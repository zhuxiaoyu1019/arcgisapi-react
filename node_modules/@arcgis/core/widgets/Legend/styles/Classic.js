/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../intl.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/Logger.js";import{subclass as l}from"../../../core/accessorSupport/decorators/subclass.js";import a from"../../Widget.js";import{renderRelationshipRamp as s}from"./support/relationshipUtils.js";import{getUnivariateAboveAndBelowRampElements as i,getUnivariateColorRampSize as t,getUnivariateColorRampPreview as n,getUnivariateColorRampMargin as o,getUnivariateColorSizeRampElements as p}from"./support/univariateUtils.js";import{getTitle as d,isRendererTitle as y,attachToNode as m,isImageryStretchedLegend as c}from"../support/styleUtils.js";import{Heading as g}from"../../support/Heading.js";import"../../support/widgetUtils.js";import{messageBundle as v}from"../../support/decorators/messageBundle.js";import{tsx as h}from"../../support/jsxFactory.js";import{formatNumber as b}from"../../../intl/number.js";const _={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},u="esri-legend__",f=24,L={display:"flex",alignItems:"flex-start"},w={marginLeft:"3px"},C={display:"table-cell",verticalAlign:"middle"};let R=class extends a{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return h("div",null,r&&r.length?r:h("div",{class:_.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,l=`${u}${e.layer.uid}-version-${e.version}`,a=e.title?g({level:this.headingLevel,class:this.classes(_.header,_.label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return h("div",{key:l,class:this.classes(_.service,_.groupLayer)},a,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer))).filter((e=>!!e));if(!s.length)return null;const i={[_.groupLayerChild]:!!e.parent};return h("div",{key:l,class:this.classes(_.service,i),tabIndex:0},a,h("div",{class:_.layer},s))}}_renderLegendForElement(e,r,l){const a="color-ramp"===e.type,i="opacity-ramp"===e.type,t="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||t){const l=e.infos.map((l=>this._renderLegendForElementInfo(l,r,t,e.legendType))).filter((e=>!!e));l.length&&(n=h("div",{class:_.layerBody},l))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,r.opacity):"relationship-ramp"===e.type?n=s(e,this.id,r.opacity):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,r.opacity):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,r.opacity));if(!n)return null;const o=e.title;let p=null;if("string"==typeof o)p=o;else if(o){const e=d(this.messages,o,a||i);p=y(o,a||i)&&o.title?`${o.title} (${e})`:e}const m=l?_.layerChildTable:_.layerTable,c=p?h("div",{class:_.layerCaption},p):null,g={[_.layerTableSizeRamp]:t||!l};return h("div",{class:this.classes(m,g)},c,n)}_renderUnivariateAboveAndBelowRamp(e,r){const{sizeRampElement:l,colorRampElement:a}=i(e,r),s=t(l,"above",!0),p=t(l,"below",!0),d=12,y=n(a,{width:d,height:s,rampAlignment:"vertical",opacity:r,type:"above"}),c=n(a,{width:d,height:p,rampAlignment:"vertical",opacity:r,type:"below"}),g=o(l),v=l.infos.map((e=>e.label)),b=v.map(((e,r)=>{const l=2===r;return 0===r?h("div",{key:r,class:e?y?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):l?h("div",null):null})),u=v.length-1,f=Math.floor(v.length/2),R=v.map(((e,r)=>r===f||r===u?h("div",{key:r,class:e?y?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):null)),A={display:"table-cell",verticalAlign:"middle"},S={marginTop:`${g}px`},I={height:`${s}px`},j={height:`${p}px`};return h("div",{key:"univariate-above-and-below-ramp-preview",styles:L},h("div",{class:_.layerBody},l.infos.map(((e,r)=>h("div",{class:this.classes(_.layerRow,_.sizeRamp)},h("div",{class:_.symbol,styles:A,bind:e.preview,afterCreate:m}),y||r%2!=0?null:h("div",{class:_.layerInfo},v[r]))))),y?h("div",{styles:S,key:"color-ramp-preview"},h("div",{styles:w},h("div",{styles:C},h("div",{class:_.rampContainer,bind:y,afterCreate:m})),h("div",{styles:C},h("div",{class:_.rampLabelsContainer,styles:I},b))),h("div",{styles:w},h("div",{styles:C},h("div",{class:_.rampContainer,bind:c,afterCreate:m})),h("div",{styles:C},h("div",{class:_.rampLabelsContainer,styles:j},R)))):null)}_renderUnivariateColorSizeRamp(e,r){const{sizeRampElement:l,colorRampElement:a}=p(e),s=o(l),i=12,d=t(l,"full",!1),y=n(a,{width:i,height:d,rampAlignment:"vertical",opacity:r,type:"full"}),c=l.infos.length-1,g=l.infos.map(((e,r)=>0===r||r===c?h("div",{key:r,class:e.label?a?_.univariateAboveAndBelowLabel:_.rampLabel:null},e.label):null)),v={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${s}px`},u={height:`${d}px`};return h("div",{key:"univariate-above-and-below-ramp-preview",styles:L},h("div",{class:_.layerBody},l.infos.map((e=>h("div",{class:this.classes(_.layerRow,_.sizeRamp)},h("div",{class:_.symbol,styles:v,bind:e.preview,afterCreate:m}))))),h("div",{styles:b,key:"color-ramp-preview"},h("div",{styles:w},h("div",{styles:C},h("div",{class:_.rampContainer,bind:y,afterCreate:m})),h("div",{styles:C},h("div",{class:_.rampLabelsContainer,styles:u},g)))))}_renderLegendForRamp(e,r){const l=e.infos,a="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,t=e.preview,n=a?_.opacityRamp:"";t.className=`${_.colorRamp} ${n}`,null!=r&&(t.style.opacity=r.toString());const o=l.map((e=>h("div",{class:e.label?_.rampLabel:null},s?this.messages[e.label]:i?this._getStretchStopLabel(e):e.label))),p={width:`${f}px`},d={height:t.style.height};return h("div",{class:_.layerRow},h("div",{class:_.symbolContainer,styles:p},h("div",{class:_.rampContainer,bind:t,afterCreate:m})),h("div",{class:_.layerInfo},h("div",{class:_.rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:b(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}_renderLegendForElementInfo(e,r,l,a){if(e.type)return this._renderLegendForElement(e,r,!0);let s=null;const i=c(r,a);if(e.preview?s=h("div",{class:_.symbol,bind:e.preview,afterCreate:m}):e.src&&(s=this._renderImage(e,r,i)),!s)return null;const t={[_.imageryLayerInfoStretched]:i},n={[_.imageryLayerInfoStretched]:i,[_.sizeRamp]:!i&&l};return h("div",{class:_.layerRow},h("div",{class:this.classes(_.symbolContainer,n)},s),h("div",{class:this.classes(_.layerInfo,t)},d(this.messages,e.label,!1)||""))}_renderImage(e,r,l){const{label:a,src:s,opacity:i}=e,t={[_.imageryLayerStretchedImage]:l,[_.symbol]:!l},n={opacity:`${null!=i?i:r.opacity}`};return h("img",{alt:d(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(t),styles:n})}};e([r()],R.prototype,"activeLayerInfos",void 0),e([r()],R.prototype,"headingLevel",void 0),e([r(),v("esri/widgets/Legend/t9n/Legend")],R.prototype,"messages",void 0),e([r({readOnly:!0})],R.prototype,"type",void 0),R=e([l("esri.widgets.Legend.styles.Classic")],R);var A=R;export default A;
