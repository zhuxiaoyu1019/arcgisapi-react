/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"@esri/calcite-components/dist/custom-elements/bundles/select.js";import"../intl.js";import i from"../core/Handles.js";import{destroyMaybe as t,isNone as o,applySome as s,isSome as l}from"../core/maybe.js";import{convertTime as r}from"../core/timeUtils.js";import{aliasOf as a}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/has.js";import"../core/accessorSupport/ensureType.js";import"../core/Logger.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import{reactionInit as c}from"../core/accessorSupport/trackingUtils.js";import{substitute as m}from"../intl/substitute.js";import p from"./Slider.js";import u from"./Widget.js";import{CSS as h}from"./ShadowAccumulation/css.js";import v from"./ShadowAccumulation/ShadowAccumulationViewModel.js";import g from"./ShadowAccumulation/ShadowAccumulationVisibleElements.js";import{DiscreteConfigurator as f}from"./ShadowAccumulation/components/DiscreteConfigurator.js";import{DurationConfigurator as w}from"./ShadowAccumulation/components/DurationConfigurator.js";import{ShadowTooltip as b}from"./ShadowAccumulation/components/ShadowTooltip.js";import{ThresholdConfigurator as _}from"./ShadowAccumulation/components/ThresholdConfigurator.js";import{TimezonePicker as y}from"./ShadowAccumulation/components/TimezonePicker.js";import S from"./support/DatePicker.js";import{Heading as M}from"./support/Heading.js";import{formatSliderLabel as j}from"./support/timeWidgetUtils.js";import"./support/widgetUtils.js";import{messageBundle as T}from"./support/decorators/messageBundle.js";import{tsx as k}from"./support/jsxFactory.js";import{formatDate as C}from"../intl/date.js";const z={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},V={labelFormatFunction:j,min:0,max:1439,steps:5,rangeLabelInputsEnabled:!1,visibleElements:{labels:!1,rangeLabels:!1},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(e,i,t)=>{i.classList.add(h.timeRangePrimaryTick),t.classList.add(h.timeRangePrimaryTickLabel);const o=t.innerText;-1!==o.indexOf(" ")&&(t.innerHTML=o.replace(/(.*) (.*)/,`$1<br><div class="${h.timeRangeAMPMLabel}">$2</div>`))}},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(e,i)=>{i.classList.add(h.timeRangeSecondaryTick)}}]};let O=class extends u{constructor(e,t){super(e,t),this.viewModel=null,this.view=null,this.headingLevel=4,this.iconClass=h.widgetIcon,this.label=void 0,this.visibleElements=new g,this._handles=new i,this._defaultViewModel=null,this._timeSlider=new p({...V,container:document.createElement("div")}),this._tooltip=null,this._onTimezoneChange=e=>{this.viewModel.utcOffset=e},this._onDateChange=e=>{this.viewModel.date=e},null!=e&&e.viewModel||(this._defaultViewModel=new v({view:null==e?void 0:e.view}),this.viewModel=this._defaultViewModel)}initialize(){this._handles.add([c((()=>({viewModel:this.viewModel,slider:this._timeSlider})),(e=>this._connectTimeSlider(e))),c((()=>({container:s(this.view,(e=>e.surface)),viewModel:this.viewModel,tooltipVisible:this.visibleElements.tooltip})),(({container:e,viewModel:i,tooltipVisible:s})=>{this._tooltip=t(this._tooltip),!o(e)&&s&&(this._tooltip=new b({viewModel:i,container:e}))})),c((()=>({viewModel:this.viewModel,visible:this.visible})),(({viewModel:e,visible:i})=>e.setRunning(i)))])}destroy(){this._handles=t(this._handles),this._timeSlider=t(this._timeSlider),l(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}render(){const{visibleElements:e,viewModel:i}=this,t="disabled"===i.state;return k("div",{key:this,class:this.classes(h.base,h.esriWidget,{[h.esriWidgetDisabled]:t})},this._renderTimeRangeSection(),e.visualizationOptions&&this._renderVisualizationOptionsSection())}get testData(){return{tooltip:this._tooltip}}_connectTimeSlider({viewModel:e,slider:i}){if(this._handles.remove("slider"),o(i))return;const t=e=>r(e,"milliseconds","minutes"),s=e=>r(e,"minutes","milliseconds"),l=({index:i,value:t})=>{0===i?e.startTimeOfDay=s(t):e.endTimeOfDay=s(t)};this._handles.add([c((()=>[e.startTimeOfDay,e.endTimeOfDay]),(e=>{i.values=e.map(t)})),i.on("thumb-change",l),i.on("thumb-drag",l),i.on("segment-drag",(()=>{[e.startTimeOfDay,e.endTimeOfDay]=i.values.map(s)}))],"slider")}_renderTimeRangeSection(){const{visibleElements:e}=this;return e.timeRangeSlider||e.datePicker?k("section",{key:"time-range",class:h.timeRange},k(M,{level:this.headingLevel},this.messages.timeLabel),e.timeRangeSlider&&this._renderTimeRange(),e.datePicker&&this._renderDatePicker()):null}_renderTimeRange(){const{messages:e,viewModel:i,visibleElements:t}=this,{startTimeOfDay:o,endTimeOfDay:s}=i,[l,r]=[o,s].map((e=>C(new Date(e),z)));return[k("div",{key:"time-range-indicator",class:h.timeRangeIndicator},m(e.timeRange,{start:l,end:r}),t.timezone&&k(y,{value:i.utcOffset,onChange:this._onTimezoneChange})),k("div",{key:"time-slider-container",bind:this,afterCreate:this._timeSliderContainerAfterCreate,afterRemoved:this._timeSliderContainerAfterRemoved})]}_timeSliderContainerAfterCreate(e){s(this._timeSlider,(i=>{e.appendChild(i.container)}))}_timeSliderContainerAfterRemoved(e){s(this._timeSlider,(i=>{e.removeChild(i.container)}))}_renderDatePicker(){return k("div",{key:"date-picker",class:h.datePickerContainer},k(S,{value:this.viewModel.date,onChange:this._onDateChange}))}_renderVisualizationOptionsSection(){const{headingLevel:e,messages:i,viewModel:t,visibleElements:o}=this,s=o.colorPicker,l=e=>this.classes(t.visualizationType===e?null:h.visualizationConfigHidden);return k("section",{key:"visualization",class:h.visualization},k(M,{level:e},i.visualizationLabel),this._renderVisualizationSelect(),k("div",{key:"threshold-configurator",class:l("threshold")},k(_,{options:t.thresholdOptions,colorPickerVisible:s})),k("div",{key:"duration-configurator",class:l("duration")},k(w,{options:t.durationOptions,colorPickerVisible:s})),k("div",{key:"discrete-configurator",class:l("discrete")},k(f,{options:t.discreteOptions,colorPickerVisible:s})))}_renderVisualizationSelect(){const e=this.messages,i=this.viewModel.visualizationType;return k("calcite-select",{class:h.visualizationSelect,key:"visualization-select",label:e.visualizationLabel,bind:this,onCalciteSelectChange:this._onVisualizationTypeChange},[{type:"threshold",label:e.threshold.label},{type:"duration",label:e.duration.label},{type:"discrete",label:e.discrete.label}].map((({type:e,label:t})=>k("calcite-option",{value:e,selected:e===i},t))))}_onVisualizationTypeChange(e){var i;const t=null==(i=e.target.selectedOption)?void 0:i.value;this.viewModel.visualizationType=null!=t?t:"threshold"}};e([n()],O.prototype,"viewModel",void 0),e([a("viewModel.view")],O.prototype,"view",void 0),e([n()],O.prototype,"headingLevel",void 0),e([n()],O.prototype,"iconClass",void 0),e([a("messages.widgetLabel",{overridable:!0})],O.prototype,"label",void 0),e([n({type:g,nonNullable:!0})],O.prototype,"visibleElements",void 0),e([n(),T("esri/widgets/ShadowAccumulation/t9n/ShadowAccumulation")],O.prototype,"messages",void 0),e([n()],O.prototype,"_defaultViewModel",void 0),e([n()],O.prototype,"_timeSlider",void 0),e([n()],O.prototype,"_tooltip",void 0),O=e([d("esri.widgets.ShadowAccumulation")],O);var A=O;export default A;
