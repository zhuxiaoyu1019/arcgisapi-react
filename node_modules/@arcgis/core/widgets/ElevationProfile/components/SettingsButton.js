/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import{on as t}from"../../../core/events.js";import{isSome as o,removeMaybe as s,destroyMaybe as r,applySome as i}from"../../../core/maybe.js";import{isMeasurementSystem as n}from"../../../core/unitUtils.js";import{property as l}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/Logger.js";import{subclass as a}from"../../../core/accessorSupport/decorators/subclass.js";import c from"../../Widget.js";import{SETTINGS_CSS as p}from"../css.js";import h from"../../support/Popover.js";import"../../support/widgetUtils.js";import{messageBundle as u}from"../../support/decorators/messageBundle.js";import{tsx as m}from"../../support/jsxFactory.js";let _=class extends c{constructor(e,t){super(e,t),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;if(!e&&!t)return m("div",{key:`${this.id}-empty`});const s=o(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return m("button",{class:p.base,title:s,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":s})}_initializePopover(e){this._destroyPopover(),this._buttonElement=e,this._popover=new h({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:e,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=s(this._focusOutElement),this._popover=r(this._popover)}_renderPopoverContent(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;return m("div",{class:p.popoverContent,bind:this,afterCreate:this._onPopoverContentAfterCreate},e&&this._renderUnitSelector(),t&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:e,unitOptions:t}=this.viewModel,o=this._messagesUnits;return m("label",{key:"unit-selector-label",class:p.selectLabel},this._messages.unitSelectLabel,m("select",{class:p.select,value:e,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},t.map((e=>m("option",{key:e,value:e},n(e)?o.systems[e]:o.units[e].pluralCapitalized)))))}_onUnitChange(e){this.viewModel.unit=e.target.value}_onUnitSelectAfterCreate(e){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,e.focus())}_renderUniformChartScalingToggle(){const e=this._messages,t=this.viewModel.uniformChartScaling,o=t?e.uniformChartScalingDisable:e.uniformChartScalingEnable;return m("label",{key:"uniform-chart-scaling-label",class:p.checkboxLabel,onmousedown:g},m("input",{class:this.classes(p.checkbox,p.uniformChartScalingCheckbox),type:"checkbox",checked:t,title:o,"aria-label":o,bind:this,onchange:this._onUniformChartScalingChange}),e.uniformChartScalingLabel)}_onUniformChartScalingChange(e){this.viewModel.uniformChartScaling=e.target.checked}_togglePopover(e){o(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){i(this._popover,(e=>e.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:e=!0}={}){i(this._popover,(e=>e.open=!1)),e&&i(this._buttonElement,(e=>e.focus()))}_onPopoverContentAfterCreate(e){s(this._focusOutElement),this._focusOutElement=t(e,"focusout",(({relatedTarget:t})=>{const o=e.contains(t),s=t===this._buttonElement;o||s||this._closePopover({focusOnButton:!1})}))}};function g(e){e.preventDefault()}e([l()],_.prototype,"viewModel",void 0),e([l()],_.prototype,"visibleElements",void 0),e([l(),u("esri/widgets/ElevationProfile/t9n/ElevationProfile")],_.prototype,"_messages",void 0),e([l(),u("esri/core/t9n/Units")],_.prototype,"_messagesUnits",void 0),_=e([a("esri.widgets.ElevationProfile.SettingsButton")],_);export{_ as SettingsButton};
