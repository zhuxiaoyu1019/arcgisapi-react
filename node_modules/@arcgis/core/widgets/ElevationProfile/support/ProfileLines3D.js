/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import t from"../../../Color.js";import s from"../../../core/Accessor.js";import o from"../../../core/Handles.js";import{isNone as r,unwrapOr as i,isSome as a}from"../../../core/maybe.js";import{throttle as n}from"../../../core/throttle.js";import{property as l}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/Logger.js";import{subclass as c}from"../../../core/accessorSupport/decorators/subclass.js";import{reactionInit as p}from"../../../core/accessorSupport/trackingUtils.js";import{b as h}from"../../../chunks/vec4f64.js";import m from"../../../geometry/Polyline.js";import{OutlineVisualElement as f}from"../../../views/3d/interactive/visualElements/OutlineVisualElement.js";import{PROFILE_LINES_STYLE_3D as u}from"./constants.js";const d=100;let v=class extends s{constructor(e){super(e),this._chartData=null,this._visualElements=[],this._handles=new o}initialize(){const e=n((e=>{this._update(e)}),d);this._handles.add([p((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e),e])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(e){this._chartData=e}_update(e){const{chartData:s}=e;if(r(s))return this.remove();if(!s.refined)return;const o=this._visualElements,i=s.lines.filter((e=>e.viewVisualizationEnabled)),a=i.length;for(;o.length>a;)o.pop().destroy();const n=u;for(;o.length<a;){const e=new f({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:n.width-n.outlineSize,width:n.width,falloff:n.falloff,color:n.outlineColor,renderOccluded:n.renderOccluded});o.push(e)}const l=e.spatialReference;for(let r=0;r<a;++r){const e=o[r],s=i[a-1-r];e.geometry=this._createLineGeometry(s,l),e.innerColor=h(t.toUnitRGBA(s.color))}}_createLineGeometry(e,t){const s=i(e.samples,[]),o=s.length-1,n=[];let l=[];for(let i=0;i<=o;i++){const{x:e,y:t,z:c}=s[i];a(c)&&l.push([e,t,c]),(i===o||r(c))&&l.length&&(n.push(l),l=[])}return new m({paths:n,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0}};e([l()],v.prototype,"view",void 0),e([l()],v.prototype,"_chartData",void 0),v=e([c("esri.widgets.ElevationProfile.support.ProfileLines3D")],v);export{v as ProfileLines3D};
