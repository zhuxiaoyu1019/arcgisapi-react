/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Logger.js";import{applySome as i,isSome as s}from"../core/maybe.js";import{init as o}from"../core/watchUtils.js";import{aliasOf as a}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/has.js";import{cast as r}from"../core/accessorSupport/decorators/cast.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import d from"./Widget.js";import c from"./Daylight/DaylightViewModel.js";import{ORDERED_SEASONS as h}from"./Daylight/support/daylightUtils.js";import p from"./Daylight/support/SliderWithDropdown.js";import m from"./support/DatePicker.js";import{Heading as g}from"./support/Heading.js";import{formatSliderLabel as w,getTimezoneInfos as v}from"./support/timeWidgetUtils.js";import"./support/widgetUtils.js";import{messageBundle as u}from"./support/decorators/messageBundle.js";import{tsx as y}from"./support/jsxFactory.js";const b={base:"esri-daylight",widgetIcon:"esri-icon-environment-settings",button:"esri-button",checkbox:"esri-daylight__checkbox",checked:"esri-icon-checkbox-checked",dayContainer:"esri-daylight__container esri-daylight__day-container",dateContainer:"esri-daylight__container esri-daylight__date-container",interactive:"esri-interactive",label:" esri-widget__anchor",labelledTick:"esri-daylight__container__labelled-tick",pause:"esri-icon-pause",play:"esri-icon-play",playPauseButton:"esri-daylight__play-pause-button",select:"esri-select",seasonPicker:"esri-daylight__season-picker",shadow:"esri-daylight__shadow-container",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",tick:"esri-daylight__container__tick",unchecked:"esri-icon-checkbox-unchecked",widget:"esri-widget",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",panelError:"esri-daylight__panel--error"},_={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},f=t.getLogger("esri.widgets.Daylight"),S="date";let k=class extends d{constructor(e,t){var i;super(e,t),this.headingLevel=3,this.iconClass=b.widgetIcon,this.label=void 0,this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new c,this.visibleElements={..._},this.dateOrSeason=S,this._timeSlider=new p({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:w,inputFormatFunction:w,min:0,max:1439,steps:null!=(i=this.timeSliderSteps)?i:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new m({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0})}get gmtOffsets(){return i(this.timezoneMessages,v)}castVisibleElements(e){return{..._,...e}}postInitialize(){this.viewModel.isSupported&&this.own(o(this.viewModel,"datePickerViewModel",(e=>{this._datePicker.viewModel=e})),o(this.viewModel,"timeSliderViewModel",(e=>{this._timeSlider.viewModel=e})),o(this,"messages",(()=>{this._timeSlider.buttonTooltip=this.timezoneMessages.chooseTimezone})),o(this,"visibleElements",(()=>{this._timeSlider.showDropDown=this.visibleElements.timezone})),o(this,"gmtOffsets",(e=>{s(e)&&(this._timeSlider.items=e.map((e=>({utcOffset:e.utcOffset,name:e.short,label:[e.shortWithUTC,e.long]}))))})),o(this,["viewModel.utcOffset","gmtOffsets"],(()=>this._onUTCOffsetChange())))}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){return this.viewModel.isSupported?y("div",{class:this.classes(b.base,b.widget)},y(g,{level:this.headingLevel},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):y("div",{class:this.classes(b.base,b.widget)},y("div",{key:"daylight__unsupported",class:b.panelError},y("p",null,this.messages.unsupported)))}renderTimeOptions(){const e={[b.play]:!this.viewModel.dayPlaying,[b.pause]:this.viewModel.dayPlaying},t={[b.shadowOn]:this.viewModel.directShadowsEnabled,[b.shadowOff]:!this.viewModel.directShadowsEnabled},i={[b.sliderDateOn]:this.visibleElements.datePicker,[b.sliderDateOff]:!this.visibleElements.datePicker};return y("div",{class:this.classes(b.dayContainer,t,i),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?y("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(b.button,b.playPauseButton,e)},y("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},y("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderDateOptions(){const e={[b.play]:!this.viewModel.yearPlaying,[b.pause]:this.viewModel.yearPlaying};return y("div",{class:b.dateContainer,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?y("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(b.button,b.playPauseButton,e)},y("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},y("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderShadowOptions(){const e=`${this.id}__shadowButton`,t={[b.checked]:this.viewModel.directShadowsEnabled,[b.unchecked]:!this.viewModel.directShadowsEnabled};return y("div",{class:b.shadow,key:"daylight-shadow-options"},y("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(b.button,b.checkbox,t),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),y("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(b.label,b.interactive),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))}renderSeasonOptions(){return y("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(b.select,b.seasonPicker),value:this.viewModel.currentSeason,"aria-label":this.messages.season},h.map((e=>y("option",{value:e},this.messages[e]))))}_onSeasonChange(e){const t=e.target;this.viewModel.currentSeason=t.value}_onUTCOffsetChange(){var e;const t=this.viewModel.utcOffset,i=null==(e=this._timeSlider.currentItem)?void 0:e.utcOffset,o=this.gmtOffsets;if(!s(o)||i===t)return;const a=o.findIndex((({utcOffset:e})=>e===t));a>-1&&(this._timeSlider.currentIndex=a)}_onPrimaryTickCreated(e,t,i){t.className+=" esri-interactive esri-widget__anchor "+b.tick+" "+b.labelledTick,i.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};t.onclick=s,i.onclick=s;const o=i.innerText;-1!==o.indexOf(" ")&&(i.innerHTML=o.replace(/(.*) (.*)/,'$1<br><div class="esri-label__ampm">$2</div>'))}_onSecondaryTickCreated(e,t){t.className+=" esri-interactive esri-widget__anchor "+b.tick,t.onclick=()=>{this.viewModel.timeSliderPosition=e}}};e([l({readOnly:!0})],k.prototype,"gmtOffsets",null),e([l(),u("esri/widgets/Daylight/t9n/Daylight")],k.prototype,"messages",void 0),e([l(),u("esri/widgets/support/t9n/timezone")],k.prototype,"timezoneMessages",void 0),e([l()],k.prototype,"headingLevel",void 0),e([l()],k.prototype,"iconClass",void 0),e([l({aliasOf:{source:"messages.title",overridable:!0}})],k.prototype,"label",void 0),e([a("viewModel.playSpeedMultiplier")],k.prototype,"playSpeedMultiplier",void 0),e([a("_timeSlider.steps")],k.prototype,"timeSliderSteps",void 0),e([a("viewModel.view")],k.prototype,"view",void 0),e([l({type:c})],k.prototype,"viewModel",void 0),e([l()],k.prototype,"visibleElements",void 0),e([r("visibleElements")],k.prototype,"castVisibleElements",null),e([l({cast:e=>"season"===e||"date"===e?e:(f.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${S}".`),S)})],k.prototype,"dateOrSeason",void 0),e([l()],k.prototype,"_timeSlider",void 0),e([l()],k.prototype,"_datePicker",void 0),k=e([n("esri.widgets.Daylight")],k);var M=k;export default M;
