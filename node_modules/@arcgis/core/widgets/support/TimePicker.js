/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../intl.js";import{eventKey as e}from"../../core/events.js";import{aliasOf as i}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import"../../core/Logger.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import{loadMoment as a}from"../../intl/moment.js";import o from"../Widget.js";import n from"./TimePickerViewModel.js";import"./widgetUtils.js";import{messageBundle as u}from"./decorators/messageBundle.js";import{tsx as h}from"./jsxFactory.js";import{formatDate as c}from"../../intl/date.js";const l={base:"esri-time-picker esri-widget",timePicker:"esri-time-picker__date-picker",timePickerInput:"esri-time-picker__input",input:"esri-input",button:"esri-widget--button"},m={hour:"numeric",minute:"numeric"},p="LT",d=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function _(t){return c(t.valueOf(),m).indexOf(" ")>-1}let v=class extends o{constructor(t,e){super(t,e),this._activeTime=null,this.label=void 0,this.messages=null,this.value=null,this.viewModel=new n}async loadLocale(){this._moment=await a()}render(){const t=this._activeTime||this.viewModel.value;return h("div",{class:l.base},h("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(l.timePickerInput,l.input),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:c(t.valueOf(),m)}))}_handleInputBlur(){this._activeTime.isValid()&&(this.viewModel.value=this._activeTime.toDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(t){this._selectPart(t,this._activePart)}_selectPart(t,e){const i=this._activeTime;if(!i)return;const s=c(i.valueOf(),m),r=0,a=s.indexOf(":");if("hours"===e)return void t.setSelectionRange(r,a);const o=a+1,n=o+2;if("minutes"===e)return void t.setSelectionRange(o,n);const u=n+1,h=s.length;"meridiem"!==e||t.setSelectionRange(u,h)}_handleInputFocus(t){this._activePart="hours",this._activeTime=this._moment(this.viewModel.value).startOf("minute"),this._selectPart(t.target,"hours")}_caretIndexToPartName(t){const e=this._activeTime.format(p),i=e.indexOf(":"),s=e.indexOf(" ");return t<=i?"hours":t>i&&t<=s?"minutes":"meridiem"}_handleInputKeydown(t){const{ctrlKey:i,metaKey:s,shiftKey:r}=t,a=e(t),o=this._activeTime,n=this._activePart,u=/\d/.test(a),h=/^a|p$/i.test(a),c=s||i;if(d.indexOf(a)>-1||u||"meridiem"===n&&h&&!c){if("ArrowLeft"===a)this._activePart=this._prevPart();else if("ArrowRight"===a)this._activePart=this._nextPart();else if("Tab"===a){const t=r?this._prevPart():this._nextPart();if(t===this._activePart)return;this._activePart=t}else if("ArrowUp"===a)this._shift("up",o,n);else if("ArrowDown"===a)this._shift("down",o,n);else if(u)this._setTime(o,n,Number(a));else if(h){const t=a.toLowerCase(),e=o.hour();("a"===t&&e>=12||"p"===t&&e<12)&&this._shift("up",o,n)}t.preventDefault(),t.stopImmediatePropagation()}else c||(t.preventDefault(),t.stopImmediatePropagation())}_handleInputClick(t){const e=t.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(e.selectionStart)}_getOrderedParts(){return _(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const t=this._getOrderedParts(),e=t.indexOf(this._activePart)-1;return t[Math.max(e,0)]}_nextPart(){const t=this._getOrderedParts(),e=t.indexOf(this._activePart)+1;return t[Math.min(e,t.length-1)]}_setTime(t,e,i){if("hours"===e){const e=_(t)?12:24,s=""+t.hour()%e,r=i,a=Number(`${s}${i}`);2===s.length||a>e?t.hour(r):a<=e&&t.hour(a)}else if("minutes"===e){const e=59,s=`${t.minute()}`,r=i,a=Number(`${s}${i}`);2===s.length||a>e?t.minute(r):a<e&&t.minute(a)}}_handleInputPaste(t){const e=t.clipboardData.getData("text/plain"),i=this._moment(e);i.isValid()&&(this._activeTime=i),t.preventDefault(),t.stopImmediatePropagation()}_handleInputWheel(t){const e=t.deltaY<0?"up":"down";this._shift(e,this._activeTime,this._activePart)}_shift(t,e,i){if(!t||!e||!i)return;const s="meridiem"===i?12:1,r="hours"===i?"hour":"minutes"===i?"minute":"hours";e["up"===t?"add":"subtract"](s,r)}};t([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],v.prototype,"label",void 0),t([s(),u("esri/widgets/support/t9n/TimePicker")],v.prototype,"messages",void 0),t([i("viewModel.value")],v.prototype,"value",void 0),t([s({type:n})],v.prototype,"viewModel",void 0),v=t([r("esri.widgets.support.TimePicker")],v);var f=v;export default f;
