/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"@esri/calcite-components/dist/custom-elements/bundles/action.js";import"@esri/calcite-components/dist/custom-elements/bundles/block.js";import"@esri/calcite-components/dist/custom-elements/bundles/icon.js";import"@esri/calcite-components/dist/custom-elements/bundles/label.js";import"@esri/calcite-components/dist/custom-elements/bundles/panel.js";import"@esri/calcite-components/dist/custom-elements/bundles/pick-list.js";import"@esri/calcite-components/dist/custom-elements/bundles/switch.js";import{destroyMaybe as s,isNone as t}from"../../core/maybe.js";import{aliasOf as i}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/has.js";import{cast as o}from"../../core/accessorSupport/decorators/cast.js";import"../../core/Logger.js";import{property as l}from"../../core/accessorSupport/decorators/property.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import r from"../Widget.js";import"./widgetUtils.js";import{messageBundle as a}from"./decorators/messageBundle.js";import{tsx as p}from"./jsxFactory.js";import c from"./SnappingControls/SnappingControlsViewModel.js";const d={header:!0},m={base:"esri-snapping-controls",container:"esri-snapping-controls__container",panel:"esri-snapping-controls__panel",item:"esri-snapping-controls__item",toggleBlock:"esri-snapping-controls__toggle-block",disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let g=class extends r{constructor(e,s){super((()=>{const{view:s,viewModel:t,snappingOptions:i,...o}=e;return o})(),s),this.label=void 0,this.messages=null,this.messagesCommon=null,this.snappingOptions=null,this.view=null,this.visibleElements={...d},this._defaultViewModel=null,null!=e&&e.viewModel?this.viewModel=e.viewModel:(this._defaultViewModel=new c({snappingOptions:e.snappingOptions,view:e.view}),this.viewModel=this._defaultViewModel)}destroy(){this._defaultViewModel=s(this._defaultViewModel)}set viewModel(e){e!==this._get("viewModel")&&((t(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=s(this._defaultViewModel)),this._set("viewModel",e))}castVisibleElements(e){return{...d,...e}}render(){const{label:e,messagesCommon:{close:s},visibleElements:{header:t}}=this,i=p("calcite-block",{class:m.toggleBlock,open:!0},this.renderSnappingToggle()),o=t?p("div",{class:m.container},p("calcite-panel",{heading:e,class:m.panel},p("calcite-action",{text:s,slot:"header-actions-end",icon:"x",appearance:"solid"}),i,this.renderLayerList())):p("div",{class:m.container},i,this.renderLayerList());return p("div",{"aria-label":e,class:this.classes(m.base,m.esriWidget)},o)}renderSnappingToggle(){const{messages:{enableSnapping:e},viewModel:{snappingOptions:{featureEnabled:s,enabledToggled:t}}}=this;return p("calcite-label",{layout:"inline-space-between"},e,p("calcite-switch",{switched:s,disabled:t,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))}renderLayerList(){const{messages:{snappingLayers:e,searchLayers:s}}=this;return p("calcite-block",{heading:e,open:!0,collapsible:!0},p("calcite-pick-list",{multiple:!0,bind:this,onCalciteListChange:this._layerListChange,filterEnabled:this.viewModel.layerListViewModel.operationalItems.length>=10,"filter-placeholder":s},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems)))}renderLayerListItemCollection(e){return e.map((e=>e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e))).toArray()}renderLayerListItem(e){var s;const{messages:{untitledLayer:t}}=this,i=e.title||t,o=(null==(s=e.children)?void 0:s.length)>0,l=e.enabled;return p("calcite-pick-list-item",{slot:o?"parent-item":null,key:`${this.id}-pick-list-item-${e.uid}`,label:i,value:e.layer.id,selected:l})}renderLayerListItemGroup(e){const s=e.title||this.messages.untitledLayer;return p("calcite-pick-list-group",{"group-title":s},[...this.renderLayerListItemCollection(e.children)])}_enableSnappingSwitchChange(e){this.snappingOptions.featureEnabled=e.detail.switched}_layerListChange(e){const s=e.detail;this.viewModel.updateEnabledFeatureSources([...s.keys()])}};e([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0),e([l(),a("esri/widgets/support/SnappingMenu/t9n/SnappingMenu")],g.prototype,"messages",void 0),e([l(),a("esri/t9n/common")],g.prototype,"messagesCommon",void 0),e([i("viewModel.snappingOptions")],g.prototype,"snappingOptions",void 0),e([i("viewModel.view")],g.prototype,"view",void 0),e([l()],g.prototype,"viewModel",null),e([l()],g.prototype,"visibleElements",void 0),e([o("visibleElements")],g.prototype,"castVisibleElements",null),g=e([n("esri.widgets.support.SnappingControls")],g);var u=g;export default u;
