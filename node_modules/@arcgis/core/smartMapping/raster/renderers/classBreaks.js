/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import r from"../../../core/Error.js";import{isSome as e}from"../../../core/maybe.js";import{formatNumber as a}from"../../../intl/number.js";import{createClassBreaksRenderer as s}from"../../../renderers/support/rasterRendererHelper.js";import{processRasterRendererParameters as t}from"../support/utils.js";async function n(a){const s=(a=await t(a)).layer,{rasterInfo:n}=s;if(n.bandCount>1)throw new r("raster-class-breaks-renderer:not-supported","Multiband raster is not supported");if(!e(n.attributeTable)&&!e(n.histograms)&&(await s.updateRasterInfoWithEstimatedStats({renderingRule:a.renderingRule,signal:a.signal}),!e(n.histograms)))throw new r("raster-class-breaks-renderer:not-supported","Histograms or raster attribute table is required on the source raster. Unable to estimate histograms");const{colors:o,numClasses:i}=a;if(o&&i&&o.length!==i)throw new r("raster-class-breaks-renderer:not-supported","The size of the `colors` parameter does not match 'numClasses'");return a.field||(a.field="value"),a.classificationMethod||(a.classificationMethod="natural-breaks"),a}async function o(a){a=await n(a);const t=s(a.layer.rasterInfo,a);if(!e(t))throw new r("raster-class-breaks-renderer:not-supported","Class breaks renderer is not supported on this data");const o={minValue:t.minValue,maxValue:t.classBreakInfos[t.classBreakInfos.length-1].maxValue,normalizationTotal:null,classBreakInfos:t.classBreakInfos.map((r=>{const e=i(r.minValue,r.maxValue);return r.label=e,{minValue:r.minValue,maxValue:r.maxValue,label:e}}))};return{renderer:t,classBreaksResult:o}}function i(r,e){return a(r,{maximumFractionDigits:3})+" - "+a(e,{maximumFractionDigits:3})}export{o as createRenderer};
