/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{isSome as t}from"../../core/maybe.js";import{getScaleForResolution as i}from"../../geometry/support/scaleUtils.js";import r from"../../renderers/visualVariables/SizeVariable.js";import a from"../statistics/spatialStatistics.js";import{createLayerAdapter as s,getLayerTypeLabels as o}from"../support/adapters/support/layerUtils.js";const n=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];async function l(i){const{view:r}=i;if(!(i&&r&&i.layer))throw new e("outline:missing-parameters","'view' and 'layer' parameters are required");const a=[0,2,3,1,5],{layer:n,...l}=i,p=s(n,a),u={layerAdapter:p,...l};if(!p)throw new e("outline:invalid-parameters","'layer' must be one of these types: "+o(a).join(", "));await r.when();const m=t(u.signal)?{signal:u.signal}:null;if(await p.load(m),"polygon"!==p.geometryType)throw new e("outline:not-supported",`outline is not supported for geometryType: ${p.geometryType}`);return u}function p(e,t){const a=e.avgSize,s=i(1,t.spatialReference),o=n.map((e=>({size:e.width,value:Math.round(a/e.size*s)})));o.sort(((e,t)=>e.value-t.value));return{visualVariables:[new r({target:"outline",valueExpression:"$view.scale",stops:o})],opacity:.25}}async function u(t){const{layerAdapter:i,...r}=await l(t),s=-1,o=await i.getSampleFeatures({sampleSize:s,returnGeometry:!0,...r}),n=await a({features:o,geometryType:i.geometryType});if(!("avgSize"in n)||!n.avgSize)throw new e("outline:insufficient-info","average polygon size is invalid");return p(n,r.view)}export default u;
