/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import s from"../../core/Error.js";import{isSome as i}from"../../core/maybe.js";import{isDateField as e,numericTypes as r}from"../../layers/support/fieldUtils.js";import{verifyBasicFieldValidity as a,verifyFieldType as t}from"./support/utils.js";import{getNormalizationType as o,getFieldsList as n}from"../support/utils.js";import{createLayerAdapter as l,getLayerTypeLabels as m}from"../support/adapters/support/layerUtils.js";const p=[...r,"date","string"];async function u(r){if(!(r&&r.layer&&(r.field||r.valueExpression||r.sqlExpression)))throw new s("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(r.valueExpression&&!r.sqlExpression&&!r.view)throw new s("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");const u=[0,2,1,3,4,5],{layer:d,...f}=r,c=l(d,u),y={layerAdapter:c,...f};if(y.normalizationType=o(y),!c)throw new s("summary-statistics:invalid-parameters","'layer' must be one of these types: "+m(u).join(", "));const w=i(y.signal)?{signal:y.signal}:null;await c.load(w);const v=y.field,x=y.normalizationType,E=y.valueExpression||y.sqlExpression,h=v?c.getField(v):null,g=await n({field:y.field,normalizationField:y.normalizationField,valueExpression:y.valueExpression}),j=a(c,g,"summary-statistics:invalid-parameters");if(j)throw j;if(h){const i=t(c,h,"summary-statistics:invalid-parameters",p);if(i)throw i;if(e(h)&&x)throw new s("summary-statistics:invalid-parameters","Normalization is not allowed for date fields")}else if(E&&x)throw new s("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");return y}async function d(s){const{layerAdapter:i,...e}=await u(s);return i.summaryStatistics(e)}export default d;
