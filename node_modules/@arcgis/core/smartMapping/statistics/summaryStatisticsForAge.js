/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{isSome as a}from"../../core/maybe.js";import r from"./summaryStatistics.js";import{getAgeExpressions as t,verifyDates as i,supportedAgeUnits as s}from"./support/ageUtils.js";import{createLayerAdapter as n,getLayerTypeLabels as m}from"../support/adapters/support/layerUtils.js";async function o(r){if(!(r&&r.layer&&r.startTime&&r.endTime&&r.unit))throw new e("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const t=[0,2,1,3,5],{layer:o,...l}=r,u=n(o,t),p={layerAdapter:u,...l};if(!u)throw new e("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+m(t).join(", "));const y=p.view,f=a(p.signal)?{signal:p.signal}:null;await Promise.all([y&&y.when(),u.load(f)]);const d=i(u,p.startTime,p.endTime,"summary-statistics-for-age:invalid-parameters");if(d)throw d;if(-1===s.indexOf(p.unit))throw new e("summary-statistics-for-age:invalid-parameters",`Supported units are: ${s.join(", ")}`);return p}async function l(e){const{layerAdapter:a,...i}=await o(e),{view:s,startTime:n,endTime:m,unit:l,minValue:u,maxValue:p,signal:y}=i,{valueExpression:f,statisticsQuery:d}=t({layer:a,startTime:n,endTime:m,unit:l}),c={layer:a,valueExpression:f,...d,minValue:u,maxValue:p,view:s,signal:y};return r(c)}export default l;
