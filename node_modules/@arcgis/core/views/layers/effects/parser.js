/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{hex2rgba as t,getNamedColorCopy as e,hsla2rgba as r}from"../../../colorUtils.js";import n from"../../../core/Error.js";import{BloomEffect as u,DropShadowEffect as a,BlurEffect as c,HueRotateEffect as o,OpacityEffect as i,ColorMatrixEffect as s}from"./effects.js";import{c as f}from"../../../chunks/_commonjsHelpers.js";var l,p,h={exports:{}};function m(t){let e;try{e=t?h.exports.parse(t):[]}catch(u){return{input:t,parsedFunctions:[],effects:[],error:new n("effect:invalid-syntax","Invalid effect syntax",{input:t,error:u})}}const r={input:t,parsedFunctions:e,effects:[],error:null};try{for(const t of e)r.effects.push(g(t))}catch(u){r.effects.length=0,r.error=u}return r}function g(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return d(t);case"opacity":return v(t);case"hue-rotate":return A(t);case"blur":return y(t);case"drop-shadow":return w(t);case"bloom":return x(t)}}catch(e){throw e.details.filter=t,e}throw new n("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function d(t){let e=1;return b(t.parameters,1),1===t.parameters.length&&(e=z(t.parameters[0])),new s(t.name,e)}function v(t){let e=1;return b(t.parameters,1),1===t.parameters.length&&(e=z(t.parameters[0])),new i(e)}function A(t){let e=0;return b(t.parameters,1),1===t.parameters.length&&(e=T(t.parameters[0])),new o(e)}function y(t){let e=0;return b(t.parameters,1),1===t.parameters.length&&(e=I(t.parameters[0]),C(e,t.parameters[0])),new c(e)}function w(t){const e=[];let r;for(const u of t.parameters)if("color"===u.type){if(e.length&&Object.freeze(e),r)throw new n("effect:type-error","Accepts only one color",{});r=M(u)}else{const t=I(u);if(Object.isFrozen(e))throw new n("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&C(t,u)}if(e.length<2||e.length>3)throw new n("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new a(e[0],e[1],e[2]||0,r||O("black"))}function x(t){let e=1,r=0,n=0;return b(t.parameters,3),t.parameters[0]&&(e=z(t.parameters[0])),t.parameters[1]&&(r=I(t.parameters[1]),C(r,t.parameters[1])),t.parameters[2]&&(n=z(t.parameters[2])),new u(e,r,n)}function b(t,e){if(t.length>e)throw new n("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function F(t){return"color"===t.type?"<color>":q[t.unit]?"<length>":j[t.unit]?"<angle>":"%"===t.unit?"<percentage>":"<double>"}function C(t,e){if(t<0)throw new n("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function E(t){if("quantity"!==t.type||null!==t.unit)throw new n("effect:type-error",`Expected <double>, Actual: ${F(t)}`,{term:t})}function $(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new n("effect:type-error",`Expected <double> or <percentage>, Actual: ${F(t)}`,{term:t})}p=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,r,n,u){this.message=t,this.expected=r,this.found=n,this.location=u,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function r(t,r){r=void 0!==r?r:{};var n,u={},a={start:Kt},c=Kt,o=_t("none"),i="none",s=Ht("none",!1),f=function(){return[]},l=")",p=Ht(")",!1),h=function(t,e){return{type:"function",name:t,parameters:e||[]}},m=",",g=Ht(",",!1),d=function(t,e){return e.length>0?ie(t,e,3):[t]},v=function(t){return{type:"quantity",value:t.value,unit:t.unit}},A=function(t){return{type:"color",colorType:t.type,value:t.value}},y=_t("whitespace"),w=/^[ \t\n\r]/,x=Nt([" ","\t","\n","\r"],!1,!1),b=_t("function"),F="(",C=Ht("(",!1),E=function(t){return t},$=_t("identifier"),j=/^[a-z\-]/,k=Nt([["a","z"],"-"],!1,!1),q=function(){return Ut()},S=_t("percentage"),z="%",R=Ht("%",!1),T=function(t){return{value:t,unit:"%"}},I=_t("length"),M="px",O=Ht("px",!1),U=function(t){return{value:t,unit:"px"}},H="cm",N=Ht("cm",!1),P=function(t){return{value:t,unit:"cm"}},_="mm",B=Ht("mm",!1),D=function(t){return{value:t,unit:"mm"}},G="in",J=Ht("in",!1),K=function(t){return{value:t,unit:"in"}},L="pt",Q=Ht("pt",!1),V=function(t){return{value:t,unit:"pt"}},W="pc",X=Ht("pc",!1),Y=function(t){return{value:t,unit:"pc"}},Z=_t("angle"),tt="deg",et=Ht("deg",!1),rt=function(t){return{value:t,unit:"deg"}},nt="rad",ut=Ht("rad",!1),at=function(t){return{value:t,unit:"rad"}},ct="grad",ot=Ht("grad",!1),it=function(t){return{value:t,unit:"grad"}},st="turn",ft=Ht("turn",!1),lt=function(t){return{value:t,unit:"turn"}},pt=_t("number"),ht=function(t){return{value:t,unit:null}},mt=_t("color"),gt="#",dt=Ht("#",!1),vt=/^[0-9a-fA-F]/,At=Nt([["0","9"],["a","f"],["A","F"]],!1,!1),yt=function(){return{type:"hex",value:Ut()}},wt=function(t){return{type:"function",value:t}},xt=function(){return{type:"named",value:Ut()}},bt=/^[+\-]/,Ft=Nt(["+","-"],!1,!1),Ct=/^[0-9]/,Et=Nt([["0","9"]],!1,!1),$t=".",jt=Ht(".",!1),kt="e",qt=Ht("e",!1),St=function(){return parseFloat(Ut())},zt=0,Rt=0,Tt=[{line:1,column:1}],It=0,Mt=[],Ot=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=a[r.startRule]}function Ut(){return t.substring(Rt,zt)}function Ht(t,e){return{type:"literal",text:t,ignoreCase:e}}function Nt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Pt(){return{type:"end"}}function _t(t){return{type:"other",description:t}}function Bt(e){var r,n=Tt[e];if(n)return n;for(r=e-1;!Tt[r];)r--;for(n={line:(n=Tt[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Tt[e]=n,n}function Dt(t,e){var r=Bt(t),n=Bt(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Gt(t){zt<It||(zt>It&&(It=zt,Mt=[]),Mt.push(t))}function Jt(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}function Kt(){var t;return(t=Lt())===u&&(t=Qt()),t}function Lt(){var e,r;return Ot++,e=zt,Yt()!==u?(t.substr(zt,4)===i?(r=i,zt+=4):(r=u,0===Ot&&Gt(s)),r!==u&&Yt()!==u?(Rt=e,e=f()):(zt=e,e=u)):(zt=e,e=u),Ot--,e===u&&0===Ot&&Gt(o),e}function Qt(){var t,e;if(t=[],(e=Vt())!==u)for(;e!==u;)t.push(e),e=Vt();else t=u;return t}function Vt(){var e,r,n,a;return e=zt,Yt()!==u&&(r=Zt())!==u&&Yt()!==u?((n=Wt())===u&&(n=null),n!==u&&Yt()!==u?(41===t.charCodeAt(zt)?(a=l,zt++):(a=u,0===Ot&&Gt(p)),a!==u&&Yt()!==u?(Rt=e,e=h(r,n)):(zt=e,e=u)):(zt=e,e=u)):(zt=e,e=u),e}function Wt(){var e,r,n,a,c,o,i,s;if(e=zt,(r=Xt())!==u){for(n=[],a=zt,(c=Yt())!==u?(44===t.charCodeAt(zt)?(o=m,zt++):(o=u,0===Ot&&Gt(g)),o===u&&(o=null),o!==u&&(i=Yt())!==u&&(s=Xt())!==u?a=c=[c,o,i,s]:(zt=a,a=u)):(zt=a,a=u);a!==u;)n.push(a),a=zt,(c=Yt())!==u?(44===t.charCodeAt(zt)?(o=m,zt++):(o=u,0===Ot&&Gt(g)),o===u&&(o=null),o!==u&&(i=Yt())!==u&&(s=Xt())!==u?a=c=[c,o,i,s]:(zt=a,a=u)):(zt=a,a=u);n!==u?(Rt=e,e=r=d(r,n)):(zt=e,e=u)}else zt=e,e=u;return e}function Xt(){var t,e;return t=zt,(e=ee())===u&&(e=re())===u&&(e=ne())===u&&(e=ue()),e!==u&&(Rt=t,e=v(e)),(t=e)===u&&(t=zt,(e=ae())!==u&&(Rt=t,e=A(e)),t=e),t}function Yt(){var e,r;for(Ot++,e=[],w.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=u,0===Ot&&Gt(x));r!==u;)e.push(r),w.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=u,0===Ot&&Gt(x));return Ot--,e===u&&(r=u,0===Ot&&Gt(y)),e}function Zt(){var e,r,n;return Ot++,e=zt,(r=te())!==u?(40===t.charCodeAt(zt)?(n=F,zt++):(n=u,0===Ot&&Gt(C)),n!==u?(Rt=e,e=r=E(r)):(zt=e,e=u)):(zt=e,e=u),Ot--,e===u&&(r=u,0===Ot&&Gt(b)),e}function te(){var e,r,n;if(Ot++,e=zt,r=[],j.test(t.charAt(zt))?(n=t.charAt(zt),zt++):(n=u,0===Ot&&Gt(k)),n!==u)for(;n!==u;)r.push(n),j.test(t.charAt(zt))?(n=t.charAt(zt),zt++):(n=u,0===Ot&&Gt(k));else r=u;return r!==u&&(Rt=e,r=q()),Ot--,(e=r)===u&&(r=u,0===Ot&&Gt($)),e}function ee(){var e,r,n;return Ot++,e=zt,Yt()!==u&&(r=ce())!==u?(37===t.charCodeAt(zt)?(n=z,zt++):(n=u,0===Ot&&Gt(R)),n!==u?(Rt=e,e=T(r)):(zt=e,e=u)):(zt=e,e=u),Ot--,e===u&&0===Ot&&Gt(S),e}function re(){var e,r,n;return Ot++,e=zt,Yt()!==u&&(r=ce())!==u?(t.substr(zt,2)===M?(n=M,zt+=2):(n=u,0===Ot&&Gt(O)),n!==u?(Rt=e,e=U(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Yt()!==u&&(r=ce())!==u?(t.substr(zt,2)===H?(n=H,zt+=2):(n=u,0===Ot&&Gt(N)),n!==u?(Rt=e,e=P(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Yt()!==u&&(r=ce())!==u?(t.substr(zt,2)===_?(n=_,zt+=2):(n=u,0===Ot&&Gt(B)),n!==u?(Rt=e,e=D(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Yt()!==u&&(r=ce())!==u?(t.substr(zt,2)===G?(n=G,zt+=2):(n=u,0===Ot&&Gt(J)),n!==u?(Rt=e,e=K(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Yt()!==u&&(r=ce())!==u?(t.substr(zt,2)===L?(n=L,zt+=2):(n=u,0===Ot&&Gt(Q)),n!==u?(Rt=e,e=V(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Yt()!==u&&(r=ce())!==u?(t.substr(zt,2)===W?(n=W,zt+=2):(n=u,0===Ot&&Gt(X)),n!==u?(Rt=e,e=Y(r)):(zt=e,e=u)):(zt=e,e=u)))))),Ot--,e===u&&0===Ot&&Gt(I),e}function ne(){var e,r,n;return Ot++,e=zt,(r=ce())!==u?(t.substr(zt,3)===tt?(n=tt,zt+=3):(n=u,0===Ot&&Gt(et)),n!==u?(Rt=e,e=r=rt(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,(r=ce())!==u?(t.substr(zt,3)===nt?(n=nt,zt+=3):(n=u,0===Ot&&Gt(ut)),n!==u?(Rt=e,e=r=at(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,(r=ce())!==u?(t.substr(zt,4)===ct?(n=ct,zt+=4):(n=u,0===Ot&&Gt(ot)),n!==u?(Rt=e,e=r=it(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,(r=ce())!==u?(t.substr(zt,4)===st?(n=st,zt+=4):(n=u,0===Ot&&Gt(ft)),n!==u?(Rt=e,e=r=lt(r)):(zt=e,e=u)):(zt=e,e=u)))),Ot--,e===u&&(r=u,0===Ot&&Gt(Z)),e}function ue(){var t,e;return Ot++,t=zt,Yt()!==u&&(e=ce())!==u?(Rt=t,t=ht(e)):(zt=t,t=u),Ot--,t===u&&0===Ot&&Gt(pt),t}function ae(){var e,r,n,a;if(Ot++,e=zt,35===t.charCodeAt(zt)?(r=gt,zt++):(r=u,0===Ot&&Gt(dt)),r!==u){if(n=[],vt.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Ot&&Gt(At)),a!==u)for(;a!==u;)n.push(a),vt.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Ot&&Gt(At));else n=u;n!==u?(Rt=e,e=r=yt()):(zt=e,e=u)}else zt=e,e=u;return e===u&&(e=zt,(r=Vt())!==u&&(Rt=e,r=wt(r)),(e=r)===u&&(e=zt,(r=te())!==u&&(Rt=e,r=xt()),e=r)),Ot--,e===u&&(r=u,0===Ot&&Gt(mt)),e}function ce(){var e,r,n,a,c,o,i,s;if(e=zt,bt.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=u,0===Ot&&Gt(Ft)),r===u&&(r=null),r!==u){for(n=zt,a=[],Ct.test(t.charAt(zt))?(c=t.charAt(zt),zt++):(c=u,0===Ot&&Gt(Et));c!==u;)a.push(c),Ct.test(t.charAt(zt))?(c=t.charAt(zt),zt++):(c=u,0===Ot&&Gt(Et));if(a!==u)if(46===t.charCodeAt(zt)?(c=$t,zt++):(c=u,0===Ot&&Gt(jt)),c!==u){if(o=[],Ct.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=u,0===Ot&&Gt(Et)),i!==u)for(;i!==u;)o.push(i),Ct.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=u,0===Ot&&Gt(Et));else o=u;o!==u?n=a=[a,c,o]:(zt=n,n=u)}else zt=n,n=u;else zt=n,n=u;if(n===u)if(n=[],Ct.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Ot&&Gt(Et)),a!==u)for(;a!==u;)n.push(a),Ct.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Ot&&Gt(Et));else n=u;if(n!==u){if(a=zt,101===t.charCodeAt(zt)?(c=kt,zt++):(c=u,0===Ot&&Gt(qt)),c!==u)if(bt.test(t.charAt(zt))?(o=t.charAt(zt),zt++):(o=u,0===Ot&&Gt(Ft)),o===u&&(o=null),o!==u){if(i=[],Ct.test(t.charAt(zt))?(s=t.charAt(zt),zt++):(s=u,0===Ot&&Gt(Et)),s!==u)for(;s!==u;)i.push(s),Ct.test(t.charAt(zt))?(s=t.charAt(zt),zt++):(s=u,0===Ot&&Gt(Et));else i=u;i!==u?a=c=[c,o,i]:(zt=a,a=u)}else zt=a,a=u;else zt=a,a=u;a===u&&(a=null),a!==u?(Rt=e,e=r=St()):(zt=e,e=u)}else zt=e,e=u}else zt=e,e=u;return e}function oe(t,e){return t.map((function(t){return t[e]}))}function ie(t,e,r){return[t].concat(oe(e,r))}if((n=c())!==u&&zt===t.length)return n;throw n!==u&&zt<t.length&&Gt(Pt()),Jt(Mt,It<t.length?t.charAt(It):null,It<t.length?Dt(It,It+1):Dt(It,It))}return t(e,Error),e.buildMessage=function(t,e){var r={literal:function(t){return'"'+u(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function u(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function c(t){return r[t.type](t)}function o(t){var e,r,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=c(t[e]);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(t){return t?'"'+u(t)+'"':"end of input"}return"Expected "+o(t)+" but "+i(e)+" found."},{SyntaxError:e,parse:r}},(l=h).exports&&(l.exports=p());const j={deg:1,grad:.9,rad:180/Math.PI,turn:360};function k(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==j[t.unit])throw new n("effect:type-error",`Expected <angle>, Actual: ${F(t)}`,{term:t})}const q={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73};function S(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==q[t.unit])throw new n("effect:type-error",`Expected <length>, Actual: ${F(t)}`,{term:t})}function z(t){$(t);const e=t.value;return C(e,t),"%"===t.unit?.01*e:e}function R(t){return E(t),C(t.value,t),t.value}function T(t){return k(t),t.value*j[t.unit]||0}function I(t){return S(t),t.value*q[t.unit]||0}function M(e){switch(e.colorType){case"hex":return t(e.value);case"named":return O(e.value);case"function":return N(e.value)}}function O(t){const r=e(t);if(!r)throw new n("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return r}const U=/^rgba?/i,H=/^hsla?/i;function N(t){if(b(t.parameters,4),U.test(t.name))return[z(t.parameters[0]),z(t.parameters[1]),z(t.parameters[2]),t.parameters[3]?z(t.parameters[3]):1];if(H.test(t.name))return r(R(t.parameters[0]),z(t.parameters[1]),z(t.parameters[2]),t.parameters[3]?z(t.parameters[3]):1);throw new n("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}export{m as parse};
