/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import"../../core/has.js";import{isNone as e}from"../../core/maybe.js";function r(e,r){return e.vertexBuffers[r].size/t(e.layout[r])}function t(e){return e[0].stride}function i(e,r,t,i,s){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(t);for(const a of i){const e=r.get(a.name);void 0===e&&console.error(`There is no location for vertex attribute '${a.name}' defined.`),a.baseInstance&&!a.divisor&&console.error(`Vertex attribute '${a.name}' uses baseInstanceOffset without divisor.`);const t=(s||(0+a.baseInstance?a.baseInstance:0))*a.stride;if(a.count<=4)n.vertexAttribPointer(e,a.count,a.type,a.normalized,a.stride,a.offset+t),n.enableVertexAttribArray(e),a.divisor>0&&o&&o.vertexAttribDivisor(e,a.divisor);else if(9===a.count)for(let r=0;r<3;r++)n.vertexAttribPointer(e+r,3,a.type,a.normalized,a.stride,a.offset+12*r+t),n.enableVertexAttribArray(e+r),a.divisor>0&&o&&o.vertexAttribDivisor(e+r,a.divisor);else if(16===a.count)for(let r=0;r<4;r++)n.vertexAttribPointer(e+r,4,a.type,a.normalized,a.stride,a.offset+16*r+t),n.enableVertexAttribArray(e+r),a.divisor>0&&o&&o.vertexAttribDivisor(e+r,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function s(e,r,t,i){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(t);for(const o of i){const e=r.get(o.name);if(o.count<=4)s.disableVertexAttribArray(e),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(e,0);else if(9===o.count)for(let r=0;r<3;r++)s.disableVertexAttribArray(e+r),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(e+r,0);else if(16===o.count)for(let r=0;r<4;r++)s.disableVertexAttribArray(e+r),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(e+r,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(34962)}function n(e){switch(e){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}function o(r){if(e(r))return 0;if("descriptor"in r)return r.glName?o(r.descriptor):0;const t=r.internalFormat||"pixelFormat"in r&&r.pixelFormat;if(!t)return 0;const i="hasMipmap"in r&&r.hasMipmap?1.3:1,s=r.width*r.height;return n(t)*s*i}export{i as bindVertexBufferLayout,n as getBytesPerElementFormat,o as getGpuMemoryUsage,t as getStride,s as unbindVertexBufferLayout,r as vertexCount};
