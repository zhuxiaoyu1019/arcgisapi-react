/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import r from"../../../../../webgl/BufferObject.js";import"../../../../../webgl/FramebufferObject.js";import"../../../../../../core/has.js";import"../../../../../webgl/enums.js";import"../../../../../webgl/RenderingContext.js";import"../../../../../../chunks/builtins.js";import{createProgram as e}from"../../../../../webgl/programUtils.js";import"../../../../../webgl/Texture.js";import s from"../../../../../webgl/VertexArrayObject.js";import{TEXTURE_BINDING_HIGHLIGHT_0 as i,TEXTURE_BINDING_HIGHLIGHT_1 as t}from"../../definitions.js";import{ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX as o,RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX as u,SIGMA as h}from"./parameters.js";import{highlight as a,blur as n}from"../../shaders/HighlightPrograms.js";class m{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(r,e){r.bindTexture(e,i),r.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",o),r.bindVAO(this._resources.quadVAO),r.drawArrays(5,0,4),r.bindVAO()}finalBlur(r,e){r.bindTexture(e,i),r.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",u),r.bindVAO(this._resources.quadVAO),r.drawArrays(5,0,4),r.bindVAO()}renderHighlight(r,e,s){r.bindTexture(e,i),r.useProgram(this._resources.highlightProgram),s.applyHighlightOptions(r,this._resources.highlightProgram),r.bindVAO(this._resources.quadVAO),r.setBlendingEnabled(!0),r.setBlendFunction(1,771),r.drawArrays(5,0,4),r.bindVAO()}_initialize(o,u,m){this._width=u,this._height=m;const g=r.createVertex(o,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),d=new s(o,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:g}),l=e(o,a),_=e(o,n);l.setUniform1i("u_texture",i),l.setUniform1i("u_shade",t),l.setUniform1f("u_sigma",h),_.setUniform1i("u_texture",i),_.setUniform1f("u_sigma",h),this._resources={quadGeometry:g,quadVAO:d,highlightProgram:l,blurProgram:_}}setup(r,e,s){this._resources?(this._width=e,this._height=s):this._initialize(r,e,s)}}export default m;
