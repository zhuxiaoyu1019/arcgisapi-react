/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{pt2px as t,toPt as e}from"../../../../../../core/screenUtils.js";import{getJustification as i,getXAnchorDirection as o,getYAnchorDirection as s}from"../../alignmentUtils.js";import{premultiplyAlphaRGBAArray as n,premultiplyAlphaRGBA as r}from"../../color.js";import{MIN_MAX_ZOOM_PRECISION_FACTOR as a}from"../../definitions.js";import{i1616to32 as l}from"../../number.js";import{MaterialKeyBase as m}from"../../materialKey/MaterialKey.js";import{DEFAULT_MIN_ZOOM as h,DEFAULT_MAX_ZOOM as f,getMinMaxZoom as c}from"./util.js";import _ from"./WGLBaseTextTemplate.js";import d from"./WGLMeshTemplate.js";import{bidiText as x}from"../../util/BidiText.js";const u=5,z=24;class M extends(_(d)){constructor(n,r,h,f,c,_,d,x,M,p,g,j,S,y,b,T,V,A=!1,C,I){super(),this._xOffset=t(j),this._yOffset=t(S),this._decoration=M||"none",this._color=f,this._haloColor=c,this._haloSize=Math.min(Math.floor(u*t(e(h))),127),this._size=Math.min(Math.round(t(r)),127);const K=Math.min(Math.round(t(r)),127);this._referenceSize=Math.round(Math.sqrt(256*K)),this._scale=this._size/z,this._angle=g,this._justify=i(_||"center"),this._xAlignD=o(_||"center"),this._yAlignD=s(d||"baseline"),this._baseline="baseline"===(d||"baseline"),this._bitset=(1===x?1:0)|(p?1:0)<<1;const v=m.load(n);v.sdf=!0,this._materialKey=v.data,this._lineWidth=t(y)||512,this._lineHeight=b||1,this._textPlacement=T,this._effects=V,this._isCIM=A,this._minMaxZoom=l(Math.round(C*a),Math.round(I*a))}static fromText(t,e){const i=new M(t.materialKey,t.font.size,t.haloSize||0,t.color&&n(t.color)||0,t.haloColor&&n(t.haloColor)||0,t.horizontalAlignment,t.verticalAlignment,0,t.font.decoration,!1,t.angle||0,t.xoffset,t.yoffset,t.lineWidth,t.lineHeight,null,null,!1,h,f),[,o]=x(t.text);return i.bindTextInfo(e,o),i._vertexBoundsScale=t.maxVVSize?t.maxVVSize/t.font.size:1,i}static fromCIMText(t,e,i){const o=t.scaleFactor||1,s=t.size*t.sizeRatio*o,[n,a]=c(t.scaleInfo,i),l=new M(t.materialKey,s,t.outlineSize*t.sizeRatio,r(t.color),r(t.outlineColor),t.horizontalAlignment,t.verticalAlignment,t.alignment,t.decoration,t.colorLocked,t.angle,t.offsetX*t.sizeRatio*o,t.offsetY*t.sizeRatio*o,512,1,t.markerPlacement,t.effects,!0,n,a),[,m]=x(t.text);return l.bindTextInfo(e,m),l._vertexBoundsScale=t.maxVVSize?t.maxVVSize/s:1,l}}export default M;
