/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{isNone as t}from"../../../../../core/maybe.js";import{MIN_MAX_ZOOM_PRECISION_FACTOR as e,TEXTURE_BINDING_ATTRIBUTE_DATA_0 as i,TEXTURE_BINDING_ATTRIBUTE_DATA_1 as r,TEXTURE_BINDING_ATTRIBUTE_DATA_2 as s,TEXTURE_BINDING_ATTRIBUTE_DATA_3 as a}from"../definitions.js";import n from"./WGLBrush.js";class o extends n{prepareState({context:t},e,i){const r=i&&-1!==i.indexOf("id");t.setBlendingEnabled(!r),t.setBlendFunctionSeparate(1,771,1,771),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilFunction(514,e.stencilRef,255)}draw(e,i,r){const s=this.getGeometryType();i.commit(e);const a=i.getGeometry(s);t(a)||(e.timeline.begin(this.name),e.attributeView.bindTextures(e.context),a.forEachCommand((t=>this.drawGeometry(e,i,t,r))))}_setSharedUniforms(t,n,o){const{displayLevel:m,pixelRatio:u,state:f}=n;t.setUniform1f("u_pixelRatio",u),t.setUniformMatrix3fv("u_dvsMat3",o.transforms.dvs),t.setUniformMatrix3fv("u_displayViewMat3",f.displayViewMat3),t.setUniform1f("u_currentZoom",Math.round(m*e)),t.setUniform1i("u_attributeTextureSize",n.attributeView.size),t.setUniform1i("u_attributeData0",i),t.setUniform1i("u_attributeData1",r),t.setUniform1i("u_attributeData2",s),t.setUniform1i("u_attributeData3",a)}}export default o;
