/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"../../ViewState.js";import{Container as t}from"../../engine/Container.js";import{WGLDrawPhase as r}from"../../engine/webgl/enums.js";class i extends t{constructor(t){super(),this.layerView=t,this._childrenRenderParameters={context:null,pixelRatio:1,state:new e,stationary:!0,painter:null},this._name=this.constructor.name,this.requestRender=this.requestRender.bind(this)}doRender(e){if(e.drawPhase!==r.MAP)return;const t=window.devicePixelRatio,{state:i,stationary:a,context:n,painter:s,profiler:o}=e,d=this._childrenRenderParameters;d.context=n.gl,d.state.copy(i),d.state.pixelRatio=t,d.stationary=a,d.painter=s;const l=this.createRenderParams(e);s.beforeRenderLayer(l,this.clips?255:0,l.globalOpacity),o.recordContainerStart(this._name);const c=n.getBoundFramebufferObject(),h=n.getViewport();n.resetState(),n.bindFramebuffer(c),n.setViewport(h.x,h.y,h.width,h.height),this.layerView._renderTarget.framebuffer=c.glName,this.layerView._renderTarget.viewport[0]=h.x,this.layerView._renderTarget.viewport[1]=h.y,this.layerView._renderTarget.viewport[2]=h.width,this.layerView._renderTarget.viewport[3]=h.height,this.layerView.render(d),n.enforceState(),s.compositeLayer(l,l.globalOpacity),o.recordContainerEnd()}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.opacity,inFadeTransition:this.inFadeTransition}}}export default i;export{i as DisplayGL};
