/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{lerp as t,clamp as e}from"../../../core/mathUtils.js";import{i,b as n,j as o,r as a}from"../../../chunks/mat4.js";import{c as l}from"../../../chunks/mat4f64.js";import{s,e as u,m as r}from"../../../chunks/vec3.js";import{f as c,c as f}from"../../../chunks/vec3f64.js";import{S as m}from"../../../chunks/SunCalc.js";const d={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function g(i,n){const o=n[2],a=O;s(a.ambient.color,1,1,1),a.ambient.intensity=d.global.ambient,s(a.diffuse.color,1,1,1),a.diffuse.intensity=d.global.diffuse;let l=(Math.abs(o)-d.local.altitude)/(d.global.altitude-d.local.altitude);l=e(l,0,1),a.globalFactor=l;const r=m.getTimes(i,n[1],n[0]);if(l<1){const e=y(i,r);u(a.ambient.color,e.ambient.color,a.ambient.color,l),a.ambient.intensity=t(e.ambient.intensity,a.ambient.intensity,l),u(a.diffuse.color,e.diffuse.color,a.diffuse.color,l),a.diffuse.intensity=t(e.diffuse.intensity,a.diffuse.intensity,l)}return a.noonFactor=T(i,r),a}function b(t,l,u,c){c||(c=f());const g=N,b=i(p);if("global"===u)m.getPosition(t,0,0,g),s(c,0,0,-1),n(b,b,-g.azimuth),o(b,b,-g.altitude),r(c,c,b);else{const i=d.planarDirection,o=i.globalAngles,u=l[2];let f=(Math.abs(u)-i.localAltitude)/(i.globalAltitude-i.localAltitude);f=e(f,0,1),f<1?(m.getPosition(t,l[1],l[0],g),g.azimuth=(1-f)*g.azimuth+f*o.azimuth,g.altitude=(1-f)*g.altitude+f*o.altitude):(g.azimuth=o.azimuth,g.altitude=o.altitude),s(c,0,-1,0),a(b,b,-g.azimuth),n(b,b,-g.altitude),r(c,c,b)}return c}function h(t,e){if("global"===e)return!0;{const e=d.planarDirection,i=t[2];return Math.abs(i)<e.localAltitude}}function A(t,e,i,n,o){const a=o.length;if(a<1)return o;const l=t.getTime(),s=(e.getTime()-l)/a;for(let u=0;u<a;++u)E.setTime(l+s*u),b(E,i,n,o[u]);return o}const p=l(),N={azimuth:0,altitude:0},O={ambient:{color:f(),intensity:0},diffuse:{color:f(),intensity:0,directionToLightSource:f()},globalFactor:0,noonFactor:0};function T(t,i){const n=t.valueOf();let o,a;i.polarException===m.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===m.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const l=o+(a-o)/2;return 1-e(Math.abs(n-l)/432e5,0,1)}function y(t,e){const i=t.valueOf();let n,o;e.polarException===m.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,o=n+432e6):e.polarException===m.POLAR_EXCEPTION.POLAR_NIGHT?(n=i-2,o=i-1):(n=e.sunrise.valueOf(),o=e.sunset.valueOf());const a=o-n,l=n+a/2,s=a/4,u=l-s,r=l+s,f=.06*a,g=n-f/2,b=n+f/2,h=o-f/2,A=o+f/2,p=d.local,N=[.01,p.ambientAtNight],O=[.8,.8,1],T=[.01,.01,.01],y=[p.diffuseAtTwilight,p.ambientAtTwilight],E=[1,.75,.75],I=[.8,.8,1],M=[.9*p.diffuseAtNoon,p.ambientAtNoon],z=[1,.98,.98],v=[.98,.98,1],_=[p.diffuseAtNoon,p.ambientAtNoon],j=[1,1,1],D=[1,1,1],L=M,H=z,R=v,k=y,w=E,x=I;let C,S,F=[0,0],G=[0,0,0],X=[0,0,0];return i<g||i>A?(F=N,G=T,X=O,S="night"):i<b?(C=b-g,F=P(i-g,C,N,y),G=P(i-g,C,T,E),X=P(i-g,C,O,I),S="sun rising"):i<u?(C=u-b,F=P(i-b,C,y,M),G=P(i-b,C,E,z),X=P(i-b,C,I,v),S="early morning"):i<l?(C=l-u,F=P(i-u,C,M,_),G=P(i-u,C,z,j),X=P(i-u,C,v,D),S="late morning"):i<r?(C=r-l,F=P(i-l,C,_,L),G=P(i-l,C,j,H),X=P(i-l,C,D,R),S="early afternoon"):i<h?(C=h-r,F=P(i-r,C,L,k),G=P(i-r,C,H,w),X=P(i-r,C,R,x),S="late afternoon"):i<A&&(C=A-h,F=P(i-h,C,k,N),G=P(i-h,C,w,T),X=P(i-h,C,x,O),S="sun setting"),{diffuse:{intensity:F[0],color:c(G[0],G[1],G[2])},ambient:{intensity:F[1],color:c(X[0],X[1],X[2])},timeOfDay:S}}function P(t,e,i,n){const o=[];for(let a=0;a<i.length;a++)o[a]=(n[a]-i[a])*t/e+i[a];return o}const E=new Date(0);export{g as computeColorAndIntensity,b as computeDirection,A as computeDirectionsOverTime,h as computeShadowsEnabled,d as settings};
