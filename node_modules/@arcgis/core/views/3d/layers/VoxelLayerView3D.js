/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import s from"../../../core/Error.js";import{init as r}from"../../../core/watchUtils.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/Logger.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import i from"../../../layers/VoxelWasmManager.js";import{LayerView3D as a}from"./LayerView3D.js";import d from"../../layers/LayerView.js";let n=class extends(a(d)){constructor(){super(...arguments),this.type="voxel-3d",this._wasmLayerId=-1}initialize(){if("local"!==this.view.viewingMode)throw new s("voxel:unsupported-viewingMode","Voxel layers support local viewingMode only.",{});if("webgl"===this.view.renderContext)throw new s("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",{});const e=i.getInstance(),t=e.addLayer(this.view,this).then((e=>{this._wasmLayerId=e,this._suspendedHandle=r(this,"suspended",(e=>{i.getInstance().setLayerEnabled(this.view,this,!e)}))})).catch((r=>{if(e.removeLayer(this.view,this),this._wasmLayerId=-1,-1===r)throw new s("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===r)throw new s("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{})}));this.addResolvingPromise(t)}destroy(){i.getInstance().removeLayer(this.view,this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null)}isUpdating(){return!(this._wasmLayerId<0)&&i.getInstance().isUpdating(this.view,this._wasmLayerId)}updatingFlagChanged(){this.notifyChange("updating")}};e([t()],n.prototype,"layer",void 0),e([t({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],n.prototype,"baseUrl",void 0),n=e([o("esri.views.3d.layers.VoxelLayerView3D")],n);var l=n;export default l;
