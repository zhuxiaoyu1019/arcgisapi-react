/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{AsyncUpdateMixin as r}from"../../../../core/AsyncUpdate.js";import{HandleOwner as s}from"../../../../core/HandleOwner.js";import t from"../../../../core/Logger.js";import{unwrapOr as i}from"../../../../core/maybe.js";import{property as o}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/accessorSupport/ensureType.js";import{subclass as l}from"../../../../core/accessorSupport/decorators/subclass.js";import{fixFields as d,collectLabelingFields as n,collectFilterFields as a}from"../../../../layers/support/fieldUtils.js";const p=t.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");let c=class extends(r(s)){constructor(e){super(e)}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:r},rendererFields:s,labelingFields:t,viewFilterFields:o}=this;return d(e,[...i(r,[]),...i(s,[]),...i(t,[]),...i(o,[])])}initialize(){const e=this.layerView.layer;this.layer=e,this.handles.add([this.autoUpdateAsync("rendererFields",(()=>{const{fieldsIndex:e,renderer:r}=this.layer;return r?y((s=>r.collectRequiredFields(s,e))):null})),this.autoUpdateAsync("labelingFields",(()=>{const{layer:e}=this;return e.labelsVisible?y((r=>n(r,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,filter:r}=this.layerView;return y((s=>a(s,e,r)))}))])}};async function y(e){const r=new Set;try{return await e(r),Array.from(r).sort()}catch(s){return p.error(s),null}}e([o()],c.prototype,"layerView",void 0),e([o()],c.prototype,"layer",void 0),e([o()],c.prototype,"requiredFields",null),e([o()],c.prototype,"rendererFields",void 0),e([o()],c.prototype,"labelingFields",void 0),e([o()],c.prototype,"viewFilterFields",void 0),c=e([l("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],c);export{c as SceneLayerViewRequiredFields};
