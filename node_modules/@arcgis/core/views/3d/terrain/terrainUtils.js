/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{unwrapOr as e,isSome as t}from"../../../core/maybe.js";import{VectorTile as n}from"../../2d/engine/vectorTiles/VectorTile.js";import{ImageWithType as l}from"../support/StreamDataLoader.js";import i from"./RasterTile.js";import{t as o}from"../../../chunks/terrainUtilsPlanar.js";import{t as r}from"../../../chunks/terrainUtilsSpherical.js";import u from"./TileTexture.js";const a={1:r,2:o};function f(e,t){e||console.warn("Terrain: "+t)}const c=1.2,s=80/180*Math.PI,d=110/180*Math.PI;function m(n,l,i){const o=a[n.viewingMode];let r;if(o.isInsideExtent(n,l))r=e(n.getElevation(l[0],l[1],l[1],n.spatialReference),0);else{if(!o.isInsideExtent(n,l,c))return 0;const e=n.getTileWithElevation(l[0],l[1],l[1],n.spatialReference);r=.5*((t(e)?e.elevationBounds[0]:n.elevationBounds.min)+(t(e)?e.elevationBounds[1]:n.elevationBounds.max));const i=o.tiltToExtentEdge(n,l,r);if(i>s&&i<d)return 0}const u=l[2]-r;return Math.abs(u)<i?0:u<0?-1:1}function v(e){return x(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function p(e){return"vector-tile"===(null==e?void 0:e.type)}function I(e){return"imagery-tile"===(null==e?void 0:e.type)||"wcs"===(null==e?void 0:e.type)}function x(e){return"imagery-tile-3d"===(null==e?void 0:e.type)}function y(e){return"tile-3d"===(null==e?void 0:e.type)}function E(e){return"vector-tile-3d"===(null==e?void 0:e.type)}function T(e){return"wmts-3d"===(null==e?void 0:e.type)}function h(e){return"elevation-3d"===(null==e?void 0:e.type)}function g(e){return e&&(y(e)||x(e)||h(e)||E(e)||T(e))}function L(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof i}function S(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof n}function M(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof u}function j(e){var t;const n=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return n instanceof HTMLImageElement||n instanceof l||n instanceof HTMLCanvasElement||n instanceof ImageData}function w(e){return t(e)&&"release"in e&&e.release(),null}function b(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function B(e,t,n,l){return a[l].checkIfTileInfoSupportedForViewSR(e,n,t)}function C(e,t,n){let l,i;if("wmts"===e.type){const o=e.activeLayer;if(o){const e=o.tileMatrixSet;if(e)l=e.tileInfo,i=e.fullExtent;else{const e=o.tileMatrixSets;if(e){const l=e.find((e=>null==B(e.tileInfo,e.fullExtent,t,n)));if(l)return{tileInfo:l.tileInfo,fullExtent:l.fullExtent}}}}}else i=I(e)?e.getCompatibleFullExtent(t):e.fullExtent,l=p(e)&&!R.force512VTL?e.compatibleTileInfo256:I(e)?e.getCompatibleTileInfo(t,i,2===n):e.tileInfo;return l&&i&&null==B(l,i,t,n)?{tileInfo:l,fullExtent:i}:{tileInfo:null,fullExtent:null}}const R={force512VTL:!1};export{B as checkIfTileInfoSupportedForView,m as computeSkirtScale,v as getLayerWithExtentRange,C as getTiledLayerInfo,h as isElevationLayerView,x as isImageryTileLayerView,L as isImageryTileRenderInfo,I as isProjectableRasterLayer,j as isRasterTileRenderInfo,g as isSurfaceLayerView,M as isTextureTileRenderInfo,y as isTileLayerView,p as isVectorTileLayer,E as isVectorTileLayerView,S as isVectorTileRenderInfo,T as isWMTSLayerView,w as releaseTileData,R as test,b as useFetchTileForLayer,f as weakAssert};
