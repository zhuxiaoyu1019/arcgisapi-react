/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import{HandleOwner as e}from"../../../../../core/HandleOwner.js";import{deg2rad as s,rad2deg as i}from"../../../../../core/mathUtils.js";import{isSome as o,none as r,isNone as a,unwrapOr as l}from"../../../../../core/maybe.js";import{property as h}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/Logger.js";import{subclass as c}from"../../../../../core/accessorSupport/decorators/subclass.js";import{reaction as n}from"../../../../../core/accessorSupport/trackingUtils.js";let p=class extends e{constructor(t){super(t),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(y);const t=o(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:r;if(this.symbol=o(t)?t.clone():null,this.initialSizes=[],o(t)){const e=this.findLayerView();o(e)&&(this.initialSizes=t.symbolLayers.map((s=>"object"===s.type?e.getSymbolLayerSize(t,s):null)).toArray())}this.angle=0,o(t)&&t.symbolLayers.some((t=>!("object"!==t.type||!o(t.heading))&&(this.angle=-s(t.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(n((()=>({angle:this.angle,scale:this.scale})),(t=>this.updateSymbol(t))),y)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:s=>{e=s.symbol,s.symbol=t,this.restart()},redo:s=>{t=s.symbol,s.symbol=e,this.restart()}}}updateSymbol({scale:t,angle:e}){const s=this.graphic.symbol;if(a(this.symbol)||a(s)||"point-3d"!==s.type)return;const r=s.clone(),h=-i(e-this.initialAngle);let c=!1;this.forEachObjectSymbolLayerPair(this.symbol,r,((e,s,i)=>{const r=l(e.heading,0)+h;s.heading!==r&&(s.heading=r,c=!0);const a=this.initialSizes[i];if(o(a)&&"width"in a){a.width=this.sizeFilter(a.width),a.height=this.sizeFilter(a.height),a.depth=this.sizeFilter(a.depth);const e=a.width*t;s.width!==e&&(s.width=e,c=!0);const i=a.depth*t;s.depth!==i&&(s.depth=i,c=!0);const o=a.height*t;s.height!==o&&(s.height=o,c=!0)}})),c&&(this.graphic.symbol=r)}forEachObjectSymbolLayerPair(t,e,s){t.symbolLayers.forEach(((t,i)=>{const o=e.symbolLayers.getItemAt(i);"object"===t.type&&"object"===o.type&&s(t,o,i)}))}};t([h()],p.prototype,"angle",void 0),t([h()],p.prototype,"scale",void 0),t([h({constructOnly:!0})],p.prototype,"graphic",void 0),t([h()],p.prototype,"symbol",void 0),t([h({constructOnly:!0})],p.prototype,"findLayerView",void 0),t([h({constructOnly:!0})],p.prototype,"sizeFilter",void 0),p=t([c("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],p);const y="scale-heading-update-key";export{p as ScaleRotateObjectSymbol3DAdapter};
