/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import{HandleOwner as t}from"../../../../../core/HandleOwner.js";import{deg2rad as s,rad2deg as o}from"../../../../../core/mathUtils.js";import{isSome as r}from"../../../../../core/maybe.js";import{property as i}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/Logger.js";import{subclass as a}from"../../../../../core/accessorSupport/decorators/subclass.js";import{reaction as c}from"../../../../../core/accessorSupport/trackingUtils.js";import{axis as n,angle as p}from"../../../../../geometry/support/axisAngleDegrees.js";import{createGraphicGeometryUndoRecord as h}from"./undoRecords.js";let l=class extends t{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(g);const e=this.geometry.transform;if(this.scale=1,r(e)){const t=n(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=s(p(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(c((()=>({angle:this.angle,scale:this.scale})),(e=>this.update(e))),g)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return h(this.graphic)}update({scale:e,angle:t}){const s=this.geometry.anchor,r=1===this.viewingMode;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:s,geographic:r}),this.previousScale=e,this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,o(t-this.previousAngle),{origin:s,geographic:r}),this.previousAngle=t,this.graphic.notifyGeometryChanged())}};e([i({constructOnly:!0})],l.prototype,"graphic",void 0),e([i({constructOnly:!0})],l.prototype,"geometry",void 0),e([i({constructOnly:!0})],l.prototype,"viewingMode",void 0),e([i()],l.prototype,"angle",void 0),e([i()],l.prototype,"scale",void 0),l=e([a("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],l);const g="scale-heading-update-key";export{l as ScaleRotateMeshAdapter};
