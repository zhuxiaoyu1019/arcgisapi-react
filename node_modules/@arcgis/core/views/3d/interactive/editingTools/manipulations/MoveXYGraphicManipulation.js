/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import t from"../../../../../core/Handles.js";import{isSome as i}from"../../../../../core/maybe.js";import{screenToMapXYForGraphic as e}from"../dragEventPipeline3D.js";import{Manipulation as r}from"./Manipulation.js";import{createGraphicMoveDragPipeline as a}from"./moveUtils.js";import{createManipulatorDragEventPipeline as o,addMapDelta as s,addScreenDelta as n}from"../../../../interactive/dragEventPipeline.js";import{GraphicManipulator as l}from"../../../../interactive/GraphicManipulator.js";class h extends r{constructor(i){super(),this._handles=new t,this._view=i.view,this._tool=i.tool,this._graphicState=i.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,1)}createGraphicDragPipeline(t){return a(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const r=this._view,a=this._graphicState.graphic,l=i(a.geometry)?a.geometry.spatialReference:null;return o(this._manipulator,((i,o,h,p,c)=>{const m=o.next(e(c,r,a,l)).next(s()).next(n());t(i,m,h,p,c)}))}_createManipulator(){const t=this._view,i=this._graphicState.graphic;this._manipulator=new l({graphic:i,view:t,selectable:!0,cursor:"move"})}}export{h as MoveXYGraphicManipulation};
