/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import t from"../../../../../core/Accessor.js";import i from"../../../../../core/Handles.js";import{isNone as s,destroyMaybe as a,isSome as r}from"../../../../../core/maybe.js";import{whenOnce as l}from"../../../../../core/watchUtils.js";import{property as o}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/Logger.js";import{subclass as n}from"../../../../../core/accessorSupport/decorators/subclass.js";import{v as h,m as d}from"../../../../../chunks/mat4.js";import{s as p,l as u}from"../../../../../chunks/vec3.js";import{sm4d as c,sv3d as m}from"../../../../../geometry/support/vectorStacks.js";import{PLANE_OUTLINE_WIDTH as y,PLANE_PREVIEW_OUTLINE_WIDTH as w,PLANE_OUTLINE_COLOR as _,PLANE_BACKGROUND_COLOR as V,GRID_COLOR as g}from"../../analysisTools/slice/sliceToolConfig.js";import{createGridVisualElement as v,createOutlineVisualElement as E,calculateBoundedPlaneTranslateRotate as b}from"../../analysisTools/slice/sliceToolUtils.js";import{createStipplePatternSimple as f}from"../../../webgl-engine/materials/lineStippleUtils.js";let j=class extends t{constructor(e){super(e),this._handles=new i,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending"}get ready(){return"ready"===this.state}set showGrid(e){this._set("showGrid",e),this._updateMaterials()}set editable(e){this._set("editable",e),this._updateMaterials()}initialize(){this._initialize()}async _initialize(){switch(this.state){case"pending":break;case"destroyed":return;case"ready":throw new Error("state error")}if(await l(this.view,"ready",!0),s(this.layerView.layerViewData))throw new Error("expected internal object to be valid");this._gridVisualElement=v(this.view),this._outlineVisualElement=E(this.view),this._handles.add([this.analysis.watch("opacity",(()=>this._updateMaterials()),!0)],"analysis"),this._handles.add([this.layerView.watch("visible",(()=>this._updateMaterials()),!0),this.layerView.layerViewData.watch("plane",(()=>this._updatePlane()),!0),this.layerView.watch("active",(()=>this._updateMaterials()),!0)],"internal"),this._updatePlane(),this._set("state","ready")}destroy(){switch(this.state){case"destroyed":case"pending":return}this._handles.destroy(),this._gridVisualElement=a(this._gridVisualElement),this._outlineVisualElement=a(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed")}async whenReady(){return await l(this,"ready"),this}_update(){switch(this.state){case"pending":case"destroyed":return}}_updatePlane(){const e=this.layerView.layerViewData.plane,t=r(e)?b(e,c.get()):null;if(this._outlineVisualElement.width=y,r(e)){const i=p(m.get(),u(e.basis1),u(e.basis2),1),s=h(c.get(),i),a=d(s,t,s);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a}this._updateMaterials()}_updateMaterials(){const e=this.layerView.layerViewData.plane&&this.analysis.visible,t=this.layerView.active,i=[_[0],_[1],_[2],_[3]];this._outlineVisualElement.color=i,this._outlineVisualElement.width=this.editable?y:w,this._outlineVisualElement.stipplePattern=t?null:f(5);const s=[V[0],V[1],V[2],V[3]],a=!!r(this.layerView.layerViewData)&&this.showGrid?g:[0,0,0,0];this._gridVisualElement.backgroundColor=s,this._gridVisualElement.gridColor=a,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};e([o({readOnly:!0})],j.prototype,"state",void 0),e([o()],j.prototype,"view",void 0),e([o()],j.prototype,"analysis",void 0),e([o()],j.prototype,"layerView",void 0),e([o()],j.prototype,"ready",null),e([o({value:!1})],j.prototype,"showGrid",null),e([o({value:!0})],j.prototype,"editable",null),j=e([n("esri.views.3d.interactive.graphics.Slice.SliceView")],j);export{j as SliceView};
