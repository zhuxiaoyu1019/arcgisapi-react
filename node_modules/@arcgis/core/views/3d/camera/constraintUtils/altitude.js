/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{clamp as t,sign as e}from"../../../../core/mathUtils.js";import{isSome as r}from"../../../../core/maybe.js";import{g as n,a as o}from"../../../../chunks/vec3.js";import{c as i}from"../../../../chunks/vec3f64.js";import{wrap as s}from"../../../../geometry/support/ray.js";import{defaultApplyOptions as c,interactionDirectionTowardsConstraintMinimization as a,hasConstraintType as m,adjustRangeForInteraction as u}from"./common.js";import{closestPointOnRay as f}from"../../support/intersectionUtils.js";function p(t,o,i=c){const m=d(t,o,i);if(0===m)return!1;const u=t.renderCoordsHelper,p=u.getAltitude(o.eye)+m,l=a(o,i.interactionDirection,j(t,o,e(m),C),A),y=n(h,o.viewForward),x=u.intersectInfiniteManifold(s(o.eye,l),p,H);return o.eye=r(x)?x:u.setAltitude(H,p,o.eye),o.center=f(H,o.eye,y,o.center),!0}function d(e,r,n=c){if(!l(e,n))return 0;const o=x(e.state.constraints.altitude,g);y(e,n,o);const i=e.renderCoordsHelper.getAltitude(r.eye),s=t(i,o.min,o.max)-i;return Math.abs(s)<=1e-6?0:s}function l(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(2!==e.interactionType||!m(e.selection,1))}function y(t,e,r){const n=e.interactionType;if(0===n)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=e,a=2===n||1===n,m=d(t,s),f=0===m?0:t.renderCoordsHelper.getAltitude(s.eye);r.min=o,r.max=i;u(m,f,a,c,.05*f,r)}function j(t,e,r,n){return t.renderCoordsHelper.worldUpAtPosition(e.eye,n),o(n,n,r),n}function x(t,e){return e.min=t.min,e.max=t.max,e}const g={min:0,max:0},A=i(),C=i(),h=i(),H=i();export{p as applyAltitudeConstraint,d as getAltitudeConstraintError};
