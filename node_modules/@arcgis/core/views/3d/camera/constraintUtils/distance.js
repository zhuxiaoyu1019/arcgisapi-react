/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../core/maybe.js";import{i as n,g as r,r as t,f as o,b as i}from"../../../../chunks/vec3.js";import{c as s}from"../../../../chunks/vec3f64.js";import{wrap as c}from"../../../../geometry/support/ray.js";import{i as a,k as f}from"../../../../chunks/sphere.js";import{defaultApplyOptions as m,interactionDirectionTowardsConstraintMinimization as u,adjustRangeForInteraction as p}from"./common.js";function d(e,n,r=m){if(!e.state.isLocal)return 0;const t=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||t===1/0)return 0;x.min=0,x.max=t,O(e,r,x);const o=g(e,n),i=x.max-o;return i>=-1e-6?0:i}function y(n,t,s=m){const p=d(n,t,s);if(0===p)return!1;const y=n.pointsOfInterest.surfaceOrigin,O=g(n,t)+p,x=r(l,t.eye),C=u(t,s.interactionDirection,j(n,t,h),L);if(!a(f(y.renderLocation,O),c(t.eye,C),k))return!1;t.eye=k;const b=o(I,t.eye,x);t.center=i(k,t.center,b);const v=n.renderCoordsHelper.getAltitude(t.center),H=n.renderCoordsHelper.intersectInfiniteManifold(t.ray,v,k);return e(H)&&(t.center=H),!0}function O(e,n,r){const t=n.interactionType;if(0===t)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=n,a=1===t||4===t,f=d(e,s),m=0===f?0:g(e,s);r.min=o,r.max=i;p(f,m,a,c,.05*m,r)}function g(e,r){const t=e.pointsOfInterest.surfaceOrigin;return n(r.eye,t.renderLocation)}function j(e,n,r){const o=e.pointsOfInterest.surfaceOrigin;return t(r,n.eye,o.renderLocation)}const x={min:0,max:0},l=s(),I=s(),L=s(),h=s(),k=s();export{y as applyDistanceConstraint,d as getDistanceConstraintError};
