/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{disposeMaybe as e,isNone as t,isSome as r}from"../../../../core/maybe.js";import"../../../webgl/BufferObject.js";import"../../../webgl/FramebufferObject.js";import"../../../../core/has.js";import"../../../webgl/enums.js";import"../../../webgl/RenderingContext.js";import"../../../../chunks/builtins.js";import n from"../../../webgl/Texture.js";import"../../../webgl/VertexArrayObject.js";class s{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach((t=>t.texture=e(t.texture))),this.cache.clear()}acquire(e){if(t(e))return null;const r=this.patternId(e),s=this.cache.get(r);if(s)return s.refCount++,s.bind;const i=2,o=this.patternToTextureData(e,2),a=o.length/i,c={refCount:1,texture:null,bind:e=>(t(c.texture)&&(c.texture=new n(this._rctx,{width:o.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},o)),e.bindTexture(c.texture,"stipplePatternTexture"),a)};return this.cache.set(r,c),c.bind}release(e){if(t(e))return;const n=this.patternId(e),s=this.cache.get(n);s&&(s.refCount--,0===s.refCount&&(r(s.texture)&&s.texture.dispose(),this.cache.delete(n)))}swap(e,t){const r=this.acquire(t);return this.release(e),r}patternId(e){return e.join(",")}patternToTextureData(e,t){const r=e.reduce(((e,t)=>e+t))*t,n=new Uint8Array(r);let s=!0,i=0;for(const o of e){for(let e=0;e<o*t;e++)n[i++]=s?255:0;s=!s}return n}}export{s as StippleTextureRepository};
