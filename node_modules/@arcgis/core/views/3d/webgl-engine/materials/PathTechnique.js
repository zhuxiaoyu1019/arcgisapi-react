/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{bindSliceUniformsWithOrigin as r}from"../core/shaderLibrary/Slice.glsl.js";import{setVVUniforms as i}from"../core/shaderLibrary/attributes/PathVertexPosition.glsl.js";import{VertexNormal as t}from"../core/shaderLibrary/attributes/VertexNormal.glsl.js";import{bindMultipassTerrainTexture as o}from"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js";import{bindReadShadowMapView as s}from"../core/shaderLibrary/shading/ReadShadowMap.glsl.js";import{bindProjectionMatrix as a,bindNearFar as n,bindView as p,bindCameraPosition as l}from"../core/shaderLibrary/util/View.glsl.js";import{ReloadableShaderModule as u}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as d}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as c,parameter as h}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import{blendingDefault as m,OITBlending as v,OITDepthTest as g,OITPolygonOffset as f}from"../lib/OrderIndependentTransparency.js";import{Program as b}from"../lib/Program.js";import{stencilWriteMaskOn as y,stencilBaseAllZerosParams as S}from"../lib/StencilUtils.js";import{P as T}from"../../../../chunks/Path.glsl.js";import{makePipelineState as P,frontFaceCullingParams as w,defaultDepthWriteParams as j,defaultColorWriteParams as M}from"../../../webgl/renderState.js";const O=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]);class E extends d{initializeProgram(e){const r=E.shader.get(),i=this.configuration,t=r.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:i.receiveSSAO,doubleSidedMode:i.doubleSidedMode,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new b(e.rctx,t,O)}bindPass(e,r){var t,s;a(this.program,r.camera.projectionMatrix),this.program.setUniform3fv("size",e.size),r.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),this.program.setUniform2fv("inverseViewport",r.inverseViewport),o(this.program,r)),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",e.opacity),0===this.configuration.output?(r.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform3fv("specular",e.specular),this.program.setUniform1f("opacity",e.opacity)):1!==this.configuration.output&&3!==this.configuration.output||n(this.program,r.camera.nearFar),i(this.program,e),null==(t=r.shadowMap)||t.bind(this.program),null==(s=r.ssaoHelper)||s.bind(this.program)}bindDraw(e){p(this.program,e),r(this.program,this.configuration,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||l(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&s(this.program,e),2===this.configuration.output&&t.bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)}setPipelineState(e){const r=this.configuration,i=3===e,t=2===e,o=e=>!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode);return P({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?m:v(e),culling:o(r)&&w,depthTest:{func:g(e)},depthWrite:i||t?j:null,colorWrite:M,stencilWrite:r.sceneHasOcludees?y:null,stencilTest:r.sceneHasOcludees?S:null,polygonOffset:i||t?null:f})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}E.shader=new u(T,(()=>import("../shaders/Path.glsl.js")));class x extends c{constructor(){super(...arguments),this.output=0,this.doubleSidedMode=0,this.receiveShadows=!1,this.receiveSSAO=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([h({count:8})],x.prototype,"output",void 0),e([h({count:3})],x.prototype,"doubleSidedMode",void 0),e([h()],x.prototype,"receiveShadows",void 0),e([h()],x.prototype,"receiveSSAO",void 0),e([h()],x.prototype,"vvSize",void 0),e([h()],x.prototype,"vvColor",void 0),e([h()],x.prototype,"vvOpacity",void 0),e([h()],x.prototype,"slicePlaneEnabled",void 0),e([h()],x.prototype,"transparent",void 0),e([h()],x.prototype,"sceneHasOcludees",void 0),e([h({count:4})],x.prototype,"transparencyPassType",void 0),e([h()],x.prototype,"multipassTerrainEnabled",void 0),e([h()],x.prototype,"cullAboveGround",void 0);export{E as PathTechnique,x as PathTechniqueConfiguration,O as pathVertexAttributeLocations};
