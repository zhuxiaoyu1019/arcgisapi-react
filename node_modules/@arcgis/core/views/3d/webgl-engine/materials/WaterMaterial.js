/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{AnimationTimer as e}from"../lib/AnimationTimer.js";import{Material as t}from"../lib/Material.js";import{OITPolygonOffsetLimit as i}from"../lib/OrderIndependentTransparency.js";import{WaterGLMaterial as a}from"./WaterGLMaterial.js";import{WaterTechniqueConfiguration as n}from"./WaterTechnique.js";import{DefaultBufferWriter as r,PositionUVLayout as s}from"./internal/DefaultBufferWriter.js";import{intersectTriangleGeometry as o}from"./internal/MaterialUtil.js";import{defaultWaterMaterialParameters as h}from"./internal/waterMaterialUtils.js";class c extends t{constructor(t){super(t,h),this.animation=new e,this.techniqueConfig=new n}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.useSSR=this.params.ssrEnabled,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<i,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*t<u;const i=this.animation.advance(e.dt);return this.animation.enabled&&i}intersect(e,t,i,a,n,r,s){o(e,t,a,n,r,void 0,s)}getGLMaterial(e){if(0===e.output&&this.params.isDraped){const t=e;return t.output=5,new a(t)}switch(e.output){case 0:case 2:case 4:case 7:return new a(e)}}createBufferWriter(){return new r(s)}}const u=35e3;export{c as WaterMaterial};
