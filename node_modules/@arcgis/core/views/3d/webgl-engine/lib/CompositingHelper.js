/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{disposeMaybe as t,isNone as r}from"../../../../core/maybe.js";import{createQuadVAO as e}from"./glUtil3D.js";import{CompositingTechnique as o,CompositingTechniqueConfiguration as i}from"../shaders/CompositingTechnique.js";import{vertexCount as s}from"../../../webgl/Util.js";class a{constructor(t,r){this._rctx=t,this._techniqueRepository=r}dispose(){this._vao=t(this._vao)}compositeTransparent(t,r,e,i=1){const a=this._rctx;c.alphaMode=1,c.function=2,c.hasOpacityFactor=1!==i;const n=this._techniqueRepository.acquire(o,c);a.useProgram(n.program),n.bindPipelineState(a),n.program.bindTexture(t,"colorTexture"),n.program.bindTexture(r,"alphaTexture"),n.program.bindTexture(e,"frontFaceTexture");const p=this.ensureVAO();a.bindVAO(p),a.drawArrays(5,0,s(p,"geometry")),n.release()}compositeSpecial(t,r){this.composite(t,0,1,r)}composite(t,r=0,e=1,i=0,a=0){const n=this._rctx;c.alphaMode=r,c.function=i,c.hasOpacityFactor=1!==e;const p=this._techniqueRepository.acquire(o,c);n.useProgram(p.program),p.bindPipelineState(n),p.program.bindTexture(t,"tex"),c.hasOpacityFactor&&p.program.setUniform1f("opacity",e),3===i&&p.program.setUniform1i("overlayIdx",a);const m=this.ensureVAO();n.bindVAO(m),n.drawArrays(5,0,s(m,"geometry")),p.release()}ensureVAO(){return r(this._vao)&&(this._vao=e(this._rctx)),this._vao}}const c=new i;export default a;
