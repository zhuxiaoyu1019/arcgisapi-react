/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{disposeMaybe as t}from"../../../../core/maybe.js";import{f as i}from"../../../../chunks/vec4f32.js";import{createQuadVAO as e}from"./glUtil3D.js";import{ShadowHighlightTechnique as s}from"../shaders/ShadowHighlightTechnique.js";import{vertexCount as h}from"../../../webgl/Util.js";const a=.001953125;class o{constructor(t,h){this._rctx=t,this._maxOpacity=1,this._defaultOptions={shadowColor:i(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1},this._technique=new s({rctx:t,viewingMode:h},null),this._vao=e(this._rctx)}render(t,i){t.shadowMap.enabled&&t.linearDepthTexture&&this.isVisible&&(this._rctx.bindFramebuffer(i),this._rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this._rctx),this._technique.bindPass(this._defaultOptions,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._technique.primitiveType,0,h(this._vao,"geometry")))}getGpuMemoryUsage(){return this._vao?this._vao.size:0}setDefaultOptions(t){this._defaultOptions=t,this._updateMaxOpacity()}get highlightShadowMapSlot(){return this._technique.highlightShadowMapSlot}get defaultSnapshotSlot(){return this._technique.defaultSnapshotSlot}dispose(){this._vao=t(this._vao),this._technique=t(this._technique)}get isVisible(){return this._maxOpacity*this._technique.opacityElevation*this._technique.dayNightTerminator>=a}_updateMaxOpacity(){const t=this._defaultOptions,i=t.shadowColor,e=Math.max(t.shadowOpacity,t.occludedShadowOpacity);this._maxOpacity=e*i[3]}}export{o as ShadowHighlightHelper};
