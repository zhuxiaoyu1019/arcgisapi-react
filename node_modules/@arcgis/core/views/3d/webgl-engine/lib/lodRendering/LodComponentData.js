/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{glLayout as e}from"../../../support/buffer/glUtil.js";import{Default3D as t}from"../DefaultVertexAttributeLocations.js";import{IntersectorResult as r}from"../intersectorUtils.js";import{acquireMaterials as s,releaseMaterials as i}from"../../materials/renderers/utils.js";import o from"../../../../webgl/BufferObject.js";import n from"../../../../webgl/VertexArrayObject.js";class a{constructor(r,i){const a=r.renderContext.rctx,l=i.geometry,m=i.material;this.materialRep=r.materialRep,m.setParameterValues({instancedDoublePrecision:!0});const u=m.createBufferWriter(),d=u.vertexBufferLayout,f=u.elementCount(l),c=u.allocate(f);u.write({},l,c,0),this.geometry=l,this.material=m,this.glMaterials=s(m,this.materialRep),this.vertexBufferLayout=d,this.vbo=o.createVertex(a,35044,c.buffer),this.vao=new n(a,t,{geometry:e(d)},{geometry:this.vbo}),this.vertexCount=f}destroy(){i(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,s,i,o,n){const a=this.geometry.id,l=o.toString();this.material.intersect(this.geometry,null,e.transform.transform,e,s,i,((s,i,m,u)=>{if(s>=0){if(null!=t&&!t(e.rayBeginPoint,e.rayEndPoint,s))return;const d={type:"external",metadata:{layerUid:n.layerUid,graphicUid:n.graphicUid(o)}};if((null==e.results.min.drapedLayerOrder||u>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||s<e.results.min.dist)&&(e.results.min.set(d,l,s,i,e.transform.transform,u,null,a,m),e.results.min.intersector="LodRenderer"),0!==e.options.store&&(null==e.results.max.drapedLayerOrder||u>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||s>e.results.max.dist)&&(e.results.max.set(d,l,s,i,e.transform.transform,u,null,a,m),e.results.min.intersector="LodRenderer"),2===e.options.store){const t=new r(e.results.min.ray);t.set(d,l,s,i,e.transform.transform,u,null,a,m),t.intersector="LodRenderer",e.results.all.push(t)}}}))}}export{a as LodComponentData};
