/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import e from"../../core/Accessor.js";import{createResolver as i}from"../../core/promiseUtils.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import"../../core/Logger.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import{setActive as o}from"./interactiveToolUtils.js";import{ManipulatorCollection as r}from"./ManipulatorCollection.js";let h=class extends e{constructor(t){super(t),this.toolState="pending",this.attached=!1,this.created=!1,this.completed=!1,this.manipulators=new r,this.updating=!1,this._editableFlags=new Array,this._creationStartedResolver=i(),this._creationFinishedResolver=i()}get active(){return null!=this.view&&this.view.activeTool===this}get isSupported(){return!0}set visible(t){this._set("visible",t),t||o(this,!1),this.attached&&(t?this._show():this._hide())}get editable(){return this.hasEditableFlag(0)}set editable(t){this.setEditableFlag(0,t)}attach(){!this.attached&&this.isSupported&&(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached&&(this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1))}handleInputEvent(t){this.attached&&this.onInputEvent(t)}handleInputEventAfter(t){this.attached&&this.onInputEventAfter(t)}destroy(){switch(this.toolState){case"pending":break;case"creating":case"created":this.manipulators.destroy()}this.toolState="destroyed",this._set("view",null),this._set("created",!1),this._set("completed",!1)}setEditableFlag(t,e){this._editableFlags[t]=e,this.manipulators.isToolEditable=this._editableFlags.every((t=>null==t||t)),this._updateManipulatorAttachment(),0===t&&this.notifyChange("editable"),this.onEditableChange()}hasEditableFlag(t){const e=this._editableFlags[t];return null==e||e}whenCreationStarted(){return this._creationStartedResolver.promise}when(){return this._creationFinishedResolver.promise}rejectCreation(t){switch(this.toolState){case"pending":case"creating":this._creationStartedResolver.resolve(this)}this._creationFinishedResolver.reject(t)}initialize(){}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)}startToolCreation(){switch(this.toolState){case"pending":this._creationStartedResolver.resolve(this),this.toolState="creating";break;case"creating":case"created":case"destroyed":default:throw new Error(`unexpected tool state ${this.toolState}`)}}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||(this._set("created",!0),this._creationFinishedResolver.resolve(this)),this.toolState="created";break;case"created":if(!this.created)throw new Error(`expected this.created to match toolstate ${this.toolState}`);break;case"destroyed":default:throw new Error(`unexpected tool state ${this.toolState}`)}}complete(){this.finishToolCreation(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}};t([s()],h.prototype,"toolState",void 0),t([s({constructOnly:!0})],h.prototype,"view",void 0),t([s({readOnly:!0})],h.prototype,"active",null),t([s({value:!0})],h.prototype,"visible",null),t([s({value:!0})],h.prototype,"editable",null),t([s({readOnly:!0})],h.prototype,"attached",void 0),t([s({readOnly:!0})],h.prototype,"created",void 0),t([s({readOnly:!0})],h.prototype,"completed",void 0),t([s({readOnly:!0})],h.prototype,"manipulators",void 0),t([s({readOnly:!0})],h.prototype,"updating",void 0),h=t([a("esri.views.interactive.InteractiveToolBase")],h);export{h as InteractiveToolBase};
