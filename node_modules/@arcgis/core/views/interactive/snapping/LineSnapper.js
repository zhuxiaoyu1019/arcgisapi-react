/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{unwrap as e}from"../../../core/maybe.js";import{a as t}from"../../../chunks/vec2f64.js";import{SnappingAlgorithm as o}from"./SnappingAlgorithm.js";import{anyMapPointToScreenPoint as r,squareDistance as s}from"./snappingUtils.js";import{LineSnappingCandidate as i}from"./candidates/LineSnappingCandidate.js";import{projectPointToLine as n}from"../../support/geometry2dUtils.js";class d extends o{snapNewVertex(e,t){const o=t.geometry.editGeometry.components[0],s=o.edges.length,i=[];if(s<1)return i;const n=t.coordinateHelper,d=r(e,n,t.elevationInfo,this.view),p=o.edges[s-1];let h=p;do{this.edgeExceedsShortLineThreshold(h,t)&&this._processCandidateProposal(h.left.pos,h.right.pos,e,d,t,i),h=h.left.left}while(h&&h!==p);return i}snapExistingVertex(t,o){const s=[],i=e(o.vertexHandle),n=i.component;if(n.edges.length<2)return s;const d=o.coordinateHelper,p=r(t,d,o.elevationInfo,this.view),h=i.left,a=i.right;h&&a&&this.edgeExceedsShortLineThreshold(h,o)&&this.edgeExceedsShortLineThreshold(a,o)&&this._processCandidateProposal(h.left.pos,a.right.pos,t,p,o,s);const l=n.edges[0];let c=l;do{c!==i.left&&c!==i.right&&this.edgeExceedsShortLineThreshold(c,o)&&this._processCandidateProposal(c.left.pos,c.right.pos,t,p,o,s),c=c.right.right}while(c&&c!==l);return s}_processCandidateProposal(e,o,d,p,h,a){const l=n(t(),d,e,o),c=h.coordinateHelper,g=c.fromXYZ(l,c.getZ(d,0));s(p,r(g,c,h.elevationInfo,this.view))<this.squaredProximityTreshold(h.pointer)&&a.push(new i({coordinateHelper:h.coordinateHelper,lineStart:e,lineEnd:o,targetPoint:g}))}}export{d as LineSnapper};
