/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{unwrap as e}from"../../../core/maybe.js";import{m as t,d as o}from"../../../chunks/vec2.js";import{a as r}from"../../../chunks/vec2f64.js";import{SnappingAlgorithm as s}from"./SnappingAlgorithm.js";import{anyMapPointToScreenPoint as i,squareDistance as n}from"./snappingUtils.js";import{RightAngleTriangleSnappingCandidate as p}from"./candidates/RightAngleTriangleSnappingCandidate.js";import{projectPointToCircle as a}from"../../support/geometry2dUtils.js";class m extends s{snapNewVertex(e,t){const o=t.geometry.editGeometry.components[0],r=[],s=o.vertices.length;if("polygon"!==t.geometry.type||s<2)return r;const i=o.vertices[0],n=o.vertices[s-1];return this._processCandidateProposal(i.pos,n.pos,e,t,r),r}snapExistingVertex(t,o){const r=[],s=e(o.vertexHandle),i=s.component;return i.edges.length<2?r:"polyline"!==o.geometry.type||0!==s.index&&s.index!==i.vertices.length-1?(this._processCandidateProposal(s.left.left.pos,s.right.right.pos,t,o,r),r):r}_processCandidateProposal(e,s,m,d,l){if(!this.exceedsShortLineThreshold(e,s,d))return;const c=t(r(),e,s,.5),g=.5*o(e,s),h=a(r(),m,c,g),f=d.coordinateHelper,v=f.fromXYZ(h,f.getZ(m,0)),y=i(m,f,d.elevationInfo,this.view);n(y,i(v,f,d.elevationInfo,this.view))<this.squaredProximityTreshold(d.pointer)&&l.push(new p({coordinateHelper:f,targetPoint:v,point1:e,point2:s}))}}export{m as RightAngleTriangleSnapper};
