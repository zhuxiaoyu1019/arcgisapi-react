/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import{createResolver as i}from"../../core/promiseUtils.js";import{debug as r}from"../../core/scheduling.js";import{whenNotOnce as n}from"../../core/watchUtils.js";import{dispatch as o}from"../../core/accessorSupport/watch.js";function t(e){switch(e.type){case"2d":return a(e);case"3d":if(e)return o(),r.dispatch(),n(e,"updating")}return Promise.resolve()}function a(n){const t=i();let a=performance.now();const s=function(){var i,t,a,s,l,u,c;if(o(),r.dispatch(),!n.ready||n.updating||!n.stationary||n.rendering||!0===(null==(i=n.layerViewManager)?void 0:i.updating)||!0===(null==(t=n.labelManager)?void 0:t.updating)||!0===(null==(a=n.graphicsView)?void 0:a.updating)||!0===(null==(s=n.magnifier)?void 0:s.visible)&&e(null==(l=n.magnifier)?void 0:l.position)&&(null==(u=n._magnifierView)||!u.mask||null==(c=n._magnifierView)||!c.overlay)||n.allLayerViews.some((e=>!0===e.updating)))return!0;return!!n.allLayerViews.find((function(e){const i=!e.isFulfilled(),r=e.updating&&!e.suspended;return i||r}))};function l(){if(!n.destroyed&&s())a=null,setTimeout(l,16);else{a||(a=performance.now());performance.now()-a>=200?t():setTimeout(l,16)}}return setTimeout(l,16),t.promise}export default t;
