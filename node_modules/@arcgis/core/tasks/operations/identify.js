/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import{getJsonType as t}from"../../geometry/support/jsonUtils.js";import{getScale as r}from"../../geometry/support/scaleUtils.js";import{serializeLayerDefinitions as i,getLayersForScale as n}from"../../layers/support/layerUtils.js";const s=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function o(o,a){const{dpi:l,dynamicLayers:m,gdbVersion:f,geometry:y,geometryPrecision:p,height:c,layerDefinitions:d,layerIds:u,layerOption:g,layerTimeOptions:x,mapExtent:O,maxAllowableOffset:h,returnFieldName:N,returnGeometry:R,returnUnformattedValues:$,returnZ:j,spatialReference:b,timeExtent:w,tolerance:E,width:J}=o.toJSON(),S=a&&e(a.geometry)?a.geometry:null,U={geometryPrecision:p,maxAllowableOffset:h,returnFieldName:N,returnGeometry:R,returnUnformattedValues:$,returnZ:j,tolerance:E},V=S&&S.toJSON()||y;if(U.imageDisplay=`${J},${c},${l}`,f&&(U.gdbVersion=f),V&&(delete V.spatialReference,U.geometry=JSON.stringify(V),U.geometryType=t(V)),b?U.sr=b.wkid||JSON.stringify(b):V&&V.spatialReference?U.sr=s(V):O&&O.spatialReference&&(U.sr=s(O)),U.time=w?w.join(","):null,O){const{xmin:e,ymin:t,xmax:r,ymax:i}=O;U.mapExtent=`${e},${t},${r},${i}`}if(U.layers=g,u&&(U.layers+=`:${u.join(",")}`),d){const e=[];for(let t=0;t<d.length;t++){const r=d[t];e[r.id]=r.definitionExpression}U.layerDefs=i(e)}if(m&&m.length){const e=[],t={extent:O,width:J,spatialReference:O.spatialReference},i=r(t),s=n(i,m);for(let r=0;r<m.length;r++){const t=m[r],i=t.id;if(!t.subLayerIds&&u&&-1!==u.indexOf(i)&&-1!==s.indexOf(i)){const r={id:i};r.source=t.source;let n,s=null;if(d&&d.length){const e=d.filter((e=>e.id===i))[0];s=e&&e.definitionExpression}s&&(r.definitionExpression=s),x&&x[i]&&(n=x[i]),n&&(r.layerTimeOptions=n),e.push(r)}}let o=JSON.stringify(e);"[]"===o&&(o="[{}]"),U.dynamicLayers=o}return U}export{o as identifyToIdentifyRESTParameters};
