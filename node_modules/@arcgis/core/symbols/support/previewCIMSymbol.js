/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{px2pt as t}from"../../core/screenUtils.js";import{CIMSymbolRasterizer as e}from"../cim/CIMSymbolRasterizer.js";import{getCIMSymbolSize as a,scaleCIMSymbolTo as l}from"./cimSymbolUtils.js";const i=new e(null,!0),o=120;async function n(e,n={}){const{size:s,maxSize:c,node:m,opacity:r}=n,y=n.cimOptions||n,{feature:d,fieldMap:h,geometryType:p,style:u}=y,g=a(e),f=Math.min(null!=s?s:g,null!=c?c:t(o));f!==g&&(e=e.clone(),l(e,f,{preserveOutlineWidth:!0}));let M=3;e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(M=1);const b=await i.rasterizeCIMSymbolAsync(e,d,h,p,{scaleFactor:M,style:u}),w=document.createElement("canvas");w.width=b.imageData.width,w.height=b.imageData.height;w.getContext("2d").putImageData(b.imageData,0,0);let C=w.width/M,D=w.height/M;if(null!=s&&(null==(null==n?void 0:n.scale)||(null==n?void 0:n.scale))){const t=C/D;C=t<=1?Math.ceil(f*t):f,D=t<=1?f:Math.ceil(f/t)}const I=new Image(C,D);return I.src=w.toDataURL(),null!=r&&(I.style.opacity=`${r}`),m&&m.appendChild(I),I}export{n as previewCIMSymbol};
