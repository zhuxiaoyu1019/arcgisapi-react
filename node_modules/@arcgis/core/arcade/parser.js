/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{validateLanguage as n,findScriptDependencies as e,checkScript as r,findFieldLiterals as o,validateScript as t,referencesMember as i,referencesFunction as c}from"./treeAnalysis.js";import{parse as l}from"./lib/esprima.js";function s(r,o=[]){const t=l("function _() { "+r+"\n}");if(null===t.body||void 0===t.body)throw new Error("No formula provided.");if(0===t.body.length)throw new Error("No formula provided.");if(0===t.body.length)throw new Error("No formula provided.");if("BlockStatement"!==t.body[0].body.type)throw new Error("Invalid formula content.");const i=n(t);if(""!==i)throw new Error(i);return e(t,o),t}function u(n,e,o,t,i){const c=[],s="function _() { \n".length-1,u="function _() { \n"+n+"\n}";try{const n=l(u,{tolerant:!0,loc:!0,range:!0}),a=n.errors;if(a.length>0)for(let e=0;e<a.length;e++)c.push({line:a[e].lineNumber-2,character:a[e].column,reason:a[e].description});const f=r(n,e,o,t,i);for(let e=0;e<f.length;e++)f[e].line=f[e].line-2,f[e].range&&(f[e].range=[f[e][0]-s,f[e][1]-s]),f[e].loc&&(f[e].loc.start.line=f[e].loc.start.line-2,f[e].loc.end.line=f[e].loc.end.line-2),c.push(f[e])}catch(a){try{if("Unexpected token }"===a.description){const n=u.split("\n").length;a.lineNumber===n?(a.index=u.length-1,c.push({line:a.lineNumber-4,character:a.column,reason:"Unexpected end of script"})):(a.index=u.length-1,c.push({line:a.lineNumber-2,character:a.column,reason:"Unexpected end of script"}))}else c.push({line:a.lineNumber-2,character:a.column,reason:a.description})}catch(f){}}return c}function a(n,e){return o(n)}function f(n,e,r){return t(n,e,r)}function d(n,e){return i(n,e)}function h(n,e){return c(n,e)}export{a as extractFieldLiterals,s as parseScript,h as referencesFunction,d as referencesMember,u as scriptCheck,f as validateScript};
