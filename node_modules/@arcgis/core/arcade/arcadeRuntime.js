/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"./ArcadePortal.js";import r from"./Attachment.js";import t from"./Dictionary.js";import n from"./Feature.js";import o from"./FunctionWrapper.js";import a from"./ImmutablePathArray.js";import i from"./ImmutablePointArray.js";import{p as s,i as l,e as c,N as u,R as f,I as p,v as h,m as w,n as m,c as E,g as d,a as g,b as N,k as I,t as y,d as v,h as T,j as R,f as O,o as S,q as b,r as U}from"../chunks/languageUtils.js";import{addFunctionDeclaration as A,findFieldLiterals as C,validateScript as M,referencesMember as x,referencesFunction as F,findFunctionCalls as P,nodeErrorMessage as D}from"./treeAnalysis.js";import{registerFunctions as L}from"./functions/array.js";import{registerFunctions as j}from"./functions/date.js";import{registerFunctions as _}from"./functions/geometry.js";import{registerFunctions as k}from"./functions/geomsync.js";import{registerFunctions as V}from"./functions/maths.js";import{registerFunctions as B}from"./functions/stats.js";import{registerFunctions as Y}from"./functions/string.js";import G from"../geometry/Extent.js";import z from"../geometry/Geometry.js";import q from"../geometry/Multipoint.js";import Z from"../geometry/Point.js";import H from"../geometry/Polygon.js";import W from"../geometry/Polyline.js";import K from"../geometry/SpatialReference.js";function X(e,r){const t=[];for(let n=0;n<r.arguments.length;n++)t.push(Q(e,r.arguments[n]));return t}function J(e,r,t){try{return t(e,r,X(e,r))}catch(n){throw n}}function Q(e,r){try{switch(r.type){case"EmptyStatement":return h;case"VariableDeclarator":return he(e,r);case"VariableDeclaration":return pe(e,r);case"BlockStatement":return ce(e,r);case"FunctionDeclaration":return fe(e,r);case"ReturnStatement":return ue(e,r);case"IfStatement":return le(e,r);case"ExpressionStatement":return se(e,r);case"AssignmentExpression":return ie(e,r);case"UpdateExpression":return oe(e,r);case"BreakStatement":return w;case"ContinueStatement":return m;case"TemplateElement":return ye(e,r);case"TemplateLiteral":return ve(e,r);case"ForStatement":return te(e,r);case"ForInStatement":return re(e,r);case"Identifier":return Te(e,r);case"MemberExpression":return Ee(e,r);case"Literal":return r.value;case"CallExpression":return Re(e,r);case"UnaryExpression":return de(e,r);case"BinaryExpression":return Ne(e,r);case"LogicalExpression":return Ie(e,r);case"ConditionalExpression":throw new Error(D(r,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return ge(e,r);case"ObjectExpression":return $(e,r);case"Property":return ee(e,r);default:throw new Error(D(r,"RUNTIME","UNREOGNISED"))}}catch(t){throw t}}function $(e,r){const n={};for(let t=0;t<r.properties.length;t++){const o=Q(e,r.properties[t]);if(E(o.value))throw new Error("Illegal Argument");if(!1===d(o.key))throw new Error("Illegal Argument");o.value===h?n[o.key.toString()]=null:n[o.key.toString()]=o.value}const o=new t(n);return o.immutable=!1,o}function ee(e,r){return{key:"Identifier"===r.key.type?r.key.name:Q(e,r.key),value:Q(e,r.value)}}function re(e,r){const o=Q(e,r.right);"VariableDeclaration"===r.left.type&&Q(e,r.left);let a=null,i="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(i=e.name)}else"Identifier"===r.left.type&&(i=r.left.name);if(!i)throw new Error(D(r,"RUNTIME","INVALIDVARIABLE"));if(i=i.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[i]&&(a=e.localScope[i]),null===a&&void 0!==e.globalScope[i]&&(a=e.globalScope[i]),null===a)throw new Error(D(r,"RUNTIME","VARIABLENOTDECLARED"));if(g(o)||d(o)){const t=o.length;for(let n=0;n<t;n++){a.value=n;const t=Q(e,r.body);if(t===w)break;if(t instanceof f)return t}return h}if(N(o)){for(let t=0;t<o.length();t++){a.value=t;const n=Q(e,r.body);if(n===w)break;if(n instanceof f)return n}return h}if(!(o instanceof t||o instanceof n))return h;{const t=o.keys();for(let n=0;n<t.length;n++){a.value=t[n];const o=Q(e,r.body);if(o===w)break;if(o instanceof f)return o}}}function te(e,r){null!==r.init&&Q(e,r.init);const t={testResult:!0,lastAction:h};do{ne(e,r,t)}while(!0===t.testResult);return t.lastAction instanceof f?t.lastAction:h}function ne(e,r,t){if(null!==r.test){if(t.testResult=Q(e,r.test),!1===t.testResult)return;if(!0!==t.testResult)throw new Error(D(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}t.lastAction=Q(e,r.body),t.lastAction!==w?t.lastAction instanceof f?t.testResult=!1:null!==r.update&&Q(e,r.update):t.testResult=!1}function oe(e,r){let o,a=null,i="";if("MemberExpression"===r.argument.type){if(a=Q(e,r.argument.object),!0===r.argument.computed?i=Q(e,r.argument.property):"Identifier"===r.argument.property.type&&(i=r.argument.property.name),g(a)){if(!I(i))throw new Error("Invalid Parameter");if(i<0&&(i=a.length+i),i<0||i>=a.length)throw new Error("Assignment outside of array bounds");o=y(a[i]),a[i]="++"===r.operator?o+1:o-1}else if(a instanceof t){if(!1===d(i))throw new Error("Dictionary accessor must be a string");if(!0!==a.hasField(i))throw new Error("Invalid Parameter");o=y(a.field(i)),a.setField(i,"++"===r.operator?o+1:o-1)}else{if(!(a instanceof n))throw N(a)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===d(i))throw new Error("Feature accessor must be a string");if(!0!==a.hasField(i))throw new Error("Invalid Parameter");o=y(a.field(i)),a.setField(i,"++"===r.operator?o+1:o-1)}return!1===r.prefix?o:"++"===r.operator?o+1:o-1}if(a="Identifier"===r.argument.type?r.argument.name.toLowerCase():"",!a)throw new Error("Invalid identifier");if(null!==e.localScope&&void 0!==e.localScope[a])return o=y(e.localScope[a].value),e.localScope[a]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},!1===r.prefix?o:"++"===r.operator?o+1:o-1;if(void 0!==e.globalScope[a])return o=y(e.globalScope[a].value),e.globalScope[a]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},!1===r.prefix?o:"++"===r.operator?o+1:o-1;throw new Error("Variable not recognised")}function ae(e,r,t,n){switch(r){case"=":return e===h?null:e;case"/=":return y(t)/y(e);case"*=":return y(t)*y(e);case"-=":return y(t)-y(e);case"+=":return d(t)||d(e)?v(t)+v(e):y(t)+y(e);case"%=":return y(t)%y(e);default:throw new Error(D(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}function ie(e,r){const o=Q(e,r.right);let a=null,i="";if("MemberExpression"===r.left.type){if(a=Q(e,r.left.object),!0===r.left.computed?i=Q(e,r.left.property):"Identifier"===r.left.property.type&&(i=r.left.property.name),g(a)){if(!I(i))throw new Error("Invalid Parameter");if(i<0&&(i=a.length+i),i<0||i>a.length)throw new Error("Assignment outside of array bounds");if(i===a.length){if("="!==r.operator)throw new Error("Invalid Parameter");a[i]=ae(o,r.operator,a[i],r)}else a[i]=ae(o,r.operator,a[i],r)}else if(a instanceof t){if(!1===d(i))throw new Error("Dictionary accessor must be a string");if(!0===a.hasField(i))a.setField(i,ae(o,r.operator,a.field(i),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");a.setField(i,ae(o,r.operator,null,r))}}else{if(!(a instanceof n))throw N(a)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===d(i))throw new Error("Feature accessor must be a string");if(!0===a.hasField(i))a.setField(i,ae(o,r.operator,a.field(i),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");a.setField(i,ae(o,r.operator,null,r))}}return h}if(a=r.left.name.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[a])return e.localScope[a]={value:ae(o,r.operator,e.localScope[a].value,r),valueset:!0,node:r.right},h;if(void 0!==e.globalScope[a])return e.globalScope[a]={value:ae(o,r.operator,e.globalScope[a].value,r),valueset:!0,node:r.right},h;throw new Error("Variable not recognised")}function se(e,r){if("AssignmentExpression"===r.expression.type||"UpdateExpression"===r.expression.type)return Q(e,r.expression);if("CallExpression"===r.expression.type){const t=Q(e,r.expression);return t===h?h:new p(t)}{const t=Q(e,r.expression);return t===h?h:new p(t)}}function le(e,r){if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error(D(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=Q(e,r.test);if(!0===t)return Q(e,r.consequent);if(!1===t)return null!==r.alternate?Q(e,r.alternate):h;throw new Error(D(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}function ce(e,r){let t=h;for(let n=0;n<r.body.length;n++)if(t=Q(e,r.body[n]),t instanceof f||t===w||t===m)return t;return t}function ue(e,r){if(null===r.argument)return new f(h);const t=Q(e,r.argument);return new f(t)}function fe(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new o(r,e)},h}function pe(e,r){for(let t=0;t<r.declarations.length;t++)Q(e,r.declarations[t]);return h}function he(e,r){let t=null===r.init?null:Q(e,r.init);if(t===h&&(t=null),"Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const n=r.id.name.toLowerCase();return null!==e.localScope?e.localScope[n]={value:t,valueset:!0,node:r.init}:e.globalScope[n]={value:t,valueset:!0,node:r.init},h}let we=0;function me(e,r,n){let o;switch(r=r.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let r=e.spatialReference._arcadeCacheId;if(void 0===r){let t=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(t=!1),t&&(we++,e.spatialReference._arcadeCacheId=we,r=we)}const n=new t({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==r&&(n._arcadeCacheId="SPREF"+r.toString()),n}}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const t=e[r];return void 0!==t?t:null}case"type":return"Extent"}break;case"polygon":switch(r){case"rings":o=e.cache._arcadeCacheId,void 0===o&&(we++,o=we,e.cache._arcadeCacheId=o);return new a(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":o=e.cache._arcadeCacheId,void 0===o&&(we++,o=we,e.cache._arcadeCacheId=o);return new a(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":o=e.cache._arcadeCacheId,void 0===o&&(we++,o=we,e.cache._arcadeCacheId=o);return new i(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,o,1);case"type":return"Multipoint"}}throw new Error(D(n,"RUNTIME","PROPERTYNOTFOUND"))}function Ee(e,r){try{const o=Q(e,r.object);if(null===o)throw new Error(D(r,"RUNTIME","NOTFOUND"));if(!1===r.computed){if("Identifier"===r.property.type){if(o instanceof t||o instanceof n)return o.field(r.property.name);if(o instanceof z)return me(o,r.property.name,r)}throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}{let a=Q(e,r.property);if(o instanceof t||o instanceof n){if(d(a))return o.field(a);throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}if(o instanceof z){if(d(a))return me(o,a,r);throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}if(g(o)){if(I(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length+a),a>=o.length||a<0)throw new Error(D(r,"RUNTIME","OUTOFBOUNDS"));return o[a]}throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}if(d(o)){if(I(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length+a),a>=o.length||a<0)throw new Error(D(r,"RUNTIME","OUTOFBOUNDS"));return o[a]}throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}if(N(o)){if(I(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length()+a),a>=o.length()||a<0)throw new Error(D(r,"RUNTIME","OUTOFBOUNDS"));return o.get(a)}throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}throw new Error(D(r,"RUNTIME","INVALIDTYPE"))}}catch(o){throw o}}function de(e,r){try{const t=Q(e,r.argument);if(l(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*y(t);if("+"===r.operator)return 1*y(t);if("~"===r.operator)return~y(t);throw new Error(D(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("~"===r.operator)return~y(t);if("-"===r.operator)return-1*y(t);if("+"===r.operator)return 1*y(t);throw new Error(D(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}catch(t){throw t}}function ge(e,r){try{const t=[];for(let n=0;n<r.elements.length;n++){const o=Q(e,r.elements[n]);if(E(o))throw new Error(D(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));o===h?t.push(null):t.push(o)}return t}catch(t){throw t}}function Ne(e,r){try{const t=[Q(e,r.left),Q(e,r.right)],n=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return R(y(n),y(o),r.operator);case"==":return c(n,o);case"!=":return!c(n,o);case"<":case">":case"<=":case">=":return T(n,o,r.operator);case"+":return d(n)||d(o)?v(n)+v(o):y(n)+y(o);case"-":return y(n)-y(o);case"*":return y(n)*y(o);case"/":return y(n)/y(o);case"%":return y(n)%y(o);default:throw new Error(D(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}catch(t){throw t}}function Ie(e,r){try{if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error(D(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error(D(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=Q(e,r.left);if(l(t))switch(r.operator){case"||":if(!0===t)return t;{const t=Q(e,r.right);if(l(t))return t;throw new Error(D(r,"RUNTIME","ONLYORORAND"))}case"&&":if(!1===t)return t;{const t=Q(e,r.right);if(l(t))return t;throw new Error(D(r,"RUNTIME","ONLYORORAND"))}default:throw new Error(D(r,"RUNTIME","ONLYORORAND"))}throw new Error(D(r,"RUNTIME","ONLYBOOLEAN"))}catch(t){throw t}}function ye(e,r){return r.value?r.value.cooked:""}function ve(e,r){let t="",n=0;for(const o of r.quasis)if(t+=o.value?o.value.cooked:"",!1===o.tail){t+=r.expressions[n]?v(Q(e,r.expressions[n])):"",n++}return t}function Te(e,r){let t;try{const n=r.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[n])return t=e.localScope[n],!0===t.valueset||(t.value=Q(e,t.node),t.valueset=!0),t.value;if(void 0!==e.globalScope[n])return t=e.globalScope[n],!0===t.valueset||(t.value=Q(e,t.node),t.valueset=!0),t.value;throw new Error(D(r,"RUNTIME","VARIABLENOTFOUND"))}catch(n){throw n}}function Re(e,r){try{if("Identifier"!==r.callee.type)throw new Error(D(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if(t.value instanceof u)return t.value.fn(e,r);if(t.value instanceof o)return xe(e,r,t.value.definition);throw new Error(D(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if(t.value instanceof u)return t.value.fn(e,r);if(t.value instanceof o)return xe(e,r,t.value.definition);throw new Error(D(r,"RUNTIME","NOTAFUNCTION"))}throw new Error(D(r,"RUNTIME","NOTFOUND"))}catch(t){throw t}}const Oe={};function Se(o){return null==o?"":g(o)||N(o)?"Array":S(o)?"Date":d(o)?"String":l(o)?"Boolean":I(o)?"Number":o instanceof r?"Attachment":o instanceof e?"Portal":o instanceof t?"Dictionary":o instanceof n?"Feature":o instanceof Z?"Point":o instanceof H?"Polygon":o instanceof W?"Polyline":o instanceof q?"Multipoint":o instanceof G?"Extent":E(o)?"Function":b(o)?"FeatureSet":U(o)?"FeatureSetCollection":o===h?"":"number"==typeof o&&isNaN(o)?"Number":"Unrecognised Type"}function be(e,r,t,n){try{const o=Q(e,r.arguments[t]);if(c(o,n))return Q(e,r.arguments[t+1]);{const o=r.arguments.length-t;return 1===o?Q(e,r.arguments[t]):2===o?null:3===o?Q(e,r.arguments[t+2]):be(e,r,t+2,n)}}catch(o){throw o}}function Ue(e,r,t,n){try{if(!0===n)return Q(e,r.arguments[t+1]);if(3===r.arguments.length-t)return Q(e,r.arguments[t+2]);{const n=Q(e,r.arguments[t+2]);if(!1===l(n))throw new Error("WHEN needs boolean test conditions");return Ue(e,r,t+2,n)}}catch(o){throw o}}function Ae(e,r){const t=e.length,n=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:Ce(Ae(e.slice(0,n),r),Ae(e.slice(n,t),r),r)}function Ce(e,r,t){const n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){let o=t(e[0],r[0]);isNaN(o)&&(o=0),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}function Me(e,r,t){try{const n=e.body;if(t.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(let a=0;a<t.length;a++)r.localScope[e.params[a].name.toLowerCase()]={value:t[a],valueset:!0,node:null};const o=Q(r,n);if(o instanceof f)return o.value;if(o===w)throw new Error("Cannot Break from a Function");if(o===m)throw new Error("Cannot Continue from a Function");return o instanceof p?o.value:o}catch(n){throw n}}function xe(e,r,t){return J(e,r,(function(r,n,o){const a={spatialReference:e.spatialReference,globalScope:e.globalScope,depthCounter:e.depthCounter+1,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return Me(t,a,o)}))}function Fe(e){return function(){const r={spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,localScope:{},depthCounter:e.context.depthCounter+1,globalScope:e.context.globalScope};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return Me(e.definition,r,arguments)}}L(Oe,J),j(Oe,J),Y(Oe,J),V(Oe,J),_(Oe,J),B(Oe,J),k(Oe,J),Oe.typeof=function(e,r){return J(e,r,(function(e,r,t){s(t,1,1);const n=Se(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},Oe.iif=function(e,r){try{s(null===r.arguments?[]:r.arguments,3,3);const t=Q(e,r.arguments[0]);if(!1===l(t))throw new Error("IF Function must have a boolean test condition");const n=Q(e,r.arguments[1]),o=Q(e,r.arguments[2]);return!0===t?n:o}catch(t){throw t}},Oe.decode=function(e,r){try{if(r.arguments.length<2)throw new Error("Missing Parameters");if(2===r.arguments.length)return Q(e,r.arguments[1]);{if((r.arguments.length-1)%2==0)throw new Error("Must have a default value result.");const t=Q(e,r.arguments[0]);return be(e,r,1,t)}}catch(t){throw t}},Oe.when=function(e,r){try{if(r.arguments.length<3)throw new Error("Missing Parameters");if(r.arguments.length%2==0)throw new Error("Must have a default value result.");const t=Q(e,r.arguments[0]);if(!1===l(t))throw new Error("WHEN needs boolean test conditions");return Ue(e,r,0,t)}catch(t){throw t}},Oe.top=function(e,r){return J(e,r,(function(e,r,t){if(s(t,2,2),g(t[0]))return y(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,y(t[1]));if(N(t[0]))return y(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,y(t[1]));throw new Error("Top cannot accept this parameter type")}))},Oe.first=function(e,r){return J(e,r,(function(e,r,t){return s(t,1,1),g(t[0])?0===t[0].length?null:t[0][0]:N(t[0])?0===t[0].length()?null:t[0].get(0):null}))},Oe.sort=function(e,r){return J(e,r,(function(e,r,t){s(t,1,2);let n=t[0];if(N(n)&&(n=n.toArray()),!1===g(n))throw new Error("Illegal Argument");if(t.length>1){if(!1===E(t[1]))throw new Error("Illegal Argument");let e=n;const r=Fe(t[1]);return e=Ae(e,(function(e,t){return r(e,t)})),e}{let e=n;if(0===e.length)return[];const r={};for(let n=0;n<e.length;n++){const t=Se(e[n]);""!==t&&(r[t]=!0)}if(!0===r.Array||!0===r.Dictionary||!0===r.Feature||!0===r.Point||!0===r.Polygon||!0===r.Polyline||!0===r.Multipoint||!0===r.Extent||!0===r.Function)return e.slice(0);let t=0,o="";for(const n in r)t++,o=n;return e=t>1||"String"===o?Ae(e,(function(e,r){if(null==e||e===h)return null==r||r===h?0:1;if(null==r||r===h)return-1;const t=v(e),n=v(r);return t<n?-1:t===n?0:1})):"Number"===o?Ae(e,(function(e,r){return e-r})):"Boolean"===o?Ae(e,(function(e,r){return e===r?0:r?-1:1})):"Date"===o?Ae(e,(function(e,r){return r-e})):e.slice(0),e}}))};for(const qe in Oe)Oe[qe]={value:new u(Oe[qe]),valueset:!0,node:null};const Pe=function(){};function De(e,r){const o=new Pe;e||(e={}),r||(r={});const a=new t({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,o.textformatting={value:a,valueset:!0,node:null};for(const t in r)o[t]={value:new u(r[t]),native:!0,valueset:!0,node:null};for(const t in e)e[t]&&"esri.Graphic"===e[t].declaredClass?o[t]={value:n.createFromGraphic(e[t]),valueset:!0,node:null}:o[t]={value:e[t],valueset:!0,node:null};return o}Pe.prototype=Oe,Pe.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Pe.prototype.pi={value:Math.PI,valueset:!0,node:null};const Le={fixSpatialReference:O,parseArguments:X,standardFunction:J};function je(e){console.log(e)}function _e(e){const r={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:J,evaluateIdentifier:Te,arcadeCustomFunctionHandler:Fe};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const t in r.functions)Oe[t]={value:new u(r.functions[t]),valueset:!0,node:null},Pe.prototype[t]=Oe[t];for(let t=0;t<r.signatures.length;t++)A(r.signatures[t],"async")}function ke(e,r){let t=r.spatialReference;null==t&&(t=new K({wkid:102100}));let n=Q({spatialReference:t,globalScope:De(r.vars,r.customfunctions),localScope:null,console:r.console?r.console:je,lrucache:r.lrucache,interceptor:r.interceptor,depthCounter:1},e.body[0].body);if(n instanceof f&&(n=n.value),n instanceof p&&(n=n.value),n===h&&(n=null),n===w)throw new Error("Cannot return BREAK");if(n===m)throw new Error("Cannot return CONTINUE");if(n instanceof o)throw new Error("Cannot return FUNCTION");if(n instanceof u)throw new Error("Cannot return FUNCTION");return n}function Ve(e,r){return C(e)}function Be(e,r){return M(e,r,"simple")}function Ye(e,r){return x(e,r)}function Ge(e,r){return F(e,r)}function ze(e){return P(e)}export{ke as executeScript,_e as extend,Ve as extractFieldLiterals,ze as findFunctionCalls,Le as functionHelper,Ge as referencesFunction,Ye as referencesMember,Be as validateScript};
