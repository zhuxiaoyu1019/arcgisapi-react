/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import s from"./Accessor.js";import e from"./Logger.js";import{runTracked as a}from"./accessorSupport/tracking.js";import{subclass as r}from"./accessorSupport/decorators/subclass.js";import{SimpleTrackingTarget as n}from"./accessorSupport/tracking/SimpleTrackingTarget.js";const c=s=>{let a=class extends s{constructor(){super(...arguments),this.asyncUpdateState=new Map}autoUpdateAsync(t,s){return o((s=>this.updateAsync(t,s)),s)}async updateAsync(t,s){if(!this.startAsyncUpdate(t)){try{const e=await s();this._set(t,e)}catch(a){e.getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(t)&&this.updateAsync(t,s)}}startAsyncUpdate(t){var s;const e=null!=(s=this.asyncUpdateState.get(t))?s:0;return 1&e?(this.asyncUpdateState.set(t,2|e),!0):(this.asyncUpdateState.set(t,1|e),!1)}endAsyncUpdate(t){var s;const e=-2&(null!=(s=this.asyncUpdateState.get(t))?s:0);return 2&e?(this.asyncUpdateState.set(t,-3&e),!0):(this.asyncUpdateState.set(t,e),!1)}};return a=t([r("esri.core.AsyncUpdate")],a),a};function o(t,s){const e=()=>{o&&!p&&t(r)},r=()=>{if(!o||p)return s();o.clear(),p=!0;const t=a(o,s);return p=!1,t},c=()=>{o&&(o.destroy(),o=null)};let o=new n(e),p=!1;return t(r),{remove:c}}let p=class extends(c(s)){};p=t([r("esri.core.AsyncUpdate")],p);export{p as AsyncUpdate,c as AsyncUpdateMixin};
