/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{nullifyNonnullableForDispose as t}from"./maybe.js";import e from"./nextTick.js";import{a as s}from"../chunks/mat3f64.js";import{a as i}from"../chunks/mat4f64.js";import{c as r}from"../chunks/quatf64.js";import{c as f}from"../chunks/vec2f64.js";import{b as h}from"../chunks/vec3f64.js";import{a as m}from"../chunks/vec4f64.js";class a{constructor(t,s,i){this.itemByteSize=t,this.itemCreate=s,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(i/this.itemByteSize),this.tickHandle=e.before((()=>this.reset()))}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=t(this.tickHandle)),this.itemsPtr=0,this.items=t(this.items),this.buffers=t(this.buffers)}get(){0===this.itemsPtr&&e((()=>{}));const t=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=t;){const t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let e=0;e<this.itemsPerBuffer;++e)this.items.push(this.itemCreate(t,e*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]}reset(){const t=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>t;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0}static createVec2f64(t=c){return new a(16,f,t)}static createVec3f64(t=c){return new a(24,h,t)}static createVec4f64(t=c){return new a(32,m,t)}static createMat3f64(t=c){return new a(72,s,t)}static createMat4f64(t=c){return new a(128,i,t)}static createQuatf64(t=c){return new a(32,r,t)}get test(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}const c=4096;export{a as VectorStack};
