/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"../request.js";import{createQueryParamsHelper as r}from"../core/queryUtils.js";import{normalizeCentralMeridian as t}from"../geometry/support/normalizeUtils.js";import{collectGeometries as s,isInputGeometryZAware as o,fetchServiceDescription as i,dropZValuesOffInputGeometry as a,handleSolveResponse as n}from"./networkService.js";import{parseUrl as u}from"./utils.js";const p=r({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});async function m(r,m,l){const c=[],f=[],y={},B={},h=u(r);return m.stops&&m.stops.features&&s(m.stops.features,f,"stops.features",y),m.pointBarriers&&m.pointBarriers.features&&s(m.pointBarriers.features,f,"pointBarriers.features",y),m.polylineBarriers&&m.polylineBarriers.features&&s(m.polylineBarriers.features,f,"polylineBarriers.features",y),m.polygonBarriers&&m.polygonBarriers.features&&s(m.polygonBarriers.features,f,"polygonBarriers.features",y),t(f).then((e=>{for(const r in y){const t=y[r];c.push(r),B[r]=e.slice(t[0],t[1])}return o(B,c)?i(h.path):Promise.resolve({dontCheck:!0})})).then((r=>{("dontCheck"in r?r.dontCheck:r.hasZ)||a(B,c);for(const e in B)B[e].forEach(((r,t)=>{m.get(e)[t].geometry=r}));const t={...l,query:{...h.query,...p.toQueryParams(m),f:"json"}},{path:s}=h,o="/solve",i=s.endsWith(o)?s:s+o;return e(i,t)})).then((e=>n(e)))}export{m as solve};
