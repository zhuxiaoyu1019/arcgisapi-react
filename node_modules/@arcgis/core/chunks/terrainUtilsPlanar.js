/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{g as t,f as o,d as n,b as r,a as s}from"./vec3.js";import{c as i}from"./vec3f64.js";import{containsPoint as a,containsPointWithMargin as l,fromExtent as c,create as u}from"../geometry/support/aaBoundingRect.js";import{MAX_ROOT_TILES as f}from"../views/3d/terrain/TerrainConst.js";import m from"../views/3d/terrain/TilingScheme.js";const h=i(),p=i(),g=i(),d=i();function M(e,t,o=0){const n=e.extent;if(0===o)return a(n,t);const r=Math.min(n[2]-n[0],n[3]-n[1]);return l(n,t,o*r)}function v(e,i,a,l){t(h,a),h[l]=i[l];const c=o(h,h,i),u=o(p,e,i),f=n(u,c),m=n(c,c);let g;g=f<=0?i:m<=f?a:r(h,i,s(c,c,f/m));const d=o(h,e,g);return Math.PI/2-Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))}function x(e,t,o){const n=e.extent;g[0]=n[0],g[1]=n[1],g[2]=o,d[0]=n[2],d[1]=n[3],d[2]=o;let r=1/0,s=1/0;return t[0]<g[0]?r=v(t,g,d,0):t[0]>d[0]&&(r=v(t,d,g,0)),t[1]<g[1]?s=v(t,g,d,1):t[1]>d[1]&&(s=v(t,d,g,1)),Math.min(r,s)}function S(t,o,n){if(t.spatialReference.isGeographic)return new e("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");const r=m.checkUnsupported(t);if(r)return r;const s=w(t,n);return s||(o&&!t.spatialReference.equals(o)?new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}function w(t,o){const n=t.lods,r=n[0].resolution*2**n[0].level,s=[r*t.size[0],r*t.size[1]],i=[t.origin.x,t.origin.y],a=c(o),l=u();m.computeRowColExtent(a,s,i,l);const h=(l[2]-l[0])*(l[3]-l[1]);if(h>f){const o=n[0].scale*2**n[0].level;let s=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*o/r;const i=Math.floor(Math.log(s)/Math.log(10));return s=Math.ceil(s/10**i)*10**i,new e("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(o).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+s.toLocaleString()+".",{level0Scale:o,suggestedLevel0Scale:s,requiredNumRootTiles:h,allowedNumRootTiles:f})}return null}var j=Object.freeze({__proto__:null,isInsideExtent:M,tiltToExtentEdge:x,checkIfTileInfoSupportedForViewSR:S});export{x as a,S as c,M as i,j as t};
