/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{compileScript as e,extend as t,enableAsyncSupport as r}from"../arcade/arcadeCompiler.js";import{extend as n,executeScript as s,referencesMember as i,referencesFunction as c}from"../arcade/arcadeRuntime.js";import{M as u}from"./languageUtils.js";import{parseScript as o,validateScript as a,scriptCheck as f,extractFieldLiterals as p}from"../arcade/parser.js";import{findScriptDependencies as l,findFunctionCalls as m}from"../arcade/treeAnalysis.js";import d from"../core/has.js";import{all as y,create as S}from"../core/promiseUtils.js";import{loadMoment as h}from"../intl/moment.js";const b=["feature","angle","bearing","centroid","envelopeintersects","extent","geometry","isselfintersecting","ringisclockwise"];function g(){if(d("csp-restrictions"))return!1;try{return new Function("function* test() {}; return true")()}catch(e){return!1}}const j=g();let A=!1,x=!1,F=null,E=[];function v(t,r){if(!0===r.useAsync||!0===t.isAsync)return w(t,r);if(d("csp-restrictions")){return function(e){return s(t,e)}}return e(t,r)}function w(t,r){if(null===F)throw new Error("Async Arcade must be enabled for this script");if(d("csp-restrictions")||!1===j){return function(e){return F.executeScript(t,e)}}return e(t,r,!0)}function G(e){n(e),t(e,"sync"),null===F?E.push(e):(t(e,"async"),F.extend(e))}function U(e,t=[]){return o(e,t)}function k(e,t,r=""){return a(e,t,r)}function M(e,t,r,n=""){return f(e,t,r,n)}function _(e,t,r=[]){return C(o(e,r),t)}function C(e,t){if(!0===t.useAsync||!0===e.isAsync){if(null===F)throw new Error("Async Arcade must be enabled for this script");return F.executeScript(e,t)}return s(e,t)}function L(e,t){return i(e,t)}function O(e,t){return c(e,t)}function R(e,t=!1){return p(e)}function q(e,t=[]){return void 0===e.usesGeometry&&l(e,t),!0===e.usesGeometry}let z=null;function D(){return z||(z=y([import("../geometry/geometryEngine.js"),import("../arcade/functions/geomsync.js")]).then((([e,t])=>(x=!0,t.setGeometryEngine(e),!0))),z)}let I=null;function T(){return null!==I||(I=r().then((()=>import("../arcade/arcadeAsyncRuntime.js"))).then((e=>{F=e;for(const r of E)F.extend(r),t(r,"async");return E=null,!0}))),I}function B(){return A}function H(){return!!F}function J(){return x}let K=null;function N(){return K||(K=T().then((()=>y([import("../arcade/featureSetUtils.js"),import("../arcade/functions/featuresetbase.js"),import("../arcade/functions/featuresetgeom.js"),import("../arcade/functions/featuresetstats.js"),import("../arcade/functions/featuresetstring.js")]).then((([e,r,n,s,i])=>(Y=e,F.extend([r,n,s,i]),t([r,n,s,i],"async"),A=!0,!0))))),K)}function P(e,t=[]){return void 0===e.usesFeatureSet&&l(e,t),!0===e.usesFeatureSet}function Q(e,t=[]){return void 0===e.isAsync&&l(e,t),!0===e.isAsync}function V(e,t){if(t){for(const r of t)if(L(e,r))return!0;return!1}return!1}function W(e,t,r=[],n=!1){return S(((s,i)=>{const c="string"==typeof e?U(e):e,u=[];u.push($()),c&&(!1===J()&&(q(c)||n)&&u.push(D()),!1===H()&&(!0===c.isAsync||t)&&u.push(T()),!1===B()&&(P(c)||V(c,r))&&u.push(N())),u?y(u).then((()=>{s(!0)}),i):s(!0)}))}function X(e){if(q(e))return!0;const t=m(e);let r=!1;for(let n=0;n<t.length;n++)if(b.indexOf(t[n])>-1){r=!0;break}return r}let Y=null;function Z(){return Y}function $(){return null!==ee||(ee=h().then((e=>(u.Moment=e,!0)))),ee}let ee=null;var te=Object.freeze({__proto__:null,compileScript:v,extend:G,parseScript:U,validateScript:k,scriptCheck:M,parseAndExecuteScript:_,executeScript:C,referencesMember:L,referencesFunction:O,extractFieldLiterals:R,scriptUsesGeometryEngine:q,enableGeometrySupport:D,enableAsyncSupport:T,isFeatureSetSupportEnabled:B,isAsyncEnabled:H,isGeometryEnabled:J,enableFeatureSetSupport:N,scriptUsesFeatureSet:P,scriptIsAsync:Q,loadScriptDependencies:W,scriptTouchesGeometry:X,featureSetUtils:Z,load:$});export{R as a,D as b,v as c,N as d,C as e,Z as f,q as g,te as h,G as i,M as j,_ as k,W as l,O as m,T as n,B as o,U as p,H as q,L as r,X as s,J as t,P as u,k as v,Q as w,$ as x};
