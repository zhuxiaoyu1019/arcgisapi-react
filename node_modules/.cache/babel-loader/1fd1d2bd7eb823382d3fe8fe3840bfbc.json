{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport t from \"../config.js\";\nimport { id as s } from \"../kernel.js\";\nimport r from \"../request.js\";\nimport i from \"../core/Error.js\";\nimport n from \"../core/Evented.js\";\nimport { on as o } from \"../core/events.js\";\nimport a from \"../core/global.js\";\nimport { fixJson as h } from \"../core/lang.js\";\nimport { getDeepValue as l } from \"../core/object.js\";\nimport { createAbortController as c, createResolver as d, onAbort as u, isAborted as p } from \"../core/promiseUtils.js\";\nimport { urlToObject as _, hasSameOrigin as g, Url as f, queryToObject as m, normalize as v, getProxyRule as S, makeAbsolute as w, objectToQuery as I } from \"../core/urlUtils.js\";\nimport { property as k } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport \"../core/has.js\";\nimport \"../core/Logger.js\";\nimport { subclass as A } from \"../core/accessorSupport/decorators/subclass.js\";\nimport y from \"./IdentityForm.js\";\nimport U from \"./IdentityModal.js\";\nimport T from \"./OAuthCredential.js\";\nimport x from \"./OAuthInfo.js\";\nimport O from \"./ServerInfo.js\";\n\nconst R = {},\n      b = e => {\n  const t = new f(e.owningSystemUrl).host,\n        s = new f(e.server).host,\n        r = /.+\\.arcgis\\.com$/i;\n  return r.test(t) && r.test(s);\n},\n      P = (e, t) => !!(b(e) && t && t.some(t => t.test(e.server)));\n\nlet C = null,\n    D = null;\n\ntry {\n  C = window.localStorage, D = window.sessionStorage;\n} catch {}\n\nclass q extends n {\n  constructor() {\n    super(), this._portalConfig = a.esriGeowConfig, this.serverInfos = [], this.oAuthInfos = [], this.credentials = [], this._soReqs = [], this._xoReqs = [], this._portals = [], this.defaultOAuthInfo = null, this.defaultTokenValidity = 60, this.dialog = null, this.formConstructor = y, this.tokenValidity = null, this.normalizeWebTierAuth = !1, this._appOrigin = \"null\" !== window.origin ? window.origin : window.location.origin, this._appUrlObj = _(window.location.href), this._busy = null, this._rejectOnPersistedPageShow = !1, this._oAuthHash = null, this._gwTokenUrl = \"/sharing/rest/generateToken\", this._agsRest = \"/rest/services\", this._agsPortal = /\\/sharing(\\/|$)/i, this._agsAdmin = /(https?:\\/\\/[^\\/]+\\/[^\\/]+)\\/admin\\/?(\\/.*)?$/i, this._adminSvcs = /\\/rest\\/admin\\/services(\\/|$)/i, this._gwDomains = [{\n      regex: /^https?:\\/\\/www\\.arcgis\\.com/i,\n      customBaseUrl: \"maps.arcgis.com\",\n      tokenServiceUrl: \"https://www.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/(?:dev|[a-z\\d-]+\\.mapsdev)\\.arcgis\\.com/i,\n      customBaseUrl: \"mapsdev.arcgis.com\",\n      tokenServiceUrl: \"https://dev.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/(?:devext|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,\n      customBaseUrl: \"mapsdevext.arcgis.com\",\n      tokenServiceUrl: \"https://devext.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/(?:qaext|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i,\n      customBaseUrl: \"mapsqa.arcgis.com\",\n      tokenServiceUrl: \"https://qaext.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/[a-z\\d-]+\\.maps\\.arcgis\\.com/i,\n      customBaseUrl: \"maps.arcgis.com\",\n      tokenServiceUrl: \"https://www.arcgis.com/sharing/rest/generateToken\"\n    }], this._legacyFed = [], this._regexSDirUrl = /http.+\\/rest\\/services\\/?/gi, this._regexServerType = /(\\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi, this._gwUser = /http.+\\/users\\/([^\\/]+)\\/?.*/i, this._gwItem = /http.+\\/items\\/([^\\/]+)\\/?.*/i, this._gwGroup = /http.+\\/groups\\/([^\\/]+)\\/?.*/i, this._rePortalTokenSvc = /\\/sharing(\\/rest)?\\/generatetoken/i, this._createDefaultOAuthInfo = !0, this._hasTestedIfAppIsOnPortal = !1, this._getOAuthHash(), window.addEventListener(\"pageshow\", e => {\n      this._pageShowHandler(e);\n    });\n  }\n\n  registerServers(e) {\n    const t = this.serverInfos;\n    t ? (e = e.filter(e => !this.findServerInfo(e.server)), this.serverInfos = t.concat(e)) : this.serverInfos = e, e.forEach(e => {\n      e.owningSystemUrl && this._portals.push(e.owningSystemUrl), e.hasPortal && this._portals.push(e.server);\n    });\n  }\n\n  registerOAuthInfos(e) {\n    const t = this.oAuthInfos;\n\n    if (t) {\n      for (const s of e) {\n        const e = this.findOAuthInfo(s.portalUrl);\n        e && t.splice(t.indexOf(e), 1);\n      }\n\n      this.oAuthInfos = t.concat(e);\n    } else this.oAuthInfos = e;\n  }\n\n  registerToken(e) {\n    e = { ...e\n    };\n\n    const t = this._sanitizeUrl(e.server),\n          s = this._isServerRsrc(t);\n\n    let r,\n        i = this.findServerInfo(t),\n        n = !0;\n    i || (i = new O(), i.server = this._getServerInstanceRoot(t), s ? i.hasServer = !0 : (i.tokenServiceUrl = this._getTokenSvcUrl(t), i.hasPortal = !0), this.registerServers([i])), r = this._findCredential(t), r ? (delete e.server, Object.assign(r, e), n = !1) : (r = new j({\n      userId: e.userId,\n      server: i.server,\n      token: e.token,\n      expires: e.expires,\n      ssl: e.ssl,\n      scope: s ? \"server\" : \"portal\"\n    }), r.resources = [t], this.credentials.push(r)), r.emitTokenChange(!1), n || r.refreshServerTokens();\n  }\n\n  toJSON() {\n    return h({\n      serverInfos: this.serverInfos.map(e => e.toJSON()),\n      oAuthInfos: this.oAuthInfos.map(e => e.toJSON()),\n      credentials: this.credentials.map(e => e.toJSON())\n    });\n  }\n\n  initialize(e) {\n    if (!e) return;\n    \"string\" == typeof e && (e = JSON.parse(e));\n    const t = e.serverInfos,\n          s = e.oAuthInfos,\n          r = e.credentials;\n\n    if (t) {\n      const e = [];\n      t.forEach(t => {\n        t.server && t.tokenServiceUrl && e.push(t.declaredClass ? t : new O(t));\n      }), e.length && this.registerServers(e);\n    }\n\n    if (s) {\n      const e = [];\n      s.forEach(t => {\n        t.appId && e.push(t.declaredClass ? t : new x(t));\n      }), e.length && this.registerOAuthInfos(e);\n    }\n\n    r && r.forEach(e => {\n      e.server && e.token && e.expires && e.expires > Date.now() && ((e = e.declaredClass ? e : new j(e)).emitTokenChange(), this.credentials.push(e));\n    });\n  }\n\n  findServerInfo(e) {\n    let t;\n    e = this._sanitizeUrl(e);\n\n    for (const s of this.serverInfos) if (this._hasSameServerInstance(s.server, e)) {\n      t = s;\n      break;\n    }\n\n    return t;\n  }\n\n  findOAuthInfo(e) {\n    let t;\n    e = this._sanitizeUrl(e);\n\n    for (const s of this.oAuthInfos) if (this._hasSameServerInstance(s.portalUrl, e)) {\n      t = s;\n      break;\n    }\n\n    return t;\n  }\n\n  findCredential(e, t) {\n    let s;\n    e = this._sanitizeUrl(e);\n    const r = this._isServerRsrc(e) ? \"server\" : \"portal\";\n\n    if (t) {\n      for (const i of this.credentials) if (this._hasSameServerInstance(i.server, e) && t === i.userId && i.scope === r) {\n        s = i;\n        break;\n      }\n    } else for (const i of this.credentials) if (this._hasSameServerInstance(i.server, e) && -1 !== this._getIdenticalSvcIdx(e, i) && i.scope === r) {\n      s = i;\n      break;\n    }\n\n    return s;\n  }\n\n  getCredential(e, t) {\n    let s,\n        r,\n        n = !0;\n    t && (s = !!t.token, r = t.error, n = !1 !== t.prompt), t = { ...t\n    }, e = this._sanitizeUrl(e);\n    const o = c(),\n          a = d();\n    if (t.signal && u(t.signal, () => {\n      o.abort();\n    }), u(o, () => {\n      a.reject(new i(\"identity-manager:user-aborted\", \"ABORTED\"));\n    }), p(o)) return a.promise;\n    t.signal = o.signal;\n\n    const h = this._isAdminResource(e),\n          l = s ? this.findCredential(e) : null;\n\n    let _;\n\n    if (l && r && r.details && 498 === r.details.httpStatus) l.destroy();else if (l) return _ = new i(\"identity-manager:not-authorized\", \"You are currently signed in as: '\" + l.userId + \"'. You do not have access to this resource: \" + e, {\n      error: r\n    }), a.reject(_), a.promise;\n\n    const f = this._findCredential(e, t);\n\n    if (f) return a.resolve(f), a.promise;\n    let m = this.findServerInfo(e);\n    if (m) !m.hasServer && this._isServerRsrc(e) && (m._restInfoPms = this._getTokenSvcUrl(e), m.hasServer = !0);else {\n      const t = this._getTokenSvcUrl(e);\n\n      if (!t) return _ = new i(\"identity-manager:unknown-resource\", \"Unknown resource - could not find token service endpoint.\"), a.reject(_), a.promise;\n      m = new O(), m.server = this._getServerInstanceRoot(e), \"string\" == typeof t ? (m.tokenServiceUrl = t, m.hasPortal = !0) : (m._restInfoPms = t, m.hasServer = !0), this.registerServers([m]);\n    }\n    return m.hasPortal && void 0 === m._selfReq && (n || g(m.tokenServiceUrl, this._appOrigin) || this._gwDomains.some(e => e.tokenServiceUrl === m.tokenServiceUrl)) && (m._selfReq = {\n      owningTenant: t && t.owningTenant,\n      selfDfd: this._getPortalSelf(m.tokenServiceUrl.replace(this._rePortalTokenSvc, \"/sharing/rest/portals/self\"), e)\n    }), this._enqueue(e, m, t, a, h);\n  }\n\n  getResourceName(e) {\n    return this._isRESTService(e) ? e.replace(this._regexSDirUrl, \"\").replace(this._regexServerType, \"\") || \"\" : this._gwUser.test(e) && e.replace(this._gwUser, \"$1\") || this._gwItem.test(e) && e.replace(this._gwItem, \"$1\") || this._gwGroup.test(e) && e.replace(this._gwGroup, \"$1\") || \"\";\n  }\n\n  generateToken(e, t, s) {\n    const n = this._rePortalTokenSvc.test(e.tokenServiceUrl),\n          o = new f(this._appOrigin),\n          a = e.shortLivedTokenValidity;\n\n    let h, l, c, d, u, p, _, m;\n\n    t && (m = this.tokenValidity || a || this.defaultTokenValidity, m > a && a > 0 && (m = a)), s && (h = s.isAdmin, l = s.serverUrl, c = s.token, p = s.signal, _ = s.ssl, e.customParameters = s.customParameters), h ? d = e.adminTokenServiceUrl : (d = e.tokenServiceUrl, u = new f(d.toLowerCase()), e.webTierAuth && null != s && s.serverUrl && !_ && \"http\" === o.scheme && (g(o.uri, d, !0) || \"https\" === u.scheme && o.host === u.host && \"7080\" === o.port && \"7443\" === u.port) && (d = d.replace(/^https:/i, \"http:\").replace(/:7443/i, \":7080\")));\n    const v = {\n      query: {\n        request: \"getToken\",\n        username: null == t ? void 0 : t.username,\n        password: null == t ? void 0 : t.password,\n        serverUrl: l,\n        token: c,\n        expiration: m,\n        referer: h || n ? this._appOrigin : null,\n        client: h ? \"referer\" : null,\n        f: \"json\",\n        ...e.customParameters\n      },\n      method: \"post\",\n      authMode: \"anonymous\",\n      useProxy: this._useProxy(e, s),\n      signal: p,\n      ...(null == s ? void 0 : s.ioArgs)\n    };\n    n || (v.withCredentials = !1);\n    return r(d, v).then(s => {\n      const r = s.data;\n      if (!r || !r.token) return new i(\"identity-manager:authentication-failed\", \"Unable to generate token\");\n      const n = e.server;\n      return R[n] || (R[n] = {}), t && (R[n][t.username] = t.password), r.validity = m, r;\n    });\n  }\n\n  isBusy() {\n    return !!this._busy;\n  }\n\n  checkSignInStatus(e) {\n    return this.checkAppAccess(e, \"\").then(e => e.credential);\n  }\n\n  checkAppAccess(e, t, s) {\n    let n = !1;\n    return this.getCredential(e, {\n      prompt: !1\n    }).then(o => {\n      let a;\n      const h = {\n        f: \"json\"\n      };\n      if (\"portal\" === o.scope) {\n        if (t && (this._doPortalSignIn(e) || s && s.force)) a = o.server + \"/sharing/rest/oauth2/validateAppAccess\", h.client_id = t;else {\n          if (!o.token) return {\n            credential: o\n          };\n          a = o.server + \"/sharing/rest\";\n        }\n      } else {\n        if (!o.token) return {\n          credential: o\n        };\n        a = o.server + \"/rest/services\";\n      }\n      return o.token && (h.token = o.token), r(a, {\n        query: h,\n        authMode: \"anonymous\"\n      }).then(e => {\n        if (!1 === e.data.valid) throw new i(\"identity-manager:not-authorized\", `You are currently signed in as: '${o.userId}'.`, e.data);\n        return n = !!e.data.viewOnlyUserTypeApp, {\n          credential: o\n        };\n      }).catch(e => {\n        if (\"identity-manager:not-authorized\" === e.name) throw e;\n        const t = e.details && e.details.httpStatus;\n        if (498 === t) throw o.destroy(), new i(\"identity-manager:not-authenticated\", \"User is not signed in.\");\n        if (400 === t) throw new i(\"identity-manager:invalid-request\");\n        return {\n          credential: o\n        };\n      });\n    }).then(e => ({\n      credential: e.credential,\n      viewOnly: n\n    }));\n  }\n\n  setOAuthResponseHash(e) {\n    var t;\n    const s = this._oAuthDfd;\n    if (this._oAuthDfd = null, !s || !e) return;\n    clearInterval(this._oAuthIntervalId), null == (t = this._oAuthOnHashHandle) || t.remove(), \"#\" === e.charAt(0) && (e = e.substring(1));\n    const r = m(e);\n\n    if (r.error) {\n      const e = \"access_denied\" === r.error,\n            t = new i(e ? \"identity-manager:user-aborted\" : \"identity-manager:authentication-failed\", e ? \"ABORTED\" : \"OAuth: \" + r.error + \" - \" + r.error_description);\n      s.reject(t);\n    } else {\n      const e = s.sinfo_,\n            t = s.oinfo_,\n            i = t._oAuthCred,\n            n = new j({\n        userId: r.username,\n        server: e.server,\n        token: r.access_token,\n        expires: Date.now() + 1e3 * Number(r.expires_in),\n        ssl: \"true\" === r.ssl,\n        _oAuthCred: i\n      });\n      t.userId = n.userId, i.storage = r.persist ? C : D, i.token = n.token, i.expires = n.expires, i.userId = n.userId, i.ssl = n.ssl, i.save(), s.resolve(n);\n    }\n  }\n\n  setOAuthRedirectionHandler(e) {\n    this._oAuthRedirectFunc = e;\n  }\n\n  setProtocolErrorHandler(e) {\n    this._protocolFunc = e;\n  }\n\n  signIn(e, t, s = {}) {\n    const r = d(),\n          n = () => {\n      var e, t, s, r, i;\n      null == (e = h) || e.remove(), null == (t = l) || t.remove(), null == (s = c) || s.remove(), null == (r = a) || r.destroy(), null == (i = this.dialog) || i.destroy(), this.dialog = a = h = l = c = null;\n    },\n          o = () => {\n      n(), this._oAuthDfd = null, r.reject(new i(\"identity-manager:user-aborted\", \"ABORTED\"));\n    };\n\n    s.signal && u(s.signal, () => {\n      o();\n    });\n    let a = new this.formConstructor();\n    a.resource = this.getResourceName(e), a.server = t.server, this.dialog = new U(), this.dialog.content = a, this.dialog.open = !0, this.emit(\"dialog-create\");\n    let h = a.on(\"cancel\", o),\n        l = this.dialog.watch(\"open\", o),\n        c = a.on(\"submit\", e => {\n      this.generateToken(t, e, {\n        isAdmin: s.isAdmin,\n        signal: s.signal\n      }).then(i => {\n        n();\n        const o = new j({\n          userId: e.username,\n          server: t.server,\n          token: i.token,\n          expires: null != i.expires ? Number(i.expires) : null,\n          ssl: !!i.ssl,\n          isAdmin: s.isAdmin,\n          validity: i.validity\n        });\n        r.resolve(o);\n      }).catch(e => {\n        a.error = e, a.signingIn = !1;\n      });\n    });\n    return r.promise;\n  }\n\n  oAuthSignIn(e, t, s, r) {\n    this._oAuthDfd = d();\n    const n = this._oAuthDfd;\n    null != r && r.signal && u(r.signal, () => {\n      const e = this._oAuthDfd && this._oAuthDfd.oAuthWin_;\n      e && !e.closed ? e.close() : this.dialog && h();\n    }), n.resUrl_ = e, n.sinfo_ = t, n.oinfo_ = s;\n    const o = !r || !1 !== r.oAuthPopupConfirmation;\n    if (!s.popup || !o) return this._doOAuthSignIn(e, t, s), n.promise;\n    const a = new this.formConstructor();\n    a.oAuthPrompt = !0, a.server = t.server, this.dialog = new U(), this.dialog.content = a, this.dialog.open = !0, this.emit(\"dialog-create\");\n\n    const h = () => {\n      _(), this._oAuthDfd = null, n.reject(new i(\"identity-manager:user-aborted\", \"ABORTED\"));\n    },\n          l = a.on(\"cancel\", h),\n          c = this.dialog.watch(\"open\", h),\n          p = a.on(\"submit\", () => {\n      _(), this._doOAuthSignIn(e, t, s);\n    }),\n          _ = () => {\n      l.remove(), c.remove(), p.remove(), a.destroy(), this.dialog.destroy(), this.dialog = null;\n    };\n\n    return n.promise;\n  }\n\n  destroyCredentials() {\n    if (this.credentials) {\n      this.credentials.slice().forEach(e => {\n        e.destroy();\n      });\n    }\n\n    this.emit(\"credentials-destroy\");\n  }\n\n  enablePostMessageAuth(e = \"https://www.arcgis.com/sharing/rest\") {\n    this._postMessageAuthHandle && this._postMessageAuthHandle.remove(), this._postMessageAuthHandle = o(window, \"message\", t => {\n      var s;\n\n      if ((t.origin === this._appOrigin || t.origin.endsWith(\".arcgis.com\")) && \"arcgis:auth:requestCredential\" === (null == (s = t.data) ? void 0 : s.type)) {\n        const s = t.source;\n        this.getCredential(e).then(e => {\n          s.postMessage({\n            type: \"arcgis:auth:credential\",\n            credential: {\n              expires: e.expires,\n              server: e.server,\n              ssl: e.ssl,\n              token: e.token,\n              userId: e.userId\n            }\n          }, t.origin);\n        }).catch(e => {\n          s.postMessage({\n            type: \"arcgis:auth:error\",\n            error: {\n              name: e.name,\n              message: e.message\n            }\n          }, t.origin);\n        });\n      }\n    });\n  }\n\n  disablePostMessageAuth() {\n    this._postMessageAuthHandle && (this._postMessageAuthHandle.remove(), this._postMessageAuthHandle = null);\n  }\n\n  _getOAuthHash() {\n    let e = window.location.hash;\n\n    if (e) {\n      \"#\" === e.charAt(0) && (e = e.substring(1));\n      const t = m(e);\n      let s = !1;\n      if (t.access_token && t.expires_in && t.state && t.hasOwnProperty(\"username\")) try {\n        t.state = JSON.parse(t.state), \"object\" == typeof t.state && t.state.portalUrl && (this._oAuthHash = t, s = !0);\n      } catch {} else t.error && t.error_description && (console.log(\"IdentityManager OAuth Error: \", t.error, \" - \", t.error_description), \"access_denied\" === t.error && (s = !0));\n      s && (window.location.hash = \"object\" == typeof t.state && t.state.hash || \"\");\n    }\n  }\n\n  _pageShowHandler(e) {\n    if (e.persisted && this.isBusy() && this._rejectOnPersistedPageShow) {\n      const e = new i(\"identity-manager:user-aborted\", \"ABORTED\");\n\n      this._errbackFunc(e);\n    }\n  }\n\n  _findCredential(e, t) {\n    let s,\n        r,\n        i,\n        n,\n        o = -1;\n    const a = t && t.token,\n          h = t && t.resource,\n          l = this._isServerRsrc(e) ? \"server\" : \"portal\",\n          c = this.credentials.filter(t => this._hasSameServerInstance(t.server, e) && t.scope === l);\n    if (e = h || e, c.length) if (1 === c.length) {\n      if (s = c[0], n = this.findServerInfo(s.server), r = n && n.owningSystemUrl, i = r && this.findCredential(r, s.userId), o = this._getIdenticalSvcIdx(e, s), !a) return -1 === o && s.resources.push(e), this._addResource(e, i), s;\n      -1 !== o && (s.resources.splice(o, 1), this._removeResource(e, i));\n    } else {\n      let t, s;\n      if (c.some(a => (s = this._getIdenticalSvcIdx(e, a), -1 !== s && (t = a, n = this.findServerInfo(t.server), r = n && n.owningSystemUrl, i = r && this.findCredential(r, t.userId), o = s, !0))), a) t && (t.resources.splice(o, 1), this._removeResource(e, i));else if (t) return this._addResource(e, i), t;\n    }\n  }\n\n  _findOAuthInfo(e) {\n    let t = this.findOAuthInfo(e);\n    if (!t) for (const s of this.oAuthInfos) if (this._isIdProvider(s.portalUrl, e)) {\n      t = s;\n      break;\n    }\n    return t;\n  }\n\n  _addResource(e, t) {\n    t && -1 === this._getIdenticalSvcIdx(e, t) && t.resources.push(e);\n  }\n\n  _removeResource(e, t) {\n    let s = -1;\n    t && (s = this._getIdenticalSvcIdx(e, t), s > -1 && t.resources.splice(s, 1));\n  }\n\n  _useProxy(e, t) {\n    return t && t.isAdmin && !g(e.adminTokenServiceUrl, this._appOrigin) || !this._isPortalDomain(e.tokenServiceUrl) && \"10.1\" === String(e.currentVersion) && !g(e.tokenServiceUrl, this._appOrigin);\n  }\n\n  _getOrigin(e) {\n    const t = new f(e);\n    return t.scheme + \"://\" + t.host + (null != t.port ? \":\" + t.port : \"\");\n  }\n\n  _getServerInstanceRoot(e) {\n    const t = e.toLowerCase();\n    let s = t.indexOf(this._agsRest);\n    return -1 === s && this._isAdminResource(e) && (s = this._agsAdmin.test(e) ? e.replace(this._agsAdmin, \"$1\").length : e.search(this._adminSvcs)), -1 === s && (s = t.indexOf(\"/sharing\")), -1 === s && \"/\" === t.substr(-1) && (s = t.length - 1), s > -1 ? e.substring(0, s) : e;\n  }\n\n  _hasSameServerInstance(e, t) {\n    return \"/\" === e.substr(-1) && (e = e.slice(0, -1)), e = e.toLowerCase(), t = this._getServerInstanceRoot(t).toLowerCase(), e = this._normalizeAGOLorgDomain(e), t = this._normalizeAGOLorgDomain(t), (e = e.substr(e.indexOf(\":\"))) === (t = t.substr(t.indexOf(\":\")));\n  }\n\n  _normalizeAGOLorgDomain(e) {\n    const t = /^https?:\\/\\/(?:cdn|[a-z\\d-]+\\.maps)\\.arcgis\\.com/i,\n          s = /^https?:\\/\\/(?:cdndev|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,\n          r = /^https?:\\/\\/(?:cdnqa|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i;\n    return t.test(e) ? e = e.replace(t, \"https://www.arcgis.com\") : s.test(e) ? e = e.replace(s, \"https://devext.arcgis.com\") : r.test(e) && (e = e.replace(r, \"https://qaext.arcgis.com\")), e;\n  }\n\n  _sanitizeUrl(e) {\n    const s = (t.request.proxyUrl || \"\").toLowerCase(),\n          r = s ? e.toLowerCase().indexOf(s + \"?\") : -1;\n    return -1 !== r && (e = e.substring(r + s.length + 1)), e = v(e), _(e).path;\n  }\n\n  _isRESTService(e) {\n    return e.indexOf(this._agsRest) > -1;\n  }\n\n  _isAdminResource(e) {\n    return this._agsAdmin.test(e) || this._adminSvcs.test(e);\n  }\n\n  _isServerRsrc(e) {\n    return this._isRESTService(e) || this._isAdminResource(e);\n  }\n\n  _isIdenticalService(e, t) {\n    let s;\n\n    if (this._isRESTService(e) && this._isRESTService(t)) {\n      const r = this._getSuffix(e).toLowerCase(),\n            i = this._getSuffix(t).toLowerCase();\n\n      if (s = r === i, !s) {\n        const e = /(.*)\\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;\n        s = r.replace(e, \"$1\") === i.replace(e, \"$1\");\n      }\n    } else this._isAdminResource(e) && this._isAdminResource(t) ? s = !0 : this._isServerRsrc(e) || this._isServerRsrc(t) || !this._isPortalDomain(e) || (s = !0);\n\n    return s;\n  }\n\n  _isPortalDomain(e) {\n    const s = new f(e.toLowerCase()),\n          r = this._portalConfig;\n\n    let i = this._gwDomains.some(e => e.regex.test(s.uri));\n\n    return !i && r && (i = this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl), s.uri)), i || t.portalUrl && (i = g(s, t.portalUrl, !0)), i || (i = this._portals.some(e => this._hasSameServerInstance(e, s.uri))), i = i || this._agsPortal.test(s.path), i;\n  }\n\n  _isIdProvider(e, t) {\n    let s = -1,\n        r = -1;\n\n    this._gwDomains.forEach((i, n) => {\n      -1 === s && i.regex.test(e) && (s = n), -1 === r && i.regex.test(t) && (r = n);\n    });\n\n    let i = !1;\n\n    if (s > -1 && r > -1 && (0 === s || 4 === s ? 0 !== r && 4 !== r || (i = !0) : 1 === s ? 1 !== r && 2 !== r || (i = !0) : 2 === s ? 2 === r && (i = !0) : 3 === s && 3 === r && (i = !0)), !i) {\n      const s = this.findServerInfo(t),\n            r = s && s.owningSystemUrl;\n      r && b(s) && this._isPortalDomain(r) && this._isIdProvider(e, r) && (i = !0);\n    }\n\n    return i;\n  }\n\n  _getIdenticalSvcIdx(e, t) {\n    let s = -1;\n\n    for (let r = 0; r < t.resources.length; r++) {\n      const i = t.resources[r];\n\n      if (this._isIdenticalService(e, i)) {\n        s = r;\n        break;\n      }\n    }\n\n    return s;\n  }\n\n  _getSuffix(e) {\n    return e.replace(this._regexSDirUrl, \"\").replace(this._regexServerType, \"$1\");\n  }\n\n  _getTokenSvcUrl(e) {\n    let t, s, i;\n\n    if (this._isRESTService(e) || this._isAdminResource(e)) {\n      const i = this._getServerInstanceRoot(e);\n\n      return t = i + \"/admin/generateToken\", s = r(e = i + \"/rest/info\", {\n        query: {\n          f: \"json\"\n        }\n      }).then(e => e.data), {\n        adminUrl: t,\n        promise: s\n      };\n    }\n\n    if (this._isPortalDomain(e)) {\n      let t = \"\";\n\n      if (this._gwDomains.some(s => (s.regex.test(e) && (t = s.tokenServiceUrl), !!t)), t || this._portals.some(s => (this._hasSameServerInstance(s, e) && (t = s + this._gwTokenUrl), !!t)), t || (i = e.toLowerCase().indexOf(\"/sharing\"), -1 !== i && (t = e.substring(0, i) + this._gwTokenUrl)), t || (t = this._getOrigin(e) + this._gwTokenUrl), t) {\n        const s = new f(e).port;\n        /^http:\\/\\//i.test(e) && \"7080\" === s && (t = t.replace(/:7080/i, \":7443\")), t = t.replace(/http:/i, \"https:\");\n      }\n\n      return t;\n    }\n\n    if (-1 !== e.toLowerCase().indexOf(\"premium.arcgisonline.com\")) return \"https://premium.arcgisonline.com/server/tokens\";\n  }\n\n  _exchangeToken(e, t, s) {\n    return r(`${e}/sharing/rest/oauth2/exchangeToken`, {\n      authMode: \"anonymous\",\n      method: \"post\",\n      query: {\n        f: \"json\",\n        client_id: t,\n        token: s\n      }\n    }).then(e => e.data.token);\n  }\n\n  _getPlatformSelf(e, t) {\n    return r(`${e}/sharing/rest/oauth2/platformSelf`, {\n      authMode: \"anonymous\",\n      headers: {\n        \"X-Esri-Auth-Client-Id\": t,\n        \"X-Esri-Auth-Redirect-Uri\": window.location.href.replace(/#.*$/, \"\")\n      },\n      method: \"post\",\n      query: {\n        f: \"json\"\n      },\n      withCredentials: !0\n    }).then(e => e.data);\n  }\n\n  _getPortalSelf(e, t) {\n    let s;\n    if (this._gwDomains.some(t => (t.regex.test(e) && (s = t.customBaseUrl), !!s)), s) return Promise.resolve({\n      allSSL: !0,\n      currentVersion: \"4.4\",\n      customBaseUrl: s,\n      portalMode: \"multitenant\",\n      supportsOAuth: !0\n    });\n    this._appOrigin.startsWith(\"https:\") ? e = e.replace(/^http:/i, \"https:\").replace(/:7080/i, \":7443\") : /^http:/i.test(t) && (e = e.replace(/^https:/i, \"http:\").replace(/:7443/i, \":7080\"));\n    return r(e, {\n      query: {\n        f: \"json\"\n      },\n      authMode: \"anonymous\",\n      withCredentials: !0\n    }).then(e => e.data);\n  }\n\n  _doPortalSignIn(e) {\n    const t = this._portalConfig,\n          s = window.location.href,\n          r = this.findServerInfo(e);\n    return !(!t && !this._isPortalDomain(s) || !(r ? r.hasPortal || r.owningSystemUrl && this._isPortalDomain(r.owningSystemUrl) : this._isPortalDomain(e)) || !(this._isIdProvider(s, e) || t && (this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl), e) || this._isIdProvider(t.restBaseUrl, e)) || g(s, e, !0)));\n  }\n\n  _checkProtocol(e, t, s, r) {\n    let n = !0;\n    const o = r ? t.adminTokenServiceUrl : t.tokenServiceUrl;\n\n    if (o.trim().toLowerCase().startsWith(\"https:\") && !this._appOrigin.startsWith(\"https:\") && S(o) && (n = !!this._protocolFunc && !!this._protocolFunc({\n      resourceUrl: e,\n      serverInfo: t\n    }), !n)) {\n      s(new i(\"identity-manager:aborted\", \"Aborted the Sign-In process to avoid sending password over insecure connection.\"));\n    }\n\n    return n;\n  }\n\n  _enqueue(e, t, s, r, i, n) {\n    return r || (r = d()), r.resUrl_ = e, r.sinfo_ = t, r.options_ = s, r.admin_ = i, r.refresh_ = n, this._busy ? this._hasSameServerInstance(this._getServerInstanceRoot(e), this._busy.resUrl_) ? (this._oAuthDfd && this._oAuthDfd.oAuthWin_ && this._oAuthDfd.oAuthWin_.focus(), this._soReqs.push(r)) : this._xoReqs.push(r) : this._doSignIn(r), r.promise;\n  }\n\n  _doSignIn(e) {\n    this._busy = e, this._rejectOnPersistedPageShow = !1;\n\n    const t = t => {\n      const s = e.options_ && e.options_.resource,\n            r = e.resUrl_,\n            i = e.refresh_;\n      let n = !1;\n      -1 === this.credentials.indexOf(t) && (i && -1 !== this.credentials.indexOf(i) ? (i.userId = t.userId, i.token = t.token, i.expires = t.expires, i.validity = t.validity, i.ssl = t.ssl, i.creationTime = t.creationTime, n = !0, t = i) : this.credentials.push(t)), t.resources || (t.resources = []), t.resources.push(s || r), t.scope = this._isServerRsrc(r) ? \"server\" : \"portal\", t.emitTokenChange();\n      const o = this._soReqs,\n            a = {};\n      this._soReqs = [], o.forEach(e => {\n        if (!this._isIdenticalService(r, e.resUrl_)) {\n          const s = this._getSuffix(e.resUrl_);\n\n          a[s] || (a[s] = !0, t.resources.push(e.resUrl_));\n        }\n      }), e.resolve(t), o.forEach(e => {\n        this._hasSameServerInstance(this._getServerInstanceRoot(r), e.resUrl_) ? e.resolve(t) : this._soReqs.push(e);\n      }), this._busy = e.resUrl_ = e.sinfo_ = e.refresh_ = null, n || this.emit(\"credential-create\", {\n        credential: t\n      }), this._soReqs.length ? this._doSignIn(this._soReqs.shift()) : this._xoReqs.length && this._doSignIn(this._xoReqs.shift());\n    },\n          s = t => {\n      e.reject(t), this._busy = e.resUrl_ = e.sinfo_ = e.refresh_ = null, this._soReqs.length ? this._doSignIn(this._soReqs.shift()) : this._xoReqs.length && this._doSignIn(this._xoReqs.shift());\n    },\n          r = (r, n, a, h) => {\n      var l, c;\n\n      const d = e.sinfo_,\n            p = !e.options_ || !1 !== e.options_.prompt,\n            _ = d.hasPortal && this._findOAuthInfo(e.resUrl_);\n\n      let f, m;\n      if (r) t(new j({\n        userId: r,\n        server: d.server,\n        token: a || null,\n        expires: null != h ? Number(h) : null,\n        ssl: !!n\n      }));else if (window !== window.parent && null != (l = this._appUrlObj.query) && l[\"arcgis-auth-origin\"] && null != (c = this._appUrlObj.query) && c[\"arcgis-auth-portal\"] && this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query[\"arcgis-auth-portal\"]), e.resUrl_)) {\n        var v;\n        window.parent.postMessage({\n          type: \"arcgis:auth:requestCredential\"\n        }, this._appUrlObj.query[\"arcgis-auth-origin\"]);\n        const r = o(window, \"message\", e => {\n          e.source === window.parent && e.data && (\"arcgis:auth:credential\" === e.data.type ? (r.remove(), t(new j(e.data.credential))) : \"arcgis:auth:error\" === e.data.type && (r.remove(), s(i.fromJSON(e.data.error))));\n        });\n        u(null == (v = e.options_) ? void 0 : v.signal, () => {\n          r.remove();\n        });\n      } else if (_) {\n        let r = _._oAuthCred;\n\n        if (!r) {\n          const e = new T(_, C),\n                t = new T(_, D);\n          e.isValid() && t.isValid() ? e.expires > t.expires ? (r = e, t.destroy()) : (r = t, e.destroy()) : r = e.isValid() ? e : t, _._oAuthCred = r;\n        }\n\n        if (r.isValid()) f = new j({\n          userId: r.userId,\n          server: d.server,\n          token: r.token,\n          expires: r.expires,\n          ssl: r.ssl,\n          _oAuthCred: r\n        }), _.appId !== r.appId && this._doPortalSignIn(e.resUrl_) ? e._pendingDfd = this._exchangeToken(f.server, _.appId, f.token).then(e => {\n          f.token = e, r.token = e, r.save(), t(f);\n        }).catch(() => {\n          t(f);\n        }) : t(f);else if (this._oAuthHash && this._hasSameServerInstance(_.portalUrl, this._oAuthHash.state.portalUrl)) {\n          const e = this._oAuthHash;\n          f = new j({\n            userId: e.username,\n            server: d.server,\n            token: e.access_token,\n            expires: Date.now() + 1e3 * Number(e.expires_in),\n            ssl: \"true\" === e.ssl,\n            oAuthState: e.state,\n            _oAuthCred: r\n          }), _.userId = f.userId, r.storage = e.persist ? C : D, r.token = f.token, r.expires = f.expires, r.userId = f.userId, r.ssl = f.ssl, r.save(), this._oAuthHash = null, t(f);\n        } else {\n          const r = () => {\n            p ? e._pendingDfd = this.oAuthSignIn(e.resUrl_, d, _, e.options_).then(t, s) : (m = new i(\"identity-manager:not-authenticated\", \"User is not signed in.\"), s(m));\n          };\n\n          this._doPortalSignIn(e.resUrl_) ? e._pendingDfd = this._getPlatformSelf(d.server, _.appId).then(({\n            portalUrl: e,\n            token: s,\n            username: i\n          }) => {\n            !e || g(e, this._appOrigin, !0) ? (f = new j({\n              server: d.server,\n              userId: i,\n              token: s\n            }), t(f)) : r();\n          }).catch(r) : r();\n        }\n      } else if (p) {\n        if (this._checkProtocol(e.resUrl_, d, s, e.admin_)) {\n          let r = e.options_;\n          e.admin_ && (r = r || {}, r.isAdmin = !0), e._pendingDfd = this.signIn(e.resUrl_, d, r).then(t, s);\n        }\n      } else m = new i(\"identity-manager:not-authenticated\", \"User is not signed in.\"), s(m);\n    },\n          n = () => {\n      const r = e.sinfo_,\n            i = r.owningSystemUrl,\n            n = e.options_;\n      let o, a, h, l;\n      if (n && (o = n.token, a = n.error, h = n.prompt), l = this._findCredential(i, {\n        token: o,\n        resource: e.resUrl_\n      }), !l) for (const e of this.credentials) if (this._isIdProvider(i, e.server)) {\n        l = e;\n        break;\n      }\n\n      if (l) {\n        const i = this.findCredential(e.resUrl_, l.userId);\n        if (i) t(i);else if (P(r, this._legacyFed)) {\n          const e = l.toJSON();\n          e.server = r.server, e.resources = null, t(new j(e));\n        } else {\n          (e._pendingDfd = this.generateToken(this.findServerInfo(l.server), null, {\n            serverUrl: e.resUrl_,\n            token: l.token,\n            signal: e.options_.signal,\n            ssl: l.ssl\n          })).then(s => {\n            t(new j({\n              userId: l.userId,\n              server: r.server,\n              token: s.token,\n              expires: null != s.expires ? Number(s.expires) : null,\n              ssl: !!s.ssl,\n              isAdmin: e.admin_,\n              validity: s.validity\n            }));\n          }, s);\n        }\n      } else {\n        this._busy = null, o && (e.options_.token = null);\n        (e._pendingDfd = this.getCredential(i.replace(/\\/?$/, \"/sharing\"), {\n          resource: e.resUrl_,\n          owningTenant: r.owningTenant,\n          signal: e.options_.signal,\n          token: o,\n          error: a,\n          prompt: h\n        })).then(() => {\n          this._enqueue(e.resUrl_, e.sinfo_, e.options_, e, e.admin_);\n        }, e => {\n          s(e);\n        });\n      }\n    };\n\n    this._errbackFunc = s;\n\n    const a = e.sinfo_.owningSystemUrl,\n          h = this._isServerRsrc(e.resUrl_),\n          c = e.sinfo_._restInfoPms;\n\n    c ? c.promise.then(t => {\n      const s = e.sinfo_;\n\n      if (s._restInfoPms) {\n        s.adminTokenServiceUrl = s._restInfoPms.adminUrl, s._restInfoPms = null, s.tokenServiceUrl = l(\"authInfo.tokenServicesUrl\", t) || l(\"authInfo.tokenServiceUrl\", t) || l(\"tokenServiceUrl\", t), s.shortLivedTokenValidity = l(\"authInfo.shortLivedTokenValidity\", t), s.currentVersion = t.currentVersion, s.owningTenant = t.owningTenant;\n        const e = s.owningSystemUrl = t.owningSystemUrl;\n        e && this._portals.push(e);\n      }\n\n      h && s.owningSystemUrl ? n() : r();\n    }, () => {\n      e.sinfo_._restInfoPms = null;\n      const t = new i(\"identity-manager:server-identification-failed\", \"Unknown resource - could not find token service endpoint.\");\n      s(t);\n    }) : h && a ? n() : e.sinfo_._selfReq ? e.sinfo_._selfReq.selfDfd.then(t => {\n      const s = {};\n      let r, i, n, o;\n      return t && (r = t.user && t.user.username, s.username = r, s.allSSL = t.allSSL, i = t.supportsOAuth, n = t.currentVersion, \"multitenant\" === t.portalMode && (o = t.customBaseUrl)), e.sinfo_.webTierAuth = !!r, r && this.normalizeWebTierAuth ? this.generateToken(e.sinfo_, null, {\n        ssl: s.allSSL\n      }).catch(() => null).then(e => (s.portalToken = e && e.token, s.tokenExpiration = e && e.expires, s)) : !r && i && parseFloat(n) >= 4.4 && !this._findOAuthInfo(e.resUrl_) ? this._generateOAuthInfo({\n        portalUrl: e.sinfo_.server,\n        customBaseUrl: o,\n        owningTenant: e.sinfo_._selfReq.owningTenant\n      }).catch(() => null).then(() => s) : s;\n    }).catch(() => null).then(t => {\n      e.sinfo_._selfReq = null, t ? r(t.username, t.allSSL, t.portalToken, t.tokenExpiration) : r();\n    }) : r();\n  }\n\n  _generateOAuthInfo(e) {\n    let t,\n        s,\n        i = e.portalUrl;\n    const n = e.customBaseUrl,\n          o = e.owningTenant,\n          a = !this.defaultOAuthInfo && this._createDefaultOAuthInfo && !this._hasTestedIfAppIsOnPortal;\n\n    if (a) {\n      s = window.location.href;\n      let e = s.indexOf(\"?\");\n      e > -1 && (s = s.slice(0, e)), e = s.search(/\\/(apps|home)\\//), s = e > -1 ? s.slice(0, e) : null;\n    }\n\n    return a && s ? (this._hasTestedIfAppIsOnPortal = !0, t = r(s + \"/sharing/rest\", {\n      query: {\n        f: \"json\"\n      }\n    }).then(() => {\n      this.defaultOAuthInfo = new x({\n        appId: \"arcgisonline\",\n        popupCallbackUrl: s + \"/home/oauth-callback.html\"\n      });\n    })) : t = Promise.resolve(), t.then(() => {\n      if (this.defaultOAuthInfo) return i = i.replace(/^http:/i, \"https:\"), r(i + \"/sharing/rest/oauth2/validateRedirectUri\", {\n        query: {\n          accountId: o,\n          client_id: this.defaultOAuthInfo.appId,\n          redirect_uri: w(this.defaultOAuthInfo.popupCallbackUrl),\n          f: \"json\"\n        }\n      }).then(e => {\n        if (e.data.valid) {\n          const t = this.defaultOAuthInfo.clone();\n          e.data.urlKey && n ? t.portalUrl = \"https://\" + e.data.urlKey.toLowerCase() + \".\" + n : t.portalUrl = i, t.popup = window !== window.top || !(g(i, this._appOrigin) || this._gwDomains.some(e => e.regex.test(i) && e.regex.test(this._appOrigin))), this.oAuthInfos.push(t);\n        }\n      });\n    });\n  }\n\n  _doOAuthSignIn(e, t, s) {\n    const r = {\n      portalUrl: s.portalUrl\n    };\n    !s.popup && s.preserveUrlHash && window.location.hash && (r.hash = window.location.hash);\n    const n = {\n      client_id: s.appId,\n      response_type: \"token\",\n      state: JSON.stringify(r),\n      expiration: s.expiration,\n      locale: s.locale,\n      redirect_uri: s.popup ? w(s.popupCallbackUrl) : window.location.href.replace(/#.*$/, \"\")\n    };\n    s.forceLogin && (n.force_login = !0), s.forceUserId && s.userId && (n.prepopulatedusername = s.userId), !s.popup && this._doPortalSignIn(e) && (n.redirectToUserOrgUrl = !0);\n    const h = s.portalUrl.replace(/^http:/i, \"https:\") + \"/sharing/oauth2/authorize\",\n          l = h + \"?\" + I(n);\n\n    if (s.popup) {\n      const e = window.open(l, \"esriJSAPIOAuth\", s.popupWindowFeatures);\n      if (e) e.focus(), this._oAuthDfd.oAuthWin_ = e, this._oAuthIntervalId = setInterval(() => {\n        if (e.closed) {\n          clearInterval(this._oAuthIntervalId), this._oAuthOnHashHandle.remove();\n          const e = this._oAuthDfd;\n\n          if (e) {\n            const t = new i(\"identity-manager:user-aborted\", \"ABORTED\");\n            e.reject(t);\n          }\n        }\n      }, 500), this._oAuthOnHashHandle = o(a, \"arcgis:auth:hash\", e => {\n        this.setOAuthResponseHash(e.detail);\n      });else {\n        const e = new i(\"identity-manager:popup-blocked\", \"ABORTED\");\n\n        this._oAuthDfd.reject(e);\n      }\n    } else this._rejectOnPersistedPageShow = !0, this._oAuthRedirectFunc ? this._oAuthRedirectFunc({\n      authorizeParams: n,\n      authorizeUrl: h,\n      resourceUrl: e,\n      serverInfo: t,\n      oAuthInfo: s\n    }) : window.location.href = l;\n  }\n\n}\n\nq.prototype.declaredClass = \"esri.identity.IdentityManagerBase\";\nlet j = class extends n.EventedAccessor {\n  constructor(e) {\n    super(e), this._oAuthCred = null, this.tokenRefreshBuffer = 2, e && e._oAuthCred && (this._oAuthCred = e._oAuthCred);\n  }\n\n  initialize() {\n    this.resources = this.resources || [], null == this.creationTime && (this.creationTime = Date.now());\n  }\n\n  refreshToken() {\n    const e = s.findServerInfo(this.server),\n          t = e && e.owningSystemUrl,\n          r = !!t && \"server\" === this.scope,\n          i = r && P(e, s._legacyFed),\n          n = e.webTierAuth,\n          o = n && s.normalizeWebTierAuth,\n          a = R[this.server],\n          h = a && a[this.userId];\n    let l,\n        c = this.resources && this.resources[0],\n        d = r && s.findServerInfo(t),\n        u = {\n      username: this.userId,\n      password: h\n    };\n    if (n && !o) return;\n    r && !d && s.serverInfos.some(e => (s._isIdProvider(t, e.server) && (d = e), !!d));\n    const p = d && s.findCredential(d.server, this.userId);\n\n    if (!r || p) {\n      if (!i) {\n        if (r) l = {\n          serverUrl: c,\n          token: p && p.token,\n          ssl: p && p.ssl\n        };else if (o) u = null, l = {\n          ssl: this.ssl\n        };else {\n          if (!h) {\n            let t;\n            return c && (c = s._sanitizeUrl(c), this._enqueued = 1, t = s._enqueue(c, e, null, null, this.isAdmin, this), t.then(() => {\n              this._enqueued = 0, this.refreshServerTokens();\n            }).catch(() => {\n              this._enqueued = 0;\n            })), t;\n          }\n\n          this.isAdmin && (l = {\n            isAdmin: !0\n          });\n        }\n        return s.generateToken(r ? d : e, r ? null : u, l).then(e => {\n          this.token = e.token, this.expires = null != e.expires ? Number(e.expires) : null, this.creationTime = Date.now(), this.validity = e.validity, this.emitTokenChange(), this.refreshServerTokens();\n        }).catch(() => {});\n      }\n\n      p.refreshToken();\n    }\n  }\n\n  refreshServerTokens() {\n    \"portal\" === this.scope && s.credentials.forEach(e => {\n      const t = s.findServerInfo(e.server),\n            r = t && t.owningSystemUrl;\n      e !== this && e.userId === this.userId && r && \"server\" === e.scope && (s._hasSameServerInstance(this.server, r) || s._isIdProvider(r, this.server)) && (P(t, s._legacyFed) ? (e.token = this.token, e.expires = this.expires, e.creationTime = this.creationTime, e.validity = this.validity, e.emitTokenChange()) : e.refreshToken());\n    });\n  }\n\n  emitTokenChange(e) {\n    clearTimeout(this._refreshTimer);\n    const t = this.server && s.findServerInfo(this.server),\n          r = t && t.owningSystemUrl,\n          i = r && s.findServerInfo(r);\n    !1 === e || r && \"portal\" !== this.scope && (!i || !i.webTierAuth || s.normalizeWebTierAuth) || null == this.expires && null == this.validity || this._startRefreshTimer(), this.emit(\"token-change\");\n  }\n\n  destroy() {\n    this.userId = this.server = this.token = this.expires = this.validity = this.resources = this.creationTime = null, this._oAuthCred && (this._oAuthCred.destroy(), this._oAuthCred = null);\n    const e = s.credentials.indexOf(this);\n    e > -1 && s.credentials.splice(e, 1), this.emitTokenChange(), this.emit(\"destroy\");\n  }\n\n  toJSON() {\n    const e = h({\n      userId: this.userId,\n      server: this.server,\n      token: this.token,\n      expires: this.expires,\n      validity: this.validity,\n      ssl: this.ssl,\n      isAdmin: this.isAdmin,\n      creationTime: this.creationTime,\n      scope: this.scope\n    }),\n          t = this.resources;\n    return t && t.length > 0 && (e.resources = t.slice()), e;\n  }\n\n  _startRefreshTimer() {\n    clearTimeout(this._refreshTimer);\n    const e = 6e4 * this.tokenRefreshBuffer,\n          t = 2 ** 31 - 1;\n    let s = (this.validity ? this.creationTime + 6e4 * this.validity : this.expires) - Date.now();\n    s < 0 ? s = 0 : s > t && (s = t), this._refreshTimer = setTimeout(this.refreshToken.bind(this), s > e ? s - e : s);\n  }\n\n};\ne([k()], j.prototype, \"creationTime\", void 0), e([k()], j.prototype, \"expires\", void 0), e([k()], j.prototype, \"isAdmin\", void 0), e([k()], j.prototype, \"oAuthState\", void 0), e([k()], j.prototype, \"resources\", void 0), e([k()], j.prototype, \"scope\", void 0), e([k()], j.prototype, \"server\", void 0), e([k()], j.prototype, \"ssl\", void 0), e([k()], j.prototype, \"token\", void 0), e([k()], j.prototype, \"tokenRefreshBuffer\", void 0), e([k()], j.prototype, \"userId\", void 0), e([k()], j.prototype, \"validity\", void 0), j = e([A(\"esri.identity.Credential\")], j);\nexport { j as Credential, q as IdentityManagerBase };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/identity/IdentityManagerBase.js"],"names":["_","e","t","id","s","r","i","n","on","o","a","fixJson","h","getDeepValue","l","createAbortController","c","createResolver","d","onAbort","u","isAborted","p","urlToObject","hasSameOrigin","g","Url","f","queryToObject","m","normalize","v","getProxyRule","S","makeAbsolute","w","objectToQuery","I","property","k","subclass","A","y","U","T","x","O","R","b","owningSystemUrl","host","server","test","P","some","C","D","window","localStorage","sessionStorage","q","constructor","_portalConfig","esriGeowConfig","serverInfos","oAuthInfos","credentials","_soReqs","_xoReqs","_portals","defaultOAuthInfo","defaultTokenValidity","dialog","formConstructor","tokenValidity","normalizeWebTierAuth","_appOrigin","origin","location","_appUrlObj","href","_busy","_rejectOnPersistedPageShow","_oAuthHash","_gwTokenUrl","_agsRest","_agsPortal","_agsAdmin","_adminSvcs","_gwDomains","regex","customBaseUrl","tokenServiceUrl","_legacyFed","_regexSDirUrl","_regexServerType","_gwUser","_gwItem","_gwGroup","_rePortalTokenSvc","_createDefaultOAuthInfo","_hasTestedIfAppIsOnPortal","_getOAuthHash","addEventListener","_pageShowHandler","registerServers","filter","findServerInfo","concat","forEach","push","hasPortal","registerOAuthInfos","findOAuthInfo","portalUrl","splice","indexOf","registerToken","_sanitizeUrl","_isServerRsrc","_getServerInstanceRoot","hasServer","_getTokenSvcUrl","_findCredential","Object","assign","j","userId","token","expires","ssl","scope","resources","emitTokenChange","refreshServerTokens","toJSON","map","initialize","JSON","parse","declaredClass","length","appId","Date","now","_hasSameServerInstance","findCredential","_getIdenticalSvcIdx","getCredential","error","prompt","signal","abort","reject","promise","_isAdminResource","details","httpStatus","destroy","resolve","_restInfoPms","_selfReq","owningTenant","selfDfd","_getPortalSelf","replace","_enqueue","getResourceName","_isRESTService","generateToken","shortLivedTokenValidity","isAdmin","serverUrl","customParameters","adminTokenServiceUrl","toLowerCase","webTierAuth","scheme","uri","port","query","request","username","password","expiration","referer","client","method","authMode","useProxy","_useProxy","ioArgs","withCredentials","then","data","validity","isBusy","checkSignInStatus","checkAppAccess","credential","_doPortalSignIn","force","client_id","valid","viewOnlyUserTypeApp","catch","name","viewOnly","setOAuthResponseHash","_oAuthDfd","clearInterval","_oAuthIntervalId","_oAuthOnHashHandle","remove","charAt","substring","error_description","sinfo_","oinfo_","_oAuthCred","access_token","Number","expires_in","storage","persist","save","setOAuthRedirectionHandler","_oAuthRedirectFunc","setProtocolErrorHandler","_protocolFunc","signIn","resource","content","open","emit","watch","signingIn","oAuthSignIn","oAuthWin_","closed","close","resUrl_","oAuthPopupConfirmation","popup","_doOAuthSignIn","oAuthPrompt","destroyCredentials","slice","enablePostMessageAuth","_postMessageAuthHandle","endsWith","type","source","postMessage","message","disablePostMessageAuth","hash","state","hasOwnProperty","console","log","persisted","_errbackFunc","_addResource","_removeResource","_findOAuthInfo","_isIdProvider","_isPortalDomain","String","currentVersion","_getOrigin","search","substr","_normalizeAGOLorgDomain","proxyUrl","path","_isIdenticalService","_getSuffix","restBaseUrl","adminUrl","_exchangeToken","_getPlatformSelf","headers","Promise","allSSL","portalMode","supportsOAuth","startsWith","_checkProtocol","trim","resourceUrl","serverInfo","options_","admin_","refresh_","focus","_doSignIn","creationTime","shift","parent","fromJSON","isValid","_pendingDfd","oAuthState","user","portalToken","tokenExpiration","parseFloat","_generateOAuthInfo","popupCallbackUrl","accountId","redirect_uri","clone","urlKey","top","preserveUrlHash","response_type","stringify","locale","forceLogin","force_login","forceUserId","prepopulatedusername","redirectToUserOrgUrl","popupWindowFeatures","setInterval","detail","authorizeParams","authorizeUrl","oAuthInfo","prototype","EventedAccessor","tokenRefreshBuffer","refreshToken","_enqueued","clearTimeout","_refreshTimer","_startRefreshTimer","setTimeout","bind","Credential","IdentityManagerBase"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"../config.js\";import{id as s}from\"../kernel.js\";import r from\"../request.js\";import i from\"../core/Error.js\";import n from\"../core/Evented.js\";import{on as o}from\"../core/events.js\";import a from\"../core/global.js\";import{fixJson as h}from\"../core/lang.js\";import{getDeepValue as l}from\"../core/object.js\";import{createAbortController as c,createResolver as d,onAbort as u,isAborted as p}from\"../core/promiseUtils.js\";import{urlToObject as _,hasSameOrigin as g,Url as f,queryToObject as m,normalize as v,getProxyRule as S,makeAbsolute as w,objectToQuery as I}from\"../core/urlUtils.js\";import{property as k}from\"../core/accessorSupport/decorators/property.js\";import\"../core/accessorSupport/ensureType.js\";import\"../core/has.js\";import\"../core/Logger.js\";import{subclass as A}from\"../core/accessorSupport/decorators/subclass.js\";import y from\"./IdentityForm.js\";import U from\"./IdentityModal.js\";import T from\"./OAuthCredential.js\";import x from\"./OAuthInfo.js\";import O from\"./ServerInfo.js\";const R={},b=e=>{const t=new f(e.owningSystemUrl).host,s=new f(e.server).host,r=/.+\\.arcgis\\.com$/i;return r.test(t)&&r.test(s)},P=(e,t)=>!!(b(e)&&t&&t.some((t=>t.test(e.server))));let C=null,D=null;try{C=window.localStorage,D=window.sessionStorage}catch{}class q extends n{constructor(){super(),this._portalConfig=a.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=y,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=\"null\"!==window.origin?window.origin:window.location.origin,this._appUrlObj=_(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthHash=null,this._gwTokenUrl=\"/sharing/rest/generateToken\",this._agsRest=\"/rest/services\",this._agsPortal=/\\/sharing(\\/|$)/i,this._agsAdmin=/(https?:\\/\\/[^\\/]+\\/[^\\/]+)\\/admin\\/?(\\/.*)?$/i,this._adminSvcs=/\\/rest\\/admin\\/services(\\/|$)/i,this._gwDomains=[{regex:/^https?:\\/\\/www\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:dev|[a-z\\d-]+\\.mapsdev)\\.arcgis\\.com/i,customBaseUrl:\"mapsdev.arcgis.com\",tokenServiceUrl:\"https://dev.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:devext|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,customBaseUrl:\"mapsdevext.arcgis.com\",tokenServiceUrl:\"https://devext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:qaext|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i,customBaseUrl:\"mapsqa.arcgis.com\",tokenServiceUrl:\"https://qaext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/[a-z\\d-]+\\.maps\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"}],this._legacyFed=[],this._regexSDirUrl=/http.+\\/rest\\/services\\/?/gi,this._regexServerType=/(\\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\\/users\\/([^\\/]+)\\/?.*/i,this._gwItem=/http.+\\/items\\/([^\\/]+)\\/?.*/i,this._gwGroup=/http.+\\/groups\\/([^\\/]+)\\/?.*/i,this._rePortalTokenSvc=/\\/sharing(\\/rest)?\\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthHash(),window.addEventListener(\"pageshow\",(e=>{this._pageShowHandler(e)}))}registerServers(e){const t=this.serverInfos;t?(e=e.filter((e=>!this.findServerInfo(e.server))),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach((e=>{e.owningSystemUrl&&this._portals.push(e.owningSystemUrl),e.hasPortal&&this._portals.push(e.server)}))}registerOAuthInfos(e){const t=this.oAuthInfos;if(t){for(const s of e){const e=this.findOAuthInfo(s.portalUrl);e&&t.splice(t.indexOf(e),1)}this.oAuthInfos=t.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const t=this._sanitizeUrl(e.server),s=this._isServerRsrc(t);let r,i=this.findServerInfo(t),n=!0;i||(i=new O,i.server=this._getServerInstanceRoot(t),s?i.hasServer=!0:(i.tokenServiceUrl=this._getTokenSvcUrl(t),i.hasPortal=!0),this.registerServers([i])),r=this._findCredential(t),r?(delete e.server,Object.assign(r,e),n=!1):(r=new j({userId:e.userId,server:i.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:s?\"server\":\"portal\"}),r.resources=[t],this.credentials.push(r)),r.emitTokenChange(!1),n||r.refreshServerTokens()}toJSON(){return h({serverInfos:this.serverInfos.map((e=>e.toJSON())),oAuthInfos:this.oAuthInfos.map((e=>e.toJSON())),credentials:this.credentials.map((e=>e.toJSON()))})}initialize(e){if(!e)return;\"string\"==typeof e&&(e=JSON.parse(e));const t=e.serverInfos,s=e.oAuthInfos,r=e.credentials;if(t){const e=[];t.forEach((t=>{t.server&&t.tokenServiceUrl&&e.push(t.declaredClass?t:new O(t))})),e.length&&this.registerServers(e)}if(s){const e=[];s.forEach((t=>{t.appId&&e.push(t.declaredClass?t:new x(t))})),e.length&&this.registerOAuthInfos(e)}r&&r.forEach((e=>{e.server&&e.token&&e.expires&&e.expires>Date.now()&&((e=e.declaredClass?e:new j(e)).emitTokenChange(),this.credentials.push(e))}))}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const s of this.serverInfos)if(this._hasSameServerInstance(s.server,e)){t=s;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const s of this.oAuthInfos)if(this._hasSameServerInstance(s.portalUrl,e)){t=s;break}return t}findCredential(e,t){let s;e=this._sanitizeUrl(e);const r=this._isServerRsrc(e)?\"server\":\"portal\";if(t){for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&t===i.userId&&i.scope===r){s=i;break}}else for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&-1!==this._getIdenticalSvcIdx(e,i)&&i.scope===r){s=i;break}return s}getCredential(e,t){let s,r,n=!0;t&&(s=!!t.token,r=t.error,n=!1!==t.prompt),t={...t},e=this._sanitizeUrl(e);const o=c(),a=d();if(t.signal&&u(t.signal,(()=>{o.abort()})),u(o,(()=>{a.reject(new i(\"identity-manager:user-aborted\",\"ABORTED\"))})),p(o))return a.promise;t.signal=o.signal;const h=this._isAdminResource(e),l=s?this.findCredential(e):null;let _;if(l&&r&&r.details&&498===r.details.httpStatus)l.destroy();else if(l)return _=new i(\"identity-manager:not-authorized\",\"You are currently signed in as: '\"+l.userId+\"'. You do not have access to this resource: \"+e,{error:r}),a.reject(_),a.promise;const f=this._findCredential(e,t);if(f)return a.resolve(f),a.promise;let m=this.findServerInfo(e);if(m)!m.hasServer&&this._isServerRsrc(e)&&(m._restInfoPms=this._getTokenSvcUrl(e),m.hasServer=!0);else{const t=this._getTokenSvcUrl(e);if(!t)return _=new i(\"identity-manager:unknown-resource\",\"Unknown resource - could not find token service endpoint.\"),a.reject(_),a.promise;m=new O,m.server=this._getServerInstanceRoot(e),\"string\"==typeof t?(m.tokenServiceUrl=t,m.hasPortal=!0):(m._restInfoPms=t,m.hasServer=!0),this.registerServers([m])}return m.hasPortal&&void 0===m._selfReq&&(n||g(m.tokenServiceUrl,this._appOrigin)||this._gwDomains.some((e=>e.tokenServiceUrl===m.tokenServiceUrl)))&&(m._selfReq={owningTenant:t&&t.owningTenant,selfDfd:this._getPortalSelf(m.tokenServiceUrl.replace(this._rePortalTokenSvc,\"/sharing/rest/portals/self\"),e)}),this._enqueue(e,m,t,a,h)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"\")||\"\":this._gwUser.test(e)&&e.replace(this._gwUser,\"$1\")||this._gwItem.test(e)&&e.replace(this._gwItem,\"$1\")||this._gwGroup.test(e)&&e.replace(this._gwGroup,\"$1\")||\"\"}generateToken(e,t,s){const n=this._rePortalTokenSvc.test(e.tokenServiceUrl),o=new f(this._appOrigin),a=e.shortLivedTokenValidity;let h,l,c,d,u,p,_,m;t&&(m=this.tokenValidity||a||this.defaultTokenValidity,m>a&&a>0&&(m=a)),s&&(h=s.isAdmin,l=s.serverUrl,c=s.token,p=s.signal,_=s.ssl,e.customParameters=s.customParameters),h?d=e.adminTokenServiceUrl:(d=e.tokenServiceUrl,u=new f(d.toLowerCase()),e.webTierAuth&&null!=s&&s.serverUrl&&!_&&\"http\"===o.scheme&&(g(o.uri,d,!0)||\"https\"===u.scheme&&o.host===u.host&&\"7080\"===o.port&&\"7443\"===u.port)&&(d=d.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\")));const v={query:{request:\"getToken\",username:null==t?void 0:t.username,password:null==t?void 0:t.password,serverUrl:l,token:c,expiration:m,referer:h||n?this._appOrigin:null,client:h?\"referer\":null,f:\"json\",...e.customParameters},method:\"post\",authMode:\"anonymous\",useProxy:this._useProxy(e,s),signal:p,...null==s?void 0:s.ioArgs};n||(v.withCredentials=!1);return r(d,v).then((s=>{const r=s.data;if(!r||!r.token)return new i(\"identity-manager:authentication-failed\",\"Unable to generate token\");const n=e.server;return R[n]||(R[n]={}),t&&(R[n][t.username]=t.password),r.validity=m,r}))}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,\"\").then((e=>e.credential))}checkAppAccess(e,t,s){let n=!1;return this.getCredential(e,{prompt:!1}).then((o=>{let a;const h={f:\"json\"};if(\"portal\"===o.scope)if(t&&(this._doPortalSignIn(e)||s&&s.force))a=o.server+\"/sharing/rest/oauth2/validateAppAccess\",h.client_id=t;else{if(!o.token)return{credential:o};a=o.server+\"/sharing/rest\"}else{if(!o.token)return{credential:o};a=o.server+\"/rest/services\"}return o.token&&(h.token=o.token),r(a,{query:h,authMode:\"anonymous\"}).then((e=>{if(!1===e.data.valid)throw new i(\"identity-manager:not-authorized\",`You are currently signed in as: '${o.userId}'.`,e.data);return n=!!e.data.viewOnlyUserTypeApp,{credential:o}})).catch((e=>{if(\"identity-manager:not-authorized\"===e.name)throw e;const t=e.details&&e.details.httpStatus;if(498===t)throw o.destroy(),new i(\"identity-manager:not-authenticated\",\"User is not signed in.\");if(400===t)throw new i(\"identity-manager:invalid-request\");return{credential:o}}))})).then((e=>({credential:e.credential,viewOnly:n})))}setOAuthResponseHash(e){var t;const s=this._oAuthDfd;if(this._oAuthDfd=null,!s||!e)return;clearInterval(this._oAuthIntervalId),null==(t=this._oAuthOnHashHandle)||t.remove(),\"#\"===e.charAt(0)&&(e=e.substring(1));const r=m(e);if(r.error){const e=\"access_denied\"===r.error,t=new i(e?\"identity-manager:user-aborted\":\"identity-manager:authentication-failed\",e?\"ABORTED\":\"OAuth: \"+r.error+\" - \"+r.error_description);s.reject(t)}else{const e=s.sinfo_,t=s.oinfo_,i=t._oAuthCred,n=new j({userId:r.username,server:e.server,token:r.access_token,expires:Date.now()+1e3*Number(r.expires_in),ssl:\"true\"===r.ssl,_oAuthCred:i});t.userId=n.userId,i.storage=r.persist?C:D,i.token=n.token,i.expires=n.expires,i.userId=n.userId,i.ssl=n.ssl,i.save(),s.resolve(n)}}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,s={}){const r=d(),n=()=>{var e,t,s,r,i;null==(e=h)||e.remove(),null==(t=l)||t.remove(),null==(s=c)||s.remove(),null==(r=a)||r.destroy(),null==(i=this.dialog)||i.destroy(),this.dialog=a=h=l=c=null},o=()=>{n(),this._oAuthDfd=null,r.reject(new i(\"identity-manager:user-aborted\",\"ABORTED\"))};s.signal&&u(s.signal,(()=>{o()}));let a=new this.formConstructor;a.resource=this.getResourceName(e),a.server=t.server,this.dialog=new U,this.dialog.content=a,this.dialog.open=!0,this.emit(\"dialog-create\");let h=a.on(\"cancel\",o),l=this.dialog.watch(\"open\",o),c=a.on(\"submit\",(e=>{this.generateToken(t,e,{isAdmin:s.isAdmin,signal:s.signal}).then((i=>{n();const o=new j({userId:e.username,server:t.server,token:i.token,expires:null!=i.expires?Number(i.expires):null,ssl:!!i.ssl,isAdmin:s.isAdmin,validity:i.validity});r.resolve(o)})).catch((e=>{a.error=e,a.signingIn=!1}))}));return r.promise}oAuthSignIn(e,t,s,r){this._oAuthDfd=d();const n=this._oAuthDfd;null!=r&&r.signal&&u(r.signal,(()=>{const e=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;e&&!e.closed?e.close():this.dialog&&h()})),n.resUrl_=e,n.sinfo_=t,n.oinfo_=s;const o=!r||!1!==r.oAuthPopupConfirmation;if(!s.popup||!o)return this._doOAuthSignIn(e,t,s),n.promise;const a=new this.formConstructor;a.oAuthPrompt=!0,a.server=t.server,this.dialog=new U,this.dialog.content=a,this.dialog.open=!0,this.emit(\"dialog-create\");const h=()=>{_(),this._oAuthDfd=null,n.reject(new i(\"identity-manager:user-aborted\",\"ABORTED\"))},l=a.on(\"cancel\",h),c=this.dialog.watch(\"open\",h),p=a.on(\"submit\",(()=>{_(),this._doOAuthSignIn(e,t,s)})),_=()=>{l.remove(),c.remove(),p.remove(),a.destroy(),this.dialog.destroy(),this.dialog=null};return n.promise}destroyCredentials(){if(this.credentials){this.credentials.slice().forEach((e=>{e.destroy()}))}this.emit(\"credentials-destroy\")}enablePostMessageAuth(e=\"https://www.arcgis.com/sharing/rest\"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=o(window,\"message\",(t=>{var s;if((t.origin===this._appOrigin||t.origin.endsWith(\".arcgis.com\"))&&\"arcgis:auth:requestCredential\"===(null==(s=t.data)?void 0:s.type)){const s=t.source;this.getCredential(e).then((e=>{s.postMessage({type:\"arcgis:auth:credential\",credential:{expires:e.expires,server:e.server,ssl:e.ssl,token:e.token,userId:e.userId}},t.origin)})).catch((e=>{s.postMessage({type:\"arcgis:auth:error\",error:{name:e.name,message:e.message}},t.origin)}))}}))}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthHash(){let e=window.location.hash;if(e){\"#\"===e.charAt(0)&&(e=e.substring(1));const t=m(e);let s=!1;if(t.access_token&&t.expires_in&&t.state&&t.hasOwnProperty(\"username\"))try{t.state=JSON.parse(t.state),\"object\"==typeof t.state&&t.state.portalUrl&&(this._oAuthHash=t,s=!0)}catch{}else t.error&&t.error_description&&(console.log(\"IdentityManager OAuth Error: \",t.error,\" - \",t.error_description),\"access_denied\"===t.error&&(s=!0));s&&(window.location.hash=\"object\"==typeof t.state&&t.state.hash||\"\")}}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const e=new i(\"identity-manager:user-aborted\",\"ABORTED\");this._errbackFunc(e)}}_findCredential(e,t){let s,r,i,n,o=-1;const a=t&&t.token,h=t&&t.resource,l=this._isServerRsrc(e)?\"server\":\"portal\",c=this.credentials.filter((t=>this._hasSameServerInstance(t.server,e)&&t.scope===l));if(e=h||e,c.length)if(1===c.length){if(s=c[0],n=this.findServerInfo(s.server),r=n&&n.owningSystemUrl,i=r&&this.findCredential(r,s.userId),o=this._getIdenticalSvcIdx(e,s),!a)return-1===o&&s.resources.push(e),this._addResource(e,i),s;-1!==o&&(s.resources.splice(o,1),this._removeResource(e,i))}else{let t,s;if(c.some((a=>(s=this._getIdenticalSvcIdx(e,a),-1!==s&&(t=a,n=this.findServerInfo(t.server),r=n&&n.owningSystemUrl,i=r&&this.findCredential(r,t.userId),o=s,!0)))),a)t&&(t.resources.splice(o,1),this._removeResource(e,i));else if(t)return this._addResource(e,i),t}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t)for(const s of this.oAuthInfos)if(this._isIdProvider(s.portalUrl,e)){t=s;break}return t}_addResource(e,t){t&&-1===this._getIdenticalSvcIdx(e,t)&&t.resources.push(e)}_removeResource(e,t){let s=-1;t&&(s=this._getIdenticalSvcIdx(e,t),s>-1&&t.resources.splice(s,1))}_useProxy(e,t){return t&&t.isAdmin&&!g(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&\"10.1\"===String(e.currentVersion)&&!g(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const t=new f(e);return t.scheme+\"://\"+t.host+(null!=t.port?\":\"+t.port:\"\")}_getServerInstanceRoot(e){const t=e.toLowerCase();let s=t.indexOf(this._agsRest);return-1===s&&this._isAdminResource(e)&&(s=this._agsAdmin.test(e)?e.replace(this._agsAdmin,\"$1\").length:e.search(this._adminSvcs)),-1===s&&(s=t.indexOf(\"/sharing\")),-1===s&&\"/\"===t.substr(-1)&&(s=t.length-1),s>-1?e.substring(0,s):e}_hasSameServerInstance(e,t){return\"/\"===e.substr(-1)&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=this._normalizeAGOLorgDomain(e),t=this._normalizeAGOLorgDomain(t),(e=e.substr(e.indexOf(\":\")))===(t=t.substr(t.indexOf(\":\")))}_normalizeAGOLorgDomain(e){const t=/^https?:\\/\\/(?:cdn|[a-z\\d-]+\\.maps)\\.arcgis\\.com/i,s=/^https?:\\/\\/(?:cdndev|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,r=/^https?:\\/\\/(?:cdnqa|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i;return t.test(e)?e=e.replace(t,\"https://www.arcgis.com\"):s.test(e)?e=e.replace(s,\"https://devext.arcgis.com\"):r.test(e)&&(e=e.replace(r,\"https://qaext.arcgis.com\")),e}_sanitizeUrl(e){const s=(t.request.proxyUrl||\"\").toLowerCase(),r=s?e.toLowerCase().indexOf(s+\"?\"):-1;return-1!==r&&(e=e.substring(r+s.length+1)),e=v(e),_(e).path}_isRESTService(e){return e.indexOf(this._agsRest)>-1}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let s;if(this._isRESTService(e)&&this._isRESTService(t)){const r=this._getSuffix(e).toLowerCase(),i=this._getSuffix(t).toLowerCase();if(s=r===i,!s){const e=/(.*)\\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;s=r.replace(e,\"$1\")===i.replace(e,\"$1\")}}else this._isAdminResource(e)&&this._isAdminResource(t)?s=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(s=!0);return s}_isPortalDomain(e){const s=new f(e.toLowerCase()),r=this._portalConfig;let i=this._gwDomains.some((e=>e.regex.test(s.uri)));return!i&&r&&(i=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),s.uri)),i||t.portalUrl&&(i=g(s,t.portalUrl,!0)),i||(i=this._portals.some((e=>this._hasSameServerInstance(e,s.uri)))),i=i||this._agsPortal.test(s.path),i}_isIdProvider(e,t){let s=-1,r=-1;this._gwDomains.forEach(((i,n)=>{-1===s&&i.regex.test(e)&&(s=n),-1===r&&i.regex.test(t)&&(r=n)}));let i=!1;if(s>-1&&r>-1&&(0===s||4===s?0!==r&&4!==r||(i=!0):1===s?1!==r&&2!==r||(i=!0):2===s?2===r&&(i=!0):3===s&&3===r&&(i=!0)),!i){const s=this.findServerInfo(t),r=s&&s.owningSystemUrl;r&&b(s)&&this._isPortalDomain(r)&&this._isIdProvider(e,r)&&(i=!0)}return i}_getIdenticalSvcIdx(e,t){let s=-1;for(let r=0;r<t.resources.length;r++){const i=t.resources[r];if(this._isIdenticalService(e,i)){s=r;break}}return s}_getSuffix(e){return e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"$1\")}_getTokenSvcUrl(e){let t,s,i;if(this._isRESTService(e)||this._isAdminResource(e)){const i=this._getServerInstanceRoot(e);return t=i+\"/admin/generateToken\",s=r(e=i+\"/rest/info\",{query:{f:\"json\"}}).then((e=>e.data)),{adminUrl:t,promise:s}}if(this._isPortalDomain(e)){let t=\"\";if(this._gwDomains.some((s=>(s.regex.test(e)&&(t=s.tokenServiceUrl),!!t))),t||this._portals.some((s=>(this._hasSameServerInstance(s,e)&&(t=s+this._gwTokenUrl),!!t))),t||(i=e.toLowerCase().indexOf(\"/sharing\"),-1!==i&&(t=e.substring(0,i)+this._gwTokenUrl)),t||(t=this._getOrigin(e)+this._gwTokenUrl),t){const s=new f(e).port;/^http:\\/\\//i.test(e)&&\"7080\"===s&&(t=t.replace(/:7080/i,\":7443\")),t=t.replace(/http:/i,\"https:\")}return t}if(-1!==e.toLowerCase().indexOf(\"premium.arcgisonline.com\"))return\"https://premium.arcgisonline.com/server/tokens\"}_exchangeToken(e,t,s){return r(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:\"anonymous\",method:\"post\",query:{f:\"json\",client_id:t,token:s}}).then((e=>e.data.token))}_getPlatformSelf(e,t){return r(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:\"anonymous\",headers:{\"X-Esri-Auth-Client-Id\":t,\"X-Esri-Auth-Redirect-Uri\":window.location.href.replace(/#.*$/,\"\")},method:\"post\",query:{f:\"json\"},withCredentials:!0}).then((e=>e.data))}_getPortalSelf(e,t){let s;if(this._gwDomains.some((t=>(t.regex.test(e)&&(s=t.customBaseUrl),!!s))),s)return Promise.resolve({allSSL:!0,currentVersion:\"4.4\",customBaseUrl:s,portalMode:\"multitenant\",supportsOAuth:!0});this._appOrigin.startsWith(\"https:\")?e=e.replace(/^http:/i,\"https:\").replace(/:7080/i,\":7443\"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\"));return r(e,{query:{f:\"json\"},authMode:\"anonymous\",withCredentials:!0}).then((e=>e.data))}_doPortalSignIn(e){const t=this._portalConfig,s=window.location.href,r=this.findServerInfo(e);return!(!t&&!this._isPortalDomain(s)||!(r?r.hasPortal||r.owningSystemUrl&&this._isPortalDomain(r.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(s,e)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),e)||this._isIdProvider(t.restBaseUrl,e))||g(s,e,!0)))}_checkProtocol(e,t,s,r){let n=!0;const o=r?t.adminTokenServiceUrl:t.tokenServiceUrl;if(o.trim().toLowerCase().startsWith(\"https:\")&&!this._appOrigin.startsWith(\"https:\")&&S(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!n)){s(new i(\"identity-manager:aborted\",\"Aborted the Sign-In process to avoid sending password over insecure connection.\"))}return n}_enqueue(e,t,s,r,i,n){return r||(r=d()),r.resUrl_=e,r.sinfo_=t,r.options_=s,r.admin_=i,r.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(r)):this._xoReqs.push(r):this._doSignIn(r),r.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=t=>{const s=e.options_&&e.options_.resource,r=e.resUrl_,i=e.refresh_;let n=!1;-1===this.credentials.indexOf(t)&&(i&&-1!==this.credentials.indexOf(i)?(i.userId=t.userId,i.token=t.token,i.expires=t.expires,i.validity=t.validity,i.ssl=t.ssl,i.creationTime=t.creationTime,n=!0,t=i):this.credentials.push(t)),t.resources||(t.resources=[]),t.resources.push(s||r),t.scope=this._isServerRsrc(r)?\"server\":\"portal\",t.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach((e=>{if(!this._isIdenticalService(r,e.resUrl_)){const s=this._getSuffix(e.resUrl_);a[s]||(a[s]=!0,t.resources.push(e.resUrl_))}})),e.resolve(t),o.forEach((e=>{this._hasSameServerInstance(this._getServerInstanceRoot(r),e.resUrl_)?e.resolve(t):this._soReqs.push(e)})),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,n||this.emit(\"credential-create\",{credential:t}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=t=>{e.reject(t),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=(r,n,a,h)=>{var l,c;const d=e.sinfo_,p=!e.options_||!1!==e.options_.prompt,_=d.hasPortal&&this._findOAuthInfo(e.resUrl_);let f,m;if(r)t(new j({userId:r,server:d.server,token:a||null,expires:null!=h?Number(h):null,ssl:!!n}));else if(window!==window.parent&&null!=(l=this._appUrlObj.query)&&l[\"arcgis-auth-origin\"]&&null!=(c=this._appUrlObj.query)&&c[\"arcgis-auth-portal\"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query[\"arcgis-auth-portal\"]),e.resUrl_)){var v;window.parent.postMessage({type:\"arcgis:auth:requestCredential\"},this._appUrlObj.query[\"arcgis-auth-origin\"]);const r=o(window,\"message\",(e=>{e.source===window.parent&&e.data&&(\"arcgis:auth:credential\"===e.data.type?(r.remove(),t(new j(e.data.credential))):\"arcgis:auth:error\"===e.data.type&&(r.remove(),s(i.fromJSON(e.data.error))))}));u(null==(v=e.options_)?void 0:v.signal,(()=>{r.remove()}))}else if(_){let r=_._oAuthCred;if(!r){const e=new T(_,C),t=new T(_,D);e.isValid()&&t.isValid()?e.expires>t.expires?(r=e,t.destroy()):(r=t,e.destroy()):r=e.isValid()?e:t,_._oAuthCred=r}if(r.isValid())f=new j({userId:r.userId,server:d.server,token:r.token,expires:r.expires,ssl:r.ssl,_oAuthCred:r}),_.appId!==r.appId&&this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._exchangeToken(f.server,_.appId,f.token).then((e=>{f.token=e,r.token=e,r.save(),t(f)})).catch((()=>{t(f)})):t(f);else if(this._oAuthHash&&this._hasSameServerInstance(_.portalUrl,this._oAuthHash.state.portalUrl)){const e=this._oAuthHash;f=new j({userId:e.username,server:d.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:\"true\"===e.ssl,oAuthState:e.state,_oAuthCred:r}),_.userId=f.userId,r.storage=e.persist?C:D,r.token=f.token,r.expires=f.expires,r.userId=f.userId,r.ssl=f.ssl,r.save(),this._oAuthHash=null,t(f)}else{const r=()=>{p?e._pendingDfd=this.oAuthSignIn(e.resUrl_,d,_,e.options_).then(t,s):(m=new i(\"identity-manager:not-authenticated\",\"User is not signed in.\"),s(m))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(d.server,_.appId).then((({portalUrl:e,token:s,username:i})=>{!e||g(e,this._appOrigin,!0)?(f=new j({server:d.server,userId:i,token:s}),t(f)):r()})).catch(r):r()}}else if(p){if(this._checkProtocol(e.resUrl_,d,s,e.admin_)){let r=e.options_;e.admin_&&(r=r||{},r.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,d,r).then(t,s)}}else m=new i(\"identity-manager:not-authenticated\",\"User is not signed in.\"),s(m)},n=()=>{const r=e.sinfo_,i=r.owningSystemUrl,n=e.options_;let o,a,h,l;if(n&&(o=n.token,a=n.error,h=n.prompt),l=this._findCredential(i,{token:o,resource:e.resUrl_}),!l)for(const e of this.credentials)if(this._isIdProvider(i,e.server)){l=e;break}if(l){const i=this.findCredential(e.resUrl_,l.userId);if(i)t(i);else if(P(r,this._legacyFed)){const e=l.toJSON();e.server=r.server,e.resources=null,t(new j(e))}else{(e._pendingDfd=this.generateToken(this.findServerInfo(l.server),null,{serverUrl:e.resUrl_,token:l.token,signal:e.options_.signal,ssl:l.ssl})).then((s=>{t(new j({userId:l.userId,server:r.server,token:s.token,expires:null!=s.expires?Number(s.expires):null,ssl:!!s.ssl,isAdmin:e.admin_,validity:s.validity}))}),s)}}else{this._busy=null,o&&(e.options_.token=null);(e._pendingDfd=this.getCredential(i.replace(/\\/?$/,\"/sharing\"),{resource:e.resUrl_,owningTenant:r.owningTenant,signal:e.options_.signal,token:o,error:a,prompt:h})).then((()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)}),(e=>{s(e)}))}};this._errbackFunc=s;const a=e.sinfo_.owningSystemUrl,h=this._isServerRsrc(e.resUrl_),c=e.sinfo_._restInfoPms;c?c.promise.then((t=>{const s=e.sinfo_;if(s._restInfoPms){s.adminTokenServiceUrl=s._restInfoPms.adminUrl,s._restInfoPms=null,s.tokenServiceUrl=l(\"authInfo.tokenServicesUrl\",t)||l(\"authInfo.tokenServiceUrl\",t)||l(\"tokenServiceUrl\",t),s.shortLivedTokenValidity=l(\"authInfo.shortLivedTokenValidity\",t),s.currentVersion=t.currentVersion,s.owningTenant=t.owningTenant;const e=s.owningSystemUrl=t.owningSystemUrl;e&&this._portals.push(e)}h&&s.owningSystemUrl?n():r()}),(()=>{e.sinfo_._restInfoPms=null;const t=new i(\"identity-manager:server-identification-failed\",\"Unknown resource - could not find token service endpoint.\");s(t)})):h&&a?n():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then((t=>{const s={};let r,i,n,o;return t&&(r=t.user&&t.user.username,s.username=r,s.allSSL=t.allSSL,i=t.supportsOAuth,n=t.currentVersion,\"multitenant\"===t.portalMode&&(o=t.customBaseUrl)),e.sinfo_.webTierAuth=!!r,r&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:s.allSSL}).catch((()=>null)).then((e=>(s.portalToken=e&&e.token,s.tokenExpiration=e&&e.expires,s))):!r&&i&&parseFloat(n)>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:o,owningTenant:e.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>s)):s})).catch((()=>null)).then((t=>{e.sinfo_._selfReq=null,t?r(t.username,t.allSSL,t.portalToken,t.tokenExpiration):r()})):r()}_generateOAuthInfo(e){let t,s,i=e.portalUrl;const n=e.customBaseUrl,o=e.owningTenant,a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){s=window.location.href;let e=s.indexOf(\"?\");e>-1&&(s=s.slice(0,e)),e=s.search(/\\/(apps|home)\\//),s=e>-1?s.slice(0,e):null}return a&&s?(this._hasTestedIfAppIsOnPortal=!0,t=r(s+\"/sharing/rest\",{query:{f:\"json\"}}).then((()=>{this.defaultOAuthInfo=new x({appId:\"arcgisonline\",popupCallbackUrl:s+\"/home/oauth-callback.html\"})}))):t=Promise.resolve(),t.then((()=>{if(this.defaultOAuthInfo)return i=i.replace(/^http:/i,\"https:\"),r(i+\"/sharing/rest/oauth2/validateRedirectUri\",{query:{accountId:o,client_id:this.defaultOAuthInfo.appId,redirect_uri:w(this.defaultOAuthInfo.popupCallbackUrl),f:\"json\"}}).then((e=>{if(e.data.valid){const t=this.defaultOAuthInfo.clone();e.data.urlKey&&n?t.portalUrl=\"https://\"+e.data.urlKey.toLowerCase()+\".\"+n:t.portalUrl=i,t.popup=window!==window.top||!(g(i,this._appOrigin)||this._gwDomains.some((e=>e.regex.test(i)&&e.regex.test(this._appOrigin)))),this.oAuthInfos.push(t)}}))}))}_doOAuthSignIn(e,t,s){const r={portalUrl:s.portalUrl};!s.popup&&s.preserveUrlHash&&window.location.hash&&(r.hash=window.location.hash);const n={client_id:s.appId,response_type:\"token\",state:JSON.stringify(r),expiration:s.expiration,locale:s.locale,redirect_uri:s.popup?w(s.popupCallbackUrl):window.location.href.replace(/#.*$/,\"\")};s.forceLogin&&(n.force_login=!0),s.forceUserId&&s.userId&&(n.prepopulatedusername=s.userId),!s.popup&&this._doPortalSignIn(e)&&(n.redirectToUserOrgUrl=!0);const h=s.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/oauth2/authorize\",l=h+\"?\"+I(n);if(s.popup){const e=window.open(l,\"esriJSAPIOAuth\",s.popupWindowFeatures);if(e)e.focus(),this._oAuthDfd.oAuthWin_=e,this._oAuthIntervalId=setInterval((()=>{if(e.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnHashHandle.remove();const e=this._oAuthDfd;if(e){const t=new i(\"identity-manager:user-aborted\",\"ABORTED\");e.reject(t)}}}),500),this._oAuthOnHashHandle=o(a,\"arcgis:auth:hash\",(e=>{this.setOAuthResponseHash(e.detail)}));else{const e=new i(\"identity-manager:popup-blocked\",\"ABORTED\");this._oAuthDfd.reject(e)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:n,authorizeUrl:h,resourceUrl:e,serverInfo:t,oAuthInfo:s}):window.location.href=l}}q.prototype.declaredClass=\"esri.identity.IdentityManagerBase\";let j=class extends n.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const e=s.findServerInfo(this.server),t=e&&e.owningSystemUrl,r=!!t&&\"server\"===this.scope,i=r&&P(e,s._legacyFed),n=e.webTierAuth,o=n&&s.normalizeWebTierAuth,a=R[this.server],h=a&&a[this.userId];let l,c=this.resources&&this.resources[0],d=r&&s.findServerInfo(t),u={username:this.userId,password:h};if(n&&!o)return;r&&!d&&s.serverInfos.some((e=>(s._isIdProvider(t,e.server)&&(d=e),!!d)));const p=d&&s.findCredential(d.server,this.userId);if(!r||p){if(!i){if(r)l={serverUrl:c,token:p&&p.token,ssl:p&&p.ssl};else if(o)u=null,l={ssl:this.ssl};else{if(!h){let t;return c&&(c=s._sanitizeUrl(c),this._enqueued=1,t=s._enqueue(c,e,null,null,this.isAdmin,this),t.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),t}this.isAdmin&&(l={isAdmin:!0})}return s.generateToken(r?d:e,r?null:u,l).then((e=>{this.token=e.token,this.expires=null!=e.expires?Number(e.expires):null,this.creationTime=Date.now(),this.validity=e.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}p.refreshToken()}}refreshServerTokens(){\"portal\"===this.scope&&s.credentials.forEach((e=>{const t=s.findServerInfo(e.server),r=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&\"server\"===e.scope&&(s._hasSameServerInstance(this.server,r)||s._isIdProvider(r,this.server))&&(P(t,s._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())}))}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&s.findServerInfo(this.server),r=t&&t.owningSystemUrl,i=r&&s.findServerInfo(r);!1===e||r&&\"portal\"!==this.scope&&(!i||!i.webTierAuth||s.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit(\"token-change\")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=s.credentials.indexOf(this);e>-1&&s.credentials.splice(e,1),this.emitTokenChange(),this.emit(\"destroy\")}toJSON(){const e=h({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,t=2**31-1;let s=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();s<0?s=0:s>t&&(s=t),this._refreshTimer=setTimeout(this.refreshToken.bind(this),s>e?s-e:s)}};e([k()],j.prototype,\"creationTime\",void 0),e([k()],j.prototype,\"expires\",void 0),e([k()],j.prototype,\"isAdmin\",void 0),e([k()],j.prototype,\"oAuthState\",void 0),e([k()],j.prototype,\"resources\",void 0),e([k()],j.prototype,\"scope\",void 0),e([k()],j.prototype,\"server\",void 0),e([k()],j.prototype,\"ssl\",void 0),e([k()],j.prototype,\"token\",void 0),e([k()],j.prototype,\"tokenRefreshBuffer\",void 0),e([k()],j.prototype,\"userId\",void 0),e([k()],j.prototype,\"validity\",void 0),j=e([A(\"esri.identity.Credential\")],j);export{j as Credential,q as IdentityManagerBase};\n"]},"metadata":{},"sourceType":"module"}