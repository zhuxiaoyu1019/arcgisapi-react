{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Accessor.js\";\nimport \"../../../core/has.js\";\nimport s from \"../../../core/Handles.js\";\nimport { isSome as r, destroyMaybe as i, isNone as n } from \"../../../core/maybe.js\";\nimport { when as o, init as h } from \"../../../core/watchUtils.js\";\nimport { property as a } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as p } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { isMoon as m, isMars as d } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport l from \"./PanoramicAtmosphere.js\";\nimport { RealisticAtmosphere as _ } from \"./RealisticAtmosphere.js\";\nimport u from \"./SimpleAtmosphere.js\";\nimport { Stars as c } from \"./Stars.js\";\nconst v = [14, 15];\nlet g = class extends t {\n  constructor() {\n    super(...arguments), this._handles = new s(), this._context = null, this._pendingAtmosphere = null, this._atmosphere = null, this._stars = null;\n  }\n\n  get canRender() {\n    return !(!this.view.basemapTerrain || !this.view.basemapTerrain.renderer.canRender) || \"global\" !== this.view.viewingMode;\n  }\n\n  get updating() {\n    return r(this._pendingAtmosphere) || r(this._stars) && this._stars.updating;\n  }\n\n  initialize() {\n    this.view._stage.addRenderPlugin(v, this);\n  }\n\n  destroy() {\n    this._pendingAtmosphere = i(this._pendingAtmosphere), this._atmosphere = i(this._atmosphere), this._stars = i(this._stars), this._handles = i(this._handles), this.view && null != this.view._stage && (this.view._stage.removeRenderPlugin(this), this._set(\"view\", null));\n  }\n\n  initializeRenderContext(e) {\n    this._context = e, this.setup();\n  }\n\n  setup() {\n    this._handles.add(o(this.view, \"basemapTerrain\", () => this._updateBasemapTerrain(), !0)), this._handles.add([h(this.view, [\"viewingMode\", \"environment.atmosphereEnabled\", \"environment.atmosphere.quality\"], () => this._updateAtmosphere(), !0), h(this.view, \"environment.starsEnabled\", () => this._updateStars(), !0)]);\n  }\n\n  uninitializeRenderContext() {\n    r(this._stars) && (this._stars.uninitializeRenderContext(), this._stars.destroy(), this._stars = null), r(this._atmosphere) && (this._atmosphere.uninitializeRenderContext(), this._atmosphere.destroy(), this._atmosphere = null);\n  }\n\n  render(e) {\n    let t = !0;\n    return r(this._stars) && this._stars.canRender && (t = this._stars.render(e) && t), r(this._atmosphere) && this._atmosphere.canRender && (t = this._atmosphere.render(e) && t), t;\n  }\n\n  _setNeedsRender() {\n    this._context && this._context.requestRender();\n  }\n\n  _updateStars() {\n    var e, t, s;\n    const i = null != (e = null == (t = this.view) || null == (s = t.environment) ? void 0 : s.starsEnabled) && e;\n    i && n(this._stars) ? (this._stars = new c({\n      view: this.view\n    }), this._stars.initializeRenderContext(this._context), this._setNeedsRender()) : !i && r(this._stars) && (this._stars.destroy(), this._stars = null, this._setNeedsRender());\n  }\n\n  _updateAtmosphere() {\n    const e = this._getAtmosphereType();\n\n    if (this.atmosphereType === e) return;\n    this.atmosphereType = e, r(this._pendingAtmosphere) && (this._pendingAtmosphere !== this._atmosphere && this._pendingAtmosphere.destroy(), this._pendingAtmosphere = null);\n\n    const t = this._getAtmosphereClass();\n\n    if (!t) return r(this._atmosphere) && (this._atmosphere.destroy(), this._atmosphere = null, this._setNeedsRender()), void this._updateBasemapTerrain();\n    const s = new t(this.view);\n    s.initializeRenderContext(this._context), n(this._atmosphere) && (this._atmosphere = s, this._setNeedsRender()), this._pendingAtmosphere = s, s.when().then(() => {\n      r(this._atmosphere) && this._pendingAtmosphere !== this._atmosphere && (this._atmosphere.destroy(), this._atmosphere = this._pendingAtmosphere), this._pendingAtmosphere = null, this._setNeedsRender(), this._updateBasemapTerrain();\n    }).catch(() => {\n      this._pendingAtmosphere === s && (this._pendingAtmosphere = null);\n    });\n  }\n\n  _getAtmosphereClass() {\n    const e = this._getAtmosphereType();\n\n    if (this.atmosphereClassFromType) return this.atmosphereClassFromType(e);\n\n    switch (e) {\n      case \"none\":\n        return null;\n\n      case \"realistic\":\n        return _;\n\n      case \"panoramic\":\n        return l;\n\n      case \"simple\":\n        return u;\n\n      default:\n        return;\n    }\n  }\n\n  _getAtmosphereType() {\n    const e = this.view.get(\"environment.atmosphereEnabled\"),\n          t = this.view.get(\"environment.atmosphere.quality\"),\n          s = this.view.viewingMode;\n    return !e || null == t || m(this.view.spatialReference) ? \"none\" : \"local\" === s ? \"panoramic\" : \"high\" === t && _.isSupported(this._context) && !d(this.view.spatialReference) ? \"realistic\" : \"simple\";\n  }\n\n  _updateBasemapTerrain() {\n    const e = this.view.basemapTerrain;\n    e && (e.velvetOverground = null != this._atmosphere && \"simple\" === this.atmosphereType);\n  }\n\n  get test() {\n    return {\n      atmosphere: this._atmosphere\n    };\n  }\n\n};\ne([a({\n  constructOnly: !0\n})], g.prototype, \"view\", void 0), e([a({\n  constructOnly: !0\n})], g.prototype, \"atmosphereClassFromType\", void 0), e([a()], g.prototype, \"updating\", null), e([a()], g.prototype, \"_pendingAtmosphere\", void 0), e([a()], g.prototype, \"_stars\", void 0), g = e([p(\"esri.views.3d.environment.EnvironmentRenderer\")], g);\nvar w = g;\nexport default w;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/environment/EnvironmentRenderer.js"],"names":["_","e","t","s","isSome","r","destroyMaybe","i","isNone","n","when","o","init","h","property","a","subclass","p","isMoon","m","isMars","d","l","RealisticAtmosphere","u","Stars","c","v","g","constructor","arguments","_handles","_context","_pendingAtmosphere","_atmosphere","_stars","canRender","view","basemapTerrain","renderer","viewingMode","updating","initialize","_stage","addRenderPlugin","destroy","removeRenderPlugin","_set","initializeRenderContext","setup","add","_updateBasemapTerrain","_updateAtmosphere","_updateStars","uninitializeRenderContext","render","_setNeedsRender","requestRender","environment","starsEnabled","_getAtmosphereType","atmosphereType","_getAtmosphereClass","then","catch","atmosphereClassFromType","get","spatialReference","isSupported","velvetOverground","test","atmosphere","constructOnly","prototype","w"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,8BAAlB;AAAiD,OAAOC,CAAP,MAAa,2BAAb;AAAyC,OAAM,sBAAN;AAA6B,OAAOC,CAAP,MAAa,0BAAb;AAAwC,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,YAAY,IAAIC,CAAnC,EAAqCC,MAAM,IAAIC,CAA/C,QAAqD,wBAArD;AAA8E,SAAOC,IAAI,IAAIC,CAAf,EAAiBC,IAAI,IAAIC,CAAzB,QAA+B,6BAA/B;AAA6D,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,sDAAzB;AAAgF,OAAM,6CAAN;AAAoD,OAAM,yBAAN;AAAgC,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,sDAAzB;AAAgF,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,QAAmC,oDAAnC;AAAwF,OAAOC,CAAP,MAAa,0BAAb;AAAwC,SAAOC,mBAAmB,IAAIvB,CAA9B,QAAoC,0BAApC;AAA+D,OAAOwB,CAAP,MAAa,uBAAb;AAAqC,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,YAAtB;AAAmC,MAAMC,CAAC,GAAC,CAAC,EAAD,EAAI,EAAJ,CAAR;AAAgB,IAAIC,CAAC,GAAC,cAAc1B,CAAd,CAAe;AAAC2B,EAAAA,WAAW,GAAE;AAAC,UAAM,GAAGC,SAAT,GAAoB,KAAKC,QAAL,GAAc,IAAI5B,CAAJ,EAAlC,EAAwC,KAAK6B,QAAL,GAAc,IAAtD,EAA2D,KAAKC,kBAAL,GAAwB,IAAnF,EAAwF,KAAKC,WAAL,GAAiB,IAAzG,EAA8G,KAAKC,MAAL,GAAY,IAA1H;AAA+H;;AAAa,MAATC,SAAS,GAAE;AAAC,WAAM,EAAE,CAAC,KAAKC,IAAL,CAAUC,cAAX,IAA2B,CAAC,KAAKD,IAAL,CAAUC,cAAV,CAAyBC,QAAzB,CAAkCH,SAAhE,KAA4E,aAAW,KAAKC,IAAL,CAAUG,WAAvG;AAAmH;;AAAY,MAARC,QAAQ,GAAE;AAAC,WAAOpC,CAAC,CAAC,KAAK4B,kBAAN,CAAD,IAA4B5B,CAAC,CAAC,KAAK8B,MAAN,CAAD,IAAgB,KAAKA,MAAL,CAAYM,QAA/D;AAAwE;;AAAAC,EAAAA,UAAU,GAAE;AAAC,SAAKL,IAAL,CAAUM,MAAV,CAAiBC,eAAjB,CAAiCjB,CAAjC,EAAmC,IAAnC;AAAyC;;AAAAkB,EAAAA,OAAO,GAAE;AAAC,SAAKZ,kBAAL,GAAwB1B,CAAC,CAAC,KAAK0B,kBAAN,CAAzB,EAAmD,KAAKC,WAAL,GAAiB3B,CAAC,CAAC,KAAK2B,WAAN,CAArE,EAAwF,KAAKC,MAAL,GAAY5B,CAAC,CAAC,KAAK4B,MAAN,CAArG,EAAmH,KAAKJ,QAAL,GAAcxB,CAAC,CAAC,KAAKwB,QAAN,CAAlI,EAAkJ,KAAKM,IAAL,IAAW,QAAM,KAAKA,IAAL,CAAUM,MAA3B,KAAoC,KAAKN,IAAL,CAAUM,MAAV,CAAiBG,kBAAjB,CAAoC,IAApC,GAA0C,KAAKC,IAAL,CAAU,MAAV,EAAiB,IAAjB,CAA9E,CAAlJ;AAAwP;;AAAAC,EAAAA,uBAAuB,CAAC/C,CAAD,EAAG;AAAC,SAAK+B,QAAL,GAAc/B,CAAd,EAAgB,KAAKgD,KAAL,EAAhB;AAA6B;;AAAAA,EAAAA,KAAK,GAAE;AAAC,SAAKlB,QAAL,CAAcmB,GAAd,CAAkBvC,CAAC,CAAC,KAAK0B,IAAN,EAAW,gBAAX,EAA6B,MAAI,KAAKc,qBAAL,EAAjC,EAA+D,CAAC,CAAhE,CAAnB,GAAuF,KAAKpB,QAAL,CAAcmB,GAAd,CAAkB,CAACrC,CAAC,CAAC,KAAKwB,IAAN,EAAW,CAAC,aAAD,EAAe,+BAAf,EAA+C,gCAA/C,CAAX,EAA6F,MAAI,KAAKe,iBAAL,EAAjG,EAA2H,CAAC,CAA5H,CAAF,EAAiIvC,CAAC,CAAC,KAAKwB,IAAN,EAAW,0BAAX,EAAuC,MAAI,KAAKgB,YAAL,EAA3C,EAAgE,CAAC,CAAjE,CAAlI,CAAlB,CAAvF;AAAiT;;AAAAC,EAAAA,yBAAyB,GAAE;AAACjD,IAAAA,CAAC,CAAC,KAAK8B,MAAN,CAAD,KAAiB,KAAKA,MAAL,CAAYmB,yBAAZ,IAAwC,KAAKnB,MAAL,CAAYU,OAAZ,EAAxC,EAA8D,KAAKV,MAAL,GAAY,IAA3F,GAAiG9B,CAAC,CAAC,KAAK6B,WAAN,CAAD,KAAsB,KAAKA,WAAL,CAAiBoB,yBAAjB,IAA6C,KAAKpB,WAAL,CAAiBW,OAAjB,EAA7C,EAAwE,KAAKX,WAAL,GAAiB,IAA/G,CAAjG;AAAsN;;AAAAqB,EAAAA,MAAM,CAACtD,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,CAAC,CAAP;AAAS,WAAOG,CAAC,CAAC,KAAK8B,MAAN,CAAD,IAAgB,KAAKA,MAAL,CAAYC,SAA5B,KAAwClC,CAAC,GAAC,KAAKiC,MAAL,CAAYoB,MAAZ,CAAmBtD,CAAnB,KAAuBC,CAAjE,GAAoEG,CAAC,CAAC,KAAK6B,WAAN,CAAD,IAAqB,KAAKA,WAAL,CAAiBE,SAAtC,KAAkDlC,CAAC,GAAC,KAAKgC,WAAL,CAAiBqB,MAAjB,CAAwBtD,CAAxB,KAA4BC,CAAhF,CAApE,EAAuJA,CAA9J;AAAgK;;AAAAsD,EAAAA,eAAe,GAAE;AAAC,SAAKxB,QAAL,IAAe,KAAKA,QAAL,CAAcyB,aAAd,EAAf;AAA6C;;AAAAJ,EAAAA,YAAY,GAAE;AAAC,QAAIpD,CAAJ,EAAMC,CAAN,EAAQC,CAAR;AAAU,UAAMI,CAAC,GAAC,SAAON,CAAC,GAAC,SAAOC,CAAC,GAAC,KAAKmC,IAAd,KAAqB,SAAOlC,CAAC,GAACD,CAAC,CAACwD,WAAX,CAArB,GAA6C,KAAK,CAAlD,GAAoDvD,CAAC,CAACwD,YAA/D,KAA8E1D,CAAtF;AAAwFM,IAAAA,CAAC,IAAEE,CAAC,CAAC,KAAK0B,MAAN,CAAJ,IAAmB,KAAKA,MAAL,GAAY,IAAIT,CAAJ,CAAM;AAACW,MAAAA,IAAI,EAAC,KAAKA;AAAX,KAAN,CAAZ,EAAoC,KAAKF,MAAL,CAAYa,uBAAZ,CAAoC,KAAKhB,QAAzC,CAApC,EAAuF,KAAKwB,eAAL,EAA1G,IAAkI,CAACjD,CAAD,IAAIF,CAAC,CAAC,KAAK8B,MAAN,CAAL,KAAqB,KAAKA,MAAL,CAAYU,OAAZ,IAAsB,KAAKV,MAAL,GAAY,IAAlC,EAAuC,KAAKqB,eAAL,EAA5D,CAAlI;AAAsN;;AAAAJ,EAAAA,iBAAiB,GAAE;AAAC,UAAMnD,CAAC,GAAC,KAAK2D,kBAAL,EAAR;;AAAkC,QAAG,KAAKC,cAAL,KAAsB5D,CAAzB,EAA2B;AAAO,SAAK4D,cAAL,GAAoB5D,CAApB,EAAsBI,CAAC,CAAC,KAAK4B,kBAAN,CAAD,KAA6B,KAAKA,kBAAL,KAA0B,KAAKC,WAA/B,IAA4C,KAAKD,kBAAL,CAAwBY,OAAxB,EAA5C,EAA8E,KAAKZ,kBAAL,GAAwB,IAAnI,CAAtB;;AAA+J,UAAM/B,CAAC,GAAC,KAAK4D,mBAAL,EAAR;;AAAmC,QAAG,CAAC5D,CAAJ,EAAM,OAAOG,CAAC,CAAC,KAAK6B,WAAN,CAAD,KAAsB,KAAKA,WAAL,CAAiBW,OAAjB,IAA2B,KAAKX,WAAL,GAAiB,IAA5C,EAAiD,KAAKsB,eAAL,EAAvE,GAA+F,KAAK,KAAKL,qBAAL,EAA3G;AAAwI,UAAMhD,CAAC,GAAC,IAAID,CAAJ,CAAM,KAAKmC,IAAX,CAAR;AAAyBlC,IAAAA,CAAC,CAAC6C,uBAAF,CAA0B,KAAKhB,QAA/B,GAAyCvB,CAAC,CAAC,KAAKyB,WAAN,CAAD,KAAsB,KAAKA,WAAL,GAAiB/B,CAAjB,EAAmB,KAAKqD,eAAL,EAAzC,CAAzC,EAA0G,KAAKvB,kBAAL,GAAwB9B,CAAlI,EAAoIA,CAAC,CAACO,IAAF,GAASqD,IAAT,CAAe,MAAI;AAAC1D,MAAAA,CAAC,CAAC,KAAK6B,WAAN,CAAD,IAAqB,KAAKD,kBAAL,KAA0B,KAAKC,WAApD,KAAkE,KAAKA,WAAL,CAAiBW,OAAjB,IAA2B,KAAKX,WAAL,GAAiB,KAAKD,kBAAnH,GAAuI,KAAKA,kBAAL,GAAwB,IAA/J,EAAoK,KAAKuB,eAAL,EAApK,EAA2L,KAAKL,qBAAL,EAA3L;AAAwN,KAA5O,EAA+Oa,KAA/O,CAAsP,MAAI;AAAC,WAAK/B,kBAAL,KAA0B9B,CAA1B,KAA8B,KAAK8B,kBAAL,GAAwB,IAAtD;AAA4D,KAAvT,CAApI;AAA8b;;AAAA6B,EAAAA,mBAAmB,GAAE;AAAC,UAAM7D,CAAC,GAAC,KAAK2D,kBAAL,EAAR;;AAAkC,QAAG,KAAKK,uBAAR,EAAgC,OAAO,KAAKA,uBAAL,CAA6BhE,CAA7B,CAAP;;AAAuC,YAAOA,CAAP;AAAU,WAAI,MAAJ;AAAW,eAAO,IAAP;;AAAY,WAAI,WAAJ;AAAgB,eAAOD,CAAP;;AAAS,WAAI,WAAJ;AAAgB,eAAOsB,CAAP;;AAAS,WAAI,QAAJ;AAAa,eAAOE,CAAP;;AAAS;AAAQ;AAAjH;AAAyH;;AAAAoC,EAAAA,kBAAkB,GAAE;AAAC,UAAM3D,CAAC,GAAC,KAAKoC,IAAL,CAAU6B,GAAV,CAAc,+BAAd,CAAR;AAAA,UAAuDhE,CAAC,GAAC,KAAKmC,IAAL,CAAU6B,GAAV,CAAc,gCAAd,CAAzD;AAAA,UAAyG/D,CAAC,GAAC,KAAKkC,IAAL,CAAUG,WAArH;AAAiI,WAAM,CAACvC,CAAD,IAAI,QAAMC,CAAV,IAAaiB,CAAC,CAAC,KAAKkB,IAAL,CAAU8B,gBAAX,CAAd,GAA2C,MAA3C,GAAkD,YAAUhE,CAAV,GAAY,WAAZ,GAAwB,WAASD,CAAT,IAAYF,CAAC,CAACoE,WAAF,CAAc,KAAKpC,QAAnB,CAAZ,IAA0C,CAACX,CAAC,CAAC,KAAKgB,IAAL,CAAU8B,gBAAX,CAA5C,GAAyE,WAAzE,GAAqF,QAArK;AAA8K;;AAAAhB,EAAAA,qBAAqB,GAAE;AAAC,UAAMlD,CAAC,GAAC,KAAKoC,IAAL,CAAUC,cAAlB;AAAiCrC,IAAAA,CAAC,KAAGA,CAAC,CAACoE,gBAAF,GAAmB,QAAM,KAAKnC,WAAX,IAAwB,aAAW,KAAK2B,cAA9D,CAAD;AAA+E;;AAAQ,MAAJS,IAAI,GAAE;AAAC,WAAM;AAACC,MAAAA,UAAU,EAAC,KAAKrC;AAAjB,KAAN;AAAoC;;AAA96G,CAArB;AAAq8GjC,CAAC,CAAC,CAACc,CAAC,CAAC;AAACyD,EAAAA,aAAa,EAAC,CAAC;AAAhB,CAAD,CAAF,CAAD,EAAyB5C,CAAC,CAAC6C,SAA3B,EAAqC,MAArC,EAA4C,KAAK,CAAjD,CAAD,EAAqDxE,CAAC,CAAC,CAACc,CAAC,CAAC;AAACyD,EAAAA,aAAa,EAAC,CAAC;AAAhB,CAAD,CAAF,CAAD,EAAyB5C,CAAC,CAAC6C,SAA3B,EAAqC,yBAArC,EAA+D,KAAK,CAApE,CAAtD,EAA6HxE,CAAC,CAAC,CAACc,CAAC,EAAF,CAAD,EAAOa,CAAC,CAAC6C,SAAT,EAAmB,UAAnB,EAA8B,IAA9B,CAA9H,EAAkKxE,CAAC,CAAC,CAACc,CAAC,EAAF,CAAD,EAAOa,CAAC,CAAC6C,SAAT,EAAmB,oBAAnB,EAAwC,KAAK,CAA7C,CAAnK,EAAmNxE,CAAC,CAAC,CAACc,CAAC,EAAF,CAAD,EAAOa,CAAC,CAAC6C,SAAT,EAAmB,QAAnB,EAA4B,KAAK,CAAjC,CAApN,EAAwP7C,CAAC,GAAC3B,CAAC,CAAC,CAACgB,CAAC,CAAC,+CAAD,CAAF,CAAD,EAAsDW,CAAtD,CAA3P;AAAoT,IAAI8C,CAAC,GAAC9C,CAAN;AAAQ,eAAe8C,CAAf","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import\"../../../core/has.js\";import s from\"../../../core/Handles.js\";import{isSome as r,destroyMaybe as i,isNone as n}from\"../../../core/maybe.js\";import{when as o,init as h}from\"../../../core/watchUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import{isMoon as m,isMars as d}from\"../../../geometry/support/spatialReferenceUtils.js\";import l from\"./PanoramicAtmosphere.js\";import{RealisticAtmosphere as _}from\"./RealisticAtmosphere.js\";import u from\"./SimpleAtmosphere.js\";import{Stars as c}from\"./Stars.js\";const v=[14,15];let g=class extends t{constructor(){super(...arguments),this._handles=new s,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null,this._stars=null}get canRender(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||\"global\"!==this.view.viewingMode}get updating(){return r(this._pendingAtmosphere)||r(this._stars)&&this._stars.updating}initialize(){this.view._stage.addRenderPlugin(v,this)}destroy(){this._pendingAtmosphere=i(this._pendingAtmosphere),this._atmosphere=i(this._atmosphere),this._stars=i(this._stars),this._handles=i(this._handles),this.view&&null!=this.view._stage&&(this.view._stage.removeRenderPlugin(this),this._set(\"view\",null))}initializeRenderContext(e){this._context=e,this.setup()}setup(){this._handles.add(o(this.view,\"basemapTerrain\",(()=>this._updateBasemapTerrain()),!0)),this._handles.add([h(this.view,[\"viewingMode\",\"environment.atmosphereEnabled\",\"environment.atmosphere.quality\"],(()=>this._updateAtmosphere()),!0),h(this.view,\"environment.starsEnabled\",(()=>this._updateStars()),!0)])}uninitializeRenderContext(){r(this._stars)&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null),r(this._atmosphere)&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)}render(e){let t=!0;return r(this._stars)&&this._stars.canRender&&(t=this._stars.render(e)&&t),r(this._atmosphere)&&this._atmosphere.canRender&&(t=this._atmosphere.render(e)&&t),t}_setNeedsRender(){this._context&&this._context.requestRender()}_updateStars(){var e,t,s;const i=null!=(e=null==(t=this.view)||null==(s=t.environment)?void 0:s.starsEnabled)&&e;i&&n(this._stars)?(this._stars=new c({view:this.view}),this._stars.initializeRenderContext(this._context),this._setNeedsRender()):!i&&r(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())}_updateAtmosphere(){const e=this._getAtmosphereType();if(this.atmosphereType===e)return;this.atmosphereType=e,r(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return r(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const s=new t(this.view);s.initializeRenderContext(this._context),n(this._atmosphere)&&(this._atmosphere=s,this._setNeedsRender()),this._pendingAtmosphere=s,s.when().then((()=>{r(this._atmosphere)&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()})).catch((()=>{this._pendingAtmosphere===s&&(this._pendingAtmosphere=null)}))}_getAtmosphereClass(){const e=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(e);switch(e){case\"none\":return null;case\"realistic\":return _;case\"panoramic\":return l;case\"simple\":return u;default:return}}_getAtmosphereType(){const e=this.view.get(\"environment.atmosphereEnabled\"),t=this.view.get(\"environment.atmosphere.quality\"),s=this.view.viewingMode;return!e||null==t||m(this.view.spatialReference)?\"none\":\"local\"===s?\"panoramic\":\"high\"===t&&_.isSupported(this._context)&&!d(this.view.spatialReference)?\"realistic\":\"simple\"}_updateBasemapTerrain(){const e=this.view.basemapTerrain;e&&(e.velvetOverground=null!=this._atmosphere&&\"simple\"===this.atmosphereType)}get test(){return{atmosphere:this._atmosphere}}};e([a({constructOnly:!0})],g.prototype,\"view\",void 0),e([a({constructOnly:!0})],g.prototype,\"atmosphereClassFromType\",void 0),e([a()],g.prototype,\"updating\",null),e([a()],g.prototype,\"_pendingAtmosphere\",void 0),e([a()],g.prototype,\"_stars\",void 0),g=e([p(\"esri.views.3d.environment.EnvironmentRenderer\")],g);var w=g;export default w;\n"]},"metadata":{},"sourceType":"module"}