{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../sources/Empty.js\";\nimport t from \"../support/FeatureSet.js\";\nimport r from \"../support/IdSet.js\";\nimport { IdState as i, shapeExtent as n } from \"../support/shared.js\";\nimport { resolve as a, all as s, reject as l } from \"../../../core/promiseUtils.js\";\nimport { relate as o, crosses as u, touches as h, within as _, overlaps as c, contains as p, intersects as f } from \"../../../geometry/geometryEngineAsync.js\";\n\nclass g extends t {\n  constructor(e) {\n    super(e), this._relation = \"\", this._relationGeom = null, this._relationString = \"\", this.declaredClass = \"esri.arcade.featureset.actions.SpatialFilter\", this._relationString = e.relationString, this._parent = e.parentfeatureset, this._maxProcessing = 40, this._relation = e.relation, this._relationGeom = e.relationGeom;\n  }\n\n  _getSet(e) {\n    return null === this._wset ? this._ensureLoaded().then(() => this._parent._getFilteredSet(\"esriSpatialRelRelation\" !== this._relation ? this._relation : this._relation + \":\" + this._relationString, this._relationGeom, null, null, e)).then(t => (this._checkCancelled(e), this._wset = new r(t._candidates.slice(0), t._known.slice(0), t._ordered, this._clonePageDefinition(t.pagesDefinition)), this._wset)) : a(this._wset);\n  }\n\n  _isInFeatureSet(e) {\n    let t = this._parent._isInFeatureSet(e);\n\n    return t === i.NotInFeatureSet ? t : (t = this._idstates[e], void 0 === t ? i.Unknown : t);\n  }\n\n  _getFeature(e, t, r) {\n    return this._parent._getFeature(e, t, r);\n  }\n\n  _getFeatures(e, t, r, i) {\n    return this._parent._getFeatures(e, t, r, i);\n  }\n\n  _featureFromCache(e) {\n    return this._parent._featureFromCache(e);\n  }\n\n  executeSpatialRelationTest(e) {\n    if (null === e.geometry) return a(!1);\n\n    switch (this._relation) {\n      case \"esriSpatialRelEnvelopeIntersects\":\n        {\n          const t = n(this._relationGeom),\n                r = n(e.geometry);\n          return f(t, r);\n        }\n\n      case \"esriSpatialRelIntersects\":\n        return f(this._relationGeom, e.geometry);\n\n      case \"esriSpatialRelContains\":\n        return p(this._relationGeom, e.geometry);\n\n      case \"esriSpatialRelOverlaps\":\n        return c(this._relationGeom, e.geometry);\n\n      case \"esriSpatialRelWithin\":\n        return _(this._relationGeom, e.geometry);\n\n      case \"esriSpatialRelTouches\":\n        return h(this._relationGeom, e.geometry);\n\n      case \"esriSpatialRelCrosses\":\n        return u(this._relationGeom, e.geometry);\n\n      case \"esriSpatialRelRelation\":\n        return o(this._relationGeom, e.geometry, this._relationString);\n    }\n  }\n\n  _fetchAndRefineFeatures(e, t, n) {\n    const a = new r([], e, !1, null),\n          l = Math.min(t, e.length);\n    return this._parent._getFeatures(a, -1, l, n).then(() => {\n      this._checkCancelled(n);\n\n      const t = [];\n\n      for (let r = 0; r < l; r++) {\n        const i = this._parent._featureFromCache(e[r]);\n\n        t.push(this.executeSpatialRelationTest(i));\n      }\n\n      return s(t);\n    }).then(r => {\n      for (let n = 0; n < t; n++) !0 === r[n] ? this._idstates[e[n]] = i.InFeatureSet : this._idstates[e[n]] = i.NotInFeatureSet;\n\n      return \"success\";\n    });\n  }\n\n  _getFilteredSet(e, t, i, n, a) {\n    return this._ensureLoaded().then(() => this._parent._getFilteredSet(\"esriSpatialRelRelation\" !== this._relation ? this._relation : this._relation + \":\" + this._relationString, this._relationGeom, i, n, a)).then(e => {\n      let i;\n      return this._checkCancelled(a), i = null !== t ? new r(e._candidates.slice(0).concat(e._known.slice(0)), [], e._ordered, this._clonePageDefinition(e.pagesDefinition)) : new r(e._candidates.slice(0), e._known.slice(0), e._ordered, this._clonePageDefinition(e.pagesDefinition)), i;\n    });\n  }\n\n  _stat(e, t, r, i, n, s, l) {\n    return \"\" !== r ? a({\n      calculated: !1\n    }) : this._parent._stat(e, t, \"esriSpatialRelRelation\" !== this._relation ? this._relation : this._relation + \":\" + this._relationString, this._relationGeom, n, s, l).then(a => !1 === a.calculated ? null === n && \"\" === r && null === i ? this._manualStat(e, t, s, l) : {\n      calculated: !1\n    } : a);\n  }\n\n  _canDoAggregates(e, t, r, i, n) {\n    return \"\" !== r || null !== i || null === this._parent ? a(!1) : this._parent._canDoAggregates(e, t, \"esriSpatialRelRelation\" !== this._relation ? this._relation : this._relation + \":\" + this._relationString, this._relationGeom, n);\n  }\n\n  _getAggregatePagesDataSourceDefinition(e, t, r, i, n, a, s) {\n    return null === this._parent ? l(new Error(\"Should never be called\")) : this._parent._getAggregatePagesDataSourceDefinition(e, t, \"esriSpatialRelRelation\" !== this._relation ? this._relation : this._relation + \":\" + this._relationString, this._relationGeom, n, a, s);\n  }\n\n  static registerAction() {\n    t._featuresetFunctions.intersects = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelIntersects\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.envelopeIntersects = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelEnvelopeIntersects\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.contains = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelContains\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.overlaps = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelOverlaps\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.within = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelWithin\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.touches = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelTouches\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.crosses = function (t) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelCrosses\",\n        relationGeom: t\n      });\n    }, t._featuresetFunctions.relate = function (t, r) {\n      return null == t ? new e({\n        parentfeatureset: this\n      }) : new g({\n        parentfeatureset: this,\n        relation: \"esriSpatialRelRelation\",\n        relationGeom: t,\n        relationString: r\n      });\n    };\n  }\n\n}\n\nexport default g;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/arcade/featureset/actions/SpatialFilter.js"],"names":["e","t","r","IdState","i","shapeExtent","n","resolve","a","all","s","reject","l","relate","o","crosses","u","touches","h","within","_","overlaps","c","contains","p","intersects","f","g","constructor","_relation","_relationGeom","_relationString","declaredClass","relationString","_parent","parentfeatureset","_maxProcessing","relation","relationGeom","_getSet","_wset","_ensureLoaded","then","_getFilteredSet","_checkCancelled","_candidates","slice","_known","_ordered","_clonePageDefinition","pagesDefinition","_isInFeatureSet","NotInFeatureSet","_idstates","Unknown","_getFeature","_getFeatures","_featureFromCache","executeSpatialRelationTest","geometry","_fetchAndRefineFeatures","Math","min","length","push","InFeatureSet","concat","_stat","calculated","_manualStat","_canDoAggregates","_getAggregatePagesDataSourceDefinition","Error","registerAction","_featuresetFunctions","envelopeIntersects"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../sources/Empty.js\";import t from\"../support/FeatureSet.js\";import r from\"../support/IdSet.js\";import{IdState as i,shapeExtent as n}from\"../support/shared.js\";import{resolve as a,all as s,reject as l}from\"../../../core/promiseUtils.js\";import{relate as o,crosses as u,touches as h,within as _,overlaps as c,contains as p,intersects as f}from\"../../../geometry/geometryEngineAsync.js\";class g extends t{constructor(e){super(e),this._relation=\"\",this._relationGeom=null,this._relationString=\"\",this.declaredClass=\"esri.arcade.featureset.actions.SpatialFilter\",this._relationString=e.relationString,this._parent=e.parentfeatureset,this._maxProcessing=40,this._relation=e.relation,this._relationGeom=e.relationGeom}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getFilteredSet(\"esriSpatialRelRelation\"!==this._relation?this._relation:this._relation+\":\"+this._relationString,this._relationGeom,null,null,e))).then((t=>(this._checkCancelled(e),this._wset=new r(t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset))):a(this._wset)}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===i.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?i.Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,i){return this._parent._getFeatures(e,t,r,i)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeSpatialRelationTest(e){if(null===e.geometry)return a(!1);switch(this._relation){case\"esriSpatialRelEnvelopeIntersects\":{const t=n(this._relationGeom),r=n(e.geometry);return f(t,r)}case\"esriSpatialRelIntersects\":return f(this._relationGeom,e.geometry);case\"esriSpatialRelContains\":return p(this._relationGeom,e.geometry);case\"esriSpatialRelOverlaps\":return c(this._relationGeom,e.geometry);case\"esriSpatialRelWithin\":return _(this._relationGeom,e.geometry);case\"esriSpatialRelTouches\":return h(this._relationGeom,e.geometry);case\"esriSpatialRelCrosses\":return u(this._relationGeom,e.geometry);case\"esriSpatialRelRelation\":return o(this._relationGeom,e.geometry,this._relationString)}}_fetchAndRefineFeatures(e,t,n){const a=new r([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(a,-1,l,n).then((()=>{this._checkCancelled(n);const t=[];for(let r=0;r<l;r++){const i=this._parent._featureFromCache(e[r]);t.push(this.executeSpatialRelationTest(i))}return s(t)})).then((r=>{for(let n=0;n<t;n++)!0===r[n]?this._idstates[e[n]]=i.InFeatureSet:this._idstates[e[n]]=i.NotInFeatureSet;return\"success\"}))}_getFilteredSet(e,t,i,n,a){return this._ensureLoaded().then((()=>this._parent._getFilteredSet(\"esriSpatialRelRelation\"!==this._relation?this._relation:this._relation+\":\"+this._relationString,this._relationGeom,i,n,a))).then((e=>{let i;return this._checkCancelled(a),i=null!==t?new r(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new r(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),i}))}_stat(e,t,r,i,n,s,l){return\"\"!==r?a({calculated:!1}):this._parent._stat(e,t,\"esriSpatialRelRelation\"!==this._relation?this._relation:this._relation+\":\"+this._relationString,this._relationGeom,n,s,l).then((a=>!1===a.calculated?null===n&&\"\"===r&&null===i?this._manualStat(e,t,s,l):{calculated:!1}:a))}_canDoAggregates(e,t,r,i,n){return\"\"!==r||null!==i||null===this._parent?a(!1):this._parent._canDoAggregates(e,t,\"esriSpatialRelRelation\"!==this._relation?this._relation:this._relation+\":\"+this._relationString,this._relationGeom,n)}_getAggregatePagesDataSourceDefinition(e,t,r,i,n,a,s){return null===this._parent?l(new Error(\"Should never be called\")):this._parent._getAggregatePagesDataSourceDefinition(e,t,\"esriSpatialRelRelation\"!==this._relation?this._relation:this._relation+\":\"+this._relationString,this._relationGeom,n,a,s)}static registerAction(){t._featuresetFunctions.intersects=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelIntersects\",relationGeom:t})},t._featuresetFunctions.envelopeIntersects=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelEnvelopeIntersects\",relationGeom:t})},t._featuresetFunctions.contains=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelContains\",relationGeom:t})},t._featuresetFunctions.overlaps=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelOverlaps\",relationGeom:t})},t._featuresetFunctions.within=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelWithin\",relationGeom:t})},t._featuresetFunctions.touches=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelTouches\",relationGeom:t})},t._featuresetFunctions.crosses=function(t){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelCrosses\",relationGeom:t})},t._featuresetFunctions.relate=function(t,r){return null==t?new e({parentfeatureset:this}):new g({parentfeatureset:this,relation:\"esriSpatialRelRelation\",relationGeom:t,relationString:r})}}}export default g;\n"]},"metadata":{},"sourceType":"module"}