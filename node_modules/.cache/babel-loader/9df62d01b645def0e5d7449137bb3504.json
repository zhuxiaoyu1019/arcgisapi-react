{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../VertexStream.js\";\nimport e from \"../WGLBrush.js\";\nimport { setTextures as r, getCommonUniforms as s, setUniforms as a, getColormapUniforms as i, getStretchUniforms as o, getShadedReliefUniforms as n, getUniformLocationInfos as h, getBasicGridUniforms as c } from \"../../../../../webgl/rasterUtils.js\";\n\nclass l extends e {\n  constructor() {\n    super(...arguments), this._desc = {\n      lut: {\n        vsPath: \"raster/lut\",\n        fsPath: \"raster/lut\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      },\n      stretch: {\n        vsPath: \"raster/stretch\",\n        fsPath: \"raster/stretch\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      },\n      hillshade: {\n        vsPath: \"raster/hillshade\",\n        fsPath: \"raster/hillshade\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      }\n    }, this._rendererUniformInfos = new Map();\n  }\n\n  dispose() {\n    this._quad && this._quad.dispose();\n  }\n\n  prepareState({\n    context: t\n  }, e) {\n    t.setBlendingEnabled(!0), t.setBlendFunctionSeparate(1, 771, 1, 771), t.setColorMask(!0, !0, !0, !0), t.setStencilWriteMask(0), t.setStencilTestEnabled(!0), t.setStencilFunction(514, e.stencilRef, 255);\n  }\n\n  draw(t, e) {\n    var r;\n    if (!e.source) return;\n    if (e.suspended) return;\n    t.timeline.begin(this.name);\n    const s = !(null != (r = t.context.capabilities.textureFloat) && r.textureFloatLinear);\n    e.updateTexture(t);\n    const a = this.getShaderVariations(e, s),\n          i = t.painter.materialManager.getProgram(t, this._desc[e.symbolizerParameters.type], a);\n    this.drawWithProgram(t.context, i, e), t.timeline.end(this.name);\n  }\n\n  drawWithProgram(e, h, l, d = 1, u = [0, 0], p = !1) {\n    this._quad || (this._quad = new t(e, [0, 0, 1, 0, 0, 1, 1, 1]));\n    const {\n      symbolizerParameters: m,\n      transformGrid: f,\n      width: g,\n      height: _,\n      opacity: b\n    } = l,\n          x = m.type;\n    e.useProgram(h);\n    const P = this.getShaderVariations(l),\n          w = this.getUniformInfos(x, e, h, P),\n          {\n      names: S,\n      textures: y\n    } = l.getTextures();\n    r(e, h, S, y);\n    const M = c(d, u),\n          U = s(f, [g, _], [l.source.width, l.source.height], b, p);\n\n    if (a(h, w, {\n      u_coordScale: l.coordScale,\n      u_dvsMat3: l.transforms.dvs,\n      ...M,\n      ...U\n    }), m.colormap) {\n      const {\n        colormap: t,\n        colormapOffset: e\n      } = m,\n            r = i(t, e);\n      a(h, w, r);\n    }\n\n    if (\"stretch\" === m.type) {\n      const t = o(m);\n      a(h, w, t);\n    } else if (\"hillshade\" === m.type) {\n      const t = n(m);\n      a(h, w, t);\n    }\n\n    this._quad.draw();\n  }\n\n  getUniformInfos(t, e, r, s) {\n    const a = s.length > 0 ? t + \"-\" + s.join(\"-\") : t;\n    if (this._rendererUniformInfos.has(a)) return this._rendererUniformInfos.get(a);\n    const i = h(e, r);\n    return this._rendererUniformInfos.set(a, i), i;\n  }\n\n  getShaderVariations(t, e = !1) {\n    const r = [];\n    return \"cubic\" === t.interpolation ? r.push(\"bicubic\") : e && \"bilinear\" === t.interpolation && r.push(\"bilinear\"), t.isRendereredSource ? r.push(\"noop\") : t.symbolizerParameters.colormap && r.push(\"applyColormap\"), t.transformGrid && r.push(\"applyProjection\"), r;\n  }\n\n}\n\nexport default l;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/raster/BrushRasterBitmap.js"],"names":["t","e","setTextures","r","getCommonUniforms","s","setUniforms","a","getColormapUniforms","i","getStretchUniforms","o","getShadedReliefUniforms","n","getUniformLocationInfos","h","getBasicGridUniforms","c","l","constructor","arguments","_desc","lut","vsPath","fsPath","attributes","Map","stretch","hillshade","_rendererUniformInfos","dispose","_quad","prepareState","context","setBlendingEnabled","setBlendFunctionSeparate","setColorMask","setStencilWriteMask","setStencilTestEnabled","setStencilFunction","stencilRef","draw","source","suspended","timeline","begin","name","capabilities","textureFloat","textureFloatLinear","updateTexture","getShaderVariations","painter","materialManager","getProgram","symbolizerParameters","type","drawWithProgram","end","d","u","p","m","transformGrid","f","width","g","height","_","opacity","b","x","useProgram","P","w","getUniformInfos","names","S","textures","y","getTextures","M","U","u_coordScale","coordScale","u_dvsMat3","transforms","dvs","colormap","colormapOffset","length","join","has","get","set","interpolation","push","isRendereredSource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../VertexStream.js\";import e from\"../WGLBrush.js\";import{setTextures as r,getCommonUniforms as s,setUniforms as a,getColormapUniforms as i,getStretchUniforms as o,getShadedReliefUniforms as n,getUniformLocationInfos as h,getBasicGridUniforms as c}from\"../../../../../webgl/rasterUtils.js\";class l extends e{constructor(){super(...arguments),this._desc={lut:{vsPath:\"raster/lut\",fsPath:\"raster/lut\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])},stretch:{vsPath:\"raster/stretch\",fsPath:\"raster/stretch\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])},hillshade:{vsPath:\"raster/hillshade\",fsPath:\"raster/hillshade\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])}},this._rendererUniformInfos=new Map}dispose(){this._quad&&this._quad.dispose()}prepareState({context:t},e){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(1,771,1,771),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilFunction(514,e.stencilRef,255)}draw(t,e){var r;if(!e.source)return;if(e.suspended)return;t.timeline.begin(this.name);const s=!(null!=(r=t.context.capabilities.textureFloat)&&r.textureFloatLinear);e.updateTexture(t);const a=this.getShaderVariations(e,s),i=t.painter.materialManager.getProgram(t,this._desc[e.symbolizerParameters.type],a);this.drawWithProgram(t.context,i,e),t.timeline.end(this.name)}drawWithProgram(e,h,l,d=1,u=[0,0],p=!1){this._quad||(this._quad=new t(e,[0,0,1,0,0,1,1,1]));const{symbolizerParameters:m,transformGrid:f,width:g,height:_,opacity:b}=l,x=m.type;e.useProgram(h);const P=this.getShaderVariations(l),w=this.getUniformInfos(x,e,h,P),{names:S,textures:y}=l.getTextures();r(e,h,S,y);const M=c(d,u),U=s(f,[g,_],[l.source.width,l.source.height],b,p);if(a(h,w,{u_coordScale:l.coordScale,u_dvsMat3:l.transforms.dvs,...M,...U}),m.colormap){const{colormap:t,colormapOffset:e}=m,r=i(t,e);a(h,w,r)}if(\"stretch\"===m.type){const t=o(m);a(h,w,t)}else if(\"hillshade\"===m.type){const t=n(m);a(h,w,t)}this._quad.draw()}getUniformInfos(t,e,r,s){const a=s.length>0?t+\"-\"+s.join(\"-\"):t;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);const i=h(e,r);return this._rendererUniformInfos.set(a,i),i}getShaderVariations(t,e=!1){const r=[];return\"cubic\"===t.interpolation?r.push(\"bicubic\"):e&&\"bilinear\"===t.interpolation&&r.push(\"bilinear\"),t.isRendereredSource?r.push(\"noop\"):t.symbolizerParameters.colormap&&r.push(\"applyColormap\"),t.transformGrid&&r.push(\"applyProjection\"),r}}export default l;\n"]},"metadata":{},"sourceType":"module"}