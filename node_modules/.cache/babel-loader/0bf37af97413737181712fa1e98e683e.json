{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Graphic.js\";\nimport r from \"../../../core/Logger.js\";\nimport { destroyMaybe as i, isSome as s, isNone as o, unwrap as a } from \"../../../core/maybe.js\";\nimport { init as n } from \"../../../core/watchUtils.js\";\nimport { property as d } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as h } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { b as l } from \"../../../chunks/vec3.js\";\nimport { f as u, c } from \"../../../chunks/vec3f64.js\";\nimport { projectBuffer as p, projectVectorToVector as g, projectBoundingRect as m } from \"../../../geometry/projection.js\";\nimport { create as y } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { extentContainsCoords3D as f } from \"../../../geometry/support/contains.js\";\nimport { estimateSize as _, makeDehydratedPoint as b } from \"../../../layers/graphics/dehydratedFeatures.js\";\nimport { hydrateGraphic as v } from \"../../../layers/graphics/hydratedFeatures.js\";\nimport E from \"../../../layers/graphics/controllers/I3SOnDemandController.js\";\nimport { getRenderingInfo as x, getRenderingInfoAsync as I } from \"../../../renderers/support/renderingInfoUtils.js\";\nimport { getGeometryZScaler as w } from \"../../../rest/query/operations/zscale.js\";\nimport S from \"../../../rest/support/Query.js\";\nimport { I3SPointsWorkerHandle as C } from \"./I3SPointsWorkerHandle.js\";\nimport { LayerView3D as D } from \"./LayerView3D.js\";\nimport F from \"./graphics/Graphics3DFeatureLikeLayerView.js\";\nimport A from \"./graphics/QueryEngine.js\";\nimport { createInteractiveEditSession as O, processAttributeEdits as N } from \"./i3s/attributeEditing.js\";\nimport { I3SAttributeOverrides as j } from \"./i3s/I3SAttributeOverrides.js\";\nimport { checkSpatialReferences as T, containsDraco as G, whenGraphicAttributes as V, getCachedAttributeValue as M } from \"./i3s/I3SUtil.js\";\nimport { DefinitionExpressionSceneLayerView as R } from \"./support/DefinitionExpressionSceneLayerView.js\";\nimport { defineFieldProperties as P } from \"./support/fieldProperties.js\";\nimport { PopupSceneLayerView as L } from \"./support/PopupSceneLayerView.js\";\nimport { SceneLayerViewRequiredFields as U } from \"./support/SceneLayerViewRequiredFields.js\";\nimport q from \"../support/debugFlags.js\";\nimport { GraphicsMap as H } from \"../support/GraphicsMap.js\";\nimport { compute as Q } from \"../support/orientedBoundingBox.js\";\nimport { updatingProgress as k } from \"../support/updatingProperties.js\";\nimport B from \"../../layers/SceneLayerView.js\";\nimport z from \"../../layers/support/FeatureFilter.js\";\nimport { TaskPriority as W } from \"../../support/Scheduler.js\";\nconst K = r.getLogger(\"esri.views.3d.layers.SceneLayerGraphicsView3D\"),\n      Z = P();\nlet J = class extends R(L(D(B))) {\n  constructor() {\n    super(...arguments), this.type = \"scene-layer-graphics-3d\", this._nodesAddedToStage = new Map(), this.drapeSourceType = 1, this._queryEngine = null, this._memCache = null, this._interactiveEditingSessions = new Map(), this.loadedGraphics = new H(), this.holeFilling = \"always\", this.progressiveLoadFactor = 1, this.supportsHeightUnitConversion = !0, this._coordinatesOutsideExtentErrors = 0, this._maxCoordinatesOutsideExtentErrors = 20;\n  }\n\n  initialize() {\n    var e;\n    const t = this.layer;\n    this.addResolvingPromise(t.indexInfo), this._attributeOverrides = new j(this.layer, null == (e = this.view.resourceController) ? void 0 : e.memoryController), T(t, this.view.spatialReference, this.view.viewingMode), this.fieldsHelper = new U({\n      layerView: this\n    }), this.updatingHandles.add(t, \"rangeInfos\", e => this._rangeInfosChanged(e), 2), this.updatingHandles.add(t, \"renderer\", (e, t) => this._rendererChange(e, t)), this.updatingHandles.add(this, \"parsedDefinitionExpression\", () => this._filterChange()), this.updatingHandles.add(this, \"view.floors\", () => this.graphics3d.filterVisibility.filterChanged()), this.handles.add(n(q, \"I3S_TREE_SHOW_TILES\", e => {\n      if (e && !this._treeDebugger) {\n        const e = this._controller.crsIndex;\n        import(\"./support/I3STreeDebugger.js\").then(({\n          I3STreeDebugger: t\n        }) => {\n          !this._treeDebugger && q.I3S_TREE_SHOW_TILES && (this._treeDebugger = new t({\n            lv: this,\n            view: this.view,\n            nodeSR: e\n          }));\n        });\n      } else e || !this._treeDebugger || q.I3S_TREE_SHOW_TILES || (this._treeDebugger.destroy(), this._treeDebugger = null);\n    })), this._set(\"graphics3d\", new F({\n      owner: this,\n      layer: t,\n      preferredUpdatePolicy: 0,\n      scaleVisibilityEnabled: !0,\n      filterVisibilityEnabled: !0,\n      timeExtentVisibilityEnabled: !1,\n      frustumVisibilityEnabled: !1,\n      elevationAlignmentEnabled: !0,\n      elevationFeatureExpressionEnabled: !1,\n      suspendResumeExtentMode: \"data\",\n      dataExtent: t.fullExtent,\n      updateClippingExtent: e => this._updateClippingExtent(e)\n    })), this.graphics3d.elevationAlignment && this.graphics3d.elevationAlignment.events.on(\"invalidate-elevation\", e => this._invalidateElevation(e)), this.supportsHeightUnitConversion && (this._verticalScale = w(\"point\", t.spatialReference, this.view.spatialReference)), this.addResolvingPromise(this.graphics3d.setup()), this._memCache = this.view.resourceController.memoryController.getMemCache(t.uid), this._controller = new E({\n      layerView: this,\n      scaleVisibilityEnabled: !1\n    }), G(this.layer.geometryDefinitions) && (this._worker = new C(e => this.view.resourceController.schedule(e))), this.handles.add(this.layer.on(\"apply-edits\", e => this.updatingHandles.addPromise(e.result))), this.handles.add(this.layer.on(\"edits\", e => this._handleEdits(e))), this.when(() => {\n      this._queryEngine = new A({\n        layerView: this,\n        priority: W.FEATURE_QUERY_ENGINE\n      }), this.updatingHandles.add(this, \"maximumNumberOfFeatures\", e => this._controller.featureTarget = e, 2), this.updatingHandles.add(this, \"suspended\", e => {\n        e && this._removeAllNodeData();\n      });\n    });\n  }\n\n  destroy() {\n    this._treeDebugger = i(this._treeDebugger), this._attributeOverrides = i(this._attributeOverrides), this._set(\"graphics3d\", i(this.graphics3d)), this._controller = i(this._controller), this._queryEngine = i(this._queryEngine), this._worker = i(this._worker), this._memCache = i(this._memCache), this._nodesAddedToStage.clear(), this.fieldsHelper = i(this.fieldsHelper);\n  }\n\n  get requiredFields() {\n    var e, t;\n    return null != (e = null == (t = this.fieldsHelper) ? void 0 : t.requiredFields) ? e : [];\n  }\n\n  get maximumNumberOfFeatures() {\n    const e = this.graphics3d && this.graphics3d.graphicsCore && this.graphics3d.graphicsCore.displayFeatureLimit;\n    return e ? e.maximumNumberOfFeatures : 0;\n  }\n\n  set maximumNumberOfFeatures(e) {\n    null != e ? (this._override(\"maximumNumberOfFeatures\", e), this._controller.fixedFeatureTarget = !0) : (this._clearOverride(\"maximumNumberOfFeatures\"), this._controller.fixedFeatureTarget = !1);\n  }\n\n  get maximumNumberOfFeaturesExceeded() {\n    return !this.suspended && !!this._controller && !this._controller.leavesReached;\n  }\n\n  get hasM() {\n    return !1;\n  }\n\n  get hasZ() {\n    return !0;\n  }\n\n  notifyGraphicGeometryChanged(e) {\n    this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e);\n  }\n\n  notifyGraphicVisibilityChanged(e) {\n    this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e);\n  }\n\n  async whenGraphicAttributes(e, t) {\n    return V(this.layer, e, this._getObjectIdField(), t, () => [...this._nodesAddedToStage.values()]);\n  }\n\n  getGraphicFromGraphicUid(e) {\n    if (!this.loadedGraphics) return null;\n\n    const t = v(this.loadedGraphics.find(t => t.uid === e), this.layer),\n          r = this._getObjectIdField();\n\n    return t && t.attributes && t.attributes[r] ? (t.layer = this.layer, t.sourceLayer = this.layer, t) : null;\n  }\n\n  whenGraphicBounds(e, t) {\n    return this.graphics3d.graphicsCore.whenGraphicBounds(e, t);\n  }\n\n  computeAttachmentOrigin(e, t) {\n    return this.graphics3d.graphicsCore.computeAttachmentOrigin(e, t);\n  }\n\n  canResume() {\n    return super.canResume() && (!this._controller || this._controller.rootNodeVisible);\n  }\n\n  isUpdating() {\n    return !!(this._controller && this._controller.updating || this.graphics3d && this.graphics3d.updating);\n  }\n\n  getRenderingInfo(e, t, r) {\n    const i = x(e, {\n      renderer: t,\n      arcade: r\n    });\n\n    if (s(i) && i.color) {\n      const e = i.color;\n      e[0] = e[0] / 255, e[1] = e[1] / 255, e[2] = e[2] / 255;\n    }\n\n    return i;\n  }\n\n  async getRenderingInfoAsync(e, t, r, i) {\n    return I(e, {\n      renderer: t,\n      arcade: r,\n      ...i\n    });\n  }\n\n  get symbolUpdateType() {\n    return this.graphics3d.graphicsCore.symbolUpdateType;\n  }\n\n  highlight(e) {\n    return this.graphics3d.highlight(e, this.layer.objectIdField);\n  }\n\n  get updatePolicy() {\n    return this.graphics3d.graphicsCore.effectiveUpdatePolicy;\n  }\n\n  createInteractiveEditSession(e) {\n    return O(this.attributeEditingContext, e);\n  }\n\n  async extractBinaryPointData(e, t) {\n    const r = {\n      geometryBuffer: e.geometryBuffer\n    };\n    return o(this._worker) && (this._worker = new C(e => this.view.resourceController.schedule(e))), this._worker.invoke(r, t).then(e => {\n      if (s(e)) {\n        return {\n          positionData: e.positions,\n          featureIds: e.featureIds\n        };\n      }\n\n      throw new Error(\"Failed to decompress Draco point data\");\n    });\n  }\n\n  checkExtent(e, t) {\n    e && !f(e, t) && (this._coordinatesOutsideExtentErrors < this._maxCoordinatesOutsideExtentErrors && K.error(\"Service Error: Coordinates outside of layer extent\"), this._coordinatesOutsideExtentErrors + 1 === this._maxCoordinatesOutsideExtentErrors && K.error(\"Maximum number of errors reached. Further errors are ignored.\"), this._coordinatesOutsideExtentErrors++);\n  }\n\n  async addNode(e, t, r) {\n    if (!X(t) && !$(t)) return Promise.reject();\n    if (this._nodesAddedToStage.has(e.index)) return void K.error(\"I3S node \" + e.id + \" already added\");\n    const i = this.layer.fullExtent,\n          s = i && te(i.clone(), .5),\n          o = this._controller.crsVertex,\n          a = [],\n          n = {\n      graphics: null,\n      featureIds: null,\n      attributeInfo: t.attributeDataInfo,\n      node: e\n    };\n    if (X(t) ? await this._addNodeBinaryPointData(e, n, t, s, a, r) : $(t) && this._addNodeLegacyPointData(e, n, t, s, a), await this._attributeOverrides.apply(n.featureIds, t.attributeDataInfo, r), e.numFeatures = n.graphics.length, this._updateNodeMemory(e), ee(n), a.length > 0 && (this.computeObb(e, a, o), this._controller.updateVisibility(e.index)), !this._controller.isGeometryVisible(e)) return this._cacheNodeData(n), Promise.resolve();\n    if (this._verticalScale) for (const d of n.graphics) this._verticalScale(d.geometry);\n    return this._nodesAddedToStage.set(e.index, n), this.loadedGraphics.addMany(n.graphics), this._filterNode(n), this._treeDebugger && this._treeDebugger.update(), Promise.resolve();\n  }\n\n  computeObb(e, t, r) {\n    const i = this._controller.crsIndex,\n          s = i.isGeographic ? this.view.renderSpatialReference : i;\n    p(t, r, 0, t, s, 0, t.length / 3);\n    const o = {\n      data: t,\n      size: 3\n    };\n    e.serviceObb = Q(o), i.isGeographic && g(e.serviceObb.center, s, e.serviceObb.center, i);\n  }\n\n  isNodeLoaded(e) {\n    return this._nodesAddedToStage.has(e);\n  }\n\n  isNodeReloading() {\n    return !1;\n  }\n\n  updateNodeState() {}\n\n  async _addNodeBinaryPointData(e, r, i, o, n, d) {\n    const h = await this.extractBinaryPointData(i, d);\n    if (null == h) return Promise.reject();\n\n    const c = this._getObjectIdField(),\n          g = this._controller.crsVertex,\n          m = this.view.spatialReference,\n          y = this.graphics3d.graphicsCore,\n          {\n      positionData: f,\n      featureIds: _\n    } = h,\n          v = 3,\n          E = f.length / v,\n          x = new Array();\n\n    for (let I = 0; I < E; I++) {\n      const r = s(e.serviceObb) ? e.serviceObb.center : [0, 0, 0],\n            i = I * v,\n            d = u(f[i + 0], f[i + 1], f[i + 2]);\n      l(d, d, r), e.serviceObb || n.push(d[0], d[1], d[2]), o && this.checkExtent(o, d);\n      const h = _[I],\n            E = {};\n      null != h && (E[c] = h);\n      const w = null == h ? t.generateUID() : h;\n      p(d, g, 0, ie, m, 0, 1);\n      const S = b(ie[0], ie[1], ie[2], m),\n            C = this.loadedGraphics.get(w);\n      if (s(C)) C.level < e.level && (se.property = \"geometry\", se.graphic = C, se.oldValue = a(C.geometry), se.newValue = S, C.geometry = S, y.graphicUpdateHandler(se)), x.push(C);else {\n        const r = t.generateUID();\n        x.push({\n          objectId: w,\n          uid: r,\n          geometry: S,\n          attributes: E,\n          visible: !0,\n          level: e.level\n        });\n      }\n    }\n\n    r.graphics = x, r.featureIds = _;\n  }\n\n  _addNodeLegacyPointData(e, r, i, o, a) {\n    const n = this._getObjectIdField(),\n          d = this._controller.crsVertex,\n          h = this.view.spatialReference,\n          l = [0, 0, 0],\n          u = new Array(),\n          c = new Array();\n\n    for (const g of i.pointData) {\n      const r = g.featureDataPosition,\n            i = r.length,\n            m = g.geometries && g.geometries[0] || re[i],\n            y = g.featureIds[0];\n      if (\"points\" !== m.params.type) continue;\n      o && this.checkExtent(o, r);\n      const f = {};\n      null != y && (f[n] = y);\n\n      const _ = null == y ? t.generateUID() : y;\n\n      let v;\n      \"Embedded\" === m.type && (v = m.params.vertexAttributes.position);\n\n      for (let o = 0; o < v.length; o += i) {\n        for (let e = 0; e < i; e++) l[e] = r[e] + v[o + e];\n\n        const n = 3 === i;\n        e.serviceObb || a.push(l[0], l[1], n ? l[2] : 0), p(l, d, 0, ie, h, 0, 1);\n        const u = b(ie[0], ie[1], n ? ie[2] : void 0, h),\n              g = this.loadedGraphics.get(_);\n        s(g) ? c.push(g) : c.push({\n          objectId: _,\n          uid: t.generateUID(),\n          geometry: u,\n          attributes: f,\n          visible: !0\n        });\n      }\n\n      u.push(y);\n    }\n\n    r.graphics = c, r.featureIds = u;\n  }\n\n  _updateNodeMemory(e) {\n    e.memory = 4096 + (s(e.numFeatures) ? e.numFeatures * this.graphics3d.graphicsCore.usedMemoryPerGraphic : 0);\n  }\n\n  _cacheNodeData(e) {\n    const t = e.graphics.reduce((e, t) => _(t) + e, 512 + 8 * e.featureIds.length + 1024);\n\n    this._memCache.put(this._getMemCacheKey(e.node), e, t);\n  }\n\n  _getMemCacheKey(e) {\n    return `${e.index}`;\n  }\n\n  _removeAllNodeData() {\n    this._nodesAddedToStage.forEach(e => {\n      if (e) {\n        const t = e.node;\n        this._updateNodeMemory(t), this._cacheNodeData(e);\n      }\n    }), this._nodesAddedToStage.clear(), this._treeDebugger && this._treeDebugger.update(), this.loadedGraphics.clear();\n  }\n\n  removeNode(e) {\n    const t = this._removeNodeStageData(e);\n\n    t && (this._updateNodeMemory(t.node), this._cacheNodeData(t));\n  }\n\n  _removeNodeStageData(e) {\n    const t = this._nodesAddedToStage.get(e);\n\n    return t ? (this.loadedGraphics.removeMany(t.graphics), this._nodesAddedToStage.delete(e), this._treeDebugger && this._treeDebugger.update(), t) : null;\n  }\n\n  async loadCachedNodeData(e) {\n    return this._memCache.pop(this._getMemCacheKey(e));\n  }\n\n  async addCachedNodeData(e, t, r, i) {\n    if (!this._nodesAddedToStage.has(e.index)) return this.loadedGraphics.addMany(t.graphics), this._nodesAddedToStage.set(e.index, t), this._updateNodeMemory(e), await this.updateAttributes(e.index, r, i), this._filterNode(t), this._treeDebugger && this._treeDebugger.update(), Promise.resolve();\n    K.error(\"I3S node \" + e.id + \" already added\");\n  }\n\n  getLoadedNodeIds() {\n    const e = [];\n    return this._nodesAddedToStage.forEach(t => e.push(t.node.id)), e.sort();\n  }\n\n  getVisibleNodes() {\n    const e = new Array();\n    return this._nodesAddedToStage.forEach(t => e.push(t.node)), e;\n  }\n\n  getLoadedNodeIndices(e) {\n    this._nodesAddedToStage.forEach((t, r) => e.push(r));\n  }\n\n  getLoadedAttributes(e) {\n    const t = this._nodesAddedToStage.get(e);\n\n    if (t && s(t.attributeInfo)) return t.attributeInfo.loadedAttributes;\n  }\n\n  getAttributeData(e) {\n    const t = this._nodesAddedToStage.get(e);\n\n    if (t && s(t.attributeInfo)) return t.attributeInfo.attributeData;\n  }\n\n  setAttributeData(e, t) {\n    const r = this._nodesAddedToStage.get(e);\n\n    r && !o(r.attributeInfo) && (r.attributeInfo.attributeData = t, this._attributeValuesChanged(r));\n  }\n\n  async updateAttributes(e, t, r) {\n    const i = this._nodesAddedToStage.get(e);\n\n    i && (await this._attributeOverrides.apply(i.featureIds, t, r), i.attributeInfo = t, this._attributeValuesChanged(i));\n  }\n\n  _attributeValuesChanged(e) {\n    if (ee(e), this._filterNode(e), this.graphics3d.graphicsCore.labelsEnabled) {\n      const t = e.graphics.map(e => e.uid);\n      this.graphics3d.graphicsCore.updateLabelingInfo(t);\n    }\n  }\n\n  _updateClippingExtent(e) {\n    return this._controller && this._controller.updateClippingArea(e), !1;\n  }\n\n  _getObjectIdField() {\n    return this.layer.objectIdField || \"OBJECTID\";\n  }\n\n  async _rendererChange(e, t) {\n    const {\n      layer: {\n        fieldsIndex: r\n      }\n    } = this,\n          i = new Set();\n    let s, o;\n    e ? (await e.collectRequiredFields(i, r), s = Array.from(i).sort()) : s = [], i.clear(), t ? (await t.collectRequiredFields(i, r), o = Array.from(i).sort()) : o = [], s.length === o.length && s.every((e, t) => s[t] === o[t]) || this._reloadAllNodes();\n  }\n\n  _rangeInfosChanged(e) {\n    null != e && e.length > 0 && K.warn(\"Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.\");\n  }\n\n  _filterChange() {\n    this._nodesAddedToStage.forEach(e => this._filterNode(e));\n  }\n\n  _reloadAllNodes() {\n    this._removeAllNodeData(), this._controller && this._controller.restartNodeLoading();\n  }\n\n  _filterNode(e) {\n    const t = this.parsedDefinitionExpression;\n\n    for (const r of e.graphics) {\n      const e = r.visible;\n      r.visible = !t || this._evaluateClause(t, r), e !== r.visible && (se.graphic = r, se.property = \"visible\", se.oldValue = e, se.newValue = r.visible, this.graphics3d.graphicsCore.graphicUpdateHandler(se));\n    }\n  }\n\n  _invalidateElevation(e) {\n    const t = this._controller.crsIndex;\n    m(e.extent, e.spatialReference, oe, t), this._controller.updateElevationChanged(oe, t);\n  }\n\n  createQuery() {\n    const e = {\n      outFields: [\"*\"],\n      returnGeometry: !0,\n      outSpatialReference: this.view.spatialReference\n    };\n    return s(this.filter) ? this.filter.createQuery(e) : new S(e);\n  }\n\n  queryFeatures(e, t) {\n    return this._queryEngine.executeQuery(this._ensureQuery(e), null == t ? void 0 : t.signal);\n  }\n\n  queryObjectIds(e, t) {\n    return this._queryEngine.executeQueryForIds(this._ensureQuery(e), null == t ? void 0 : t.signal);\n  }\n\n  queryFeatureCount(e, t) {\n    return this._queryEngine.executeQueryForCount(this._ensureQuery(e), null == t ? void 0 : t.signal);\n  }\n\n  queryExtent(e, t) {\n    return this._queryEngine.executeQueryForExtent(this._ensureQuery(e), null == t ? void 0 : t.signal);\n  }\n\n  _ensureQuery(e) {\n    return this._addDefinitionExpressionToQuery(o(e) ? this.createQuery() : S.from(e));\n  }\n\n  getUsedMemory() {\n    const e = this.graphics3d && this.graphics3d.graphicsCore;\n    return e ? e.usedMemory : 0;\n  }\n\n  getUnloadedMemory() {\n    const e = this.graphics3d && this.graphics3d.graphicsCore;\n    return .8 * ((this._controller ? this._controller.unloadedMemoryEstimate : 0) + (e ? e.unprocessedMemoryEstimate : 0));\n  }\n\n  ignoresMemoryFactor() {\n    return this._controller && this._controller.fixedFeatureTarget;\n  }\n\n  _handleEdits(e) {\n    N(this.attributeEditingContext, e);\n  }\n\n  get attributeEditingContext() {\n    const e = this._getObjectIdField();\n\n    return {\n      sessions: this._interactiveEditingSessions,\n      fieldsIndex: this.layer.fieldsIndex,\n      objectIdField: e,\n      forEachNode: e => this._nodesAddedToStage.forEach(t => e(t.node, t.featureIds)),\n      attributeStorageInfo: this.i3slayer.attributeStorageInfo,\n      attributeOverrides: this._attributeOverrides,\n      getAttributeData: e => this.getAttributeData(e),\n      setAttributeData: (t, r, i) => {\n        this.setAttributeData(t, r);\n\n        const o = this._nodesAddedToStage.get(t);\n\n        if (s(i)) {\n          const t = this.loadedGraphics.get(i.attributes[e]);\n          s(t) && this.graphics3d.graphicsCore.recreateGraphics([t]);\n        } else s(o) && this.graphics3d.graphicsCore.recreateGraphics(o.graphics);\n      },\n      clearMemCache: () => {}\n    };\n  }\n\n  get performanceInfo() {\n    const e = {\n      displayedNumberOfFeatures: this.loadedGraphics.length,\n      maximumNumberOfFeatures: this.maximumNumberOfFeatures,\n      totalNumberOfFeatures: -1,\n      nodes: this._nodesAddedToStage.size,\n      core: this.graphics3d.graphicsCore.performanceInfo\n    };\n    return this._controller && this._controller.updateStats(e), e;\n  }\n\n  get test() {\n    return {\n      controller: this._controller,\n      numNodes: this._nodesAddedToStage.size,\n      numFeatures: this.loadedGraphics.length\n    };\n  }\n\n};\ne([d()], J.prototype, \"graphics3d\", void 0), e([d({\n  type: z\n})], J.prototype, \"filter\", void 0), e([d()], J.prototype, \"loadedGraphics\", void 0), e([d({\n  aliasOf: \"layer\"\n})], J.prototype, \"i3slayer\", void 0), e([d()], J.prototype, \"_controller\", void 0), e([d()], J.prototype, \"updating\", void 0), e([d()], J.prototype, \"suspended\", void 0), e([d()], J.prototype, \"holeFilling\", void 0), e([d(k)], J.prototype, \"updatingProgress\", void 0), e([d({\n  aliasOf: \"_controller.updatingProgress\"\n})], J.prototype, \"updatingProgressValue\", void 0), e([d(Z.requiredFields)], J.prototype, \"requiredFields\", null), e([d(Z.availableFields)], J.prototype, \"availableFields\", void 0), e([d()], J.prototype, \"fieldsHelper\", void 0), e([d({\n  type: Number\n})], J.prototype, \"maximumNumberOfFeatures\", null), e([d({\n  readOnly: !0\n})], J.prototype, \"maximumNumberOfFeaturesExceeded\", null), e([d({\n  readOnly: !0,\n  aliasOf: \"view.qualitySettings.sceneService.point.lodFactor\"\n})], J.prototype, \"lodFactor\", void 0), e([d({\n  readOnly: !0\n})], J.prototype, \"hasM\", null), e([d({\n  readOnly: !0\n})], J.prototype, \"hasZ\", null), J = e([h(\"esri.views.3d.layers.SceneLayerGraphicsView3D\")], J);\nvar Y = J;\n\nfunction $(e) {\n  return \"pointData\" in e;\n}\n\nfunction X(e) {\n  return \"geometryBuffer\" in e && null !== e.geometryBuffer;\n}\n\nfunction ee(e) {\n  const t = e.attributeInfo;\n\n  for (let r = 0; r < e.graphics.length; r++) {\n    const i = e.graphics[r];\n    if (i.attributes || (i.attributes = {}), s(t) && s(t.loadedAttributes)) for (const {\n      name: e\n    } of t.loadedAttributes) t.attributeData[e] && (i.attributes[e] = M(t.attributeData[e], r));\n  }\n}\n\nfunction te(e, t) {\n  return e.xmin -= t, e.ymin -= t, e.xmax += t, e.ymax += t, e.hasZ && (e.zmin -= t, e.zmax += t), e.hasM && (e.mmin -= t, e.mmax += t), e;\n}\n\nconst re = {\n  2: {\n    type: \"Embedded\",\n    params: {\n      type: \"points\",\n      vertexAttributes: {\n        position: [0, 0]\n      }\n    }\n  },\n  3: {\n    type: \"Embedded\",\n    params: {\n      type: \"points\",\n      vertexAttributes: {\n        position: [0, 0, 0]\n      }\n    }\n  }\n},\n      ie = c(),\n      se = {\n  graphic: null,\n  property: null,\n  oldValue: null,\n  newValue: null\n},\n      oe = y();\nexport default Y;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/SceneLayerGraphicsView3D.js"],"names":["_","e","t","r","destroyMaybe","i","isSome","s","isNone","o","unwrap","a","init","n","property","d","subclass","h","b","l","f","u","c","projectBuffer","p","projectVectorToVector","g","projectBoundingRect","m","create","y","extentContainsCoords3D","estimateSize","makeDehydratedPoint","hydrateGraphic","v","E","getRenderingInfo","x","getRenderingInfoAsync","I","getGeometryZScaler","w","S","I3SPointsWorkerHandle","C","LayerView3D","D","F","A","createInteractiveEditSession","O","processAttributeEdits","N","I3SAttributeOverrides","j","checkSpatialReferences","T","containsDraco","G","whenGraphicAttributes","V","getCachedAttributeValue","M","DefinitionExpressionSceneLayerView","R","defineFieldProperties","P","PopupSceneLayerView","L","SceneLayerViewRequiredFields","U","q","GraphicsMap","H","compute","Q","updatingProgress","k","B","z","TaskPriority","W","K","getLogger","Z","J","constructor","arguments","type","_nodesAddedToStage","Map","drapeSourceType","_queryEngine","_memCache","_interactiveEditingSessions","loadedGraphics","holeFilling","progressiveLoadFactor","supportsHeightUnitConversion","_coordinatesOutsideExtentErrors","_maxCoordinatesOutsideExtentErrors","initialize","layer","addResolvingPromise","indexInfo","_attributeOverrides","view","resourceController","memoryController","spatialReference","viewingMode","fieldsHelper","layerView","updatingHandles","add","_rangeInfosChanged","_rendererChange","_filterChange","graphics3d","filterVisibility","filterChanged","handles","_treeDebugger","_controller","crsIndex","then","I3STreeDebugger","I3S_TREE_SHOW_TILES","lv","nodeSR","destroy","_set","owner","preferredUpdatePolicy","scaleVisibilityEnabled","filterVisibilityEnabled","timeExtentVisibilityEnabled","frustumVisibilityEnabled","elevationAlignmentEnabled","elevationFeatureExpressionEnabled","suspendResumeExtentMode","dataExtent","fullExtent","updateClippingExtent","_updateClippingExtent","elevationAlignment","events","on","_invalidateElevation","_verticalScale","setup","getMemCache","uid","geometryDefinitions","_worker","schedule","addPromise","result","_handleEdits","when","priority","FEATURE_QUERY_ENGINE","featureTarget","_removeAllNodeData","clear","requiredFields","maximumNumberOfFeatures","graphicsCore","displayFeatureLimit","_override","fixedFeatureTarget","_clearOverride","maximumNumberOfFeaturesExceeded","suspended","leavesReached","hasM","hasZ","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","_getObjectIdField","values","getGraphicFromGraphicUid","find","attributes","sourceLayer","whenGraphicBounds","computeAttachmentOrigin","canResume","rootNodeVisible","isUpdating","updating","renderer","arcade","color","symbolUpdateType","highlight","objectIdField","updatePolicy","effectiveUpdatePolicy","attributeEditingContext","extractBinaryPointData","geometryBuffer","invoke","positionData","positions","featureIds","Error","checkExtent","error","addNode","X","$","Promise","reject","has","index","id","te","clone","crsVertex","graphics","attributeInfo","attributeDataInfo","node","_addNodeBinaryPointData","_addNodeLegacyPointData","apply","numFeatures","length","_updateNodeMemory","ee","computeObb","updateVisibility","isGeometryVisible","_cacheNodeData","resolve","geometry","set","addMany","_filterNode","update","isGeographic","renderSpatialReference","data","size","serviceObb","center","isNodeLoaded","isNodeReloading","updateNodeState","Array","push","generateUID","ie","get","level","se","graphic","oldValue","newValue","graphicUpdateHandler","objectId","visible","pointData","featureDataPosition","geometries","re","params","vertexAttributes","position","memory","usedMemoryPerGraphic","reduce","put","_getMemCacheKey","forEach","removeNode","_removeNodeStageData","removeMany","delete","loadCachedNodeData","pop","addCachedNodeData","updateAttributes","getLoadedNodeIds","sort","getVisibleNodes","getLoadedNodeIndices","getLoadedAttributes","loadedAttributes","getAttributeData","attributeData","setAttributeData","_attributeValuesChanged","labelsEnabled","map","updateLabelingInfo","updateClippingArea","fieldsIndex","Set","collectRequiredFields","from","every","_reloadAllNodes","warn","restartNodeLoading","parsedDefinitionExpression","_evaluateClause","extent","oe","updateElevationChanged","createQuery","outFields","returnGeometry","outSpatialReference","filter","queryFeatures","executeQuery","_ensureQuery","signal","queryObjectIds","executeQueryForIds","queryFeatureCount","executeQueryForCount","queryExtent","executeQueryForExtent","_addDefinitionExpressionToQuery","getUsedMemory","usedMemory","getUnloadedMemory","unloadedMemoryEstimate","unprocessedMemoryEstimate","ignoresMemoryFactor","sessions","forEachNode","attributeStorageInfo","i3slayer","attributeOverrides","recreateGraphics","clearMemCache","performanceInfo","displayedNumberOfFeatures","totalNumberOfFeatures","nodes","core","updateStats","test","controller","numNodes","prototype","aliasOf","availableFields","Number","readOnly","Y","name","xmin","ymin","xmax","ymax","zmin","zmax","mmin","mmax"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Graphic.js\";import r from\"../../../core/Logger.js\";import{destroyMaybe as i,isSome as s,isNone as o,unwrap as a}from\"../../../core/maybe.js\";import{init as n}from\"../../../core/watchUtils.js\";import{property as d}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as h}from\"../../../core/accessorSupport/decorators/subclass.js\";import{b as l}from\"../../../chunks/vec3.js\";import{f as u,c}from\"../../../chunks/vec3f64.js\";import{projectBuffer as p,projectVectorToVector as g,projectBoundingRect as m}from\"../../../geometry/projection.js\";import{create as y}from\"../../../geometry/support/aaBoundingRect.js\";import{extentContainsCoords3D as f}from\"../../../geometry/support/contains.js\";import{estimateSize as _,makeDehydratedPoint as b}from\"../../../layers/graphics/dehydratedFeatures.js\";import{hydrateGraphic as v}from\"../../../layers/graphics/hydratedFeatures.js\";import E from\"../../../layers/graphics/controllers/I3SOnDemandController.js\";import{getRenderingInfo as x,getRenderingInfoAsync as I}from\"../../../renderers/support/renderingInfoUtils.js\";import{getGeometryZScaler as w}from\"../../../rest/query/operations/zscale.js\";import S from\"../../../rest/support/Query.js\";import{I3SPointsWorkerHandle as C}from\"./I3SPointsWorkerHandle.js\";import{LayerView3D as D}from\"./LayerView3D.js\";import F from\"./graphics/Graphics3DFeatureLikeLayerView.js\";import A from\"./graphics/QueryEngine.js\";import{createInteractiveEditSession as O,processAttributeEdits as N}from\"./i3s/attributeEditing.js\";import{I3SAttributeOverrides as j}from\"./i3s/I3SAttributeOverrides.js\";import{checkSpatialReferences as T,containsDraco as G,whenGraphicAttributes as V,getCachedAttributeValue as M}from\"./i3s/I3SUtil.js\";import{DefinitionExpressionSceneLayerView as R}from\"./support/DefinitionExpressionSceneLayerView.js\";import{defineFieldProperties as P}from\"./support/fieldProperties.js\";import{PopupSceneLayerView as L}from\"./support/PopupSceneLayerView.js\";import{SceneLayerViewRequiredFields as U}from\"./support/SceneLayerViewRequiredFields.js\";import q from\"../support/debugFlags.js\";import{GraphicsMap as H}from\"../support/GraphicsMap.js\";import{compute as Q}from\"../support/orientedBoundingBox.js\";import{updatingProgress as k}from\"../support/updatingProperties.js\";import B from\"../../layers/SceneLayerView.js\";import z from\"../../layers/support/FeatureFilter.js\";import{TaskPriority as W}from\"../../support/Scheduler.js\";const K=r.getLogger(\"esri.views.3d.layers.SceneLayerGraphicsView3D\"),Z=P();let J=class extends(R(L(D(B)))){constructor(){super(...arguments),this.type=\"scene-layer-graphics-3d\",this._nodesAddedToStage=new Map,this.drapeSourceType=1,this._queryEngine=null,this._memCache=null,this._interactiveEditingSessions=new Map,this.loadedGraphics=new H,this.holeFilling=\"always\",this.progressiveLoadFactor=1,this.supportsHeightUnitConversion=!0,this._coordinatesOutsideExtentErrors=0,this._maxCoordinatesOutsideExtentErrors=20}initialize(){var e;const t=this.layer;this.addResolvingPromise(t.indexInfo),this._attributeOverrides=new j(this.layer,null==(e=this.view.resourceController)?void 0:e.memoryController),T(t,this.view.spatialReference,this.view.viewingMode),this.fieldsHelper=new U({layerView:this}),this.updatingHandles.add(t,\"rangeInfos\",(e=>this._rangeInfosChanged(e)),2),this.updatingHandles.add(t,\"renderer\",((e,t)=>this._rendererChange(e,t))),this.updatingHandles.add(this,\"parsedDefinitionExpression\",(()=>this._filterChange())),this.updatingHandles.add(this,\"view.floors\",(()=>this.graphics3d.filterVisibility.filterChanged())),this.handles.add(n(q,\"I3S_TREE_SHOW_TILES\",(e=>{if(e&&!this._treeDebugger){const e=this._controller.crsIndex;import(\"./support/I3STreeDebugger.js\").then((({I3STreeDebugger:t})=>{!this._treeDebugger&&q.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new t({lv:this,view:this.view,nodeSR:e}))}))}else e||!this._treeDebugger||q.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)}))),this._set(\"graphics3d\",new F({owner:this,layer:t,preferredUpdatePolicy:0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:\"data\",dataExtent:t.fullExtent,updateClippingExtent:e=>this._updateClippingExtent(e)})),this.graphics3d.elevationAlignment&&this.graphics3d.elevationAlignment.events.on(\"invalidate-elevation\",(e=>this._invalidateElevation(e))),this.supportsHeightUnitConversion&&(this._verticalScale=w(\"point\",t.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.graphics3d.setup()),this._memCache=this.view.resourceController.memoryController.getMemCache(t.uid),this._controller=new E({layerView:this,scaleVisibilityEnabled:!1}),G(this.layer.geometryDefinitions)&&(this._worker=new C((e=>this.view.resourceController.schedule(e)))),this.handles.add(this.layer.on(\"apply-edits\",(e=>this.updatingHandles.addPromise(e.result)))),this.handles.add(this.layer.on(\"edits\",(e=>this._handleEdits(e)))),this.when((()=>{this._queryEngine=new A({layerView:this,priority:W.FEATURE_QUERY_ENGINE}),this.updatingHandles.add(this,\"maximumNumberOfFeatures\",(e=>this._controller.featureTarget=e),2),this.updatingHandles.add(this,\"suspended\",(e=>{e&&this._removeAllNodeData()}))}))}destroy(){this._treeDebugger=i(this._treeDebugger),this._attributeOverrides=i(this._attributeOverrides),this._set(\"graphics3d\",i(this.graphics3d)),this._controller=i(this._controller),this._queryEngine=i(this._queryEngine),this._worker=i(this._worker),this._memCache=i(this._memCache),this._nodesAddedToStage.clear(),this.fieldsHelper=i(this.fieldsHelper)}get requiredFields(){var e,t;return null!=(e=null==(t=this.fieldsHelper)?void 0:t.requiredFields)?e:[]}get maximumNumberOfFeatures(){const e=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return e?e.maximumNumberOfFeatures:0}set maximumNumberOfFeatures(e){null!=e?(this._override(\"maximumNumberOfFeatures\",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride(\"maximumNumberOfFeatures\"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return!this.suspended&&(!!this._controller&&!this._controller.leavesReached)}get hasM(){return!1}get hasZ(){return!0}notifyGraphicGeometryChanged(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)}async whenGraphicAttributes(e,t){return V(this.layer,e,this._getObjectIdField(),t,(()=>[...this._nodesAddedToStage.values()]))}getGraphicFromGraphicUid(e){if(!this.loadedGraphics)return null;const t=v(this.loadedGraphics.find((t=>t.uid===e)),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,t):null}whenGraphicBounds(e,t){return this.graphics3d.graphicsCore.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t)}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}isUpdating(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)}getRenderingInfo(e,t,r){const i=x(e,{renderer:t,arcade:r});if(s(i)&&i.color){const e=i.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return i}async getRenderingInfoAsync(e,t,r,i){return I(e,{renderer:t,arcade:r,...i})}get symbolUpdateType(){return this.graphics3d.graphicsCore.symbolUpdateType}highlight(e){return this.graphics3d.highlight(e,this.layer.objectIdField)}get updatePolicy(){return this.graphics3d.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(e){return O(this.attributeEditingContext,e)}async extractBinaryPointData(e,t){const r={geometryBuffer:e.geometryBuffer};return o(this._worker)&&(this._worker=new C((e=>this.view.resourceController.schedule(e)))),this._worker.invoke(r,t).then((e=>{if(s(e)){return{positionData:e.positions,featureIds:e.featureIds}}throw new Error(\"Failed to decompress Draco point data\")}))}checkExtent(e,t){e&&!f(e,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&K.error(\"Service Error: Coordinates outside of layer extent\"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&K.error(\"Maximum number of errors reached. Further errors are ignored.\"),this._coordinatesOutsideExtentErrors++)}async addNode(e,t,r){if(!X(t)&&!$(t))return Promise.reject();if(this._nodesAddedToStage.has(e.index))return void K.error(\"I3S node \"+e.id+\" already added\");const i=this.layer.fullExtent,s=i&&te(i.clone(),.5),o=this._controller.crsVertex,a=[],n={graphics:null,featureIds:null,attributeInfo:t.attributeDataInfo,node:e};if(X(t)?await this._addNodeBinaryPointData(e,n,t,s,a,r):$(t)&&this._addNodeLegacyPointData(e,n,t,s,a),await this._attributeOverrides.apply(n.featureIds,t.attributeDataInfo,r),e.numFeatures=n.graphics.length,this._updateNodeMemory(e),ee(n),a.length>0&&(this.computeObb(e,a,o),this._controller.updateVisibility(e.index)),!this._controller.isGeometryVisible(e))return this._cacheNodeData(n),Promise.resolve();if(this._verticalScale)for(const d of n.graphics)this._verticalScale(d.geometry);return this._nodesAddedToStage.set(e.index,n),this.loadedGraphics.addMany(n.graphics),this._filterNode(n),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve()}computeObb(e,t,r){const i=this._controller.crsIndex,s=i.isGeographic?this.view.renderSpatialReference:i;p(t,r,0,t,s,0,t.length/3);const o={data:t,size:3};e.serviceObb=Q(o),i.isGeographic&&g(e.serviceObb.center,s,e.serviceObb.center,i)}isNodeLoaded(e){return this._nodesAddedToStage.has(e)}isNodeReloading(){return!1}updateNodeState(){}async _addNodeBinaryPointData(e,r,i,o,n,d){const h=await this.extractBinaryPointData(i,d);if(null==h)return Promise.reject();const c=this._getObjectIdField(),g=this._controller.crsVertex,m=this.view.spatialReference,y=this.graphics3d.graphicsCore,{positionData:f,featureIds:_}=h,v=3,E=f.length/v,x=new Array;for(let I=0;I<E;I++){const r=s(e.serviceObb)?e.serviceObb.center:[0,0,0],i=I*v,d=u(f[i+0],f[i+1],f[i+2]);l(d,d,r),e.serviceObb||n.push(d[0],d[1],d[2]),o&&this.checkExtent(o,d);const h=_[I],E={};null!=h&&(E[c]=h);const w=null==h?t.generateUID():h;p(d,g,0,ie,m,0,1);const S=b(ie[0],ie[1],ie[2],m),C=this.loadedGraphics.get(w);if(s(C))C.level<e.level&&(se.property=\"geometry\",se.graphic=C,se.oldValue=a(C.geometry),se.newValue=S,C.geometry=S,y.graphicUpdateHandler(se)),x.push(C);else{const r=t.generateUID();x.push({objectId:w,uid:r,geometry:S,attributes:E,visible:!0,level:e.level})}}r.graphics=x,r.featureIds=_}_addNodeLegacyPointData(e,r,i,o,a){const n=this._getObjectIdField(),d=this._controller.crsVertex,h=this.view.spatialReference,l=[0,0,0],u=new Array,c=new Array;for(const g of i.pointData){const r=g.featureDataPosition,i=r.length,m=g.geometries&&g.geometries[0]||re[i],y=g.featureIds[0];if(\"points\"!==m.params.type)continue;o&&this.checkExtent(o,r);const f={};null!=y&&(f[n]=y);const _=null==y?t.generateUID():y;let v;\"Embedded\"===m.type&&(v=m.params.vertexAttributes.position);for(let o=0;o<v.length;o+=i){for(let e=0;e<i;e++)l[e]=r[e]+v[o+e];const n=3===i;e.serviceObb||a.push(l[0],l[1],n?l[2]:0),p(l,d,0,ie,h,0,1);const u=b(ie[0],ie[1],n?ie[2]:void 0,h),g=this.loadedGraphics.get(_);s(g)?c.push(g):c.push({objectId:_,uid:t.generateUID(),geometry:u,attributes:f,visible:!0})}u.push(y)}r.graphics=c,r.featureIds=u}_updateNodeMemory(e){e.memory=4096+(s(e.numFeatures)?e.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(e){const t=e.graphics.reduce(((e,t)=>_(t)+e),512+8*e.featureIds.length+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}_getMemCacheKey(e){return`${e.index}`}_removeAllNodeData(){this._nodesAddedToStage.forEach((e=>{if(e){const t=e.node;this._updateNodeMemory(t),this._cacheNodeData(e)}})),this._nodesAddedToStage.clear(),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}removeNode(e){const t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}_removeNodeStageData(e){const t=this._nodesAddedToStage.get(e);return t?(this.loadedGraphics.removeMany(t.graphics),this._nodesAddedToStage.delete(e),this._treeDebugger&&this._treeDebugger.update(),t):null}async loadCachedNodeData(e){return this._memCache.pop(this._getMemCacheKey(e))}async addCachedNodeData(e,t,r,i){if(!this._nodesAddedToStage.has(e.index))return this.loadedGraphics.addMany(t.graphics),this._nodesAddedToStage.set(e.index,t),this._updateNodeMemory(e),await this.updateAttributes(e.index,r,i),this._filterNode(t),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve();K.error(\"I3S node \"+e.id+\" already added\")}getLoadedNodeIds(){const e=[];return this._nodesAddedToStage.forEach((t=>e.push(t.node.id))),e.sort()}getVisibleNodes(){const e=new Array;return this._nodesAddedToStage.forEach((t=>e.push(t.node))),e}getLoadedNodeIndices(e){this._nodesAddedToStage.forEach(((t,r)=>e.push(r)))}getLoadedAttributes(e){const t=this._nodesAddedToStage.get(e);if(t&&s(t.attributeInfo))return t.attributeInfo.loadedAttributes}getAttributeData(e){const t=this._nodesAddedToStage.get(e);if(t&&s(t.attributeInfo))return t.attributeInfo.attributeData}setAttributeData(e,t){const r=this._nodesAddedToStage.get(e);r&&!o(r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}async updateAttributes(e,t,r){const i=this._nodesAddedToStage.get(e);i&&(await this._attributeOverrides.apply(i.featureIds,t,r),i.attributeInfo=t,this._attributeValuesChanged(i))}_attributeValuesChanged(e){if(ee(e),this._filterNode(e),this.graphics3d.graphicsCore.labelsEnabled){const t=e.graphics.map((e=>e.uid));this.graphics3d.graphicsCore.updateLabelingInfo(t)}}_updateClippingExtent(e){return this._controller&&this._controller.updateClippingArea(e),!1}_getObjectIdField(){return this.layer.objectIdField||\"OBJECTID\"}async _rendererChange(e,t){const{layer:{fieldsIndex:r}}=this,i=new Set;let s,o;e?(await e.collectRequiredFields(i,r),s=Array.from(i).sort()):s=[],i.clear(),t?(await t.collectRequiredFields(i,r),o=Array.from(i).sort()):o=[],s.length===o.length&&s.every(((e,t)=>s[t]===o[t]))||this._reloadAllNodes()}_rangeInfosChanged(e){null!=e&&e.length>0&&K.warn(\"Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.\")}_filterChange(){this._nodesAddedToStage.forEach((e=>this._filterNode(e)))}_reloadAllNodes(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}_filterNode(e){const t=this.parsedDefinitionExpression;for(const r of e.graphics){const e=r.visible;r.visible=!t||this._evaluateClause(t,r),e!==r.visible&&(se.graphic=r,se.property=\"visible\",se.oldValue=e,se.newValue=r.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(se))}}_invalidateElevation(e){const t=this._controller.crsIndex;m(e.extent,e.spatialReference,oe,t),this._controller.updateElevationChanged(oe,t)}createQuery(){const e={outFields:[\"*\"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return s(this.filter)?this.filter.createQuery(e):new S(e)}queryFeatures(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),null==t?void 0:t.signal)}queryObjectIds(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryExtent(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQuery(e){return this._addDefinitionExpressionToQuery(o(e)?this.createQuery():S.from(e))}getUsedMemory(){const e=this.graphics3d&&this.graphics3d.graphicsCore;return e?e.usedMemory:0}getUnloadedMemory(){const e=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(e?e.unprocessedMemoryEstimate:0))}ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}_handleEdits(e){N(this.attributeEditingContext,e)}get attributeEditingContext(){const e=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:e,forEachNode:e=>this._nodesAddedToStage.forEach((t=>e(t.node,t.featureIds))),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(t,r,i)=>{this.setAttributeData(t,r);const o=this._nodesAddedToStage.get(t);if(s(i)){const t=this.loadedGraphics.get(i.attributes[e]);s(t)&&this.graphics3d.graphicsCore.recreateGraphics([t])}else s(o)&&this.graphics3d.graphicsCore.recreateGraphics(o.graphics)},clearMemCache:()=>{}}}get performanceInfo(){const e={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.graphics3d.graphicsCore.performanceInfo};return this._controller&&this._controller.updateStats(e),e}get test(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,numFeatures:this.loadedGraphics.length}}};e([d()],J.prototype,\"graphics3d\",void 0),e([d({type:z})],J.prototype,\"filter\",void 0),e([d()],J.prototype,\"loadedGraphics\",void 0),e([d({aliasOf:\"layer\"})],J.prototype,\"i3slayer\",void 0),e([d()],J.prototype,\"_controller\",void 0),e([d()],J.prototype,\"updating\",void 0),e([d()],J.prototype,\"suspended\",void 0),e([d()],J.prototype,\"holeFilling\",void 0),e([d(k)],J.prototype,\"updatingProgress\",void 0),e([d({aliasOf:\"_controller.updatingProgress\"})],J.prototype,\"updatingProgressValue\",void 0),e([d(Z.requiredFields)],J.prototype,\"requiredFields\",null),e([d(Z.availableFields)],J.prototype,\"availableFields\",void 0),e([d()],J.prototype,\"fieldsHelper\",void 0),e([d({type:Number})],J.prototype,\"maximumNumberOfFeatures\",null),e([d({readOnly:!0})],J.prototype,\"maximumNumberOfFeaturesExceeded\",null),e([d({readOnly:!0,aliasOf:\"view.qualitySettings.sceneService.point.lodFactor\"})],J.prototype,\"lodFactor\",void 0),e([d({readOnly:!0})],J.prototype,\"hasM\",null),e([d({readOnly:!0})],J.prototype,\"hasZ\",null),J=e([h(\"esri.views.3d.layers.SceneLayerGraphicsView3D\")],J);var Y=J;function $(e){return\"pointData\"in e}function X(e){return\"geometryBuffer\"in e&&null!==e.geometryBuffer}function ee(e){const t=e.attributeInfo;for(let r=0;r<e.graphics.length;r++){const i=e.graphics[r];if(i.attributes||(i.attributes={}),s(t)&&s(t.loadedAttributes))for(const{name:e}of t.loadedAttributes)t.attributeData[e]&&(i.attributes[e]=M(t.attributeData[e],r))}}function te(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}const re={2:{type:\"Embedded\",params:{type:\"points\",vertexAttributes:{position:[0,0]}}},3:{type:\"Embedded\",params:{type:\"points\",vertexAttributes:{position:[0,0,0]}}}},ie=c(),se={graphic:null,property:null,oldValue:null,newValue:null},oe=y();export default Y;\n"]},"metadata":{},"sourceType":"module"}