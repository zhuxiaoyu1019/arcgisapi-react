{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { neverReached as e } from \"../../../core/compilerUtils.js\";\nimport { unquantizeOptimizedGeometry as t, convertToGeometry as r } from \"../../../layers/graphics/featureConversionUtils.js\";\nimport { getGeometryZScaler as s } from \"./zscale.js\";\n\nfunction i(e, t) {\n  return t;\n}\n\nfunction o(e, t, r, s) {\n  switch (r) {\n    case 0:\n      return u(e, t + s, 0);\n\n    case 1:\n      return \"lowerLeft\" === e.originPosition ? u(e, t + s, 1) : d(e, t + s, 1);\n  }\n}\n\nfunction n(e, t, r, s) {\n  switch (r) {\n    case 2:\n      return u(e, t, 2);\n\n    default:\n      return o(e, t, r, s);\n  }\n}\n\nfunction a(e, t, r, s) {\n  switch (r) {\n    case 2:\n      return u(e, t, 3);\n\n    default:\n      return o(e, t, r, s);\n  }\n}\n\nfunction h(e, t, r, s) {\n  switch (r) {\n    case 3:\n      return u(e, t, 3);\n\n    default:\n      return n(e, t, r, s);\n  }\n}\n\nfunction u({\n  translate: e,\n  scale: t\n}, r, s) {\n  return e[s] + r * t[s];\n}\n\nfunction d({\n  translate: e,\n  scale: t\n}, r, s) {\n  return e[s] - r * t[s];\n}\n\nclass l {\n  constructor(e) {\n    this.options = e, this.geometryTypes = [\"esriGeometryPoint\", \"esriGeometryMultipoint\", \"esriGeometryPolyline\", \"esriGeometryPolygon\"], this.previousCoordinate = [0, 0], this.transform = null, this.applyTransform = i, this.lengths = [], this.currentLengthIndex = 0, this.toAddInCurrentPath = 0, this.vertexDimension = 0, this.coordinateBuffer = null, this.coordinateBufferPtr = 0, this.AttributesConstructor = function () {};\n  }\n\n  createFeatureResult() {\n    return {\n      fields: [],\n      features: []\n    };\n  }\n\n  finishFeatureResult(e) {\n    if (this.options.applyTransform && (e.transform = null), this.AttributesConstructor = function () {}, this.coordinateBuffer = null, this.lengths.length = 0, !e.hasZ) return;\n    const t = s(e.geometryType, this.options.sourceSpatialReference, e.spatialReference);\n    if (t) for (const r of e.features) t(r.geometry);\n  }\n\n  createSpatialReference() {\n    return {};\n  }\n\n  addField(e, t) {\n    e.fields.push(t);\n    const r = e.fields.map(e => e.name);\n\n    this.AttributesConstructor = function () {\n      for (const e of r) this[e] = null;\n    };\n  }\n\n  addFeature(e, t) {\n    e.features.push(t);\n  }\n\n  prepareFeatures(t) {\n    switch (this.transform = t.transform, this.options.applyTransform && t.transform && (this.applyTransform = this.deriveApplyTransform(t)), this.vertexDimension = 2, t.hasZ && this.vertexDimension++, t.hasM && this.vertexDimension++, t.geometryType) {\n      case \"esriGeometryPoint\":\n        this.addCoordinate = (e, t, r) => this.addCoordinatePoint(e, t, r), this.createGeometry = e => this.createPointGeometry(e);\n        break;\n\n      case \"esriGeometryPolygon\":\n        this.addCoordinate = (e, t, r) => this.addCoordinatePolygon(e, t, r), this.createGeometry = e => this.createPolygonGeometry(e);\n        break;\n\n      case \"esriGeometryPolyline\":\n        this.addCoordinate = (e, t, r) => this.addCoordinatePolyline(e, t, r), this.createGeometry = e => this.createPolylineGeometry(e);\n        break;\n\n      case \"esriGeometryMultipoint\":\n        this.addCoordinate = (e, t, r) => this.addCoordinateMultipoint(e, t, r), this.createGeometry = e => this.createMultipointGeometry(e);\n        break;\n\n      default:\n        e(t.geometryType);\n    }\n  }\n\n  createFeature() {\n    return this.lengths.length = 0, this.currentLengthIndex = 0, this.previousCoordinate[0] = 0, this.previousCoordinate[1] = 0, this.coordinateBuffer = null, this.coordinateBufferPtr = 0, {\n      attributes: new this.AttributesConstructor()\n    };\n  }\n\n  allocateCoordinates() {}\n\n  addLength(e, t, r) {\n    0 === this.lengths.length && (this.toAddInCurrentPath = t), this.lengths.push(t);\n  }\n\n  addQueryGeometry(e, s) {\n    const {\n      queryGeometry: i,\n      queryGeometryType: o\n    } = s,\n          n = t(i.clone(), i, !1, !1, this.transform),\n          a = r(n, o, !1, !1);\n    e.queryGeometryType = o, e.queryGeometry = { ...a\n    };\n  }\n\n  createPointGeometry(e) {\n    const t = {\n      x: 0,\n      y: 0,\n      spatialReference: e.spatialReference\n    };\n    return e.hasZ && (t.z = 0), e.hasM && (t.m = 0), t;\n  }\n\n  addCoordinatePoint(e, t, r) {\n    switch (t = this.applyTransform(this.transform, t, r, 0), r) {\n      case 0:\n        e.x = t;\n        break;\n\n      case 1:\n        e.y = t;\n        break;\n\n      case 2:\n        \"z\" in e ? e.z = t : e.m = t;\n        break;\n\n      case 3:\n        e.m = t;\n    }\n  }\n\n  transformPathLikeValue(e, t) {\n    let r = 0;\n    return t <= 1 && (r = this.previousCoordinate[t], this.previousCoordinate[t] += e), this.applyTransform(this.transform, e, t, r);\n  }\n\n  addCoordinatePolyline(e, t, r) {\n    this.dehydratedAddPointsCoordinate(e.paths, t, r);\n  }\n\n  addCoordinatePolygon(e, t, r) {\n    this.dehydratedAddPointsCoordinate(e.rings, t, r);\n  }\n\n  addCoordinateMultipoint(e, t, r) {\n    0 === r && e.points.push([]);\n    const s = this.transformPathLikeValue(t, r);\n    e.points[e.points.length - 1].push(s);\n  }\n\n  createPolygonGeometry(e) {\n    return {\n      rings: [[]],\n      spatialReference: e.spatialReference,\n      hasZ: !!e.hasZ,\n      hasM: !!e.hasM\n    };\n  }\n\n  createPolylineGeometry(e) {\n    return {\n      paths: [[]],\n      spatialReference: e.spatialReference,\n      hasZ: !!e.hasZ,\n      hasM: !!e.hasM\n    };\n  }\n\n  createMultipointGeometry(e) {\n    return {\n      points: [],\n      spatialReference: e.spatialReference,\n      hasZ: !!e.hasZ,\n      hasM: !!e.hasM\n    };\n  }\n\n  dehydratedAddPointsCoordinate(e, t, r) {\n    0 === r && 0 == this.toAddInCurrentPath-- && (e.push([]), this.toAddInCurrentPath = this.lengths[++this.currentLengthIndex] - 1, this.previousCoordinate[0] = 0, this.previousCoordinate[1] = 0);\n    const s = this.transformPathLikeValue(t, r),\n          i = e[e.length - 1];\n    0 === r && (this.coordinateBufferPtr = 0, this.coordinateBuffer = new Array(this.vertexDimension), i.push(this.coordinateBuffer)), this.coordinateBuffer[this.coordinateBufferPtr++] = s;\n  }\n\n  deriveApplyTransform(e) {\n    const {\n      hasZ: t,\n      hasM: r\n    } = e;\n    return t && r ? h : t ? n : r ? a : o;\n  }\n\n}\n\nexport { l as JSONFeatureSetParserContext };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/rest/query/operations/pbfJSONFeatureSet.js"],"names":["neverReached","e","unquantizeOptimizedGeometry","t","convertToGeometry","r","getGeometryZScaler","s","i","o","u","originPosition","d","n","a","h","translate","scale","l","constructor","options","geometryTypes","previousCoordinate","transform","applyTransform","lengths","currentLengthIndex","toAddInCurrentPath","vertexDimension","coordinateBuffer","coordinateBufferPtr","AttributesConstructor","createFeatureResult","fields","features","finishFeatureResult","length","hasZ","geometryType","sourceSpatialReference","spatialReference","geometry","createSpatialReference","addField","push","map","name","addFeature","prepareFeatures","deriveApplyTransform","hasM","addCoordinate","addCoordinatePoint","createGeometry","createPointGeometry","addCoordinatePolygon","createPolygonGeometry","addCoordinatePolyline","createPolylineGeometry","addCoordinateMultipoint","createMultipointGeometry","createFeature","attributes","allocateCoordinates","addLength","addQueryGeometry","queryGeometry","queryGeometryType","clone","x","y","z","m","transformPathLikeValue","dehydratedAddPointsCoordinate","paths","rings","points","Array","JSONFeatureSetParserContext"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{neverReached as e}from\"../../../core/compilerUtils.js\";import{unquantizeOptimizedGeometry as t,convertToGeometry as r}from\"../../../layers/graphics/featureConversionUtils.js\";import{getGeometryZScaler as s}from\"./zscale.js\";function i(e,t){return t}function o(e,t,r,s){switch(r){case 0:return u(e,t+s,0);case 1:return\"lowerLeft\"===e.originPosition?u(e,t+s,1):d(e,t+s,1)}}function n(e,t,r,s){switch(r){case 2:return u(e,t,2);default:return o(e,t,r,s)}}function a(e,t,r,s){switch(r){case 2:return u(e,t,3);default:return o(e,t,r,s)}}function h(e,t,r,s){switch(r){case 3:return u(e,t,3);default:return n(e,t,r,s)}}function u({translate:e,scale:t},r,s){return e[s]+r*t[s]}function d({translate:e,scale:t},r,s){return e[s]-r*t[s]}class l{constructor(e){this.options=e,this.geometryTypes=[\"esriGeometryPoint\",\"esriGeometryMultipoint\",\"esriGeometryPolyline\",\"esriGeometryPolygon\"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=i,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=s(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const r=e.fields.map((e=>e.name));this.AttributesConstructor=function(){for(const e of r)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(t){switch(this.transform=t.transform,this.options.applyTransform&&t.transform&&(this.applyTransform=this.deriveApplyTransform(t)),this.vertexDimension=2,t.hasZ&&this.vertexDimension++,t.hasM&&this.vertexDimension++,t.geometryType){case\"esriGeometryPoint\":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case\"esriGeometryPolygon\":this.addCoordinate=(e,t,r)=>this.addCoordinatePolygon(e,t,r),this.createGeometry=e=>this.createPolygonGeometry(e);break;case\"esriGeometryPolyline\":this.addCoordinate=(e,t,r)=>this.addCoordinatePolyline(e,t,r),this.createGeometry=e=>this.createPolylineGeometry(e);break;case\"esriGeometryMultipoint\":this.addCoordinate=(e,t,r)=>this.addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this.createMultipointGeometry(e);break;default:e(t.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,s){const{queryGeometry:i,queryGeometryType:o}=s,n=t(i.clone(),i,!1,!1,this.transform),a=r(n,o,!1,!1);e.queryGeometryType=o,e.queryGeometry={...a}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:\"z\"in e?e.z=t:e.m=t;break;case 3:e.m=t}}transformPathLikeValue(e,t){let r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}addCoordinatePolyline(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)}addCoordinatePolygon(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)}addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const s=this.transformPathLikeValue(t,r),i=e[e.length-1];0===r&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),i.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=s}deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?h:t?n:r?a:o}}export{l as JSONFeatureSetParserContext};\n"]},"metadata":{},"sourceType":"module"}