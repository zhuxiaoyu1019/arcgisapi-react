{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as i } from \"../../../../chunks/tslib.es6.js\";\nimport { ReloadableShaderModule as r } from \"../core/shaderTechnique/ReloadableShaderModule.js\";\nimport { ShaderTechnique as o } from \"../core/shaderTechnique/ShaderTechnique.js\";\nimport { ShaderTechniqueConfiguration as e, parameter as t } from \"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";\nimport { Default3D as s } from \"../lib/DefaultVertexAttributeLocations.js\";\nimport { blendingDefault as a } from \"../lib/OrderIndependentTransparency.js\";\nimport { Program as n } from \"../lib/Program.js\";\nimport { S as p } from \"../../../../chunks/ShadowAccumulation.glsl.js\";\nimport { makePipelineState as m, separateBlendingParams as h, defaultColorWriteParams as l } from \"../../../webgl/renderState.js\";\n\nclass c extends o {\n  initializeProgram(i) {\n    const r = c.shader.get().build(this.configuration);\n    return new n(i.rctx, r, s);\n  }\n\n  initializePipeline(i) {\n    return 0 === this.configuration.pass ? m({\n      blending: h(1, 1, 1, 1),\n      colorWrite: l,\n      depthTest: null,\n      depthWrite: null\n    }) : 1 === this.configuration.pass || 2 === this.configuration.pass ? m({\n      blending: a,\n      colorWrite: l,\n      depthTest: null,\n      depthWrite: null\n    }) : m({});\n  }\n\n  bindPass(i) {\n    if (0 === this.configuration.pass || 2 === this.configuration.pass) {\n      const r = i;\n      this.program.bindTexture(r.linearDepthTexture, \"depthMap\"), r.shadowMap.bind(this.program), r.shadowMap.bindView(this.program, r.camera.center), this.program.setUniform2fv(\"nearFar\", r.camera.nearFar), this.program.setUniformMatrix4fv(\"inverseView\", r.inverseView), this.program.setUniform4fv(\"projInfo\", r.projInfo), this.program.setUniform2fv(\"zScale\", r.zScale);\n    } else if (1 === this.configuration.pass) {\n      const r = i;\n\n      if (this.program.bindTexture(r.shadowAccumulationMap, \"shadowAccumulationMap\"), this.program.setUniform1f(\"sampleScale\", r.sampleScale), this.program.setUniform1f(\"opacityFromElevation\", r.opacityFromElevation), 0 === this.configuration.visualization) {\n        const r = i;\n        this.program.bindTexture(r.colorRamp, \"colorRamp\"), this.program.setUniform1f(\"rampSize\", r.rampSize), this.configuration.bandsEnabled && this.program.setUniform1f(\"bandSize\", r.bandSize);\n      } else if (1 === this.configuration.visualization) {\n        const r = i;\n        this.program.setUniform1f(\"threshold\", r.threshold), this.program.setUniform4fv(\"colors\", r.colors);\n      }\n    }\n  }\n\n  get primitiveType() {\n    return 5;\n  }\n\n}\n\nc.shader = new r(p, () => import(\"./ShadowAccumulation.glsl.js\"));\n\nclass d extends e {\n  constructor() {\n    super(...arguments), this.pass = 0, this.visualization = 0, this.bandsEnabled = !1;\n  }\n\n}\n\ni([t({\n  count: 3\n})], d.prototype, \"pass\", void 0), i([t()], d.prototype, \"visualization\", void 0), i([t()], d.prototype, \"bandsEnabled\", void 0);\nexport { c as ShadowAccumulationTechnique, d as ShadowAccumulationTechniqueConfiguration };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowAccumulationTechnique.js"],"names":["_","i","ReloadableShaderModule","r","ShaderTechnique","o","ShaderTechniqueConfiguration","e","parameter","t","Default3D","s","blendingDefault","a","Program","n","S","p","makePipelineState","m","separateBlendingParams","h","defaultColorWriteParams","l","c","initializeProgram","shader","get","build","configuration","rctx","initializePipeline","pass","blending","colorWrite","depthTest","depthWrite","bindPass","program","bindTexture","linearDepthTexture","shadowMap","bind","bindView","camera","center","setUniform2fv","nearFar","setUniformMatrix4fv","inverseView","setUniform4fv","projInfo","zScale","shadowAccumulationMap","setUniform1f","sampleScale","opacityFromElevation","visualization","colorRamp","rampSize","bandsEnabled","bandSize","threshold","colors","primitiveType","d","constructor","arguments","count","prototype","ShadowAccumulationTechnique","ShadowAccumulationTechniqueConfiguration"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as i}from\"../../../../chunks/tslib.es6.js\";import{ReloadableShaderModule as r}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as e,parameter as t}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as s}from\"../lib/DefaultVertexAttributeLocations.js\";import{blendingDefault as a}from\"../lib/OrderIndependentTransparency.js\";import{Program as n}from\"../lib/Program.js\";import{S as p}from\"../../../../chunks/ShadowAccumulation.glsl.js\";import{makePipelineState as m,separateBlendingParams as h,defaultColorWriteParams as l}from\"../../../webgl/renderState.js\";class c extends o{initializeProgram(i){const r=c.shader.get().build(this.configuration);return new n(i.rctx,r,s)}initializePipeline(i){return 0===this.configuration.pass?m({blending:h(1,1,1,1),colorWrite:l,depthTest:null,depthWrite:null}):1===this.configuration.pass||2===this.configuration.pass?m({blending:a,colorWrite:l,depthTest:null,depthWrite:null}):m({})}bindPass(i){if(0===this.configuration.pass||2===this.configuration.pass){const r=i;this.program.bindTexture(r.linearDepthTexture,\"depthMap\"),r.shadowMap.bind(this.program),r.shadowMap.bindView(this.program,r.camera.center),this.program.setUniform2fv(\"nearFar\",r.camera.nearFar),this.program.setUniformMatrix4fv(\"inverseView\",r.inverseView),this.program.setUniform4fv(\"projInfo\",r.projInfo),this.program.setUniform2fv(\"zScale\",r.zScale)}else if(1===this.configuration.pass){const r=i;if(this.program.bindTexture(r.shadowAccumulationMap,\"shadowAccumulationMap\"),this.program.setUniform1f(\"sampleScale\",r.sampleScale),this.program.setUniform1f(\"opacityFromElevation\",r.opacityFromElevation),0===this.configuration.visualization){const r=i;this.program.bindTexture(r.colorRamp,\"colorRamp\"),this.program.setUniform1f(\"rampSize\",r.rampSize),this.configuration.bandsEnabled&&this.program.setUniform1f(\"bandSize\",r.bandSize)}else if(1===this.configuration.visualization){const r=i;this.program.setUniform1f(\"threshold\",r.threshold),this.program.setUniform4fv(\"colors\",r.colors)}}}get primitiveType(){return 5}}c.shader=new r(p,(()=>import(\"./ShadowAccumulation.glsl.js\")));class d extends e{constructor(){super(...arguments),this.pass=0,this.visualization=0,this.bandsEnabled=!1}}i([t({count:3})],d.prototype,\"pass\",void 0),i([t()],d.prototype,\"visualization\",void 0),i([t()],d.prototype,\"bandsEnabled\",void 0);export{c as ShadowAccumulationTechnique,d as ShadowAccumulationTechniqueConfiguration};\n"]},"metadata":{},"sourceType":"module"}