{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { pt2px as t } from \"../../../../../../core/screenUtils.js\";\nimport { getXAnchorDirection as e, getYAnchorDirection as i } from \"../../alignmentUtils.js\";\nimport { premultiplyAlphaRGBA as s } from \"../../color.js\";\nimport { MIN_MAX_ZOOM_PRECISION_FACTOR as o } from \"../../definitions.js\";\nimport { i1616to32 as a } from \"../../number.js\";\nimport { TextMaterialKey as n } from \"../../materialKey/MaterialKey.js\";\nimport { isFunction as r, getMinMaxZoom as l } from \"./util.js\";\nimport h from \"./WGLBaseTextTemplate.js\";\nimport c from \"./WGLDynamicMeshTemplate.js\";\nimport { codepoints as m } from \"../../../../layers/features/textUtils.js\";\nconst _ = 5,\n      f = 24;\n\nfunction y(t, e, i, s) {\n  return \"string\" == typeof t.text ? t.text : \"function\" == typeof t.text ? t.text(e, i, s) : \"\";\n}\n\nclass p extends h(c) {\n  constructor(e, i, l) {\n    super(e), this._horizontalAlignment = \"center\", this._verticalAlignment = \"middle\", this._textToGlyphs = new Map(), this._minMaxZoom = a(Math.round(i * o), Math.round(l * o));\n    const h = e.scaleFactor || 1;\n\n    if (this._cimTextLayer = e, r(e.color)) {\n      const t = (t, i, o) => s(e.color(t, i, o));\n\n      this._dynamicPropertyMap.set(\"_color\", t);\n    } else this._color = s(e.color);\n\n    if (r(e.color)) {\n      const t = (t, i, o) => s(e.outlineColor(t, i, o));\n\n      this._dynamicPropertyMap.set(\"_haloColor\", t);\n    } else this._haloColor = s(e.outlineColor);\n\n    let c;\n    r(e.size) || (c = Math.min(Math.round(t(e.size * e.sizeRatio)), 127));\n\n    const m = (i, s, o) => r(e.size) ? Math.min(Math.round(t(e.size(i, s, o) * e.sizeRatio)), 127) : c;\n\n    if (this._dynamicPropertyMap.set(\"_size\", m), r(e.outlineSize)) {\n      const i = (i, s, o) => Math.min(Math.floor(_ * t(e.outlineSize(i, s, o) * e.sizeRatio)), 127);\n\n      this._dynamicPropertyMap.set(\"_haloSize\", i);\n    } else this._haloSize = Math.min(Math.floor(_ * t(e.outlineSize * e.sizeRatio)), 127);\n\n    let f;\n    r(e.offsetX) || (f = Math.round(t(e.offsetX * e.sizeRatio)));\n\n    const y = (i, s, o) => r(e.offsetX) ? Math.round(t(e.offsetX(i, s, o) * e.sizeRatio)) : f;\n\n    let p;\n    this._dynamicPropertyMap.set(\"_xOffset\", y), r(e.offsetY) || (p = Math.round(t(e.offsetY * e.sizeRatio)));\n\n    const d = (i, s, o) => r(e.offsetY) ? Math.round(t(e.offsetY(i, s, o) * e.sizeRatio)) : p;\n\n    this._dynamicPropertyMap.set(\"_yOffset\", d), r(e.angle) ? this._dynamicPropertyMap.set(\"_angle\", e.angle) : this._angle = e.angle, r(e.horizontalAlignment) ? this._dynamicPropertyMap.set(\"_horizontalAlignment\", e.horizontalAlignment) : this._horizontalAlignment = e.horizontalAlignment, r(e.verticalAlignment) ? this._dynamicPropertyMap.set(\"_verticalAlignment\", e.verticalAlignment) : this._verticalAlignment = e.verticalAlignment, this._scaleFactor = h, r(e.text) ? this._dynamicPropertyMap.set(\"_text\", e.text) : this._text = e.text;\n    const M = Math.min(Math.round(t(e.referenceSize * e.sizeRatio)), 127);\n    this._referenceSize = Math.round(Math.sqrt(256 * M)), this._materialKey = e.materialKey;\n    const g = n.load(this._materialKey);\n    g.sdf = !0, this._bitset = (1 === e.alignment ? 1 : 0) | (e.colorLocked ? 1 : 0) << 1, this._materialKey = g.data, this._decoration = \"none\", this._lineHeight = 1, this._lineWidth = 512, this._textPlacement = e.markerPlacement, this._effects = e.effects, this._isCIM = !0;\n  }\n\n  static fromCIMText(t, e) {\n    const [i, s] = l(t.scaleInfo, e);\n    return new p(t, i, s);\n  }\n\n  async analyze(t, e, i, s) {\n    const o = e.readLegacyFeature(),\n          a = y(this._cimTextLayer, o, i, s),\n          n = await t.getMosaicItem(this._cimTextLayer.cim, m(a));\n    return this._textToGlyphs.set(a, n.glyphMosaicItems), n;\n  }\n\n  bindFeature(t, s, o) {\n    const a = t.readLegacyFeature();\n    if (this._dynamicPropertyMap.forEach((t, e) => {\n      this[e] = t(a, s, o);\n    }), !this._text || 0 === this._text.length) return void (this._shapingInfo = null);\n    this._size *= this._scaleFactor, this._scale = this._size / f, this._xOffset *= this._scaleFactor, this._yOffset *= this._scaleFactor, this._xAlignD = e(this._horizontalAlignment || \"center\"), this._yAlignD = i(this._verticalAlignment || \"baseline\");\n\n    const n = this._textToGlyphs.get(this._text);\n\n    this.bindTextInfo(n, !1);\n  }\n\n}\n\nexport default p;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate.js"],"names":["pt2px","t","getXAnchorDirection","e","getYAnchorDirection","i","premultiplyAlphaRGBA","s","MIN_MAX_ZOOM_PRECISION_FACTOR","o","i1616to32","a","TextMaterialKey","n","isFunction","r","getMinMaxZoom","l","h","c","codepoints","m","_","f","y","text","p","constructor","_horizontalAlignment","_verticalAlignment","_textToGlyphs","Map","_minMaxZoom","Math","round","scaleFactor","_cimTextLayer","color","_dynamicPropertyMap","set","_color","outlineColor","_haloColor","size","min","sizeRatio","outlineSize","floor","_haloSize","offsetX","offsetY","d","angle","_angle","horizontalAlignment","verticalAlignment","_scaleFactor","_text","M","referenceSize","_referenceSize","sqrt","_materialKey","materialKey","g","load","sdf","_bitset","alignment","colorLocked","data","_decoration","_lineHeight","_lineWidth","_textPlacement","markerPlacement","_effects","effects","_isCIM","fromCIMText","scaleInfo","analyze","readLegacyFeature","getMosaicItem","cim","glyphMosaicItems","bindFeature","forEach","length","_shapingInfo","_size","_scale","_xOffset","_yOffset","_xAlignD","_yAlignD","get","bindTextInfo"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{pt2px as t}from\"../../../../../../core/screenUtils.js\";import{getXAnchorDirection as e,getYAnchorDirection as i}from\"../../alignmentUtils.js\";import{premultiplyAlphaRGBA as s}from\"../../color.js\";import{MIN_MAX_ZOOM_PRECISION_FACTOR as o}from\"../../definitions.js\";import{i1616to32 as a}from\"../../number.js\";import{TextMaterialKey as n}from\"../../materialKey/MaterialKey.js\";import{isFunction as r,getMinMaxZoom as l}from\"./util.js\";import h from\"./WGLBaseTextTemplate.js\";import c from\"./WGLDynamicMeshTemplate.js\";import{codepoints as m}from\"../../../../layers/features/textUtils.js\";const _=5,f=24;function y(t,e,i,s){return\"string\"==typeof t.text?t.text:\"function\"==typeof t.text?t.text(e,i,s):\"\"}class p extends(h(c)){constructor(e,i,l){super(e),this._horizontalAlignment=\"center\",this._verticalAlignment=\"middle\",this._textToGlyphs=new Map,this._minMaxZoom=a(Math.round(i*o),Math.round(l*o));const h=e.scaleFactor||1;if(this._cimTextLayer=e,r(e.color)){const t=(t,i,o)=>s(e.color(t,i,o));this._dynamicPropertyMap.set(\"_color\",t)}else this._color=s(e.color);if(r(e.color)){const t=(t,i,o)=>s(e.outlineColor(t,i,o));this._dynamicPropertyMap.set(\"_haloColor\",t)}else this._haloColor=s(e.outlineColor);let c;r(e.size)||(c=Math.min(Math.round(t(e.size*e.sizeRatio)),127));const m=(i,s,o)=>r(e.size)?Math.min(Math.round(t(e.size(i,s,o)*e.sizeRatio)),127):c;if(this._dynamicPropertyMap.set(\"_size\",m),r(e.outlineSize)){const i=(i,s,o)=>Math.min(Math.floor(_*t(e.outlineSize(i,s,o)*e.sizeRatio)),127);this._dynamicPropertyMap.set(\"_haloSize\",i)}else this._haloSize=Math.min(Math.floor(_*t(e.outlineSize*e.sizeRatio)),127);let f;r(e.offsetX)||(f=Math.round(t(e.offsetX*e.sizeRatio)));const y=(i,s,o)=>r(e.offsetX)?Math.round(t(e.offsetX(i,s,o)*e.sizeRatio)):f;let p;this._dynamicPropertyMap.set(\"_xOffset\",y),r(e.offsetY)||(p=Math.round(t(e.offsetY*e.sizeRatio)));const d=(i,s,o)=>r(e.offsetY)?Math.round(t(e.offsetY(i,s,o)*e.sizeRatio)):p;this._dynamicPropertyMap.set(\"_yOffset\",d),r(e.angle)?this._dynamicPropertyMap.set(\"_angle\",e.angle):this._angle=e.angle,r(e.horizontalAlignment)?this._dynamicPropertyMap.set(\"_horizontalAlignment\",e.horizontalAlignment):this._horizontalAlignment=e.horizontalAlignment,r(e.verticalAlignment)?this._dynamicPropertyMap.set(\"_verticalAlignment\",e.verticalAlignment):this._verticalAlignment=e.verticalAlignment,this._scaleFactor=h,r(e.text)?this._dynamicPropertyMap.set(\"_text\",e.text):this._text=e.text;const M=Math.min(Math.round(t(e.referenceSize*e.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*M)),this._materialKey=e.materialKey;const g=n.load(this._materialKey);g.sdf=!0,this._bitset=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1,this._materialKey=g.data,this._decoration=\"none\",this._lineHeight=1,this._lineWidth=512,this._textPlacement=e.markerPlacement,this._effects=e.effects,this._isCIM=!0}static fromCIMText(t,e){const[i,s]=l(t.scaleInfo,e);return new p(t,i,s)}async analyze(t,e,i,s){const o=e.readLegacyFeature(),a=y(this._cimTextLayer,o,i,s),n=await t.getMosaicItem(this._cimTextLayer.cim,m(a));return this._textToGlyphs.set(a,n.glyphMosaicItems),n}bindFeature(t,s,o){const a=t.readLegacyFeature();if(this._dynamicPropertyMap.forEach(((t,e)=>{this[e]=t(a,s,o)})),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/f,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=e(this._horizontalAlignment||\"center\"),this._yAlignD=i(this._verticalAlignment||\"baseline\");const n=this._textToGlyphs.get(this._text);this.bindTextInfo(n,!1)}}export default p;\n"]},"metadata":{},"sourceType":"module"}