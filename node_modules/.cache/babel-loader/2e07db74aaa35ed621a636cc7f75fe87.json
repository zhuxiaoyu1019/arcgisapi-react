{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport r from \"../../../Graphic.js\";\nimport t from \"../../../core/Error.js\";\nimport i from \"../../../core/Logger.js\";\nimport { isSome as s, isNone as l } from \"../../../core/maybe.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as n } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { WhereClause as a } from \"../../../core/sql/WhereClause.js\";\nimport \"../../../layers/buildingSublayers/BuildingComponentSublayer.js\";\nimport { fixFields as u, unpackFieldNames as d, populateMissingFields as p } from \"../../../layers/support/fieldUtils.js\";\nimport y from \"../../../rest/support/Query.js\";\nimport { BuildingSublayerView3DMixin as h } from \"./BuildingSublayerView3D.js\";\nimport { I3SMeshView3D as c } from \"./I3SMeshView3D.js\";\nimport { applyFilterMode as f } from \"./i3s/BuildingFilterUtil.js\";\nimport { createGetFeatureExtent as m } from \"./i3s/I3SGeometryUtil.js\";\nimport { I3SMeshViewFilter as F } from \"./i3s/I3SMeshViewFilter.js\";\nimport g from \"./i3s/I3SQueryEngine.js\";\nimport { I3SQueryFeatureAdapter as b } from \"./i3s/I3SQueryFeatureAdapter.js\";\nimport w from \"./i3s/I3SQueryFeatureStore.js\";\nimport { findFieldsCaseInsensitive as v, getIndexCrs as E } from \"./i3s/I3SUtil.js\";\nimport { DefinitionExpressionSceneLayerView as _ } from \"./support/DefinitionExpressionSceneLayerView.js\";\nimport x from \"../../layers/BuildingComponentSublayerView.js\";\nimport S from \"../../layers/support/FeatureFilter.js\";\nimport { getRequiredFields as j, getFetchPopupTemplate as I } from \"../../layers/support/popupUtils.js\";\nimport { TaskPriority as Q } from \"../../support/Scheduler.js\";\nconst q = i.getLogger(\"esri.views.3d.layers.BuildingComponentSublayerView3D\");\nlet R = class extends _(c(h(x))) {\n  constructor() {\n    super(...arguments), this.type = \"building-component-sublayer-3d\", this.layerView = null, this._elevationContext = \"scene\", this._isIntegratedMesh = !1, this._supportsLabeling = !1, this.lodFactor = 1, this.progressiveLoadFactor = 1, this._queryEngine = null;\n  }\n\n  get layerUid() {\n    return this.sublayer.layer.uid;\n  }\n\n  get sublayerUid() {\n    return this.sublayer.uid;\n  }\n\n  initialize() {\n    this.updatingHandles.add(this, \"sublayer.renderer,definitionExpressionFields,filterExpressionFields\", () => this._updateRequiredFields()), this.updatingHandles.add(this.sublayer, \"renderer\", e => this._rendererChange(e), 2);\n\n    for (const e of [\"parsedDefinitionExpression\", \"filter\", \"viewFilter.parsedWhereClause\", \"viewFilter.parsedGeometry\", \"viewFilter.sortedObjectIds\"]) this.updatingHandles.add(this, e, () => this._filterChange());\n\n    this.updatingHandles.add(this, \"parsedFilterExpressions\", () => this._updateSymbologyOverride(), 2), this.addResolvingPromise(this._updateRequiredFields());\n  }\n\n  get parsedFilterExpressions() {\n    return \"Overview\" === this.sublayer.modelName ? [] : this.layerView.filterExpressions.map(([e, r]) => {\n      let t;\n\n      try {\n        t = a.create(e, this.sublayer.fieldsIndex);\n      } catch (l) {\n        return q.error(\"Failed to parse filterExpression: \" + l), null;\n      }\n\n      if (!t.isStandardized) return q.error(\"filterExpression is using non standard function\"), null;\n      const i = [],\n            s = t.fieldNames;\n      return v(s, this.sublayer.fields, {\n        missingFields: i\n      }), i.length > 0 ? (q.error(`filterExpression references unknown fields: ${i.join(\", \")}`), null) : [t, r];\n    }).filter(e => null != e);\n  }\n\n  get filter() {\n    return s(this.viewFilter) ? this.viewFilter.filter : null;\n  }\n\n  set filter(e) {\n    !l(e) && F.checkSupport(e) ? s(this.viewFilter) ? this.viewFilter.filter = e : this.viewFilter = new F({\n      filter: e,\n      layerFieldsIndex: this.sublayer.fieldsIndex,\n      loadAsyncModule: e => this._loadAsyncModule(e),\n      applyFilters: () => this._applyFilters(!0),\n      addSqlFilter: (e, r) => this.addSqlFilter(e, r, this.logError)\n    }) : this.viewFilter = null;\n  }\n\n  _updateSymbologyOverride() {\n    const e = this.parsedFilterExpressions;\n    e.length > 0 ? this._setSymbologyOverride((r, t) => {\n      for (const [s, l] of e) try {\n        if (s.testFeature(r)) return f(t, l);\n      } catch (i) {\n        this.logError(i);\n      }\n\n      return f(t, null);\n    }, this.filterExpressionFields) : this._setSymbologyOverride(null, null);\n  }\n\n  get filterExpressionFields() {\n    return u(this.sublayer.fieldsIndex, this.parsedFilterExpressions.reduce((e, [r]) => e.concat(r.fieldNames), []));\n  }\n\n  get availableFields() {\n    const e = this.sublayer,\n          r = e.fieldsIndex;\n    let t = this.requiredFields;\n\n    if (e.outFields || e.layer.outFields) {\n      const i = [...(e.outFields || []), ...(e.layer.outFields || [])];\n      t = [...d(r, i), ...t];\n    }\n\n    return u(r, t);\n  }\n\n  _createLayerGraphic(e) {\n    const t = new r(null, null, e);\n    return t.layer = this.sublayer.layer, t.sourceLayer = this.sublayer, t;\n  }\n\n  canResume() {\n    return super.canResume() && (!this._controller || this._controller.rootNodeVisible);\n  }\n\n  async fetchPopupFeatures(e, r) {\n    const t = this._validateFetchPopupFeatures(r);\n\n    if (t) return Promise.reject(t);\n    if (!s(r) || !r.clientGraphics || 0 === r.clientGraphics.length) return [];\n    const i = [],\n          l = [],\n          o = s(this.sublayer.associatedLayer) ? await this.sublayer.associatedLayer.load() : this.sublayer,\n          n = d(this.sublayer.fieldsIndex, await j(o, I(this.sublayer, r))),\n          a = new Set();\n\n    for (const s of r.clientGraphics) p(n, s, a) ? l.push(s) : i.push(s);\n\n    return 0 === l.length ? Promise.resolve(i) : (s(this.sublayer.associatedLayer) && (await this.sublayer.associatedLayer.load().catch(() => q.warn(\"Failed to load associated feature layer. Displaying popup attributes from cached attributes.\"))), this.whenGraphicAttributes(l, Array.from(a)).catch(() => l).then(e => i.concat(e)));\n  }\n\n  async _updateRequiredFields() {\n    const e = u(this.sublayer.fieldsIndex, [...(this.sublayer.renderer ? await this.sublayer.renderer.getRequiredFields(this.sublayer.fieldsIndex) : []), ...(this.definitionExpressionFields || []), ...(this.filterExpressionFields || [])]);\n\n    this._set(\"requiredFields\", e);\n  }\n\n  _validateFetchPopupFeatures(e) {\n    const {\n      sublayer: r\n    } = this,\n          {\n      popupEnabled: i\n    } = r;\n    return i ? I(r, e) ? void 0 : new t(\"buildingscenelayerview3d:fetchPopupFeatures\", \"Layer does not define a popup template\", {\n      sublayer: r\n    }) : new t(\"buildingscenelayerview3d:fetchPopupFeatures\", \"Popups are disabled\", {\n      sublayer: r\n    });\n  }\n\n  getFilters() {\n    const e = super.getFilters();\n    return this.addSqlFilter(e, this.parsedDefinitionExpression, this.logError), s(this.viewFilter) && this.viewFilter.addFilters(e, this.view, this._controller.crsIndex, this._collection), e;\n  }\n\n  createQuery() {\n    const e = {\n      outFields: [\"*\"],\n      returnGeometry: !1,\n      outSpatialReference: this.view.spatialReference\n    };\n    return s(this.filter) ? this.filter.createQuery(e) : new y(e);\n  }\n\n  queryExtent(e, r) {\n    return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e), null == r ? void 0 : r.signal);\n  }\n\n  queryFeatureCount(e, r) {\n    return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e), null == r ? void 0 : r.signal);\n  }\n\n  queryFeatures(e, r) {\n    return this._ensureQueryEngine().executeQuery(this._ensureQuery(e), null == r ? void 0 : r.signal).then(e => {\n      if (null == e || !e.features) return e;\n      const r = this.sublayer,\n            t = r.layer;\n\n      for (const i of e.features) i.layer = t, i.sourceLayer = r;\n\n      return e;\n    });\n  }\n\n  queryObjectIds(e, r) {\n    return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e), null == r ? void 0 : r.signal);\n  }\n\n  _ensureQueryEngine() {\n    return l(this._queryEngine) && (this._queryEngine = this._createQueryEngine()), this._queryEngine;\n  }\n\n  _createQueryEngine() {\n    const e = m(this.view.spatialReference, this.view.renderSpatialReference, this._collection);\n    return new g({\n      layerView: this,\n      priority: Q.FEATURE_QUERY_ENGINE,\n      spatialIndex: new w({\n        featureAdapter: new b({\n          objectIdField: this.sublayer.objectIdField,\n          attributeStorageInfo: this.sublayer.attributeStorageInfo,\n          getFeatureExtent: e\n        }),\n        forAllFeatures: (e, r) => this._forAllFeatures((r, t, i) => e({\n          id: r,\n          index: t,\n          meta: i\n        }), r, 2),\n        getFeatureExtent: e,\n        sourceSpatialReference: E(this.sublayer),\n        viewSpatialReference: this.view.spatialReference\n      })\n    });\n  }\n\n  _ensureQuery(e) {\n    return this._addDefinitionExpressionToQuery(l(e) ? this.createQuery() : y.from(e));\n  }\n\n};\ne([o({\n  aliasOf: \"sublayer\"\n})], R.prototype, \"i3slayer\", void 0), e([o()], R.prototype, \"layerView\", void 0), e([o()], R.prototype, \"suspended\", void 0), e([o({\n  readOnly: !0,\n  aliasOf: \"view.qualitySettings.sceneService.3dObject.lodFactor\"\n})], R.prototype, \"lodFactor\", void 0), e([o({\n  readOnly: !0\n})], R.prototype, \"parsedFilterExpressions\", null), e([o({\n  type: S\n})], R.prototype, \"filter\", null), e([o()], R.prototype, \"viewFilter\", void 0), e([o({\n  type: [String],\n  readOnly: !0\n})], R.prototype, \"filterExpressionFields\", null), e([o({\n  type: [String],\n  readOnly: !0\n})], R.prototype, \"requiredFields\", void 0), e([o({\n  type: [String],\n  readOnly: !0\n})], R.prototype, \"availableFields\", null), R = e([n(\"esri.views.3d.layers.BuildingComponentSublayerView3D\")], R);\nvar O = R;\nexport default O;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/BuildingComponentSublayerView3D.js"],"names":["_","e","r","t","i","isSome","s","isNone","l","property","o","subclass","n","WhereClause","a","fixFields","u","unpackFieldNames","d","populateMissingFields","p","y","BuildingSublayerView3DMixin","h","I3SMeshView3D","c","applyFilterMode","f","createGetFeatureExtent","m","I3SMeshViewFilter","F","g","I3SQueryFeatureAdapter","b","w","findFieldsCaseInsensitive","v","getIndexCrs","E","DefinitionExpressionSceneLayerView","x","S","getRequiredFields","j","getFetchPopupTemplate","I","TaskPriority","Q","q","getLogger","R","constructor","arguments","type","layerView","_elevationContext","_isIntegratedMesh","_supportsLabeling","lodFactor","progressiveLoadFactor","_queryEngine","layerUid","sublayer","layer","uid","sublayerUid","initialize","updatingHandles","add","_updateRequiredFields","_rendererChange","_filterChange","_updateSymbologyOverride","addResolvingPromise","parsedFilterExpressions","modelName","filterExpressions","map","create","fieldsIndex","error","isStandardized","fieldNames","fields","missingFields","length","join","filter","viewFilter","checkSupport","layerFieldsIndex","loadAsyncModule","_loadAsyncModule","applyFilters","_applyFilters","addSqlFilter","logError","_setSymbologyOverride","testFeature","filterExpressionFields","reduce","concat","availableFields","requiredFields","outFields","_createLayerGraphic","sourceLayer","canResume","_controller","rootNodeVisible","fetchPopupFeatures","_validateFetchPopupFeatures","Promise","reject","clientGraphics","associatedLayer","load","Set","push","resolve","catch","warn","whenGraphicAttributes","Array","from","then","renderer","definitionExpressionFields","_set","popupEnabled","getFilters","parsedDefinitionExpression","addFilters","view","crsIndex","_collection","createQuery","returnGeometry","outSpatialReference","spatialReference","queryExtent","_ensureQueryEngine","executeQueryForExtent","_ensureQuery","signal","queryFeatureCount","executeQueryForCount","queryFeatures","executeQuery","features","queryObjectIds","executeQueryForIds","_createQueryEngine","renderSpatialReference","priority","FEATURE_QUERY_ENGINE","spatialIndex","featureAdapter","objectIdField","attributeStorageInfo","getFeatureExtent","forAllFeatures","_forAllFeatures","id","index","meta","sourceSpatialReference","viewSpatialReference","_addDefinitionExpressionToQuery","aliasOf","prototype","readOnly","String","O"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import r from\"../../../Graphic.js\";import t from\"../../../core/Error.js\";import i from\"../../../core/Logger.js\";import{isSome as s,isNone as l}from\"../../../core/maybe.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../../core/accessorSupport/decorators/subclass.js\";import{WhereClause as a}from\"../../../core/sql/WhereClause.js\";import\"../../../layers/buildingSublayers/BuildingComponentSublayer.js\";import{fixFields as u,unpackFieldNames as d,populateMissingFields as p}from\"../../../layers/support/fieldUtils.js\";import y from\"../../../rest/support/Query.js\";import{BuildingSublayerView3DMixin as h}from\"./BuildingSublayerView3D.js\";import{I3SMeshView3D as c}from\"./I3SMeshView3D.js\";import{applyFilterMode as f}from\"./i3s/BuildingFilterUtil.js\";import{createGetFeatureExtent as m}from\"./i3s/I3SGeometryUtil.js\";import{I3SMeshViewFilter as F}from\"./i3s/I3SMeshViewFilter.js\";import g from\"./i3s/I3SQueryEngine.js\";import{I3SQueryFeatureAdapter as b}from\"./i3s/I3SQueryFeatureAdapter.js\";import w from\"./i3s/I3SQueryFeatureStore.js\";import{findFieldsCaseInsensitive as v,getIndexCrs as E}from\"./i3s/I3SUtil.js\";import{DefinitionExpressionSceneLayerView as _}from\"./support/DefinitionExpressionSceneLayerView.js\";import x from\"../../layers/BuildingComponentSublayerView.js\";import S from\"../../layers/support/FeatureFilter.js\";import{getRequiredFields as j,getFetchPopupTemplate as I}from\"../../layers/support/popupUtils.js\";import{TaskPriority as Q}from\"../../support/Scheduler.js\";const q=i.getLogger(\"esri.views.3d.layers.BuildingComponentSublayerView3D\");let R=class extends(_(c(h(x)))){constructor(){super(...arguments),this.type=\"building-component-sublayer-3d\",this.layerView=null,this._elevationContext=\"scene\",this._isIntegratedMesh=!1,this._supportsLabeling=!1,this.lodFactor=1,this.progressiveLoadFactor=1,this._queryEngine=null}get layerUid(){return this.sublayer.layer.uid}get sublayerUid(){return this.sublayer.uid}initialize(){this.updatingHandles.add(this,\"sublayer.renderer,definitionExpressionFields,filterExpressionFields\",(()=>this._updateRequiredFields())),this.updatingHandles.add(this.sublayer,\"renderer\",(e=>this._rendererChange(e)),2);for(const e of[\"parsedDefinitionExpression\",\"filter\",\"viewFilter.parsedWhereClause\",\"viewFilter.parsedGeometry\",\"viewFilter.sortedObjectIds\"])this.updatingHandles.add(this,e,(()=>this._filterChange()));this.updatingHandles.add(this,\"parsedFilterExpressions\",(()=>this._updateSymbologyOverride()),2),this.addResolvingPromise(this._updateRequiredFields())}get parsedFilterExpressions(){return\"Overview\"===this.sublayer.modelName?[]:this.layerView.filterExpressions.map((([e,r])=>{let t;try{t=a.create(e,this.sublayer.fieldsIndex)}catch(l){return q.error(\"Failed to parse filterExpression: \"+l),null}if(!t.isStandardized)return q.error(\"filterExpression is using non standard function\"),null;const i=[],s=t.fieldNames;return v(s,this.sublayer.fields,{missingFields:i}),i.length>0?(q.error(`filterExpression references unknown fields: ${i.join(\", \")}`),null):[t,r]})).filter((e=>null!=e))}get filter(){return s(this.viewFilter)?this.viewFilter.filter:null}set filter(e){!l(e)&&F.checkSupport(e)?s(this.viewFilter)?this.viewFilter.filter=e:this.viewFilter=new F({filter:e,layerFieldsIndex:this.sublayer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(e,r)=>this.addSqlFilter(e,r,this.logError)}):this.viewFilter=null}_updateSymbologyOverride(){const e=this.parsedFilterExpressions;e.length>0?this._setSymbologyOverride(((r,t)=>{for(const[s,l]of e)try{if(s.testFeature(r))return f(t,l)}catch(i){this.logError(i)}return f(t,null)}),this.filterExpressionFields):this._setSymbologyOverride(null,null)}get filterExpressionFields(){return u(this.sublayer.fieldsIndex,this.parsedFilterExpressions.reduce(((e,[r])=>e.concat(r.fieldNames)),[]))}get availableFields(){const e=this.sublayer,r=e.fieldsIndex;let t=this.requiredFields;if(e.outFields||e.layer.outFields){const i=[...e.outFields||[],...e.layer.outFields||[]];t=[...d(r,i),...t]}return u(r,t)}_createLayerGraphic(e){const t=new r(null,null,e);return t.layer=this.sublayer.layer,t.sourceLayer=this.sublayer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}async fetchPopupFeatures(e,r){const t=this._validateFetchPopupFeatures(r);if(t)return Promise.reject(t);if(!s(r)||!r.clientGraphics||0===r.clientGraphics.length)return[];const i=[],l=[],o=s(this.sublayer.associatedLayer)?await this.sublayer.associatedLayer.load():this.sublayer,n=d(this.sublayer.fieldsIndex,await j(o,I(this.sublayer,r))),a=new Set;for(const s of r.clientGraphics)p(n,s,a)?l.push(s):i.push(s);return 0===l.length?Promise.resolve(i):(s(this.sublayer.associatedLayer)&&await this.sublayer.associatedLayer.load().catch((()=>q.warn(\"Failed to load associated feature layer. Displaying popup attributes from cached attributes.\"))),this.whenGraphicAttributes(l,Array.from(a)).catch((()=>l)).then((e=>i.concat(e))))}async _updateRequiredFields(){const e=u(this.sublayer.fieldsIndex,[...this.sublayer.renderer?await this.sublayer.renderer.getRequiredFields(this.sublayer.fieldsIndex):[],...this.definitionExpressionFields||[],...this.filterExpressionFields||[]]);this._set(\"requiredFields\",e)}_validateFetchPopupFeatures(e){const{sublayer:r}=this,{popupEnabled:i}=r;return i?I(r,e)?void 0:new t(\"buildingscenelayerview3d:fetchPopupFeatures\",\"Layer does not define a popup template\",{sublayer:r}):new t(\"buildingscenelayerview3d:fetchPopupFeatures\",\"Popups are disabled\",{sublayer:r})}getFilters(){const e=super.getFilters();return this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),s(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}createQuery(){const e={outFields:[\"*\"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return s(this.filter)?this.filter.createQuery(e):new y(e)}queryExtent(e,r){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null==r?void 0:r.signal)}queryFeatureCount(e,r){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null==r?void 0:r.signal)}queryFeatures(e,r){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null==r?void 0:r.signal).then((e=>{if(null==e||!e.features)return e;const r=this.sublayer,t=r.layer;for(const i of e.features)i.layer=t,i.sourceLayer=r;return e}))}queryObjectIds(e,r){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null==r?void 0:r.signal)}_ensureQueryEngine(){return l(this._queryEngine)&&(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=m(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new g({layerView:this,priority:Q.FEATURE_QUERY_ENGINE,spatialIndex:new w({featureAdapter:new b({objectIdField:this.sublayer.objectIdField,attributeStorageInfo:this.sublayer.attributeStorageInfo,getFeatureExtent:e}),forAllFeatures:(e,r)=>this._forAllFeatures(((r,t,i)=>e({id:r,index:t,meta:i})),r,2),getFeatureExtent:e,sourceSpatialReference:E(this.sublayer),viewSpatialReference:this.view.spatialReference})})}_ensureQuery(e){return this._addDefinitionExpressionToQuery(l(e)?this.createQuery():y.from(e))}};e([o({aliasOf:\"sublayer\"})],R.prototype,\"i3slayer\",void 0),e([o()],R.prototype,\"layerView\",void 0),e([o()],R.prototype,\"suspended\",void 0),e([o({readOnly:!0,aliasOf:\"view.qualitySettings.sceneService.3dObject.lodFactor\"})],R.prototype,\"lodFactor\",void 0),e([o({readOnly:!0})],R.prototype,\"parsedFilterExpressions\",null),e([o({type:S})],R.prototype,\"filter\",null),e([o()],R.prototype,\"viewFilter\",void 0),e([o({type:[String],readOnly:!0})],R.prototype,\"filterExpressionFields\",null),e([o({type:[String],readOnly:!0})],R.prototype,\"requiredFields\",void 0),e([o({type:[String],readOnly:!0})],R.prototype,\"availableFields\",null),R=e([n(\"esri.views.3d.layers.BuildingComponentSublayerView3D\")],R);var O=R;export default O;\n"]},"metadata":{},"sourceType":"module"}