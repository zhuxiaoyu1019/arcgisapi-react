{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../core/Logger.js\";\nimport { create as s } from \"../../geometry/support/aaBoundingRect.js\";\nimport { getBoundsXY as e } from \"../../geometry/support/boundsUtils.js\";\nimport { isPolygon as i, isPolyline as r, isExtent as a } from \"../../geometry/support/jsonUtils.js\";\nimport { SimpleGeometryCursor as o } from \"./CIMEffects.js\";\nimport { getEffectOperator as n, getPlacementOperator as h } from \"./CIMOperators.js\";\nimport { Placement as l } from \"./CIMPlacements.js\";\nimport c from \"./Rect.js\";\nconst f = Math.PI / 180,\n      m = t.getLogger(\"esri.symbols.cim.CIMSymbolDrawHelper\");\n\nclass u {\n  constructor(t) {\n    this._t = t;\n  }\n\n  static createIdentity() {\n    return new u([1, 0, 0, 0, 1, 0]);\n  }\n\n  clone() {\n    const t = this._t;\n    return new u(t.slice());\n  }\n\n  transform(t) {\n    const s = this._t;\n    return [s[0] * t[0] + s[1] * t[1] + s[2], s[3] * t[0] + s[4] * t[1] + s[5]];\n  }\n\n  static createScale(t, s) {\n    return new u([t, 0, 0, 0, s, 0]);\n  }\n\n  scale(t, s) {\n    const e = this._t;\n    return e[0] *= t, e[1] *= t, e[2] *= t, e[3] *= s, e[4] *= s, e[5] *= s, this;\n  }\n\n  scaleRatio() {\n    return Math.sqrt(this._t[0] * this._t[0] + this._t[1] * this._t[1]);\n  }\n\n  static createTranslate(t, s) {\n    return new u([0, 0, t, 0, 0, s]);\n  }\n\n  translate(t, s) {\n    const e = this._t;\n    return e[2] += t, e[5] += s, this;\n  }\n\n  static createRotate(t) {\n    const s = Math.cos(t),\n          e = Math.sin(t);\n    return new u([s, -e, 0, e, s, 0]);\n  }\n\n  rotate(t) {\n    return this.multiply(u.createRotate(t));\n  }\n\n  multiply(t) {\n    const s = this._t,\n          e = t._t,\n          i = s[0] * e[0] + s[3] * e[1],\n          r = s[1] * e[0] + s[4] * e[1],\n          a = s[2] * e[0] + s[5] * e[1] + e[2],\n          o = s[0] * e[3] + s[3] * e[4],\n          n = s[1] * e[3] + s[4] * e[4],\n          h = s[2] * e[3] + s[5] * e[4] + e[5];\n    return s[0] = i, s[1] = r, s[2] = a, s[3] = o, s[4] = n, s[5] = h, this;\n  }\n\n}\n\nclass p {\n  constructor(t) {\n    this._transfos = [], this._sizeTransfos = [], this._transfos.push(t || u.createIdentity()), this._sizeTransfos.push(t ? t.scaleRatio() : 1);\n  }\n\n  transformPt(t) {\n    return this._transfos[this._transfos.length - 1].transform(t);\n  }\n\n  transformSize(t) {\n    return t * this._sizeTransfos[this._sizeTransfos.length - 1];\n  }\n\n  back() {\n    return this._transfos[this._transfos.length - 1];\n  }\n\n  push(t, s) {\n    const e = s ? t.scaleRatio() : 1;\n    t.multiply(this.back()), this._transfos.push(t), this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length - 1] * e);\n  }\n\n  pop() {\n    this._transfos.splice(-1, 1), this._sizeTransfos.splice(-1, 1);\n  }\n\n  drawSymbol(t, s) {\n    if (t) switch (t.type) {\n      case \"CIMPointSymbol\":\n      case \"CIMLineSymbol\":\n      case \"CIMPolygonSymbol\":\n        this.drawMultiLayerSymbol(t, s);\n    }\n  }\n\n  drawMultiLayerSymbol(t, s) {\n    if (!t) return;\n    const e = t.symbolLayers;\n    if (!e) return;\n    const i = t.effects;\n\n    if (i) {\n      const t = this.executeEffects(i, s);\n\n      if (t) {\n        let s = t.next();\n\n        for (; s;) this.drawSymbolLayers(e, s), s = t.next();\n      }\n    } else this.drawSymbolLayers(e, s);\n  }\n\n  executeEffects(t, s) {\n    const e = 1;\n    let i = new o(s);\n\n    for (const r of t) {\n      const t = n(r);\n      t && (i = t.execute(i, r, e));\n    }\n\n    return i;\n  }\n\n  drawSymbolLayers(t, s) {\n    let e = t.length;\n\n    for (; e--;) {\n      const i = t[e];\n      if (!i || !1 === i.enable) continue;\n      const r = i.effects;\n\n      if (r) {\n        const t = this.executeEffects(r, s);\n\n        if (t) {\n          let s = t.next();\n\n          for (; s;) this.drawSymbolLayer(i, s), s = t.next();\n        }\n      } else this.drawSymbolLayer(i, s);\n    }\n  }\n\n  drawSymbolLayer(t, s) {\n    switch (t.type) {\n      case \"CIMSolidFill\":\n        this.drawSolidFill(s, t.color);\n        break;\n\n      case \"CIMHatchFill\":\n        this.drawHatchFill(t, s);\n        break;\n\n      case \"CIMSolidStroke\":\n        this.drawSolidStroke(s, t.color, t.width, t.capStyle, t.joinStyle, t.miterLimit);\n        break;\n\n      case \"CIMCharacterMarker\":\n      case \"CIMPictureMarker\":\n      case \"CIMVectorMarker\":\n        this.drawMarkerLayer(t, s);\n    }\n  }\n\n  drawHatchFill(t, s) {\n    const e = 1,\n          i = this._buildHatchPolyline(t, s, e);\n\n    i && (this.pushClipPath(s), this.drawMultiLayerSymbol(t.lineSymbol, i), this.popClipPath());\n  }\n\n  drawMarkerLayer(t, s) {\n    const e = t.markerPlacement;\n\n    if (e) {\n      const i = h(e);\n\n      if (i) {\n        const r = \"CIMMarkerPlacementInsidePolygon\" === e.type;\n        r && this.pushClipPath(s);\n        const a = 1,\n              o = i.execute(s, e, a);\n\n        if (o) {\n          let s = o.next();\n\n          for (; s;) this.drawMarker(t, s), s = o.next();\n        }\n\n        r && this.popClipPath();\n      }\n    } else {\n      const e = new l();\n      e.tx = s.x, e.ty = s.y, this.drawMarker(t, e);\n    }\n  }\n\n  drawMarker(t, s) {\n    switch (t.type) {\n      case \"CIMCharacterMarker\":\n      case \"CIMPictureMarker\":\n        this.drawPictureMarker(t, s);\n        break;\n\n      case \"CIMVectorMarker\":\n        this.drawVectorMarker(t, s);\n    }\n  }\n\n  drawPictureMarker(t, s) {\n    if (!t) return;\n    const e = t.size || 10,\n          i = u.createIdentity(),\n          r = t.anchorPoint;\n\n    if (r) {\n      let s = r.x,\n          a = r.y;\n      \"Absolute\" !== t.anchorPointUnits && (s *= e, a *= e), i.translate(-s, -a);\n    }\n\n    t.rotation && i.rotate(t.rotation * f), i.translate(t.offsetX || 0, t.offsetY || 0), i.translate(s.tx, s.ty), this.push(i, !1), this.drawImage(t.url, e, t.scaleX), this.pop();\n  }\n\n  drawVectorMarker(t, s) {\n    if (!t) return;\n    const e = t.markerGraphics;\n    if (!e) return;\n    const i = t.size,\n          r = t.frame,\n          a = r ? r.ymax - r.ymin : 0,\n          o = i && a ? i / a : 1,\n          n = u.createIdentity();\n    r && n.translate(.5 * -(r.xmax + r.xmin), .5 * -(r.ymax + r.ymin));\n    const h = t.anchorPoint;\n\n    if (h) {\n      let s = h.x,\n          e = h.y;\n      \"Absolute\" !== t.anchorPointUnits ? r && (s *= r.xmax - r.xmin, e *= r.ymax - r.ymin) : (s /= o, e /= o), n.translate(-s, -e);\n    }\n\n    1 !== o && n.scale(o, o), t.rotation && n.rotate(t.rotation * f), n.translate(t.offsetX || 0, t.offsetY || 0), n.translate(s.tx, s.ty), this.push(n, t.scaleSymbolsProportionally);\n\n    for (const l of e) l && l.symbol && l.geometry || m.error(\"Invalid marker graphic\", l), this.drawSymbol(l.symbol, l.geometry);\n\n    this.pop();\n  }\n\n  _buildHatchPolyline(t, i, r) {\n    let a = (void 0 !== t.separation ? t.separation : 4) * r,\n        o = void 0 !== t.rotation ? t.rotation : 0;\n    if (0 === a) return null;\n    a < 0 && (a = -a);\n    let n = 0;\n    const h = .5 * a;\n\n    for (; n > h;) n -= a;\n\n    for (; n < -h;) n += a;\n\n    const l = s();\n    e(l, i), l[0] -= h, l[1] -= h, l[2] += h, l[3] += h;\n    const c = [[l[0], l[1]], [l[0], l[3]], [l[2], l[3]], [l[2], l[1]]];\n\n    for (; o > 180;) o -= 180;\n\n    for (; o < 0;) o += 180;\n\n    const m = Math.cos(o * f),\n          u = Math.sin(o * f),\n          p = -a * u,\n          _ = a * m;\n\n    let y, d, x, M;\n    n = (void 0 !== t.offsetX ? t.offsetX * r : 0) * u - (void 0 !== t.offsetY ? t.offsetY * r : 0) * m, y = x = Number.MAX_VALUE, d = M = -Number.MAX_VALUE;\n\n    for (const s of c) {\n      const t = s[0],\n            e = s[1],\n            i = m * t + u * e,\n            r = -u * t + m * e;\n      y = Math.min(y, i), x = Math.min(x, r), d = Math.max(d, i), M = Math.max(M, r);\n    }\n\n    x = Math.floor(x / a) * a;\n    let b = m * y - u * x - p * n / a,\n        P = u * y + m * x - _ * n / a,\n        w = m * d - u * x - p * n / a,\n        g = u * d + m * x - _ * n / a;\n    const S = 1 + Math.round((M - x) / a),\n          C = [];\n\n    for (let s = 0; s < S; s++) b += p, P += _, w += p, g += _, C.push([[b, P], [w, g]]);\n\n    return {\n      paths: C\n    };\n  }\n\n}\n\nclass _ extends p {\n  constructor() {\n    super(), this.reset();\n  }\n\n  reset() {\n    this._xmin = this._ymin = 1 / 0, this._xmax = this._ymax = -1 / 0, this._clipCount = 0;\n  }\n\n  envelope() {\n    return new c(this._xmin, this._ymin, this._xmax - this._xmin, this._ymax - this._ymin);\n  }\n\n  drawSolidFill(t) {\n    if (t && !(this._clipCount > 0)) if (i(t)) this._processPath(t.rings, 0);else if (r(t)) this._processPath(t.paths, 0);else if (a(t)) {\n      const s = d(t);\n      s && this._processPath(s.rings, 0);\n    }\n  }\n\n  drawSolidStroke(t, s, e) {\n    if (!t || this._clipCount > 0) return;\n    const o = .5 * this.transformSize(e);\n    if (i(t)) this._processPath(t.rings, o);else if (r(t)) this._processPath(t.paths, o);else if (a(t)) {\n      const s = d(t);\n      s && this._processPath(s.rings, o);\n    }\n  }\n\n  pushClipPath(t) {\n    this.drawSolidFill(t), ++this._clipCount;\n  }\n\n  popClipPath() {\n    --this._clipCount;\n  }\n\n  drawImage(t, s, e) {\n    const i = s / 2;\n\n    this._merge(this.transformPt([0, 0]), i);\n  }\n\n  _processPath(t, s) {\n    if (t) for (const e of t) {\n      const t = e ? e.length : 0;\n\n      if (t > 1) {\n        this._merge(this.transformPt(e[0]), s);\n\n        for (let i = 1; i < t; ++i) this._merge(this.transformPt(e[i]), s);\n      }\n    }\n  }\n\n  _merge(t, s) {\n    t[0] - s < this._xmin && (this._xmin = t[0] - s), t[0] + s > this._xmax && (this._xmax = t[0] + s), t[1] - s < this._ymin && (this._ymin = t[1] - s), t[1] + s > this._ymax && (this._ymax = t[1] + s);\n  }\n\n}\n\nclass y extends p {\n  constructor(t, s) {\n    super(s), this._ctx = t;\n  }\n\n  drawSolidFill(t, s) {\n    if (!t) return;\n    if (i(t)) this._buildPath(t.rings, !0);else if (r(t)) this._buildPath(t.paths, !0);else {\n      if (!a(t)) return;\n\n      this._buildPath(d(t).rings, !0);\n    }\n    const e = this._ctx;\n    e.fillStyle = \"string\" == typeof s ? s : \"rgba(\" + Math.round(s[0]) + \",\" + Math.round(s[1]) + \",\" + Math.round(s[2]) + \",\" + s[3] / 255 + \")\", e.fill(\"evenodd\");\n  }\n\n  drawSolidStroke(t, s, e, o, n, h) {\n    if (!t || !s || 0 === e) return;\n    if (i(t)) this._buildPath(t.rings, !0);else if (r(t)) this._buildPath(t.paths, !1);else {\n      if (!a(t)) return;\n\n      this._buildPath(d(t).rings, !0);\n    }\n    const l = this._ctx;\n    l.strokeStyle = \"string\" == typeof s ? s : \"rgba(\" + Math.round(s[0]) + \",\" + Math.round(s[1]) + \",\" + Math.round(s[2]) + \",\" + s[3] / 255 + \")\", l.lineWidth = this.transformSize(e) + .5, this._setCapStyle(o), this._setJoinStyle(n), l.miterLimit = h, l.stroke();\n  }\n\n  pushClipPath(t) {\n    if (this._ctx.save(), i(t)) this._buildPath(t.rings, !0);else if (r(t)) this._buildPath(t.paths, !0);else {\n      if (!a(t)) return;\n\n      this._buildPath(d(t).rings, !0);\n    }\n\n    this._ctx.clip(\"evenodd\");\n  }\n\n  popClipPath() {\n    this._ctx.restore();\n  }\n\n  drawImage(t, s, e) {}\n\n  _buildPath(t, s) {\n    const e = this._ctx;\n    if (e.beginPath(), t) for (const i of t) {\n      const t = i ? i.length : 0;\n\n      if (t > 1) {\n        let r = this.transformPt(i[0]);\n        e.moveTo(r[0], r[1]);\n\n        for (let s = 1; s < t; ++s) r = this.transformPt(i[s]), e.lineTo(r[0], r[1]);\n\n        s && e.closePath();\n      }\n    }\n  }\n\n  _setCapStyle(t) {\n    switch (t) {\n      case \"Butt\":\n        this._ctx.lineCap = \"butt\";\n        break;\n\n      case \"Round\":\n        this._ctx.lineCap = \"round\";\n        break;\n\n      case \"Square\":\n        this._ctx.lineCap = \"square\";\n    }\n  }\n\n  _setJoinStyle(t) {\n    switch (t) {\n      case \"Bevel\":\n        this._ctx.lineJoin = \"bevel\";\n        break;\n\n      case \"Round\":\n        this._ctx.lineJoin = \"round\";\n        break;\n\n      case \"Miter\":\n        this._ctx.lineJoin = \"miter\";\n    }\n  }\n\n}\n\nconst d = t => t ? {\n  spatialReference: t.spatialReference,\n  rings: [[[t.xmin, t.ymin], [t.xmin, t.ymax], [t.xmax, t.ymax], [t.xmax, t.ymin], [t.xmin, t.ymin]]]\n} : null;\n\nexport { p as CIMSymbolDrawHelper, f as C_DEG_TO_RAD, y as CanvasDrawHelper, _ as EnvDrawHelper, u as Transformation };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/symbols/cim/CIMSymbolDrawHelper.js"],"names":["t","create","s","getBoundsXY","e","isPolygon","i","isPolyline","r","isExtent","a","SimpleGeometryCursor","o","getEffectOperator","n","getPlacementOperator","h","Placement","l","c","f","Math","PI","m","getLogger","u","constructor","_t","createIdentity","clone","slice","transform","createScale","scale","scaleRatio","sqrt","createTranslate","translate","createRotate","cos","sin","rotate","multiply","p","_transfos","_sizeTransfos","push","transformPt","length","transformSize","back","pop","splice","drawSymbol","type","drawMultiLayerSymbol","symbolLayers","effects","executeEffects","next","drawSymbolLayers","execute","enable","drawSymbolLayer","drawSolidFill","color","drawHatchFill","drawSolidStroke","width","capStyle","joinStyle","miterLimit","drawMarkerLayer","_buildHatchPolyline","pushClipPath","lineSymbol","popClipPath","markerPlacement","drawMarker","tx","x","ty","y","drawPictureMarker","drawVectorMarker","size","anchorPoint","anchorPointUnits","rotation","offsetX","offsetY","drawImage","url","scaleX","markerGraphics","frame","ymax","ymin","xmax","xmin","scaleSymbolsProportionally","symbol","geometry","error","separation","_","d","M","Number","MAX_VALUE","min","max","floor","b","P","w","g","S","round","C","paths","reset","_xmin","_ymin","_xmax","_ymax","_clipCount","envelope","_processPath","rings","_merge","_ctx","_buildPath","fillStyle","fill","strokeStyle","lineWidth","_setCapStyle","_setJoinStyle","stroke","save","clip","restore","beginPath","moveTo","lineTo","closePath","lineCap","lineJoin","spatialReference","CIMSymbolDrawHelper","C_DEG_TO_RAD","CanvasDrawHelper","EnvDrawHelper","Transformation"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../core/Logger.js\";import{create as s}from\"../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as e}from\"../../geometry/support/boundsUtils.js\";import{isPolygon as i,isPolyline as r,isExtent as a}from\"../../geometry/support/jsonUtils.js\";import{SimpleGeometryCursor as o}from\"./CIMEffects.js\";import{getEffectOperator as n,getPlacementOperator as h}from\"./CIMOperators.js\";import{Placement as l}from\"./CIMPlacements.js\";import c from\"./Rect.js\";const f=Math.PI/180,m=t.getLogger(\"esri.symbols.cim.CIMSymbolDrawHelper\");class u{constructor(t){this._t=t}static createIdentity(){return new u([1,0,0,0,1,0])}clone(){const t=this._t;return new u(t.slice())}transform(t){const s=this._t;return[s[0]*t[0]+s[1]*t[1]+s[2],s[3]*t[0]+s[4]*t[1]+s[5]]}static createScale(t,s){return new u([t,0,0,0,s,0])}scale(t,s){const e=this._t;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=s,e[4]*=s,e[5]*=s,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,s){return new u([0,0,t,0,0,s])}translate(t,s){const e=this._t;return e[2]+=t,e[5]+=s,this}static createRotate(t){const s=Math.cos(t),e=Math.sin(t);return new u([s,-e,0,e,s,0])}rotate(t){return this.multiply(u.createRotate(t))}multiply(t){const s=this._t,e=t._t,i=s[0]*e[0]+s[3]*e[1],r=s[1]*e[0]+s[4]*e[1],a=s[2]*e[0]+s[5]*e[1]+e[2],o=s[0]*e[3]+s[3]*e[4],n=s[1]*e[3]+s[4]*e[4],h=s[2]*e[3]+s[5]*e[4]+e[5];return s[0]=i,s[1]=r,s[2]=a,s[3]=o,s[4]=n,s[5]=h,this}}class p{constructor(t){this._transfos=[],this._sizeTransfos=[],this._transfos.push(t||u.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}back(){return this._transfos[this._transfos.length-1]}push(t,s){const e=s?t.scaleRatio():1;t.multiply(this.back()),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*e)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(t,s){if(t)switch(t.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":this.drawMultiLayerSymbol(t,s)}}drawMultiLayerSymbol(t,s){if(!t)return;const e=t.symbolLayers;if(!e)return;const i=t.effects;if(i){const t=this.executeEffects(i,s);if(t){let s=t.next();for(;s;)this.drawSymbolLayers(e,s),s=t.next()}}else this.drawSymbolLayers(e,s)}executeEffects(t,s){const e=1;let i=new o(s);for(const r of t){const t=n(r);t&&(i=t.execute(i,r,e))}return i}drawSymbolLayers(t,s){let e=t.length;for(;e--;){const i=t[e];if(!i||!1===i.enable)continue;const r=i.effects;if(r){const t=this.executeEffects(r,s);if(t){let s=t.next();for(;s;)this.drawSymbolLayer(i,s),s=t.next()}}else this.drawSymbolLayer(i,s)}}drawSymbolLayer(t,s){switch(t.type){case\"CIMSolidFill\":this.drawSolidFill(s,t.color);break;case\"CIMHatchFill\":this.drawHatchFill(t,s);break;case\"CIMSolidStroke\":this.drawSolidStroke(s,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit);break;case\"CIMCharacterMarker\":case\"CIMPictureMarker\":case\"CIMVectorMarker\":this.drawMarkerLayer(t,s)}}drawHatchFill(t,s){const e=1,i=this._buildHatchPolyline(t,s,e);i&&(this.pushClipPath(s),this.drawMultiLayerSymbol(t.lineSymbol,i),this.popClipPath())}drawMarkerLayer(t,s){const e=t.markerPlacement;if(e){const i=h(e);if(i){const r=\"CIMMarkerPlacementInsidePolygon\"===e.type;r&&this.pushClipPath(s);const a=1,o=i.execute(s,e,a);if(o){let s=o.next();for(;s;)this.drawMarker(t,s),s=o.next()}r&&this.popClipPath()}}else{const e=new l;e.tx=s.x,e.ty=s.y,this.drawMarker(t,e)}}drawMarker(t,s){switch(t.type){case\"CIMCharacterMarker\":case\"CIMPictureMarker\":this.drawPictureMarker(t,s);break;case\"CIMVectorMarker\":this.drawVectorMarker(t,s)}}drawPictureMarker(t,s){if(!t)return;const e=t.size||10,i=u.createIdentity(),r=t.anchorPoint;if(r){let s=r.x,a=r.y;\"Absolute\"!==t.anchorPointUnits&&(s*=e,a*=e),i.translate(-s,-a)}t.rotation&&i.rotate(t.rotation*f),i.translate(t.offsetX||0,t.offsetY||0),i.translate(s.tx,s.ty),this.push(i,!1),this.drawImage(t.url,e,t.scaleX),this.pop()}drawVectorMarker(t,s){if(!t)return;const e=t.markerGraphics;if(!e)return;const i=t.size,r=t.frame,a=r?r.ymax-r.ymin:0,o=i&&a?i/a:1,n=u.createIdentity();r&&n.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const h=t.anchorPoint;if(h){let s=h.x,e=h.y;\"Absolute\"!==t.anchorPointUnits?r&&(s*=r.xmax-r.xmin,e*=r.ymax-r.ymin):(s/=o,e/=o),n.translate(-s,-e)}1!==o&&n.scale(o,o),t.rotation&&n.rotate(t.rotation*f),n.translate(t.offsetX||0,t.offsetY||0),n.translate(s.tx,s.ty),this.push(n,t.scaleSymbolsProportionally);for(const l of e)l&&l.symbol&&l.geometry||m.error(\"Invalid marker graphic\",l),this.drawSymbol(l.symbol,l.geometry);this.pop()}_buildHatchPolyline(t,i,r){let a=(void 0!==t.separation?t.separation:4)*r,o=void 0!==t.rotation?t.rotation:0;if(0===a)return null;a<0&&(a=-a);let n=0;const h=.5*a;for(;n>h;)n-=a;for(;n<-h;)n+=a;const l=s();e(l,i),l[0]-=h,l[1]-=h,l[2]+=h,l[3]+=h;const c=[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]];for(;o>180;)o-=180;for(;o<0;)o+=180;const m=Math.cos(o*f),u=Math.sin(o*f),p=-a*u,_=a*m;let y,d,x,M;n=(void 0!==t.offsetX?t.offsetX*r:0)*u-(void 0!==t.offsetY?t.offsetY*r:0)*m,y=x=Number.MAX_VALUE,d=M=-Number.MAX_VALUE;for(const s of c){const t=s[0],e=s[1],i=m*t+u*e,r=-u*t+m*e;y=Math.min(y,i),x=Math.min(x,r),d=Math.max(d,i),M=Math.max(M,r)}x=Math.floor(x/a)*a;let b=m*y-u*x-p*n/a,P=u*y+m*x-_*n/a,w=m*d-u*x-p*n/a,g=u*d+m*x-_*n/a;const S=1+Math.round((M-x)/a),C=[];for(let s=0;s<S;s++)b+=p,P+=_,w+=p,g+=_,C.push([[b,P],[w,g]]);return{paths:C}}}class _ extends p{constructor(){super(),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new c(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}drawSolidFill(t){if(t&&!(this._clipCount>0))if(i(t))this._processPath(t.rings,0);else if(r(t))this._processPath(t.paths,0);else if(a(t)){const s=d(t);s&&this._processPath(s.rings,0)}}drawSolidStroke(t,s,e){if(!t||this._clipCount>0)return;const o=.5*this.transformSize(e);if(i(t))this._processPath(t.rings,o);else if(r(t))this._processPath(t.paths,o);else if(a(t)){const s=d(t);s&&this._processPath(s.rings,o)}}pushClipPath(t){this.drawSolidFill(t),++this._clipCount}popClipPath(){--this._clipCount}drawImage(t,s,e){const i=s/2;this._merge(this.transformPt([0,0]),i)}_processPath(t,s){if(t)for(const e of t){const t=e?e.length:0;if(t>1){this._merge(this.transformPt(e[0]),s);for(let i=1;i<t;++i)this._merge(this.transformPt(e[i]),s)}}}_merge(t,s){t[0]-s<this._xmin&&(this._xmin=t[0]-s),t[0]+s>this._xmax&&(this._xmax=t[0]+s),t[1]-s<this._ymin&&(this._ymin=t[1]-s),t[1]+s>this._ymax&&(this._ymax=t[1]+s)}}class y extends p{constructor(t,s){super(s),this._ctx=t}drawSolidFill(t,s){if(!t)return;if(i(t))this._buildPath(t.rings,!0);else if(r(t))this._buildPath(t.paths,!0);else{if(!a(t))return;this._buildPath(d(t).rings,!0)}const e=this._ctx;e.fillStyle=\"string\"==typeof s?s:\"rgba(\"+Math.round(s[0])+\",\"+Math.round(s[1])+\",\"+Math.round(s[2])+\",\"+s[3]/255+\")\",e.fill(\"evenodd\")}drawSolidStroke(t,s,e,o,n,h){if(!t||!s||0===e)return;if(i(t))this._buildPath(t.rings,!0);else if(r(t))this._buildPath(t.paths,!1);else{if(!a(t))return;this._buildPath(d(t).rings,!0)}const l=this._ctx;l.strokeStyle=\"string\"==typeof s?s:\"rgba(\"+Math.round(s[0])+\",\"+Math.round(s[1])+\",\"+Math.round(s[2])+\",\"+s[3]/255+\")\",l.lineWidth=this.transformSize(e)+.5,this._setCapStyle(o),this._setJoinStyle(n),l.miterLimit=h,l.stroke()}pushClipPath(t){if(this._ctx.save(),i(t))this._buildPath(t.rings,!0);else if(r(t))this._buildPath(t.paths,!0);else{if(!a(t))return;this._buildPath(d(t).rings,!0)}this._ctx.clip(\"evenodd\")}popClipPath(){this._ctx.restore()}drawImage(t,s,e){}_buildPath(t,s){const e=this._ctx;if(e.beginPath(),t)for(const i of t){const t=i?i.length:0;if(t>1){let r=this.transformPt(i[0]);e.moveTo(r[0],r[1]);for(let s=1;s<t;++s)r=this.transformPt(i[s]),e.lineTo(r[0],r[1]);s&&e.closePath()}}}_setCapStyle(t){switch(t){case\"Butt\":this._ctx.lineCap=\"butt\";break;case\"Round\":this._ctx.lineCap=\"round\";break;case\"Square\":this._ctx.lineCap=\"square\"}}_setJoinStyle(t){switch(t){case\"Bevel\":this._ctx.lineJoin=\"bevel\";break;case\"Round\":this._ctx.lineJoin=\"round\";break;case\"Miter\":this._ctx.lineJoin=\"miter\"}}}const d=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;export{p as CIMSymbolDrawHelper,f as C_DEG_TO_RAD,y as CanvasDrawHelper,_ as EnvDrawHelper,u as Transformation};\n"]},"metadata":{},"sourceType":"module"}