{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../Logger.js\";\nimport { setDeepValue as e } from \"../../../object.js\";\nimport r from \"../../../Warning.js\";\nimport { getOwnClassMetadata as n } from \"../../metadata.js\";\nimport { isCollection as o } from \"./type.js\";\nconst i = t.getLogger(\"esri.core.accessorSupport.extensions.serializableProperty.reader\");\n\nfunction p(t, r, n) {\n  var o, i;\n  t && (!n && !r.read || null != (o = r.read) && o.reader || !1 === (null == (i = r.read) ? void 0 : i.enabled) || d(t) && e(\"read.reader\", u(t), r));\n}\n\nfunction u(t) {\n  var e;\n  const r = null != (e = t.ndimArray) ? e : 0;\n  if (r > 1) return c(t);\n  if (1 === r) return a(t);\n\n  if (\"type\" in t && l(t.type)) {\n    var n, o;\n    const e = null == (n = t.type.prototype) || null == (o = n.itemType) ? void 0 : o.Type,\n          r = a(\"function\" == typeof e ? {\n      type: e\n    } : {\n      types: e\n    });\n    return (e, n, o) => {\n      const i = r(e, n, o);\n      return i ? new t.type(i) : i;\n    };\n  }\n\n  return s(t);\n}\n\nfunction s(t) {\n  return \"type\" in t ? y(t.type) : j(t.types);\n}\n\nfunction y(t) {\n  return t.prototype.read ? (e, r, n) => {\n    if (null == e) return e;\n    const o = typeof e;\n    if (\"object\" !== o) return void i.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${o}'`);\n    const p = new t();\n    return p.read(e, n), p;\n  } : t.fromJSON;\n}\n\nfunction f(t, e, r, n) {\n  return 0 !== n && Array.isArray(e) ? e.map(e => f(t, e, r, n - 1)) : t(e, void 0, r);\n}\n\nfunction c(t) {\n  var e;\n  const r = s(t),\n        n = f.bind(null, r),\n        o = null != (e = t.ndimArray) ? e : 0;\n  return (t, e, r) => {\n    if (null == t) return t;\n    t = n(t, r, o);\n    let i = o,\n        p = t;\n\n    for (; i > 0 && Array.isArray(p);) i--, p = p[0];\n\n    if (void 0 !== p) for (let n = 0; n < i; n++) t = [t];\n    return t;\n  };\n}\n\nfunction a(t) {\n  const e = s(t);\n  return (t, r, n) => {\n    if (null == t) return t;\n\n    if (Array.isArray(t)) {\n      const r = [];\n\n      for (const o of t) {\n        const t = e(o, void 0, n);\n        void 0 !== t && r.push(t);\n      }\n\n      return r;\n    }\n\n    const o = e(t, void 0, n);\n    return void 0 !== o ? [o] : void 0;\n  };\n}\n\nfunction l(t) {\n  if (!o(t)) return !1;\n  const e = t.prototype.itemType;\n  return !(!e || !e.Type) && (\"function\" == typeof e.Type ? v(e.Type) : m(e.Type));\n}\n\nfunction d(t) {\n  return \"types\" in t ? m(t.types) : v(t.type);\n}\n\nfunction v(t) {\n  return !Array.isArray(t) && !!t && t.prototype && (\"read\" in t.prototype || \"fromJSON\" in t || l(t));\n}\n\nfunction m(t) {\n  for (const e in t.typeMap) {\n    if (!v(t.typeMap[e])) return !1;\n  }\n\n  return !0;\n}\n\nfunction j(t) {\n  var e;\n  let n = null;\n  const o = null != (e = t.errorContext) ? e : \"type\";\n  return (e, p, u) => {\n    if (null == e) return e;\n    const s = typeof e;\n    if (\"object\" !== s) return void i.error(`Expected JSON value of type 'object' to deserialize, but got '${s}'`);\n    n || (n = g(t));\n    const y = t.key;\n    if (\"string\" != typeof y) return;\n    const f = e[y],\n          c = f ? n[f] : t.defaultKeyValue ? t.typeMap[t.defaultKeyValue] : void 0;\n\n    if (!c) {\n      const t = `Type '${f || \"unknown\"}' is not supported`;\n      return u && u.messages && e && u.messages.push(new r(`${o}:unsupported`, t, {\n        definition: e,\n        context: u\n      })), void i.error(t);\n    }\n\n    const a = new c();\n    return a.read(e, u), a;\n  };\n}\n\nfunction g(t) {\n  const e = {};\n\n  for (const i in t.typeMap) {\n    var r, o;\n    const p = t.typeMap[i],\n          u = n(p.prototype);\n    if (\"function\" == typeof t.key) continue;\n    const s = u.properties[t.key];\n    if (!s) continue;\n    null != (r = s.json) && r.type && Array.isArray(s.json.type) && 1 === s.json.type.length && \"string\" == typeof s.json.type[0] && (e[s.json.type[0]] = p);\n    const y = null == (o = s.json) ? void 0 : o.write;\n\n    if (!y || !y.writer) {\n      e[i] = p;\n      continue;\n    }\n\n    const f = y.target,\n          c = \"string\" == typeof f ? f : t.key,\n          a = {};\n    y.writer(i, a, c), a[c] && (e[a[c]] = p);\n  }\n\n  return e;\n}\n\nexport { p as create, u as createTypeReader };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/core/accessorSupport/extensions/serializableProperty/reader.js"],"names":["t","setDeepValue","e","r","getOwnClassMetadata","n","isCollection","o","i","getLogger","p","read","reader","enabled","d","u","ndimArray","c","a","l","type","prototype","itemType","Type","types","s","y","j","error","declaredClass","fromJSON","f","Array","isArray","map","bind","push","v","m","typeMap","errorContext","g","key","defaultKeyValue","messages","definition","context","properties","json","length","write","writer","target","create","createTypeReader"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../Logger.js\";import{setDeepValue as e}from\"../../../object.js\";import r from\"../../../Warning.js\";import{getOwnClassMetadata as n}from\"../../metadata.js\";import{isCollection as o}from\"./type.js\";const i=t.getLogger(\"esri.core.accessorSupport.extensions.serializableProperty.reader\");function p(t,r,n){var o,i;t&&(!n&&!r.read||null!=(o=r.read)&&o.reader||!1===(null==(i=r.read)?void 0:i.enabled)||d(t)&&e(\"read.reader\",u(t),r))}function u(t){var e;const r=null!=(e=t.ndimArray)?e:0;if(r>1)return c(t);if(1===r)return a(t);if(\"type\"in t&&l(t.type)){var n,o;const e=null==(n=t.type.prototype)||null==(o=n.itemType)?void 0:o.Type,r=a(\"function\"==typeof e?{type:e}:{types:e});return(e,n,o)=>{const i=r(e,n,o);return i?new t.type(i):i}}return s(t)}function s(t){return\"type\"in t?y(t.type):j(t.types)}function y(t){return t.prototype.read?(e,r,n)=>{if(null==e)return e;const o=typeof e;if(\"object\"!==o)return void i.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${o}'`);const p=new t;return p.read(e,n),p}:t.fromJSON}function f(t,e,r,n){return 0!==n&&Array.isArray(e)?e.map((e=>f(t,e,r,n-1))):t(e,void 0,r)}function c(t){var e;const r=s(t),n=f.bind(null,r),o=null!=(e=t.ndimArray)?e:0;return(t,e,r)=>{if(null==t)return t;t=n(t,r,o);let i=o,p=t;for(;i>0&&Array.isArray(p);)i--,p=p[0];if(void 0!==p)for(let n=0;n<i;n++)t=[t];return t}}function a(t){const e=s(t);return(t,r,n)=>{if(null==t)return t;if(Array.isArray(t)){const r=[];for(const o of t){const t=e(o,void 0,n);void 0!==t&&r.push(t)}return r}const o=e(t,void 0,n);return void 0!==o?[o]:void 0}}function l(t){if(!o(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(\"function\"==typeof e.Type?v(e.Type):m(e.Type))}function d(t){return\"types\"in t?m(t.types):v(t.type)}function v(t){return!Array.isArray(t)&&(!!t&&t.prototype&&(\"read\"in t.prototype||\"fromJSON\"in t||l(t)))}function m(t){for(const e in t.typeMap){if(!v(t.typeMap[e]))return!1}return!0}function j(t){var e;let n=null;const o=null!=(e=t.errorContext)?e:\"type\";return(e,p,u)=>{if(null==e)return e;const s=typeof e;if(\"object\"!==s)return void i.error(`Expected JSON value of type 'object' to deserialize, but got '${s}'`);n||(n=g(t));const y=t.key;if(\"string\"!=typeof y)return;const f=e[y],c=f?n[f]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const t=`Type '${f||\"unknown\"}' is not supported`;return u&&u.messages&&e&&u.messages.push(new r(`${o}:unsupported`,t,{definition:e,context:u})),void i.error(t)}const a=new c;return a.read(e,u),a}}function g(t){const e={};for(const i in t.typeMap){var r,o;const p=t.typeMap[i],u=n(p.prototype);if(\"function\"==typeof t.key)continue;const s=u.properties[t.key];if(!s)continue;null!=(r=s.json)&&r.type&&Array.isArray(s.json.type)&&1===s.json.type.length&&\"string\"==typeof s.json.type[0]&&(e[s.json.type[0]]=p);const y=null==(o=s.json)?void 0:o.write;if(!y||!y.writer){e[i]=p;continue}const f=y.target,c=\"string\"==typeof f?f:t.key,a={};y.writer(i,a,c),a[c]&&(e[a[c]]=p)}return e}export{p as create,u as createTypeReader};\n"]},"metadata":{},"sourceType":"module"}