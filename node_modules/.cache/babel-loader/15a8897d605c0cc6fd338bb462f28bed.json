{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../../core/maybe.js\";\nimport { f as s } from \"../../../../../chunks/vec3.js\";\nimport { Z as i, c as a } from \"../../../../../chunks/vec3f64.js\";\nimport { glsl as o } from \"../shaderModules/interfaces.js\";\n\nfunction c(e, s) {\n  if (s.slicePlaneEnabled) {\n    e.extensions.add(\"GL_OES_standard_derivatives\"), s.sliceEnabledForVertexPrograms && (e.vertex.uniforms.add(\"slicePlaneOrigin\", \"vec3\"), e.vertex.uniforms.add(\"slicePlaneBasis1\", \"vec3\"), e.vertex.uniforms.add(\"slicePlaneBasis2\", \"vec3\")), e.fragment.uniforms.add(\"slicePlaneOrigin\", \"vec3\"), e.fragment.uniforms.add(\"slicePlaneBasis1\", \"vec3\"), e.fragment.uniforms.add(\"slicePlaneBasis2\", \"vec3\");\n    const i = o`struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,\n          a = o`vec4 applySliceHighlight(vec4 color, vec3 pos) {\nSliceFactors factors = calculateSliceFactors(pos);\nif (sliceByFactors(factors)) {\nreturn color;\n}\nconst float HIGHLIGHT_WIDTH = 1.0;\nconst vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\nfactors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\nfactors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\nfactors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\nfactors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\nfactors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\nfloat highlightFactor = (1.0 - step(0.5, factors.front))\n* (1.0 - step(0.5, factors.side0))\n* (1.0 - step(0.5, factors.side1))\n* (1.0 - step(0.5, factors.side2))\n* (1.0 - step(0.5, factors.side3));\nreturn mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}`,\n          c = s.sliceHighlightDisabled ? o`#define highlightSlice(_color_, _pos_) (_color_)` : o`\n        ${a}\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      `;\n    s.sliceEnabledForVertexPrograms && e.vertex.code.add(i), e.fragment.code.add(i), e.fragment.code.add(c);\n  } else {\n    const i = o`#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)`;\n    s.sliceEnabledForVertexPrograms && e.vertex.code.add(i), e.fragment.code.add(i);\n  }\n}\n\nfunction l(e, s, i) {\n  r(e, s, i.slicePlane, i.origin);\n}\n\nfunction r(a, o, c, l) {\n  o.slicePlaneEnabled && (e(c) ? (l ? (s(t, c.origin, l), a.setUniform3fv(\"slicePlaneOrigin\", t)) : a.setUniform3fv(\"slicePlaneOrigin\", c.origin), a.setUniform3fv(\"slicePlaneBasis1\", c.basis1), a.setUniform3fv(\"slicePlaneBasis2\", c.basis2)) : (a.setUniform3fv(\"slicePlaneBasis1\", i), a.setUniform3fv(\"slicePlaneBasis2\", i), a.setUniform3fv(\"slicePlaneOrigin\", i)));\n}\n\nconst t = a();\nexport { c as Slice, r as bindSliceUniforms, l as bindSliceUniformsWithOrigin };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"],"names":["isSome","e","f","s","Z","i","c","a","glsl","o","slicePlaneEnabled","extensions","add","sliceEnabledForVertexPrograms","vertex","uniforms","fragment","sliceHighlightDisabled","code","l","r","slicePlane","origin","t","setUniform3fv","basis1","basis2","Slice","bindSliceUniforms","bindSliceUniformsWithOrigin"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,8BAAvB;AAAsD,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOC,CAAC,IAAIC,CAAZ,EAAcC,CAAC,IAAIC,CAAnB,QAAyB,kCAAzB;AAA4D,SAAOC,IAAI,IAAIC,CAAf,QAAqB,gCAArB;;AAAsD,SAASH,CAAT,CAAWL,CAAX,EAAaE,CAAb,EAAe;AAAC,MAAGA,CAAC,CAACO,iBAAL,EAAuB;AAACT,IAAAA,CAAC,CAACU,UAAF,CAAaC,GAAb,CAAiB,6BAAjB,GAAgDT,CAAC,CAACU,6BAAF,KAAkCZ,CAAC,CAACa,MAAF,CAASC,QAAT,CAAkBH,GAAlB,CAAsB,kBAAtB,EAAyC,MAAzC,GAAiDX,CAAC,CAACa,MAAF,CAASC,QAAT,CAAkBH,GAAlB,CAAsB,kBAAtB,EAAyC,MAAzC,CAAjD,EAAkGX,CAAC,CAACa,MAAF,CAASC,QAAT,CAAkBH,GAAlB,CAAsB,kBAAtB,EAAyC,MAAzC,CAApI,CAAhD,EAAsOX,CAAC,CAACe,QAAF,CAAWD,QAAX,CAAoBH,GAApB,CAAwB,kBAAxB,EAA2C,MAA3C,CAAtO,EAAyRX,CAAC,CAACe,QAAF,CAAWD,QAAX,CAAoBH,GAApB,CAAwB,kBAAxB,EAA2C,MAA3C,CAAzR,EAA4UX,CAAC,CAACe,QAAF,CAAWD,QAAX,CAAoBH,GAApB,CAAwB,kBAAxB,EAA2C,MAA3C,CAA5U;AAA+X,UAAMP,CAAC,GAACI,CAAE;AAC3oB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oEArCioB;AAAA,UAqC5jBF,CAAC,GAACE,CAAE;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAvDioB;AAAA,UAuD9nBH,CAAC,GAACH,CAAC,CAACc,sBAAF,GAAyBR,CAAE,kDAA3B,GAA6EA,CAAE;AACpF,UAAUF,CAAE;AACZ;AACA,OA1DioB;AA0DznBJ,IAAAA,CAAC,CAACU,6BAAF,IAAiCZ,CAAC,CAACa,MAAF,CAASI,IAAT,CAAcN,GAAd,CAAkBP,CAAlB,CAAjC,EAAsDJ,CAAC,CAACe,QAAF,CAAWE,IAAX,CAAgBN,GAAhB,CAAoBP,CAApB,CAAtD,EAA6EJ,CAAC,CAACe,QAAF,CAAWE,IAAX,CAAgBN,GAAhB,CAAoBN,CAApB,CAA7E;AAAoG,GA1D8H,MA0D1H;AAAC,UAAMD,CAAC,GAACI,CAAE;AAC3H;AACA,iDAFiH;AAE/DN,IAAAA,CAAC,CAACU,6BAAF,IAAiCZ,CAAC,CAACa,MAAF,CAASI,IAAT,CAAcN,GAAd,CAAkBP,CAAlB,CAAjC,EAAsDJ,CAAC,CAACe,QAAF,CAAWE,IAAX,CAAgBN,GAAhB,CAAoBP,CAApB,CAAtD;AAA6E;AAAC;;AAAA,SAASc,CAAT,CAAWlB,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAACe,EAAAA,CAAC,CAACnB,CAAD,EAAGE,CAAH,EAAKE,CAAC,CAACgB,UAAP,EAAkBhB,CAAC,CAACiB,MAApB,CAAD;AAA6B;;AAAA,SAASF,CAAT,CAAWb,CAAX,EAAaE,CAAb,EAAeH,CAAf,EAAiBa,CAAjB,EAAmB;AAACV,EAAAA,CAAC,CAACC,iBAAF,KAAsBT,CAAC,CAACK,CAAD,CAAD,IAAMa,CAAC,IAAEhB,CAAC,CAACoB,CAAD,EAAGjB,CAAC,CAACgB,MAAL,EAAYH,CAAZ,CAAD,EAAgBZ,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmCD,CAAnC,CAAlB,IAAyDhB,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmClB,CAAC,CAACgB,MAArC,CAA1D,EAAuGf,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmClB,CAAC,CAACmB,MAArC,CAAvG,EAAoJlB,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmClB,CAAC,CAACoB,MAArC,CAA1J,KAAyMnB,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmCnB,CAAnC,GAAsCE,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmCnB,CAAnC,CAAtC,EAA4EE,CAAC,CAACiB,aAAF,CAAgB,kBAAhB,EAAmCnB,CAAnC,CAArR,CAAtB;AAAmV;;AAAA,MAAMkB,CAAC,GAAChB,CAAC,EAAT;AAAY,SAAOD,CAAC,IAAIqB,KAAZ,EAAkBP,CAAC,IAAIQ,iBAAvB,EAAyCT,CAAC,IAAIU,2BAA9C","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../../core/maybe.js\";import{f as s}from\"../../../../../chunks/vec3.js\";import{Z as i,c as a}from\"../../../../../chunks/vec3f64.js\";import{glsl as o}from\"../shaderModules/interfaces.js\";function c(e,s){if(s.slicePlaneEnabled){e.extensions.add(\"GL_OES_standard_derivatives\"),s.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add(\"slicePlaneOrigin\",\"vec3\"),e.vertex.uniforms.add(\"slicePlaneBasis1\",\"vec3\"),e.vertex.uniforms.add(\"slicePlaneBasis2\",\"vec3\")),e.fragment.uniforms.add(\"slicePlaneOrigin\",\"vec3\"),e.fragment.uniforms.add(\"slicePlaneBasis1\",\"vec3\"),e.fragment.uniforms.add(\"slicePlaneBasis2\",\"vec3\");const i=o`struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,a=o`vec4 applySliceHighlight(vec4 color, vec3 pos) {\nSliceFactors factors = calculateSliceFactors(pos);\nif (sliceByFactors(factors)) {\nreturn color;\n}\nconst float HIGHLIGHT_WIDTH = 1.0;\nconst vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\nfactors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\nfactors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\nfactors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\nfactors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\nfactors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\nfloat highlightFactor = (1.0 - step(0.5, factors.front))\n* (1.0 - step(0.5, factors.side0))\n* (1.0 - step(0.5, factors.side1))\n* (1.0 - step(0.5, factors.side2))\n* (1.0 - step(0.5, factors.side3));\nreturn mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}`,c=s.sliceHighlightDisabled?o`#define highlightSlice(_color_, _pos_) (_color_)`:o`\n        ${a}\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      `;s.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(c)}else{const i=o`#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)`;s.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i)}}function l(e,s,i){r(e,s,i.slicePlane,i.origin)}function r(a,o,c,l){o.slicePlaneEnabled&&(e(c)?(l?(s(t,c.origin,l),a.setUniform3fv(\"slicePlaneOrigin\",t)):a.setUniform3fv(\"slicePlaneOrigin\",c.origin),a.setUniform3fv(\"slicePlaneBasis1\",c.basis1),a.setUniform3fv(\"slicePlaneBasis2\",c.basis2)):(a.setUniform3fv(\"slicePlaneBasis1\",i),a.setUniform3fv(\"slicePlaneBasis2\",i),a.setUniform3fv(\"slicePlaneOrigin\",i)))}const t=a();export{c as Slice,r as bindSliceUniforms,l as bindSliceUniformsWithOrigin};\n"]},"metadata":{},"sourceType":"module"}