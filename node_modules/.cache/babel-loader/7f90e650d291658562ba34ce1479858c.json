{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Handles.js\";\nimport { timeoutHandle as t } from \"../../../../core/handleUtils.js\";\nimport { isSome as r } from \"../../../../core/maybe.js\";\nimport { isAborted as o, createAbortError as s, onAbort as i, createAbortController as a } from \"../../../../core/promiseUtils.js\";\nimport { DefaultLoadingContext as n } from \"../../glTF/DefaultLoadingContext.js\";\nimport { load as l } from \"../../glTF/loader.js\";\nimport { load as c } from \"./wosrLoader.js\";\n\nclass m {\n  constructor() {\n    this.gltfCache = new Map(), this.wosrCache = new Map(), this.evictHandles = new e();\n  }\n\n  loadGLTF(e, t, r) {\n    const o = r ? `gltfPBR:${e}` : `gltf:${e}`;\n    return this.fromCache(this.gltfCache, o, t => l(new n(t.streamDataRequester), e, t, r), t);\n  }\n\n  loadWOSR(e, t) {\n    const r = `wosr:${e}:${t.disableTextures}`;\n    return this.fromCache(this.wosrCache, r, t => c(e, t), t);\n  }\n\n  destroy() {\n    this.evictHandles.destroy(), this.gltfCache.clear(), this.wosrCache.clear();\n  }\n\n  get size() {\n    return this.wosrCache.size + this.gltfCache.size;\n  }\n\n  fromCache(e, t, n, l) {\n    return new Promise((c, m) => {\n      if (o(l)) return void m(s());\n      const h = i(l, () => {\n        this.remove(e, t), m(s());\n      }),\n            f = e.get(t);\n      if (f) return this.evictHandles.remove(t), f.refCount++, void f.item.then(c, m);\n      const d = a(),\n            C = { ...l,\n        signal: d.signal\n      },\n            v = {\n        refCount: 1,\n        abortController: d,\n        item: n(C).then(r => (v.abortController = null, r.remove = () => this.remove(e, t), r))\n      };\n      e.set(t, v), v.item.then(e => {\n        r(h) && h.remove(), c(e);\n      }, e => {\n        r(h) && h.remove(), m(e);\n      });\n    });\n  }\n\n  remove(e, o) {\n    const s = e.get(o);\n    s && (s.refCount--, 0 === s.refCount && this.evictHandles.add(t(() => {\n      e.delete(o), r(s.abortController) && s.abortController.abort();\n    }, f), o));\n  }\n\n}\n\nconst h = 1e4;\nlet f = h;\nconst d = {\n  overrideEvictDelay: e => (f = e, {\n    remove() {\n      f = h;\n    }\n\n  })\n};\nexport { m as ObjectResourceCache, d as test };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/ObjectResourceCache.js"],"names":["e","timeoutHandle","t","isSome","r","isAborted","o","createAbortError","s","onAbort","i","createAbortController","a","DefaultLoadingContext","n","load","l","c","m","constructor","gltfCache","Map","wosrCache","evictHandles","loadGLTF","fromCache","streamDataRequester","loadWOSR","disableTextures","destroy","clear","size","Promise","h","remove","f","get","refCount","item","then","d","C","signal","v","abortController","set","add","delete","abort","overrideEvictDelay","ObjectResourceCache","test"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Handles.js\";import{timeoutHandle as t}from\"../../../../core/handleUtils.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{isAborted as o,createAbortError as s,onAbort as i,createAbortController as a}from\"../../../../core/promiseUtils.js\";import{DefaultLoadingContext as n}from\"../../glTF/DefaultLoadingContext.js\";import{load as l}from\"../../glTF/loader.js\";import{load as c}from\"./wosrLoader.js\";class m{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new e}loadGLTF(e,t,r){const o=r?`gltfPBR:${e}`:`gltf:${e}`;return this.fromCache(this.gltfCache,o,(t=>l(new n(t.streamDataRequester),e,t,r)),t)}loadWOSR(e,t){const r=`wosr:${e}:${t.disableTextures}`;return this.fromCache(this.wosrCache,r,(t=>c(e,t)),t)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}fromCache(e,t,n,l){return new Promise(((c,m)=>{if(o(l))return void m(s());const h=i(l,(()=>{this.remove(e,t),m(s())})),f=e.get(t);if(f)return this.evictHandles.remove(t),f.refCount++,void f.item.then(c,m);const d=a(),C={...l,signal:d.signal},v={refCount:1,abortController:d,item:n(C).then((r=>(v.abortController=null,r.remove=()=>this.remove(e,t),r)))};e.set(t,v),v.item.then((e=>{r(h)&&h.remove(),c(e)}),(e=>{r(h)&&h.remove(),m(e)}))}))}remove(e,o){const s=e.get(o);s&&(s.refCount--,0===s.refCount&&this.evictHandles.add(t((()=>{e.delete(o),r(s.abortController)&&s.abortController.abort()}),f),o))}}const h=1e4;let f=h;const d={overrideEvictDelay:e=>(f=e,{remove(){f=h}})};export{m as ObjectResourceCache,d as test};\n"]},"metadata":{},"sourceType":"module"}