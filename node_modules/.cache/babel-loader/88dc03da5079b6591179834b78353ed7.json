{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../request.js\";\nimport { binaryIndexOf as t, flatten as r, splitIntoChunks as o } from \"../../../../core/arrayUtils.js\";\nimport n from \"../../../../core/Error.js\";\nimport a from \"../../../../core/has.js\";\nimport { isSome as s, isNone as i } from \"../../../../core/maybe.js\";\nimport { eachAlways as c } from \"../../../../core/promiseUtils.js\";\nimport { isInt16Array as l, isInt32Array as u } from \"../../../../core/typedArrayUtil.js\";\nimport { a as f } from \"../../../../chunks/mat4.js\";\nimport { c as p } from \"../../../../chunks/mat4f64.js\";\nimport { a as m, m as h, c as d } from \"../../../../chunks/quat.js\";\nimport { b as y } from \"../../../../chunks/quatf32.js\";\nimport { s as g, g as b, w, q as x, a as S, b as M, m as v } from \"../../../../chunks/vec3.js\";\nimport { c as j } from \"../../../../chunks/vec4f64.js\";\nimport { projectBoundingSphere as R, projectBuffer as q, computeLinearTransformation as T, projectVectorToVector as k } from \"../../../../geometry/projection.js\";\nimport { getSphericalPCPF as z, getReferenceEllipsoid as F } from \"../../../../geometry/projectionEllipsoid.js\";\nimport A from \"../../../../geometry/SpatialReference.js\";\nimport { create as I } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { create as C, empty as U, expandPointInPlace as B, intersects as K } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { canProject as L } from \"../../../../geometry/support/webMercatorUtils.js\";\nimport W from \"../../../../rest/support/Query.js\";\nimport { readBinaryAttribute as G } from \"./I3SBinaryReader.js\";\nimport { computeGlobalTransformation as E } from \"./I3SProjectionUtil.js\";\nimport { createSolidEdgeMaterial as O, createMaterialFromEdges as P } from \"../support/edgeUtils.js\";\nimport { parseColorMixMode as $ } from \"../support/symbolColorUtils.js\";\nimport { corners as Q, compute as Z, create as D } from \"../../support/orientedBoundingBox.js\";\n\nfunction H(e) {\n  return e && parseInt(e.substring(e.lastIndexOf(\"/\") + 1, e.length), 10);\n}\n\nfunction J(e) {\n  if (a(\"disable-feature:i3s-draco\") || !e) return !1;\n\n  for (const t of e) for (const e of t.geometryBuffers) if (\"draco\" === e.compressedAttributes.encoding) return !0;\n\n  return !1;\n}\n\nfunction N(e, t, r, o, n, a) {\n  n.traverse(r, r => {\n    let n = r.mbs;\n    t !== o && (n = ee, R(r.mbs, o, n, t));\n    const s = te(e, n);\n    return 0 !== s && (a(r, s), !0);\n  });\n}\n\nfunction V(e, t, r) {\n  let o = 0,\n      n = 0;\n\n  for (let a = 0; a < t.length && o < e.length; a++) e[o] === t[a] && (r(a) && (e[n] = e[o], n++), o++);\n\n  e.length = n;\n}\n\nfunction X(e, r, o) {\n  let n = 0,\n      a = 0;\n\n  for (; n < o.length;) {\n    t(e, o[n]) >= 0 === r && (o[a] = o[n], a++), n++;\n  }\n\n  o.length = a;\n}\n\nconst Y = I();\n\nfunction _(e, t) {\n  if (0 === t.rotationScale[1] && 0 === t.rotationScale[2] && 0 === t.rotationScale[3] && 0 === t.rotationScale[5] && 0 === t.rotationScale[6] && 0 === t.rotationScale[7]) return Y[0] = (e[0] - t.position[0]) / t.rotationScale[0], Y[1] = (e[1] - t.position[1]) / t.rotationScale[4], Y[2] = (e[2] - t.position[2]) / t.rotationScale[8], Y[3] = (e[3] - t.position[0]) / t.rotationScale[0], Y[4] = (e[4] - t.position[1]) / t.rotationScale[4], Y[5] = (e[5] - t.position[2]) / t.rotationScale[8], Y;\n}\n\nconst ee = j();\n\nfunction te(e, t) {\n  const r = t[0],\n        o = t[1],\n        n = t[3],\n        a = e[0] - r,\n        s = r - e[2],\n        i = e[1] - o,\n        c = o - e[3],\n        l = Math.max(a, s, 0),\n        u = Math.max(i, c, 0),\n        f = l * l + u * u;\n  if (f > n * n) return 0;\n  if (f > 0) return 1;\n  return -Math.max(a, s, i, c) > n ? 3 : 2;\n}\n\nfunction re(e, t) {\n  const r = t[0],\n        o = t[1],\n        n = t[2],\n        a = t[3],\n        s = e[0] - r,\n        i = r - e[3],\n        c = e[1] - o,\n        l = o - e[4],\n        u = e[2] - n,\n        f = n - e[5],\n        p = Math.max(s, i, 0),\n        m = Math.max(c, l, 0),\n        h = Math.max(u, f, 0),\n        d = p * p + m * m + h * h;\n  if (d > a * a) return 0;\n  if (d > 0) return 1;\n  return -Math.max(s, i, c, l, u, f) > a ? 3 : 2;\n}\n\nfunction oe(e, t, r) {\n  const o = [],\n        n = r && r.missingFields,\n        a = r && r.originalFields;\n\n  for (const s of e) {\n    const e = s.toLowerCase();\n    let r = !1;\n\n    for (const n of t) if (e === n.name.toLowerCase()) {\n      o.push(n.name), r = !0, a && a.push(s);\n      break;\n    }\n\n    !r && n && n.push(s);\n  }\n\n  return o;\n}\n\nasync function ne(e, t, o, a, c) {\n  if (0 === t.length) return [];\n  const l = e.attributeStorageInfo;\n  if (s(e.associatedLayer)) try {\n    return await se(e.associatedLayer, t, o, a);\n  } catch (u) {\n    if (e.associatedLayer.loaded) throw u;\n  }\n\n  if (l) {\n    const s = ae(t, o, c);\n    if (i(s)) throw new n(\"scenelayer:features-not-loaded\", \"Tried to query attributes for unloaded features\");\n    const u = e.parsedUrl.path,\n          f = await Promise.all(s.map(e => ce(u, l, e.node, e.indices, a).then(t => {\n      for (let r = 0; r < e.graphics.length; r++) {\n        const o = e.graphics[r],\n              n = t[r];\n        if (o.attributes) for (const e in o.attributes) e in n || (n[e] = o.attributes[e]);\n        o.attributes = n;\n      }\n\n      return e.graphics;\n    })));\n    return r(f);\n  }\n\n  throw new n(\"scenelayer:no-attribute-source\", \"This scene layer does not have a source for attributes available\");\n}\n\nfunction ae(e, t, r) {\n  const o = new Map(),\n        n = [],\n        a = r();\n\n  for (const s of e) {\n    const e = s.attributes[t];\n\n    for (let t = 0; t < a.length; t++) {\n      const r = a[t],\n            i = r.featureIds.indexOf(e);\n\n      if (i >= 0) {\n        let e = o.get(r.node);\n        e || (e = {\n          node: r.node,\n          indices: [],\n          graphics: []\n        }, n.push(e), o.set(r.node, e)), e.indices.push(i), e.graphics.push(s);\n\n        for (let r = t; r > 0; r--) a[r] = a[r - 1];\n\n        a[0] = r;\n        break;\n      }\n    }\n  }\n\n  return n;\n}\n\nasync function se(e, t, r, o) {\n  t.sort((e, t) => e.attributes[r] - t.attributes[r]);\n  const n = t.map(e => e.attributes[r]),\n        a = [],\n        s = oe(o, e.fields, {\n    originalFields: a\n  }),\n        i = await ie(e, n, s);\n\n  for (let c = 0; c < t.length; c++) {\n    const e = t[c],\n          r = i[c],\n          o = {};\n    if (e.attributes) for (const t in e.attributes) o[t] = e.attributes[t];\n\n    for (let t = 0; t < a.length; t++) o[a[t]] = r[s[t]];\n\n    e.attributes = o;\n  }\n\n  return t;\n}\n\nfunction ie(e, t, a) {\n  const s = e.capabilities.query.maxRecordCount;\n\n  if (null != s && t.length > s) {\n    const n = o(t, s);\n    return Promise.all(n.map(t => ie(e, t, a))).then(r);\n  }\n\n  const i = new W({\n    objectIds: t,\n    outFields: a,\n    orderByFields: [e.objectIdField]\n  });\n  return e.queryFeatures(i).then(e => {\n    if (e && e.features && e.features.length === t.length) return e.features.map(e => e.attributes);\n    throw new n(\"scenelayer:feature-not-in-associated-layer\", \"Feature not found in associated feature layer\");\n  });\n}\n\nfunction ce(t, r, o, n, a) {\n  const s = [];\n\n  for (const e of r) if (e && -1 !== a.indexOf(e.name)) {\n    const r = `${t}/nodes/${o.resources.attributes}/attributes/${e.key}/0`;\n    s.push({\n      url: r,\n      storageInfo: e\n    });\n  }\n\n  return c(s.map(t => e(t.url, {\n    responseType: \"array-buffer\"\n  }).then(e => G(t.storageInfo, e.data)))).then(e => {\n    const t = [];\n\n    for (const r of n) {\n      const o = {};\n\n      for (let t = 0; t < e.length; t++) null != e[t].value && (o[s[t].storageInfo.name] = fe(e[t].value, r));\n\n      t.push(o);\n    }\n\n    return t;\n  });\n}\n\nconst le = -32768,\n      ue = -(2 ** 31);\n\nfunction fe(e, t) {\n  if (!e) return null;\n  const r = e[t];\n  if (l(e)) return r === le ? null : r;\n  if (u(e)) return r === ue ? null : r;\n  return r != r ? null : r;\n}\n\nfunction pe(e) {\n  const t = e.store.indexCRS || e.store.geographicCRS,\n        r = void 0 === t ? e.store.indexWKT : void 0;\n\n  if (r) {\n    if (!e.spatialReference) throw new n(\"layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference\", \"Found indeWKT in the scene layer store but no layer spatial reference\", {});\n    if (r !== e.spatialReference.wkt) throw new n(\"layerview:store-spatial-reference-wkt-index-incompatible\", \"The indeWKT of the scene layer store does not match the WKT of the layer spatial reference\", {});\n  }\n\n  const o = t ? new A(H(t)) : e.spatialReference;\n  return o.equals(e.spatialReference) ? e.spatialReference : o;\n}\n\nfunction me(e) {\n  const t = e.store.vertexCRS || e.store.projectedCRS,\n        r = void 0 === t ? e.store.vertexWKT : void 0;\n\n  if (r) {\n    if (!e.spatialReference) throw new n(\"layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference\", \"Found vertexWKT in the scene layer store but no layer spatial reference\", {});\n    if (r !== e.spatialReference.wkt) throw new n(\"layerview:store-spatial-reference-wkt-vertex-incompatible\", \"The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference\", {});\n  }\n\n  const o = t ? new A(H(t)) : e.spatialReference;\n  return o.equals(e.spatialReference) ? e.spatialReference : o;\n}\n\nfunction he(e, t) {\n  return i(t) ? \"@null\" : t === z(t) ? \"@ECEF\" : e.equals(t) ? \"\" : null != t.wkid ? \"@\" + t.wkid : null;\n}\n\nfunction de(e, t, r) {\n  if (!L(e, t)) throw new n(\"layerview:spatial-reference-incompatible\", \"The spatial reference of this scene layer is incompatible with the spatial reference of the view\", {});\n  if (\"local\" === r && e.isGeographic) throw new n(\"layerview:local-gcs-not-supported\", \"Geographic coordinate systems are not supported in local scenes\", {});\n}\n\nfunction ye(e, t, r) {\n  const o = pe(e),\n        n = me(e);\n  de(o, t, r), de(n, t, r);\n}\n\nfunction ge(e) {\n  return (null == e.geometryType || \"triangles\" === e.geometryType) && (null == e.topology || \"PerAttributeArray\" === e.topology) && null != e.vertexAttributes && null != e.vertexAttributes.position;\n}\n\nfunction be(e) {\n  if (null == e.store || null == e.store.defaultGeometrySchema || !ge(e.store.defaultGeometrySchema)) throw new n(\"scenelayer:unsupported-geometry-schema\", \"The geometry schema of this scene layer is not supported.\", {\n    url: e.parsedUrl.path\n  });\n}\n\nfunction we(e, t) {\n  ye(e, t.spatialReference, t.viewingMode);\n}\n\nfunction xe(e) {\n  return null != e.geometryType && \"points\" === e.geometryType && (null == e.topology || \"PerAttributeArray\" === e.topology) && (null == e.encoding || \"\" === e.encoding || \"lepcc-xyz\" === e.encoding) && null != e.vertexAttributes && null != e.vertexAttributes.position;\n}\n\nfunction Se(e) {\n  if (null == e.store || null == e.store.defaultGeometrySchema || !xe(e.store.defaultGeometrySchema)) throw new n(\"pointcloud:unsupported-geometry-schema\", \"The geometry schema of this point cloud scene layer is not supported.\", {});\n}\n\nfunction Me(e, t) {\n  de(e.spatialReference, t.spatialReference, t.viewingMode);\n}\n\nfunction ve(e) {\n  return \"simple\" === e.type || \"class-breaks\" === e.type || \"unique-value\" === e.type;\n}\n\nfunction je(e) {\n  return \"mesh-3d\" === e.type;\n}\n\nfunction Re(e) {\n  if (null == e || !ve(e)) return !0;\n  if ((\"unique-value\" === e.type || \"class-breaks\" === e.type) && null == e.defaultSymbol) return !0;\n  const t = e.getSymbols();\n  if (0 === t.length) return !0;\n\n  for (const r of t) {\n    if (!je(r) || 0 === r.symbolLayers.length) return !0;\n\n    for (const e of r.symbolLayers.items) if (\"fill\" !== e.type || i(e.material) || i(e.material.color) || \"replace\" !== e.material.colorMixMode) return !0;\n  }\n\n  return !1;\n}\n\nconst qe = O({\n  color: [0, 0, 0, 0],\n  opacity: 0\n});\n\nclass Te {\n  constructor() {\n    this.edgeMaterial = null, this.material = null, this.castShadows = !0;\n  }\n\n}\n\nfunction ke(e) {\n  const t = new Te();\n  let r = !1,\n      o = !1;\n\n  for (const n of e.symbolLayers.items) if (\"fill\" === n.type && n.enabled) {\n    const e = n.material,\n          a = n.edges;\n\n    if (s(e) && !r) {\n      const o = e.color,\n            a = $(e.colorMixMode);\n      s(o) ? t.material = {\n        color: [o.r / 255, o.g / 255, o.b / 255],\n        alpha: o.a,\n        colorMixMode: a\n      } : t.material = {\n        color: [1, 1, 1],\n        alpha: 1,\n        colorMixMode: 1\n      }, t.castShadows = n.castShadows, r = !0;\n    }\n\n    s(a) && !o && (t.edgeMaterial = P(a, {}), o = !0);\n  }\n\n  return t.material || (t.material = {\n    color: [1, 1, 1],\n    alpha: 1,\n    colorMixMode: 1\n  }), t;\n}\n\nfunction ze(e, t) {\n  return (0 | e) + (0 | t) | 0;\n}\n\nfunction Fe(e, t, r, o, n = 0) {\n  o === z(o) ? t.isGeographic ? Ie(e, r, t, n) : Ae(e, r, t, n) : e === r ? (r.center[2] += n, q(r.center, t, 0, r.center, o, 0, 1)) : (g(r.center, e.center[0], e.center[1], e.center[2] + n), q(r.center, t, 0, r.center, o, 0, 1), m(r.quaternion, e.quaternion), b(r.halfSize, e.halfSize));\n}\n\nfunction Ae(e, t, r, o) {\n  Q(e, Ke), g(t.center, e.center[0], e.center[1], e.center[2] + o), T(r, t.center, Ue, z(r)), g(t.center, Ue[12], Ue[13], Ue[14]);\n  const n = 2 * Math.sqrt(1 + Ue[0] + Ue[5] + Ue[10]);\n  Be[0] = (Ue[6] - Ue[9]) / n, Be[1] = (Ue[8] - Ue[2]) / n, Be[2] = (Ue[1] - Ue[4]) / n, Be[3] = .25 * n, h(t.quaternion, Be, e.quaternion), d(Be, t.quaternion);\n  let a = 0,\n      s = 0,\n      i = 0;\n\n  for (const c of Ke) c[2] += o, q(c, r, 0, c, z(r), 0, 1), w(Ee, c, t.center), x(Ee, Ee, Be), a = Math.max(a, Math.abs(Ee[0])), s = Math.max(s, Math.abs(Ee[1])), i = Math.max(i, Math.abs(Ee[2]));\n\n  g(t.halfSize, a, s, i);\n}\n\nfunction Ie(e, t, r, o) {\n  const n = F(r),\n        a = 1 + Math.max(0, o) / (n.radius + e.center[2]);\n  g(t.center, e.center[0], e.center[1], e.center[2] + o), q(t.center, r, 0, t.center, z(r), 0, 1), m(t.quaternion, e.quaternion), d(Be, e.quaternion), g(Ee, 0, 0, 1), x(Ee, Ee, Be), g(Ee, e.halfSize[0] * Math.abs(Ee[0]), e.halfSize[1] * Math.abs(Ee[1]), e.halfSize[2] * Math.abs(Ee[2])), S(Ee, Ee, n.inverseFlattening), M(t.halfSize, e.halfSize, Ee), S(t.halfSize, t.halfSize, a);\n}\n\nfunction Ce(e, t, r, o, n, a) {\n  if (!a || 0 === a.length || i(t)) return null;\n  const c = E(e.mbs, n, r, t);\n  let l;\n  f(Pe, c);\n\n  const u = () => {\n    if (!l) if (l = Ke, U(We), s(e.serviceObb)) {\n      Fe(e.serviceObb, r, Ge, t, n), Q(Ge, l);\n\n      for (const e of l) v(e, e, Pe), B(We, e);\n    } else {\n      const o = e.mbs,\n            a = o[3];\n      k(o, r, Ee, t), v(Ee, Ee, Pe), Ee[2] += n;\n\n      for (let e = 0; e < 8; ++e) {\n        const t = 1 & e ? a : -a,\n              r = 2 & e ? a : -a,\n              o = 4 & e ? a : -a,\n              n = l[e];\n        b(n, [Ee[0] + t, Ee[1] + r, Ee[2] + o]), B(We, n);\n      }\n    }\n  };\n\n  let p = 1 / 0,\n      m = -1 / 0;\n\n  const h = e => {\n    if (\"replace\" !== e.type) return;\n    const r = e.geometry;\n    if (!r.hasZ) return;\n    U(Le);\n    const n = r.spatialReference || o,\n          a = r.rings.reduce((e, r) => r.reduce((e, r) => (k(r, n, Ee, t), v(Ee, Ee, Pe), B(Le, Ee), Math.min(Ee[2], e)), e), 1 / 0);\n    u(), K(We, Le) && (p = Math.min(p, a), m = Math.max(m, a));\n  };\n\n  if (a.forEach(e => h(e)), p === 1 / 0) return null;\n\n  const d = (e, t, r) => {\n    v(Ee, r, c), e[t + 0] = Ee[0], e[t + 1] = Ee[1], e[t + 2] = Ee[2], t += 24, r[2] = p, v(Ee, r, c), e[t + 0] = Ee[0], e[t + 1] = Ee[1], e[t + 2] = Ee[2], t += 24, r[2] = m, v(Ee, r, c), e[t + 0] = Ee[0], e[t + 1] = Ee[1], e[t + 2] = Ee[2];\n  };\n\n  for (let s = 0; s < 8; ++s) d(Oe.data, 3 * s, l[s]);\n\n  return Z(Oe);\n}\n\nconst Ue = p(),\n      Be = y(),\n      Ke = [[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]],\n      Le = C(),\n      We = C(),\n      Ge = D(),\n      Ee = [0, 0, 0],\n      Oe = {\n  data: new Array(72),\n  size: 3\n},\n      Pe = p();\nexport { Te as SymbolInfo, ze as addWraparound, Me as checkPointCloudLayerCompatibleWithView, Se as checkPointCloudLayerValid, we as checkSceneLayerCompatibleWithView, be as checkSceneLayerValid, de as checkSpatialReference, ye as checkSpatialReferences, Ce as computeVisibilityObb, J as containsDraco, H as extractWkid, V as filterInPlace, oe as findFieldsCaseInsensitive, N as findIntersectingNodes, he as getCacheKeySuffix, fe as getCachedAttributeValue, _ as getClipAABB, pe as getIndexCrs, ke as getSymbolInfo, me as getVertexCrs, re as intersectBoundingBoxWithMbs, te as intersectBoundingRectWithMbs, X as objectIdFilter, Re as rendererNeedsTextures, Fe as transformObb, qe as transparentEdgeMaterial, ne as whenGraphicAttributes };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js"],"names":["e","binaryIndexOf","t","flatten","r","splitIntoChunks","o","n","a","isSome","s","isNone","i","eachAlways","c","isInt16Array","l","isInt32Array","u","f","p","m","h","d","b","y","g","w","q","x","S","M","v","j","projectBoundingSphere","R","projectBuffer","computeLinearTransformation","T","projectVectorToVector","k","getSphericalPCPF","z","getReferenceEllipsoid","F","A","create","I","C","empty","U","expandPointInPlace","B","intersects","K","canProject","L","W","readBinaryAttribute","G","computeGlobalTransformation","E","createSolidEdgeMaterial","O","createMaterialFromEdges","P","parseColorMixMode","$","corners","Q","compute","Z","D","H","parseInt","substring","lastIndexOf","length","J","geometryBuffers","compressedAttributes","encoding","N","traverse","mbs","ee","te","V","X","Y","_","rotationScale","position","Math","max","re","oe","missingFields","originalFields","toLowerCase","name","push","ne","attributeStorageInfo","associatedLayer","se","loaded","ae","parsedUrl","path","Promise","all","map","ce","node","indices","then","graphics","attributes","Map","featureIds","indexOf","get","set","sort","fields","ie","capabilities","query","maxRecordCount","objectIds","outFields","orderByFields","objectIdField","queryFeatures","features","resources","key","url","storageInfo","responseType","data","value","fe","le","ue","pe","store","indexCRS","geographicCRS","indexWKT","spatialReference","wkt","equals","me","vertexCRS","projectedCRS","vertexWKT","he","wkid","de","isGeographic","ye","ge","geometryType","topology","vertexAttributes","be","defaultGeometrySchema","we","viewingMode","xe","Se","Me","ve","type","je","Re","defaultSymbol","getSymbols","symbolLayers","items","material","color","colorMixMode","qe","opacity","Te","constructor","edgeMaterial","castShadows","ke","enabled","edges","alpha","ze","Fe","Ie","Ae","center","quaternion","halfSize","Ke","Ue","sqrt","Be","Ee","abs","radius","inverseFlattening","Ce","Pe","We","serviceObb","Ge","geometry","hasZ","Le","rings","reduce","min","forEach","Oe","Array","size","SymbolInfo","addWraparound","checkPointCloudLayerCompatibleWithView","checkPointCloudLayerValid","checkSceneLayerCompatibleWithView","checkSceneLayerValid","checkSpatialReference","checkSpatialReferences","computeVisibilityObb","containsDraco","extractWkid","filterInPlace","findFieldsCaseInsensitive","findIntersectingNodes","getCacheKeySuffix","getCachedAttributeValue","getClipAABB","getIndexCrs","getSymbolInfo","getVertexCrs","intersectBoundingBoxWithMbs","intersectBoundingRectWithMbs","objectIdFilter","rendererNeedsTextures","transformObb","transparentEdgeMaterial","whenGraphicAttributes"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import{binaryIndexOf as t,flatten as r,splitIntoChunks as o}from\"../../../../core/arrayUtils.js\";import n from\"../../../../core/Error.js\";import a from\"../../../../core/has.js\";import{isSome as s,isNone as i}from\"../../../../core/maybe.js\";import{eachAlways as c}from\"../../../../core/promiseUtils.js\";import{isInt16Array as l,isInt32Array as u}from\"../../../../core/typedArrayUtil.js\";import{a as f}from\"../../../../chunks/mat4.js\";import{c as p}from\"../../../../chunks/mat4f64.js\";import{a as m,m as h,c as d}from\"../../../../chunks/quat.js\";import{b as y}from\"../../../../chunks/quatf32.js\";import{s as g,g as b,w,q as x,a as S,b as M,m as v}from\"../../../../chunks/vec3.js\";import{c as j}from\"../../../../chunks/vec4f64.js\";import{projectBoundingSphere as R,projectBuffer as q,computeLinearTransformation as T,projectVectorToVector as k}from\"../../../../geometry/projection.js\";import{getSphericalPCPF as z,getReferenceEllipsoid as F}from\"../../../../geometry/projectionEllipsoid.js\";import A from\"../../../../geometry/SpatialReference.js\";import{create as I}from\"../../../../geometry/support/aaBoundingBox.js\";import{create as C,empty as U,expandPointInPlace as B,intersects as K}from\"../../../../geometry/support/aaBoundingRect.js\";import{canProject as L}from\"../../../../geometry/support/webMercatorUtils.js\";import W from\"../../../../rest/support/Query.js\";import{readBinaryAttribute as G}from\"./I3SBinaryReader.js\";import{computeGlobalTransformation as E}from\"./I3SProjectionUtil.js\";import{createSolidEdgeMaterial as O,createMaterialFromEdges as P}from\"../support/edgeUtils.js\";import{parseColorMixMode as $}from\"../support/symbolColorUtils.js\";import{corners as Q,compute as Z,create as D}from\"../../support/orientedBoundingBox.js\";function H(e){return e&&parseInt(e.substring(e.lastIndexOf(\"/\")+1,e.length),10)}function J(e){if(a(\"disable-feature:i3s-draco\")||!e)return!1;for(const t of e)for(const e of t.geometryBuffers)if(\"draco\"===e.compressedAttributes.encoding)return!0;return!1}function N(e,t,r,o,n,a){n.traverse(r,(r=>{let n=r.mbs;t!==o&&(n=ee,R(r.mbs,o,n,t));const s=te(e,n);return 0!==s&&(a(r,s),!0)}))}function V(e,t,r){let o=0,n=0;for(let a=0;a<t.length&&o<e.length;a++)e[o]===t[a]&&(r(a)&&(e[n]=e[o],n++),o++);e.length=n}function X(e,r,o){let n=0,a=0;for(;n<o.length;){t(e,o[n])>=0===r&&(o[a]=o[n],a++),n++}o.length=a}const Y=I();function _(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return Y[0]=(e[0]-t.position[0])/t.rotationScale[0],Y[1]=(e[1]-t.position[1])/t.rotationScale[4],Y[2]=(e[2]-t.position[2])/t.rotationScale[8],Y[3]=(e[3]-t.position[0])/t.rotationScale[0],Y[4]=(e[4]-t.position[1])/t.rotationScale[4],Y[5]=(e[5]-t.position[2])/t.rotationScale[8],Y}const ee=j();function te(e,t){const r=t[0],o=t[1],n=t[3],a=e[0]-r,s=r-e[2],i=e[1]-o,c=o-e[3],l=Math.max(a,s,0),u=Math.max(i,c,0),f=l*l+u*u;if(f>n*n)return 0;if(f>0)return 1;return-Math.max(a,s,i,c)>n?3:2}function re(e,t){const r=t[0],o=t[1],n=t[2],a=t[3],s=e[0]-r,i=r-e[3],c=e[1]-o,l=o-e[4],u=e[2]-n,f=n-e[5],p=Math.max(s,i,0),m=Math.max(c,l,0),h=Math.max(u,f,0),d=p*p+m*m+h*h;if(d>a*a)return 0;if(d>0)return 1;return-Math.max(s,i,c,l,u,f)>a?3:2}function oe(e,t,r){const o=[],n=r&&r.missingFields,a=r&&r.originalFields;for(const s of e){const e=s.toLowerCase();let r=!1;for(const n of t)if(e===n.name.toLowerCase()){o.push(n.name),r=!0,a&&a.push(s);break}!r&&n&&n.push(s)}return o}async function ne(e,t,o,a,c){if(0===t.length)return[];const l=e.attributeStorageInfo;if(s(e.associatedLayer))try{return await se(e.associatedLayer,t,o,a)}catch(u){if(e.associatedLayer.loaded)throw u}if(l){const s=ae(t,o,c);if(i(s))throw new n(\"scenelayer:features-not-loaded\",\"Tried to query attributes for unloaded features\");const u=e.parsedUrl.path,f=await Promise.all(s.map((e=>ce(u,l,e.node,e.indices,a).then((t=>{for(let r=0;r<e.graphics.length;r++){const o=e.graphics[r],n=t[r];if(o.attributes)for(const e in o.attributes)e in n||(n[e]=o.attributes[e]);o.attributes=n}return e.graphics})))));return r(f)}throw new n(\"scenelayer:no-attribute-source\",\"This scene layer does not have a source for attributes available\")}function ae(e,t,r){const o=new Map,n=[],a=r();for(const s of e){const e=s.attributes[t];for(let t=0;t<a.length;t++){const r=a[t],i=r.featureIds.indexOf(e);if(i>=0){let e=o.get(r.node);e||(e={node:r.node,indices:[],graphics:[]},n.push(e),o.set(r.node,e)),e.indices.push(i),e.graphics.push(s);for(let r=t;r>0;r--)a[r]=a[r-1];a[0]=r;break}}}return n}async function se(e,t,r,o){t.sort(((e,t)=>e.attributes[r]-t.attributes[r]));const n=t.map((e=>e.attributes[r])),a=[],s=oe(o,e.fields,{originalFields:a}),i=await ie(e,n,s);for(let c=0;c<t.length;c++){const e=t[c],r=i[c],o={};if(e.attributes)for(const t in e.attributes)o[t]=e.attributes[t];for(let t=0;t<a.length;t++)o[a[t]]=r[s[t]];e.attributes=o}return t}function ie(e,t,a){const s=e.capabilities.query.maxRecordCount;if(null!=s&&t.length>s){const n=o(t,s);return Promise.all(n.map((t=>ie(e,t,a)))).then(r)}const i=new W({objectIds:t,outFields:a,orderByFields:[e.objectIdField]});return e.queryFeatures(i).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new n(\"scenelayer:feature-not-in-associated-layer\",\"Feature not found in associated feature layer\")}))}function ce(t,r,o,n,a){const s=[];for(const e of r)if(e&&-1!==a.indexOf(e.name)){const r=`${t}/nodes/${o.resources.attributes}/attributes/${e.key}/0`;s.push({url:r,storageInfo:e})}return c(s.map((t=>e(t.url,{responseType:\"array-buffer\"}).then((e=>G(t.storageInfo,e.data)))))).then((e=>{const t=[];for(const r of n){const o={};for(let t=0;t<e.length;t++)null!=e[t].value&&(o[s[t].storageInfo.name]=fe(e[t].value,r));t.push(o)}return t}))}const le=-32768,ue=-(2**31);function fe(e,t){if(!e)return null;const r=e[t];if(l(e))return r===le?null:r;if(u(e))return r===ue?null:r;return r!=r?null:r}function pe(e){const t=e.store.indexCRS||e.store.geographicCRS,r=void 0===t?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new n(\"layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference\",\"Found indeWKT in the scene layer store but no layer spatial reference\",{});if(r!==e.spatialReference.wkt)throw new n(\"layerview:store-spatial-reference-wkt-index-incompatible\",\"The indeWKT of the scene layer store does not match the WKT of the layer spatial reference\",{})}const o=t?new A(H(t)):e.spatialReference;return o.equals(e.spatialReference)?e.spatialReference:o}function me(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=void 0===t?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new n(\"layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference\",\"Found vertexWKT in the scene layer store but no layer spatial reference\",{});if(r!==e.spatialReference.wkt)throw new n(\"layerview:store-spatial-reference-wkt-vertex-incompatible\",\"The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference\",{})}const o=t?new A(H(t)):e.spatialReference;return o.equals(e.spatialReference)?e.spatialReference:o}function he(e,t){return i(t)?\"@null\":t===z(t)?\"@ECEF\":e.equals(t)?\"\":null!=t.wkid?\"@\"+t.wkid:null}function de(e,t,r){if(!L(e,t))throw new n(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this scene layer is incompatible with the spatial reference of the view\",{});if(\"local\"===r&&e.isGeographic)throw new n(\"layerview:local-gcs-not-supported\",\"Geographic coordinate systems are not supported in local scenes\",{})}function ye(e,t,r){const o=pe(e),n=me(e);de(o,t,r),de(n,t,r)}function ge(e){return(null==e.geometryType||\"triangles\"===e.geometryType)&&((null==e.topology||\"PerAttributeArray\"===e.topology)&&(null!=e.vertexAttributes&&null!=e.vertexAttributes.position))}function be(e){if(null==e.store||null==e.store.defaultGeometrySchema||!ge(e.store.defaultGeometrySchema))throw new n(\"scenelayer:unsupported-geometry-schema\",\"The geometry schema of this scene layer is not supported.\",{url:e.parsedUrl.path})}function we(e,t){ye(e,t.spatialReference,t.viewingMode)}function xe(e){return null!=e.geometryType&&\"points\"===e.geometryType&&((null==e.topology||\"PerAttributeArray\"===e.topology)&&((null==e.encoding||\"\"===e.encoding||\"lepcc-xyz\"===e.encoding)&&(null!=e.vertexAttributes&&null!=e.vertexAttributes.position)))}function Se(e){if(null==e.store||null==e.store.defaultGeometrySchema||!xe(e.store.defaultGeometrySchema))throw new n(\"pointcloud:unsupported-geometry-schema\",\"The geometry schema of this point cloud scene layer is not supported.\",{})}function Me(e,t){de(e.spatialReference,t.spatialReference,t.viewingMode)}function ve(e){return\"simple\"===e.type||\"class-breaks\"===e.type||\"unique-value\"===e.type}function je(e){return\"mesh-3d\"===e.type}function Re(e){if(null==e||!ve(e))return!0;if((\"unique-value\"===e.type||\"class-breaks\"===e.type)&&null==e.defaultSymbol)return!0;const t=e.getSymbols();if(0===t.length)return!0;for(const r of t){if(!je(r)||0===r.symbolLayers.length)return!0;for(const e of r.symbolLayers.items)if(\"fill\"!==e.type||i(e.material)||i(e.material.color)||\"replace\"!==e.material.colorMixMode)return!0}return!1}const qe=O({color:[0,0,0,0],opacity:0});class Te{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function ke(e){const t=new Te;let r=!1,o=!1;for(const n of e.symbolLayers.items)if(\"fill\"===n.type&&n.enabled){const e=n.material,a=n.edges;if(s(e)&&!r){const o=e.color,a=$(e.colorMixMode);s(o)?t.material={color:[o.r/255,o.g/255,o.b/255],alpha:o.a,colorMixMode:a}:t.material={color:[1,1,1],alpha:1,colorMixMode:1},t.castShadows=n.castShadows,r=!0}s(a)&&!o&&(t.edgeMaterial=P(a,{}),o=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:1}),t}function ze(e,t){return(0|e)+(0|t)|0}function Fe(e,t,r,o,n=0){o===z(o)?t.isGeographic?Ie(e,r,t,n):Ae(e,r,t,n):e===r?(r.center[2]+=n,q(r.center,t,0,r.center,o,0,1)):(g(r.center,e.center[0],e.center[1],e.center[2]+n),q(r.center,t,0,r.center,o,0,1),m(r.quaternion,e.quaternion),b(r.halfSize,e.halfSize))}function Ae(e,t,r,o){Q(e,Ke),g(t.center,e.center[0],e.center[1],e.center[2]+o),T(r,t.center,Ue,z(r)),g(t.center,Ue[12],Ue[13],Ue[14]);const n=2*Math.sqrt(1+Ue[0]+Ue[5]+Ue[10]);Be[0]=(Ue[6]-Ue[9])/n,Be[1]=(Ue[8]-Ue[2])/n,Be[2]=(Ue[1]-Ue[4])/n,Be[3]=.25*n,h(t.quaternion,Be,e.quaternion),d(Be,t.quaternion);let a=0,s=0,i=0;for(const c of Ke)c[2]+=o,q(c,r,0,c,z(r),0,1),w(Ee,c,t.center),x(Ee,Ee,Be),a=Math.max(a,Math.abs(Ee[0])),s=Math.max(s,Math.abs(Ee[1])),i=Math.max(i,Math.abs(Ee[2]));g(t.halfSize,a,s,i)}function Ie(e,t,r,o){const n=F(r),a=1+Math.max(0,o)/(n.radius+e.center[2]);g(t.center,e.center[0],e.center[1],e.center[2]+o),q(t.center,r,0,t.center,z(r),0,1),m(t.quaternion,e.quaternion),d(Be,e.quaternion),g(Ee,0,0,1),x(Ee,Ee,Be),g(Ee,e.halfSize[0]*Math.abs(Ee[0]),e.halfSize[1]*Math.abs(Ee[1]),e.halfSize[2]*Math.abs(Ee[2])),S(Ee,Ee,n.inverseFlattening),M(t.halfSize,e.halfSize,Ee),S(t.halfSize,t.halfSize,a)}function Ce(e,t,r,o,n,a){if(!a||0===a.length||i(t))return null;const c=E(e.mbs,n,r,t);let l;f(Pe,c);const u=()=>{if(!l)if(l=Ke,U(We),s(e.serviceObb)){Fe(e.serviceObb,r,Ge,t,n),Q(Ge,l);for(const e of l)v(e,e,Pe),B(We,e)}else{const o=e.mbs,a=o[3];k(o,r,Ee,t),v(Ee,Ee,Pe),Ee[2]+=n;for(let e=0;e<8;++e){const t=1&e?a:-a,r=2&e?a:-a,o=4&e?a:-a,n=l[e];b(n,[Ee[0]+t,Ee[1]+r,Ee[2]+o]),B(We,n)}}};let p=1/0,m=-1/0;const h=e=>{if(\"replace\"!==e.type)return;const r=e.geometry;if(!r.hasZ)return;U(Le);const n=r.spatialReference||o,a=r.rings.reduce(((e,r)=>r.reduce(((e,r)=>(k(r,n,Ee,t),v(Ee,Ee,Pe),B(Le,Ee),Math.min(Ee[2],e))),e)),1/0);u(),K(We,Le)&&(p=Math.min(p,a),m=Math.max(m,a))};if(a.forEach((e=>h(e))),p===1/0)return null;const d=(e,t,r)=>{v(Ee,r,c),e[t+0]=Ee[0],e[t+1]=Ee[1],e[t+2]=Ee[2],t+=24,r[2]=p,v(Ee,r,c),e[t+0]=Ee[0],e[t+1]=Ee[1],e[t+2]=Ee[2],t+=24,r[2]=m,v(Ee,r,c),e[t+0]=Ee[0],e[t+1]=Ee[1],e[t+2]=Ee[2]};for(let s=0;s<8;++s)d(Oe.data,3*s,l[s]);return Z(Oe)}const Ue=p(),Be=y(),Ke=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Le=C(),We=C(),Ge=D(),Ee=[0,0,0],Oe={data:new Array(72),size:3},Pe=p();export{Te as SymbolInfo,ze as addWraparound,Me as checkPointCloudLayerCompatibleWithView,Se as checkPointCloudLayerValid,we as checkSceneLayerCompatibleWithView,be as checkSceneLayerValid,de as checkSpatialReference,ye as checkSpatialReferences,Ce as computeVisibilityObb,J as containsDraco,H as extractWkid,V as filterInPlace,oe as findFieldsCaseInsensitive,N as findIntersectingNodes,he as getCacheKeySuffix,fe as getCachedAttributeValue,_ as getClipAABB,pe as getIndexCrs,ke as getSymbolInfo,me as getVertexCrs,re as intersectBoundingBoxWithMbs,te as intersectBoundingRectWithMbs,X as objectIdFilter,Re as rendererNeedsTextures,Fe as transformObb,qe as transparentEdgeMaterial,ne as whenGraphicAttributes};\n"]},"metadata":{},"sourceType":"module"}