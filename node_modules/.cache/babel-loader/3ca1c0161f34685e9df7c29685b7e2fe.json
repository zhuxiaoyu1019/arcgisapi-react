{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../intl.js\";\nimport e from \"../../../core/Error.js\";\nimport { clone as t } from \"../../../core/lang.js\";\nimport i from \"../../../core/Logger.js\";\nimport { isSome as n } from \"../../../core/maybe.js\";\nimport { getMetersPerUnitForSR as r } from \"../../../core/unitUtils.js\";\nimport o from \"../../../geometry/Polygon.js\";\nimport { createExtentFromGeometry as l, scaleExtent as s } from \"./geometryUtils.js\";\nimport { substitute as u } from \"../../../intl/substitute.js\";\nimport { formatDate as a } from \"../../../intl/date.js\";\nconst d = /https?:\\/\\/services.*\\.arcgis\\.com/i,\n      c = /(?:\\{([^}]+)\\})/g,\n      f = i.getLogger(\"esri.widgets.Search.support.layerSearchUtils\");\n\nfunction g(t, i) {\n  const {\n    exactMatch: n = !1,\n    location: o,\n    maxResults: l,\n    spatialReference: s,\n    source: u,\n    sourceIndex: a,\n    suggestResult: d,\n    view: c\n  } = t,\n        {\n    layer: g,\n    filter: m,\n    zoomScale: F\n  } = u,\n        b = c && c.scale,\n        j = p(u, c),\n        R = i && i.signal;\n  return h(g).then(() => {\n    const e = g.popupTemplate;\n    return e ? e.getRequiredFields(g.fieldsIndex) : null;\n  }).then(t => {\n    var i, p;\n    const {\n      objectIdField: h,\n      returnZ: S\n    } = g,\n          L = w(u);\n    if (!$(g, L)) throw f.error(\"invalid-field: displayField is invalid.\"), new e(\"getResults():invalid-field\", \"displayField is invalid.\");\n    const D = t && t.length ? t : [L],\n          E = u.outFields || D,\n          O = y(E);\n    -1 !== E.indexOf(h) || O || E.push(h);\n    if (!(O || x(g, E))) throw f.error(\"invalid-field: outField is invalid.\"), new e(\"getResults():invalid-field\", \"outField is invalid.\");\n    const C = g.createQuery(),\n          {\n      orderByFields: N\n    } = u;\n\n    if (N && (C.orderByFields = N), s) {\n      C.outSpatialReference = s;\n      const e = 1 / r(s);\n      e && (C.maxAllowableOffset = e);\n    }\n\n    const k = \"mesh\" === g.geometryType || \"multipatch\" === g.geometryType,\n          q = (null == (i = g.capabilities) || null == (p = i.data) ? void 0 : p.supportsZ) && !k;\n    if (C.returnZ = q && !1 !== S, C.returnGeometry = !0, C.multipatchOption = k ? \"xyFootprint\" : null, E && (C.outFields = E), o) C.geometry = o;else if (d.key) C.objectIds = [d.key];else {\n      const t = u.searchFields || [L];\n      if (!x(g, t)) throw f.error(\"invalid-field: search field is invalid.\"), new e(\"getResults():invalid-field\", \"search field is invalid.\");\n      v(g) && (C.num = l), j && (C.geometry = j);\n      if (!d.text.trim()) return [];\n      const {\n        prefix: i = \"\",\n        suffix: r = \"\"\n      } = u,\n            o = T(I(`${i}${d.text}${r}`), g, t, m, n);\n      if (!o) return [];\n      C.where = o;\n    }\n    return g.queryFeatures(C, {\n      signal: R\n    }).then(e => U(e, c, u, a, L, b, F));\n  });\n}\n\nfunction m(t, i) {\n  const {\n    source: n,\n    spatialReference: r,\n    view: o,\n    suggestTerm: l,\n    maxSuggestions: s,\n    sourceIndex: u\n  } = t,\n        {\n    layer: a,\n    filter: d\n  } = n,\n        g = i && i.signal,\n        m = p(n, o);\n  return h(a).then(() => {\n    if (!v(a)) return [];\n    const t = w(n),\n          i = n.searchFields || [t],\n          o = [];\n    n.suggestionTemplate ? n.suggestionTemplate.replace(c, (e, t) => (o.push(t), e)) : o.push(t);\n    const p = y(o);\n    -1 !== o.indexOf(a.objectIdField) || p || o.push(a.objectIdField);\n    const h = $(a, t),\n          F = p || x(a, o),\n          b = x(a, i);\n    if (!h) throw f.error(\"invalid-field: displayField is invalid.\"), new e(\"getSuggestions():invalid-field\", \"displayField is invalid.\");\n    if (!F) throw f.error(\"invalid-field: outField is invalid.\"), new e(\"getSuggestions():invalid-field\", \"outField is invalid.\");\n    if (!b) throw f.error(\"invalid-field: search field is invalid.\"), new e(\"getSuggestions():invalid-field\", \"search field is invalid.\");\n    const j = a.createQuery(),\n          {\n      orderByFields: R\n    } = n;\n    R && (j.orderByFields = R), j.outSpatialReference = r, j.returnGeometry = !1, j.num = s, j.outFields = o, m && (j.geometry = m);\n    if (!l.trim()) return [];\n    const {\n      prefix: S = \"\",\n      suffix: L = \"\"\n    } = n,\n          D = T(I(`${S}${l}${L}`), a, i, d, !1);\n    return D ? (j.where = D, a.queryFeatures(j, {\n      signal: g\n    }).then(e => N(e, n, u, t))) : [];\n  });\n}\n\nfunction p(e, t) {\n  const {\n    filter: i,\n    withinViewEnabled: n\n  } = e,\n        r = t && t.extent;\n  return i && i.geometry || (n && r ? r : void 0);\n}\n\nfunction y(e) {\n  return e && -1 !== e.indexOf(\"*\");\n}\n\nasync function h(e) {\n  e && (await e.load());\n}\n\nfunction v(e) {\n  var t, i, n;\n  return null != (t = null == e || null == (i = e.capabilities) || null == (n = i.query) ? void 0 : n.supportsPagination) && t;\n}\n\nfunction F(e) {\n  var t, i, n, r;\n  return null != (t = null == e || null == (i = e.fieldsIndex) || null == (n = i.fields) || null == (r = n.find(e => \"string\" === e.type)) ? void 0 : r.name) ? t : \"\";\n}\n\nfunction w(e) {\n  return e.displayField || e.layer.displayField || F(e.layer);\n}\n\nfunction x(e, t) {\n  return !(!e || !t) && t.every(t => $(e, t));\n}\n\nfunction $(e, t) {\n  return !!e.getField(t);\n}\n\nfunction b(e) {\n  for (let t = 0; t < e.length; t++) if (e.charCodeAt(t) > 255) return !0;\n\n  return !1;\n}\n\nfunction j(e, t, i) {\n  let n = null;\n  const {\n    codedValues: r\n  } = e;\n  return r && r.some(e => {\n    const r = e.name,\n          o = i ? r : r.toLowerCase();\n    return (i ? t : t.toLowerCase()) === o && (n = e.code.toString(), !0);\n  }), n;\n}\n\nfunction I(e) {\n  return e.replace(/\\'/g, \"''\");\n}\n\nfunction R(e, t) {\n  const i = t && t.where;\n  return i ? `(${e}) AND (${i})` : e;\n}\n\nfunction S(e, t, i, n, r) {\n  const o = t.type,\n        l = t.name;\n\n  if (\"string\" === o || \"date\" === o || \"global-id\" === o) {\n    if (r) return R(`${l} = ${i}'${e}'`, n);\n    return R(`UPPER(${l}) LIKE ${i}'%${e.toUpperCase()}%'`, n);\n  }\n\n  if (\"oid\" === o || \"small-integer\" === o || \"integer\" === o || \"single\" === o || \"double\" === o) {\n    const t = Number(e);\n    return isNaN(t) ? null : R(`${l} = ${t}`, n);\n  }\n\n  return R(`${l} = ${e}`, n);\n}\n\nfunction L(e, t) {\n  return e ? ` OR (${t})` : `(${t})`;\n}\n\nfunction T(e, t, i, n, r) {\n  const {\n    definitionExpression: o\n  } = t;\n  let l = \"\";\n\n  if (e) {\n    const o = d.test(t.url) && b(e) ? \"N\" : \"\";\n    i && i.forEach(i => {\n      const s = t.getField(i),\n            u = \"function\" == typeof t.getFieldDomain && t.getFieldDomain(i),\n            a = (u && \"coded-value\" === u.type ? j(u, e, r) : null) || e || null;\n\n      if (null !== a) {\n        const e = S(a, s, o, n, r);\n        e && (l += L(l, e));\n      }\n    });\n  }\n\n  return o ? `(${o}) AND (${l})` : l;\n}\n\nfunction D(e, t) {\n  let i = null;\n  const {\n    codedValues: n\n  } = e;\n  return n && n.length && n.some(e => e.code === t && (i = e.name, !0)), i;\n}\n\nfunction E(e, t) {\n  return e[Object.keys(e).find(e => e.toLowerCase() === t.toLowerCase())];\n}\n\nfunction O(e, t, i) {\n  const n = e.sourceLayer,\n        {\n    attributes: r\n  } = e,\n        o = \"function\" == typeof n.getFieldDomain && n.getFieldDomain(i);\n  if (t) return u(t, r);\n\n  if (i && r) {\n    const e = n.getField(i),\n          t = E(r, i);\n    return null == t ? \"\" : o && \"coded-value\" === o.type ? D(o, t) : \"date\" === (null == e ? void 0 : e.type) ? a(new Date(t)) : \"number\" == typeof t ? t.toString() : \"string\" != typeof t ? \"\" : t.trim();\n  }\n\n  return \"\";\n}\n\nfunction C(e, t, i, n) {\n  const r = e.sourceLayer,\n        {\n    attributes: o\n  } = e,\n        {\n    objectIdField: l\n  } = r,\n        s = o[l];\n  return {\n    text: O(e, t.suggestionTemplate, n),\n    key: s,\n    sourceIndex: i\n  };\n}\n\nfunction N(e, t, i, n) {\n  return e.features.map(e => C(e, t, i, n));\n}\n\nfunction k(e, i, r, u, a, d, c) {\n  const f = e.clone(),\n        g = e.sourceLayer,\n        m = g && g.objectIdField,\n        p = m && e.attributes[m],\n        y = O(e, r.searchTemplate, a),\n        h = l(f.geometry, i, d),\n        v = \"number\" == typeof c ? s(t(h), i, c) : h,\n        F = e.clone();\n  return n(v) && (F.geometry = o.fromExtent(v)), {\n    extent: v,\n    target: F,\n    feature: f,\n    key: p,\n    name: y,\n    sourceIndex: u\n  };\n}\n\nfunction U(e, t, i, n, r, o, l) {\n  return e.features.map(e => k(e, t, i, n, r, o, l));\n}\n\nexport { g as getResults, m as getSuggestions };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/widgets/Search/support/layerSearchUtils.js"],"names":["e","clone","t","i","isSome","n","getMetersPerUnitForSR","r","o","createExtentFromGeometry","l","scaleExtent","s","substitute","u","formatDate","a","d","c","f","getLogger","g","exactMatch","location","maxResults","spatialReference","source","sourceIndex","suggestResult","view","layer","filter","m","zoomScale","F","b","scale","j","p","R","signal","h","then","popupTemplate","getRequiredFields","fieldsIndex","objectIdField","returnZ","S","L","w","$","error","D","length","E","outFields","O","y","indexOf","push","x","C","createQuery","orderByFields","N","outSpatialReference","maxAllowableOffset","k","geometryType","q","capabilities","data","supportsZ","returnGeometry","multipatchOption","geometry","key","objectIds","searchFields","v","num","text","trim","prefix","suffix","T","I","where","queryFeatures","U","suggestTerm","maxSuggestions","suggestionTemplate","replace","withinViewEnabled","extent","load","query","supportsPagination","fields","find","type","name","displayField","every","getField","charCodeAt","codedValues","some","toLowerCase","code","toString","toUpperCase","Number","isNaN","definitionExpression","test","url","forEach","getFieldDomain","Object","keys","sourceLayer","attributes","Date","features","map","searchTemplate","fromExtent","target","feature","getResults","getSuggestions"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../intl.js\";import e from\"../../../core/Error.js\";import{clone as t}from\"../../../core/lang.js\";import i from\"../../../core/Logger.js\";import{isSome as n}from\"../../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../../core/unitUtils.js\";import o from\"../../../geometry/Polygon.js\";import{createExtentFromGeometry as l,scaleExtent as s}from\"./geometryUtils.js\";import{substitute as u}from\"../../../intl/substitute.js\";import{formatDate as a}from\"../../../intl/date.js\";const d=/https?:\\/\\/services.*\\.arcgis\\.com/i,c=/(?:\\{([^}]+)\\})/g,f=i.getLogger(\"esri.widgets.Search.support.layerSearchUtils\");function g(t,i){const{exactMatch:n=!1,location:o,maxResults:l,spatialReference:s,source:u,sourceIndex:a,suggestResult:d,view:c}=t,{layer:g,filter:m,zoomScale:F}=u,b=c&&c.scale,j=p(u,c),R=i&&i.signal;return h(g).then((()=>{const e=g.popupTemplate;return e?e.getRequiredFields(g.fieldsIndex):null})).then((t=>{var i,p;const{objectIdField:h,returnZ:S}=g,L=w(u);if(!$(g,L))throw f.error(\"invalid-field: displayField is invalid.\"),new e(\"getResults():invalid-field\",\"displayField is invalid.\");const D=t&&t.length?t:[L],E=u.outFields||D,O=y(E);-1!==E.indexOf(h)||O||E.push(h);if(!(O||x(g,E)))throw f.error(\"invalid-field: outField is invalid.\"),new e(\"getResults():invalid-field\",\"outField is invalid.\");const C=g.createQuery(),{orderByFields:N}=u;if(N&&(C.orderByFields=N),s){C.outSpatialReference=s;const e=1/r(s);e&&(C.maxAllowableOffset=e)}const k=\"mesh\"===g.geometryType||\"multipatch\"===g.geometryType,q=(null==(i=g.capabilities)||null==(p=i.data)?void 0:p.supportsZ)&&!k;if(C.returnZ=q&&!1!==S,C.returnGeometry=!0,C.multipatchOption=k?\"xyFootprint\":null,E&&(C.outFields=E),o)C.geometry=o;else if(d.key)C.objectIds=[d.key];else{const t=u.searchFields||[L];if(!x(g,t))throw f.error(\"invalid-field: search field is invalid.\"),new e(\"getResults():invalid-field\",\"search field is invalid.\");v(g)&&(C.num=l),j&&(C.geometry=j);if(!d.text.trim())return[];const{prefix:i=\"\",suffix:r=\"\"}=u,o=T(I(`${i}${d.text}${r}`),g,t,m,n);if(!o)return[];C.where=o}return g.queryFeatures(C,{signal:R}).then((e=>U(e,c,u,a,L,b,F)))}))}function m(t,i){const{source:n,spatialReference:r,view:o,suggestTerm:l,maxSuggestions:s,sourceIndex:u}=t,{layer:a,filter:d}=n,g=i&&i.signal,m=p(n,o);return h(a).then((()=>{if(!v(a))return[];const t=w(n),i=n.searchFields||[t],o=[];n.suggestionTemplate?n.suggestionTemplate.replace(c,((e,t)=>(o.push(t),e))):o.push(t);const p=y(o);-1!==o.indexOf(a.objectIdField)||p||o.push(a.objectIdField);const h=$(a,t),F=p||x(a,o),b=x(a,i);if(!h)throw f.error(\"invalid-field: displayField is invalid.\"),new e(\"getSuggestions():invalid-field\",\"displayField is invalid.\");if(!F)throw f.error(\"invalid-field: outField is invalid.\"),new e(\"getSuggestions():invalid-field\",\"outField is invalid.\");if(!b)throw f.error(\"invalid-field: search field is invalid.\"),new e(\"getSuggestions():invalid-field\",\"search field is invalid.\");const j=a.createQuery(),{orderByFields:R}=n;R&&(j.orderByFields=R),j.outSpatialReference=r,j.returnGeometry=!1,j.num=s,j.outFields=o,m&&(j.geometry=m);if(!l.trim())return[];const{prefix:S=\"\",suffix:L=\"\"}=n,D=T(I(`${S}${l}${L}`),a,i,d,!1);return D?(j.where=D,a.queryFeatures(j,{signal:g}).then((e=>N(e,n,u,t)))):[]}))}function p(e,t){const{filter:i,withinViewEnabled:n}=e,r=t&&t.extent;return i&&i.geometry||(n&&r?r:void 0)}function y(e){return e&&-1!==e.indexOf(\"*\")}async function h(e){e&&await e.load()}function v(e){var t,i,n;return null!=(t=null==e||null==(i=e.capabilities)||null==(n=i.query)?void 0:n.supportsPagination)&&t}function F(e){var t,i,n,r;return null!=(t=null==e||null==(i=e.fieldsIndex)||null==(n=i.fields)||null==(r=n.find((e=>\"string\"===e.type)))?void 0:r.name)?t:\"\"}function w(e){return e.displayField||e.layer.displayField||F(e.layer)}function x(e,t){return!(!e||!t)&&t.every((t=>$(e,t)))}function $(e,t){return!!e.getField(t)}function b(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function j(e,t,i){let n=null;const{codedValues:r}=e;return r&&r.some((e=>{const r=e.name,o=i?r:r.toLowerCase();return(i?t:t.toLowerCase())===o&&(n=e.code.toString(),!0)})),n}function I(e){return e.replace(/\\'/g,\"''\")}function R(e,t){const i=t&&t.where;return i?`(${e}) AND (${i})`:e}function S(e,t,i,n,r){const o=t.type,l=t.name;if(\"string\"===o||\"date\"===o||\"global-id\"===o){if(r)return R(`${l} = ${i}'${e}'`,n);return R(`UPPER(${l}) LIKE ${i}'%${e.toUpperCase()}%'`,n)}if(\"oid\"===o||\"small-integer\"===o||\"integer\"===o||\"single\"===o||\"double\"===o){const t=Number(e);return isNaN(t)?null:R(`${l} = ${t}`,n)}return R(`${l} = ${e}`,n)}function L(e,t){return e?` OR (${t})`:`(${t})`}function T(e,t,i,n,r){const{definitionExpression:o}=t;let l=\"\";if(e){const o=d.test(t.url)&&b(e)?\"N\":\"\";i&&i.forEach((i=>{const s=t.getField(i),u=\"function\"==typeof t.getFieldDomain&&t.getFieldDomain(i),a=(u&&\"coded-value\"===u.type?j(u,e,r):null)||e||null;if(null!==a){const e=S(a,s,o,n,r);e&&(l+=L(l,e))}}))}return o?`(${o}) AND (${l})`:l}function D(e,t){let i=null;const{codedValues:n}=e;return n&&n.length&&n.some((e=>e.code===t&&(i=e.name,!0))),i}function E(e,t){return e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}function O(e,t,i){const n=e.sourceLayer,{attributes:r}=e,o=\"function\"==typeof n.getFieldDomain&&n.getFieldDomain(i);if(t)return u(t,r);if(i&&r){const e=n.getField(i),t=E(r,i);return null==t?\"\":o&&\"coded-value\"===o.type?D(o,t):\"date\"===(null==e?void 0:e.type)?a(new Date(t)):\"number\"==typeof t?t.toString():\"string\"!=typeof t?\"\":t.trim()}return\"\"}function C(e,t,i,n){const r=e.sourceLayer,{attributes:o}=e,{objectIdField:l}=r,s=o[l];return{text:O(e,t.suggestionTemplate,n),key:s,sourceIndex:i}}function N(e,t,i,n){return e.features.map((e=>C(e,t,i,n)))}function k(e,i,r,u,a,d,c){const f=e.clone(),g=e.sourceLayer,m=g&&g.objectIdField,p=m&&e.attributes[m],y=O(e,r.searchTemplate,a),h=l(f.geometry,i,d),v=\"number\"==typeof c?s(t(h),i,c):h,F=e.clone();return n(v)&&(F.geometry=o.fromExtent(v)),{extent:v,target:F,feature:f,key:p,name:y,sourceIndex:u}}function U(e,t,i,n,r,o,l){return e.features.map((e=>k(e,t,i,n,r,o,l)))}export{g as getResults,m as getSuggestions};\n"]},"metadata":{},"sourceType":"module"}