{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e, unwrapOr as r } from \"../../../core/maybe.js\";\nimport { g as n, h as t, a as o, f as i, b as s, d as a, l as c } from \"../../../chunks/vec3.js\";\nimport { c as l } from \"../../../chunks/vec3f64.js\";\nimport { getReferenceEllipsoid as d } from \"../../../geometry/projectionEllipsoid.js\";\nimport { containsPoint as u } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { Intersector as f } from \"../webgl-engine/lib/Intersector.js\";\n\nfunction p(r, n, t, o) {\n  return e(r.renderCoordsHelper.fromRenderCoords(n.eye, j, o)) && u(t, j);\n}\n\nfunction m(e, n) {\n  return e.elevationProvider ? r(e.elevationProvider.getElevation(n[0], n[1], n[2], e.renderCoordsHelper.spatialReference, \"ground\"), 0) : 0;\n}\n\nfunction g(e, r, a, c) {\n  const l = e.state.camera.clone();\n  r && (l.eye = r, l.center = a, l.up = c), v(e, l.ray, w) || n(w, l.center);\n  const d = e.state.constraints,\n        u = d.minimumPoiDistance;\n\n  if (t(l.eye, w) < u) {\n    const r = d.collision.enabled;\n    n(H, l.viewForward), o(H, H, u), r ? l.eye = i(j, w, H) : s(w, l.eye, H);\n    const t = e.renderCoordsHelper,\n          a = t.getAltitude(l.eye),\n          c = d.collision.elevationMargin;\n    r && a < c && (i(H, w, l.eye), l.eye = t.setAltitude(j, c, l.eye), s(w, l.eye, H));\n  }\n\n  return l.center = w, l;\n}\n\nfunction y(e, r, n) {\n  if (!e.state.isGlobal) return !1;\n  const o = m(e, r),\n        i = e.stateManager.constraintsManager.nearFarHeuristic,\n        {\n    far: s\n  } = i.compute(r, n, e.dataExtent, o, C),\n        a = s * s;\n  return t(r, n) > a;\n}\n\nfunction v(e, r, n) {\n  let t = M[e.viewingMode];\n  t || (t = new f(e.state.viewingMode), t.options.backfacesTerrain = !e.state.isGlobal, t.options.invisibleTerrain = !0, M[e.viewingMode] = t);\n  const {\n    isGlobal: o\n  } = e.state;\n  return !(!e.sceneIntersectionHelper.intersectRay(r, t, n) || y(e, r.origin, n)) || !(!e.renderCoordsHelper.intersectManifold(r, 0, n) || y(e, r.origin, n)) || !!o && b(r, n, d(e.spatialReference).radius);\n}\n\nfunction b(e, r, n) {\n  const t = a(e.origin, e.origin) - n * n,\n        i = t > 0 ? Math.sqrt(t) / 3 : 1;\n  return o(r, e.direction, i / c(e.direction)), s(r, r, e.origin), !0;\n}\n\nconst M = {},\n      j = l(),\n      w = l(),\n      H = l(),\n      C = {\n  near: 0,\n  far: 0\n};\nexport { g as cameraOnContentAlongViewDirection, p as eyeWithinExtent, m as surfaceElevationBelowRenderLocation };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/camera/intersectionUtils.js"],"names":["isSome","e","unwrapOr","r","g","n","h","t","a","o","f","i","b","s","d","l","c","getReferenceEllipsoid","containsPoint","u","Intersector","p","renderCoordsHelper","fromRenderCoords","eye","j","m","elevationProvider","getElevation","spatialReference","state","camera","clone","center","up","v","ray","w","constraints","minimumPoiDistance","collision","enabled","H","viewForward","getAltitude","elevationMargin","setAltitude","y","isGlobal","stateManager","constraintsManager","nearFarHeuristic","far","compute","dataExtent","C","M","viewingMode","options","backfacesTerrain","invisibleTerrain","sceneIntersectionHelper","intersectRay","origin","intersectManifold","radius","Math","sqrt","direction","near","cameraOnContentAlongViewDirection","eyeWithinExtent","surfaceElevationBelowRenderLocation"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e,unwrapOr as r}from\"../../../core/maybe.js\";import{g as n,h as t,a as o,f as i,b as s,d as a,l as c}from\"../../../chunks/vec3.js\";import{c as l}from\"../../../chunks/vec3f64.js\";import{getReferenceEllipsoid as d}from\"../../../geometry/projectionEllipsoid.js\";import{containsPoint as u}from\"../../../geometry/support/aaBoundingRect.js\";import{Intersector as f}from\"../webgl-engine/lib/Intersector.js\";function p(r,n,t,o){return e(r.renderCoordsHelper.fromRenderCoords(n.eye,j,o))&&u(t,j)}function m(e,n){return e.elevationProvider?r(e.elevationProvider.getElevation(n[0],n[1],n[2],e.renderCoordsHelper.spatialReference,\"ground\"),0):0}function g(e,r,a,c){const l=e.state.camera.clone();r&&(l.eye=r,l.center=a,l.up=c),v(e,l.ray,w)||n(w,l.center);const d=e.state.constraints,u=d.minimumPoiDistance;if(t(l.eye,w)<u){const r=d.collision.enabled;n(H,l.viewForward),o(H,H,u),r?l.eye=i(j,w,H):s(w,l.eye,H);const t=e.renderCoordsHelper,a=t.getAltitude(l.eye),c=d.collision.elevationMargin;r&&a<c&&(i(H,w,l.eye),l.eye=t.setAltitude(j,c,l.eye),s(w,l.eye,H))}return l.center=w,l}function y(e,r,n){if(!e.state.isGlobal)return!1;const o=m(e,r),i=e.stateManager.constraintsManager.nearFarHeuristic,{far:s}=i.compute(r,n,e.dataExtent,o,C),a=s*s;return t(r,n)>a}function v(e,r,n){let t=M[e.viewingMode];t||(t=new f(e.state.viewingMode),t.options.backfacesTerrain=!e.state.isGlobal,t.options.invisibleTerrain=!0,M[e.viewingMode]=t);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(r,t,n)||y(e,r.origin,n))||(!(!e.renderCoordsHelper.intersectManifold(r,0,n)||y(e,r.origin,n))||!!o&&b(r,n,d(e.spatialReference).radius))}function b(e,r,n){const t=a(e.origin,e.origin)-n*n,i=t>0?Math.sqrt(t)/3:1;return o(r,e.direction,i/c(e.direction)),s(r,r,e.origin),!0}const M={},j=l(),w=l(),H=l(),C={near:0,far:0};export{g as cameraOnContentAlongViewDirection,p as eyeWithinExtent,m as surfaceElevationBelowRenderLocation};\n"]},"metadata":{},"sourceType":"module"}