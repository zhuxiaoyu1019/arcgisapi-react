{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport i from \"../../../Graphic.js\";\nimport \"../../../symbols.js\";\nimport r from \"../../../core/Accessor.js\";\nimport s from \"../../../core/Handles.js\";\nimport { isNone as t } from \"../../../core/maybe.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as a } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { diff as l } from \"../../../core/accessorSupport/diffUtils.js\";\nimport { c as p } from \"../../../chunks/vec3f64.js\";\nimport { makeDehydratedPoint as c } from \"../../../layers/graphics/dehydratedFeatures.js\";\nimport { Graphics3DCore as h } from \"./graphics/Graphics3DCore.js\";\nimport n from \"./graphics/Graphics3DScaleVisibility.js\";\nimport { boundingBoxTop as d } from \"./i3s/I3SGeometryUtil.js\";\nimport { LimitGraphicsMap as y } from \"../support/LimitGraphicsMap.js\";\nimport g from \"../../../symbols/PointSymbol3D.js\";\nlet u = class extends r {\n  constructor(e) {\n    super(e), this.loadedGraphics = new y(5e4), this.slicePlaneEnabled = !1, this._renderingInfo = {\n      symbol: new g()\n    }, this._handles = new s(), this._graphicsByNode = new Map(), this._scaleVisibility = null;\n  }\n\n  initialize() {\n    this._graphicsCore = new h({\n      owner: this,\n      layer: this.layer,\n      preferredUpdatePolicy: 0,\n      elevationFeatureExpressionEnabled: !1,\n      graphicSymbolSupported: !1,\n      getRenderingInfoWithoutRenderer: !0,\n      hasZ: !0,\n      hasM: !1\n    });\n    const e = this.view.basemapTerrain;\n    this._scaleVisibility = new n({\n      layerScaleEnabled: !1\n    }), this._scaleVisibility.setup(this, this.layer, (e, i, r) => this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e, i, r), this._graphicsCore, e);\n    const i = this.view.labeler.addGraphicsOwner(this._graphicsCore, this._scaleVisibility, {\n      emptySymbolLabelSupported: !0,\n      elevationInfoOverride: {\n        mode: \"absolute-height\",\n        offset: 0\n      },\n      disablePlacement: {\n        logEntityDescription: \"3D Object Scene Layer features\"\n      }\n    }),\n          r = this.view.deconflictor.addGraphicsOwner(this._graphicsCore);\n    this._graphicsCore.setup({\n      labeler: i,\n      deconflictor: r,\n      scaleVisibility: this._scaleVisibility\n    }).then(() => {\n      this._graphicsCore.startCreateGraphics();\n    }).catch(() => {}), this._handles.add([this.layer.watch(\"labelingInfo\", (e, i) => {\n      l(e, i) && this._graphicsCore.updateLabelingInfo();\n    })]);\n  }\n\n  destroy() {\n    this._handles && (this._handles.destroy(), this._handles = null), null != this._scaleVisibility && (this._scaleVisibility.destroy(), this._scaleVisibility = null), null != this._graphicsCore && (this._graphicsCore.destroy(), this._graphicsCore = null), this.loadedGraphics.destroy(), this.view = null;\n  }\n\n  addNodeMeta(e, r) {\n    let s = 0;\n    const o = e.filteredIds,\n          a = e.featureIds.map((a, l) => {\n      d(l, this.collection, e.objectHandle, f);\n      const p = c(0, 0, 0, this.view.spatialReference);\n      this.view.renderCoordsHelper.fromRenderCoords(f, p);\n      const h = r(l, e);\n      let n = !1;\n      return t(o) ? n = !0 : s < o.length && a === o[s] && (n = !0, s++), {\n        objectId: a,\n        uid: i.generateUID(),\n        attributes: h,\n        visible: n,\n        geometry: p\n      };\n    });\n    this.loadedGraphics.addMany(a), this._graphicsByNode.set(e.node.index, a);\n  }\n\n  setNodeMetaAttributes(e, i) {\n    const r = this._graphicsByNode.get(e.node.index),\n          s = new Array(r.length);\n\n    for (let t = 0; t < r.length; t++) {\n      const o = r[t];\n      o.attributes = i(t, e), s[t] = o.uid;\n    }\n\n    this._graphicsCore.updateLabelingInfo(s);\n  }\n\n  applyFilterChange(e) {\n    const i = this._graphicsByNode.get(e.node.index);\n\n    if (i) if (t(e.filteredIds)) for (const r of i) r.visible || (r.visible = !0, m.graphic = r, m.property = \"visible\", m.oldValue = !1, m.newValue = !0, this._graphicsCore.graphicUpdateHandler(m));else {\n      let r = 0;\n\n      for (const s of i) {\n        const i = s.visible;\n        r < e.filteredIds.length && s.objectId === e.filteredIds[r] ? (s.visible = !0, r++) : s.visible = !1, i !== s.visible && (m.graphic = s, m.property = \"visible\", m.oldValue = i, m.newValue = s.visible, this._graphicsCore.graphicUpdateHandler(m));\n      }\n    }\n  }\n\n  removeNodeMeta(e) {\n    this.loadedGraphics.removeManyByObjectId(e.featureIds);\n  }\n\n  getRenderingInfo() {\n    return this._renderingInfo;\n  }\n\n  notifyGraphicGeometryChanged() {}\n\n  notifyGraphicVisibilityChanged() {}\n\n  get updatePolicy() {\n    return this._graphicsCore.effectiveUpdatePolicy;\n  }\n\n  get usedMemory() {\n    return this._graphicsCore.usedMemory;\n  }\n\n  get unloadedMemoryEstimate() {\n    return this._graphicsCore.unprocessedMemoryEstimate;\n  }\n\n  get test() {\n    return {\n      graphicsCore: this._graphicsCore\n    };\n  }\n\n};\ne([o()], u.prototype, \"view\", void 0), e([o()], u.prototype, \"layer\", void 0), e([o()], u.prototype, \"collection\", void 0), e([o()], u.prototype, \"loadedGraphics\", void 0), e([o({\n  aliasOf: \"_graphicsCore.updating\"\n})], u.prototype, \"updating\", void 0), e([o()], u.prototype, \"slicePlaneEnabled\", void 0), e([o()], u.prototype, \"_graphicsCore\", void 0), u = e([a(\"esri.views.3d.layers.I3SMeshViewLabeler\")], u);\nconst m = {\n  graphic: null,\n  property: null,\n  oldValue: null,\n  newValue: null\n},\n      f = p();\nvar b = u;\nexport default b;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/I3SMeshViewLabeler.js"],"names":["_","e","i","r","s","isNone","t","property","o","subclass","a","diff","l","c","p","makeDehydratedPoint","Graphics3DCore","h","n","boundingBoxTop","d","LimitGraphicsMap","y","g","u","constructor","loadedGraphics","slicePlaneEnabled","_renderingInfo","symbol","_handles","_graphicsByNode","Map","_scaleVisibility","initialize","_graphicsCore","owner","layer","preferredUpdatePolicy","elevationFeatureExpressionEnabled","graphicSymbolSupported","getRenderingInfoWithoutRenderer","hasZ","hasM","view","basemapTerrain","layerScaleEnabled","setup","spatialIndex","queryGraphicUIDsInExtent","labeler","addGraphicsOwner","emptySymbolLabelSupported","elevationInfoOverride","mode","offset","disablePlacement","logEntityDescription","deconflictor","scaleVisibility","then","startCreateGraphics","catch","add","watch","updateLabelingInfo","destroy","addNodeMeta","filteredIds","featureIds","map","collection","objectHandle","f","spatialReference","renderCoordsHelper","fromRenderCoords","length","objectId","uid","generateUID","attributes","visible","geometry","addMany","set","node","index","setNodeMetaAttributes","get","Array","applyFilterChange","m","graphic","oldValue","newValue","graphicUpdateHandler","removeNodeMeta","removeManyByObjectId","getRenderingInfo","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","updatePolicy","effectiveUpdatePolicy","usedMemory","unloadedMemoryEstimate","unprocessedMemoryEstimate","test","graphicsCore","prototype","aliasOf","b"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import i from\"../../../Graphic.js\";import\"../../../symbols.js\";import r from\"../../../core/Accessor.js\";import s from\"../../../core/Handles.js\";import{isNone as t}from\"../../../core/maybe.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{diff as l}from\"../../../core/accessorSupport/diffUtils.js\";import{c as p}from\"../../../chunks/vec3f64.js\";import{makeDehydratedPoint as c}from\"../../../layers/graphics/dehydratedFeatures.js\";import{Graphics3DCore as h}from\"./graphics/Graphics3DCore.js\";import n from\"./graphics/Graphics3DScaleVisibility.js\";import{boundingBoxTop as d}from\"./i3s/I3SGeometryUtil.js\";import{LimitGraphicsMap as y}from\"../support/LimitGraphicsMap.js\";import g from\"../../../symbols/PointSymbol3D.js\";let u=class extends r{constructor(e){super(e),this.loadedGraphics=new y(5e4),this.slicePlaneEnabled=!1,this._renderingInfo={symbol:new g},this._handles=new s,this._graphicsByNode=new Map,this._scaleVisibility=null}initialize(){this._graphicsCore=new h({owner:this,layer:this.layer,preferredUpdatePolicy:0,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});const e=this.view.basemapTerrain;this._scaleVisibility=new n({layerScaleEnabled:!1}),this._scaleVisibility.setup(this,this.layer,((e,i,r)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,i,r)),this._graphicsCore,e);const i=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:\"absolute-height\",offset:0},disablePlacement:{logEntityDescription:\"3D Object Scene Layer features\"}}),r=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:i,deconflictor:r,scaleVisibility:this._scaleVisibility}).then((()=>{this._graphicsCore.startCreateGraphics()})).catch((()=>{})),this._handles.add([this.layer.watch(\"labelingInfo\",((e,i)=>{l(e,i)&&this._graphicsCore.updateLabelingInfo()}))])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null),null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=null),null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null),this.loadedGraphics.destroy(),this.view=null}addNodeMeta(e,r){let s=0;const o=e.filteredIds,a=e.featureIds.map(((a,l)=>{d(l,this.collection,e.objectHandle,f);const p=c(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(f,p);const h=r(l,e);let n=!1;return t(o)?n=!0:s<o.length&&a===o[s]&&(n=!0,s++),{objectId:a,uid:i.generateUID(),attributes:h,visible:n,geometry:p}}));this.loadedGraphics.addMany(a),this._graphicsByNode.set(e.node.index,a)}setNodeMetaAttributes(e,i){const r=this._graphicsByNode.get(e.node.index),s=new Array(r.length);for(let t=0;t<r.length;t++){const o=r[t];o.attributes=i(t,e),s[t]=o.uid}this._graphicsCore.updateLabelingInfo(s)}applyFilterChange(e){const i=this._graphicsByNode.get(e.node.index);if(i)if(t(e.filteredIds))for(const r of i)r.visible||(r.visible=!0,m.graphic=r,m.property=\"visible\",m.oldValue=!1,m.newValue=!0,this._graphicsCore.graphicUpdateHandler(m));else{let r=0;for(const s of i){const i=s.visible;r<e.filteredIds.length&&s.objectId===e.filteredIds[r]?(s.visible=!0,r++):s.visible=!1,i!==s.visible&&(m.graphic=s,m.property=\"visible\",m.oldValue=i,m.newValue=s.visible,this._graphicsCore.graphicUpdateHandler(m))}}}removeNodeMeta(e){this.loadedGraphics.removeManyByObjectId(e.featureIds)}getRenderingInfo(){return this._renderingInfo}notifyGraphicGeometryChanged(){}notifyGraphicVisibilityChanged(){}get updatePolicy(){return this._graphicsCore.effectiveUpdatePolicy}get usedMemory(){return this._graphicsCore.usedMemory}get unloadedMemoryEstimate(){return this._graphicsCore.unprocessedMemoryEstimate}get test(){return{graphicsCore:this._graphicsCore}}};e([o()],u.prototype,\"view\",void 0),e([o()],u.prototype,\"layer\",void 0),e([o()],u.prototype,\"collection\",void 0),e([o()],u.prototype,\"loadedGraphics\",void 0),e([o({aliasOf:\"_graphicsCore.updating\"})],u.prototype,\"updating\",void 0),e([o()],u.prototype,\"slicePlaneEnabled\",void 0),e([o()],u.prototype,\"_graphicsCore\",void 0),u=e([a(\"esri.views.3d.layers.I3SMeshViewLabeler\")],u);const m={graphic:null,property:null,oldValue:null,newValue:null},f=p();var b=u;export default b;\n"]},"metadata":{},"sourceType":"module"}