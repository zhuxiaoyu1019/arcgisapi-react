{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { neverReached as e } from \"../../../../core/compilerUtils.js\";\nimport { unwrapOr as t } from \"../../../../core/maybe.js\";\nimport { d as n } from \"../../../../chunks/mat4.js\";\nimport { c as o } from \"../../../../chunks/mat4f64.js\";\nimport { c as r } from \"../../../../chunks/vec3f64.js\";\nimport { projectBuffer as i, computeLinearTransformation as s } from \"../../../../geometry/projection.js\";\nimport { isDehydratedPoint as a } from \"../../../../layers/graphics/dehydratedFeatureUtils.js\";\nimport { updateVertexAttributeAuxpos1w as l } from \"./graphicUtils.js\";\nimport { isSamplePosition as c, getElevationAtPoint as u } from \"../../support/ElevationProvider.js\";\n\nfunction f(e, t, n, o, r, s, a, l, c, u, f) {\n  const m = j[f.mode];\n  let d,\n      p,\n      g = 0;\n  if (i(e, t, n, o, c.spatialReference, r, l)) return m.requiresAlignment(f) ? (g = m.applyElevationAlignmentBuffer(o, r, s, a, l, c, u, f), d = s, p = a) : (d = o, p = r), i(d, c.spatialReference, p, s, u.spatialReference, a, l) ? g : void 0;\n}\n\nfunction m(n, o, r, i, s) {\n  const l = (a(n) ? n.z : c(n) ? n.array[n.offset + 2] : n[2]) || 0;\n\n  switch (r.mode) {\n    case \"on-the-ground\":\n      {\n        const e = t(u(o, n, \"ground\"), 0);\n        return s && (s.verticalDistanceToGround = 0, s.sampledElevation = e), e;\n      }\n\n    case \"relative-to-ground\":\n      {\n        const e = t(u(o, n, \"ground\"), 0),\n              a = r.geometryZWithOffset(l, i);\n        return s && (s.verticalDistanceToGround = a, s.sampledElevation = e), a + e;\n      }\n\n    case \"relative-to-scene\":\n      {\n        const e = t(u(o, n, \"scene\"), 0),\n              a = r.geometryZWithOffset(l, i);\n        return s && (s.verticalDistanceToGround = a, s.sampledElevation = e), a + e;\n      }\n\n    case \"absolute-height\":\n      {\n        const e = r.geometryZWithOffset(l, i);\n\n        if (s) {\n          const r = t(u(o, n, \"ground\"), 0);\n          s.verticalDistanceToGround = e - r, s.sampledElevation = r;\n        }\n\n        return e;\n      }\n\n    default:\n      return e(r.mode), 0;\n  }\n}\n\nfunction d(e, t, n) {\n  return null == t || null == n ? e.definedChanged : \"on-the-ground\" === t && \"on-the-ground\" === n ? e.staysOnTheGround : t === n || \"on-the-ground\" !== t && \"on-the-ground\" !== n ? T.UPDATE : e.onTheGroundChanged;\n}\n\nfunction p(e) {\n  return \"relative-to-ground\" === e || \"relative-to-scene\" === e;\n}\n\nfunction g(e) {\n  return \"absolute-height\" !== e;\n}\n\nfunction v(e, t, o, r, i) {\n  const a = m(t, o, i, r, O);\n  l(e, O.verticalDistanceToGround);\n  const c = O.sampledElevation,\n        u = n(x, e.transformation);\n  U[0] = t.x, U[1] = t.y, U[2] = a;\n  return s(t.spatialReference, U, u, r.spatialReference) ? e.transformation = u : console.warn(\"Could not locate symbol object properly, it might be misplaced\"), c;\n}\n\nfunction E(e, n, o, r, i, s) {\n  let a = 0;\n  const l = s.spatialReference;\n  n *= 3, r *= 3;\n\n  for (let c = 0; c < i; ++c) {\n    const i = e[n + 0],\n          c = e[n + 1],\n          u = e[n + 2],\n          f = t(s.getElevation(i, c, u, l, \"ground\"), 0);\n    a += f, o[r + 0] = i, o[r + 1] = c, o[r + 2] = f, n += 3, r += 3;\n  }\n\n  return a / i;\n}\n\nfunction h(e, n, o, r, i, s, a, l) {\n  let c = 0;\n  const u = l.calculateOffsetRenderUnits(a),\n        f = l.featureExpressionInfoContext,\n        m = s.spatialReference;\n  n *= 3, r *= 3;\n\n  for (let d = 0; d < i; ++d) {\n    const i = e[n + 0],\n          a = e[n + 1],\n          l = e[n + 2],\n          d = t(s.getElevation(i, a, l, m, \"ground\"), 0);\n    c += d, o[r + 0] = i, o[r + 1] = a, o[r + 2] = null == f ? l + d + u : d + u, n += 3, r += 3;\n  }\n\n  return c / i;\n}\n\nfunction y(e, n, o, r, i, s, a, l) {\n  let c = 0;\n  const u = l.calculateOffsetRenderUnits(a),\n        f = l.featureExpressionInfoContext,\n        m = s.spatialReference;\n  n *= 3, r *= 3;\n\n  for (let d = 0; d < i; ++d) {\n    const i = e[n + 0],\n          a = e[n + 1],\n          l = e[n + 2],\n          d = t(s.getElevation(i, a, l, m, \"scene\"), 0);\n    c += d, o[r + 0] = i, o[r + 1] = a, o[r + 2] = null == f ? l + d + u : d + u, n += 3, r += 3;\n  }\n\n  return c / i;\n}\n\nfunction A(e) {\n  const t = e.meterUnitOffset,\n        n = e.featureExpressionInfoContext;\n  return 0 !== t || null != n;\n}\n\nfunction R(e, t, n, o, r, i, s, a) {\n  const l = a.calculateOffsetRenderUnits(s),\n        c = a.featureExpressionInfoContext;\n  t *= 3, o *= 3;\n\n  for (let u = 0; u < r; ++u) {\n    const r = e[t + 0],\n          i = e[t + 1],\n          s = e[t + 2];\n    n[o + 0] = r, n[o + 1] = i, n[o + 2] = null == c ? s + l : l, t += 3, o += 3;\n  }\n\n  return 0;\n}\n\nvar T;\n!function (e) {\n  e[e.NONE = 0] = \"NONE\", e[e.UPDATE = 1] = \"UPDATE\", e[e.RECREATE = 2] = \"RECREATE\";\n}(T || (T = {}));\nconst j = {\n  \"absolute-height\": {\n    applyElevationAlignmentBuffer: R,\n    requiresAlignment: A\n  },\n  \"on-the-ground\": {\n    applyElevationAlignmentBuffer: E,\n    requiresAlignment: () => !0\n  },\n  \"relative-to-ground\": {\n    applyElevationAlignmentBuffer: h,\n    requiresAlignment: () => !0\n  },\n  \"relative-to-scene\": {\n    applyElevationAlignmentBuffer: y,\n    requiresAlignment: () => !0\n  }\n},\n      x = o(),\n      O = {\n  verticalDistanceToGround: 0,\n  sampledElevation: 0\n},\n      U = r();\nexport { T as SymbolUpdateType, v as applyElevationAlignmentForHUD, f as applyPerVertexElevationAlignment, d as elevationModeChangeUpdateType, m as evaluateElevationAlignmentAtPoint, p as needsElevationUpdates2D, g as needsElevationUpdates3D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/elevationAlignmentUtils.js"],"names":["neverReached","e","unwrapOr","t","d","n","c","o","r","projectBuffer","i","computeLinearTransformation","s","isDehydratedPoint","a","updateVertexAttributeAuxpos1w","l","isSamplePosition","getElevationAtPoint","u","f","m","j","mode","p","g","spatialReference","requiresAlignment","applyElevationAlignmentBuffer","z","array","offset","verticalDistanceToGround","sampledElevation","geometryZWithOffset","definedChanged","staysOnTheGround","T","UPDATE","onTheGroundChanged","v","O","x","transformation","U","y","console","warn","E","getElevation","h","calculateOffsetRenderUnits","featureExpressionInfoContext","A","meterUnitOffset","R","NONE","RECREATE","SymbolUpdateType","applyElevationAlignmentForHUD","applyPerVertexElevationAlignment","elevationModeChangeUpdateType","evaluateElevationAlignmentAtPoint","needsElevationUpdates2D","needsElevationUpdates3D"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,YAAY,IAAIC,CAAvB,QAA6B,mCAA7B;AAAiE,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,2BAAzB;AAAqD,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOD,CAAC,IAAIE,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOC,aAAa,IAAIC,CAAxB,EAA0BC,2BAA2B,IAAIC,CAAzD,QAA+D,oCAA/D;AAAoG,SAAOC,iBAAiB,IAAIC,CAA5B,QAAkC,uDAAlC;AAA0F,SAAOC,6BAA6B,IAAIC,CAAxC,QAA8C,mBAA9C;AAAkE,SAAOC,gBAAgB,IAAIX,CAA3B,EAA6BY,mBAAmB,IAAIC,CAApD,QAA0D,oCAA1D;;AAA+F,SAASC,CAAT,CAAWnB,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBE,CAAjB,EAAmBC,CAAnB,EAAqBI,CAArB,EAAuBE,CAAvB,EAAyBE,CAAzB,EAA2BV,CAA3B,EAA6Ba,CAA7B,EAA+BC,CAA/B,EAAiC;AAAC,QAAMC,CAAC,GAACC,CAAC,CAACF,CAAC,CAACG,IAAH,CAAT;AAAkB,MAAInB,CAAJ;AAAA,MAAMoB,CAAN;AAAA,MAAQC,CAAC,GAAC,CAAV;AAAY,MAAGf,CAAC,CAACT,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASD,CAAC,CAACoB,gBAAX,EAA4BlB,CAA5B,EAA8BQ,CAA9B,CAAJ,EAAqC,OAAOK,CAAC,CAACM,iBAAF,CAAoBP,CAApB,KAAwBK,CAAC,GAACJ,CAAC,CAACO,6BAAF,CAAgCrB,CAAhC,EAAkCC,CAAlC,EAAoCI,CAApC,EAAsCE,CAAtC,EAAwCE,CAAxC,EAA0CV,CAA1C,EAA4Ca,CAA5C,EAA8CC,CAA9C,CAAF,EAAmDhB,CAAC,GAACQ,CAArD,EAAuDY,CAAC,GAACV,CAAjF,KAAqFV,CAAC,GAACG,CAAF,EAAIiB,CAAC,GAAChB,CAA3F,GAA8FE,CAAC,CAACN,CAAD,EAAGE,CAAC,CAACoB,gBAAL,EAAsBF,CAAtB,EAAwBZ,CAAxB,EAA0BO,CAAC,CAACO,gBAA5B,EAA6CZ,CAA7C,EAA+CE,CAA/C,CAAD,GAAmDS,CAAnD,GAAqD,KAAK,CAA/J;AAAiK;;AAAA,SAASJ,CAAT,CAAWhB,CAAX,EAAaE,CAAb,EAAeC,CAAf,EAAiBE,CAAjB,EAAmBE,CAAnB,EAAqB;AAAC,QAAMI,CAAC,GAAC,CAACF,CAAC,CAACT,CAAD,CAAD,GAAKA,CAAC,CAACwB,CAAP,GAASvB,CAAC,CAACD,CAAD,CAAD,GAAKA,CAAC,CAACyB,KAAF,CAAQzB,CAAC,CAAC0B,MAAF,GAAS,CAAjB,CAAL,GAAyB1B,CAAC,CAAC,CAAD,CAApC,KAA0C,CAAlD;;AAAoD,UAAOG,CAAC,CAACe,IAAT;AAAe,SAAI,eAAJ;AAAoB;AAAC,cAAMtB,CAAC,GAACE,CAAC,CAACgB,CAAC,CAACZ,CAAD,EAAGF,CAAH,EAAK,QAAL,CAAF,EAAiB,CAAjB,CAAT;AAA6B,eAAOO,CAAC,KAAGA,CAAC,CAACoB,wBAAF,GAA2B,CAA3B,EAA6BpB,CAAC,CAACqB,gBAAF,GAAmBhC,CAAnD,CAAD,EAAuDA,CAA9D;AAAgE;;AAAA,SAAI,oBAAJ;AAAyB;AAAC,cAAMA,CAAC,GAACE,CAAC,CAACgB,CAAC,CAACZ,CAAD,EAAGF,CAAH,EAAK,QAAL,CAAF,EAAiB,CAAjB,CAAT;AAAA,cAA6BS,CAAC,GAACN,CAAC,CAAC0B,mBAAF,CAAsBlB,CAAtB,EAAwBN,CAAxB,CAA/B;AAA0D,eAAOE,CAAC,KAAGA,CAAC,CAACoB,wBAAF,GAA2BlB,CAA3B,EAA6BF,CAAC,CAACqB,gBAAF,GAAmBhC,CAAnD,CAAD,EAAuDa,CAAC,GAACb,CAAhE;AAAkE;;AAAA,SAAI,mBAAJ;AAAwB;AAAC,cAAMA,CAAC,GAACE,CAAC,CAACgB,CAAC,CAACZ,CAAD,EAAGF,CAAH,EAAK,OAAL,CAAF,EAAgB,CAAhB,CAAT;AAAA,cAA4BS,CAAC,GAACN,CAAC,CAAC0B,mBAAF,CAAsBlB,CAAtB,EAAwBN,CAAxB,CAA9B;AAAyD,eAAOE,CAAC,KAAGA,CAAC,CAACoB,wBAAF,GAA2BlB,CAA3B,EAA6BF,CAAC,CAACqB,gBAAF,GAAmBhC,CAAnD,CAAD,EAAuDa,CAAC,GAACb,CAAhE;AAAkE;;AAAA,SAAI,iBAAJ;AAAsB;AAAC,cAAMA,CAAC,GAACO,CAAC,CAAC0B,mBAAF,CAAsBlB,CAAtB,EAAwBN,CAAxB,CAAR;;AAAmC,YAAGE,CAAH,EAAK;AAAC,gBAAMJ,CAAC,GAACL,CAAC,CAACgB,CAAC,CAACZ,CAAD,EAAGF,CAAH,EAAK,QAAL,CAAF,EAAiB,CAAjB,CAAT;AAA6BO,UAAAA,CAAC,CAACoB,wBAAF,GAA2B/B,CAAC,GAACO,CAA7B,EAA+BI,CAAC,CAACqB,gBAAF,GAAmBzB,CAAlD;AAAoD;;AAAA,eAAOP,CAAP;AAAS;;AAAA;AAAQ,aAAOA,CAAC,CAACO,CAAC,CAACe,IAAH,CAAD,EAAU,CAAjB;AAA7kB;AAAimB;;AAAA,SAASnB,CAAT,CAAWH,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,SAAO,QAAMF,CAAN,IAAS,QAAME,CAAf,GAAiBJ,CAAC,CAACkC,cAAnB,GAAkC,oBAAkBhC,CAAlB,IAAqB,oBAAkBE,CAAvC,GAAyCJ,CAAC,CAACmC,gBAA3C,GAA4DjC,CAAC,KAAGE,CAAJ,IAAO,oBAAkBF,CAAlB,IAAqB,oBAAkBE,CAA9C,GAAgDgC,CAAC,CAACC,MAAlD,GAAyDrC,CAAC,CAACsC,kBAAhK;AAAmL;;AAAA,SAASf,CAAT,CAAWvB,CAAX,EAAa;AAAC,SAAM,yBAAuBA,CAAvB,IAA0B,wBAAsBA,CAAtD;AAAwD;;AAAA,SAASwB,CAAT,CAAWxB,CAAX,EAAa;AAAC,SAAM,sBAAoBA,CAA1B;AAA4B;;AAAA,SAASuC,CAAT,CAAWvC,CAAX,EAAaE,CAAb,EAAeI,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqB;AAAC,QAAMI,CAAC,GAACO,CAAC,CAAClB,CAAD,EAAGI,CAAH,EAAKG,CAAL,EAAOF,CAAP,EAASiC,CAAT,CAAT;AAAqBzB,EAAAA,CAAC,CAACf,CAAD,EAAGwC,CAAC,CAACT,wBAAL,CAAD;AAAgC,QAAM1B,CAAC,GAACmC,CAAC,CAACR,gBAAV;AAAA,QAA2Bd,CAAC,GAACd,CAAC,CAACqC,CAAD,EAAGzC,CAAC,CAAC0C,cAAL,CAA9B;AAAmDC,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAKzC,CAAC,CAACuC,CAAP,EAASE,CAAC,CAAC,CAAD,CAAD,GAAKzC,CAAC,CAAC0C,CAAhB,EAAkBD,CAAC,CAAC,CAAD,CAAD,GAAK9B,CAAvB;AAAyB,SAAOF,CAAC,CAACT,CAAC,CAACuB,gBAAH,EAAoBkB,CAApB,EAAsBzB,CAAtB,EAAwBX,CAAC,CAACkB,gBAA1B,CAAD,GAA6CzB,CAAC,CAAC0C,cAAF,GAAiBxB,CAA9D,GAAgE2B,OAAO,CAACC,IAAR,CAAa,gEAAb,CAAhE,EAA+IzC,CAAtJ;AAAwJ;;AAAA,SAAS0C,CAAT,CAAW/C,CAAX,EAAaI,CAAb,EAAeE,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqBE,CAArB,EAAuB;AAAC,MAAIE,CAAC,GAAC,CAAN;AAAQ,QAAME,CAAC,GAACJ,CAAC,CAACc,gBAAV;AAA2BrB,EAAAA,CAAC,IAAE,CAAH,EAAKG,CAAC,IAAE,CAAR;;AAAU,OAAI,IAAIF,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACI,CAAd,EAAgB,EAAEJ,CAAlB,EAAoB;AAAC,UAAMI,CAAC,GAACT,CAAC,CAACI,CAAC,GAAC,CAAH,CAAT;AAAA,UAAeC,CAAC,GAACL,CAAC,CAACI,CAAC,GAAC,CAAH,CAAlB;AAAA,UAAwBc,CAAC,GAAClB,CAAC,CAACI,CAAC,GAAC,CAAH,CAA3B;AAAA,UAAiCe,CAAC,GAACjB,CAAC,CAACS,CAAC,CAACqC,YAAF,CAAevC,CAAf,EAAiBJ,CAAjB,EAAmBa,CAAnB,EAAqBH,CAArB,EAAuB,QAAvB,CAAD,EAAkC,CAAlC,CAApC;AAAyEF,IAAAA,CAAC,IAAEM,CAAH,EAAKb,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOE,CAAZ,EAAcH,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOF,CAArB,EAAuBC,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOY,CAA9B,EAAgCf,CAAC,IAAE,CAAnC,EAAqCG,CAAC,IAAE,CAAxC;AAA0C;;AAAA,SAAOM,CAAC,GAACJ,CAAT;AAAW;;AAAA,SAASwC,CAAT,CAAWjD,CAAX,EAAaI,CAAb,EAAeE,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB,EAAyBE,CAAzB,EAA2B;AAAC,MAAIV,CAAC,GAAC,CAAN;AAAQ,QAAMa,CAAC,GAACH,CAAC,CAACmC,0BAAF,CAA6BrC,CAA7B,CAAR;AAAA,QAAwCM,CAAC,GAACJ,CAAC,CAACoC,4BAA5C;AAAA,QAAyE/B,CAAC,GAACT,CAAC,CAACc,gBAA7E;AAA8FrB,EAAAA,CAAC,IAAE,CAAH,EAAKG,CAAC,IAAE,CAAR;;AAAU,OAAI,IAAIJ,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACM,CAAd,EAAgB,EAAEN,CAAlB,EAAoB;AAAC,UAAMM,CAAC,GAACT,CAAC,CAACI,CAAC,GAAC,CAAH,CAAT;AAAA,UAAeS,CAAC,GAACb,CAAC,CAACI,CAAC,GAAC,CAAH,CAAlB;AAAA,UAAwBW,CAAC,GAACf,CAAC,CAACI,CAAC,GAAC,CAAH,CAA3B;AAAA,UAAiCD,CAAC,GAACD,CAAC,CAACS,CAAC,CAACqC,YAAF,CAAevC,CAAf,EAAiBI,CAAjB,EAAmBE,CAAnB,EAAqBK,CAArB,EAAuB,QAAvB,CAAD,EAAkC,CAAlC,CAApC;AAAyEf,IAAAA,CAAC,IAAEF,CAAH,EAAKG,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOE,CAAZ,EAAcH,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOM,CAArB,EAAuBP,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAO,QAAMY,CAAN,GAAQJ,CAAC,GAACZ,CAAF,GAAIe,CAAZ,GAAcf,CAAC,GAACe,CAA9C,EAAgDd,CAAC,IAAE,CAAnD,EAAqDG,CAAC,IAAE,CAAxD;AAA0D;;AAAA,SAAOF,CAAC,GAACI,CAAT;AAAW;;AAAA,SAASmC,CAAT,CAAW5C,CAAX,EAAaI,CAAb,EAAeE,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB,EAAyBE,CAAzB,EAA2B;AAAC,MAAIV,CAAC,GAAC,CAAN;AAAQ,QAAMa,CAAC,GAACH,CAAC,CAACmC,0BAAF,CAA6BrC,CAA7B,CAAR;AAAA,QAAwCM,CAAC,GAACJ,CAAC,CAACoC,4BAA5C;AAAA,QAAyE/B,CAAC,GAACT,CAAC,CAACc,gBAA7E;AAA8FrB,EAAAA,CAAC,IAAE,CAAH,EAAKG,CAAC,IAAE,CAAR;;AAAU,OAAI,IAAIJ,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACM,CAAd,EAAgB,EAAEN,CAAlB,EAAoB;AAAC,UAAMM,CAAC,GAACT,CAAC,CAACI,CAAC,GAAC,CAAH,CAAT;AAAA,UAAeS,CAAC,GAACb,CAAC,CAACI,CAAC,GAAC,CAAH,CAAlB;AAAA,UAAwBW,CAAC,GAACf,CAAC,CAACI,CAAC,GAAC,CAAH,CAA3B;AAAA,UAAiCD,CAAC,GAACD,CAAC,CAACS,CAAC,CAACqC,YAAF,CAAevC,CAAf,EAAiBI,CAAjB,EAAmBE,CAAnB,EAAqBK,CAArB,EAAuB,OAAvB,CAAD,EAAiC,CAAjC,CAApC;AAAwEf,IAAAA,CAAC,IAAEF,CAAH,EAAKG,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOE,CAAZ,EAAcH,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAOM,CAArB,EAAuBP,CAAC,CAACC,CAAC,GAAC,CAAH,CAAD,GAAO,QAAMY,CAAN,GAAQJ,CAAC,GAACZ,CAAF,GAAIe,CAAZ,GAAcf,CAAC,GAACe,CAA9C,EAAgDd,CAAC,IAAE,CAAnD,EAAqDG,CAAC,IAAE,CAAxD;AAA0D;;AAAA,SAAOF,CAAC,GAACI,CAAT;AAAW;;AAAA,SAAS2C,CAAT,CAAWpD,CAAX,EAAa;AAAC,QAAME,CAAC,GAACF,CAAC,CAACqD,eAAV;AAAA,QAA0BjD,CAAC,GAACJ,CAAC,CAACmD,4BAA9B;AAA2D,SAAO,MAAIjD,CAAJ,IAAO,QAAME,CAApB;AAAsB;;AAAA,SAASkD,CAAT,CAAWtD,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBE,CAAjB,EAAmBC,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB,EAAyBE,CAAzB,EAA2B;AAAC,QAAME,CAAC,GAACF,CAAC,CAACqC,0BAAF,CAA6BvC,CAA7B,CAAR;AAAA,QAAwCN,CAAC,GAACQ,CAAC,CAACsC,4BAA5C;AAAyEjD,EAAAA,CAAC,IAAE,CAAH,EAAKI,CAAC,IAAE,CAAR;;AAAU,OAAI,IAAIY,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACX,CAAd,EAAgB,EAAEW,CAAlB,EAAoB;AAAC,UAAMX,CAAC,GAACP,CAAC,CAACE,CAAC,GAAC,CAAH,CAAT;AAAA,UAAeO,CAAC,GAACT,CAAC,CAACE,CAAC,GAAC,CAAH,CAAlB;AAAA,UAAwBS,CAAC,GAACX,CAAC,CAACE,CAAC,GAAC,CAAH,CAA3B;AAAiCE,IAAAA,CAAC,CAACE,CAAC,GAAC,CAAH,CAAD,GAAOC,CAAP,EAASH,CAAC,CAACE,CAAC,GAAC,CAAH,CAAD,GAAOG,CAAhB,EAAkBL,CAAC,CAACE,CAAC,GAAC,CAAH,CAAD,GAAO,QAAMD,CAAN,GAAQM,CAAC,GAACI,CAAV,GAAYA,CAArC,EAAuCb,CAAC,IAAE,CAA1C,EAA4CI,CAAC,IAAE,CAA/C;AAAiD;;AAAA,SAAO,CAAP;AAAS;;AAAA,IAAI8B,CAAJ;AAAM,CAAC,UAASpC,CAAT,EAAW;AAACA,EAAAA,CAAC,CAACA,CAAC,CAACuD,IAAF,GAAO,CAAR,CAAD,GAAY,MAAZ,EAAmBvD,CAAC,CAACA,CAAC,CAACqC,MAAF,GAAS,CAAV,CAAD,GAAc,QAAjC,EAA0CrC,CAAC,CAACA,CAAC,CAACwD,QAAF,GAAW,CAAZ,CAAD,GAAgB,UAA1D;AAAqE,CAAjF,CAAkFpB,CAAC,KAAGA,CAAC,GAAC,EAAL,CAAnF,CAAD;AAA8F,MAAMf,CAAC,GAAC;AAAC,qBAAkB;AAACM,IAAAA,6BAA6B,EAAC2B,CAA/B;AAAiC5B,IAAAA,iBAAiB,EAAC0B;AAAnD,GAAnB;AAAyE,mBAAgB;AAACzB,IAAAA,6BAA6B,EAACoB,CAA/B;AAAiCrB,IAAAA,iBAAiB,EAAC,MAAI,CAAC;AAAxD,GAAzF;AAAoJ,wBAAqB;AAACC,IAAAA,6BAA6B,EAACsB,CAA/B;AAAiCvB,IAAAA,iBAAiB,EAAC,MAAI,CAAC;AAAxD,GAAzK;AAAoO,uBAAoB;AAACC,IAAAA,6BAA6B,EAACiB,CAA/B;AAAiClB,IAAAA,iBAAiB,EAAC,MAAI,CAAC;AAAxD;AAAxP,CAAR;AAAA,MAA4Te,CAAC,GAACnC,CAAC,EAA/T;AAAA,MAAkUkC,CAAC,GAAC;AAACT,EAAAA,wBAAwB,EAAC,CAA1B;AAA4BC,EAAAA,gBAAgB,EAAC;AAA7C,CAApU;AAAA,MAAoXW,CAAC,GAACpC,CAAC,EAAvX;AAA0X,SAAO6B,CAAC,IAAIqB,gBAAZ,EAA6BlB,CAAC,IAAImB,6BAAlC,EAAgEvC,CAAC,IAAIwC,gCAArE,EAAsGxD,CAAC,IAAIyD,6BAA3G,EAAyIxC,CAAC,IAAIyC,iCAA9I,EAAgLtC,CAAC,IAAIuC,uBAArL,EAA6MtC,CAAC,IAAIuC,uBAAlN","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{neverReached as e}from\"../../../../core/compilerUtils.js\";import{unwrapOr as t}from\"../../../../core/maybe.js\";import{d as n}from\"../../../../chunks/mat4.js\";import{c as o}from\"../../../../chunks/mat4f64.js\";import{c as r}from\"../../../../chunks/vec3f64.js\";import{projectBuffer as i,computeLinearTransformation as s}from\"../../../../geometry/projection.js\";import{isDehydratedPoint as a}from\"../../../../layers/graphics/dehydratedFeatureUtils.js\";import{updateVertexAttributeAuxpos1w as l}from\"./graphicUtils.js\";import{isSamplePosition as c,getElevationAtPoint as u}from\"../../support/ElevationProvider.js\";function f(e,t,n,o,r,s,a,l,c,u,f){const m=j[f.mode];let d,p,g=0;if(i(e,t,n,o,c.spatialReference,r,l))return m.requiresAlignment(f)?(g=m.applyElevationAlignmentBuffer(o,r,s,a,l,c,u,f),d=s,p=a):(d=o,p=r),i(d,c.spatialReference,p,s,u.spatialReference,a,l)?g:void 0}function m(n,o,r,i,s){const l=(a(n)?n.z:c(n)?n.array[n.offset+2]:n[2])||0;switch(r.mode){case\"on-the-ground\":{const e=t(u(o,n,\"ground\"),0);return s&&(s.verticalDistanceToGround=0,s.sampledElevation=e),e}case\"relative-to-ground\":{const e=t(u(o,n,\"ground\"),0),a=r.geometryZWithOffset(l,i);return s&&(s.verticalDistanceToGround=a,s.sampledElevation=e),a+e}case\"relative-to-scene\":{const e=t(u(o,n,\"scene\"),0),a=r.geometryZWithOffset(l,i);return s&&(s.verticalDistanceToGround=a,s.sampledElevation=e),a+e}case\"absolute-height\":{const e=r.geometryZWithOffset(l,i);if(s){const r=t(u(o,n,\"ground\"),0);s.verticalDistanceToGround=e-r,s.sampledElevation=r}return e}default:return e(r.mode),0}}function d(e,t,n){return null==t||null==n?e.definedChanged:\"on-the-ground\"===t&&\"on-the-ground\"===n?e.staysOnTheGround:t===n||\"on-the-ground\"!==t&&\"on-the-ground\"!==n?T.UPDATE:e.onTheGroundChanged}function p(e){return\"relative-to-ground\"===e||\"relative-to-scene\"===e}function g(e){return\"absolute-height\"!==e}function v(e,t,o,r,i){const a=m(t,o,i,r,O);l(e,O.verticalDistanceToGround);const c=O.sampledElevation,u=n(x,e.transformation);U[0]=t.x,U[1]=t.y,U[2]=a;return s(t.spatialReference,U,u,r.spatialReference)?e.transformation=u:console.warn(\"Could not locate symbol object properly, it might be misplaced\"),c}function E(e,n,o,r,i,s){let a=0;const l=s.spatialReference;n*=3,r*=3;for(let c=0;c<i;++c){const i=e[n+0],c=e[n+1],u=e[n+2],f=t(s.getElevation(i,c,u,l,\"ground\"),0);a+=f,o[r+0]=i,o[r+1]=c,o[r+2]=f,n+=3,r+=3}return a/i}function h(e,n,o,r,i,s,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),f=l.featureExpressionInfoContext,m=s.spatialReference;n*=3,r*=3;for(let d=0;d<i;++d){const i=e[n+0],a=e[n+1],l=e[n+2],d=t(s.getElevation(i,a,l,m,\"ground\"),0);c+=d,o[r+0]=i,o[r+1]=a,o[r+2]=null==f?l+d+u:d+u,n+=3,r+=3}return c/i}function y(e,n,o,r,i,s,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),f=l.featureExpressionInfoContext,m=s.spatialReference;n*=3,r*=3;for(let d=0;d<i;++d){const i=e[n+0],a=e[n+1],l=e[n+2],d=t(s.getElevation(i,a,l,m,\"scene\"),0);c+=d,o[r+0]=i,o[r+1]=a,o[r+2]=null==f?l+d+u:d+u,n+=3,r+=3}return c/i}function A(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}function R(e,t,n,o,r,i,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,o*=3;for(let u=0;u<r;++u){const r=e[t+0],i=e[t+1],s=e[t+2];n[o+0]=r,n[o+1]=i,n[o+2]=null==c?s+l:l,t+=3,o+=3}return 0}var T;!function(e){e[e.NONE=0]=\"NONE\",e[e.UPDATE=1]=\"UPDATE\",e[e.RECREATE=2]=\"RECREATE\"}(T||(T={}));const j={\"absolute-height\":{applyElevationAlignmentBuffer:R,requiresAlignment:A},\"on-the-ground\":{applyElevationAlignmentBuffer:E,requiresAlignment:()=>!0},\"relative-to-ground\":{applyElevationAlignmentBuffer:h,requiresAlignment:()=>!0},\"relative-to-scene\":{applyElevationAlignmentBuffer:y,requiresAlignment:()=>!0}},x=o(),O={verticalDistanceToGround:0,sampledElevation:0},U=r();export{T as SymbolUpdateType,v as applyElevationAlignmentForHUD,f as applyPerVertexElevationAlignment,d as elevationModeChangeUpdateType,m as evaluateElevationAlignmentAtPoint,p as needsElevationUpdates2D,g as needsElevationUpdates3D};\n"]},"metadata":{},"sourceType":"module"}