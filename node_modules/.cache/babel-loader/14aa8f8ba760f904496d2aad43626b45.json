{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as o } from \"../../../../core/maybe.js\";\nimport r from \"../../../../renderers/PointCloudClassBreaksRenderer.js\";\nimport t from \"../../../../renderers/PointCloudStretchRenderer.js\";\nimport n from \"../../../../renderers/PointCloudUniqueValueRenderer.js\";\nimport { createGeometryIndexFromSchema as l, createTypedView as i, readBinaryAttribute as s } from \"./I3SBinaryReader.js\";\nimport { decodeXYZ as f } from \"./LEPCC.js\";\n\nfunction u(e, o, l, i) {\n  const {\n    rendererJSON: s,\n    isRGBRenderer: f\n  } = e;\n  let u = null,\n      c = null;\n  if (o && f) u = o;else if (o && \"pointCloudUniqueValueRenderer\" === s.type) {\n    c = n.fromJSON(s);\n    const e = c.colorUniqueValueInfos;\n    u = new Uint8Array(3 * i);\n    const r = p(c.fieldTransformType);\n\n    for (let t = 0; t < i; t++) {\n      const n = (r ? r(o[t]) : o[t]) + \"\";\n\n      for (let o = 0; o < e.length; o++) if (e[o].values.indexOf(n) >= 0) {\n        u[3 * t] = e[o].color.r, u[3 * t + 1] = e[o].color.g, u[3 * t + 2] = e[o].color.b;\n        break;\n      }\n    }\n  } else if (o && \"pointCloudStretchRenderer\" === s.type) {\n    c = t.fromJSON(s);\n    const e = c.stops;\n    u = new Uint8Array(3 * i);\n    const r = p(c.fieldTransformType);\n\n    for (let t = 0; t < i; t++) {\n      const n = r ? r(o[t]) : o[t],\n            l = e.length - 1;\n      if (n < e[0].value) u[3 * t] = e[0].color.r, u[3 * t + 1] = e[0].color.g, u[3 * t + 2] = e[0].color.b;else if (n >= e[l].value) u[3 * t] = e[l].color.r, u[3 * t + 1] = e[l].color.g, u[3 * t + 2] = e[l].color.b;else for (let o = 1; o < e.length; o++) if (n < e[o].value) {\n        const r = (n - e[o - 1].value) / (e[o].value - e[o - 1].value);\n        u[3 * t] = e[o].color.r * r + e[o - 1].color.r * (1 - r), u[3 * t + 1] = e[o].color.g * r + e[o - 1].color.g * (1 - r), u[3 * t + 2] = e[o].color.b * r + e[o - 1].color.b * (1 - r);\n        break;\n      }\n    }\n  } else if (o && \"pointCloudClassBreaksRenderer\" === s.type) {\n    c = r.fromJSON(s);\n    const e = c.colorClassBreakInfos;\n    u = new Uint8Array(3 * i);\n    const t = p(c.fieldTransformType);\n\n    for (let r = 0; r < i; r++) {\n      const n = t ? t(o[r]) : o[r];\n\n      for (let o = 0; o < e.length; o++) if (n >= e[o].minValue && n <= e[o].maxValue) {\n        u[3 * r] = e[o].color.r, u[3 * r + 1] = e[o].color.g, u[3 * r + 2] = e[o].color.b;\n        break;\n      }\n    }\n  } else {\n    u = new Uint8Array(3 * i);\n\n    for (let e = 0; e < u.length; e++) u[e] = 255;\n  }\n\n  if (l && c && c.colorModulation) {\n    const e = c.colorModulation.minValue,\n          o = c.colorModulation.maxValue,\n          r = .3;\n\n    for (let t = 0; t < i; t++) {\n      const n = l[t],\n            i = n >= o ? 1 : n <= e ? r : r + (1 - r) * (n - e) / (o - e);\n      u[3 * t] = i * u[3 * t], u[3 * t + 1] = i * u[3 * t + 1], u[3 * t + 2] = i * u[3 * t + 2];\n    }\n  }\n\n  return u;\n}\n\nfunction c(o, r) {\n  if (null == o.encoding || \"\" === o.encoding) {\n    const t = l(r, o);\n    if (e(t.vertexAttributes.position)) return;\n    const n = i(r, t.vertexAttributes.position),\n          s = t.header.fields,\n          f = [s.offsetX, s.offsetY, s.offsetZ],\n          u = [s.scaleX, s.scaleY, s.scaleZ],\n          c = n.length / 3,\n          a = new Float64Array(3 * c);\n\n    for (let e = 0; e < c; e++) a[3 * e] = n[3 * e] * u[0] + f[0], a[3 * e + 1] = n[3 * e + 1] * u[1] + f[1], a[3 * e + 2] = n[3 * e + 2] * u[2] + f[2];\n\n    return a;\n  }\n\n  if (\"lepcc-xyz\" === o.encoding) return f(r).result;\n}\n\nfunction a(e, r, t) {\n  return o(e) && e.attributeInfo.useElevation ? d(r, t) : o(e) ? s(e.attributeInfo.storageInfo, e.buffer, t) : null;\n}\n\nfunction d(e, o) {\n  const r = new Float64Array(o);\n\n  for (let t = 0; t < o; t++) r[t] = e[3 * t + 2];\n\n  return r;\n}\n\nfunction m(e, o, r, t, n) {\n  const l = e.length / 3;\n  let i = 0;\n\n  for (let s = 0; s < l; s++) {\n    let l = !0;\n\n    for (let e = 0; e < t.length && l; e++) {\n      const {\n        filterJSON: o\n      } = t[e],\n            r = n[e].values[s];\n\n      switch (o.type) {\n        case \"pointCloudValueFilter\":\n          {\n            const e = \"exclude\" === o.mode;\n            -1 !== o.values.indexOf(r) === e && (l = !1);\n            break;\n          }\n\n        case \"pointCloudBitfieldFilter\":\n          {\n            const e = b(o.requiredSetBits),\n                  t = b(o.requiredClearBits);\n            (r & e) === e && 0 == (r & t) || (l = !1);\n            break;\n          }\n\n        case \"pointCloudReturnFilter\":\n          {\n            const e = 15 & r,\n                  t = r >>> 4 & 15,\n                  n = t > 1,\n                  i = 1 === e,\n                  s = e === t;\n            let f = !1;\n\n            for (const r of o.includedReturns) if (\"last\" === r && s || \"firstOfMany\" === r && i && n || \"lastOfMany\" === r && s && n || \"single\" === r && !n) {\n              f = !0;\n              break;\n            }\n\n            f || (l = !1);\n            break;\n          }\n      }\n    }\n\n    l && (r[i] = s, e[3 * i] = e[3 * s], e[3 * i + 1] = e[3 * s + 1], e[3 * i + 2] = e[3 * s + 2], o[3 * i] = o[3 * s], o[3 * i + 1] = o[3 * s + 1], o[3 * i + 2] = o[3 * s + 2], i++);\n  }\n\n  return i;\n}\n\nfunction p(e) {\n  return null == e || \"none\" === e ? null : \"low-four-bit\" === e ? e => 15 & e : \"high-four-bit\" === e ? e => (240 & e) >> 4 : \"absolute-value\" === e ? e => Math.abs(e) : \"modulo-ten\" === e ? e => e % 10 : null;\n}\n\nfunction b(e) {\n  let o = 0;\n\n  for (const r of e || []) o |= 1 << r;\n\n  return o;\n}\n\nexport { d as elevationFromPositions, u as evaluateRenderer, m as filterInPlace, a as getAttributeValues, c as readGeometry };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js"],"names":["isNone","e","isSome","o","r","t","n","createGeometryIndexFromSchema","l","createTypedView","i","readBinaryAttribute","s","decodeXYZ","f","u","rendererJSON","isRGBRenderer","c","type","fromJSON","colorUniqueValueInfos","Uint8Array","p","fieldTransformType","length","values","indexOf","color","g","b","stops","value","colorClassBreakInfos","minValue","maxValue","colorModulation","encoding","vertexAttributes","position","header","fields","offsetX","offsetY","offsetZ","scaleX","scaleY","scaleZ","a","Float64Array","result","attributeInfo","useElevation","d","storageInfo","buffer","m","filterJSON","mode","requiredSetBits","requiredClearBits","includedReturns","Math","abs","elevationFromPositions","evaluateRenderer","filterInPlace","getAttributeValues","readGeometry"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as o}from\"../../../../core/maybe.js\";import r from\"../../../../renderers/PointCloudClassBreaksRenderer.js\";import t from\"../../../../renderers/PointCloudStretchRenderer.js\";import n from\"../../../../renderers/PointCloudUniqueValueRenderer.js\";import{createGeometryIndexFromSchema as l,createTypedView as i,readBinaryAttribute as s}from\"./I3SBinaryReader.js\";import{decodeXYZ as f}from\"./LEPCC.js\";function u(e,o,l,i){const{rendererJSON:s,isRGBRenderer:f}=e;let u=null,c=null;if(o&&f)u=o;else if(o&&\"pointCloudUniqueValueRenderer\"===s.type){c=n.fromJSON(s);const e=c.colorUniqueValueInfos;u=new Uint8Array(3*i);const r=p(c.fieldTransformType);for(let t=0;t<i;t++){const n=(r?r(o[t]):o[t])+\"\";for(let o=0;o<e.length;o++)if(e[o].values.indexOf(n)>=0){u[3*t]=e[o].color.r,u[3*t+1]=e[o].color.g,u[3*t+2]=e[o].color.b;break}}}else if(o&&\"pointCloudStretchRenderer\"===s.type){c=t.fromJSON(s);const e=c.stops;u=new Uint8Array(3*i);const r=p(c.fieldTransformType);for(let t=0;t<i;t++){const n=r?r(o[t]):o[t],l=e.length-1;if(n<e[0].value)u[3*t]=e[0].color.r,u[3*t+1]=e[0].color.g,u[3*t+2]=e[0].color.b;else if(n>=e[l].value)u[3*t]=e[l].color.r,u[3*t+1]=e[l].color.g,u[3*t+2]=e[l].color.b;else for(let o=1;o<e.length;o++)if(n<e[o].value){const r=(n-e[o-1].value)/(e[o].value-e[o-1].value);u[3*t]=e[o].color.r*r+e[o-1].color.r*(1-r),u[3*t+1]=e[o].color.g*r+e[o-1].color.g*(1-r),u[3*t+2]=e[o].color.b*r+e[o-1].color.b*(1-r);break}}}else if(o&&\"pointCloudClassBreaksRenderer\"===s.type){c=r.fromJSON(s);const e=c.colorClassBreakInfos;u=new Uint8Array(3*i);const t=p(c.fieldTransformType);for(let r=0;r<i;r++){const n=t?t(o[r]):o[r];for(let o=0;o<e.length;o++)if(n>=e[o].minValue&&n<=e[o].maxValue){u[3*r]=e[o].color.r,u[3*r+1]=e[o].color.g,u[3*r+2]=e[o].color.b;break}}}else{u=new Uint8Array(3*i);for(let e=0;e<u.length;e++)u[e]=255}if(l&&c&&c.colorModulation){const e=c.colorModulation.minValue,o=c.colorModulation.maxValue,r=.3;for(let t=0;t<i;t++){const n=l[t],i=n>=o?1:n<=e?r:r+(1-r)*(n-e)/(o-e);u[3*t]=i*u[3*t],u[3*t+1]=i*u[3*t+1],u[3*t+2]=i*u[3*t+2]}}return u}function c(o,r){if(null==o.encoding||\"\"===o.encoding){const t=l(r,o);if(e(t.vertexAttributes.position))return;const n=i(r,t.vertexAttributes.position),s=t.header.fields,f=[s.offsetX,s.offsetY,s.offsetZ],u=[s.scaleX,s.scaleY,s.scaleZ],c=n.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=n[3*e]*u[0]+f[0],a[3*e+1]=n[3*e+1]*u[1]+f[1],a[3*e+2]=n[3*e+2]*u[2]+f[2];return a}if(\"lepcc-xyz\"===o.encoding)return f(r).result}function a(e,r,t){return o(e)&&e.attributeInfo.useElevation?d(r,t):o(e)?s(e.attributeInfo.storageInfo,e.buffer,t):null}function d(e,o){const r=new Float64Array(o);for(let t=0;t<o;t++)r[t]=e[3*t+2];return r}function m(e,o,r,t,n){const l=e.length/3;let i=0;for(let s=0;s<l;s++){let l=!0;for(let e=0;e<t.length&&l;e++){const{filterJSON:o}=t[e],r=n[e].values[s];switch(o.type){case\"pointCloudValueFilter\":{const e=\"exclude\"===o.mode;-1!==o.values.indexOf(r)===e&&(l=!1);break}case\"pointCloudBitfieldFilter\":{const e=b(o.requiredSetBits),t=b(o.requiredClearBits);(r&e)===e&&0==(r&t)||(l=!1);break}case\"pointCloudReturnFilter\":{const e=15&r,t=r>>>4&15,n=t>1,i=1===e,s=e===t;let f=!1;for(const r of o.includedReturns)if(\"last\"===r&&s||\"firstOfMany\"===r&&i&&n||\"lastOfMany\"===r&&s&&n||\"single\"===r&&!n){f=!0;break}f||(l=!1);break}}}l&&(r[i]=s,e[3*i]=e[3*s],e[3*i+1]=e[3*s+1],e[3*i+2]=e[3*s+2],o[3*i]=o[3*s],o[3*i+1]=o[3*s+1],o[3*i+2]=o[3*s+2],i++)}return i}function p(e){return null==e||\"none\"===e?null:\"low-four-bit\"===e?e=>15&e:\"high-four-bit\"===e?e=>(240&e)>>4:\"absolute-value\"===e?e=>Math.abs(e):\"modulo-ten\"===e?e=>e%10:null}function b(e){let o=0;for(const r of e||[])o|=1<<r;return o}export{d as elevationFromPositions,u as evaluateRenderer,m as filterInPlace,a as getAttributeValues,c as readGeometry};\n"]},"metadata":{},"sourceType":"module"}