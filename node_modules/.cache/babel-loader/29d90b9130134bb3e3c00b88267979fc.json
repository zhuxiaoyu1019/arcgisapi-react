{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { pt2px as t } from \"../../../../../../core/screenUtils.js\";\nimport { premultiplyAlphaRGBA as i } from \"../../color.js\";\nimport { MIN_MAX_ZOOM_PRECISION_FACTOR as e, SPRITE_PADDING as s } from \"../../definitions.js\";\nimport { i1616to32 as r } from \"../../number.js\";\nimport { LineMaterialKey as o } from \"../../materialKey/MaterialKey.js\";\nimport { isFunction as a, getLimitCosine as l, getMinMaxZoom as h } from \"./util.js\";\nimport n from \"./WGLBaseLineTemplate.js\";\nimport c from \"./WGLDynamicMeshTemplate.js\";\nimport { ok as m } from \"../../util/Result.js\";\n\nclass p extends n(c) {\n  constructor(s, o, h) {\n    super(s), this._minMaxZoom = r(Math.round(o * e), Math.round(h * e)), this._cimLineLayer = s;\n    let n = 0;\n    a(s.width) || (n = .5 * t(s.width));\n\n    const c = (i, e, r) => a(s.width) ? .5 * t(s.width(i, e, r)) : n;\n\n    if (this._dynamicPropertyMap.set(\"_halfWidth\", c), a(s.cap) ? this._dynamicPropertyMap.set(\"_capType\", s.cap) : this._capType = s.cap, a(s.join) ? this._dynamicPropertyMap.set(\"_joinType\", s.join) : this._joinType = s.join, a(s.color)) {\n      const t = (t, e, r) => {\n        const o = s.color(t, e, r);\n        return o && i(o) || 0;\n      };\n\n      this._dynamicPropertyMap.set(\"_fillColor\", t);\n    } else {\n      const t = s.color;\n      this._fillColor = t && i(t) || 0;\n    }\n\n    if (a(s.miterLimit)) {\n      const t = (t, i, e) => l(s.miterLimit(t, i, e));\n\n      this._dynamicPropertyMap.set(\"_miterLimitCosine\", t);\n    } else this._miterLimitCosine = l(s.miterLimit);\n\n    this._scaleFactor = s.scaleFactor || 1, this._isDashed = s.isDashed, this._effects = s.effects, this.tessellationProperties._bitset = s.colorLocked ? 1 : 0, this._materialKey = s.materialKey, this._initializeTessellator(!0);\n  }\n\n  static fromCIMLine(t, i) {\n    const [e, s] = h(t.scaleInfo, i);\n    return new p(t, e, s);\n  }\n\n  bindFeature(t, i, e) {\n    const a = t.readLegacyFeature();\n    this._dynamicPropertyMap.forEach((t, s) => {\n      this[s] = t(a, i, e);\n    }), this._halfWidth *= this._scaleFactor;\n    const l = this._materialCache,\n          h = (0, this._cimLineLayer.materialHash)(a, i, e),\n          n = l.get(h);\n    let c = null;\n\n    if (n && m(n.spriteMosaicItem) && (c = n.spriteMosaicItem), c) {\n      this._hasPattern = !0;\n      const {\n        rect: t,\n        width: i,\n        height: e\n      } = c,\n            o = t.x + s,\n            a = t.y + s,\n            l = o + i,\n            h = a + e;\n      this.tessellationProperties._tl = r(o, a), this.tessellationProperties._br = r(l, h);\n    } else this._hasPattern = !1, this.tessellationProperties._tl = 0, this.tessellationProperties._br = 0;\n\n    this.tessellationProperties._fillColor = this._fillColor, this.tessellationProperties._halfWidth = this._halfWidth, this.tessellationProperties.offset = 0, this.tessellationProperties._halfReferenceWidth = this.tessellationProperties._halfWidth;\n    const p = o.load(this._materialKey);\n    c && (p.sdf = c.sdf, p.pattern = !0, p.textureBinding = c.textureBinding), this._materialKey = p.data;\n  }\n\n}\n\nexport default p;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate.js"],"names":["pt2px","t","premultiplyAlphaRGBA","i","MIN_MAX_ZOOM_PRECISION_FACTOR","e","SPRITE_PADDING","s","i1616to32","r","LineMaterialKey","o","isFunction","a","getLimitCosine","l","getMinMaxZoom","h","n","c","ok","m","p","constructor","_minMaxZoom","Math","round","_cimLineLayer","width","_dynamicPropertyMap","set","cap","_capType","join","_joinType","color","_fillColor","miterLimit","_miterLimitCosine","_scaleFactor","scaleFactor","_isDashed","isDashed","_effects","effects","tessellationProperties","_bitset","colorLocked","_materialKey","materialKey","_initializeTessellator","fromCIMLine","scaleInfo","bindFeature","readLegacyFeature","forEach","_halfWidth","_materialCache","materialHash","get","spriteMosaicItem","_hasPattern","rect","height","x","y","_tl","_br","offset","_halfReferenceWidth","load","sdf","pattern","textureBinding","data"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{pt2px as t}from\"../../../../../../core/screenUtils.js\";import{premultiplyAlphaRGBA as i}from\"../../color.js\";import{MIN_MAX_ZOOM_PRECISION_FACTOR as e,SPRITE_PADDING as s}from\"../../definitions.js\";import{i1616to32 as r}from\"../../number.js\";import{LineMaterialKey as o}from\"../../materialKey/MaterialKey.js\";import{isFunction as a,getLimitCosine as l,getMinMaxZoom as h}from\"./util.js\";import n from\"./WGLBaseLineTemplate.js\";import c from\"./WGLDynamicMeshTemplate.js\";import{ok as m}from\"../../util/Result.js\";class p extends(n(c)){constructor(s,o,h){super(s),this._minMaxZoom=r(Math.round(o*e),Math.round(h*e)),this._cimLineLayer=s;let n=0;a(s.width)||(n=.5*t(s.width));const c=(i,e,r)=>a(s.width)?.5*t(s.width(i,e,r)):n;if(this._dynamicPropertyMap.set(\"_halfWidth\",c),a(s.cap)?this._dynamicPropertyMap.set(\"_capType\",s.cap):this._capType=s.cap,a(s.join)?this._dynamicPropertyMap.set(\"_joinType\",s.join):this._joinType=s.join,a(s.color)){const t=(t,e,r)=>{const o=s.color(t,e,r);return o&&i(o)||0};this._dynamicPropertyMap.set(\"_fillColor\",t)}else{const t=s.color;this._fillColor=t&&i(t)||0}if(a(s.miterLimit)){const t=(t,i,e)=>l(s.miterLimit(t,i,e));this._dynamicPropertyMap.set(\"_miterLimitCosine\",t)}else this._miterLimitCosine=l(s.miterLimit);this._scaleFactor=s.scaleFactor||1,this._isDashed=s.isDashed,this._effects=s.effects,this.tessellationProperties._bitset=s.colorLocked?1:0,this._materialKey=s.materialKey,this._initializeTessellator(!0)}static fromCIMLine(t,i){const[e,s]=h(t.scaleInfo,i);return new p(t,e,s)}bindFeature(t,i,e){const a=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,s)=>{this[s]=t(a,i,e)})),this._halfWidth*=this._scaleFactor;const l=this._materialCache,h=(0,this._cimLineLayer.materialHash)(a,i,e),n=l.get(h);let c=null;if(n&&m(n.spriteMosaicItem)&&(c=n.spriteMosaicItem),c){this._hasPattern=!0;const{rect:t,width:i,height:e}=c,o=t.x+s,a=t.y+s,l=o+i,h=a+e;this.tessellationProperties._tl=r(o,a),this.tessellationProperties._br=r(l,h)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const p=o.load(this._materialKey);c&&(p.sdf=c.sdf,p.pattern=!0,p.textureBinding=c.textureBinding),this._materialKey=p.data}}export default p;\n"]},"metadata":{},"sourceType":"module"}