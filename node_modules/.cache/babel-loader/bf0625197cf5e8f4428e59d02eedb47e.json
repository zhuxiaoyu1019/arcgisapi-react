{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport s from \"../../../../core/Handles.js\";\nimport { init as i } from \"../../../../core/watchUtils.js\";\nimport { property as r } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { getReferenceEllipsoid as o } from \"../../../../geometry/projectionEllipsoid.js\";\nimport { FrustumExtentIntersection as a } from \"../../support/FrustumExtentIntersection.js\";\nimport { TaskPriority as l } from \"../../../support/Scheduler.js\";\nconst h = 1.2;\nlet u = class extends t {\n  constructor() {\n    super(...arguments), this.suspended = !1, this.extent = null, this.extentIntersectionDirty = !0, this._isVisibleBelowSurface = !1, this.handles = new s(), this.layerView = null, this.updating = !0;\n  }\n\n  setup(e) {\n    this.layerView = e, this.extentIntersection = new a({\n      renderCoordsHelper: e.view.renderCoordsHelper\n    });\n    const t = e.view,\n          s = t.basemapTerrain,\n          r = t.resourceController.scheduler;\n    this.handles.add([t.on(\"resize\", () => this.viewChange()), t.state.watch(\"camera\", () => this.viewChange(), !0), r.registerTask(l.FRUSTUM_VISIBILITY, this), s.on(\"elevation-bounds-change\", () => this.elevationBoundsChange())]), \"local\" === t.viewingMode ? this.isVisibleBelowSurface = !0 : this.handles.add([i(s, [\"opacity\", \"wireframe\"], () => this.updateIsVisibleBelowSurface()), i(t, \"map.ground.navigationConstraint.type\", () => this.updateIsVisibleBelowSurface())]);\n  }\n\n  destroy() {\n    this.layerView = null, this.extent = null, this.extentIntersection = null, this.handles && (this.handles.destroy(), this.handles = null);\n  }\n\n  _setDirty() {\n    this.updating || this._set(\"updating\", !0);\n  }\n\n  setExtent(e) {\n    this.extent = e, this.extentIntersectionDirty = !0, this._setDirty();\n  }\n\n  viewChange() {\n    this._setDirty();\n  }\n\n  elevationBoundsChange() {\n    this._setDirty(), this.extentIntersectionDirty = !0;\n  }\n\n  set isVisibleBelowSurface(e) {\n    this._isVisibleBelowSurface = e, this._setDirty(), this.extentIntersectionDirty = !0;\n  }\n\n  updateIsVisibleBelowSurface() {\n    const e = this.layerView.view,\n          t = e.basemapTerrain,\n          s = \"local\" === e.viewingMode,\n          i = e.map.ground && e.map.ground.navigationConstraint && \"none\" === e.map.ground.navigationConstraint.type;\n    this.isVisibleBelowSurface = s || !t.opaque || i;\n  }\n\n  updateExtentIntersection() {\n    if (!this.extentIntersectionDirty) return;\n    this.extentIntersectionDirty = !1;\n    const e = this.layerView.view;\n    let t;\n    if (this._isVisibleBelowSurface) t = -.3 * o(e.spatialReference).radius;else {\n      const {\n        min: s,\n        max: i\n      } = e.basemapTerrain.elevationBounds;\n      t = s - Math.max(1, (i - s) * (h - 1));\n    }\n    this.extentIntersection.update(this.extent, e.spatialReference, t);\n  }\n\n  get running() {\n    return this.updating;\n  }\n\n  runTask() {\n    if (this._set(\"updating\", !1), !this.extent) return void this._set(\"suspended\", !1);\n    this.updateExtentIntersection();\n    const e = this.layerView.view.frustum,\n          t = o(this.layerView.view.spatialReference).radius;\n\n    this._set(\"suspended\", !this.extentIntersection.isVisibleInFrustum(e, t));\n  }\n\n};\ne([r({\n  readOnly: !0\n})], u.prototype, \"suspended\", void 0), e([r({\n  readOnly: !0\n})], u.prototype, \"updating\", void 0), u = e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")], u);\nvar p = u;\nexport default p;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"],"names":["_","e","t","s","init","i","property","r","subclass","n","getReferenceEllipsoid","o","FrustumExtentIntersection","a","TaskPriority","l","h","u","constructor","arguments","suspended","extent","extentIntersectionDirty","_isVisibleBelowSurface","handles","layerView","updating","setup","extentIntersection","renderCoordsHelper","view","basemapTerrain","resourceController","scheduler","add","on","viewChange","state","watch","registerTask","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","updateIsVisibleBelowSurface","destroy","_setDirty","_set","setExtent","map","ground","navigationConstraint","type","opaque","updateExtentIntersection","spatialReference","radius","min","max","elevationBounds","Math","update","running","runTask","frustum","isVisibleInFrustum","readOnly","prototype","p"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var p=u;export default p;\n"]},"metadata":{},"sourceType":"module"}