{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { clone as e } from \"../../../../../core/lang.js\";\nimport { urlToObject as t, objectToQuery as i, isAbsolute as l, join as r } from \"../../../../../core/urlUtils.js\";\nimport s from \"../../../../../geometry/Extent.js\";\nimport { readServiceTileInfo as o } from \"../../../../../layers/support/serviceTileInfoProperty.js\";\nimport { TilemapCache as a } from \"../../../../../layers/support/TilemapCache.js\";\nimport n from \"../TileIndex.js\";\n\nclass p {\n  constructor(p, h, u) {\n    this.tileMapURL = \"\", this.tilemapCache = null, this.parsedUrl = null, this.tileInfo = null, this.capabilities = null, this.tileIndex = null, this.fullExtent = null, this.name = p, this.sourceUrl = h, h && (this.parsedUrl = t(this.sourceUrl));\n    const c = this.parsedUrl.path,\n          m = this.parsedUrl.query ? \"?\" + i(this.parsedUrl.query) : \"\",\n          f = e(u),\n          d = f.tiles;\n    h && d.forEach((e, t) => {\n      l(e) || (d[t] = r(c, e) + m);\n    }), this.tileServers = d, u.tileMap && (this.tileMapURL = r(h, u.tileMap));\n    const x = u.capabilities && u.capabilities.split(\",\").map(e => e.toLowerCase().trim()),\n          g = !!u.exportTilesAllowed,\n          y = !!x && -1 !== x.indexOf(\"tilemap\"),\n          M = g && u.hasOwnProperty(\"maxExportTilesCount\") ? u.maxExportTilesCount : 0;\n    this.capabilities = {\n      operations: {\n        supportsExportTiles: g,\n        supportsTileMap: y\n      },\n      exportTiles: g ? {\n        maxExportTilesCount: +M\n      } : null\n    }, this.tileInfo = o(f.tileInfo, f, null, {\n      ignoreMinMaxLOD: !0\n    }), y && (this.type = \"vector-tile\", this.tilemapCache = new a({\n      layer: this\n    }), this.tilemapCache && (this.tileIndex = new n(this.tilemapCache))), this.fullExtent = s.fromJSON(u.fullExtent);\n  }\n\n  getRefKey(e, t) {\n    return this.tileIndex ? this.tileIndex.dataKey(e, t) : Promise.resolve(e);\n  }\n\n  getSourceTileUrl(e, t, i) {\n    let l = this.tileServers[t % this.tileServers.length];\n    return l = l.replace(/\\{z\\}/gi, e.toString()).replace(/\\{y\\}/gi, t.toString()).replace(/\\{x\\}/gi, i.toString()), l;\n  }\n\n  isCompatibleWith(e) {\n    const t = this.tileInfo,\n          i = e.tileInfo;\n    if (!t.spatialReference.equals(i.spatialReference)) return !1;\n    if (!t.origin.equals(i.origin)) return !1;\n    if (Math.round(t.dpi) !== Math.round(i.dpi)) return !1;\n    const l = t.lods,\n          r = i.lods,\n          s = Math.min(l.length, r.length);\n\n    for (let o = 0; o < s; o++) {\n      const e = l[o],\n            t = r[o];\n      if (e.level !== t.level || Math.round(e.scale) !== Math.round(t.scale)) return !1;\n    }\n\n    return !0;\n  }\n\n}\n\nexport default p;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/style/VectorTileSource.js"],"names":["clone","e","urlToObject","t","objectToQuery","i","isAbsolute","l","join","r","s","readServiceTileInfo","o","TilemapCache","a","n","p","constructor","h","u","tileMapURL","tilemapCache","parsedUrl","tileInfo","capabilities","tileIndex","fullExtent","name","sourceUrl","c","path","m","query","f","d","tiles","forEach","tileServers","tileMap","x","split","map","toLowerCase","trim","g","exportTilesAllowed","y","indexOf","M","hasOwnProperty","maxExportTilesCount","operations","supportsExportTiles","supportsTileMap","exportTiles","ignoreMinMaxLOD","type","layer","fromJSON","getRefKey","dataKey","Promise","resolve","getSourceTileUrl","length","replace","toString","isCompatibleWith","spatialReference","equals","origin","Math","round","dpi","lods","min","level","scale"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{clone as e}from\"../../../../../core/lang.js\";import{urlToObject as t,objectToQuery as i,isAbsolute as l,join as r}from\"../../../../../core/urlUtils.js\";import s from\"../../../../../geometry/Extent.js\";import{readServiceTileInfo as o}from\"../../../../../layers/support/serviceTileInfoProperty.js\";import{TilemapCache as a}from\"../../../../../layers/support/TilemapCache.js\";import n from\"../TileIndex.js\";class p{constructor(p,h,u){this.tileMapURL=\"\",this.tilemapCache=null,this.parsedUrl=null,this.tileInfo=null,this.capabilities=null,this.tileIndex=null,this.fullExtent=null,this.name=p,this.sourceUrl=h,h&&(this.parsedUrl=t(this.sourceUrl));const c=this.parsedUrl.path,m=this.parsedUrl.query?\"?\"+i(this.parsedUrl.query):\"\",f=e(u),d=f.tiles;h&&d.forEach(((e,t)=>{l(e)||(d[t]=r(c,e)+m)})),this.tileServers=d,u.tileMap&&(this.tileMapURL=r(h,u.tileMap));const x=u.capabilities&&u.capabilities.split(\",\").map((e=>e.toLowerCase().trim())),g=!!u.exportTilesAllowed,y=!!x&&-1!==x.indexOf(\"tilemap\"),M=g&&u.hasOwnProperty(\"maxExportTilesCount\")?u.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:g,supportsTileMap:y},exportTiles:g?{maxExportTilesCount:+M}:null},this.tileInfo=o(f.tileInfo,f,null,{ignoreMinMaxLOD:!0}),y&&(this.type=\"vector-tile\",this.tilemapCache=new a({layer:this}),this.tilemapCache&&(this.tileIndex=new n(this.tilemapCache))),this.fullExtent=s.fromJSON(u.fullExtent)}getRefKey(e,t){return this.tileIndex?this.tileIndex.dataKey(e,t):Promise.resolve(e)}getSourceTileUrl(e,t,i){let l=this.tileServers[t%this.tileServers.length];return l=l.replace(/\\{z\\}/gi,e.toString()).replace(/\\{y\\}/gi,t.toString()).replace(/\\{x\\}/gi,i.toString()),l}isCompatibleWith(e){const t=this.tileInfo,i=e.tileInfo;if(!t.spatialReference.equals(i.spatialReference))return!1;if(!t.origin.equals(i.origin))return!1;if(Math.round(t.dpi)!==Math.round(i.dpi))return!1;const l=t.lods,r=i.lods,s=Math.min(l.length,r.length);for(let o=0;o<s;o++){const e=l[o],t=r[o];if(e.level!==t.level||Math.round(e.scale)!==Math.round(t.scale))return!1}return!0}}export default p;\n"]},"metadata":{},"sourceType":"module"}