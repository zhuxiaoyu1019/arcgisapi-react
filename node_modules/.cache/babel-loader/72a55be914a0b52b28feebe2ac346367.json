{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { forEach as i } from \"../../../../core/asyncUtils.js\";\nimport { estimateAttributesObjectSize as e } from \"../../../../core/byteSizeEstimations.js\";\nimport { isSome as t, isNone as r } from \"../../../../core/maybe.js\";\nimport s from \"../../../../core/ObjectPool.js\";\nimport { b as a } from \"../../../../chunks/vec2.js\";\nimport { a as o } from \"../../../../chunks/vec2f64.js\";\nimport { a as h } from \"../../../../chunks/vec3.js\";\nimport { c as n } from \"../../../../chunks/vec3f64.js\";\nimport c from \"../../../../geometry/Polygon.js\";\nimport { projectBoundingRect as l } from \"../../../../geometry/projection.js\";\nimport { set as p, ZERO as y, empty as m, expandWithAABB as u, allFinite as d, toRect as g } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { create as b, allFinite as f } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { computeAABR as _, numVertices as G } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nimport { convertFromGeometry as E } from \"../../../../layers/graphics/featureConversionUtils.js\";\nimport { createFeature as x } from \"./featureExpressionInfoUtils.js\";\nconst j = new s(Array, i => p(i, y), null, 10, 5),\n      v = b();\n\nclass S {\n  constructor(i, e, r, s, a) {\n    this._labelGraphics = new Array(), this._auxiliaryGraphics = new Array(), this._visibilityFlags = L(2, 4), this._featureExpressionFeature = null, this._optimizedGeometry = {\n      geometry: null,\n      hasZ: !1,\n      hasM: !1\n    }, this._extent = null, this.isElevationSource = !1, ++e.referenced, this.graphics3DSymbol = e, this.graphic = i, this._graphics = r, this._featureExpressionFeature = a ? x(a, i, s) : null;\n\n    for (const o of this._graphics) t(o) && (this.isElevationSource = this.isElevationSource || o.isElevationSource);\n  }\n\n  get labelGraphics() {\n    return this._labelGraphics;\n  }\n\n  get extent() {\n    return this._extent;\n  }\n\n  initialize(i, e, t) {\n    this._layer = e, this._stage = i, this.forEachSymbolLayerGraphic(r => {\n      r.initialize(i, e, t), r.setVisibility(this.isVisible());\n    });\n  }\n\n  destroy() {\n    this.forEachSymbolLayerGraphic(i => i.destroy()), this._graphics = null, this._auxiliaryGraphics = null, --this.graphics3DSymbol.referenced, this.graphics3DSymbol = null;\n  }\n\n  get destroyed() {\n    return null == this._graphics;\n  }\n\n  clearLabelGraphics() {\n    this.forEachLabelGraphic(i => i.destroy()), this._labelGraphics.length = 0;\n  }\n\n  addLabelGraphic(i, e, t) {\n    this._labelGraphics.push(i), i.initialize(e, t), i.setVisibility(this.isVisible(1));\n  }\n\n  addAuxiliaryGraphic(i) {\n    this._auxiliaryGraphics.push(i), this._layer && (i.initialize(this._stage, this._layer), i.setVisibility(this.isVisible()));\n  }\n\n  get isDraped() {\n    let i = !1;\n    return this.forEachSymbolLayerGraphic(e => {\n      \"draped\" === e.type && (i = !0);\n    }), i;\n  }\n\n  isVisible(i = 0, e) {\n    for (let t = 0; t <= i; t++) {\n      const i = this._visibilityFlags[t];\n\n      for (let t = 0; t < i.length; ++t) if (!1 === i[t] && t !== e) return !1;\n    }\n\n    return !0;\n  }\n\n  hasVisibilityFlag(i, e) {\n    return null != this._visibilityFlags[e][i];\n  }\n\n  setVisibilityFlag(i, e, t) {\n    const r = this.isVisible(t);\n    this._visibilityFlags[t][i] = e;\n    const s = this.isVisible(t);\n    if (r === s) return !1;\n    if (1 === t) this.forEachLabelGraphic(i => i.setVisibility(s));else {\n      this.forEachSymbolLayerGraphic(i => i.setVisibility(s));\n      const i = this.isVisible(1);\n      this.forEachLabelGraphic(e => e.setVisibility(i));\n    }\n    return !0;\n  }\n\n  clearVisibilityFlag(i, e = 0) {\n    return this.setVisibilityFlag(i, void 0, e);\n  }\n\n  computeExtent(i) {\n    if (!this._extent) {\n      const e = this.graphic.geometry;\n      if (r(e)) return !1;\n      this._extent = b(), _(e, this._extent);\n      const t = e.spatialReference;\n      if (!t.equals(i) && !l(this._extent, t, this._extent, i)) return this._extent = null, !1;\n    }\n\n    return !0;\n  }\n\n  getAsOptimizedGeometry(i, e) {\n    return this._optimizedGeometry.geometry && this._optimizedGeometry.hasZ === i && this._optimizedGeometry.hasM === e || (this._optimizedGeometry.geometry = this._convertGraphicToOptimizedGeometry(this.graphic, i, e), this._optimizedGeometry.hasZ = i, this._optimizedGeometry.hasM = e), this._optimizedGeometry.geometry;\n  }\n\n  _convertGraphicToOptimizedGeometry(i, e, t) {\n    let r = i.geometry;\n    return \"mesh\" !== r.type && \"extent\" !== r.type || (r = c.fromExtent(\"mesh\" === r.type ? r.extent : r)), E(r, e, t);\n  }\n\n  get usedMemory() {\n    let i = e(this.graphic.attributes);\n    return this.forEachSymbolLayerGraphic(e => {\n      const t = e.graphics3DSymbolLayer.complexity;\n      if (r(t)) return;\n      const s = \"draped\" === e.type ? t.memory.draped : t.memory;\n      i += s.bytesPerFeature, s.bytesPerCoordinate && (i += G(this.graphic.geometry) * s.bytesPerCoordinate);\n    }), i;\n  }\n\n  computeAttachmentOrigin() {\n    const i = {\n      render: {\n        origin: n(),\n        num: 0\n      },\n      draped: {\n        origin: o(),\n        num: 0\n      }\n    };\n\n    for (const e of this._graphics) r(e) || e.computeAttachmentOrigin(i);\n\n    return i.render.num && h(i.render.origin, i.render.origin, 1 / i.render.num), i.draped.num && a(i.draped.origin, i.draped.origin, 1 / i.draped.num), i;\n  }\n\n  async getProjectedBoundingBox(e, t, s, a, o) {\n    return o || (o = {\n      boundingBox: null,\n      requiresDrapedElevation: !1,\n      screenSpaceObjects: []\n    }), o.boundingBox ? m(o.boundingBox) : o.boundingBox = m(), o.requiresDrapedElevation = !1, await i(this._graphics, async i => {\n      if (r(i)) return;\n      const h = \"draped\" === i.type ? t : e,\n            n = j.acquire(),\n            c = await i.getProjectedBoundingBox(h, s, o.screenSpaceObjects, a, n);\n      isFinite(c[2]) && isFinite(c[5]) || (o.requiresDrapedElevation = !0), c && u(o.boundingBox, n), j.release(n);\n    }), d(o.boundingBox) || f(g(o.boundingBox, v)) ? o : null;\n  }\n\n  needsElevationUpdates() {\n    for (const i of this._graphics) if (t(i) && (\"object3d\" === i.type || \"lod-instance\" === i.type) && i.needsElevationUpdates) return !0;\n\n    for (const i of this._labelGraphics) if (i && i.needsElevationUpdates) return !0;\n\n    return !1;\n  }\n\n  alignWithElevation(i, e, t) {\n    this.forEachRenderedGraphic(r => {\n      \"object3d\" !== r.type && \"lod-instance\" !== r.type || r.alignWithElevation(i, e, this._featureExpressionFeature, t);\n    });\n  }\n\n  addObjectStateSet(i, e) {\n    this.forEachSymbolLayerGraphic(t => t.addObjectState(i, e));\n  }\n\n  removeObjectState(i) {\n    this.forEachSymbolLayerGraphic(e => e.removeObjectState(i));\n  }\n\n  forEachGraphicList(i, e) {\n    i.forEach(i => i && e(i));\n  }\n\n  forEachSymbolLayerGraphic(i) {\n    this.forEachGraphicList(this._graphics, i), this.forEachGraphicList(this._auxiliaryGraphics, i);\n  }\n\n  forEachLabelGraphic(i) {\n    this.forEachGraphicList(this._labelGraphics, i);\n  }\n\n  forEachRenderedGraphic(i) {\n    this.forEachSymbolLayerGraphic(i), this.forEachLabelGraphic(i);\n  }\n\n}\n\nfunction L(i, e) {\n  const t = new Array(i);\n\n  for (let r = 0; r < t.length; r++) t[r] = new Array(e);\n\n  return t;\n}\n\nexport default S;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphic.js"],"names":["forEach","i","estimateAttributesObjectSize","e","isSome","t","isNone","r","s","b","a","o","h","c","n","projectBoundingRect","l","set","p","ZERO","y","empty","m","expandWithAABB","u","allFinite","d","toRect","g","create","f","computeAABR","_","numVertices","G","convertFromGeometry","E","createFeature","x","j","Array","v","S","constructor","_labelGraphics","_auxiliaryGraphics","_visibilityFlags","L","_featureExpressionFeature","_optimizedGeometry","geometry","hasZ","hasM","_extent","isElevationSource","referenced","graphics3DSymbol","graphic","_graphics","labelGraphics","extent","initialize","_layer","_stage","forEachSymbolLayerGraphic","setVisibility","isVisible","destroy","destroyed","clearLabelGraphics","forEachLabelGraphic","length","addLabelGraphic","push","addAuxiliaryGraphic","isDraped","type","hasVisibilityFlag","setVisibilityFlag","clearVisibilityFlag","computeExtent","spatialReference","equals","getAsOptimizedGeometry","_convertGraphicToOptimizedGeometry","fromExtent","usedMemory","attributes","graphics3DSymbolLayer","complexity","memory","draped","bytesPerFeature","bytesPerCoordinate","computeAttachmentOrigin","render","origin","num","getProjectedBoundingBox","boundingBox","requiresDrapedElevation","screenSpaceObjects","acquire","isFinite","release","needsElevationUpdates","alignWithElevation","forEachRenderedGraphic","addObjectStateSet","addObjectState","removeObjectState","forEachGraphicList"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{forEach as i}from\"../../../../core/asyncUtils.js\";import{estimateAttributesObjectSize as e}from\"../../../../core/byteSizeEstimations.js\";import{isSome as t,isNone as r}from\"../../../../core/maybe.js\";import s from\"../../../../core/ObjectPool.js\";import{b as a}from\"../../../../chunks/vec2.js\";import{a as o}from\"../../../../chunks/vec2f64.js\";import{a as h}from\"../../../../chunks/vec3.js\";import{c as n}from\"../../../../chunks/vec3f64.js\";import c from\"../../../../geometry/Polygon.js\";import{projectBoundingRect as l}from\"../../../../geometry/projection.js\";import{set as p,ZERO as y,empty as m,expandWithAABB as u,allFinite as d,toRect as g}from\"../../../../geometry/support/aaBoundingBox.js\";import{create as b,allFinite as f}from\"../../../../geometry/support/aaBoundingRect.js\";import{computeAABR as _,numVertices as G}from\"../../../../layers/graphics/dehydratedFeatures.js\";import{convertFromGeometry as E}from\"../../../../layers/graphics/featureConversionUtils.js\";import{createFeature as x}from\"./featureExpressionInfoUtils.js\";const j=new s(Array,(i=>p(i,y)),null,10,5),v=b();class S{constructor(i,e,r,s,a){this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=L(2,4),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++e.referenced,this.graphics3DSymbol=e,this.graphic=i,this._graphics=r,this._featureExpressionFeature=a?x(a,i,s):null;for(const o of this._graphics)t(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(i,e,t){this._layer=e,this._stage=i,this.forEachSymbolLayerGraphic((r=>{r.initialize(i,e,t),r.setVisibility(this.isVisible())}))}destroy(){this.forEachSymbolLayerGraphic((i=>i.destroy())),this._graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this._graphics}clearLabelGraphics(){this.forEachLabelGraphic((i=>i.destroy())),this._labelGraphics.length=0}addLabelGraphic(i,e,t){this._labelGraphics.push(i),i.initialize(e,t),i.setVisibility(this.isVisible(1))}addAuxiliaryGraphic(i){this._auxiliaryGraphics.push(i),this._layer&&(i.initialize(this._stage,this._layer),i.setVisibility(this.isVisible()))}get isDraped(){let i=!1;return this.forEachSymbolLayerGraphic((e=>{\"draped\"===e.type&&(i=!0)})),i}isVisible(i=0,e){for(let t=0;t<=i;t++){const i=this._visibilityFlags[t];for(let t=0;t<i.length;++t)if(!1===i[t]&&t!==e)return!1}return!0}hasVisibilityFlag(i,e){return null!=this._visibilityFlags[e][i]}setVisibilityFlag(i,e,t){const r=this.isVisible(t);this._visibilityFlags[t][i]=e;const s=this.isVisible(t);if(r===s)return!1;if(1===t)this.forEachLabelGraphic((i=>i.setVisibility(s)));else{this.forEachSymbolLayerGraphic((i=>i.setVisibility(s)));const i=this.isVisible(1);this.forEachLabelGraphic((e=>e.setVisibility(i)))}return!0}clearVisibilityFlag(i,e=0){return this.setVisibilityFlag(i,void 0,e)}computeExtent(i){if(!this._extent){const e=this.graphic.geometry;if(r(e))return!1;this._extent=b(),_(e,this._extent);const t=e.spatialReference;if(!t.equals(i)&&!l(this._extent,t,this._extent,i))return this._extent=null,!1}return!0}getAsOptimizedGeometry(i,e){return this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===i&&this._optimizedGeometry.hasM===e||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,i,e),this._optimizedGeometry.hasZ=i,this._optimizedGeometry.hasM=e),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(i,e,t){let r=i.geometry;return\"mesh\"!==r.type&&\"extent\"!==r.type||(r=c.fromExtent(\"mesh\"===r.type?r.extent:r)),E(r,e,t)}get usedMemory(){let i=e(this.graphic.attributes);return this.forEachSymbolLayerGraphic((e=>{const t=e.graphics3DSymbolLayer.complexity;if(r(t))return;const s=\"draped\"===e.type?t.memory.draped:t.memory;i+=s.bytesPerFeature,s.bytesPerCoordinate&&(i+=G(this.graphic.geometry)*s.bytesPerCoordinate)})),i}computeAttachmentOrigin(){const i={render:{origin:n(),num:0},draped:{origin:o(),num:0}};for(const e of this._graphics)r(e)||e.computeAttachmentOrigin(i);return i.render.num&&h(i.render.origin,i.render.origin,1/i.render.num),i.draped.num&&a(i.draped.origin,i.draped.origin,1/i.draped.num),i}async getProjectedBoundingBox(e,t,s,a,o){return o||(o={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),o.boundingBox?m(o.boundingBox):o.boundingBox=m(),o.requiresDrapedElevation=!1,await i(this._graphics,(async i=>{if(r(i))return;const h=\"draped\"===i.type?t:e,n=j.acquire(),c=await i.getProjectedBoundingBox(h,s,o.screenSpaceObjects,a,n);isFinite(c[2])&&isFinite(c[5])||(o.requiresDrapedElevation=!0),c&&u(o.boundingBox,n),j.release(n)})),d(o.boundingBox)||f(g(o.boundingBox,v))?o:null}needsElevationUpdates(){for(const i of this._graphics)if(t(i)&&(\"object3d\"===i.type||\"lod-instance\"===i.type)&&i.needsElevationUpdates)return!0;for(const i of this._labelGraphics)if(i&&i.needsElevationUpdates)return!0;return!1}alignWithElevation(i,e,t){this.forEachRenderedGraphic((r=>{\"object3d\"!==r.type&&\"lod-instance\"!==r.type||r.alignWithElevation(i,e,this._featureExpressionFeature,t)}))}addObjectStateSet(i,e){this.forEachSymbolLayerGraphic((t=>t.addObjectState(i,e)))}removeObjectState(i){this.forEachSymbolLayerGraphic((e=>e.removeObjectState(i)))}forEachGraphicList(i,e){i.forEach((i=>i&&e(i)))}forEachSymbolLayerGraphic(i){this.forEachGraphicList(this._graphics,i),this.forEachGraphicList(this._auxiliaryGraphics,i)}forEachLabelGraphic(i){this.forEachGraphicList(this._labelGraphics,i)}forEachRenderedGraphic(i){this.forEachSymbolLayerGraphic(i),this.forEachLabelGraphic(i)}}function L(i,e){const t=new Array(i);for(let r=0;r<t.length;r++)t[r]=new Array(e);return t}export default S;\n"]},"metadata":{},"sourceType":"module"}