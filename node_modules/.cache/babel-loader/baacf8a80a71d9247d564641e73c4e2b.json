{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t } from \"../../../../../core/maybe.js\";\nimport { VTL_TEXTURE_BINDING_UNIT_SPRITES as i } from \"../definitions.js\";\nimport { WGLDrawPhase as n } from \"../enums.js\";\nimport { u32to4Xu8 as a } from \"../number.js\";\nimport r from \"./WGLBrush.js\";\n\nclass o extends r {\n  constructor() {\n    super(...arguments), this._programOptions = {\n      id: !1,\n      pattern: !1,\n      sdf: !1\n    };\n  }\n\n  dispose() {}\n\n  drawMany(r, o) {\n    const {\n      context: s,\n      displayLevel: l,\n      state: f,\n      drawPhase: m,\n      painter: u,\n      pixelRatio: c,\n      spriteMosaic: d,\n      styleLayerUID: p\n    } = r;\n    if (!o.some(e => {\n      var t, i;\n      return null != (t = null == (i = e.layerData.get(p)) ? void 0 : i.lineIndexCount) && t;\n    })) return;\n\n    const g = r.styleLayer,\n          y = g.lineMaterial,\n          M = u.vectorTilesMaterialManager,\n          v = g.getPaintValue(\"line-translate\", l),\n          _ = g.getPaintValue(\"line-translate-anchor\", l),\n          U = g.getPaintProperty(\"line-pattern\"),\n          x = void 0 !== U,\n          P = x && U.isDataDriven;\n\n    let E, D;\n\n    if (x && !P) {\n      const e = U.getValue(l);\n      E = d.getMosaicItemPosition(e);\n    }\n\n    let V = !1;\n\n    if (!x) {\n      const e = g.getPaintProperty(\"line-dasharray\");\n\n      if (D = void 0 !== e, V = D && e.isDataDriven, D && !V) {\n        const t = e.getValue(l),\n              i = g.getDashKey(t, g.getLayoutValue(\"line-cap\", l));\n        E = d.getMosaicItemPosition(i);\n      }\n    }\n\n    const h = 1 / c,\n          I = m === n.HITTEST,\n          S = this._programOptions;\n    S.id = I, S.pattern = x, S.sdf = D;\n    const T = M.getMaterialProgram(s, y, S);\n\n    if (s.useProgram(T), T.setUniformMatrix3fv(\"u_displayViewMat3\", f.displayViewMat3), T.setUniformMatrix3fv(\"u_displayMat3\", 1 === _ ? f.displayMat3 : f.displayViewMat3), T.setUniform2fv(\"u_lineTranslation\", v), T.setUniform1f(\"u_depth\", g.z), T.setUniform1f(\"u_antialiasing\", h), I) {\n      const e = a(p + 1);\n      T.setUniform4fv(\"u_id\", e);\n    }\n\n    if (E && e(E)) {\n      const {\n        page: t\n      } = E,\n            n = d.getPageSize(t);\n      e(n) && (d.bind(s, 9729, t, i), T.setUniform2fv(\"u_mosaicSize\", n), T.setUniform1i(\"u_texture\", i));\n    }\n\n    let w = -1;\n\n    for (const n of o) {\n      if (!n.layerData.has(p)) continue;\n      n.key.level !== w && (w = n.key.level, y.setDataUniforms(T, l, g, w, d));\n      const a = 2 ** (l - w) / c;\n      T.setUniform1f(\"u_zoomFactor\", a);\n      const r = n.layerData.get(p);\n      if (!r.lineIndexCount) continue;\n      r.prepareForRendering(s);\n      const o = r.lineVertexArrayObject;\n\n      if (!t(o)) {\n        if (s.bindVAO(o), T.setUniformMatrix3fv(\"u_dvsMat3\", n.transforms.dvs), s.setStencilFunction(514, n.stencilRef, 255), P || V) {\n          const t = r.patternMap;\n          if (!t) continue;\n\n          for (const [n, a] of t) {\n            const t = d.getPageSize(n);\n            e(t) && (d.bind(s, 9729, n, i), T.setUniform2fv(\"u_mosaicSize\", t), T.setUniform1i(\"u_texture\", i), s.drawElements(4, a[1], 5125, Uint32Array.BYTES_PER_ELEMENT * a[0]));\n          }\n        } else s.drawElements(4, r.lineIndexCount, 5125, Uint32Array.BYTES_PER_ELEMENT * r.lineIndexStart);\n\n        n.triangleCount += r.lineIndexCount / 3;\n      }\n    }\n  }\n\n}\n\nexport { o as WGLBrushVTLLine };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushVTLLine.js"],"names":["isSome","e","isNone","t","VTL_TEXTURE_BINDING_UNIT_SPRITES","i","WGLDrawPhase","n","u32to4Xu8","a","r","o","constructor","arguments","_programOptions","id","pattern","sdf","dispose","drawMany","context","s","displayLevel","l","state","f","drawPhase","m","painter","u","pixelRatio","c","spriteMosaic","d","styleLayerUID","p","some","layerData","get","lineIndexCount","g","styleLayer","y","lineMaterial","M","vectorTilesMaterialManager","v","getPaintValue","_","U","getPaintProperty","x","P","isDataDriven","E","D","getValue","getMosaicItemPosition","V","getDashKey","getLayoutValue","h","I","HITTEST","S","T","getMaterialProgram","useProgram","setUniformMatrix3fv","displayViewMat3","displayMat3","setUniform2fv","setUniform1f","z","setUniform4fv","page","getPageSize","bind","setUniform1i","w","has","key","level","setDataUniforms","prepareForRendering","lineVertexArrayObject","bindVAO","transforms","dvs","setStencilFunction","stencilRef","patternMap","drawElements","Uint32Array","BYTES_PER_ELEMENT","lineIndexStart","triangleCount","WGLBrushVTLLine"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../../../core/maybe.js\";import{VTL_TEXTURE_BINDING_UNIT_SPRITES as i}from\"../definitions.js\";import{WGLDrawPhase as n}from\"../enums.js\";import{u32to4Xu8 as a}from\"../number.js\";import r from\"./WGLBrush.js\";class o extends r{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(r,o){const{context:s,displayLevel:l,state:f,drawPhase:m,painter:u,pixelRatio:c,spriteMosaic:d,styleLayerUID:p}=r;if(!o.some((e=>{var t,i;return null!=(t=null==(i=e.layerData.get(p))?void 0:i.lineIndexCount)&&t})))return;const g=r.styleLayer,y=g.lineMaterial,M=u.vectorTilesMaterialManager,v=g.getPaintValue(\"line-translate\",l),_=g.getPaintValue(\"line-translate-anchor\",l),U=g.getPaintProperty(\"line-pattern\"),x=void 0!==U,P=x&&U.isDataDriven;let E,D;if(x&&!P){const e=U.getValue(l);E=d.getMosaicItemPosition(e)}let V=!1;if(!x){const e=g.getPaintProperty(\"line-dasharray\");if(D=void 0!==e,V=D&&e.isDataDriven,D&&!V){const t=e.getValue(l),i=g.getDashKey(t,g.getLayoutValue(\"line-cap\",l));E=d.getMosaicItemPosition(i)}}const h=1/c,I=m===n.HITTEST,S=this._programOptions;S.id=I,S.pattern=x,S.sdf=D;const T=M.getMaterialProgram(s,y,S);if(s.useProgram(T),T.setUniformMatrix3fv(\"u_displayViewMat3\",f.displayViewMat3),T.setUniformMatrix3fv(\"u_displayMat3\",1===_?f.displayMat3:f.displayViewMat3),T.setUniform2fv(\"u_lineTranslation\",v),T.setUniform1f(\"u_depth\",g.z),T.setUniform1f(\"u_antialiasing\",h),I){const e=a(p+1);T.setUniform4fv(\"u_id\",e)}if(E&&e(E)){const{page:t}=E,n=d.getPageSize(t);e(n)&&(d.bind(s,9729,t,i),T.setUniform2fv(\"u_mosaicSize\",n),T.setUniform1i(\"u_texture\",i))}let w=-1;for(const n of o){if(!n.layerData.has(p))continue;n.key.level!==w&&(w=n.key.level,y.setDataUniforms(T,l,g,w,d));const a=2**(l-w)/c;T.setUniform1f(\"u_zoomFactor\",a);const r=n.layerData.get(p);if(!r.lineIndexCount)continue;r.prepareForRendering(s);const o=r.lineVertexArrayObject;if(!t(o)){if(s.bindVAO(o),T.setUniformMatrix3fv(\"u_dvsMat3\",n.transforms.dvs),s.setStencilFunction(514,n.stencilRef,255),P||V){const t=r.patternMap;if(!t)continue;for(const[n,a]of t){const t=d.getPageSize(n);e(t)&&(d.bind(s,9729,n,i),T.setUniform2fv(\"u_mosaicSize\",t),T.setUniform1i(\"u_texture\",i),s.drawElements(4,a[1],5125,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else s.drawElements(4,r.lineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);n.triangleCount+=r.lineIndexCount/3}}}}export{o as WGLBrushVTLLine};\n"]},"metadata":{},"sourceType":"module"}