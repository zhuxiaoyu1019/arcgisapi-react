{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport { isSome as t, isNone as r, unwrap as o } from \"../../../../core/maybe.js\";\nimport { getMetersPerUnitForSR as a } from \"../../../../core/unitUtils.js\";\nimport { e as i } from \"../../../../chunks/earcut.js\";\nimport { I as n } from \"../../../../chunks/mat4f64.js\";\nimport { s } from \"../../../../chunks/vec2.js\";\nimport { f as l, a as u } from \"../../../../chunks/vec2f64.js\";\nimport { b as c, s as m } from \"../../../../chunks/vec4.js\";\nimport { t as h } from \"../../../../chunks/common.js\";\nimport { empty as d, expandWithBuffer as p, intersectsClippingArea as g, expandWithAABB as y, create as f } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { empty as _, expandPointInPlace as v, create as x } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { perVertexElevationAligner as D } from \"./ElevationAligners.js\";\nimport { elevationModeChangeUpdateType as b, SymbolUpdateType as C, needsElevationUpdates2D as E } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as w } from \"./ElevationContext.js\";\nimport G from \"./Graphics3DDrapedGraphicLayer.js\";\nimport { Graphics3DObject3DGraphicLayer as S } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as j } from \"./Graphics3DSymbolLayer.js\";\nimport { geometryAsPolygon as T, geometryToRenderInfo as A, createWaterGeometry as P, geometryToRenderInfoDraped as U } from \"./polygonUtils.js\";\nimport { Object3D as M } from \"../../webgl-engine/lib/Object3D.js\";\nimport { RenderGeometry as B } from \"../../webgl-engine/lib/RenderGeometry.js\";\nimport { WaterMaterial as O } from \"../../webgl-engine/materials/WaterMaterial.js\";\nimport { defaultWaterMaterialParameters as R, wavePresets as L } from \"../../webgl-engine/materials/internal/waterMaterialUtils.js\";\nconst N = [\"polyline\", \"polygon\", \"extent\"];\n\nclass V extends j {\n  constructor(e, t, r, o) {\n    super(e, t, r, o);\n  }\n\n  async doLoad() {}\n\n  destroy() {\n    super.destroy(), this._context.stage.remove(this._material), this._material = null;\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry, N, this.symbolLayer.type)) return null;\n    const r = this.setGraphicElevationContext(t, new w());\n    return this.ensureDrapedStatus(\"on-the-ground\" === r.mode), this.ensureMaterial(), this.draped ? this._createAsOverlay(t) : this._createAs3DShape(t, r, t.uid);\n  }\n\n  ensureMaterial() {\n    if (t(this._material)) return;\n    const r = { ...R\n    },\n          o = this.symbolLayer.color;\n    t(o) && (r.color = e.toUnitRGBA(o));\n\n    const a = this._getCombinedOpacity(o, {\n      hasIntrinsicColor: !0\n    });\n\n    r.color = [r.color[0], r.color[1], r.color[2], a], r.transparent = a < 1 || this.needsDrivenTransparentPass, r.waveDirection = t(this.symbolLayer.waveDirection) ? V.headingVectorFromAngle(this.symbolLayer.waveDirection) : l(0, 0);\n    const i = this.symbolLayer.waveStrength + \"-\" + this.symbolLayer.waterbodySize,\n          n = L[i];\n    r.waveStrength = n.waveStrength, r.waveTextureRepeat = n.textureRepeat, r.waveVelocity = n.waveVelocity, r.flowStrength = n.perturbationStrength, r.slicePlaneEnabled = this._context.slicePlaneEnabled, r.isDraped = this.draped, this._material = new O(r), this._context.stage.add(this._material);\n  }\n\n  layerOpacityChanged() {\n    if (r(this._material)) return !0;\n\n    const e = this._material.params.color,\n          t = this._getCombinedOpacity(this.symbolLayer.color, {\n      hasIntrinsicColor: !0\n    }),\n          o = t < 1 || this.needsDrivenTransparentPass;\n\n    return this._material.setParameterValues({\n      color: [e[0], e[1], e[2], t],\n      transparent: o\n    }), !0;\n  }\n\n  layerElevationInfoChanged(e, t, r) {\n    const o = this._elevationContext.mode,\n          a = b(V.elevationModeChangeTypes, r, o);\n    if (a !== C.UPDATE) return a;\n    const i = E(o);\n    return this.updateGraphics3DGraphicElevationInfo(e, t, () => i);\n  }\n\n  slicePlaneEnabledChanged() {\n    return t(this._material) && this._material.setParameterValues({\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    }), !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    return !0;\n  }\n\n  pixelRatioChanged() {\n    return !0;\n  }\n\n  _createAs3DShape(e, t, o) {\n    const a = T(e.geometry);\n    if (r(a)) return null;\n    z.renderData = A(a, this._context.elevationProvider, this._context.renderCoordsHelper, t);\n    const i = z.renderData.position.length / 3;\n    if (z.uvCoords = new Float64Array(2 * i), z.outNum = 0, z.outGeometries = [], z.outTransforms = [], z.outMaterials = [], this._create3DShapeGeometries(z), this._logGeometryCreationWarnings(z.renderData, a.rings, \"rings\", \"WaterSymbol3DLayer\"), 0 === z.outNum) return null;\n\n    this._createUVCoordsFromVertices(z.uvCoords, z.renderData.mapPosition, i, this._context.elevationProvider.spatialReference);\n\n    const n = new M({\n      geometries: z.outGeometries,\n      materials: z.outMaterials,\n      transformations: z.outTransforms,\n      castShadow: !1,\n      metadata: {\n        layerUid: this._context.layer.uid,\n        graphicUid: o\n      }\n    }),\n          s = D,\n          l = new S(this, n, z.outGeometries, null, null, s, t);\n    return l.alignedSampledElevation = z.renderData.sampledElevation, l.needsElevationUpdates = E(t.mode), l;\n  }\n\n  _createUVCoordsFromVertices(e, t, r, o) {\n    const i = a(o);\n\n    _(I);\n\n    for (let a = 0; a < r; a++) s(W, t[3 * a + 0], t[3 * a + 1]), v(I, W);\n\n    c(I, I, i);\n    const n = I[0] % V.unitSizeOfTexture,\n          l = I[1] % V.unitSizeOfTexture;\n    F[0] = I[0] - n, F[1] = I[1] - l;\n\n    for (let a = 0; a < r; a++) e[2 * a + 0] = (t[3 * a + 0] * i - F[0]) / V.unitSizeOfTexture, e[2 * a + 1] = (t[3 * a + 1] * i - F[1]) / V.unitSizeOfTexture;\n  }\n\n  _create3DShapeGeometries(e) {\n    const r = e.renderData.polygons,\n          a = e.uvCoords;\n\n    for (const {\n      count: s,\n      index: l,\n      position: u,\n      mapPosition: c,\n      holeIndices: m\n    } of r) {\n      if (t(this._context.clippingExtent) && (d(k), p(k, c), !g(k, this._context.clippingExtent))) continue;\n      const r = i(c, m, 3);\n      if (0 === r.length) continue;\n      const h = new Uint32Array(r),\n            y = new Float64Array(a.buffer, 2 * l * a.BYTES_PER_ELEMENT, 2 * s),\n            f = P({\n        indices: h,\n        attributeData: {\n          position: u,\n          uv0: y,\n          mapPosition: c\n        }\n      });\n      e.outGeometries.push(f), e.outMaterials.push(o(this._material)), e.outTransforms.push(n), e.outNum++;\n    }\n  }\n\n  _createAsOverlay(e) {\n    const t = T(e.geometry);\n    if (r(t)) return null;\n    o(this._material).renderPriority = this._renderPriority, Y.renderData = U(t, this._context.overlaySR);\n    const a = Y.renderData.position.length / 3;\n    return Y.uvCoords = new Float64Array(2 * a), Y.outNum = 0, Y.outGeometries = [], Y.outBoundingBox = d(), Y.layerUid = this._context.layer.uid, Y.graphicsUid = e.uid, this._createAsOverlayWater(Y), this._logGeometryCreationWarnings(Y.renderData, t.rings, \"rings\", \"WaterSymbol3DLayer\"), 0 === Y.outNum ? null : (this._createUVCoordsFromVertices(Y.uvCoords, Y.renderData.position, a, this._context.overlaySR), Y.outNum > 0 ? new G(this, Y.outGeometries, Y.outBoundingBox) : null);\n  }\n\n  _createAsOverlayWater(e) {\n    const t = e.uvCoords,\n          r = e.renderData.polygons;\n\n    for (const {\n      position: a,\n      holeIndices: n,\n      index: s,\n      count: l\n    } of r) {\n      if (d(k), p(k, a), !g(k, this._context.clippingExtent)) continue;\n      y(e.outBoundingBox, k);\n      const r = i(a, n, 3);\n      if (0 === r.length) continue;\n      const u = new Uint32Array(r),\n            c = new Float64Array(t.buffer, 2 * s * t.BYTES_PER_ELEMENT, 2 * l),\n            h = P({\n        indices: u,\n        attributeData: {\n          position: a,\n          uv0: c\n        }\n      }),\n            f = new B(h, o(this._material), e.layerUid, e.graphicsUid),\n            _ = k;\n      m(f.boundingSphere, .5 * (_[0] + _[3]), .5 * (_[1] + _[4]), 0, .5 * Math.sqrt((_[3] - _[0]) * (_[3] - _[0]) + (_[4] - _[1]) * (_[4] - _[1]))), e.outGeometries.push(f), e.outNum++;\n    }\n  }\n\n  static headingVectorFromAngle(e) {\n    const t = u(),\n          r = h(e);\n    return t[0] = Math.sin(r), t[1] = Math.cos(r), t;\n  }\n\n  get test() {\n    return {\n      create3DShape: e => this._createAs3DShape(e.graphic, e.elevationContext, e.graphicUid),\n      ensureMaterial: () => this.ensureMaterial()\n    };\n  }\n\n}\n\nV.unitSizeOfTexture = 100, V.elevationModeChangeTypes = {\n  definedChanged: C.RECREATE,\n  staysOnTheGround: C.NONE,\n  onTheGroundChanged: C.RECREATE\n};\nconst F = u(),\n      I = x(),\n      W = u(),\n      k = f(),\n      z = {\n  renderData: null,\n  uvCoords: null,\n  outNum: 0,\n  outBoundingBox: null,\n  outGeometries: null,\n  outMaterials: null,\n  outTransforms: null\n},\n      Y = {\n  renderData: null,\n  uvCoords: null,\n  outNum: 0,\n  outBoundingBox: null,\n  outGeometries: null,\n  outMaterials: null,\n  outTransforms: null\n};\nexport default V;\nexport { V as Graphics3DWaterSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DWaterSymbolLayer.js"],"names":["e","isSome","t","isNone","r","unwrap","o","getMetersPerUnitForSR","a","i","I","n","s","f","l","u","b","c","m","h","empty","d","expandWithBuffer","p","intersectsClippingArea","g","expandWithAABB","y","create","_","expandPointInPlace","v","x","perVertexElevationAligner","D","elevationModeChangeUpdateType","SymbolUpdateType","C","needsElevationUpdates2D","E","ElevationContext","w","G","Graphics3DObject3DGraphicLayer","S","Graphics3DSymbolLayer","j","geometryAsPolygon","T","geometryToRenderInfo","A","createWaterGeometry","P","geometryToRenderInfoDraped","U","Object3D","M","RenderGeometry","B","WaterMaterial","O","defaultWaterMaterialParameters","R","wavePresets","L","N","V","constructor","doLoad","destroy","_context","stage","remove","_material","createGraphics3DGraphic","graphic","_validateGeometry","geometry","symbolLayer","type","setGraphicElevationContext","ensureDrapedStatus","mode","ensureMaterial","draped","_createAsOverlay","_createAs3DShape","uid","color","toUnitRGBA","_getCombinedOpacity","hasIntrinsicColor","transparent","needsDrivenTransparentPass","waveDirection","headingVectorFromAngle","waveStrength","waterbodySize","waveTextureRepeat","textureRepeat","waveVelocity","flowStrength","perturbationStrength","slicePlaneEnabled","isDraped","add","layerOpacityChanged","params","setParameterValues","layerElevationInfoChanged","_elevationContext","elevationModeChangeTypes","UPDATE","updateGraphics3DGraphicElevationInfo","slicePlaneEnabledChanged","physicalBasedRenderingChanged","pixelRatioChanged","z","renderData","elevationProvider","renderCoordsHelper","position","length","uvCoords","Float64Array","outNum","outGeometries","outTransforms","outMaterials","_create3DShapeGeometries","_logGeometryCreationWarnings","rings","_createUVCoordsFromVertices","mapPosition","spatialReference","geometries","materials","transformations","castShadow","metadata","layerUid","layer","graphicUid","alignedSampledElevation","sampledElevation","needsElevationUpdates","W","unitSizeOfTexture","F","polygons","count","index","holeIndices","clippingExtent","k","Uint32Array","buffer","BYTES_PER_ELEMENT","indices","attributeData","uv0","push","renderPriority","_renderPriority","Y","overlaySR","outBoundingBox","graphicsUid","_createAsOverlayWater","boundingSphere","Math","sqrt","sin","cos","test","create3DShape","elevationContext","definedChanged","RECREATE","staysOnTheGround","NONE","onTheGroundChanged","Graphics3DWaterSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import{isSome as t,isNone as r,unwrap as o}from\"../../../../core/maybe.js\";import{getMetersPerUnitForSR as a}from\"../../../../core/unitUtils.js\";import{e as i}from\"../../../../chunks/earcut.js\";import{I as n}from\"../../../../chunks/mat4f64.js\";import{s}from\"../../../../chunks/vec2.js\";import{f as l,a as u}from\"../../../../chunks/vec2f64.js\";import{b as c,s as m}from\"../../../../chunks/vec4.js\";import{t as h}from\"../../../../chunks/common.js\";import{empty as d,expandWithBuffer as p,intersectsClippingArea as g,expandWithAABB as y,create as f}from\"../../../../geometry/support/aaBoundingBox.js\";import{empty as _,expandPointInPlace as v,create as x}from\"../../../../geometry/support/aaBoundingRect.js\";import{perVertexElevationAligner as D}from\"./ElevationAligners.js\";import{elevationModeChangeUpdateType as b,SymbolUpdateType as C,needsElevationUpdates2D as E}from\"./elevationAlignmentUtils.js\";import{ElevationContext as w}from\"./ElevationContext.js\";import G from\"./Graphics3DDrapedGraphicLayer.js\";import{Graphics3DObject3DGraphicLayer as S}from\"./Graphics3DObject3DGraphicLayer.js\";import{Graphics3DSymbolLayer as j}from\"./Graphics3DSymbolLayer.js\";import{geometryAsPolygon as T,geometryToRenderInfo as A,createWaterGeometry as P,geometryToRenderInfoDraped as U}from\"./polygonUtils.js\";import{Object3D as M}from\"../../webgl-engine/lib/Object3D.js\";import{RenderGeometry as B}from\"../../webgl-engine/lib/RenderGeometry.js\";import{WaterMaterial as O}from\"../../webgl-engine/materials/WaterMaterial.js\";import{defaultWaterMaterialParameters as R,wavePresets as L}from\"../../webgl-engine/materials/internal/waterMaterialUtils.js\";const N=[\"polyline\",\"polygon\",\"extent\"];class V extends j{constructor(e,t,r,o){super(e,t,r,o)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,N,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new w);return this.ensureDrapedStatus(\"on-the-ground\"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(t(this._material))return;const r={...R},o=this.symbolLayer.color;t(o)&&(r.color=e.toUnitRGBA(o));const a=this._getCombinedOpacity(o,{hasIntrinsicColor:!0});r.color=[r.color[0],r.color[1],r.color[2],a],r.transparent=a<1||this.needsDrivenTransparentPass,r.waveDirection=t(this.symbolLayer.waveDirection)?V.headingVectorFromAngle(this.symbolLayer.waveDirection):l(0,0);const i=this.symbolLayer.waveStrength+\"-\"+this.symbolLayer.waterbodySize,n=L[i];r.waveStrength=n.waveStrength,r.waveTextureRepeat=n.textureRepeat,r.waveVelocity=n.waveVelocity,r.flowStrength=n.perturbationStrength,r.slicePlaneEnabled=this._context.slicePlaneEnabled,r.isDraped=this.draped,this._material=new O(r),this._context.stage.add(this._material)}layerOpacityChanged(){if(r(this._material))return!0;const e=this._material.params.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),o=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({color:[e[0],e[1],e[2],t],transparent:o}),!0}layerElevationInfoChanged(e,t,r){const o=this._elevationContext.mode,a=b(V.elevationModeChangeTypes,r,o);if(a!==C.UPDATE)return a;const i=E(o);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>i))}slicePlaneEnabledChanged(){return t(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,o){const a=T(e.geometry);if(r(a))return null;z.renderData=A(a,this._context.elevationProvider,this._context.renderCoordsHelper,t);const i=z.renderData.position.length/3;if(z.uvCoords=new Float64Array(2*i),z.outNum=0,z.outGeometries=[],z.outTransforms=[],z.outMaterials=[],this._create3DShapeGeometries(z),this._logGeometryCreationWarnings(z.renderData,a.rings,\"rings\",\"WaterSymbol3DLayer\"),0===z.outNum)return null;this._createUVCoordsFromVertices(z.uvCoords,z.renderData.mapPosition,i,this._context.elevationProvider.spatialReference);const n=new M({geometries:z.outGeometries,materials:z.outMaterials,transformations:z.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:o}}),s=D,l=new S(this,n,z.outGeometries,null,null,s,t);return l.alignedSampledElevation=z.renderData.sampledElevation,l.needsElevationUpdates=E(t.mode),l}_createUVCoordsFromVertices(e,t,r,o){const i=a(o);_(I);for(let a=0;a<r;a++)s(W,t[3*a+0],t[3*a+1]),v(I,W);c(I,I,i);const n=I[0]%V.unitSizeOfTexture,l=I[1]%V.unitSizeOfTexture;F[0]=I[0]-n,F[1]=I[1]-l;for(let a=0;a<r;a++)e[2*a+0]=(t[3*a+0]*i-F[0])/V.unitSizeOfTexture,e[2*a+1]=(t[3*a+1]*i-F[1])/V.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,a=e.uvCoords;for(const{count:s,index:l,position:u,mapPosition:c,holeIndices:m}of r){if(t(this._context.clippingExtent)&&(d(k),p(k,c),!g(k,this._context.clippingExtent)))continue;const r=i(c,m,3);if(0===r.length)continue;const h=new Uint32Array(r),y=new Float64Array(a.buffer,2*l*a.BYTES_PER_ELEMENT,2*s),f=P({indices:h,attributeData:{position:u,uv0:y,mapPosition:c}});e.outGeometries.push(f),e.outMaterials.push(o(this._material)),e.outTransforms.push(n),e.outNum++}}_createAsOverlay(e){const t=T(e.geometry);if(r(t))return null;o(this._material).renderPriority=this._renderPriority,Y.renderData=U(t,this._context.overlaySR);const a=Y.renderData.position.length/3;return Y.uvCoords=new Float64Array(2*a),Y.outNum=0,Y.outGeometries=[],Y.outBoundingBox=d(),Y.layerUid=this._context.layer.uid,Y.graphicsUid=e.uid,this._createAsOverlayWater(Y),this._logGeometryCreationWarnings(Y.renderData,t.rings,\"rings\",\"WaterSymbol3DLayer\"),0===Y.outNum?null:(this._createUVCoordsFromVertices(Y.uvCoords,Y.renderData.position,a,this._context.overlaySR),Y.outNum>0?new G(this,Y.outGeometries,Y.outBoundingBox):null)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:a,holeIndices:n,index:s,count:l}of r){if(d(k),p(k,a),!g(k,this._context.clippingExtent))continue;y(e.outBoundingBox,k);const r=i(a,n,3);if(0===r.length)continue;const u=new Uint32Array(r),c=new Float64Array(t.buffer,2*s*t.BYTES_PER_ELEMENT,2*l),h=P({indices:u,attributeData:{position:a,uv0:c}}),f=new B(h,o(this._material),e.layerUid,e.graphicsUid),_=k;m(f.boundingSphere,.5*(_[0]+_[3]),.5*(_[1]+_[4]),0,.5*Math.sqrt((_[3]-_[0])*(_[3]-_[0])+(_[4]-_[1])*(_[4]-_[1]))),e.outGeometries.push(f),e.outNum++}}static headingVectorFromAngle(e){const t=u(),r=h(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}get test(){return{create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}V.unitSizeOfTexture=100,V.elevationModeChangeTypes={definedChanged:C.RECREATE,staysOnTheGround:C.NONE,onTheGroundChanged:C.RECREATE};const F=u(),I=x(),W=u(),k=f(),z={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Y={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};export default V;export{V as Graphics3DWaterSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}