{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../../core/Evented.js\";\nimport i from \"../../../../../core/Handles.js\";\nimport { isSome as r } from \"../../../../../core/maybe.js\";\nimport { createDeferred as s, throwIfAborted as a, whenOrAbort as n } from \"../../../../../core/promiseUtils.js\";\nimport { whenNotOnce as o } from \"../../../../../core/watchUtils.js\";\nimport { property as p } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as u } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport l from \"../../../../../geometry/SpatialReference.js\";\nimport c from \"../../../../../layers/graphics/data/FeatureStore.js\";\nimport d from \"../../../../../layers/graphics/data/QueryEngine.js\";\nimport h from \"../../../../../layers/support/TileInfo.js\";\nimport f from \"../../../../../layers/support/TimeInfo.js\";\nimport m from \"../../../../../rest/support/Query.js\";\nimport { FeatureServiceTiledFetcher as g } from \"./FeatureServiceTiledFetcher.js\";\nimport { FeatureServiceTileStore as y } from \"./FeatureServiceTileStore.js\";\nimport { WatchUpdatingTracking as S } from \"../../../../support/WatchUpdatingTracking.js\";\nlet w = class extends t.EventedAccessor {\n  constructor() {\n    super(...arguments), this.isInitializing = !0, this.whenSetup = s(), this.handles = new i(), this.updatingHandles = new S(), this.pendingApplyEdits = new Map();\n  }\n\n  get updating() {\n    return this.featureFetcher.updating || this.isInitializing || this.updatingHandles.updating;\n  }\n\n  destroy() {\n    this.featureFetcher.destroy(), this.queryEngine.destroy(), this.featureStore.clear(), this.handles.destroy();\n  }\n\n  async setup(e) {\n    const {\n      geometryType: t,\n      objectIdField: i,\n      timeInfo: r,\n      fields: s\n    } = e.serviceInfo;\n    return this.featureStore = new c({ ...e.serviceInfo,\n      hasZ: !1,\n      hasM: !1\n    }), this.queryEngine = new d({\n      spatialReference: e.spatialReference,\n      featureStore: this.featureStore,\n      geometryType: t,\n      fields: s,\n      hasZ: !1,\n      hasM: !1,\n      objectIdField: i,\n      timeInfo: r ? f.fromJSON(r) : null\n    }), this.featureFetcher = new g({\n      store: new y({\n        featureStore: this.featureStore\n      }),\n      url: e.serviceInfo.url,\n      objectIdField: e.serviceInfo.objectIdField,\n      globalIdField: e.serviceInfo.globalIdField,\n      capabilities: e.serviceInfo.capabilities,\n      spatialReference: l.fromJSON(e.spatialReference),\n      sourceSpatialReference: l.fromJSON(e.serviceInfo.spatialReference)\n    }), this.handles.add([this.featureFetcher.watch(\"availability\", e => this.emit(\"notify-availability\", {\n      availability: e\n    }), !0), this.watch(\"updating\", () => this.notifyUpdating())]), this.whenSetup.resolve(), this.isInitializing = !1, this.configure(e.configuration);\n  }\n\n  async configure(e) {\n    return await this.updatingHandles.addPromise(this.whenSetup.promise), this.updateFeatureFetcherConfiguration(e), {\n      result: {}\n    };\n  }\n\n  async fetchCandidates(e, t) {\n    await this.whenSetup.promise, a(t);\n    return {\n      result: await this.queryEngine.executeQueryForSnapping({\n        point: e.point,\n        distance: e.distance,\n        types: e.types,\n        query: r(e.filter) ? e.filter : {\n          where: \"1=1\"\n        }\n      }, r(t) ? t.signal : null)\n    };\n  }\n\n  async updateTiles(e, t) {\n    return await this.updatingHandles.addPromise(this.whenSetup.promise), a(t), this.featureFetcher.tileSize = e.tileSize, this.featureFetcher.tilesOfInterest = e.tiles, this.featureFetcher.tileInfo = r(e.tileInfo) ? h.fromJSON(e.tileInfo) : null, {\n      result: {}\n    };\n  }\n\n  async refresh(e, t) {\n    return await this.updatingHandles.addPromise(this.whenSetup.promise), a(t), this.featureFetcher.refresh(), {\n      result: {}\n    };\n  }\n\n  async whenNotUpdating(e, t) {\n    return await this.updatingHandles.addPromise(this.whenSetup.promise), a(t), await n(o(this, \"updating\"), t), {\n      result: {}\n    };\n  }\n\n  async getDebugInfo(e, t) {\n    return a(t), {\n      result: this.featureFetcher.debugInfo\n    };\n  }\n\n  async beginApplyEdits(e, t) {\n    this.updatingHandles.addPromise(this.whenSetup.promise), a(t);\n    const i = s();\n    return this.pendingApplyEdits.set(e.id, i), this.featureFetcher.applyEdits(i.promise), this.updatingHandles.addPromise(i.promise), {\n      result: {}\n    };\n  }\n\n  async endApplyEdits(e, t) {\n    const i = this.pendingApplyEdits.get(e.id);\n    return i && i.resolve(e.edits), a(t), {\n      result: {}\n    };\n  }\n\n  updateFeatureFetcherConfiguration(e) {\n    this.featureFetcher.filter = r(e.filter) ? m.fromJSON(e.filter) : null, this.featureFetcher.customParameters = e.customParameters;\n  }\n\n  notifyUpdating() {\n    this.emit(\"notify-updating\", {\n      updating: this.updating\n    });\n  }\n\n};\n\nfunction F() {\n  return new w();\n}\n\ne([p({\n  readOnly: !0\n})], w.prototype, \"updating\", null), e([p()], w.prototype, \"isInitializing\", void 0), w = e([u(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker\")], w);\nexport default F;\nexport { w as FeatureServiceSnappingSourceWorker };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceSnappingSourceWorker.js"],"names":["_","e","t","i","isSome","r","createDeferred","s","throwIfAborted","a","whenOrAbort","n","whenNotOnce","o","property","p","subclass","u","l","c","d","h","f","m","FeatureServiceTiledFetcher","g","FeatureServiceTileStore","y","WatchUpdatingTracking","S","w","EventedAccessor","constructor","arguments","isInitializing","whenSetup","handles","updatingHandles","pendingApplyEdits","Map","updating","featureFetcher","destroy","queryEngine","featureStore","clear","setup","geometryType","objectIdField","timeInfo","fields","serviceInfo","hasZ","hasM","spatialReference","fromJSON","store","url","globalIdField","capabilities","sourceSpatialReference","add","watch","emit","availability","notifyUpdating","resolve","configure","configuration","addPromise","promise","updateFeatureFetcherConfiguration","result","fetchCandidates","executeQueryForSnapping","point","distance","types","query","filter","where","signal","updateTiles","tileSize","tilesOfInterest","tiles","tileInfo","refresh","whenNotUpdating","getDebugInfo","debugInfo","beginApplyEdits","set","id","applyEdits","endApplyEdits","get","edits","customParameters","F","readOnly","prototype","FeatureServiceSnappingSourceWorker"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/Evented.js\";import i from\"../../../../../core/Handles.js\";import{isSome as r}from\"../../../../../core/maybe.js\";import{createDeferred as s,throwIfAborted as a,whenOrAbort as n}from\"../../../../../core/promiseUtils.js\";import{whenNotOnce as o}from\"../../../../../core/watchUtils.js\";import{property as p}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as u}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import l from\"../../../../../geometry/SpatialReference.js\";import c from\"../../../../../layers/graphics/data/FeatureStore.js\";import d from\"../../../../../layers/graphics/data/QueryEngine.js\";import h from\"../../../../../layers/support/TileInfo.js\";import f from\"../../../../../layers/support/TimeInfo.js\";import m from\"../../../../../rest/support/Query.js\";import{FeatureServiceTiledFetcher as g}from\"./FeatureServiceTiledFetcher.js\";import{FeatureServiceTileStore as y}from\"./FeatureServiceTileStore.js\";import{WatchUpdatingTracking as S}from\"../../../../support/WatchUpdatingTracking.js\";let w=class extends t.EventedAccessor{constructor(){super(...arguments),this.isInitializing=!0,this.whenSetup=s(),this.handles=new i,this.updatingHandles=new S,this.pendingApplyEdits=new Map}get updating(){return this.featureFetcher.updating||this.isInitializing||this.updatingHandles.updating}destroy(){this.featureFetcher.destroy(),this.queryEngine.destroy(),this.featureStore.clear(),this.handles.destroy()}async setup(e){const{geometryType:t,objectIdField:i,timeInfo:r,fields:s}=e.serviceInfo;return this.featureStore=new c({...e.serviceInfo,hasZ:!1,hasM:!1}),this.queryEngine=new d({spatialReference:e.spatialReference,featureStore:this.featureStore,geometryType:t,fields:s,hasZ:!1,hasM:!1,objectIdField:i,timeInfo:r?f.fromJSON(r):null}),this.featureFetcher=new g({store:new y({featureStore:this.featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:l.fromJSON(e.spatialReference),sourceSpatialReference:l.fromJSON(e.serviceInfo.spatialReference)}),this.handles.add([this.featureFetcher.watch(\"availability\",(e=>this.emit(\"notify-availability\",{availability:e})),!0),this.watch(\"updating\",(()=>this.notifyUpdating()))]),this.whenSetup.resolve(),this.isInitializing=!1,this.configure(e.configuration)}async configure(e){return await this.updatingHandles.addPromise(this.whenSetup.promise),this.updateFeatureFetcherConfiguration(e),{result:{}}}async fetchCandidates(e,t){await this.whenSetup.promise,a(t);return{result:await this.queryEngine.executeQueryForSnapping({point:e.point,distance:e.distance,types:e.types,query:r(e.filter)?e.filter:{where:\"1=1\"}},r(t)?t.signal:null)}}async updateTiles(e,t){return await this.updatingHandles.addPromise(this.whenSetup.promise),a(t),this.featureFetcher.tileSize=e.tileSize,this.featureFetcher.tilesOfInterest=e.tiles,this.featureFetcher.tileInfo=r(e.tileInfo)?h.fromJSON(e.tileInfo):null,{result:{}}}async refresh(e,t){return await this.updatingHandles.addPromise(this.whenSetup.promise),a(t),this.featureFetcher.refresh(),{result:{}}}async whenNotUpdating(e,t){return await this.updatingHandles.addPromise(this.whenSetup.promise),a(t),await n(o(this,\"updating\"),t),{result:{}}}async getDebugInfo(e,t){return a(t),{result:this.featureFetcher.debugInfo}}async beginApplyEdits(e,t){this.updatingHandles.addPromise(this.whenSetup.promise),a(t);const i=s();return this.pendingApplyEdits.set(e.id,i),this.featureFetcher.applyEdits(i.promise),this.updatingHandles.addPromise(i.promise),{result:{}}}async endApplyEdits(e,t){const i=this.pendingApplyEdits.get(e.id);return i&&i.resolve(e.edits),a(t),{result:{}}}updateFeatureFetcherConfiguration(e){this.featureFetcher.filter=r(e.filter)?m.fromJSON(e.filter):null,this.featureFetcher.customParameters=e.customParameters}notifyUpdating(){this.emit(\"notify-updating\",{updating:this.updating})}};function F(){return new w}e([p({readOnly:!0})],w.prototype,\"updating\",null),e([p()],w.prototype,\"isInitializing\",void 0),w=e([u(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker\")],w);export default F;export{w as FeatureServiceSnappingSourceWorker};\n"]},"metadata":{},"sourceType":"module"}