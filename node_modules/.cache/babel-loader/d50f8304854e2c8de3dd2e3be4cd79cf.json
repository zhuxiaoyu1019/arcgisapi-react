{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Logger.js\";\nimport { toPt as l } from \"../../../../../core/screenUtils.js\";\n\nconst o = 8,\n      t = o - 2,\n      r = e.getLogger(\"esri.renderers.visualVariables.support.utils\"),\n      s = e => {\n  if (!(\"visualVariables\" in e) || !e.visualVariables || !e.visualVariables.length) return e;\n  const l = e.clone(),\n        o = l.visualVariables.map(e => n(e) ? i(e) : e);\n  return l.visualVariables = o, l;\n};\n\nfunction a(e) {\n  return e.map(e => n(e) ? i(e.clone()) : e);\n}\n\nfunction n(e) {\n  return (\"size\" === e.type || \"color\" === e.type || \"opacity\" === e.type) && null != e.stops;\n}\n\nfunction i(e) {\n  return e.stops = b(e.type, e.stops), e;\n}\n\nfunction u(e, l, o) {\n  return (1 - o) * e + o * l;\n}\n\nfunction c(e, o) {\n  const [r, ...s] = o,\n        a = s.pop(),\n        n = s[0].value,\n        i = s[s.length - 1].value,\n        c = (i - n) / t,\n        p = [];\n\n  for (let t = n; t < i; t += c) {\n    let r = 0;\n\n    for (; t >= s[r].value;) r++;\n\n    const a = s[r],\n          n = o[r - 1],\n          i = t - n.value,\n          c = a.value === n.value ? 1 : i / (a.value - n.value);\n\n    if (\"color\" === e) {\n      const e = s[r],\n            l = o[r - 1],\n            a = e.color.clone();\n      a.r = u(l.color.r, a.r, c), a.g = u(l.color.g, a.g, c), a.b = u(l.color.b, a.b, c), a.a = u(l.color.a, a.a, c), p.push({\n        value: t,\n        color: a,\n        label: e.label\n      });\n    } else if (\"size\" === e) {\n      const e = s[r],\n            a = o[r - 1],\n            n = l(e.size),\n            i = u(l(a.size), n, c);\n      p.push({\n        value: t,\n        size: i,\n        label: e.label\n      });\n    } else {\n      const e = s[r],\n            l = u(o[r - 1].opacity, e.opacity, c);\n      p.push({\n        value: t,\n        opacity: l,\n        label: e.label\n      });\n    }\n  }\n\n  return [r, ...p, a];\n}\n\nfunction p(e) {\n  const [l, ...o] = e,\n        r = o.pop();\n\n  for (; o.length > t;) {\n    let e = 0,\n        l = 0;\n\n    for (let t = 1; t < o.length; t++) {\n      const r = o[t - 1],\n            s = o[t],\n            a = Math.abs(s.value - r.value);\n      a > l && (l = a, e = t);\n    }\n\n    o.splice(e, 1);\n  }\n\n  return [l, ...o, r];\n}\n\nfunction b(e, l) {\n  return l.length <= o ? l : (r.warn(`Found ${l.length} Visual Variable stops, but MapView only supports ${o}. Displayed stops will be simplified.`), l.length > 2 * o ? c(e, l) : p(l));\n}\n\nexport { s as simplifyVVRenderer, a as simplifyVisualVariables };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/layers/features/support/rendererUtils.js"],"names":["e","toPt","l","o","t","r","getLogger","s","visualVariables","length","clone","map","n","i","a","type","stops","b","u","c","pop","value","p","color","g","push","label","size","opacity","Math","abs","splice","warn","simplifyVVRenderer","simplifyVisualVariables"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Logger.js\";import{toPt as l}from\"../../../../../core/screenUtils.js\";const o=8,t=o-2,r=e.getLogger(\"esri.renderers.visualVariables.support.utils\"),s=e=>{if(!(\"visualVariables\"in e)||!e.visualVariables||!e.visualVariables.length)return e;const l=e.clone(),o=l.visualVariables.map((e=>n(e)?i(e):e));return l.visualVariables=o,l};function a(e){return e.map((e=>n(e)?i(e.clone()):e))}function n(e){return(\"size\"===e.type||\"color\"===e.type||\"opacity\"===e.type)&&null!=e.stops}function i(e){return e.stops=b(e.type,e.stops),e}function u(e,l,o){return(1-o)*e+o*l}function c(e,o){const[r,...s]=o,a=s.pop(),n=s[0].value,i=s[s.length-1].value,c=(i-n)/t,p=[];for(let t=n;t<i;t+=c){let r=0;for(;t>=s[r].value;)r++;const a=s[r],n=o[r-1],i=t-n.value,c=a.value===n.value?1:i/(a.value-n.value);if(\"color\"===e){const e=s[r],l=o[r-1],a=e.color.clone();a.r=u(l.color.r,a.r,c),a.g=u(l.color.g,a.g,c),a.b=u(l.color.b,a.b,c),a.a=u(l.color.a,a.a,c),p.push({value:t,color:a,label:e.label})}else if(\"size\"===e){const e=s[r],a=o[r-1],n=l(e.size),i=u(l(a.size),n,c);p.push({value:t,size:i,label:e.label})}else{const e=s[r],l=u(o[r-1].opacity,e.opacity,c);p.push({value:t,opacity:l,label:e.label})}}return[r,...p,a]}function p(e){const[l,...o]=e,r=o.pop();for(;o.length>t;){let e=0,l=0;for(let t=1;t<o.length;t++){const r=o[t-1],s=o[t],a=Math.abs(s.value-r.value);a>l&&(l=a,e=t)}o.splice(e,1)}return[l,...o,r]}function b(e,l){return l.length<=o?l:(r.warn(`Found ${l.length} Visual Variable stops, but MapView only supports ${o}. Displayed stops will be simplified.`),l.length>2*o?c(e,l):p(l))}export{s as simplifyVVRenderer,a as simplifyVisualVariables};\n"]},"metadata":{},"sourceType":"module"}