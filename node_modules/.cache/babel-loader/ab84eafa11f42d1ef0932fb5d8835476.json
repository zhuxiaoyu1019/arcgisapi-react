{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../core/has.js\";\nimport o from \"../../../core/Loadable.js\";\nimport { isSome as r } from \"../../../core/maybe.js\";\nimport { open as i } from \"../../../core/workers/workers.js\";\nimport { property as n } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as s } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport l from \"../../../rest/support/FeatureSet.js\";\nimport c from \"../../../geometry/Extent.js\";\nlet a = class extends o {\n  constructor(e) {\n    super(e), this.type = \"csv\";\n  }\n\n  load(e) {\n    const t = r(e) ? e.signal : null;\n    return this.addResolvingPromise(this._startWorker(t)), Promise.resolve(this);\n  }\n\n  destroy() {\n    var e;\n    null == (e = this._connection) || e.close(), this._connection = null;\n  }\n\n  openPorts() {\n    return this.load().then(() => this._connection.openPorts());\n  }\n\n  queryFeatures(e, t = {}) {\n    return this.load(t).then(() => this._connection.invoke(\"queryFeatures\", e ? e.toJSON() : null, t)).then(e => l.fromJSON(e));\n  }\n\n  queryFeaturesJSON(e, t = {}) {\n    return this.load(t).then(() => this._connection.invoke(\"queryFeatures\", e ? e.toJSON() : null, t));\n  }\n\n  queryFeatureCount(e, t = {}) {\n    return this.load(t).then(() => this._connection.invoke(\"queryFeatureCount\", e ? e.toJSON() : null, t));\n  }\n\n  queryObjectIds(e, t = {}) {\n    return this.load(t).then(() => this._connection.invoke(\"queryObjectIds\", e ? e.toJSON() : null, t));\n  }\n\n  queryExtent(e, t = {}) {\n    return this.load(t).then(() => this._connection.invoke(\"queryExtent\", e ? e.toJSON() : null, t)).then(e => ({\n      count: e.count,\n      extent: c.fromJSON(e.extent)\n    }));\n  }\n\n  querySnapping(e, t = {}) {\n    return this.load(t).then(() => this._connection.invoke(\"querySnapping\", e, t));\n  }\n\n  async _startWorker(e) {\n    this._connection = await i(\"CSVSourceWorker\", {\n      strategy: t(\"feature-layers-workers\") ? \"dedicated\" : \"local\",\n      signal: e\n    });\n    const o = await this._connection.invoke(\"load\", {\n      url: this.url,\n      parsing: {\n        columnDelimiter: this.delimiter,\n        fields: this.fields && this.fields.map(e => e.toJSON()),\n        latitudeField: this.latitudeField,\n        longitudeField: this.longitudeField,\n        spatialReference: this.spatialReference && this.spatialReference.toJSON(),\n        timeInfo: this.timeInfo && this.timeInfo.toJSON()\n      }\n    }, {\n      signal: e\n    });\n    this.locationInfo = o.locationInfo, this.sourceJSON = o.layerDefinition, this.columnDelimiter = o.columnDelimiter;\n  }\n\n};\ne([n()], a.prototype, \"type\", void 0), e([n()], a.prototype, \"url\", void 0), e([n()], a.prototype, \"delimiter\", void 0), e([n()], a.prototype, \"fields\", void 0), e([n()], a.prototype, \"latitudeField\", void 0), e([n()], a.prototype, \"longitudeField\", void 0), e([n()], a.prototype, \"spatialReference\", void 0), e([n()], a.prototype, \"timeInfo\", void 0), e([n()], a.prototype, \"locationInfo\", void 0), e([n()], a.prototype, \"sourceJSON\", void 0), e([n()], a.prototype, \"columnDelimiter\", void 0), a = e([s(\"esri.layers.graphics.sources.CSVSource\")], a);\nvar u = a;\nexport default u;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/graphics/sources/CSVSource.js"],"names":["_","e","t","o","isSome","r","open","i","property","n","subclass","s","l","c","a","constructor","type","load","signal","addResolvingPromise","_startWorker","Promise","resolve","destroy","_connection","close","openPorts","then","queryFeatures","invoke","toJSON","fromJSON","queryFeaturesJSON","queryFeatureCount","queryObjectIds","queryExtent","count","extent","querySnapping","strategy","url","parsing","columnDelimiter","delimiter","fields","map","latitudeField","longitudeField","spatialReference","timeInfo","locationInfo","sourceJSON","layerDefinition","prototype","u"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../core/has.js\";import o from\"../../../core/Loadable.js\";import{isSome as r}from\"../../../core/maybe.js\";import{open as i}from\"../../../core/workers/workers.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import l from\"../../../rest/support/FeatureSet.js\";import c from\"../../../geometry/Extent.js\";let a=class extends o{constructor(e){super(e),this.type=\"csv\"}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}openPorts(){return this.load().then((()=>this._connection.openPorts()))}queryFeatures(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryFeatures\",e?e.toJSON():null,t))).then((e=>l.fromJSON(e)))}queryFeaturesJSON(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryFeatures\",e?e.toJSON():null,t)))}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryFeatureCount\",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryObjectIds\",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryExtent\",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:c.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"querySnapping\",e,t)))}async _startWorker(e){this._connection=await i(\"CSVSourceWorker\",{strategy:t(\"feature-layers-workers\")?\"dedicated\":\"local\",signal:e});const o=await this._connection.invoke(\"load\",{url:this.url,parsing:{columnDelimiter:this.delimiter,fields:this.fields&&this.fields.map((e=>e.toJSON())),latitudeField:this.latitudeField,longitudeField:this.longitudeField,spatialReference:this.spatialReference&&this.spatialReference.toJSON(),timeInfo:this.timeInfo&&this.timeInfo.toJSON()}},{signal:e});this.locationInfo=o.locationInfo,this.sourceJSON=o.layerDefinition,this.columnDelimiter=o.columnDelimiter}};e([n()],a.prototype,\"type\",void 0),e([n()],a.prototype,\"url\",void 0),e([n()],a.prototype,\"delimiter\",void 0),e([n()],a.prototype,\"fields\",void 0),e([n()],a.prototype,\"latitudeField\",void 0),e([n()],a.prototype,\"longitudeField\",void 0),e([n()],a.prototype,\"spatialReference\",void 0),e([n()],a.prototype,\"timeInfo\",void 0),e([n()],a.prototype,\"locationInfo\",void 0),e([n()],a.prototype,\"sourceJSON\",void 0),e([n()],a.prototype,\"columnDelimiter\",void 0),a=e([s(\"esri.layers.graphics.sources.CSVSource\")],a);var u=a;export default u;\n"]},"metadata":{},"sourceType":"module"}