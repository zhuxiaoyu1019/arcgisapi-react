{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../core/clock.js\";\nimport { InputHandler as e } from \"../InputHandler.js\";\nimport { euclideanDistance as i } from \"./support.js\";\nconst n = {\n  maximumClickDelay: 300,\n  movementUntilMouseDrag: 1.5,\n  movementUntilPenDrag: 6,\n  movementUntilTouchDrag: 6,\n  holdDelay: 500\n};\n\nclass o extends e {\n  constructor(e = n.maximumClickDelay, i = n.movementUntilMouseDrag, o = n.movementUntilPenDrag, r = n.movementUntilTouchDrag, s = n.holdDelay, a = t) {\n    super(!1), this.maximumClickDelay = e, this.movementUntilMouseDrag = i, this.movementUntilPenDrag = o, this.movementUntilTouchDrag = r, this.holdDelay = s, this._clock = a, this._pointerState = new Map(), this._pointerDrag = this.registerOutgoing(\"pointer-drag\"), this._immediateClick = this.registerOutgoing(\"immediate-click\"), this._pointerHold = this.registerOutgoing(\"hold\"), this.registerIncoming(\"pointer-down\", this._handlePointerDown.bind(this)), this.registerIncoming(\"pointer-up\", t => {\n      this._handlePointerLoss(t, \"pointer-up\");\n    }), this.registerIncoming(\"pointer-capture-lost\", t => {\n      this._handlePointerLoss(t, \"pointer-capture-lost\");\n    }), this.registerIncoming(\"pointer-cancel\", t => {\n      this._handlePointerLoss(t, \"pointer-cancel\");\n    }), this._moveHandle = this.registerIncoming(\"pointer-move\", this._handlePointerMove.bind(this)), this._moveHandle.pause();\n  }\n\n  onUninstall() {\n    this._pointerState.forEach(t => {\n      null != t.holdTimeout && (t.holdTimeout.remove(), t.holdTimeout = null);\n    }), super.onUninstall();\n  }\n\n  _handlePointerDown(t) {\n    const e = t.data,\n          i = e.native.pointerId;\n    let n = null;\n    0 === this._pointerState.size && (n = this._clock.setTimeout(() => {\n      const e = this._pointerState.get(i);\n\n      if (e) {\n        if (!e.isDragging) {\n          const i = e.previousEvent;\n          this._pointerHold.emit(i, void 0, t.modifiers), e.holdEmitted = !0;\n        }\n\n        e.holdTimeout = null;\n      }\n    }, this.holdDelay));\n    const o = {\n      startEvent: e,\n      previousEvent: e,\n      startTimestamp: t.timestamp,\n      isDragging: !1,\n      downButton: e.native.button,\n      holdTimeout: n,\n      modifiers: new Set()\n    };\n    this._pointerState.set(i, o), this.startCapturingPointer(e.native), this._moveHandle.resume(), this._pointerState.size > 1 && this.startDragging(t);\n  }\n\n  _createPointerDragData(t, e, i) {\n    return {\n      action: t,\n      startEvent: e.startEvent,\n      previousEvent: e.previousEvent,\n      currentEvent: i\n    };\n  }\n\n  _handlePointerMove(t) {\n    const e = t.data,\n          n = e.native.pointerId,\n          o = this._pointerState.get(n);\n\n    if (o) {\n      if (o.isDragging) this._pointerDrag.emit(this._createPointerDragData(\"update\", o, e), void 0, o.modifiers);else {\n        i(e, o.startEvent) > this._getDragThreshold(e.native.pointerType) && this.startDragging(t);\n      }\n      o.previousEvent = e;\n    }\n  }\n\n  _getDragThreshold(t) {\n    switch (t) {\n      case \"touch\":\n        return this.movementUntilTouchDrag;\n\n      case \"pen\":\n        return this.movementUntilPenDrag;\n\n      case \"mouse\":\n      default:\n        return this.movementUntilMouseDrag;\n    }\n  }\n\n  startDragging(t) {\n    const e = t.data,\n          i = e.native.pointerId;\n\n    this._pointerState.forEach(n => {\n      null != n.holdTimeout && (n.holdTimeout.remove(), n.holdTimeout = null), n.isDragging || (n.modifiers = t.modifiers, n.isDragging = !0, i === n.startEvent.native.pointerId ? this._pointerDrag.emit(this._createPointerDragData(\"start\", n, e)) : this._pointerDrag.emit(this._createPointerDragData(\"start\", n, n.previousEvent), t.timestamp));\n    });\n  }\n\n  _handlePointerLoss(t, e) {\n    const i = t.data,\n          n = i.native.pointerId,\n          o = this._pointerState.get(n);\n\n    if (o) {\n      if (null != o.holdTimeout && (o.holdTimeout.remove(), o.holdTimeout = null), o.isDragging) this._pointerDrag.emit(this._createPointerDragData(\"end\", o, \"pointer-up\" === e ? i : o.previousEvent), void 0, o.modifiers);else if (\"pointer-up\" === e && o.downButton === i.native.button) {\n        t.timestamp - o.startTimestamp <= this.maximumClickDelay && !o.holdEmitted && this._immediateClick.emit(i);\n      }\n      this._pointerState.delete(n), this.stopCapturingPointer(i.native), 0 === this._pointerState.size && this._moveHandle.pause();\n    }\n  }\n\n}\n\nexport { n as DefaultParameters, o as PointerClickHoldAndDrag };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/input/recognizers/PointerClickHoldAndDrag.js"],"names":["t","InputHandler","e","euclideanDistance","i","n","maximumClickDelay","movementUntilMouseDrag","movementUntilPenDrag","movementUntilTouchDrag","holdDelay","o","constructor","r","s","a","_clock","_pointerState","Map","_pointerDrag","registerOutgoing","_immediateClick","_pointerHold","registerIncoming","_handlePointerDown","bind","_handlePointerLoss","_moveHandle","_handlePointerMove","pause","onUninstall","forEach","holdTimeout","remove","data","native","pointerId","size","setTimeout","get","isDragging","previousEvent","emit","modifiers","holdEmitted","startEvent","startTimestamp","timestamp","downButton","button","Set","set","startCapturingPointer","resume","startDragging","_createPointerDragData","action","currentEvent","_getDragThreshold","pointerType","delete","stopCapturingPointer","DefaultParameters","PointerClickHoldAndDrag"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../core/clock.js\";import{InputHandler as e}from\"../InputHandler.js\";import{euclideanDistance as i}from\"./support.js\";const n={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class o extends e{constructor(e=n.maximumClickDelay,i=n.movementUntilMouseDrag,o=n.movementUntilPenDrag,r=n.movementUntilTouchDrag,s=n.holdDelay,a=t){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=o,this.movementUntilTouchDrag=r,this.holdDelay=s,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing(\"pointer-drag\"),this._immediateClick=this.registerOutgoing(\"immediate-click\"),this._pointerHold=this.registerOutgoing(\"hold\"),this.registerIncoming(\"pointer-down\",this._handlePointerDown.bind(this)),this.registerIncoming(\"pointer-up\",(t=>{this._handlePointerLoss(t,\"pointer-up\")})),this.registerIncoming(\"pointer-capture-lost\",(t=>{this._handlePointerLoss(t,\"pointer-capture-lost\")})),this.registerIncoming(\"pointer-cancel\",(t=>{this._handlePointerLoss(t,\"pointer-cancel\")})),this._moveHandle=this.registerIncoming(\"pointer-move\",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((t=>{null!=t.holdTimeout&&(t.holdTimeout.remove(),t.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=e.native.pointerId;let n=null;0===this._pointerState.size&&(n=this._clock.setTimeout((()=>{const e=this._pointerState.get(i);if(e){if(!e.isDragging){const i=e.previousEvent;this._pointerHold.emit(i,void 0,t.modifiers),e.holdEmitted=!0}e.holdTimeout=null}}),this.holdDelay));const o={startEvent:e,previousEvent:e,startTimestamp:t.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,o),this.startCapturingPointer(e.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(t)}_createPointerDragData(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}_handlePointerMove(t){const e=t.data,n=e.native.pointerId,o=this._pointerState.get(n);if(o){if(o.isDragging)this._pointerDrag.emit(this._createPointerDragData(\"update\",o,e),void 0,o.modifiers);else{i(e,o.startEvent)>this._getDragThreshold(e.native.pointerType)&&this.startDragging(t)}o.previousEvent=e}}_getDragThreshold(t){switch(t){case\"touch\":return this.movementUntilTouchDrag;case\"pen\":return this.movementUntilPenDrag;case\"mouse\":default:return this.movementUntilMouseDrag}}startDragging(t){const e=t.data,i=e.native.pointerId;this._pointerState.forEach((n=>{null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=t.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData(\"start\",n,e)):this._pointerDrag.emit(this._createPointerDragData(\"start\",n,n.previousEvent),t.timestamp))}))}_handlePointerLoss(t,e){const i=t.data,n=i.native.pointerId,o=this._pointerState.get(n);if(o){if(null!=o.holdTimeout&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging)this._pointerDrag.emit(this._createPointerDragData(\"end\",o,\"pointer-up\"===e?i:o.previousEvent),void 0,o.modifiers);else if(\"pointer-up\"===e&&o.downButton===i.native.button){t.timestamp-o.startTimestamp<=this.maximumClickDelay&&!o.holdEmitted&&this._immediateClick.emit(i)}this._pointerState.delete(n),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause()}}}export{n as DefaultParameters,o as PointerClickHoldAndDrag};\n"]},"metadata":{},"sourceType":"module"}