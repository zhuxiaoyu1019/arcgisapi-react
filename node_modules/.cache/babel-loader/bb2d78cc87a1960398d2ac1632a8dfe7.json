{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport a from \"../../../core/Accessor.js\";\nimport i from \"../../../core/Handles.js\";\nimport { deg2rad as e, rad2deg as s } from \"../../../core/mathUtils.js\";\nimport { destroyMaybe as r } from \"../../../core/maybe.js\";\nimport { init as n } from \"../../../core/watchUtils.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as c } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { applyAll as l } from \"../camera/constraintUtils.js\";\nimport { surfaceElevationBelowRenderLocation as h } from \"../camera/intersectionUtils.js\";\nimport { createNearFarHeuristic as u } from \"./NearFarHeuristic.js\";\nimport d from \"./SurfaceCollisionConstraint.js\";\nlet p = class extends a {\n  constructor(t) {\n    super(t), this._handles = new i(), this.nearFarHeuristic = u(t.view.state.viewingMode, t.view.basemapTerrain, t.view.renderCoordsHelper.spatialReference);\n  }\n\n  initialize() {\n    this._handles.add([this.view.watch([\"constraints.clipDistance.near\", \"constraints.clipDistance.far\"], () => this._clipDistanceNearFarChanged()), this.view.watch(\"constraints.clipDistance.mode\", () => this._updateNearFar()), this.view.state.events.on(\"before-camera-change\", t => this._updateCameraNearFar(t.camera)), this.view.watch(\"dataExtent\", () => this._updateNearFar(), !0), this.view.watch([\"constraints.altitude.min\", \"constraints.altitude.max\"], () => this._updateAltitude(), !0), this.view.watch(\"constraints.tilt.max\", () => this._updateTiltMax(), !0), this.view.watch(\"constraints.tilt.mode\", () => this._updateTilt(), !0), this.view.watch(\"state.camera\", () => this._updateTiltAutoMax(), !0), this.view.watch([\"map.ground.navigationConstraint.type\", \"constraints.collision.enabled\"], () => this._updateCollision(), !0)]), this.view.state.isLocal && this._handles.add(n(this.view, \"dataExtent\", t => this._updateLocalSurfaceDistance(t))), this._updateNearFar(), 2 !== this.view.state.viewingMode && this._updateAltitude(), this._updateTilt(), this._updateCollision(), this._set(\"surfaceCollisionConstraint\", new d({\n      view: this.view\n    }));\n  }\n\n  destroy() {\n    this._handles = r(this._handles), this.surfaceCollisionConstraint && (this.surfaceCollisionConstraint.destroy(), this._set(\"surfaceCollisionConstraint\", null));\n  }\n\n  _clipDistanceNearFarChanged() {\n    const t = this.view.constraints && this.view.constraints.clipDistance;\n    t && \"auto\" !== t.mode && this.view.state.updateCamera(a => (this._updateCameraNearFarManual(a, t), !0));\n  }\n\n  _updateNearFar() {\n    this.view.state.updateCamera(t => (this._updateCameraNearFar(t), !0));\n  }\n\n  _updateCameraNearFar(t) {\n    const a = this.view.constraints && this.view.constraints.clipDistance;\n    \"manual\" === (a ? a.mode : \"auto\") ? this._updateCameraNearFarManual(t, a) : this._updateCameraNearFarAuto(t, a);\n  }\n\n  _updateCameraNearFarAuto(t, a) {\n    this.nearFarHeuristic.compute(t.eye, t.center, this.view.dataExtent, h(this.view, t.eye), t), a && a.autoUpdate(t.near, t.far);\n  }\n\n  _updateCameraNearFarManual(t, a) {\n    a && (t.near = a.near, t.far = a.far);\n  }\n\n  _updateCollision() {\n    var t, a, i;\n    const e = null == (t = this.view.map) || null == (a = t.ground) || null == (i = a.navigationConstraint) ? void 0 : i.type,\n          s = !e || \"stay-above\" === e,\n          r = this.view.state.constraints.collision;\n\n    if (s !== r.enabled) {\n      r.enabled = s, s && this._reapplyConstraints(8);\n      const t = this.view.constraints && this.view.constraints.tilt;\n      t && \"auto\" !== t.mode || this._updateTiltAuto();\n    }\n  }\n\n  _updateAltitude() {\n    const t = this.view.constraints && this.view.constraints.altitude;\n    t && 2 !== this.view.state.viewingMode ? this.view.state.constraints.altitude = {\n      min: t.min,\n      max: t.max\n    } : this.view.state.constraints.altitude = null, this._reapplyConstraints();\n  }\n\n  _updateTiltMax() {\n    const t = this.view.constraints && this.view.constraints.tilt;\n    t && \"auto\" !== t.mode && (this._updateTiltManual(t), this._reapplyConstraints());\n  }\n\n  _updateTilt() {\n    const t = this.view.constraints && this.view.constraints.tilt;\n    \"manual\" === (t ? t.mode : \"auto\") ? this._updateTiltManual(t) : this._updateTiltAuto(), this._reapplyConstraints();\n  }\n\n  _updateTiltManual(t) {\n    const a = this.view.state.constraints;\n    a.tilt = a.createConstantMaxTilt(e(t.max));\n  }\n\n  _updateTiltAuto() {\n    const t = this.view.state.constraints;\n    t.tilt = t.createDefaultTilt(), this._updateTiltAutoMax();\n  }\n\n  _updateTiltAutoMax() {\n    const t = this.view.constraints && this.view.constraints.tilt;\n    if (!t || \"auto\" !== t.mode) return;\n    const a = this.view.state.constraints;\n\n    if (a.tilt) {\n      const i = a.tilt(this.view.state.camera.distance).max;\n      t.autoUpdate(s(i));\n    }\n  }\n\n  _updateLocalSurfaceDistance(t) {\n    let a = Math.max(t.width, t.height);\n    if (a <= 0) return;\n    t.hasZ && (a = Math.max(a, t.zmax - t.zmin));\n    const i = this.view.state,\n          e = 3 * a / Math.atan(i.camera.fov / 2);\n    e !== i.constraints.distance && (i.constraints.distance = e);\n  }\n\n  _reapplyConstraints(t = 15) {\n    this.view.state.updateCamera(a => l(this.view, a, {\n      selection: t,\n      interactionType: 0,\n      interactionFactor: null,\n      interactionStartCamera: null,\n      interactionDirection: null,\n      tiltMode: 0\n    }));\n  }\n\n};\nt([o({\n  constructOnly: !0\n})], p.prototype, \"view\", void 0), t([o({\n  readOnly: !0\n})], p.prototype, \"surfaceCollisionConstraint\", void 0), p = t([c(\"esri.views.3d.state.ConstraintsManager\")], p);\nvar m = p;\nexport default m;\nexport { p as ConstraintsManager };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/state/ConstraintsManager.js"],"names":["_","t","a","i","deg2rad","e","rad2deg","s","destroyMaybe","r","init","n","property","o","subclass","c","applyAll","l","surfaceElevationBelowRenderLocation","h","createNearFarHeuristic","u","d","p","constructor","_handles","nearFarHeuristic","view","state","viewingMode","basemapTerrain","renderCoordsHelper","spatialReference","initialize","add","watch","_clipDistanceNearFarChanged","_updateNearFar","events","on","_updateCameraNearFar","camera","_updateAltitude","_updateTiltMax","_updateTilt","_updateTiltAutoMax","_updateCollision","isLocal","_updateLocalSurfaceDistance","_set","destroy","surfaceCollisionConstraint","constraints","clipDistance","mode","updateCamera","_updateCameraNearFarManual","_updateCameraNearFarAuto","compute","eye","center","dataExtent","autoUpdate","near","far","map","ground","navigationConstraint","type","collision","enabled","_reapplyConstraints","tilt","_updateTiltAuto","altitude","min","max","_updateTiltManual","createConstantMaxTilt","createDefaultTilt","distance","Math","width","height","hasZ","zmax","zmin","atan","fov","selection","interactionType","interactionFactor","interactionStartCamera","interactionDirection","tiltMode","constructOnly","prototype","readOnly","m","ConstraintsManager"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import a from\"../../../core/Accessor.js\";import i from\"../../../core/Handles.js\";import{deg2rad as e,rad2deg as s}from\"../../../core/mathUtils.js\";import{destroyMaybe as r}from\"../../../core/maybe.js\";import{init as n}from\"../../../core/watchUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as c}from\"../../../core/accessorSupport/decorators/subclass.js\";import{applyAll as l}from\"../camera/constraintUtils.js\";import{surfaceElevationBelowRenderLocation as h}from\"../camera/intersectionUtils.js\";import{createNearFarHeuristic as u}from\"./NearFarHeuristic.js\";import d from\"./SurfaceCollisionConstraint.js\";let p=class extends a{constructor(t){super(t),this._handles=new i,this.nearFarHeuristic=u(t.view.state.viewingMode,t.view.basemapTerrain,t.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([this.view.watch([\"constraints.clipDistance.near\",\"constraints.clipDistance.far\"],(()=>this._clipDistanceNearFarChanged())),this.view.watch(\"constraints.clipDistance.mode\",(()=>this._updateNearFar())),this.view.state.events.on(\"before-camera-change\",(t=>this._updateCameraNearFar(t.camera))),this.view.watch(\"dataExtent\",(()=>this._updateNearFar()),!0),this.view.watch([\"constraints.altitude.min\",\"constraints.altitude.max\"],(()=>this._updateAltitude()),!0),this.view.watch(\"constraints.tilt.max\",(()=>this._updateTiltMax()),!0),this.view.watch(\"constraints.tilt.mode\",(()=>this._updateTilt()),!0),this.view.watch(\"state.camera\",(()=>this._updateTiltAutoMax()),!0),this.view.watch([\"map.ground.navigationConstraint.type\",\"constraints.collision.enabled\"],(()=>this._updateCollision()),!0)]),this.view.state.isLocal&&this._handles.add(n(this.view,\"dataExtent\",(t=>this._updateLocalSurfaceDistance(t)))),this._updateNearFar(),2!==this.view.state.viewingMode&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set(\"surfaceCollisionConstraint\",new d({view:this.view}))}destroy(){this._handles=r(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set(\"surfaceCollisionConstraint\",null))}_clipDistanceNearFarChanged(){const t=this.view.constraints&&this.view.constraints.clipDistance;t&&\"auto\"!==t.mode&&this.view.state.updateCamera((a=>(this._updateCameraNearFarManual(a,t),!0)))}_updateNearFar(){this.view.state.updateCamera((t=>(this._updateCameraNearFar(t),!0)))}_updateCameraNearFar(t){const a=this.view.constraints&&this.view.constraints.clipDistance;\"manual\"===(a?a.mode:\"auto\")?this._updateCameraNearFarManual(t,a):this._updateCameraNearFarAuto(t,a)}_updateCameraNearFarAuto(t,a){this.nearFarHeuristic.compute(t.eye,t.center,this.view.dataExtent,h(this.view,t.eye),t),a&&a.autoUpdate(t.near,t.far)}_updateCameraNearFarManual(t,a){a&&(t.near=a.near,t.far=a.far)}_updateCollision(){var t,a,i;const e=null==(t=this.view.map)||null==(a=t.ground)||null==(i=a.navigationConstraint)?void 0:i.type,s=!e||\"stay-above\"===e,r=this.view.state.constraints.collision;if(s!==r.enabled){r.enabled=s,s&&this._reapplyConstraints(8);const t=this.view.constraints&&this.view.constraints.tilt;t&&\"auto\"!==t.mode||this._updateTiltAuto()}}_updateAltitude(){const t=this.view.constraints&&this.view.constraints.altitude;t&&2!==this.view.state.viewingMode?this.view.state.constraints.altitude={min:t.min,max:t.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const t=this.view.constraints&&this.view.constraints.tilt;t&&\"auto\"!==t.mode&&(this._updateTiltManual(t),this._reapplyConstraints())}_updateTilt(){const t=this.view.constraints&&this.view.constraints.tilt;\"manual\"===(t?t.mode:\"auto\")?this._updateTiltManual(t):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(t){const a=this.view.state.constraints;a.tilt=a.createConstantMaxTilt(e(t.max))}_updateTiltAuto(){const t=this.view.state.constraints;t.tilt=t.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const t=this.view.constraints&&this.view.constraints.tilt;if(!t||\"auto\"!==t.mode)return;const a=this.view.state.constraints;if(a.tilt){const i=a.tilt(this.view.state.camera.distance).max;t.autoUpdate(s(i))}}_updateLocalSurfaceDistance(t){let a=Math.max(t.width,t.height);if(a<=0)return;t.hasZ&&(a=Math.max(a,t.zmax-t.zmin));const i=this.view.state,e=3*a/Math.atan(i.camera.fov/2);e!==i.constraints.distance&&(i.constraints.distance=e)}_reapplyConstraints(t=15){this.view.state.updateCamera((a=>l(this.view,a,{selection:t,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})))}};t([o({constructOnly:!0})],p.prototype,\"view\",void 0),t([o({readOnly:!0})],p.prototype,\"surfaceCollisionConstraint\",void 0),p=t([c(\"esri.views.3d.state.ConstraintsManager\")],p);var m=p;export default m;export{p as ConstraintsManager};\n"]},"metadata":{},"sourceType":"module"}