{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport t from \"../../core/Accessor.js\";\nimport s from \"../../core/Logger.js\";\nimport { isNone as r, isSome as i } from \"../../core/maybe.js\";\nimport a from \"../../core/PerformanceSampler.js\";\nimport n from \"../../core/PooledArray.js\";\nimport { isAborted as o, createAbortError as u, when as h } from \"../../core/promiseUtils.js\";\nimport { Milliseconds as _ } from \"../../core/time.js\";\nimport { init as d } from \"../../core/watchUtils.js\";\nimport { property as l } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as E } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport c from \"../../layers/support/PromiseQueue.js\";\nimport T from \"./debugFlags.js\";\nconst m = s.getLogger(\"esri.views.support.Scheduler\");\n\nfunction g(e) {\n  return new U.Scheduler({\n    nowFunc: e\n  });\n}\n\nvar p;\n!function (e) {\n  e.RESOURCE_CONTROLLER = \"schedule\", e.SLIDE = \"slide\", e.STREAM_DATA_LOADER = \"stream loader\", e.ELEVATION_QUERY = \"elevation query\", e.TERRAIN_SURFACE = \"terrain\", e.SURFACE_GEOMETRY_UPDATES = \"surface geometry updates\", e.GRAPHICS_CORE = \"Graphics3D\", e.I3S_CONTROLLER = \"I3S\", e.POINT_CLOUD_LAYER = \"point cloud\", e.FEATURE_TILE_FETCHER = \"feature fetcher\", e.STAGE = \"stage\", e.GRAPHICS_DECONFLICTOR = \"graphics deconflictor\", e.FILTER_VISIBILITY = \"Graphics3D filter visibility\", e.SCALE_VISIBILITY = \"Graphics3D scale visibility\", e.FRUSTUM_VISIBILITY = \"Graphics3D frustum visibility\", e.POINT_OF_INTEREST_FREQUENT = \"POI frequent\", e.POINT_OF_INTEREST_INFREQUENT = \"POI infrequent\", e.LABELER = \"labeler\", e.FEATURE_QUERY_ENGINE = \"feature query\", e.FEATURE_TILE_TREE = \"feature tile tree\", e.FEATURE_TILE_TREE_ACTIVE = \"fast feature tile tree\", e.ELEVATION_ALIGNMENT = \"elevation alignment\", e.TEXT_TEXTURE_ATLAS = \"text texture atlas\", e.TEXTURE_UNLOAD = \"texture unload\", e.OVERLAY_MANAGER = \"overlay manager\", e.LINE_OF_SIGHT_TOOL = \"line of sight tool\", e.LINE_OF_SIGHT_TOOL_INTERACTIVE = \"interactive line of sight tool\", e.ELEVATION_PROFILE = \"elevation profile\", e.SNAPPING = \"snapping\", e.SHADOW_ACCUMULATOR = \"shadow accumulator\", e[e.TEST_PRIO = 1] = \"TEST_PRIO\";\n}(p || (p = {}));\nconst I = 0,\n      R = new Map([[p.RESOURCE_CONTROLLER, I], [p.SLIDE, I], [p.STREAM_DATA_LOADER, I], [p.ELEVATION_QUERY, I], [p.TERRAIN_SURFACE, 1], [p.SURFACE_GEOMETRY_UPDATES, 1], [p.GRAPHICS_CORE, 2], [p.I3S_CONTROLLER, 2], [p.POINT_CLOUD_LAYER, 2], [p.FEATURE_TILE_FETCHER, 2], [p.STAGE, 4], [p.GRAPHICS_DECONFLICTOR, 4], [p.FILTER_VISIBILITY, 4], [p.SCALE_VISIBILITY, 4], [p.FRUSTUM_VISIBILITY, 4], [p.POINT_OF_INTEREST_FREQUENT, 6], [p.POINT_OF_INTEREST_INFREQUENT, 30], [p.LABELER, 8], [p.FEATURE_QUERY_ENGINE, 8], [p.FEATURE_TILE_TREE, 16], [p.FEATURE_TILE_TREE_ACTIVE, I], [p.ELEVATION_ALIGNMENT, 12], [p.TEXT_TEXTURE_ATLAS, 12], [p.TEXTURE_UNLOAD, 12], [p.OVERLAY_MANAGER, 12], [p.LINE_OF_SIGHT_TOOL, 16], [p.LINE_OF_SIGHT_TOOL_INTERACTIVE, I], [p.SNAPPING, I], [p.SHADOW_ACCUMULATOR, 30]]);\n\nfunction f(e) {\n  return R.has(e) ? R.get(e) : \"number\" == typeof e ? e : 1;\n}\n\nconst A = _(6.5),\n      S = _(1),\n      b = _(30),\n      L = _(1e3 / 30),\n      k = _(100),\n      O = .9;\n\nvar U, P;\n!function (s) {\n  let o = class extends t {\n    constructor(e) {\n      super(e), this.updating = !0, this.performanceInfo = {\n        total: new a(\"total\"),\n        tasks: new Map()\n      }, this._frameTaskTimes = new Map(), this._budget = null, this._state = 1, this._tasks = new n(), this._runQueue = new n(), this._load = 0, this._idleStateCallbacks = new n(), this._idleUpdatesStartFired = !1, this._maxReschedule = C, this._forceTask = !1, this._debug = !1, this._debugHandle = d(T, \"SCHEDULER_LOG_SLOW_TASKS\", e => this._debug = e), this._budget = new h(e.nowFunc);\n\n      for (const r of Object.keys(p)) this.performanceInfo.tasks.set(p[r], new a(p[r]));\n\n      let t;\n      const s = this;\n      this._test = {\n        get state() {\n          return r(t) ? s._state : t;\n        },\n\n        set state(e) {\n          t = e;\n        },\n\n        FRAME_SAFETY_BUDGET: A,\n        INTERACTING_BUDGET: L,\n        IDLE_BUDGET: k,\n\n        get budget() {\n          return s._budget.budget;\n        },\n\n        usedBudget: 0,\n        updateTask: e => this._updateTask(e),\n        getState: e => this._getState(e),\n        getRuntime: e => this._getRuntime(e),\n        resetRuntimes: () => this._resetRuntimes(),\n        getRunning: () => this._getRunning()\n      };\n    }\n\n    destroy() {\n      this._debugHandle && this._debugHandle.remove();\n    }\n\n    registerTask(e, t) {\n      const s = f(e),\n            r = new u(this, e, t, s);\n      return this._tasks.push(r), this.performanceInfo.tasks.has(e) || this.performanceInfo.tasks.set(e, new a(e)), r;\n    }\n\n    registerIdleStateCallbacks(e, t) {\n      const s = {\n        idleBegin: e,\n        idleEnd: t\n      };\n      this._idleStateCallbacks.push(s), 2 === this.state && this._idleUpdatesStartFired && s.idleBegin();\n      const r = this;\n      return {\n        remove: () => this._removeIdleStateCallbacks(s),\n\n        set idleBegin(e) {\n          r._idleUpdatesStartFired && (s.idleEnd(), 2 === r._state && e()), s.idleBegin = e;\n        },\n\n        set idleEnd(e) {\n          s.idleEnd = e;\n        }\n\n      };\n    }\n\n    get now() {\n      return this.nowFunc();\n    }\n\n    get load() {\n      return this._load;\n    }\n\n    set state(e) {\n      this._state !== e && (this._state = e, 2 !== this.state && this._idleUpdatesStartFired && (this._idleUpdatesStartFired = !1, this._idleStateCallbacks.forAll(e => e.idleEnd())));\n    }\n\n    get state() {\n      return r(this._test.state) ? this._state : this._test.state;\n    }\n\n    updateBudget(e) {\n      this._test.usedBudget = 0;\n      let t = A,\n          s = e.frameDuration,\n          r = S;\n\n      switch (this.state) {\n        case 2:\n          t = _(0), s = _(Math.max(k, e.frameDuration)), r = b;\n          break;\n\n        case 1:\n          s = _(Math.max(L, e.frameDuration));\n      }\n\n      return s = _(s - e.elapsedFrameTime - t), 2 !== this.state && s < S && !this._forceTask ? (this._forceTask = !0, !1) : (s = _(Math.max(s, r)), this._budget.reset(s, this.state), this._maxReschedule = C, this._updateLoad(), this._schedule());\n    }\n\n    frame() {\n      switch (this._forceTask = !1, this.state) {\n        case 2:\n          this._idleUpdatesStartFired || (this._idleUpdatesStartFired = !0, this._idleStateCallbacks.forAll(e => e.idleBegin())), this._runIdle();\n          break;\n\n        case 1:\n          this._runInteracting();\n\n          break;\n\n        default:\n          this._runAnimating();\n\n      }\n\n      this._test.usedBudget = this._budget.elapsed;\n    }\n\n    stopFrame() {\n      this._budget.reset(_(0), this._state), this._budget.madeProgress();\n    }\n\n    _removeIdleStateCallbacks(e) {\n      this._idleUpdatesStartFired && e.idleEnd(), this._idleStateCallbacks.removeUnordered(e);\n    }\n\n    removeTask(e) {\n      this._tasks.removeUnordered(e), this._runQueue.removeUnordered(e);\n    }\n\n    _updateTask(e) {\n      this._tasks.forAll(t => {\n        t.name === e && t.setPriority(e);\n      });\n    }\n\n    _getState(e) {\n      if (this._runQueue.some(t => t.name === e)) return P.SCHEDULED;\n      let t = P.IDLE;\n      return this._tasks.forAll(s => {\n        s.name === e && s.needsUpdate && (s.schedulePriority <= 1 ? t = P.READY : t !== P.READY && (t = P.WAITING));\n      }), t;\n    }\n\n    _getRuntime(e) {\n      let t = 0;\n      return this._tasks.forAll(s => {\n        s.name === e && (t += s.runtime);\n      }), t;\n    }\n\n    _resetRuntimes() {\n      this._tasks.forAll(e => e.runtime = 0);\n    }\n\n    _getRunning() {\n      const e = new Map();\n      if (this._tasks.forAll(t => {\n        t.needsUpdate && e.set(t.name, (e.get(t.name) || 0) + 1);\n      }), 0 === e.size) return null;\n      let t = \"\";\n      return e.forEach((e, s) => {\n        t += e > 1 ? ` ${e}x ${s}` : ` ${s}`;\n      }), t;\n    }\n\n    _runIdle() {\n      this._run();\n    }\n\n    _runInteracting() {\n      this._run();\n    }\n\n    _runAnimating() {\n      this._run();\n    }\n\n    _updateLoad() {\n      const e = this._tasks.reduce((e, t) => t.needsUpdate ? ++e : e, 0);\n\n      this._load = this._load * O + e * (1 - O);\n    }\n\n    _schedule() {\n      if (this._maxReschedule <= 0) return !1;\n\n      for (this._runQueue.filterInPlace(e => !!e.needsUpdate || (e.schedulePriority = e.basePriority, !1)), this._tasks.forAll(e => {\n        e.basePriority === I && e.needsUpdate && !this._runQueue.some(t => t === e) && this._runQueue.unshift(e);\n      }); 0 === this._runQueue.length;) {\n        let e = !1,\n            t = 0;\n        if (this._tasks.forAll(s => {\n          if (s.needsUpdate && 0 !== s.schedulePriority && s.basePriority !== I) switch (e = !0, t = Math.max(t, s.basePriority), s.schedulePriority) {\n            case 1:\n              s.schedulePriority = 0, this._runQueue.push(s);\n              break;\n\n            default:\n              --s.schedulePriority;\n          }\n        }), !e) return this.updating = !1, !1;\n        this._maxReschedule === C && (this._maxReschedule = t), --this._maxReschedule;\n      }\n\n      return this.updating = !0, !0;\n    }\n\n    _run() {\n      const e = this._budget.now();\n\n      this._startFrameTaskTimes();\n\n      do {\n        for (; this._runQueue.length > 0;) {\n          const s = this._budget.now(),\n                r = this._runQueue.pop();\n\n          this._budget.resetProgress();\n\n          try {\n            r.task.runTask(this._budget);\n          } catch (t) {\n            m.error(`Exception in task \"${r.name}\"`, t);\n          }\n\n          r.schedulePriority = r.basePriority;\n          const i = this._budget.now() - s;\n          if (r.runtime += i, this._frameTaskTimes.set(r.priority, this._frameTaskTimes.get(r.priority) + i), this._debug && this._budget.elapsed > 2 * this._budget.budget && console.log(\"Task\", r.name, \"used\", this._budget.elapsed, \"of max\", this._budget.budget, \"ms\"), this._budget.remaining <= 0) return void this._recordFrameTaskTimes(this._budget.now() - e);\n        }\n      } while (this._schedule());\n\n      this._recordFrameTaskTimes(this._budget.now() - e);\n    }\n\n    _startFrameTaskTimes() {\n      for (const e of Object.keys(p)) this._frameTaskTimes.set(p[e], 0);\n    }\n\n    _recordFrameTaskTimes(e) {\n      this._frameTaskTimes.forEach((e, t) => this.performanceInfo.tasks.get(t).record(e)), this.performanceInfo.total.record(e);\n    }\n\n    get test() {\n      return this._test;\n    }\n\n  };\n  e([l()], o.prototype, \"updating\", void 0), e([l()], o.prototype, \"nowFunc\", void 0), o = e([E(\"esri.views.support.Scheduler\")], o), s.Scheduler = o;\n  let u = class extends t {\n    constructor(e, t, s, r) {\n      super({}), this._scheduler = e, this.name = t, this._basePriority = r, this.runtime = 0, this._queue = new c(), this.updating = !1, this.schedulePriority = this._basePriority, this.task = i(s) ? s : {\n        running: !1,\n        runTask: e => this.processQueue(e)\n      };\n    }\n\n    normalizeCtorArgs() {\n      return {};\n    }\n\n    remove() {\n      this.processQueue(N), this._scheduler.removeTask(this), this.schedule = y.schedule, this.reschedule = y.reschedule;\n    }\n\n    get basePriority() {\n      return this._basePriority;\n    }\n\n    setPriority(e) {\n      this.name = e;\n      const t = f(e);\n      this._basePriority !== I && 0 === this.schedulePriority || (this.schedulePriority = t), this._basePriority = t;\n    }\n\n    get priority() {\n      return this.name;\n    }\n\n    set priority(e) {\n      this.setPriority(e);\n    }\n\n    get needsUpdate() {\n      return this.updating || this.task.running;\n    }\n\n    schedule(e, t, s) {\n      return this.updating = !0, this._queue.push(e, t, s);\n    }\n\n    reschedule(e, t, s) {\n      return this.updating = !0, this._queue.unshift(e, t, s);\n    }\n\n    processQueue(e) {\n      for (; !e.done && this._queue.process();) e.madeProgress();\n\n      this.updating = this._queue.length > 0;\n    }\n\n  };\n  e([l()], u.prototype, \"updating\", void 0), u = e([E(\"esri.views.support.SchedulerTask\")], u);\n\n  class h {\n    constructor(e) {\n      this.now = e, this._begin = 0, this._budget = 0, this._state = 2, this._didWork = !1, this._enabled = !0;\n    }\n\n    run(e) {\n      return !this.done && (!0 === e() && (this._didWork = !0), !0);\n    }\n\n    get done() {\n      return this._didWork && this.elapsed >= this._budget && this._enabled;\n    }\n\n    get budget() {\n      return this._budget;\n    }\n\n    madeProgress() {\n      this._didWork = !0;\n    }\n\n    get state() {\n      return this._state;\n    }\n\n    get enabled() {\n      return this._enabled;\n    }\n\n    set enabled(e) {\n      this._enabled = e;\n    }\n\n    reset(e, t) {\n      this._begin = this.now(), this._budget = e, this._state = t, this._didWork = !1;\n    }\n\n    get remaining() {\n      return Math.max(this._budget - this.elapsed, 0);\n    }\n\n    get elapsed() {\n      return this.now() - this._begin;\n    }\n\n    resetProgress() {\n      this._didWork = !1;\n    }\n\n    get hasProgressed() {\n      return this._didWork;\n    }\n\n  }\n\n  s.Budget = h;\n}(U || (U = {})), function (e) {\n  e.SCHEDULED = \"s\", e.READY = \"r\", e.WAITING = \"w\", e.IDLE = \"i\";\n}(P || (P = {}));\n\nconst N = (() => {\n  const e = new U.Budget(() => performance.now());\n  return e.enabled = !1, e;\n})();\n\nclass F {\n  remove() {}\n\n  processQueue() {}\n\n  schedule(e, t, s) {\n    try {\n      if (o(t)) {\n        const e = u();\n        return s ? Promise.resolve(s(e)) : Promise.reject(e);\n      }\n\n      return h(e());\n    } catch (r) {\n      return Promise.reject(r);\n    }\n  }\n\n  reschedule(e, t, s) {\n    return this.schedule(e, t, s);\n  }\n\n}\n\nconst y = new F(),\n      C = Number.MAX_SAFE_INTEGER;\nexport { y as ImmediateTask, p as TaskPriority, P as TaskState, f as getTaskPriority, g as newScheduler, N as noBudget, R as taskPriorities };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/support/Scheduler.js"],"names":["_","e","t","s","isNone","r","isSome","i","a","n","isAborted","o","createAbortError","u","when","h","Milliseconds","init","d","property","l","subclass","E","c","T","m","getLogger","g","U","Scheduler","nowFunc","p","RESOURCE_CONTROLLER","SLIDE","STREAM_DATA_LOADER","ELEVATION_QUERY","TERRAIN_SURFACE","SURFACE_GEOMETRY_UPDATES","GRAPHICS_CORE","I3S_CONTROLLER","POINT_CLOUD_LAYER","FEATURE_TILE_FETCHER","STAGE","GRAPHICS_DECONFLICTOR","FILTER_VISIBILITY","SCALE_VISIBILITY","FRUSTUM_VISIBILITY","POINT_OF_INTEREST_FREQUENT","POINT_OF_INTEREST_INFREQUENT","LABELER","FEATURE_QUERY_ENGINE","FEATURE_TILE_TREE","FEATURE_TILE_TREE_ACTIVE","ELEVATION_ALIGNMENT","TEXT_TEXTURE_ATLAS","TEXTURE_UNLOAD","OVERLAY_MANAGER","LINE_OF_SIGHT_TOOL","LINE_OF_SIGHT_TOOL_INTERACTIVE","ELEVATION_PROFILE","SNAPPING","SHADOW_ACCUMULATOR","TEST_PRIO","I","R","Map","f","has","get","A","S","b","L","k","O","P","constructor","updating","performanceInfo","total","tasks","_frameTaskTimes","_budget","_state","_tasks","_runQueue","_load","_idleStateCallbacks","_idleUpdatesStartFired","_maxReschedule","C","_forceTask","_debug","_debugHandle","Object","keys","set","_test","state","FRAME_SAFETY_BUDGET","INTERACTING_BUDGET","IDLE_BUDGET","budget","usedBudget","updateTask","_updateTask","getState","_getState","getRuntime","_getRuntime","resetRuntimes","_resetRuntimes","getRunning","_getRunning","destroy","remove","registerTask","push","registerIdleStateCallbacks","idleBegin","idleEnd","_removeIdleStateCallbacks","now","load","forAll","updateBudget","frameDuration","Math","max","elapsedFrameTime","reset","_updateLoad","_schedule","frame","_runIdle","_runInteracting","_runAnimating","elapsed","stopFrame","madeProgress","removeUnordered","removeTask","name","setPriority","some","SCHEDULED","IDLE","needsUpdate","schedulePriority","READY","WAITING","runtime","size","forEach","_run","reduce","filterInPlace","basePriority","unshift","length","_startFrameTaskTimes","pop","resetProgress","task","runTask","error","priority","console","log","remaining","_recordFrameTaskTimes","record","test","prototype","_scheduler","_basePriority","_queue","running","processQueue","normalizeCtorArgs","N","schedule","y","reschedule","done","process","_begin","_didWork","_enabled","run","enabled","hasProgressed","Budget","performance","F","Promise","resolve","reject","Number","MAX_SAFE_INTEGER","ImmediateTask","TaskPriority","TaskState","getTaskPriority","newScheduler","noBudget","taskPriorities"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Accessor.js\";import s from\"../../core/Logger.js\";import{isNone as r,isSome as i}from\"../../core/maybe.js\";import a from\"../../core/PerformanceSampler.js\";import n from\"../../core/PooledArray.js\";import{isAborted as o,createAbortError as u,when as h}from\"../../core/promiseUtils.js\";import{Milliseconds as _}from\"../../core/time.js\";import{init as d}from\"../../core/watchUtils.js\";import{property as l}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as E}from\"../../core/accessorSupport/decorators/subclass.js\";import c from\"../../layers/support/PromiseQueue.js\";import T from\"./debugFlags.js\";const m=s.getLogger(\"esri.views.support.Scheduler\");function g(e){return new U.Scheduler({nowFunc:e})}var p;!function(e){e.RESOURCE_CONTROLLER=\"schedule\",e.SLIDE=\"slide\",e.STREAM_DATA_LOADER=\"stream loader\",e.ELEVATION_QUERY=\"elevation query\",e.TERRAIN_SURFACE=\"terrain\",e.SURFACE_GEOMETRY_UPDATES=\"surface geometry updates\",e.GRAPHICS_CORE=\"Graphics3D\",e.I3S_CONTROLLER=\"I3S\",e.POINT_CLOUD_LAYER=\"point cloud\",e.FEATURE_TILE_FETCHER=\"feature fetcher\",e.STAGE=\"stage\",e.GRAPHICS_DECONFLICTOR=\"graphics deconflictor\",e.FILTER_VISIBILITY=\"Graphics3D filter visibility\",e.SCALE_VISIBILITY=\"Graphics3D scale visibility\",e.FRUSTUM_VISIBILITY=\"Graphics3D frustum visibility\",e.POINT_OF_INTEREST_FREQUENT=\"POI frequent\",e.POINT_OF_INTEREST_INFREQUENT=\"POI infrequent\",e.LABELER=\"labeler\",e.FEATURE_QUERY_ENGINE=\"feature query\",e.FEATURE_TILE_TREE=\"feature tile tree\",e.FEATURE_TILE_TREE_ACTIVE=\"fast feature tile tree\",e.ELEVATION_ALIGNMENT=\"elevation alignment\",e.TEXT_TEXTURE_ATLAS=\"text texture atlas\",e.TEXTURE_UNLOAD=\"texture unload\",e.OVERLAY_MANAGER=\"overlay manager\",e.LINE_OF_SIGHT_TOOL=\"line of sight tool\",e.LINE_OF_SIGHT_TOOL_INTERACTIVE=\"interactive line of sight tool\",e.ELEVATION_PROFILE=\"elevation profile\",e.SNAPPING=\"snapping\",e.SHADOW_ACCUMULATOR=\"shadow accumulator\",e[e.TEST_PRIO=1]=\"TEST_PRIO\"}(p||(p={}));const I=0,R=new Map([[p.RESOURCE_CONTROLLER,I],[p.SLIDE,I],[p.STREAM_DATA_LOADER,I],[p.ELEVATION_QUERY,I],[p.TERRAIN_SURFACE,1],[p.SURFACE_GEOMETRY_UPDATES,1],[p.GRAPHICS_CORE,2],[p.I3S_CONTROLLER,2],[p.POINT_CLOUD_LAYER,2],[p.FEATURE_TILE_FETCHER,2],[p.STAGE,4],[p.GRAPHICS_DECONFLICTOR,4],[p.FILTER_VISIBILITY,4],[p.SCALE_VISIBILITY,4],[p.FRUSTUM_VISIBILITY,4],[p.POINT_OF_INTEREST_FREQUENT,6],[p.POINT_OF_INTEREST_INFREQUENT,30],[p.LABELER,8],[p.FEATURE_QUERY_ENGINE,8],[p.FEATURE_TILE_TREE,16],[p.FEATURE_TILE_TREE_ACTIVE,I],[p.ELEVATION_ALIGNMENT,12],[p.TEXT_TEXTURE_ATLAS,12],[p.TEXTURE_UNLOAD,12],[p.OVERLAY_MANAGER,12],[p.LINE_OF_SIGHT_TOOL,16],[p.LINE_OF_SIGHT_TOOL_INTERACTIVE,I],[p.SNAPPING,I],[p.SHADOW_ACCUMULATOR,30]]);function f(e){return R.has(e)?R.get(e):\"number\"==typeof e?e:1}const A=_(6.5),S=_(1),b=_(30),L=_(1e3/30),k=_(100),O=.9;var U,P;!function(s){let o=class extends t{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new a(\"total\"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=1,this._tasks=new n,this._runQueue=new n,this._load=0,this._idleStateCallbacks=new n,this._idleUpdatesStartFired=!1,this._maxReschedule=C,this._forceTask=!1,this._debug=!1,this._debugHandle=d(T,\"SCHEDULER_LOG_SLOW_TASKS\",(e=>this._debug=e)),this._budget=new h(e.nowFunc);for(const r of Object.keys(p))this.performanceInfo.tasks.set(p[r],new a(p[r]));let t;const s=this;this._test={get state(){return r(t)?s._state:t},set state(e){t=e},FRAME_SAFETY_BUDGET:A,INTERACTING_BUDGET:L,IDLE_BUDGET:k,get budget(){return s._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,t){const s=f(e),r=new u(this,e,t,s);return this._tasks.push(r),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a(e)),r}registerIdleStateCallbacks(e,t){const s={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(s),2===this.state&&this._idleUpdatesStartFired&&s.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(s),set idleBegin(e){r._idleUpdatesStartFired&&(s.idleEnd(),2===r._state&&e()),s.idleBegin=e},set idleEnd(e){s.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return r(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=A,s=e.frameDuration,r=S;switch(this.state){case 2:t=_(0),s=_(Math.max(k,e.frameDuration)),r=b;break;case 1:s=_(Math.max(L,e.frameDuration))}return s=_(s-e.elapsedFrameTime-t),2!==this.state&&s<S&&!this._forceTask?(this._forceTask=!0,!1):(s=_(Math.max(s,r)),this._budget.reset(s,this.state),this._maxReschedule=C,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(_(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return P.SCHEDULED;let t=P.IDLE;return this._tasks.forAll((s=>{s.name===e&&s.needsUpdate&&(s.schedulePriority<=1?t=P.READY:t!==P.READY&&(t=P.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((s=>{s.name===e&&(t+=s.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t=\"\";return e.forEach(((e,s)=>{t+=e>1?` ${e}x ${s}`:` ${s}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=this._load*O+e*(1-O)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{e.basePriority===I&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((s=>{if(s.needsUpdate&&0!==s.schedulePriority&&s.basePriority!==I)switch(e=!0,t=Math.max(t,s.basePriority),s.schedulePriority){case 1:s.schedulePriority=0,this._runQueue.push(s);break;default:--s.schedulePriority}})),!e)return this.updating=!1,!1;this._maxReschedule===C&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const s=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)}catch(t){m.error(`Exception in task \"${r.name}\"`,t)}r.schedulePriority=r.basePriority;const i=this._budget.now()-s;if(r.runtime+=i,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log(\"Task\",r.name,\"used\",this._budget.elapsed,\"of max\",this._budget.budget,\"ms\"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(p))this._frameTaskTimes.set(p[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};e([l()],o.prototype,\"updating\",void 0),e([l()],o.prototype,\"nowFunc\",void 0),o=e([E(\"esri.views.support.Scheduler\")],o),s.Scheduler=o;let u=class extends t{constructor(e,t,s,r){super({}),this._scheduler=e,this.name=t,this._basePriority=r,this.runtime=0,this._queue=new c,this.updating=!1,this.schedulePriority=this._basePriority,this.task=i(s)?s:{running:!1,runTask:e=>this.processQueue(e)}}normalizeCtorArgs(){return{}}remove(){this.processQueue(N),this._scheduler.removeTask(this),this.schedule=y.schedule,this.reschedule=y.reschedule}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=f(e);this._basePriority!==I&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,s){return this.updating=!0,this._queue.push(e,t,s)}reschedule(e,t,s){return this.updating=!0,this._queue.unshift(e,t,s)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};e([l()],u.prototype,\"updating\",void 0),u=e([E(\"esri.views.support.SchedulerTask\")],u);class h{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}s.Budget=h}(U||(U={})),function(e){e.SCHEDULED=\"s\",e.READY=\"r\",e.WAITING=\"w\",e.IDLE=\"i\"}(P||(P={}));const N=(()=>{const e=new U.Budget((()=>performance.now()));return e.enabled=!1,e})();class F{remove(){}processQueue(){}schedule(e,t,s){try{if(o(t)){const e=u();return s?Promise.resolve(s(e)):Promise.reject(e)}return h(e())}catch(r){return Promise.reject(r)}}reschedule(e,t,s){return this.schedule(e,t,s)}}const y=new F,C=Number.MAX_SAFE_INTEGER;export{y as ImmediateTask,p as TaskPriority,P as TaskState,f as getTaskPriority,g as newScheduler,N as noBudget,R as taskPriorities};\n"]},"metadata":{},"sourceType":"module"}