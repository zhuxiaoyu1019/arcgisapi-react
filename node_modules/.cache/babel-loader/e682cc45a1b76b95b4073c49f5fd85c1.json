{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../intl.js\";\nimport e from \"../../../core/Logger.js\";\nimport { isNone as t } from \"../../../core/maybe.js\";\nimport { replace as r } from \"../../../core/string.js\";\nimport { formatDate as n, convertDateFormatToIntlOptions as i } from \"../../../intl/date.js\";\nimport { formatNumber as o, convertNumberFormatToIntlOptions as a } from \"../../../intl/number.js\";\nimport { featureHasFields as u } from \"../../../layers/support/fieldUtils.js\";\nimport l from \"../../../popup/support/FieldInfoFormat.js\";\nimport { loadArcade as s } from \"../../../support/arcadeOnDemand.js\";\nconst f = \"esri.widgets.Feature.support.featureUtils\",\n      c = e.getLogger(f),\n      d = /href=(\"\"|'')/gi,\n      p = /(\\{([^\\{\\r\\n]+)\\})/g,\n      m = /\\'/g,\n      y = /^\\s*expression\\//i,\n      g = /(\\n)/gi,\n      h = /[\\u00A0-\\u9999<>\\&]/gim,\n      b = /href\\s*=\\s*(?:\\\"([^\\\"]+)\\\"|\\'([^\\']+)\\')/gi,\n      F = /^(?:mailto:|tel:)/,\n      I = \"relationships/\",\n      w = i(\"short-date-short-time\");\n\nfunction N(e) {\n  if (!t(e)) return e.get(\"sourceLayer\") || e.get(\"layer\");\n}\n\nasync function j(e, t) {\n  return \"function\" == typeof e ? e.call(null, t) : e;\n}\n\nfunction v(e = \"\") {\n  if (e) return !F.test(e.trim().toLowerCase());\n}\n\nfunction C(e) {\n  return y.test(e);\n}\n\nfunction L(e, t) {\n  if (!C(t) || !e) return null;\n  const r = t.replace(y, \"\").toLowerCase();\n  let n;\n  return e.some(e => e.name.toLowerCase() === r && (n = e, !0)), n;\n}\n\nfunction x(e, t) {\n  const r = L(t, null == e ? void 0 : e.fieldName);\n  return r ? r.title || null : e ? e.label || e.fieldName : null;\n}\n\nfunction D(e, t) {\n  const r = t.get(e.toLowerCase());\n  return `{${r && r.fieldName || e}}`;\n}\n\nfunction A(e) {\n  return e.replace(d, \"\");\n}\n\nfunction E(e, t) {\n  const r = M(t, e);\n  return r ? r.name : e;\n}\n\nfunction q(e, t) {\n  return e && e.map(e => E(e, t));\n}\n\nfunction M(e, t) {\n  return e && \"function\" == typeof e.getField ? e.getField(t) : null;\n}\n\nfunction $(e) {\n  return `${e}`.trim();\n}\n\nfunction G({\n  attributes: e,\n  globalAttributes: t,\n  layer: r,\n  text: n,\n  expressionAttributes: i,\n  fieldInfoMap: o\n}) {\n  return n ? R({\n    formattedAttributes: t,\n    template: k(n, { ...t,\n      ...i,\n      ...e\n    }, r),\n    fieldInfoMap: o\n  }) : \"\";\n}\n\nfunction R({\n  formattedAttributes: e,\n  template: t,\n  fieldInfoMap: n\n}) {\n  return $(A(r(r(t, e => D(e, n)), e)));\n}\n\nfunction S(e, t, r = !1) {\n  const n = t[e];\n\n  if (\"string\" == typeof n) {\n    const i = \"%27\",\n          o = (r ? encodeURIComponent(n) : n).replace(m, i);\n    t[e] = o;\n  }\n}\n\nfunction T(e, t = !1) {\n  const r = { ...e\n  };\n  return Object.keys(r).forEach(e => S(e, r, t)), r;\n}\n\nfunction O(e, t, n) {\n  const i = (t = $(t)) && \"{\" !== t[0];\n  return r(e, T(n, i));\n}\n\nfunction U(e, t) {\n  return e.replace(p, (e, r, n) => {\n    const i = M(t, n);\n    return i ? `{${i.name}}` : r;\n  });\n}\n\nfunction k(e, t, r) {\n  const n = U(e, r);\n  return n ? n.replace(b, (e, r, n) => O(e, r || n, t)) : n;\n}\n\nfunction Q(e, t) {\n  if (\"string\" == typeof e && t && null == t.dateFormat && (null != t.places || null != t.digitSeparator)) {\n    const t = Number(e);\n    if (!isNaN(t)) return t;\n  }\n\n  return e;\n}\n\nfunction P(e, t) {\n  const r = t.fieldInfos,\n        n = t.fieldName,\n        i = z(r, n),\n        u = null == i ? void 0 : i.clone(),\n        s = t.preventPlacesFormatting,\n        f = M(t.layer, n);\n\n  if (u && f && \"date\" === f.type) {\n    const e = u.format || new l();\n    e.dateFormat = e.dateFormat || \"short-date-short-time\", u.format = e;\n  }\n\n  const c = u && u.format;\n  return \"string\" == typeof (e = Q(e, c)) || null == e || null == c ? e : s ? o(e, { ...a(c),\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 20\n  }) : c.format(e);\n}\n\nfunction z(e, t) {\n  if (!e || !e.length || !t) return;\n  const r = t.toLowerCase();\n  let n;\n  return e.some(e => !(!e.fieldName || e.fieldName.toLowerCase() !== r) && (n = e, !0)), n;\n}\n\nfunction B({\n  fieldName: e,\n  graphic: t,\n  layer: r\n}) {\n  if (re(e)) return null;\n  if (!r || \"function\" != typeof r.getFeatureType) return null;\n  const {\n    typeIdField: n\n  } = r;\n  if (!n || e !== n) return null;\n  const i = r.getFeatureType(t);\n  return i ? i.name : null;\n}\n\nfunction H({\n  fieldName: e,\n  value: t,\n  graphic: r,\n  layer: n\n}) {\n  if (re(e)) return null;\n  if (!n || \"function\" != typeof n.getFieldDomain) return null;\n  const i = n.getFieldDomain(e, {\n    feature: r\n  });\n  return i && \"coded-value\" === i.type ? i.getName(t) : null;\n}\n\nfunction J(e, t) {\n  const {\n    creatorField: r,\n    creationDateField: i,\n    editorField: o,\n    editDateField: a\n  } = e;\n  if (!t) return;\n  const u = t[a];\n\n  if (\"number\" == typeof u) {\n    const e = t[o];\n    return {\n      type: \"edit\",\n      date: n(u, w),\n      user: e\n    };\n  }\n\n  const l = t[i];\n\n  if (\"number\" == typeof l) {\n    const e = t[r];\n    return {\n      type: \"create\",\n      date: n(l, w),\n      user: e\n    };\n  }\n\n  return null;\n}\n\nfunction K(e, t) {\n  const r = new Map();\n  return e && e.forEach(e => {\n    const n = E(e.fieldName, t);\n    e.fieldName = n, r.set(n.toLowerCase(), e);\n  }), r;\n}\n\nfunction V(e) {\n  const t = [];\n  if (!e) return t;\n  const {\n    fieldInfos: r,\n    content: n\n  } = e;\n  return r && t.push(...r), n && Array.isArray(n) ? (n.forEach(e => {\n    if (\"fields\" === e.type) {\n      const r = e && e.fieldInfos;\n      r && t.push(...r);\n    }\n  }), t) : t;\n}\n\nfunction W(e) {\n  return e.replace(h, e => `&#${e.charCodeAt(0)};`);\n}\n\nfunction X(e) {\n  return \"string\" == typeof e ? e.replace(g, '<br class=\"esri-text-new-line\" />') : e;\n}\n\nfunction Y(e) {\n  const {\n    value: t,\n    fieldName: r,\n    fieldInfos: i,\n    fieldInfoMap: o,\n    layer: a,\n    graphic: u\n  } = e;\n  if (null == t) return \"\";\n  const l = H({\n    fieldName: r,\n    value: t,\n    graphic: u,\n    layer: a\n  });\n  if (l) return l;\n  const s = B({\n    fieldName: r,\n    graphic: u,\n    layer: a\n  });\n  if (s) return s;\n  if (o.get(r.toLowerCase())) return P(t, {\n    fieldInfos: i,\n    fieldName: r,\n    layer: a\n  });\n  const f = a && a.fieldsIndex;\n  return f && f.isDateField(r) ? n(t, w) : X(t);\n}\n\nfunction Z({\n  fieldInfos: e,\n  attributes: t,\n  layer: r,\n  graphic: n,\n  fieldInfoMap: i,\n  relatedInfos: o\n}) {\n  const a = { ...t\n  };\n  return null == o || o.forEach(e => oe(a, e)), Object.keys(a).forEach(t => {\n    const o = a[t];\n    a[t] = Y({\n      fieldName: t,\n      fieldInfos: e,\n      fieldInfoMap: i,\n      layer: r,\n      value: o,\n      graphic: n\n    });\n  }), a;\n}\n\nasync function _(e, t) {\n  var r, n;\n  const {\n    layer: i,\n    graphic: o,\n    outFields: a,\n    objectIds: u,\n    returnGeometry: l,\n    spatialReference: s\n  } = e,\n        f = u[0];\n\n  if (\"number\" != typeof f && \"string\" != typeof f) {\n    const e = \"Could not query required fields for the specified feature. The feature's ID is invalid.\",\n          t = {\n      layer: i,\n      graphic: o,\n      objectId: f,\n      requiredFields: a\n    };\n    return c.warn(e, t), null;\n  }\n\n  if (null == (r = i.capabilities) || null == (n = r.operations) || !n.supportsQuery) {\n    const e = \"The specified layer cannot be queried. The following fields will not be available.\",\n          t = {\n      layer: i,\n      graphic: o,\n      requiredFields: a,\n      returnGeometry: l\n    };\n    return c.warn(e, t), null;\n  }\n\n  const d = i.createQuery();\n  d.objectIds = u, d.outFields = null != a && a.length ? a : [i.objectIdField], d.returnGeometry = !!l, d.outSpatialReference = s;\n  return (await i.queryFeatures(d, t)).features[0];\n}\n\nasync function ee(e) {\n  var t;\n  if (null == (t = e.expressionInfos) || !t.length) return !1;\n  const r = await s(),\n        {\n    arcadeUtils: {\n      hasGeometryFunctions: n\n    }\n  } = r;\n  return n(e);\n}\n\nasync function te({\n  graphic: e,\n  popupTemplate: t,\n  layer: r,\n  spatialReference: n\n}, i) {\n  if (!r || !t) return;\n  if (\"function\" == typeof r.load && (await r.load(i)), !e.attributes) return;\n  const o = e.attributes[r.objectIdField];\n  if (null == o) return;\n  const a = [o],\n        l = await t.getRequiredFields(r.fieldsIndex),\n        s = u(l, e),\n        f = s ? [] : l,\n        c = t.returnGeometry || (await ee(t));\n  if (s && !c) return;\n  const d = await _({\n    layer: r,\n    graphic: e,\n    outFields: f,\n    objectIds: a,\n    returnGeometry: c,\n    spatialReference: n\n  }, i);\n  d && (d.geometry && (e.geometry = d.geometry), d.attributes && (e.attributes = { ...e.attributes,\n    ...d.attributes\n  }));\n}\n\nfunction re(e = \"\") {\n  return !!e && -1 !== e.indexOf(I);\n}\n\nfunction ne(e) {\n  return e ? `${I}${e.layerId}/${e.fieldName}` : \"\";\n}\n\nfunction ie({\n  attributes: e,\n  graphic: t,\n  relatedInfo: r\n}) {\n  e && t && r && Object.keys(t.attributes).forEach(n => {\n    const i = ne({\n      layerId: r.relation.id.toString(),\n      fieldName: n\n    });\n    e[i] = t.attributes[n];\n  });\n}\n\nfunction oe(e, t) {\n  e && t && (t.relatedFeatures && t.relatedFeatures && t.relatedFeatures.forEach(r => ie({\n    attributes: e,\n    graphic: r,\n    relatedInfo: t\n  })), t.relatedStatsFeatures && t.relatedStatsFeatures && t.relatedStatsFeatures.forEach(r => ie({\n    attributes: e,\n    graphic: r,\n    relatedInfo: t\n  })));\n}\n\nexport { X as applyTextFormattingHTML, K as createfieldInfoMap, U as fixTokens, Z as formatAttributes, J as formatEditInfo, P as formatValueToFieldInfo, V as getAllFieldInfos, z as getFieldInfo, x as getFieldInfoLabel, E as getFixedFieldName, q as getFixedFieldNames, N as getSourceLayer, j as graphicCallback, W as htmlEntities, C as isExpressionField, re as isRelatedField, te as queryUpdatedFeature, v as shouldOpenInNewTab, R as substituteAttributes, G as substituteFieldsInLinksAndAttributes };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/widgets/Feature/support/featureUtils.js"],"names":["e","isNone","t","replace","r","formatDate","n","convertDateFormatToIntlOptions","i","formatNumber","o","convertNumberFormatToIntlOptions","a","featureHasFields","u","l","loadArcade","s","f","c","getLogger","d","p","m","y","g","h","b","F","I","w","N","get","j","call","v","test","trim","toLowerCase","C","L","some","name","x","fieldName","title","label","D","A","E","M","q","map","getField","$","G","attributes","globalAttributes","layer","text","expressionAttributes","fieldInfoMap","R","formattedAttributes","template","k","S","encodeURIComponent","T","Object","keys","forEach","O","U","Q","dateFormat","places","digitSeparator","Number","isNaN","P","fieldInfos","z","clone","preventPlacesFormatting","type","format","minimumFractionDigits","maximumFractionDigits","length","B","graphic","re","getFeatureType","typeIdField","H","value","getFieldDomain","feature","getName","J","creatorField","creationDateField","editorField","editDateField","date","user","K","Map","set","V","content","push","Array","isArray","W","charCodeAt","X","Y","fieldsIndex","isDateField","Z","relatedInfos","oe","_","outFields","objectIds","returnGeometry","spatialReference","objectId","requiredFields","warn","capabilities","operations","supportsQuery","createQuery","objectIdField","outSpatialReference","queryFeatures","features","ee","expressionInfos","arcadeUtils","hasGeometryFunctions","te","popupTemplate","load","getRequiredFields","geometry","indexOf","ne","layerId","ie","relatedInfo","relation","id","toString","relatedFeatures","relatedStatsFeatures","applyTextFormattingHTML","createfieldInfoMap","fixTokens","formatAttributes","formatEditInfo","formatValueToFieldInfo","getAllFieldInfos","getFieldInfo","getFieldInfoLabel","getFixedFieldName","getFixedFieldNames","getSourceLayer","graphicCallback","htmlEntities","isExpressionField","isRelatedField","queryUpdatedFeature","shouldOpenInNewTab","substituteAttributes","substituteFieldsInLinksAndAttributes"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../intl.js\";import e from\"../../../core/Logger.js\";import{isNone as t}from\"../../../core/maybe.js\";import{replace as r}from\"../../../core/string.js\";import{formatDate as n,convertDateFormatToIntlOptions as i}from\"../../../intl/date.js\";import{formatNumber as o,convertNumberFormatToIntlOptions as a}from\"../../../intl/number.js\";import{featureHasFields as u}from\"../../../layers/support/fieldUtils.js\";import l from\"../../../popup/support/FieldInfoFormat.js\";import{loadArcade as s}from\"../../../support/arcadeOnDemand.js\";const f=\"esri.widgets.Feature.support.featureUtils\",c=e.getLogger(f),d=/href=(\"\"|'')/gi,p=/(\\{([^\\{\\r\\n]+)\\})/g,m=/\\'/g,y=/^\\s*expression\\//i,g=/(\\n)/gi,h=/[\\u00A0-\\u9999<>\\&]/gim,b=/href\\s*=\\s*(?:\\\"([^\\\"]+)\\\"|\\'([^\\']+)\\')/gi,F=/^(?:mailto:|tel:)/,I=\"relationships/\",w=i(\"short-date-short-time\");function N(e){if(!t(e))return e.get(\"sourceLayer\")||e.get(\"layer\")}async function j(e,t){return\"function\"==typeof e?e.call(null,t):e}function v(e=\"\"){if(e)return!F.test(e.trim().toLowerCase())}function C(e){return y.test(e)}function L(e,t){if(!C(t)||!e)return null;const r=t.replace(y,\"\").toLowerCase();let n;return e.some((e=>e.name.toLowerCase()===r&&(n=e,!0))),n}function x(e,t){const r=L(t,null==e?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function D(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}function A(e){return e.replace(d,\"\")}function E(e,t){const r=M(t,e);return r?r.name:e}function q(e,t){return e&&e.map((e=>E(e,t)))}function M(e,t){return e&&\"function\"==typeof e.getField?e.getField(t):null}function $(e){return`${e}`.trim()}function G({attributes:e,globalAttributes:t,layer:r,text:n,expressionAttributes:i,fieldInfoMap:o}){return n?R({formattedAttributes:t,template:k(n,{...t,...i,...e},r),fieldInfoMap:o}):\"\"}function R({formattedAttributes:e,template:t,fieldInfoMap:n}){return $(A(r(r(t,(e=>D(e,n))),e)))}function S(e,t,r=!1){const n=t[e];if(\"string\"==typeof n){const i=\"%27\",o=(r?encodeURIComponent(n):n).replace(m,i);t[e]=o}}function T(e,t=!1){const r={...e};return Object.keys(r).forEach((e=>S(e,r,t))),r}function O(e,t,n){const i=(t=$(t))&&\"{\"!==t[0];return r(e,T(n,i))}function U(e,t){return e.replace(p,((e,r,n)=>{const i=M(t,n);return i?`{${i.name}}`:r}))}function k(e,t,r){const n=U(e,r);return n?n.replace(b,((e,r,n)=>O(e,r||n,t))):n}function Q(e,t){if(\"string\"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}function P(e,t){const r=t.fieldInfos,n=t.fieldName,i=z(r,n),u=null==i?void 0:i.clone(),s=t.preventPlacesFormatting,f=M(t.layer,n);if(u&&f&&\"date\"===f.type){const e=u.format||new l;e.dateFormat=e.dateFormat||\"short-date-short-time\",u.format=e}const c=u&&u.format;return\"string\"==typeof(e=Q(e,c))||null==e||null==c?e:s?o(e,{...a(c),minimumFractionDigits:0,maximumFractionDigits:20}):c.format(e)}function z(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let n;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r)&&(n=e,!0))),n}function B({fieldName:e,graphic:t,layer:r}){if(re(e))return null;if(!r||\"function\"!=typeof r.getFeatureType)return null;const{typeIdField:n}=r;if(!n||e!==n)return null;const i=r.getFeatureType(t);return i?i.name:null}function H({fieldName:e,value:t,graphic:r,layer:n}){if(re(e))return null;if(!n||\"function\"!=typeof n.getFieldDomain)return null;const i=n.getFieldDomain(e,{feature:r});return i&&\"coded-value\"===i.type?i.getName(t):null}function J(e,t){const{creatorField:r,creationDateField:i,editorField:o,editDateField:a}=e;if(!t)return;const u=t[a];if(\"number\"==typeof u){const e=t[o];return{type:\"edit\",date:n(u,w),user:e}}const l=t[i];if(\"number\"==typeof l){const e=t[r];return{type:\"create\",date:n(l,w),user:e}}return null}function K(e,t){const r=new Map;return e&&e.forEach((e=>{const n=E(e.fieldName,t);e.fieldName=n,r.set(n.toLowerCase(),e)})),r}function V(e){const t=[];if(!e)return t;const{fieldInfos:r,content:n}=e;return r&&t.push(...r),n&&Array.isArray(n)?(n.forEach((e=>{if(\"fields\"===e.type){const r=e&&e.fieldInfos;r&&t.push(...r)}})),t):t}function W(e){return e.replace(h,(e=>`&#${e.charCodeAt(0)};`))}function X(e){return\"string\"==typeof e?e.replace(g,'<br class=\"esri-text-new-line\" />'):e}function Y(e){const{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:o,layer:a,graphic:u}=e;if(null==t)return\"\";const l=H({fieldName:r,value:t,graphic:u,layer:a});if(l)return l;const s=B({fieldName:r,graphic:u,layer:a});if(s)return s;if(o.get(r.toLowerCase()))return P(t,{fieldInfos:i,fieldName:r,layer:a});const f=a&&a.fieldsIndex;return f&&f.isDateField(r)?n(t,w):X(t)}function Z({fieldInfos:e,attributes:t,layer:r,graphic:n,fieldInfoMap:i,relatedInfos:o}){const a={...t};return null==o||o.forEach((e=>oe(a,e))),Object.keys(a).forEach((t=>{const o=a[t];a[t]=Y({fieldName:t,fieldInfos:e,fieldInfoMap:i,layer:r,value:o,graphic:n})})),a}async function _(e,t){var r,n;const{layer:i,graphic:o,outFields:a,objectIds:u,returnGeometry:l,spatialReference:s}=e,f=u[0];if(\"number\"!=typeof f&&\"string\"!=typeof f){const e=\"Could not query required fields for the specified feature. The feature's ID is invalid.\",t={layer:i,graphic:o,objectId:f,requiredFields:a};return c.warn(e,t),null}if(null==(r=i.capabilities)||null==(n=r.operations)||!n.supportsQuery){const e=\"The specified layer cannot be queried. The following fields will not be available.\",t={layer:i,graphic:o,requiredFields:a,returnGeometry:l};return c.warn(e,t),null}const d=i.createQuery();d.objectIds=u,d.outFields=null!=a&&a.length?a:[i.objectIdField],d.returnGeometry=!!l,d.outSpatialReference=s;return(await i.queryFeatures(d,t)).features[0]}async function ee(e){var t;if(null==(t=e.expressionInfos)||!t.length)return!1;const r=await s(),{arcadeUtils:{hasGeometryFunctions:n}}=r;return n(e)}async function te({graphic:e,popupTemplate:t,layer:r,spatialReference:n},i){if(!r||!t)return;if(\"function\"==typeof r.load&&await r.load(i),!e.attributes)return;const o=e.attributes[r.objectIdField];if(null==o)return;const a=[o],l=await t.getRequiredFields(r.fieldsIndex),s=u(l,e),f=s?[]:l,c=t.returnGeometry||await ee(t);if(s&&!c)return;const d=await _({layer:r,graphic:e,outFields:f,objectIds:a,returnGeometry:c,spatialReference:n},i);d&&(d.geometry&&(e.geometry=d.geometry),d.attributes&&(e.attributes={...e.attributes,...d.attributes}))}function re(e=\"\"){return!!e&&-1!==e.indexOf(I)}function ne(e){return e?`${I}${e.layerId}/${e.fieldName}`:\"\"}function ie({attributes:e,graphic:t,relatedInfo:r}){e&&t&&r&&Object.keys(t.attributes).forEach((n=>{const i=ne({layerId:r.relation.id.toString(),fieldName:n});e[i]=t.attributes[n]}))}function oe(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((r=>ie({attributes:e,graphic:r,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((r=>ie({attributes:e,graphic:r,relatedInfo:t}))))}export{X as applyTextFormattingHTML,K as createfieldInfoMap,U as fixTokens,Z as formatAttributes,J as formatEditInfo,P as formatValueToFieldInfo,V as getAllFieldInfos,z as getFieldInfo,x as getFieldInfoLabel,E as getFixedFieldName,q as getFixedFieldNames,N as getSourceLayer,j as graphicCallback,W as htmlEntities,C as isExpressionField,re as isRelatedField,te as queryUpdatedFeature,v as shouldOpenInNewTab,R as substituteAttributes,G as substituteFieldsInLinksAndAttributes};\n"]},"metadata":{},"sourceType":"module"}