{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport \"../../../../core/has.js\";\nimport t from \"../../../../core/Logger.js\";\nimport { isFinite as o } from \"../../../../core/mathUtils.js\";\nimport { isSome as i, unwrap as r, unwrapOr as n } from \"../../../../core/maybe.js\";\nimport { O as s } from \"../../../../chunks/vec3f64.js\";\nimport { f as a } from \"../../../../chunks/vec4f64.js\";\nimport { SymbolUpdateType as l } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as p } from \"./ElevationContext.js\";\nimport { zeroContext as d } from \"./featureExpressionInfoUtils.js\";\nimport { mixinColorAndOpacity as c } from \"./graphicUtils.js\";\nimport { Loadable as u } from \"./Loadable.js\";\nimport { defaultSymbolLayerComplexity as h } from \"./symbolComplexity.js\";\nconst f = t.getLogger(\"esri.views.3d.layers.graphics.Graphics3DSymbolLayer\");\n\nclass y extends u {\n  constructor(e, t, o, i) {\n    super(o.schedule), this._context = o, this._elevationInfoOverride = null, this.complexity = null, this.logger = f, this._elevationOptions = {\n      supportsOffsetAdjustment: !1,\n      supportsOnTheGround: !0\n    }, this.symbol = e, this.symbolLayer = t, this._renderPriority = i.renderPriority, this._renderPriorityStep = i.renderPriorityStep, this._elevationContext = new p(), this.complexity = this.computeComplexity(), this._updateDrivenProperties(i.ignoreDrivers), this._updateElevationContext();\n  }\n\n  getCachedSize() {\n    return null;\n  }\n\n  get extentPadding() {\n    return 0;\n  }\n\n  get needsDrivenTransparentPass() {\n    return this._drivenProperties.opacity && !this._drivenProperties.opacityAlwaysOpaque;\n  }\n\n  _logGeometryCreationWarnings(e, t, o, i) {\n    const r = e.projectionSuccess,\n          n = \"polygons\" in e ? e.polygons : null,\n          s = `${i} geometry failed to be created`;\n    let a = null;\n    r ? !t.length || 1 === t.length && !t[0].length ? a = `${s} (no ${o} were defined)` : Array.isArray(t) && Array.isArray(t[0]) ? n && 0 === n.length && \"rings\" === o && t.length > 0 && t[0].length > 2 && (a = `${s} (filled rings should use clockwise winding - try reversing the order of vertices)`) : a = `${s} (${o} should be defined as a 2D array)` : a = `${s} (failed to project geometry to view spatial reference)`, a && f.warnOncePerTick(a);\n  }\n\n  _validateGeometry(e, t = null, r = null) {\n    if (i(t) && !t.includes(e.type)) return this.logger.warn(\"unsupported geometry type for \" + r + ` symbol: ${e.type}`), !1;\n\n    if (\"point\" === e.type) {\n      const t = e;\n      if (!o(t.x) || !o(t.y)) return f.warn(\"point coordinate is not a valid number, graphic skipped\"), !1;\n    }\n\n    return !0;\n  }\n\n  _defaultElevationInfoNoZ() {\n    return m;\n  }\n\n  _defaultElevationInfoZ() {\n    return g;\n  }\n\n  _updateElevationContext() {\n    i(this._elevationInfoOverride) ? (this._elevationContext.setFromElevationInfo(this._elevationInfoOverride), this._elevationContext.updateFeatureExpressionInfoContext(null)) : this._context.layer.elevationInfo ? (this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo), this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)) : this._elevationContext.reset();\n  }\n\n  getDefaultElevationInfo(e) {\n    return e.hasZ ? this._defaultElevationInfoZ() : this._defaultElevationInfoNoZ();\n  }\n\n  getGeometryElevationMode(e, t = this.getDefaultElevationInfo(e)) {\n    return this._elevationContext.mode || t.mode;\n  }\n\n  setElevationInfoOverride(e) {\n    this._elevationInfoOverride = e, this._updateElevationContext();\n  }\n\n  setGraphicElevationContext(e, t) {\n    const o = r(e.geometry),\n          i = this.getDefaultElevationInfo(o);\n    t.unit = null != this._elevationContext.unit ? this._elevationContext.unit : i.unit, t.mode = this.getGeometryElevationMode(o, i), t.offsetMeters = n(this._elevationContext.meterUnitOffset, n(i.offset, 0));\n    const s = !this._elevationOptions.supportsOnTheGround && \"on-the-ground\" === t.mode;\n    s && (t.mode = \"relative-to-ground\", t.offsetMeters = 0);\n    const a = s ? d : this._elevationContext.featureExpressionInfoContext;\n    return t.updateFeatureExpressionInfoContext(a, e, this._context.layer), t;\n  }\n\n  prepareSymbolLayerPatch(e) {}\n\n  updateGeometry(e, t) {\n    return !1;\n  }\n\n  onRemoveGraphic(e) {}\n\n  _updateDrivenProperties(e) {\n    const t = {\n      color: !1,\n      opacity: !1,\n      opacityAlwaysOpaque: !0,\n      size: !1\n    };\n    if (e) return void (this._drivenProperties = t);\n    const o = this._context.renderer;\n    o && \"visualVariables\" in o && o.visualVariables && o.visualVariables.forEach(e => {\n      switch (e.type) {\n        case \"color\":\n          if (t.color = !0, e.stops) for (let o = 0; o < e.stops.length; o++) {\n            const i = e.stops[o].color;\n            i && (t.opacity = !0, i.a < 1 && (t.opacityAlwaysOpaque = !1));\n          }\n          break;\n\n        case \"opacity\":\n          t.opacity = !0, t.opacityAlwaysOpaque = !1;\n          break;\n\n        case \"size\":\n          t.size = !0;\n      }\n    }), this._drivenProperties = t;\n  }\n\n  _getLayerOpacity() {\n    if (this._context.layerView && \"fullOpacity\" in this._context.layerView) return this._context.layerView.fullOpacity;\n    const e = this._context.layer.opacity;\n    return null == e ? 1 : e;\n  }\n\n  _getCombinedOpacity(e, t = _) {\n    let o = 1;\n    return this.draped || (o *= this._getLayerOpacity()), this._drivenProperties.opacity || (i(e) ? o *= e.a : t.hasIntrinsicColor || (o = 0)), o;\n  }\n\n  _getCombinedOpacityAndColor(t, o = _) {\n    const r = this._getCombinedOpacity(t, o);\n\n    if (this._drivenProperties.color) return c(null, r);\n    const n = i(t) ? e.toUnitRGB(t) : s;\n    return c(n, r);\n  }\n\n  _getVertexOpacityAndColor(e, t = null) {\n    const o = this._drivenProperties.color ? e.color : null,\n          r = this._drivenProperties.opacity ? e.opacity : null,\n          n = c(o, r);\n    return i(t) && (n[0] *= t, n[1] *= t, n[2] *= t, n[3] *= t), n;\n  }\n\n  isFastUpdatesEnabled() {\n    return this._fastUpdates && this._fastUpdates.enabled;\n  }\n\n  computeComplexity() {\n    return h(this.symbol, this.symbolLayer);\n  }\n\n  destroy() {\n    this.abortLoad();\n  }\n\n  globalPropertyChanged(e, t, o) {\n    switch (e) {\n      case \"opacity\":\n        return this.layerOpacityChanged(t, o);\n\n      case \"elevationInfo\":\n        {\n          const e = this._elevationContext.mode;\n\n          this._updateElevationContext();\n\n          return this.layerElevationInfoChanged(t, o, e) !== l.RECREATE;\n        }\n\n      case \"slicePlaneEnabled\":\n        return this.slicePlaneEnabledChanged(t, o);\n\n      case \"physicalBasedRenderingEnabled\":\n        return this.physicalBasedRenderingChanged();\n\n      case \"pixelRatio\":\n        return this.pixelRatioChanged();\n\n      default:\n        return !1;\n    }\n  }\n\n  updateGraphics3DGraphicElevationInfo(e, t, o) {\n    let r = l.UPDATE;\n    return e.forEach(e => {\n      const n = t(e);\n\n      if (i(n)) {\n        const t = e.graphic;\n        this.setGraphicElevationContext(t, n.elevationContext), n.needsElevationUpdates = o(n.elevationContext.mode);\n      } else r = l.RECREATE;\n    }), r;\n  }\n\n  applyRendererDiff(e, t) {\n    return !1;\n  }\n\n  getFastUpdateAttrValues(e) {\n    if (!this._fastUpdates.enabled) return null;\n    const t = this._fastUpdates.visualVariables,\n          o = t.size ? v(t.size.field, e) : 0,\n          i = t.color ? v(t.color.field, e) : 0,\n          r = t.opacity ? v(t.opacity.field, e) : 0;\n    return a(o, i, r, 0);\n  }\n\n  get draped() {\n    return this._draped;\n  }\n\n  ensureDrapedStatus(e) {\n    return null == this._draped ? (this._draped = e, !0) : (e !== this.draped && f.warnOnce(\"A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.\"), !1);\n  }\n\n}\n\nfunction v(e, t) {\n  const o = null != e ? t.attributes[e] : 0;\n  return null != o && isFinite(o) ? o : 0;\n}\n\nconst m = {\n  mode: \"on-the-ground\",\n  offset: 0,\n  unit: \"meters\"\n},\n      g = {\n  mode: \"absolute-height\",\n  offset: 0,\n  unit: \"meters\"\n},\n      _ = {\n  hasIntrinsicColor: !1\n};\nexport default y;\nexport { y as Graphics3DSymbolLayer, v as getAttributeValue };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolLayer.js"],"names":["e","t","isFinite","o","isSome","i","unwrap","r","unwrapOr","n","O","s","f","a","SymbolUpdateType","l","ElevationContext","p","zeroContext","d","mixinColorAndOpacity","c","Loadable","u","defaultSymbolLayerComplexity","h","getLogger","y","constructor","schedule","_context","_elevationInfoOverride","complexity","logger","_elevationOptions","supportsOffsetAdjustment","supportsOnTheGround","symbol","symbolLayer","_renderPriority","renderPriority","_renderPriorityStep","renderPriorityStep","_elevationContext","computeComplexity","_updateDrivenProperties","ignoreDrivers","_updateElevationContext","getCachedSize","extentPadding","needsDrivenTransparentPass","_drivenProperties","opacity","opacityAlwaysOpaque","_logGeometryCreationWarnings","projectionSuccess","polygons","length","Array","isArray","warnOncePerTick","_validateGeometry","includes","type","warn","x","_defaultElevationInfoNoZ","m","_defaultElevationInfoZ","g","setFromElevationInfo","updateFeatureExpressionInfoContext","layer","elevationInfo","featureExpressionInfoContext","reset","getDefaultElevationInfo","hasZ","getGeometryElevationMode","mode","setElevationInfoOverride","setGraphicElevationContext","geometry","unit","offsetMeters","meterUnitOffset","offset","prepareSymbolLayerPatch","updateGeometry","onRemoveGraphic","color","size","renderer","visualVariables","forEach","stops","_getLayerOpacity","layerView","fullOpacity","_getCombinedOpacity","_","draped","hasIntrinsicColor","_getCombinedOpacityAndColor","toUnitRGB","_getVertexOpacityAndColor","isFastUpdatesEnabled","_fastUpdates","enabled","destroy","abortLoad","globalPropertyChanged","layerOpacityChanged","layerElevationInfoChanged","RECREATE","slicePlaneEnabledChanged","physicalBasedRenderingChanged","pixelRatioChanged","updateGraphics3DGraphicElevationInfo","UPDATE","graphic","elevationContext","needsElevationUpdates","applyRendererDiff","getFastUpdateAttrValues","v","field","_draped","ensureDrapedStatus","warnOnce","attributes","Graphics3DSymbolLayer","getAttributeValue"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import\"../../../../core/has.js\";import t from\"../../../../core/Logger.js\";import{isFinite as o}from\"../../../../core/mathUtils.js\";import{isSome as i,unwrap as r,unwrapOr as n}from\"../../../../core/maybe.js\";import{O as s}from\"../../../../chunks/vec3f64.js\";import{f as a}from\"../../../../chunks/vec4f64.js\";import{SymbolUpdateType as l}from\"./elevationAlignmentUtils.js\";import{ElevationContext as p}from\"./ElevationContext.js\";import{zeroContext as d}from\"./featureExpressionInfoUtils.js\";import{mixinColorAndOpacity as c}from\"./graphicUtils.js\";import{Loadable as u}from\"./Loadable.js\";import{defaultSymbolLayerComplexity as h}from\"./symbolComplexity.js\";const f=t.getLogger(\"esri.views.3d.layers.graphics.Graphics3DSymbolLayer\");class y extends u{constructor(e,t,o,i){super(o.schedule),this._context=o,this._elevationInfoOverride=null,this.complexity=null,this.logger=f,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new p,this.complexity=this.computeComplexity(),this._updateDrivenProperties(i.ignoreDrivers),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,o,i){const r=e.projectionSuccess,n=\"polygons\"in e?e.polygons:null,s=`${i} geometry failed to be created`;let a=null;r?!t.length||1===t.length&&!t[0].length?a=`${s} (no ${o} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?n&&0===n.length&&\"rings\"===o&&t.length>0&&t[0].length>2&&(a=`${s} (filled rings should use clockwise winding - try reversing the order of vertices)`):a=`${s} (${o} should be defined as a 2D array)`:a=`${s} (failed to project geometry to view spatial reference)`,a&&f.warnOncePerTick(a)}_validateGeometry(e,t=null,r=null){if(i(t)&&!t.includes(e.type))return this.logger.warn(\"unsupported geometry type for \"+r+` symbol: ${e.type}`),!1;if(\"point\"===e.type){const t=e;if(!o(t.x)||!o(t.y))return f.warn(\"point coordinate is not a valid number, graphic skipped\"),!1}return!0}_defaultElevationInfoNoZ(){return m}_defaultElevationInfoZ(){return g}_updateElevationContext(){i(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const o=r(e.geometry),i=this.getDefaultElevationInfo(o);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(o,i),t.offsetMeters=n(this._elevationContext.meterUnitOffset,n(i.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&\"on-the-ground\"===t.mode;s&&(t.mode=\"relative-to-ground\",t.offsetMeters=0);const a=s?d:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_updateDrivenProperties(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};if(e)return void(this._drivenProperties=t);const o=this._context.renderer;o&&\"visualVariables\"in o&&o.visualVariables&&o.visualVariables.forEach((e=>{switch(e.type){case\"color\":if(t.color=!0,e.stops)for(let o=0;o<e.stops.length;o++){const i=e.stops[o].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case\"opacity\":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case\"size\":t.size=!0}})),this._drivenProperties=t}_getLayerOpacity(){if(this._context.layerView&&\"fullOpacity\"in this._context.layerView)return this._context.layerView.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=_){let o=1;return this.draped||(o*=this._getLayerOpacity()),this._drivenProperties.opacity||(i(e)?o*=e.a:t.hasIntrinsicColor||(o=0)),o}_getCombinedOpacityAndColor(t,o=_){const r=this._getCombinedOpacity(t,o);if(this._drivenProperties.color)return c(null,r);const n=i(t)?e.toUnitRGB(t):s;return c(n,r)}_getVertexOpacityAndColor(e,t=null){const o=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,n=c(o,r);return i(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return h(this.symbol,this.symbolLayer)}destroy(){this.abortLoad()}globalPropertyChanged(e,t,o){switch(e){case\"opacity\":return this.layerOpacityChanged(t,o);case\"elevationInfo\":{const e=this._elevationContext.mode;this._updateElevationContext();return this.layerElevationInfoChanged(t,o,e)!==l.RECREATE}case\"slicePlaneEnabled\":return this.slicePlaneEnabledChanged(t,o);case\"physicalBasedRenderingEnabled\":return this.physicalBasedRenderingChanged();case\"pixelRatio\":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,o){let r=l.UPDATE;return e.forEach((e=>{const n=t(e);if(i(n)){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=o(n.elevationContext.mode)}else r=l.RECREATE})),r}applyRendererDiff(e,t){return!1}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,o=t.size?v(t.size.field,e):0,i=t.color?v(t.color.field,e):0,r=t.opacity?v(t.opacity.field,e):0;return a(o,i,r,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&f.warnOnce(\"A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.\"),!1)}}function v(e,t){const o=null!=e?t.attributes[e]:0;return null!=o&&isFinite(o)?o:0}const m={mode:\"on-the-ground\",offset:0,unit:\"meters\"},g={mode:\"absolute-height\",offset:0,unit:\"meters\"},_={hasIntrinsicColor:!1};export default y;export{y as Graphics3DSymbolLayer,v as getAttributeValue};\n"]},"metadata":{},"sourceType":"module"}