{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Logger.js\";\nimport { disposeMaybe as t, abortMaybe as r } from \"../../../core/maybe.js\";\nimport { createResolver as o, createAbortController as i, isAbortError as s } from \"../../../core/promiseUtils.js\";\nimport { d as n } from \"../../../chunks/mat4.js\";\nimport { c as a } from \"../../../chunks/mat4f64.js\";\nimport { requestImage as m } from \"../../../support/requestImageUtils.js\";\nimport { SimpleAtmosphereTechniqueConfiguration as l, SimpleAtmosphereTechnique as h } from \"./SimpleAtmosphereTechnique.js\";\nimport c from \"./resources/SimpleAtmosphereTexture.js\";\nimport { glLayout as p } from \"../support/buffer/glUtil.js\";\nimport { newLayout as u } from \"../support/buffer/InterleavedLayout.js\";\nimport { bindProjectionMatrix as f } from \"../webgl-engine/core/shaderLibrary/util/View.glsl.js\";\nimport { Default3D as g } from \"../webgl-engine/lib/DefaultVertexAttributeLocations.js\";\nimport d from \"../webgl-engine/lib/GeometryUtil.js\";\nimport _ from \"../../webgl/BufferObject.js\";\nimport y from \"../../webgl/Texture.js\";\nimport { vertexCount as b } from \"../../webgl/Util.js\";\nimport x from \"../../webgl/VertexArrayObject.js\";\nconst j = e.getLogger(\"esri.views.3d.environment.PanoramicAtmosphere\");\n\nclass v {\n  constructor() {\n    this.slot = 14, this._atmosphereTechniqueConfig = new l(), this._readyResolver = o(), this._readyController = i();\n  }\n\n  get canRender() {\n    return null != this._texture;\n  }\n\n  destroy() {\n    this._readyResolver.reject(), this._texture = t(this._texture), this._vao = t(this._vao), this._readyController = r(this._readyController);\n  }\n\n  when() {\n    return this._readyResolver.promise;\n  }\n\n  initializeRenderContext(e) {\n    this._atmosphereTechniqueConfig.geometry = 1, this._atmosphereTechnique = e.shaderTechniqueRep.acquire(h, this._atmosphereTechniqueConfig);\n    const t = e.renderContext.rctx;\n    this._vao = this._createVertexArrayObject(t), this._vaoCount = b(this._vao, \"geometry\"), m(c, {\n      signal: this._readyController.signal\n    }).then(r => {\n      this._texture = new y(t, {\n        pixelFormat: 6408,\n        dataType: 5121,\n        wrapMode: 33071,\n        samplingMode: 9729,\n        flipped: !0\n      }, r), e.requestRender(), this._readyController = null, this._readyResolver.resolve();\n    }).catch(e => {\n      s(e) || j.error(\"Unable to initialize atmosphere: image request failed\", e), this._readyResolver.reject();\n    });\n  }\n\n  uninitializeRenderContext() {\n    this.destroy();\n  }\n\n  render(e) {\n    if (e.slot !== this.slot || 0 !== e.pass) return !1;\n    const t = e.rctx,\n          r = this._atmosphereTechnique.program;\n    return t.useProgram(r), this._atmosphereTechnique.bindPipelineState(t), r.bindTexture(this._texture, \"tex\"), f(r, e.camera.projectionMatrix), w(C, e.camera.viewMatrix), r.setUniformMatrix4fv(\"view\", C), r.setUniform4f(\"color\", 1, 1, 1, 1), e.scenelightingData.setLightDirectionUniform(r), t.bindVAO(this._vao), r.assertCompatibleVertexAttributeLocations(this._vao), t.drawArrays(4, 0, this._vaoCount), !0;\n  }\n\n  _createVertexArrayObject(e) {\n    const t = d.createPolySphereGeometry(1, 2, !1),\n          r = t.indices.get(\"position\");\n\n    for (let n = 0; n < r.length; n += 3) {\n      const e = r[n];\n      r[n] = r[n + 2], r[n + 2] = e;\n    }\n\n    const o = t.vertexAttributes.get(\"position\").data,\n          i = q.createBuffer(r.length),\n          s = i.position;\n\n    for (let n = 0; n < r.length; ++n) {\n      const e = 3 * r[n];\n      s.set(n, 0, o[e]), s.set(n, 1, o[e + 1]), s.set(n, 2, o[e + 2]);\n    }\n\n    return new x(e, g, {\n      geometry: p(q)\n    }, {\n      geometry: _.createVertex(e, 35044, i.buffer)\n    });\n  }\n\n}\n\nfunction w(e, t) {\n  n(e, t), e[12] = 0, e[13] = 0, e[14] = 0, e[15] = 1;\n}\n\nconst C = a(),\n      q = u().vec3f(\"position\");\nexport default v;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/environment/PanoramicAtmosphere.js"],"names":["e","disposeMaybe","t","abortMaybe","r","createResolver","o","createAbortController","i","isAbortError","s","d","n","c","a","requestImage","m","SimpleAtmosphereTechniqueConfiguration","l","SimpleAtmosphereTechnique","h","glLayout","p","newLayout","u","bindProjectionMatrix","f","Default3D","g","_","y","vertexCount","b","x","j","getLogger","v","constructor","slot","_atmosphereTechniqueConfig","_readyResolver","_readyController","canRender","_texture","destroy","reject","_vao","when","promise","initializeRenderContext","geometry","_atmosphereTechnique","shaderTechniqueRep","acquire","renderContext","rctx","_createVertexArrayObject","_vaoCount","signal","then","pixelFormat","dataType","wrapMode","samplingMode","flipped","requestRender","resolve","catch","error","uninitializeRenderContext","render","pass","program","useProgram","bindPipelineState","bindTexture","camera","projectionMatrix","w","C","viewMatrix","setUniformMatrix4fv","setUniform4f","scenelightingData","setLightDirectionUniform","bindVAO","assertCompatibleVertexAttributeLocations","drawArrays","createPolySphereGeometry","indices","get","length","vertexAttributes","data","q","createBuffer","position","set","createVertex","buffer","vec3f"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,yBAAb;AAAuC,SAAOC,YAAY,IAAIC,CAAvB,EAAyBC,UAAU,IAAIC,CAAvC,QAA6C,wBAA7C;AAAsE,SAAOC,cAAc,IAAIC,CAAzB,EAA2BC,qBAAqB,IAAIC,CAApD,EAAsDC,YAAY,IAAIC,CAAtE,QAA4E,+BAA5E;AAA4G,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,yBAAlB;AAA4C,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,uCAA7B;AAAqE,SAAOC,sCAAsC,IAAIC,CAAjD,EAAmDC,yBAAyB,IAAIC,CAAhF,QAAsF,gCAAtF;AAAuH,OAAOP,CAAP,MAAa,wCAAb;AAAsD,SAAOQ,QAAQ,IAAIC,CAAnB,QAAyB,6BAAzB;AAAuD,SAAOC,SAAS,IAAIC,CAApB,QAA0B,wCAA1B;AAAmE,SAAOC,oBAAoB,IAAIC,CAA/B,QAAqC,sDAArC;AAA4F,SAAOC,SAAS,IAAIC,CAApB,QAA0B,wDAA1B;AAAmF,OAAOjB,CAAP,MAAa,qCAAb;AAAmD,OAAOkB,CAAP,MAAa,6BAAb;AAA2C,OAAOC,CAAP,MAAa,wBAAb;AAAsC,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,qBAA5B;AAAkD,OAAOC,CAAP,MAAa,kCAAb;AAAgD,MAAMC,CAAC,GAAClC,CAAC,CAACmC,SAAF,CAAY,+CAAZ,CAAR;;AAAqE,MAAMC,CAAN,CAAO;AAACC,EAAAA,WAAW,GAAE;AAAC,SAAKC,IAAL,GAAU,EAAV,EAAa,KAAKC,0BAAL,GAAgC,IAAIrB,CAAJ,EAA7C,EAAmD,KAAKsB,cAAL,GAAoBlC,CAAC,EAAxE,EAA2E,KAAKmC,gBAAL,GAAsBjC,CAAC,EAAlG;AAAqG;;AAAa,MAATkC,SAAS,GAAE;AAAC,WAAO,QAAM,KAAKC,QAAlB;AAA2B;;AAAAC,EAAAA,OAAO,GAAE;AAAC,SAAKJ,cAAL,CAAoBK,MAApB,IAA6B,KAAKF,QAAL,GAAczC,CAAC,CAAC,KAAKyC,QAAN,CAA5C,EAA4D,KAAKG,IAAL,GAAU5C,CAAC,CAAC,KAAK4C,IAAN,CAAvE,EAAmF,KAAKL,gBAAL,GAAsBrC,CAAC,CAAC,KAAKqC,gBAAN,CAA1G;AAAkI;;AAAAM,EAAAA,IAAI,GAAE;AAAC,WAAO,KAAKP,cAAL,CAAoBQ,OAA3B;AAAmC;;AAAAC,EAAAA,uBAAuB,CAACjD,CAAD,EAAG;AAAC,SAAKuC,0BAAL,CAAgCW,QAAhC,GAAyC,CAAzC,EAA2C,KAAKC,oBAAL,GAA0BnD,CAAC,CAACoD,kBAAF,CAAqBC,OAArB,CAA6BjC,CAA7B,EAA+B,KAAKmB,0BAApC,CAArE;AAAqI,UAAMrC,CAAC,GAACF,CAAC,CAACsD,aAAF,CAAgBC,IAAxB;AAA6B,SAAKT,IAAL,GAAU,KAAKU,wBAAL,CAA8BtD,CAA9B,CAAV,EAA2C,KAAKuD,SAAL,GAAezB,CAAC,CAAC,KAAKc,IAAN,EAAW,UAAX,CAA3D,EAAkF9B,CAAC,CAACH,CAAD,EAAG;AAAC6C,MAAAA,MAAM,EAAC,KAAKjB,gBAAL,CAAsBiB;AAA9B,KAAH,CAAD,CAA2CC,IAA3C,CAAiDvD,CAAC,IAAE;AAAC,WAAKuC,QAAL,GAAc,IAAIb,CAAJ,CAAM5B,CAAN,EAAQ;AAAC0D,QAAAA,WAAW,EAAC,IAAb;AAAkBC,QAAAA,QAAQ,EAAC,IAA3B;AAAgCC,QAAAA,QAAQ,EAAC,KAAzC;AAA+CC,QAAAA,YAAY,EAAC,IAA5D;AAAiEC,QAAAA,OAAO,EAAC,CAAC;AAA1E,OAAR,EAAqF5D,CAArF,CAAd,EAAsGJ,CAAC,CAACiE,aAAF,EAAtG,EAAwH,KAAKxB,gBAAL,GAAsB,IAA9I,EAAmJ,KAAKD,cAAL,CAAoB0B,OAApB,EAAnJ;AAAiL,KAAtO,EAAyOC,KAAzO,CAAgPnE,CAAC,IAAE;AAACU,MAAAA,CAAC,CAACV,CAAD,CAAD,IAAMkC,CAAC,CAACkC,KAAF,CAAQ,uDAAR,EAAgEpE,CAAhE,CAAN,EAAyE,KAAKwC,cAAL,CAAoBK,MAApB,EAAzE;AAAsG,KAA1V,CAAlF;AAA+a;;AAAAwB,EAAAA,yBAAyB,GAAE;AAAC,SAAKzB,OAAL;AAAe;;AAAA0B,EAAAA,MAAM,CAACtE,CAAD,EAAG;AAAC,QAAGA,CAAC,CAACsC,IAAF,KAAS,KAAKA,IAAd,IAAoB,MAAItC,CAAC,CAACuE,IAA7B,EAAkC,OAAM,CAAC,CAAP;AAAS,UAAMrE,CAAC,GAACF,CAAC,CAACuD,IAAV;AAAA,UAAenD,CAAC,GAAC,KAAK+C,oBAAL,CAA0BqB,OAA3C;AAAmD,WAAOtE,CAAC,CAACuE,UAAF,CAAarE,CAAb,GAAgB,KAAK+C,oBAAL,CAA0BuB,iBAA1B,CAA4CxE,CAA5C,CAAhB,EAA+DE,CAAC,CAACuE,WAAF,CAAc,KAAKhC,QAAnB,EAA4B,KAA5B,CAA/D,EAAkGjB,CAAC,CAACtB,CAAD,EAAGJ,CAAC,CAAC4E,MAAF,CAASC,gBAAZ,CAAnG,EAAiIC,CAAC,CAACC,CAAD,EAAG/E,CAAC,CAAC4E,MAAF,CAASI,UAAZ,CAAlI,EAA0J5E,CAAC,CAAC6E,mBAAF,CAAsB,MAAtB,EAA6BF,CAA7B,CAA1J,EAA0L3E,CAAC,CAAC8E,YAAF,CAAe,OAAf,EAAuB,CAAvB,EAAyB,CAAzB,EAA2B,CAA3B,EAA6B,CAA7B,CAA1L,EAA0NlF,CAAC,CAACmF,iBAAF,CAAoBC,wBAApB,CAA6ChF,CAA7C,CAA1N,EAA0QF,CAAC,CAACmF,OAAF,CAAU,KAAKvC,IAAf,CAA1Q,EAA+R1C,CAAC,CAACkF,wCAAF,CAA2C,KAAKxC,IAAhD,CAA/R,EAAqV5C,CAAC,CAACqF,UAAF,CAAa,CAAb,EAAe,CAAf,EAAiB,KAAK9B,SAAtB,CAArV,EAAsX,CAAC,CAA9X;AAAgY;;AAAAD,EAAAA,wBAAwB,CAACxD,CAAD,EAAG;AAAC,UAAME,CAAC,GAACS,CAAC,CAAC6E,wBAAF,CAA2B,CAA3B,EAA6B,CAA7B,EAA+B,CAAC,CAAhC,CAAR;AAAA,UAA2CpF,CAAC,GAACF,CAAC,CAACuF,OAAF,CAAUC,GAAV,CAAc,UAAd,CAA7C;;AAAuE,SAAI,IAAI9E,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACR,CAAC,CAACuF,MAAhB,EAAuB/E,CAAC,IAAE,CAA1B,EAA4B;AAAC,YAAMZ,CAAC,GAACI,CAAC,CAACQ,CAAD,CAAT;AAAaR,MAAAA,CAAC,CAACQ,CAAD,CAAD,GAAKR,CAAC,CAACQ,CAAC,GAAC,CAAH,CAAN,EAAYR,CAAC,CAACQ,CAAC,GAAC,CAAH,CAAD,GAAOZ,CAAnB;AAAqB;;AAAA,UAAMM,CAAC,GAACJ,CAAC,CAAC0F,gBAAF,CAAmBF,GAAnB,CAAuB,UAAvB,EAAmCG,IAA3C;AAAA,UAAgDrF,CAAC,GAACsF,CAAC,CAACC,YAAF,CAAe3F,CAAC,CAACuF,MAAjB,CAAlD;AAAA,UAA2EjF,CAAC,GAACF,CAAC,CAACwF,QAA/E;;AAAwF,SAAI,IAAIpF,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACR,CAAC,CAACuF,MAAhB,EAAuB,EAAE/E,CAAzB,EAA2B;AAAC,YAAMZ,CAAC,GAAC,IAAEI,CAAC,CAACQ,CAAD,CAAX;AAAeF,MAAAA,CAAC,CAACuF,GAAF,CAAMrF,CAAN,EAAQ,CAAR,EAAUN,CAAC,CAACN,CAAD,CAAX,GAAgBU,CAAC,CAACuF,GAAF,CAAMrF,CAAN,EAAQ,CAAR,EAAUN,CAAC,CAACN,CAAC,GAAC,CAAH,CAAX,CAAhB,EAAkCU,CAAC,CAACuF,GAAF,CAAMrF,CAAN,EAAQ,CAAR,EAAUN,CAAC,CAACN,CAAC,GAAC,CAAH,CAAX,CAAlC;AAAoD;;AAAA,WAAO,IAAIiC,CAAJ,CAAMjC,CAAN,EAAQ4B,CAAR,EAAU;AAACsB,MAAAA,QAAQ,EAAC5B,CAAC,CAACwE,CAAD;AAAX,KAAV,EAA0B;AAAC5C,MAAAA,QAAQ,EAACrB,CAAC,CAACqE,YAAF,CAAelG,CAAf,EAAiB,KAAjB,EAAuBQ,CAAC,CAAC2F,MAAzB;AAAV,KAA1B,CAAP;AAA8E;;AAA33D;;AAA43D,SAASrB,CAAT,CAAW9E,CAAX,EAAaE,CAAb,EAAe;AAACU,EAAAA,CAAC,CAACZ,CAAD,EAAGE,CAAH,CAAD,EAAOF,CAAC,CAAC,EAAD,CAAD,GAAM,CAAb,EAAeA,CAAC,CAAC,EAAD,CAAD,GAAM,CAArB,EAAuBA,CAAC,CAAC,EAAD,CAAD,GAAM,CAA7B,EAA+BA,CAAC,CAAC,EAAD,CAAD,GAAM,CAArC;AAAuC;;AAAA,MAAM+E,CAAC,GAACjE,CAAC,EAAT;AAAA,MAAYgF,CAAC,GAACtE,CAAC,GAAG4E,KAAJ,CAAU,UAAV,CAAd;AAAoC,eAAehE,CAAf","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Logger.js\";import{disposeMaybe as t,abortMaybe as r}from\"../../../core/maybe.js\";import{createResolver as o,createAbortController as i,isAbortError as s}from\"../../../core/promiseUtils.js\";import{d as n}from\"../../../chunks/mat4.js\";import{c as a}from\"../../../chunks/mat4f64.js\";import{requestImage as m}from\"../../../support/requestImageUtils.js\";import{SimpleAtmosphereTechniqueConfiguration as l,SimpleAtmosphereTechnique as h}from\"./SimpleAtmosphereTechnique.js\";import c from\"./resources/SimpleAtmosphereTexture.js\";import{glLayout as p}from\"../support/buffer/glUtil.js\";import{newLayout as u}from\"../support/buffer/InterleavedLayout.js\";import{bindProjectionMatrix as f}from\"../webgl-engine/core/shaderLibrary/util/View.glsl.js\";import{Default3D as g}from\"../webgl-engine/lib/DefaultVertexAttributeLocations.js\";import d from\"../webgl-engine/lib/GeometryUtil.js\";import _ from\"../../webgl/BufferObject.js\";import y from\"../../webgl/Texture.js\";import{vertexCount as b}from\"../../webgl/Util.js\";import x from\"../../webgl/VertexArrayObject.js\";const j=e.getLogger(\"esri.views.3d.environment.PanoramicAtmosphere\");class v{constructor(){this.slot=14,this._atmosphereTechniqueConfig=new l,this._readyResolver=o(),this._readyController=i()}get canRender(){return null!=this._texture}destroy(){this._readyResolver.reject(),this._texture=t(this._texture),this._vao=t(this._vao),this._readyController=r(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(e){this._atmosphereTechniqueConfig.geometry=1,this._atmosphereTechnique=e.shaderTechniqueRep.acquire(h,this._atmosphereTechniqueConfig);const t=e.renderContext.rctx;this._vao=this._createVertexArrayObject(t),this._vaoCount=b(this._vao,\"geometry\"),m(c,{signal:this._readyController.signal}).then((r=>{this._texture=new y(t,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},r),e.requestRender(),this._readyController=null,this._readyResolver.resolve()})).catch((e=>{s(e)||j.error(\"Unable to initialize atmosphere: image request failed\",e),this._readyResolver.reject()}))}uninitializeRenderContext(){this.destroy()}render(e){if(e.slot!==this.slot||0!==e.pass)return!1;const t=e.rctx,r=this._atmosphereTechnique.program;return t.useProgram(r),this._atmosphereTechnique.bindPipelineState(t),r.bindTexture(this._texture,\"tex\"),f(r,e.camera.projectionMatrix),w(C,e.camera.viewMatrix),r.setUniformMatrix4fv(\"view\",C),r.setUniform4f(\"color\",1,1,1,1),e.scenelightingData.setLightDirectionUniform(r),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(4,0,this._vaoCount),!0}_createVertexArrayObject(e){const t=d.createPolySphereGeometry(1,2,!1),r=t.indices.get(\"position\");for(let n=0;n<r.length;n+=3){const e=r[n];r[n]=r[n+2],r[n+2]=e}const o=t.vertexAttributes.get(\"position\").data,i=q.createBuffer(r.length),s=i.position;for(let n=0;n<r.length;++n){const e=3*r[n];s.set(n,0,o[e]),s.set(n,1,o[e+1]),s.set(n,2,o[e+2])}return new x(e,g,{geometry:p(q)},{geometry:_.createVertex(e,35044,i.buffer)})}}function w(e,t){n(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const C=a(),q=u().vec3f(\"position\");export default v;\n"]},"metadata":{},"sourceType":"module"}