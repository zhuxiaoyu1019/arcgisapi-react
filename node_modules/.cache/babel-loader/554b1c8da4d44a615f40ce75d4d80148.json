{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as t, unwrap as r } from \"../../../../core/maybe.js\";\nimport i from \"../../../webgl/BufferObject.js\";\nimport \"../../../webgl/FramebufferObject.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../webgl/enums.js\";\nimport \"../../../webgl/RenderingContext.js\";\nimport \"../../../../chunks/builtins.js\";\nimport \"../../../webgl/Texture.js\";\nimport s from \"../../../webgl/VertexArrayObject.js\";\nimport { deserializeSymbols as n } from \"./decluttering/util.js\";\n\nclass f {\n  constructor(e, t) {\n    this.layerUIDs = [], this.isDestroyed = !1, this.data = e, this.memoryUsed = e.byteLength;\n    let r = 1;\n    const i = new Uint32Array(e);\n    this.layerUIDs = [];\n    const s = i[r++];\n\n    for (let n = 0; n < s; n++) this.layerUIDs[n] = i[r++];\n\n    this.bufferDataOffset = r, t && (this.layer = t.getStyleLayerByUID(this.layerUIDs[0]));\n  }\n\n  get isPreparedForRendering() {\n    return e(this.data);\n  }\n\n  get offset() {\n    return this.bufferDataOffset;\n  }\n\n  destroy() {\n    this.isDestroyed || (this.doDestroy(), this.isDestroyed = !0);\n  }\n\n  prepareForRendering(t) {\n    e(this.data) || (this.doPrepareForRendering(t, this.data, this.bufferDataOffset), this.data = null);\n  }\n\n}\n\nclass o extends f {\n  constructor(e, t) {\n    super(e, t), this.type = 2, this.lineIndexStart = 0, this.lineIndexCount = 0;\n    const r = new Uint32Array(e);\n    let i = this.bufferDataOffset;\n    this.lineIndexStart = r[i++], this.lineIndexCount = r[i++];\n    const s = r[i++];\n\n    if (s > 0) {\n      const e = new Map();\n\n      for (let t = 0; t < s; t++) {\n        const t = r[i++],\n              s = r[i++],\n              n = r[i++];\n        e.set(t, [s, n]);\n      }\n\n      this.patternMap = e;\n    }\n\n    this.bufferDataOffset = i;\n  }\n\n  hasData() {\n    return this.lineIndexCount > 0;\n  }\n\n  triangleCount() {\n    return this.lineIndexCount / 3;\n  }\n\n  doDestroy() {\n    t(this.lineVertexArrayObject) && this.lineVertexArrayObject.dispose(), t(this.lineVertexBuffer) && this.lineVertexBuffer.dispose(), t(this.lineIndexBuffer) && this.lineIndexBuffer.dispose(), this.lineVertexArrayObject = null, this.lineVertexBuffer = null, this.lineIndexBuffer = null, this.memoryUsed = 0;\n  }\n\n  doPrepareForRendering(e, t, r) {\n    const n = new Uint32Array(t),\n          f = new Int32Array(n.buffer),\n          o = n[r++];\n    this.lineVertexBuffer = i.createVertex(e, 35044, new Int32Array(f.buffer, 4 * r, o)), r += o;\n    const a = n[r++];\n    this.lineIndexBuffer = i.createIndex(e, 35044, new Uint32Array(n.buffer, 4 * r, a)), r += a;\n    const l = this.layer.lineMaterial;\n    this.lineVertexArrayObject = new s(e, l.getAttributeLocations(), l.getLayoutInfo(), {\n      geometry: this.lineVertexBuffer\n    }, this.lineIndexBuffer);\n  }\n\n}\n\nclass a extends f {\n  constructor(e, t) {\n    super(e, t), this.type = 1, this.fillIndexStart = 0, this.fillIndexCount = 0, this.outlineIndexStart = 0, this.outlineIndexCount = 0;\n    const r = new Uint32Array(e);\n    let i = this.bufferDataOffset;\n    this.fillIndexStart = r[i++], this.fillIndexCount = r[i++], this.outlineIndexStart = r[i++], this.outlineIndexCount = r[i++];\n    const s = r[i++];\n\n    if (s > 0) {\n      const e = new Map();\n\n      for (let t = 0; t < s; t++) {\n        const t = r[i++],\n              s = r[i++],\n              n = r[i++];\n        e.set(t, [s, n]);\n      }\n\n      this.patternMap = e;\n    }\n\n    this.bufferDataOffset = i;\n  }\n\n  hasData() {\n    return this.fillIndexCount > 0 || this.outlineIndexCount > 0;\n  }\n\n  triangleCount() {\n    return (this.fillIndexCount + this.outlineIndexCount) / 3;\n  }\n\n  doDestroy() {\n    t(this.fillVertexArrayObject) && this.fillVertexArrayObject.dispose(), t(this.fillVertexBuffer) && this.fillVertexBuffer.dispose(), t(this.fillIndexBuffer) && this.fillIndexBuffer.dispose(), this.fillVertexArrayObject = null, this.fillVertexBuffer = null, this.fillIndexBuffer = null, t(this.outlineVertexArrayObject) && this.outlineVertexArrayObject.dispose(), t(this.outlineVertexBuffer) && this.outlineVertexBuffer.dispose(), t(this.outlineIndexBuffer) && this.outlineIndexBuffer.dispose(), this.outlineVertexArrayObject = null, this.outlineVertexBuffer = null, this.outlineIndexBuffer = null, this.memoryUsed = 0;\n  }\n\n  doPrepareForRendering(e, t, r) {\n    const n = new Uint32Array(t),\n          f = new Int32Array(n.buffer),\n          o = n[r++];\n    this.fillVertexBuffer = i.createVertex(e, 35044, new Int32Array(f.buffer, 4 * r, o)), r += o;\n    const a = n[r++];\n    this.fillIndexBuffer = i.createIndex(e, 35044, new Uint32Array(n.buffer, 4 * r, a)), r += a;\n    const l = n[r++];\n    this.outlineVertexBuffer = i.createVertex(e, 35044, new Int32Array(f.buffer, 4 * r, l)), r += l;\n    const u = n[r++];\n    this.outlineIndexBuffer = i.createIndex(e, 35044, new Uint32Array(n.buffer, 4 * r, u)), r += u;\n    const h = this.layer,\n          c = h.fillMaterial,\n          x = h.outlineMaterial;\n    this.fillVertexArrayObject = new s(e, c.getAttributeLocations(), c.getLayoutInfo(), {\n      geometry: this.fillVertexBuffer\n    }, this.fillIndexBuffer), this.outlineVertexArrayObject = new s(e, x.getAttributeLocations(), x.getLayoutInfo(), {\n      geometry: this.outlineVertexBuffer\n    }, this.outlineIndexBuffer);\n  }\n\n}\n\nclass l extends f {\n  constructor(e, t, r) {\n    super(e, t), this.type = 3, this.iconPerPageElementsMap = new Map(), this.glyphPerPageElementsMap = new Map(), this.symbolInstances = [], this.isIconSDF = !1, this.opacityChanged = !1, this.lastOpacityUpdate = 0, this.symbols = [];\n    const i = new Uint32Array(e),\n          s = new Int32Array(e),\n          f = new Float32Array(e);\n    let o = this.bufferDataOffset;\n    this.isIconSDF = !!i[o++];\n    const a = i[o++];\n\n    for (let n = 0; n < a; n++) {\n      const e = i[o++],\n            t = i[o++],\n            r = i[o++];\n      this.iconPerPageElementsMap.set(e, [t, r]);\n    }\n\n    const l = i[o++];\n\n    for (let n = 0; n < l; n++) {\n      const e = i[o++],\n            t = i[o++],\n            r = i[o++];\n      this.glyphPerPageElementsMap.set(e, [t, r]);\n    }\n\n    const u = i[o++],\n          h = i[o++];\n    this.iconOpacity = new Int32Array(u), this.textOpacity = new Int32Array(h), o = n(i, s, f, o, this.symbols, r), this.bufferDataOffset = o;\n  }\n\n  hasData() {\n    return this.iconPerPageElementsMap.size > 0 || this.glyphPerPageElementsMap.size > 0;\n  }\n\n  triangleCount() {\n    let e = 0;\n\n    for (const [t, r] of this.iconPerPageElementsMap) e += r[1];\n\n    for (const [t, r] of this.glyphPerPageElementsMap) e += r[1];\n\n    return e / 3;\n  }\n\n  doDestroy() {\n    t(this.iconVertexArrayObject) && this.iconVertexArrayObject.dispose(), t(this.iconVertexBuffer) && this.iconVertexBuffer.dispose(), t(this.iconOpacityBuffer) && this.iconOpacityBuffer.dispose(), t(this.iconIndexBuffer) && this.iconIndexBuffer.dispose(), this.iconVertexArrayObject = null, this.iconVertexBuffer = null, this.iconOpacityBuffer = null, this.iconIndexBuffer = null, t(this.textVertexArrayObject) && this.textVertexArrayObject.dispose(), t(this.textVertexBuffer) && this.textVertexBuffer.dispose(), t(this.textOpacityBuffer) && this.textOpacityBuffer.dispose(), t(this.textIndexBuffer) && this.textIndexBuffer.dispose(), this.textVertexArrayObject = null, this.textVertexBuffer = null, this.textOpacityBuffer = null, this.textIndexBuffer = null, this.memoryUsed = 0;\n  }\n\n  updateOpacityInfo() {\n    if (!this.opacityChanged) return;\n    this.opacityChanged = !1;\n    const e = r(this.iconOpacity),\n          t = r(this.iconOpacityBuffer);\n    e.length > 0 && e.byteLength === t.size && t.setSubData(e);\n    const i = r(this.textOpacity),\n          s = r(this.textOpacityBuffer);\n    i.length > 0 && i.byteLength === s.size && s.setSubData(i);\n  }\n\n  doPrepareForRendering(e, t, n) {\n    const f = new Uint32Array(t),\n          o = new Int32Array(f.buffer),\n          a = f[n++];\n    this.iconVertexBuffer = i.createVertex(e, 35044, new Int32Array(o.buffer, 4 * n, a)), n += a;\n    const l = f[n++];\n    this.iconIndexBuffer = i.createIndex(e, 35044, new Uint32Array(f.buffer, 4 * n, l)), n += l;\n    const u = f[n++];\n    this.textVertexBuffer = i.createVertex(e, 35044, new Int32Array(o.buffer, 4 * n, u)), n += u;\n    const h = f[n++];\n    this.textIndexBuffer = i.createIndex(e, 35044, new Uint32Array(f.buffer, 4 * n, h)), n += h, this.iconOpacityBuffer = i.createVertex(e, 35044, r(this.iconOpacity).buffer), this.textOpacityBuffer = i.createVertex(e, 35044, r(this.textOpacity).buffer);\n    const c = this.layer,\n          x = c.iconMaterial,\n          y = c.textMaterial;\n    this.iconVertexArrayObject = new s(e, x.getAttributeLocations(), x.getLayoutInfo(), {\n      geometry: this.iconVertexBuffer,\n      opacity: this.iconOpacityBuffer\n    }, this.iconIndexBuffer), this.textVertexArrayObject = new s(e, y.getAttributeLocations(), y.getLayoutInfo(), {\n      geometry: this.textVertexBuffer,\n      opacity: this.textOpacityBuffer\n    }, this.textIndexBuffer);\n  }\n\n}\n\nclass u extends f {\n  constructor(e, t) {\n    super(e, t), this.type = 4, this.circleIndexStart = 0, this.circleIndexCount = 0;\n    const r = new Uint32Array(e);\n    let i = this.bufferDataOffset;\n    this.circleIndexStart = r[i++], this.circleIndexCount = r[i++], this.bufferDataOffset = i;\n  }\n\n  hasData() {\n    return this.circleIndexCount > 0;\n  }\n\n  triangleCount() {\n    return this.circleIndexCount / 3;\n  }\n\n  doDestroy() {\n    t(this.circleVertexArrayObject) && this.circleVertexArrayObject.dispose(), t(this.circleVertexBuffer) && this.circleVertexBuffer.dispose(), t(this.circleIndexBuffer) && this.circleIndexBuffer.dispose(), this.circleVertexArrayObject = null, this.circleVertexBuffer = null, this.circleIndexBuffer = null, this.memoryUsed = 0;\n  }\n\n  doPrepareForRendering(e, t, r) {\n    const n = new Uint32Array(t),\n          f = new Int32Array(n.buffer),\n          o = n[r++];\n    this.circleVertexBuffer = i.createVertex(e, 35044, new Int32Array(f.buffer, 4 * r, o)), r += o;\n    const a = n[r++];\n    this.circleIndexBuffer = i.createIndex(e, 35044, new Uint32Array(n.buffer, 4 * r, a)), r += a;\n    const l = this.layer.circleMaterial;\n    this.circleVertexArrayObject = new s(e, l.getAttributeLocations(), l.getLayoutInfo(), {\n      geometry: this.circleVertexBuffer\n    }, this.circleIndexBuffer);\n  }\n\n}\n\nexport { u as CircleRenderBucket, a as FillRenderBucket, o as LineRenderBucket, f as RenderBucketBase, l as SymbolRenderBucket };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/RenderBucket.js"],"names":["isNone","e","isSome","t","unwrap","r","i","s","deserializeSymbols","n","f","constructor","layerUIDs","isDestroyed","data","memoryUsed","byteLength","Uint32Array","bufferDataOffset","layer","getStyleLayerByUID","isPreparedForRendering","offset","destroy","doDestroy","prepareForRendering","doPrepareForRendering","o","type","lineIndexStart","lineIndexCount","Map","set","patternMap","hasData","triangleCount","lineVertexArrayObject","dispose","lineVertexBuffer","lineIndexBuffer","Int32Array","buffer","createVertex","a","createIndex","l","lineMaterial","getAttributeLocations","getLayoutInfo","geometry","fillIndexStart","fillIndexCount","outlineIndexStart","outlineIndexCount","fillVertexArrayObject","fillVertexBuffer","fillIndexBuffer","outlineVertexArrayObject","outlineVertexBuffer","outlineIndexBuffer","u","h","c","fillMaterial","x","outlineMaterial","iconPerPageElementsMap","glyphPerPageElementsMap","symbolInstances","isIconSDF","opacityChanged","lastOpacityUpdate","symbols","Float32Array","iconOpacity","textOpacity","size","iconVertexArrayObject","iconVertexBuffer","iconOpacityBuffer","iconIndexBuffer","textVertexArrayObject","textVertexBuffer","textOpacityBuffer","textIndexBuffer","updateOpacityInfo","length","setSubData","iconMaterial","y","textMaterial","opacity","circleIndexStart","circleIndexCount","circleVertexArrayObject","circleVertexBuffer","circleIndexBuffer","circleMaterial","CircleRenderBucket","FillRenderBucket","LineRenderBucket","RenderBucketBase","SymbolRenderBucket"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as t,unwrap as r}from\"../../../../core/maybe.js\";import i from\"../../../webgl/BufferObject.js\";import\"../../../webgl/FramebufferObject.js\";import\"../../../../core/has.js\";import\"../../../webgl/enums.js\";import\"../../../webgl/RenderingContext.js\";import\"../../../../chunks/builtins.js\";import\"../../../webgl/Texture.js\";import s from\"../../../webgl/VertexArrayObject.js\";import{deserializeSymbols as n}from\"./decluttering/util.js\";class f{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this.data=e,this.memoryUsed=e.byteLength;let r=1;const i=new Uint32Array(e);this.layerUIDs=[];const s=i[r++];for(let n=0;n<s;n++)this.layerUIDs[n]=i[r++];this.bufferDataOffset=r,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return e(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){e(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class o extends f{constructor(e,t){super(e,t),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.lineIndexStart=r[i++],this.lineIndexCount=r[i++];const s=r[i++];if(s>0){const e=new Map;for(let t=0;t<s;t++){const t=r[i++],s=r[i++],n=r[i++];e.set(t,[s,n])}this.patternMap=e}this.bufferDataOffset=i}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){t(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),t(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),t(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const n=new Uint32Array(t),f=new Int32Array(n.buffer),o=n[r++];this.lineVertexBuffer=i.createVertex(e,35044,new Int32Array(f.buffer,4*r,o)),r+=o;const a=n[r++];this.lineIndexBuffer=i.createIndex(e,35044,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new s(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class a extends f{constructor(e,t){super(e,t),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.fillIndexStart=r[i++],this.fillIndexCount=r[i++],this.outlineIndexStart=r[i++],this.outlineIndexCount=r[i++];const s=r[i++];if(s>0){const e=new Map;for(let t=0;t<s;t++){const t=r[i++],s=r[i++],n=r[i++];e.set(t,[s,n])}this.patternMap=e}this.bufferDataOffset=i}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){t(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),t(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),t(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,t(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),t(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),t(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const n=new Uint32Array(t),f=new Int32Array(n.buffer),o=n[r++];this.fillVertexBuffer=i.createVertex(e,35044,new Int32Array(f.buffer,4*r,o)),r+=o;const a=n[r++];this.fillIndexBuffer=i.createIndex(e,35044,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=n[r++];this.outlineVertexBuffer=i.createVertex(e,35044,new Int32Array(f.buffer,4*r,l)),r+=l;const u=n[r++];this.outlineIndexBuffer=i.createIndex(e,35044,new Uint32Array(n.buffer,4*r,u)),r+=u;const h=this.layer,c=h.fillMaterial,x=h.outlineMaterial;this.fillVertexArrayObject=new s(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new s(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class l extends f{constructor(e,t,r){super(e,t),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(e),s=new Int32Array(e),f=new Float32Array(e);let o=this.bufferDataOffset;this.isIconSDF=!!i[o++];const a=i[o++];for(let n=0;n<a;n++){const e=i[o++],t=i[o++],r=i[o++];this.iconPerPageElementsMap.set(e,[t,r])}const l=i[o++];for(let n=0;n<l;n++){const e=i[o++],t=i[o++],r=i[o++];this.glyphPerPageElementsMap.set(e,[t,r])}const u=i[o++],h=i[o++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(h),o=n(i,s,f,o,this.symbols,r),this.bufferDataOffset=o}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,r]of this.iconPerPageElementsMap)e+=r[1];for(const[t,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){t(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),t(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),t(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),t(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,t(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),t(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),t(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),t(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=r(this.iconOpacity),t=r(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);const i=r(this.textOpacity),s=r(this.textOpacityBuffer);i.length>0&&i.byteLength===s.size&&s.setSubData(i)}doPrepareForRendering(e,t,n){const f=new Uint32Array(t),o=new Int32Array(f.buffer),a=f[n++];this.iconVertexBuffer=i.createVertex(e,35044,new Int32Array(o.buffer,4*n,a)),n+=a;const l=f[n++];this.iconIndexBuffer=i.createIndex(e,35044,new Uint32Array(f.buffer,4*n,l)),n+=l;const u=f[n++];this.textVertexBuffer=i.createVertex(e,35044,new Int32Array(o.buffer,4*n,u)),n+=u;const h=f[n++];this.textIndexBuffer=i.createIndex(e,35044,new Uint32Array(f.buffer,4*n,h)),n+=h,this.iconOpacityBuffer=i.createVertex(e,35044,r(this.iconOpacity).buffer),this.textOpacityBuffer=i.createVertex(e,35044,r(this.textOpacity).buffer);const c=this.layer,x=c.iconMaterial,y=c.textMaterial;this.iconVertexArrayObject=new s(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new s(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class u extends f{constructor(e,t){super(e,t),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.circleIndexStart=r[i++],this.circleIndexCount=r[i++],this.bufferDataOffset=i}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){t(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),t(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),t(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const n=new Uint32Array(t),f=new Int32Array(n.buffer),o=n[r++];this.circleVertexBuffer=i.createVertex(e,35044,new Int32Array(f.buffer,4*r,o)),r+=o;const a=n[r++];this.circleIndexBuffer=i.createIndex(e,35044,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new s(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}export{u as CircleRenderBucket,a as FillRenderBucket,o as LineRenderBucket,f as RenderBucketBase,l as SymbolRenderBucket};\n"]},"metadata":{},"sourceType":"module"}