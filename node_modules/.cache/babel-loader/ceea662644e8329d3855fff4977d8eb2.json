{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { clamp as t } from \"../../../core/mathUtils.js\";\nimport { bilerp as a } from \"../support/mathUtils.js\";\nimport { ELEVATION_NODATA_VALUE as s } from \"./TerrainConst.js\";\n\nclass i {\n  constructor(t, a, s) {\n    this.samplerData = null, this.level = t[0], this.i = t[1], this.j = t[2], this.extent = a;\n    const i = s.noDataValue,\n          o = s.values;\n    let e = 1 / 0,\n        l = -1 / 0,\n        h = !0,\n        r = !1;\n\n    for (let n = 0; n < o.length; n++) {\n      const t = o[n];\n      t !== i ? (e = t < e ? t : e, l = t > l ? t : l, h = !1) : r = !0;\n    }\n\n    h && (e = 0, l = 0), l = l > -3e38 ? l : 0, this.samplerData = {\n      pixelData: s.values,\n      width: s.width,\n      height: s.height,\n      noDataValue: i,\n      safeWidth: .99999999 * (s.width - 1),\n      dx: (s.width - 1) / (a[2] - a[0]),\n      dy: (s.width - 1) / (a[3] - a[1]),\n      x0: a[0],\n      y1: a[3]\n    }, this.bounds = [e, l], this.hasNoDataValues = r;\n  }\n\n  release() {\n    this.samplerData = null, this.bounds = null;\n  }\n\n  computeMinMaxValue(t, i, o, e) {\n    e.min = 1 / 0, e.max = -1 / 0, e.hasNoDataValues = !1;\n    const l = t - this.level;\n    if (l <= 0) return e;\n    const h = 2 ** l;\n    if (!(Math.floor(i / h) === this.i && Math.floor(o / h) === this.j)) return e;\n    let r = 1 / 0,\n        n = -1 / 0;\n    const m = this.samplerData.width,\n          f = this.samplerData.pixelData,\n          u = .5 * s;\n    let c = (m - 1) / h,\n        p = (o - this.j * h) * c,\n        d = (i - this.i * h) * c;\n\n    if (c < 1) {\n      const t = Math.floor(p),\n            s = Math.floor(d),\n            i = t + s * m,\n            o = f[i],\n            l = f[i + 1],\n            h = f[i + m],\n            r = f[i + m + 1];\n\n      if (o + l + h + r < u) {\n        const i = p - t,\n              n = d - s,\n              m = a(o, l, h, r, i, n),\n              f = a(o, l, h, r, i + c, n),\n              u = a(o, l, h, r, i, n + c),\n              x = a(o, l, h, r, i + c, n + c);\n        return e.min = Math.min(m, f, u, x), e.max = Math.max(m, f, u, x), e;\n      }\n\n      p = t, d = s, c = 1;\n    } else p = Math.floor(p), d = Math.floor(d), c = Math.ceil(c);\n\n    for (let a = p; a <= p + c; a++) for (let t = d; t <= d + c; t++) {\n      const s = f[a + t * m];\n      s < u ? (r = Math.min(r, s), n = Math.max(n, s)) : e.hasNoDataValues = !0;\n    }\n\n    return e.min = r, e.max = n, e;\n  }\n\n  static sample(a, i, o) {\n    for (const e of o) {\n      if (!e) continue;\n      const o = e.safeWidth,\n            l = e.width,\n            h = e.pixelData;\n      let r = t(e.dy * (e.y1 - i), 0, o),\n          n = t(e.dx * (a - e.x0), 0, o);\n      const m = Math.floor(r),\n            f = Math.floor(n),\n            u = m * l + f,\n            c = u + l,\n            p = h[u],\n            d = h[c],\n            x = h[u + 1],\n            M = h[c + 1];\n\n      if (p + d + x + M < .5 * s) {\n        r -= m, n -= f;\n        const t = p + (x - p) * n;\n        return t + (d + (M - d) * n - t) * r;\n      }\n    }\n\n    return null;\n  }\n\n}\n\nexport { i as ElevationData };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/terrain/ElevationData.js"],"names":["clamp","t","bilerp","a","ELEVATION_NODATA_VALUE","s","i","constructor","samplerData","level","j","extent","noDataValue","o","values","e","l","h","r","n","length","pixelData","width","height","safeWidth","dx","dy","x0","y1","bounds","hasNoDataValues","release","computeMinMaxValue","min","max","Math","floor","m","f","u","c","p","d","x","ceil","sample","M","ElevationData"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{clamp as t}from\"../../../core/mathUtils.js\";import{bilerp as a}from\"../support/mathUtils.js\";import{ELEVATION_NODATA_VALUE as s}from\"./TerrainConst.js\";class i{constructor(t,a,s){this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=a;const i=s.noDataValue,o=s.values;let e=1/0,l=-1/0,h=!0,r=!1;for(let n=0;n<o.length;n++){const t=o[n];t!==i?(e=t<e?t:e,l=t>l?t:l,h=!1):r=!0}h&&(e=0,l=0),l=l>-3e38?l:0,this.samplerData={pixelData:s.values,width:s.width,height:s.height,noDataValue:i,safeWidth:.99999999*(s.width-1),dx:(s.width-1)/(a[2]-a[0]),dy:(s.width-1)/(a[3]-a[1]),x0:a[0],y1:a[3]},this.bounds=[e,l],this.hasNoDataValues=r}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,o,e){e.min=1/0,e.max=-1/0,e.hasNoDataValues=!1;const l=t-this.level;if(l<=0)return e;const h=2**l;if(!(Math.floor(i/h)===this.i&&Math.floor(o/h)===this.j))return e;let r=1/0,n=-1/0;const m=this.samplerData.width,f=this.samplerData.pixelData,u=.5*s;let c=(m-1)/h,p=(o-this.j*h)*c,d=(i-this.i*h)*c;if(c<1){const t=Math.floor(p),s=Math.floor(d),i=t+s*m,o=f[i],l=f[i+1],h=f[i+m],r=f[i+m+1];if(o+l+h+r<u){const i=p-t,n=d-s,m=a(o,l,h,r,i,n),f=a(o,l,h,r,i+c,n),u=a(o,l,h,r,i,n+c),x=a(o,l,h,r,i+c,n+c);return e.min=Math.min(m,f,u,x),e.max=Math.max(m,f,u,x),e}p=t,d=s,c=1}else p=Math.floor(p),d=Math.floor(d),c=Math.ceil(c);for(let a=p;a<=p+c;a++)for(let t=d;t<=d+c;t++){const s=f[a+t*m];s<u?(r=Math.min(r,s),n=Math.max(n,s)):e.hasNoDataValues=!0}return e.min=r,e.max=n,e}static sample(a,i,o){for(const e of o){if(!e)continue;const o=e.safeWidth,l=e.width,h=e.pixelData;let r=t(e.dy*(e.y1-i),0,o),n=t(e.dx*(a-e.x0),0,o);const m=Math.floor(r),f=Math.floor(n),u=m*l+f,c=u+l,p=h[u],d=h[c],x=h[u+1],M=h[c+1];if(p+d+x+M<.5*s){r-=m,n-=f;const t=p+(x-p)*n;return t+(d+(M-d)*n-t)*r}}return null}}export{i as ElevationData};\n"]},"metadata":{},"sourceType":"module"}