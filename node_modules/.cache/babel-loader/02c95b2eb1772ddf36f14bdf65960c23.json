{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../../request.js\";\nimport e from \"../../../../core/pbf.js\";\n\nclass s {\n  constructor(t) {\n    if (this._metrics = [], this._bitmaps = [], t) for (; t.next();) switch (t.tag()) {\n      case 1:\n        {\n          const e = t.getMessage();\n\n          for (; e.next();) switch (e.tag()) {\n            case 3:\n              {\n                const t = e.getMessage();\n                let s, a, r, n, i, c, g;\n\n                for (; t.next();) switch (t.tag()) {\n                  case 1:\n                    s = t.getUInt32();\n                    break;\n\n                  case 2:\n                    a = t.getBytes();\n                    break;\n\n                  case 3:\n                    r = t.getUInt32();\n                    break;\n\n                  case 4:\n                    n = t.getUInt32();\n                    break;\n\n                  case 5:\n                    i = t.getSInt32();\n                    break;\n\n                  case 6:\n                    c = t.getSInt32();\n                    break;\n\n                  case 7:\n                    g = t.getUInt32();\n                    break;\n\n                  default:\n                    t.skip();\n                }\n\n                t.release(), s && (this._metrics[s] = {\n                  width: r,\n                  height: n,\n                  left: i,\n                  top: c,\n                  advance: g\n                }, this._bitmaps[s] = a);\n                break;\n              }\n\n            default:\n              e.skip();\n          }\n\n          e.release();\n          break;\n        }\n\n      default:\n        t.skip();\n    }\n  }\n\n  getMetrics(t) {\n    return this._metrics[t];\n  }\n\n  getBitmap(t) {\n    return this._bitmaps[t];\n  }\n\n}\n\nclass a {\n  constructor() {\n    this._ranges = [];\n  }\n\n  getRange(t) {\n    return this._ranges[t];\n  }\n\n  addRange(t, e) {\n    this._ranges[t] = e;\n  }\n\n}\n\nclass r {\n  constructor(t) {\n    this._glyphInfo = {}, this._baseURL = t;\n  }\n\n  getRange(a, r) {\n    const n = this._getFontStack(a);\n\n    if (n.getRange(r)) return Promise.resolve();\n\n    const i = 256 * r,\n          c = i + 255,\n          g = this._baseURL.replace(\"{fontstack}\", a).replace(\"{range}\", i + \"-\" + c);\n\n    return t(g, {\n      responseType: \"array-buffer\"\n    }).then(t => {\n      n.addRange(r, new s(new e(new Uint8Array(t.data), new DataView(t.data))));\n    }).catch(() => {\n      n.addRange(r, new s());\n    });\n  }\n\n  getGlyph(t, e) {\n    const s = this._getFontStack(t);\n\n    if (!s) return;\n    const a = Math.floor(e / 256);\n    if (a > 256) return;\n    const r = s.getRange(a);\n    return r ? {\n      metrics: r.getMetrics(e),\n      bitmap: r.getBitmap(e)\n    } : void 0;\n  }\n\n  _getFontStack(t) {\n    let e = this._glyphInfo[t];\n    return e || (e = this._glyphInfo[t] = new a()), e;\n  }\n\n}\n\nexport default r;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/GlyphSource.js"],"names":["t","e","s","constructor","_metrics","_bitmaps","next","tag","getMessage","a","r","n","i","c","g","getUInt32","getBytes","getSInt32","skip","release","width","height","left","top","advance","getMetrics","getBitmap","_ranges","getRange","addRange","_glyphInfo","_baseURL","_getFontStack","Promise","resolve","replace","responseType","then","Uint8Array","data","DataView","catch","getGlyph","Math","floor","metrics","bitmap"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../request.js\";import e from\"../../../../core/pbf.js\";class s{constructor(t){if(this._metrics=[],this._bitmaps=[],t)for(;t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let s,a,r,n,i,c,g;for(;t.next();)switch(t.tag()){case 1:s=t.getUInt32();break;case 2:a=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:n=t.getUInt32();break;case 5:i=t.getSInt32();break;case 6:c=t.getSInt32();break;case 7:g=t.getUInt32();break;default:t.skip()}t.release(),s&&(this._metrics[s]={width:r,height:n,left:i,top:c,advance:g},this._bitmaps[s]=a);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class a{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class r{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(a,r){const n=this._getFontStack(a);if(n.getRange(r))return Promise.resolve();const i=256*r,c=i+255,g=this._baseURL.replace(\"{fontstack}\",a).replace(\"{range}\",i+\"-\"+c);return t(g,{responseType:\"array-buffer\"}).then((t=>{n.addRange(r,new s(new e(new Uint8Array(t.data),new DataView(t.data))))})).catch((()=>{n.addRange(r,new s)}))}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const a=Math.floor(e/256);if(a>256)return;const r=s.getRange(a);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new a),e}}export default r;\n"]},"metadata":{},"sourceType":"module"}