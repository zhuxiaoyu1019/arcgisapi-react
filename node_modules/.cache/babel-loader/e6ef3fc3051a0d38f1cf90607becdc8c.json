{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as r } from \"./chunks/tslib.es6.js\";\nimport e from \"./Color.js\";\nimport o from \"./core/Collection.js\";\nimport { referenceSetter as t } from \"./core/collectionUtils.js\";\nimport { typeCast as s } from \"./core/compilerUtils.js\";\nimport a from \"./core/Error.js\";\nimport { JSONSupportMixin as i } from \"./core/JSONSupport.js\";\nimport { clone as n } from \"./core/lang.js\";\nimport l from \"./core/Loadable.js\";\nimport { loadAll as p } from \"./core/loadAll.js\";\nimport c from \"./core/Logger.js\";\nimport { throwIfAborted as u, eachAlways as y } from \"./core/promiseUtils.js\";\nimport { property as d } from \"./core/accessorSupport/decorators/property.js\";\nimport { Integer as m } from \"./core/accessorSupport/ensureType.js\";\nimport \"./core/has.js\";\nimport { subclass as f } from \"./core/accessorSupport/decorators/subclass.js\";\nimport { writer as h } from \"./core/accessorSupport/decorators/writer.js\";\nimport { NavigationConstraint as v } from \"./ground/NavigationConstraint.js\";\nimport { transparencyToOpacity as g, opacityToTransparency as j } from \"./webdoc/support/opacityUtils.js\";\nvar w;\nconst C = c.getLogger(\"esri.Ground\");\nlet S = w = class extends i(l) {\n  constructor(r) {\n    super(r), this.opacity = 1, this.surfaceColor = null, this.navigationConstraint = null, this.layers = new o();\n\n    const e = r => {\n      r.parent && r.parent !== this && \"remove\" in r.parent && r.parent.remove(r), r.parent = this, \"elevation\" !== r.type && \"base-elevation\" !== r.type && C.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`);\n    },\n          t = r => {\n      r.parent = null;\n    };\n\n    this.layers.on(\"after-add\", r => e(r.item)), this.layers.on(\"after-remove\", r => t(r.item));\n  }\n\n  initialize() {\n    this.when().catch(r => {\n      C.error(\"#load()\", \"Failed to load ground\", r);\n    }), this.resourceInfo && this.read(this.resourceInfo.data, this.resourceInfo.context);\n  }\n\n  destroy() {\n    const r = this.layers.removeAll();\n\n    for (const e of r) e.destroy();\n\n    this.layers.destroy();\n  }\n\n  normalizeCtorArgs(r) {\n    return r && \"resourceInfo\" in r && (this._set(\"resourceInfo\", r.resourceInfo), delete (r = { ...r\n    }).resourceInfo), r;\n  }\n\n  set layers(r) {\n    this._set(\"layers\", t(r, this._get(\"layers\")));\n  }\n\n  writeLayers(r, e, o, t) {\n    const i = [];\n    r ? (t = { ...t,\n      layerContainerType: \"ground\"\n    }, r.forEach(r => {\n      if (\"write\" in r) {\n        const e = {};\n        s(r)().write(e, t) && i.push(e);\n      } else t && t.messages && t.messages.push(new a(\"layer:unsupported\", `Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted in the ground`, {\n        layer: r\n      }));\n    }), e.layers = i) : e.layers = i;\n  }\n\n  load(r) {\n    return this.addResolvingPromise(this._loadFromSource(r)), Promise.resolve(this);\n  }\n\n  loadAll() {\n    return p(this, r => {\n      r(this.layers);\n    });\n  }\n\n  async queryElevation(r, e) {\n    await this.load({\n      signal: null == e ? void 0 : e.signal\n    });\n    const {\n      ElevationQuery: o\n    } = await import(\"./layers/support/ElevationQuery.js\");\n    u(e);\n    const t = new o(),\n          s = this.layers.filter(L).toArray();\n    return t.queryAll(s, r, e);\n  }\n\n  async createElevationSampler(r, e) {\n    await this.load({\n      signal: null == e ? void 0 : e.signal\n    });\n    const {\n      ElevationQuery: o\n    } = await import(\"./layers/support/ElevationQuery.js\");\n    u(e);\n    const t = new o(),\n          s = this.layers.filter(L).toArray();\n    return t.createSamplerAll(s, r, e);\n  }\n\n  clone() {\n    const r = {\n      opacity: this.opacity,\n      surfaceColor: n(this.surfaceColor),\n      navigationConstraint: n(this.navigationConstraint),\n      layers: this.layers.slice()\n    };\n    return this.loaded && (r.loadStatus = \"loaded\"), new w({\n      resourceInfo: this.resourceInfo\n    }).set(r);\n  }\n\n  read(r, e) {\n    this.resourceInfo || this._set(\"resourceInfo\", {\n      data: r,\n      context: e\n    }), super.read(r, e);\n  }\n\n  _loadFromSource(r) {\n    const e = this.resourceInfo;\n    return e ? this._loadLayersFromJSON(e.data, e.context, r) : Promise.resolve(null);\n  }\n\n  _loadLayersFromJSON(r, e, o) {\n    const t = e && e.origin || \"web-scene\",\n          s = e && e.portal || null,\n          a = e && e.url || null;\n    return import(\"./layers/support/layersCreator.js\").then(({\n      populateOperationalLayers: e\n    }) => {\n      u(o);\n      const i = [];\n\n      if (r.layers && Array.isArray(r.layers)) {\n        const o = {\n          context: {\n            origin: t,\n            url: a,\n            portal: s,\n            layerContainerType: \"ground\"\n          },\n          defaultLayerType: \"ArcGISTiledElevationServiceLayer\"\n        };\n        i.push(e(this.layers, r.layers, o));\n      }\n\n      return y(i);\n    }).then(() => {});\n  }\n\n};\n\nfunction I(r) {\n  return r && \"createElevationSampler\" in r;\n}\n\nfunction L(r) {\n  return \"elevation\" === r.type || I(r);\n}\n\nr([d({\n  json: {\n    read: !1\n  }\n})], S.prototype, \"layers\", null), r([h(\"layers\")], S.prototype, \"writeLayers\", null), r([d({\n  readOnly: !0\n})], S.prototype, \"resourceInfo\", void 0), r([d({\n  type: Number,\n  nonNullable: !0,\n  range: {\n    min: 0,\n    max: 1\n  },\n  json: {\n    type: m,\n    read: {\n      reader: g,\n      source: \"transparency\"\n    },\n    write: {\n      writer: (r, e) => {\n        e.transparency = j(r);\n      },\n      target: \"transparency\"\n    }\n  }\n})], S.prototype, \"opacity\", void 0), r([d({\n  type: e,\n  json: {\n    type: [m],\n    write: (r, e) => {\n      e.surfaceColor = r.toJSON().slice(0, 3);\n    }\n  }\n})], S.prototype, \"surfaceColor\", void 0), r([d({\n  type: v,\n  json: {\n    write: !0\n  }\n})], S.prototype, \"navigationConstraint\", void 0), S = w = r([f(\"esri.Ground\")], S);\nvar A = S;\nexport default A;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/Ground.js"],"names":["_","r","e","o","referenceSetter","t","typeCast","s","a","JSONSupportMixin","i","clone","n","l","loadAll","p","c","throwIfAborted","u","eachAlways","y","property","d","Integer","m","subclass","f","writer","h","NavigationConstraint","v","transparencyToOpacity","g","opacityToTransparency","j","w","C","getLogger","S","constructor","opacity","surfaceColor","navigationConstraint","layers","parent","remove","type","error","title","id","on","item","initialize","when","catch","resourceInfo","read","data","context","destroy","removeAll","normalizeCtorArgs","_set","_get","writeLayers","layerContainerType","forEach","write","push","messages","declaredClass","layer","load","addResolvingPromise","_loadFromSource","Promise","resolve","queryElevation","signal","ElevationQuery","filter","L","toArray","queryAll","createElevationSampler","createSamplerAll","slice","loaded","loadStatus","set","_loadLayersFromJSON","origin","portal","url","then","populateOperationalLayers","Array","isArray","defaultLayerType","I","json","prototype","readOnly","Number","nonNullable","range","min","max","reader","source","transparency","target","toJSON","A"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"./chunks/tslib.es6.js\";import e from\"./Color.js\";import o from\"./core/Collection.js\";import{referenceSetter as t}from\"./core/collectionUtils.js\";import{typeCast as s}from\"./core/compilerUtils.js\";import a from\"./core/Error.js\";import{JSONSupportMixin as i}from\"./core/JSONSupport.js\";import{clone as n}from\"./core/lang.js\";import l from\"./core/Loadable.js\";import{loadAll as p}from\"./core/loadAll.js\";import c from\"./core/Logger.js\";import{throwIfAborted as u,eachAlways as y}from\"./core/promiseUtils.js\";import{property as d}from\"./core/accessorSupport/decorators/property.js\";import{Integer as m}from\"./core/accessorSupport/ensureType.js\";import\"./core/has.js\";import{subclass as f}from\"./core/accessorSupport/decorators/subclass.js\";import{writer as h}from\"./core/accessorSupport/decorators/writer.js\";import{NavigationConstraint as v}from\"./ground/NavigationConstraint.js\";import{transparencyToOpacity as g,opacityToTransparency as j}from\"./webdoc/support/opacityUtils.js\";var w;const C=c.getLogger(\"esri.Ground\");let S=w=class extends(i(l)){constructor(r){super(r),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new o;const e=r=>{r.parent&&r.parent!==this&&\"remove\"in r.parent&&r.parent.remove(r),r.parent=this,\"elevation\"!==r.type&&\"base-elevation\"!==r.type&&C.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},t=r=>{r.parent=null};this.layers.on(\"after-add\",(r=>e(r.item))),this.layers.on(\"after-remove\",(r=>t(r.item)))}initialize(){this.when().catch((r=>{C.error(\"#load()\",\"Failed to load ground\",r)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const r=this.layers.removeAll();for(const e of r)e.destroy();this.layers.destroy()}normalizeCtorArgs(r){return r&&\"resourceInfo\"in r&&(this._set(\"resourceInfo\",r.resourceInfo),delete(r={...r}).resourceInfo),r}set layers(r){this._set(\"layers\",t(r,this._get(\"layers\")))}writeLayers(r,e,o,t){const i=[];r?(t={...t,layerContainerType:\"ground\"},r.forEach((r=>{if(\"write\"in r){const e={};s(r)().write(e,t)&&i.push(e)}else t&&t.messages&&t.messages.push(new a(\"layer:unsupported\",`Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted in the ground`,{layer:r}))})),e.layers=i):e.layers=i}load(r){return this.addResolvingPromise(this._loadFromSource(r)),Promise.resolve(this)}loadAll(){return p(this,(r=>{r(this.layers)}))}async queryElevation(r,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:o}=await import(\"./layers/support/ElevationQuery.js\");u(e);const t=new o,s=this.layers.filter(L).toArray();return t.queryAll(s,r,e)}async createElevationSampler(r,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:o}=await import(\"./layers/support/ElevationQuery.js\");u(e);const t=new o,s=this.layers.filter(L).toArray();return t.createSamplerAll(s,r,e)}clone(){const r={opacity:this.opacity,surfaceColor:n(this.surfaceColor),navigationConstraint:n(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(r.loadStatus=\"loaded\"),new w({resourceInfo:this.resourceInfo}).set(r)}read(r,e){this.resourceInfo||this._set(\"resourceInfo\",{data:r,context:e}),super.read(r,e)}_loadFromSource(r){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,r):Promise.resolve(null)}_loadLayersFromJSON(r,e,o){const t=e&&e.origin||\"web-scene\",s=e&&e.portal||null,a=e&&e.url||null;return import(\"./layers/support/layersCreator.js\").then((({populateOperationalLayers:e})=>{u(o);const i=[];if(r.layers&&Array.isArray(r.layers)){const o={context:{origin:t,url:a,portal:s,layerContainerType:\"ground\"},defaultLayerType:\"ArcGISTiledElevationServiceLayer\"};i.push(e(this.layers,r.layers,o))}return y(i)})).then((()=>{}))}};function I(r){return r&&\"createElevationSampler\"in r}function L(r){return\"elevation\"===r.type||I(r)}r([d({json:{read:!1}})],S.prototype,\"layers\",null),r([h(\"layers\")],S.prototype,\"writeLayers\",null),r([d({readOnly:!0})],S.prototype,\"resourceInfo\",void 0),r([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:m,read:{reader:g,source:\"transparency\"},write:{writer:(r,e)=>{e.transparency=j(r)},target:\"transparency\"}}})],S.prototype,\"opacity\",void 0),r([d({type:e,json:{type:[m],write:(r,e)=>{e.surfaceColor=r.toJSON().slice(0,3)}}})],S.prototype,\"surfaceColor\",void 0),r([d({type:v,json:{write:!0}})],S.prototype,\"navigationConstraint\",void 0),S=w=r([f(\"esri.Ground\")],S);var A=S;export default A;\n"]},"metadata":{},"sourceType":"module"}