{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { createAbortController as e, onAbortOrThrow as t, always as r } from \"../../../../core/promiseUtils.js\";\n\nclass s {\n  constructor(e, t) {\n    this.requester = e, this.apiKey = t, this.activeRequests = new Set();\n  }\n\n  get busy() {\n    return this.requester.busy;\n  }\n\n  request(s, l, o) {\n    const a = e(),\n          n = t(o, () => a.abort()),\n          u = {\n      signal: a.signal,\n      query: {\n        token: this.apiKey\n      }\n    },\n          i = this.requester.request(s, l, u),\n          c = {\n      response: i,\n      abortController: a,\n      abortHandle: n\n    };\n    return this.activeRequests.add(c), r(i, () => {\n      var e;\n      c.abortController = null, null == (e = c.abortHandle) || e.remove(), c.abortHandle = null, this.activeRequests.delete(c);\n    }), i;\n  }\n\n  cancelAll() {\n    this.activeRequests.forEach(e => {\n      var t, r;\n      null == (t = e.abortController) || t.abort(), e.abortController = null, null == (r = e.abortHandle) || r.remove();\n    }), this.activeRequests.clear();\n  }\n\n}\n\nexport default s;\nexport { s as I3SStreamDataController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/i3s/I3SStreamDataController.js"],"names":["createAbortController","e","onAbortOrThrow","t","always","r","s","constructor","requester","apiKey","activeRequests","Set","busy","request","l","o","a","n","abort","u","signal","query","token","i","c","response","abortController","abortHandle","add","remove","delete","cancelAll","forEach","clear","I3SStreamDataController"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,qBAAqB,IAAIC,CAAhC,EAAkCC,cAAc,IAAIC,CAApD,EAAsDC,MAAM,IAAIC,CAAhE,QAAsE,kCAAtE;;AAAyG,MAAMC,CAAN,CAAO;AAACC,EAAAA,WAAW,CAACN,CAAD,EAAGE,CAAH,EAAK;AAAC,SAAKK,SAAL,GAAeP,CAAf,EAAiB,KAAKQ,MAAL,GAAYN,CAA7B,EAA+B,KAAKO,cAAL,GAAoB,IAAIC,GAAJ,EAAnD;AAA2D;;AAAQ,MAAJC,IAAI,GAAE;AAAC,WAAO,KAAKJ,SAAL,CAAeI,IAAtB;AAA2B;;AAAAC,EAAAA,OAAO,CAACP,CAAD,EAAGQ,CAAH,EAAKC,CAAL,EAAO;AAAC,UAAMC,CAAC,GAACf,CAAC,EAAT;AAAA,UAAYgB,CAAC,GAACd,CAAC,CAACY,CAAD,EAAI,MAAIC,CAAC,CAACE,KAAF,EAAR,CAAf;AAAA,UAAmCC,CAAC,GAAC;AAACC,MAAAA,MAAM,EAACJ,CAAC,CAACI,MAAV;AAAiBC,MAAAA,KAAK,EAAC;AAACC,QAAAA,KAAK,EAAC,KAAKb;AAAZ;AAAvB,KAArC;AAAA,UAAiFc,CAAC,GAAC,KAAKf,SAAL,CAAeK,OAAf,CAAuBP,CAAvB,EAAyBQ,CAAzB,EAA2BK,CAA3B,CAAnF;AAAA,UAAiHK,CAAC,GAAC;AAACC,MAAAA,QAAQ,EAACF,CAAV;AAAYG,MAAAA,eAAe,EAACV,CAA5B;AAA8BW,MAAAA,WAAW,EAACV;AAA1C,KAAnH;AAAgK,WAAO,KAAKP,cAAL,CAAoBkB,GAApB,CAAwBJ,CAAxB,GAA2BnB,CAAC,CAACkB,CAAD,EAAI,MAAI;AAAC,UAAItB,CAAJ;AAAMuB,MAAAA,CAAC,CAACE,eAAF,GAAkB,IAAlB,EAAuB,SAAOzB,CAAC,GAACuB,CAAC,CAACG,WAAX,KAAyB1B,CAAC,CAAC4B,MAAF,EAAhD,EAA2DL,CAAC,CAACG,WAAF,GAAc,IAAzE,EAA8E,KAAKjB,cAAL,CAAoBoB,MAApB,CAA2BN,CAA3B,CAA9E;AAA4G,KAA3H,CAA5B,EAA0JD,CAAjK;AAAmK;;AAAAQ,EAAAA,SAAS,GAAE;AAAC,SAAKrB,cAAL,CAAoBsB,OAApB,CAA6B/B,CAAC,IAAE;AAAC,UAAIE,CAAJ,EAAME,CAAN;AAAQ,eAAOF,CAAC,GAACF,CAAC,CAACyB,eAAX,KAA6BvB,CAAC,CAACe,KAAF,EAA7B,EAAuCjB,CAAC,CAACyB,eAAF,GAAkB,IAAzD,EAA8D,SAAOrB,CAAC,GAACJ,CAAC,CAAC0B,WAAX,KAAyBtB,CAAC,CAACwB,MAAF,EAAvF;AAAkG,KAA3I,GAA8I,KAAKnB,cAAL,CAAoBuB,KAApB,EAA9I;AAA0K;;AAA3nB;;AAA4nB,eAAe3B,CAAf;AAAiB,SAAOA,CAAC,IAAI4B,uBAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{createAbortController as e,onAbortOrThrow as t,always as r}from\"../../../../core/promiseUtils.js\";class s{constructor(e,t){this.requester=e,this.apiKey=t,this.activeRequests=new Set}get busy(){return this.requester.busy}request(s,l,o){const a=e(),n=t(o,(()=>a.abort())),u={signal:a.signal,query:{token:this.apiKey}},i=this.requester.request(s,l,u),c={response:i,abortController:a,abortHandle:n};return this.activeRequests.add(c),r(i,(()=>{var e;c.abortController=null,null==(e=c.abortHandle)||e.remove(),c.abortHandle=null,this.activeRequests.delete(c)})),i}cancelAll(){this.activeRequests.forEach((e=>{var t,r;null==(t=e.abortController)||t.abort(),e.abortController=null,null==(r=e.abortHandle)||r.remove()})),this.activeRequests.clear()}}export default s;export{s as I3SStreamDataController};\n"]},"metadata":{},"sourceType":"module"}