{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport \"../geometry.js\";\nimport r from \"../request.js\";\nimport t from \"../core/Error.js\";\nimport { HandleOwnerMixin as s } from \"../core/HandleOwner.js\";\nimport { isSome as i } from \"../core/maybe.js\";\nimport { MultiOriginJSONMixin as o } from \"../core/MultiOriginJSONSupport.js\";\nimport { throwIfAbortError as a } from \"../core/promiseUtils.js\";\nimport { urlToObject as l, objectToQuery as n, makeAbsolute as p } from \"../core/urlUtils.js\";\nimport { property as c } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/has.js\";\nimport { cast as u } from \"../core/accessorSupport/decorators/cast.js\";\nimport \"../core/Logger.js\";\nimport { reader as m } from \"../core/accessorSupport/decorators/reader.js\";\nimport { subclass as h } from \"../core/accessorSupport/decorators/subclass.js\";\nimport { writer as d } from \"../core/accessorSupport/decorators/writer.js\";\nimport y from \"./Layer.js\";\nimport { APIKeyMixin as f } from \"./mixins/APIKeyMixin.js\";\nimport { ArcGISCachedService as v } from \"./mixins/ArcGISCachedService.js\";\nimport { ArcGISMapService as g } from \"./mixins/ArcGISMapService.js\";\nimport { ArcGISService as _ } from \"./mixins/ArcGISService.js\";\nimport { BlendLayer as S } from \"./mixins/BlendLayer.js\";\nimport { CustomParametersMixin as j } from \"./mixins/CustomParametersMixin.js\";\nimport { OperationalLayer as b } from \"./mixins/OperationalLayer.js\";\nimport { PortalLayer as T } from \"./mixins/PortalLayer.js\";\nimport { RefreshableLayer as w } from \"./mixins/RefreshableLayer.js\";\nimport { ScaleRangeLayer as O } from \"./mixins/ScaleRangeLayer.js\";\nimport { SublayersOwner as L } from \"./mixins/SublayersOwner.js\";\nimport { parse as R, isHostedAgolService as x, isArcGISUrl as U } from \"./support/arcgisLayerUrl.js\";\nimport { url as P } from \"./support/commonProperties.js\";\nimport A from \"./support/Sublayer.js\";\nimport W from \"../geometry/SpatialReference.js\";\nconst I = [\"Canvas/World_Dark_Gray_Base\", \"Canvas/World_Dark_Gray_Reference\", \"Canvas/World_Light_Gray_Base\", \"Canvas/World_Light_Gray_Reference\", \"Elevation/World_Hillshade\", \"Elevation/World_Hillshade_Dark\", \"Ocean/World_Ocean_Base\", \"Ocean/World_Ocean_Reference\", \"Ocean_Basemap\", \"Reference/World_Boundaries_and_Places\", \"Reference/World_Boundaries_and_Places_Alternate\", \"Reference/World_Transportation\", \"World_Imagery\", \"World_Street_Map\", \"World_Topo_Map\"];\nlet M = class extends S(L(O(w(b(T(v(g(_(o(s(f(j(y))))))))))))) {\n  constructor(...e) {\n    super(...e), this.listMode = \"show\", this.isReference = null, this.operationalLayerType = \"ArcGISTiledMapServiceLayer\", this.resampling = !0, this.sourceJSON = null, this.spatialReference = null, this.path = null, this.sublayers = null, this.type = \"tile\", this.url = null;\n  }\n\n  normalizeCtorArgs(e, r) {\n    return \"string\" == typeof e ? {\n      url: e,\n      ...r\n    } : e;\n  }\n\n  load(e) {\n    const r = i(e) ? e.signal : null;\n    return this.addResolvingPromise(this.loadFromPortal({\n      supportedTypes: [\"Map Service\"]\n    }, e).catch(a).then(() => this._fetchService(r))), Promise.resolve(this);\n  }\n\n  get attributionDataUrl() {\n    var e;\n    const r = null == (e = this.parsedUrl) ? void 0 : e.path.toLowerCase();\n    return r && this._getDefaultAttribution(this._getMapName(r));\n  }\n\n  readSpatialReference(e, r) {\n    return (e = e || r.tileInfo && r.tileInfo.spatialReference) && W.fromJSON(e);\n  }\n\n  writeSublayers(e, r, t, s) {\n    if (!this.loaded || !e) return;\n    const i = e.slice().reverse().flatten(({\n      sublayers: e\n    }) => e && e.toArray().reverse()).toArray(),\n          o = [],\n          a = {\n      writeSublayerStructure: !1,\n      ...s\n    };\n    i.forEach(e => {\n      const r = e.write({}, a);\n      o.push(r);\n    });\n    o.some(e => Object.keys(e).length > 1) && (r.layers = o);\n  }\n\n  get tileServers() {\n    return this._getDefaultTileServers(this.parsedUrl.path);\n  }\n\n  castTileServers(e) {\n    return Array.isArray(e) ? e.map(e => l(e).path) : null;\n  }\n\n  fetchTile(e, t, s, i = {}) {\n    const {\n      signal: o,\n      timestamp: a\n    } = i,\n          l = this.getTileUrl(e, t, s),\n          n = {\n      responseType: \"image\",\n      signal: o\n    };\n    return null != a && (n.query = {\n      _ts: i.timestamp\n    }), r(l, n).then(e => e.data);\n  }\n\n  getTileUrl(e, r, t) {\n    const s = !this.tilemapCache && this.supportsBlankTile,\n          i = n({ ...this.parsedUrl.query,\n      blankTile: !s && null,\n      ...this.customParameters,\n      token: this.apiKey\n    }),\n          o = this.tileServers;\n    return `${o && o.length ? o[r % o.length] : this.parsedUrl.path}/tile/${e}/${r}/${t}${i ? \"?\" + i : \"\"}`;\n  }\n\n  _fetchService(e) {\n    return new Promise((s, o) => {\n      if (this.sourceJSON) {\n        if (null != this.sourceJSON.bandCount && null != this.sourceJSON.pixelSizeX) throw new t(\"tile-layer:unsupported-url\", \"use ImageryTileLayer to open a tiled image service\");\n        return void s({\n          data: this.sourceJSON\n        });\n      }\n\n      if (!this.parsedUrl) throw new t(\"tile-layer:undefined-url\", \"layer's url is not defined\");\n      const a = R(this.parsedUrl.path);\n      if (i(a) && \"ImageServer\" === a.serverType) throw new t(\"tile-layer:unsupported-url\", \"use ImageryTileLayer to open a tiled image service\");\n      r(this.parsedUrl.path, {\n        query: {\n          f: \"json\",\n          ...this.parsedUrl.query,\n          ...this.customParameters,\n          token: this.apiKey\n        },\n        responseType: \"json\",\n        signal: e\n      }).then(s, o);\n    }).then(r => {\n      if (r.ssl && (this.url = this.url.replace(/^http:/i, \"https:\")), this.sourceJSON = r.data, this.read(r.data, {\n        origin: \"service\",\n        url: this.parsedUrl\n      }), 10.1 === this.version && !x(this.url)) return this._fetchServerVersion(this.url, e).then(e => {\n        this.read({\n          currentVersion: e\n        });\n      }).catch(() => {});\n    });\n  }\n\n  _fetchServerVersion(e, s) {\n    if (!U(e)) return Promise.reject();\n    const i = e.replace(/(.*\\/rest)\\/.*/i, \"$1\") + \"/info\";\n    return r(i, {\n      query: {\n        f: \"json\",\n        ...this.customParameters,\n        token: this.apiKey\n      },\n      responseType: \"json\",\n      signal: s\n    }).then(e => {\n      if (e.data && e.data.currentVersion) return e.data.currentVersion;\n      throw new t(\"tile-layer:version-not-available\");\n    });\n  }\n\n  _getMapName(e) {\n    const r = e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);\n    return r && r[2];\n  }\n\n  _getDefaultAttribution(e) {\n    if (!e) return;\n    let r;\n    e = e.toLowerCase();\n\n    for (let t = 0, s = I.length; t < s; t++) if (r = I[t], r.toLowerCase().indexOf(e) > -1) return p(\"//static.arcgis.com/attribution/\" + r);\n  }\n\n  _getDefaultTileServers(e) {\n    const r = -1 !== e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),\n          t = -1 !== e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);\n    return r || t ? [e, e.replace(r ? /server\\.arcgisonline/i : /services\\.arcgisonline/i, r ? \"services.arcgisonline\" : \"server.arcgisonline\")] : [];\n  }\n\n  get hasOverriddenFetchTile() {\n    return !this.fetchTile.__isDefault__;\n  }\n\n};\ne([c({\n  readOnly: !0\n})], M.prototype, \"attributionDataUrl\", null), e([c({\n  type: [\"show\", \"hide\", \"hide-children\"]\n})], M.prototype, \"listMode\", void 0), e([c({\n  type: Boolean,\n  json: {\n    read: !1,\n    write: {\n      enabled: !0,\n      overridePolicy: () => ({\n        enabled: !1\n      })\n    }\n  }\n})], M.prototype, \"isReference\", void 0), e([c({\n  readOnly: !0,\n  type: [\"ArcGISTiledMapServiceLayer\"]\n})], M.prototype, \"operationalLayerType\", void 0), e([c({\n  type: Boolean\n})], M.prototype, \"resampling\", void 0), e([c()], M.prototype, \"sourceJSON\", void 0), e([c({\n  type: W\n})], M.prototype, \"spatialReference\", void 0), e([m(\"spatialReference\", [\"spatialReference\", \"tileInfo\"])], M.prototype, \"readSpatialReference\", null), e([c({\n  type: String,\n  json: {\n    origins: {\n      \"web-scene\": {\n        read: !0,\n        write: !0\n      }\n    },\n    read: !1\n  }\n})], M.prototype, \"path\", void 0), e([c({\n  readOnly: !0\n})], M.prototype, \"sublayers\", void 0), e([d(\"sublayers\", {\n  layers: {\n    type: [A]\n  }\n})], M.prototype, \"writeSublayers\", null), e([c({\n  json: {\n    read: !1,\n    write: !1\n  }\n})], M.prototype, \"popupEnabled\", void 0), e([c()], M.prototype, \"tileServers\", null), e([u(\"tileServers\")], M.prototype, \"castTileServers\", null), e([c({\n  readOnly: !0,\n  json: {\n    read: !1\n  }\n})], M.prototype, \"type\", void 0), e([c(P)], M.prototype, \"url\", void 0), M = e([h(\"esri.layers.TileLayer\")], M), M.prototype.fetchTile.__isDefault__ = !0;\nvar C = M;\nexport default C;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/TileLayer.js"],"names":["_","e","r","t","HandleOwnerMixin","s","isSome","i","MultiOriginJSONMixin","o","throwIfAbortError","a","urlToObject","l","objectToQuery","n","makeAbsolute","p","property","c","cast","u","reader","m","subclass","h","writer","d","y","APIKeyMixin","f","ArcGISCachedService","v","ArcGISMapService","g","ArcGISService","BlendLayer","S","CustomParametersMixin","j","OperationalLayer","b","PortalLayer","T","RefreshableLayer","w","ScaleRangeLayer","O","SublayersOwner","L","parse","R","isHostedAgolService","x","isArcGISUrl","U","url","P","A","W","I","M","constructor","listMode","isReference","operationalLayerType","resampling","sourceJSON","spatialReference","path","sublayers","type","normalizeCtorArgs","load","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","then","_fetchService","Promise","resolve","attributionDataUrl","parsedUrl","toLowerCase","_getDefaultAttribution","_getMapName","readSpatialReference","tileInfo","fromJSON","writeSublayers","loaded","slice","reverse","flatten","toArray","writeSublayerStructure","forEach","write","push","some","Object","keys","length","layers","tileServers","_getDefaultTileServers","castTileServers","Array","isArray","map","fetchTile","timestamp","getTileUrl","responseType","query","_ts","data","tilemapCache","supportsBlankTile","blankTile","customParameters","token","apiKey","bandCount","pixelSizeX","serverType","ssl","replace","read","origin","version","_fetchServerVersion","currentVersion","reject","match","indexOf","search","hasOverriddenFetchTile","__isDefault__","readOnly","prototype","Boolean","json","enabled","overridePolicy","String","origins","C"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../geometry.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{HandleOwnerMixin as s}from\"../core/HandleOwner.js\";import{isSome as i}from\"../core/maybe.js\";import{MultiOriginJSONMixin as o}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as a}from\"../core/promiseUtils.js\";import{urlToObject as l,objectToQuery as n,makeAbsolute as p}from\"../core/urlUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import{cast as u}from\"../core/accessorSupport/decorators/cast.js\";import\"../core/Logger.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as h}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import y from\"./Layer.js\";import{APIKeyMixin as f}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as v}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as g}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as _}from\"./mixins/ArcGISService.js\";import{BlendLayer as S}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as j}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{PortalLayer as T}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as w}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as O}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as L}from\"./mixins/SublayersOwner.js\";import{parse as R,isHostedAgolService as x,isArcGISUrl as U}from\"./support/arcgisLayerUrl.js\";import{url as P}from\"./support/commonProperties.js\";import A from\"./support/Sublayer.js\";import W from\"../geometry/SpatialReference.js\";const I=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let M=class extends(S(L(O(w(b(T(v(g(_(o(s(f(j(y)))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=i(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(a).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){var e;const r=null==(e=this.parsedUrl)?void 0:e.path.toLowerCase();return r&&this._getDefaultAttribution(this._getMapName(r))}readSpatialReference(e,r){return(e=e||r.tileInfo&&r.tileInfo.spatialReference)&&W.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>l(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o,timestamp:a}=i,l=this.getTileUrl(e,t,s),n={responseType:\"image\",signal:o};return null!=a&&(n.query={_ts:i.timestamp}),r(l,n).then((e=>e.data))}getTileUrl(e,r,t){const s=!this.tilemapCache&&this.supportsBlankTile,i=n({...this.parsedUrl.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}_fetchService(e){return new Promise(((s,o)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const a=R(this.parsedUrl.path);if(i(a)&&\"ImageServer\"===a.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,o)})).then((r=>{if(r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!x(this.url))return this._fetchServerVersion(this.url,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!U(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r&&r[2]}_getDefaultAttribution(e){if(!e)return;let r;e=e.toLowerCase();for(let t=0,s=I.length;t<s;t++)if(r=I[t],r.toLowerCase().indexOf(e)>-1)return p(\"//static.arcgis.com/attribution/\"+r)}_getDefaultTileServers(e){const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([c({readOnly:!0})],M.prototype,\"attributionDataUrl\",null),e([c({type:[\"show\",\"hide\",\"hide-children\"]})],M.prototype,\"listMode\",void 0),e([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],M.prototype,\"isReference\",void 0),e([c({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],M.prototype,\"operationalLayerType\",void 0),e([c({type:Boolean})],M.prototype,\"resampling\",void 0),e([c()],M.prototype,\"sourceJSON\",void 0),e([c({type:W})],M.prototype,\"spatialReference\",void 0),e([m(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],M.prototype,\"readSpatialReference\",null),e([c({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],M.prototype,\"path\",void 0),e([c({readOnly:!0})],M.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[A]}})],M.prototype,\"writeSublayers\",null),e([c({json:{read:!1,write:!1}})],M.prototype,\"popupEnabled\",void 0),e([c()],M.prototype,\"tileServers\",null),e([u(\"tileServers\")],M.prototype,\"castTileServers\",null),e([c({readOnly:!0,json:{read:!1}})],M.prototype,\"type\",void 0),e([c(P)],M.prototype,\"url\",void 0),M=e([h(\"esri.layers.TileLayer\")],M),M.prototype.fetchTile.__isDefault__=!0;var C=M;export default C;\n"]},"metadata":{},"sourceType":"module"}