{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { pt2px as t } from \"../../../../../core/screenUtils.js\";\nimport { CIMSymbolHelper as e } from \"../../../../../symbols/cim/CIMSymbolHelper.js\";\nimport i from \"../../../../../symbols/cim/Rect.js\";\nimport { AVERAGE_GLYPH_MOSAIC_ITEM as r } from \"../../../engine/webgl/definitions.js\";\nimport { getTextSymbolSize as n } from \"../../graphics/graphicsUtils.js\";\nconst s = {\n  \"simple-marker\": 1,\n  \"picture-marker\": 1,\n  text: 0,\n  \"simple-line\": 0,\n  \"simple-fill\": 0,\n  \"picture-fill\": 0,\n  cim: 1,\n  \"web-style\": 1\n},\n      o = .707;\n\nfunction a(t) {\n  if (!(\"visualVariables\" in t)) return 0;\n  if (!t.hasVisualVariables(\"size\")) return 0;\n  const e = t.getVisualVariablesForType(\"size\");\n  if (!e[0]) return 0;\n  const i = e[0];\n  if (\"stops\" === i.transformationType) return i.stops.map(t => t.size).reduce(x, 0);\n\n  if (\"clamped-linear\" === i.transformationType) {\n    let t = -1 / 0,\n        e = -1 / 0;\n    return t = \"number\" == typeof i.maxSize ? i.maxSize : i.maxSize.stops.map(t => t.size).reduce(x, 0), e = \"number\" == typeof i.minSize ? i.minSize : i.minSize.stops.map(t => t.size).reduce(x, 0), Math.max(t, e);\n  }\n\n  return \"real-world-size\" === i.transformationType ? 30 : void 0;\n}\n\nfunction m(t) {\n  return t.type in s;\n}\n\nasync function u(e, i, r) {\n  if (!e || r && \"cluster\" === r.type) return 0;\n  if (\"heatmap\" === e.type) return Math.round(3 * e.blurRadius);\n  if (\"dot-density\" === e.type) return 0;\n  if (\"dictionary\" === e.type) return \"esriGeometryPoint\" === i || \"esriGeometryMultipoint\" === i ? 100 : 200;\n  const n = e.getSymbols(),\n        s = a(e),\n        o = [];\n\n  for (const t of n) o.push(d(t, s));\n\n  const m = await Promise.all(o);\n  return t(m.reduce(x, 0));\n}\n\nconst c = [0, 0, 0, 0];\n\nfunction l(t, e) {\n  return null == t ? e : t;\n}\n\nfunction p(t, e) {\n  return null == t.outline ? e : l(t.outline.width, e);\n}\n\nconst f = {\n  sdf: !0,\n  code: 99,\n  metrics: r.metrics,\n  rect: new i(0, 0, 24, 24),\n  page: 0,\n  textureBinding: 2\n};\n\nfunction h(t) {\n  const e = t.text && t.text.length;\n  if (!e) return {\n    glyphMosaicItems: [f]\n  };\n  const i = [];\n\n  for (let r = 0; r < e; r++) i.push({ ...f,\n    code: t.text.charCodeAt(r)\n  });\n\n  return {\n    glyphMosaicItems: i\n  };\n}\n\nasync function y(t, i) {\n  if (\"simple-marker\" === t.type) {\n    const e = Math.max(l(t.size, 12), i);\n    return M(t) + e * o;\n  }\n\n  if (\"picture-marker\" === t.type) {\n    const e = Math.max(l(t.height, 12), i),\n          r = l(t.width, 12) * (e / l(t.height, 12)) / 2,\n          n = e / 2;\n    return M(t) + Math.sqrt(r * r + n * n);\n  }\n\n  if (\"text\" === t.type) {\n    const e = h(t);\n    n(c, t.toJSON(), e);\n    const i = Math.abs(c[0]),\n          r = Math.abs(c[1]),\n          s = c[2],\n          o = c[3];\n    return Math.max(i, r) + Math.max(s, o);\n  }\n\n  if (\"simple-line\" === t.type) {\n    const e = t,\n          r = Math.max(l(e.width, .75), i) / 2;\n    return e.marker ? Math.max(6 * e.width, 2 * i) : r;\n  }\n\n  if (\"simple-fill\" === t.type || \"picture-fill\" === t.type) return Math.max(p(t, 0), i) / 2;\n\n  if (\"cim\" === t.type) {\n    const i = e.getEnvelope(t.data);\n    return i ? Math.sqrt(i.width * i.width + i.height * i.height) : 0;\n  }\n\n  return \"web-style\" === t.type ? y(await t.fetchCIMSymbol(), i) : 0;\n}\n\nasync function d(t, e) {\n  return m(t) ? Math.min(await y(t, e), 75) : 0;\n}\n\nfunction M(t) {\n  const e = l(t.xoffset, 0),\n        i = l(t.yoffset, 0);\n  return Math.sqrt(e * e + i * i);\n}\n\nfunction x(t, e) {\n  return Math.max(t, e);\n}\n\nexport { u as computePxBuffer, a as getPtMaxVVSize };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/layers/features/support/pixelBuffering.js"],"names":["pt2px","t","CIMSymbolHelper","e","i","AVERAGE_GLYPH_MOSAIC_ITEM","r","getTextSymbolSize","n","s","text","cim","o","a","hasVisualVariables","getVisualVariablesForType","transformationType","stops","map","size","reduce","x","maxSize","minSize","Math","max","m","type","u","round","blurRadius","getSymbols","push","d","Promise","all","c","l","p","outline","width","f","sdf","code","metrics","rect","page","textureBinding","h","length","glyphMosaicItems","charCodeAt","y","M","height","sqrt","toJSON","abs","marker","getEnvelope","data","fetchCIMSymbol","min","xoffset","yoffset","computePxBuffer","getPtMaxVVSize"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,KAAK,IAAIC,CAAhB,QAAsB,oCAAtB;AAA2D,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,+CAAhC;AAAgF,OAAOC,CAAP,MAAa,oCAAb;AAAkD,SAAOC,yBAAyB,IAAIC,CAApC,QAA0C,sCAA1C;AAAiF,SAAOC,iBAAiB,IAAIC,CAA5B,QAAkC,iCAAlC;AAAoE,MAAMC,CAAC,GAAC;AAAC,mBAAgB,CAAjB;AAAmB,oBAAiB,CAApC;AAAsCC,EAAAA,IAAI,EAAC,CAA3C;AAA6C,iBAAc,CAA3D;AAA6D,iBAAc,CAA3E;AAA6E,kBAAe,CAA5F;AAA8FC,EAAAA,GAAG,EAAC,CAAlG;AAAoG,eAAY;AAAhH,CAAR;AAAA,MAA2HC,CAAC,GAAC,IAA7H;;AAAkI,SAASC,CAAT,CAAWZ,CAAX,EAAa;AAAC,MAAG,EAAE,qBAAoBA,CAAtB,CAAH,EAA4B,OAAO,CAAP;AAAS,MAAG,CAACA,CAAC,CAACa,kBAAF,CAAqB,MAArB,CAAJ,EAAiC,OAAO,CAAP;AAAS,QAAMX,CAAC,GAACF,CAAC,CAACc,yBAAF,CAA4B,MAA5B,CAAR;AAA4C,MAAG,CAACZ,CAAC,CAAC,CAAD,CAAL,EAAS,OAAO,CAAP;AAAS,QAAMC,CAAC,GAACD,CAAC,CAAC,CAAD,CAAT;AAAa,MAAG,YAAUC,CAAC,CAACY,kBAAf,EAAkC,OAAOZ,CAAC,CAACa,KAAF,CAAQC,GAAR,CAAajB,CAAC,IAAEA,CAAC,CAACkB,IAAlB,EAAyBC,MAAzB,CAAgCC,CAAhC,EAAkC,CAAlC,CAAP;;AAA4C,MAAG,qBAAmBjB,CAAC,CAACY,kBAAxB,EAA2C;AAAC,QAAIf,CAAC,GAAC,CAAC,CAAD,GAAG,CAAT;AAAA,QAAWE,CAAC,GAAC,CAAC,CAAD,GAAG,CAAhB;AAAkB,WAAOF,CAAC,GAAC,YAAU,OAAOG,CAAC,CAACkB,OAAnB,GAA2BlB,CAAC,CAACkB,OAA7B,GAAqClB,CAAC,CAACkB,OAAF,CAAUL,KAAV,CAAgBC,GAAhB,CAAqBjB,CAAC,IAAEA,CAAC,CAACkB,IAA1B,EAAiCC,MAAjC,CAAwCC,CAAxC,EAA0C,CAA1C,CAAvC,EAAoFlB,CAAC,GAAC,YAAU,OAAOC,CAAC,CAACmB,OAAnB,GAA2BnB,CAAC,CAACmB,OAA7B,GAAqCnB,CAAC,CAACmB,OAAF,CAAUN,KAAV,CAAgBC,GAAhB,CAAqBjB,CAAC,IAAEA,CAAC,CAACkB,IAA1B,EAAiCC,MAAjC,CAAwCC,CAAxC,EAA0C,CAA1C,CAA3H,EAAwKG,IAAI,CAACC,GAAL,CAASxB,CAAT,EAAWE,CAAX,CAA/K;AAA6L;;AAAA,SAAM,sBAAoBC,CAAC,CAACY,kBAAtB,GAAyC,EAAzC,GAA4C,KAAK,CAAvD;AAAyD;;AAAA,SAASU,CAAT,CAAWzB,CAAX,EAAa;AAAC,SAAOA,CAAC,CAAC0B,IAAF,IAAUlB,CAAjB;AAAmB;;AAAA,eAAemB,CAAf,CAAiBzB,CAAjB,EAAmBC,CAAnB,EAAqBE,CAArB,EAAuB;AAAC,MAAG,CAACH,CAAD,IAAIG,CAAC,IAAE,cAAYA,CAAC,CAACqB,IAAxB,EAA6B,OAAO,CAAP;AAAS,MAAG,cAAYxB,CAAC,CAACwB,IAAjB,EAAsB,OAAOH,IAAI,CAACK,KAAL,CAAW,IAAE1B,CAAC,CAAC2B,UAAf,CAAP;AAAkC,MAAG,kBAAgB3B,CAAC,CAACwB,IAArB,EAA0B,OAAO,CAAP;AAAS,MAAG,iBAAexB,CAAC,CAACwB,IAApB,EAAyB,OAAM,wBAAsBvB,CAAtB,IAAyB,6BAA2BA,CAApD,GAAsD,GAAtD,GAA0D,GAAhE;AAAoE,QAAMI,CAAC,GAACL,CAAC,CAAC4B,UAAF,EAAR;AAAA,QAAuBtB,CAAC,GAACI,CAAC,CAACV,CAAD,CAA1B;AAAA,QAA8BS,CAAC,GAAC,EAAhC;;AAAmC,OAAI,MAAMX,CAAV,IAAeO,CAAf,EAAiBI,CAAC,CAACoB,IAAF,CAAOC,CAAC,CAAChC,CAAD,EAAGQ,CAAH,CAAR;;AAAe,QAAMiB,CAAC,GAAC,MAAMQ,OAAO,CAACC,GAAR,CAAYvB,CAAZ,CAAd;AAA6B,SAAOX,CAAC,CAACyB,CAAC,CAACN,MAAF,CAASC,CAAT,EAAW,CAAX,CAAD,CAAR;AAAwB;;AAAA,MAAMe,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAR;;AAAkB,SAASC,CAAT,CAAWpC,CAAX,EAAaE,CAAb,EAAe;AAAC,SAAO,QAAMF,CAAN,GAAQE,CAAR,GAAUF,CAAjB;AAAmB;;AAAA,SAASqC,CAAT,CAAWrC,CAAX,EAAaE,CAAb,EAAe;AAAC,SAAO,QAAMF,CAAC,CAACsC,OAAR,GAAgBpC,CAAhB,GAAkBkC,CAAC,CAACpC,CAAC,CAACsC,OAAF,CAAUC,KAAX,EAAiBrC,CAAjB,CAA1B;AAA8C;;AAAA,MAAMsC,CAAC,GAAC;AAACC,EAAAA,GAAG,EAAC,CAAC,CAAN;AAAQC,EAAAA,IAAI,EAAC,EAAb;AAAgBC,EAAAA,OAAO,EAACtC,CAAC,CAACsC,OAA1B;AAAkCC,EAAAA,IAAI,EAAC,IAAIzC,CAAJ,CAAM,CAAN,EAAQ,CAAR,EAAU,EAAV,EAAa,EAAb,CAAvC;AAAwD0C,EAAAA,IAAI,EAAC,CAA7D;AAA+DC,EAAAA,cAAc,EAAC;AAA9E,CAAR;;AAAyF,SAASC,CAAT,CAAW/C,CAAX,EAAa;AAAC,QAAME,CAAC,GAACF,CAAC,CAACS,IAAF,IAAQT,CAAC,CAACS,IAAF,CAAOuC,MAAvB;AAA8B,MAAG,CAAC9C,CAAJ,EAAM,OAAM;AAAC+C,IAAAA,gBAAgB,EAAC,CAACT,CAAD;AAAlB,GAAN;AAA6B,QAAMrC,CAAC,GAAC,EAAR;;AAAW,OAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACH,CAAd,EAAgBG,CAAC,EAAjB,EAAoBF,CAAC,CAAC4B,IAAF,CAAO,EAAC,GAAGS,CAAJ;AAAME,IAAAA,IAAI,EAAC1C,CAAC,CAACS,IAAF,CAAOyC,UAAP,CAAkB7C,CAAlB;AAAX,GAAP;;AAAyC,SAAM;AAAC4C,IAAAA,gBAAgB,EAAC9C;AAAlB,GAAN;AAA2B;;AAAA,eAAegD,CAAf,CAAiBnD,CAAjB,EAAmBG,CAAnB,EAAqB;AAAC,MAAG,oBAAkBH,CAAC,CAAC0B,IAAvB,EAA4B;AAAC,UAAMxB,CAAC,GAACqB,IAAI,CAACC,GAAL,CAASY,CAAC,CAACpC,CAAC,CAACkB,IAAH,EAAQ,EAAR,CAAV,EAAsBf,CAAtB,CAAR;AAAiC,WAAOiD,CAAC,CAACpD,CAAD,CAAD,GAAKE,CAAC,GAACS,CAAd;AAAgB;;AAAA,MAAG,qBAAmBX,CAAC,CAAC0B,IAAxB,EAA6B;AAAC,UAAMxB,CAAC,GAACqB,IAAI,CAACC,GAAL,CAASY,CAAC,CAACpC,CAAC,CAACqD,MAAH,EAAU,EAAV,CAAV,EAAwBlD,CAAxB,CAAR;AAAA,UAAmCE,CAAC,GAAC+B,CAAC,CAACpC,CAAC,CAACuC,KAAH,EAAS,EAAT,CAAD,IAAerC,CAAC,GAACkC,CAAC,CAACpC,CAAC,CAACqD,MAAH,EAAU,EAAV,CAAlB,IAAiC,CAAtE;AAAA,UAAwE9C,CAAC,GAACL,CAAC,GAAC,CAA5E;AAA8E,WAAOkD,CAAC,CAACpD,CAAD,CAAD,GAAKuB,IAAI,CAAC+B,IAAL,CAAUjD,CAAC,GAACA,CAAF,GAAIE,CAAC,GAACA,CAAhB,CAAZ;AAA+B;;AAAA,MAAG,WAASP,CAAC,CAAC0B,IAAd,EAAmB;AAAC,UAAMxB,CAAC,GAAC6C,CAAC,CAAC/C,CAAD,CAAT;AAAaO,IAAAA,CAAC,CAAC4B,CAAD,EAAGnC,CAAC,CAACuD,MAAF,EAAH,EAAcrD,CAAd,CAAD;AAAkB,UAAMC,CAAC,GAACoB,IAAI,CAACiC,GAAL,CAASrB,CAAC,CAAC,CAAD,CAAV,CAAR;AAAA,UAAuB9B,CAAC,GAACkB,IAAI,CAACiC,GAAL,CAASrB,CAAC,CAAC,CAAD,CAAV,CAAzB;AAAA,UAAwC3B,CAAC,GAAC2B,CAAC,CAAC,CAAD,CAA3C;AAAA,UAA+CxB,CAAC,GAACwB,CAAC,CAAC,CAAD,CAAlD;AAAsD,WAAOZ,IAAI,CAACC,GAAL,CAASrB,CAAT,EAAWE,CAAX,IAAckB,IAAI,CAACC,GAAL,CAAShB,CAAT,EAAWG,CAAX,CAArB;AAAmC;;AAAA,MAAG,kBAAgBX,CAAC,CAAC0B,IAArB,EAA0B;AAAC,UAAMxB,CAAC,GAACF,CAAR;AAAA,UAAUK,CAAC,GAACkB,IAAI,CAACC,GAAL,CAASY,CAAC,CAAClC,CAAC,CAACqC,KAAH,EAAS,GAAT,CAAV,EAAwBpC,CAAxB,IAA2B,CAAvC;AAAyC,WAAOD,CAAC,CAACuD,MAAF,GAASlC,IAAI,CAACC,GAAL,CAAS,IAAEtB,CAAC,CAACqC,KAAb,EAAmB,IAAEpC,CAArB,CAAT,GAAiCE,CAAxC;AAA0C;;AAAA,MAAG,kBAAgBL,CAAC,CAAC0B,IAAlB,IAAwB,mBAAiB1B,CAAC,CAAC0B,IAA9C,EAAmD,OAAOH,IAAI,CAACC,GAAL,CAASa,CAAC,CAACrC,CAAD,EAAG,CAAH,CAAV,EAAgBG,CAAhB,IAAmB,CAA1B;;AAA4B,MAAG,UAAQH,CAAC,CAAC0B,IAAb,EAAkB;AAAC,UAAMvB,CAAC,GAACD,CAAC,CAACwD,WAAF,CAAc1D,CAAC,CAAC2D,IAAhB,CAAR;AAA8B,WAAOxD,CAAC,GAACoB,IAAI,CAAC+B,IAAL,CAAUnD,CAAC,CAACoC,KAAF,GAAQpC,CAAC,CAACoC,KAAV,GAAgBpC,CAAC,CAACkD,MAAF,GAASlD,CAAC,CAACkD,MAArC,CAAD,GAA8C,CAAtD;AAAwD;;AAAA,SAAM,gBAAcrD,CAAC,CAAC0B,IAAhB,GAAqByB,CAAC,CAAC,MAAMnD,CAAC,CAAC4D,cAAF,EAAP,EAA0BzD,CAA1B,CAAtB,GAAmD,CAAzD;AAA2D;;AAAA,eAAe6B,CAAf,CAAiBhC,CAAjB,EAAmBE,CAAnB,EAAqB;AAAC,SAAOuB,CAAC,CAACzB,CAAD,CAAD,GAAKuB,IAAI,CAACsC,GAAL,CAAS,MAAMV,CAAC,CAACnD,CAAD,EAAGE,CAAH,CAAhB,EAAsB,EAAtB,CAAL,GAA+B,CAAtC;AAAwC;;AAAA,SAASkD,CAAT,CAAWpD,CAAX,EAAa;AAAC,QAAME,CAAC,GAACkC,CAAC,CAACpC,CAAC,CAAC8D,OAAH,EAAW,CAAX,CAAT;AAAA,QAAuB3D,CAAC,GAACiC,CAAC,CAACpC,CAAC,CAAC+D,OAAH,EAAW,CAAX,CAA1B;AAAwC,SAAOxC,IAAI,CAAC+B,IAAL,CAAUpD,CAAC,GAACA,CAAF,GAAIC,CAAC,GAACA,CAAhB,CAAP;AAA0B;;AAAA,SAASiB,CAAT,CAAWpB,CAAX,EAAaE,CAAb,EAAe;AAAC,SAAOqB,IAAI,CAACC,GAAL,CAASxB,CAAT,EAAWE,CAAX,CAAP;AAAqB;;AAAA,SAAOyB,CAAC,IAAIqC,eAAZ,EAA4BpD,CAAC,IAAIqD,cAAjC","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{pt2px as t}from\"../../../../../core/screenUtils.js\";import{CIMSymbolHelper as e}from\"../../../../../symbols/cim/CIMSymbolHelper.js\";import i from\"../../../../../symbols/cim/Rect.js\";import{AVERAGE_GLYPH_MOSAIC_ITEM as r}from\"../../../engine/webgl/definitions.js\";import{getTextSymbolSize as n}from\"../../graphics/graphicsUtils.js\";const s={\"simple-marker\":1,\"picture-marker\":1,text:0,\"simple-line\":0,\"simple-fill\":0,\"picture-fill\":0,cim:1,\"web-style\":1},o=.707;function a(t){if(!(\"visualVariables\"in t))return 0;if(!t.hasVisualVariables(\"size\"))return 0;const e=t.getVisualVariablesForType(\"size\");if(!e[0])return 0;const i=e[0];if(\"stops\"===i.transformationType)return i.stops.map((t=>t.size)).reduce(x,0);if(\"clamped-linear\"===i.transformationType){let t=-1/0,e=-1/0;return t=\"number\"==typeof i.maxSize?i.maxSize:i.maxSize.stops.map((t=>t.size)).reduce(x,0),e=\"number\"==typeof i.minSize?i.minSize:i.minSize.stops.map((t=>t.size)).reduce(x,0),Math.max(t,e)}return\"real-world-size\"===i.transformationType?30:void 0}function m(t){return t.type in s}async function u(e,i,r){if(!e||r&&\"cluster\"===r.type)return 0;if(\"heatmap\"===e.type)return Math.round(3*e.blurRadius);if(\"dot-density\"===e.type)return 0;if(\"dictionary\"===e.type)return\"esriGeometryPoint\"===i||\"esriGeometryMultipoint\"===i?100:200;const n=e.getSymbols(),s=a(e),o=[];for(const t of n)o.push(d(t,s));const m=await Promise.all(o);return t(m.reduce(x,0))}const c=[0,0,0,0];function l(t,e){return null==t?e:t}function p(t,e){return null==t.outline?e:l(t.outline.width,e)}const f={sdf:!0,code:99,metrics:r.metrics,rect:new i(0,0,24,24),page:0,textureBinding:2};function h(t){const e=t.text&&t.text.length;if(!e)return{glyphMosaicItems:[f]};const i=[];for(let r=0;r<e;r++)i.push({...f,code:t.text.charCodeAt(r)});return{glyphMosaicItems:i}}async function y(t,i){if(\"simple-marker\"===t.type){const e=Math.max(l(t.size,12),i);return M(t)+e*o}if(\"picture-marker\"===t.type){const e=Math.max(l(t.height,12),i),r=l(t.width,12)*(e/l(t.height,12))/2,n=e/2;return M(t)+Math.sqrt(r*r+n*n)}if(\"text\"===t.type){const e=h(t);n(c,t.toJSON(),e);const i=Math.abs(c[0]),r=Math.abs(c[1]),s=c[2],o=c[3];return Math.max(i,r)+Math.max(s,o)}if(\"simple-line\"===t.type){const e=t,r=Math.max(l(e.width,.75),i)/2;return e.marker?Math.max(6*e.width,2*i):r}if(\"simple-fill\"===t.type||\"picture-fill\"===t.type)return Math.max(p(t,0),i)/2;if(\"cim\"===t.type){const i=e.getEnvelope(t.data);return i?Math.sqrt(i.width*i.width+i.height*i.height):0}return\"web-style\"===t.type?y(await t.fetchCIMSymbol(),i):0}async function d(t,e){return m(t)?Math.min(await y(t,e),75):0}function M(t){const e=l(t.xoffset,0),i=l(t.yoffset,0);return Math.sqrt(e*e+i*i)}function x(t,e){return Math.max(t,e)}export{u as computePxBuffer,a as getPtMaxVVSize};\n"]},"metadata":{},"sourceType":"module"}