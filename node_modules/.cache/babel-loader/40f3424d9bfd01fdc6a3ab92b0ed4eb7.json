{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Error.js\";\nimport t from \"../../../../../core/Logger.js\";\nimport s from \"../../../../../core/LRUCache.js\";\nimport { createRendererExpression as r } from \"../../../../../support/arcadeOnDemand.js\";\nimport { expandSymbol as i } from \"../../../../../symbols/cim/cimSymbolUtils.js\";\nimport { createLabelOverrideFunction as a } from \"../../../../../symbols/cim/utils.js\";\nimport n from \"../../../arcade/callExpressionWithFeature.js\";\nimport { createSymbolSchema as l } from \"../../../layers/features/schemaUtils.js\";\nconst o = t.getLogger(\"esri/views/2d/engine/webgl/util/Matcher\");\n\nasync function u(e, t, s) {\n  switch (e.type) {\n    case \"simple\":\n      return c.fromBasicRenderer(e, t, s);\n\n    case \"map\":\n      return h.fromUVRenderer(e, t, s);\n\n    case \"interval\":\n      return m.fromCBRenderer(e, t, s);\n\n    case \"dictionary\":\n      return p.fromDictionaryRenderer(e, t, s);\n\n    case \"subtype\":\n      return d.fromSubtypes(e, t, s);\n  }\n}\n\nclass c {\n  constructor() {\n    this.type = \"feature\", this._defaultResult = null;\n  }\n\n  static async fromBasicRenderer(e, t, s) {\n    const r = new c();\n\n    if (e.symbol) {\n      const a = await i(e.symbol, s),\n            n = t.createTemplateGroup(a, null);\n      r.setDefault(n);\n    }\n\n    return r;\n  }\n\n  size() {\n    return 1;\n  }\n\n  getDefault() {\n    return this._defaultResult;\n  }\n\n  setDefault(e) {\n    this._defaultResult = e;\n  }\n\n  match(e, t, s, r, i) {\n    return this.getDefault();\n  }\n\n  async analyze(e, t, s, r, i) {\n    return null;\n  }\n\n}\n\nclass d extends c {\n  constructor(e, t) {\n    super(), this._subMatchers = e, this._subtypeField = t;\n  }\n\n  static async fromSubtypes(e, t, s) {\n    const r = new Map(),\n          i = [];\n\n    for (const a in e.renderers) {\n      const n = parseInt(a, 10),\n            l = u(e.renderers[a], t, s).then(e => r.set(n, e));\n      i.push(l);\n    }\n\n    return await Promise.all(i), new d(r, e.subtypeField);\n  }\n\n  match(e, t, s, r, i) {\n    const a = t.readAttribute(this._subtypeField),\n          n = this._subMatchers.get(a);\n\n    return n ? n.match(e, t, s, r, i) : null;\n  }\n\n}\n\nclass m extends c {\n  constructor(e, t, s, r) {\n    super(), this.type = \"interval\", this._intervals = [], this._isMaxInclusive = t, this._fieldIndex = r, this._field = e, this._normalizationInfo = s;\n  }\n\n  static async fromCBRenderer(e, t, s) {\n    const {\n      isMaxInclusive: r,\n      normalizationField: a,\n      normalizationTotal: n,\n      normalizationType: l\n    } = e,\n          o = e.field,\n          u = new m(o, r, {\n      normalizationField: a,\n      normalizationTotal: n,\n      normalizationType: l\n    }, e.fieldIndex),\n          c = await i(e.backgroundFillSymbol, s);\n    await Promise.all(e.intervals.map(async e => {\n      const r = await i(e.symbol, s),\n            a = await t.createTemplateGroup(r, c),\n            n = {\n        min: e.min,\n        max: e.max\n      };\n      u.add(n, a);\n    }));\n    const d = await i(e.defaultSymbol, s);\n\n    if (d) {\n      const e = await t.createTemplateGroup(d, c);\n      u.setDefault(e);\n    }\n\n    return u;\n  }\n\n  add(e, t) {\n    this._intervals.push({\n      interval: e,\n      result: t\n    }), this._intervals.sort((e, t) => e.interval.min - t.interval.min);\n  }\n\n  size() {\n    return super.size() + this._intervals.length;\n  }\n\n  match(e, t, s, r, i) {\n    if (null == this._fieldIndex && !this._field) return this.getDefault();\n    const a = null != this._fieldIndex ? t.getComputedNumericAtIndex(this._fieldIndex) : this._getValueFromField(t);\n    if (!a && (null == a || isNaN(a))) return this.getDefault();\n\n    for (let n = 0; n < this._intervals.length; n++) {\n      const {\n        interval: e,\n        result: t\n      } = this._intervals[n],\n            s = a >= e.min,\n            r = this._isMaxInclusive ? a <= e.max : a < e.max;\n      if (s && r) return t;\n    }\n\n    return this.getDefault();\n  }\n\n  _needsNormalization() {\n    const e = this._normalizationInfo;\n    return e && (e.normalizationField || e.normalizationTotal || e.normalizationType);\n  }\n\n  _getValueFromField(e) {\n    const t = e.readAttribute(this._field);\n    if (!this._needsNormalization() || null == t) return t;\n    const {\n      normalizationField: s,\n      normalizationTotal: r,\n      normalizationType: i\n    } = this._normalizationInfo,\n          a = !!s && e.readAttribute(s);\n    if (i) switch (i) {\n      case \"esriNormalizeByField\":\n        return a ? t / a : void 0;\n\n      case \"esriNormalizeByLog\":\n        return Math.log(t) * Math.LOG10E;\n\n      case \"esriNormalizeByPercentOfTotal\":\n        return t / r * 100;\n\n      default:\n        return void o.error(`Found unknown normalization type: ${i}`);\n    } else o.error(\"Normalization is required, but no type was set!\");\n  }\n\n}\n\nclass h extends c {\n  constructor(e, t, s) {\n    super(), this.type = \"map\", this._nullResult = null, this._resultsMap = new Map(), this._fieldsIndex = s, this._fields = e, this._seperator = t || \"\";\n  }\n\n  static async fromUVRenderer(e, t, s) {\n    const r = e.fieldDelimiter,\n          a = [e.field];\n    e.field2 && a.push(e.field2), e.field3 && a.push(e.field3);\n    const n = await i(e.backgroundFillSymbol, s),\n          l = new h(a, r, e.fieldIndex);\n    await Promise.all(e.map.map(async e => {\n      const r = await i(e.symbol, s),\n            a = await t.createTemplateGroup(r, n);\n      \"<Null>\" === e.value ? l.setNullResult(a) : l.add(e.value, a);\n    }));\n    const o = await i(e.defaultSymbol, s);\n\n    if (o) {\n      const e = await t.createTemplateGroup(o, n);\n      l.setDefault(e);\n    }\n\n    return l;\n  }\n\n  setNullResult(e) {\n    this._nullResult = e;\n  }\n\n  add(e, t) {\n    this._resultsMap.set(e.toString(), t);\n  }\n\n  size() {\n    return super.size() + this._resultsMap.size;\n  }\n\n  match(e, t, s, r, i) {\n    if (null == this._fieldsIndex && !this._fields) return this.getDefault();\n    const a = null != this._fieldsIndex ? t.getComputedStringAtIndex(this._fieldsIndex) : this._getValueFromFields(t);\n    if (null !== this._nullResult && (null == a || \"\" === a || \"<Null>\" === a)) return this._nullResult;\n    if (!a && null == a) return this.getDefault();\n    const n = a.toString();\n    return this._resultsMap.has(n) ? this._resultsMap.get(n) : this.getDefault();\n  }\n\n  _getValueFromFields(e) {\n    const t = [];\n\n    for (const s of this._fields) {\n      const r = e.readAttribute(s);\n      null == r || \"\" === r ? t.push(\"<Null>\") : t.push(r);\n    }\n\n    return t.join(this._seperator);\n  }\n\n}\n\nasync function f(e, t) {\n  const s = e || 1;\n  if (\"number\" == typeof s) return (e, t, r) => s;\n  const i = await r(s, t.spatialReference, t.fields);\n  return (e, s, r) => n(i, e, {\n    $view: r\n  }, t.geometryType, s) || 1;\n}\n\nclass p extends c {\n  constructor(e, t, r, i) {\n    super(), this.type = \"dictionary\", this._groupIdCache = new s(100), this._renderer = e, this._fieldMap = e.fieldMap, this._symbolFields = e.getSymbolFields(), this._templates = t, this._info = r, this._scaleFn = i;\n  }\n\n  static async fromDictionaryRenderer(e, t, s) {\n    const r = (await import(\"../../../../../renderers/DictionaryRenderer.js\")).default.fromJSON(e.renderer);\n    await r.fetchResources({\n      spatialReference: s.spatialReference,\n      fields: s.fields\n    });\n    const i = await f(r.scaleExpression, s);\n    return new p(r, t, s, i);\n  }\n\n  async _analyzeFeature(t, s, r, n) {\n    const u = t.readLegacyFeature(),\n          c = this._scaleFn(u, s, r),\n          d = this._attributeHash(u) + \"-\" + c,\n          m = this._groupIdCache.get(d);\n\n    if (m) return m;\n\n    const h = { ...r,\n      spatialReference: this._info.spatialReference,\n      abortOptions: n,\n      fields: this._info.fields\n    },\n          f = await this._renderer.getSymbolAsync(u, h),\n          p = l(f, this._renderer),\n          _ = i(p, this._info, n).then(t => {\n      if (\"expanded-cim\" !== t.type) return o.error(new e(\"mapview-bad-type\", `Found unexpected type ${t.type} in dictionary response`)), null;\n      t.hash += \"-\" + c;\n\n      for (const e of t.layers) e.scaleFactor = c, e.templateHash += \"-\" + c, \"text\" === e.type && \"string\" == typeof e.text && e.text.indexOf(\"[\") > -1 && (e.text = a(this._fieldMap, e.text, e.cim.textCase));\n\n      return this._templates.createTemplateGroup(t, null);\n    });\n\n    return this._groupIdCache.put(d, _, 1), _;\n  }\n\n  async analyze(e, t, s, r, i) {\n    const a = t.getCursor(),\n          n = [];\n\n    for (; a.next();) n.push(this._analyzeFeature(a, s, r, i));\n\n    return Promise.all(n);\n  }\n\n  match(e, t, s, r, i) {\n    return null;\n  }\n\n  _attributeHash(e) {\n    let t = \"\";\n\n    for (const s of this._symbolFields) {\n      const r = this._fieldMap[s];\n      r && (t += e.attributes[r] + \"-\");\n    }\n\n    return t;\n  }\n\n}\n\nexport { p as DictionaryMatcher, c as FeatureMatcher, m as IntervalMatcher, h as MapMatcher, d as SubtypeMatcher, u as createMatcher };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/webgl/util/Matcher.js"],"names":["e","t","s","createRendererExpression","r","expandSymbol","i","createLabelOverrideFunction","a","n","createSymbolSchema","l","o","getLogger","u","type","c","fromBasicRenderer","h","fromUVRenderer","m","fromCBRenderer","p","fromDictionaryRenderer","d","fromSubtypes","constructor","_defaultResult","symbol","createTemplateGroup","setDefault","size","getDefault","match","analyze","_subMatchers","_subtypeField","Map","renderers","parseInt","then","set","push","Promise","all","subtypeField","readAttribute","get","_intervals","_isMaxInclusive","_fieldIndex","_field","_normalizationInfo","isMaxInclusive","normalizationField","normalizationTotal","normalizationType","field","fieldIndex","backgroundFillSymbol","intervals","map","min","max","add","defaultSymbol","interval","result","sort","length","getComputedNumericAtIndex","_getValueFromField","isNaN","_needsNormalization","Math","log","LOG10E","error","_nullResult","_resultsMap","_fieldsIndex","_fields","_seperator","fieldDelimiter","field2","field3","value","setNullResult","toString","getComputedStringAtIndex","_getValueFromFields","has","join","f","spatialReference","fields","$view","geometryType","_groupIdCache","_renderer","_fieldMap","fieldMap","_symbolFields","getSymbolFields","_templates","_info","_scaleFn","default","fromJSON","renderer","fetchResources","scaleExpression","_analyzeFeature","readLegacyFeature","_attributeHash","abortOptions","getSymbolAsync","_","hash","layers","scaleFactor","templateHash","text","indexOf","cim","textCase","put","getCursor","next","attributes","DictionaryMatcher","FeatureMatcher","IntervalMatcher","MapMatcher","SubtypeMatcher","createMatcher"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import t from\"../../../../../core/Logger.js\";import s from\"../../../../../core/LRUCache.js\";import{createRendererExpression as r}from\"../../../../../support/arcadeOnDemand.js\";import{expandSymbol as i}from\"../../../../../symbols/cim/cimSymbolUtils.js\";import{createLabelOverrideFunction as a}from\"../../../../../symbols/cim/utils.js\";import n from\"../../../arcade/callExpressionWithFeature.js\";import{createSymbolSchema as l}from\"../../../layers/features/schemaUtils.js\";const o=t.getLogger(\"esri/views/2d/engine/webgl/util/Matcher\");async function u(e,t,s){switch(e.type){case\"simple\":return c.fromBasicRenderer(e,t,s);case\"map\":return h.fromUVRenderer(e,t,s);case\"interval\":return m.fromCBRenderer(e,t,s);case\"dictionary\":return p.fromDictionaryRenderer(e,t,s);case\"subtype\":return d.fromSubtypes(e,t,s)}}class c{constructor(){this.type=\"feature\",this._defaultResult=null}static async fromBasicRenderer(e,t,s){const r=new c;if(e.symbol){const a=await i(e.symbol,s),n=t.createTemplateGroup(a,null);r.setDefault(n)}return r}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}match(e,t,s,r,i){return this.getDefault()}async analyze(e,t,s,r,i){return null}}class d extends c{constructor(e,t){super(),this._subMatchers=e,this._subtypeField=t}static async fromSubtypes(e,t,s){const r=new Map,i=[];for(const a in e.renderers){const n=parseInt(a,10),l=u(e.renderers[a],t,s).then((e=>r.set(n,e)));i.push(l)}return await Promise.all(i),new d(r,e.subtypeField)}match(e,t,s,r,i){const a=t.readAttribute(this._subtypeField),n=this._subMatchers.get(a);return n?n.match(e,t,s,r,i):null}}class m extends c{constructor(e,t,s,r){super(),this.type=\"interval\",this._intervals=[],this._isMaxInclusive=t,this._fieldIndex=r,this._field=e,this._normalizationInfo=s}static async fromCBRenderer(e,t,s){const{isMaxInclusive:r,normalizationField:a,normalizationTotal:n,normalizationType:l}=e,o=e.field,u=new m(o,r,{normalizationField:a,normalizationTotal:n,normalizationType:l},e.fieldIndex),c=await i(e.backgroundFillSymbol,s);await Promise.all(e.intervals.map((async e=>{const r=await i(e.symbol,s),a=await t.createTemplateGroup(r,c),n={min:e.min,max:e.max};u.add(n,a)})));const d=await i(e.defaultSymbol,s);if(d){const e=await t.createTemplateGroup(d,c);u.setDefault(e)}return u}add(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort(((e,t)=>e.interval.min-t.interval.min))}size(){return super.size()+this._intervals.length}match(e,t,s,r,i){if(null==this._fieldIndex&&!this._field)return this.getDefault();const a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(let n=0;n<this._intervals.length;n++){const{interval:e,result:t}=this._intervals[n],s=a>=e.min,r=this._isMaxInclusive?a<=e.max:a<e.max;if(s&&r)return t}return this.getDefault()}_needsNormalization(){const e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}_getValueFromField(e){const t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;const{normalizationField:s,normalizationTotal:r,normalizationType:i}=this._normalizationInfo,a=!!s&&e.readAttribute(s);if(i)switch(i){case\"esriNormalizeByField\":return a?t/a:void 0;case\"esriNormalizeByLog\":return Math.log(t)*Math.LOG10E;case\"esriNormalizeByPercentOfTotal\":return t/r*100;default:return void o.error(`Found unknown normalization type: ${i}`)}else o.error(\"Normalization is required, but no type was set!\")}}class h extends c{constructor(e,t,s){super(),this.type=\"map\",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=s,this._fields=e,this._seperator=t||\"\"}static async fromUVRenderer(e,t,s){const r=e.fieldDelimiter,a=[e.field];e.field2&&a.push(e.field2),e.field3&&a.push(e.field3);const n=await i(e.backgroundFillSymbol,s),l=new h(a,r,e.fieldIndex);await Promise.all(e.map.map((async e=>{const r=await i(e.symbol,s),a=await t.createTemplateGroup(r,n);\"<Null>\"===e.value?l.setNullResult(a):l.add(e.value,a)})));const o=await i(e.defaultSymbol,s);if(o){const e=await t.createTemplateGroup(o,n);l.setDefault(e)}return l}setNullResult(e){this._nullResult=e}add(e,t){this._resultsMap.set(e.toString(),t)}size(){return super.size()+this._resultsMap.size}match(e,t,s,r,i){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||\"\"===a||\"<Null>\"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();const n=a.toString();return this._resultsMap.has(n)?this._resultsMap.get(n):this.getDefault()}_getValueFromFields(e){const t=[];for(const s of this._fields){const r=e.readAttribute(s);null==r||\"\"===r?t.push(\"<Null>\"):t.push(r)}return t.join(this._seperator)}}async function f(e,t){const s=e||1;if(\"number\"==typeof s)return(e,t,r)=>s;const i=await r(s,t.spatialReference,t.fields);return(e,s,r)=>n(i,e,{$view:r},t.geometryType,s)||1}class p extends c{constructor(e,t,r,i){super(),this.type=\"dictionary\",this._groupIdCache=new s(100),this._renderer=e,this._fieldMap=e.fieldMap,this._symbolFields=e.getSymbolFields(),this._templates=t,this._info=r,this._scaleFn=i}static async fromDictionaryRenderer(e,t,s){const r=(await import(\"../../../../../renderers/DictionaryRenderer.js\")).default.fromJSON(e.renderer);await r.fetchResources({spatialReference:s.spatialReference,fields:s.fields});const i=await f(r.scaleExpression,s);return new p(r,t,s,i)}async _analyzeFeature(t,s,r,n){const u=t.readLegacyFeature(),c=this._scaleFn(u,s,r),d=this._attributeHash(u)+\"-\"+c,m=this._groupIdCache.get(d);if(m)return m;const h={...r,spatialReference:this._info.spatialReference,abortOptions:n,fields:this._info.fields},f=await this._renderer.getSymbolAsync(u,h),p=l(f,this._renderer),_=i(p,this._info,n).then((t=>{if(\"expanded-cim\"!==t.type)return o.error(new e(\"mapview-bad-type\",`Found unexpected type ${t.type} in dictionary response`)),null;t.hash+=\"-\"+c;for(const e of t.layers)e.scaleFactor=c,e.templateHash+=\"-\"+c,\"text\"===e.type&&\"string\"==typeof e.text&&e.text.indexOf(\"[\")>-1&&(e.text=a(this._fieldMap,e.text,e.cim.textCase));return this._templates.createTemplateGroup(t,null)}));return this._groupIdCache.put(d,_,1),_}async analyze(e,t,s,r,i){const a=t.getCursor(),n=[];for(;a.next();)n.push(this._analyzeFeature(a,s,r,i));return Promise.all(n)}match(e,t,s,r,i){return null}_attributeHash(e){let t=\"\";for(const s of this._symbolFields){const r=this._fieldMap[s];r&&(t+=e.attributes[r]+\"-\")}return t}}export{p as DictionaryMatcher,c as FeatureMatcher,m as IntervalMatcher,h as MapMatcher,d as SubtypeMatcher,u as createMatcher};\n"]},"metadata":{},"sourceType":"module"}