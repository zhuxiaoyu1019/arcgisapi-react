{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as t, unwrapOr as s } from \"../../../../core/maybe.js\";\nimport { g as i, m as a, b as n } from \"../../../../chunks/vec3.js\";\nimport { c as r } from \"../../../../chunks/vec3f64.js\";\nimport { create as o, setMin as c, setMax as h, isPoint as g, empty as d, center as l, offset as u } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { g as b } from \"../../../../chunks/sphere.js\";\nimport { setContextFeature as O } from \"./featureExpressionInfoUtils.js\";\nimport { demResolutionForBoundingBox as j } from \"./graphicUtils.js\";\n\nclass m {\n  constructor(e, t, s, i, a, n, r, o = null) {\n    this.graphics3DSymbolLayer = e, this.stageObject = t, this._uniqueGeometries = s, this._uniqueMaterials = i, this._uniqueTextures = a, this.elevationAligner = n, this.elevationContext = r, this._edgeState = o, this.type = \"object3d\", this.stageLayer = null, this.stage = null, this._visible = !1, this._addedToStage = !1, this.alignedSampledElevation = 0, this.needsElevationUpdates = !1, this.useObjectOriginAsAttachmentOrigin = !1, this.graphics3DSymbolLayer = e, this.stageObject = t;\n  }\n\n  get isElevationSource() {\n    return !(!this.stageObject.metadata || !this.stageObject.metadata.isElevationSource);\n  }\n\n  initialize(e, t) {\n    this.stageLayer = t, this.stage = e, e.addMany(this._uniqueMaterials), e.addMany(this._uniqueGeometries), e.addMany(this._uniqueTextures), e.add(this.stageObject);\n  }\n\n  destroy() {\n    const e = this.stage;\n    this.stageLayer && (e.removeMany(this._uniqueMaterials), e.removeMany(this._uniqueGeometries), e.removeMany(this._uniqueTextures)), e.remove(this.stageObject), this._addedToStage && (this.stageLayer.remove(this.stageObject), this._addedToStage = !1);\n    const t = this.stage.renderView.ensureEdgeView();\n    t.hasObject(this.stageObject) && t.removeObject(this.stageObject), this.stageObject.dispose(), this._visible = !1, this.stageLayer = null, this.stage = null;\n  }\n\n  layerOpacityChanged(t, s) {\n    if (e(this._edgeState)) return;\n    const i = p(this._edgeState.baseMaterial);\n    let a = !1;\n\n    for (const e of this._edgeState.edgeMaterials) e.objectTransparency !== i && (e.objectTransparency = i, a = !0);\n\n    a && this.resetEdgeObject(s);\n    this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject, [t]);\n  }\n\n  slicePlaneEnabledChanged(t, s) {\n    if (e(this._edgeState)) return;\n    this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject, this._edgeState.edgeMaterials, {\n      slicePlaneEnabled: t\n    }, !s), this._edgeState.properties.slicePlaneEnabled = t;\n  }\n\n  setVisibility(e) {\n    if (null != this.stage && this._visible !== e && (this._visible = e, this._visible ? this._addedToStage ? this.stageObject.setVisible(!0) : (this.stageLayer.add(this.stageObject), this._addedToStage = !0) : this.stageObject.setVisible(!1), t(this._edgeState))) {\n      const t = this.stage.renderView.ensureEdgeView();\n      t.hasObject(this.stageObject) ? t.updateObjectVisibility(this.stageObject, e) : e && this.addOrUpdateEdgeObject(t, !1);\n    }\n  }\n\n  get visible() {\n    return this._visible;\n  }\n\n  alignWithElevation(e, s, i, a) {\n    if (null == this.elevationAligner) return;\n    t(i) && O(this.elevationContext.featureExpressionInfoContext, i);\n    const n = this.elevationAligner(this, this.elevationContext, e, s);\n    null != n && (this.alignedSampledElevation = n), this.resetEdgeObject(a);\n  }\n\n  getCenterObjectSpace(e = r()) {\n    return i(e, b(this.stageObject.boundingVolumeObjectSpace.bounds));\n  }\n\n  getBoundingBoxObjectSpace(e = o()) {\n    const t = this.stageObject.boundingVolumeObjectSpace;\n    return c(e, t.min), h(e, t.max), e;\n  }\n\n  computeAttachmentOrigin(e) {\n    if (this.useObjectOriginAsAttachmentOrigin) {\n      const t = this.stageObject.transformation;\n      e.render.origin[0] += t[12], e.render.origin[1] += t[13], e.render.origin[2] += t[14], e.render.num++;\n    } else for (const t of this.stageObject.geometryRecords) t.computeAttachmentOrigin(y) && (a(y, y, this.stageObject.transformation), n(e.render.origin, e.render.origin, y), e.render.num++);\n  }\n\n  async getProjectedBoundingBox(e, t, i, n, r) {\n    const o = this.getBoundingBoxObjectSpace(r),\n          c = S,\n          h = g(o) ? 1 : c.length;\n\n    for (let s = 0; s < h; s++) {\n      const e = c[s];\n      f[0] = o[e[0]], f[1] = o[e[1]], f[2] = o[e[2]], a(f, f, this.stageObject.transformation), v[3 * s + 0] = f[0], v[3 * s + 1] = f[1], v[3 * s + 2] = f[2];\n    }\n\n    if (!e(v, 0, h)) return null;\n    d(o);\n    let b = null;\n    this.calculateRelativeScreenBounds && (b = this.calculateRelativeScreenBounds());\n\n    for (let s = 0; s < 3 * h; s += 3) {\n      for (let e = 0; e < 3; e++) o[e] = Math.min(o[e], v[s + e]), o[e + 3] = Math.max(o[e + 3], v[s + e]);\n\n      b && i.push({\n        location: v.slice(s, s + 3),\n        screenSpaceBoundingRect: b\n      });\n    }\n\n    if (t && t.service && \"absolute-height\" !== this.elevationContext.mode) {\n      l(o, y);\n      const e = \"relative-to-scene\" === this.elevationContext.mode ? \"scene\" : \"ground\";\n      let i = 0;\n      if (t.useViewElevation) i = s(t.service.getElevation(y[0], y[1], e), 0);else try {\n        const a = j(o, t);\n        i = s(await t.service.queryElevation(y[0], y[1], n, a, e), 0);\n      } catch (O) {}\n      u(o, 0, 0, -this.alignedSampledElevation + i);\n    }\n\n    return o;\n  }\n\n  addObjectState(e, t) {\n    0 === e && t.addObject(this.stageObject, this.stageObject.highlight()), 1 === e && t.addObject(this.stageObject, this.stageObject.maskOccludee());\n  }\n\n  removeObjectState(e) {\n    e.removeObject(this.stageObject);\n  }\n\n  resetEdgeObject(t) {\n    if (e(this._edgeState)) return;\n    const s = this.stage.renderView.ensureEdgeView();\n    this._visible ? this.addOrUpdateEdgeObject(s, t) : s.removeObject(this.stageObject);\n  }\n\n  addOrUpdateEdgeObject(t, s) {\n    const i = this._edgeState;\n    if (e(i)) return;\n    const a = p(i.baseMaterial);\n\n    for (const e of i.edgeMaterials) e.objectTransparency = a;\n\n    t.addOrUpdateObject3D(this.stageObject, i.edgeMaterials, i.properties, !s).then(() => {\n      var e;\n      return null == (e = this.stageLayer) ? void 0 : e.sync();\n    });\n  }\n\n}\n\nfunction p(e) {\n  return e.isVisible ? e.params.transparent ? 1 : 2 : 0;\n}\n\nconst v = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n      f = r(),\n      y = r(),\n      S = [[0, 1, 2], [3, 1, 2], [0, 4, 2], [3, 4, 2], [0, 1, 5], [3, 1, 5], [0, 4, 5], [3, 4, 5]];\nexport default m;\nexport { m as Graphics3DObject3DGraphicLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer.js"],"names":["isNone","e","isSome","t","unwrapOr","s","g","i","m","a","b","n","c","r","create","o","setMin","setMax","h","isPoint","empty","d","center","l","offset","u","setContextFeature","O","demResolutionForBoundingBox","j","constructor","graphics3DSymbolLayer","stageObject","_uniqueGeometries","_uniqueMaterials","_uniqueTextures","elevationAligner","elevationContext","_edgeState","type","stageLayer","stage","_visible","_addedToStage","alignedSampledElevation","needsElevationUpdates","useObjectOriginAsAttachmentOrigin","isElevationSource","metadata","initialize","addMany","add","destroy","removeMany","remove","renderView","ensureEdgeView","hasObject","removeObject","dispose","layerOpacityChanged","p","baseMaterial","edgeMaterials","objectTransparency","resetEdgeObject","updateAllComponentOpacities","slicePlaneEnabledChanged","updateAllComponentMaterials","slicePlaneEnabled","properties","setVisibility","setVisible","updateObjectVisibility","addOrUpdateEdgeObject","visible","alignWithElevation","featureExpressionInfoContext","getCenterObjectSpace","boundingVolumeObjectSpace","bounds","getBoundingBoxObjectSpace","min","max","computeAttachmentOrigin","transformation","render","origin","num","geometryRecords","y","getProjectedBoundingBox","S","length","f","v","calculateRelativeScreenBounds","Math","push","location","slice","screenSpaceBoundingRect","service","mode","useViewElevation","getElevation","queryElevation","addObjectState","addObject","highlight","maskOccludee","removeObjectState","addOrUpdateObject3D","then","sync","isVisible","params","transparent","Graphics3DObject3DGraphicLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as t,unwrapOr as s}from\"../../../../core/maybe.js\";import{g as i,m as a,b as n}from\"../../../../chunks/vec3.js\";import{c as r}from\"../../../../chunks/vec3f64.js\";import{create as o,setMin as c,setMax as h,isPoint as g,empty as d,center as l,offset as u}from\"../../../../geometry/support/aaBoundingBox.js\";import{g as b}from\"../../../../chunks/sphere.js\";import{setContextFeature as O}from\"./featureExpressionInfoUtils.js\";import{demResolutionForBoundingBox as j}from\"./graphicUtils.js\";class m{constructor(e,t,s,i,a,n,r,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=s,this._uniqueMaterials=i,this._uniqueTextures=a,this.elevationAligner=n,this.elevationContext=r,this._edgeState=o,this.type=\"object3d\",this.stageLayer=null,this.stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this.stageLayer=t,this.stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.addMany(this._uniqueTextures),e.add(this.stageObject)}destroy(){const e=this.stage;this.stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.removeMany(this._uniqueTextures)),e.remove(this.stageObject),this._addedToStage&&(this.stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this.stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),this._visible=!1,this.stageLayer=null,this.stage=null}layerOpacityChanged(t,s){if(e(this._edgeState))return;const i=p(this._edgeState.baseMaterial);let a=!1;for(const e of this._edgeState.edgeMaterials)e.objectTransparency!==i&&(e.objectTransparency=i,a=!0);a&&this.resetEdgeObject(s);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,s){if(e(this._edgeState))return;this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:t},!s),this._edgeState.properties.slicePlaneEnabled=t}setVisibility(e){if(null!=this.stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),t(this._edgeState))){const t=this.stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this.addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,s,i,a){if(null==this.elevationAligner)return;t(i)&&O(this.elevationContext.featureExpressionInfoContext,i);const n=this.elevationAligner(this,this.elevationContext,e,s);null!=n&&(this.alignedSampledElevation=n),this.resetEdgeObject(a)}getCenterObjectSpace(e=r()){return i(e,b(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=o()){const t=this.stageObject.boundingVolumeObjectSpace;return c(e,t.min),h(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(y)&&(a(y,y,this.stageObject.transformation),n(e.render.origin,e.render.origin,y),e.render.num++)}async getProjectedBoundingBox(e,t,i,n,r){const o=this.getBoundingBoxObjectSpace(r),c=S,h=g(o)?1:c.length;for(let s=0;s<h;s++){const e=c[s];f[0]=o[e[0]],f[1]=o[e[1]],f[2]=o[e[2]],a(f,f,this.stageObject.transformation),v[3*s+0]=f[0],v[3*s+1]=f[1],v[3*s+2]=f[2]}if(!e(v,0,h))return null;d(o);let b=null;this.calculateRelativeScreenBounds&&(b=this.calculateRelativeScreenBounds());for(let s=0;s<3*h;s+=3){for(let e=0;e<3;e++)o[e]=Math.min(o[e],v[s+e]),o[e+3]=Math.max(o[e+3],v[s+e]);b&&i.push({location:v.slice(s,s+3),screenSpaceBoundingRect:b})}if(t&&t.service&&\"absolute-height\"!==this.elevationContext.mode){l(o,y);const e=\"relative-to-scene\"===this.elevationContext.mode?\"scene\":\"ground\";let i=0;if(t.useViewElevation)i=s(t.service.getElevation(y[0],y[1],e),0);else try{const a=j(o,t);i=s(await t.service.queryElevation(y[0],y[1],n,a,e),0)}catch(O){}u(o,0,0,-this.alignedSampledElevation+i)}return o}addObjectState(e,t){0===e&&t.addObject(this.stageObject,this.stageObject.highlight()),1===e&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(t){if(e(this._edgeState))return;const s=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(s,t):s.removeObject(this.stageObject)}addOrUpdateEdgeObject(t,s){const i=this._edgeState;if(e(i))return;const a=p(i.baseMaterial);for(const e of i.edgeMaterials)e.objectTransparency=a;t.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!s).then((()=>{var e;return null==(e=this.stageLayer)?void 0:e.sync()}))}}function p(e){return e.isVisible?e.params.transparent?1:2:0}const v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f=r(),y=r(),S=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];export default m;export{m as Graphics3DObject3DGraphicLayer};\n"]},"metadata":{},"sourceType":"module"}