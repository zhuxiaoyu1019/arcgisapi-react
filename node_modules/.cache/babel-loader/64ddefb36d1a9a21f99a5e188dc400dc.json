{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport e from \"../../../../core/Accessor.js\";\nimport { property as o } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as r } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { fromValues as n } from \"../lib/localOrigin.js\";\nimport i from \"../lib/ModelDirtySet.js\";\nimport { RenderGeometry as s } from \"../lib/RenderGeometry.js\";\nimport { assert as a, logWithBase as d } from \"../lib/Util.js\";\nimport { isWebGLLayer as c } from \"../lib/WebGLLayer.js\";\nconst l = a,\n      m = d,\n      h = 1e4,\n      p = 10;\nlet g = class extends e {\n  constructor() {\n    super(), this.dirtySet = new i({\n      model: this\n    }), this._id2origin = new Map(), this._content = new Map();\n  }\n\n  getObject(t) {\n    return this._content.get(t);\n  }\n\n  add(t) {\n    const e = t.id;\n    l(!this._content.has(e), \"Model/Stage already contains object to be added\"), this._content.set(e, t), c(t) && this.dirtySet.layerAdded(t);\n  }\n\n  remove(t) {\n    l(this._content.has(t.id), \"Model/Stage doesn't contain object to be removed\"), this._content.delete(t.id), t.unload(), c(t) && this.dirtySet.layerRemoved(t);\n  }\n\n  addMany(t) {\n    for (const e of t) l(!this._content.has(e.id), \"Model/Stage already contains object to be added\"), this._content.set(e.id, e);\n  }\n\n  removeMany(t) {\n    for (const e of t) l(this._content.has(e.id), \"Model/Stage doesn't contain object to be removed\"), this._content.delete(e.id), e.unload();\n  }\n\n  forEachOfType(t, e) {\n    this._content.forEach(o => {\n      o.type === t && e(o);\n    });\n  }\n\n  _getOrigin(t) {\n    let e = 0;\n    const o = t[3] * p / h;\n    o > 1 && (e = Math.ceil(m(o, 2)));\n    const r = 2 ** e * h,\n          i = Math.round(t[0] / r),\n          s = Math.round(t[1] / r),\n          a = Math.round(t[2] / r),\n          d = e + \"_\" + i + \"_\" + s + \"_\" + a;\n\n    let c = this._id2origin.get(d);\n\n    return null == c && (c = n(i * r, s * r, a * r, d), this._id2origin.set(d, c)), c;\n  }\n\n  getRenderGeometry(t, e) {\n    const {\n      geometry: o,\n      material: r,\n      id: n,\n      shaderTransformation: i,\n      origin: a,\n      instanceParameters: d\n    } = e,\n          c = new s(o, r, null, null, n, o.boundingInfo, i, t.castShadow);\n    return c.updateTransformation(o => t.getCombinedStaticTransformation(e, o)), c.origin = a || this._getOrigin(c.boundingSphere), c.instanceParameters = d, c;\n  }\n\n  updateRenderGeometryTransformation(t, e, o) {\n    o.updateTransformation(o => t.getCombinedStaticTransformation(e, o));\n\n    const r = this._getOrigin(o.boundingSphere);\n\n    return o.origin !== r;\n  }\n\n  getStats() {\n    const t = {},\n          e = Array.from(this._content.values());\n\n    for (let o = 0; o < 5; ++o) t[o] = e.filter(t => t.type === o).length;\n\n    return {\n      contentTypes: t,\n      dirtySet: this.dirtySet.formatDebugInfo()\n    };\n  }\n\n  get test() {\n    return {\n      content: Array.from(this._content.values())\n    };\n  }\n\n};\nt([o({\n  constructOnly: !0\n})], g.prototype, \"dirtySet\", void 0), g = t([r(\"esri.views.3d.webgl-engine.parts.Model\")], g);\nexport { g as Model };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/parts/Model.js"],"names":["_","t","e","property","o","subclass","r","fromValues","n","i","RenderGeometry","s","assert","a","logWithBase","d","isWebGLLayer","c","l","m","h","p","g","constructor","dirtySet","model","_id2origin","Map","_content","getObject","get","add","id","has","set","layerAdded","remove","delete","unload","layerRemoved","addMany","removeMany","forEachOfType","forEach","type","_getOrigin","Math","ceil","round","getRenderGeometry","geometry","material","shaderTransformation","origin","instanceParameters","boundingInfo","castShadow","updateTransformation","getCombinedStaticTransformation","boundingSphere","updateRenderGeometryTransformation","getStats","Array","from","values","filter","length","contentTypes","formatDebugInfo","test","content","constructOnly","prototype","Model"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{fromValues as n}from\"../lib/localOrigin.js\";import i from\"../lib/ModelDirtySet.js\";import{RenderGeometry as s}from\"../lib/RenderGeometry.js\";import{assert as a,logWithBase as d}from\"../lib/Util.js\";import{isWebGLLayer as c}from\"../lib/WebGLLayer.js\";const l=a,m=d,h=1e4,p=10;let g=class extends e{constructor(){super(),this.dirtySet=new i({model:this}),this._id2origin=new Map,this._content=new Map}getObject(t){return this._content.get(t)}add(t){const e=t.id;l(!this._content.has(e),\"Model/Stage already contains object to be added\"),this._content.set(e,t),c(t)&&this.dirtySet.layerAdded(t)}remove(t){l(this._content.has(t.id),\"Model/Stage doesn't contain object to be removed\"),this._content.delete(t.id),t.unload(),c(t)&&this.dirtySet.layerRemoved(t)}addMany(t){for(const e of t)l(!this._content.has(e.id),\"Model/Stage already contains object to be added\"),this._content.set(e.id,e)}removeMany(t){for(const e of t)l(this._content.has(e.id),\"Model/Stage doesn't contain object to be removed\"),this._content.delete(e.id),e.unload()}forEachOfType(t,e){this._content.forEach((o=>{o.type===t&&e(o)}))}_getOrigin(t){let e=0;const o=t[3]*p/h;o>1&&(e=Math.ceil(m(o,2)));const r=2**e*h,i=Math.round(t[0]/r),s=Math.round(t[1]/r),a=Math.round(t[2]/r),d=e+\"_\"+i+\"_\"+s+\"_\"+a;let c=this._id2origin.get(d);return null==c&&(c=n(i*r,s*r,a*r,d),this._id2origin.set(d,c)),c}getRenderGeometry(t,e){const{geometry:o,material:r,id:n,shaderTransformation:i,origin:a,instanceParameters:d}=e,c=new s(o,r,null,null,n,o.boundingInfo,i,t.castShadow);return c.updateTransformation((o=>t.getCombinedStaticTransformation(e,o))),c.origin=a||this._getOrigin(c.boundingSphere),c.instanceParameters=d,c}updateRenderGeometryTransformation(t,e,o){o.updateTransformation((o=>t.getCombinedStaticTransformation(e,o)));const r=this._getOrigin(o.boundingSphere);return o.origin!==r}getStats(){const t={},e=Array.from(this._content.values());for(let o=0;o<5;++o)t[o]=e.filter((t=>t.type===o)).length;return{contentTypes:t,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};t([o({constructOnly:!0})],g.prototype,\"dirtySet\",void 0),g=t([r(\"esri.views.3d.webgl-engine.parts.Model\")],g);export{g as Model};\n"]},"metadata":{},"sourceType":"module"}