{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"./FeatureSetIterator.js\";\nimport t from \"./IdSet.js\";\nimport { FeatureServiceDatabaseType as r, layerGeometryEsriConstants as n, IdState as s, convertSquareUnitsToCode as i, convertLinearUnitsToCode as a, esriFieldToJson as h, layerGeometryEsriRestConstants as l } from \"./shared.js\";\nimport u from \"./cache.js\";\nimport { max as c, min as o, sum as d, variance as _, stdev as p, mean as f, distinct as g, count as m } from \"./stats.js\";\nimport { create as y, resolve as b, reject as F, isPromiseLike as S } from \"../../../core/promiseUtils.js\";\nimport { WhereClause as I } from \"../../../core/sql/WhereClause.js\";\nimport { union as T, geodesicArea as P, planarArea as w, geodesicLength as x, planarLength as D } from \"../../../geometry/geometryEngineAsync.js\";\nimport k from \"../../../geometry/SpatialReference.js\";\nimport E from \"../../../layers/support/FieldsIndex.js\";\n\nclass v {\n  constructor(e) {\n    this.recentlyUsedQueries = null, this.featureSetQueryInterceptor = null, this._idstates = [], this._parent = null, this._wset = null, this._mainSetInUse = null, this._maxProcessing = 200, this._maxQuery = 500, this._totalCount = -1, this._databaseType = r.NotEvaluated, this._databaseTypeProbed = null, this.declaredRootClass = \"esri.arcade.featureset.support.FeatureSet\", this._featureCache = [], this.types = null, this.fields = null, this.geometryType = \"\", this.objectIdField = \"\", this.globalIdField = \"\", this.spatialReference = null, this.hasM = !1, this.hasZ = !1, this._transparent = !1, this.loaded = !1, this._loadPromise = null, this._fieldsIndex = null, e && e.lrucache && (this.recentlyUsedQueries = e.lrucache), e && e.interceptor && (this.featureSetQueryInterceptor = e.interceptor);\n  }\n\n  optimisePagingFeatureQueries(e) {\n    this._parent && this._parent.optimisePagingFeatureQueries(e);\n  }\n\n  _hasMemorySource() {\n    return !0;\n  }\n\n  prop(e, t) {\n    return void 0 === t ? this[e] : (void 0 !== this[e] && (this[e] = t), this);\n  }\n\n  end() {\n    return null !== this._parent && !0 === this._parent._transparent ? this._parent.end() : this._parent;\n  }\n\n  _ensureLoaded() {\n    return this.load();\n  }\n\n  load() {\n    return null === this._loadPromise && (this._loadPromise = y((e, t) => {\n      if (!0 === this._parent.loaded) return this._initialiseFeatureSet(), void e(this);\n\n      this._parent.load().then(() => {\n        try {\n          this._initialiseFeatureSet(), e(this);\n        } catch (r) {\n          t(r);\n        }\n      }, t);\n    })), this._loadPromise;\n  }\n\n  _initialiseFeatureSet() {\n    null !== this._parent ? (this.fields = this._parent.fields.slice(0), this.geometryType = this._parent.geometryType, this.objectIdField = this._parent.objectIdField, this.globalIdField = this._parent.globalIdField, this.spatialReference = this._parent.spatialReference, this.hasM = this._parent.hasM, this.hasZ = this._parent.hasZ, this.typeIdField = this._parent.typeIdField, this.types = this._parent.types) : (this.fields = [], this.typeIdField = \"\", this.objectIdField = \"\", this.globalIdField = \"\", this.spatialReference = new k({\n      wkid: 4326\n    }), this.geometryType = n.point);\n  }\n\n  getField(e, t) {\n    let r;\n    return (t = t || this.fields) && (e = e.toLowerCase(), t.some(t => (t && t.name.toLowerCase() === e && (r = t), !!r))), r;\n  }\n\n  getFieldsIndex() {\n    return null === this._fieldsIndex && (this._fieldsIndex = new E(this.fields)), this._fieldsIndex;\n  }\n\n  _maxProcessingRate() {\n    return null !== this._parent ? Math.min(this._maxProcessing, this._parent._maxProcessingRate()) : Math.min(this._maxProcessing, this._maxQueryRate());\n  }\n\n  _maxQueryRate() {\n    return null !== this._parent ? Math.max(this._maxQuery, this._parent._maxQueryRate()) : this._maxQuery;\n  }\n\n  _checkCancelled(e) {\n    if (null !== e && e.aborted) throw new Error(\"Operation has been cancelled.\");\n  }\n\n  nativeCapabilities() {\n    return this._parent.nativeCapabilities();\n  }\n\n  _canDoAggregates(e, t, r, n, s) {\n    return null === this._parent ? b(!1) : this._parent._canDoAggregates(e, t, r, n, s);\n  }\n\n  _getAggregatePagesDataSourceDefinition(e, t, r, n, s, i, a) {\n    return null === this._parent ? F(new Error(\"Should never be called\")) : this._parent._getAggregatePagesDataSourceDefinition(e, t, r, n, s, i, a);\n  }\n\n  _getAgregagtePhysicalPage(e, t, r) {\n    return null === this._parent ? F(new Error(\"Should never be called\")) : this._parent._getAgregagtePhysicalPage(e, t, r);\n  }\n\n  databaseType() {\n    if (this._databaseType === r.NotEvaluated) {\n      if (null !== u.applicationCache) {\n        const e = u.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());\n        if (null !== e) return e;\n      }\n\n      if (null !== this._databaseTypeProbed) return this._databaseTypeProbed;\n      const e = [{\n        thetype: r.SqlServer,\n        testwhere: \"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0\"\n      }, {\n        thetype: r.Oracle,\n        testwhere: \"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0\"\n      }, {\n        thetype: r.StandardisedNoInterval,\n        testwhere: \"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0\"\n      }];\n      let t = y((t, r) => {\n        this._getDatabaseTypeImpl(e, 0).then(e => {\n          this._databaseType = e, t(this._databaseType);\n        }, e => {\n          r(e);\n        });\n      });\n      return null !== u.applicationCache && (u.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(), t), t = t.catch(e => {\n        throw u.applicationCache.clearDatabaseType(this._cacheableFeatureSetSourceKey()), e;\n      })), this._databaseTypeProbed = t, this._databaseTypeProbed;\n    }\n\n    return b(this._databaseType);\n  }\n\n  _cacheableFeatureSetSourceKey() {\n    return \"MUSTBESET\";\n  }\n\n  _getDatabaseTypeImpl(e, t) {\n    return t >= e.length ? b(r.StandardisedNoInterval) : this._runDatabaseProbe(e[t].testwhere).then(r => !0 === r ? e[t].thetype : this._getDatabaseTypeImpl(e, t + 1));\n  }\n\n  _runDatabaseProbe(e) {\n    return null !== this._parent ? this._parent._runDatabaseProbe(e) : F(new Error(\"Not Implemented\"));\n  }\n\n  isTable() {\n    return this._parent.isTable();\n  }\n\n  _featureFromCache(e) {\n    if (void 0 !== this._featureCache[e]) return this._featureCache[e];\n  }\n\n  _isInFeatureSet(e) {\n    return s.Unknown;\n  }\n\n  _getSet(e) {\n    throw new Error(\"Not implemented in abstract class\");\n  }\n\n  _getFeature(e, t, r) {\n    try {\n      return this._checkCancelled(r), void 0 !== this._featureFromCache(t) ? b(this._featureFromCache(t)) : this._getFeatures(e, t, this._maxProcessingRate(), r).then(() => (this._checkCancelled(r), void 0 !== this._featureFromCache(t) ? this._featureFromCache(t) : F(new Error(\"Feature Not Found\"))));\n    } catch (n) {\n      return F(n);\n    }\n  }\n\n  _getFeatureBatch(e, r) {\n    try {\n      this._checkCancelled(r);\n\n      const n = new t([], e, !1, null),\n            s = [];\n      return this._getFeatures(n, -1, e.length, r).then(() => {\n        this._checkCancelled(r);\n\n        for (const t of e) void 0 !== this._featureFromCache(t) && s.push(this._featureFromCache(t));\n\n        return s;\n      });\n    } catch (n) {\n      return F(n);\n    }\n  }\n\n  _getFeatures(e, t, r, n) {\n    return b(\"success\");\n  }\n\n  _getFilteredSet(e, t, r, n, s) {\n    throw new Error(\"Not implemented in abstract class\");\n  }\n\n  _refineSetBlock(e, t, r) {\n    try {\n      if (!0 === this._checkIfNeedToExpandCandidatePage(e, this._maxQueryRate())) return this._expandPagedSet(e, this._maxQueryRate(), 0, 0, r).then(() => this._refineSetBlock(e, t, r));\n\n      this._checkCancelled(r);\n\n      const n = e._candidates.length;\n\n      this._refineKnowns(e, t);\n\n      let s = n - e._candidates.length;\n      return 0 === e._candidates.length || s >= t ? b(e) : this._refineIfParentKnown(e, t - s, r).then(() => {\n        if (this._checkCancelled(r), this._refineKnowns(e, t - s), s = n - e._candidates.length, s < t && e._candidates.length > 0) {\n          const n = t - s,\n                i = this._prepareFetchAndRefineSet(e._candidates);\n\n          return this._fetchAndRefineFeatures(i, i.length > n ? n : e._candidates.length, r).then(() => (this._checkCancelled(r), this._refineKnowns(e, t - s), e));\n        }\n\n        return e;\n      });\n    } catch (n) {\n      return F(n);\n    }\n  }\n\n  _fetchAndRefineFeatures(e, t, r) {\n    return null;\n  }\n\n  _prepareFetchAndRefineSet(e) {\n    const t = [];\n\n    for (let r = 0; r < e.length; r++) this._isPhysicalFeature(e[r]) && t.push(e[r]);\n\n    return t;\n  }\n\n  _isPhysicalFeature(e) {\n    return null === this._parent || this._parent._isPhysicalFeature(e);\n  }\n\n  _refineKnowns(e, t) {\n    let r = 0,\n        n = null;\n    const i = [];\n    t = this._maxQueryRate();\n\n    for (let a = 0; a < e._candidates.length && \"GETPAGES\" !== e._candidates[a]; a++) {\n      let h = !1;\n\n      const l = this._candidateIdTransform(e._candidates[a]);\n\n      l !== e._candidates[a] && (h = !0);\n\n      const u = this._isInFeatureSet(l);\n\n      if (u === s.InFeatureSet) !0 === h ? e._known.indexOf(l) < 0 && (e._known.push(l), r += 1) : (e._known.push(e._candidates[a]), r += 1), null === n ? n = {\n        start: a,\n        end: a\n      } : n.end === a - 1 ? n.end = a : (i.push(n), n = {\n        start: a,\n        end: a\n      });else if (u === s.NotInFeatureSet) null === n ? n = {\n        start: a,\n        end: a\n      } : n.end === a - 1 ? n.end = a : (i.push(n), n = {\n        start: a,\n        end: a\n      }), r += 1;else if (u === s.Unknown && (r += 1, !0 === e._ordered)) break;\n      if (r >= t) break;\n    }\n\n    null !== n && i.push(n);\n\n    for (let s = i.length - 1; s >= 0; s--) e._candidates.splice(i[s].start, i[s].end - i[s].start + 1);\n  }\n\n  _refineIfParentKnown(e, r, n) {\n    const s = new t([], [], e._ordered, null);\n    return s._candidates = e._candidates.slice(0), this._parent._refineSetBlock(s, r, n);\n  }\n\n  _candidateIdTransform(e) {\n    return this._parent._candidateIdTransform(e);\n  }\n\n  _checkIfNeedToExpandKnownPage(e, t) {\n    if (null === e.pagesDefinition) return !1;\n    let r = 0;\n\n    for (let n = e._lastFetchedIndex; n < e._known.length; n++) {\n      if (\"GETPAGES\" === e._known[n]) return !0;\n      if (void 0 === this._featureCache[e._known[n]] && (r += 1, r >= t)) break;\n    }\n\n    return !1;\n  }\n\n  _checkIfNeedToExpandCandidatePage(e, t) {\n    if (null === e.pagesDefinition) return !1;\n    let r = 0;\n\n    for (let n = 0; n < e._candidates.length; n++) {\n      if (\"GETPAGES\" === e._candidates[n]) return !0;\n      if (r += 1, r >= t) break;\n    }\n\n    return !1;\n  }\n\n  _expandPagedSet(e, t, r, n, s) {\n    return null === this._parent ? F(new Error(\"Parent Paging not implemented\")) : this._parent._expandPagedSet(e, t, r, n, s);\n  }\n\n  _expandPagedSetFeatureSet(e, t, r, n, s) {\n    return e._known.length > 0 && \"GETPAGES\" === e._known[e._known.length - 1] && (n = 1), 0 === n && e._candidates.length > 0 && \"GETPAGES\" === e._candidates[e._candidates.length - 1] && (n = 2), 0 === n ? b(\"finished\") : this._getPage(e, n, s).then(n => r + n < t ? this._expandPagedSet(e, t, r + n, 0, s) : \"success\");\n  }\n\n  _getPage(e, t, r) {\n    const n = 1 === t ? e._known : e._candidates;\n\n    if (e.pagesDefinition.internal.set.length > e.pagesDefinition.resultOffset || !0 === e.pagesDefinition.internal.fullyResolved) {\n      n.length = n.length - 1;\n      let t = 0;\n\n      for (let s = 0; s < e.pagesDefinition.resultRecordCount && !(e.pagesDefinition.resultOffset + s >= e.pagesDefinition.internal.set.length); s++) n[n.length] = e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset + s], t++;\n\n      e.pagesDefinition.resultOffset += t;\n      let r = !1;\n      return !0 === e.pagesDefinition.internal.fullyResolved && e.pagesDefinition.internal.set.length <= e.pagesDefinition.resultOffset && (r = !0), !1 === r && n.push(\"GETPAGES\"), b(t);\n    }\n\n    return this._getPhysicalPage(e, t, r).then(() => this._getPage(e, t, r));\n  }\n\n  _getPhysicalPage(e, t, r) {\n    return null;\n  }\n\n  _clonePageDefinition(e) {\n    return null === this._parent ? null : this._parent._clonePageDefinition(e);\n  }\n\n  _first(e) {\n    return this.iterator(e).next();\n  }\n\n  first(e) {\n    return this._first(e);\n  }\n\n  calculateStatistic(e, t, r, n) {\n    return this._ensureLoaded().then(() => this._stat(e, t, \"\", null, null, r, n).then(s => !1 === s.calculated ? this._manualStat(e, t, r, n).then(e => e.result) : s.result));\n  }\n\n  _manualStat(e, t, r, n) {\n    switch (e.toLowerCase()) {\n      case \"count\":\n        return m(this, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"distinct\":\n        return g(this, t, r).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"avg\":\n      case \"mean\":\n        return f(this, t, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"stdev\":\n        return p(this, t, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"variance\":\n        return _(this, t, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"sum\":\n        return d(this, t, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"min\":\n        return o(this, t, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      case \"max\":\n        return c(this, t, n).then(e => ({\n          calculated: !0,\n          result: e\n        }));\n\n      default:\n        return b({\n          calculated: !0,\n          result: 0\n        });\n    }\n  }\n\n  _stat(e, t, r, n, s, i, a) {\n    return this._parent._stat(e, t, r, n, s, i, a).then(h => !1 === h.calculated ? null === s && \"\" === r && null === n ? this._manualStat(e, t, i, a) : {\n      calculated: !1\n    } : h);\n  }\n\n  _unionAllGeomSelf(e) {\n    const t = this.iterator(this._defaultTracker(e)),\n          r = [];\n    return y((e, n) => {\n      this._unionShapeInBatches(r, t, e, n);\n    });\n  }\n\n  _unionAllGeom(e) {\n    return y((t, r) => {\n      const n = this.iterator(this._defaultTracker(e)),\n            s = [];\n\n      this._unionShapeInBatches(s, n, t, r);\n    });\n  }\n\n  _unionShapeInBatches(e, t, r, n) {\n    t.next().then(s => {\n      try {\n        null !== s && null !== s.geometry && e.push(s.geometry), e.length > 30 || null === s && e.length > 1 ? T(e).then(i => {\n          try {\n            null === s ? r(i) : (e = [i], this._unionShapeInBatches(e, t, r, n));\n          } catch (a) {\n            n(a);\n          }\n        }, n) : null === s ? 1 === e.length ? r(e[0]) : r(null) : this._unionShapeInBatches(e, t, r, n);\n      } catch (i) {\n        n(i);\n      }\n    }, n);\n  }\n\n  iterator(t) {\n    return new e(this, t);\n  }\n\n  intersection(e, t = !1) {\n    return v._featuresetFunctions.intersection.bind(this)(e, t);\n  }\n\n  difference(e, t = !1, r = !0) {\n    return v._featuresetFunctions.difference.bind(this)(e, t, r);\n  }\n\n  symmetricDifference(e, t = !1, r = !0) {\n    return v._featuresetFunctions.symmetricDifference.bind(this)(e, t, r);\n  }\n\n  morphShape(e, t, r = \"unknown\", n = null) {\n    return v._featuresetFunctions.morphShape.bind(this)(e, t, r, n);\n  }\n\n  morphShapeAndAttributes(e, t, r = \"unknown\") {\n    return v._featuresetFunctions.morphShapeAndAttributes.bind(this)(e, t, r);\n  }\n\n  union(e, t = !1) {\n    return v._featuresetFunctions.union.bind(this)(e, t);\n  }\n\n  intersects(e) {\n    return v._featuresetFunctions.intersects.bind(this)(e);\n  }\n\n  envelopeIntersects(e) {\n    return v._featuresetFunctions.envelopeIntersects.bind(this)(e);\n  }\n\n  contains(e) {\n    return v._featuresetFunctions.contains.bind(this)(e);\n  }\n\n  overlaps(e) {\n    return v._featuresetFunctions.overlaps.bind(this)(e);\n  }\n\n  relate(e, t) {\n    return v._featuresetFunctions.relate.bind(this)(e, t);\n  }\n\n  within(e) {\n    return v._featuresetFunctions.within.bind(this)(e);\n  }\n\n  touches(e) {\n    return v._featuresetFunctions.touches.bind(this)(e);\n  }\n\n  top(e) {\n    return v._featuresetFunctions.top.bind(this)(e);\n  }\n\n  crosses(e) {\n    return v._featuresetFunctions.crosses.bind(this)(e);\n  }\n\n  buffer(e, t, r, n = !0) {\n    return v._featuresetFunctions.buffer.bind(this)(e, t, r, n);\n  }\n\n  filter(e, t = null) {\n    return v._featuresetFunctions.filter.bind(this)(e, t);\n  }\n\n  orderBy(e) {\n    return v._featuresetFunctions.orderBy.bind(this)(e);\n  }\n\n  dissolve(e, t) {\n    return v._featuresetFunctions.dissolve.bind(this)(e, t);\n  }\n\n  groupby(e, t) {\n    return v._featuresetFunctions.groupby.bind(this)(e, t);\n  }\n\n  reduce(e, t = null, r) {\n    return y((n, s) => {\n      this._reduceImpl(this.iterator(this._defaultTracker(r)), e, t, 0, n, s, 0);\n    });\n  }\n\n  _reduceImpl(e, t, r, n, s, i, a) {\n    try {\n      if (++a > 1e3) return void setTimeout(() => {\n        a = 0, this._reduceImpl(e, t, r, n, s, i, a);\n      });\n      e.next().then(h => {\n        try {\n          if (null === h) s(r);else {\n            const l = t(r, h, n, this);\n            S(l) ? l.then(r => {\n              this._reduceImpl(e, t, r, n + 1, s, i, a);\n            }, i) : this._reduceImpl(e, t, l, n + 1, s, i, a);\n          }\n        } catch (l) {\n          i(l);\n        }\n      }, i);\n    } catch (h) {\n      i(h);\n    }\n  }\n\n  removeField(e) {\n    return v._featuresetFunctions.removeField.bind(this)(e);\n  }\n\n  addField(e, t, r = null) {\n    return v._featuresetFunctions.addField.bind(this)(e, t, r);\n  }\n\n  sumArea(e, t = !1, r) {\n    const n = i(e);\n    return this.reduce((e, r) => null === r.geometry ? 0 : t ? P(r.geometry, n).then(t => e + t) : w(r.geometry, n).then(t => e + t), 0, r);\n  }\n\n  sumLength(e, t = !1, r) {\n    const n = a(e);\n    return this.reduce((e, r) => null === r.geometry ? 0 : t ? x(r.geometry, n).then(t => e + t) : D(r.geometry, n).then(t => e + t), 0, r);\n  }\n\n  _substituteVars(e, t) {\n    if (null !== t) {\n      const r = {};\n\n      for (const e in t) r[e.toLowerCase()] = t[e];\n\n      e.parameters = r;\n    }\n  }\n\n  distinct(e, t = 1e3, r = null, n) {\n    return this.load().then(() => {\n      const s = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(s, r), this.calculateStatistic(\"distinct\", s, t, this._defaultTracker(n));\n    });\n  }\n\n  min(e, t = null, r) {\n    return this.load().then(() => {\n      const n = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(n, t), this.calculateStatistic(\"min\", n, -1, this._defaultTracker(r));\n    });\n  }\n\n  max(e, t = null, r) {\n    return this.load().then(() => {\n      const n = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(n, t), this.calculateStatistic(\"max\", n, -1, this._defaultTracker(r));\n    });\n  }\n\n  avg(e, t = null, r) {\n    return this.load().then(() => {\n      const n = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(n, t), this.calculateStatistic(\"avg\", n, -1, this._defaultTracker(r));\n    });\n  }\n\n  sum(e, t = null, r) {\n    return this.load().then(() => {\n      const n = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(n, t), this.calculateStatistic(\"sum\", n, -1, this._defaultTracker(r));\n    });\n  }\n\n  stdev(e, t = null, r) {\n    return this.load().then(() => {\n      const n = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(n, t), this.calculateStatistic(\"stdev\", n, -1, this._defaultTracker(r));\n    });\n  }\n\n  variance(e, t = null, r) {\n    return this.load().then(() => {\n      const n = I.create(e, this.getFieldsIndex());\n      return this._substituteVars(n, t), this.calculateStatistic(\"variance\", n, -1, this._defaultTracker(r));\n    });\n  }\n\n  count(e) {\n    return this.load().then(() => this.calculateStatistic(\"count\", I.create(\"1\", this.getFieldsIndex()), -1, this._defaultTracker(e)));\n  }\n\n  _defaultTracker(e) {\n    return e || {\n      aborted: !1\n    };\n  }\n\n  forEach(e, t) {\n    return y((r, n) => {\n      this._forEachImpl(this.iterator(this._defaultTracker(t)), e, this, r, n, 0);\n    });\n  }\n\n  _forEachImpl(e, t, r, n, s, i) {\n    try {\n      if (++i > 1e3) return void setTimeout(() => {\n        i = 0, this._forEachImpl(e, t, r, n, s, i);\n      }, 0);\n      e.next().then(a => {\n        try {\n          if (null === a) n(r);else {\n            const h = t(a);\n            null == h ? this._forEachImpl(e, t, r, n, s, i) : S(h) ? h.then(() => {\n              try {\n                this._forEachImpl(e, t, r, n, s, i);\n              } catch (a) {\n                s(a);\n              }\n            }, s) : this._forEachImpl(e, t, r, n, s, i);\n          }\n        } catch (h) {\n          s(h);\n        }\n      }, s);\n    } catch (a) {\n      s(a);\n    }\n  }\n\n  convertToJSON(e) {\n    const t = {\n      layerDefinition: {\n        geometryType: this.geometryType,\n        fields: []\n      },\n      featureSet: {\n        features: [],\n        geometryType: this.geometryType\n      }\n    };\n\n    for (let r = 0; r < this.fields.length; r++) t.layerDefinition.fields.push(h(this.fields[r]));\n\n    return this.reduce((e, r) => {\n      const n = {\n        geometry: r.geometry && r.geometry.toJSON(),\n        attributes: {}\n      };\n\n      for (const t in r.attributes) n.attributes[t] = r.attributes[t];\n\n      return t.featureSet.features.push(n), 1;\n    }, 0, e).then(() => t);\n  }\n\n  castToText() {\n    return \"object, FeatureSet\";\n  }\n\n  queryAttachments(e, t, r, n) {\n    return this._parent.queryAttachments(e, t, r, n);\n  }\n\n  serviceUrl() {\n    return this._parent.serviceUrl();\n  }\n\n  subtypes() {\n    return this.typeIdField ? {\n      subtypeField: this.typeIdField,\n      subtypes: this.types ? this.types.map(e => ({\n        name: e.name,\n        code: e.id\n      })) : []\n    } : null;\n  }\n\n  relationshipMetaData() {\n    return this._parent.relationshipMetaData();\n  }\n\n  get gdbVersion() {\n    return this._parent ? this._parent.gdbVersion : \"\";\n  }\n\n  schema() {\n    const e = [];\n\n    for (const t of this.fields) e.push(h(t));\n\n    return {\n      objectIdField: this.objectIdField,\n      globalIdField: this.globalIdField,\n      geometryType: void 0 === l[this.geometryType] ? \"\" : l[this.geometryType],\n      fields: e\n    };\n  }\n\n  convertToText(e, t) {\n    return \"schema\" === e ? this._ensureLoaded().then(() => JSON.stringify(this.schema())) : \"featureset\" === e ? this._ensureLoaded().then(() => {\n      const e = [];\n      return this.reduce((t, r) => {\n        const n = {\n          geometry: r.geometry ? r.geometry.toJSON() : null,\n          attributes: r.attributes\n        };\n        return null !== n.geometry && n.geometry.spatialReference && delete n.geometry.spatialReference, e.push(n), 1;\n      }, 0, t).then(() => {\n        const t = this.schema();\n        return t.features = e, t.spatialReference = this.spatialReference.toJSON(), JSON.stringify(t);\n      });\n    }) : b(this.castToText());\n  }\n\n  getFeatureByObjectId(e, t) {\n    return this._parent.getFeatureByObjectId(e, t);\n  }\n\n  getOwningSystemUrl() {\n    return this._parent.getOwningSystemUrl();\n  }\n\n  getIdentityUser() {\n    return this._parent.getIdentityUser();\n  }\n\n}\n\nv._featuresetFunctions = {};\nexport default v;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/arcade/featureset/support/FeatureSet.js"],"names":["e","t","FeatureServiceDatabaseType","r","layerGeometryEsriConstants","n","IdState","s","convertSquareUnitsToCode","i","convertLinearUnitsToCode","a","esriFieldToJson","h","layerGeometryEsriRestConstants","l","u","max","c","min","o","sum","d","variance","_","stdev","p","mean","f","distinct","g","count","m","create","y","resolve","b","reject","F","isPromiseLike","S","WhereClause","I","union","T","geodesicArea","P","planarArea","w","geodesicLength","x","planarLength","D","k","E","v","constructor","recentlyUsedQueries","featureSetQueryInterceptor","_idstates","_parent","_wset","_mainSetInUse","_maxProcessing","_maxQuery","_totalCount","_databaseType","NotEvaluated","_databaseTypeProbed","declaredRootClass","_featureCache","types","fields","geometryType","objectIdField","globalIdField","spatialReference","hasM","hasZ","_transparent","loaded","_loadPromise","_fieldsIndex","lrucache","interceptor","optimisePagingFeatureQueries","_hasMemorySource","prop","end","_ensureLoaded","load","_initialiseFeatureSet","then","slice","typeIdField","wkid","point","getField","toLowerCase","some","name","getFieldsIndex","_maxProcessingRate","Math","_maxQueryRate","_checkCancelled","aborted","Error","nativeCapabilities","_canDoAggregates","_getAggregatePagesDataSourceDefinition","_getAgregagtePhysicalPage","databaseType","applicationCache","getDatabaseType","_cacheableFeatureSetSourceKey","thetype","SqlServer","testwhere","Oracle","StandardisedNoInterval","_getDatabaseTypeImpl","setDatabaseType","catch","clearDatabaseType","length","_runDatabaseProbe","isTable","_featureFromCache","_isInFeatureSet","Unknown","_getSet","_getFeature","_getFeatures","_getFeatureBatch","push","_getFilteredSet","_refineSetBlock","_checkIfNeedToExpandCandidatePage","_expandPagedSet","_candidates","_refineKnowns","_refineIfParentKnown","_prepareFetchAndRefineSet","_fetchAndRefineFeatures","_isPhysicalFeature","_candidateIdTransform","InFeatureSet","_known","indexOf","start","NotInFeatureSet","_ordered","splice","_checkIfNeedToExpandKnownPage","pagesDefinition","_lastFetchedIndex","_expandPagedSetFeatureSet","_getPage","internal","set","resultOffset","fullyResolved","resultRecordCount","_getPhysicalPage","_clonePageDefinition","_first","iterator","next","first","calculateStatistic","_stat","calculated","_manualStat","result","_unionAllGeomSelf","_defaultTracker","_unionShapeInBatches","_unionAllGeom","geometry","intersection","_featuresetFunctions","bind","difference","symmetricDifference","morphShape","morphShapeAndAttributes","intersects","envelopeIntersects","contains","overlaps","relate","within","touches","top","crosses","buffer","filter","orderBy","dissolve","groupby","reduce","_reduceImpl","setTimeout","removeField","addField","sumArea","sumLength","_substituteVars","parameters","avg","forEach","_forEachImpl","convertToJSON","layerDefinition","featureSet","features","toJSON","attributes","castToText","queryAttachments","serviceUrl","subtypes","subtypeField","map","code","id","relationshipMetaData","gdbVersion","schema","convertToText","JSON","stringify","getFeatureByObjectId","getOwningSystemUrl","getIdentityUser"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./FeatureSetIterator.js\";import t from\"./IdSet.js\";import{FeatureServiceDatabaseType as r,layerGeometryEsriConstants as n,IdState as s,convertSquareUnitsToCode as i,convertLinearUnitsToCode as a,esriFieldToJson as h,layerGeometryEsriRestConstants as l}from\"./shared.js\";import u from\"./cache.js\";import{max as c,min as o,sum as d,variance as _,stdev as p,mean as f,distinct as g,count as m}from\"./stats.js\";import{create as y,resolve as b,reject as F,isPromiseLike as S}from\"../../../core/promiseUtils.js\";import{WhereClause as I}from\"../../../core/sql/WhereClause.js\";import{union as T,geodesicArea as P,planarArea as w,geodesicLength as x,planarLength as D}from\"../../../geometry/geometryEngineAsync.js\";import k from\"../../../geometry/SpatialReference.js\";import E from\"../../../layers/support/FieldsIndex.js\";class v{constructor(e){this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=r.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass=\"esri.arcade.featureset.support.FeatureSet\",this._featureCache=[],this.types=null,this.fields=null,this.geometryType=\"\",this.objectIdField=\"\",this.globalIdField=\"\",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache),e&&e.interceptor&&(this.featureSetQueryInterceptor=e.interceptor)}optimisePagingFeatureQueries(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}_hasMemorySource(){return!0}prop(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}end(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}_ensureLoaded(){return this.load()}load(){return null===this._loadPromise&&(this._loadPromise=y(((e,t)=>{if(!0===this._parent.loaded)return this._initialiseFeatureSet(),void e(this);this._parent.load().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(r){t(r)}}),t)}))),this._loadPromise}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField=\"\",this.objectIdField=\"\",this.globalIdField=\"\",this.spatialReference=new k({wkid:4326}),this.geometryType=n.point)}getField(e,t){let r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((t=>(t&&t.name.toLowerCase()===e&&(r=t),!!r)))),r}getFieldsIndex(){return null===this._fieldsIndex&&(this._fieldsIndex=new E(this.fields)),this._fieldsIndex}_maxProcessingRate(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}_maxQueryRate(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}_checkCancelled(e){if(null!==e&&e.aborted)throw new Error(\"Operation has been cancelled.\")}nativeCapabilities(){return this._parent.nativeCapabilities()}_canDoAggregates(e,t,r,n,s){return null===this._parent?b(!1):this._parent._canDoAggregates(e,t,r,n,s)}_getAggregatePagesDataSourceDefinition(e,t,r,n,s,i,a){return null===this._parent?F(new Error(\"Should never be called\")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,s,i,a)}_getAgregagtePhysicalPage(e,t,r){return null===this._parent?F(new Error(\"Should never be called\")):this._parent._getAgregagtePhysicalPage(e,t,r)}databaseType(){if(this._databaseType===r.NotEvaluated){if(null!==u.applicationCache){const e=u.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==e)return e}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;const e=[{thetype:r.SqlServer,testwhere:\"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0\"},{thetype:r.Oracle,testwhere:\"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0\"},{thetype:r.StandardisedNoInterval,testwhere:\"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0\"}];let t=y(((t,r)=>{this._getDatabaseTypeImpl(e,0).then((e=>{this._databaseType=e,t(this._databaseType)}),(e=>{r(e)}))}));return null!==u.applicationCache&&(u.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),t),t=t.catch((e=>{throw u.applicationCache.clearDatabaseType(this._cacheableFeatureSetSourceKey()),e}))),this._databaseTypeProbed=t,this._databaseTypeProbed}return b(this._databaseType)}_cacheableFeatureSetSourceKey(){return\"MUSTBESET\"}_getDatabaseTypeImpl(e,t){return t>=e.length?b(r.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((r=>!0===r?e[t].thetype:this._getDatabaseTypeImpl(e,t+1)))}_runDatabaseProbe(e){return null!==this._parent?this._parent._runDatabaseProbe(e):F(new Error(\"Not Implemented\"))}isTable(){return this._parent.isTable()}_featureFromCache(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}_isInFeatureSet(e){return s.Unknown}_getSet(e){throw new Error(\"Not implemented in abstract class\")}_getFeature(e,t,r){try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?b(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then((()=>(this._checkCancelled(r),void 0!==this._featureFromCache(t)?this._featureFromCache(t):F(new Error(\"Feature Not Found\")))))}catch(n){return F(n)}}_getFeatureBatch(e,r){try{this._checkCancelled(r);const n=new t([],e,!1,null),s=[];return this._getFeatures(n,-1,e.length,r).then((()=>{this._checkCancelled(r);for(const t of e)void 0!==this._featureFromCache(t)&&s.push(this._featureFromCache(t));return s}))}catch(n){return F(n)}}_getFeatures(e,t,r,n){return b(\"success\")}_getFilteredSet(e,t,r,n,s){throw new Error(\"Not implemented in abstract class\")}_refineSetBlock(e,t,r){try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then((()=>this._refineSetBlock(e,t,r)));this._checkCancelled(r);const n=e._candidates.length;this._refineKnowns(e,t);let s=n-e._candidates.length;return 0===e._candidates.length||s>=t?b(e):this._refineIfParentKnown(e,t-s,r).then((()=>{if(this._checkCancelled(r),this._refineKnowns(e,t-s),s=n-e._candidates.length,s<t&&e._candidates.length>0){const n=t-s,i=this._prepareFetchAndRefineSet(e._candidates);return this._fetchAndRefineFeatures(i,i.length>n?n:e._candidates.length,r).then((()=>(this._checkCancelled(r),this._refineKnowns(e,t-s),e)))}return e}))}catch(n){return F(n)}}_fetchAndRefineFeatures(e,t,r){return null}_prepareFetchAndRefineSet(e){const t=[];for(let r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}_isPhysicalFeature(e){return null===this._parent||this._parent._isPhysicalFeature(e)}_refineKnowns(e,t){let r=0,n=null;const i=[];t=this._maxQueryRate();for(let a=0;a<e._candidates.length&&\"GETPAGES\"!==e._candidates[a];a++){let h=!1;const l=this._candidateIdTransform(e._candidates[a]);l!==e._candidates[a]&&(h=!0);const u=this._isInFeatureSet(l);if(u===s.InFeatureSet)!0===h?e._known.indexOf(l)<0&&(e._known.push(l),r+=1):(e._known.push(e._candidates[a]),r+=1),null===n?n={start:a,end:a}:n.end===a-1?n.end=a:(i.push(n),n={start:a,end:a});else if(u===s.NotInFeatureSet)null===n?n={start:a,end:a}:n.end===a-1?n.end=a:(i.push(n),n={start:a,end:a}),r+=1;else if(u===s.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&i.push(n);for(let s=i.length-1;s>=0;s--)e._candidates.splice(i[s].start,i[s].end-i[s].start+1)}_refineIfParentKnown(e,r,n){const s=new t([],[],e._ordered,null);return s._candidates=e._candidates.slice(0),this._parent._refineSetBlock(s,r,n)}_candidateIdTransform(e){return this._parent._candidateIdTransform(e)}_checkIfNeedToExpandKnownPage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let n=e._lastFetchedIndex;n<e._known.length;n++){if(\"GETPAGES\"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1,r>=t))break}return!1}_checkIfNeedToExpandCandidatePage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let n=0;n<e._candidates.length;n++){if(\"GETPAGES\"===e._candidates[n])return!0;if(r+=1,r>=t)break}return!1}_expandPagedSet(e,t,r,n,s){return null===this._parent?F(new Error(\"Parent Paging not implemented\")):this._parent._expandPagedSet(e,t,r,n,s)}_expandPagedSetFeatureSet(e,t,r,n,s){return e._known.length>0&&\"GETPAGES\"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&\"GETPAGES\"===e._candidates[e._candidates.length-1]&&(n=2),0===n?b(\"finished\"):this._getPage(e,n,s).then((n=>r+n<t?this._expandPagedSet(e,t,r+n,0,s):\"success\"))}_getPage(e,t,r){const n=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){n.length=n.length-1;let t=0;for(let s=0;s<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+s>=e.pagesDefinition.internal.set.length);s++)n[n.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+s],t++;e.pagesDefinition.resultOffset+=t;let r=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(r=!0),!1===r&&n.push(\"GETPAGES\"),b(t)}return this._getPhysicalPage(e,t,r).then((()=>this._getPage(e,t,r)))}_getPhysicalPage(e,t,r){return null}_clonePageDefinition(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}_first(e){return this.iterator(e).next()}first(e){return this._first(e)}calculateStatistic(e,t,r,n){return this._ensureLoaded().then((()=>this._stat(e,t,\"\",null,null,r,n).then((s=>!1===s.calculated?this._manualStat(e,t,r,n).then((e=>e.result)):s.result))))}_manualStat(e,t,r,n){switch(e.toLowerCase()){case\"count\":return m(this,n).then((e=>({calculated:!0,result:e})));case\"distinct\":return g(this,t,r).then((e=>({calculated:!0,result:e})));case\"avg\":case\"mean\":return f(this,t,n).then((e=>({calculated:!0,result:e})));case\"stdev\":return p(this,t,n).then((e=>({calculated:!0,result:e})));case\"variance\":return _(this,t,n).then((e=>({calculated:!0,result:e})));case\"sum\":return d(this,t,n).then((e=>({calculated:!0,result:e})));case\"min\":return o(this,t,n).then((e=>({calculated:!0,result:e})));case\"max\":return c(this,t,n).then((e=>({calculated:!0,result:e})));default:return b({calculated:!0,result:0})}}_stat(e,t,r,n,s,i,a){return this._parent._stat(e,t,r,n,s,i,a).then((h=>!1===h.calculated?null===s&&\"\"===r&&null===n?this._manualStat(e,t,i,a):{calculated:!1}:h))}_unionAllGeomSelf(e){const t=this.iterator(this._defaultTracker(e)),r=[];return y(((e,n)=>{this._unionShapeInBatches(r,t,e,n)}))}_unionAllGeom(e){return y(((t,r)=>{const n=this.iterator(this._defaultTracker(e)),s=[];this._unionShapeInBatches(s,n,t,r)}))}_unionShapeInBatches(e,t,r,n){t.next().then((s=>{try{null!==s&&null!==s.geometry&&e.push(s.geometry),e.length>30||null===s&&e.length>1?T(e).then((i=>{try{null===s?r(i):(e=[i],this._unionShapeInBatches(e,t,r,n))}catch(a){n(a)}}),n):null===s?1===e.length?r(e[0]):r(null):this._unionShapeInBatches(e,t,r,n)}catch(i){n(i)}}),n)}iterator(t){return new e(this,t)}intersection(e,t=!1){return v._featuresetFunctions.intersection.bind(this)(e,t)}difference(e,t=!1,r=!0){return v._featuresetFunctions.difference.bind(this)(e,t,r)}symmetricDifference(e,t=!1,r=!0){return v._featuresetFunctions.symmetricDifference.bind(this)(e,t,r)}morphShape(e,t,r=\"unknown\",n=null){return v._featuresetFunctions.morphShape.bind(this)(e,t,r,n)}morphShapeAndAttributes(e,t,r=\"unknown\"){return v._featuresetFunctions.morphShapeAndAttributes.bind(this)(e,t,r)}union(e,t=!1){return v._featuresetFunctions.union.bind(this)(e,t)}intersects(e){return v._featuresetFunctions.intersects.bind(this)(e)}envelopeIntersects(e){return v._featuresetFunctions.envelopeIntersects.bind(this)(e)}contains(e){return v._featuresetFunctions.contains.bind(this)(e)}overlaps(e){return v._featuresetFunctions.overlaps.bind(this)(e)}relate(e,t){return v._featuresetFunctions.relate.bind(this)(e,t)}within(e){return v._featuresetFunctions.within.bind(this)(e)}touches(e){return v._featuresetFunctions.touches.bind(this)(e)}top(e){return v._featuresetFunctions.top.bind(this)(e)}crosses(e){return v._featuresetFunctions.crosses.bind(this)(e)}buffer(e,t,r,n=!0){return v._featuresetFunctions.buffer.bind(this)(e,t,r,n)}filter(e,t=null){return v._featuresetFunctions.filter.bind(this)(e,t)}orderBy(e){return v._featuresetFunctions.orderBy.bind(this)(e)}dissolve(e,t){return v._featuresetFunctions.dissolve.bind(this)(e,t)}groupby(e,t){return v._featuresetFunctions.groupby.bind(this)(e,t)}reduce(e,t=null,r){return y(((n,s)=>{this._reduceImpl(this.iterator(this._defaultTracker(r)),e,t,0,n,s,0)}))}_reduceImpl(e,t,r,n,s,i,a){try{if(++a>1e3)return void setTimeout((()=>{a=0,this._reduceImpl(e,t,r,n,s,i,a)}));e.next().then((h=>{try{if(null===h)s(r);else{const l=t(r,h,n,this);S(l)?l.then((r=>{this._reduceImpl(e,t,r,n+1,s,i,a)}),i):this._reduceImpl(e,t,l,n+1,s,i,a)}}catch(l){i(l)}}),i)}catch(h){i(h)}}removeField(e){return v._featuresetFunctions.removeField.bind(this)(e)}addField(e,t,r=null){return v._featuresetFunctions.addField.bind(this)(e,t,r)}sumArea(e,t=!1,r){const n=i(e);return this.reduce(((e,r)=>null===r.geometry?0:t?P(r.geometry,n).then((t=>e+t)):w(r.geometry,n).then((t=>e+t))),0,r)}sumLength(e,t=!1,r){const n=a(e);return this.reduce(((e,r)=>null===r.geometry?0:t?x(r.geometry,n).then((t=>e+t)):D(r.geometry,n).then((t=>e+t))),0,r)}_substituteVars(e,t){if(null!==t){const r={};for(const e in t)r[e.toLowerCase()]=t[e];e.parameters=r}}distinct(e,t=1e3,r=null,n){return this.load().then((()=>{const s=I.create(e,this.getFieldsIndex());return this._substituteVars(s,r),this.calculateStatistic(\"distinct\",s,t,this._defaultTracker(n))}))}min(e,t=null,r){return this.load().then((()=>{const n=I.create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic(\"min\",n,-1,this._defaultTracker(r))}))}max(e,t=null,r){return this.load().then((()=>{const n=I.create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic(\"max\",n,-1,this._defaultTracker(r))}))}avg(e,t=null,r){return this.load().then((()=>{const n=I.create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic(\"avg\",n,-1,this._defaultTracker(r))}))}sum(e,t=null,r){return this.load().then((()=>{const n=I.create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic(\"sum\",n,-1,this._defaultTracker(r))}))}stdev(e,t=null,r){return this.load().then((()=>{const n=I.create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic(\"stdev\",n,-1,this._defaultTracker(r))}))}variance(e,t=null,r){return this.load().then((()=>{const n=I.create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic(\"variance\",n,-1,this._defaultTracker(r))}))}count(e){return this.load().then((()=>this.calculateStatistic(\"count\",I.create(\"1\",this.getFieldsIndex()),-1,this._defaultTracker(e))))}_defaultTracker(e){return e||{aborted:!1}}forEach(e,t){return y(((r,n)=>{this._forEachImpl(this.iterator(this._defaultTracker(t)),e,this,r,n,0)}))}_forEachImpl(e,t,r,n,s,i){try{if(++i>1e3)return void setTimeout((()=>{i=0,this._forEachImpl(e,t,r,n,s,i)}),0);e.next().then((a=>{try{if(null===a)n(r);else{const h=t(a);null==h?this._forEachImpl(e,t,r,n,s,i):S(h)?h.then((()=>{try{this._forEachImpl(e,t,r,n,s,i)}catch(a){s(a)}}),s):this._forEachImpl(e,t,r,n,s,i)}}catch(h){s(h)}}),s)}catch(a){s(a)}}convertToJSON(e){const t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}};for(let r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(h(this.fields[r]));return this.reduce(((e,r)=>{const n={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(const t in r.attributes)n.attributes[t]=r.attributes[t];return t.featureSet.features.push(n),1}),0,e).then((()=>t))}castToText(){return\"object, FeatureSet\"}queryAttachments(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)}serviceUrl(){return this._parent.serviceUrl()}subtypes(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((e=>({name:e.name,code:e.id}))):[]}:null}relationshipMetaData(){return this._parent.relationshipMetaData()}get gdbVersion(){return this._parent?this._parent.gdbVersion:\"\"}schema(){const e=[];for(const t of this.fields)e.push(h(t));return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===l[this.geometryType]?\"\":l[this.geometryType],fields:e}}convertToText(e,t){return\"schema\"===e?this._ensureLoaded().then((()=>JSON.stringify(this.schema()))):\"featureset\"===e?this._ensureLoaded().then((()=>{const e=[];return this.reduce(((t,r)=>{const n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1}),0,t).then((()=>{const t=this.schema();return t.features=e,t.spatialReference=this.spatialReference.toJSON(),JSON.stringify(t)}))})):b(this.castToText())}getFeatureByObjectId(e,t){return this._parent.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._parent.getOwningSystemUrl()}getIdentityUser(){return this._parent.getIdentityUser()}}v._featuresetFunctions={};export default v;\n"]},"metadata":{},"sourceType":"module"}