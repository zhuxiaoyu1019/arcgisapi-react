{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nclass t {\n  constructor(t = 15e3, e = 5e3) {\n    this._timer = null, this._cachedBlocks = new Map(), this._size = -1, this._duration = t, this._interval = Math.min(t, e);\n  }\n\n  decreaseRefCount(t, e) {\n    const s = t + \"/\" + e,\n          r = this._cachedBlocks;\n\n    if (r.has(s)) {\n      const t = r.get(s);\n      return t.refCount--, t.refCount <= 0 && (r.delete(s), t.controller && t.controller.abort()), t.refCount;\n    }\n\n    return 0;\n  }\n\n  getBlock(t, e) {\n    const s = t + \"/\" + e,\n          r = this._cachedBlocks;\n\n    if (r.has(s)) {\n      const t = r.get(s);\n      return t.ts = Date.now(), t.refCount++, r.delete(s), r.set(s, t), t.block;\n    }\n\n    return null;\n  }\n\n  putBlock(t, e, s, r = null) {\n    const i = this._cachedBlocks,\n          c = t + \"/\" + e;\n\n    if (i.has(c)) {\n      const t = i.get(c);\n      t.ts = Date.now(), t.refCount++;\n    } else i.set(c, {\n      block: s,\n      ts: Date.now(),\n      refCount: 1,\n      controller: r\n    });\n\n    this.trim(), this.updateTimer();\n  }\n\n  deleteBlock(t, e) {\n    const s = this._cachedBlocks,\n          r = t + \"/\" + e;\n    s.has(r) && s.delete(r);\n  }\n\n  updateMaxSize(t) {\n    this._size = t, this.trim();\n  }\n\n  empty() {\n    this._cachedBlocks.clear(), this.clearTimer();\n  }\n\n  getCurrentSize() {\n    return this._cachedBlocks.size;\n  }\n\n  updateTimer() {\n    if (null != this._timer) return;\n    const t = this._cachedBlocks;\n    this._timer = setInterval(() => {\n      const e = Array.from(t),\n            s = Date.now();\n\n      for (let r = 0; r < e.length && e[r][1].ts <= s - this._duration; r++) t.delete(e[r][0]);\n\n      0 === t.size && this.clearTimer();\n    }, this._interval);\n  }\n\n  trim() {\n    const t = this._cachedBlocks;\n    if (-1 === this._size || this._size >= t.size) return;\n    const e = Array.from(t);\n\n    for (let s = 0; s < e.length - this._size; s++) t.delete(e[s][0]);\n  }\n\n  clearTimer() {\n    null != this._timer && (clearInterval(this._timer), this._timer = null);\n  }\n\n}\n\nexport default t;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/rasterDatasets/EphemeralBlockCache.js"],"names":["t","constructor","e","_timer","_cachedBlocks","Map","_size","_duration","_interval","Math","min","decreaseRefCount","s","r","has","get","refCount","delete","controller","abort","getBlock","ts","Date","now","set","block","putBlock","i","c","trim","updateTimer","deleteBlock","updateMaxSize","empty","clear","clearTimer","getCurrentSize","size","setInterval","Array","from","length","clearInterval"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nclass t{constructor(t=15e3,e=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,e)}decreaseRefCount(t,e){const s=t+\"/\"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.refCount--,t.refCount<=0&&(r.delete(s),t.controller&&t.controller.abort()),t.refCount}return 0}getBlock(t,e){const s=t+\"/\"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.ts=Date.now(),t.refCount++,r.delete(s),r.set(s,t),t.block}return null}putBlock(t,e,s,r=null){const i=this._cachedBlocks,c=t+\"/\"+e;if(i.has(c)){const t=i.get(c);t.ts=Date.now(),t.refCount++}else i.set(c,{block:s,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}deleteBlock(t,e){const s=this._cachedBlocks,r=t+\"/\"+e;s.has(r)&&s.delete(r)}updateMaxSize(t){this._size=t,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null!=this._timer)return;const t=this._cachedBlocks;this._timer=setInterval((()=>{const e=Array.from(t),s=Date.now();for(let r=0;r<e.length&&e[r][1].ts<=s-this._duration;r++)t.delete(e[r][0]);0===t.size&&this.clearTimer()}),this._interval)}trim(){const t=this._cachedBlocks;if(-1===this._size||this._size>=t.size)return;const e=Array.from(t);for(let s=0;s<e.length-this._size;s++)t.delete(e[s][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}export default t;\n"]},"metadata":{},"sourceType":"module"}