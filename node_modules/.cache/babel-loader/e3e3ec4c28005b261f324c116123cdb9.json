{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport e from \"../../../core/Accessor.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport r from \"../../../popup/FieldInfo.js\";\nimport a from \"../../../popup/content/support/ChartMediaInfoValueSeries.js\";\nimport { substituteFieldsInLinksAndAttributes as s, fixTokens as l, substituteAttributes as n, getFixedFieldNames as d, getFixedFieldName as p, isRelatedField as u, formatValueToFieldInfo as f, getFieldInfo as m, getFieldInfoLabel as c } from \"../support/featureUtils.js\";\nimport { getRelatedFieldInfo as h } from \"../support/relatedFeatureUtils.js\";\nlet y = class extends e {\n  constructor(t) {\n    super(t), this.activeMediaInfoIndex = 0, this.attributes = null, this.description = null, this.fieldInfoMap = null, this.formattedAttributes = null, this.expressionAttributes = null, this.layer = null, this.mediaInfos = null, this.popupTemplate = null, this.relatedInfos = null, this.title = null;\n  }\n\n  get activeMediaInfo() {\n    return this.formattedMediaInfos[this.activeMediaInfoIndex] || null;\n  }\n\n  get formattedMediaInfos() {\n    return this._formatMediaInfos() || [];\n  }\n\n  get formattedMediaInfoCount() {\n    return this.formattedMediaInfos.length;\n  }\n\n  setActiveMedia(t) {\n    this._setContentElementMedia(t);\n  }\n\n  next() {\n    this._pageContentElementMedia(1);\n  }\n\n  previous() {\n    this._pageContentElementMedia(-1);\n  }\n\n  _setContentElementMedia(t) {\n    const {\n      formattedMediaInfoCount: e\n    } = this,\n          o = (t + e) % e;\n    this.activeMediaInfoIndex = o;\n  }\n\n  _pageContentElementMedia(t) {\n    const {\n      activeMediaInfoIndex: e\n    } = this,\n          o = e + t;\n\n    this._setContentElementMedia(o);\n  }\n\n  _formatMediaInfos() {\n    const {\n      attributes: t,\n      mediaInfos: e,\n      formattedAttributes: o,\n      expressionAttributes: i,\n      fieldInfoMap: r,\n      layer: a\n    } = this;\n    return null == e ? void 0 : e.map(e => {\n      if (!e) return null;\n\n      if (e.title = s({\n        attributes: t,\n        fieldInfoMap: r,\n        globalAttributes: o,\n        expressionAttributes: i,\n        layer: a,\n        text: e.title\n      }), e.caption = s({\n        attributes: t,\n        fieldInfoMap: r,\n        globalAttributes: o,\n        expressionAttributes: i,\n        layer: a,\n        text: e.caption\n      }), e.altText = s({\n        attributes: t,\n        fieldInfoMap: r,\n        globalAttributes: o,\n        expressionAttributes: i,\n        layer: a,\n        text: e.altText\n      }), \"image\" === e.type) {\n        const {\n          value: t\n        } = e;\n        return this._setImageValue({\n          value: t,\n          formattedAttributes: o,\n          layer: a\n        }), e.value.sourceURL ? e : void 0;\n      }\n\n      if (\"pie-chart\" === e.type || \"line-chart\" === e.type || \"column-chart\" === e.type || \"bar-chart\" === e.type) {\n        const {\n          value: i\n        } = e;\n        return this._setChartValue({\n          value: i,\n          chartType: e.type,\n          attributes: t,\n          formattedAttributes: o,\n          layer: a\n        }), e;\n      }\n\n      return null;\n    }).filter(Boolean);\n  }\n\n  _setImageValue(t) {\n    const {\n      fieldInfoMap: e\n    } = this,\n          {\n      value: o,\n      formattedAttributes: i,\n      layer: r\n    } = t,\n          {\n      linkURL: a,\n      sourceURL: s\n    } = o;\n\n    if (s) {\n      const t = l(s, r);\n      o.sourceURL = n({\n        formattedAttributes: i,\n        template: t,\n        fieldInfoMap: e\n      });\n    }\n\n    if (a) {\n      const t = l(a, r);\n      o.linkURL = n({\n        formattedAttributes: i,\n        template: t,\n        fieldInfoMap: e\n      });\n    }\n  }\n\n  _setChartValue(t) {\n    const {\n      value: e,\n      attributes: o,\n      formattedAttributes: i,\n      chartType: r,\n      layer: a\n    } = t,\n          {\n      popupTemplate: s,\n      relatedInfos: l\n    } = this,\n          {\n      fields: n,\n      normalizeField: f\n    } = e;\n    e.fields = d(n, a), f && (e.normalizeField = p(f, a));\n    if (!n.some(t => !!(null != i[t] || u(t) && l.size))) return;\n    const m = null == s ? void 0 : s.fieldInfos;\n    n.forEach(t => {\n      if (u(t)) return void (e.series = [...e.series, ...this._getRelatedChartInfos({\n        fieldInfos: m,\n        fieldName: t,\n        formattedAttributes: i,\n        chartType: r,\n        value: e\n      })]);\n\n      const a = this._getChartOption({\n        value: e,\n        attributes: o,\n        chartType: r,\n        formattedAttributes: i,\n        fieldName: t,\n        fieldInfos: m\n      });\n\n      e.series.push(a);\n    });\n  }\n\n  _getRelatedChartInfos(t) {\n    var e;\n    const {\n      fieldInfos: o,\n      fieldName: i,\n      formattedAttributes: r,\n      chartType: a,\n      value: s\n    } = t,\n          l = [],\n          n = h(i),\n          {\n      layerId: d,\n      fieldName: p\n    } = n,\n          u = null == (e = this.relatedInfos) ? void 0 : e.get(d.toString());\n    if (!u) return l;\n    const {\n      relatedFeatures: f,\n      relation: m\n    } = u;\n    if (!m || !f) return l;\n    const {\n      cardinality: c\n    } = m;\n    f.forEach(t => {\n      const {\n        attributes: e\n      } = t;\n      e && Object.keys(e).forEach(t => {\n        t === p && l.push(this._getChartOption({\n          value: s,\n          attributes: e,\n          formattedAttributes: r,\n          fieldName: i,\n          chartType: a,\n          relatedFieldName: t,\n          fieldInfos: o\n        }));\n      });\n    });\n    return \"one-to-many\" === c || \"many-to-many\" === c ? l : [l[0]];\n  }\n\n  _getTooltip({\n    label: t,\n    value: e,\n    chartType: o\n  }) {\n    return \"pie-chart\" === o ? t : `${t}: ${e}`;\n  }\n\n  _getChartOption(t) {\n    var e;\n\n    const {\n      value: o,\n      attributes: i,\n      formattedAttributes: s,\n      fieldName: l,\n      relatedFieldName: n,\n      fieldInfos: d,\n      chartType: y\n    } = t,\n          {\n      layer: I\n    } = this,\n          {\n      normalizeField: v,\n      tooltipField: b\n    } = o,\n          M = v ? u(v) ? i[h(v).fieldName] : i[v] : null,\n          g = n && void 0 !== i[n] ? i[n] : void 0 !== i[l] ? i[l] : s[l],\n          A = void 0 === g ? null : g && M ? g / M : g,\n          _ = new a({\n      value: A\n    });\n\n    if (u(l)) {\n      const t = h(l),\n            e = h(b),\n            o = e ? e.fieldName : null,\n            r = f(A, {\n        fieldInfos: d,\n        fieldName: n,\n        layer: I,\n        preventPlacesFormatting: !!M\n      }),\n            a = t ? t.label || t.fieldName : n,\n            s = o && void 0 !== i[o] ? i[o] : a;\n      return _.tooltip = this._getTooltip({\n        label: s,\n        value: r,\n        chartType: y\n      }), _;\n    }\n\n    const x = m(d, l),\n          T = p(l, I),\n          C = b && void 0 !== s[b] ? s[b] : c(x || new r({\n      fieldName: T\n    }), null == (e = this.popupTemplate) ? void 0 : e.expressionInfos),\n          F = s[T];\n    return _.tooltip = this._getTooltip({\n      label: C,\n      value: F,\n      chartType: y\n    }), _;\n  }\n\n};\nt([o()], y.prototype, \"activeMediaInfoIndex\", void 0), t([o({\n  readOnly: !0\n})], y.prototype, \"activeMediaInfo\", null), t([o()], y.prototype, \"attributes\", void 0), t([o()], y.prototype, \"description\", void 0), t([o()], y.prototype, \"fieldInfoMap\", void 0), t([o()], y.prototype, \"formattedAttributes\", void 0), t([o()], y.prototype, \"expressionAttributes\", void 0), t([o({\n  readOnly: !0\n})], y.prototype, \"formattedMediaInfos\", null), t([o()], y.prototype, \"layer\", void 0), t([o({\n  readOnly: !0\n})], y.prototype, \"formattedMediaInfoCount\", null), t([o()], y.prototype, \"mediaInfos\", void 0), t([o()], y.prototype, \"popupTemplate\", void 0), t([o()], y.prototype, \"relatedInfos\", void 0), t([o()], y.prototype, \"title\", void 0), y = t([i(\"esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel\")], y);\nvar I = y;\nexport default I;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/widgets/Feature/FeatureMedia/FeatureMediaViewModel.js"],"names":["_","t","e","property","o","subclass","i","r","a","substituteFieldsInLinksAndAttributes","s","fixTokens","l","substituteAttributes","n","getFixedFieldNames","d","getFixedFieldName","p","isRelatedField","u","formatValueToFieldInfo","f","getFieldInfo","m","getFieldInfoLabel","c","getRelatedFieldInfo","h","y","constructor","activeMediaInfoIndex","attributes","description","fieldInfoMap","formattedAttributes","expressionAttributes","layer","mediaInfos","popupTemplate","relatedInfos","title","activeMediaInfo","formattedMediaInfos","_formatMediaInfos","formattedMediaInfoCount","length","setActiveMedia","_setContentElementMedia","next","_pageContentElementMedia","previous","map","globalAttributes","text","caption","altText","type","value","_setImageValue","sourceURL","_setChartValue","chartType","filter","Boolean","linkURL","template","fields","normalizeField","some","size","fieldInfos","forEach","series","_getRelatedChartInfos","fieldName","_getChartOption","push","layerId","get","toString","relatedFeatures","relation","cardinality","Object","keys","relatedFieldName","_getTooltip","label","I","v","tooltipField","b","M","g","A","preventPlacesFormatting","tooltip","x","T","C","expressionInfos","F","prototype","readOnly"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Accessor.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"../../../popup/FieldInfo.js\";import a from\"../../../popup/content/support/ChartMediaInfoValueSeries.js\";import{substituteFieldsInLinksAndAttributes as s,fixTokens as l,substituteAttributes as n,getFixedFieldNames as d,getFixedFieldName as p,isRelatedField as u,formatValueToFieldInfo as f,getFieldInfo as m,getFieldInfoLabel as c}from\"../support/featureUtils.js\";import{getRelatedFieldInfo as h}from\"../support/relatedFeatureUtils.js\";let y=class extends e{constructor(t){super(t),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(t){this._setContentElementMedia(t)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(t){const{formattedMediaInfoCount:e}=this,o=(t+e)%e;this.activeMediaInfoIndex=o}_pageContentElementMedia(t){const{activeMediaInfoIndex:e}=this,o=e+t;this._setContentElementMedia(o)}_formatMediaInfos(){const{attributes:t,mediaInfos:e,formattedAttributes:o,expressionAttributes:i,fieldInfoMap:r,layer:a}=this;return null==e?void 0:e.map((e=>{if(!e)return null;if(e.title=s({attributes:t,fieldInfoMap:r,globalAttributes:o,expressionAttributes:i,layer:a,text:e.title}),e.caption=s({attributes:t,fieldInfoMap:r,globalAttributes:o,expressionAttributes:i,layer:a,text:e.caption}),e.altText=s({attributes:t,fieldInfoMap:r,globalAttributes:o,expressionAttributes:i,layer:a,text:e.altText}),\"image\"===e.type){const{value:t}=e;return this._setImageValue({value:t,formattedAttributes:o,layer:a}),e.value.sourceURL?e:void 0}if(\"pie-chart\"===e.type||\"line-chart\"===e.type||\"column-chart\"===e.type||\"bar-chart\"===e.type){const{value:i}=e;return this._setChartValue({value:i,chartType:e.type,attributes:t,formattedAttributes:o,layer:a}),e}return null})).filter(Boolean)}_setImageValue(t){const{fieldInfoMap:e}=this,{value:o,formattedAttributes:i,layer:r}=t,{linkURL:a,sourceURL:s}=o;if(s){const t=l(s,r);o.sourceURL=n({formattedAttributes:i,template:t,fieldInfoMap:e})}if(a){const t=l(a,r);o.linkURL=n({formattedAttributes:i,template:t,fieldInfoMap:e})}}_setChartValue(t){const{value:e,attributes:o,formattedAttributes:i,chartType:r,layer:a}=t,{popupTemplate:s,relatedInfos:l}=this,{fields:n,normalizeField:f}=e;e.fields=d(n,a),f&&(e.normalizeField=p(f,a));if(!n.some((t=>!!(null!=i[t]||u(t)&&l.size))))return;const m=null==s?void 0:s.fieldInfos;n.forEach((t=>{if(u(t))return void(e.series=[...e.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:t,formattedAttributes:i,chartType:r,value:e})]);const a=this._getChartOption({value:e,attributes:o,chartType:r,formattedAttributes:i,fieldName:t,fieldInfos:m});e.series.push(a)}))}_getRelatedChartInfos(t){var e;const{fieldInfos:o,fieldName:i,formattedAttributes:r,chartType:a,value:s}=t,l=[],n=h(i),{layerId:d,fieldName:p}=n,u=null==(e=this.relatedInfos)?void 0:e.get(d.toString());if(!u)return l;const{relatedFeatures:f,relation:m}=u;if(!m||!f)return l;const{cardinality:c}=m;f.forEach((t=>{const{attributes:e}=t;e&&Object.keys(e).forEach((t=>{t===p&&l.push(this._getChartOption({value:s,attributes:e,formattedAttributes:r,fieldName:i,chartType:a,relatedFieldName:t,fieldInfos:o}))}))}));return\"one-to-many\"===c||\"many-to-many\"===c?l:[l[0]]}_getTooltip({label:t,value:e,chartType:o}){return\"pie-chart\"===o?t:`${t}: ${e}`}_getChartOption(t){var e;const{value:o,attributes:i,formattedAttributes:s,fieldName:l,relatedFieldName:n,fieldInfos:d,chartType:y}=t,{layer:I}=this,{normalizeField:v,tooltipField:b}=o,M=v?u(v)?i[h(v).fieldName]:i[v]:null,g=n&&void 0!==i[n]?i[n]:void 0!==i[l]?i[l]:s[l],A=void 0===g?null:g&&M?g/M:g,_=new a({value:A});if(u(l)){const t=h(l),e=h(b),o=e?e.fieldName:null,r=f(A,{fieldInfos:d,fieldName:n,layer:I,preventPlacesFormatting:!!M}),a=t?t.label||t.fieldName:n,s=o&&void 0!==i[o]?i[o]:a;return _.tooltip=this._getTooltip({label:s,value:r,chartType:y}),_}const x=m(d,l),T=p(l,I),C=b&&void 0!==s[b]?s[b]:c(x||new r({fieldName:T}),null==(e=this.popupTemplate)?void 0:e.expressionInfos),F=s[T];return _.tooltip=this._getTooltip({label:C,value:F,chartType:y}),_}};t([o()],y.prototype,\"activeMediaInfoIndex\",void 0),t([o({readOnly:!0})],y.prototype,\"activeMediaInfo\",null),t([o()],y.prototype,\"attributes\",void 0),t([o()],y.prototype,\"description\",void 0),t([o()],y.prototype,\"fieldInfoMap\",void 0),t([o()],y.prototype,\"formattedAttributes\",void 0),t([o()],y.prototype,\"expressionAttributes\",void 0),t([o({readOnly:!0})],y.prototype,\"formattedMediaInfos\",null),t([o()],y.prototype,\"layer\",void 0),t([o({readOnly:!0})],y.prototype,\"formattedMediaInfoCount\",null),t([o()],y.prototype,\"mediaInfos\",void 0),t([o()],y.prototype,\"popupTemplate\",void 0),t([o()],y.prototype,\"relatedInfos\",void 0),t([o()],y.prototype,\"title\",void 0),y=t([i(\"esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel\")],y);var I=y;export default I;\n"]},"metadata":{},"sourceType":"module"}