{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../request.js\";\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport { join as r, urlToObject as n } from \"../../../core/urlUtils.js\";\nimport { getJsonType as o } from \"../../../geometry/support/jsonUtils.js\";\nimport { normalizeCentralMeridian as i } from \"../../../geometry/support/normalizeUtils.js\";\nimport { applyFeatureSetZUnitScaling as s } from \"./queryZScale.js\";\nimport { mapParameters as l } from \"../../../tasks/operations/urlUtils.js\";\nconst u = \"Layer does not support extent calculation.\";\n\nfunction y(t, r) {\n  var n, i;\n  const s = t.geometry,\n        l = t.toJSON(),\n        u = l;\n\n  if (e(s) && (u.geometry = JSON.stringify(s), u.geometryType = o(s), u.inSR = s.spatialReference.wkid || JSON.stringify(s.spatialReference)), null != (n = l.topFilter) && n.groupByFields && (u.topFilter.groupByFields = l.topFilter.groupByFields.join(\",\")), null != (i = l.topFilter) && i.orderByFields && (u.topFilter.orderByFields = l.topFilter.orderByFields.join(\",\")), l.topFilter && (u.topFilter = JSON.stringify(u.topFilter)), l.objectIds && (u.objectIds = l.objectIds.join(\",\")), l.orderByFields && (u.orderByFields = l.orderByFields.join(\",\")), l.outFields && !(null != r && r.returnCountOnly || null != r && r.returnExtentOnly || null != r && r.returnIdsOnly) ? -1 !== l.outFields.indexOf(\"*\") ? u.outFields = \"*\" : u.outFields = l.outFields.join(\",\") : delete u.outFields, l.outSR ? u.outSR = l.outSR.wkid || JSON.stringify(l.outSR) : s && l.returnGeometry && (u.outSR = u.inSR), l.returnGeometry && delete l.returnGeometry, l.timeExtent) {\n    const t = l.timeExtent,\n          {\n      start: e,\n      end: r\n    } = t;\n    null == e && null == r || (u.time = e === r ? e : `${null == e ? \"null\" : e},${null == r ? \"null\" : r}`), delete l.timeExtent;\n  }\n\n  return u;\n}\n\nasync function m(t, e, r, n) {\n  const o = await c(t, e, \"json\", n);\n  return s(e, r, o.data), o;\n}\n\nasync function d(t, r, n) {\n  return e(r.timeExtent) && r.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      objectIds: []\n    }\n  }) : c(t, r, \"json\", n, {\n    returnIdsOnly: !0\n  });\n}\n\nasync function p(t, r, n) {\n  return e(r.timeExtent) && r.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      count: 0,\n      extent: null\n    }\n  }) : c(t, r, \"json\", n, {\n    returnExtentOnly: !0,\n    returnCountOnly: !0\n  }).then(t => {\n    const e = t.data;\n    if (e.hasOwnProperty(\"extent\")) return t;\n    if (e.features) throw new Error(u);\n    if (e.hasOwnProperty(\"count\")) throw new Error(u);\n    return t;\n  });\n}\n\nfunction a(t, r, n) {\n  return e(r.timeExtent) && r.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      count: 0\n    }\n  }) : c(t, r, \"json\", n, {\n    returnIdsOnly: !0,\n    returnCountOnly: !0\n  });\n}\n\nfunction c(o, s, u, m = {}, d = {}) {\n  const p = \"string\" == typeof o ? n(o) : o,\n        a = s.geometry ? [s.geometry] : [];\n  return m.responseType = \"pbf\" === u ? \"array-buffer\" : \"json\", i(a, null, m).then(n => {\n    const o = n && n[0];\n    e(o) && ((s = s.clone()).geometry = o);\n    const i = l({ ...p.query,\n      f: u,\n      ...d,\n      ...y(s, d)\n    });\n    return t(r(p.path, \"queryTopFeatures\"), { ...m,\n      query: { ...i,\n        ...m.query\n      }\n    });\n  });\n}\n\nexport { a as executeQueryForTopCount, p as executeQueryForTopExtents, d as executeQueryForTopIds, m as executeTopFeaturesQuery, y as queryToQueryStringParameters };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/rest/query/operations/queryTopFeatures.js"],"names":["t","isSome","e","join","r","urlToObject","n","getJsonType","o","normalizeCentralMeridian","i","applyFeatureSetZUnitScaling","s","mapParameters","l","u","y","geometry","toJSON","JSON","stringify","geometryType","inSR","spatialReference","wkid","topFilter","groupByFields","orderByFields","objectIds","outFields","returnCountOnly","returnExtentOnly","returnIdsOnly","indexOf","outSR","returnGeometry","timeExtent","start","end","time","m","c","data","d","isEmpty","Promise","resolve","p","count","extent","then","hasOwnProperty","features","Error","a","responseType","clone","query","f","path","executeQueryForTopCount","executeQueryForTopExtents","executeQueryForTopIds","executeTopFeaturesQuery","queryToQueryStringParameters"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,qBAAb;AAAmC,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,wBAAvB;AAAgD,SAAOC,IAAI,IAAIC,CAAf,EAAiBC,WAAW,IAAIC,CAAhC,QAAsC,2BAAtC;AAAkE,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,wCAA5B;AAAqE,SAAOC,wBAAwB,IAAIC,CAAnC,QAAyC,6CAAzC;AAAuF,SAAOC,2BAA2B,IAAIC,CAAtC,QAA4C,kBAA5C;AAA+D,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,uCAA9B;AAAsE,MAAMC,CAAC,GAAC,4CAAR;;AAAqD,SAASC,CAAT,CAAWhB,CAAX,EAAaI,CAAb,EAAe;AAAC,MAAIE,CAAJ,EAAMI,CAAN;AAAQ,QAAME,CAAC,GAACZ,CAAC,CAACiB,QAAV;AAAA,QAAmBH,CAAC,GAACd,CAAC,CAACkB,MAAF,EAArB;AAAA,QAAgCH,CAAC,GAACD,CAAlC;;AAAoC,MAAGZ,CAAC,CAACU,CAAD,CAAD,KAAOG,CAAC,CAACE,QAAF,GAAWE,IAAI,CAACC,SAAL,CAAeR,CAAf,CAAX,EAA6BG,CAAC,CAACM,YAAF,GAAeb,CAAC,CAACI,CAAD,CAA7C,EAAiDG,CAAC,CAACO,IAAF,GAAOV,CAAC,CAACW,gBAAF,CAAmBC,IAAnB,IAAyBL,IAAI,CAACC,SAAL,CAAeR,CAAC,CAACW,gBAAjB,CAAxF,GAA4H,SAAOjB,CAAC,GAACQ,CAAC,CAACW,SAAX,KAAuBnB,CAAC,CAACoB,aAAzB,KAAyCX,CAAC,CAACU,SAAF,CAAYC,aAAZ,GAA0BZ,CAAC,CAACW,SAAF,CAAYC,aAAZ,CAA0BvB,IAA1B,CAA+B,GAA/B,CAAnE,CAA5H,EAAoO,SAAOO,CAAC,GAACI,CAAC,CAACW,SAAX,KAAuBf,CAAC,CAACiB,aAAzB,KAAyCZ,CAAC,CAACU,SAAF,CAAYE,aAAZ,GAA0Bb,CAAC,CAACW,SAAF,CAAYE,aAAZ,CAA0BxB,IAA1B,CAA+B,GAA/B,CAAnE,CAApO,EAA4UW,CAAC,CAACW,SAAF,KAAcV,CAAC,CAACU,SAAF,GAAYN,IAAI,CAACC,SAAL,CAAeL,CAAC,CAACU,SAAjB,CAA1B,CAA5U,EAAmYX,CAAC,CAACc,SAAF,KAAcb,CAAC,CAACa,SAAF,GAAYd,CAAC,CAACc,SAAF,CAAYzB,IAAZ,CAAiB,GAAjB,CAA1B,CAAnY,EAAobW,CAAC,CAACa,aAAF,KAAkBZ,CAAC,CAACY,aAAF,GAAgBb,CAAC,CAACa,aAAF,CAAgBxB,IAAhB,CAAqB,GAArB,CAAlC,CAApb,EAAifW,CAAC,CAACe,SAAF,IAAa,EAAE,QAAMzB,CAAN,IAASA,CAAC,CAAC0B,eAAX,IAA4B,QAAM1B,CAAN,IAASA,CAAC,CAAC2B,gBAAvC,IAAyD,QAAM3B,CAAN,IAASA,CAAC,CAAC4B,aAAtE,CAAb,GAAkG,CAAC,CAAD,KAAKlB,CAAC,CAACe,SAAF,CAAYI,OAAZ,CAAoB,GAApB,CAAL,GAA8BlB,CAAC,CAACc,SAAF,GAAY,GAA1C,GAA8Cd,CAAC,CAACc,SAAF,GAAYf,CAAC,CAACe,SAAF,CAAY1B,IAAZ,CAAiB,GAAjB,CAA5J,GAAkL,OAAOY,CAAC,CAACc,SAA5qB,EAAsrBf,CAAC,CAACoB,KAAF,GAAQnB,CAAC,CAACmB,KAAF,GAAQpB,CAAC,CAACoB,KAAF,CAAQV,IAAR,IAAcL,IAAI,CAACC,SAAL,CAAeN,CAAC,CAACoB,KAAjB,CAA9B,GAAsDtB,CAAC,IAAEE,CAAC,CAACqB,cAAL,KAAsBpB,CAAC,CAACmB,KAAF,GAAQnB,CAAC,CAACO,IAAhC,CAA5uB,EAAkxBR,CAAC,CAACqB,cAAF,IAAkB,OAAOrB,CAAC,CAACqB,cAA7yB,EAA4zBrB,CAAC,CAACsB,UAAj0B,EAA40B;AAAC,UAAMpC,CAAC,GAACc,CAAC,CAACsB,UAAV;AAAA,UAAqB;AAACC,MAAAA,KAAK,EAACnC,CAAP;AAASoC,MAAAA,GAAG,EAAClC;AAAb,QAAgBJ,CAArC;AAAuC,YAAME,CAAN,IAAS,QAAME,CAAf,KAAmBW,CAAC,CAACwB,IAAF,GAAOrC,CAAC,KAAGE,CAAJ,GAAMF,CAAN,GAAS,GAAE,QAAMA,CAAN,GAAQ,MAAR,GAAeA,CAAE,IAAG,QAAME,CAAN,GAAQ,MAAR,GAAeA,CAAE,EAA1E,GAA6E,OAAOU,CAAC,CAACsB,UAAtF;AAAiG;;AAAA,SAAOrB,CAAP;AAAS;;AAAA,eAAeyB,CAAf,CAAiBxC,CAAjB,EAAmBE,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB,EAAyB;AAAC,QAAME,CAAC,GAAC,MAAMiC,CAAC,CAACzC,CAAD,EAAGE,CAAH,EAAK,MAAL,EAAYI,CAAZ,CAAf;AAA8B,SAAOM,CAAC,CAACV,CAAD,EAAGE,CAAH,EAAKI,CAAC,CAACkC,IAAP,CAAD,EAAclC,CAArB;AAAuB;;AAAA,eAAemC,CAAf,CAAiB3C,CAAjB,EAAmBI,CAAnB,EAAqBE,CAArB,EAAuB;AAAC,SAAOJ,CAAC,CAACE,CAAC,CAACgC,UAAH,CAAD,IAAiBhC,CAAC,CAACgC,UAAF,CAAaQ,OAA9B,GAAsCC,OAAO,CAACC,OAAR,CAAgB;AAACJ,IAAAA,IAAI,EAAC;AAACd,MAAAA,SAAS,EAAC;AAAX;AAAN,GAAhB,CAAtC,GAA6Ea,CAAC,CAACzC,CAAD,EAAGI,CAAH,EAAK,MAAL,EAAYE,CAAZ,EAAc;AAAC0B,IAAAA,aAAa,EAAC,CAAC;AAAhB,GAAd,CAArF;AAAuH;;AAAA,eAAee,CAAf,CAAiB/C,CAAjB,EAAmBI,CAAnB,EAAqBE,CAArB,EAAuB;AAAC,SAAOJ,CAAC,CAACE,CAAC,CAACgC,UAAH,CAAD,IAAiBhC,CAAC,CAACgC,UAAF,CAAaQ,OAA9B,GAAsCC,OAAO,CAACC,OAAR,CAAgB;AAACJ,IAAAA,IAAI,EAAC;AAACM,MAAAA,KAAK,EAAC,CAAP;AAASC,MAAAA,MAAM,EAAC;AAAhB;AAAN,GAAhB,CAAtC,GAAoFR,CAAC,CAACzC,CAAD,EAAGI,CAAH,EAAK,MAAL,EAAYE,CAAZ,EAAc;AAACyB,IAAAA,gBAAgB,EAAC,CAAC,CAAnB;AAAqBD,IAAAA,eAAe,EAAC,CAAC;AAAtC,GAAd,CAAD,CAAyDoB,IAAzD,CAA+DlD,CAAC,IAAE;AAAC,UAAME,CAAC,GAACF,CAAC,CAAC0C,IAAV;AAAe,QAAGxC,CAAC,CAACiD,cAAF,CAAiB,QAAjB,CAAH,EAA8B,OAAOnD,CAAP;AAAS,QAAGE,CAAC,CAACkD,QAAL,EAAc,MAAM,IAAIC,KAAJ,CAAUtC,CAAV,CAAN;AAAmB,QAAGb,CAAC,CAACiD,cAAF,CAAiB,OAAjB,CAAH,EAA6B,MAAM,IAAIE,KAAJ,CAAUtC,CAAV,CAAN;AAAmB,WAAOf,CAAP;AAAS,GAAnN,CAA3F;AAAiT;;AAAA,SAASsD,CAAT,CAAWtD,CAAX,EAAaI,CAAb,EAAeE,CAAf,EAAiB;AAAC,SAAOJ,CAAC,CAACE,CAAC,CAACgC,UAAH,CAAD,IAAiBhC,CAAC,CAACgC,UAAF,CAAaQ,OAA9B,GAAsCC,OAAO,CAACC,OAAR,CAAgB;AAACJ,IAAAA,IAAI,EAAC;AAACM,MAAAA,KAAK,EAAC;AAAP;AAAN,GAAhB,CAAtC,GAAwEP,CAAC,CAACzC,CAAD,EAAGI,CAAH,EAAK,MAAL,EAAYE,CAAZ,EAAc;AAAC0B,IAAAA,aAAa,EAAC,CAAC,CAAhB;AAAkBF,IAAAA,eAAe,EAAC,CAAC;AAAnC,GAAd,CAAhF;AAAqI;;AAAA,SAASW,CAAT,CAAWjC,CAAX,EAAaI,CAAb,EAAeG,CAAf,EAAiByB,CAAC,GAAC,EAAnB,EAAsBG,CAAC,GAAC,EAAxB,EAA2B;AAAC,QAAMI,CAAC,GAAC,YAAU,OAAOvC,CAAjB,GAAmBF,CAAC,CAACE,CAAD,CAApB,GAAwBA,CAAhC;AAAA,QAAkC8C,CAAC,GAAC1C,CAAC,CAACK,QAAF,GAAW,CAACL,CAAC,CAACK,QAAH,CAAX,GAAwB,EAA5D;AAA+D,SAAOuB,CAAC,CAACe,YAAF,GAAe,UAAQxC,CAAR,GAAU,cAAV,GAAyB,MAAxC,EAA+CL,CAAC,CAAC4C,CAAD,EAAG,IAAH,EAAQd,CAAR,CAAD,CAAYU,IAAZ,CAAkB5C,CAAC,IAAE;AAAC,UAAME,CAAC,GAACF,CAAC,IAAEA,CAAC,CAAC,CAAD,CAAZ;AAAgBJ,IAAAA,CAAC,CAACM,CAAD,CAAD,KAAO,CAACI,CAAC,GAACA,CAAC,CAAC4C,KAAF,EAAH,EAAcvC,QAAd,GAAuBT,CAA9B;AAAiC,UAAME,CAAC,GAACI,CAAC,CAAC,EAAC,GAAGiC,CAAC,CAACU,KAAN;AAAYC,MAAAA,CAAC,EAAC3C,CAAd;AAAgB,SAAG4B,CAAnB;AAAqB,SAAG3B,CAAC,CAACJ,CAAD,EAAG+B,CAAH;AAAzB,KAAD,CAAT;AAA2C,WAAO3C,CAAC,CAACI,CAAC,CAAC2C,CAAC,CAACY,IAAH,EAAQ,kBAAR,CAAF,EAA8B,EAAC,GAAGnB,CAAJ;AAAMiB,MAAAA,KAAK,EAAC,EAAC,GAAG/C,CAAJ;AAAM,WAAG8B,CAAC,CAACiB;AAAX;AAAZ,KAA9B,CAAR;AAAsE,GAAxL,CAAtD;AAAiP;;AAAA,SAAOH,CAAC,IAAIM,uBAAZ,EAAoCb,CAAC,IAAIc,yBAAzC,EAAmElB,CAAC,IAAImB,qBAAxE,EAA8FtB,CAAC,IAAIuB,uBAAnG,EAA2H/C,CAAC,IAAIgD,4BAAhI","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{isSome as e}from\"../../../core/maybe.js\";import{join as r,urlToObject as n}from\"../../../core/urlUtils.js\";import{getJsonType as o}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{applyFeatureSetZUnitScaling as s}from\"./queryZScale.js\";import{mapParameters as l}from\"../../../tasks/operations/urlUtils.js\";const u=\"Layer does not support extent calculation.\";function y(t,r){var n,i;const s=t.geometry,l=t.toJSON(),u=l;if(e(s)&&(u.geometry=JSON.stringify(s),u.geometryType=o(s),u.inSR=s.spatialReference.wkid||JSON.stringify(s.spatialReference)),null!=(n=l.topFilter)&&n.groupByFields&&(u.topFilter.groupByFields=l.topFilter.groupByFields.join(\",\")),null!=(i=l.topFilter)&&i.orderByFields&&(u.topFilter.orderByFields=l.topFilter.orderByFields.join(\",\")),l.topFilter&&(u.topFilter=JSON.stringify(u.topFilter)),l.objectIds&&(u.objectIds=l.objectIds.join(\",\")),l.orderByFields&&(u.orderByFields=l.orderByFields.join(\",\")),l.outFields&&!(null!=r&&r.returnCountOnly||null!=r&&r.returnExtentOnly||null!=r&&r.returnIdsOnly)?-1!==l.outFields.indexOf(\"*\")?u.outFields=\"*\":u.outFields=l.outFields.join(\",\"):delete u.outFields,l.outSR?u.outSR=l.outSR.wkid||JSON.stringify(l.outSR):s&&l.returnGeometry&&(u.outSR=u.inSR),l.returnGeometry&&delete l.returnGeometry,l.timeExtent){const t=l.timeExtent,{start:e,end:r}=t;null==e&&null==r||(u.time=e===r?e:`${null==e?\"null\":e},${null==r?\"null\":r}`),delete l.timeExtent}return u}async function m(t,e,r,n){const o=await c(t,e,\"json\",n);return s(e,r,o.data),o}async function d(t,r,n){return e(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):c(t,r,\"json\",n,{returnIdsOnly:!0})}async function p(t,r,n){return e(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):c(t,r,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}).then((t=>{const e=t.data;if(e.hasOwnProperty(\"extent\"))return t;if(e.features)throw new Error(u);if(e.hasOwnProperty(\"count\"))throw new Error(u);return t}))}function a(t,r,n){return e(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):c(t,r,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}function c(o,s,u,m={},d={}){const p=\"string\"==typeof o?n(o):o,a=s.geometry?[s.geometry]:[];return m.responseType=\"pbf\"===u?\"array-buffer\":\"json\",i(a,null,m).then((n=>{const o=n&&n[0];e(o)&&((s=s.clone()).geometry=o);const i=l({...p.query,f:u,...d,...y(s,d)});return t(r(p.path,\"queryTopFeatures\"),{...m,query:{...i,...m.query}})}))}export{a as executeQueryForTopCount,p as executeQueryForTopExtents,d as executeQueryForTopIds,m as executeTopFeaturesQuery,y as queryToQueryStringParameters};\n"]},"metadata":{},"sourceType":"module"}