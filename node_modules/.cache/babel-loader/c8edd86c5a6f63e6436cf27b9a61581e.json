{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport t from \"../../core/Logger.js\";\nimport { zoomToFeature as r, zoomToClusteredFeatures as i, browseClusteredFeatures as o, removeSelectedFeature as n } from \"./actions.js\";\n\nconst a = \"esri.widgets.Popup.PopupViewModel\",\n      s = t.getLogger(a),\n      c = function (t) {\n  const {\n    event: a,\n    view: s\n  } = t,\n        {\n    action: c\n  } = a,\n        u = s && s.popup;\n  if (!c) return Promise.reject(new e(\"trigger-action:missing-arguments\", \"Event has no action\"));\n  if (!u) return Promise.reject(new e(\"trigger-action:missing-arguments\", \"view.popup is missing\"));\n  const {\n    disabled: d,\n    id: w\n  } = c;\n  if (!w) return Promise.reject(new e(\"trigger-action:invalid-action\", \"action.id is missing\"));\n  if (d) return Promise.reject(new e(\"trigger-action:invalid-action\", \"Action is disabled\"));\n  if (w === r.id) return l(u.viewModel);\n  if (w === i.id) return g(u.viewModel);\n  if (w === o.id) return u.featureMenuOpen = !u.featureMenuOpen, u.viewModel.browseClusterEnabled = !u.viewModel.browseClusterEnabled, Promise.resolve();\n\n  if (u.viewModel.browseClusterEnabled = !1, w === n.id) {\n    u.close();\n    const {\n      selectedFeature: t\n    } = u;\n    if (!t) return Promise.reject(new e(`trigger-action:${n.id}`, \"selectedFeature is required\", {\n      selectedFeature: t\n    }));\n    const {\n      sourceLayer: r\n    } = t;\n    return r ? r.remove(t) : s.graphics.remove(t), Promise.resolve();\n  }\n\n  return Promise.resolve();\n};\n\nfunction u(e) {\n  const {\n    selectedFeature: t,\n    location: r,\n    view: i\n  } = e;\n  if (!i) return null;\n  if (\"3d\" === i.type) return t || r;\n  return e.get(\"selectedFeature.geometry\") || r;\n}\n\nfunction d(t, r) {\n  if (\"3d\" !== (null == r ? void 0 : r.type) || !t || \"esri.Graphic\" !== t.declaredClass) return !0;\n  const i = r.getViewForGraphic(t);\n\n  if (i && \"whenGraphicBounds\" in i) {\n    let r = !1;\n    return i.whenGraphicBounds(t, {\n      useViewElevation: !0\n    }).then(e => {\n      r = !e || !e.boundingBox || e.boundingBox[0] === e.boundingBox[3] && e.boundingBox[1] === e.boundingBox[4] && e.boundingBox[2] === e.boundingBox[5];\n    }).catch(() => {\n      const r = new e(\"zoom-to:invalid-graphic\", \"Could not zoom to the location of the graphic.\", {\n        graphic: t\n      });\n      s.error(r);\n    }), r;\n  }\n\n  return !0;\n}\n\nasync function l(t) {\n  const {\n    location: i,\n    selectedFeature: o,\n    view: n,\n    zoomFactor: a\n  } = t,\n        c = u(t);\n\n  if (!c) {\n    const t = new e(\"zoom-to:invalid-target-or-view\", \"Cannot zoom to location without a target and view.\", {\n      target: c,\n      view: n\n    });\n    return s.error(t), Promise.reject(t);\n  }\n\n  const l = n.scale / a,\n        g = t.get(\"selectedFeature.geometry\") || i,\n        w = g && \"point\" === g.type && d(o, n);\n  r.active = !0, r.disabled = !0, await t.view.goTo({\n    target: c,\n    scale: w ? l : void 0\n  }), r.active = !1, r.disabled = !1, t.zoomToLocation = null, w && (t.location = g);\n}\n\nasync function g(t) {\n  const {\n    selectedFeature: r,\n    view: o\n  } = t;\n\n  if (\"2d\" !== (null == o ? void 0 : o.type)) {\n    const t = new e(\"zoomToCluster:invalid-view\", \"View must be 2d MapView.\", {\n      view: o\n    });\n    throw s.error(t), t;\n  }\n\n  if (!r.isAggregate) {\n    const t = new e(\"zoomToCluster:invalid-selectedFeature\", \"Selected feature must represent an aggregate/cluster graphic.\", {\n      selectedFeature: r\n    });\n    throw s.error(t), t;\n  }\n\n  const n = r.sourceLayer,\n        a = await o.whenLayerView(n),\n        c = a.createQuery();\n  c.aggregateIds = [r.getObjectId()], i.active = !0, i.disabled = !0;\n  const {\n    extent: u\n  } = await a.queryExtent(c);\n  await o.goTo({\n    target: u\n  }), i.active = !1, i.disabled = !1;\n}\n\nasync function w(t) {\n  const {\n    selectedFeature: r,\n    view: i\n  } = t;\n\n  if (\"2d\" !== (null == i ? void 0 : i.type)) {\n    const t = new e(\"displayClusterExtent:invalid-view\", \"View must be 2d MapView.\", {\n      view: i\n    });\n    throw s.error(t), t;\n  }\n\n  if (!r.isAggregate) {\n    const t = new e(\"zoomToCluster:invalid-selectedFeature\", \"Selected feature must represent an aggregate/cluster graphic.\", {\n      selectedFeature: r\n    });\n    throw s.error(t), t;\n  }\n\n  const o = r.sourceLayer,\n        n = await i.whenLayerView(o),\n        a = n.createQuery();\n  a.aggregateIds = [r.getObjectId()];\n  const {\n    extent: c\n  } = await n.queryExtent(a);\n  t.selectedClusterBoundaryFeature.geometry = c, i.graphics.add(t.selectedClusterBoundaryFeature);\n}\n\nasync function v(t) {\n  const {\n    selectedFeature: r,\n    view: i\n  } = t;\n\n  if (\"2d\" !== (null == i ? void 0 : i.type)) {\n    const t = new e(\"browseAggregateFeatures:invalid-view\", \"View must be 2d MapView.\", {\n      view: i\n    });\n    throw s.error(t), t;\n  }\n\n  if (!r.isAggregate) {\n    const t = new e(\"browseAggregateFeatures:invalid-selectedFeature\", \"Selected feature must represent an aggregate/cluster graphic.\", {\n      selectedFeature: r\n    });\n    throw s.error(t), t;\n  }\n\n  const n = r.sourceLayer,\n        a = await i.whenLayerView(n),\n        c = a.createQuery();\n  c.aggregateIds = [r.getObjectId()], o.active = !0, o.disabled = !0;\n  const {\n    features: u\n  } = await a.queryFeatures(c);\n  o.active = !1, o.disabled = !1, i.popup.open({\n    features: [r].concat(u),\n    featureMenuOpen: !0\n  });\n}\n\nfunction p(e) {\n  e.features = e.features.filter(e => e.isAggregate);\n}\n\nexport { v as browseAggregateFeatures, w as displayClusterExtent, u as getSelectedTarget, d as isZoomScreenSize, p as removeClusteredFeaturesForBrowsing, c as triggerAction, g as zoomToClusterExtent, l as zoomToLocation };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/widgets/Popup/actionUtils.js"],"names":["e","t","zoomToFeature","r","zoomToClusteredFeatures","i","browseClusteredFeatures","o","removeSelectedFeature","n","a","s","getLogger","c","event","view","action","u","popup","Promise","reject","disabled","d","id","w","l","viewModel","g","featureMenuOpen","browseClusterEnabled","resolve","close","selectedFeature","sourceLayer","remove","graphics","location","type","get","declaredClass","getViewForGraphic","whenGraphicBounds","useViewElevation","then","boundingBox","catch","graphic","error","zoomFactor","target","scale","active","goTo","zoomToLocation","isAggregate","whenLayerView","createQuery","aggregateIds","getObjectId","extent","queryExtent","selectedClusterBoundaryFeature","geometry","add","v","features","queryFeatures","open","concat","p","filter","browseAggregateFeatures","displayClusterExtent","getSelectedTarget","isZoomScreenSize","removeClusteredFeaturesForBrowsing","triggerAction","zoomToClusterExtent"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import t from\"../../core/Logger.js\";import{zoomToFeature as r,zoomToClusteredFeatures as i,browseClusteredFeatures as o,removeSelectedFeature as n}from\"./actions.js\";const a=\"esri.widgets.Popup.PopupViewModel\",s=t.getLogger(a),c=function(t){const{event:a,view:s}=t,{action:c}=a,u=s&&s.popup;if(!c)return Promise.reject(new e(\"trigger-action:missing-arguments\",\"Event has no action\"));if(!u)return Promise.reject(new e(\"trigger-action:missing-arguments\",\"view.popup is missing\"));const{disabled:d,id:w}=c;if(!w)return Promise.reject(new e(\"trigger-action:invalid-action\",\"action.id is missing\"));if(d)return Promise.reject(new e(\"trigger-action:invalid-action\",\"Action is disabled\"));if(w===r.id)return l(u.viewModel);if(w===i.id)return g(u.viewModel);if(w===o.id)return u.featureMenuOpen=!u.featureMenuOpen,u.viewModel.browseClusterEnabled=!u.viewModel.browseClusterEnabled,Promise.resolve();if(u.viewModel.browseClusterEnabled=!1,w===n.id){u.close();const{selectedFeature:t}=u;if(!t)return Promise.reject(new e(`trigger-action:${n.id}`,\"selectedFeature is required\",{selectedFeature:t}));const{sourceLayer:r}=t;return r?r.remove(t):s.graphics.remove(t),Promise.resolve()}return Promise.resolve()};function u(e){const{selectedFeature:t,location:r,view:i}=e;if(!i)return null;if(\"3d\"===i.type)return t||r;return e.get(\"selectedFeature.geometry\")||r}function d(t,r){if(\"3d\"!==(null==r?void 0:r.type)||!t||\"esri.Graphic\"!==t.declaredClass)return!0;const i=r.getViewForGraphic(t);if(i&&\"whenGraphicBounds\"in i){let r=!1;return i.whenGraphicBounds(t,{useViewElevation:!0}).then((e=>{r=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const r=new e(\"zoom-to:invalid-graphic\",\"Could not zoom to the location of the graphic.\",{graphic:t});s.error(r)})),r}return!0}async function l(t){const{location:i,selectedFeature:o,view:n,zoomFactor:a}=t,c=u(t);if(!c){const t=new e(\"zoom-to:invalid-target-or-view\",\"Cannot zoom to location without a target and view.\",{target:c,view:n});return s.error(t),Promise.reject(t)}const l=n.scale/a,g=t.get(\"selectedFeature.geometry\")||i,w=g&&\"point\"===g.type&&d(o,n);r.active=!0,r.disabled=!0,await t.view.goTo({target:c,scale:w?l:void 0}),r.active=!1,r.disabled=!1,t.zoomToLocation=null,w&&(t.location=g)}async function g(t){const{selectedFeature:r,view:o}=t;if(\"2d\"!==(null==o?void 0:o.type)){const t=new e(\"zoomToCluster:invalid-view\",\"View must be 2d MapView.\",{view:o});throw s.error(t),t}if(!r.isAggregate){const t=new e(\"zoomToCluster:invalid-selectedFeature\",\"Selected feature must represent an aggregate/cluster graphic.\",{selectedFeature:r});throw s.error(t),t}const n=r.sourceLayer,a=await o.whenLayerView(n),c=a.createQuery();c.aggregateIds=[r.getObjectId()],i.active=!0,i.disabled=!0;const{extent:u}=await a.queryExtent(c);await o.goTo({target:u}),i.active=!1,i.disabled=!1}async function w(t){const{selectedFeature:r,view:i}=t;if(\"2d\"!==(null==i?void 0:i.type)){const t=new e(\"displayClusterExtent:invalid-view\",\"View must be 2d MapView.\",{view:i});throw s.error(t),t}if(!r.isAggregate){const t=new e(\"zoomToCluster:invalid-selectedFeature\",\"Selected feature must represent an aggregate/cluster graphic.\",{selectedFeature:r});throw s.error(t),t}const o=r.sourceLayer,n=await i.whenLayerView(o),a=n.createQuery();a.aggregateIds=[r.getObjectId()];const{extent:c}=await n.queryExtent(a);t.selectedClusterBoundaryFeature.geometry=c,i.graphics.add(t.selectedClusterBoundaryFeature)}async function v(t){const{selectedFeature:r,view:i}=t;if(\"2d\"!==(null==i?void 0:i.type)){const t=new e(\"browseAggregateFeatures:invalid-view\",\"View must be 2d MapView.\",{view:i});throw s.error(t),t}if(!r.isAggregate){const t=new e(\"browseAggregateFeatures:invalid-selectedFeature\",\"Selected feature must represent an aggregate/cluster graphic.\",{selectedFeature:r});throw s.error(t),t}const n=r.sourceLayer,a=await i.whenLayerView(n),c=a.createQuery();c.aggregateIds=[r.getObjectId()],o.active=!0,o.disabled=!0;const{features:u}=await a.queryFeatures(c);o.active=!1,o.disabled=!1,i.popup.open({features:[r].concat(u),featureMenuOpen:!0})}function p(e){e.features=e.features.filter((e=>e.isAggregate))}export{v as browseAggregateFeatures,w as displayClusterExtent,u as getSelectedTarget,d as isZoomScreenSize,p as removeClusteredFeaturesForBrowsing,c as triggerAction,g as zoomToClusterExtent,l as zoomToLocation};\n"]},"metadata":{},"sourceType":"module"}