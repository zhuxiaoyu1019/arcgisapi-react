{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Color.js\";\nimport i from \"../../../core/Accessor.js\";\nimport { isSome as r, isNone as s } from \"../../../core/maybe.js\";\nimport n from \"../../../core/ObjectPool.js\";\nimport a from \"../../../core/PooledArray.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as l } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { t as h } from \"../../../chunks/mat4.js\";\nimport { c as d, I as c } from \"../../../chunks/mat4f64.js\";\nimport { f as u, s as p, a as g, l as f, b as m, n as T, d as v } from \"../../../chunks/vec3.js\";\nimport { Z as b, c as y } from \"../../../chunks/vec3f64.js\";\nimport { c as x, s as R } from \"../../../chunks/vec4.js\";\nimport { Z as S, c as O } from \"../../../chunks/vec4f64.js\";\nimport { create as _, set as k, expandWithOffset as q } from \"../../../geometry/support/aaBoundingBox.js\";\nimport { BufferViewVec3f as P } from \"../../../geometry/support/buffer/BufferView.js\";\nimport { requestImage as C } from \"../../../support/requestImageUtils.js\";\nimport { overlayRenderOccludedFlag as D } from \"./OverlayRenderer.js\";\nimport { clearCaches as w, intersectSkirts as B } from \"./PatchGeometryFactory.js\";\nimport { PatchRenderData as U } from \"./PatchRenderData.js\";\nimport { DEFAULT_TILE_BACKGROUND as j } from \"./TerrainConst.js\";\nimport { TileRenderer as E } from \"./TileRenderer.js\";\nimport { IteratorPreorder as A, sortTiles as M, compareTiles as N, tile2str as G } from \"./tileUtils.js\";\nimport { bindSliceUniforms as I } from \"../webgl-engine/core/shaderLibrary/Slice.glsl.js\";\nimport { bindSSRUniforms as L } from \"../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl.js\";\nimport { bindProjectionMatrix as F } from \"../webgl-engine/core/shaderLibrary/util/View.glsl.js\";\nimport { createEmptyTexture as Q } from \"../webgl-engine/lib/glUtil3D.js\";\nimport { IntersectorResult as z } from \"../webgl-engine/lib/intersectorUtils.js\";\nimport { getSettings as V } from \"../webgl-engine/lib/screenSizePerspectiveUtils.js\";\nimport { TERRAIN_ID as H, getVerticalOffsetTerrain as W } from \"../webgl-engine/lib/verticalOffsetUtils.js\";\nimport { intersectAabbInvDirBefore as X, intersectTriangles as Y, bindScreenSizePerspective as Z } from \"../webgl-engine/materials/internal/MaterialUtil.js\";\nimport { TerrainTechniqueConfiguration as J, TerrainTechnique as K } from \"../webgl-engine/shaders/TerrainTechnique.js\";\n\nconst $ = 7,\n      ee = 10,\n      te = _(),\n      ie = O();\n\nclass re {\n  constructor() {\n    this.extent = O(), this.minLevel = 0, this.maxLevel = 0, this.callback = null;\n  }\n\n}\n\nlet se = class extends i {\n  constructor(e) {\n    super(e), this.type = \"Terrain\", this.isGround = !0, this.tileSize = 256, this.rctx = null, this._isTransparent = !1, this.renderDataPool = new n(U), this._patchGroups = new a({\n      allocator: e => e || {\n        root: null,\n        origin: null,\n        patches: new a()\n      },\n      deallocator: e => (e.root = null, e.origin = null, e.patches.clear(), e)\n    }), this.patchGroupsDirty = !0, this.patchGroupsMap = new Map(), this.tileIterator = new A(), this.highestVisibleLODTile = null, this.visible = !0, this._opaque = !0, this._skirtScale = 1, this._velvetOverground = !0, this.castShadows = !0, this._ssrEnabled = !1, this.emptyTex = null, this.tileRenderer = null, this.tileBackgroundInitialized = !1, this.tileBackgroundUpdating = !1, this.stencilEnabledLayerExtents = [], this.numTrianglesRendered = 0, this.numTilesRendered = 0, this.numTilesCulled = 0, this.numOriginsRendered = 0, this.clippingExtent = null, this.overlayOpacity = 1, this.needsHighlight = !1, this.renderOccludedFlags = 1, this.visibleScaleRangeQueries = new a({\n      initialSize: 10\n    }), this.visibleScaleRangeQueriesInvPtr = 0, this.visibleScaleRangeQueryQueue = new a({\n      initialSize: 30\n    }), this.visibleScaleRangeQueryPool = new n(re);\n  }\n\n  get isGlobal() {\n    return 1 === this.stage.viewingMode;\n  }\n\n  initialize() {\n    const e = [2, 7, 9];\n    this.stage.addRenderPlugin(e, this);\n  }\n\n  destroy() {\n    this.stage.removeRenderPlugin(this), w();\n  }\n\n  get updating() {\n    return !this.tileBackgroundInitialized || this.tileBackgroundUpdating;\n  }\n\n  get canRender() {\n    return this.visible && !!this.rootTiles && this.tileBackgroundInitialized && !this.renderingDisabled;\n  }\n\n  set renderingDisabled(e) {\n    this._set(\"renderingDisabled\", !!e), this.setNeedsRender();\n  }\n\n  set opaque(e) {\n    this._opaque !== e && (this._opaque = e, this.setNeedsRender());\n  }\n\n  get needsLinearDepth() {\n    return this.overlayRenderer.hasWater;\n  }\n\n  get opaque() {\n    return this._opaque && !this.shaderTechniqueConfig.slicePlaneEnabled;\n  }\n\n  set isTransparent(e) {\n    this._isTransparent !== e && (this._isTransparent = e, this.setNeedsRender());\n  }\n\n  get isTransparent() {\n    return this._isTransparent;\n  }\n\n  set skirtScale(e) {\n    e !== this._skirtScale && (this._skirtScale = e, this.setNeedsRender());\n  }\n\n  get skirtScale() {\n    return this._skirtScale;\n  }\n\n  get renderPatchBorders() {\n    return !!this.shaderTechniqueConfig.tileBorders;\n  }\n\n  set renderPatchBorders(e) {\n    this.shaderTechniqueConfig.tileBorders !== e && (this.shaderTechniqueConfig.tileBorders = e, this.setNeedsRender(), this.notifyChange(\"renderPatchBorders\"));\n  }\n\n  get cullBackFaces() {\n    return this.shaderTechniqueConfig.backfaceCullingEnabled;\n  }\n\n  set cullBackFaces(e) {\n    this.shaderTechniqueConfig.backfaceCullingEnabled !== e && (this.shaderTechniqueConfig.backfaceCullingEnabled = e, this.notifyChange(\"cullBackFaces\"), this.setNeedsRender());\n  }\n\n  set renderOrder(e) {\n    this._set(\"renderOrder\", e), this.setNeedsRender();\n  }\n\n  set velvetOverground(e) {\n    this._velvetOverground !== e && (this._velvetOverground = e, this.setNeedsRender());\n  }\n\n  get intersectionHandlerId() {\n    return H;\n  }\n\n  get slicePlane() {\n    return this.shaderTechniqueConfig.slicePlaneEnabled;\n  }\n\n  set slicePlane(e) {\n    this.shaderTechniqueConfig.slicePlaneEnabled !== e && (this.shaderTechniqueConfig.slicePlaneEnabled = e, this.setNeedsRender());\n  }\n\n  set textureFadingEnabled(e) {\n    this.shaderTechniqueConfig.textureFadingEnabled !== e && (this.shaderTechniqueConfig.textureFadingEnabled = e, this.setNeedsRender());\n  }\n\n  setDebugScreenSizePerspective(e) {\n    this.shaderTechniqueConfig.screenSizePerspective !== e && (this.shaderTechniqueConfig.screenSizePerspective = e, this.setNeedsRender());\n  }\n\n  setRootTiles(e) {\n    this.rootTiles = e, this.setNeedsRender();\n  }\n\n  setNeedsHighlight(e) {\n    this.needsHighlight = e, this.setNeedsRender();\n  }\n\n  setRenderOccludedOverlay(e) {\n    this.renderOccludedFlags = e ? D : 1, this.setNeedsRender();\n  }\n\n  setStencilEnabledLayerExtents(e) {\n    this.stencilEnabledLayerExtents = e, this.setNeedsRender();\n  }\n\n  setTileSize(e) {\n    this.tileSize = e, this.tileRenderer && (this.tileRenderer.tileSize = e), this.setNeedsRender();\n  }\n\n  loadTile(e) {\n    e.renderData || (e.renderData = this.renderDataPool.acquire(), e.renderData.init(e), e.renderData.localOrigin = this._getLocalOriginOfTile(e)), this.updateTileGeometry(e), this.updateTileTexture(e);\n  }\n\n  queryVisibleLevelRange(e, t, i, r) {\n    const s = this.visibleScaleRangeQueryPool.acquire();\n    x(s.extent, e), s.minLevel = t || -Number.MAX_VALUE, s.maxLevel = null != i ? i : Number.MAX_VALUE, s.callback = r, this.visibleScaleRangeQueryQueue.push(s), this.setNeedsRender();\n  }\n\n  updateTileTexture(e) {\n    this.tileRenderer && this.tileBackgroundInitialized && (this.tileRenderer.updateTileTexture(e), this.setNeedsRender(), e.resetPendingUpdate(64));\n  }\n\n  updateTileGeometry(e) {\n    for (const t of e.layerInfo[0]) t.pendingUpdates &= -33;\n\n    e.resetPendingUpdate(32), e.renderData.updateGeometry(this.rctx, this.wireframe) && this.setNeedsRender();\n  }\n\n  unloadTile(e) {\n    e.renderData && (e.renderData.releaseGeometry() && this.setNeedsRender(), this.renderDataPool.release(e.renderData), e.renderData.clear(), e.renderData = null, e.setMemoryDirty(), this.setNeedsRender());\n  }\n\n  _getLocalOriginOfTile(e) {\n    const t = ee - $,\n          i = Math.max(0, Math.floor((e.lij[0] - t) / $) * $);\n    if (this.isGlobal && 0 === i) return b;\n\n    for (; e.parent && e.lij[0] > i;) e = e.parent;\n\n    return e.centerAtSeaLevel;\n  }\n\n  setVisibility(e) {\n    this.visible = e, this.setNeedsRender();\n  }\n\n  getStats() {\n    return {\n      numTilesRendered: this.numTilesRendered,\n      numTilesCulled: this.numTilesCulled,\n      numTrianglesRendered: this.numTrianglesRendered,\n      numOriginsRendered: this.numOriginsRendered\n    };\n  }\n\n  set wireframe(e) {\n    this._get(\"wireframe\") !== e && (this._set(\"wireframe\", e), this.allTiles.forAll(t => {\n      var i;\n      return null == (i = t.renderData) ? void 0 : i.updateGeometry(this.rctx, e);\n    }), this.setNeedsRender());\n  }\n\n  setNeedsRender(e = 1) {\n    this.patchGroupsDirty = !0, this.context.requestRender(e);\n  }\n\n  setTileBackground(e) {\n    this.tileBackground = e, this._updateTileBackground();\n  }\n\n  initializeRenderContext(e) {\n    this.context = e, this.rctx = e.renderContext.rctx, this.shaderTechniques = e.shaderTechniqueRep, this.shaderTechniqueConfig = new J(), this.tileRenderer = new E(this.rctx, this.tileSize, this.shaderTechniques), this.tileBackground && this._updateTileBackground(), this.emptyTex = Q(this.rctx);\n  }\n\n  uninitializeRenderContext() {\n    null != this.emptyTex && (this.emptyTex.dispose(), this.emptyTex = null), this.tileRenderer && (this.tileRenderer.dispose(), this.tileRenderer = null);\n  }\n\n  intersect(e, t, i, n) {\n    if (!this.rootTiles || e.options.selectOpaqueTerrainOnly && e.options.selectionMode && !this._opaque) return;\n    const a = de,\n          o = ce;\n    u(a, n, i), p(o, 1 / a[0], 1 / a[1], 1 / a[2]);\n    const l = e.results.min,\n          h = e.results.max,\n          d = e.results.ground,\n          T = 0 === e.options.store,\n          b = !!e.results.ground.target;\n    let y;\n    const x = W(e.verticalOffset),\n          R = this.clippingExtent;\n    this.allTiles.forAll(S => {\n      if (null === S.renderData || b && this._useStencilForTile(S)) return;\n\n      if (e.options.invisibleTerrain) {\n        if (!S.visible && R && !S.intersectsExtent(R)) return;\n      } else if (!S.visible) return;\n\n      const O = S.renderData.geometryInfo;\n      k(te, O.boundingBox);\n      const _ = S.renderData.localOrigin;\n      r(x) && (x.localOrigin = _, x.applyToAabb(te));\n      const C = -this._skirtScale * O.skirtLength;\n\n      if (0 !== C) {\n        const e = S.up;\n        q(te, C * e[0], C * e[1], C * e[2]);\n      }\n\n      const D = te;\n      u(ue, i, _);\n      const w = T && null != l.dist ? l.dist : 1 / 0;\n      if (!X(D, ue, o, e.tolerance, w)) return;\n\n      const U = (e, t, i, r) => {\n        e.set(void 0, G(t), i, r, c, void 0), e.intersector = ge, e.target = {\n          type: \"external\",\n          metadata: {\n            tile: t\n          }\n        };\n      },\n            j = (r, o) => {\n        if (r >= 0 && (e.options.backfacesTerrain || v(o, a) < 0) && (e.options.invisibleTerrain || !e.options.selectionMode || null == t || t(i, n, r))) {\n          if ((null == d.dist || r < d.dist) && U(d, S, r, o), e.options.isFiltered) return;\n          2 === e.options.store && (s(y) ? (y = new z(e.ray), U(y, S, r, o), e.results.all.push(y)) : r < y.dist && U(y, S, r, o)), (null == l.dist || r < l.dist) && U(l, S, r, o), 0 !== e.options.store && (null == h.dist || r > h.dist) && U(h, S, r, o);\n        }\n      },\n            E = pe;\n\n      u(E, n, _);\n      const A = O.indices,\n            M = O.vertexAttributes,\n            N = {\n        data: M.getField(\"position\", P).typedBuffer,\n        size: 3,\n        stride: M.stride / 4\n      },\n            I = O.numWithoutSkirtIndices / 3;\n\n      if (Y(ue, E, 0, I, A, N, null, x, j), 0 !== C) {\n        const e = this.isGlobal ? e => g(e, e, C / f(m(e, e, _))) : e => p(e, 0, 0, C),\n              t = A.length / 3;\n        B(ue, E, I, t, A, M, e, x, j);\n      }\n    });\n  }\n\n  prepareRender() {\n    this.overlayOpacity < 1 && this.updateOverlayOpacity();\n  }\n\n  render(e) {\n    if (9 === e.slot) {\n      if (0 == (e.renderOccludedMask & D)) return !1;\n    } else {\n      const t = this.opaque ? 2 : 7;\n      if (e.slot !== t) return !1;\n    }\n\n    const t = e.pass,\n          i = 1 === e.scenelightingData.globalFactor,\n          r = this._updatePatchGroups();\n\n    switch (t) {\n      case 0:\n        {\n          const t = e.shadowMap && e.shadowMap.enabled;\n          this.shaderTechniqueConfig.receiveShadows !== t && (this.shaderTechniqueConfig.receiveShadows = t);\n          const i = this.overlayRenderer.isEmpty() ? 0 : this.overlayRenderer.hasWater ? 2 : 1;\n          this.shaderTechniqueConfig.overlayMode !== i && (this.shaderTechniqueConfig.overlayMode = i);\n          const s = 9 === e.slot ? 3 : 1;\n\n          this._renderMaterialPass(e, 0, r, s);\n\n          break;\n        }\n\n      case 4:\n      case 6:\n        this.castShadows && i && this._renderAuxiliaryPass(e, 3, r, 0);\n        break;\n\n      case 2:\n        this.isTransparent && this.overlayRenderer.isEmpty() || this._renderAuxiliaryPass(e, 1, r, 0);\n        break;\n\n      case 3:\n        this._renderAuxiliaryPass(e, 2, r, 0);\n\n        break;\n\n      case 5:\n        this.needsHighlight && (this._renderAuxiliaryPass(e, 4, r, 2), e.rctx.clearSafe(256));\n    }\n\n    return 0 !== this.visibleScaleRangeQueryQueue.length && this.setNeedsRender(), !0;\n  }\n\n  _renderMaterialPass(e, t, i, r) {\n    const {\n      rctx: s,\n      camera: n\n    } = e;\n    this._ssrEnabled = e.ssrParams.ssrEnabled, this._setTerrainTechnique(t, 3 === r);\n    const a = this.shaderTechnique.program;\n    s.useProgram(a), 0 !== this.shaderTechniqueConfig.overlayMode && 1 === r && e.ssrParams && L(a, e.ssrParams), e.shadowMap.bind(a), e.ssaoHelper.bind(a), this._bindOverlayData(a, r), a.setUniformMatrix4fv(\"viewNormal\", n.viewInverseTransposeMatrix), F(a, n.projectionMatrix), e.scenelightingData.setUniforms(a, !0);\n    const o = n.viewMatrix;\n    p(he, o[12], o[13], o[14]), T(he, he), a.setUniform3fv(\"viewDirection\", he), this.numTilesRendered = 0, this.numTilesCulled = 0, this.numTrianglesRendered = 0, this.numOriginsRendered = 0, this._prepareScaleRangeQueries(), this.opaque ? this._renderPatchGroups(e, a, i, r) : e.offscreenRenderingHelper.renderToTargets(() => this._renderPatchGroups(e, a, i, r), e.offscreenRenderingHelper.tmpColor, e.offscreenRenderingHelper.mainDepth, [0, 0, 0, 0]), this._processScaleRangeQueries();\n  }\n\n  _renderAuxiliaryPass(e, t, i, r) {\n    this._setTerrainTechnique(t, 3 === r);\n\n    const s = e.rctx,\n          n = this.shaderTechnique.program;\n\n    if (s.useProgram(n), 5 === e.pass) {\n      const t = e.offscreenRenderingHelper;\n      n.bindTexture(t.depthTexture, \"depthTex\"), n.setUniform4f(\"highlightViewportPixelSz\", 0, 0, 1 / t.width, 1 / t.height);\n    } else n.setUniformMatrix4fv(\"viewNormal\", e.camera.viewInverseTransposeMatrix), 2 !== e.pass && 4 !== e.pass && 6 !== e.pass || n.setUniform2fv(\"nearFar\", e.camera.nearFar);\n\n    this._renderPatchGroupsAuxiliary(e, n, i, r);\n  }\n\n  _updateTileBackground() {\n    if (!this.tileRenderer) return;\n    this.tileBackgroundUpdating = !0;\n\n    const e = () => {\n      this.tileBackgroundInitialized = !0, this.tileBackgroundUpdating = !1, this.shaderTechniqueConfig.useGrid = this.tileRenderer.backgroundIsGrid, this.shaderTechniqueConfig.hasBackgroundColor = !this.tileRenderer.backgroundIsGrid && !!r(this.tileRenderer.backgroundColor), this.allTiles.forAll(e => this.tileRenderer.updateTileTexture(e)), this.setNeedsRender();\n    };\n\n    if (\"string\" == typeof this.tileBackground) {\n      const t = this.tileBackground;\n      C(t).then(i => {\n        t === this.tileBackground && this.tileRenderer && (this.tileRenderer.setBackground(i, this.tileBackground === j), e());\n      });\n    } else {\n      const i = this.tileBackground ? t.toUnitRGBA(this.tileBackground) : [0, 0, 0, 0];\n      this.tileRenderer.setBackground(i, !1), e();\n    }\n  }\n\n  _updatePatchGroups() {\n    const e = this._patchGroups;\n    if (!this.patchGroupsDirty) return e;\n\n    if (this.highestVisibleLODTile = null, this._renderCollectOrigins(e), 0 !== this.renderOrder) {\n      for (let t = 0; t < e.length; t++) M(this.renderOrder, e.data[t].patches);\n\n      e.sort((e, t) => ae(e, t, this.renderOrder));\n    }\n\n    return this.patchGroupsDirty = !1, e;\n  }\n\n  _renderCollectOrigins(e) {\n    const t = this.rootTiles,\n          i = this.isGlobal;\n    e.clear();\n\n    for (const r of t) {\n      const t = e.pushNew();\n      t.root = r, t.origin = i ? b : r.centerAtSeaLevel, t.patches.clear(), this._renderCollectOriginsForRoot(e, t);\n    }\n\n    e.filterInPlace(e => e.patches.length > 0);\n  }\n\n  _renderCollectOriginsForRoot(e, t) {\n    const i = this.tileIterator;\n    i.resetOne(t.root);\n    const r = this.patchGroupsMap;\n\n    for (r.clear(), r.set(t.origin, t); !i.done;) {\n      const t = i.next(),\n            s = t.renderData;\n\n      if (!s || t.visible) {\n        if (t.lij[0] % $ == 0) {\n          const i = e.pushNew();\n          i.root = t, i.origin = t.centerAtSeaLevel, r.set(t.centerAtSeaLevel, i), i.patches.clear();\n        }\n\n        if (t.rendered) {\n          if (s) {\n            const e = r.get(s.localOrigin);\n            e && e.patches.push(t), (!this.highestVisibleLODTile || t.vlevel > this.highestVisibleLODTile.vlevel) && (this.highestVisibleLODTile = t), i.skipSubtree();\n          }\n        } else this.numTilesCulled++;\n      } else this.numTilesCulled++, i.skipSubtree();\n    }\n  }\n\n  _scaleQueriesForTile(e) {\n    const t = e.extent,\n          i = e.lij[0];\n    let r = 0;\n\n    for (; r < this.visibleScaleRangeQueriesInvPtr;) {\n      const e = this.visibleScaleRangeQueries.data[r],\n            s = e.extent;\n      i >= e.minLevel && i <= e.maxLevel && s[0] <= t[2] && s[2] >= t[0] && s[1] <= t[3] && s[3] >= t[1] ? (this.visibleScaleRangeQueries.swapElements(r, this.visibleScaleRangeQueriesInvPtr - 1), this.visibleScaleRangeQueriesInvPtr--) : r++;\n    }\n  }\n\n  _useStencilForTile(e) {\n    for (const t of this.stencilEnabledLayerExtents) if (e.intersectsExtent(t)) return !0;\n\n    return !1;\n  }\n\n  _renderPatchGroupsAuxiliary(e, t, i, r) {\n    this.shaderTechnique.bindPipelineState(e.rctx);\n    const s = this.stencilEnabledLayerExtents.length > 0;\n    t.setUniformMatrix4fv(\"proj\", e.camera.projectionMatrix), t.setUniform1f(\"skirtScale\", this._skirtScale), 0 !== r && this._bindOverlayData(t, r);\n\n    for (let n = 0; n < i.length; n++) {\n      const a = i.data[n];\n\n      this._bindPatchGroupData(t, a, e.camera.eye, e.camera.viewMatrix);\n\n      for (let i = 0; i < a.patches.length; i++) this._renderPatch(e.rctx, t, a.patches.data[i], 4, s, r);\n    }\n\n    e.rctx.bindVAO(null);\n  }\n\n  _renderPatchGroups(e, t, i, n) {\n    const a = e.rctx,\n          o = e.camera,\n          l = o.viewMatrix;\n\n    if (this.shaderTechnique.bindPipelineState(a), this.shaderTechniqueConfig.screenSizePerspective && this.pointsOfInterest) {\n      const e = V(this.stage.viewingMode, this.ellipsoidRadius),\n            i = this.pointsOfInterest.centerOnSurfaceFrequent.distance;\n      e.update({\n        distance: i,\n        fovY: o.fovY\n      }), Z(e, t, \"screenSizePerspective\");\n    }\n\n    const h = this.stencilEnabledLayerExtents.length > 0,\n          d = 3 === n;\n    d && (t.bindTexture(this.emptyTex, \"tex\"), t.setUniform1f(\"blend\", 1), t.setUniform4fv(\"texOffsetAndScale\", S));\n    const c = r(this.tileRenderer.backgroundColor) ? this.tileRenderer.backgroundColor : S;\n    this.shaderTechniqueConfig.hasBackgroundColor && t.setUniform4fv(\"backgroundColor\", c);\n    const u = d ? 0 : this._skirtScale;\n    t.setUniform1f(\"skirtScale\", u);\n    const p = this.wireframe ? 1 : 4;\n    this.shaderTechniqueConfig.textureFadingEnabled && t.bindTexture(this.emptyTex, \"texNext\");\n\n    for (let g = 0; g < i.length; g++) {\n      const c = i.data[g],\n            u = c.patches;\n\n      this._bindPatchGroupData(t, c, o.eye, l);\n\n      const f = e.sliceHelper && e.sliceHelper.plane;\n      I(t, this.shaderTechnique.configuration, f, c.origin), e.shadowMap && e.shadowMap.bindView(t, c.origin), this.numOriginsRendered++;\n\n      for (let e = 0; e < u.length; e++) {\n        const i = u.data[e],\n              o = i.renderData.textureReference;\n        if (s(o)) continue;\n\n        if (!d) {\n          this._scaleQueriesForTile(i), oe(i.renderData.geometryInfo.uvOffsetAndScale, o.offsetAndScale, ie), t.setUniform4fv(\"texOffsetAndScale\", ie), t.bindTexture(o.texture.texture, \"tex\");\n          const e = i.renderData.textureFadeFactor,\n                s = e < 1 ? i.renderData.nextTextureReference : null;\n          this.shaderTechniqueConfig.textureFadingEnabled && r(s) && e < 1 ? (oe(i.renderData.geometryInfo.uvOffsetAndScale, s.offsetAndScale, ie), t.setUniform1f(\"textureFadeFactor\", e), t.setUniform4fv(\"nextTexOffsetAndScale\", ie), t.bindTexture(s.texture.texture, \"texNext\")) : t.setUniform1f(\"textureFadeFactor\", 1), i.renderData.textureIsFading && this.setNeedsRender(), t.setUniform1f(\"opacity\", i.renderData.opacity), t.setUniform1i(\"compositeBackground\", i.renderData.compositeBackgroundInShader ? 1 : 0), t.setUniform1f(\"textureOpacity\", i.renderData.layerOpacity), t.setUniform1f(\"baseOpacity\", i.renderData.baseOpacity);\n        }\n\n        const l = this._renderPatch(a, t, i, p, h, n);\n\n        i.renderOrder = this.numTilesRendered, this.numTilesRendered++, this.numTrianglesRendered += l / 3;\n      }\n    }\n\n    a.bindVAO(null);\n  }\n\n  _renderPatch(e, t, i, r, n, a) {\n    if (s(i.renderData.vao.indexBuffer)) return 0;\n    0 !== a && this._bindOverlayPatchData(t, i.renderData.overlay), n && (this._useStencilForTile(i) ? this.stencilShaderTechnique.bindPipelineState(e) : this.shaderTechnique.bindPipelineState(e));\n    const o = 0 === this._skirtScale ? i.renderData.geometryInfo.numWithoutSkirtIndices : i.renderData.vao.indexBuffer.size;\n    return e.bindVAO(i.renderData.vao), t.assertCompatibleVertexAttributeLocations(i.renderData.vao), e.drawElements(r, o, i.renderData.vao.indexBuffer.indexType, 0), o;\n  }\n\n  _bindPatchGroupData(e, t, i, r) {\n    e.setUniform3fv(\"origin\", t.origin), h(le, r, t.origin), e.setUniformMatrix4fv(\"view\", le), e.setUniform3f(\"camPos\", i[0] - t.origin[0], i[1] - t.origin[1], i[2] - t.origin[2]);\n  }\n\n  _bindOverlayData(e, t) {\n    if (0 === this.shaderTechniqueConfig.overlayMode) return;\n    e.setUniform1f(\"overlayOpacity\", this.overlayOpacity);\n    const i = this.overlayRenderer.overlays;\n\n    if (i.length > 0) {\n      const s = i[0],\n            n = s.getColorTexture(t);\n\n      if (e.bindTexture(r(n) ? n : this.emptyTex, \"ovColorTex\"), 2 === this.shaderTechniqueConfig.overlayMode) {\n        const i = s.getNormalTexture(t);\n        e.bindTexture(r(i) ? i : this.emptyTex, \"ovWaterTex\");\n      }\n    }\n  }\n\n  _bindOverlayPatchData(e, t) {\n    e.setUniform4fv(\"overlayTexOffset\", t.offsets), e.setUniform4fv(\"overlayTexScale\", t.scales);\n  }\n\n  _setTerrainTechnique(e, t) {\n    this.shaderTechniqueConfig.output = e, 0 === e && (this.shaderTechniqueConfig.atmosphere = this.isGlobal && this._velvetOverground, this.shaderTechniqueConfig.ssrEnabled = this._ssrEnabled), this.shaderTechniqueConfig.renderOccluded = t, this.shaderTechniqueConfig.stencilEnabled = !1, this.shaderTechnique = this.shaderTechniques.releaseAndAcquire(K, this.shaderTechniqueConfig, this.shaderTechnique), this.shaderTechniqueConfig.stencilEnabled = !0, this.stencilShaderTechnique = this.shaderTechniques.releaseAndAcquire(K, this.shaderTechniqueConfig, this.stencilShaderTechnique);\n  }\n\n  _prepareScaleRangeQueries() {\n    const e = this.visibleScaleRangeQueries,\n          t = this.visibleScaleRangeQueryQueue;\n\n    for (; e.length < e.data.length && t.length > 0;) {\n      const i = t.pop();\n      e.push(i);\n    }\n\n    this.visibleScaleRangeQueriesInvPtr = e.length;\n  }\n\n  _processScaleRangeQueries() {\n    const e = this.visibleScaleRangeQueries,\n          t = this.visibleScaleRangeQueryPool;\n\n    for (let i = 0; i < e.length; i++) {\n      const r = e.data[i];\n      t.release(r), r.callback(i >= this.visibleScaleRangeQueriesInvPtr), r.callback = null;\n    }\n\n    e.clear();\n  }\n\n  get test() {\n    return {\n      tileRenderer: this.tileRenderer\n    };\n  }\n\n};\ne([o()], se.prototype, \"tileBackgroundInitialized\", void 0), e([o()], se.prototype, \"tileBackgroundUpdating\", void 0), e([o({\n  constructOnly: !0\n})], se.prototype, \"overlayRenderer\", void 0), e([o({\n  constructOnly: !0\n})], se.prototype, \"stage\", void 0), e([o({\n  readOnly: !0\n})], se.prototype, \"isGlobal\", null), e([o({\n  constructOnly: !0\n})], se.prototype, \"updateOverlayOpacity\", void 0), e([o({\n  constructOnly: !0\n})], se.prototype, \"allTiles\", void 0), e([o({\n  constructOnly: !0\n})], se.prototype, \"ellipsoidRadius\", void 0), e([o({\n  readOnly: !0\n})], se.prototype, \"updating\", null), e([o({\n  value: !1\n})], se.prototype, \"renderingDisabled\", null), e([o()], se.prototype, \"renderPatchBorders\", null), e([o()], se.prototype, \"cullBackFaces\", null), e([o({\n  value: 1\n})], se.prototype, \"renderOrder\", null), e([o()], se.prototype, \"wireframe\", null), se = e([l(\"esri.views.3d.terrain.TerrainRenderer\")], se);\nvar ne = se;\n\nfunction ae(e, t, i) {\n  return 0 === e.patches.length ? -i : 0 === t.patches.length ? i : N(e.patches.data[0], t.patches.data[0], i);\n}\n\nfunction oe(e, t, i) {\n  const r = e[0] * t[2] + t[0],\n        s = e[1] * t[3] + t[1],\n        n = e[2] * t[2],\n        a = e[3] * t[3];\n  R(i, r, s, n, a);\n}\n\nconst le = d(),\n      he = y(),\n      de = y(),\n      ce = y(),\n      ue = y(),\n      pe = y(),\n      ge = \"TerrainRenderer\";\nexport default ne;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/terrain/TerrainRenderer.js"],"names":["_","e","t","i","isSome","r","isNone","s","n","a","property","o","subclass","l","h","c","d","I","f","u","p","g","b","m","T","v","Z","y","x","R","S","O","create","set","k","expandWithOffset","q","BufferViewVec3f","P","requestImage","C","overlayRenderOccludedFlag","D","clearCaches","w","intersectSkirts","B","PatchRenderData","U","DEFAULT_TILE_BACKGROUND","j","TileRenderer","E","IteratorPreorder","A","sortTiles","M","compareTiles","N","tile2str","G","bindSliceUniforms","bindSSRUniforms","L","bindProjectionMatrix","F","createEmptyTexture","Q","IntersectorResult","z","getSettings","V","TERRAIN_ID","H","getVerticalOffsetTerrain","W","intersectAabbInvDirBefore","X","intersectTriangles","Y","bindScreenSizePerspective","TerrainTechniqueConfiguration","J","TerrainTechnique","K","$","ee","te","ie","re","constructor","extent","minLevel","maxLevel","callback","se","type","isGround","tileSize","rctx","_isTransparent","renderDataPool","_patchGroups","allocator","root","origin","patches","deallocator","clear","patchGroupsDirty","patchGroupsMap","Map","tileIterator","highestVisibleLODTile","visible","_opaque","_skirtScale","_velvetOverground","castShadows","_ssrEnabled","emptyTex","tileRenderer","tileBackgroundInitialized","tileBackgroundUpdating","stencilEnabledLayerExtents","numTrianglesRendered","numTilesRendered","numTilesCulled","numOriginsRendered","clippingExtent","overlayOpacity","needsHighlight","renderOccludedFlags","visibleScaleRangeQueries","initialSize","visibleScaleRangeQueriesInvPtr","visibleScaleRangeQueryQueue","visibleScaleRangeQueryPool","isGlobal","stage","viewingMode","initialize","addRenderPlugin","destroy","removeRenderPlugin","updating","canRender","rootTiles","renderingDisabled","_set","setNeedsRender","opaque","needsLinearDepth","overlayRenderer","hasWater","shaderTechniqueConfig","slicePlaneEnabled","isTransparent","skirtScale","renderPatchBorders","tileBorders","notifyChange","cullBackFaces","backfaceCullingEnabled","renderOrder","velvetOverground","intersectionHandlerId","slicePlane","textureFadingEnabled","setDebugScreenSizePerspective","screenSizePerspective","setRootTiles","setNeedsHighlight","setRenderOccludedOverlay","setStencilEnabledLayerExtents","setTileSize","loadTile","renderData","acquire","init","localOrigin","_getLocalOriginOfTile","updateTileGeometry","updateTileTexture","queryVisibleLevelRange","Number","MAX_VALUE","push","resetPendingUpdate","layerInfo","pendingUpdates","updateGeometry","wireframe","unloadTile","releaseGeometry","release","setMemoryDirty","Math","max","floor","lij","parent","centerAtSeaLevel","setVisibility","getStats","_get","allTiles","forAll","context","requestRender","setTileBackground","tileBackground","_updateTileBackground","initializeRenderContext","renderContext","shaderTechniques","shaderTechniqueRep","uninitializeRenderContext","dispose","intersect","options","selectOpaqueTerrainOnly","selectionMode","de","ce","results","min","ground","store","target","verticalOffset","_useStencilForTile","invisibleTerrain","intersectsExtent","geometryInfo","boundingBox","applyToAabb","skirtLength","up","ue","dist","tolerance","intersector","ge","metadata","tile","backfacesTerrain","isFiltered","ray","all","pe","indices","vertexAttributes","data","getField","typedBuffer","size","stride","numWithoutSkirtIndices","length","prepareRender","updateOverlayOpacity","render","slot","renderOccludedMask","pass","scenelightingData","globalFactor","_updatePatchGroups","shadowMap","enabled","receiveShadows","isEmpty","overlayMode","_renderMaterialPass","_renderAuxiliaryPass","clearSafe","camera","ssrParams","ssrEnabled","_setTerrainTechnique","shaderTechnique","program","useProgram","bind","ssaoHelper","_bindOverlayData","setUniformMatrix4fv","viewInverseTransposeMatrix","projectionMatrix","setUniforms","viewMatrix","he","setUniform3fv","_prepareScaleRangeQueries","_renderPatchGroups","offscreenRenderingHelper","renderToTargets","tmpColor","mainDepth","_processScaleRangeQueries","bindTexture","depthTexture","setUniform4f","width","height","setUniform2fv","nearFar","_renderPatchGroupsAuxiliary","useGrid","backgroundIsGrid","hasBackgroundColor","backgroundColor","then","setBackground","toUnitRGBA","_renderCollectOrigins","sort","ae","pushNew","_renderCollectOriginsForRoot","filterInPlace","resetOne","done","next","rendered","get","vlevel","skipSubtree","_scaleQueriesForTile","swapElements","bindPipelineState","setUniform1f","_bindPatchGroupData","eye","_renderPatch","bindVAO","pointsOfInterest","ellipsoidRadius","centerOnSurfaceFrequent","distance","update","fovY","setUniform4fv","sliceHelper","plane","configuration","bindView","textureReference","oe","uvOffsetAndScale","offsetAndScale","texture","textureFadeFactor","nextTextureReference","textureIsFading","opacity","setUniform1i","compositeBackgroundInShader","layerOpacity","baseOpacity","vao","indexBuffer","_bindOverlayPatchData","overlay","stencilShaderTechnique","assertCompatibleVertexAttributeLocations","drawElements","indexType","le","setUniform3f","overlays","getColorTexture","getNormalTexture","offsets","scales","output","atmosphere","renderOccluded","stencilEnabled","releaseAndAcquire","pop","test","prototype","constructOnly","readOnly","value","ne"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Color.js\";import i from\"../../../core/Accessor.js\";import{isSome as r,isNone as s}from\"../../../core/maybe.js\";import n from\"../../../core/ObjectPool.js\";import a from\"../../../core/PooledArray.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{t as h}from\"../../../chunks/mat4.js\";import{c as d,I as c}from\"../../../chunks/mat4f64.js\";import{f as u,s as p,a as g,l as f,b as m,n as T,d as v}from\"../../../chunks/vec3.js\";import{Z as b,c as y}from\"../../../chunks/vec3f64.js\";import{c as x,s as R}from\"../../../chunks/vec4.js\";import{Z as S,c as O}from\"../../../chunks/vec4f64.js\";import{create as _,set as k,expandWithOffset as q}from\"../../../geometry/support/aaBoundingBox.js\";import{BufferViewVec3f as P}from\"../../../geometry/support/buffer/BufferView.js\";import{requestImage as C}from\"../../../support/requestImageUtils.js\";import{overlayRenderOccludedFlag as D}from\"./OverlayRenderer.js\";import{clearCaches as w,intersectSkirts as B}from\"./PatchGeometryFactory.js\";import{PatchRenderData as U}from\"./PatchRenderData.js\";import{DEFAULT_TILE_BACKGROUND as j}from\"./TerrainConst.js\";import{TileRenderer as E}from\"./TileRenderer.js\";import{IteratorPreorder as A,sortTiles as M,compareTiles as N,tile2str as G}from\"./tileUtils.js\";import{bindSliceUniforms as I}from\"../webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{bindSSRUniforms as L}from\"../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl.js\";import{bindProjectionMatrix as F}from\"../webgl-engine/core/shaderLibrary/util/View.glsl.js\";import{createEmptyTexture as Q}from\"../webgl-engine/lib/glUtil3D.js\";import{IntersectorResult as z}from\"../webgl-engine/lib/intersectorUtils.js\";import{getSettings as V}from\"../webgl-engine/lib/screenSizePerspectiveUtils.js\";import{TERRAIN_ID as H,getVerticalOffsetTerrain as W}from\"../webgl-engine/lib/verticalOffsetUtils.js\";import{intersectAabbInvDirBefore as X,intersectTriangles as Y,bindScreenSizePerspective as Z}from\"../webgl-engine/materials/internal/MaterialUtil.js\";import{TerrainTechniqueConfiguration as J,TerrainTechnique as K}from\"../webgl-engine/shaders/TerrainTechnique.js\";const $=7,ee=10,te=_(),ie=O();class re{constructor(){this.extent=O(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let se=class extends i{constructor(e){super(e),this.type=\"Terrain\",this.isGround=!0,this.tileSize=256,this.rctx=null,this._isTransparent=!1,this.renderDataPool=new n(U),this._patchGroups=new a({allocator:e=>e||{root:null,origin:null,patches:new a},deallocator:e=>(e.root=null,e.origin=null,e.patches.clear(),e)}),this.patchGroupsDirty=!0,this.patchGroupsMap=new Map,this.tileIterator=new A,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._skirtScale=1,this._velvetOverground=!0,this.castShadows=!0,this._ssrEnabled=!1,this.emptyTex=null,this.tileRenderer=null,this.tileBackgroundInitialized=!1,this.tileBackgroundUpdating=!1,this.stencilEnabledLayerExtents=[],this.numTrianglesRendered=0,this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.clippingExtent=null,this.overlayOpacity=1,this.needsHighlight=!1,this.renderOccludedFlags=1,this.visibleScaleRangeQueries=new a({initialSize:10}),this.visibleScaleRangeQueriesInvPtr=0,this.visibleScaleRangeQueryQueue=new a({initialSize:30}),this.visibleScaleRangeQueryPool=new n(re)}get isGlobal(){return 1===this.stage.viewingMode}initialize(){const e=[2,7,9];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),w()}get updating(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}get canRender(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}set renderingDisabled(e){this._set(\"renderingDisabled\",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get needsLinearDepth(){return this.overlayRenderer.hasWater}get opaque(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}set skirtScale(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())}get skirtScale(){return this._skirtScale}get renderPatchBorders(){return!!this.shaderTechniqueConfig.tileBorders}set renderPatchBorders(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange(\"renderPatchBorders\"))}get cullBackFaces(){return this.shaderTechniqueConfig.backfaceCullingEnabled}set cullBackFaces(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange(\"cullBackFaces\"),this.setNeedsRender())}set renderOrder(e){this._set(\"renderOrder\",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get intersectionHandlerId(){return H}get slicePlane(){return this.shaderTechniqueConfig.slicePlaneEnabled}set slicePlane(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())}set textureFadingEnabled(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this.rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?D:1,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}loadTile(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e)}queryVisibleLevelRange(e,t,i,r){const s=this.visibleScaleRangeQueryPool.acquire();x(s.extent,e),s.minLevel=t||-Number.MAX_VALUE,s.maxLevel=null!=i?i:Number.MAX_VALUE,s.callback=r,this.visibleScaleRangeQueryQueue.push(s),this.setNeedsRender()}updateTileTexture(e){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e),this.setNeedsRender(),e.resetPendingUpdate(64))}updateTileGeometry(e){for(const t of e.layerInfo[0])t.pendingUpdates&=-33;e.resetPendingUpdate(32),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){e.renderData&&(e.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=ee-$,i=Math.max(0,Math.floor((e.lij[0]-t)/$)*$);if(this.isGlobal&&0===i)return b;for(;e.parent&&e.lij[0]>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get(\"wireframe\")!==e&&(this._set(\"wireframe\",e),this.allTiles.forAll((t=>{var i;return null==(i=t.renderData)?void 0:i.updateGeometry(this.rctx,e)})),this.setNeedsRender())}setNeedsRender(e=1){this.patchGroupsDirty=!0,this.context.requestRender(e)}setTileBackground(e){this.tileBackground=e,this._updateTileBackground()}initializeRenderContext(e){this.context=e,this.rctx=e.renderContext.rctx,this.shaderTechniques=e.shaderTechniqueRep,this.shaderTechniqueConfig=new J,this.tileRenderer=new E(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=Q(this.rctx)}uninitializeRenderContext(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)}intersect(e,t,i,n){if(!this.rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const a=de,o=ce;u(a,n,i),p(o,1/a[0],1/a[1],1/a[2]);const l=e.results.min,h=e.results.max,d=e.results.ground,T=0===e.options.store,b=!!e.results.ground.target;let y;const x=W(e.verticalOffset),R=this.clippingExtent;this.allTiles.forAll((S=>{if(null===S.renderData||b&&this._useStencilForTile(S))return;if(e.options.invisibleTerrain){if(!S.visible&&R&&!S.intersectsExtent(R))return}else if(!S.visible)return;const O=S.renderData.geometryInfo;k(te,O.boundingBox);const _=S.renderData.localOrigin;r(x)&&(x.localOrigin=_,x.applyToAabb(te));const C=-this._skirtScale*O.skirtLength;if(0!==C){const e=S.up;q(te,C*e[0],C*e[1],C*e[2])}const D=te;u(ue,i,_);const w=T&&null!=l.dist?l.dist:1/0;if(!X(D,ue,o,e.tolerance,w))return;const U=(e,t,i,r)=>{e.set(void 0,G(t),i,r,c,void 0),e.intersector=ge,e.target={type:\"external\",metadata:{tile:t}}},j=(r,o)=>{if(r>=0&&(e.options.backfacesTerrain||v(o,a)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(i,n,r))){if((null==d.dist||r<d.dist)&&U(d,S,r,o),e.options.isFiltered)return;2===e.options.store&&(s(y)?(y=new z(e.ray),U(y,S,r,o),e.results.all.push(y)):r<y.dist&&U(y,S,r,o)),(null==l.dist||r<l.dist)&&U(l,S,r,o),0!==e.options.store&&(null==h.dist||r>h.dist)&&U(h,S,r,o)}},E=pe;u(E,n,_);const A=O.indices,M=O.vertexAttributes,N={data:M.getField(\"position\",P).typedBuffer,size:3,stride:M.stride/4},I=O.numWithoutSkirtIndices/3;if(Y(ue,E,0,I,A,N,null,x,j),0!==C){const e=this.isGlobal?e=>g(e,e,C/f(m(e,e,_))):e=>p(e,0,0,C),t=A.length/3;B(ue,E,I,t,A,M,e,x,j)}}))}prepareRender(){this.overlayOpacity<1&&this.updateOverlayOpacity()}render(e){if(9===e.slot){if(0==(e.renderOccludedMask&D))return!1}else{const t=this.opaque?2:7;if(e.slot!==t)return!1}const t=e.pass,i=1===e.scenelightingData.globalFactor,r=this._updatePatchGroups();switch(t){case 0:{const t=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==t&&(this.shaderTechniqueConfig.receiveShadows=t);const i=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==i&&(this.shaderTechniqueConfig.overlayMode=i);const s=9===e.slot?3:1;this._renderMaterialPass(e,0,r,s);break}case 4:case 6:this.castShadows&&i&&this._renderAuxiliaryPass(e,3,r,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,1,r,0);break;case 3:this._renderAuxiliaryPass(e,2,r,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(e,4,r,2),e.rctx.clearSafe(256))}return 0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender(),!0}_renderMaterialPass(e,t,i,r){const{rctx:s,camera:n}=e;this._ssrEnabled=e.ssrParams.ssrEnabled,this._setTerrainTechnique(t,3===r);const a=this.shaderTechnique.program;s.useProgram(a),0!==this.shaderTechniqueConfig.overlayMode&&1===r&&e.ssrParams&&L(a,e.ssrParams),e.shadowMap.bind(a),e.ssaoHelper.bind(a),this._bindOverlayData(a,r),a.setUniformMatrix4fv(\"viewNormal\",n.viewInverseTransposeMatrix),F(a,n.projectionMatrix),e.scenelightingData.setUniforms(a,!0);const o=n.viewMatrix;p(he,o[12],o[13],o[14]),T(he,he),a.setUniform3fv(\"viewDirection\",he),this.numTilesRendered=0,this.numTilesCulled=0,this.numTrianglesRendered=0,this.numOriginsRendered=0,this._prepareScaleRangeQueries(),this.opaque?this._renderPatchGroups(e,a,i,r):e.offscreenRenderingHelper.renderToTargets((()=>this._renderPatchGroups(e,a,i,r)),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._processScaleRangeQueries()}_renderAuxiliaryPass(e,t,i,r){this._setTerrainTechnique(t,3===r);const s=e.rctx,n=this.shaderTechnique.program;if(s.useProgram(n),5===e.pass){const t=e.offscreenRenderingHelper;n.bindTexture(t.depthTexture,\"depthTex\"),n.setUniform4f(\"highlightViewportPixelSz\",0,0,1/t.width,1/t.height)}else n.setUniformMatrix4fv(\"viewNormal\",e.camera.viewInverseTransposeMatrix),2!==e.pass&&4!==e.pass&&6!==e.pass||n.setUniform2fv(\"nearFar\",e.camera.nearFar);this._renderPatchGroupsAuxiliary(e,n,i,r)}_updateTileBackground(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid,this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!r(this.tileRenderer.backgroundColor),this.allTiles.forAll((e=>this.tileRenderer.updateTileTexture(e))),this.setNeedsRender()};if(\"string\"==typeof this.tileBackground){const t=this.tileBackground;C(t).then((i=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(i,this.tileBackground===j),e())}))}else{const i=this.tileBackground?t.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(i,!1),e()}}_updatePatchGroups(){const e=this._patchGroups;if(!this.patchGroupsDirty)return e;if(this.highestVisibleLODTile=null,this._renderCollectOrigins(e),0!==this.renderOrder){for(let t=0;t<e.length;t++)M(this.renderOrder,e.data[t].patches);e.sort(((e,t)=>ae(e,t,this.renderOrder)))}return this.patchGroupsDirty=!1,e}_renderCollectOrigins(e){const t=this.rootTiles,i=this.isGlobal;e.clear();for(const r of t){const t=e.pushNew();t.root=r,t.origin=i?b:r.centerAtSeaLevel,t.patches.clear(),this._renderCollectOriginsForRoot(e,t)}e.filterInPlace((e=>e.patches.length>0))}_renderCollectOriginsForRoot(e,t){const i=this.tileIterator;i.resetOne(t.root);const r=this.patchGroupsMap;for(r.clear(),r.set(t.origin,t);!i.done;){const t=i.next(),s=t.renderData;if(!s||t.visible){if(t.lij[0]%$==0){const i=e.pushNew();i.root=t,i.origin=t.centerAtSeaLevel,r.set(t.centerAtSeaLevel,i),i.patches.clear()}if(t.rendered){if(s){const e=r.get(s.localOrigin);e&&e.patches.push(t),(!this.highestVisibleLODTile||t.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=t),i.skipSubtree()}}else this.numTilesCulled++}else this.numTilesCulled++,i.skipSubtree()}}_scaleQueriesForTile(e){const t=e.extent,i=e.lij[0];let r=0;for(;r<this.visibleScaleRangeQueriesInvPtr;){const e=this.visibleScaleRangeQueries.data[r],s=e.extent;i>=e.minLevel&&i<=e.maxLevel&&s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]?(this.visibleScaleRangeQueries.swapElements(r,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):r++}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i,r){this.shaderTechnique.bindPipelineState(e.rctx);const s=this.stencilEnabledLayerExtents.length>0;t.setUniformMatrix4fv(\"proj\",e.camera.projectionMatrix),t.setUniform1f(\"skirtScale\",this._skirtScale),0!==r&&this._bindOverlayData(t,r);for(let n=0;n<i.length;n++){const a=i.data[n];this._bindPatchGroupData(t,a,e.camera.eye,e.camera.viewMatrix);for(let i=0;i<a.patches.length;i++)this._renderPatch(e.rctx,t,a.patches.data[i],4,s,r)}e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i,n){const a=e.rctx,o=e.camera,l=o.viewMatrix;if(this.shaderTechnique.bindPipelineState(a),this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){const e=V(this.stage.viewingMode,this.ellipsoidRadius),i=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:i,fovY:o.fovY}),Z(e,t,\"screenSizePerspective\")}const h=this.stencilEnabledLayerExtents.length>0,d=3===n;d&&(t.bindTexture(this.emptyTex,\"tex\"),t.setUniform1f(\"blend\",1),t.setUniform4fv(\"texOffsetAndScale\",S));const c=r(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:S;this.shaderTechniqueConfig.hasBackgroundColor&&t.setUniform4fv(\"backgroundColor\",c);const u=d?0:this._skirtScale;t.setUniform1f(\"skirtScale\",u);const p=this.wireframe?1:4;this.shaderTechniqueConfig.textureFadingEnabled&&t.bindTexture(this.emptyTex,\"texNext\");for(let g=0;g<i.length;g++){const c=i.data[g],u=c.patches;this._bindPatchGroupData(t,c,o.eye,l);const f=e.sliceHelper&&e.sliceHelper.plane;I(t,this.shaderTechnique.configuration,f,c.origin),e.shadowMap&&e.shadowMap.bindView(t,c.origin),this.numOriginsRendered++;for(let e=0;e<u.length;e++){const i=u.data[e],o=i.renderData.textureReference;if(s(o))continue;if(!d){this._scaleQueriesForTile(i),oe(i.renderData.geometryInfo.uvOffsetAndScale,o.offsetAndScale,ie),t.setUniform4fv(\"texOffsetAndScale\",ie),t.bindTexture(o.texture.texture,\"tex\");const e=i.renderData.textureFadeFactor,s=e<1?i.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&r(s)&&e<1?(oe(i.renderData.geometryInfo.uvOffsetAndScale,s.offsetAndScale,ie),t.setUniform1f(\"textureFadeFactor\",e),t.setUniform4fv(\"nextTexOffsetAndScale\",ie),t.bindTexture(s.texture.texture,\"texNext\")):t.setUniform1f(\"textureFadeFactor\",1),i.renderData.textureIsFading&&this.setNeedsRender(),t.setUniform1f(\"opacity\",i.renderData.opacity),t.setUniform1i(\"compositeBackground\",i.renderData.compositeBackgroundInShader?1:0),t.setUniform1f(\"textureOpacity\",i.renderData.layerOpacity),t.setUniform1f(\"baseOpacity\",i.renderData.baseOpacity)}const l=this._renderPatch(a,t,i,p,h,n);i.renderOrder=this.numTilesRendered,this.numTilesRendered++,this.numTrianglesRendered+=l/3}}a.bindVAO(null)}_renderPatch(e,t,i,r,n,a){if(s(i.renderData.vao.indexBuffer))return 0;0!==a&&this._bindOverlayPatchData(t,i.renderData.overlay),n&&(this._useStencilForTile(i)?this.stencilShaderTechnique.bindPipelineState(e):this.shaderTechnique.bindPipelineState(e));const o=0===this._skirtScale?i.renderData.geometryInfo.numWithoutSkirtIndices:i.renderData.vao.indexBuffer.size;return e.bindVAO(i.renderData.vao),t.assertCompatibleVertexAttributeLocations(i.renderData.vao),e.drawElements(r,o,i.renderData.vao.indexBuffer.indexType,0),o}_bindPatchGroupData(e,t,i,r){e.setUniform3fv(\"origin\",t.origin),h(le,r,t.origin),e.setUniformMatrix4fv(\"view\",le),e.setUniform3f(\"camPos\",i[0]-t.origin[0],i[1]-t.origin[1],i[2]-t.origin[2])}_bindOverlayData(e,t){if(0===this.shaderTechniqueConfig.overlayMode)return;e.setUniform1f(\"overlayOpacity\",this.overlayOpacity);const i=this.overlayRenderer.overlays;if(i.length>0){const s=i[0],n=s.getColorTexture(t);if(e.bindTexture(r(n)?n:this.emptyTex,\"ovColorTex\"),2===this.shaderTechniqueConfig.overlayMode){const i=s.getNormalTexture(t);e.bindTexture(r(i)?i:this.emptyTex,\"ovWaterTex\")}}}_bindOverlayPatchData(e,t){e.setUniform4fv(\"overlayTexOffset\",t.offsets),e.setUniform4fv(\"overlayTexScale\",t.scales)}_setTerrainTechnique(e,t){this.shaderTechniqueConfig.output=e,0===e&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled),this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this.shaderTechnique=this.shaderTechniques.releaseAndAcquire(K,this.shaderTechniqueConfig,this.shaderTechnique),this.shaderTechniqueConfig.stencilEnabled=!0,this.stencilShaderTechnique=this.shaderTechniques.releaseAndAcquire(K,this.shaderTechniqueConfig,this.stencilShaderTechnique)}_prepareScaleRangeQueries(){const e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryQueue;for(;e.length<e.data.length&&t.length>0;){const i=t.pop();e.push(i)}this.visibleScaleRangeQueriesInvPtr=e.length}_processScaleRangeQueries(){const e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryPool;for(let i=0;i<e.length;i++){const r=e.data[i];t.release(r),r.callback(i>=this.visibleScaleRangeQueriesInvPtr),r.callback=null}e.clear()}get test(){return{tileRenderer:this.tileRenderer}}};e([o()],se.prototype,\"tileBackgroundInitialized\",void 0),e([o()],se.prototype,\"tileBackgroundUpdating\",void 0),e([o({constructOnly:!0})],se.prototype,\"overlayRenderer\",void 0),e([o({constructOnly:!0})],se.prototype,\"stage\",void 0),e([o({readOnly:!0})],se.prototype,\"isGlobal\",null),e([o({constructOnly:!0})],se.prototype,\"updateOverlayOpacity\",void 0),e([o({constructOnly:!0})],se.prototype,\"allTiles\",void 0),e([o({constructOnly:!0})],se.prototype,\"ellipsoidRadius\",void 0),e([o({readOnly:!0})],se.prototype,\"updating\",null),e([o({value:!1})],se.prototype,\"renderingDisabled\",null),e([o()],se.prototype,\"renderPatchBorders\",null),e([o()],se.prototype,\"cullBackFaces\",null),e([o({value:1})],se.prototype,\"renderOrder\",null),e([o()],se.prototype,\"wireframe\",null),se=e([l(\"esri.views.3d.terrain.TerrainRenderer\")],se);var ne=se;function ae(e,t,i){return 0===e.patches.length?-i:0===t.patches.length?i:N(e.patches.data[0],t.patches.data[0],i)}function oe(e,t,i){const r=e[0]*t[2]+t[0],s=e[1]*t[3]+t[1],n=e[2]*t[2],a=e[3]*t[3];R(i,r,s,n,a)}const le=d(),he=y(),de=y(),ce=y(),ue=y(),pe=y(),ge=\"TerrainRenderer\";export default ne;\n"]},"metadata":{},"sourceType":"module"}