{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Handles.js\";\nimport { someMap as i } from \"../../../../core/MapUtils.js\";\nimport { isSome as s } from \"../../../../core/maybe.js\";\nimport { init as r } from \"../../../../core/watchUtils.js\";\nimport \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as a } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { t as o } from \"../../../../chunks/boundedPlane.js\";\nimport { Deconflictor as c, DeconflictorViewState as n, DeconflictorGraphic as h } from \"./Deconflictor.js\";\nimport { LabelDeconflictor as l } from \"./LabelDeconflictor.js\";\nimport { TaskPriority as p } from \"../../../support/Scheduler.js\";\nlet d = class extends c {\n  constructor() {\n    super(...arguments), this._handles = new t(), this._contexts = new Map(), this._viewState = new n(), this.visibilityGroup = 0, this._iconMarginFactor = -.1;\n  }\n\n  get labels() {\n    return this._labels;\n  }\n\n  get viewState() {\n    return this._viewState;\n  }\n\n  initialize() {\n    this._handles.add([this.view.watch(\"state.camera\", () => {\n      this.updateViewState(), this.setDirty();\n    }), this.view.watch(\"map.ground.opacity\", (e, t) => {\n      1 !== e && 1 !== t || this.setDirty();\n    }), r(this.view, \"slicePlane\", () => {\n      this.updateSlicePlane(), this.slicePlaneChanged();\n    })]), this._frameTask = this.view.resourceController.scheduler.registerTask(p.GRAPHICS_DECONFLICTOR, this), this._labels = new l({\n      view: this.view,\n      parent: this\n    });\n  }\n\n  destroy() {\n    this._labels.destroy(), this._labels = null, this._handles.destroy(), this._handles = null, this._frameTask && (this._frameTask.remove(), this._frameTask = null);\n  }\n\n  get iconMarginFactor() {\n    return this._iconMarginFactor;\n  }\n\n  set iconMarginFactor(e) {\n    this._iconMarginFactor = e, this.setDirty();\n  }\n\n  setDirty() {\n    this._contexts.size > 0 && (super.setDirty(), this._labels.setDirty());\n  }\n\n  runTask(e) {\n    super.runTask(e), this.running || this._labels.setDirty();\n  }\n\n  setInitialIconVisibilityFlag(e, t) {\n    const i = !(this._graphicSupportsDeconfliction(t) && u(e));\n    t.setVisibilityFlag(3, i, 0);\n  }\n\n  updateViewState() {\n    this.view && this.view.state && (this._viewState.camera.copyFrom(this.view.state.camera), this.updateSlicePlane());\n  }\n\n  updateSlicePlane() {\n    const e = this.view ? this.view.slicePlane : null;\n    s(e) && o(e, this._viewState.camera.viewMatrix, this._viewState.slicePlane), this._viewState.slicePlaneEnabled = s(e);\n  }\n\n  slicePlaneChanged() {\n    i(this._contexts, (e, t) => t.symbolCreationContext.slicePlaneEnabled) && this.setDirty();\n  }\n\n  addGraphicsOwner(e) {\n    let t = this._contexts.get(e);\n\n    return null == t && (t = new Map(), this._contexts.set(e, t), this.setDirty()), {\n      addGraphic: i => this.addGraphic(e, t, i),\n      removeGraphic: e => this.removeGraphic(t, e),\n      labelingInfoChange: () => this._labels.enabledChanged(e, t),\n      featureReductionChange: () => this.enabledChanged(e, t),\n      slicePlaneEnabledChange: () => this._slicePlaneEnabledChanged(e, t),\n      clear: () => t.forEach(e => this.removeGraphic(t, e.graphics3DGraphic))\n    };\n  }\n\n  removeGraphicsOwner(e) {\n    const t = this._contexts.get(e);\n\n    t && (t.forEach(e => this.removeGraphic(t, e.graphics3DGraphic)), this._contexts.delete(e), this.setDirty());\n  }\n\n  addGraphic(e, t, i) {\n    const s = i.graphic.uid,\n          r = new h(i, e.symbolCreationContext.slicePlaneEnabled);\n    t.set(s, r), u(e) && this.addToActiveGraphics(r), e.labelsEnabled && this._labels.addToActiveGraphics(r);\n  }\n\n  removeGraphic(e, t) {\n    const i = t.graphic.uid,\n          s = e.get(i);\n    s && (this.removeFromActiveGraphics(s), this._labels.removeFromActiveGraphics(s), e.delete(i), this.setDirty());\n  }\n\n  enabledChanged(e, t) {\n    const i = u(e);\n    i || m(e), this.modifyGraphics(t, i);\n  }\n\n  _slicePlaneEnabledChanged(e, t) {\n    const i = e.symbolCreationContext.slicePlaneEnabled;\n    t.forEach(e => e.slicePlaneEnabled = i), this.setDirty();\n  }\n\n  getGraphicsLayers(e) {\n    return e._graphics;\n  }\n\n  _graphicSupportsDeconfliction(e) {\n    if (e.isDraped) return !1;\n    const t = e._graphics;\n    if (!t || !t.length) return !1;\n\n    for (const i of t) if (this.layerSupportsDeconfliction(i)) return !0;\n\n    return !1;\n  }\n\n};\n\nfunction u(e) {\n  const t = e.layer;\n  return !(!t || !t.featureReduction || \"selection\" !== t.featureReduction.type);\n}\n\nfunction m(e) {\n  const t = e.graphics3DGraphics;\n  t && t.forEach(e => e.clearVisibilityFlag(3));\n}\n\nd = e([a(\"esri.views.3d.layers.graphics.GraphicsDeconflictor\")], d);\nexport { d as GraphicsDeconflictor };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/GraphicsDeconflictor.js"],"names":["_","e","t","someMap","i","isSome","s","init","r","subclass","a","o","Deconflictor","c","DeconflictorViewState","n","DeconflictorGraphic","h","LabelDeconflictor","l","TaskPriority","p","d","constructor","arguments","_handles","_contexts","Map","_viewState","visibilityGroup","_iconMarginFactor","labels","_labels","viewState","initialize","add","view","watch","updateViewState","setDirty","updateSlicePlane","slicePlaneChanged","_frameTask","resourceController","scheduler","registerTask","GRAPHICS_DECONFLICTOR","parent","destroy","remove","iconMarginFactor","size","runTask","running","setInitialIconVisibilityFlag","_graphicSupportsDeconfliction","u","setVisibilityFlag","state","camera","copyFrom","slicePlane","viewMatrix","slicePlaneEnabled","symbolCreationContext","addGraphicsOwner","get","set","addGraphic","removeGraphic","labelingInfoChange","enabledChanged","featureReductionChange","slicePlaneEnabledChange","_slicePlaneEnabledChanged","clear","forEach","graphics3DGraphic","removeGraphicsOwner","delete","graphic","uid","addToActiveGraphics","labelsEnabled","removeFromActiveGraphics","m","modifyGraphics","getGraphicsLayers","_graphics","isDraped","length","layerSupportsDeconfliction","layer","featureReduction","type","graphics3DGraphics","clearVisibilityFlag","GraphicsDeconflictor"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Handles.js\";import{someMap as i}from\"../../../../core/MapUtils.js\";import{isSome as s}from\"../../../../core/maybe.js\";import{init as r}from\"../../../../core/watchUtils.js\";import\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{t as o}from\"../../../../chunks/boundedPlane.js\";import{Deconflictor as c,DeconflictorViewState as n,DeconflictorGraphic as h}from\"./Deconflictor.js\";import{LabelDeconflictor as l}from\"./LabelDeconflictor.js\";import{TaskPriority as p}from\"../../../support/Scheduler.js\";let d=class extends c{constructor(){super(...arguments),this._handles=new t,this._contexts=new Map,this._viewState=new n,this.visibilityGroup=0,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([this.view.watch(\"state.camera\",(()=>{this.updateViewState(),this.setDirty()})),this.view.watch(\"map.ground.opacity\",((e,t)=>{1!==e&&1!==t||this.setDirty()})),r(this.view,\"slicePlane\",(()=>{this.updateSlicePlane(),this.slicePlaneChanged()}))]),this._frameTask=this.view.resourceController.scheduler.registerTask(p.GRAPHICS_DECONFLICTOR,this),this._labels=new l({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&u(e));t.setVisibilityFlag(3,i,0)}updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())}updateSlicePlane(){const e=this.view?this.view.slicePlane:null;s(e)&&o(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=s(e)}slicePlaneChanged(){i(this._contexts,((e,t)=>t.symbolCreationContext.slicePlaneEnabled))&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return null==t&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this.addGraphic(e,t,i),removeGraphic:e=>this.removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach((e=>this.removeGraphic(t,e.graphics3DGraphic)))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach((e=>this.removeGraphic(t,e.graphics3DGraphic))),this._contexts.delete(e),this.setDirty())}addGraphic(e,t,i){const s=i.graphic.uid,r=new h(i,e.symbolCreationContext.slicePlaneEnabled);t.set(s,r),u(e)&&this.addToActiveGraphics(r),e.labelsEnabled&&this._labels.addToActiveGraphics(r)}removeGraphic(e,t){const i=t.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=u(e);i||m(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach((e=>e.slicePlaneEnabled=i)),this.setDirty()}getGraphicsLayers(e){return e._graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e._graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function u(e){const t=e.layer;return!(!t||!t.featureReduction||\"selection\"!==t.featureReduction.type)}function m(e){const t=e.graphics3DGraphics;t&&t.forEach((e=>e.clearVisibilityFlag(3)))}d=e([a(\"esri.views.3d.layers.graphics.GraphicsDeconflictor\")],d);export{d as GraphicsDeconflictor};\n"]},"metadata":{},"sourceType":"module"}