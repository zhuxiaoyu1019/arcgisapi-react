{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../core/Error.js\";\nimport { HandleOwnerMixin as r } from \"../../../core/HandleOwner.js\";\nimport o from \"../../../core/has.js\";\nimport s from \"../../../core/Loadable.js\";\nimport { isSome as a, unwrap as i } from \"../../../core/maybe.js\";\nimport { debounce as n, eachAlways as c } from \"../../../core/promiseUtils.js\";\nimport { init as p } from \"../../../core/watchUtils.js\";\nimport { open as l } from \"../../../core/workers/workers.js\";\nimport { property as u } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as m } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { featureGeometryTypeKebabDictionary as y } from \"../../../geometry/support/typeUtils.js\";\nimport { createCapabilities as d, createDrawingInfo as f } from \"./support/clientSideDefaults.js\";\nimport { getCapabilities as h, getWFSLayerInfo as w, prepareWFSLayerFields as g, findFeatureType as S } from \"../../ogc/wfsUtils.js\";\nimport v from \"../../../rest/support/FeatureSet.js\";\nimport F from \"../../../geometry/Extent.js\";\nlet j = class extends r(s) {\n  constructor() {\n    super(...arguments), this.capabilities = d(!1, !1), this.type = \"wfs\", this._updateCustomParameters = n(() => {\n      var e;\n      const t = this.layer.customParameters;\n      return null == (e = this._connection) ? void 0 : e.invoke(\"setCustomParameters\", t);\n    });\n  }\n\n  load(e) {\n    var t;\n    const r = null != (t = a(e) && e.signal) ? t : null;\n    return this.addResolvingPromise(this._startWorker({\n      signal: r\n    })), Promise.resolve(this);\n  }\n\n  destroy() {\n    var e;\n    null == (e = this._connection) || e.close(), this._connection = null;\n  }\n\n  async openPorts() {\n    return await this.load(), this._connection.openPorts();\n  }\n\n  async queryFeatures(e, t = {}) {\n    await this.load(t);\n    const r = await this._connection.invoke(\"queryFeatures\", e ? e.toJSON() : null, t);\n    return v.fromJSON(r);\n  }\n\n  async queryFeaturesJSON(e, t = {}) {\n    return await this.load(t), this._connection.invoke(\"queryFeatures\", e ? e.toJSON() : null, t);\n  }\n\n  async queryFeatureCount(e, t = {}) {\n    return await this.load(t), this._connection.invoke(\"queryFeatureCount\", e ? e.toJSON() : null, t);\n  }\n\n  async queryObjectIds(e, t = {}) {\n    return await this.load(t), this._connection.invoke(\"queryObjectIds\", e ? e.toJSON() : null, t);\n  }\n\n  async queryExtent(e, t = {}) {\n    await this.load(t);\n    const r = await this._connection.invoke(\"queryExtent\", e ? e.toJSON() : null, t);\n    return {\n      count: r.count,\n      extent: F.fromJSON(r.extent)\n    };\n  }\n\n  async querySnapping(e, t = {}) {\n    return await this.load(t), this._connection.invoke(\"querySnapping\", e, t);\n  }\n\n  async refresh(e = {}) {\n    await this.load(e);\n    const {\n      extent: t\n    } = await this._connection.invoke(\"refresh\", void 0, e);\n    return this.sourceJSON.extent = t, {\n      extent: t\n    };\n  }\n\n  async _createLoadOptions(e) {\n    const {\n      url: r,\n      customParameters: o,\n      name: s,\n      namespaceUri: a,\n      spatialReference: n,\n      fields: c,\n      geometryType: p,\n      swapXY: l\n    } = this.layer;\n    if (!r) throw new t(\"wfs-layer:missing-url\", \"WFSLayer must be created with a url\");\n    this.wfsCapabilities = this.wfsCapabilities || (await h(r, {\n      customParameters: o,\n      ...e\n    }));\n    const u = [\"fields\", \"geometryType\", \"name\", \"namespaceUri\", \"spatialReference\", \"swapXY\"].some(e => null == this.layer[e]) ? await w(this.wfsCapabilities, s, a, {\n      spatialReference: n,\n      customParameters: o,\n      signal: null == e ? void 0 : e.signal\n    }) : { ...g(c),\n      geometryType: p,\n      name: s,\n      namespaceUri: a,\n      spatialReference: n,\n      swapXY: l\n    },\n          m = i(S(this.wfsCapabilities.readFeatureTypes(), u.name, u.namespaceUri)),\n          d = y.toJSON(u.geometryType);\n    return {\n      customParameters: o,\n      featureType: m,\n      fields: u.fields.map(e => e.toJSON()),\n      geometryField: u.geometryField,\n      geometryType: d,\n      getFeatureUrl: this.wfsCapabilities.operations.GetFeature.url,\n      getFeatureOutputFormat: this.wfsCapabilities.operations.GetFeature.outputFormat,\n      objectIdField: u.objectIdField,\n      spatialReference: u.spatialReference.toJSON(),\n      swapXY: u.swapXY\n    };\n  }\n\n  async _startWorker(e) {\n    const [t, r] = await c([this._createLoadOptions(e), l(\"WFSSourceWorker\", { ...e,\n      strategy: o(\"feature-layers-workers\") ? \"dedicated\" : \"local\"\n    })]),\n          s = t.error || r.error || null,\n          a = r.value || null;\n    if (s) throw a && a.close(), s;\n    const i = t.value;\n    this._connection = r.value;\n    const {\n      extent: n\n    } = await this._connection.invoke(\"load\", i, e);\n    this.sourceJSON = {\n      extent: n,\n      fields: i.fields,\n      geometryType: i.geometryType,\n      objectIdField: i.objectIdField,\n      geometryField: i.geometryField,\n      drawingInfo: f(i.geometryType),\n      name: i.featureType.title,\n      wfsInfo: {\n        name: i.featureType.name,\n        featureUrl: i.getFeatureUrl,\n        maxFeatures: 3e3,\n        swapXY: i.swapXY,\n        supportedSpatialReferences: i.featureType.supportedSpatialReferences,\n        version: \"2.0.0\",\n        wfsNamespace: i.featureType.namespaceUri\n      }\n    }, this.handles.add(p(this.layer, \"customParameters\", () => this._updateCustomParameters().catch(() => {})));\n  }\n\n};\ne([u()], j.prototype, \"capabilities\", void 0), e([u({\n  constructOnly: !0\n})], j.prototype, \"layer\", void 0), e([u()], j.prototype, \"sourceJSON\", void 0), e([u()], j.prototype, \"type\", void 0), e([u()], j.prototype, \"wfsCapabilities\", void 0), j = e([m(\"esri.layers.graphics.sources.WFSSource\")], j);\nvar O = j;\nexport default O;\nexport { j as WFSSource };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/graphics/sources/WFSSource.js"],"names":["_","e","t","HandleOwnerMixin","r","o","s","isSome","a","unwrap","i","debounce","n","eachAlways","c","init","p","open","l","property","u","subclass","m","featureGeometryTypeKebabDictionary","y","createCapabilities","d","createDrawingInfo","f","getCapabilities","h","getWFSLayerInfo","w","prepareWFSLayerFields","g","findFeatureType","S","v","F","j","constructor","arguments","capabilities","type","_updateCustomParameters","layer","customParameters","_connection","invoke","load","signal","addResolvingPromise","_startWorker","Promise","resolve","destroy","close","openPorts","queryFeatures","toJSON","fromJSON","queryFeaturesJSON","queryFeatureCount","queryObjectIds","queryExtent","count","extent","querySnapping","refresh","sourceJSON","_createLoadOptions","url","name","namespaceUri","spatialReference","fields","geometryType","swapXY","wfsCapabilities","some","readFeatureTypes","featureType","map","geometryField","getFeatureUrl","operations","GetFeature","getFeatureOutputFormat","outputFormat","objectIdField","strategy","error","value","drawingInfo","title","wfsInfo","featureUrl","maxFeatures","supportedSpatialReferences","version","wfsNamespace","handles","add","catch","prototype","constructOnly","O","WFSSource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../core/Error.js\";import{HandleOwnerMixin as r}from\"../../../core/HandleOwner.js\";import o from\"../../../core/has.js\";import s from\"../../../core/Loadable.js\";import{isSome as a,unwrap as i}from\"../../../core/maybe.js\";import{debounce as n,eachAlways as c}from\"../../../core/promiseUtils.js\";import{init as p}from\"../../../core/watchUtils.js\";import{open as l}from\"../../../core/workers/workers.js\";import{property as u}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as m}from\"../../../core/accessorSupport/decorators/subclass.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../geometry/support/typeUtils.js\";import{createCapabilities as d,createDrawingInfo as f}from\"./support/clientSideDefaults.js\";import{getCapabilities as h,getWFSLayerInfo as w,prepareWFSLayerFields as g,findFeatureType as S}from\"../../ogc/wfsUtils.js\";import v from\"../../../rest/support/FeatureSet.js\";import F from\"../../../geometry/Extent.js\";let j=class extends(r(s)){constructor(){super(...arguments),this.capabilities=d(!1,!1),this.type=\"wfs\",this._updateCustomParameters=n((()=>{var e;const t=this.layer.customParameters;return null==(e=this._connection)?void 0:e.invoke(\"setCustomParameters\",t)}))}load(e){var t;const r=null!=(t=a(e)&&e.signal)?t:null;return this.addResolvingPromise(this._startWorker({signal:r})),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke(\"queryFeatures\",e?e.toJSON():null,t);return v.fromJSON(r)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._connection.invoke(\"queryFeatures\",e?e.toJSON():null,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._connection.invoke(\"queryFeatureCount\",e?e.toJSON():null,t)}async queryObjectIds(e,t={}){return await this.load(t),this._connection.invoke(\"queryObjectIds\",e?e.toJSON():null,t)}async queryExtent(e,t={}){await this.load(t);const r=await this._connection.invoke(\"queryExtent\",e?e.toJSON():null,t);return{count:r.count,extent:F.fromJSON(r.extent)}}async querySnapping(e,t={}){return await this.load(t),this._connection.invoke(\"querySnapping\",e,t)}async refresh(e={}){await this.load(e);const{extent:t}=await this._connection.invoke(\"refresh\",void 0,e);return this.sourceJSON.extent=t,{extent:t}}async _createLoadOptions(e){const{url:r,customParameters:o,name:s,namespaceUri:a,spatialReference:n,fields:c,geometryType:p,swapXY:l}=this.layer;if(!r)throw new t(\"wfs-layer:missing-url\",\"WFSLayer must be created with a url\");this.wfsCapabilities=this.wfsCapabilities||await h(r,{customParameters:o,...e});const u=[\"fields\",\"geometryType\",\"name\",\"namespaceUri\",\"spatialReference\",\"swapXY\"].some((e=>null==this.layer[e]))?await w(this.wfsCapabilities,s,a,{spatialReference:n,customParameters:o,signal:null==e?void 0:e.signal}):{...g(c),geometryType:p,name:s,namespaceUri:a,spatialReference:n,swapXY:l},m=i(S(this.wfsCapabilities.readFeatureTypes(),u.name,u.namespaceUri)),d=y.toJSON(u.geometryType);return{customParameters:o,featureType:m,fields:u.fields.map((e=>e.toJSON())),geometryField:u.geometryField,geometryType:d,getFeatureUrl:this.wfsCapabilities.operations.GetFeature.url,getFeatureOutputFormat:this.wfsCapabilities.operations.GetFeature.outputFormat,objectIdField:u.objectIdField,spatialReference:u.spatialReference.toJSON(),swapXY:u.swapXY}}async _startWorker(e){const[t,r]=await c([this._createLoadOptions(e),l(\"WFSSourceWorker\",{...e,strategy:o(\"feature-layers-workers\")?\"dedicated\":\"local\"})]),s=t.error||r.error||null,a=r.value||null;if(s)throw a&&a.close(),s;const i=t.value;this._connection=r.value;const{extent:n}=await this._connection.invoke(\"load\",i,e);this.sourceJSON={extent:n,fields:i.fields,geometryType:i.geometryType,objectIdField:i.objectIdField,geometryField:i.geometryField,drawingInfo:f(i.geometryType),name:i.featureType.title,wfsInfo:{name:i.featureType.name,featureUrl:i.getFeatureUrl,maxFeatures:3e3,swapXY:i.swapXY,supportedSpatialReferences:i.featureType.supportedSpatialReferences,version:\"2.0.0\",wfsNamespace:i.featureType.namespaceUri}},this.handles.add(p(this.layer,\"customParameters\",(()=>this._updateCustomParameters().catch((()=>{})))))}};e([u()],j.prototype,\"capabilities\",void 0),e([u({constructOnly:!0})],j.prototype,\"layer\",void 0),e([u()],j.prototype,\"sourceJSON\",void 0),e([u()],j.prototype,\"type\",void 0),e([u()],j.prototype,\"wfsCapabilities\",void 0),j=e([m(\"esri.layers.graphics.sources.WFSSource\")],j);var O=j;export default O;export{j as WFSSource};\n"]},"metadata":{},"sourceType":"module"}