{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../ArcadePortal.js\";\nimport t from \"../Dictionary.js\";\nimport n from \"../Feature.js\";\nimport r from \"../featureSetCollection.js\";\nimport { getPortal as i, lookupUser as a, constructFeatureSetFromPortalItem as s, constructFeatureSet as l, constructFeatureSetFromRelationship as o, constructFeatureSetFromUrl as f, constructAssociationMetaDataFeatureSetFromUrl as u } from \"../featureSetUtils.js\";\nimport { p as c, C as d, d as m, q as p, u as y, a as g, g as h, t as F, b as I, T as E, L as D } from \"../../chunks/languageUtils.js\";\nimport { SqlExpressionAdapted as w, StringToCodeAdapted as b, FieldRename as A, AdaptedFeatureSet as N, OriginalField as x } from \"../featureset/actions/Adapted.js\";\nimport S from \"../featureset/actions/AttributeFilter.js\";\nimport $ from \"../featureset/actions/OrderBy.js\";\nimport T from \"../featureset/actions/Top.js\";\nimport L from \"../featureset/sources/Empty.js\";\nimport v from \"../featureset/sources/FeatureLayerMemory.js\";\nimport j from \"../featureset/support/OrderbyClause.js\";\nimport { cloneField as O } from \"../featureset/support/shared.js\";\nimport { isSingleField as R } from \"../featureset/support/sqlUtils.js\";\nimport { calculateStat as C } from \"./fieldStats.js\";\nimport { all as P, resolve as M } from \"../../core/promiseUtils.js\";\nimport { WhereClause as k } from \"../../core/sql/WhereClause.js\";\nimport G from \"../../layers/FeatureLayer.js\";\nimport B from \"../../layers/support/Field.js\";\n\nfunction V(e, t, n, r) {\n  if (1 === r.length) {\n    if (g(r[0])) return C(e, r[0], -1);\n    if (I(r[0])) return C(e, r[0].toArray(), -1);\n  }\n\n  return C(e, r, -1);\n}\n\nfunction H(e, t, n) {\n  const r = e.getVariables();\n\n  if (r.length > 0) {\n    const i = [];\n\n    for (let e = 0; e < r.length; e++) {\n      const a = {\n        name: r[e]\n      };\n      i.push(t.evaluateIdentifier(n, a));\n    }\n\n    return P(i).then(t => {\n      const n = {};\n\n      for (let e = 0; e < r.length; e++) n[r[e]] = t[e];\n\n      return e.parameters = n, e;\n    });\n  }\n\n  return M(e);\n}\n\nfunction z(e, t, n = null) {\n  for (const r in e) if (r.toLowerCase() === t.toLowerCase()) return e[r];\n\n  return n;\n}\n\nfunction U(e) {\n  if (null === e) return null;\n  const t = {\n    type: z(e, \"type\", \"\"),\n    name: z(e, \"name\", \"\")\n  };\n  if (\"range\" === t.type) t.range = z(e, \"range\", []);else {\n    t.codedValues = [];\n\n    for (const n of z(e, \"codedValues\", [])) t.codedValues.push({\n      name: z(n, \"name\", \"\"),\n      code: z(n, \"code\", null)\n    });\n  }\n  return t;\n}\n\nfunction W(e) {\n  if (null === e) return null;\n  const t = {},\n        n = z(e, \"wkt\", null);\n  null !== n && (t.wkt = n);\n  const r = z(e, \"wkid\", null);\n  return null !== r && (t.wkid = r), t;\n}\n\nfunction _(e) {\n  if (null === e) return null;\n  const t = {\n    hasZ: z(e, \"hasz\", !1),\n    hasM: z(e, \"hasm\", !1)\n  },\n        n = z(e, \"spatialreference\", null);\n  n && (t.spatialReference = W(n));\n  const r = z(e, \"x\", null);\n  if (null !== r) return t.x = r, t.y = z(e, \"y\", null), t;\n  const i = z(e, \"rings\", null);\n  if (null !== i) return t.rings = i, t;\n  const a = z(e, \"paths\", null);\n  if (null !== a) return t.paths = a, t;\n  const s = z(e, \"points\", null);\n  if (null !== s) return t.points = s, t;\n\n  for (const l of [\"xmin\", \"xmax\", \"ymin\", \"ymax\", \"zmin\", \"zmax\", \"mmin\", \"mmax\"]) {\n    const n = z(e, l, null);\n    null !== n && (t[l] = n);\n  }\n\n  return t;\n}\n\nfunction q(e, t) {\n  for (const n of t) if (n === e) return !0;\n\n  return !1;\n}\n\nfunction J(e) {\n  return !!e.layerDefinition && !!e.featureSet && !1 !== q(e.layerDefinition.geometryType, [\"\", \"esriGeometryPoint\", \"esriGeometryPolyline\", \"esriGeometryPolygon\", \"esriGeometryMultipoint\", \"esriGeometryEnvelope\"]) && null !== e.layerDefinition.objectIdField && \"\" !== e.layerDefinition.objectIdField && !1 !== g(e.layerDefinition.fields) && !1 !== g(e.featureSet.features);\n}\n\nfunction K(C) {\n  \"async\" === C.mode && (C.functions.getuser = function (n, r) {\n    return C.standardFunctionAsync(n, r, (r, s, l) => {\n      c(l, 1, 2);\n      let o = d(l[1], \"\"),\n          f = !0 === o;\n\n      if (o = !0 === o || !1 === o ? \"\" : m(o), l[0] instanceof e) {\n        let e = null;\n        return n.services && n.services.portal && (e = n.services.portal), e = i(l[0], e), a(e, o, f).then(e => {\n          if (e) {\n            const n = JSON.parse(JSON.stringify(e));\n\n            for (const e of [\"lastLogin\", \"created\", \"modified\"]) void 0 !== n[e] && null !== n[e] && (n[e] = new Date(n[e]));\n\n            return t.convertObjectToArcadeDictionary(n);\n          }\n\n          return null;\n        });\n      }\n\n      let u = null;\n      if (p(l[0]) && (u = l[0]), u) return f = !1, o ? null : u.load().then(() => u.getOwningSystemUrl()).then(r => {\n        if (!r) return o ? null : u.getIdentityUser().then(e => e ? t.convertObjectToArcadeDictionary({\n          username: e\n        }) : null);\n        let s = null;\n        return n.services && n.services.portal && (s = n.services.portal), s = i(new e(r), s), a(s, o, f).then(e => {\n          if (e) {\n            const n = JSON.parse(JSON.stringify(e));\n\n            for (const e of [\"lastLogin\", \"created\", \"modified\"]) void 0 !== n[e] && null !== n[e] && (n[e] = new Date(n[e]));\n\n            return t.convertObjectToArcadeDictionary(n);\n          }\n\n          return null;\n        });\n      });\n      throw new Error(\"Invalid Parameter\");\n    });\n  }, C.signatures.push({\n    name: \"getuser\",\n    min: \"1\",\n    max: \"2\"\n  }), C.functions.featuresetbyid = function (e, t) {\n    return C.standardFunctionAsync(e, t, (e, t, n) => {\n      if (c(n, 2, 4), n[0] instanceof r) {\n        const e = m(n[1]);\n        let t = d(n[2], null);\n        const r = y(d(n[3], !0));\n        if (null === t && (t = [\"*\"]), !1 === g(t)) throw new Error(\"Invalid Parameter\");\n        return n[0].featureSetById(e, r, t);\n      }\n\n      throw new Error(\"Invalid Parameter\");\n    });\n  }, C.signatures.push({\n    name: \"featuresetbyid\",\n    min: \"2\",\n    max: \"4\"\n  }), C.functions.featuresetbyportalitem = function (t, n) {\n    return C.standardFunctionAsync(t, n, (n, r, a) => {\n      if (c(a, 2, 5), null === a[0]) throw new Error(\"Portal is required\");\n\n      if (a[0] instanceof e) {\n        const e = m(a[1]),\n              n = m(a[2]);\n        let r = d(a[3], null);\n        const l = y(d(a[4], !0));\n        if (null === r && (r = [\"*\"]), !1 === g(r)) throw new Error(\"Invalid Parameter\");\n        let o = null;\n        return t.services && t.services.portal && (o = t.services.portal), o = i(a[0], o), s(e, n, t.spatialReference, r, l, o, t.lrucache, t.interceptor);\n      }\n\n      if (!1 === h(a[0])) throw new Error(\"Portal is required\");\n      const l = m(a[0]),\n            o = m(a[1]);\n      let f = d(a[2], null);\n      const u = y(d(a[3], !0));\n      if (null === f && (f = [\"*\"]), !1 === g(f)) throw new Error(\"Invalid Parameter\");\n      if (t.services && t.services.portal) return s(l, o, t.spatialReference, f, u, t.services.portal, t.lrucache, t.interceptor);\n      throw new Error(\"Portal is required\");\n    });\n  }, C.signatures.push({\n    name: \"featuresetbyportalitem\",\n    min: \"2\",\n    max: \"5\"\n  }), C.functions.featuresetbyname = function (e, t) {\n    return C.standardFunctionAsync(e, t, (e, t, n) => {\n      if (c(n, 2, 4), n[0] instanceof r) {\n        const e = m(n[1]);\n        let t = d(n[2], null);\n        const r = y(d(n[3], !0));\n        if (null === t && (t = [\"*\"]), !1 === g(t)) throw new Error(\"Invalid Parameter\");\n        return n[0].featureSetByName(e, r, t);\n      }\n\n      throw new Error(\"Invalid Parameter\");\n    });\n  }, C.signatures.push({\n    name: \"featuresetbyname\",\n    min: \"2\",\n    max: \"4\"\n  }), C.functions.featureset = function (e, n) {\n    return C.standardFunction(e, n, (n, r, i) => {\n      c(i, 1, 1);\n      let a = i[0];\n      const s = {\n        layerDefinition: {\n          geometryType: \"\",\n          objectIdField: \"\",\n          globalIdField: \"\",\n          typeIdField: \"\",\n          fields: []\n        },\n        featureSet: {\n          geometryType: \"\",\n          features: []\n        }\n      };\n      if (h(a)) a = JSON.parse(a), void 0 !== a.layerDefinition ? (s.layerDefinition = a.layerDefinition, s.featureSet = a.featureSet, a.layerDefinition.spatialReference && (s.layerDefinition.spatialReference = a.layerDefinition.spatialReference)) : (s.featureSet.features = a.features, s.featureSet.geometryType = a.geometryType, s.layerDefinition.geometryType = s.featureSet.geometryType, s.layerDefinition.objectIdField = a.objectIdFieldName, s.layerDefinition.typeIdField = a.typeIdFieldName, s.layerDefinition.globalIdField = a.globalIdFieldName, s.layerDefinition.fields = a.fields, a.spatialReference && (s.layerDefinition.spatialReference = a.spatialReference));else {\n        if (!(i[0] instanceof t)) throw new Error(\"Invalid Parameter\");\n        {\n          a = JSON.parse(i[0].castToText());\n          const e = z(a, \"layerdefinition\");\n\n          if (null !== e) {\n            s.layerDefinition.geometryType = z(e, \"geometrytype\", \"\"), s.featureSet.geometryType = s.layerDefinition.geometryType, s.layerDefinition.globalIdField = z(e, \"globalidfield\", \"\"), s.layerDefinition.objectIdField = z(e, \"objectidfield\", \"\"), s.layerDefinition.typeIdField = z(e, \"typeidfield\", \"\");\n            const t = z(e, \"spatialreference\", null);\n            t && (s.layerDefinition.spatialReference = W(t));\n\n            for (const r of z(e, \"fields\", [])) {\n              const e = {\n                name: z(r, \"name\", \"\"),\n                alias: z(r, \"alias\", \"\"),\n                type: z(r, \"type\", \"\"),\n                nullable: z(r, \"nullable\", !0),\n                editable: z(r, \"editable\", !0),\n                length: z(r, \"length\", null),\n                domain: U(z(r, \"domain\"))\n              };\n              s.layerDefinition.fields.push(e);\n            }\n\n            const n = z(a, \"featureset\", null);\n\n            if (n) {\n              const e = {};\n\n              for (const t of s.layerDefinition.fields) e[t.name.toLowerCase()] = t.name;\n\n              for (const t of z(n, \"features\", [])) {\n                const n = {},\n                      r = z(t, \"attributes\", {});\n\n                for (const t in r) n[e[t.toLowerCase()]] = r[t];\n\n                s.featureSet.features.push({\n                  attributes: n,\n                  geometry: _(z(t, \"geometry\", null))\n                });\n              }\n            }\n          } else {\n            s.layerDefinition.geometryType = z(a, \"geometrytype\", \"\"), s.featureSet.geometryType = s.layerDefinition.geometryType, s.layerDefinition.objectIdField = z(a, \"objectidfieldname\", \"\"), s.layerDefinition.typeIdField = z(a, \"typeidfieldname\", \"\");\n            const e = z(a, \"spatialreference\", null);\n            e && (s.layerDefinition.spatialReference = W(e));\n\n            for (const n of z(a, \"fields\", [])) {\n              const e = {\n                name: z(n, \"name\", \"\"),\n                alias: z(n, \"alias\", \"\"),\n                type: z(n, \"type\", \"\"),\n                nullable: z(n, \"nullable\", !0),\n                editable: z(n, \"editable\", !0),\n                length: z(n, \"length\", null),\n                domain: U(z(n, \"domain\"))\n              };\n              s.layerDefinition.fields.push(e);\n            }\n\n            const t = {};\n\n            for (const n of s.layerDefinition.fields) t[n.name.toLowerCase()] = n.name;\n\n            for (const n of z(a, \"features\", [])) {\n              const e = {},\n                    r = z(n, \"attributes\", {});\n\n              for (const n in r) e[t[n.toLowerCase()]] = r[n];\n\n              s.featureSet.features.push({\n                attributes: e,\n                geometry: _(z(n, \"geometry\", null))\n              });\n            }\n          }\n        }\n      }\n      if (!1 === J(s)) throw new Error(\"Invalid Parameter\");\n      return v.create(s, e.spatialReference);\n    });\n  }, C.signatures.push({\n    name: \"featureset\",\n    min: \"1\",\n    max: \"1\"\n  }), C.functions.filter = function (e, t) {\n    return C.standardFunctionAsync(e, t, (t, n, r) => (c(r, 2, 2), p(r[0]) ? r[0].load().then(t => {\n      const n = k.create(r[1], t.getFieldsIndex()),\n            i = n.getVariables();\n\n      if (i.length > 0) {\n        const t = [];\n\n        for (let n = 0; n < i.length; n++) {\n          const r = {\n            name: i[n]\n          };\n          t.push(C.evaluateIdentifier(e, r));\n        }\n\n        return P(t).then(e => {\n          const t = {};\n\n          for (let n = 0; n < i.length; n++) t[i[n]] = e[n];\n\n          return n.parameters = t, new S({\n            parentfeatureset: r[0],\n            whereclause: n\n          });\n        });\n      }\n\n      return M(new S({\n        parentfeatureset: r[0],\n        whereclause: n\n      }));\n    }) : C.failDefferred(\"Filter cannot accept this parameter type\")));\n  }, C.signatures.push({\n    name: \"filter\",\n    min: \"2\",\n    max: \"2\"\n  }), C.functions.orderby = function (e, t) {\n    return C.standardFunctionAsync(e, t, (e, t, n) => {\n      if (c(n, 2, 2), p(n[0])) {\n        const e = new j(n[1]);\n        return M(new $({\n          parentfeatureset: n[0],\n          orderbyclause: e\n        }));\n      }\n\n      return C.failDefferred(\"Order cannot accept this parameter type\");\n    });\n  }, C.signatures.push({\n    name: \"orderby\",\n    min: \"2\",\n    max: \"2\"\n  }), C.functions.top = function (e, t) {\n    return C.standardFunctionAsync(e, t, (e, t, n) => (c(n, 2, 2), p(n[0]) ? M(new T({\n      parentfeatureset: n[0],\n      topnum: n[1]\n    })) : g(n[0]) ? F(n[1]) >= n[0].length ? n[0].slice(0) : n[0].slice(0, F(n[1])) : I(n[0]) ? F(n[1]) >= n[0].length() ? n[0].slice(0) : n[0].slice(0, F(n[1])) : C.failDefferred(\"Top cannot accept this parameter type\")));\n  }, C.signatures.push({\n    name: \"top\",\n    min: \"2\",\n    max: \"2\"\n  }), C.functions.first = function (e, t) {\n    return C.standardFunctionAsync(e, t, (e, t, r) => (c(r, 1, 1), p(r[0]) ? r[0].first(e.abortSignal).then(e => {\n      if (null !== e) {\n        const t = n.createFromGraphicLikeObject(e.geometry, e.attributes, r[0]);\n        t._underlyingGraphic = e, e = t;\n      }\n\n      return e;\n    }) : g(r[0]) ? 0 === r[0].length ? M(null) : M(r[0][0]) : I(r[0]) ? 0 === r[0].length() ? M(null) : M(r[0].get(0)) : null));\n  }, C.signatures.push({\n    name: \"first\",\n    min: \"1\",\n    max: \"1\"\n  }), C.functions.attachments = function (e, r) {\n    return C.standardFunctionAsync(e, r, (r, i, a) => {\n      c(a, 1, 2);\n      const s = {\n        minsize: -1,\n        maxsize: -1,\n        types: null\n      };\n      if (a.length > 1) if (a[1] instanceof t) {\n        if (a[1].hasField(\"minsize\") && (s.minsize = F(a[1].field(\"minsize\"))), a[1].hasField(\"maxsize\") && (s.maxsize = F(a[1].field(\"maxsize\"))), a[1].hasField(\"types\")) {\n          const e = E(a[1].field(\"types\"), !1);\n          e.length > 0 && (s.types = e);\n        }\n      } else if (null !== a[1]) throw new Error(\"Invalid Parameter\");\n\n      if (a[0] instanceof n) {\n        let t = a[0]._layer;\n        return t instanceof G && (t = l(t, e.spatialReference, [\"*\"], !0, e.lrucache, e.interceptor)), null === t || !1 === p(t) ? [] : t.load().then(() => t.queryAttachments(a[0].field(t.objectIdField), s.minsize, s.maxsize, s.types));\n      }\n\n      if (null === a[0]) return [];\n      throw new Error(\"Invalid Parameter\");\n    });\n  }, C.signatures.push({\n    name: \"attachments\",\n    min: \"1\",\n    max: \"2\"\n  }), C.functions.featuresetbyrelationshipname = function (e, t) {\n    return C.standardFunctionAsync(e, t, (t, r, i) => {\n      c(i, 2, 4);\n      const a = i[0],\n            s = m(i[1]);\n      let u = d(i[2], null);\n      const h = y(d(i[3], !0));\n      if (null === u && (u = [\"*\"]), !1 === g(u)) throw new Error(\"Invalid Parameter\");\n      if (null === i[0]) return null;\n      if (!(i[0] instanceof n)) throw new Error(\"Invalid Parameter\");\n      let F = a._layer;\n      return F instanceof G && (F = l(F, e.spatialReference, [\"*\"], !0, e.lrucache, e.interceptor)), null === F || !1 === p(F) ? null : F.load().then(t => {\n        const n = t.relationshipMetaData().filter(e => e.name === s);\n        if (0 === n.length) return null;\n        if (void 0 !== n[0].relationshipTableId && null !== n[0].relationshipTableId && n[0].relationshipTableId > -1) return o(t, n[0], a.field(t.objectIdField), t.spatialReference, u, h, e.lrucache, e.interceptor);\n        let r = t.serviceUrl();\n        return r ? (r = \"/\" === r.charAt(r.length - 1) ? r + n[0].relatedTableId.toString() : r + \"/\" + n[0].relatedTableId.toString(), f(r, t.spatialReference, u, h, e.lrucache, e.interceptor).then(e => e.load().then(() => e.relationshipMetaData()).then(r => {\n          if (r = r.filter(e => e.id === n[0].id), !1 === a.hasField(n[0].keyField) || null === a.field(n[0].keyField)) return t.getFeatureByObjectId(a.field(t.objectIdField), [n[0].keyField]).then(t => {\n            if (t) {\n              const i = k.create(r[0].keyField + \"= @id\", e.getFieldsIndex());\n              return i.parameters = {\n                id: t.attributes[n[0].keyField]\n              }, e.filter(i);\n            }\n\n            return new L({\n              parentfeatureset: e\n            });\n          });\n          const i = k.create(r[0].keyField + \"= @id\", e.getFieldsIndex());\n          return i.parameters = {\n            id: a.field(n[0].keyField)\n          }, e.filter(i);\n        }))) : null;\n      });\n    });\n  }, C.signatures.push({\n    name: \"featuresetbyrelationshipname\",\n    min: \"2\",\n    max: \"4\"\n  }), C.functions.featuresetbyassociation = function (e, t) {\n    return C.standardFunctionAsync(e, t, (t, r, i) => {\n      c(i, 2, 3);\n      const a = i[0],\n            s = m(d(i[1], \"\")).toLowerCase(),\n            o = h(i[2]) ? m(i[2]) : null;\n      if (null === i[0]) return null;\n      if (!(i[0] instanceof n)) throw new Error(\"Invalid Parameter\");\n      let f = a._layer;\n      return f instanceof G && (f = l(f, e.spatialReference, [\"*\"], !0, e.lrucache, e.interceptor)), null === f || !1 === p(f) ? null : f.load().then(() => {\n        const t = f.serviceUrl();\n        return u(t, e.spatialReference);\n      }).then(e => {\n        let t = null,\n            n = null,\n            r = !1;\n\n        if (null !== o && \"\" !== o && void 0 !== o) {\n          for (const t of e.terminals) t.terminalName === o && (n = t.terminalId);\n\n          null === n && (r = !0);\n        }\n\n        const i = e.associations.getFieldsIndex(),\n              l = i.get(\"TOGLOBALID\").name,\n              u = i.get(\"FROMGLOBALID\").name,\n              c = i.get(\"TOTERMINALID\").name,\n              d = i.get(\"FROMTERMINALID\").name,\n              m = i.get(\"FROMNETWORKSOURCEID\").name,\n              p = i.get(\"TONETWORKSOURCEID\").name,\n              y = i.get(\"ASSOCIATIONTYPE\").name,\n              g = i.get(\"ISCONTENTVISIBLE\").name,\n              h = i.get(\"OBJECTID\").name;\n\n        for (const s of f.fields) if (\"global-id\" === s.type) {\n          t = a.field(s.name);\n          break;\n        }\n\n        let F = null,\n            I = new w(new B({\n          name: \"percentalong\",\n          alias: \"percentalong\",\n          type: \"double\"\n        }), k.create(\"0\", e.associations.getFieldsIndex())),\n            E = new w(new B({\n          name: \"side\",\n          alias: \"side\",\n          type: \"string\"\n        }), k.create(\"''\", e.associations.getFieldsIndex()));\n        const S = \"globalid\",\n              $ = \"globalId\",\n              T = {};\n\n        for (const a in e.lkp) T[a] = e.lkp[a].sourceId;\n\n        const L = new b(new B({\n          name: \"classname\",\n          alias: \"classname\",\n          type: \"string\"\n        }), null, T);\n        let v = \"\";\n\n        switch (s) {\n          case \"midspan\":\n            {\n              v = `((${l}='${t}') OR ( ${u}='${t}')) AND (${y} IN (5))`, L.codefield = k.create(`CASE WHEN (${l}='${t}') THEN ${m} ELSE ${p} END`, e.associations.getFieldsIndex());\n              const n = O(N.findField(e.associations.fields, u));\n              n.name = S, n.alias = S, F = new w(n, k.create(`CASE WHEN (${u}='${t}') THEN ${l} ELSE ${u} END`, e.associations.getFieldsIndex())), I = e.unVersion >= 4 ? new x(N.findField(e.associations.fields, i.get(\"PERCENTALONG\").name)) : new w(new B({\n                name: \"percentalong\",\n                alias: \"percentalong\",\n                type: \"double\"\n              }), k.create(\"0\", e.associations.getFieldsIndex()));\n              break;\n            }\n\n          case \"junctionedge\":\n            {\n              v = `((${l}='${t}') OR ( ${u}='${t}')) AND (${y} IN (4,6))`, L.codefield = k.create(`CASE WHEN (${l}='${t}') THEN ${m} ELSE ${p} END`, e.associations.getFieldsIndex());\n              const n = O(N.findField(e.associations.fields, u));\n              n.name = S, n.alias = S, F = new w(n, k.create(`CASE WHEN (${u}='${t}') THEN ${l} ELSE ${u} END`, e.associations.getFieldsIndex())), E = new w(new B({\n                name: \"side\",\n                alias: \"side\",\n                type: \"string\"\n              }), k.create(`CASE WHEN (${y}=4) THEN 'from' ELSE 'to' END`, e.associations.getFieldsIndex()));\n              break;\n            }\n\n          case \"connected\":\n            {\n              let r = `${l}='@T'`,\n                  i = `${u}='@T'`;\n              null !== n && (r += ` AND ${c}=@A`, i += ` AND ${d}=@A`), v = \"((\" + r + \") OR (\" + i + \"))\", v = D(v, \"@T\", t), r = D(r, \"@T\", t), null !== n && (r = D(r, \"@A\", n.toString()), v = D(v, \"@A\", n.toString())), L.codefield = k.create(\"CASE WHEN \" + r + ` THEN ${m} ELSE ${p} END`, e.associations.getFieldsIndex());\n              const a = O(N.findField(e.associations.fields, u));\n              a.name = S, a.alias = S, F = new w(a, k.create(\"CASE WHEN \" + r + ` THEN ${u} ELSE ${l} END`, e.associations.getFieldsIndex()));\n              break;\n            }\n\n          case \"container\":\n            v = `${l}='${t}' AND ${y} = 2`, null !== n && (v += ` AND ${c} = ` + n.toString()), L.codefield = m, v = \"( \" + v + \" )\", F = new A(N.findField(e.associations.fields, u), S, S);\n\n          case \"content\":\n            v = `(${u}='${t}' AND ${y} = 2)`, null !== n && (v += ` AND ${d} = ` + n.toString()), L.codefield = p, v = \"( \" + v + \" )\", F = new A(N.findField(e.associations.fields, l), S, S);\n            break;\n\n          case \"structure\":\n            v = `(${l}='${t}' AND ${y} = 3)`, null !== n && (v += ` AND ${c} = ` + n.toString()), L.codefield = m, v = \"( \" + v + \" )\", F = new A(N.findField(e.associations.fields, u), S, $);\n            break;\n\n          case \"attached\":\n            v = `(${u}='${t}' AND ${y} = 3)`, null !== n && (v += ` AND ${d} = ` + n.toString()), L.codefield = p, v = \"( \" + v + \" )\", F = new A(N.findField(e.associations.fields, l), S, $);\n            break;\n\n          default:\n            throw new Error(\"Invalid Parameter\");\n        }\n\n        r && (v = \"1 <> 1\");\n        return new N({\n          parentfeatureset: e.associations,\n          adaptedFields: [new x(N.findField(e.associations.fields, h)), new x(N.findField(e.associations.fields, g)), F, E, L, I],\n          extraFilter: v ? k.create(v, e.associations.getFieldsIndex()) : null\n        });\n      });\n    });\n  }, C.signatures.push({\n    name: \"featuresetbyassociation\",\n    min: \"2\",\n    max: \"6\"\n  }), C.functions.groupby = function (e, n) {\n    return C.standardFunctionAsync(e, n, (n, r, i) => (c(i, 3, 3), p(i[0]) ? i[0].load().then(n => {\n      const r = [],\n            a = [];\n      let s = !1,\n          l = [];\n      if (h(i[1])) l.push(i[1]);else if (i[1] instanceof t) l.push(i[1]);else if (g(i[1])) l = i[1];else {\n        if (!I(i[1])) return C.failDefferred(\"Illegal Value: GroupBy\");\n        l = i[1].toArray();\n      }\n\n      for (const e of l) if (h(e)) {\n        const t = k.create(m(e), n.getFieldsIndex()),\n              i = !0 === R(t) ? m(e) : \"%%%%FIELDNAME\";\n        r.push({\n          name: i,\n          expression: t\n        }), \"%%%%FIELDNAME\" === i && (s = !0);\n      } else {\n        if (!(e instanceof t)) return C.failDefferred(\"Illegal Value: GroupBy\");\n        {\n          const t = e.hasField(\"name\") ? e.field(\"name\") : \"%%%%FIELDNAME\",\n                i = e.hasField(\"expression\") ? e.field(\"expression\") : \"\";\n          if (\"%%%%FIELDNAME\" === t && (s = !0), !t) return C.failDefferred(\"Illegal Value: GroupBy\");\n          r.push({\n            name: t,\n            expression: k.create(i || t, n.getFieldsIndex())\n          });\n        }\n      }\n\n      if (l = [], h(i[2])) l.push(i[2]);else if (g(i[2])) l = i[2];else if (I(i[2])) l = i[2].toArray();else {\n        if (!(i[2] instanceof t)) return C.failDefferred(\"Illegal Value: GroupBy\");\n        l.push(i[2]);\n      }\n\n      for (const e of l) {\n        if (!(e instanceof t)) return C.failDefferred(\"Illegal Value: GroupBy\");\n        {\n          const t = e.hasField(\"name\") ? e.field(\"name\") : \"\",\n                r = e.hasField(\"statistic\") ? e.field(\"statistic\") : \"\",\n                i = e.hasField(\"expression\") ? e.field(\"expression\") : \"\";\n          if (!t || !r || !i) return C.failDefferred(\"Illegal Value: GroupBy\");\n          a.push({\n            name: t,\n            statistic: r.toLowerCase(),\n            expression: k.create(i, n.getFieldsIndex())\n          });\n        }\n      }\n\n      if (s) {\n        const e = {};\n\n        for (const r of n.fields) e[r.name.toLowerCase()] = 1;\n\n        for (const n of r) \"%%%%FIELDNAME\" !== n.name && (e[n.name.toLowerCase()] = 1);\n\n        for (const n of a) \"%%%%FIELDNAME\" !== n.name && (e[n.name.toLowerCase()] = 1);\n\n        let t = 0;\n\n        for (const n of r) if (\"%%%%FIELDNAME\" === n.name) {\n          for (; 1 === e[\"field_\" + t.toString()];) t++;\n\n          e[\"field_\" + t.toString()] = 1, n.name = \"FIELD_\" + t.toString();\n        }\n      }\n\n      const o = [];\n\n      for (const t of r) o.push(H(t.expression, C, e));\n\n      for (const t of a) o.push(H(t.expression, C, e));\n\n      return o.length > 0 ? P(o).then(() => M(i[0].groupby(r, a))) : M(i[0].groupby(r, a));\n    }) : C.failDefferred(\"Illegal Value: GroupBy\")));\n  }, C.signatures.push({\n    name: \"groupby\",\n    min: \"3\",\n    max: \"3\"\n  }), C.functions.distinct = function (e, n) {\n    return C.standardFunctionAsync(e, n, (n, r, i) => p(i[0]) ? (c(i, 2, 2), i[0].load().then(n => {\n      const r = [];\n      let a = [];\n      if (h(i[1])) a.push(i[1]);else if (i[1] instanceof t) a.push(i[1]);else if (g(i[1])) a = i[1];else {\n        if (!I(i[1])) return C.failDefferred(\"Illegal Value: GroupBy\");\n        a = i[1].toArray();\n      }\n      let s = !1;\n\n      for (const e of a) if (h(e)) {\n        const t = k.create(m(e), n.getFieldsIndex()),\n              i = !0 === R(t) ? m(e) : \"%%%%FIELDNAME\";\n        r.push({\n          name: i,\n          expression: t\n        }), \"%%%%FIELDNAME\" === i && (s = !0);\n      } else {\n        if (!(e instanceof t)) return C.failDefferred(\"Illegal Value: GroupBy\");\n        {\n          const t = e.hasField(\"name\") ? e.field(\"name\") : \"%%%%FIELDNAME\",\n                i = e.hasField(\"expression\") ? e.field(\"expression\") : \"\";\n          if (\"%%%%FIELDNAME\" === t && (s = !0), !t) return C.failDefferred(\"Illegal Value: GroupBy\");\n          r.push({\n            name: t,\n            expression: k.create(i || t, n.getFieldsIndex())\n          });\n        }\n      }\n\n      if (s) {\n        const e = {};\n\n        for (const r of n.fields) e[r.name.toLowerCase()] = 1;\n\n        for (const n of r) \"%%%%FIELDNAME\" !== n.name && (e[n.name.toLowerCase()] = 1);\n\n        let t = 0;\n\n        for (const n of r) if (\"%%%%FIELDNAME\" === n.name) {\n          for (; 1 === e[\"field_\" + t.toString()];) t++;\n\n          e[\"field_\" + t.toString()] = 1, n.name = \"FIELD_\" + t.toString();\n        }\n      }\n\n      const l = [];\n\n      for (const t of r) l.push(H(t.expression, C, e));\n\n      return l.length > 0 ? P(l).then(() => M(i[0].groupby(r, []))) : M(i[0].groupby(r, []));\n    })) : V(\"distinct\", n, r, i));\n  });\n}\n\nexport { K as registerFunctions };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/arcade/functions/featuresetbase.js"],"names":["e","t","n","r","getPortal","i","lookupUser","a","constructFeatureSetFromPortalItem","s","constructFeatureSet","l","constructFeatureSetFromRelationship","o","constructFeatureSetFromUrl","f","constructAssociationMetaDataFeatureSetFromUrl","u","p","c","C","d","m","q","y","g","h","F","b","I","T","E","L","D","SqlExpressionAdapted","w","StringToCodeAdapted","FieldRename","A","AdaptedFeatureSet","N","OriginalField","x","S","$","v","j","cloneField","O","isSingleField","R","calculateStat","all","P","resolve","M","WhereClause","k","G","B","V","length","toArray","H","getVariables","name","push","evaluateIdentifier","then","parameters","z","toLowerCase","U","type","range","codedValues","code","W","wkt","wkid","_","hasZ","hasM","spatialReference","rings","paths","points","J","layerDefinition","featureSet","geometryType","objectIdField","fields","features","K","mode","functions","getuser","standardFunctionAsync","services","portal","JSON","parse","stringify","Date","convertObjectToArcadeDictionary","load","getOwningSystemUrl","getIdentityUser","username","Error","signatures","min","max","featuresetbyid","featureSetById","featuresetbyportalitem","lrucache","interceptor","featuresetbyname","featureSetByName","featureset","standardFunction","globalIdField","typeIdField","objectIdFieldName","typeIdFieldName","globalIdFieldName","castToText","alias","nullable","editable","domain","attributes","geometry","create","filter","getFieldsIndex","parentfeatureset","whereclause","failDefferred","orderby","orderbyclause","top","topnum","slice","first","abortSignal","createFromGraphicLikeObject","_underlyingGraphic","get","attachments","minsize","maxsize","types","hasField","field","_layer","queryAttachments","featuresetbyrelationshipname","relationshipMetaData","relationshipTableId","serviceUrl","charAt","relatedTableId","toString","id","keyField","getFeatureByObjectId","featuresetbyassociation","terminals","terminalName","terminalId","associations","lkp","sourceId","codefield","findField","unVersion","adaptedFields","extraFilter","groupby","expression","statistic","distinct","registerFunctions"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../ArcadePortal.js\";import t from\"../Dictionary.js\";import n from\"../Feature.js\";import r from\"../featureSetCollection.js\";import{getPortal as i,lookupUser as a,constructFeatureSetFromPortalItem as s,constructFeatureSet as l,constructFeatureSetFromRelationship as o,constructFeatureSetFromUrl as f,constructAssociationMetaDataFeatureSetFromUrl as u}from\"../featureSetUtils.js\";import{p as c,C as d,d as m,q as p,u as y,a as g,g as h,t as F,b as I,T as E,L as D}from\"../../chunks/languageUtils.js\";import{SqlExpressionAdapted as w,StringToCodeAdapted as b,FieldRename as A,AdaptedFeatureSet as N,OriginalField as x}from\"../featureset/actions/Adapted.js\";import S from\"../featureset/actions/AttributeFilter.js\";import $ from\"../featureset/actions/OrderBy.js\";import T from\"../featureset/actions/Top.js\";import L from\"../featureset/sources/Empty.js\";import v from\"../featureset/sources/FeatureLayerMemory.js\";import j from\"../featureset/support/OrderbyClause.js\";import{cloneField as O}from\"../featureset/support/shared.js\";import{isSingleField as R}from\"../featureset/support/sqlUtils.js\";import{calculateStat as C}from\"./fieldStats.js\";import{all as P,resolve as M}from\"../../core/promiseUtils.js\";import{WhereClause as k}from\"../../core/sql/WhereClause.js\";import G from\"../../layers/FeatureLayer.js\";import B from\"../../layers/support/Field.js\";function V(e,t,n,r){if(1===r.length){if(g(r[0]))return C(e,r[0],-1);if(I(r[0]))return C(e,r[0].toArray(),-1)}return C(e,r,-1)}function H(e,t,n){const r=e.getVariables();if(r.length>0){const i=[];for(let e=0;e<r.length;e++){const a={name:r[e]};i.push(t.evaluateIdentifier(n,a))}return P(i).then((t=>{const n={};for(let e=0;e<r.length;e++)n[r[e]]=t[e];return e.parameters=n,e}))}return M(e)}function z(e,t,n=null){for(const r in e)if(r.toLowerCase()===t.toLowerCase())return e[r];return n}function U(e){if(null===e)return null;const t={type:z(e,\"type\",\"\"),name:z(e,\"name\",\"\")};if(\"range\"===t.type)t.range=z(e,\"range\",[]);else{t.codedValues=[];for(const n of z(e,\"codedValues\",[]))t.codedValues.push({name:z(n,\"name\",\"\"),code:z(n,\"code\",null)})}return t}function W(e){if(null===e)return null;const t={},n=z(e,\"wkt\",null);null!==n&&(t.wkt=n);const r=z(e,\"wkid\",null);return null!==r&&(t.wkid=r),t}function _(e){if(null===e)return null;const t={hasZ:z(e,\"hasz\",!1),hasM:z(e,\"hasm\",!1)},n=z(e,\"spatialreference\",null);n&&(t.spatialReference=W(n));const r=z(e,\"x\",null);if(null!==r)return t.x=r,t.y=z(e,\"y\",null),t;const i=z(e,\"rings\",null);if(null!==i)return t.rings=i,t;const a=z(e,\"paths\",null);if(null!==a)return t.paths=a,t;const s=z(e,\"points\",null);if(null!==s)return t.points=s,t;for(const l of[\"xmin\",\"xmax\",\"ymin\",\"ymax\",\"zmin\",\"zmax\",\"mmin\",\"mmax\"]){const n=z(e,l,null);null!==n&&(t[l]=n)}return t}function q(e,t){for(const n of t)if(n===e)return!0;return!1}function J(e){return!!e.layerDefinition&&(!!e.featureSet&&(!1!==q(e.layerDefinition.geometryType,[\"\",\"esriGeometryPoint\",\"esriGeometryPolyline\",\"esriGeometryPolygon\",\"esriGeometryMultipoint\",\"esriGeometryEnvelope\"])&&(null!==e.layerDefinition.objectIdField&&\"\"!==e.layerDefinition.objectIdField&&(!1!==g(e.layerDefinition.fields)&&!1!==g(e.featureSet.features)))))}function K(C){\"async\"===C.mode&&(C.functions.getuser=function(n,r){return C.standardFunctionAsync(n,r,((r,s,l)=>{c(l,1,2);let o=d(l[1],\"\"),f=!0===o;if(o=!0===o||!1===o?\"\":m(o),l[0]instanceof e){let e=null;return n.services&&n.services.portal&&(e=n.services.portal),e=i(l[0],e),a(e,o,f).then((e=>{if(e){const n=JSON.parse(JSON.stringify(e));for(const e of[\"lastLogin\",\"created\",\"modified\"])void 0!==n[e]&&null!==n[e]&&(n[e]=new Date(n[e]));return t.convertObjectToArcadeDictionary(n)}return null}))}let u=null;if(p(l[0])&&(u=l[0]),u)return f=!1,o?null:u.load().then((()=>u.getOwningSystemUrl())).then((r=>{if(!r)return o?null:u.getIdentityUser().then((e=>e?t.convertObjectToArcadeDictionary({username:e}):null));let s=null;return n.services&&n.services.portal&&(s=n.services.portal),s=i(new e(r),s),a(s,o,f).then((e=>{if(e){const n=JSON.parse(JSON.stringify(e));for(const e of[\"lastLogin\",\"created\",\"modified\"])void 0!==n[e]&&null!==n[e]&&(n[e]=new Date(n[e]));return t.convertObjectToArcadeDictionary(n)}return null}))}));throw new Error(\"Invalid Parameter\")}))},C.signatures.push({name:\"getuser\",min:\"1\",max:\"2\"}),C.functions.featuresetbyid=function(e,t){return C.standardFunctionAsync(e,t,((e,t,n)=>{if(c(n,2,4),n[0]instanceof r){const e=m(n[1]);let t=d(n[2],null);const r=y(d(n[3],!0));if(null===t&&(t=[\"*\"]),!1===g(t))throw new Error(\"Invalid Parameter\");return n[0].featureSetById(e,r,t)}throw new Error(\"Invalid Parameter\")}))},C.signatures.push({name:\"featuresetbyid\",min:\"2\",max:\"4\"}),C.functions.featuresetbyportalitem=function(t,n){return C.standardFunctionAsync(t,n,((n,r,a)=>{if(c(a,2,5),null===a[0])throw new Error(\"Portal is required\");if(a[0]instanceof e){const e=m(a[1]),n=m(a[2]);let r=d(a[3],null);const l=y(d(a[4],!0));if(null===r&&(r=[\"*\"]),!1===g(r))throw new Error(\"Invalid Parameter\");let o=null;return t.services&&t.services.portal&&(o=t.services.portal),o=i(a[0],o),s(e,n,t.spatialReference,r,l,o,t.lrucache,t.interceptor)}if(!1===h(a[0]))throw new Error(\"Portal is required\");const l=m(a[0]),o=m(a[1]);let f=d(a[2],null);const u=y(d(a[3],!0));if(null===f&&(f=[\"*\"]),!1===g(f))throw new Error(\"Invalid Parameter\");if(t.services&&t.services.portal)return s(l,o,t.spatialReference,f,u,t.services.portal,t.lrucache,t.interceptor);throw new Error(\"Portal is required\")}))},C.signatures.push({name:\"featuresetbyportalitem\",min:\"2\",max:\"5\"}),C.functions.featuresetbyname=function(e,t){return C.standardFunctionAsync(e,t,((e,t,n)=>{if(c(n,2,4),n[0]instanceof r){const e=m(n[1]);let t=d(n[2],null);const r=y(d(n[3],!0));if(null===t&&(t=[\"*\"]),!1===g(t))throw new Error(\"Invalid Parameter\");return n[0].featureSetByName(e,r,t)}throw new Error(\"Invalid Parameter\")}))},C.signatures.push({name:\"featuresetbyname\",min:\"2\",max:\"4\"}),C.functions.featureset=function(e,n){return C.standardFunction(e,n,((n,r,i)=>{c(i,1,1);let a=i[0];const s={layerDefinition:{geometryType:\"\",objectIdField:\"\",globalIdField:\"\",typeIdField:\"\",fields:[]},featureSet:{geometryType:\"\",features:[]}};if(h(a))a=JSON.parse(a),void 0!==a.layerDefinition?(s.layerDefinition=a.layerDefinition,s.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(s.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(s.featureSet.features=a.features,s.featureSet.geometryType=a.geometryType,s.layerDefinition.geometryType=s.featureSet.geometryType,s.layerDefinition.objectIdField=a.objectIdFieldName,s.layerDefinition.typeIdField=a.typeIdFieldName,s.layerDefinition.globalIdField=a.globalIdFieldName,s.layerDefinition.fields=a.fields,a.spatialReference&&(s.layerDefinition.spatialReference=a.spatialReference));else{if(!(i[0]instanceof t))throw new Error(\"Invalid Parameter\");{a=JSON.parse(i[0].castToText());const e=z(a,\"layerdefinition\");if(null!==e){s.layerDefinition.geometryType=z(e,\"geometrytype\",\"\"),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.globalIdField=z(e,\"globalidfield\",\"\"),s.layerDefinition.objectIdField=z(e,\"objectidfield\",\"\"),s.layerDefinition.typeIdField=z(e,\"typeidfield\",\"\");const t=z(e,\"spatialreference\",null);t&&(s.layerDefinition.spatialReference=W(t));for(const r of z(e,\"fields\",[])){const e={name:z(r,\"name\",\"\"),alias:z(r,\"alias\",\"\"),type:z(r,\"type\",\"\"),nullable:z(r,\"nullable\",!0),editable:z(r,\"editable\",!0),length:z(r,\"length\",null),domain:U(z(r,\"domain\"))};s.layerDefinition.fields.push(e)}const n=z(a,\"featureset\",null);if(n){const e={};for(const t of s.layerDefinition.fields)e[t.name.toLowerCase()]=t.name;for(const t of z(n,\"features\",[])){const n={},r=z(t,\"attributes\",{});for(const t in r)n[e[t.toLowerCase()]]=r[t];s.featureSet.features.push({attributes:n,geometry:_(z(t,\"geometry\",null))})}}}else{s.layerDefinition.geometryType=z(a,\"geometrytype\",\"\"),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=z(a,\"objectidfieldname\",\"\"),s.layerDefinition.typeIdField=z(a,\"typeidfieldname\",\"\");const e=z(a,\"spatialreference\",null);e&&(s.layerDefinition.spatialReference=W(e));for(const n of z(a,\"fields\",[])){const e={name:z(n,\"name\",\"\"),alias:z(n,\"alias\",\"\"),type:z(n,\"type\",\"\"),nullable:z(n,\"nullable\",!0),editable:z(n,\"editable\",!0),length:z(n,\"length\",null),domain:U(z(n,\"domain\"))};s.layerDefinition.fields.push(e)}const t={};for(const n of s.layerDefinition.fields)t[n.name.toLowerCase()]=n.name;for(const n of z(a,\"features\",[])){const e={},r=z(n,\"attributes\",{});for(const n in r)e[t[n.toLowerCase()]]=r[n];s.featureSet.features.push({attributes:e,geometry:_(z(n,\"geometry\",null))})}}}}if(!1===J(s))throw new Error(\"Invalid Parameter\");return v.create(s,e.spatialReference)}))},C.signatures.push({name:\"featureset\",min:\"1\",max:\"1\"}),C.functions.filter=function(e,t){return C.standardFunctionAsync(e,t,((t,n,r)=>(c(r,2,2),p(r[0])?r[0].load().then((t=>{const n=k.create(r[1],t.getFieldsIndex()),i=n.getVariables();if(i.length>0){const t=[];for(let n=0;n<i.length;n++){const r={name:i[n]};t.push(C.evaluateIdentifier(e,r))}return P(t).then((e=>{const t={};for(let n=0;n<i.length;n++)t[i[n]]=e[n];return n.parameters=t,new S({parentfeatureset:r[0],whereclause:n})}))}return M(new S({parentfeatureset:r[0],whereclause:n}))})):C.failDefferred(\"Filter cannot accept this parameter type\"))))},C.signatures.push({name:\"filter\",min:\"2\",max:\"2\"}),C.functions.orderby=function(e,t){return C.standardFunctionAsync(e,t,((e,t,n)=>{if(c(n,2,2),p(n[0])){const e=new j(n[1]);return M(new $({parentfeatureset:n[0],orderbyclause:e}))}return C.failDefferred(\"Order cannot accept this parameter type\")}))},C.signatures.push({name:\"orderby\",min:\"2\",max:\"2\"}),C.functions.top=function(e,t){return C.standardFunctionAsync(e,t,((e,t,n)=>(c(n,2,2),p(n[0])?M(new T({parentfeatureset:n[0],topnum:n[1]})):g(n[0])?F(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,F(n[1])):I(n[0])?F(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,F(n[1])):C.failDefferred(\"Top cannot accept this parameter type\"))))},C.signatures.push({name:\"top\",min:\"2\",max:\"2\"}),C.functions.first=function(e,t){return C.standardFunctionAsync(e,t,((e,t,r)=>(c(r,1,1),p(r[0])?r[0].first(e.abortSignal).then((e=>{if(null!==e){const t=n.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e})):g(r[0])?0===r[0].length?M(null):M(r[0][0]):I(r[0])?0===r[0].length()?M(null):M(r[0].get(0)):null)))},C.signatures.push({name:\"first\",min:\"1\",max:\"1\"}),C.functions.attachments=function(e,r){return C.standardFunctionAsync(e,r,((r,i,a)=>{c(a,1,2);const s={minsize:-1,maxsize:-1,types:null};if(a.length>1)if(a[1]instanceof t){if(a[1].hasField(\"minsize\")&&(s.minsize=F(a[1].field(\"minsize\"))),a[1].hasField(\"maxsize\")&&(s.maxsize=F(a[1].field(\"maxsize\"))),a[1].hasField(\"types\")){const e=E(a[1].field(\"types\"),!1);e.length>0&&(s.types=e)}}else if(null!==a[1])throw new Error(\"Invalid Parameter\");if(a[0]instanceof n){let t=a[0]._layer;return t instanceof G&&(t=l(t,e.spatialReference,[\"*\"],!0,e.lrucache,e.interceptor)),null===t||!1===p(t)?[]:t.load().then((()=>t.queryAttachments(a[0].field(t.objectIdField),s.minsize,s.maxsize,s.types)))}if(null===a[0])return[];throw new Error(\"Invalid Parameter\")}))},C.signatures.push({name:\"attachments\",min:\"1\",max:\"2\"}),C.functions.featuresetbyrelationshipname=function(e,t){return C.standardFunctionAsync(e,t,((t,r,i)=>{c(i,2,4);const a=i[0],s=m(i[1]);let u=d(i[2],null);const h=y(d(i[3],!0));if(null===u&&(u=[\"*\"]),!1===g(u))throw new Error(\"Invalid Parameter\");if(null===i[0])return null;if(!(i[0]instanceof n))throw new Error(\"Invalid Parameter\");let F=a._layer;return F instanceof G&&(F=l(F,e.spatialReference,[\"*\"],!0,e.lrucache,e.interceptor)),null===F||!1===p(F)?null:F.load().then((t=>{const n=t.relationshipMetaData().filter((e=>e.name===s));if(0===n.length)return null;if(void 0!==n[0].relationshipTableId&&null!==n[0].relationshipTableId&&n[0].relationshipTableId>-1)return o(t,n[0],a.field(t.objectIdField),t.spatialReference,u,h,e.lrucache,e.interceptor);let r=t.serviceUrl();return r?(r=\"/\"===r.charAt(r.length-1)?r+n[0].relatedTableId.toString():r+\"/\"+n[0].relatedTableId.toString(),f(r,t.spatialReference,u,h,e.lrucache,e.interceptor).then((e=>e.load().then((()=>e.relationshipMetaData())).then((r=>{if(r=r.filter((e=>e.id===n[0].id)),!1===a.hasField(n[0].keyField)||null===a.field(n[0].keyField))return t.getFeatureByObjectId(a.field(t.objectIdField),[n[0].keyField]).then((t=>{if(t){const i=k.create(r[0].keyField+\"= @id\",e.getFieldsIndex());return i.parameters={id:t.attributes[n[0].keyField]},e.filter(i)}return new L({parentfeatureset:e})}));const i=k.create(r[0].keyField+\"= @id\",e.getFieldsIndex());return i.parameters={id:a.field(n[0].keyField)},e.filter(i)}))))):null}))}))},C.signatures.push({name:\"featuresetbyrelationshipname\",min:\"2\",max:\"4\"}),C.functions.featuresetbyassociation=function(e,t){return C.standardFunctionAsync(e,t,((t,r,i)=>{c(i,2,3);const a=i[0],s=m(d(i[1],\"\")).toLowerCase(),o=h(i[2])?m(i[2]):null;if(null===i[0])return null;if(!(i[0]instanceof n))throw new Error(\"Invalid Parameter\");let f=a._layer;return f instanceof G&&(f=l(f,e.spatialReference,[\"*\"],!0,e.lrucache,e.interceptor)),null===f||!1===p(f)?null:f.load().then((()=>{const t=f.serviceUrl();return u(t,e.spatialReference)})).then((e=>{let t=null,n=null,r=!1;if(null!==o&&\"\"!==o&&void 0!==o){for(const t of e.terminals)t.terminalName===o&&(n=t.terminalId);null===n&&(r=!0)}const i=e.associations.getFieldsIndex(),l=i.get(\"TOGLOBALID\").name,u=i.get(\"FROMGLOBALID\").name,c=i.get(\"TOTERMINALID\").name,d=i.get(\"FROMTERMINALID\").name,m=i.get(\"FROMNETWORKSOURCEID\").name,p=i.get(\"TONETWORKSOURCEID\").name,y=i.get(\"ASSOCIATIONTYPE\").name,g=i.get(\"ISCONTENTVISIBLE\").name,h=i.get(\"OBJECTID\").name;for(const s of f.fields)if(\"global-id\"===s.type){t=a.field(s.name);break}let F=null,I=new w(new B({name:\"percentalong\",alias:\"percentalong\",type:\"double\"}),k.create(\"0\",e.associations.getFieldsIndex())),E=new w(new B({name:\"side\",alias:\"side\",type:\"string\"}),k.create(\"''\",e.associations.getFieldsIndex()));const S=\"globalid\",$=\"globalId\",T={};for(const a in e.lkp)T[a]=e.lkp[a].sourceId;const L=new b(new B({name:\"classname\",alias:\"classname\",type:\"string\"}),null,T);let v=\"\";switch(s){case\"midspan\":{v=`((${l}='${t}') OR ( ${u}='${t}')) AND (${y} IN (5))`,L.codefield=k.create(`CASE WHEN (${l}='${t}') THEN ${m} ELSE ${p} END`,e.associations.getFieldsIndex());const n=O(N.findField(e.associations.fields,u));n.name=S,n.alias=S,F=new w(n,k.create(`CASE WHEN (${u}='${t}') THEN ${l} ELSE ${u} END`,e.associations.getFieldsIndex())),I=e.unVersion>=4?new x(N.findField(e.associations.fields,i.get(\"PERCENTALONG\").name)):new w(new B({name:\"percentalong\",alias:\"percentalong\",type:\"double\"}),k.create(\"0\",e.associations.getFieldsIndex()));break}case\"junctionedge\":{v=`((${l}='${t}') OR ( ${u}='${t}')) AND (${y} IN (4,6))`,L.codefield=k.create(`CASE WHEN (${l}='${t}') THEN ${m} ELSE ${p} END`,e.associations.getFieldsIndex());const n=O(N.findField(e.associations.fields,u));n.name=S,n.alias=S,F=new w(n,k.create(`CASE WHEN (${u}='${t}') THEN ${l} ELSE ${u} END`,e.associations.getFieldsIndex())),E=new w(new B({name:\"side\",alias:\"side\",type:\"string\"}),k.create(`CASE WHEN (${y}=4) THEN 'from' ELSE 'to' END`,e.associations.getFieldsIndex()));break}case\"connected\":{let r=`${l}='@T'`,i=`${u}='@T'`;null!==n&&(r+=` AND ${c}=@A`,i+=` AND ${d}=@A`),v=\"((\"+r+\") OR (\"+i+\"))\",v=D(v,\"@T\",t),r=D(r,\"@T\",t),null!==n&&(r=D(r,\"@A\",n.toString()),v=D(v,\"@A\",n.toString())),L.codefield=k.create(\"CASE WHEN \"+r+` THEN ${m} ELSE ${p} END`,e.associations.getFieldsIndex());const a=O(N.findField(e.associations.fields,u));a.name=S,a.alias=S,F=new w(a,k.create(\"CASE WHEN \"+r+` THEN ${u} ELSE ${l} END`,e.associations.getFieldsIndex()));break}case\"container\":v=`${l}='${t}' AND ${y} = 2`,null!==n&&(v+=` AND ${c} = `+n.toString()),L.codefield=m,v=\"( \"+v+\" )\",F=new A(N.findField(e.associations.fields,u),S,S);case\"content\":v=`(${u}='${t}' AND ${y} = 2)`,null!==n&&(v+=` AND ${d} = `+n.toString()),L.codefield=p,v=\"( \"+v+\" )\",F=new A(N.findField(e.associations.fields,l),S,S);break;case\"structure\":v=`(${l}='${t}' AND ${y} = 3)`,null!==n&&(v+=` AND ${c} = `+n.toString()),L.codefield=m,v=\"( \"+v+\" )\",F=new A(N.findField(e.associations.fields,u),S,$);break;case\"attached\":v=`(${u}='${t}' AND ${y} = 3)`,null!==n&&(v+=` AND ${d} = `+n.toString()),L.codefield=p,v=\"( \"+v+\" )\",F=new A(N.findField(e.associations.fields,l),S,$);break;default:throw new Error(\"Invalid Parameter\")}r&&(v=\"1 <> 1\");return new N({parentfeatureset:e.associations,adaptedFields:[new x(N.findField(e.associations.fields,h)),new x(N.findField(e.associations.fields,g)),F,E,L,I],extraFilter:v?k.create(v,e.associations.getFieldsIndex()):null})}))}))},C.signatures.push({name:\"featuresetbyassociation\",min:\"2\",max:\"6\"}),C.functions.groupby=function(e,n){return C.standardFunctionAsync(e,n,((n,r,i)=>(c(i,3,3),p(i[0])?i[0].load().then((n=>{const r=[],a=[];let s=!1,l=[];if(h(i[1]))l.push(i[1]);else if(i[1]instanceof t)l.push(i[1]);else if(g(i[1]))l=i[1];else{if(!I(i[1]))return C.failDefferred(\"Illegal Value: GroupBy\");l=i[1].toArray()}for(const e of l)if(h(e)){const t=k.create(m(e),n.getFieldsIndex()),i=!0===R(t)?m(e):\"%%%%FIELDNAME\";r.push({name:i,expression:t}),\"%%%%FIELDNAME\"===i&&(s=!0)}else{if(!(e instanceof t))return C.failDefferred(\"Illegal Value: GroupBy\");{const t=e.hasField(\"name\")?e.field(\"name\"):\"%%%%FIELDNAME\",i=e.hasField(\"expression\")?e.field(\"expression\"):\"\";if(\"%%%%FIELDNAME\"===t&&(s=!0),!t)return C.failDefferred(\"Illegal Value: GroupBy\");r.push({name:t,expression:k.create(i||t,n.getFieldsIndex())})}}if(l=[],h(i[2]))l.push(i[2]);else if(g(i[2]))l=i[2];else if(I(i[2]))l=i[2].toArray();else{if(!(i[2]instanceof t))return C.failDefferred(\"Illegal Value: GroupBy\");l.push(i[2])}for(const e of l){if(!(e instanceof t))return C.failDefferred(\"Illegal Value: GroupBy\");{const t=e.hasField(\"name\")?e.field(\"name\"):\"\",r=e.hasField(\"statistic\")?e.field(\"statistic\"):\"\",i=e.hasField(\"expression\")?e.field(\"expression\"):\"\";if(!t||!r||!i)return C.failDefferred(\"Illegal Value: GroupBy\");a.push({name:t,statistic:r.toLowerCase(),expression:k.create(i,n.getFieldsIndex())})}}if(s){const e={};for(const r of n.fields)e[r.name.toLowerCase()]=1;for(const n of r)\"%%%%FIELDNAME\"!==n.name&&(e[n.name.toLowerCase()]=1);for(const n of a)\"%%%%FIELDNAME\"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of r)if(\"%%%%FIELDNAME\"===n.name){for(;1===e[\"field_\"+t.toString()];)t++;e[\"field_\"+t.toString()]=1,n.name=\"FIELD_\"+t.toString()}}const o=[];for(const t of r)o.push(H(t.expression,C,e));for(const t of a)o.push(H(t.expression,C,e));return o.length>0?P(o).then((()=>M(i[0].groupby(r,a)))):M(i[0].groupby(r,a))})):C.failDefferred(\"Illegal Value: GroupBy\"))))},C.signatures.push({name:\"groupby\",min:\"3\",max:\"3\"}),C.functions.distinct=function(e,n){return C.standardFunctionAsync(e,n,((n,r,i)=>p(i[0])?(c(i,2,2),i[0].load().then((n=>{const r=[];let a=[];if(h(i[1]))a.push(i[1]);else if(i[1]instanceof t)a.push(i[1]);else if(g(i[1]))a=i[1];else{if(!I(i[1]))return C.failDefferred(\"Illegal Value: GroupBy\");a=i[1].toArray()}let s=!1;for(const e of a)if(h(e)){const t=k.create(m(e),n.getFieldsIndex()),i=!0===R(t)?m(e):\"%%%%FIELDNAME\";r.push({name:i,expression:t}),\"%%%%FIELDNAME\"===i&&(s=!0)}else{if(!(e instanceof t))return C.failDefferred(\"Illegal Value: GroupBy\");{const t=e.hasField(\"name\")?e.field(\"name\"):\"%%%%FIELDNAME\",i=e.hasField(\"expression\")?e.field(\"expression\"):\"\";if(\"%%%%FIELDNAME\"===t&&(s=!0),!t)return C.failDefferred(\"Illegal Value: GroupBy\");r.push({name:t,expression:k.create(i||t,n.getFieldsIndex())})}}if(s){const e={};for(const r of n.fields)e[r.name.toLowerCase()]=1;for(const n of r)\"%%%%FIELDNAME\"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of r)if(\"%%%%FIELDNAME\"===n.name){for(;1===e[\"field_\"+t.toString()];)t++;e[\"field_\"+t.toString()]=1,n.name=\"FIELD_\"+t.toString()}}const l=[];for(const t of r)l.push(H(t.expression,C,e));return l.length>0?P(l).then((()=>M(i[0].groupby(r,[])))):M(i[0].groupby(r,[]))}))):V(\"distinct\",n,r,i)))})}export{K as registerFunctions};\n"]},"metadata":{},"sourceType":"module"}