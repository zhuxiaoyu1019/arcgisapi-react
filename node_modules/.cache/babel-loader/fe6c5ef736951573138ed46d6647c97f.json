{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../core/global.js\";\nimport { clamp as e } from \"../../core/mathUtils.js\";\n\nconst n = (() => {\n  if (!(\"document\" in t)) return () => null;\n  const e = document.createElement(\"canvas\"),\n        n = e.getContext(\"2d\"),\n        r = 512;\n  return e.height = r, e.width = 1, t => {\n    n.clearRect(0, 0, 1, e.height);\n    const r = n.createLinearGradient(0, 0, 0, e.height);\n\n    for (const {\n      ratio: e,\n      color: n\n    } of t.colorStops) r.addColorStop(Math.max(e, .001), `rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`);\n\n    return n.fillStyle = r, n.fillRect(0, 0, 1, e.height), n.getImageData(0, 0, 1, e.height).data;\n  };\n})();\n\nfunction r(t, e, n, r) {\n  const {\n    blurRadius: o,\n    fieldOffset: a,\n    field: i\n  } = e,\n        u = new Float64Array(n * r),\n        l = f(o),\n        s = Math.round(3 * o);\n  let h,\n      d = Number.NEGATIVE_INFINITY;\n  const m = c(i, a);\n\n  for (const {\n    geometry: f,\n    attributes: c\n  } of t) {\n    const t = f.x - s,\n          e = f.y - s,\n          o = Math.max(0, t),\n          a = Math.max(0, e),\n          i = Math.min(r, f.y + s),\n          g = Math.min(n, f.x + s),\n          y = +m(c);\n\n    for (let r = a; r < i; r++) {\n      const a = l[r - e];\n\n      for (let e = o; e < g; e++) {\n        const o = l[e - t];\n        h = u[r * n + e] += a * o * y, h > d && (d = h);\n      }\n    }\n  }\n\n  return {\n    matrix: u.buffer,\n    max: d\n  };\n}\n\nfunction o(t, e, n, r) {\n  const {\n    blurRadius: o,\n    fieldOffset: a,\n    field: i\n  } = e,\n        c = new Float64Array(n * r),\n        l = f(o),\n        s = Math.round(3 * o);\n  let h,\n      d = Number.NEGATIVE_INFINITY;\n  const m = u(i, a),\n        g = new Set();\n\n  for (const f of t) {\n    const t = f.getCursor();\n\n    for (; t.next();) {\n      const e = t.getObjectId();\n      if (g.has(e)) continue;\n      g.add(e);\n      const o = t.readLegacyPointGeometry(),\n            a = 128;\n      if (o.x < -a || o.x >= n + a || o.y < -a || o.y > r + a) continue;\n      const i = +m(t),\n            f = Math.round(o.x) - s,\n            u = Math.round(o.y) - s,\n            y = Math.max(0, f),\n            M = Math.max(0, u),\n            x = Math.min(r, Math.round(o.y) + s),\n            b = Math.min(n, Math.round(o.x) + s);\n\n      for (let t = M; t < x; t++) {\n        const e = l[t - u];\n\n        for (let r = y; r < b; r++) {\n          const o = l[r - f];\n          h = c[t * n + r] += e * o * i, h > d && (d = h);\n        }\n      }\n    }\n  }\n\n  return {\n    matrix: c.buffer,\n    max: d\n  };\n}\n\nfunction a(t, e, n, r, o, a) {\n  t.canvas.width = t.canvas.height = e, t.clearRect(0, 0, e, e);\n  const f = t.getImageData(0, 0, e, e);\n  n && r && f.data.set(new Uint8ClampedArray(i(e, n, r, o, a))), t.putImageData(f, 0, 0);\n}\n\nfunction i(t, n, r, o, a) {\n  const i = new Uint32Array(t * t),\n        f = \"buffer\" in n ? n : new Float64Array(n),\n        c = \"buffer\" in r ? new Uint32Array(r.buffer) : new Uint32Array(new Uint8Array(r).buffer),\n        u = c.length / (a - o);\n\n  for (let l = 0; l < f.length; l++) {\n    const t = f[l],\n          n = Math.floor((t - o) * u);\n    i[l] = c[e(n, 0, c.length - 1)];\n  }\n\n  return i.buffer;\n}\n\nfunction f(t) {\n  const e = Math.round(3 * t),\n        n = 2 * t * t,\n        r = new Float64Array(2 * e + 1);\n\n  for (let o = 0; o <= r.length; o++) r[o] = Math.exp(-((o - e) ** 2) / n) / Math.sqrt(2 * Math.PI) * (t / 2);\n\n  return r;\n}\n\nfunction c(t, e) {\n  return \"function\" == typeof t ? t : t ? \"string\" == typeof e ? e => -1 * +e[t] : n => +n[t] + e : () => 1;\n}\n\nfunction u(t, e) {\n  return null != t ? \"string\" == typeof e ? e => -1 * +e.readAttribute(t) : n => +n.readAttribute(t) + e : t => 1;\n}\n\nexport { r as calculateHeatmapIntensityInfo, o as calculateHeatmapIntensityInfoReaders, i as createHeatmapImageData, f as createKernel, c as createValueFunction, u as createValueFunctionCursor, a as drawHeatmap, n as generateGradient };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/renderers/support/heatmapUtils.js"],"names":["t","clamp","e","n","document","createElement","getContext","r","height","width","clearRect","createLinearGradient","ratio","color","colorStops","addColorStop","Math","max","fillStyle","fillRect","getImageData","data","blurRadius","o","fieldOffset","a","field","i","u","Float64Array","l","f","s","round","h","d","Number","NEGATIVE_INFINITY","m","c","geometry","attributes","x","y","min","g","matrix","buffer","Set","getCursor","next","getObjectId","has","add","readLegacyPointGeometry","M","b","canvas","set","Uint8ClampedArray","putImageData","Uint32Array","Uint8Array","length","floor","exp","sqrt","PI","readAttribute","calculateHeatmapIntensityInfo","calculateHeatmapIntensityInfoReaders","createHeatmapImageData","createKernel","createValueFunction","createValueFunctionCursor","drawHeatmap","generateGradient"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../core/global.js\";import{clamp as e}from\"../../core/mathUtils.js\";const n=(()=>{if(!(\"document\"in t))return()=>null;const e=document.createElement(\"canvas\"),n=e.getContext(\"2d\"),r=512;return e.height=r,e.width=1,t=>{n.clearRect(0,0,1,e.height);const r=n.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:n}of t.colorStops)r.addColorStop(Math.max(e,.001),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`);return n.fillStyle=r,n.fillRect(0,0,1,e.height),n.getImageData(0,0,1,e.height).data}})();function r(t,e,n,r){const{blurRadius:o,fieldOffset:a,field:i}=e,u=new Float64Array(n*r),l=f(o),s=Math.round(3*o);let h,d=Number.NEGATIVE_INFINITY;const m=c(i,a);for(const{geometry:f,attributes:c}of t){const t=f.x-s,e=f.y-s,o=Math.max(0,t),a=Math.max(0,e),i=Math.min(r,f.y+s),g=Math.min(n,f.x+s),y=+m(c);for(let r=a;r<i;r++){const a=l[r-e];for(let e=o;e<g;e++){const o=l[e-t];h=u[r*n+e]+=a*o*y,h>d&&(d=h)}}}return{matrix:u.buffer,max:d}}function o(t,e,n,r){const{blurRadius:o,fieldOffset:a,field:i}=e,c=new Float64Array(n*r),l=f(o),s=Math.round(3*o);let h,d=Number.NEGATIVE_INFINITY;const m=u(i,a),g=new Set;for(const f of t){const t=f.getCursor();for(;t.next();){const e=t.getObjectId();if(g.has(e))continue;g.add(e);const o=t.readLegacyPointGeometry(),a=128;if(o.x<-a||o.x>=n+a||o.y<-a||o.y>r+a)continue;const i=+m(t),f=Math.round(o.x)-s,u=Math.round(o.y)-s,y=Math.max(0,f),M=Math.max(0,u),x=Math.min(r,Math.round(o.y)+s),b=Math.min(n,Math.round(o.x)+s);for(let t=M;t<x;t++){const e=l[t-u];for(let r=y;r<b;r++){const o=l[r-f];h=c[t*n+r]+=e*o*i,h>d&&(d=h)}}}}return{matrix:c.buffer,max:d}}function a(t,e,n,r,o,a){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const f=t.getImageData(0,0,e,e);n&&r&&f.data.set(new Uint8ClampedArray(i(e,n,r,o,a))),t.putImageData(f,0,0)}function i(t,n,r,o,a){const i=new Uint32Array(t*t),f=\"buffer\"in n?n:new Float64Array(n),c=\"buffer\"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),u=c.length/(a-o);for(let l=0;l<f.length;l++){const t=f[l],n=Math.floor((t-o)*u);i[l]=c[e(n,0,c.length-1)]}return i.buffer}function f(t){const e=Math.round(3*t),n=2*t*t,r=new Float64Array(2*e+1);for(let o=0;o<=r.length;o++)r[o]=Math.exp(-((o-e)**2)/n)/Math.sqrt(2*Math.PI)*(t/2);return r}function c(t,e){return\"function\"==typeof t?t:t?\"string\"==typeof e?e=>-1*+e[t]:n=>+n[t]+e:()=>1}function u(t,e){return null!=t?\"string\"==typeof e?e=>-1*+e.readAttribute(t):n=>+n.readAttribute(t)+e:t=>1}export{r as calculateHeatmapIntensityInfo,o as calculateHeatmapIntensityInfoReaders,i as createHeatmapImageData,f as createKernel,c as createValueFunction,u as createValueFunctionCursor,a as drawHeatmap,n as generateGradient};\n"]},"metadata":{},"sourceType":"module"}