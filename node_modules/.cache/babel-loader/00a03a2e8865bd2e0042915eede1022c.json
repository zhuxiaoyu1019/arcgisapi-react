{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { equals as t } from \"../../../core/arrayUtils.js\";\nimport e from \"../../../core/Evented.js\";\nimport { isSome as s, isNone as r } from \"../../../core/maybe.js\";\nimport i from \"../../../geometry/Polygon.js\";\nimport n from \"../../../geometry/Polyline.js\";\nimport { createCoordinateHelper as o } from \"../coordinateHelper.js\";\n\nclass h {\n  constructor(t) {\n    this.left = null, this.right = null, this.type = \"vertex\", this.index = null, this.component = t;\n  }\n\n  get pos() {\n    return this._pos;\n  }\n\n  set pos(t) {\n    this._pos = t, this.component.unnormalizeVertexPositions();\n  }\n\n}\n\nclass c {\n  constructor(t, e, s) {\n    this.type = \"edge\", this.component = t, this.left = e, this.right = s, e.right = this, s.left = this;\n  }\n\n}\n\nclass l {\n  constructor(t) {\n    this.vertices = [], this.edges = [], this.data = t;\n  }\n\n  unnormalizeVertexPositions() {\n    this.vertices.length <= 1 || this.data.coordinateHelper.unnormalize(this.vertices);\n  }\n\n  updateVertexIndex(t, e) {\n    if (0 === this.vertices.length) return;\n    const s = this.vertices[0];\n    let r = null,\n        i = t,\n        n = e;\n\n    do {\n      r = i, r.index = n++, i = r.right ? r.right.right : null;\n    } while (null != i && i !== s);\n\n    r.left && r !== this.vertices[this.vertices.length - 1] && this.swapVertices(this.vertices.indexOf(r), this.vertices.length - 1);\n  }\n\n  getFirstVertex() {\n    return 0 === this.vertices.length ? null : this.vertices[0];\n  }\n\n  getLastVertex() {\n    return 0 === this.vertices.length ? null : this.vertices[this.vertices.length - 1];\n  }\n\n  isClosed() {\n    return this.vertices.length > 2 && null !== this.vertices[0].left;\n  }\n\n  swapVertices(t, e) {\n    const s = this.vertices[t];\n    this.vertices[t] = this.vertices[e], this.vertices[e] = s;\n  }\n\n  iterateVertices(t) {\n    if (0 === this.vertices.length) return;\n    const e = this.vertices[0];\n    let r = e;\n\n    do {\n      t(r, r.index), r = s(r.right) ? r.right.right : null;\n    } while (r !== e && null != r);\n  }\n\n}\n\nclass a extends e {\n  constructor(t) {\n    super(), this.coordinateHelper = t, this.undoStack = [], this.redoStack = [], this.components = [];\n  }\n\n  apply(t, e = 1) {\n    return 0 !== e && !r(this.lastOperation) && this.lastOperation.accumulate(t) || (t.apply(), this.undoStack.push(t), this.redoStack = []), t;\n  }\n\n  undo() {\n    if (this.undoStack.length > 0) {\n      const t = this.undoStack.pop();\n      return t.undo(), this.redoStack.push(t), t;\n    }\n\n    return null;\n  }\n\n  get canUndo() {\n    return this.undoStack.length > 0;\n  }\n\n  get lastOperation() {\n    return this.undoStack.length > 0 ? this.undoStack[this.undoStack.length - 1] : null;\n  }\n\n  redo() {\n    if (this.redoStack.length > 0) {\n      const t = this.redoStack.pop();\n      return t.apply(), this.undoStack.push(t), t;\n    }\n\n    return null;\n  }\n\n  get canRedo() {\n    return this.redoStack.length > 0;\n  }\n\n  toPoint() {\n    return 0 === this.components.length || 0 === this.components[0].vertices.length ? null : this.coordinateHelper.createPoint(this.components[0].vertices[0].pos);\n  }\n\n  toPolyline() {\n    const t = [],\n          e = this.coordinateHelper.toArray;\n    return this.components.forEach((s, r) => {\n      const i = [];\n      let n = s.vertices.find(t => null == t.left);\n      const o = n;\n\n      do {\n        i.push(e(n.pos)), n = n.right ? n.right.right : null;\n      } while (n && n !== o);\n\n      t.push(i);\n    }), new n({\n      paths: t,\n      spatialReference: this.coordinateHelper.spatialReference,\n      hasZ: this.coordinateHelper.hasZ(),\n      hasM: this.coordinateHelper.hasM()\n    });\n  }\n\n  toPolygon() {\n    const t = [],\n          e = this.coordinateHelper.toArray;\n    return this.components.forEach((r, i) => {\n      const n = [],\n            o = r.vertices[0];\n      let h = o;\n      const c = h;\n\n      do {\n        n.push(e(h.pos)), h = s(h.right) ? h.right.right : null;\n      } while (h && h !== c);\n\n      r.isClosed() && n.push(e(o.pos)), t.push(n);\n    }), new i({\n      rings: t,\n      spatialReference: this.coordinateHelper.spatialReference,\n      hasZ: this.coordinateHelper.hasZ(),\n      hasM: this.coordinateHelper.hasM()\n    });\n  }\n\n  static fromGeometry(e, s) {\n    const r = o(e.hasZ, e.hasM, e.spatialReference, s),\n          i = new a(r);\n\n    switch (e.type) {\n      case \"polygon\":\n        {\n          const s = e.rings;\n\n          for (let e = 0; e < s.length; ++e) {\n            const n = s[e],\n                  o = new l(i),\n                  a = n.length > 2 && t(n[0], n[n.length - 1]),\n                  p = a ? n.length - 1 : n.length;\n\n            for (let t = 0; t < p; ++t) {\n              const e = r.fromArray(n[t]),\n                    s = new h(o);\n              o.vertices.push(s), s.pos = e, s.index = t;\n            }\n\n            const u = o.vertices.length - 1;\n\n            for (let t = 0; t < u; ++t) {\n              const e = o.vertices[t],\n                    s = o.vertices[t + 1],\n                    r = new c(o, e, s);\n              o.edges.push(r);\n            }\n\n            if (a) {\n              const t = new c(o, o.vertices[o.vertices.length - 1], o.vertices[0]);\n              o.edges.push(t);\n            }\n\n            i.components.push(o);\n          }\n        }\n        break;\n\n      case \"polyline\":\n        for (const t of e.paths) {\n          const e = new l(i),\n                s = t.length;\n\n          for (let i = 0; i < s; ++i) {\n            const s = r.fromArray(t[i]),\n                  n = new h(e);\n            e.vertices.push(n), n.pos = s, n.index = i;\n          }\n\n          const n = e.vertices.length - 1;\n\n          for (let t = 0; t < n; ++t) {\n            const s = e.vertices[t],\n                  r = e.vertices[t + 1],\n                  i = new c(e, s, r);\n            e.edges.push(i);\n          }\n\n          i.components.push(e);\n        }\n\n        break;\n\n      case \"point\":\n        {\n          const t = new l(i),\n                s = new h(t);\n          s.index = 0, s.pos = i.coordinateHelper.fromPoint(e), t.vertices.push(s), i.components.push(t);\n        }\n    }\n\n    return i;\n  }\n\n}\n\nexport { l as Component, c as Edge, a as EditGeometry, h as Vertex };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/interactive/editGeometry/EditGeometry.js"],"names":["equals","t","e","isSome","s","isNone","r","i","n","createCoordinateHelper","o","h","constructor","left","right","type","index","component","pos","_pos","unnormalizeVertexPositions","c","l","vertices","edges","data","length","coordinateHelper","unnormalize","updateVertexIndex","swapVertices","indexOf","getFirstVertex","getLastVertex","isClosed","iterateVertices","a","undoStack","redoStack","components","apply","lastOperation","accumulate","push","undo","pop","canUndo","redo","canRedo","toPoint","createPoint","toPolyline","toArray","forEach","find","paths","spatialReference","hasZ","hasM","toPolygon","rings","fromGeometry","p","fromArray","u","fromPoint","Component","Edge","EditGeometry","Vertex"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{equals as t}from\"../../../core/arrayUtils.js\";import e from\"../../../core/Evented.js\";import{isSome as s,isNone as r}from\"../../../core/maybe.js\";import i from\"../../../geometry/Polygon.js\";import n from\"../../../geometry/Polyline.js\";import{createCoordinateHelper as o}from\"../coordinateHelper.js\";class h{constructor(t){this.left=null,this.right=null,this.type=\"vertex\",this.index=null,this.component=t}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions()}}class c{constructor(t,e,s){this.type=\"edge\",this.component=t,this.left=e,this.right=s,e.right=this,s.left=this}}class l{constructor(t){this.vertices=[],this.edges=[],this.data=t}unnormalizeVertexPositions(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)}updateVertexIndex(t,e){if(0===this.vertices.length)return;const s=this.vertices[0];let r=null,i=t,n=e;do{r=i,r.index=n++,i=r.right?r.right.right:null}while(null!=i&&i!==s);r.left&&r!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(r),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].left}swapVertices(t,e){const s=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=s}iterateVertices(t){if(0===this.vertices.length)return;const e=this.vertices[0];let r=e;do{t(r,r.index),r=s(r.right)?r.right.right:null}while(r!==e&&null!=r)}}class a extends e{constructor(t){super(),this.coordinateHelper=t,this.undoStack=[],this.redoStack=[],this.components=[]}apply(t,e=1){return 0!==e&&!r(this.lastOperation)&&this.lastOperation.accumulate(t)||(t.apply(),this.undoStack.push(t),this.redoStack=[]),t}undo(){if(this.undoStack.length>0){const t=this.undoStack.pop();return t.undo(),this.redoStack.push(t),t}return null}get canUndo(){return this.undoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length>0){const t=this.redoStack.pop();return t.apply(),this.undoStack.push(t),t}return null}get canRedo(){return this.redoStack.length>0}toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}toPolyline(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((s,r)=>{const i=[];let n=s.vertices.find((t=>null==t.left));const o=n;do{i.push(e(n.pos)),n=n.right?n.right.right:null}while(n&&n!==o);t.push(i)})),new n({paths:t,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}toPolygon(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((r,i)=>{const n=[],o=r.vertices[0];let h=o;const c=h;do{n.push(e(h.pos)),h=s(h.right)?h.right.right:null}while(h&&h!==c);r.isClosed()&&n.push(e(o.pos)),t.push(n)})),new i({rings:t,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,s){const r=o(e.hasZ,e.hasM,e.spatialReference,s),i=new a(r);switch(e.type){case\"polygon\":{const s=e.rings;for(let e=0;e<s.length;++e){const n=s[e],o=new l(i),a=n.length>2&&t(n[0],n[n.length-1]),p=a?n.length-1:n.length;for(let t=0;t<p;++t){const e=r.fromArray(n[t]),s=new h(o);o.vertices.push(s),s.pos=e,s.index=t}const u=o.vertices.length-1;for(let t=0;t<u;++t){const e=o.vertices[t],s=o.vertices[t+1],r=new c(o,e,s);o.edges.push(r)}if(a){const t=new c(o,o.vertices[o.vertices.length-1],o.vertices[0]);o.edges.push(t)}i.components.push(o)}}break;case\"polyline\":for(const t of e.paths){const e=new l(i),s=t.length;for(let i=0;i<s;++i){const s=r.fromArray(t[i]),n=new h(e);e.vertices.push(n),n.pos=s,n.index=i}const n=e.vertices.length-1;for(let t=0;t<n;++t){const s=e.vertices[t],r=e.vertices[t+1],i=new c(e,s,r);e.edges.push(i)}i.components.push(e)}break;case\"point\":{const t=new l(i),s=new h(t);s.index=0,s.pos=i.coordinateHelper.fromPoint(e),t.vertices.push(s),i.components.push(t)}}return i}}export{l as Component,c as Edge,a as EditGeometry,h as Vertex};\n"]},"metadata":{},"sourceType":"module"}