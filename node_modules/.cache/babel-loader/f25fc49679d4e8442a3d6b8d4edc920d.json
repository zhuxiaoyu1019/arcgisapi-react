{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../../core/Handles.js\";\nimport { isSome as e, unwrap as s } from \"../../../../core/maybe.js\";\nimport { createRenderScreenPointArray as i, createRenderScreenPointArray3 as o, createScreenPointArray as r } from \"../../../../core/screenUtils.js\";\nimport { i as a, s as n, b as h, n as c, f as l, l as m, a as _ } from \"../../../../chunks/vec2.js\";\nimport { b as u } from \"../../../../chunks/vec3.js\";\nimport { c as p } from \"../../../../chunks/vec3f64.js\";\nimport { screenSpaceTangent as d } from \"../measurementTools/support/viewUtils.js\";\nimport { VisualElement as x } from \"./VisualElement.js\";\nimport f from \"../../../overlay/LineOverlayItem.js\";\nimport b from \"../../../overlay/TextOverlayItem.js\";\n\nclass v extends x {\n  constructor(e) {\n    super(e.view), this._handles = new t(), this._textItem = null, this._calloutItem = null, this._showCallout = !0, this._showText = !0, this._geometry = null, this._text = null, this._fontSize = 14, this._distance = 25, this._anchor = \"right\", this.applyProps(e);\n  }\n\n  get geometry() {\n    return this._geometry;\n  }\n\n  set geometry(t) {\n    this._geometry = t, this._updateLabelPosition();\n  }\n\n  get textItem() {\n    return this._textItem;\n  }\n\n  get text() {\n    return this._text;\n  }\n\n  set text(t) {\n    this._text = t, this.attached && (this._textItem.text = this._text);\n  }\n\n  get fontSize() {\n    return this._fontSize;\n  }\n\n  set fontSize(t) {\n    this._fontSize = t, this.attached && (this._textItem.fontSize = this._fontSize);\n  }\n\n  get distance() {\n    return this._distance;\n  }\n\n  set distance(t) {\n    this._distance !== t && (this._distance = t, this._updateLabelPosition());\n  }\n\n  get anchor() {\n    return this._anchor;\n  }\n\n  set anchor(t) {\n    this._anchor !== t && (this._anchor = t, this._updateLabelPosition());\n  }\n\n  overlaps(t) {\n    return !!this.attached && this.textItem.visible && t.textItem.visible && this.view.overlay.overlaps(this._textItem, t.textItem);\n  }\n\n  _updateLabelPosition() {\n    if (this.attached) {\n      if (this._showText = !1, this._showCallout = !1, e(this.geometry) && this.view._stage) switch (this.geometry.type) {\n        case \"point\":\n          if (this._computeLabelPositionFromPoint(this.geometry.point, k)) {\n            if (this.geometry.callout) {\n              const t = this.view.state.camera,\n                    e = this.geometry.callout.distance;\n              a(R, R, [0, this.geometry.callout.offset]), t.renderToScreen(R, k), n(j, 0, 1), h(j, j, e * t.pixelRatio), a(j, j, R), t.renderToScreen(j, z), this._showCallout = this._updatePosition(k, z);\n            } else this._textItem.position = [k[0], k[1]], this._textItem.anchor = \"center\";\n\n            this._showText = !0;\n          }\n\n          break;\n\n        case \"corner\":\n          this._computeLabelPositionFromCorner(this.geometry, this._distance, k, z) && (this._showCallout = this._updatePosition(k, z), this._showText = !0);\n          break;\n\n        case \"segment\":\n          this._computeLabelPositionFromSegment(this.geometry, this._distance, this._anchor, k, z) && (this._showText = !0, this._showCallout = this._updatePosition(k, z));\n      }\n      this.updateVisibility(this.visible);\n    }\n  }\n\n  _computeLabelPositionFromPoint(t, e) {\n    const s = this.view.state.camera;\n    return s.projectToRenderScreen(t, R), !(R[2] < 0 || R[2] > 1) && (s.renderToScreen(R, e), !0);\n  }\n\n  _computeLabelPositionFromCorner(t, e, s, i) {\n    if (!t) return !1;\n    const o = this.view.state.camera;\n    return w(t.left, 1, o, P), c(P, P), w(t.right, 0, o, T), a(j, P, T), c(j, j), l(j, j), o.projectToRenderScreen(t.left.endRenderSpace, R), !(R[2] < 0 || R[2] > 1) && (o.renderToScreen(R, s), h(j, j, e * o.pixelRatio), a(j, j, R), o.renderToScreen(j, i), !0);\n  }\n\n  _computeLabelPositionFromSegment(t, e, s, i, o) {\n    if (!t) return !1;\n    const r = t.segment,\n          l = this.view.state.camera;\n    d(r.startRenderSpace, r.endRenderSpace, P, l), n(j, -P[1], P[0]);\n\n    let _ = !1;\n\n    switch (s) {\n      case \"top\":\n        _ = j[1] < 0;\n        break;\n\n      case \"bottom\":\n        _ = j[1] > 0;\n        break;\n\n      case \"left\":\n        _ = j[0] > 0;\n        break;\n\n      case \"right\":\n        _ = j[0] < 0;\n    }\n\n    if (_ && c(j, j), 0 === m(j)) switch (s) {\n      case \"top\":\n        j[1] = 1;\n        break;\n\n      case \"bottom\":\n        j[1] = -1;\n        break;\n\n      case \"left\":\n        j[0] = -1;\n        break;\n\n      case \"right\":\n        j[0] = 1;\n    }\n    return r.eval(O[t.sampleLocation], L), l.projectToRenderScreen(L, R), !(R[2] < 0 || R[2] > 1) && (l.renderToScreen(R, i), h(j, j, e * l.pixelRatio), a(j, j, R), l.renderToScreen(j, o), !0);\n  }\n\n  _updatePosition(t, e) {\n    if (e) {\n      const s = e[0] - t[0],\n            i = e[1] - t[1];\n      return this._textItem.position = [e[0], e[1]], this._textItem.anchor = Math.abs(s) > Math.abs(i) ? s > 0 ? \"left\" : \"right\" : i > 0 ? \"top\" : \"bottom\", this._calloutItem.startPosition = [t[0], t[1]], this._calloutItem.endPosition = [e[0], e[1]], !0;\n    }\n\n    return this._textItem.position = [t[0], t[1]], this._textItem.anchor = \"center\", !1;\n  }\n\n  createResources() {\n    this._textItem = new b({\n      visible: !0\n    }), this._textItem.text = s(this._text), this._textItem.fontSize = this._fontSize, this._calloutItem = new f({\n      visible: !0,\n      width: 2\n    }), this._updateLabelPosition(), this.view.overlay.items.addMany([this._textItem, this._calloutItem]), this._handles.add(this.view.state.watch(\"camera\", () => this._updateLabelPosition()));\n  }\n\n  destroyResources() {\n    this.view.overlay && !this.view.overlay.destroyed && this.view.overlay.items.removeMany([this._textItem, this._calloutItem]), this._handles.removeAll();\n  }\n\n  updateVisibility(t) {\n    this._textItem.visible = this._showText && t, this._calloutItem.visible = this._showCallout && t;\n  }\n\n}\n\nfunction w(t, e, s, i) {\n  t.eval(e, y, S), u(I, y, S), s.projectToRenderScreen(y, C), s.projectToRenderScreen(I, M), _(i, V, F), l(i, i);\n}\n\nfunction g(t) {\n  switch (t) {\n    case \"top\":\n      return \"bottom\";\n\n    case \"right\":\n      return \"left\";\n\n    case \"bottom\":\n      return \"top\";\n\n    case \"left\":\n      return \"right\";\n  }\n}\n\nconst y = p(),\n      I = p(),\n      S = p(),\n      P = i(),\n      T = i(),\n      j = i(),\n      L = p(),\n      R = o(),\n      k = r(),\n      z = r(),\n      C = o(),\n      F = C,\n      M = o(),\n      V = M,\n      O = {\n  start: 0,\n  center: .5,\n  end: 1\n};\nexport { v as LabelVisualElement, g as mirrorPosition, w as screenSpaceTangent };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/interactive/visualElements/LabelVisualElement.js"],"names":["t","isSome","e","unwrap","s","createRenderScreenPointArray","i","createRenderScreenPointArray3","o","createScreenPointArray","r","a","n","b","h","c","f","l","m","_","u","p","screenSpaceTangent","d","VisualElement","x","v","constructor","view","_handles","_textItem","_calloutItem","_showCallout","_showText","_geometry","_text","_fontSize","_distance","_anchor","applyProps","geometry","_updateLabelPosition","textItem","text","attached","fontSize","distance","anchor","overlaps","visible","overlay","_stage","type","_computeLabelPositionFromPoint","point","k","callout","state","camera","R","offset","renderToScreen","j","pixelRatio","z","_updatePosition","position","_computeLabelPositionFromCorner","_computeLabelPositionFromSegment","updateVisibility","projectToRenderScreen","w","left","P","right","T","endRenderSpace","segment","startRenderSpace","eval","O","sampleLocation","L","Math","abs","startPosition","endPosition","createResources","width","items","addMany","add","watch","destroyResources","destroyed","removeMany","removeAll","y","S","I","C","M","V","F","g","start","center","end","LabelVisualElement","mirrorPosition"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,6BAAb;AAA2C,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,QAAmC,2BAAnC;AAA+D,SAAOC,4BAA4B,IAAIC,CAAvC,EAAyCC,6BAA6B,IAAIC,CAA1E,EAA4EC,sBAAsB,IAAIC,CAAtG,QAA4G,iCAA5G;AAA8I,SAAOJ,CAAC,IAAIK,CAAZ,EAAcP,CAAC,IAAIQ,CAAnB,EAAqBC,CAAC,IAAIC,CAA1B,EAA4BF,CAAC,IAAIG,CAAjC,EAAmCC,CAAC,IAAIC,CAAxC,EAA0CA,CAAC,IAAIC,CAA/C,EAAiDP,CAAC,IAAIQ,CAAtD,QAA4D,4BAA5D;AAAyF,SAAON,CAAC,IAAIO,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOL,CAAC,IAAIM,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOC,kBAAkB,IAAIC,CAA7B,QAAmC,0CAAnC;AAA8E,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,oBAA9B;AAAmD,OAAOT,CAAP,MAAa,qCAAb;AAAmD,OAAOH,CAAP,MAAa,qCAAb;;AAAmD,MAAMa,CAAN,SAAgBD,CAAhB,CAAiB;AAACE,EAAAA,WAAW,CAACzB,CAAD,EAAG;AAAC,UAAMA,CAAC,CAAC0B,IAAR,GAAc,KAAKC,QAAL,GAAc,IAAI7B,CAAJ,EAA5B,EAAkC,KAAK8B,SAAL,GAAe,IAAjD,EAAsD,KAAKC,YAAL,GAAkB,IAAxE,EAA6E,KAAKC,YAAL,GAAkB,CAAC,CAAhG,EAAkG,KAAKC,SAAL,GAAe,CAAC,CAAlH,EAAoH,KAAKC,SAAL,GAAe,IAAnI,EAAwI,KAAKC,KAAL,GAAW,IAAnJ,EAAwJ,KAAKC,SAAL,GAAe,EAAvK,EAA0K,KAAKC,SAAL,GAAe,EAAzL,EAA4L,KAAKC,OAAL,GAAa,OAAzM,EAAiN,KAAKC,UAAL,CAAgBrC,CAAhB,CAAjN;AAAoO;;AAAY,MAARsC,QAAQ,GAAE;AAAC,WAAO,KAAKN,SAAZ;AAAsB;;AAAY,MAARM,QAAQ,CAACxC,CAAD,EAAG;AAAC,SAAKkC,SAAL,GAAelC,CAAf,EAAiB,KAAKyC,oBAAL,EAAjB;AAA6C;;AAAY,MAARC,QAAQ,GAAE;AAAC,WAAO,KAAKZ,SAAZ;AAAsB;;AAAQ,MAAJa,IAAI,GAAE;AAAC,WAAO,KAAKR,KAAZ;AAAkB;;AAAQ,MAAJQ,IAAI,CAAC3C,CAAD,EAAG;AAAC,SAAKmC,KAAL,GAAWnC,CAAX,EAAa,KAAK4C,QAAL,KAAgB,KAAKd,SAAL,CAAea,IAAf,GAAoB,KAAKR,KAAzC,CAAb;AAA6D;;AAAY,MAARU,QAAQ,GAAE;AAAC,WAAO,KAAKT,SAAZ;AAAsB;;AAAY,MAARS,QAAQ,CAAC7C,CAAD,EAAG;AAAC,SAAKoC,SAAL,GAAepC,CAAf,EAAiB,KAAK4C,QAAL,KAAgB,KAAKd,SAAL,CAAee,QAAf,GAAwB,KAAKT,SAA7C,CAAjB;AAAyE;;AAAY,MAARU,QAAQ,GAAE;AAAC,WAAO,KAAKT,SAAZ;AAAsB;;AAAY,MAARS,QAAQ,CAAC9C,CAAD,EAAG;AAAC,SAAKqC,SAAL,KAAiBrC,CAAjB,KAAqB,KAAKqC,SAAL,GAAerC,CAAf,EAAiB,KAAKyC,oBAAL,EAAtC;AAAmE;;AAAU,MAANM,MAAM,GAAE;AAAC,WAAO,KAAKT,OAAZ;AAAoB;;AAAU,MAANS,MAAM,CAAC/C,CAAD,EAAG;AAAC,SAAKsC,OAAL,KAAetC,CAAf,KAAmB,KAAKsC,OAAL,GAAatC,CAAb,EAAe,KAAKyC,oBAAL,EAAlC;AAA+D;;AAAAO,EAAAA,QAAQ,CAAChD,CAAD,EAAG;AAAC,WAAM,CAAC,CAAC,KAAK4C,QAAP,IAAkB,KAAKF,QAAL,CAAcO,OAAd,IAAuBjD,CAAC,CAAC0C,QAAF,CAAWO,OAAlC,IAA2C,KAAKrB,IAAL,CAAUsB,OAAV,CAAkBF,QAAlB,CAA2B,KAAKlB,SAAhC,EAA0C9B,CAAC,CAAC0C,QAA5C,CAAnE;AAA0H;;AAAAD,EAAAA,oBAAoB,GAAE;AAAC,QAAG,KAAKG,QAAR,EAAiB;AAAC,UAAG,KAAKX,SAAL,GAAe,CAAC,CAAhB,EAAkB,KAAKD,YAAL,GAAkB,CAAC,CAArC,EAAuC9B,CAAC,CAAC,KAAKsC,QAAN,CAAD,IAAkB,KAAKZ,IAAL,CAAUuB,MAAtE,EAA6E,QAAO,KAAKX,QAAL,CAAcY,IAArB;AAA2B,aAAI,OAAJ;AAAY,cAAG,KAAKC,8BAAL,CAAoC,KAAKb,QAAL,CAAcc,KAAlD,EAAwDC,CAAxD,CAAH,EAA8D;AAAC,gBAAG,KAAKf,QAAL,CAAcgB,OAAjB,EAAyB;AAAC,oBAAMxD,CAAC,GAAC,KAAK4B,IAAL,CAAU6B,KAAV,CAAgBC,MAAxB;AAAA,oBAA+BxD,CAAC,GAAC,KAAKsC,QAAL,CAAcgB,OAAd,CAAsBV,QAAvD;AAAgEnC,cAAAA,CAAC,CAACgD,CAAD,EAAGA,CAAH,EAAK,CAAC,CAAD,EAAG,KAAKnB,QAAL,CAAcgB,OAAd,CAAsBI,MAAzB,CAAL,CAAD,EAAwC5D,CAAC,CAAC6D,cAAF,CAAiBF,CAAjB,EAAmBJ,CAAnB,CAAxC,EAA8D3C,CAAC,CAACkD,CAAD,EAAG,CAAH,EAAK,CAAL,CAA/D,EAAuEhD,CAAC,CAACgD,CAAD,EAAGA,CAAH,EAAK5D,CAAC,GAACF,CAAC,CAAC+D,UAAT,CAAxE,EAA6FpD,CAAC,CAACmD,CAAD,EAAGA,CAAH,EAAKH,CAAL,CAA9F,EAAsG3D,CAAC,CAAC6D,cAAF,CAAiBC,CAAjB,EAAmBE,CAAnB,CAAtG,EAA4H,KAAKhC,YAAL,GAAkB,KAAKiC,eAAL,CAAqBV,CAArB,EAAuBS,CAAvB,CAA9I;AAAwK,aAAlQ,MAAuQ,KAAKlC,SAAL,CAAeoC,QAAf,GAAwB,CAACX,CAAC,CAAC,CAAD,CAAF,EAAMA,CAAC,CAAC,CAAD,CAAP,CAAxB,EAAoC,KAAKzB,SAAL,CAAeiB,MAAf,GAAsB,QAA1D;;AAAmE,iBAAKd,SAAL,GAAe,CAAC,CAAhB;AAAkB;;AAAA;;AAAM,aAAI,QAAJ;AAAa,eAAKkC,+BAAL,CAAqC,KAAK3B,QAA1C,EAAmD,KAAKH,SAAxD,EAAkEkB,CAAlE,EAAoES,CAApE,MAAyE,KAAKhC,YAAL,GAAkB,KAAKiC,eAAL,CAAqBV,CAArB,EAAuBS,CAAvB,CAAlB,EAA4C,KAAK/B,SAAL,GAAe,CAAC,CAArI;AAAwI;;AAAM,aAAI,SAAJ;AAAc,eAAKmC,gCAAL,CAAsC,KAAK5B,QAA3C,EAAoD,KAAKH,SAAzD,EAAmE,KAAKC,OAAxE,EAAgFiB,CAAhF,EAAkFS,CAAlF,MAAuF,KAAK/B,SAAL,GAAe,CAAC,CAAhB,EAAkB,KAAKD,YAAL,GAAkB,KAAKiC,eAAL,CAAqBV,CAArB,EAAuBS,CAAvB,CAA3H;AAAjnB;AAAuwB,WAAKK,gBAAL,CAAsB,KAAKpB,OAA3B;AAAoC;AAAC;;AAAAI,EAAAA,8BAA8B,CAACrD,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAME,CAAC,GAAC,KAAKwB,IAAL,CAAU6B,KAAV,CAAgBC,MAAxB;AAA+B,WAAOtD,CAAC,CAACkE,qBAAF,CAAwBtE,CAAxB,EAA0B2D,CAA1B,GAA6B,EAAEA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAL,IAAQA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAf,MAAoBvD,CAAC,CAACyD,cAAF,CAAiBF,CAAjB,EAAmBzD,CAAnB,GAAsB,CAAC,CAA3C,CAApC;AAAkF;;AAAAiE,EAAAA,+BAA+B,CAACnE,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;AAAC,QAAG,CAACN,CAAJ,EAAM,OAAM,CAAC,CAAP;AAAS,UAAMQ,CAAC,GAAC,KAAKoB,IAAL,CAAU6B,KAAV,CAAgBC,MAAxB;AAA+B,WAAOa,CAAC,CAACvE,CAAC,CAACwE,IAAH,EAAQ,CAAR,EAAUhE,CAAV,EAAYiE,CAAZ,CAAD,EAAgB1D,CAAC,CAAC0D,CAAD,EAAGA,CAAH,CAAjB,EAAuBF,CAAC,CAACvE,CAAC,CAAC0E,KAAH,EAAS,CAAT,EAAWlE,CAAX,EAAamE,CAAb,CAAxB,EAAwChE,CAAC,CAACmD,CAAD,EAAGW,CAAH,EAAKE,CAAL,CAAzC,EAAiD5D,CAAC,CAAC+C,CAAD,EAAGA,CAAH,CAAlD,EAAwD7C,CAAC,CAAC6C,CAAD,EAAGA,CAAH,CAAzD,EAA+DtD,CAAC,CAAC8D,qBAAF,CAAwBtE,CAAC,CAACwE,IAAF,CAAOI,cAA/B,EAA8CjB,CAA9C,CAA/D,EAAgH,EAAEA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAL,IAAQA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAf,MAAoBnD,CAAC,CAACqD,cAAF,CAAiBF,CAAjB,EAAmBvD,CAAnB,GAAsBU,CAAC,CAACgD,CAAD,EAAGA,CAAH,EAAK5D,CAAC,GAACM,CAAC,CAACuD,UAAT,CAAvB,EAA4CpD,CAAC,CAACmD,CAAD,EAAGA,CAAH,EAAKH,CAAL,CAA7C,EAAqDnD,CAAC,CAACqD,cAAF,CAAiBC,CAAjB,EAAmBxD,CAAnB,CAArD,EAA2E,CAAC,CAAhG,CAAvH;AAA0N;;AAAA8D,EAAAA,gCAAgC,CAACpE,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASE,CAAT,EAAW;AAAC,QAAG,CAACR,CAAJ,EAAM,OAAM,CAAC,CAAP;AAAS,UAAMU,CAAC,GAACV,CAAC,CAAC6E,OAAV;AAAA,UAAkB5D,CAAC,GAAC,KAAKW,IAAL,CAAU6B,KAAV,CAAgBC,MAApC;AAA2CnC,IAAAA,CAAC,CAACb,CAAC,CAACoE,gBAAH,EAAoBpE,CAAC,CAACkE,cAAtB,EAAqCH,CAArC,EAAuCxD,CAAvC,CAAD,EAA2CL,CAAC,CAACkD,CAAD,EAAG,CAACW,CAAC,CAAC,CAAD,CAAL,EAASA,CAAC,CAAC,CAAD,CAAV,CAA5C;;AAA2D,QAAItD,CAAC,GAAC,CAAC,CAAP;;AAAS,YAAOf,CAAP;AAAU,WAAI,KAAJ;AAAUe,QAAAA,CAAC,GAAC2C,CAAC,CAAC,CAAD,CAAD,GAAK,CAAP;AAAS;;AAAM,WAAI,QAAJ;AAAa3C,QAAAA,CAAC,GAAC2C,CAAC,CAAC,CAAD,CAAD,GAAK,CAAP;AAAS;;AAAM,WAAI,MAAJ;AAAW3C,QAAAA,CAAC,GAAC2C,CAAC,CAAC,CAAD,CAAD,GAAK,CAAP;AAAS;;AAAM,WAAI,OAAJ;AAAY3C,QAAAA,CAAC,GAAC2C,CAAC,CAAC,CAAD,CAAD,GAAK,CAAP;AAArG;;AAA8G,QAAG3C,CAAC,IAAEJ,CAAC,CAAC+C,CAAD,EAAGA,CAAH,CAAJ,EAAU,MAAI5C,CAAC,CAAC4C,CAAD,CAAlB,EAAsB,QAAO1D,CAAP;AAAU,WAAI,KAAJ;AAAU0D,QAAAA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAL;AAAO;;AAAM,WAAI,QAAJ;AAAaA,QAAAA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAC,CAAN;AAAQ;;AAAM,WAAI,MAAJ;AAAWA,QAAAA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAC,CAAN;AAAQ;;AAAM,WAAI,OAAJ;AAAYA,QAAAA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAL;AAAjG;AAAwG,WAAOpD,CAAC,CAACqE,IAAF,CAAOC,CAAC,CAAChF,CAAC,CAACiF,cAAH,CAAR,EAA2BC,CAA3B,GAA8BjE,CAAC,CAACqD,qBAAF,CAAwBY,CAAxB,EAA0BvB,CAA1B,CAA9B,EAA2D,EAAEA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAL,IAAQA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAf,MAAoB1C,CAAC,CAAC4C,cAAF,CAAiBF,CAAjB,EAAmBrD,CAAnB,GAAsBQ,CAAC,CAACgD,CAAD,EAAGA,CAAH,EAAK5D,CAAC,GAACe,CAAC,CAAC8C,UAAT,CAAvB,EAA4CpD,CAAC,CAACmD,CAAD,EAAGA,CAAH,EAAKH,CAAL,CAA7C,EAAqD1C,CAAC,CAAC4C,cAAF,CAAiBC,CAAjB,EAAmBtD,CAAnB,CAArD,EAA2E,CAAC,CAAhG,CAAlE;AAAqK;;AAAAyD,EAAAA,eAAe,CAACjE,CAAD,EAAGE,CAAH,EAAK;AAAC,QAAGA,CAAH,EAAK;AAAC,YAAME,CAAC,GAACF,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC,CAAD,CAAd;AAAA,YAAkBM,CAAC,GAACJ,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC,CAAD,CAA1B;AAA8B,aAAO,KAAK8B,SAAL,CAAeoC,QAAf,GAAwB,CAAChE,CAAC,CAAC,CAAD,CAAF,EAAMA,CAAC,CAAC,CAAD,CAAP,CAAxB,EAAoC,KAAK4B,SAAL,CAAeiB,MAAf,GAAsBoC,IAAI,CAACC,GAAL,CAAShF,CAAT,IAAY+E,IAAI,CAACC,GAAL,CAAS9E,CAAT,CAAZ,GAAwBF,CAAC,GAAC,CAAF,GAAI,MAAJ,GAAW,OAAnC,GAA2CE,CAAC,GAAC,CAAF,GAAI,KAAJ,GAAU,QAA/G,EAAwH,KAAKyB,YAAL,CAAkBsD,aAAlB,GAAgC,CAACrF,CAAC,CAAC,CAAD,CAAF,EAAMA,CAAC,CAAC,CAAD,CAAP,CAAxJ,EAAoK,KAAK+B,YAAL,CAAkBuD,WAAlB,GAA8B,CAACpF,CAAC,CAAC,CAAD,CAAF,EAAMA,CAAC,CAAC,CAAD,CAAP,CAAlM,EAA8M,CAAC,CAAtN;AAAwN;;AAAA,WAAO,KAAK4B,SAAL,CAAeoC,QAAf,GAAwB,CAAClE,CAAC,CAAC,CAAD,CAAF,EAAMA,CAAC,CAAC,CAAD,CAAP,CAAxB,EAAoC,KAAK8B,SAAL,CAAeiB,MAAf,GAAsB,QAA1D,EAAmE,CAAC,CAA3E;AAA6E;;AAAAwC,EAAAA,eAAe,GAAE;AAAC,SAAKzD,SAAL,GAAe,IAAIjB,CAAJ,CAAM;AAACoC,MAAAA,OAAO,EAAC,CAAC;AAAV,KAAN,CAAf,EAAmC,KAAKnB,SAAL,CAAea,IAAf,GAAoBvC,CAAC,CAAC,KAAK+B,KAAN,CAAxD,EAAqE,KAAKL,SAAL,CAAee,QAAf,GAAwB,KAAKT,SAAlG,EAA4G,KAAKL,YAAL,GAAkB,IAAIf,CAAJ,CAAM;AAACiC,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYuC,MAAAA,KAAK,EAAC;AAAlB,KAAN,CAA9H,EAA0J,KAAK/C,oBAAL,EAA1J,EAAsL,KAAKb,IAAL,CAAUsB,OAAV,CAAkBuC,KAAlB,CAAwBC,OAAxB,CAAgC,CAAC,KAAK5D,SAAN,EAAgB,KAAKC,YAArB,CAAhC,CAAtL,EAA0P,KAAKF,QAAL,CAAc8D,GAAd,CAAkB,KAAK/D,IAAL,CAAU6B,KAAV,CAAgBmC,KAAhB,CAAsB,QAAtB,EAAgC,MAAI,KAAKnD,oBAAL,EAApC,CAAlB,CAA1P;AAA+U;;AAAAoD,EAAAA,gBAAgB,GAAE;AAAC,SAAKjE,IAAL,CAAUsB,OAAV,IAAmB,CAAC,KAAKtB,IAAL,CAAUsB,OAAV,CAAkB4C,SAAtC,IAAiD,KAAKlE,IAAL,CAAUsB,OAAV,CAAkBuC,KAAlB,CAAwBM,UAAxB,CAAmC,CAAC,KAAKjE,SAAN,EAAgB,KAAKC,YAArB,CAAnC,CAAjD,EAAwH,KAAKF,QAAL,CAAcmE,SAAd,EAAxH;AAAkJ;;AAAA3B,EAAAA,gBAAgB,CAACrE,CAAD,EAAG;AAAC,SAAK8B,SAAL,CAAemB,OAAf,GAAuB,KAAKhB,SAAL,IAAgBjC,CAAvC,EAAyC,KAAK+B,YAAL,CAAkBkB,OAAlB,GAA0B,KAAKjB,YAAL,IAAmBhC,CAAtF;AAAwF;;AAA9zH;;AAA+zH,SAASuE,CAAT,CAAWvE,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBE,CAAjB,EAAmB;AAACN,EAAAA,CAAC,CAAC+E,IAAF,CAAO7E,CAAP,EAAS+F,CAAT,EAAWC,CAAX,GAAc9E,CAAC,CAAC+E,CAAD,EAAGF,CAAH,EAAKC,CAAL,CAAf,EAAuB9F,CAAC,CAACkE,qBAAF,CAAwB2B,CAAxB,EAA0BG,CAA1B,CAAvB,EAAoDhG,CAAC,CAACkE,qBAAF,CAAwB6B,CAAxB,EAA0BE,CAA1B,CAApD,EAAiFlF,CAAC,CAACb,CAAD,EAAGgG,CAAH,EAAKC,CAAL,CAAlF,EAA0FtF,CAAC,CAACX,CAAD,EAAGA,CAAH,CAA3F;AAAiG;;AAAA,SAASkG,CAAT,CAAWxG,CAAX,EAAa;AAAC,UAAOA,CAAP;AAAU,SAAI,KAAJ;AAAU,aAAM,QAAN;;AAAe,SAAI,OAAJ;AAAY,aAAM,MAAN;;AAAa,SAAI,QAAJ;AAAa,aAAM,KAAN;;AAAY,SAAI,MAAJ;AAAW,aAAM,OAAN;AAAhG;AAA+G;;AAAA,MAAMiG,CAAC,GAAC5E,CAAC,EAAT;AAAA,MAAY8E,CAAC,GAAC9E,CAAC,EAAf;AAAA,MAAkB6E,CAAC,GAAC7E,CAAC,EAArB;AAAA,MAAwBoD,CAAC,GAACnE,CAAC,EAA3B;AAAA,MAA8BqE,CAAC,GAACrE,CAAC,EAAjC;AAAA,MAAoCwD,CAAC,GAACxD,CAAC,EAAvC;AAAA,MAA0C4E,CAAC,GAAC7D,CAAC,EAA7C;AAAA,MAAgDsC,CAAC,GAACnD,CAAC,EAAnD;AAAA,MAAsD+C,CAAC,GAAC7C,CAAC,EAAzD;AAAA,MAA4DsD,CAAC,GAACtD,CAAC,EAA/D;AAAA,MAAkE0F,CAAC,GAAC5F,CAAC,EAArE;AAAA,MAAwE+F,CAAC,GAACH,CAA1E;AAAA,MAA4EC,CAAC,GAAC7F,CAAC,EAA/E;AAAA,MAAkF8F,CAAC,GAACD,CAApF;AAAA,MAAsFrB,CAAC,GAAC;AAACyB,EAAAA,KAAK,EAAC,CAAP;AAASC,EAAAA,MAAM,EAAC,EAAhB;AAAmBC,EAAAA,GAAG,EAAC;AAAvB,CAAxF;AAAkH,SAAOjF,CAAC,IAAIkF,kBAAZ,EAA+BJ,CAAC,IAAIK,cAApC,EAAmDtC,CAAC,IAAIjD,kBAAxD","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/Handles.js\";import{isSome as e,unwrap as s}from\"../../../../core/maybe.js\";import{createRenderScreenPointArray as i,createRenderScreenPointArray3 as o,createScreenPointArray as r}from\"../../../../core/screenUtils.js\";import{i as a,s as n,b as h,n as c,f as l,l as m,a as _}from\"../../../../chunks/vec2.js\";import{b as u}from\"../../../../chunks/vec3.js\";import{c as p}from\"../../../../chunks/vec3f64.js\";import{screenSpaceTangent as d}from\"../measurementTools/support/viewUtils.js\";import{VisualElement as x}from\"./VisualElement.js\";import f from\"../../../overlay/LineOverlayItem.js\";import b from\"../../../overlay/TextOverlayItem.js\";class v extends x{constructor(e){super(e.view),this._handles=new t,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text=null,this._fontSize=14,this._distance=25,this._anchor=\"right\",this.applyProps(e)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(t){this._text=t,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.attached&&(this._textItem.fontSize=this._fontSize)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this._updateLabelPosition())}get anchor(){return this._anchor}set anchor(t){this._anchor!==t&&(this._anchor=t,this._updateLabelPosition())}overlaps(t){return!!this.attached&&(this.textItem.visible&&t.textItem.visible&&this.view.overlay.overlaps(this._textItem,t.textItem))}_updateLabelPosition(){if(this.attached){if(this._showText=!1,this._showCallout=!1,e(this.geometry)&&this.view._stage)switch(this.geometry.type){case\"point\":if(this._computeLabelPositionFromPoint(this.geometry.point,k)){if(this.geometry.callout){const t=this.view.state.camera,e=this.geometry.callout.distance;a(R,R,[0,this.geometry.callout.offset]),t.renderToScreen(R,k),n(j,0,1),h(j,j,e*t.pixelRatio),a(j,j,R),t.renderToScreen(j,z),this._showCallout=this._updatePosition(k,z)}else this._textItem.position=[k[0],k[1]],this._textItem.anchor=\"center\";this._showText=!0}break;case\"corner\":this._computeLabelPositionFromCorner(this.geometry,this._distance,k,z)&&(this._showCallout=this._updatePosition(k,z),this._showText=!0);break;case\"segment\":this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,k,z)&&(this._showText=!0,this._showCallout=this._updatePosition(k,z))}this.updateVisibility(this.visible)}}_computeLabelPositionFromPoint(t,e){const s=this.view.state.camera;return s.projectToRenderScreen(t,R),!(R[2]<0||R[2]>1)&&(s.renderToScreen(R,e),!0)}_computeLabelPositionFromCorner(t,e,s,i){if(!t)return!1;const o=this.view.state.camera;return w(t.left,1,o,P),c(P,P),w(t.right,0,o,T),a(j,P,T),c(j,j),l(j,j),o.projectToRenderScreen(t.left.endRenderSpace,R),!(R[2]<0||R[2]>1)&&(o.renderToScreen(R,s),h(j,j,e*o.pixelRatio),a(j,j,R),o.renderToScreen(j,i),!0)}_computeLabelPositionFromSegment(t,e,s,i,o){if(!t)return!1;const r=t.segment,l=this.view.state.camera;d(r.startRenderSpace,r.endRenderSpace,P,l),n(j,-P[1],P[0]);let _=!1;switch(s){case\"top\":_=j[1]<0;break;case\"bottom\":_=j[1]>0;break;case\"left\":_=j[0]>0;break;case\"right\":_=j[0]<0}if(_&&c(j,j),0===m(j))switch(s){case\"top\":j[1]=1;break;case\"bottom\":j[1]=-1;break;case\"left\":j[0]=-1;break;case\"right\":j[0]=1}return r.eval(O[t.sampleLocation],L),l.projectToRenderScreen(L,R),!(R[2]<0||R[2]>1)&&(l.renderToScreen(R,i),h(j,j,e*l.pixelRatio),a(j,j,R),l.renderToScreen(j,o),!0)}_updatePosition(t,e){if(e){const s=e[0]-t[0],i=e[1]-t[1];return this._textItem.position=[e[0],e[1]],this._textItem.anchor=Math.abs(s)>Math.abs(i)?s>0?\"left\":\"right\":i>0?\"top\":\"bottom\",this._calloutItem.startPosition=[t[0],t[1]],this._calloutItem.endPosition=[e[0],e[1]],!0}return this._textItem.position=[t[0],t[1]],this._textItem.anchor=\"center\",!1}createResources(){this._textItem=new b({visible:!0}),this._textItem.text=s(this._text),this._textItem.fontSize=this._fontSize,this._calloutItem=new f({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add(this.view.state.watch(\"camera\",(()=>this._updateLabelPosition())))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(t){this._textItem.visible=this._showText&&t,this._calloutItem.visible=this._showCallout&&t}}function w(t,e,s,i){t.eval(e,y,S),u(I,y,S),s.projectToRenderScreen(y,C),s.projectToRenderScreen(I,M),_(i,V,F),l(i,i)}function g(t){switch(t){case\"top\":return\"bottom\";case\"right\":return\"left\";case\"bottom\":return\"top\";case\"left\":return\"right\"}}const y=p(),I=p(),S=p(),P=i(),T=i(),j=i(),L=p(),R=o(),k=r(),z=r(),C=o(),F=C,M=o(),V=M,O={start:0,center:.5,end:1};export{v as LabelVisualElement,g as mirrorPosition,w as screenSpaceTangent};\n"]},"metadata":{},"sourceType":"module"}