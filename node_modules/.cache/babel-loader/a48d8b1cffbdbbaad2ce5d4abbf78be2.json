{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { PathTransformationCursor as e, getCoord2D as t, reversePath as n } from \"../CIMCursor.js\";\nimport { CurveHelper as i } from \"../CurveHelper.js\";\nconst s = .001;\n\nclass r {\n  static local() {\n    return null === r.instance && (r.instance = new r()), r.instance;\n  }\n\n  execute(e, t, n) {\n    return new l(e, t, n);\n  }\n\n}\n\nr.instance = null;\n\nclass l extends e {\n  constructor(e, t, n) {\n    super(e, !0, !0), this._curveHelper = new i(), this._angleToLine = void 0 === t.angleToLine || t.angleToLine, this._offset = void 0 !== t.offset ? t.offset * n : 0, this._relativeTo = t.relativeTo, this._position = void 0 !== t.startPointOffset ? t.startPointOffset * n : 0, this._epsilon = s * n;\n  }\n\n  processPath(e) {\n    const i = this._position;\n\n    if (\"SegmentMidpoint\" === this._relativeTo) {\n      for (this.iteratePath || (this._segmentCount = e.length, this._curSegment = 1, this.iteratePath = !0); this._curSegment < this._segmentCount;) {\n        const n = this._curSegment;\n        this._curSegment++;\n\n        const i = e[n - 1],\n              s = e[n],\n              r = this._curveHelper.calculateLength(i, s);\n\n        if (r < this._epsilon) continue;\n\n        const l = .5 + this._position / r,\n              [a, o] = this._curveHelper.getAngleCS(i, s, l),\n              h = t(i, s, l);\n\n        return this.internalPlacement.setTranslate(h[0] - this._offset * o, h[1] + this._offset * a), this._angleToLine && this.internalPlacement.setRotateCS(a, o), this.internalPlacement;\n      }\n\n      return this.iteratePath = !1, null;\n    }\n\n    \"LineEnd\" === this._relativeTo && n(e);\n    const s = this.onLine(e, i);\n    return \"LineEnd\" === this._relativeTo && n(e), s;\n  }\n\n  onLine(e, n) {\n    let i,\n        s = !1;\n\n    switch (this._relativeTo) {\n      case \"LineMiddle\":\n      default:\n        i = this._curveHelper.calculatePathLength(e) / 2 + n;\n        break;\n\n      case \"LineBeginning\":\n        i = n;\n        break;\n\n      case \"LineEnd\":\n        i = n, s = !0;\n    }\n\n    const r = e.length;\n    let l,\n        a = 0,\n        o = e[0];\n\n    for (let h = 1; h < r; ++h) {\n      l = o, o = e[h];\n\n      const n = this._curveHelper.calculateLength(l, o);\n\n      if (a + n > i) {\n        const e = (i - a) / n,\n              [r, h] = this._curveHelper.getAngleCS(l, o, e),\n              c = t(l, o, e),\n              u = s ? this._offset : -this._offset;\n\n        return this.internalPlacement.setTranslate(c[0] - u * h, c[1] + u * r), this._angleToLine && (s ? this.internalPlacement.setRotateCS(-r, -h) : this.internalPlacement.setRotateCS(r, h)), this.internalPlacement;\n      }\n\n      a += n;\n    }\n\n    return null;\n  }\n\n}\n\nexport { r as PlacementOnLine };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/symbols/cim/placements/PlacementOnLine.js"],"names":["PathTransformationCursor","e","getCoord2D","t","reversePath","n","CurveHelper","i","s","r","local","instance","execute","l","constructor","_curveHelper","_angleToLine","angleToLine","_offset","offset","_relativeTo","relativeTo","_position","startPointOffset","_epsilon","processPath","iteratePath","_segmentCount","length","_curSegment","calculateLength","a","o","getAngleCS","h","internalPlacement","setTranslate","setRotateCS","onLine","calculatePathLength","c","u","PlacementOnLine"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{PathTransformationCursor as e,getCoord2D as t,reversePath as n}from\"../CIMCursor.js\";import{CurveHelper as i}from\"../CurveHelper.js\";const s=.001;class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,n){return new l(e,t,n)}}r.instance=null;class l extends e{constructor(e,t,n){super(e,!0,!0),this._curveHelper=new i,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*n:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*n:0,this._epsilon=s*n}processPath(e){const i=this._position;if(\"SegmentMidpoint\"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){const n=this._curSegment;this._curSegment++;const i=e[n-1],s=e[n],r=this._curveHelper.calculateLength(i,s);if(r<this._epsilon)continue;const l=.5+this._position/r,[a,o]=this._curveHelper.getAngleCS(i,s,l),h=t(i,s,l);return this.internalPlacement.setTranslate(h[0]-this._offset*o,h[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,o),this.internalPlacement}return this.iteratePath=!1,null}\"LineEnd\"===this._relativeTo&&n(e);const s=this.onLine(e,i);return\"LineEnd\"===this._relativeTo&&n(e),s}onLine(e,n){let i,s=!1;switch(this._relativeTo){case\"LineMiddle\":default:i=this._curveHelper.calculatePathLength(e)/2+n;break;case\"LineBeginning\":i=n;break;case\"LineEnd\":i=n,s=!0}const r=e.length;let l,a=0,o=e[0];for(let h=1;h<r;++h){l=o,o=e[h];const n=this._curveHelper.calculateLength(l,o);if(a+n>i){const e=(i-a)/n,[r,h]=this._curveHelper.getAngleCS(l,o,e),c=t(l,o,e),u=s?this._offset:-this._offset;return this.internalPlacement.setTranslate(c[0]-u*h,c[1]+u*r),this._angleToLine&&(s?this.internalPlacement.setRotateCS(-r,-h):this.internalPlacement.setRotateCS(r,h)),this.internalPlacement}a+=n}return null}}export{r as PlacementOnLine};\n"]},"metadata":{},"sourceType":"module"}