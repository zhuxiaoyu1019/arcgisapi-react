{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { SymbolHelper as t } from \"../../../../symbols/cim/CIMSymbolHelper.js\";\nimport \"../../../webgl/BufferObject.js\";\nimport \"../../../webgl/FramebufferObject.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../webgl/enums.js\";\nimport \"../../../webgl/RenderingContext.js\";\nimport \"../../../../chunks/builtins.js\";\nimport i from \"../../../webgl/Texture.js\";\nimport \"../../../webgl/VertexArrayObject.js\";\nimport e from \"./RectangleBinPack.js\";\nimport s from \"../webgl/Rect.js\";\nconst h = \"dasharray-\";\n\nclass r {\n  constructor(t, i, s = 0) {\n    this._size = [], this._mosaicsData = [], this._textures = [], this._dirties = [], this._maxItemSize = 0, this._currentPage = 0, this._pageWidth = 0, this._pageHeight = 0, this._mosaicRects = {}, this.pixelRatio = 1, (t <= 0 || i <= 0) && console.error(\"Sprites mosaic defaultWidth and defaultHeight must be greater than zero!\"), this._pageWidth = t, this._pageHeight = i, s > 0 && (this._maxItemSize = s), this._binPack = new e(t - 4, i - 4);\n  }\n\n  dispose() {\n    this._binPack = null, this._mosaicRects = {};\n\n    for (const t of this._textures) t && t.dispose();\n\n    this._textures.length = 0;\n  }\n\n  getWidth(t) {\n    return t >= this._size.length ? -1 : this._size[t][0];\n  }\n\n  getHeight(t) {\n    return t >= this._size.length ? -1 : this._size[t][1];\n  }\n\n  getPageSize(t) {\n    return t >= this._size.length ? null : this._size[t];\n  }\n\n  setSpriteSource(t) {\n    if (this.dispose(), this.pixelRatio = t.devicePixelRatio, 0 === this._mosaicsData.length) {\n      this._binPack = new e(this._pageWidth - 4, this._pageHeight - 4);\n      const t = Math.floor(this._pageWidth),\n            i = Math.floor(this._pageHeight),\n            s = new Uint32Array(t * i);\n      this._mosaicsData[0] = s, this._dirties.push(!0), this._size.push([this._pageWidth, this._pageHeight]), this._textures.push(void 0);\n    }\n\n    this._sprites = t;\n  }\n\n  getSpriteItem(t, i = !1) {\n    let e,\n        s,\n        r = this._mosaicRects[t];\n    if (r) return r;\n    if (!this._sprites || \"loaded\" !== this._sprites.loadStatus) return null;\n    if (t && t.startsWith(h) ? ([e, s] = this._rasterizeDash(t), i = !0) : e = this._sprites.getSpriteInfo(t), !e || !e.width || !e.height || e.width < 0 || e.height < 0) return null;\n\n    const a = e.width,\n          o = e.height,\n          [n, _, g] = this._allocateImage(a, o);\n\n    return n.width <= 0 ? null : (this._copy(n, e, _, g, i, s), r = {\n      rect: n,\n      width: a,\n      height: o,\n      sdf: e.sdf,\n      simplePattern: !1,\n      pixelRatio: e.pixelRatio,\n      page: _\n    }, this._mosaicRects[t] = r, r);\n  }\n\n  getSpriteItems(t) {\n    const i = {};\n\n    for (const e of t) i[e.name] = this.getSpriteItem(e.name, e.repeat);\n\n    return i;\n  }\n\n  getMosaicItemPosition(t, i) {\n    const e = this.getSpriteItem(t, i),\n          s = e && e.rect;\n    if (!s) return null;\n    s.width = e.width, s.height = e.height;\n    const h = e.width,\n          r = e.height,\n          a = 2;\n    return {\n      tl: [s.x + a, s.y + a],\n      br: [s.x + a + h, s.y + a + r],\n      page: e.page\n    };\n  }\n\n  bind(t, e, s = 0, h = 0) {\n    this._textures[s] || (this._textures[s] = new i(t, {\n      pixelFormat: 6408,\n      dataType: 5121,\n      wrapMode: 33071,\n      width: this._size[s][0],\n      height: this._size[s][1]\n    }, new Uint8Array(this._mosaicsData[s].buffer)));\n    const r = this._textures[s];\n    r.setSamplingMode(e), this._dirties[s] && r.setData(new Uint8Array(this._mosaicsData[s].buffer)), t.bindTexture(r, h), this._dirties[s] = !1;\n  }\n\n  static _copyBits(t, i, e, s, h, r, a, o, n, _, g) {\n    let p = s * i + e,\n        c = o * r + a;\n\n    if (g) {\n      c -= r;\n\n      for (let a = -1; a <= _; a++, p = ((a + _) % _ + s) * i + e, c += r) for (let i = -1; i <= n; i++) h[c + i] = t[p + (i + n) % n];\n    } else for (let l = 0; l < _; l++) {\n      for (let i = 0; i < n; i++) h[c + i] = t[p + i];\n\n      p += i, c += r;\n    }\n  }\n\n  _copy(t, i, e, s, h, a) {\n    if (!this._sprites || \"loaded\" !== this._sprites.loadStatus || e >= this._mosaicsData.length) return;\n    const o = new Uint32Array(a ? a.buffer : this._sprites.image.buffer),\n          n = this._mosaicsData[e];\n    n && o || console.error(\"Source or target images are uninitialized!\");\n    const _ = 2,\n          g = a ? i.width : this._sprites.width;\n    r._copyBits(o, g, i.x, i.y, n, s[0], t.x + _, t.y + _, i.width, i.height, h), this._dirties[e] = !0;\n  }\n\n  _allocateImage(t, i) {\n    t += 2, i += 2;\n    const h = Math.max(t, i);\n\n    if (this._maxItemSize && this._maxItemSize < h) {\n      const e = new s(0, 0, t, i);\n      return this._mosaicsData.push(new Uint32Array(t * i)), this._dirties.push(!0), this._size.push([t, i]), this._textures.push(void 0), [e, this._mosaicsData.length - 1, [t, i]];\n    }\n\n    let r = t % 4 ? 4 - t % 4 : 4,\n        a = i % 4 ? 4 - i % 4 : 4;\n    1 === r && (r = 5), 1 === a && (a = 5);\n\n    const o = this._binPack.allocate(t + r, i + a);\n\n    return o.width <= 0 ? (this._dirties[this._currentPage] || (this._mosaicsData[this._currentPage] = null), this._currentPage = this._mosaicsData.length, this._mosaicsData.push(new Uint32Array(this._pageWidth * this._pageHeight)), this._dirties.push(!0), this._size.push([this._pageWidth, this._pageHeight]), this._textures.push(void 0), this._binPack = new e(this._pageWidth - 4, this._pageHeight - 4), this._allocateImage(t, i)) : [o, this._currentPage, [this._pageWidth, this._pageHeight]];\n  }\n\n  _rasterizeDash(i) {\n    const e = /\\[(.*?)\\]/,\n          s = i.match(e);\n    if (!s) return null;\n    const h = s[1].split(\",\").map(Number),\n          r = i.slice(i.lastIndexOf(\"-\") + 1),\n          [a, o, n] = t.rasterizeDash(h, r);\n    return [{\n      x: 0,\n      y: 0,\n      width: o,\n      height: n,\n      sdf: !0,\n      pixelRatio: 1\n    }, new Uint8Array(a.buffer)];\n  }\n\n}\n\nexport default r;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/SpriteMosaic.js"],"names":["SymbolHelper","t","i","e","s","h","r","constructor","_size","_mosaicsData","_textures","_dirties","_maxItemSize","_currentPage","_pageWidth","_pageHeight","_mosaicRects","pixelRatio","console","error","_binPack","dispose","length","getWidth","getHeight","getPageSize","setSpriteSource","devicePixelRatio","Math","floor","Uint32Array","push","_sprites","getSpriteItem","loadStatus","startsWith","_rasterizeDash","getSpriteInfo","width","height","a","o","n","_","g","_allocateImage","_copy","rect","sdf","simplePattern","page","getSpriteItems","name","repeat","getMosaicItemPosition","tl","x","y","br","bind","pixelFormat","dataType","wrapMode","Uint8Array","buffer","setSamplingMode","setData","bindTexture","_copyBits","p","c","l","image","max","allocate","match","split","map","Number","slice","lastIndexOf","rasterizeDash"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{SymbolHelper as t}from\"../../../../symbols/cim/CIMSymbolHelper.js\";import\"../../../webgl/BufferObject.js\";import\"../../../webgl/FramebufferObject.js\";import\"../../../../core/has.js\";import\"../../../webgl/enums.js\";import\"../../../webgl/RenderingContext.js\";import\"../../../../chunks/builtins.js\";import i from\"../../../webgl/Texture.js\";import\"../../../webgl/VertexArrayObject.js\";import e from\"./RectangleBinPack.js\";import s from\"../webgl/Rect.js\";const h=\"dasharray-\";class r{constructor(t,i,s=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error(\"Sprites mosaic defaultWidth and defaultHeight must be greater than zero!\"),this._pageWidth=t,this._pageHeight=i,s>0&&(this._maxItemSize=s),this._binPack=new e(t-4,i-4)}dispose(){this._binPack=null,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}getPageSize(t){return t>=this._size.length?null:this._size[t]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new e(this._pageWidth-4,this._pageHeight-4);const t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),s=new Uint32Array(t*i);this._mosaicsData[0]=s,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t,i=!1){let e,s,r=this._mosaicRects[t];if(r)return r;if(!this._sprites||\"loaded\"!==this._sprites.loadStatus)return null;if(t&&t.startsWith(h)?([e,s]=this._rasterizeDash(t),i=!0):e=this._sprites.getSpriteInfo(t),!e||!e.width||!e.height||e.width<0||e.height<0)return null;const a=e.width,o=e.height,[n,_,g]=this._allocateImage(a,o);return n.width<=0?null:(this._copy(n,e,_,g,i,s),r={rect:n,width:a,height:o,sdf:e.sdf,simplePattern:!1,pixelRatio:e.pixelRatio,page:_},this._mosaicRects[t]=r,r)}getSpriteItems(t){const i={};for(const e of t)i[e.name]=this.getSpriteItem(e.name,e.repeat);return i}getMosaicItemPosition(t,i){const e=this.getSpriteItem(t,i),s=e&&e.rect;if(!s)return null;s.width=e.width,s.height=e.height;const h=e.width,r=e.height,a=2;return{tl:[s.x+a,s.y+a],br:[s.x+a+h,s.y+a+r],page:e.page}}bind(t,e,s=0,h=0){this._textures[s]||(this._textures[s]=new i(t,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[s][0],height:this._size[s][1]},new Uint8Array(this._mosaicsData[s].buffer)));const r=this._textures[s];r.setSamplingMode(e),this._dirties[s]&&r.setData(new Uint8Array(this._mosaicsData[s].buffer)),t.bindTexture(r,h),this._dirties[s]=!1}static _copyBits(t,i,e,s,h,r,a,o,n,_,g){let p=s*i+e,c=o*r+a;if(g){c-=r;for(let a=-1;a<=_;a++,p=((a+_)%_+s)*i+e,c+=r)for(let i=-1;i<=n;i++)h[c+i]=t[p+(i+n)%n]}else for(let l=0;l<_;l++){for(let i=0;i<n;i++)h[c+i]=t[p+i];p+=i,c+=r}}_copy(t,i,e,s,h,a){if(!this._sprites||\"loaded\"!==this._sprites.loadStatus||e>=this._mosaicsData.length)return;const o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),n=this._mosaicsData[e];n&&o||console.error(\"Source or target images are uninitialized!\");const _=2,g=a?i.width:this._sprites.width;r._copyBits(o,g,i.x,i.y,n,s[0],t.x+_,t.y+_,i.width,i.height,h),this._dirties[e]=!0}_allocateImage(t,i){t+=2,i+=2;const h=Math.max(t,i);if(this._maxItemSize&&this._maxItemSize<h){const e=new s(0,0,t,i);return this._mosaicsData.push(new Uint32Array(t*i)),this._dirties.push(!0),this._size.push([t,i]),this._textures.push(void 0),[e,this._mosaicsData.length-1,[t,i]]}let r=t%4?4-t%4:4,a=i%4?4-i%4:4;1===r&&(r=5),1===a&&(a=5);const o=this._binPack.allocate(t+r,i+a);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new e(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,i)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(i){const e=/\\[(.*?)\\]/,s=i.match(e);if(!s)return null;const h=s[1].split(\",\").map(Number),r=i.slice(i.lastIndexOf(\"-\")+1),[a,o,n]=t.rasterizeDash(h,r);return[{x:0,y:0,width:o,height:n,sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}export default r;\n"]},"metadata":{},"sourceType":"module"}