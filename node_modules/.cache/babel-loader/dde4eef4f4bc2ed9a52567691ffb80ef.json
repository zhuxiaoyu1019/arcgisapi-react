{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../../chunks/tslib.es6.js\";\nimport { isSome as o } from \"../../../../../../core/maybe.js\";\nimport { c as r } from \"../../../../../../chunks/mat3f64.js\";\nimport { c as t } from \"../../../../../../chunks/vec4f64.js\";\nimport { C as s } from \"../../../../../../chunks/ComponentShader.glsl.js\";\nimport { bindSliceUniforms as i } from \"../../../core/shaderLibrary/Slice.glsl.js\";\nimport { VertexPosition as a } from \"../../../core/shaderLibrary/attributes/VertexPosition.glsl.js\";\nimport { bindOutputHighlight as n } from \"../../../core/shaderLibrary/output/OutputHighlight.glsl.js\";\nimport { bindPBRUniforms as l } from \"../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js\";\nimport { bindSSRUniforms as d } from \"../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl.js\";\nimport { doublePrecisionRequiresObfuscation as u } from \"../../../core/shaderLibrary/util/DoublePrecision.glsl.js\";\nimport { ReloadableShaderModule as c } from \"../../../core/shaderTechnique/ReloadableShaderModule.js\";\nimport { ShaderTechnique as p } from \"../../../core/shaderTechnique/ShaderTechnique.js\";\nimport { ShaderTechniqueConfiguration as m, parameter as h } from \"../../../core/shaderTechnique/ShaderTechniqueConfiguration.js\";\nimport { blendingDefault as b, OITBlending as f, OITDepthTest as x, OITPolygonOffset as T } from \"../../../lib/OrderIndependentTransparency.js\";\nimport { Program as v } from \"../../../lib/Program.js\";\nimport { stencilWriteMaskOn as g, replaceBitWhenDepthTestPasses as M, stencilBaseAllZerosParams as y } from \"../../../lib/StencilUtils.js\";\nimport { makePipelineState as S, cullingParams as P, defaultDepthWriteParams as C, defaultColorWriteParams as E } from \"../../../../../webgl/renderState.js\";\n\nclass O extends p {\n  bindPass(e) {\n    const o = this.program;\n    a.bindViewProjTransform(o, e.viewTransform), i(this.program, this.configuration, e.slicePlane), 0 === e.identifier && (void 0 !== e.ssrParams && d(this.program, e.ssrParams), o.setUniformMatrix3fv(\"uTransformNormal_ViewFromGlobal\", e.transformNormal_ViewFromGlobal), 2 === e.subPass && o.setUniform2fv(\"cameraNearFar\", e.cameraNearFar), 0 === e.subPass && e.lighting.setUniforms(this.program, e.integratedMesh)), 1 === e.identifier && this.program.setUniform2fv(\"cameraNearFar\", e.cameraNearFar);\n  }\n\n  bindMaterial(e, r) {\n    const t = this.program;\n    t.setUniform4fv(\"uBaseColor\", e.baseColor), t.setUniform1f(\"uObjectOpacity\", e.objectOpacity), t.setUniform1f(\"textureAlphaCutoff\", e.alphaCutoff), 1 === e.componentParameters.type ? e.componentParameters.texture.bind(t, \"uComponentColorTex\", \"uComponentColorTexInvDim\") : (t.setUniform4fv(\"uExternalColor\", e.componentParameters.externalColor), t.setUniform1i(\"uExternalColorMixMode\", e.componentParameters.externalColorMixMode)), o(e.baseColorTexture) && e.baseColorTexture.bind(t, \"uBaseColorTexture\", \"uBaseColorTextureSize\"), 0 !== this.configuration.output && 7 !== this.configuration.output || (l(this.program, e, this.configuration.isSchematic), o(e.metallicRoughnessTexture) && e.metallicRoughnessTexture.bind(t, \"texMetallicRoughness\", \"texMetallicRoughnessSize\"), o(e.emissionTexture) && e.emissionTexture.bind(t, \"texEmission\", \"texEmissionSize\"), o(e.occlusionTexture) && e.occlusionTexture.bind(t, \"texOcclusion\", \"texOcclusionSize\"), o(e.normalTexture) && e.normalTexture.bind(t, \"normalTexture\", \"normalTextureSize\")), e.isIntegratedMesh && (0 === r.identifier && 0 === r.subPass ? (t.bindTexture(e.overlayColor, \"ovColorTex\"), t.bindTexture(e.overlayNormal, \"ovNormalTex\")) : 2 === r.identifier && t.bindTexture(e.overlayHighlight, \"ovColorTex\"), t.setUniform1f(\"overlayOpacity\", 1)), 2 === r.identifier && n(this.program, r), 0 === r.identifier && 0 === r.subPass && (r.ambientOcclusionEnabled && r.bindAmbientOcclusion(t), r.shadowsEnabled && r.bindShadowMap(t)), 0 !== r.identifier || 0 !== r.subPass && 1 !== r.subPass || !r.multipassTerrainParams.multipassTerrainEnabled || (this.program.setUniform2fv(\"cameraNearFar\", r.cameraNearFar), t.setUniform2fv(\"inverseViewport\", r.inverseViewport), r.multipassTerrainParams.terrainLinearDepthTexture && t.bindTexture(r.multipassTerrainParams.terrainLinearDepthTexture, \"terrainDepthTexture\"));\n  }\n\n  bindDraw(e, o) {\n    if (a.bindModelTransform(this.program, e), this.program.setUniformMatrix3fv(\"uTransformNormal_GlobalFromModel\", e.transformNormal_GlobalFromModel), this.program.rebindTextures(), o.isIntegratedMesh) {\n      const r = o.overlayTexScale,\n            t = o.overlayTexOffset;\n      this.program.setUniform4fv(\"overlayTexOffset\", [e.toMapSpace[0] * r[0] + t[0], e.toMapSpace[1] * r[1] + t[1], e.toMapSpace[0] * r[2] + t[2], e.toMapSpace[1] * r[3] + t[3]]), this.program.setUniform4fv(\"overlayTexScale\", [e.toMapSpace[2] * r[0], e.toMapSpace[3] * r[1], e.toMapSpace[2] * r[2], e.toMapSpace[3] * r[3]]);\n    }\n  }\n\n  initializeProgram(e) {\n    const o = O.shader.get(),\n          r = this.configuration,\n          t = o.build({\n      multipassTerrainEnabled: r.multipassTerrainEnabled,\n      cullAboveGround: r.cullAboveGround,\n      OITEnabled: 0 === r.transparencyPassType,\n      output: r.output,\n      normalType: 0 === r.integratedMeshMode ? r.hasNormals ? 1 : 3 : 2,\n      attributeColor: r.hasVertexColors,\n      attributeTextureCoordinates: r.vertexTextureCoordinates,\n      componentData: r.componentData,\n      alphaDiscardMode: r.alphaDiscardMode,\n      baseColorTexture: r.baseColorTexture,\n      doubleSidedMode: r.doubleSidedMode,\n      receiveAmbientOcclusion: r.receiveAmbientOcclusion,\n      receiveShadows: r.receiveShadows,\n      slicePlaneEnabled: r.slicePlaneEnabled,\n      sliceHighlightDisabled: !1,\n      sliceEnabledForVertexPrograms: !1,\n      viewingMode: e.viewingMode,\n      vertexDiscardMode: r.vertexDiscardMode,\n      pbrMode: 3 === r.integratedMeshMode ? 4 : r.usePBR ? r.isSchematic ? 2 : 1 : 0,\n      hasMetalnessAndRoughnessTexture: r.hasMetalnessAndRoughnessTexture,\n      hasEmissionTexture: r.hasEmissionTexture,\n      hasOcclusionTexture: r.hasOcclusionTexture,\n      hasNormalTexture: r.hasNormalTexture,\n      vertexTangents: !1,\n      supportsTextureAtlas: !0,\n      doublePrecisionRequiresObfuscation: u(e.rctx),\n      overlayEnabled: 2 === r.integratedMeshMode || 3 === r.integratedMeshMode,\n      ssrEnabled: r.ssrEnabled,\n      highStepCount: !1,\n      ellipsoidMode: r.ellipsoidMode\n    });\n    return new v(e.rctx, t, o.attributeLocations);\n  }\n\n  setPipelineState(e) {\n    const o = this.configuration,\n          r = 0 !== o.integratedMeshMode,\n          t = 3 === e,\n          s = 2 === e;\n    return S({\n      blending: 0 !== o.output && 7 !== o.output || !o.blendingEnabled ? null : t ? b : f(e),\n      culling: P(o.cullFace),\n      depthTest: {\n        func: x(e)\n      },\n      depthWrite: t || s ? C : null,\n      colorWrite: E,\n      stencilWrite: r || o.sceneHasOcludees ? g : null,\n      stencilTest: r ? M(1) : o.sceneHasOcludees ? y : null,\n      polygonOffset: t || s ? o.polygonOffsetEnabled ? {\n        factor: 2,\n        units: 2\n      } : null : T\n    });\n  }\n\n  initializePipeline() {\n    return this.setPipelineState(this.configuration.transparencyPassType);\n  }\n\n}\n\nO.shader = new c(s, () => import(\"./shader/ComponentShader.glsl.js\"));\n\nclass j extends a.ModelTransform {\n  constructor() {\n    super(...arguments), this.transformNormal_GlobalFromModel = r(), this.toMapSpace = t();\n  }\n\n}\n\nclass N extends m {\n  constructor() {\n    super(...arguments), this.output = 0, this.hasVertexColors = !1, this.hasNormals = !1, this.vertexTextureCoordinates = 0, this.componentData = 0, this.slicePlaneEnabled = !1, this.cullFace = 2, this.baseColorTexture = !1, this.receiveAmbientOcclusion = !0, this.receiveShadows = !0, this.vertexDiscardMode = 0, this.doubleSidedMode = 2, this.blendingEnabled = !0, this.alphaDiscardMode = 1, this.integratedMeshMode = 0, this.ssrEnabled = !1, this.polygonOffsetEnabled = !1, this.usePBR = !1, this.isSchematic = !1, this.hasMetalnessAndRoughnessTexture = !1, this.hasEmissionTexture = !1, this.hasOcclusionTexture = !1, this.hasNormalTexture = !1, this.sceneHasOcludees = !1, this.transparencyPassType = 3, this.ellipsoidMode = 1, this.multipassTerrainEnabled = !1, this.cullAboveGround = !1;\n  }\n\n}\n\ne([h({\n  count: 8\n})], N.prototype, \"output\", void 0), e([h()], N.prototype, \"hasVertexColors\", void 0), e([h()], N.prototype, \"hasNormals\", void 0), e([h({\n  count: 3\n})], N.prototype, \"vertexTextureCoordinates\", void 0), e([h({\n  count: 2\n})], N.prototype, \"componentData\", void 0), e([h()], N.prototype, \"slicePlaneEnabled\", void 0), e([h({\n  count: 3\n})], N.prototype, \"cullFace\", void 0), e([h()], N.prototype, \"baseColorTexture\", void 0), e([h()], N.prototype, \"receiveAmbientOcclusion\", void 0), e([h()], N.prototype, \"receiveShadows\", void 0), e([h({\n  count: 3\n})], N.prototype, \"vertexDiscardMode\", void 0), e([h({\n  count: 3\n})], N.prototype, \"doubleSidedMode\", void 0), e([h()], N.prototype, \"blendingEnabled\", void 0), e([h({\n  count: 4\n})], N.prototype, \"alphaDiscardMode\", void 0), e([h({\n  count: 4\n})], N.prototype, \"integratedMeshMode\", void 0), e([h()], N.prototype, \"ssrEnabled\", void 0), e([h()], N.prototype, \"polygonOffsetEnabled\", void 0), e([h()], N.prototype, \"usePBR\", void 0), e([h()], N.prototype, \"isSchematic\", void 0), e([h()], N.prototype, \"hasMetalnessAndRoughnessTexture\", void 0), e([h()], N.prototype, \"hasEmissionTexture\", void 0), e([h()], N.prototype, \"hasOcclusionTexture\", void 0), e([h()], N.prototype, \"hasNormalTexture\", void 0), e([h()], N.prototype, \"sceneHasOcludees\", void 0), e([h({\n  count: 4\n})], N.prototype, \"transparencyPassType\", void 0), e([h({\n  count: 4\n})], N.prototype, \"ellipsoidMode\", void 0), e([h()], N.prototype, \"multipassTerrainEnabled\", void 0), e([h()], N.prototype, \"cullAboveGround\", void 0);\nexport { j as ComponentDrawParameters, O as ComponentTechnique, N as ComponentTechniqueConfiguration };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique.js"],"names":["_","e","isSome","o","c","r","t","C","s","bindSliceUniforms","i","VertexPosition","a","bindOutputHighlight","n","bindPBRUniforms","l","bindSSRUniforms","d","doublePrecisionRequiresObfuscation","u","ReloadableShaderModule","ShaderTechnique","p","ShaderTechniqueConfiguration","m","parameter","h","blendingDefault","b","OITBlending","f","OITDepthTest","x","OITPolygonOffset","T","Program","v","stencilWriteMaskOn","g","replaceBitWhenDepthTestPasses","M","stencilBaseAllZerosParams","y","makePipelineState","S","cullingParams","P","defaultDepthWriteParams","defaultColorWriteParams","E","O","bindPass","program","bindViewProjTransform","viewTransform","configuration","slicePlane","identifier","ssrParams","setUniformMatrix3fv","transformNormal_ViewFromGlobal","subPass","setUniform2fv","cameraNearFar","lighting","setUniforms","integratedMesh","bindMaterial","setUniform4fv","baseColor","setUniform1f","objectOpacity","alphaCutoff","componentParameters","type","texture","bind","externalColor","setUniform1i","externalColorMixMode","baseColorTexture","output","isSchematic","metallicRoughnessTexture","emissionTexture","occlusionTexture","normalTexture","isIntegratedMesh","bindTexture","overlayColor","overlayNormal","overlayHighlight","ambientOcclusionEnabled","bindAmbientOcclusion","shadowsEnabled","bindShadowMap","multipassTerrainParams","multipassTerrainEnabled","inverseViewport","terrainLinearDepthTexture","bindDraw","bindModelTransform","transformNormal_GlobalFromModel","rebindTextures","overlayTexScale","overlayTexOffset","toMapSpace","initializeProgram","shader","get","build","cullAboveGround","OITEnabled","transparencyPassType","normalType","integratedMeshMode","hasNormals","attributeColor","hasVertexColors","attributeTextureCoordinates","vertexTextureCoordinates","componentData","alphaDiscardMode","doubleSidedMode","receiveAmbientOcclusion","receiveShadows","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","viewingMode","vertexDiscardMode","pbrMode","usePBR","hasMetalnessAndRoughnessTexture","hasEmissionTexture","hasOcclusionTexture","hasNormalTexture","vertexTangents","supportsTextureAtlas","rctx","overlayEnabled","ssrEnabled","highStepCount","ellipsoidMode","attributeLocations","setPipelineState","blending","blendingEnabled","culling","cullFace","depthTest","func","depthWrite","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","polygonOffsetEnabled","factor","units","initializePipeline","j","ModelTransform","constructor","arguments","N","count","prototype","ComponentDrawParameters","ComponentTechnique","ComponentTechniqueConfiguration"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../../chunks/tslib.es6.js\";import{isSome as o}from\"../../../../../../core/maybe.js\";import{c as r}from\"../../../../../../chunks/mat3f64.js\";import{c as t}from\"../../../../../../chunks/vec4f64.js\";import{C as s}from\"../../../../../../chunks/ComponentShader.glsl.js\";import{bindSliceUniforms as i}from\"../../../core/shaderLibrary/Slice.glsl.js\";import{VertexPosition as a}from\"../../../core/shaderLibrary/attributes/VertexPosition.glsl.js\";import{bindOutputHighlight as n}from\"../../../core/shaderLibrary/output/OutputHighlight.glsl.js\";import{bindPBRUniforms as l}from\"../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js\";import{bindSSRUniforms as d}from\"../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl.js\";import{doublePrecisionRequiresObfuscation as u}from\"../../../core/shaderLibrary/util/DoublePrecision.glsl.js\";import{ReloadableShaderModule as c}from\"../../../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as p}from\"../../../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as m,parameter as h}from\"../../../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{blendingDefault as b,OITBlending as f,OITDepthTest as x,OITPolygonOffset as T}from\"../../../lib/OrderIndependentTransparency.js\";import{Program as v}from\"../../../lib/Program.js\";import{stencilWriteMaskOn as g,replaceBitWhenDepthTestPasses as M,stencilBaseAllZerosParams as y}from\"../../../lib/StencilUtils.js\";import{makePipelineState as S,cullingParams as P,defaultDepthWriteParams as C,defaultColorWriteParams as E}from\"../../../../../webgl/renderState.js\";class O extends p{bindPass(e){const o=this.program;a.bindViewProjTransform(o,e.viewTransform),i(this.program,this.configuration,e.slicePlane),0===e.identifier&&(void 0!==e.ssrParams&&d(this.program,e.ssrParams),o.setUniformMatrix3fv(\"uTransformNormal_ViewFromGlobal\",e.transformNormal_ViewFromGlobal),2===e.subPass&&o.setUniform2fv(\"cameraNearFar\",e.cameraNearFar),0===e.subPass&&e.lighting.setUniforms(this.program,e.integratedMesh)),1===e.identifier&&this.program.setUniform2fv(\"cameraNearFar\",e.cameraNearFar)}bindMaterial(e,r){const t=this.program;t.setUniform4fv(\"uBaseColor\",e.baseColor),t.setUniform1f(\"uObjectOpacity\",e.objectOpacity),t.setUniform1f(\"textureAlphaCutoff\",e.alphaCutoff),1===e.componentParameters.type?e.componentParameters.texture.bind(t,\"uComponentColorTex\",\"uComponentColorTexInvDim\"):(t.setUniform4fv(\"uExternalColor\",e.componentParameters.externalColor),t.setUniform1i(\"uExternalColorMixMode\",e.componentParameters.externalColorMixMode)),o(e.baseColorTexture)&&e.baseColorTexture.bind(t,\"uBaseColorTexture\",\"uBaseColorTextureSize\"),0!==this.configuration.output&&7!==this.configuration.output||(l(this.program,e,this.configuration.isSchematic),o(e.metallicRoughnessTexture)&&e.metallicRoughnessTexture.bind(t,\"texMetallicRoughness\",\"texMetallicRoughnessSize\"),o(e.emissionTexture)&&e.emissionTexture.bind(t,\"texEmission\",\"texEmissionSize\"),o(e.occlusionTexture)&&e.occlusionTexture.bind(t,\"texOcclusion\",\"texOcclusionSize\"),o(e.normalTexture)&&e.normalTexture.bind(t,\"normalTexture\",\"normalTextureSize\")),e.isIntegratedMesh&&(0===r.identifier&&0===r.subPass?(t.bindTexture(e.overlayColor,\"ovColorTex\"),t.bindTexture(e.overlayNormal,\"ovNormalTex\")):2===r.identifier&&t.bindTexture(e.overlayHighlight,\"ovColorTex\"),t.setUniform1f(\"overlayOpacity\",1)),2===r.identifier&&n(this.program,r),0===r.identifier&&0===r.subPass&&(r.ambientOcclusionEnabled&&r.bindAmbientOcclusion(t),r.shadowsEnabled&&r.bindShadowMap(t)),0!==r.identifier||0!==r.subPass&&1!==r.subPass||!r.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv(\"cameraNearFar\",r.cameraNearFar),t.setUniform2fv(\"inverseViewport\",r.inverseViewport),r.multipassTerrainParams.terrainLinearDepthTexture&&t.bindTexture(r.multipassTerrainParams.terrainLinearDepthTexture,\"terrainDepthTexture\"))}bindDraw(e,o){if(a.bindModelTransform(this.program,e),this.program.setUniformMatrix3fv(\"uTransformNormal_GlobalFromModel\",e.transformNormal_GlobalFromModel),this.program.rebindTextures(),o.isIntegratedMesh){const r=o.overlayTexScale,t=o.overlayTexOffset;this.program.setUniform4fv(\"overlayTexOffset\",[e.toMapSpace[0]*r[0]+t[0],e.toMapSpace[1]*r[1]+t[1],e.toMapSpace[0]*r[2]+t[2],e.toMapSpace[1]*r[3]+t[3]]),this.program.setUniform4fv(\"overlayTexScale\",[e.toMapSpace[2]*r[0],e.toMapSpace[3]*r[1],e.toMapSpace[2]*r[2],e.toMapSpace[3]*r[3]])}}initializeProgram(e){const o=O.shader.get(),r=this.configuration,t=o.build({multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround,OITEnabled:0===r.transparencyPassType,output:r.output,normalType:0===r.integratedMeshMode?r.hasNormals?1:3:2,attributeColor:r.hasVertexColors,attributeTextureCoordinates:r.vertexTextureCoordinates,componentData:r.componentData,alphaDiscardMode:r.alphaDiscardMode,baseColorTexture:r.baseColorTexture,doubleSidedMode:r.doubleSidedMode,receiveAmbientOcclusion:r.receiveAmbientOcclusion,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:e.viewingMode,vertexDiscardMode:r.vertexDiscardMode,pbrMode:3===r.integratedMeshMode?4:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:u(e.rctx),overlayEnabled:2===r.integratedMeshMode||3===r.integratedMeshMode,ssrEnabled:r.ssrEnabled,highStepCount:!1,ellipsoidMode:r.ellipsoidMode});return new v(e.rctx,t,o.attributeLocations)}setPipelineState(e){const o=this.configuration,r=0!==o.integratedMeshMode,t=3===e,s=2===e;return S({blending:0!==o.output&&7!==o.output||!o.blendingEnabled?null:t?b:f(e),culling:P(o.cullFace),depthTest:{func:x(e)},depthWrite:t||s?C:null,colorWrite:E,stencilWrite:r||o.sceneHasOcludees?g:null,stencilTest:r?M(1):o.sceneHasOcludees?y:null,polygonOffset:t||s?o.polygonOffsetEnabled?{factor:2,units:2}:null:T})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}O.shader=new c(s,(()=>import(\"./shader/ComponentShader.glsl.js\")));class j extends a.ModelTransform{constructor(){super(...arguments),this.transformNormal_GlobalFromModel=r(),this.toMapSpace=t()}}class N extends m{constructor(){super(...arguments),this.output=0,this.hasVertexColors=!1,this.hasNormals=!1,this.vertexTextureCoordinates=0,this.componentData=0,this.slicePlaneEnabled=!1,this.cullFace=2,this.baseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.vertexDiscardMode=0,this.doubleSidedMode=2,this.blendingEnabled=!0,this.alphaDiscardMode=1,this.integratedMeshMode=0,this.ssrEnabled=!1,this.polygonOffsetEnabled=!1,this.usePBR=!1,this.isSchematic=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.ellipsoidMode=1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([h({count:8})],N.prototype,\"output\",void 0),e([h()],N.prototype,\"hasVertexColors\",void 0),e([h()],N.prototype,\"hasNormals\",void 0),e([h({count:3})],N.prototype,\"vertexTextureCoordinates\",void 0),e([h({count:2})],N.prototype,\"componentData\",void 0),e([h()],N.prototype,\"slicePlaneEnabled\",void 0),e([h({count:3})],N.prototype,\"cullFace\",void 0),e([h()],N.prototype,\"baseColorTexture\",void 0),e([h()],N.prototype,\"receiveAmbientOcclusion\",void 0),e([h()],N.prototype,\"receiveShadows\",void 0),e([h({count:3})],N.prototype,\"vertexDiscardMode\",void 0),e([h({count:3})],N.prototype,\"doubleSidedMode\",void 0),e([h()],N.prototype,\"blendingEnabled\",void 0),e([h({count:4})],N.prototype,\"alphaDiscardMode\",void 0),e([h({count:4})],N.prototype,\"integratedMeshMode\",void 0),e([h()],N.prototype,\"ssrEnabled\",void 0),e([h()],N.prototype,\"polygonOffsetEnabled\",void 0),e([h()],N.prototype,\"usePBR\",void 0),e([h()],N.prototype,\"isSchematic\",void 0),e([h()],N.prototype,\"hasMetalnessAndRoughnessTexture\",void 0),e([h()],N.prototype,\"hasEmissionTexture\",void 0),e([h()],N.prototype,\"hasOcclusionTexture\",void 0),e([h()],N.prototype,\"hasNormalTexture\",void 0),e([h()],N.prototype,\"sceneHasOcludees\",void 0),e([h({count:4})],N.prototype,\"transparencyPassType\",void 0),e([h({count:4})],N.prototype,\"ellipsoidMode\",void 0),e([h()],N.prototype,\"multipassTerrainEnabled\",void 0),e([h()],N.prototype,\"cullAboveGround\",void 0);export{j as ComponentDrawParameters,O as ComponentTechnique,N as ComponentTechniqueConfiguration};\n"]},"metadata":{},"sourceType":"module"}