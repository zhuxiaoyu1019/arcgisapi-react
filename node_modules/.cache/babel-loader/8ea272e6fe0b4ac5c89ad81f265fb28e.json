{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e } from \"../../../../../core/maybe.js\";\nimport { WGLDrawPhase as t } from \"../enums.js\";\nimport { u32to4Xu8 as r } from \"../number.js\";\nimport a from \"./WGLBrush.js\";\n\nclass i extends a {\n  constructor() {\n    super(...arguments), this._programOptions = {\n      id: !1\n    };\n  }\n\n  dispose() {}\n\n  drawMany(a, i) {\n    const {\n      context: n,\n      displayLevel: s,\n      requiredLevel: o,\n      state: l,\n      drawPhase: c,\n      painter: u,\n      spriteMosaic: d,\n      styleLayerUID: f\n    } = a;\n    if (!i.some(e => {\n      var t, r;\n      return null != (t = null == (r = e.layerData.get(f)) ? void 0 : r.circleIndexCount) && t;\n    })) return;\n    const m = a.styleLayer,\n          p = m.circleMaterial,\n          y = u.vectorTilesMaterialManager,\n          v = 1.2,\n          g = m.getPaintValue(\"circle-translate\", s),\n          M = m.getPaintValue(\"circle-translate-anchor\", s),\n          x = c === t.HITTEST,\n          _ = this._programOptions;\n    _.id = x;\n    const U = y.getMaterialProgram(n, p, _);\n    n.useProgram(U), U.setUniformMatrix3fv(\"u_displayMat3\", 1 === M ? l.displayMat3 : l.displayViewMat3), U.setUniform2fv(\"u_circleTranslation\", g), U.setUniform1f(\"u_depth\", m.z), U.setUniform1f(\"u_antialiasingWidth\", v);\n    let h = -1;\n\n    if (x) {\n      const e = r(f + 1);\n      U.setUniform4fv(\"u_id\", e);\n    }\n\n    for (const t of i) {\n      if (!t.layerData.has(f)) continue;\n      t.key.level !== h && (h = t.key.level, p.setDataUniforms(U, s, m, h, d));\n      const r = t.layerData.get(f);\n      if (!r.circleIndexCount) continue;\n      r.prepareForRendering(n);\n      const a = r.circleVertexArrayObject;\n      e(a) || (n.bindVAO(a), U.setUniformMatrix3fv(\"u_dvsMat3\", t.transforms.dvs), o !== t.key.level ? n.setStencilFunction(514, t.stencilRef, 255) : n.setStencilFunction(516, 255, 255), n.drawElements(4, r.circleIndexCount, 5125, Uint32Array.BYTES_PER_ELEMENT * r.circleIndexStart), t.triangleCount += r.circleIndexCount / 3);\n    }\n  }\n\n}\n\nexport { i as WGLBrushVTLCircle };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushVTLCircle.js"],"names":["isNone","e","WGLDrawPhase","t","u32to4Xu8","r","a","i","constructor","arguments","_programOptions","id","dispose","drawMany","context","n","displayLevel","s","requiredLevel","o","state","l","drawPhase","c","painter","u","spriteMosaic","d","styleLayerUID","f","some","layerData","get","circleIndexCount","m","styleLayer","p","circleMaterial","y","vectorTilesMaterialManager","v","g","getPaintValue","M","x","HITTEST","_","U","getMaterialProgram","useProgram","setUniformMatrix3fv","displayMat3","displayViewMat3","setUniform2fv","setUniform1f","z","h","setUniform4fv","has","key","level","setDataUniforms","prepareForRendering","circleVertexArrayObject","bindVAO","transforms","dvs","setStencilFunction","stencilRef","drawElements","Uint32Array","BYTES_PER_ELEMENT","circleIndexStart","triangleCount","WGLBrushVTLCircle"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e}from\"../../../../../core/maybe.js\";import{WGLDrawPhase as t}from\"../enums.js\";import{u32to4Xu8 as r}from\"../number.js\";import a from\"./WGLBrush.js\";class i extends a{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(a,i){const{context:n,displayLevel:s,requiredLevel:o,state:l,drawPhase:c,painter:u,spriteMosaic:d,styleLayerUID:f}=a;if(!i.some((e=>{var t,r;return null!=(t=null==(r=e.layerData.get(f))?void 0:r.circleIndexCount)&&t})))return;const m=a.styleLayer,p=m.circleMaterial,y=u.vectorTilesMaterialManager,v=1.2,g=m.getPaintValue(\"circle-translate\",s),M=m.getPaintValue(\"circle-translate-anchor\",s),x=c===t.HITTEST,_=this._programOptions;_.id=x;const U=y.getMaterialProgram(n,p,_);n.useProgram(U),U.setUniformMatrix3fv(\"u_displayMat3\",1===M?l.displayMat3:l.displayViewMat3),U.setUniform2fv(\"u_circleTranslation\",g),U.setUniform1f(\"u_depth\",m.z),U.setUniform1f(\"u_antialiasingWidth\",v);let h=-1;if(x){const e=r(f+1);U.setUniform4fv(\"u_id\",e)}for(const t of i){if(!t.layerData.has(f))continue;t.key.level!==h&&(h=t.key.level,p.setDataUniforms(U,s,m,h,d));const r=t.layerData.get(f);if(!r.circleIndexCount)continue;r.prepareForRendering(n);const a=r.circleVertexArrayObject;e(a)||(n.bindVAO(a),U.setUniformMatrix3fv(\"u_dvsMat3\",t.transforms.dvs),o!==t.key.level?n.setStencilFunction(514,t.stencilRef,255):n.setStencilFunction(516,255,255),n.drawElements(4,r.circleIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*r.circleIndexStart),t.triangleCount+=r.circleIndexCount/3)}}}export{i as WGLBrushVTLCircle};\n"]},"metadata":{},"sourceType":"module"}