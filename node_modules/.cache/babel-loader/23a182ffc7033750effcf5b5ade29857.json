{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { eachAlways as e } from \"../../../../../core/promiseUtils.js\";\nimport { TargetBuffer as t, AttributeType as s } from \"./types.js\";\n\nclass i {\n  constructor(e, s, i, r, n) {\n    this.buffer = e, this.componentType = i, this.dataType = r, this.data = [], this.isFinalized = !1, this.accessorIndex = -1, this.accessorAttribute = null, this.accessorMin = null, this.accessorMax = null, s.bufferViews || (s.bufferViews = []), this.index = s.bufferViews.length, this.bufferView = {\n      buffer: e.index,\n      byteLength: -1,\n      target: n\n    };\n    const a = this.getElementSize();\n    a >= 4 && n !== t.ELEMENT_ARRAY_BUFFER && (this.bufferView.byteStride = a), s.bufferViews.push(this.bufferView);\n  }\n\n  push(e) {\n    const t = this.data.length;\n\n    if (this.data.push(e), this.accessorIndex >= 0) {\n      const s = t % this.numComponentsForDataType(),\n            i = this.accessorMin[s];\n      this.accessorMin[s] = \"number\" != typeof i ? e : Math.min(i, e);\n      const r = this.accessorMax[s];\n      this.accessorMax[s] = \"number\" != typeof r ? e : Math.max(r, e);\n    }\n  }\n\n  get dataSize() {\n    return this.data.length * this.sizeComponentType();\n  }\n\n  get size() {\n    function e(e, t) {\n      return t * Math.ceil(e / t);\n    }\n\n    return e(this.dataSize, 4);\n  }\n\n  getByteOffset() {\n    if (!this.isFinalized) throw new Error(\"Cannot get BufferView offset until it is finalized\");\n    return this.buffer.getByteOffset(this);\n  }\n\n  get byteOffset() {\n    if (!this.isFinalized) throw new Error(\"Cannot get BufferView offset until it is finalized\");\n    return this.buffer.getByteOffset(this);\n  }\n\n  writeOutToBuffer(e, t = this.size) {\n    const s = new DataView(e, t),\n          i = this.sizeComponentType();\n\n    for (let r = 0; r < this.data.length; ++r) this.writeValue(s, r * i, this.data[r]);\n  }\n\n  writeAsync(e) {\n    if (this.asyncWritePromise) throw new Error(\"Can't write multiple bufferView vlaues asynchronously\");\n    return this.asyncWritePromise = e.then(e => {\n      const t = new Uint8Array(e);\n\n      for (let s = 0; s < t.byteLength; ++s) this.data.push(t[s]);\n\n      delete this.asyncWritePromise;\n    }), this.asyncWritePromise;\n  }\n\n  startAccessor(e) {\n    if (this.accessorIndex >= 0) throw new Error(\"Accessor was started without ending the previous one\");\n    this.accessorIndex = this.data.length, this.accessorAttribute = e;\n    const t = this.numComponentsForDataType();\n    this.accessorMin = new Array(t), this.accessorMax = new Array(t);\n  }\n\n  endAccessor() {\n    if (this.accessorIndex < 0) throw new Error(\"An accessor was not started, but was attempted to be ended\");\n    const e = this.getElementSize(),\n          t = this.numComponentsForDataType(),\n          s = (this.data.length - this.accessorIndex) / t;\n    if (s % 1) throw new Error(\"An accessor was ended with missing component values\");\n\n    for (let r = 0; r < this.accessorMin.length; ++r) \"number\" != typeof this.accessorMin[r] && (this.accessorMin[r] = 0), \"number\" != typeof this.accessorMax[r] && (this.accessorMax[r] = 0);\n\n    const i = {\n      byteOffset: e * (this.accessorIndex / t),\n      componentType: this.componentType,\n      count: s,\n      type: this.dataType,\n      min: this.accessorMin,\n      max: this.accessorMax,\n      name: this.accessorAttribute\n    };\n\n    switch (this.accessorAttribute) {\n      case \"TEXCOORD_0\":\n      case \"TEXCOORD_1\":\n      case \"COLOR_0\":\n      case \"WEIGHTS_0\":\n        switch (this.componentType) {\n          case 5121:\n          case 5123:\n            i.normalized = !0;\n        }\n\n    }\n\n    return this.accessorIndex = -1, this.accessorAttribute = null, this.accessorMin = null, this.accessorMax = null, i;\n  }\n\n  get finalized() {\n    return this.finalizedPromise ? this.finalizedPromise : this.isFinalized ? this.finalizedPromise = Promise.resolve() : this.finalizedPromise = new Promise(e => this.finalizedPromiseResolve = e);\n  }\n\n  finalize() {\n    const t = this.bufferView;\n    return new Promise(t => {\n      const s = this.buffer.getViewFinalizePromises(this);\n      this.asyncWritePromise && s.push(this.asyncWritePromise), t(e(s));\n    }).then(() => {\n      this.isFinalized = !0, t.byteOffset = this.getByteOffset(), t.byteLength = this.dataSize, this.finalizedPromiseResolve && this.finalizedPromiseResolve();\n    });\n  }\n\n  getElementSize() {\n    return this.sizeComponentType() * this.numComponentsForDataType();\n  }\n\n  sizeComponentType() {\n    switch (this.componentType) {\n      case 5120:\n      case 5121:\n        return 1;\n\n      case 5122:\n      case 5123:\n        return 2;\n\n      case 5125:\n      case 5126:\n        return 4;\n    }\n  }\n\n  numComponentsForDataType() {\n    switch (this.dataType) {\n      case s.SCALAR:\n        return 1;\n\n      case s.VEC2:\n        return 2;\n\n      case s.VEC3:\n        return 3;\n\n      case s.VEC4:\n      case s.MAT2:\n        return 4;\n\n      case s.MAT3:\n        return 9;\n\n      case s.MAT4:\n        return 16;\n    }\n  }\n\n  writeValue(e, t, s) {\n    switch (this.componentType) {\n      case 5120:\n        e.setInt8(t, s);\n        break;\n\n      case 5121:\n        e.setUint8(t, s);\n        break;\n\n      case 5122:\n        e.setInt16(t, s, !0);\n        break;\n\n      case 5123:\n        e.setUint16(t, s, !0);\n        break;\n\n      case 5125:\n        e.setUint32(t, s, !0);\n        break;\n\n      case 5126:\n        e.setFloat32(t, s, !0);\n        break;\n\n      default:\n        throw new Error(`Unsupported data type: ${this.componentType}`);\n    }\n  }\n\n}\n\nexport { i as BufferView };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/geometry/support/meshUtils/exporters/gltf/bufferview.js"],"names":["eachAlways","e","TargetBuffer","t","AttributeType","s","i","constructor","r","n","buffer","componentType","dataType","data","isFinalized","accessorIndex","accessorAttribute","accessorMin","accessorMax","bufferViews","index","length","bufferView","byteLength","target","a","getElementSize","ELEMENT_ARRAY_BUFFER","byteStride","push","numComponentsForDataType","Math","min","max","dataSize","sizeComponentType","size","ceil","getByteOffset","Error","byteOffset","writeOutToBuffer","DataView","writeValue","writeAsync","asyncWritePromise","then","Uint8Array","startAccessor","Array","endAccessor","count","type","name","normalized","finalized","finalizedPromise","Promise","resolve","finalizedPromiseResolve","finalize","getViewFinalizePromises","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","setInt8","setUint8","setInt16","setUint16","setUint32","setFloat32","BufferView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{eachAlways as e}from\"../../../../../core/promiseUtils.js\";import{TargetBuffer as t,AttributeType as s}from\"./types.js\";class i{constructor(e,s,i,r,n){this.buffer=e,this.componentType=i,this.dataType=r,this.data=[],this.isFinalized=!1,this.accessorIndex=-1,this.accessorAttribute=null,this.accessorMin=null,this.accessorMax=null,s.bufferViews||(s.bufferViews=[]),this.index=s.bufferViews.length,this.bufferView={buffer:e.index,byteLength:-1,target:n};const a=this.getElementSize();a>=4&&n!==t.ELEMENT_ARRAY_BUFFER&&(this.bufferView.byteStride=a),s.bufferViews.push(this.bufferView)}push(e){const t=this.data.length;if(this.data.push(e),this.accessorIndex>=0){const s=t%this.numComponentsForDataType(),i=this.accessorMin[s];this.accessorMin[s]=\"number\"!=typeof i?e:Math.min(i,e);const r=this.accessorMax[s];this.accessorMax[s]=\"number\"!=typeof r?e:Math.max(r,e)}}get dataSize(){return this.data.length*this.sizeComponentType()}get size(){function e(e,t){return t*Math.ceil(e/t)}return e(this.dataSize,4)}getByteOffset(){if(!this.isFinalized)throw new Error(\"Cannot get BufferView offset until it is finalized\");return this.buffer.getByteOffset(this)}get byteOffset(){if(!this.isFinalized)throw new Error(\"Cannot get BufferView offset until it is finalized\");return this.buffer.getByteOffset(this)}writeOutToBuffer(e,t=this.size){const s=new DataView(e,t),i=this.sizeComponentType();for(let r=0;r<this.data.length;++r)this.writeValue(s,r*i,this.data[r])}writeAsync(e){if(this.asyncWritePromise)throw new Error(\"Can't write multiple bufferView vlaues asynchronously\");return this.asyncWritePromise=e.then((e=>{const t=new Uint8Array(e);for(let s=0;s<t.byteLength;++s)this.data.push(t[s]);delete this.asyncWritePromise})),this.asyncWritePromise}startAccessor(e){if(this.accessorIndex>=0)throw new Error(\"Accessor was started without ending the previous one\");this.accessorIndex=this.data.length,this.accessorAttribute=e;const t=this.numComponentsForDataType();this.accessorMin=new Array(t),this.accessorMax=new Array(t)}endAccessor(){if(this.accessorIndex<0)throw new Error(\"An accessor was not started, but was attempted to be ended\");const e=this.getElementSize(),t=this.numComponentsForDataType(),s=(this.data.length-this.accessorIndex)/t;if(s%1)throw new Error(\"An accessor was ended with missing component values\");for(let r=0;r<this.accessorMin.length;++r)\"number\"!=typeof this.accessorMin[r]&&(this.accessorMin[r]=0),\"number\"!=typeof this.accessorMax[r]&&(this.accessorMax[r]=0);const i={byteOffset:e*(this.accessorIndex/t),componentType:this.componentType,count:s,type:this.dataType,min:this.accessorMin,max:this.accessorMax,name:this.accessorAttribute};switch(this.accessorAttribute){case\"TEXCOORD_0\":case\"TEXCOORD_1\":case\"COLOR_0\":case\"WEIGHTS_0\":switch(this.componentType){case 5121:case 5123:i.normalized=!0}}return this.accessorIndex=-1,this.accessorAttribute=null,this.accessorMin=null,this.accessorMax=null,i}get finalized(){return this.finalizedPromise?this.finalizedPromise:this.isFinalized?this.finalizedPromise=Promise.resolve():this.finalizedPromise=new Promise((e=>this.finalizedPromiseResolve=e))}finalize(){const t=this.bufferView;return new Promise((t=>{const s=this.buffer.getViewFinalizePromises(this);this.asyncWritePromise&&s.push(this.asyncWritePromise),t(e(s))})).then((()=>{this.isFinalized=!0,t.byteOffset=this.getByteOffset(),t.byteLength=this.dataSize,this.finalizedPromiseResolve&&this.finalizedPromiseResolve()}))}getElementSize(){return this.sizeComponentType()*this.numComponentsForDataType()}sizeComponentType(){switch(this.componentType){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5125:case 5126:return 4}}numComponentsForDataType(){switch(this.dataType){case s.SCALAR:return 1;case s.VEC2:return 2;case s.VEC3:return 3;case s.VEC4:case s.MAT2:return 4;case s.MAT3:return 9;case s.MAT4:return 16}}writeValue(e,t,s){switch(this.componentType){case 5120:e.setInt8(t,s);break;case 5121:e.setUint8(t,s);break;case 5122:e.setInt16(t,s,!0);break;case 5123:e.setUint16(t,s,!0);break;case 5125:e.setUint32(t,s,!0);break;case 5126:e.setFloat32(t,s,!0);break;default:throw new Error(`Unsupported data type: ${this.componentType}`)}}}export{i as BufferView};\n"]},"metadata":{},"sourceType":"module"}