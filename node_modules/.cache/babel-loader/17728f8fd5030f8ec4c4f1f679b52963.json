{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport e from \"../../../core/Error.js\";\nimport { isSome as s } from \"../../../core/maybe.js\";\nimport { eachAlways as r } from \"../../../core/promiseUtils.js\";\nimport { property as i } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as o } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport a from \"../RasterInfo.js\";\nimport m from \"./BaseRaster.js\";\nimport { split as n, estimateStatisticsHistograms as l } from \"../rasterFunctions/pixelUtils.js\";\nimport p from \"../../../geometry/Extent.js\";\nimport c from \"../../../geometry/SpatialReference.js\";\nlet h = class extends m {\n  constructor() {\n    super(...arguments), this.datasetFormat = \"MEMORY\";\n  }\n\n  async open(t) {\n    var e;\n    await this.init();\n    const {\n      pixelBlock: s,\n      statistics: r,\n      histograms: i,\n      name: o,\n      keyProperties: m,\n      nativeExtent: n,\n      transform: l\n    } = this.data,\n          {\n      width: h,\n      height: d,\n      pixelType: f\n    } = s,\n          u = this.data.extent || new p({\n      xmin: -.5,\n      ymin: .5,\n      xmax: h - .5,\n      ymax: d - .5,\n      spatialReference: new c({\n        wkid: 3857\n      })\n    }),\n          y = null != (e = this.data.isPseudoSpatialReference) ? e : !this.data.extent,\n          x = {\n      x: u.width / h,\n      y: u.height / d\n    },\n          g = new a({\n      width: h,\n      height: d,\n      pixelType: f,\n      extent: u,\n      nativeExtent: n,\n      transform: l,\n      pixelSize: x,\n      spatialReference: u.spatialReference,\n      bandCount: 3,\n      keyProperties: m || {},\n      statistics: r,\n      isPseudoSpatialReference: y,\n      histograms: i\n    });\n    this.createRemoteDatasetStorageInfo(g, 512, 512), this._set(\"rasterInfo\", g), this.updateTileInfo(), await this._buildInMemoryRaster(s, {\n      width: 512,\n      height: 512\n    }, t), this.datasetName = o, this.url = \"/InMemory/\" + o;\n  }\n\n  fetchRawTile(t, e, s, r = {}) {\n    const i = this._pixelBlockTiles.get(`${t}/${e}/${s}`);\n\n    return Promise.resolve(i);\n  }\n\n  async _buildInMemoryRaster(t, i, o) {\n    const a = this.rasterInfo.storageInfo.maximumPyramidLevel,\n          m = this.rasterJobHandler ? this.rasterJobHandler.split({\n      pixelBlock: t,\n      tileSize: i,\n      maximumPyramidLevel: a\n    }, o) : Promise.resolve(n(t, i, a)),\n          p = s(this.rasterInfo.statistics),\n          c = s(this.rasterInfo.histograms),\n          h = p && c ? Promise.resolve({\n      statistics: null,\n      histograms: null\n    }) : this.rasterJobHandler ? this.rasterJobHandler.estimateStatisticsHistograms({\n      pixelBlock: t\n    }, o) : Promise.resolve(l(t)),\n          d = await r([m, h]);\n    if (!d[0].value && d[1].value) throw new e(\"inmemory-raster:open\", \"failed to build in memory raster\");\n    var f, u;\n    (this._pixelBlockTiles = d[0].value, p) || (this.rasterInfo.statistics = null == (f = d[1].value) ? void 0 : f.statistics);\n    c && (this.rasterInfo.histograms = null == (u = d[1].value) ? void 0 : u.histograms);\n  }\n\n};\nt([i({\n  type: String,\n  json: {\n    write: !0\n  }\n})], h.prototype, \"datasetFormat\", void 0), t([i()], h.prototype, \"data\", void 0), h = t([o(\"esri.layers.support.rasterDatasets.InMemoryRaster\")], h);\nvar d = h;\nexport default d;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/rasterDatasets/InMemoryRaster.js"],"names":["_","t","e","isSome","s","eachAlways","r","property","i","subclass","o","a","m","split","n","estimateStatisticsHistograms","l","p","c","h","constructor","arguments","datasetFormat","open","init","pixelBlock","statistics","histograms","name","keyProperties","nativeExtent","transform","data","width","height","d","pixelType","f","u","extent","xmin","ymin","xmax","ymax","spatialReference","wkid","y","isPseudoSpatialReference","x","g","pixelSize","bandCount","createRemoteDatasetStorageInfo","_set","updateTileInfo","_buildInMemoryRaster","datasetName","url","fetchRawTile","_pixelBlockTiles","get","Promise","resolve","rasterInfo","storageInfo","maximumPyramidLevel","rasterJobHandler","tileSize","value","type","String","json","write","prototype"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import e from\"../../../core/Error.js\";import{isSome as s}from\"../../../core/maybe.js\";import{eachAlways as r}from\"../../../core/promiseUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../RasterInfo.js\";import m from\"./BaseRaster.js\";import{split as n,estimateStatisticsHistograms as l}from\"../rasterFunctions/pixelUtils.js\";import p from\"../../../geometry/Extent.js\";import c from\"../../../geometry/SpatialReference.js\";let h=class extends m{constructor(){super(...arguments),this.datasetFormat=\"MEMORY\"}async open(t){var e;await this.init();const{pixelBlock:s,statistics:r,histograms:i,name:o,keyProperties:m,nativeExtent:n,transform:l}=this.data,{width:h,height:d,pixelType:f}=s,u=this.data.extent||new p({xmin:-.5,ymin:.5,xmax:h-.5,ymax:d-.5,spatialReference:new c({wkid:3857})}),y=null!=(e=this.data.isPseudoSpatialReference)?e:!this.data.extent,x={x:u.width/h,y:u.height/d},g=new a({width:h,height:d,pixelType:f,extent:u,nativeExtent:n,transform:l,pixelSize:x,spatialReference:u.spatialReference,bandCount:3,keyProperties:m||{},statistics:r,isPseudoSpatialReference:y,histograms:i});this.createRemoteDatasetStorageInfo(g,512,512),this._set(\"rasterInfo\",g),this.updateTileInfo(),await this._buildInMemoryRaster(s,{width:512,height:512},t),this.datasetName=o,this.url=\"/InMemory/\"+o}fetchRawTile(t,e,s,r={}){const i=this._pixelBlockTiles.get(`${t}/${e}/${s}`);return Promise.resolve(i)}async _buildInMemoryRaster(t,i,o){const a=this.rasterInfo.storageInfo.maximumPyramidLevel,m=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:i,maximumPyramidLevel:a},o):Promise.resolve(n(t,i,a)),p=s(this.rasterInfo.statistics),c=s(this.rasterInfo.histograms),h=p&&c?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},o):Promise.resolve(l(t)),d=await r([m,h]);if(!d[0].value&&d[1].value)throw new e(\"inmemory-raster:open\",\"failed to build in memory raster\");var f,u;(this._pixelBlockTiles=d[0].value,p)||(this.rasterInfo.statistics=null==(f=d[1].value)?void 0:f.statistics);c&&(this.rasterInfo.histograms=null==(u=d[1].value)?void 0:u.histograms)}};t([i({type:String,json:{write:!0}})],h.prototype,\"datasetFormat\",void 0),t([i()],h.prototype,\"data\",void 0),h=t([o(\"esri.layers.support.rasterDatasets.InMemoryRaster\")],h);var d=h;export default d;\n"]},"metadata":{},"sourceType":"module"}