{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport { clamp as t } from \"../../../../core/mathUtils.js\";\nimport { createRenderScreenPointArray3 as r } from \"../../../../core/screenUtils.js\";\nimport { property as o } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as s } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { d as i, z as n, g as a, e as c, f as d, n as p } from \"../../../../chunks/vec3.js\";\nimport { c as h } from \"../../../../chunks/vec3f64.js\";\nimport u from \"../../../../geometry/Point.js\";\nimport { wrap as l } from \"../../../../geometry/support/ray.js\";\nimport { PropertiesPool as m } from \"../PropertiesPool.js\";\nimport { PointOfInterest as f } from \"./PointOfInterest.js\";\nimport { TaskPriority as y } from \"../../../support/Scheduler.js\";\nconst g = Array;\n\nlet _ = class extends f {\n  constructor(e) {\n    super(e), this._propertiesPool = new m({\n      location: u,\n      renderLocation: g\n    }, this), this._dirty = !0, this.renderLocation = this._propertiesPool.get(\"renderLocation\");\n  }\n\n  initialize() {\n    this.handles.add([this.centerOnSurface.watch(\"renderLocation\", () => this.updateRenderLocation()), this.state.watch(\"camera\", () => this.updateRenderLocation())]), this.scheduler && this.handles.add(this.scheduler.registerTask(y.POINT_OF_INTEREST_FREQUENT, this));\n  }\n\n  destroy() {\n    this._propertiesPool.destroy(), this._propertiesPool = null;\n  }\n\n  get updating() {\n    return this._dirty || this.centerOnSurface.updating;\n  }\n\n  get location() {\n    const e = this._propertiesPool.get(\"location\");\n\n    return this.renderCoordsHelper.fromRenderCoords(this.renderLocation, e, this.state.spatialReference), e;\n  }\n\n  get running() {\n    return this._dirty;\n  }\n\n  runTask() {\n    const e = this._get(\"renderLocation\"),\n          r = this.centerOnSurface.renderLocation,\n          o = this.renderCoordsHelper,\n          s = this.state.camera;\n\n    this._dirty = !1, o.worldUpAtPosition(r, S);\n    const d = Math.max(0, (Math.acos(i(S, s.viewForward)) - .5 * Math.PI) * (s.aboveGround ? 1 : -1));\n\n    if (Number.isNaN(d)) {\n      if (!e || !n(e, r)) {\n        const e = this._propertiesPool.get(\"renderLocation\");\n\n        a(e, r), this._set(\"renderLocation\", e);\n      }\n\n      return;\n    }\n\n    const p = 1 - t(d / (.5 * Math.PI), 0, 1),\n          h = p * p * p;\n\n    this._calculateScreenHorizontalEdgeOnSurface(O);\n\n    const u = this._propertiesPool.get(\"renderLocation\");\n\n    c(u, r, O, h), e && n(e, u) || this._set(\"renderLocation\", u);\n  }\n\n  _calculateScreenHorizontalEdgeOnSurface(e) {\n    const t = this.state.camera,\n          o = t.getRenderCenter(r());\n    if (o[1] = t.aboveGround ? t.padding[2] : t.fullHeight - t.padding[0], this.estimateSurfaceIntersectionAtRenderPoint(o, e)) return e;\n    const s = this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);\n\n    if (t.unprojectFromRenderScreen(o, L)) {\n      d(L, L, t.eye);\n      const r = p(L, L);\n      if (this.renderCoordsHelper.intersectManifold(l(t.eye, r), s, e)) return e;\n    }\n\n    return this.renderCoordsHelper.setAltitude(e, s, t.eye);\n  }\n\n  updateRenderLocation() {\n    this._dirty = !0;\n  }\n\n};\n\ne([o()], _.prototype, \"_dirty\", void 0), e([o({\n  constructOnly: !0\n})], _.prototype, \"scheduler\", void 0), e([o({\n  constructOnly: !0\n})], _.prototype, \"centerOnSurface\", void 0), e([o({\n  constructOnly: !0\n})], _.prototype, \"estimateSurfaceIntersectionAtRenderPoint\", void 0), e([o({\n  readOnly: !0\n})], _.prototype, \"updating\", null), e([o({\n  readOnly: !0\n})], _.prototype, \"location\", null), e([o({\n  readOnly: !0\n})], _.prototype, \"renderLocation\", void 0), _ = e([s(\"esri.views.3d.support.CenterOnSurface\")], _);\nconst S = h(),\n      L = h(),\n      O = h();\nvar P = _;\nexport default P;\nexport { _ as Focus };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/support/pointsOfInterest/Focus.js"],"names":["_","e","clamp","t","createRenderScreenPointArray3","r","property","o","subclass","s","d","i","z","n","g","a","c","f","p","h","u","wrap","l","PropertiesPool","m","PointOfInterest","TaskPriority","y","Array","constructor","_propertiesPool","location","renderLocation","_dirty","get","initialize","handles","add","centerOnSurface","watch","updateRenderLocation","state","scheduler","registerTask","POINT_OF_INTEREST_FREQUENT","destroy","updating","renderCoordsHelper","fromRenderCoords","spatialReference","running","runTask","_get","camera","worldUpAtPosition","S","Math","max","acos","viewForward","PI","aboveGround","Number","isNaN","_set","_calculateScreenHorizontalEdgeOnSurface","O","getRenderCenter","padding","fullHeight","estimateSurfaceIntersectionAtRenderPoint","getAltitude","unprojectFromRenderScreen","L","eye","intersectManifold","setAltitude","prototype","constructOnly","readOnly","P","Focus"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{clamp as t}from\"../../../../core/mathUtils.js\";import{createRenderScreenPointArray3 as r}from\"../../../../core/screenUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{d as i,z as n,g as a,e as c,f as d,n as p}from\"../../../../chunks/vec3.js\";import{c as h}from\"../../../../chunks/vec3f64.js\";import u from\"../../../../geometry/Point.js\";import{wrap as l}from\"../../../../geometry/support/ray.js\";import{PropertiesPool as m}from\"../PropertiesPool.js\";import{PointOfInterest as f}from\"./PointOfInterest.js\";import{TaskPriority as y}from\"../../../support/Scheduler.js\";const g=Array;let _=class extends f{constructor(e){super(e),this._propertiesPool=new m({location:u,renderLocation:g},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get(\"renderLocation\")}initialize(){this.handles.add([this.centerOnSurface.watch(\"renderLocation\",(()=>this.updateRenderLocation())),this.state.watch(\"camera\",(()=>this.updateRenderLocation()))]),this.scheduler&&this.handles.add(this.scheduler.registerTask(y.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get(\"location\");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get(\"renderLocation\"),r=this.centerOnSurface.renderLocation,o=this.renderCoordsHelper,s=this.state.camera;this._dirty=!1,o.worldUpAtPosition(r,S);const d=Math.max(0,(Math.acos(i(S,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(d)){if(!e||!n(e,r)){const e=this._propertiesPool.get(\"renderLocation\");a(e,r),this._set(\"renderLocation\",e)}return}const p=1-t(d/(.5*Math.PI),0,1),h=p*p*p;this._calculateScreenHorizontalEdgeOnSurface(O);const u=this._propertiesPool.get(\"renderLocation\");c(u,r,O,h),e&&n(e,u)||this._set(\"renderLocation\",u)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.camera,o=t.getRenderCenter(r());if(o[1]=t.aboveGround?t.padding[2]:t.fullHeight-t.padding[0],this.estimateSurfaceIntersectionAtRenderPoint(o,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(o,L)){d(L,L,t.eye);const r=p(L,L);if(this.renderCoordsHelper.intersectManifold(l(t.eye,r),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,t.eye)}updateRenderLocation(){this._dirty=!0}};e([o()],_.prototype,\"_dirty\",void 0),e([o({constructOnly:!0})],_.prototype,\"scheduler\",void 0),e([o({constructOnly:!0})],_.prototype,\"centerOnSurface\",void 0),e([o({constructOnly:!0})],_.prototype,\"estimateSurfaceIntersectionAtRenderPoint\",void 0),e([o({readOnly:!0})],_.prototype,\"updating\",null),e([o({readOnly:!0})],_.prototype,\"location\",null),e([o({readOnly:!0})],_.prototype,\"renderLocation\",void 0),_=e([s(\"esri.views.3d.support.CenterOnSurface\")],_);const S=h(),L=h(),O=h();var P=_;export default P;export{_ as Focus};\n"]},"metadata":{},"sourceType":"module"}