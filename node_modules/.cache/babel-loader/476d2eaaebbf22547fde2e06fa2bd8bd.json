{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport e from \"../../../../Graphic.js\";\nimport i from \"../../../../core/Accessor.js\";\nimport s from \"../../../../core/Collection.js\";\nimport r from \"../../../../core/Handles.js\";\nimport { isSome as a, destroyMaybe as o, isNone as n } from \"../../../../core/maybe.js\";\nimport { isAbortError as c } from \"../../../../core/promiseUtils.js\";\nimport { init as h } from \"../../../../core/watchUtils.js\";\nimport { property as p } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as l } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { diff as d } from \"../../../../core/accessorSupport/diffUtils.js\";\nimport u from \"../../../../layers/Layer.js\";\nimport { hydrateGraphic as g } from \"../../../../layers/graphics/hydratedFeatures.js\";\nimport m from \"../../../../rest/support/Query.js\";\nimport { SUSPEND_RESUME_EXTENT_OPTIMISM as y } from \"./constants.js\";\nimport { Graphics3DCore as f } from \"./Graphics3DCore.js\";\nimport b from \"./Graphics3DElevationAlignment.js\";\nimport { Graphics3DObjectStates as j } from \"./Graphics3DObjectStates.js\";\nimport w from \"./Graphics3DScaleVisibility.js\";\nimport { enlargeExtent as C } from \"./graphicUtils.js\";\nimport { WatchUpdatingTracking as S } from \"../../../support/WatchUpdatingTracking.js\";\nlet v = class extends i {\n  constructor(t) {\n    super(t), this.graphicsCore = null, this.elevationAlignment = new b(), this.watchUpdatingTracking = new S(), this.handles = new r(), this.suspendResumeExtent = null;\n  }\n\n  normalizeCtorArgs(t) {\n    let e = null;\n    t.scaleVisibilityEnabled && (delete (t = { ...t\n    }).scaleVisibilityEnabled, e = new w());\n    const i = new f({\n      owner: t.owner,\n      layer: t.layer,\n      preferredUpdatePolicy: 1,\n      graphicSymbolSupported: !0\n    });\n    return { ...t,\n      graphicsCore: i,\n      scaleVisibility: e\n    };\n  }\n\n  initialize() {\n    const t = this.scaleVisibility;\n    a(t) && \"minScale\" in this.layer && this.watchUpdatingTracking.add(this.layer, \"scaleRangeId\", () => t.layerMinMaxScaleChangeHandler()), \"elevationInfo\" in this.layer && this.watchUpdatingTracking.add(this.layer, \"elevationInfo\", (t, e) => {\n      d(t, e) && this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange());\n    });\n  }\n\n  async setup() {\n    const t = (t, e, i) => this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t, e, i);\n\n    if (this.elevationAlignment.setup(this.owner, t, this.graphicsCore, this.view.elevationProvider), a(this.scaleVisibility) && \"minScale\" in this.layer) {\n      const e = this.owner.view.basemapTerrain;\n      this.scaleVisibility.setup(this.owner, this.layer, t, this.graphicsCore, e);\n    }\n\n    this._set(\"objectStates\", new j(this.graphicsCore));\n\n    try {\n      await this.graphicsCore.setup({\n        elevationAlignment: this.elevationAlignment,\n        scaleVisibility: this.scaleVisibility,\n        objectStates: this.objectStates\n      });\n    } catch (e) {\n      if (c(e)) return;\n      throw e;\n    }\n\n    this.destroyed || (this.handles.add(this.view.watch(\"clippingArea\", () => this.updateClippingExtent(), !0)), this.updateClippingExtent(), this.setupSuspendResumeExtent(), this.graphicsCore.startCreateGraphics());\n  }\n\n  destroy() {\n    this.handles = o(this.handles), this.watchUpdatingTracking.destroy(), this._set(\"elevationAlignment\", o(this.elevationAlignment)), this._set(\"scaleVisibility\", o(this.scaleVisibility)), this._set(\"objectStates\", o(this.objectStates)), this._set(\"graphicsCore\", o(this.graphicsCore));\n  }\n\n  get suspended() {\n    return !(!a(this.scaleVisibility) || !this.scaleVisibility.suspended);\n  }\n\n  get updating() {\n    var t, e;\n    return !!(null != (t = this.graphicsCore) && t.updating || a(this.scaleVisibility) && this.scaleVisibility.updating || null != (e = this.watchUpdatingTracking) && e.updating);\n  }\n\n  getGraphicFromGraphicUid(t) {\n    if (this.owner.loadedGraphics) {\n      const e = this.owner.loadedGraphics.find(e => e.uid === t);\n\n      if (e) {\n        const t = this.layer instanceof u ? this.layer : null;\n        return g(e, t);\n      }\n    }\n  }\n\n  whenGraphicBounds(t, e) {\n    return this.graphicsCore ? this.graphicsCore.whenGraphicBounds(t, e) : Promise.reject();\n  }\n\n  computeAttachmentOrigin(t, e) {\n    return this.graphicsCore ? this.graphicsCore.computeAttachmentOrigin(t, e) : null;\n  }\n\n  getSymbolLayerSize(t, e) {\n    return this.graphicsCore ? this.graphicsCore.getSymbolLayerSize(t, e) : null;\n  }\n\n  maskOccludee(t) {\n    const {\n      set: e,\n      handle: i\n    } = this.objectStates.acquireSet(1, null);\n    return this.objectStates.setUid(e, t.uid), i;\n  }\n\n  highlight(t) {\n    if (t instanceof m) return x;\n    if (\"number\" == typeof t) return this.highlight([t]);\n    if (t instanceof e) return this.highlight([t]);\n\n    if (t instanceof s && (t = t.toArray()), Array.isArray(t) && t.length > 0) {\n      if (t[0] instanceof e) {\n        const e = t.map(t => t.uid),\n              {\n          set: i,\n          handle: s\n        } = this.objectStates.acquireSet(0, null);\n        return this.objectStates.setUids(i, e), s;\n      }\n\n      if (\"number\" == typeof t[0]) {\n        const e = t,\n              {\n          set: i,\n          handle: s\n        } = this.objectStates.acquireSet(0, null);\n        return this.objectStates.setObjectIds(i, e), s;\n      }\n    }\n\n    return x;\n  }\n\n  updateClippingExtent() {\n    const t = this.view.clippingArea;\n    this.graphicsCore.setClippingExtent(t, this.view.spatialReference) && this.graphicsCore.recreateAllGraphics();\n  }\n\n  updateSuspendResumeExtent() {\n    n(this.scaleVisibility) || (this.suspendResumeExtent = C(this.graphicsCore.computedExtent, this.suspendResumeExtent, y, this.graphicsCore.extentPadding), this.scaleVisibility.setExtent(this.suspendResumeExtent));\n  }\n\n  setupSuspendResumeExtent() {\n    n(this.scaleVisibility) || (h(this.graphicsCore, \"computedExtent\", t => this.updateSuspendResumeExtent(), !0), this.graphicsCore.watch(\"extentPadding\", t => this.updateSuspendResumeExtent()));\n  }\n\n};\nt([p({\n  constructOnly: !0\n})], v.prototype, \"owner\", void 0), t([p({\n  constructOnly: !0\n})], v.prototype, \"layer\", void 0), t([p({\n  readOnly: !0,\n  aliasOf: \"owner.view\"\n})], v.prototype, \"view\", void 0), t([p({\n  constructOnly: !0\n})], v.prototype, \"graphicsCore\", void 0), t([p({\n  constructOnly: !0\n})], v.prototype, \"scaleVisibility\", void 0), t([p({\n  readOnly: !0\n})], v.prototype, \"elevationAlignment\", void 0), t([p({\n  readOnly: !0\n})], v.prototype, \"objectStates\", void 0), t([p({\n  readOnly: !0\n})], v.prototype, \"watchUpdatingTracking\", void 0), t([p({\n  readOnly: !0\n})], v.prototype, \"suspended\", null), t([p({\n  readOnly: !0\n})], v.prototype, \"updating\", null), v = t([l(\"esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView\")], v);\nconst x = {\n  remove() {},\n\n  pause() {},\n\n  resume() {}\n\n};\nvar E = v;\nexport default E;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphicLikeLayerView.js"],"names":["_","t","e","i","s","r","isSome","a","destroyMaybe","o","isNone","n","isAbortError","c","init","h","property","p","subclass","l","diff","d","u","hydrateGraphic","g","m","SUSPEND_RESUME_EXTENT_OPTIMISM","y","Graphics3DCore","f","b","Graphics3DObjectStates","j","w","enlargeExtent","C","WatchUpdatingTracking","S","v","constructor","graphicsCore","elevationAlignment","watchUpdatingTracking","handles","suspendResumeExtent","normalizeCtorArgs","scaleVisibilityEnabled","owner","layer","preferredUpdatePolicy","graphicSymbolSupported","scaleVisibility","initialize","add","layerMinMaxScaleChangeHandler","addPromise","elevationInfoChange","setup","spatialIndex","queryGraphicUIDsInExtent","view","elevationProvider","basemapTerrain","_set","objectStates","destroyed","watch","updateClippingExtent","setupSuspendResumeExtent","startCreateGraphics","destroy","suspended","updating","getGraphicFromGraphicUid","loadedGraphics","find","uid","whenGraphicBounds","Promise","reject","computeAttachmentOrigin","getSymbolLayerSize","maskOccludee","set","handle","acquireSet","setUid","highlight","x","toArray","Array","isArray","length","map","setUids","setObjectIds","clippingArea","setClippingExtent","spatialReference","recreateAllGraphics","updateSuspendResumeExtent","computedExtent","extentPadding","setExtent","constructOnly","prototype","readOnly","aliasOf","remove","pause","resume","E"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import i from\"../../../../core/Accessor.js\";import s from\"../../../../core/Collection.js\";import r from\"../../../../core/Handles.js\";import{isSome as a,destroyMaybe as o,isNone as n}from\"../../../../core/maybe.js\";import{isAbortError as c}from\"../../../../core/promiseUtils.js\";import{init as h}from\"../../../../core/watchUtils.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{diff as d}from\"../../../../core/accessorSupport/diffUtils.js\";import u from\"../../../../layers/Layer.js\";import{hydrateGraphic as g}from\"../../../../layers/graphics/hydratedFeatures.js\";import m from\"../../../../rest/support/Query.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as y}from\"./constants.js\";import{Graphics3DCore as f}from\"./Graphics3DCore.js\";import b from\"./Graphics3DElevationAlignment.js\";import{Graphics3DObjectStates as j}from\"./Graphics3DObjectStates.js\";import w from\"./Graphics3DScaleVisibility.js\";import{enlargeExtent as C}from\"./graphicUtils.js\";import{WatchUpdatingTracking as S}from\"../../../support/WatchUpdatingTracking.js\";let v=class extends i{constructor(t){super(t),this.graphicsCore=null,this.elevationAlignment=new b,this.watchUpdatingTracking=new S,this.handles=new r,this.suspendResumeExtent=null}normalizeCtorArgs(t){let e=null;t.scaleVisibilityEnabled&&(delete(t={...t}).scaleVisibilityEnabled,e=new w);const i=new f({owner:t.owner,layer:t.layer,preferredUpdatePolicy:1,graphicSymbolSupported:!0});return{...t,graphicsCore:i,scaleVisibility:e}}initialize(){const t=this.scaleVisibility;a(t)&&\"minScale\"in this.layer&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>t.layerMinMaxScaleChangeHandler())),\"elevationInfo\"in this.layer&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{d(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())}))}async setup(){const t=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.elevationAlignment.setup(this.owner,t,this.graphicsCore,this.view.elevationProvider),a(this.scaleVisibility)&&\"minScale\"in this.layer){const e=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this.owner,this.layer,t,this.graphicsCore,e)}this._set(\"objectStates\",new j(this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(e){if(c(e))return;throw e}this.destroyed||(this.handles.add(this.view.watch(\"clippingArea\",(()=>this.updateClippingExtent()),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles=o(this.handles),this.watchUpdatingTracking.destroy(),this._set(\"elevationAlignment\",o(this.elevationAlignment)),this._set(\"scaleVisibility\",o(this.scaleVisibility)),this._set(\"objectStates\",o(this.objectStates)),this._set(\"graphicsCore\",o(this.graphicsCore))}get suspended(){return!(!a(this.scaleVisibility)||!this.scaleVisibility.suspended)}get updating(){var t,e;return!!(null!=(t=this.graphicsCore)&&t.updating||a(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(e=this.watchUpdatingTracking)&&e.updating)}getGraphicFromGraphicUid(t){if(this.owner.loadedGraphics){const e=this.owner.loadedGraphics.find((e=>e.uid===t));if(e){const t=this.layer instanceof u?this.layer:null;return g(e,t)}}}whenGraphicBounds(t,e){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(t,e):Promise.reject()}computeAttachmentOrigin(t,e){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(t,e):null}getSymbolLayerSize(t,e){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(t,e):null}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t){if(t instanceof m)return x;if(\"number\"==typeof t)return this.highlight([t]);if(t instanceof e)return this.highlight([t]);if(t instanceof s&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof e){const e=t.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,e),s}if(\"number\"==typeof t[0]){const e=t,{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setObjectIds(i,e),s}}return x}updateClippingExtent(){const t=this.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}updateSuspendResumeExtent(){n(this.scaleVisibility)||(this.suspendResumeExtent=C(this.graphicsCore.computedExtent,this.suspendResumeExtent,y,this.graphicsCore.extentPadding),this.scaleVisibility.setExtent(this.suspendResumeExtent))}setupSuspendResumeExtent(){n(this.scaleVisibility)||(h(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent()),!0),this.graphicsCore.watch(\"extentPadding\",(t=>this.updateSuspendResumeExtent())))}};t([p({constructOnly:!0})],v.prototype,\"owner\",void 0),t([p({constructOnly:!0})],v.prototype,\"layer\",void 0),t([p({readOnly:!0,aliasOf:\"owner.view\"})],v.prototype,\"view\",void 0),t([p({constructOnly:!0})],v.prototype,\"graphicsCore\",void 0),t([p({constructOnly:!0})],v.prototype,\"scaleVisibility\",void 0),t([p({readOnly:!0})],v.prototype,\"elevationAlignment\",void 0),t([p({readOnly:!0})],v.prototype,\"objectStates\",void 0),t([p({readOnly:!0})],v.prototype,\"watchUpdatingTracking\",void 0),t([p({readOnly:!0})],v.prototype,\"suspended\",null),t([p({readOnly:!0})],v.prototype,\"updating\",null),v=t([l(\"esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView\")],v);const x={remove(){},pause(){},resume(){}};var E=v;export default E;\n"]},"metadata":{},"sourceType":"module"}