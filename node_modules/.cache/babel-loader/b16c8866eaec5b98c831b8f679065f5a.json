{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../geometry.js\";\nimport { isSameTagIgnoreNS as e, getElementValue as t, getElements as n, getElement as r, getElementNumericValue as s, getElementNumericValues as a } from \"./xmlUtilities.js\";\nimport i from \"../rasterTransforms/PolynomialTransform.js\";\nimport l from \"../../../geometry/SpatialReference.js\";\n\nfunction o(e, t) {\n  if (!e || !t) return null;\n  const n = [];\n\n  for (let r = 0; r < e.length; r++) n.push(e[r]), n.push(t[r]);\n\n  return n;\n}\n\nfunction u(e) {\n  var n;\n  const l = r(e, \"GeodataXform\"),\n        u = c(s(l, \"SpatialReference/WKID\") || t(l, \"SpatialReference/WKT\"));\n  if (\"typens:PolynomialXform\" !== l.getAttribute(\"xsi:type\")) return {\n    spatialReference: u,\n    transform: null\n  };\n  const f = null != (n = s(l, \"PolynomialOrder\")) ? n : 1,\n        m = a(l, \"CoeffX/Double\"),\n        d = a(l, \"CoeffY/Double\"),\n        p = a(l, \"InverseCoeffX/Double\"),\n        S = a(l, \"InverseCoeffY/Double\"),\n        C = o(m, d),\n        I = o(p, S);\n  return {\n    spatialReference: u,\n    transform: new i({\n      spatialReference: u,\n      polynomialOrder: f,\n      forwardCoefficients: C,\n      inverseCoefficients: I\n    })\n  };\n}\n\nfunction f(e) {\n  var a;\n  const i = s(e, \"NoDataValue\"),\n        l = r(e, \"Histograms/HistItem\"),\n        o = s(l, \"HistMin\"),\n        u = s(l, \"HistMax\"),\n        f = s(l, \"BucketCount\"),\n        c = null == (a = t(l, \"HistCounts\")) ? void 0 : a.split(\"|\").map(e => Number(e));\n  let m, d, p, S;\n  n(e, \"Metadata/MDI\").forEach(e => {\n    var t;\n    const n = Number(null != (t = e.textContent) ? t : e.nodeValue);\n\n    switch (e.getAttribute(\"key\").toUpperCase()) {\n      case \"STATISTICS_MINIMUM\":\n        m = n;\n        break;\n\n      case \"STATISTICS_MAXIMUM\":\n        d = n;\n        break;\n\n      case \"STATISTICS_MEAN\":\n        p = n;\n        break;\n\n      case \"STATISTICS_STDDEV\":\n        S = n;\n    }\n  });\n  const C = s(e, \"Metadata/SourceBandIndex\");\n  return {\n    noDataValue: i,\n    histogram: null != c && c.length && null != m && null != d ? {\n      min: o,\n      max: u,\n      size: f || c.length,\n      counts: c\n    } : null,\n    sourceBandIndex: C,\n    statistics: null != m && null != d ? {\n      min: m,\n      max: d,\n      avg: p,\n      stddev: S\n    } : null\n  };\n}\n\nfunction c(e) {\n  if (!e) return null;\n  let t = Number(e);\n  if (!isNaN(t) && 0 !== t) return new l({\n    wkid: t\n  });\n\n  if ((e = String(e)).startsWith(\"COMPD_CS\")) {\n    if (!e.includes(\"VERTCS\") || !e.includes(\"GEOGCS\") && !e.startsWith(\"PROJCS\")) return null;\n    const n = e.indexOf(\"VERTCS\"),\n          r = e.indexOf(\"PROJCS\"),\n          s = r > -1 ? r : e.indexOf(\"GEOGCS\");\n    if (-1 === s) return null;\n    const a = e.slice(s, e.lastIndexOf(\"]\", n) + 1).trim(),\n          i = e.slice(s, e.lastIndexOf(\"]\")).trim();\n    t = m(a);\n    const o = new l(t ? {\n      wkid: t\n    } : {\n      wkt: a\n    }),\n          u = m(i);\n    return u && (o.vcsWkid = u), o;\n  }\n\n  return e.startsWith(\"GEOGCS\") || e.startsWith(\"PROJCS\") ? (t = m(e), new l(0 !== t ? {\n    wkid: t\n  } : {\n    wkt: e\n  })) : null;\n}\n\nfunction m(e) {\n  const t = e.replace(/\\]/g, \"[\").replace(/\\\"/g, \"\").split(\"[\").map(e => e.trim()).filter(e => \"\" !== e),\n        n = t[t.length - 1].split(\",\");\n\n  if (\"EPSG\" === n[0] && e.endsWith('\"]]')) {\n    const e = Number(n[1]);\n    if (!isNaN(e) && 0 !== e) return e;\n  }\n\n  return 0;\n}\n\nfunction d(r) {\n  var s;\n  if (\"pamdataset\" !== (null == r || null == (s = r.documentElement.tagName) ? void 0 : s.toLowerCase())) return {};\n  const a = {\n    spatialReference: null,\n    transform: null,\n    metadata: {},\n    rasterBands: [],\n    statistics: null,\n    histograms: null\n  };\n  r.documentElement.childNodes.forEach(r => {\n    if (1 === r.nodeType) if (e(r, \"SRS\")) {\n      if (!a.spatialReference) {\n        const e = t(r);\n        a.spatialReference = c(e);\n      }\n    } else if (e(r, \"Metadata\")) {\n      if (\"xml:ESRI\" === r.getAttribute(\"domain\")) {\n        const {\n          spatialReference: e,\n          transform: t\n        } = u(r);\n        a.transform = t, a.spatialReference || (a.spatialReference = e);\n      } else {\n        n(r, \"MDI\").forEach(e => a.metadata[e.getAttribute(\"key\")] = t(e));\n      }\n    } else if (e(r, \"PAMRasterBand\")) {\n      const e = f(r);\n      null != e.sourceBandIndex && null == a.rasterBands[e.sourceBandIndex] ? a.rasterBands[e.sourceBandIndex] = e : a.rasterBands.push(e);\n    }\n  });\n  const i = a.rasterBands;\n\n  if (i) {\n    const e = !!i[0].statistics;\n    a.statistics = e ? i.map(e => e.statistics) : null;\n    const t = !!i[0].histogram;\n    a.histograms = t ? i.map(e => e.histogram) : null;\n  }\n\n  return a;\n}\n\nexport { d as parsePAMInfo, c as parseSpatialReference };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/rasterDatasets/pamParser.js"],"names":["isSameTagIgnoreNS","e","getElementValue","t","getElements","n","getElement","r","getElementNumericValue","s","getElementNumericValues","a","i","l","o","length","push","u","c","getAttribute","spatialReference","transform","f","m","d","p","S","C","I","polynomialOrder","forwardCoefficients","inverseCoefficients","split","map","Number","forEach","textContent","nodeValue","toUpperCase","noDataValue","histogram","min","max","size","counts","sourceBandIndex","statistics","avg","stddev","isNaN","wkid","String","startsWith","includes","indexOf","slice","lastIndexOf","trim","wkt","vcsWkid","replace","filter","endsWith","documentElement","tagName","toLowerCase","metadata","rasterBands","histograms","childNodes","nodeType","parsePAMInfo","parseSpatialReference"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../geometry.js\";import{isSameTagIgnoreNS as e,getElementValue as t,getElements as n,getElement as r,getElementNumericValue as s,getElementNumericValues as a}from\"./xmlUtilities.js\";import i from\"../rasterTransforms/PolynomialTransform.js\";import l from\"../../../geometry/SpatialReference.js\";function o(e,t){if(!e||!t)return null;const n=[];for(let r=0;r<e.length;r++)n.push(e[r]),n.push(t[r]);return n}function u(e){var n;const l=r(e,\"GeodataXform\"),u=c(s(l,\"SpatialReference/WKID\")||t(l,\"SpatialReference/WKT\"));if(\"typens:PolynomialXform\"!==l.getAttribute(\"xsi:type\"))return{spatialReference:u,transform:null};const f=null!=(n=s(l,\"PolynomialOrder\"))?n:1,m=a(l,\"CoeffX/Double\"),d=a(l,\"CoeffY/Double\"),p=a(l,\"InverseCoeffX/Double\"),S=a(l,\"InverseCoeffY/Double\"),C=o(m,d),I=o(p,S);return{spatialReference:u,transform:new i({spatialReference:u,polynomialOrder:f,forwardCoefficients:C,inverseCoefficients:I})}}function f(e){var a;const i=s(e,\"NoDataValue\"),l=r(e,\"Histograms/HistItem\"),o=s(l,\"HistMin\"),u=s(l,\"HistMax\"),f=s(l,\"BucketCount\"),c=null==(a=t(l,\"HistCounts\"))?void 0:a.split(\"|\").map((e=>Number(e)));let m,d,p,S;n(e,\"Metadata/MDI\").forEach((e=>{var t;const n=Number(null!=(t=e.textContent)?t:e.nodeValue);switch(e.getAttribute(\"key\").toUpperCase()){case\"STATISTICS_MINIMUM\":m=n;break;case\"STATISTICS_MAXIMUM\":d=n;break;case\"STATISTICS_MEAN\":p=n;break;case\"STATISTICS_STDDEV\":S=n}}));const C=s(e,\"Metadata/SourceBandIndex\");return{noDataValue:i,histogram:null!=c&&c.length&&null!=m&&null!=d?{min:o,max:u,size:f||c.length,counts:c}:null,sourceBandIndex:C,statistics:null!=m&&null!=d?{min:m,max:d,avg:p,stddev:S}:null}}function c(e){if(!e)return null;let t=Number(e);if(!isNaN(t)&&0!==t)return new l({wkid:t});if((e=String(e)).startsWith(\"COMPD_CS\")){if(!e.includes(\"VERTCS\")||!e.includes(\"GEOGCS\")&&!e.startsWith(\"PROJCS\"))return null;const n=e.indexOf(\"VERTCS\"),r=e.indexOf(\"PROJCS\"),s=r>-1?r:e.indexOf(\"GEOGCS\");if(-1===s)return null;const a=e.slice(s,e.lastIndexOf(\"]\",n)+1).trim(),i=e.slice(s,e.lastIndexOf(\"]\")).trim();t=m(a);const o=new l(t?{wkid:t}:{wkt:a}),u=m(i);return u&&(o.vcsWkid=u),o}return e.startsWith(\"GEOGCS\")||e.startsWith(\"PROJCS\")?(t=m(e),new l(0!==t?{wkid:t}:{wkt:e})):null}function m(e){const t=e.replace(/\\]/g,\"[\").replace(/\\\"/g,\"\").split(\"[\").map((e=>e.trim())).filter((e=>\"\"!==e)),n=t[t.length-1].split(\",\");if(\"EPSG\"===n[0]&&e.endsWith('\"]]')){const e=Number(n[1]);if(!isNaN(e)&&0!==e)return e}return 0}function d(r){var s;if(\"pamdataset\"!==(null==r||null==(s=r.documentElement.tagName)?void 0:s.toLowerCase()))return{};const a={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};r.documentElement.childNodes.forEach((r=>{if(1===r.nodeType)if(e(r,\"SRS\")){if(!a.spatialReference){const e=t(r);a.spatialReference=c(e)}}else if(e(r,\"Metadata\"))if(\"xml:ESRI\"===r.getAttribute(\"domain\")){const{spatialReference:e,transform:t}=u(r);a.transform=t,a.spatialReference||(a.spatialReference=e)}else{n(r,\"MDI\").forEach((e=>a.metadata[e.getAttribute(\"key\")]=t(e)))}else if(e(r,\"PAMRasterBand\")){const e=f(r);null!=e.sourceBandIndex&&null==a.rasterBands[e.sourceBandIndex]?a.rasterBands[e.sourceBandIndex]=e:a.rasterBands.push(e)}}));const i=a.rasterBands;if(i){const e=!!i[0].statistics;a.statistics=e?i.map((e=>e.statistics)):null;const t=!!i[0].histogram;a.histograms=t?i.map((e=>e.histogram)):null}return a}export{d as parsePAMInfo,c as parseSpatialReference};\n"]},"metadata":{},"sourceType":"module"}