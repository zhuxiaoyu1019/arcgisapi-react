{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"./chunks/tslib.es6.js\";\nimport r from \"./core/Collection.js\";\nimport { referenceSetter as t } from \"./core/collectionUtils.js\";\nimport { JSONSupportMixin as s } from \"./core/JSONSupport.js\";\nimport { clone as o } from \"./core/lang.js\";\nimport a from \"./core/Loadable.js\";\nimport { loadAll as i } from \"./core/loadAll.js\";\nimport n from \"./core/Logger.js\";\nimport { isSome as l } from \"./core/maybe.js\";\nimport { throwIfAborted as p, eachAlways as c } from \"./core/promiseUtils.js\";\nimport { isProtocolRelative as m, urlToObject as h } from \"./core/urlUtils.js\";\nimport { property as u } from \"./core/accessorSupport/decorators/property.js\";\nimport \"./core/accessorSupport/ensureType.js\";\nimport \"./core/has.js\";\nimport { subclass as f } from \"./core/accessorSupport/decorators/subclass.js\";\nimport { writer as y } from \"./core/accessorSupport/decorators/writer.js\";\nimport d from \"./geometry/SpatialReference.js\";\nimport b from \"./portal/Portal.js\";\nimport L from \"./portal/PortalItem.js\";\nimport { getBasemapTitle as w, esriBasemapDefinitions as I } from \"./support/basemapDefinitions.js\";\nimport { getLayerJSON as g } from \"./webdoc/support/writeUtils.js\";\nvar j;\nlet S = 0;\nconst v = n.getLogger(\"esri.Basemap\");\n\nlet _ = j = class extends s(a) {\n  constructor(e) {\n    super(e), this.id = null, this.portalItem = null, this.spatialReference = null, this.thumbnailUrl = null, this.title = \"Basemap\", this.id = Date.now().toString(16) + \"-basemap-\" + S++, this.baseLayers = new r(), this.referenceLayers = new r();\n\n    const t = e => {\n      e.parent && e.parent !== this && \"remove\" in e.parent && e.parent.remove(e), e.parent = this, \"elevation\" === e.type && v.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`);\n    },\n          s = e => {\n      e.parent = null;\n    };\n\n    this.baseLayers.on(\"after-add\", e => t(e.item)), this.referenceLayers.on(\"after-add\", e => t(e.item)), this.baseLayers.on(\"after-remove\", e => s(e.item)), this.referenceLayers.on(\"after-remove\", e => s(e.item));\n  }\n\n  initialize() {\n    this.when().catch(e => {\n      v.error(\"#load()\", `Failed to load basemap (title: '${this.title}', id: '${this.id}')`, e);\n    }), this.resourceInfo && this.read(this.resourceInfo.data, this.resourceInfo.context);\n  }\n\n  destroy() {\n    var e;\n    const r = this.baseLayers.removeAll();\n\n    for (const s of r) s.destroy();\n\n    const t = this.referenceLayers.removeAll();\n\n    for (const s of t) s.destroy();\n\n    this.baseLayers.destroy(), this.referenceLayers.destroy(), null == (e = this.portalItem) || e.destroy(), this.portalItem = null;\n  }\n\n  normalizeCtorArgs(e) {\n    return e && \"resourceInfo\" in e && (this._set(\"resourceInfo\", e.resourceInfo), delete (e = { ...e\n    }).resourceInfo), e;\n  }\n\n  set baseLayers(e) {\n    this._set(\"baseLayers\", t(e, this._get(\"baseLayers\")));\n  }\n\n  _writeBaseLayers(e, r, t) {\n    const s = [];\n    e ? (t = { ...t,\n      layerContainerType: \"basemap\"\n    }, this.baseLayers.forEach(e => {\n      const r = g(e, t.webmap ? t.webmap.getLayerJSONFromResourceInfo(e) : null, t);\n      l(r) && s.push(r);\n    }), this.referenceLayers.forEach(e => {\n      const r = g(e, t.webmap ? t.webmap.getLayerJSONFromResourceInfo(e) : null, t);\n      l(r) && (r.isReference = !0, s.push(r));\n    }), r.baseMapLayers = s) : r.baseMapLayers = s;\n  }\n\n  set referenceLayers(e) {\n    this._set(\"referenceLayers\", t(e, this._get(\"referenceLayers\")));\n  }\n\n  writeTitle(e, r) {\n    r.title = e || \"Basemap\";\n  }\n\n  load(e) {\n    return this.addResolvingPromise(this._loadFromSource(e)), Promise.resolve(this);\n  }\n\n  loadAll() {\n    return i(this, e => {\n      e(this.baseLayers, this.referenceLayers);\n    });\n  }\n\n  clone() {\n    const e = {\n      id: this.id,\n      title: this.title,\n      portalItem: this.portalItem,\n      baseLayers: this.baseLayers.slice(),\n      referenceLayers: this.referenceLayers.slice()\n    };\n    return this.loaded && (e.loadStatus = \"loaded\"), new j({\n      resourceInfo: this.resourceInfo\n    }).set(e);\n  }\n\n  read(e, r) {\n    this.resourceInfo || this._set(\"resourceInfo\", {\n      data: e,\n      context: r\n    }), super.read(e, r);\n  }\n\n  write(e, r) {\n    return e = e || {}, r && r.origin || (r = {\n      origin: \"web-map\",\n      ...r\n    }), super.write(e, r), !this.loaded && this.resourceInfo && this.resourceInfo.data.baseMapLayers && (e.baseMapLayers = this.resourceInfo.data.baseMapLayers.map(e => {\n      const r = o(e);\n      return r.url && m(r.url) && (r.url = `https:${r.url}`), r.templateUrl && m(r.templateUrl) && (r.templateUrl = `https:${r.templateUrl}`), r;\n    })), e;\n  }\n\n  async _loadFromSource(e) {\n    const {\n      resourceInfo: r,\n      portalItem: t\n    } = this;\n    p(e);\n    const s = [];\n\n    if (r) {\n      const t = r.context ? r.context.url : null;\n\n      if (s.push(this._loadLayersFromJSON(r.data, t, e)), r.data.id && !r.data.title) {\n        const e = r.data.id;\n        s.push(w(e).then(e => {\n          e && this.read({\n            title: e\n          }, r.context);\n        }));\n      }\n    } else t && s.push(this._loadFromItem(t, e));\n\n    await Promise.all(s);\n  }\n\n  async _loadLayersFromJSON(e, r, t) {\n    const s = this.resourceInfo && this.resourceInfo.context,\n          o = this.portalItem && this.portalItem.portal || s && s.portal || null,\n          a = s && \"web-scene\" === s.origin ? \"web-scene\" : \"web-map\",\n          {\n      populateOperationalLayers: i\n    } = await import(\"./layers/support/layersCreator.js\"),\n          n = [];\n\n    if (p(t), e.baseMapLayers && Array.isArray(e.baseMapLayers)) {\n      const t = {\n        context: {\n          origin: a,\n          url: r,\n          portal: o,\n          layerContainerType: \"basemap\"\n        },\n        defaultLayerType: \"DefaultTileLayer\"\n      },\n            s = i(this.baseLayers, e.baseMapLayers.filter(e => !e.isReference), t);\n      n.push(s);\n      const l = i(this.referenceLayers, e.baseMapLayers.filter(e => e.isReference), t);\n      n.push(l);\n    }\n\n    await c(n);\n  }\n\n  async _loadFromItem(e, r) {\n    const t = await e.load(r),\n          s = await t.fetchData(\"json\", r),\n          o = h(e.itemUrl);\n    return this._set(\"resourceInfo\", {\n      data: s.baseMap,\n      context: {\n        origin: \"web-map\",\n        portal: e.portal || b.getDefault(),\n        url: o\n      }\n    }), this.read(this.resourceInfo.data, this.resourceInfo.context), this.read({\n      spatialReference: s.spatialReference\n    }, this.resourceInfo.context), this.read({\n      title: e.title,\n      thumbnailUrl: e.thumbnailUrl\n    }, {\n      origin: \"portal-item\",\n      portal: e.portal || b.getDefault(),\n      url: o\n    }), this._loadLayersFromJSON(this.resourceInfo.data, o, r);\n  }\n\n  static fromId(e) {\n    const r = I[e];\n    return r ? j.fromJSON(r) : null;\n  }\n\n};\n\ne([u({\n  json: {\n    write: {\n      ignoreOrigin: !0,\n      target: \"baseMapLayers\",\n\n      writer(e, r, t, s) {\n        this._writeBaseLayers(e, r, s);\n      }\n\n    },\n    origins: {\n      \"web-scene\": {\n        write: {\n          ignoreOrigin: !0,\n          target: {\n            baseMapLayers: {\n              type: r\n            }\n          },\n\n          writer(e, r, t, s) {\n            this._writeBaseLayers(e, r, s);\n          }\n\n        }\n      }\n    }\n  }\n})], _.prototype, \"baseLayers\", null), e([u({\n  type: String,\n  json: {\n    origins: {\n      \"web-scene\": {\n        write: !0\n      }\n    }\n  }\n})], _.prototype, \"id\", void 0), e([u({\n  type: L\n})], _.prototype, \"portalItem\", void 0), e([u()], _.prototype, \"referenceLayers\", null), e([u({\n  readOnly: !0\n})], _.prototype, \"resourceInfo\", void 0), e([u({\n  type: d\n})], _.prototype, \"spatialReference\", void 0), e([u()], _.prototype, \"thumbnailUrl\", void 0), e([u({\n  type: String,\n  json: {\n    origins: {\n      \"web-scene\": {\n        write: {\n          isRequired: !0\n        }\n      }\n    }\n  }\n})], _.prototype, \"title\", void 0), e([y(\"title\")], _.prototype, \"writeTitle\", null), _ = j = e([f(\"esri.Basemap\")], _);\nvar U = _;\nexport default U;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/Basemap.js"],"names":["_","e","r","referenceSetter","t","JSONSupportMixin","s","clone","o","a","loadAll","i","n","isSome","l","throwIfAborted","p","eachAlways","c","isProtocolRelative","m","urlToObject","h","property","u","subclass","f","writer","y","d","b","L","getBasemapTitle","w","esriBasemapDefinitions","I","getLayerJSON","g","j","S","v","getLogger","constructor","id","portalItem","spatialReference","thumbnailUrl","title","Date","now","toString","baseLayers","referenceLayers","parent","remove","type","error","on","item","initialize","when","catch","resourceInfo","read","data","context","destroy","removeAll","normalizeCtorArgs","_set","_get","_writeBaseLayers","layerContainerType","forEach","webmap","getLayerJSONFromResourceInfo","push","isReference","baseMapLayers","writeTitle","load","addResolvingPromise","_loadFromSource","Promise","resolve","slice","loaded","loadStatus","set","write","origin","map","url","templateUrl","_loadLayersFromJSON","then","_loadFromItem","all","portal","populateOperationalLayers","Array","isArray","defaultLayerType","filter","fetchData","itemUrl","baseMap","getDefault","fromId","fromJSON","json","ignoreOrigin","target","origins","prototype","String","readOnly","isRequired","U"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"./chunks/tslib.es6.js\";import r from\"./core/Collection.js\";import{referenceSetter as t}from\"./core/collectionUtils.js\";import{JSONSupportMixin as s}from\"./core/JSONSupport.js\";import{clone as o}from\"./core/lang.js\";import a from\"./core/Loadable.js\";import{loadAll as i}from\"./core/loadAll.js\";import n from\"./core/Logger.js\";import{isSome as l}from\"./core/maybe.js\";import{throwIfAborted as p,eachAlways as c}from\"./core/promiseUtils.js\";import{isProtocolRelative as m,urlToObject as h}from\"./core/urlUtils.js\";import{property as u}from\"./core/accessorSupport/decorators/property.js\";import\"./core/accessorSupport/ensureType.js\";import\"./core/has.js\";import{subclass as f}from\"./core/accessorSupport/decorators/subclass.js\";import{writer as y}from\"./core/accessorSupport/decorators/writer.js\";import d from\"./geometry/SpatialReference.js\";import b from\"./portal/Portal.js\";import L from\"./portal/PortalItem.js\";import{getBasemapTitle as w,esriBasemapDefinitions as I}from\"./support/basemapDefinitions.js\";import{getLayerJSON as g}from\"./webdoc/support/writeUtils.js\";var j;let S=0;const v=n.getLogger(\"esri.Basemap\");let _=j=class extends(s(a)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title=\"Basemap\",this.id=Date.now().toString(16)+\"-basemap-\"+S++,this.baseLayers=new r,this.referenceLayers=new r;const t=e=>{e.parent&&e.parent!==this&&\"remove\"in e.parent&&e.parent.remove(e),e.parent=this,\"elevation\"===e.type&&v.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},s=e=>{e.parent=null};this.baseLayers.on(\"after-add\",(e=>t(e.item))),this.referenceLayers.on(\"after-add\",(e=>t(e.item))),this.baseLayers.on(\"after-remove\",(e=>s(e.item))),this.referenceLayers.on(\"after-remove\",(e=>s(e.item)))}initialize(){this.when().catch((e=>{v.error(\"#load()\",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const r=this.baseLayers.removeAll();for(const s of r)s.destroy();const t=this.referenceLayers.removeAll();for(const s of t)s.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(e=this.portalItem)||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&\"resourceInfo\"in e&&(this._set(\"resourceInfo\",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set(\"baseLayers\",t(e,this._get(\"baseLayers\")))}_writeBaseLayers(e,r,t){const s=[];e?(t={...t,layerContainerType:\"basemap\"},this.baseLayers.forEach((e=>{const r=g(e,t.webmap?t.webmap.getLayerJSONFromResourceInfo(e):null,t);l(r)&&s.push(r)})),this.referenceLayers.forEach((e=>{const r=g(e,t.webmap?t.webmap.getLayerJSONFromResourceInfo(e):null,t);l(r)&&(r.isReference=!0,s.push(r))})),r.baseMapLayers=s):r.baseMapLayers=s}set referenceLayers(e){this._set(\"referenceLayers\",t(e,this._get(\"referenceLayers\")))}writeTitle(e,r){r.title=e||\"Basemap\"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return i(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus=\"loaded\"),new j({resourceInfo:this.resourceInfo}).set(e)}read(e,r){this.resourceInfo||this._set(\"resourceInfo\",{data:e,context:r}),super.read(e,r)}write(e,r){return e=e||{},r&&r.origin||(r={origin:\"web-map\",...r}),super.write(e,r),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const r=o(e);return r.url&&m(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&m(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r}))),e}async _loadFromSource(e){const{resourceInfo:r,portalItem:t}=this;p(e);const s=[];if(r){const t=r.context?r.context.url:null;if(s.push(this._loadLayersFromJSON(r.data,t,e)),r.data.id&&!r.data.title){const e=r.data.id;s.push(w(e).then((e=>{e&&this.read({title:e},r.context)})))}}else t&&s.push(this._loadFromItem(t,e));await Promise.all(s)}async _loadLayersFromJSON(e,r,t){const s=this.resourceInfo&&this.resourceInfo.context,o=this.portalItem&&this.portalItem.portal||s&&s.portal||null,a=s&&\"web-scene\"===s.origin?\"web-scene\":\"web-map\",{populateOperationalLayers:i}=await import(\"./layers/support/layersCreator.js\"),n=[];if(p(t),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const t={context:{origin:a,url:r,portal:o,layerContainerType:\"basemap\"},defaultLayerType:\"DefaultTileLayer\"},s=i(this.baseLayers,e.baseMapLayers.filter((e=>!e.isReference)),t);n.push(s);const l=i(this.referenceLayers,e.baseMapLayers.filter((e=>e.isReference)),t);n.push(l)}await c(n)}async _loadFromItem(e,r){const t=await e.load(r),s=await t.fetchData(\"json\",r),o=h(e.itemUrl);return this._set(\"resourceInfo\",{data:s.baseMap,context:{origin:\"web-map\",portal:e.portal||b.getDefault(),url:o}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:s.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:\"portal-item\",portal:e.portal||b.getDefault(),url:o}),this._loadLayersFromJSON(this.resourceInfo.data,o,r)}static fromId(e){const r=I[e];return r?j.fromJSON(r):null}};e([u({json:{write:{ignoreOrigin:!0,target:\"baseMapLayers\",writer(e,r,t,s){this._writeBaseLayers(e,r,s)}},origins:{\"web-scene\":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:r}},writer(e,r,t,s){this._writeBaseLayers(e,r,s)}}}}}})],_.prototype,\"baseLayers\",null),e([u({type:String,json:{origins:{\"web-scene\":{write:!0}}}})],_.prototype,\"id\",void 0),e([u({type:L})],_.prototype,\"portalItem\",void 0),e([u()],_.prototype,\"referenceLayers\",null),e([u({readOnly:!0})],_.prototype,\"resourceInfo\",void 0),e([u({type:d})],_.prototype,\"spatialReference\",void 0),e([u()],_.prototype,\"thumbnailUrl\",void 0),e([u({type:String,json:{origins:{\"web-scene\":{write:{isRequired:!0}}}}})],_.prototype,\"title\",void 0),e([y(\"title\")],_.prototype,\"writeTitle\",null),_=j=e([f(\"esri.Basemap\")],_);var U=_;export default U;\n"]},"metadata":{},"sourceType":"module"}