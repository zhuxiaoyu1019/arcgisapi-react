{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport t from \"../core/Error.js\";\nimport r from \"../core/has.js\";\nimport { isSome as o, isNone as s } from \"../core/maybe.js\";\nimport { whenOrAbort as i } from \"../core/promiseUtils.js\";\nimport { property as u } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport \"../core/Logger.js\";\nimport { subclass as n } from \"../core/accessorSupport/decorators/subclass.js\";\nimport { DataLayerSource as a } from \"../layers/support/source/DataLayerSource.js\";\nimport { executeAttachmentQuery as c } from \"../rest/query/executeAttachmentQuery.js\";\nimport { executeForCount as p } from \"../rest/query/executeForCount.js\";\nimport { executeForExtent as m } from \"../rest/query/executeForExtent.js\";\nimport { executeForIds as f } from \"../rest/query/executeForIds.js\";\nimport { executeRawQueryJSON as l } from \"../rest/query/executeQueryJSON.js\";\nimport { executeRawQueryPBF as h } from \"../rest/query/executeQueryPBF.js\";\nimport { executeRelationshipQuery as d, executeRelationshipQueryForCount as y } from \"../rest/query/executeRelationshipQuery.js\";\nimport { executeTopFeaturesQuery as F } from \"../rest/query/executeTopFeaturesQuery.js\";\nimport { executeForTopIds as S } from \"../rest/query/executeForTopIds.js\";\nimport { executeForTopExtents as j } from \"../rest/query/executeForTopExtents.js\";\nimport { executeForTopCount as D } from \"../rest/query/executeForTopCount.js\";\nimport x from \"../rest/support/FeatureSet.js\";\nimport O from \"../rest/support/Query.js\";\nimport b from \"../rest/support/RelationshipQuery.js\";\nimport q from \"./Task.js\";\nlet g = class extends q {\n  constructor(e) {\n    super(e), this.dynamicDataSource = null, this.fieldsIndex = null, this.format = \"json\", this.gdbVersion = null, this.infoFor3D = null, this.sourceSpatialReference = null;\n  }\n\n  execute(e, t) {\n    return this.executeJSON(e, t).then(r => this.featureSetFromJSON(e, r, t));\n  }\n\n  async executeJSON(e, t) {\n    var o;\n\n    const s = { ...this.requestOptions,\n      ...t\n    },\n          i = this._normalizeQuery(e),\n          u = null != (null == (o = e.outStatistics) ? void 0 : o[0]),\n          n = r(\"featurelayer-pbf-statistics\"),\n          a = !u || n;\n\n    let c;\n    if (\"pbf\" === this.format && a) try {\n      c = await h(this.url, i, s);\n    } catch (p) {\n      if (\"query:parsing-pbf\" !== p.name) throw p;\n      this.format = \"json\";\n    }\n    return \"json\" !== this.format && a || (c = await l(this.url, i, s)), this._normalizeFields(c.fields), c;\n  }\n\n  async featureSetFromJSON(e, t, r) {\n    if (!(this._queryIs3DObjectFormat(e) && o(this.infoFor3D) && t.features && t.features.length)) return x.fromJSON(t);\n    const {\n      meshFeatureSetFromJSON: s\n    } = await i(import(\"../rest/support/meshFeatureSet.js\"), r);\n    return s(e, this.infoFor3D, t);\n  }\n\n  executeForCount(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    },\n          o = this._normalizeQuery(e);\n\n    return p(this.url, o, r);\n  }\n\n  executeForExtent(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    },\n          o = this._normalizeQuery(e);\n\n    return m(this.url, o, r);\n  }\n\n  executeForIds(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    },\n          o = this._normalizeQuery(e);\n\n    return f(this.url, o, r);\n  }\n\n  executeRelationshipQuery(e, t) {\n    e = b.from(e);\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return (this.gdbVersion || this.dynamicDataSource) && ((e = e.clone()).gdbVersion = e.gdbVersion || this.gdbVersion, e.dynamicDataSource = e.dynamicDataSource || this.dynamicDataSource), d(this.url, e, r);\n  }\n\n  executeRelationshipQueryForCount(e, t) {\n    e = b.from(e);\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return (this.gdbVersion || this.dynamicDataSource) && ((e = e.clone()).gdbVersion = e.gdbVersion || this.gdbVersion, e.dynamicDataSource = e.dynamicDataSource || this.dynamicDataSource), y(this.url, e, r);\n  }\n\n  executeAttachmentQuery(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return c(this.url, e, r);\n  }\n\n  executeTopFeaturesQuery(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return F(this.parsedUrl, e, this.sourceSpatialReference, r);\n  }\n\n  executeForTopIds(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return S(this.parsedUrl, e, r);\n  }\n\n  executeForTopExtents(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return j(this.parsedUrl, e, r);\n  }\n\n  executeForTopCount(e, t) {\n    const r = { ...this.requestOptions,\n      ...t\n    };\n    return D(this.parsedUrl, e, r);\n  }\n\n  _normalizeQuery(e) {\n    let r = O.from(e);\n\n    if (r.sourceSpatialReference = r.sourceSpatialReference || this.sourceSpatialReference, (this.gdbVersion || this.dynamicDataSource) && (r = r === e ? r.clone() : r, r.gdbVersion = e.gdbVersion || this.gdbVersion, r.dynamicDataSource = e.dynamicDataSource ? a.from(e.dynamicDataSource) : this.dynamicDataSource), o(this.infoFor3D) && this._queryIs3DObjectFormat(e)) {\n      r = r === e ? r.clone() : r, r.formatOf3DObjects = null;\n\n      for (const e of this.infoFor3D.queryFormats) {\n        if (\"3D_glb\" === e.id) {\n          r.formatOf3DObjects = e.id;\n          break;\n        }\n\n        \"3D_gltf\" !== e.id || r.formatOf3DObjects || (r.formatOf3DObjects = e.id);\n      }\n\n      if (!r.formatOf3DObjects) throw new t(\"query:unsupported-3d-query-formats\", \"Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf\");\n\n      if (s(r.outFields) || !r.outFields.includes(\"*\")) {\n        r = r === e ? r.clone() : r, s(r.outFields) && (r.outFields = []);\n        const {\n          originX: t,\n          originY: o,\n          originZ: i,\n          translationX: u,\n          translationY: n,\n          translationZ: a,\n          scaleX: c,\n          scaleY: p,\n          scaleZ: m,\n          rotationX: f,\n          rotationY: l,\n          rotationZ: h,\n          rotationDeg: d\n        } = this.infoFor3D.transformFieldRoles;\n        r.outFields.push(t, o, i, u, n, a, c, p, m, f, l, h, d);\n      }\n    }\n\n    return r;\n  }\n\n  _normalizeFields(e) {\n    if (o(this.fieldsIndex) && o(e)) for (const t of e) {\n      const e = this.fieldsIndex.get(t.name);\n      e && Object.assign(t, e.toJSON());\n    }\n  }\n\n  _queryIs3DObjectFormat(e) {\n    return o(this.infoFor3D) && e.returnGeometry && \"xyFootprint\" !== e.multipatchOption && !e.outStatistics;\n  }\n\n};\ne([u({\n  type: a\n})], g.prototype, \"dynamicDataSource\", void 0), e([u()], g.prototype, \"fieldsIndex\", void 0), e([u()], g.prototype, \"format\", void 0), e([u()], g.prototype, \"gdbVersion\", void 0), e([u()], g.prototype, \"infoFor3D\", void 0), e([u()], g.prototype, \"sourceSpatialReference\", void 0), g = e([n(\"esri.tasks.QueryTask\")], g);\nvar Q = g;\nexport default Q;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/tasks/QueryTask.js"],"names":["_","e","t","r","isSome","o","isNone","s","whenOrAbort","i","property","u","subclass","n","DataLayerSource","a","executeAttachmentQuery","c","executeForCount","p","executeForExtent","m","executeForIds","f","executeRawQueryJSON","l","executeRawQueryPBF","h","executeRelationshipQuery","d","executeRelationshipQueryForCount","y","executeTopFeaturesQuery","F","executeForTopIds","S","executeForTopExtents","j","executeForTopCount","D","x","O","b","q","g","constructor","dynamicDataSource","fieldsIndex","format","gdbVersion","infoFor3D","sourceSpatialReference","execute","executeJSON","then","featureSetFromJSON","requestOptions","_normalizeQuery","outStatistics","url","name","_normalizeFields","fields","_queryIs3DObjectFormat","features","length","fromJSON","meshFeatureSetFromJSON","from","clone","parsedUrl","formatOf3DObjects","queryFormats","id","outFields","includes","originX","originY","originZ","translationX","translationY","translationZ","scaleX","scaleY","scaleZ","rotationX","rotationY","rotationZ","rotationDeg","transformFieldRoles","push","get","Object","assign","toJSON","returnGeometry","multipatchOption","type","prototype","Q"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"../core/Error.js\";import r from\"../core/has.js\";import{isSome as o,isNone as s}from\"../core/maybe.js\";import{whenOrAbort as i}from\"../core/promiseUtils.js\";import{property as u}from\"../core/accessorSupport/decorators/property.js\";import\"../core/accessorSupport/ensureType.js\";import\"../core/Logger.js\";import{subclass as n}from\"../core/accessorSupport/decorators/subclass.js\";import{DataLayerSource as a}from\"../layers/support/source/DataLayerSource.js\";import{executeAttachmentQuery as c}from\"../rest/query/executeAttachmentQuery.js\";import{executeForCount as p}from\"../rest/query/executeForCount.js\";import{executeForExtent as m}from\"../rest/query/executeForExtent.js\";import{executeForIds as f}from\"../rest/query/executeForIds.js\";import{executeRawQueryJSON as l}from\"../rest/query/executeQueryJSON.js\";import{executeRawQueryPBF as h}from\"../rest/query/executeQueryPBF.js\";import{executeRelationshipQuery as d,executeRelationshipQueryForCount as y}from\"../rest/query/executeRelationshipQuery.js\";import{executeTopFeaturesQuery as F}from\"../rest/query/executeTopFeaturesQuery.js\";import{executeForTopIds as S}from\"../rest/query/executeForTopIds.js\";import{executeForTopExtents as j}from\"../rest/query/executeForTopExtents.js\";import{executeForTopCount as D}from\"../rest/query/executeForTopCount.js\";import x from\"../rest/support/FeatureSet.js\";import O from\"../rest/support/Query.js\";import b from\"../rest/support/RelationshipQuery.js\";import q from\"./Task.js\";let g=class extends q{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format=\"json\",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then((r=>this.featureSetFromJSON(e,r,t)))}async executeJSON(e,t){var o;const s={...this.requestOptions,...t},i=this._normalizeQuery(e),u=null!=(null==(o=e.outStatistics)?void 0:o[0]),n=r(\"featurelayer-pbf-statistics\"),a=!u||n;let c;if(\"pbf\"===this.format&&a)try{c=await h(this.url,i,s)}catch(p){if(\"query:parsing-pbf\"!==p.name)throw p;this.format=\"json\"}return\"json\"!==this.format&&a||(c=await l(this.url,i,s)),this._normalizeFields(c.fields),c}async featureSetFromJSON(e,t,r){if(!(this._queryIs3DObjectFormat(e)&&o(this.infoFor3D)&&t.features&&t.features.length))return x.fromJSON(t);const{meshFeatureSetFromJSON:s}=await i(import(\"../rest/support/meshFeatureSet.js\"),r);return s(e,this.infoFor3D,t)}executeForCount(e,t){const r={...this.requestOptions,...t},o=this._normalizeQuery(e);return p(this.url,o,r)}executeForExtent(e,t){const r={...this.requestOptions,...t},o=this._normalizeQuery(e);return m(this.url,o,r)}executeForIds(e,t){const r={...this.requestOptions,...t},o=this._normalizeQuery(e);return f(this.url,o,r)}executeRelationshipQuery(e,t){e=b.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),d(this.url,e,r)}executeRelationshipQueryForCount(e,t){e=b.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),y(this.url,e,r)}executeAttachmentQuery(e,t){const r={...this.requestOptions,...t};return c(this.url,e,r)}executeTopFeaturesQuery(e,t){const r={...this.requestOptions,...t};return F(this.parsedUrl,e,this.sourceSpatialReference,r)}executeForTopIds(e,t){const r={...this.requestOptions,...t};return S(this.parsedUrl,e,r)}executeForTopExtents(e,t){const r={...this.requestOptions,...t};return j(this.parsedUrl,e,r)}executeForTopCount(e,t){const r={...this.requestOptions,...t};return D(this.parsedUrl,e,r)}_normalizeQuery(e){let r=O.from(e);if(r.sourceSpatialReference=r.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(r=r===e?r.clone():r,r.gdbVersion=e.gdbVersion||this.gdbVersion,r.dynamicDataSource=e.dynamicDataSource?a.from(e.dynamicDataSource):this.dynamicDataSource),o(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){r=r===e?r.clone():r,r.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if(\"3D_glb\"===e.id){r.formatOf3DObjects=e.id;break}\"3D_gltf\"!==e.id||r.formatOf3DObjects||(r.formatOf3DObjects=e.id)}if(!r.formatOf3DObjects)throw new t(\"query:unsupported-3d-query-formats\",\"Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf\");if(s(r.outFields)||!r.outFields.includes(\"*\")){r=r===e?r.clone():r,s(r.outFields)&&(r.outFields=[]);const{originX:t,originY:o,originZ:i,translationX:u,translationY:n,translationZ:a,scaleX:c,scaleY:p,scaleZ:m,rotationX:f,rotationY:l,rotationZ:h,rotationDeg:d}=this.infoFor3D.transformFieldRoles;r.outFields.push(t,o,i,u,n,a,c,p,m,f,l,h,d)}}return r}_normalizeFields(e){if(o(this.fieldsIndex)&&o(e))for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return o(this.infoFor3D)&&e.returnGeometry&&\"xyFootprint\"!==e.multipatchOption&&!e.outStatistics}};e([u({type:a})],g.prototype,\"dynamicDataSource\",void 0),e([u()],g.prototype,\"fieldsIndex\",void 0),e([u()],g.prototype,\"format\",void 0),e([u()],g.prototype,\"gdbVersion\",void 0),e([u()],g.prototype,\"infoFor3D\",void 0),e([u()],g.prototype,\"sourceSpatialReference\",void 0),g=e([n(\"esri.tasks.QueryTask\")],g);var Q=g;export default Q;\n"]},"metadata":{},"sourceType":"module"}