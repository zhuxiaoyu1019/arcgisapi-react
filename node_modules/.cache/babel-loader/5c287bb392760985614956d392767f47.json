{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../Error.js\";\nimport r from \"../has.js\";\nimport { throwIfAborted as e, createAbortController as o } from \"../promiseUtils.js\";\nimport n from \"./Connection.js\";\nexport { default as Connection } from \"./Connection.js\";\nimport i from \"./RemoteClient.js\";\nexport { default as RemoteClient } from \"./RemoteClient.js\";\nimport s from \"./WorkerOwner.js\";\nlet a = r(\"esri-workers-debug\") ? 1 : r(\"host-browser\") ? navigator.hardwareConcurrency - 1 : 0;\na || (a = r(\"safari\") && r(\"mac\") || r(\"trident\") ? 7 : 2);\nlet l = 0;\nconst c = [];\n\nfunction m() {\n  g();\n}\n\nfunction f(t, r) {\n  return u(t, {\n    client: r\n  });\n}\n\nasync function u(t, r) {\n  const e = new n();\n  return await e.open(t, r), e;\n}\n\nasync function p(o, n = {}) {\n  if (\"string\" != typeof o) throw new t(\"workers:undefined-module\", \"modulePath is missing\");\n  let s = n.strategy || \"distributed\";\n\n  if (r(\"host-webworker\") && !r(\"esri-workers\") && (s = \"local\"), \"local\" === s) {\n    let t = await i.loadWorker(o);\n    t || (t = await import(\n    /* @vite-ignore */\n\n    /* webpackIgnore: true */\n    o)), e(n.signal);\n    const r = n.client || t;\n    return u([i.connect(t)], { ...n,\n      client: r\n    });\n  }\n\n  if (await g(), e(n.signal), \"dedicated\" === s) {\n    const t = l++ % a;\n    return u([await c[t].open(o, n)], n);\n  }\n\n  if (n.maxNumWorkers && n.maxNumWorkers > 0) {\n    const t = Math.min(n.maxNumWorkers, a);\n\n    if (t < a) {\n      const r = new Array(t);\n\n      for (let e = 0; e < t; ++e) {\n        const t = l++ % a;\n        r[e] = c[t].open(o, n);\n      }\n\n      return u(r, n);\n    }\n  }\n\n  return u(c.map(t => t.open(o, n)), n);\n}\n\nfunction w() {\n  h && (d.abort(), h = null);\n\n  for (let t = 0; t < c.length; t++) c[t] && c[t].terminate();\n\n  c.length = 0;\n}\n\nlet d,\n    h = null;\n\nasync function g() {\n  if (h) return h;\n  d = o();\n  const t = [];\n\n  for (let r = 0; r < a; r++) {\n    const e = s.create(r).then(t => (c[r] = t, t));\n    t.push(e);\n  }\n\n  return h = Promise.all(t), h;\n}\n\nexport { m as initialize, p as open, f as openWithPorts, w as terminate };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/core/workers/workers.js"],"names":["t","r","throwIfAborted","e","createAbortController","o","n","default","Connection","i","RemoteClient","s","a","navigator","hardwareConcurrency","l","c","m","g","f","u","client","open","p","strategy","loadWorker","signal","connect","maxNumWorkers","Math","min","Array","map","w","h","d","abort","length","terminate","create","then","push","Promise","all","initialize","openWithPorts"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../Error.js\";import r from\"../has.js\";import{throwIfAborted as e,createAbortController as o}from\"../promiseUtils.js\";import n from\"./Connection.js\";export{default as Connection}from\"./Connection.js\";import i from\"./RemoteClient.js\";export{default as RemoteClient}from\"./RemoteClient.js\";import s from\"./WorkerOwner.js\";let a=r(\"esri-workers-debug\")?1:r(\"host-browser\")?navigator.hardwareConcurrency-1:0;a||(a=r(\"safari\")&&r(\"mac\")||r(\"trident\")?7:2);let l=0;const c=[];function m(){g()}function f(t,r){return u(t,{client:r})}async function u(t,r){const e=new n;return await e.open(t,r),e}async function p(o,n={}){if(\"string\"!=typeof o)throw new t(\"workers:undefined-module\",\"modulePath is missing\");let s=n.strategy||\"distributed\";if(r(\"host-webworker\")&&!r(\"esri-workers\")&&(s=\"local\"),\"local\"===s){let t=await i.loadWorker(o);t||(t=await import(\n/* @vite-ignore */\n/* webpackIgnore: true */\no)),e(n.signal);const r=n.client||t;return u([i.connect(t)],{...n,client:r})}if(await g(),e(n.signal),\"dedicated\"===s){const t=l++%a;return u([await c[t].open(o,n)],n)}if(n.maxNumWorkers&&n.maxNumWorkers>0){const t=Math.min(n.maxNumWorkers,a);if(t<a){const r=new Array(t);for(let e=0;e<t;++e){const t=l++%a;r[e]=c[t].open(o,n)}return u(r,n)}}return u(c.map((t=>t.open(o,n))),n)}function w(){h&&(d.abort(),h=null);for(let t=0;t<c.length;t++)c[t]&&c[t].terminate();c.length=0}let d,h=null;async function g(){if(h)return h;d=o();const t=[];for(let r=0;r<a;r++){const e=s.create(r).then((t=>(c[r]=t,t)));t.push(e)}return h=Promise.all(t),h}export{m as initialize,p as open,f as openWithPorts,w as terminate};\n"]},"metadata":{},"sourceType":"module"}