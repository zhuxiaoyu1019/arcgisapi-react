{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../config.js\";\nimport { id as t } from \"../kernel.js\";\nimport i from \"../request.js\";\nimport r from \"../core/Error.js\";\nimport { JSONMap as a } from \"../core/jsonMap.js\";\nimport { isSome as n } from \"../core/maybe.js\";\nimport { createScreenPoint as s, pt2px as o, px2pt as l } from \"../core/screenUtils.js\";\nimport { normalize as u, dataComponents as c } from \"../core/urlUtils.js\";\nimport y from \"../geometry/Polygon.js\";\nimport { getSizeRangeAtScale as f } from \"../renderers/visualVariables/support/visualVariableUtils.js\";\nimport { execute as m } from \"./geoprocessor/execute.js\";\nimport { submitJob as p } from \"./geoprocessor/submitJob.js\";\nimport { toJSON as d } from \"./support/fileFormat.js\";\nimport { toJSON as g } from \"./support/layoutTemplate.js\";\nimport { getVisibleLayerViews as h, isGroupLayer as b, isBingMapsLayer as w, isCSVLayer as S, isFeatureLayer as x, isGeoJSONLayer as v, isGraphicsLayer as I, isImageryLayer as D, isKMLLayer as L, isMapImageLayer as V, isMapNotesLayer as M, isOpenStreetMapLayer as O, isStreamLayer as T, isTileLayer as E, isVectorTileLayer as F, isWebTileLayer as P, isWMSLayer as R, isWMTSLayer as k, applyVisualVariables as N, getContextBoundingBox as J, createPolygonLayer as C, createPolylineLayer as U, createPointLayer as j, createMultipointLayer as A } from \"./support/printTaskUtils.js\";\nimport z from \"./support/PrintTemplate.js\";\nimport K from \"./support/Query.js\";\nimport { supportsApiKey as $ } from \"../support/apiKeyUtils.js\";\nconst _ = {\n  Feet: \"ft\",\n  Kilometers: \"km\",\n  Meters: \"m\",\n  Miles: \"mi\"\n},\n      q = new a({\n  esriFeet: \"Feet\",\n  esriKilometers: \"Kilometers\",\n  esriMeters: \"Meters\",\n  esriMiles: \"Miles\"\n}),\n      W = new a({\n  esriExecutionTypeSynchronous: \"sync\",\n  esriExecutionTypeAsynchronous: \"async\"\n}),\n      B = new K({\n  returnGeometry: !0\n}),\n      G = new Map();\n\nasync function Q(e, t, r) {\n  const a = Z(e);\n  let n = G.get(a);\n  return Promise.resolve().then(() => n ? {\n    data: n.gpMetadata\n  } : (n = {\n    gpServerUrl: a,\n    is11xService: !1,\n    legendLayerNameMap: [],\n    legendLayers: []\n  }, i(a, {\n    query: {\n      f: \"json\"\n    }\n  }))).then(e => (n.gpMetadata = e.data, n.cimVersion = n.gpMetadata.cimVersion, n.is11xService = !!n.cimVersion, G.set(a, n), X(t, n))).then(i => {\n    const a = Ie(n);\n    let s;\n\n    const o = e => \"sync\" === a ? e.results && e.results[0] && e.results[0].value : s.fetchResultData(\"Output_File\", null, r).then(e => e.value);\n\n    return \"async\" === a ? p(e, i, null, r).then(e => (s = e, e.waitForJobCompletion({\n      interval: t.updateDelay\n    }).then(o))) : m(e, i, null, r).then(o);\n  });\n}\n\nasync function H(e) {\n  const t = Z(e);\n  return Ie(G.get(t));\n}\n\nasync function X(e, t) {\n  t = t || {\n    is11xService: !1,\n    legendLayerNameMap: [],\n    legendLayers: []\n  };\n  const i = e.template || new z();\n  null == i.showLabels && (i.showLabels = !0);\n  const a = i.exportOptions;\n  let n;\n  const s = g(i.layout);\n\n  if (a) {\n    if (n = {\n      dpi: a.dpi\n    }, \"map_only\" === s.toLowerCase() || \"\" === s) {\n      const e = a.width,\n            t = a.height;\n      n.outputSize = [e, t];\n    }\n  }\n\n  const o = i.layoutOptions;\n  let l;\n\n  if (o) {\n    let e, t;\n    \"Miles\" === o.scalebarUnit || \"Kilometers\" === o.scalebarUnit ? (e = \"Kilometers\", t = \"Miles\") : \"Meters\" !== o.scalebarUnit && \"Feet\" !== o.scalebarUnit || (e = \"Meters\", t = \"Feet\"), l = {\n      titleText: o.titleText,\n      authorText: o.authorText,\n      copyrightText: o.copyrightText,\n      customTextElements: o.customTextElements,\n      scaleBarOptions: {\n        metricUnit: q.toJSON(e),\n        metricLabel: _[e],\n        nonMetricUnit: q.toJSON(t),\n        nonMetricLabel: _[t]\n      }\n    };\n  }\n\n  let u = null;\n  o && o.legendLayers && (u = o.legendLayers.map(e => {\n    t.legendLayerNameMap[e.layerId] = e.title;\n    const i = {\n      id: e.layerId\n    };\n    return e.subLayerIds && (i.subLayerIds = e.subLayerIds), i;\n  }));\n  const c = await Y(e, i, t);\n\n  if (c.operationalLayers) {\n    const e = new RegExp(\"[\\\\u4E00-\\\\u9FFF\\\\u0E00-\\\\u0E7F\\\\u0900-\\\\u097F\\\\u3040-\\\\u309F\\\\u30A0-\\\\u30FF\\\\u31F0-\\\\u31FF]\"),\n          i = /[\\u0600-\\u06FF]/,\n          a = t => {\n      const r = t.text,\n            a = t.font,\n            n = a && a.family && a.family.toLowerCase();\n      r && a && (\"arial\" === n || \"arial unicode ms\" === n) && (a.family = e.test(r) ? \"Arial Unicode MS\" : \"Arial\", \"normal\" !== a.style && i.test(r) && (a.family = \"Arial Unicode MS\"));\n    },\n          n = () => {\n      throw new r(\"print-task:cim-symbol-unsupported\", \"CIMSymbol is not supported by a print service published from ArcMap\");\n    };\n\n    c.operationalLayers.forEach(e => {\n      var i, r, s;\n      null != (i = e.featureCollection) && i.layers ? e.featureCollection.layers.forEach(e => {\n        var i, r, s, o;\n\n        if (null != (i = e.layerDefinition) && null != (r = i.drawingInfo) && null != (s = r.renderer) && s.symbol) {\n          const i = e.layerDefinition.drawingInfo.renderer;\n          \"esriTS\" === i.symbol.type ? a(i.symbol) : \"CIMSymbolReference\" !== i.symbol.type || t.is11xService || n();\n        }\n\n        null != (o = e.featureSet) && o.features && e.featureSet.features.forEach(e => {\n          e.symbol && (\"esriTS\" === e.symbol.type ? a(e.symbol) : \"CIMSymbolReference\" !== e.symbol.type || t.is11xService || n());\n        });\n      }) : !t.is11xService && null != (r = e.layerDefinition) && null != (s = r.drawingInfo) && s.renderer && JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('\"type\":\"CIMSymbolReference\"') && n();\n    });\n  }\n\n  e.outSpatialReference && (c.mapOptions.spatialReference = e.outSpatialReference.toJSON()), Object.assign(c, {\n    exportOptions: n,\n    layoutOptions: l || {}\n  }), Object.assign(c.layoutOptions, {\n    legendOptions: {\n      operationalLayers: null != u ? u : t.legendLayers.slice()\n    }\n  }), t.legendLayers.length = 0, G.set(t.gpServerUrl, t);\n  const y = {\n    Web_Map_as_JSON: JSON.stringify(c),\n    Format: d(i.format),\n    Layout_Template: s\n  };\n  return e.extraParameters && Object.assign(y, e.extraParameters), y;\n}\n\nasync function Y(e, t, i) {\n  const r = e.view;\n  let a = r.spatialReference;\n  const s = {\n    operationalLayers: await ee(r, t, i)\n  };\n  let o = i.ssExtent || e.extent || r.extent;\n\n  if (a && a.isWrappable && (o = o.clone()._normalize(!0), a = o.spatialReference), s.mapOptions = {\n    extent: o && o.toJSON(),\n    spatialReference: a && a.toJSON(),\n    showAttribution: t.attributionVisible\n  }, i.ssExtent = null, r.background && (s.background = r.background.toJSON()), r.rotation && (s.mapOptions.rotation = -r.rotation), t.scalePreserved && (s.mapOptions.scale = t.outScale || r.scale), r.timeExtent) {\n    const e = n(r.timeExtent.start) ? r.timeExtent.start.getTime() : null,\n          t = n(r.timeExtent.end) ? r.timeExtent.end.getTime() : null;\n    s.mapOptions.time = [e, t];\n  }\n\n  return s;\n}\n\nfunction Z(e) {\n  let t = e;\n  const i = t.lastIndexOf(\"/GPServer/\");\n  return i > 0 && (t = t.slice(0, i + 9)), t;\n}\n\nasync function ee(e, t, i) {\n  const r = [],\n        a = {\n    layerView: null,\n    printTemplate: t,\n    view: e\n  };\n  let n = 0;\n  t.scalePreserved && (n = t.outScale || e.scale);\n  const s = h(e, n);\n\n  for (const o of s) {\n    const e = o.layer;\n    if (!e.loaded || b(e)) continue;\n    let t;\n    a.layerView = o, t = w(e) ? te(e) : S(e) ? await ie(e, a, i) : x(e) ? await ae(e, a, i) : v(e) ? await ne(e, a, i) : I(e) ? await se(e, a, i) : D(e) ? oe(e, i) : L(e) ? await le(e, a, i) : V(e) ? ue(e, a, i) : M(e) ? await ce(a, i) : O(e) ? ye() : T(e) ? await me(e, a, i) : E(e) ? pe(e) : F(e) ? await de(e, a, i) : P(e) ? ge(e) : R(e) ? he(e) : k(e) ? be(e) : await fe(e, a, i), t && (Array.isArray(t) ? r.push(...t) : (t.id = e.id, t.title = i.legendLayerNameMap[e.id] || e.title, t.opacity = e.opacity, t.minScale = e.minScale || 0, t.maxScale = e.maxScale || 0, r.push(t)));\n  }\n\n  if (n && r.forEach(e => {\n    e.minScale = 0, e.maxScale = 0;\n  }), e.graphics && e.graphics.length) {\n    const a = await re(null, e.graphics, t, i);\n    a && r.push(a);\n  }\n\n  return r;\n}\n\nfunction te(e) {\n  return {\n    culture: e.culture,\n    key: e.key,\n    type: \"BingMaps\" + (\"aerial\" === e.style ? \"Aerial\" : \"hybrid\" === e.style ? \"Hybrid\" : \"Road\")\n  };\n}\n\nasync function ie(e, {\n  layerView: t,\n  printTemplate: i\n}, r) {\n  let a;\n\n  if (r.legendLayers && r.legendLayers.push({\n    id: e.id\n  }), !r.is11xService) {\n    return re(e, await ve(t), i, r);\n  }\n\n  return a = {\n    type: \"CSV\"\n  }, e.write(a, {\n    origin: \"web-map\"\n  }), delete a.popupInfo, delete a.layerType, a.showLabels = i.showLabels && e.labelsVisible, a;\n}\n\nasync function re(e, t, i, r) {\n  let a;\n  const n = C(),\n        s = U(),\n        o = j(),\n        l = A(),\n        u = j();\n\n  if (u.layerDefinition.name = \"textLayer\", delete u.layerDefinition.drawingInfo, e) {\n    if (\"esri.layers.FeatureLayer\" === e.declaredClass || \"esri.layers.StreamLayer\" === e.declaredClass ? n.layerDefinition.name = s.layerDefinition.name = o.layerDefinition.name = l.layerDefinition.name = r.legendLayerNameMap[e.id] || e.get(\"arcgisProps.title\") || e.title : \"esri.layers.GraphicsLayer\" === e.declaredClass && (t = e.graphics.items), e.renderer) {\n      const t = e.renderer.toJSON();\n      n.layerDefinition.drawingInfo.renderer = t, s.layerDefinition.drawingInfo.renderer = t, o.layerDefinition.drawingInfo.renderer = t, l.layerDefinition.drawingInfo.renderer = t;\n    }\n\n    if (i.showLabels && e.labelsVisible && \"function\" == typeof e.write) {\n      var c, f;\n      const t = null == (c = e.write({}, {\n        origin: \"web-map\"\n      }).layerDefinition) || null == (f = c.drawingInfo) ? void 0 : f.labelingInfo;\n      t && (a = !0, n.layerDefinition.drawingInfo.labelingInfo = t, s.layerDefinition.drawingInfo.labelingInfo = t, o.layerDefinition.drawingInfo.labelingInfo = t, l.layerDefinition.drawingInfo.labelingInfo = t);\n    }\n  }\n\n  let m;\n  null != e && e.renderer || a || (delete n.layerDefinition.drawingInfo, delete s.layerDefinition.drawingInfo, delete o.layerDefinition.drawingInfo, delete l.layerDefinition.drawingInfo);\n  const p = null == e ? void 0 : e.fieldsIndex,\n        d = null == e ? void 0 : e.renderer;\n\n  if (p) {\n    if (d && \"function\" == typeof d.collectRequiredFields) {\n      const e = new Set();\n      await d.collectRequiredFields(e, p), m = Array.from(e);\n    }\n\n    const e = p.fields.map(e => e.toJSON());\n    n.layerDefinition.fields = e, s.layerDefinition.fields = e, o.layerDefinition.fields = e, l.layerDefinition.fields = e;\n  }\n\n  const g = t && t.length;\n  let h;\n\n  for (let w = 0; w < g; w++) {\n    const a = t[w] || t.getItemAt(w);\n    if (!1 === a.visible || !a.geometry) continue;\n    if (h = a.toJSON(), h.hasOwnProperty(\"popupTemplate\") && delete h.popupTemplate, h.geometry && h.geometry.z && delete h.geometry.z, h.symbol && h.symbol.outline && \"esriCLS\" === h.symbol.outline.type && !r.is11xService) continue;\n    !r.is11xService && h.symbol && h.symbol.outline && h.symbol.outline.color && h.symbol.outline.color[3] && (h.symbol.outline.color[3] = 255);\n    const c = e && e.renderer && (\"valueExpression\" in e.renderer && e.renderer.valueExpression || \"hasVisualVariables\" in e.renderer && e.renderer.hasVisualVariables());\n\n    if (!h.symbol && e && e.renderer && c && !r.is11xService) {\n      const t = e.renderer,\n            i = await t.getSymbolAsync(a);\n      if (!i) continue;\n      h.symbol = i.toJSON(), \"hasVisualVariables\" in t && t.hasVisualVariables() && N(h.symbol, {\n        renderer: t,\n        graphic: a,\n        symbol: i\n      });\n    }\n\n    if (h.symbol && (h.symbol.angle || delete h.symbol.angle, De(h.symbol) ? h.symbol = await Se(h.symbol, r) : h.symbol.text && delete h.attributes), (!i || !i.forceFeatureAttributes) && m && m.length) {\n      const e = {};\n      m.forEach(t => {\n        h.attributes && h.attributes.hasOwnProperty(t) && (e[t] = h.attributes[t]);\n      }), h.attributes = e;\n    }\n\n    \"polygon\" === a.geometry.type ? n.featureSet.features.push(h) : \"polyline\" === a.geometry.type ? s.featureSet.features.push(h) : \"point\" === a.geometry.type ? h.symbol && h.symbol.text ? u.featureSet.features.push(h) : o.featureSet.features.push(h) : \"multipoint\" === a.geometry.type ? l.featureSet.features.push(h) : \"extent\" === a.geometry.type && (h.geometry = y.fromExtent(a.geometry).toJSON(), n.featureSet.features.push(h));\n  }\n\n  const b = [n, s, l, o, u].filter(e => e.featureSet.features.length > 0);\n\n  for (const y of b) {\n    const e = y.featureSet.features.every(e => e.symbol);\n    !e || i && i.forceFeatureAttributes || y.featureSet.features.forEach(e => {\n      delete e.attributes;\n    }), e && delete y.layerDefinition.drawingInfo, y.layerDefinition.drawingInfo && y.layerDefinition.drawingInfo.renderer && (await xe(y.layerDefinition.drawingInfo.renderer, r));\n  }\n\n  return b.length ? {\n    featureCollection: {\n      layers: b\n    },\n    showLabels: a\n  } : null;\n}\n\nasync function ae(e, t, i) {\n  var r, a;\n  let n;\n  i.legendLayers && i.legendLayers.push({\n    id: e.id\n  });\n  const s = e.renderer;\n  if (e.featureReduction || s && \"dot-density\" === s.type && (!i.is11xService || parseFloat(i.cimVersion) < 2.6)) return fe(e, t, i);\n  const {\n    layerView: o,\n    printTemplate: l,\n    view: u\n  } = t,\n        c = s && (\"valueExpression\" in s && s.valueExpression || \"hasVisualVariables\" in s && s.hasVisualVariables()),\n        y = \"feature-layer\" !== (null == (r = e.source) ? void 0 : r.type) && \"ogc-feature\" !== (null == (a = e.source) ? void 0 : a.type);\n\n  if (!i.is11xService && c || e.featureReduction || y || !s || \"field\" in s && null != s.field && (\"string\" != typeof s.field || !e.getField(s.field))) {\n    const t = await ve(o);\n    n = await re(e, t, l, i);\n  } else {\n    var m, p;\n\n    if (n = {\n      id: (d = e.write()).id,\n      title: d.title,\n      opacity: d.opacity,\n      minScale: d.minScale,\n      maxScale: d.maxScale,\n      url: d.url,\n      layerDefinition: d.layerDefinition\n    }, n.showLabels = l.showLabels && e.labelsVisible, we(n, e), null != (m = n.layerDefinition) && null != (p = m.drawingInfo) && p.renderer && (delete n.layerDefinition.minScale, delete n.layerDefinition.maxScale, await xe(n.layerDefinition.drawingInfo.renderer, i), \"visualVariables\" in s && s.visualVariables && s.visualVariables[0])) {\n      const e = s.visualVariables[0];\n\n      if (\"size\" === e.type && e.maxSize && \"number\" != typeof e.maxSize && e.minSize && \"number\" != typeof e.minSize) {\n        const t = f(e, u.scale);\n        n.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize = t.minSize, n.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize = t.maxSize;\n      }\n    }\n  }\n\n  var d;\n  return n;\n}\n\nasync function ne(e, {\n  layerView: t,\n  printTemplate: i\n}, r) {\n  r.legendLayers && r.legendLayers.push({\n    id: e.id\n  });\n  return re(e, await ve(t), i, r);\n}\n\nasync function se(e, {\n  printTemplate: t\n}, i) {\n  return re(e, null, t, i);\n}\n\nfunction oe(e, t) {\n  t.legendLayers && t.legendLayers.push({\n    id: e.id\n  });\n  const i = {\n    bandIds: e.bandIds,\n    compressionQuality: e.compressionQuality,\n    format: e.format,\n    interpolation: e.interpolation\n  };\n  if ((e.mosaicRule || e.definitionExpression) && (i.mosaicRule = e.exportImageServiceParameters.mosaicRule.toJSON()), e.renderingRule || e.renderer) if (t.is11xService) e.renderingRule && (i.renderingRule = e.renderingRule.toJSON()), e.renderer && (i.layerDefinition = i.layerDefinition || {}, i.layerDefinition.drawingInfo = i.layerDefinition.drawingInfo || {}, i.layerDefinition.drawingInfo.renderer = e.renderer.toJSON());else {\n    const t = e.exportImageServiceParameters.combineRendererWithRenderingRule();\n    t && (i.renderingRule = t.toJSON());\n  }\n  return we(i, e), i;\n}\n\nasync function le(e, t, i) {\n  const r = t.printTemplate;\n\n  if (i.is11xService) {\n    const t = {\n      type: \"kml\"\n    };\n    return e.write(t, {\n      origin: \"web-map\"\n    }), delete t.layerType, t.url = u(e.url), t;\n  }\n\n  {\n    const a = [],\n          n = t.layerView;\n    n.allVisibleMapImages.forEach((t, i) => {\n      const r = {\n        id: `${e.id}_image${i}`,\n        type: \"image\",\n        title: e.id,\n        minScale: e.minScale || 0,\n        maxScale: e.maxScale || 0,\n        opacity: e.opacity,\n        extent: t.extent\n      };\n      \"data:image/png;base64,\" === t.href.substr(0, 22) ? r.imageData = t.href.substr(22) : r.url = t.href, a.push(r);\n    });\n    const s = [...n.allVisiblePoints.items, ...n.allVisiblePolylines.items, ...n.allVisiblePolygons.items],\n          o = {\n      id: e.id,\n      ...(await re(null, s, r, i))\n    };\n    return a.push(o), a;\n  }\n}\n\nfunction ue(e, {\n  view: t\n}, i) {\n  let r;\n  const a = {\n    id: e.id,\n    subLayerIds: []\n  };\n  let n = [];\n\n  const s = t.scale,\n        o = e => {\n    const t = 0 === s,\n          i = 0 === e.minScale || s <= e.minScale,\n          r = 0 === e.maxScale || s >= e.maxScale;\n    if (e.visible && (t || i && r)) if (e.sublayers) e.sublayers.forEach(o);else {\n      const t = e.toExportImageJSON(),\n            i = {\n        id: e.id,\n        name: e.title,\n        layerDefinition: {\n          drawingInfo: t.drawingInfo,\n          definitionExpression: t.definitionExpression,\n          source: t.source\n        }\n      };\n      n.unshift(i), a.subLayerIds.push(e.id);\n    }\n  };\n\n  return e.sublayers && e.sublayers.forEach(o), n.length && (n = n.map(({\n    id: e,\n    name: t,\n    layerDefinition: i\n  }) => ({\n    id: e,\n    name: t,\n    layerDefinition: i\n  })), r = {\n    layers: n,\n    visibleLayers: e.capabilities.exportMap.supportsDynamicLayers ? void 0 : a.subLayerIds\n  }, we(r, e), i.legendLayers.push(a)), r;\n}\n\nasync function ce({\n  layerView: e,\n  printTemplate: t\n}, i) {\n  const r = [],\n        a = e.layer;\n  if (n(a.featureCollections)) for (const n of a.featureCollections) {\n    const e = await re(n, n.source, t, i);\n    e && r.push(...e.featureCollection.layers);\n  } else if (n(a.sublayers)) for (const n of a.sublayers) {\n    const e = await re(null, n.graphics, t, i);\n    e && r.push(...e.featureCollection.layers);\n  }\n  return {\n    featureCollection: {\n      layers: r\n    }\n  };\n}\n\nfunction ye() {\n  return {\n    type: \"OpenStreetMap\"\n  };\n}\n\nasync function fe(e, {\n  printTemplate: t,\n  view: i\n}, r) {\n  const a = {\n    type: \"image\"\n  },\n        n = {\n    format: \"png\",\n    ignoreBackground: !0,\n    layers: [e],\n    rotation: 0\n  },\n        o = r.ssExtent || i.extent.clone();\n  let l = 96,\n      u = !0,\n      y = !0;\n\n  if (t.exportOptions) {\n    const e = t.exportOptions;\n    e.dpi > 0 && (l = e.dpi), e.width > 0 && (u = e.width % 2 == i.width % 2), e.height > 0 && (y = e.height % 2 == i.height % 2);\n  }\n\n  if (\"map-only\" === t.layout && t.scalePreserved && (!t.outScale || t.outScale === i.scale) && 96 === l && (!u || !y) && (n.area = {\n    x: 0,\n    y: 0,\n    width: i.width,\n    height: i.height\n  }, u || (n.area.width -= 1), y || (n.area.height -= 1), !r.ssExtent)) {\n    const e = i.toMap(s(n.area.width, n.area.height));\n    o.ymin = e.y, o.xmax = e.x, r.ssExtent = o;\n  }\n\n  a.extent = o.clone()._normalize(!0).toJSON();\n  const f = await i.takeScreenshot(n),\n        {\n    data: m\n  } = c(f.dataUrl);\n  return a.imageData = m, a;\n}\n\nasync function me(e, {\n  layerView: t,\n  printTemplate: i\n}, r) {\n  r.legendLayers && r.legendLayers.push({\n    id: e.id\n  });\n  return re(e, await ve(t), i, r);\n}\n\nfunction pe(e) {\n  const t = {\n    customParameters: e.customParameters\n  };\n  return we(t, e), t;\n}\n\nasync function de(e, i, r) {\n  if (r.is11xService && e.serviceUrl && e.styleUrl) {\n    const i = t && t.findCredential(e.styleUrl),\n          a = t && t.findCredential(e.serviceUrl);\n\n    if (!i && !a || \"2.1.0\" !== r.cimVersion) {\n      const t = {\n        type: \"VectorTileLayer\"\n      };\n      return t.styleUrl = u(e.styleUrl), i && (t.token = i.token), a && a.token !== t.token && (t.additionalTokens = [{\n        url: e.serviceUrl,\n        token: a.token\n      }]), t;\n    }\n  }\n\n  return fe(e, i, r);\n}\n\nfunction ge(e) {\n  const t = {\n    type: \"WebTiledLayer\",\n    urlTemplate: e.urlTemplate.replace(/\\${/g, \"{\"),\n    credits: e.copyright\n  };\n  return e.subDomains && e.subDomains.length > 0 && (t.subDomains = e.subDomains), t;\n}\n\nfunction he(e) {\n  let t;\n\n  const i = [],\n        r = e => {\n    e.visible && (e.sublayers ? e.sublayers.forEach(r) : e.name && i.unshift(e.name));\n  };\n\n  return e.sublayers && e.sublayers.forEach(r), i.length && (t = {\n    type: \"wms\",\n    customLayerParameters: e.customLayerParameters,\n    customParameters: e.customParameters,\n    transparentBackground: e.imageTransparency,\n    visibleLayers: i,\n    url: u(e.url),\n    version: e.version\n  }), t;\n}\n\nfunction be(e) {\n  const t = e.activeLayer;\n  return {\n    type: \"wmts\",\n    customLayerParameters: e.customLayerParameters,\n    customParameters: e.customParameters,\n    format: t.imageFormat,\n    layer: t.id,\n    style: t.styleId,\n    tileMatrixSet: t.tileMatrixSetId,\n    url: u(e.url)\n  };\n}\n\nfunction we(i, r) {\n  if (r.url) if (i.url = u(i.url || r.url), \"apiKey\" in r && r.apiKey) i.token = r.apiKey;else if (e.apiKey && $(r.url)) i.token = e.apiKey;else {\n    var a, n;\n    i.token = null == (a = t) || null == (n = a.findCredential(r.url)) ? void 0 : n.token;\n  }\n}\n\nasync function Se(e, t) {\n  t.canvas || (t.canvas = document.createElement(\"canvas\"));\n  const r = 1024;\n  t.canvas.width = r, t.canvas.height = r;\n  const a = t.canvas.getContext(\"2d\");\n  let n, s;\n\n  if (e.path) {\n    var u;\n    const t = new Path2D(e.path);\n    t.closePath(), a.fillStyle = Array.isArray(e.color) ? `rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3] / 255})` : \"rgb(0,0,0)\", a.fill(t);\n    const i = J(a);\n    if (!i) return null;\n    a.clearRect(0, 0, r, r);\n    const l = o(e.size) / Math.max(i.width, i.height);\n    a.scale(l, l);\n    const c = r / l,\n          y = c / 2 - i.width / 2 - i.x,\n          f = c / 2 - i.height / 2 - i.y;\n\n    if (a.translate(y, f), Array.isArray(e.color) && a.fill(t), null != (u = e.outline) && u.width && Array.isArray(e.outline.color)) {\n      const r = e.outline;\n      a.lineWidth = o(r.width) / l, a.lineJoin = \"round\", a.strokeStyle = `rgba(${r.color[0]},${r.color[1]},${r.color[2]},${r.color[3] / 255})`, a.stroke(t), i.width += a.lineWidth, i.height += a.lineWidth;\n    }\n\n    i.width *= l, i.height *= l;\n    const m = a.getImageData(r / 2 - i.width / 2, r / 2 - i.height / 2, Math.ceil(i.width), Math.ceil(i.height));\n    n = m.width, s = m.height, a.canvas.width = n, a.canvas.height = s, a.putImageData(m, 0, 0);\n  } else {\n    const t = \"image/svg+xml\" === e.contentType ? \"data:image/svg+xml;base64,\" + e.imageData : e.url,\n          r = (await i(t, {\n      responseType: \"image\"\n    })).data;\n    n = o(e.width), s = o(e.height), a.canvas.width = n, a.canvas.height = s, a.drawImage(r, 0, 0, a.canvas.width, a.canvas.height);\n  }\n\n  return {\n    type: \"esriPMS\",\n    imageData: a.canvas.toDataURL(\"image/png\").substr(22),\n    angle: e.angle,\n    contentType: \"image/png\",\n    height: l(s),\n    width: l(n),\n    xoffset: e.xoffset,\n    yoffset: e.yoffset\n  };\n}\n\nasync function xe(e, t) {\n  const i = e.type;\n  if (\"simple\" === i && De(e.symbol)) e.symbol = await Se(e.symbol, t);else if (\"uniqueValue\" === i || \"classBreaks\" === i) {\n    De(e.defaultSymbol) && (e.defaultSymbol = await Se(e.defaultSymbol, t));\n    const r = e[\"uniqueValue\" === i ? \"uniqueValueInfos\" : \"classBreakInfos\"];\n    if (r) for (const e of r) De(e.symbol) && (e.symbol = await Se(e.symbol, t));\n  }\n}\n\nasync function ve(e) {\n  return e.queryFeatures(B).then(e => e.features);\n}\n\nfunction Ie(e) {\n  return e.gpMetadata && e.gpMetadata.executionType ? W.fromJSON(e.gpMetadata.executionType) : \"sync\";\n}\n\nfunction De(e) {\n  return e && (e.path || \"image/svg+xml\" === e.contentType || e.url && e.url.endsWith(\".svg\"));\n}\n\nexport { Q as execute, X as getGpPrintParams, Z as getGpServerUrl, H as getMode, G as printCacheMap };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/rest/print.js"],"names":["e","id","t","i","r","JSONMap","a","isSome","n","createScreenPoint","s","pt2px","o","px2pt","l","normalize","u","dataComponents","c","y","getSizeRangeAtScale","f","execute","m","submitJob","p","toJSON","d","g","getVisibleLayerViews","h","isGroupLayer","b","isBingMapsLayer","w","isCSVLayer","S","isFeatureLayer","x","isGeoJSONLayer","v","isGraphicsLayer","I","isImageryLayer","D","isKMLLayer","L","isMapImageLayer","V","isMapNotesLayer","M","isOpenStreetMapLayer","O","isStreamLayer","T","isTileLayer","E","isVectorTileLayer","F","isWebTileLayer","P","isWMSLayer","R","isWMTSLayer","k","applyVisualVariables","N","getContextBoundingBox","J","createPolygonLayer","C","createPolylineLayer","U","createPointLayer","j","createMultipointLayer","A","z","K","supportsApiKey","$","_","Feet","Kilometers","Meters","Miles","q","esriFeet","esriKilometers","esriMeters","esriMiles","W","esriExecutionTypeSynchronous","esriExecutionTypeAsynchronous","B","returnGeometry","G","Map","Q","Z","get","Promise","resolve","then","data","gpMetadata","gpServerUrl","is11xService","legendLayerNameMap","legendLayers","query","cimVersion","set","X","Ie","results","value","fetchResultData","waitForJobCompletion","interval","updateDelay","H","template","showLabels","exportOptions","layout","dpi","toLowerCase","width","height","outputSize","layoutOptions","scalebarUnit","titleText","authorText","copyrightText","customTextElements","scaleBarOptions","metricUnit","metricLabel","nonMetricUnit","nonMetricLabel","map","layerId","title","subLayerIds","Y","operationalLayers","RegExp","text","font","family","test","style","forEach","featureCollection","layers","layerDefinition","drawingInfo","renderer","symbol","type","featureSet","features","JSON","stringify","includes","outSpatialReference","mapOptions","spatialReference","Object","assign","legendOptions","slice","length","Web_Map_as_JSON","Format","format","Layout_Template","extraParameters","view","ee","ssExtent","extent","isWrappable","clone","_normalize","showAttribution","attributionVisible","background","rotation","scalePreserved","scale","outScale","timeExtent","start","getTime","end","time","lastIndexOf","layerView","printTemplate","layer","loaded","te","ie","ae","ne","se","oe","le","ue","ce","ye","me","pe","de","ge","he","be","fe","Array","isArray","push","opacity","minScale","maxScale","graphics","re","culture","key","ve","write","origin","popupInfo","layerType","labelsVisible","name","declaredClass","items","labelingInfo","fieldsIndex","collectRequiredFields","Set","from","fields","getItemAt","visible","geometry","hasOwnProperty","popupTemplate","outline","color","valueExpression","hasVisualVariables","getSymbolAsync","graphic","angle","De","Se","attributes","forceFeatureAttributes","fromExtent","filter","every","xe","featureReduction","parseFloat","source","field","getField","url","we","visualVariables","maxSize","minSize","bandIds","compressionQuality","interpolation","mosaicRule","definitionExpression","exportImageServiceParameters","renderingRule","combineRendererWithRenderingRule","allVisibleMapImages","href","substr","imageData","allVisiblePoints","allVisiblePolylines","allVisiblePolygons","sublayers","toExportImageJSON","unshift","visibleLayers","capabilities","exportMap","supportsDynamicLayers","featureCollections","ignoreBackground","area","toMap","ymin","xmax","takeScreenshot","dataUrl","customParameters","serviceUrl","styleUrl","findCredential","token","additionalTokens","urlTemplate","replace","credits","copyright","subDomains","customLayerParameters","transparentBackground","imageTransparency","version","activeLayer","imageFormat","styleId","tileMatrixSet","tileMatrixSetId","apiKey","canvas","document","createElement","getContext","path","Path2D","closePath","fillStyle","fill","clearRect","size","Math","max","translate","lineWidth","lineJoin","strokeStyle","stroke","getImageData","ceil","putImageData","contentType","responseType","drawImage","toDataURL","xoffset","yoffset","defaultSymbol","queryFeatures","executionType","fromJSON","endsWith","getGpPrintParams","getGpServerUrl","getMode","printCacheMap"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,cAAb;AAA4B,SAAOC,EAAE,IAAIC,CAAb,QAAmB,cAAnB;AAAkC,OAAOC,CAAP,MAAa,eAAb;AAA6B,OAAOC,CAAP,MAAa,kBAAb;AAAgC,SAAOC,OAAO,IAAIC,CAAlB,QAAwB,oBAAxB;AAA6C,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,kBAAvB;AAA0C,SAAOC,iBAAiB,IAAIC,CAA5B,EAA8BC,KAAK,IAAIC,CAAvC,EAAyCC,KAAK,IAAIC,CAAlD,QAAwD,wBAAxD;AAAiF,SAAOC,SAAS,IAAIC,CAApB,EAAsBC,cAAc,IAAIC,CAAxC,QAA8C,qBAA9C;AAAoE,OAAOC,CAAP,MAAa,wBAAb;AAAsC,SAAOC,mBAAmB,IAAIC,CAA9B,QAAoC,6DAApC;AAAkG,SAAOC,OAAO,IAAIC,CAAlB,QAAwB,2BAAxB;AAAoD,SAAOC,SAAS,IAAIC,CAApB,QAA0B,6BAA1B;AAAwD,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,yBAAvB;AAAiD,SAAOD,MAAM,IAAIE,CAAjB,QAAuB,6BAAvB;AAAqD,SAAOC,oBAAoB,IAAIC,CAA/B,EAAiCC,YAAY,IAAIC,CAAjD,EAAmDC,eAAe,IAAIC,CAAtE,EAAwEC,UAAU,IAAIC,CAAtF,EAAwFC,cAAc,IAAIC,CAA1G,EAA4GC,cAAc,IAAIC,CAA9H,EAAgIC,eAAe,IAAIC,CAAnJ,EAAqJC,cAAc,IAAIC,CAAvK,EAAyKC,UAAU,IAAIC,CAAvL,EAAyLC,eAAe,IAAIC,CAA5M,EAA8MC,eAAe,IAAIC,CAAjO,EAAmOC,oBAAoB,IAAIC,CAA3P,EAA6PC,aAAa,IAAIC,CAA9Q,EAAgRC,WAAW,IAAIC,CAA/R,EAAiSC,iBAAiB,IAAIC,CAAtT,EAAwTC,cAAc,IAAIC,CAA1U,EAA4UC,UAAU,IAAIC,CAA1V,EAA4VC,WAAW,IAAIC,CAA3W,EAA6WC,oBAAoB,IAAIC,CAArY,EAAuYC,qBAAqB,IAAIC,CAAha,EAAkaC,kBAAkB,IAAIC,CAAxb,EAA0bC,mBAAmB,IAAIC,CAAjd,EAAmdC,gBAAgB,IAAIC,CAAve,EAAyeC,qBAAqB,IAAIC,CAAlgB,QAAwgB,6BAAxgB;AAAsiB,OAAOC,CAAP,MAAa,4BAAb;AAA0C,OAAOC,CAAP,MAAa,oBAAb;AAAkC,SAAOC,cAAc,IAAIC,CAAzB,QAA+B,2BAA/B;AAA2D,MAAMC,CAAC,GAAC;AAACC,EAAAA,IAAI,EAAC,IAAN;AAAWC,EAAAA,UAAU,EAAC,IAAtB;AAA2BC,EAAAA,MAAM,EAAC,GAAlC;AAAsCC,EAAAA,KAAK,EAAC;AAA5C,CAAR;AAAA,MAA0DC,CAAC,GAAC,IAAIhF,CAAJ,CAAM;AAACiF,EAAAA,QAAQ,EAAC,MAAV;AAAiBC,EAAAA,cAAc,EAAC,YAAhC;AAA6CC,EAAAA,UAAU,EAAC,QAAxD;AAAiEC,EAAAA,SAAS,EAAC;AAA3E,CAAN,CAA5D;AAAA,MAAuJC,CAAC,GAAC,IAAIrF,CAAJ,CAAM;AAACsF,EAAAA,4BAA4B,EAAC,MAA9B;AAAqCC,EAAAA,6BAA6B,EAAC;AAAnE,CAAN,CAAzJ;AAAA,MAA4OC,CAAC,GAAC,IAAIhB,CAAJ,CAAM;AAACiB,EAAAA,cAAc,EAAC,CAAC;AAAjB,CAAN,CAA9O;AAAA,MAAyQC,CAAC,GAAC,IAAIC,GAAJ,EAA3Q;;AAAmR,eAAeC,CAAf,CAAiBlG,CAAjB,EAAmBE,CAAnB,EAAqBE,CAArB,EAAuB;AAAC,QAAME,CAAC,GAAC6F,CAAC,CAACnG,CAAD,CAAT;AAAa,MAAIQ,CAAC,GAACwF,CAAC,CAACI,GAAF,CAAM9F,CAAN,CAAN;AAAe,SAAO+F,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAwB,MAAI/F,CAAC,GAAC;AAACgG,IAAAA,IAAI,EAAChG,CAAC,CAACiG;AAAR,GAAD,IAAsBjG,CAAC,GAAC;AAACkG,IAAAA,WAAW,EAACpG,CAAb;AAAeqG,IAAAA,YAAY,EAAC,CAAC,CAA7B;AAA+BC,IAAAA,kBAAkB,EAAC,EAAlD;AAAqDC,IAAAA,YAAY,EAAC;AAAlE,GAAF,EAAwE1G,CAAC,CAACG,CAAD,EAAG;AAACwG,IAAAA,KAAK,EAAC;AAACzF,MAAAA,CAAC,EAAC;AAAH;AAAP,GAAH,CAA/F,CAA7B,EAAsJkF,IAAtJ,CAA4JvG,CAAC,KAAGQ,CAAC,CAACiG,UAAF,GAAazG,CAAC,CAACwG,IAAf,EAAoBhG,CAAC,CAACuG,UAAF,GAAavG,CAAC,CAACiG,UAAF,CAAaM,UAA9C,EAAyDvG,CAAC,CAACmG,YAAF,GAAe,CAAC,CAACnG,CAAC,CAACuG,UAA5E,EAAuFf,CAAC,CAACgB,GAAF,CAAM1G,CAAN,EAAQE,CAAR,CAAvF,EAAkGyG,CAAC,CAAC/G,CAAD,EAAGM,CAAH,CAAtG,CAA7J,EAA4Q+F,IAA5Q,CAAkRpG,CAAC,IAAE;AAAC,UAAMG,CAAC,GAAC4G,EAAE,CAAC1G,CAAD,CAAV;AAAc,QAAIE,CAAJ;;AAAM,UAAME,CAAC,GAACZ,CAAC,IAAE,WAASM,CAAT,GAAWN,CAAC,CAACmH,OAAF,IAAWnH,CAAC,CAACmH,OAAF,CAAU,CAAV,CAAX,IAAyBnH,CAAC,CAACmH,OAAF,CAAU,CAAV,EAAaC,KAAjD,GAAuD1G,CAAC,CAAC2G,eAAF,CAAkB,aAAlB,EAAgC,IAAhC,EAAqCjH,CAArC,EAAwCmG,IAAxC,CAA8CvG,CAAC,IAAEA,CAAC,CAACoH,KAAnD,CAAlE;;AAA6H,WAAM,YAAU9G,CAAV,GAAYmB,CAAC,CAACzB,CAAD,EAAGG,CAAH,EAAK,IAAL,EAAUC,CAAV,CAAD,CAAcmG,IAAd,CAAoBvG,CAAC,KAAGU,CAAC,GAACV,CAAF,EAAIA,CAAC,CAACsH,oBAAF,CAAuB;AAACC,MAAAA,QAAQ,EAACrH,CAAC,CAACsH;AAAZ,KAAvB,EAAiDjB,IAAjD,CAAsD3F,CAAtD,CAAP,CAArB,CAAZ,GAAoGW,CAAC,CAACvB,CAAD,EAAGG,CAAH,EAAK,IAAL,EAAUC,CAAV,CAAD,CAAcmG,IAAd,CAAmB3F,CAAnB,CAA1G;AAAgI,GAAviB,CAAP;AAAijB;;AAAA,eAAe6G,CAAf,CAAiBzH,CAAjB,EAAmB;AAAC,QAAME,CAAC,GAACiG,CAAC,CAACnG,CAAD,CAAT;AAAa,SAAOkH,EAAE,CAAClB,CAAC,CAACI,GAAF,CAAMlG,CAAN,CAAD,CAAT;AAAoB;;AAAA,eAAe+G,CAAf,CAAiBjH,CAAjB,EAAmBE,CAAnB,EAAqB;AAACA,EAAAA,CAAC,GAACA,CAAC,IAAE;AAACyG,IAAAA,YAAY,EAAC,CAAC,CAAf;AAAiBC,IAAAA,kBAAkB,EAAC,EAApC;AAAuCC,IAAAA,YAAY,EAAC;AAApD,GAAL;AAA6D,QAAM1G,CAAC,GAACH,CAAC,CAAC0H,QAAF,IAAY,IAAI7C,CAAJ,EAApB;AAA0B,UAAM1E,CAAC,CAACwH,UAAR,KAAqBxH,CAAC,CAACwH,UAAF,GAAa,CAAC,CAAnC;AAAsC,QAAMrH,CAAC,GAACH,CAAC,CAACyH,aAAV;AAAwB,MAAIpH,CAAJ;AAAM,QAAME,CAAC,GAACkB,CAAC,CAACzB,CAAC,CAAC0H,MAAH,CAAT;;AAAoB,MAAGvH,CAAH,EAAK;AAAC,QAAGE,CAAC,GAAC;AAACsH,MAAAA,GAAG,EAACxH,CAAC,CAACwH;AAAP,KAAF,EAAc,eAAapH,CAAC,CAACqH,WAAF,EAAb,IAA8B,OAAKrH,CAApD,EAAsD;AAAC,YAAMV,CAAC,GAACM,CAAC,CAAC0H,KAAV;AAAA,YAAgB9H,CAAC,GAACI,CAAC,CAAC2H,MAApB;AAA2BzH,MAAAA,CAAC,CAAC0H,UAAF,GAAa,CAAClI,CAAD,EAAGE,CAAH,CAAb;AAAmB;AAAC;;AAAA,QAAMU,CAAC,GAACT,CAAC,CAACgI,aAAV;AAAwB,MAAIrH,CAAJ;;AAAM,MAAGF,CAAH,EAAK;AAAC,QAAIZ,CAAJ,EAAME,CAAN;AAAQ,gBAAUU,CAAC,CAACwH,YAAZ,IAA0B,iBAAexH,CAAC,CAACwH,YAA3C,IAAyDpI,CAAC,GAAC,YAAF,EAAeE,CAAC,GAAC,OAA1E,IAAmF,aAAWU,CAAC,CAACwH,YAAb,IAA2B,WAASxH,CAAC,CAACwH,YAAtC,KAAqDpI,CAAC,GAAC,QAAF,EAAWE,CAAC,GAAC,MAAlE,CAAnF,EAA6JY,CAAC,GAAC;AAACuH,MAAAA,SAAS,EAACzH,CAAC,CAACyH,SAAb;AAAuBC,MAAAA,UAAU,EAAC1H,CAAC,CAAC0H,UAApC;AAA+CC,MAAAA,aAAa,EAAC3H,CAAC,CAAC2H,aAA/D;AAA6EC,MAAAA,kBAAkB,EAAC5H,CAAC,CAAC4H,kBAAlG;AAAqHC,MAAAA,eAAe,EAAC;AAACC,QAAAA,UAAU,EAACpD,CAAC,CAAC5D,MAAF,CAAS1B,CAAT,CAAZ;AAAwB2I,QAAAA,WAAW,EAAC1D,CAAC,CAACjF,CAAD,CAArC;AAAyC4I,QAAAA,aAAa,EAACtD,CAAC,CAAC5D,MAAF,CAASxB,CAAT,CAAvD;AAAmE2I,QAAAA,cAAc,EAAC5D,CAAC,CAAC/E,CAAD;AAAnF;AAArI,KAA/J;AAA6X;;AAAA,MAAIc,CAAC,GAAC,IAAN;AAAWJ,EAAAA,CAAC,IAAEA,CAAC,CAACiG,YAAL,KAAoB7F,CAAC,GAACJ,CAAC,CAACiG,YAAF,CAAeiC,GAAf,CAAoB9I,CAAC,IAAE;AAACE,IAAAA,CAAC,CAAC0G,kBAAF,CAAqB5G,CAAC,CAAC+I,OAAvB,IAAgC/I,CAAC,CAACgJ,KAAlC;AAAwC,UAAM7I,CAAC,GAAC;AAACF,MAAAA,EAAE,EAACD,CAAC,CAAC+I;AAAN,KAAR;AAAuB,WAAO/I,CAAC,CAACiJ,WAAF,KAAgB9I,CAAC,CAAC8I,WAAF,GAAcjJ,CAAC,CAACiJ,WAAhC,GAA6C9I,CAApD;AAAsD,GAA7I,CAAtB;AAAuK,QAAMe,CAAC,GAAC,MAAMgI,CAAC,CAAClJ,CAAD,EAAGG,CAAH,EAAKD,CAAL,CAAf;;AAAuB,MAAGgB,CAAC,CAACiI,iBAAL,EAAuB;AAAC,UAAMnJ,CAAC,GAAC,IAAIoJ,MAAJ,CAAW,8FAAX,CAAR;AAAA,UAAmHjJ,CAAC,GAAC,iBAArH;AAAA,UAAuIG,CAAC,GAACJ,CAAC,IAAE;AAAC,YAAME,CAAC,GAACF,CAAC,CAACmJ,IAAV;AAAA,YAAe/I,CAAC,GAACJ,CAAC,CAACoJ,IAAnB;AAAA,YAAwB9I,CAAC,GAACF,CAAC,IAAEA,CAAC,CAACiJ,MAAL,IAAajJ,CAAC,CAACiJ,MAAF,CAASxB,WAAT,EAAvC;AAA8D3H,MAAAA,CAAC,IAAEE,CAAH,KAAO,YAAUE,CAAV,IAAa,uBAAqBA,CAAzC,MAA8CF,CAAC,CAACiJ,MAAF,GAASvJ,CAAC,CAACwJ,IAAF,CAAOpJ,CAAP,IAAU,kBAAV,GAA6B,OAAtC,EAA8C,aAAWE,CAAC,CAACmJ,KAAb,IAAoBtJ,CAAC,CAACqJ,IAAF,CAAOpJ,CAAP,CAApB,KAAgCE,CAAC,CAACiJ,MAAF,GAAS,kBAAzC,CAA5F;AAA0J,KAArW;AAAA,UAAsW/I,CAAC,GAAC,MAAI;AAAC,YAAM,IAAIJ,CAAJ,CAAM,mCAAN,EAA0C,qEAA1C,CAAN;AAAuH,KAApe;;AAAqec,IAAAA,CAAC,CAACiI,iBAAF,CAAoBO,OAApB,CAA6B1J,CAAC,IAAE;AAAC,UAAIG,CAAJ,EAAMC,CAAN,EAAQM,CAAR;AAAU,eAAOP,CAAC,GAACH,CAAC,CAAC2J,iBAAX,KAA+BxJ,CAAC,CAACyJ,MAAjC,GAAwC5J,CAAC,CAAC2J,iBAAF,CAAoBC,MAApB,CAA2BF,OAA3B,CAAoC1J,CAAC,IAAE;AAAC,YAAIG,CAAJ,EAAMC,CAAN,EAAQM,CAAR,EAAUE,CAAV;;AAAY,YAAG,SAAOT,CAAC,GAACH,CAAC,CAAC6J,eAAX,KAA6B,SAAOzJ,CAAC,GAACD,CAAC,CAAC2J,WAAX,CAA7B,IAAsD,SAAOpJ,CAAC,GAACN,CAAC,CAAC2J,QAAX,CAAtD,IAA4ErJ,CAAC,CAACsJ,MAAjF,EAAwF;AAAC,gBAAM7J,CAAC,GAACH,CAAC,CAAC6J,eAAF,CAAkBC,WAAlB,CAA8BC,QAAtC;AAA+C,uBAAW5J,CAAC,CAAC6J,MAAF,CAASC,IAApB,GAAyB3J,CAAC,CAACH,CAAC,CAAC6J,MAAH,CAA1B,GAAqC,yBAAuB7J,CAAC,CAAC6J,MAAF,CAASC,IAAhC,IAAsC/J,CAAC,CAACyG,YAAxC,IAAsDnG,CAAC,EAA5F;AAA+F;;AAAA,iBAAOI,CAAC,GAACZ,CAAC,CAACkK,UAAX,KAAwBtJ,CAAC,CAACuJ,QAA1B,IAAoCnK,CAAC,CAACkK,UAAF,CAAaC,QAAb,CAAsBT,OAAtB,CAA+B1J,CAAC,IAAE;AAACA,UAAAA,CAAC,CAACgK,MAAF,KAAW,aAAWhK,CAAC,CAACgK,MAAF,CAASC,IAApB,GAAyB3J,CAAC,CAACN,CAAC,CAACgK,MAAH,CAA1B,GAAqC,yBAAuBhK,CAAC,CAACgK,MAAF,CAASC,IAAhC,IAAsC/J,CAAC,CAACyG,YAAxC,IAAsDnG,CAAC,EAAvG;AAA2G,SAA9I,CAApC;AAAqL,OAAhd,CAAxC,GAA2f,CAACN,CAAC,CAACyG,YAAH,IAAiB,SAAOvG,CAAC,GAACJ,CAAC,CAAC6J,eAAX,CAAjB,IAA8C,SAAOnJ,CAAC,GAACN,CAAC,CAAC0J,WAAX,CAA9C,IAAuEpJ,CAAC,CAACqJ,QAAzE,IAAmFK,IAAI,CAACC,SAAL,CAAerK,CAAC,CAAC6J,eAAF,CAAkBC,WAAlB,CAA8BC,QAA7C,EAAuDO,QAAvD,CAAgE,6BAAhE,CAAnF,IAAmL9J,CAAC,EAA/qB;AAAkrB,KAA7tB;AAAguB;;AAAAR,EAAAA,CAAC,CAACuK,mBAAF,KAAwBrJ,CAAC,CAACsJ,UAAF,CAAaC,gBAAb,GAA8BzK,CAAC,CAACuK,mBAAF,CAAsB7I,MAAtB,EAAtD,GAAsFgJ,MAAM,CAACC,MAAP,CAAczJ,CAAd,EAAgB;AAAC0G,IAAAA,aAAa,EAACpH,CAAf;AAAiB2H,IAAAA,aAAa,EAACrH,CAAC,IAAE;AAAlC,GAAhB,CAAtF,EAA6I4J,MAAM,CAACC,MAAP,CAAczJ,CAAC,CAACiH,aAAhB,EAA8B;AAACyC,IAAAA,aAAa,EAAC;AAACzB,MAAAA,iBAAiB,EAAC,QAAMnI,CAAN,GAAQA,CAAR,GAAUd,CAAC,CAAC2G,YAAF,CAAegE,KAAf;AAA7B;AAAf,GAA9B,CAA7I,EAAiP3K,CAAC,CAAC2G,YAAF,CAAeiE,MAAf,GAAsB,CAAvQ,EAAyQ9E,CAAC,CAACgB,GAAF,CAAM9G,CAAC,CAACwG,WAAR,EAAoBxG,CAApB,CAAzQ;AAAgS,QAAMiB,CAAC,GAAC;AAAC4J,IAAAA,eAAe,EAACX,IAAI,CAACC,SAAL,CAAenJ,CAAf,CAAjB;AAAmC8J,IAAAA,MAAM,EAACrJ,CAAC,CAACxB,CAAC,CAAC8K,MAAH,CAA3C;AAAsDC,IAAAA,eAAe,EAACxK;AAAtE,GAAR;AAAiF,SAAOV,CAAC,CAACmL,eAAF,IAAmBT,MAAM,CAACC,MAAP,CAAcxJ,CAAd,EAAgBnB,CAAC,CAACmL,eAAlB,CAAnB,EAAsDhK,CAA7D;AAA+D;;AAAA,eAAe+H,CAAf,CAAiBlJ,CAAjB,EAAmBE,CAAnB,EAAqBC,CAArB,EAAuB;AAAC,QAAMC,CAAC,GAACJ,CAAC,CAACoL,IAAV;AAAe,MAAI9K,CAAC,GAACF,CAAC,CAACqK,gBAAR;AAAyB,QAAM/J,CAAC,GAAC;AAACyI,IAAAA,iBAAiB,EAAC,MAAMkC,EAAE,CAACjL,CAAD,EAAGF,CAAH,EAAKC,CAAL;AAA3B,GAAR;AAA4C,MAAIS,CAAC,GAACT,CAAC,CAACmL,QAAF,IAAYtL,CAAC,CAACuL,MAAd,IAAsBnL,CAAC,CAACmL,MAA9B;;AAAqC,MAAGjL,CAAC,IAAEA,CAAC,CAACkL,WAAL,KAAmB5K,CAAC,GAACA,CAAC,CAAC6K,KAAF,GAAUC,UAAV,CAAqB,CAAC,CAAtB,CAAF,EAA2BpL,CAAC,GAACM,CAAC,CAAC6J,gBAAlD,GAAoE/J,CAAC,CAAC8J,UAAF,GAAa;AAACe,IAAAA,MAAM,EAAC3K,CAAC,IAAEA,CAAC,CAACc,MAAF,EAAX;AAAsB+I,IAAAA,gBAAgB,EAACnK,CAAC,IAAEA,CAAC,CAACoB,MAAF,EAA1C;AAAqDiK,IAAAA,eAAe,EAACzL,CAAC,CAAC0L;AAAvE,GAAjF,EAA4KzL,CAAC,CAACmL,QAAF,GAAW,IAAvL,EAA4LlL,CAAC,CAACyL,UAAF,KAAenL,CAAC,CAACmL,UAAF,GAAazL,CAAC,CAACyL,UAAF,CAAanK,MAAb,EAA5B,CAA5L,EAA+OtB,CAAC,CAAC0L,QAAF,KAAapL,CAAC,CAAC8J,UAAF,CAAasB,QAAb,GAAsB,CAAC1L,CAAC,CAAC0L,QAAtC,CAA/O,EAA+R5L,CAAC,CAAC6L,cAAF,KAAmBrL,CAAC,CAAC8J,UAAF,CAAawB,KAAb,GAAmB9L,CAAC,CAAC+L,QAAF,IAAY7L,CAAC,CAAC4L,KAApD,CAA/R,EAA0V5L,CAAC,CAAC8L,UAA/V,EAA0W;AAAC,UAAMlM,CAAC,GAACQ,CAAC,CAACJ,CAAC,CAAC8L,UAAF,CAAaC,KAAd,CAAD,GAAsB/L,CAAC,CAAC8L,UAAF,CAAaC,KAAb,CAAmBC,OAAnB,EAAtB,GAAmD,IAA3D;AAAA,UAAgElM,CAAC,GAACM,CAAC,CAACJ,CAAC,CAAC8L,UAAF,CAAaG,GAAd,CAAD,GAAoBjM,CAAC,CAAC8L,UAAF,CAAaG,GAAb,CAAiBD,OAAjB,EAApB,GAA+C,IAAjH;AAAsH1L,IAAAA,CAAC,CAAC8J,UAAF,CAAa8B,IAAb,GAAkB,CAACtM,CAAD,EAAGE,CAAH,CAAlB;AAAwB;;AAAA,SAAOQ,CAAP;AAAS;;AAAA,SAASyF,CAAT,CAAWnG,CAAX,EAAa;AAAC,MAAIE,CAAC,GAACF,CAAN;AAAQ,QAAMG,CAAC,GAACD,CAAC,CAACqM,WAAF,CAAc,YAAd,CAAR;AAAoC,SAAOpM,CAAC,GAAC,CAAF,KAAMD,CAAC,GAACA,CAAC,CAAC2K,KAAF,CAAQ,CAAR,EAAU1K,CAAC,GAAC,CAAZ,CAAR,GAAwBD,CAA/B;AAAiC;;AAAA,eAAemL,EAAf,CAAkBrL,CAAlB,EAAoBE,CAApB,EAAsBC,CAAtB,EAAwB;AAAC,QAAMC,CAAC,GAAC,EAAR;AAAA,QAAWE,CAAC,GAAC;AAACkM,IAAAA,SAAS,EAAC,IAAX;AAAgBC,IAAAA,aAAa,EAACvM,CAA9B;AAAgCkL,IAAAA,IAAI,EAACpL;AAArC,GAAb;AAAqD,MAAIQ,CAAC,GAAC,CAAN;AAAQN,EAAAA,CAAC,CAAC6L,cAAF,KAAmBvL,CAAC,GAACN,CAAC,CAAC+L,QAAF,IAAYjM,CAAC,CAACgM,KAAnC;AAA0C,QAAMtL,CAAC,GAACoB,CAAC,CAAC9B,CAAD,EAAGQ,CAAH,CAAT;;AAAe,OAAI,MAAMI,CAAV,IAAeF,CAAf,EAAiB;AAAC,UAAMV,CAAC,GAACY,CAAC,CAAC8L,KAAV;AAAgB,QAAG,CAAC1M,CAAC,CAAC2M,MAAH,IAAW3K,CAAC,CAAChC,CAAD,CAAf,EAAmB;AAAS,QAAIE,CAAJ;AAAMI,IAAAA,CAAC,CAACkM,SAAF,GAAY5L,CAAZ,EAAcV,CAAC,GAACgC,CAAC,CAAClC,CAAD,CAAD,GAAK4M,EAAE,CAAC5M,CAAD,CAAP,GAAWoC,CAAC,CAACpC,CAAD,CAAD,GAAK,MAAM6M,EAAE,CAAC7M,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqBmC,CAAC,CAACtC,CAAD,CAAD,GAAK,MAAM8M,EAAE,CAAC9M,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqBqC,CAAC,CAACxC,CAAD,CAAD,GAAK,MAAM+M,EAAE,CAAC/M,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqBuC,CAAC,CAAC1C,CAAD,CAAD,GAAK,MAAMgN,EAAE,CAAChN,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqByC,CAAC,CAAC5C,CAAD,CAAD,GAAKiN,EAAE,CAACjN,CAAD,EAAGG,CAAH,CAAP,GAAa2C,CAAC,CAAC9C,CAAD,CAAD,GAAK,MAAMkN,EAAE,CAAClN,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqB6C,CAAC,CAAChD,CAAD,CAAD,GAAKmN,EAAE,CAACnN,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAP,GAAe+C,CAAC,CAAClD,CAAD,CAAD,GAAK,MAAMoN,EAAE,CAAC9M,CAAD,EAAGH,CAAH,CAAb,GAAmBiD,CAAC,CAACpD,CAAD,CAAD,GAAKqN,EAAE,EAAP,GAAU/J,CAAC,CAACtD,CAAD,CAAD,GAAK,MAAMsN,EAAE,CAACtN,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqBqD,CAAC,CAACxD,CAAD,CAAD,GAAKuN,EAAE,CAACvN,CAAD,CAAP,GAAW0D,CAAC,CAAC1D,CAAD,CAAD,GAAK,MAAMwN,EAAE,CAACxN,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAAb,GAAqByD,CAAC,CAAC5D,CAAD,CAAD,GAAKyN,EAAE,CAACzN,CAAD,CAAP,GAAW8D,CAAC,CAAC9D,CAAD,CAAD,GAAK0N,EAAE,CAAC1N,CAAD,CAAP,GAAWgE,CAAC,CAAChE,CAAD,CAAD,GAAK2N,EAAE,CAAC3N,CAAD,CAAP,GAAW,MAAM4N,EAAE,CAAC5N,CAAD,EAAGM,CAAH,EAAKH,CAAL,CAA3R,EAAmSD,CAAC,KAAG2N,KAAK,CAACC,OAAN,CAAc5N,CAAd,IAAiBE,CAAC,CAAC2N,IAAF,CAAO,GAAG7N,CAAV,CAAjB,IAA+BA,CAAC,CAACD,EAAF,GAAKD,CAAC,CAACC,EAAP,EAAUC,CAAC,CAAC8I,KAAF,GAAQ7I,CAAC,CAACyG,kBAAF,CAAqB5G,CAAC,CAACC,EAAvB,KAA4BD,CAAC,CAACgJ,KAAhD,EAAsD9I,CAAC,CAAC8N,OAAF,GAAUhO,CAAC,CAACgO,OAAlE,EAA0E9N,CAAC,CAAC+N,QAAF,GAAWjO,CAAC,CAACiO,QAAF,IAAY,CAAjG,EAAmG/N,CAAC,CAACgO,QAAF,GAAWlO,CAAC,CAACkO,QAAF,IAAY,CAA1H,EAA4H9N,CAAC,CAAC2N,IAAF,CAAO7N,CAAP,CAA3J,CAAH,CAApS;AAA8c;;AAAA,MAAGM,CAAC,IAAEJ,CAAC,CAACsJ,OAAF,CAAW1J,CAAC,IAAE;AAACA,IAAAA,CAAC,CAACiO,QAAF,GAAW,CAAX,EAAajO,CAAC,CAACkO,QAAF,GAAW,CAAxB;AAA0B,GAAzC,CAAH,EAA+ClO,CAAC,CAACmO,QAAF,IAAYnO,CAAC,CAACmO,QAAF,CAAWrD,MAAzE,EAAgF;AAAC,UAAMxK,CAAC,GAAC,MAAM8N,EAAE,CAAC,IAAD,EAAMpO,CAAC,CAACmO,QAAR,EAAiBjO,CAAjB,EAAmBC,CAAnB,CAAhB;AAAsCG,IAAAA,CAAC,IAAEF,CAAC,CAAC2N,IAAF,CAAOzN,CAAP,CAAH;AAAa;;AAAA,SAAOF,CAAP;AAAS;;AAAA,SAASwM,EAAT,CAAY5M,CAAZ,EAAc;AAAC,SAAM;AAACqO,IAAAA,OAAO,EAACrO,CAAC,CAACqO,OAAX;AAAmBC,IAAAA,GAAG,EAACtO,CAAC,CAACsO,GAAzB;AAA6BrE,IAAAA,IAAI,EAAC,cAAY,aAAWjK,CAAC,CAACyJ,KAAb,GAAmB,QAAnB,GAA4B,aAAWzJ,CAAC,CAACyJ,KAAb,GAAmB,QAAnB,GAA4B,MAApE;AAAlC,GAAN;AAAqH;;AAAA,eAAeoD,EAAf,CAAkB7M,CAAlB,EAAoB;AAACwM,EAAAA,SAAS,EAACtM,CAAX;AAAauM,EAAAA,aAAa,EAACtM;AAA3B,CAApB,EAAkDC,CAAlD,EAAoD;AAAC,MAAIE,CAAJ;;AAAM,MAAGF,CAAC,CAACyG,YAAF,IAAgBzG,CAAC,CAACyG,YAAF,CAAekH,IAAf,CAAoB;AAAC9N,IAAAA,EAAE,EAACD,CAAC,CAACC;AAAN,GAApB,CAAhB,EAA+C,CAACG,CAAC,CAACuG,YAArD,EAAkE;AAAC,WAAOyH,EAAE,CAACpO,CAAD,EAAG,MAAMuO,EAAE,CAACrO,CAAD,CAAX,EAAeC,CAAf,EAAiBC,CAAjB,CAAT;AAA6B;;AAAA,SAAOE,CAAC,GAAC;AAAC2J,IAAAA,IAAI,EAAC;AAAN,GAAF,EAAejK,CAAC,CAACwO,KAAF,CAAQlO,CAAR,EAAU;AAACmO,IAAAA,MAAM,EAAC;AAAR,GAAV,CAAf,EAA6C,OAAOnO,CAAC,CAACoO,SAAtD,EAAgE,OAAOpO,CAAC,CAACqO,SAAzE,EAAmFrO,CAAC,CAACqH,UAAF,GAAaxH,CAAC,CAACwH,UAAF,IAAc3H,CAAC,CAAC4O,aAAhH,EAA8HtO,CAArI;AAAuI;;AAAA,eAAe8N,EAAf,CAAkBpO,CAAlB,EAAoBE,CAApB,EAAsBC,CAAtB,EAAwBC,CAAxB,EAA0B;AAAC,MAAIE,CAAJ;AAAM,QAAME,CAAC,GAAC8D,CAAC,EAAT;AAAA,QAAY5D,CAAC,GAAC8D,CAAC,EAAf;AAAA,QAAkB5D,CAAC,GAAC8D,CAAC,EAArB;AAAA,QAAwB5D,CAAC,GAAC8D,CAAC,EAA3B;AAAA,QAA8B5D,CAAC,GAAC0D,CAAC,EAAjC;;AAAoC,MAAG1D,CAAC,CAAC6I,eAAF,CAAkBgF,IAAlB,GAAuB,WAAvB,EAAmC,OAAO7N,CAAC,CAAC6I,eAAF,CAAkBC,WAA5D,EAAwE9J,CAA3E,EAA6E;AAAC,QAAG,+BAA6BA,CAAC,CAAC8O,aAA/B,IAA8C,8BAA4B9O,CAAC,CAAC8O,aAA5E,GAA0FtO,CAAC,CAACqJ,eAAF,CAAkBgF,IAAlB,GAAuBnO,CAAC,CAACmJ,eAAF,CAAkBgF,IAAlB,GAAuBjO,CAAC,CAACiJ,eAAF,CAAkBgF,IAAlB,GAAuB/N,CAAC,CAAC+I,eAAF,CAAkBgF,IAAlB,GAAuBzO,CAAC,CAACwG,kBAAF,CAAqB5G,CAAC,CAACC,EAAvB,KAA4BD,CAAC,CAACoG,GAAF,CAAM,mBAAN,CAA5B,IAAwDpG,CAAC,CAACgJ,KAAhP,GAAsP,gCAA8BhJ,CAAC,CAAC8O,aAAhC,KAAgD5O,CAAC,GAACF,CAAC,CAACmO,QAAF,CAAWY,KAA7D,CAAtP,EAA0T/O,CAAC,CAAC+J,QAA/T,EAAwU;AAAC,YAAM7J,CAAC,GAACF,CAAC,CAAC+J,QAAF,CAAWrI,MAAX,EAAR;AAA4BlB,MAAAA,CAAC,CAACqJ,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,GAAuC7J,CAAvC,EAAyCQ,CAAC,CAACmJ,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,GAAuC7J,CAAhF,EAAkFU,CAAC,CAACiJ,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,GAAuC7J,CAAzH,EAA2HY,CAAC,CAAC+I,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,GAAuC7J,CAAlK;AAAoK;;AAAA,QAAGC,CAAC,CAACwH,UAAF,IAAc3H,CAAC,CAAC4O,aAAhB,IAA+B,cAAY,OAAO5O,CAAC,CAACwO,KAAvD,EAA6D;AAAC,UAAItN,CAAJ,EAAMG,CAAN;AAAQ,YAAMnB,CAAC,GAAC,SAAOgB,CAAC,GAAClB,CAAC,CAACwO,KAAF,CAAQ,EAAR,EAAW;AAACC,QAAAA,MAAM,EAAC;AAAR,OAAX,EAA+B5E,eAAxC,KAA0D,SAAOxI,CAAC,GAACH,CAAC,CAAC4I,WAAX,CAA1D,GAAkF,KAAK,CAAvF,GAAyFzI,CAAC,CAAC2N,YAAnG;AAAgH9O,MAAAA,CAAC,KAAGI,CAAC,GAAC,CAAC,CAAH,EAAKE,CAAC,CAACqJ,eAAF,CAAkBC,WAAlB,CAA8BkF,YAA9B,GAA2C9O,CAAhD,EAAkDQ,CAAC,CAACmJ,eAAF,CAAkBC,WAAlB,CAA8BkF,YAA9B,GAA2C9O,CAA7F,EAA+FU,CAAC,CAACiJ,eAAF,CAAkBC,WAAlB,CAA8BkF,YAA9B,GAA2C9O,CAA1I,EAA4IY,CAAC,CAAC+I,eAAF,CAAkBC,WAAlB,CAA8BkF,YAA9B,GAA2C9O,CAA1L,CAAD;AAA8L;AAAC;;AAAA,MAAIqB,CAAJ;AAAM,UAAMvB,CAAN,IAASA,CAAC,CAAC+J,QAAX,IAAqBzJ,CAArB,KAAyB,OAAOE,CAAC,CAACqJ,eAAF,CAAkBC,WAAzB,EAAqC,OAAOpJ,CAAC,CAACmJ,eAAF,CAAkBC,WAA9D,EAA0E,OAAOlJ,CAAC,CAACiJ,eAAF,CAAkBC,WAAnG,EAA+G,OAAOhJ,CAAC,CAAC+I,eAAF,CAAkBC,WAAjK;AAA8K,QAAMrI,CAAC,GAAC,QAAMzB,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACiP,WAAzB;AAAA,QAAqCtN,CAAC,GAAC,QAAM3B,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAAC+J,QAAxD;;AAAiE,MAAGtI,CAAH,EAAK;AAAC,QAAGE,CAAC,IAAE,cAAY,OAAOA,CAAC,CAACuN,qBAA3B,EAAiD;AAAC,YAAMlP,CAAC,GAAC,IAAImP,GAAJ,EAAR;AAAgB,YAAMxN,CAAC,CAACuN,qBAAF,CAAwBlP,CAAxB,EAA0ByB,CAA1B,CAAN,EAAmCF,CAAC,GAACsM,KAAK,CAACuB,IAAN,CAAWpP,CAAX,CAArC;AAAmD;;AAAA,UAAMA,CAAC,GAACyB,CAAC,CAAC4N,MAAF,CAASvG,GAAT,CAAc9I,CAAC,IAAEA,CAAC,CAAC0B,MAAF,EAAjB,CAAR;AAAsClB,IAAAA,CAAC,CAACqJ,eAAF,CAAkBwF,MAAlB,GAAyBrP,CAAzB,EAA2BU,CAAC,CAACmJ,eAAF,CAAkBwF,MAAlB,GAAyBrP,CAApD,EAAsDY,CAAC,CAACiJ,eAAF,CAAkBwF,MAAlB,GAAyBrP,CAA/E,EAAiFc,CAAC,CAAC+I,eAAF,CAAkBwF,MAAlB,GAAyBrP,CAA1G;AAA4G;;AAAA,QAAM4B,CAAC,GAAC1B,CAAC,IAAEA,CAAC,CAAC4K,MAAb;AAAoB,MAAIhJ,CAAJ;;AAAM,OAAI,IAAII,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACN,CAAd,EAAgBM,CAAC,EAAjB,EAAoB;AAAC,UAAM5B,CAAC,GAACJ,CAAC,CAACgC,CAAD,CAAD,IAAMhC,CAAC,CAACoP,SAAF,CAAYpN,CAAZ,CAAd;AAA6B,QAAG,CAAC,CAAD,KAAK5B,CAAC,CAACiP,OAAP,IAAgB,CAACjP,CAAC,CAACkP,QAAtB,EAA+B;AAAS,QAAG1N,CAAC,GAACxB,CAAC,CAACoB,MAAF,EAAF,EAAaI,CAAC,CAAC2N,cAAF,CAAiB,eAAjB,KAAmC,OAAO3N,CAAC,CAAC4N,aAAzD,EAAuE5N,CAAC,CAAC0N,QAAF,IAAY1N,CAAC,CAAC0N,QAAF,CAAW3K,CAAvB,IAA0B,OAAO/C,CAAC,CAAC0N,QAAF,CAAW3K,CAAnH,EAAqH/C,CAAC,CAACkI,MAAF,IAAUlI,CAAC,CAACkI,MAAF,CAAS2F,OAAnB,IAA4B,cAAY7N,CAAC,CAACkI,MAAF,CAAS2F,OAAT,CAAiB1F,IAAzD,IAA+D,CAAC7J,CAAC,CAACuG,YAA1L,EAAuM;AAAS,KAACvG,CAAC,CAACuG,YAAH,IAAiB7E,CAAC,CAACkI,MAAnB,IAA2BlI,CAAC,CAACkI,MAAF,CAAS2F,OAApC,IAA6C7N,CAAC,CAACkI,MAAF,CAAS2F,OAAT,CAAiBC,KAA9D,IAAqE9N,CAAC,CAACkI,MAAF,CAAS2F,OAAT,CAAiBC,KAAjB,CAAuB,CAAvB,CAArE,KAAiG9N,CAAC,CAACkI,MAAF,CAAS2F,OAAT,CAAiBC,KAAjB,CAAuB,CAAvB,IAA0B,GAA3H;AAAgI,UAAM1O,CAAC,GAAClB,CAAC,IAAEA,CAAC,CAAC+J,QAAL,KAAgB,qBAAoB/J,CAAC,CAAC+J,QAAtB,IAAgC/J,CAAC,CAAC+J,QAAF,CAAW8F,eAA3C,IAA4D,wBAAuB7P,CAAC,CAAC+J,QAAzB,IAAmC/J,CAAC,CAAC+J,QAAF,CAAW+F,kBAAX,EAA/G,CAAR;;AAAwJ,QAAG,CAAChO,CAAC,CAACkI,MAAH,IAAWhK,CAAX,IAAcA,CAAC,CAAC+J,QAAhB,IAA0B7I,CAA1B,IAA6B,CAACd,CAAC,CAACuG,YAAnC,EAAgD;AAAC,YAAMzG,CAAC,GAACF,CAAC,CAAC+J,QAAV;AAAA,YAAmB5J,CAAC,GAAC,MAAMD,CAAC,CAAC6P,cAAF,CAAiBzP,CAAjB,CAA3B;AAA+C,UAAG,CAACH,CAAJ,EAAM;AAAS2B,MAAAA,CAAC,CAACkI,MAAF,GAAS7J,CAAC,CAACuB,MAAF,EAAT,EAAoB,wBAAuBxB,CAAvB,IAA0BA,CAAC,CAAC4P,kBAAF,EAA1B,IAAkD5L,CAAC,CAACpC,CAAC,CAACkI,MAAH,EAAU;AAACD,QAAAA,QAAQ,EAAC7J,CAAV;AAAY8P,QAAAA,OAAO,EAAC1P,CAApB;AAAsB0J,QAAAA,MAAM,EAAC7J;AAA7B,OAAV,CAAvE;AAAkH;;AAAA,QAAG2B,CAAC,CAACkI,MAAF,KAAWlI,CAAC,CAACkI,MAAF,CAASiG,KAAT,IAAgB,OAAOnO,CAAC,CAACkI,MAAF,CAASiG,KAAhC,EAAsCC,EAAE,CAACpO,CAAC,CAACkI,MAAH,CAAF,GAAalI,CAAC,CAACkI,MAAF,GAAS,MAAMmG,EAAE,CAACrO,CAAC,CAACkI,MAAH,EAAU5J,CAAV,CAA9B,GAA2C0B,CAAC,CAACkI,MAAF,CAASX,IAAT,IAAe,OAAOvH,CAAC,CAACsO,UAApH,GAAgI,CAAC,CAACjQ,CAAD,IAAI,CAACA,CAAC,CAACkQ,sBAAR,KAAiC9O,CAAjC,IAAoCA,CAAC,CAACuJ,MAAzK,EAAgL;AAAC,YAAM9K,CAAC,GAAC,EAAR;AAAWuB,MAAAA,CAAC,CAACmI,OAAF,CAAWxJ,CAAC,IAAE;AAAC4B,QAAAA,CAAC,CAACsO,UAAF,IAActO,CAAC,CAACsO,UAAF,CAAaX,cAAb,CAA4BvP,CAA5B,CAAd,KAA+CF,CAAC,CAACE,CAAD,CAAD,GAAK4B,CAAC,CAACsO,UAAF,CAAalQ,CAAb,CAApD;AAAqE,OAApF,GAAuF4B,CAAC,CAACsO,UAAF,GAAapQ,CAApG;AAAsG;;AAAA,kBAAYM,CAAC,CAACkP,QAAF,CAAWvF,IAAvB,GAA4BzJ,CAAC,CAAC0J,UAAF,CAAaC,QAAb,CAAsB4D,IAAtB,CAA2BjM,CAA3B,CAA5B,GAA0D,eAAaxB,CAAC,CAACkP,QAAF,CAAWvF,IAAxB,GAA6BvJ,CAAC,CAACwJ,UAAF,CAAaC,QAAb,CAAsB4D,IAAtB,CAA2BjM,CAA3B,CAA7B,GAA2D,YAAUxB,CAAC,CAACkP,QAAF,CAAWvF,IAArB,GAA0BnI,CAAC,CAACkI,MAAF,IAAUlI,CAAC,CAACkI,MAAF,CAASX,IAAnB,GAAwBrI,CAAC,CAACkJ,UAAF,CAAaC,QAAb,CAAsB4D,IAAtB,CAA2BjM,CAA3B,CAAxB,GAAsDlB,CAAC,CAACsJ,UAAF,CAAaC,QAAb,CAAsB4D,IAAtB,CAA2BjM,CAA3B,CAAhF,GAA8G,iBAAexB,CAAC,CAACkP,QAAF,CAAWvF,IAA1B,GAA+BnJ,CAAC,CAACoJ,UAAF,CAAaC,QAAb,CAAsB4D,IAAtB,CAA2BjM,CAA3B,CAA/B,GAA6D,aAAWxB,CAAC,CAACkP,QAAF,CAAWvF,IAAtB,KAA6BnI,CAAC,CAAC0N,QAAF,GAAWrO,CAAC,CAACmP,UAAF,CAAahQ,CAAC,CAACkP,QAAf,EAAyB9N,MAAzB,EAAX,EAA6ClB,CAAC,CAAC0J,UAAF,CAAaC,QAAb,CAAsB4D,IAAtB,CAA2BjM,CAA3B,CAA1E,CAAhS;AAAyY;;AAAA,QAAME,CAAC,GAAC,CAACxB,CAAD,EAAGE,CAAH,EAAKI,CAAL,EAAOF,CAAP,EAASI,CAAT,EAAYuP,MAAZ,CAAoBvQ,CAAC,IAAEA,CAAC,CAACkK,UAAF,CAAaC,QAAb,CAAsBW,MAAtB,GAA6B,CAApD,CAAR;;AAAgE,OAAI,MAAM3J,CAAV,IAAea,CAAf,EAAiB;AAAC,UAAMhC,CAAC,GAACmB,CAAC,CAAC+I,UAAF,CAAaC,QAAb,CAAsBqG,KAAtB,CAA6BxQ,CAAC,IAAEA,CAAC,CAACgK,MAAlC,CAAR;AAAmD,KAAChK,CAAD,IAAIG,CAAC,IAAEA,CAAC,CAACkQ,sBAAT,IAAiClP,CAAC,CAAC+I,UAAF,CAAaC,QAAb,CAAsBT,OAAtB,CAA+B1J,CAAC,IAAE;AAAC,aAAOA,CAAC,CAACoQ,UAAT;AAAoB,KAAvD,CAAjC,EAA2FpQ,CAAC,IAAE,OAAOmB,CAAC,CAAC0I,eAAF,CAAkBC,WAAvH,EAAmI3I,CAAC,CAAC0I,eAAF,CAAkBC,WAAlB,IAA+B3I,CAAC,CAAC0I,eAAF,CAAkBC,WAAlB,CAA8BC,QAA7D,KAAuE,MAAM0G,EAAE,CAACtP,CAAC,CAAC0I,eAAF,CAAkBC,WAAlB,CAA8BC,QAA/B,EAAwC3J,CAAxC,CAA/E,CAAnI;AAA6P;;AAAA,SAAO4B,CAAC,CAAC8I,MAAF,GAAS;AAACnB,IAAAA,iBAAiB,EAAC;AAACC,MAAAA,MAAM,EAAC5H;AAAR,KAAnB;AAA8B2F,IAAAA,UAAU,EAACrH;AAAzC,GAAT,GAAqD,IAA5D;AAAiE;;AAAA,eAAewM,EAAf,CAAkB9M,CAAlB,EAAoBE,CAApB,EAAsBC,CAAtB,EAAwB;AAAC,MAAIC,CAAJ,EAAME,CAAN;AAAQ,MAAIE,CAAJ;AAAML,EAAAA,CAAC,CAAC0G,YAAF,IAAgB1G,CAAC,CAAC0G,YAAF,CAAekH,IAAf,CAAoB;AAAC9N,IAAAA,EAAE,EAACD,CAAC,CAACC;AAAN,GAApB,CAAhB;AAA+C,QAAMS,CAAC,GAACV,CAAC,CAAC+J,QAAV;AAAmB,MAAG/J,CAAC,CAAC0Q,gBAAF,IAAoBhQ,CAAC,IAAE,kBAAgBA,CAAC,CAACuJ,IAArB,KAA4B,CAAC9J,CAAC,CAACwG,YAAH,IAAiBgK,UAAU,CAACxQ,CAAC,CAAC4G,UAAH,CAAV,GAAyB,GAAtE,CAAvB,EAAkG,OAAO6G,EAAE,CAAC5N,CAAD,EAAGE,CAAH,EAAKC,CAAL,CAAT;AAAiB,QAAK;AAACqM,IAAAA,SAAS,EAAC5L,CAAX;AAAa6L,IAAAA,aAAa,EAAC3L,CAA3B;AAA6BsK,IAAAA,IAAI,EAACpK;AAAlC,MAAqCd,CAA1C;AAAA,QAA4CgB,CAAC,GAACR,CAAC,KAAG,qBAAoBA,CAApB,IAAuBA,CAAC,CAACmP,eAAzB,IAA0C,wBAAuBnP,CAAvB,IAA0BA,CAAC,CAACoP,kBAAF,EAAvE,CAA/C;AAAA,QAA8I3O,CAAC,GAAC,qBAAmB,SAAOf,CAAC,GAACJ,CAAC,CAAC4Q,MAAX,IAAmB,KAAK,CAAxB,GAA0BxQ,CAAC,CAAC6J,IAA/C,KAAsD,mBAAiB,SAAO3J,CAAC,GAACN,CAAC,CAAC4Q,MAAX,IAAmB,KAAK,CAAxB,GAA0BtQ,CAAC,CAAC2J,IAA7C,CAAtM;;AAAyP,MAAG,CAAC9J,CAAC,CAACwG,YAAH,IAAiBzF,CAAjB,IAAoBlB,CAAC,CAAC0Q,gBAAtB,IAAwCvP,CAAxC,IAA2C,CAACT,CAA5C,IAA+C,WAAUA,CAAV,IAAa,QAAMA,CAAC,CAACmQ,KAArB,KAA6B,YAAU,OAAOnQ,CAAC,CAACmQ,KAAnB,IAA0B,CAAC7Q,CAAC,CAAC8Q,QAAF,CAAWpQ,CAAC,CAACmQ,KAAb,CAAxD,CAAlD,EAA+H;AAAC,UAAM3Q,CAAC,GAAC,MAAMqO,EAAE,CAAC3N,CAAD,CAAhB;AAAoBJ,IAAAA,CAAC,GAAC,MAAM4N,EAAE,CAACpO,CAAD,EAAGE,CAAH,EAAKY,CAAL,EAAOX,CAAP,CAAV;AAAoB,GAAxK,MAA4K;AAAC,QAAIoB,CAAJ,EAAME,CAAN;;AAAQ,QAAGjB,CAAC,GAAC;AAACP,MAAAA,EAAE,EAAC,CAAC0B,CAAC,GAAC3B,CAAC,CAACwO,KAAF,EAAH,EAAcvO,EAAlB;AAAqB+I,MAAAA,KAAK,EAACrH,CAAC,CAACqH,KAA7B;AAAmCgF,MAAAA,OAAO,EAACrM,CAAC,CAACqM,OAA7C;AAAqDC,MAAAA,QAAQ,EAACtM,CAAC,CAACsM,QAAhE;AAAyEC,MAAAA,QAAQ,EAACvM,CAAC,CAACuM,QAApF;AAA6F6C,MAAAA,GAAG,EAACpP,CAAC,CAACoP,GAAnG;AAAuGlH,MAAAA,eAAe,EAAClI,CAAC,CAACkI;AAAzH,KAAF,EAA4IrJ,CAAC,CAACmH,UAAF,GAAa7G,CAAC,CAAC6G,UAAF,IAAc3H,CAAC,CAAC4O,aAAzK,EAAuLoC,EAAE,CAACxQ,CAAD,EAAGR,CAAH,CAAzL,EAA+L,SAAOuB,CAAC,GAACf,CAAC,CAACqJ,eAAX,KAA6B,SAAOpI,CAAC,GAACF,CAAC,CAACuI,WAAX,CAA7B,IAAsDrI,CAAC,CAACsI,QAAxD,KAAmE,OAAOvJ,CAAC,CAACqJ,eAAF,CAAkBoE,QAAzB,EAAkC,OAAOzN,CAAC,CAACqJ,eAAF,CAAkBqE,QAA3D,EAAoE,MAAMuC,EAAE,CAACjQ,CAAC,CAACqJ,eAAF,CAAkBC,WAAlB,CAA8BC,QAA/B,EAAwC5J,CAAxC,CAA5E,EAAuH,qBAAoBO,CAApB,IAAuBA,CAAC,CAACuQ,eAAzB,IAA0CvQ,CAAC,CAACuQ,eAAF,CAAkB,CAAlB,CAApO,CAAlM,EAA4b;AAAC,YAAMjR,CAAC,GAACU,CAAC,CAACuQ,eAAF,CAAkB,CAAlB,CAAR;;AAA6B,UAAG,WAASjR,CAAC,CAACiK,IAAX,IAAiBjK,CAAC,CAACkR,OAAnB,IAA4B,YAAU,OAAOlR,CAAC,CAACkR,OAA/C,IAAwDlR,CAAC,CAACmR,OAA1D,IAAmE,YAAU,OAAOnR,CAAC,CAACmR,OAAzF,EAAiG;AAAC,cAAMjR,CAAC,GAACmB,CAAC,CAACrB,CAAD,EAAGgB,CAAC,CAACgL,KAAL,CAAT;AAAqBxL,QAAAA,CAAC,CAACqJ,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,CAAuCkH,eAAvC,CAAuD,CAAvD,EAA0DE,OAA1D,GAAkEjR,CAAC,CAACiR,OAApE,EAA4E3Q,CAAC,CAACqJ,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,CAAuCkH,eAAvC,CAAuD,CAAvD,EAA0DC,OAA1D,GAAkEhR,CAAC,CAACgR,OAAhJ;AAAwJ;AAAC;AAAC;;AAAA,MAAIvP,CAAJ;AAAM,SAAOnB,CAAP;AAAS;;AAAA,eAAeuM,EAAf,CAAkB/M,CAAlB,EAAoB;AAACwM,EAAAA,SAAS,EAACtM,CAAX;AAAauM,EAAAA,aAAa,EAACtM;AAA3B,CAApB,EAAkDC,CAAlD,EAAoD;AAACA,EAAAA,CAAC,CAACyG,YAAF,IAAgBzG,CAAC,CAACyG,YAAF,CAAekH,IAAf,CAAoB;AAAC9N,IAAAA,EAAE,EAACD,CAAC,CAACC;AAAN,GAApB,CAAhB;AAA+C,SAAOmO,EAAE,CAACpO,CAAD,EAAG,MAAMuO,EAAE,CAACrO,CAAD,CAAX,EAAeC,CAAf,EAAiBC,CAAjB,CAAT;AAA6B;;AAAA,eAAe4M,EAAf,CAAkBhN,CAAlB,EAAoB;AAACyM,EAAAA,aAAa,EAACvM;AAAf,CAApB,EAAsCC,CAAtC,EAAwC;AAAC,SAAOiO,EAAE,CAACpO,CAAD,EAAG,IAAH,EAAQE,CAAR,EAAUC,CAAV,CAAT;AAAsB;;AAAA,SAAS8M,EAAT,CAAYjN,CAAZ,EAAcE,CAAd,EAAgB;AAACA,EAAAA,CAAC,CAAC2G,YAAF,IAAgB3G,CAAC,CAAC2G,YAAF,CAAekH,IAAf,CAAoB;AAAC9N,IAAAA,EAAE,EAACD,CAAC,CAACC;AAAN,GAApB,CAAhB;AAA+C,QAAME,CAAC,GAAC;AAACiR,IAAAA,OAAO,EAACpR,CAAC,CAACoR,OAAX;AAAmBC,IAAAA,kBAAkB,EAACrR,CAAC,CAACqR,kBAAxC;AAA2DpG,IAAAA,MAAM,EAACjL,CAAC,CAACiL,MAApE;AAA2EqG,IAAAA,aAAa,EAACtR,CAAC,CAACsR;AAA3F,GAAR;AAAkH,MAAG,CAACtR,CAAC,CAACuR,UAAF,IAAcvR,CAAC,CAACwR,oBAAjB,MAAyCrR,CAAC,CAACoR,UAAF,GAAavR,CAAC,CAACyR,4BAAF,CAA+BF,UAA/B,CAA0C7P,MAA1C,EAAtD,GAA0G1B,CAAC,CAAC0R,aAAF,IAAiB1R,CAAC,CAAC+J,QAAhI,EAAyI,IAAG7J,CAAC,CAACyG,YAAL,EAAkB3G,CAAC,CAAC0R,aAAF,KAAkBvR,CAAC,CAACuR,aAAF,GAAgB1R,CAAC,CAAC0R,aAAF,CAAgBhQ,MAAhB,EAAlC,GAA4D1B,CAAC,CAAC+J,QAAF,KAAa5J,CAAC,CAAC0J,eAAF,GAAkB1J,CAAC,CAAC0J,eAAF,IAAmB,EAArC,EAAwC1J,CAAC,CAAC0J,eAAF,CAAkBC,WAAlB,GAA8B3J,CAAC,CAAC0J,eAAF,CAAkBC,WAAlB,IAA+B,EAArG,EAAwG3J,CAAC,CAAC0J,eAAF,CAAkBC,WAAlB,CAA8BC,QAA9B,GAAuC/J,CAAC,CAAC+J,QAAF,CAAWrI,MAAX,EAA5J,CAA5D,CAAlB,KAAmQ;AAAC,UAAMxB,CAAC,GAACF,CAAC,CAACyR,4BAAF,CAA+BE,gCAA/B,EAAR;AAA0EzR,IAAAA,CAAC,KAAGC,CAAC,CAACuR,aAAF,GAAgBxR,CAAC,CAACwB,MAAF,EAAnB,CAAD;AAAgC;AAAA,SAAOsP,EAAE,CAAC7Q,CAAD,EAAGH,CAAH,CAAF,EAAQG,CAAf;AAAiB;;AAAA,eAAe+M,EAAf,CAAkBlN,CAAlB,EAAoBE,CAApB,EAAsBC,CAAtB,EAAwB;AAAC,QAAMC,CAAC,GAACF,CAAC,CAACuM,aAAV;;AAAwB,MAAGtM,CAAC,CAACwG,YAAL,EAAkB;AAAC,UAAMzG,CAAC,GAAC;AAAC+J,MAAAA,IAAI,EAAC;AAAN,KAAR;AAAqB,WAAOjK,CAAC,CAACwO,KAAF,CAAQtO,CAAR,EAAU;AAACuO,MAAAA,MAAM,EAAC;AAAR,KAAV,GAA8B,OAAOvO,CAAC,CAACyO,SAAvC,EAAiDzO,CAAC,CAAC6Q,GAAF,GAAM/P,CAAC,CAAChB,CAAC,CAAC+Q,GAAH,CAAxD,EAAgE7Q,CAAvE;AAAyE;;AAAA;AAAC,UAAMI,CAAC,GAAC,EAAR;AAAA,UAAWE,CAAC,GAACN,CAAC,CAACsM,SAAf;AAAyBhM,IAAAA,CAAC,CAACoR,mBAAF,CAAsBlI,OAAtB,CAA+B,CAACxJ,CAAD,EAAGC,CAAH,KAAO;AAAC,YAAMC,CAAC,GAAC;AAACH,QAAAA,EAAE,EAAE,GAAED,CAAC,CAACC,EAAG,SAAQE,CAAE,EAAtB;AAAwB8J,QAAAA,IAAI,EAAC,OAA7B;AAAqCjB,QAAAA,KAAK,EAAChJ,CAAC,CAACC,EAA7C;AAAgDgO,QAAAA,QAAQ,EAACjO,CAAC,CAACiO,QAAF,IAAY,CAArE;AAAuEC,QAAAA,QAAQ,EAAClO,CAAC,CAACkO,QAAF,IAAY,CAA5F;AAA8FF,QAAAA,OAAO,EAAChO,CAAC,CAACgO,OAAxG;AAAgHzC,QAAAA,MAAM,EAACrL,CAAC,CAACqL;AAAzH,OAAR;AAAyI,mCAA2BrL,CAAC,CAAC2R,IAAF,CAAOC,MAAP,CAAc,CAAd,EAAgB,EAAhB,CAA3B,GAA+C1R,CAAC,CAAC2R,SAAF,GAAY7R,CAAC,CAAC2R,IAAF,CAAOC,MAAP,CAAc,EAAd,CAA3D,GAA6E1R,CAAC,CAAC2Q,GAAF,GAAM7Q,CAAC,CAAC2R,IAArF,EAA0FvR,CAAC,CAACyN,IAAF,CAAO3N,CAAP,CAA1F;AAAoG,KAApR;AAAuR,UAAMM,CAAC,GAAC,CAAC,GAAGF,CAAC,CAACwR,gBAAF,CAAmBjD,KAAvB,EAA6B,GAAGvO,CAAC,CAACyR,mBAAF,CAAsBlD,KAAtD,EAA4D,GAAGvO,CAAC,CAAC0R,kBAAF,CAAqBnD,KAApF,CAAR;AAAA,UAAmGnO,CAAC,GAAC;AAACX,MAAAA,EAAE,EAACD,CAAC,CAACC,EAAN;AAAS,UAAG,MAAMmO,EAAE,CAAC,IAAD,EAAM1N,CAAN,EAAQN,CAAR,EAAUD,CAAV,CAAX;AAAT,KAArG;AAAuI,WAAOG,CAAC,CAACyN,IAAF,CAAOnN,CAAP,GAAUN,CAAjB;AAAmB;AAAC;;AAAA,SAAS6M,EAAT,CAAYnN,CAAZ,EAAc;AAACoL,EAAAA,IAAI,EAAClL;AAAN,CAAd,EAAuBC,CAAvB,EAAyB;AAAC,MAAIC,CAAJ;AAAM,QAAME,CAAC,GAAC;AAACL,IAAAA,EAAE,EAACD,CAAC,CAACC,EAAN;AAASgJ,IAAAA,WAAW,EAAC;AAArB,GAAR;AAAiC,MAAIzI,CAAC,GAAC,EAAN;;AAAS,QAAME,CAAC,GAACR,CAAC,CAAC8L,KAAV;AAAA,QAAgBpL,CAAC,GAACZ,CAAC,IAAE;AAAC,UAAME,CAAC,GAAC,MAAIQ,CAAZ;AAAA,UAAcP,CAAC,GAAC,MAAIH,CAAC,CAACiO,QAAN,IAAgBvN,CAAC,IAAEV,CAAC,CAACiO,QAArC;AAAA,UAA8C7N,CAAC,GAAC,MAAIJ,CAAC,CAACkO,QAAN,IAAgBxN,CAAC,IAAEV,CAAC,CAACkO,QAArE;AAA8E,QAAGlO,CAAC,CAACuP,OAAF,KAAYrP,CAAC,IAAEC,CAAC,IAAEC,CAAlB,CAAH,EAAwB,IAAGJ,CAAC,CAACmS,SAAL,EAAenS,CAAC,CAACmS,SAAF,CAAYzI,OAAZ,CAAoB9I,CAApB,EAAf,KAA0C;AAAC,YAAMV,CAAC,GAACF,CAAC,CAACoS,iBAAF,EAAR;AAAA,YAA8BjS,CAAC,GAAC;AAACF,QAAAA,EAAE,EAACD,CAAC,CAACC,EAAN;AAAS4O,QAAAA,IAAI,EAAC7O,CAAC,CAACgJ,KAAhB;AAAsBa,QAAAA,eAAe,EAAC;AAACC,UAAAA,WAAW,EAAC5J,CAAC,CAAC4J,WAAf;AAA2B0H,UAAAA,oBAAoB,EAACtR,CAAC,CAACsR,oBAAlD;AAAuEZ,UAAAA,MAAM,EAAC1Q,CAAC,CAAC0Q;AAAhF;AAAtC,OAAhC;AAA+JpQ,MAAAA,CAAC,CAAC6R,OAAF,CAAUlS,CAAV,GAAaG,CAAC,CAAC2I,WAAF,CAAc8E,IAAd,CAAmB/N,CAAC,CAACC,EAArB,CAAb;AAAsC;AAAC,GAA7W;;AAA8W,SAAOD,CAAC,CAACmS,SAAF,IAAanS,CAAC,CAACmS,SAAF,CAAYzI,OAAZ,CAAoB9I,CAApB,CAAb,EAAoCJ,CAAC,CAACsK,MAAF,KAAWtK,CAAC,GAACA,CAAC,CAACsI,GAAF,CAAO,CAAC;AAAC7I,IAAAA,EAAE,EAACD,CAAJ;AAAM6O,IAAAA,IAAI,EAAC3O,CAAX;AAAa2J,IAAAA,eAAe,EAAC1J;AAA7B,GAAD,MAAoC;AAACF,IAAAA,EAAE,EAACD,CAAJ;AAAM6O,IAAAA,IAAI,EAAC3O,CAAX;AAAa2J,IAAAA,eAAe,EAAC1J;AAA7B,GAApC,CAAP,CAAF,EAAgFC,CAAC,GAAC;AAACwJ,IAAAA,MAAM,EAACpJ,CAAR;AAAU8R,IAAAA,aAAa,EAACtS,CAAC,CAACuS,YAAF,CAAeC,SAAf,CAAyBC,qBAAzB,GAA+C,KAAK,CAApD,GAAsDnS,CAAC,CAAC2I;AAAhF,GAAlF,EAA+K+H,EAAE,CAAC5Q,CAAD,EAAGJ,CAAH,CAAjL,EAAuLG,CAAC,CAAC0G,YAAF,CAAekH,IAAf,CAAoBzN,CAApB,CAAlM,CAApC,EAA8PF,CAArQ;AAAuQ;;AAAA,eAAegN,EAAf,CAAkB;AAACZ,EAAAA,SAAS,EAACxM,CAAX;AAAayM,EAAAA,aAAa,EAACvM;AAA3B,CAAlB,EAAgDC,CAAhD,EAAkD;AAAC,QAAMC,CAAC,GAAC,EAAR;AAAA,QAAWE,CAAC,GAACN,CAAC,CAAC0M,KAAf;AAAqB,MAAGlM,CAAC,CAACF,CAAC,CAACoS,kBAAH,CAAJ,EAA2B,KAAI,MAAMlS,CAAV,IAAeF,CAAC,CAACoS,kBAAjB,EAAoC;AAAC,UAAM1S,CAAC,GAAC,MAAMoO,EAAE,CAAC5N,CAAD,EAAGA,CAAC,CAACoQ,MAAL,EAAY1Q,CAAZ,EAAcC,CAAd,CAAhB;AAAiCH,IAAAA,CAAC,IAAEI,CAAC,CAAC2N,IAAF,CAAO,GAAG/N,CAAC,CAAC2J,iBAAF,CAAoBC,MAA9B,CAAH;AAAyC,GAA1I,MAA+I,IAAGpJ,CAAC,CAACF,CAAC,CAAC6R,SAAH,CAAJ,EAAkB,KAAI,MAAM3R,CAAV,IAAeF,CAAC,CAAC6R,SAAjB,EAA2B;AAAC,UAAMnS,CAAC,GAAC,MAAMoO,EAAE,CAAC,IAAD,EAAM5N,CAAC,CAAC2N,QAAR,EAAiBjO,CAAjB,EAAmBC,CAAnB,CAAhB;AAAsCH,IAAAA,CAAC,IAAEI,CAAC,CAAC2N,IAAF,CAAO,GAAG/N,CAAC,CAAC2J,iBAAF,CAAoBC,MAA9B,CAAH;AAAyC;AAAA,SAAM;AAACD,IAAAA,iBAAiB,EAAC;AAACC,MAAAA,MAAM,EAACxJ;AAAR;AAAnB,GAAN;AAAqC;;AAAA,SAASiN,EAAT,GAAa;AAAC,SAAM;AAACpD,IAAAA,IAAI,EAAC;AAAN,GAAN;AAA6B;;AAAA,eAAe2D,EAAf,CAAkB5N,CAAlB,EAAoB;AAACyM,EAAAA,aAAa,EAACvM,CAAf;AAAiBkL,EAAAA,IAAI,EAACjL;AAAtB,CAApB,EAA6CC,CAA7C,EAA+C;AAAC,QAAME,CAAC,GAAC;AAAC2J,IAAAA,IAAI,EAAC;AAAN,GAAR;AAAA,QAAuBzJ,CAAC,GAAC;AAACyK,IAAAA,MAAM,EAAC,KAAR;AAAc0H,IAAAA,gBAAgB,EAAC,CAAC,CAAhC;AAAkC/I,IAAAA,MAAM,EAAC,CAAC5J,CAAD,CAAzC;AAA6C8L,IAAAA,QAAQ,EAAC;AAAtD,GAAzB;AAAA,QAAkFlL,CAAC,GAACR,CAAC,CAACkL,QAAF,IAAYnL,CAAC,CAACoL,MAAF,CAASE,KAAT,EAAhG;AAAiH,MAAI3K,CAAC,GAAC,EAAN;AAAA,MAASE,CAAC,GAAC,CAAC,CAAZ;AAAA,MAAcG,CAAC,GAAC,CAAC,CAAjB;;AAAmB,MAAGjB,CAAC,CAAC0H,aAAL,EAAmB;AAAC,UAAM5H,CAAC,GAACE,CAAC,CAAC0H,aAAV;AAAwB5H,IAAAA,CAAC,CAAC8H,GAAF,GAAM,CAAN,KAAUhH,CAAC,GAACd,CAAC,CAAC8H,GAAd,GAAmB9H,CAAC,CAACgI,KAAF,GAAQ,CAAR,KAAYhH,CAAC,GAAChB,CAAC,CAACgI,KAAF,GAAQ,CAAR,IAAW7H,CAAC,CAAC6H,KAAF,GAAQ,CAAjC,CAAnB,EAAuDhI,CAAC,CAACiI,MAAF,GAAS,CAAT,KAAa9G,CAAC,GAACnB,CAAC,CAACiI,MAAF,GAAS,CAAT,IAAY9H,CAAC,CAAC8H,MAAF,GAAS,CAApC,CAAvD;AAA8F;;AAAA,MAAG,eAAa/H,CAAC,CAAC2H,MAAf,IAAuB3H,CAAC,CAAC6L,cAAzB,KAA0C,CAAC7L,CAAC,CAAC+L,QAAH,IAAa/L,CAAC,CAAC+L,QAAF,KAAa9L,CAAC,CAAC6L,KAAtE,KAA8E,OAAKlL,CAAnF,KAAuF,CAACE,CAAD,IAAI,CAACG,CAA5F,MAAiGX,CAAC,CAACoS,IAAF,GAAO;AAACtQ,IAAAA,CAAC,EAAC,CAAH;AAAKnB,IAAAA,CAAC,EAAC,CAAP;AAAS6G,IAAAA,KAAK,EAAC7H,CAAC,CAAC6H,KAAjB;AAAuBC,IAAAA,MAAM,EAAC9H,CAAC,CAAC8H;AAAhC,GAAP,EAA+CjH,CAAC,KAAGR,CAAC,CAACoS,IAAF,CAAO5K,KAAP,IAAc,CAAjB,CAAhD,EAAoE7G,CAAC,KAAGX,CAAC,CAACoS,IAAF,CAAO3K,MAAP,IAAe,CAAlB,CAArE,EAA0F,CAAC7H,CAAC,CAACkL,QAA9L,CAAH,EAA2M;AAAC,UAAMtL,CAAC,GAACG,CAAC,CAAC0S,KAAF,CAAQnS,CAAC,CAACF,CAAC,CAACoS,IAAF,CAAO5K,KAAR,EAAcxH,CAAC,CAACoS,IAAF,CAAO3K,MAArB,CAAT,CAAR;AAA+CrH,IAAAA,CAAC,CAACkS,IAAF,GAAO9S,CAAC,CAACmB,CAAT,EAAWP,CAAC,CAACmS,IAAF,GAAO/S,CAAC,CAACsC,CAApB,EAAsBlC,CAAC,CAACkL,QAAF,GAAW1K,CAAjC;AAAmC;;AAAAN,EAAAA,CAAC,CAACiL,MAAF,GAAS3K,CAAC,CAAC6K,KAAF,GAAUC,UAAV,CAAqB,CAAC,CAAtB,EAAyBhK,MAAzB,EAAT;AAA2C,QAAML,CAAC,GAAC,MAAMlB,CAAC,CAAC6S,cAAF,CAAiBxS,CAAjB,CAAd;AAAA,QAAkC;AAACgG,IAAAA,IAAI,EAACjF;AAAN,MAASL,CAAC,CAACG,CAAC,CAAC4R,OAAH,CAA5C;AAAwD,SAAO3S,CAAC,CAACyR,SAAF,GAAYxQ,CAAZ,EAAcjB,CAArB;AAAuB;;AAAA,eAAegN,EAAf,CAAkBtN,CAAlB,EAAoB;AAACwM,EAAAA,SAAS,EAACtM,CAAX;AAAauM,EAAAA,aAAa,EAACtM;AAA3B,CAApB,EAAkDC,CAAlD,EAAoD;AAACA,EAAAA,CAAC,CAACyG,YAAF,IAAgBzG,CAAC,CAACyG,YAAF,CAAekH,IAAf,CAAoB;AAAC9N,IAAAA,EAAE,EAACD,CAAC,CAACC;AAAN,GAApB,CAAhB;AAA+C,SAAOmO,EAAE,CAACpO,CAAD,EAAG,MAAMuO,EAAE,CAACrO,CAAD,CAAX,EAAeC,CAAf,EAAiBC,CAAjB,CAAT;AAA6B;;AAAA,SAASmN,EAAT,CAAYvN,CAAZ,EAAc;AAAC,QAAME,CAAC,GAAC;AAACgT,IAAAA,gBAAgB,EAAClT,CAAC,CAACkT;AAApB,GAAR;AAA8C,SAAOlC,EAAE,CAAC9Q,CAAD,EAAGF,CAAH,CAAF,EAAQE,CAAf;AAAiB;;AAAA,eAAesN,EAAf,CAAkBxN,CAAlB,EAAoBG,CAApB,EAAsBC,CAAtB,EAAwB;AAAC,MAAGA,CAAC,CAACuG,YAAF,IAAgB3G,CAAC,CAACmT,UAAlB,IAA8BnT,CAAC,CAACoT,QAAnC,EAA4C;AAAC,UAAMjT,CAAC,GAACD,CAAC,IAAEA,CAAC,CAACmT,cAAF,CAAiBrT,CAAC,CAACoT,QAAnB,CAAX;AAAA,UAAwC9S,CAAC,GAACJ,CAAC,IAAEA,CAAC,CAACmT,cAAF,CAAiBrT,CAAC,CAACmT,UAAnB,CAA7C;;AAA4E,QAAG,CAAChT,CAAD,IAAI,CAACG,CAAL,IAAQ,YAAUF,CAAC,CAAC2G,UAAvB,EAAkC;AAAC,YAAM7G,CAAC,GAAC;AAAC+J,QAAAA,IAAI,EAAC;AAAN,OAAR;AAAiC,aAAO/J,CAAC,CAACkT,QAAF,GAAWpS,CAAC,CAAChB,CAAC,CAACoT,QAAH,CAAZ,EAAyBjT,CAAC,KAAGD,CAAC,CAACoT,KAAF,GAAQnT,CAAC,CAACmT,KAAb,CAA1B,EAA8ChT,CAAC,IAAEA,CAAC,CAACgT,KAAF,KAAUpT,CAAC,CAACoT,KAAf,KAAuBpT,CAAC,CAACqT,gBAAF,GAAmB,CAAC;AAACxC,QAAAA,GAAG,EAAC/Q,CAAC,CAACmT,UAAP;AAAkBG,QAAAA,KAAK,EAAChT,CAAC,CAACgT;AAA1B,OAAD,CAA1C,CAA9C,EAA4HpT,CAAnI;AAAqI;AAAC;;AAAA,SAAO0N,EAAE,CAAC5N,CAAD,EAAGG,CAAH,EAAKC,CAAL,CAAT;AAAiB;;AAAA,SAASqN,EAAT,CAAYzN,CAAZ,EAAc;AAAC,QAAME,CAAC,GAAC;AAAC+J,IAAAA,IAAI,EAAC,eAAN;AAAsBuJ,IAAAA,WAAW,EAACxT,CAAC,CAACwT,WAAF,CAAcC,OAAd,CAAsB,MAAtB,EAA6B,GAA7B,CAAlC;AAAoEC,IAAAA,OAAO,EAAC1T,CAAC,CAAC2T;AAA9E,GAAR;AAAiG,SAAO3T,CAAC,CAAC4T,UAAF,IAAc5T,CAAC,CAAC4T,UAAF,CAAa9I,MAAb,GAAoB,CAAlC,KAAsC5K,CAAC,CAAC0T,UAAF,GAAa5T,CAAC,CAAC4T,UAArD,GAAiE1T,CAAxE;AAA0E;;AAAA,SAASwN,EAAT,CAAY1N,CAAZ,EAAc;AAAC,MAAIE,CAAJ;;AAAM,QAAMC,CAAC,GAAC,EAAR;AAAA,QAAWC,CAAC,GAACJ,CAAC,IAAE;AAACA,IAAAA,CAAC,CAACuP,OAAF,KAAYvP,CAAC,CAACmS,SAAF,GAAYnS,CAAC,CAACmS,SAAF,CAAYzI,OAAZ,CAAoBtJ,CAApB,CAAZ,GAAmCJ,CAAC,CAAC6O,IAAF,IAAQ1O,CAAC,CAACkS,OAAF,CAAUrS,CAAC,CAAC6O,IAAZ,CAAvD;AAA0E,GAA3F;;AAA4F,SAAO7O,CAAC,CAACmS,SAAF,IAAanS,CAAC,CAACmS,SAAF,CAAYzI,OAAZ,CAAoBtJ,CAApB,CAAb,EAAoCD,CAAC,CAAC2K,MAAF,KAAW5K,CAAC,GAAC;AAAC+J,IAAAA,IAAI,EAAC,KAAN;AAAY4J,IAAAA,qBAAqB,EAAC7T,CAAC,CAAC6T,qBAApC;AAA0DX,IAAAA,gBAAgB,EAAClT,CAAC,CAACkT,gBAA7E;AAA8FY,IAAAA,qBAAqB,EAAC9T,CAAC,CAAC+T,iBAAtH;AAAwIzB,IAAAA,aAAa,EAACnS,CAAtJ;AAAwJ4Q,IAAAA,GAAG,EAAC/P,CAAC,CAAChB,CAAC,CAAC+Q,GAAH,CAA7J;AAAqKiD,IAAAA,OAAO,EAAChU,CAAC,CAACgU;AAA/K,GAAb,CAApC,EAA0O9T,CAAjP;AAAmP;;AAAA,SAASyN,EAAT,CAAY3N,CAAZ,EAAc;AAAC,QAAME,CAAC,GAACF,CAAC,CAACiU,WAAV;AAAsB,SAAM;AAAChK,IAAAA,IAAI,EAAC,MAAN;AAAa4J,IAAAA,qBAAqB,EAAC7T,CAAC,CAAC6T,qBAArC;AAA2DX,IAAAA,gBAAgB,EAAClT,CAAC,CAACkT,gBAA9E;AAA+FjI,IAAAA,MAAM,EAAC/K,CAAC,CAACgU,WAAxG;AAAoHxH,IAAAA,KAAK,EAACxM,CAAC,CAACD,EAA5H;AAA+HwJ,IAAAA,KAAK,EAACvJ,CAAC,CAACiU,OAAvI;AAA+IC,IAAAA,aAAa,EAAClU,CAAC,CAACmU,eAA/J;AAA+KtD,IAAAA,GAAG,EAAC/P,CAAC,CAAChB,CAAC,CAAC+Q,GAAH;AAApL,GAAN;AAAmM;;AAAA,SAASC,EAAT,CAAY7Q,CAAZ,EAAcC,CAAd,EAAgB;AAAC,MAAGA,CAAC,CAAC2Q,GAAL,EAAS,IAAG5Q,CAAC,CAAC4Q,GAAF,GAAM/P,CAAC,CAACb,CAAC,CAAC4Q,GAAF,IAAO3Q,CAAC,CAAC2Q,GAAV,CAAP,EAAsB,YAAW3Q,CAAX,IAAcA,CAAC,CAACkU,MAAzC,EAAgDnU,CAAC,CAACmT,KAAF,GAAQlT,CAAC,CAACkU,MAAV,CAAhD,KAAsE,IAAGtU,CAAC,CAACsU,MAAF,IAAUtP,CAAC,CAAC5E,CAAC,CAAC2Q,GAAH,CAAd,EAAsB5Q,CAAC,CAACmT,KAAF,GAAQtT,CAAC,CAACsU,MAAV,CAAtB,KAA2C;AAAC,QAAIhU,CAAJ,EAAME,CAAN;AAAQL,IAAAA,CAAC,CAACmT,KAAF,GAAQ,SAAOhT,CAAC,GAACJ,CAAT,KAAa,SAAOM,CAAC,GAACF,CAAC,CAAC+S,cAAF,CAAiBjT,CAAC,CAAC2Q,GAAnB,CAAT,CAAb,GAA+C,KAAK,CAApD,GAAsDvQ,CAAC,CAAC8S,KAAhE;AAAsE;AAAC;;AAAA,eAAenD,EAAf,CAAkBnQ,CAAlB,EAAoBE,CAApB,EAAsB;AAACA,EAAAA,CAAC,CAACqU,MAAF,KAAWrU,CAAC,CAACqU,MAAF,GAASC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAApB;AAAsD,QAAMrU,CAAC,GAAC,IAAR;AAAaF,EAAAA,CAAC,CAACqU,MAAF,CAASvM,KAAT,GAAe5H,CAAf,EAAiBF,CAAC,CAACqU,MAAF,CAAStM,MAAT,GAAgB7H,CAAjC;AAAmC,QAAME,CAAC,GAACJ,CAAC,CAACqU,MAAF,CAASG,UAAT,CAAoB,IAApB,CAAR;AAAkC,MAAIlU,CAAJ,EAAME,CAAN;;AAAQ,MAAGV,CAAC,CAAC2U,IAAL,EAAU;AAAC,QAAI3T,CAAJ;AAAM,UAAMd,CAAC,GAAC,IAAI0U,MAAJ,CAAW5U,CAAC,CAAC2U,IAAb,CAAR;AAA2BzU,IAAAA,CAAC,CAAC2U,SAAF,IAAcvU,CAAC,CAACwU,SAAF,GAAYjH,KAAK,CAACC,OAAN,CAAc9N,CAAC,CAAC4P,KAAhB,IAAwB,QAAO5P,CAAC,CAAC4P,KAAF,CAAQ,CAAR,CAAW,IAAG5P,CAAC,CAAC4P,KAAF,CAAQ,CAAR,CAAW,IAAG5P,CAAC,CAAC4P,KAAF,CAAQ,CAAR,CAAW,IAAG5P,CAAC,CAAC4P,KAAF,CAAQ,CAAR,IAAW,GAAI,GAAxF,GAA2F,YAArH,EAAkItP,CAAC,CAACyU,IAAF,CAAO7U,CAAP,CAAlI;AAA4I,UAAMC,CAAC,GAACiE,CAAC,CAAC9D,CAAD,CAAT;AAAa,QAAG,CAACH,CAAJ,EAAM,OAAO,IAAP;AAAYG,IAAAA,CAAC,CAAC0U,SAAF,CAAY,CAAZ,EAAc,CAAd,EAAgB5U,CAAhB,EAAkBA,CAAlB;AAAqB,UAAMU,CAAC,GAACF,CAAC,CAACZ,CAAC,CAACiV,IAAH,CAAD,GAAUC,IAAI,CAACC,GAAL,CAAShV,CAAC,CAAC6H,KAAX,EAAiB7H,CAAC,CAAC8H,MAAnB,CAAlB;AAA6C3H,IAAAA,CAAC,CAAC0L,KAAF,CAAQlL,CAAR,EAAUA,CAAV;AAAa,UAAMI,CAAC,GAACd,CAAC,GAACU,CAAV;AAAA,UAAYK,CAAC,GAACD,CAAC,GAAC,CAAF,GAAIf,CAAC,CAAC6H,KAAF,GAAQ,CAAZ,GAAc7H,CAAC,CAACmC,CAA9B;AAAA,UAAgCjB,CAAC,GAACH,CAAC,GAAC,CAAF,GAAIf,CAAC,CAAC8H,MAAF,GAAS,CAAb,GAAe9H,CAAC,CAACgB,CAAnD;;AAAqD,QAAGb,CAAC,CAAC8U,SAAF,CAAYjU,CAAZ,EAAcE,CAAd,GAAiBwM,KAAK,CAACC,OAAN,CAAc9N,CAAC,CAAC4P,KAAhB,KAAwBtP,CAAC,CAACyU,IAAF,CAAO7U,CAAP,CAAzC,EAAmD,SAAOc,CAAC,GAAChB,CAAC,CAAC2P,OAAX,KAAqB3O,CAAC,CAACgH,KAAvB,IAA8B6F,KAAK,CAACC,OAAN,CAAc9N,CAAC,CAAC2P,OAAF,CAAUC,KAAxB,CAApF,EAAmH;AAAC,YAAMxP,CAAC,GAACJ,CAAC,CAAC2P,OAAV;AAAkBrP,MAAAA,CAAC,CAAC+U,SAAF,GAAYzU,CAAC,CAACR,CAAC,CAAC4H,KAAH,CAAD,GAAWlH,CAAvB,EAAyBR,CAAC,CAACgV,QAAF,GAAW,OAApC,EAA4ChV,CAAC,CAACiV,WAAF,GAAe,QAAOnV,CAAC,CAACwP,KAAF,CAAQ,CAAR,CAAW,IAAGxP,CAAC,CAACwP,KAAF,CAAQ,CAAR,CAAW,IAAGxP,CAAC,CAACwP,KAAF,CAAQ,CAAR,CAAW,IAAGxP,CAAC,CAACwP,KAAF,CAAQ,CAAR,IAAW,GAAI,GAA3H,EAA8HtP,CAAC,CAACkV,MAAF,CAAStV,CAAT,CAA9H,EAA0IC,CAAC,CAAC6H,KAAF,IAAS1H,CAAC,CAAC+U,SAArJ,EAA+JlV,CAAC,CAAC8H,MAAF,IAAU3H,CAAC,CAAC+U,SAA3K;AAAqL;;AAAAlV,IAAAA,CAAC,CAAC6H,KAAF,IAASlH,CAAT,EAAWX,CAAC,CAAC8H,MAAF,IAAUnH,CAArB;AAAuB,UAAMS,CAAC,GAACjB,CAAC,CAACmV,YAAF,CAAerV,CAAC,GAAC,CAAF,GAAID,CAAC,CAAC6H,KAAF,GAAQ,CAA3B,EAA6B5H,CAAC,GAAC,CAAF,GAAID,CAAC,CAAC8H,MAAF,GAAS,CAA1C,EAA4CiN,IAAI,CAACQ,IAAL,CAAUvV,CAAC,CAAC6H,KAAZ,CAA5C,EAA+DkN,IAAI,CAACQ,IAAL,CAAUvV,CAAC,CAAC8H,MAAZ,CAA/D,CAAR;AAA4FzH,IAAAA,CAAC,GAACe,CAAC,CAACyG,KAAJ,EAAUtH,CAAC,GAACa,CAAC,CAAC0G,MAAd,EAAqB3H,CAAC,CAACiU,MAAF,CAASvM,KAAT,GAAexH,CAApC,EAAsCF,CAAC,CAACiU,MAAF,CAAStM,MAAT,GAAgBvH,CAAtD,EAAwDJ,CAAC,CAACqV,YAAF,CAAepU,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAAxD;AAA8E,GAAv1B,MAA21B;AAAC,UAAMrB,CAAC,GAAC,oBAAkBF,CAAC,CAAC4V,WAApB,GAAgC,+BAA6B5V,CAAC,CAAC+R,SAA/D,GAAyE/R,CAAC,CAAC+Q,GAAnF;AAAA,UAAuF3Q,CAAC,GAAC,CAAC,MAAMD,CAAC,CAACD,CAAD,EAAG;AAAC2V,MAAAA,YAAY,EAAC;AAAd,KAAH,CAAR,EAAoCrP,IAA7H;AAAkIhG,IAAAA,CAAC,GAACI,CAAC,CAACZ,CAAC,CAACgI,KAAH,CAAH,EAAatH,CAAC,GAACE,CAAC,CAACZ,CAAC,CAACiI,MAAH,CAAhB,EAA2B3H,CAAC,CAACiU,MAAF,CAASvM,KAAT,GAAexH,CAA1C,EAA4CF,CAAC,CAACiU,MAAF,CAAStM,MAAT,GAAgBvH,CAA5D,EAA8DJ,CAAC,CAACwV,SAAF,CAAY1V,CAAZ,EAAc,CAAd,EAAgB,CAAhB,EAAkBE,CAAC,CAACiU,MAAF,CAASvM,KAA3B,EAAiC1H,CAAC,CAACiU,MAAF,CAAStM,MAA1C,CAA9D;AAAgH;;AAAA,SAAM;AAACgC,IAAAA,IAAI,EAAC,SAAN;AAAgB8H,IAAAA,SAAS,EAACzR,CAAC,CAACiU,MAAF,CAASwB,SAAT,CAAmB,WAAnB,EAAgCjE,MAAhC,CAAuC,EAAvC,CAA1B;AAAqE7B,IAAAA,KAAK,EAACjQ,CAAC,CAACiQ,KAA7E;AAAmF2F,IAAAA,WAAW,EAAC,WAA/F;AAA2G3N,IAAAA,MAAM,EAACnH,CAAC,CAACJ,CAAD,CAAnH;AAAuHsH,IAAAA,KAAK,EAAClH,CAAC,CAACN,CAAD,CAA9H;AAAkIwV,IAAAA,OAAO,EAAChW,CAAC,CAACgW,OAA5I;AAAoJC,IAAAA,OAAO,EAACjW,CAAC,CAACiW;AAA9J,GAAN;AAA6K;;AAAA,eAAexF,EAAf,CAAkBzQ,CAAlB,EAAoBE,CAApB,EAAsB;AAAC,QAAMC,CAAC,GAACH,CAAC,CAACiK,IAAV;AAAe,MAAG,aAAW9J,CAAX,IAAc+P,EAAE,CAAClQ,CAAC,CAACgK,MAAH,CAAnB,EAA8BhK,CAAC,CAACgK,MAAF,GAAS,MAAMmG,EAAE,CAACnQ,CAAC,CAACgK,MAAH,EAAU9J,CAAV,CAAjB,CAA9B,KAAiE,IAAG,kBAAgBC,CAAhB,IAAmB,kBAAgBA,CAAtC,EAAwC;AAAC+P,IAAAA,EAAE,CAAClQ,CAAC,CAACkW,aAAH,CAAF,KAAsBlW,CAAC,CAACkW,aAAF,GAAgB,MAAM/F,EAAE,CAACnQ,CAAC,CAACkW,aAAH,EAAiBhW,CAAjB,CAA9C;AAAmE,UAAME,CAAC,GAACJ,CAAC,CAAC,kBAAgBG,CAAhB,GAAkB,kBAAlB,GAAqC,iBAAtC,CAAT;AAAkE,QAAGC,CAAH,EAAK,KAAI,MAAMJ,CAAV,IAAeI,CAAf,EAAiB8P,EAAE,CAAClQ,CAAC,CAACgK,MAAH,CAAF,KAAehK,CAAC,CAACgK,MAAF,GAAS,MAAMmG,EAAE,CAACnQ,CAAC,CAACgK,MAAH,EAAU9J,CAAV,CAAhC;AAA8C;AAAC;;AAAA,eAAeqO,EAAf,CAAkBvO,CAAlB,EAAoB;AAAC,SAAOA,CAAC,CAACmW,aAAF,CAAgBrQ,CAAhB,EAAmBS,IAAnB,CAAyBvG,CAAC,IAAEA,CAAC,CAACmK,QAA9B,CAAP;AAAgD;;AAAA,SAASjD,EAAT,CAAYlH,CAAZ,EAAc;AAAC,SAAOA,CAAC,CAACyG,UAAF,IAAczG,CAAC,CAACyG,UAAF,CAAa2P,aAA3B,GAAyCzQ,CAAC,CAAC0Q,QAAF,CAAWrW,CAAC,CAACyG,UAAF,CAAa2P,aAAxB,CAAzC,GAAgF,MAAvF;AAA8F;;AAAA,SAASlG,EAAT,CAAYlQ,CAAZ,EAAc;AAAC,SAAOA,CAAC,KAAGA,CAAC,CAAC2U,IAAF,IAAQ,oBAAkB3U,CAAC,CAAC4V,WAA5B,IAAyC5V,CAAC,CAAC+Q,GAAF,IAAO/Q,CAAC,CAAC+Q,GAAF,CAAMuF,QAAN,CAAe,MAAf,CAAnD,CAAR;AAAmF;;AAAA,SAAOpQ,CAAC,IAAI5E,OAAZ,EAAoB2F,CAAC,IAAIsP,gBAAzB,EAA0CpQ,CAAC,IAAIqQ,cAA/C,EAA8D/O,CAAC,IAAIgP,OAAnE,EAA2EzQ,CAAC,IAAI0Q,aAAhF","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../config.js\";import{id as t}from\"../kernel.js\";import i from\"../request.js\";import r from\"../core/Error.js\";import{JSONMap as a}from\"../core/jsonMap.js\";import{isSome as n}from\"../core/maybe.js\";import{createScreenPoint as s,pt2px as o,px2pt as l}from\"../core/screenUtils.js\";import{normalize as u,dataComponents as c}from\"../core/urlUtils.js\";import y from\"../geometry/Polygon.js\";import{getSizeRangeAtScale as f}from\"../renderers/visualVariables/support/visualVariableUtils.js\";import{execute as m}from\"./geoprocessor/execute.js\";import{submitJob as p}from\"./geoprocessor/submitJob.js\";import{toJSON as d}from\"./support/fileFormat.js\";import{toJSON as g}from\"./support/layoutTemplate.js\";import{getVisibleLayerViews as h,isGroupLayer as b,isBingMapsLayer as w,isCSVLayer as S,isFeatureLayer as x,isGeoJSONLayer as v,isGraphicsLayer as I,isImageryLayer as D,isKMLLayer as L,isMapImageLayer as V,isMapNotesLayer as M,isOpenStreetMapLayer as O,isStreamLayer as T,isTileLayer as E,isVectorTileLayer as F,isWebTileLayer as P,isWMSLayer as R,isWMTSLayer as k,applyVisualVariables as N,getContextBoundingBox as J,createPolygonLayer as C,createPolylineLayer as U,createPointLayer as j,createMultipointLayer as A}from\"./support/printTaskUtils.js\";import z from\"./support/PrintTemplate.js\";import K from\"./support/Query.js\";import{supportsApiKey as $}from\"../support/apiKeyUtils.js\";const _={Feet:\"ft\",Kilometers:\"km\",Meters:\"m\",Miles:\"mi\"},q=new a({esriFeet:\"Feet\",esriKilometers:\"Kilometers\",esriMeters:\"Meters\",esriMiles:\"Miles\"}),W=new a({esriExecutionTypeSynchronous:\"sync\",esriExecutionTypeAsynchronous:\"async\"}),B=new K({returnGeometry:!0}),G=new Map;async function Q(e,t,r){const a=Z(e);let n=G.get(a);return Promise.resolve().then((()=>n?{data:n.gpMetadata}:(n={gpServerUrl:a,is11xService:!1,legendLayerNameMap:[],legendLayers:[]},i(a,{query:{f:\"json\"}})))).then((e=>(n.gpMetadata=e.data,n.cimVersion=n.gpMetadata.cimVersion,n.is11xService=!!n.cimVersion,G.set(a,n),X(t,n)))).then((i=>{const a=Ie(n);let s;const o=e=>\"sync\"===a?e.results&&e.results[0]&&e.results[0].value:s.fetchResultData(\"Output_File\",null,r).then((e=>e.value));return\"async\"===a?p(e,i,null,r).then((e=>(s=e,e.waitForJobCompletion({interval:t.updateDelay}).then(o)))):m(e,i,null,r).then(o)}))}async function H(e){const t=Z(e);return Ie(G.get(t))}async function X(e,t){t=t||{is11xService:!1,legendLayerNameMap:[],legendLayers:[]};const i=e.template||new z;null==i.showLabels&&(i.showLabels=!0);const a=i.exportOptions;let n;const s=g(i.layout);if(a){if(n={dpi:a.dpi},\"map_only\"===s.toLowerCase()||\"\"===s){const e=a.width,t=a.height;n.outputSize=[e,t]}}const o=i.layoutOptions;let l;if(o){let e,t;\"Miles\"===o.scalebarUnit||\"Kilometers\"===o.scalebarUnit?(e=\"Kilometers\",t=\"Miles\"):\"Meters\"!==o.scalebarUnit&&\"Feet\"!==o.scalebarUnit||(e=\"Meters\",t=\"Feet\"),l={titleText:o.titleText,authorText:o.authorText,copyrightText:o.copyrightText,customTextElements:o.customTextElements,scaleBarOptions:{metricUnit:q.toJSON(e),metricLabel:_[e],nonMetricUnit:q.toJSON(t),nonMetricLabel:_[t]}}}let u=null;o&&o.legendLayers&&(u=o.legendLayers.map((e=>{t.legendLayerNameMap[e.layerId]=e.title;const i={id:e.layerId};return e.subLayerIds&&(i.subLayerIds=e.subLayerIds),i})));const c=await Y(e,i,t);if(c.operationalLayers){const e=new RegExp(\"[\\\\u4E00-\\\\u9FFF\\\\u0E00-\\\\u0E7F\\\\u0900-\\\\u097F\\\\u3040-\\\\u309F\\\\u30A0-\\\\u30FF\\\\u31F0-\\\\u31FF]\"),i=/[\\u0600-\\u06FF]/,a=t=>{const r=t.text,a=t.font,n=a&&a.family&&a.family.toLowerCase();r&&a&&(\"arial\"===n||\"arial unicode ms\"===n)&&(a.family=e.test(r)?\"Arial Unicode MS\":\"Arial\",\"normal\"!==a.style&&i.test(r)&&(a.family=\"Arial Unicode MS\"))},n=()=>{throw new r(\"print-task:cim-symbol-unsupported\",\"CIMSymbol is not supported by a print service published from ArcMap\")};c.operationalLayers.forEach((e=>{var i,r,s;null!=(i=e.featureCollection)&&i.layers?e.featureCollection.layers.forEach((e=>{var i,r,s,o;if(null!=(i=e.layerDefinition)&&null!=(r=i.drawingInfo)&&null!=(s=r.renderer)&&s.symbol){const i=e.layerDefinition.drawingInfo.renderer;\"esriTS\"===i.symbol.type?a(i.symbol):\"CIMSymbolReference\"!==i.symbol.type||t.is11xService||n()}null!=(o=e.featureSet)&&o.features&&e.featureSet.features.forEach((e=>{e.symbol&&(\"esriTS\"===e.symbol.type?a(e.symbol):\"CIMSymbolReference\"!==e.symbol.type||t.is11xService||n())}))})):!t.is11xService&&null!=(r=e.layerDefinition)&&null!=(s=r.drawingInfo)&&s.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('\"type\":\"CIMSymbolReference\"')&&n()}))}e.outSpatialReference&&(c.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(c,{exportOptions:n,layoutOptions:l||{}}),Object.assign(c.layoutOptions,{legendOptions:{operationalLayers:null!=u?u:t.legendLayers.slice()}}),t.legendLayers.length=0,G.set(t.gpServerUrl,t);const y={Web_Map_as_JSON:JSON.stringify(c),Format:d(i.format),Layout_Template:s};return e.extraParameters&&Object.assign(y,e.extraParameters),y}async function Y(e,t,i){const r=e.view;let a=r.spatialReference;const s={operationalLayers:await ee(r,t,i)};let o=i.ssExtent||e.extent||r.extent;if(a&&a.isWrappable&&(o=o.clone()._normalize(!0),a=o.spatialReference),s.mapOptions={extent:o&&o.toJSON(),spatialReference:a&&a.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,r.background&&(s.background=r.background.toJSON()),r.rotation&&(s.mapOptions.rotation=-r.rotation),t.scalePreserved&&(s.mapOptions.scale=t.outScale||r.scale),r.timeExtent){const e=n(r.timeExtent.start)?r.timeExtent.start.getTime():null,t=n(r.timeExtent.end)?r.timeExtent.end.getTime():null;s.mapOptions.time=[e,t]}return s}function Z(e){let t=e;const i=t.lastIndexOf(\"/GPServer/\");return i>0&&(t=t.slice(0,i+9)),t}async function ee(e,t,i){const r=[],a={layerView:null,printTemplate:t,view:e};let n=0;t.scalePreserved&&(n=t.outScale||e.scale);const s=h(e,n);for(const o of s){const e=o.layer;if(!e.loaded||b(e))continue;let t;a.layerView=o,t=w(e)?te(e):S(e)?await ie(e,a,i):x(e)?await ae(e,a,i):v(e)?await ne(e,a,i):I(e)?await se(e,a,i):D(e)?oe(e,i):L(e)?await le(e,a,i):V(e)?ue(e,a,i):M(e)?await ce(a,i):O(e)?ye():T(e)?await me(e,a,i):E(e)?pe(e):F(e)?await de(e,a,i):P(e)?ge(e):R(e)?he(e):k(e)?be(e):await fe(e,a,i),t&&(Array.isArray(t)?r.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=e.opacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,r.push(t)))}if(n&&r.forEach((e=>{e.minScale=0,e.maxScale=0})),e.graphics&&e.graphics.length){const a=await re(null,e.graphics,t,i);a&&r.push(a)}return r}function te(e){return{culture:e.culture,key:e.key,type:\"BingMaps\"+(\"aerial\"===e.style?\"Aerial\":\"hybrid\"===e.style?\"Hybrid\":\"Road\")}}async function ie(e,{layerView:t,printTemplate:i},r){let a;if(r.legendLayers&&r.legendLayers.push({id:e.id}),!r.is11xService){return re(e,await ve(t),i,r)}return a={type:\"CSV\"},e.write(a,{origin:\"web-map\"}),delete a.popupInfo,delete a.layerType,a.showLabels=i.showLabels&&e.labelsVisible,a}async function re(e,t,i,r){let a;const n=C(),s=U(),o=j(),l=A(),u=j();if(u.layerDefinition.name=\"textLayer\",delete u.layerDefinition.drawingInfo,e){if(\"esri.layers.FeatureLayer\"===e.declaredClass||\"esri.layers.StreamLayer\"===e.declaredClass?n.layerDefinition.name=s.layerDefinition.name=o.layerDefinition.name=l.layerDefinition.name=r.legendLayerNameMap[e.id]||e.get(\"arcgisProps.title\")||e.title:\"esri.layers.GraphicsLayer\"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON();n.layerDefinition.drawingInfo.renderer=t,s.layerDefinition.drawingInfo.renderer=t,o.layerDefinition.drawingInfo.renderer=t,l.layerDefinition.drawingInfo.renderer=t}if(i.showLabels&&e.labelsVisible&&\"function\"==typeof e.write){var c,f;const t=null==(c=e.write({},{origin:\"web-map\"}).layerDefinition)||null==(f=c.drawingInfo)?void 0:f.labelingInfo;t&&(a=!0,n.layerDefinition.drawingInfo.labelingInfo=t,s.layerDefinition.drawingInfo.labelingInfo=t,o.layerDefinition.drawingInfo.labelingInfo=t,l.layerDefinition.drawingInfo.labelingInfo=t)}}let m;null!=e&&e.renderer||a||(delete n.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo);const p=null==e?void 0:e.fieldsIndex,d=null==e?void 0:e.renderer;if(p){if(d&&\"function\"==typeof d.collectRequiredFields){const e=new Set;await d.collectRequiredFields(e,p),m=Array.from(e)}const e=p.fields.map((e=>e.toJSON()));n.layerDefinition.fields=e,s.layerDefinition.fields=e,o.layerDefinition.fields=e,l.layerDefinition.fields=e}const g=t&&t.length;let h;for(let w=0;w<g;w++){const a=t[w]||t.getItemAt(w);if(!1===a.visible||!a.geometry)continue;if(h=a.toJSON(),h.hasOwnProperty(\"popupTemplate\")&&delete h.popupTemplate,h.geometry&&h.geometry.z&&delete h.geometry.z,h.symbol&&h.symbol.outline&&\"esriCLS\"===h.symbol.outline.type&&!r.is11xService)continue;!r.is11xService&&h.symbol&&h.symbol.outline&&h.symbol.outline.color&&h.symbol.outline.color[3]&&(h.symbol.outline.color[3]=255);const c=e&&e.renderer&&(\"valueExpression\"in e.renderer&&e.renderer.valueExpression||\"hasVisualVariables\"in e.renderer&&e.renderer.hasVisualVariables());if(!h.symbol&&e&&e.renderer&&c&&!r.is11xService){const t=e.renderer,i=await t.getSymbolAsync(a);if(!i)continue;h.symbol=i.toJSON(),\"hasVisualVariables\"in t&&t.hasVisualVariables()&&N(h.symbol,{renderer:t,graphic:a,symbol:i})}if(h.symbol&&(h.symbol.angle||delete h.symbol.angle,De(h.symbol)?h.symbol=await Se(h.symbol,r):h.symbol.text&&delete h.attributes),(!i||!i.forceFeatureAttributes)&&m&&m.length){const e={};m.forEach((t=>{h.attributes&&h.attributes.hasOwnProperty(t)&&(e[t]=h.attributes[t])})),h.attributes=e}\"polygon\"===a.geometry.type?n.featureSet.features.push(h):\"polyline\"===a.geometry.type?s.featureSet.features.push(h):\"point\"===a.geometry.type?h.symbol&&h.symbol.text?u.featureSet.features.push(h):o.featureSet.features.push(h):\"multipoint\"===a.geometry.type?l.featureSet.features.push(h):\"extent\"===a.geometry.type&&(h.geometry=y.fromExtent(a.geometry).toJSON(),n.featureSet.features.push(h))}const b=[n,s,l,o,u].filter((e=>e.featureSet.features.length>0));for(const y of b){const e=y.featureSet.features.every((e=>e.symbol));!e||i&&i.forceFeatureAttributes||y.featureSet.features.forEach((e=>{delete e.attributes})),e&&delete y.layerDefinition.drawingInfo,y.layerDefinition.drawingInfo&&y.layerDefinition.drawingInfo.renderer&&await xe(y.layerDefinition.drawingInfo.renderer,r)}return b.length?{featureCollection:{layers:b},showLabels:a}:null}async function ae(e,t,i){var r,a;let n;i.legendLayers&&i.legendLayers.push({id:e.id});const s=e.renderer;if(e.featureReduction||s&&\"dot-density\"===s.type&&(!i.is11xService||parseFloat(i.cimVersion)<2.6))return fe(e,t,i);const{layerView:o,printTemplate:l,view:u}=t,c=s&&(\"valueExpression\"in s&&s.valueExpression||\"hasVisualVariables\"in s&&s.hasVisualVariables()),y=\"feature-layer\"!==(null==(r=e.source)?void 0:r.type)&&\"ogc-feature\"!==(null==(a=e.source)?void 0:a.type);if(!i.is11xService&&c||e.featureReduction||y||!s||\"field\"in s&&null!=s.field&&(\"string\"!=typeof s.field||!e.getField(s.field))){const t=await ve(o);n=await re(e,t,l,i)}else{var m,p;if(n={id:(d=e.write()).id,title:d.title,opacity:d.opacity,minScale:d.minScale,maxScale:d.maxScale,url:d.url,layerDefinition:d.layerDefinition},n.showLabels=l.showLabels&&e.labelsVisible,we(n,e),null!=(m=n.layerDefinition)&&null!=(p=m.drawingInfo)&&p.renderer&&(delete n.layerDefinition.minScale,delete n.layerDefinition.maxScale,await xe(n.layerDefinition.drawingInfo.renderer,i),\"visualVariables\"in s&&s.visualVariables&&s.visualVariables[0])){const e=s.visualVariables[0];if(\"size\"===e.type&&e.maxSize&&\"number\"!=typeof e.maxSize&&e.minSize&&\"number\"!=typeof e.minSize){const t=f(e,u.scale);n.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,n.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}}var d;return n}async function ne(e,{layerView:t,printTemplate:i},r){r.legendLayers&&r.legendLayers.push({id:e.id});return re(e,await ve(t),i,r)}async function se(e,{printTemplate:t},i){return re(e,null,t,i)}function oe(e,t){t.legendLayers&&t.legendLayers.push({id:e.id});const i={bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation};if((e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(t.is11xService)e.renderingRule&&(i.renderingRule=e.renderingRule.toJSON()),e.renderer&&(i.layerDefinition=i.layerDefinition||{},i.layerDefinition.drawingInfo=i.layerDefinition.drawingInfo||{},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const t=e.exportImageServiceParameters.combineRendererWithRenderingRule();t&&(i.renderingRule=t.toJSON())}return we(i,e),i}async function le(e,t,i){const r=t.printTemplate;if(i.is11xService){const t={type:\"kml\"};return e.write(t,{origin:\"web-map\"}),delete t.layerType,t.url=u(e.url),t}{const a=[],n=t.layerView;n.allVisibleMapImages.forEach(((t,i)=>{const r={id:`${e.id}_image${i}`,type:\"image\",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:t.extent};\"data:image/png;base64,\"===t.href.substr(0,22)?r.imageData=t.href.substr(22):r.url=t.href,a.push(r)}));const s=[...n.allVisiblePoints.items,...n.allVisiblePolylines.items,...n.allVisiblePolygons.items],o={id:e.id,...await re(null,s,r,i)};return a.push(o),a}}function ue(e,{view:t},i){let r;const a={id:e.id,subLayerIds:[]};let n=[];const s=t.scale,o=e=>{const t=0===s,i=0===e.minScale||s<=e.minScale,r=0===e.maxScale||s>=e.maxScale;if(e.visible&&(t||i&&r))if(e.sublayers)e.sublayers.forEach(o);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{drawingInfo:t.drawingInfo,definitionExpression:t.definitionExpression,source:t.source}};n.unshift(i),a.subLayerIds.push(e.id)}};return e.sublayers&&e.sublayers.forEach(o),n.length&&(n=n.map((({id:e,name:t,layerDefinition:i})=>({id:e,name:t,layerDefinition:i}))),r={layers:n,visibleLayers:e.capabilities.exportMap.supportsDynamicLayers?void 0:a.subLayerIds},we(r,e),i.legendLayers.push(a)),r}async function ce({layerView:e,printTemplate:t},i){const r=[],a=e.layer;if(n(a.featureCollections))for(const n of a.featureCollections){const e=await re(n,n.source,t,i);e&&r.push(...e.featureCollection.layers)}else if(n(a.sublayers))for(const n of a.sublayers){const e=await re(null,n.graphics,t,i);e&&r.push(...e.featureCollection.layers)}return{featureCollection:{layers:r}}}function ye(){return{type:\"OpenStreetMap\"}}async function fe(e,{printTemplate:t,view:i},r){const a={type:\"image\"},n={format:\"png\",ignoreBackground:!0,layers:[e],rotation:0},o=r.ssExtent||i.extent.clone();let l=96,u=!0,y=!0;if(t.exportOptions){const e=t.exportOptions;e.dpi>0&&(l=e.dpi),e.width>0&&(u=e.width%2==i.width%2),e.height>0&&(y=e.height%2==i.height%2)}if(\"map-only\"===t.layout&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&96===l&&(!u||!y)&&(n.area={x:0,y:0,width:i.width,height:i.height},u||(n.area.width-=1),y||(n.area.height-=1),!r.ssExtent)){const e=i.toMap(s(n.area.width,n.area.height));o.ymin=e.y,o.xmax=e.x,r.ssExtent=o}a.extent=o.clone()._normalize(!0).toJSON();const f=await i.takeScreenshot(n),{data:m}=c(f.dataUrl);return a.imageData=m,a}async function me(e,{layerView:t,printTemplate:i},r){r.legendLayers&&r.legendLayers.push({id:e.id});return re(e,await ve(t),i,r)}function pe(e){const t={customParameters:e.customParameters};return we(t,e),t}async function de(e,i,r){if(r.is11xService&&e.serviceUrl&&e.styleUrl){const i=t&&t.findCredential(e.styleUrl),a=t&&t.findCredential(e.serviceUrl);if(!i&&!a||\"2.1.0\"!==r.cimVersion){const t={type:\"VectorTileLayer\"};return t.styleUrl=u(e.styleUrl),i&&(t.token=i.token),a&&a.token!==t.token&&(t.additionalTokens=[{url:e.serviceUrl,token:a.token}]),t}}return fe(e,i,r)}function ge(e){const t={type:\"WebTiledLayer\",urlTemplate:e.urlTemplate.replace(/\\${/g,\"{\"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function he(e){let t;const i=[],r=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(r):e.name&&i.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(r),i.length&&(t={type:\"wms\",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:u(e.url),version:e.version}),t}function be(e){const t=e.activeLayer;return{type:\"wmts\",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:u(e.url)}}function we(i,r){if(r.url)if(i.url=u(i.url||r.url),\"apiKey\"in r&&r.apiKey)i.token=r.apiKey;else if(e.apiKey&&$(r.url))i.token=e.apiKey;else{var a,n;i.token=null==(a=t)||null==(n=a.findCredential(r.url))?void 0:n.token}}async function Se(e,t){t.canvas||(t.canvas=document.createElement(\"canvas\"));const r=1024;t.canvas.width=r,t.canvas.height=r;const a=t.canvas.getContext(\"2d\");let n,s;if(e.path){var u;const t=new Path2D(e.path);t.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:\"rgb(0,0,0)\",a.fill(t);const i=J(a);if(!i)return null;a.clearRect(0,0,r,r);const l=o(e.size)/Math.max(i.width,i.height);a.scale(l,l);const c=r/l,y=c/2-i.width/2-i.x,f=c/2-i.height/2-i.y;if(a.translate(y,f),Array.isArray(e.color)&&a.fill(t),null!=(u=e.outline)&&u.width&&Array.isArray(e.outline.color)){const r=e.outline;a.lineWidth=o(r.width)/l,a.lineJoin=\"round\",a.strokeStyle=`rgba(${r.color[0]},${r.color[1]},${r.color[2]},${r.color[3]/255})`,a.stroke(t),i.width+=a.lineWidth,i.height+=a.lineWidth}i.width*=l,i.height*=l;const m=a.getImageData(r/2-i.width/2,r/2-i.height/2,Math.ceil(i.width),Math.ceil(i.height));n=m.width,s=m.height,a.canvas.width=n,a.canvas.height=s,a.putImageData(m,0,0)}else{const t=\"image/svg+xml\"===e.contentType?\"data:image/svg+xml;base64,\"+e.imageData:e.url,r=(await i(t,{responseType:\"image\"})).data;n=o(e.width),s=o(e.height),a.canvas.width=n,a.canvas.height=s,a.drawImage(r,0,0,a.canvas.width,a.canvas.height)}return{type:\"esriPMS\",imageData:a.canvas.toDataURL(\"image/png\").substr(22),angle:e.angle,contentType:\"image/png\",height:l(s),width:l(n),xoffset:e.xoffset,yoffset:e.yoffset}}async function xe(e,t){const i=e.type;if(\"simple\"===i&&De(e.symbol))e.symbol=await Se(e.symbol,t);else if(\"uniqueValue\"===i||\"classBreaks\"===i){De(e.defaultSymbol)&&(e.defaultSymbol=await Se(e.defaultSymbol,t));const r=e[\"uniqueValue\"===i?\"uniqueValueInfos\":\"classBreakInfos\"];if(r)for(const e of r)De(e.symbol)&&(e.symbol=await Se(e.symbol,t))}}async function ve(e){return e.queryFeatures(B).then((e=>e.features))}function Ie(e){return e.gpMetadata&&e.gpMetadata.executionType?W.fromJSON(e.gpMetadata.executionType):\"sync\"}function De(e){return e&&(e.path||\"image/svg+xml\"===e.contentType||e.url&&e.url.endsWith(\".svg\"))}export{Q as execute,X as getGpPrintParams,Z as getGpServerUrl,H as getMode,G as printCacheMap};\n"]},"metadata":{},"sourceType":"module"}