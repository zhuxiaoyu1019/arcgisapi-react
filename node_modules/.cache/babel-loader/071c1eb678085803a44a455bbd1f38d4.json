{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { clamp as e } from \"../../../../core/mathUtils.js\";\nimport { isNone as t } from \"../../../../core/maybe.js\";\nimport { fromValues as i } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { BufferViewVec4f as s } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { newLayout as a } from \"../../support/buffer/InterleavedLayout.js\";\nimport { computeAttachmentOriginLines as r } from \"../lib/geometryDataUtils.js\";\nimport n from \"../lib/GLMaterial.js\";\nimport { Material as o, materialParametersDefaults as u } from \"../lib/Material.js\";\nimport { isPathGeometry as h } from \"../lib/PathGeometry.js\";\nimport { assert as c } from \"../lib/Util.js\";\nimport { pathVertexAttributeLocations as l, PathTechniqueConfiguration as p, PathTechnique as d } from \"./PathTechnique.js\";\nimport f from \"./VisualVariableMaterialParameters.js\";\nimport { writeDefaultAttributes as m, writeBufferVec4 as b } from \"./internal/bufferWriterUtils.js\";\nimport { intersectAabbInvDir as v } from \"./internal/MaterialUtil.js\";\nconst g = c;\n\nclass S extends o {\n  constructor(e) {\n    super(e, y), this.supportsEdges = !0, this._vertexAttributeLocations = l, this.techniqueConfig = new p(), this.vertexBufferLayout = S.getVertexBufferLayout(this.params);\n  }\n\n  getTechniqueConfig(e, t) {\n    return this.techniqueConfig.output = e, this.techniqueConfig.vvSize = this.params.vvSizeEnabled, this.techniqueConfig.vvColor = this.params.vvColorEnabled, this.techniqueConfig.vvOpacity = this.params.vvOpacityEnabled, this.techniqueConfig.slicePlaneEnabled = this.params.slicePlaneEnabled, this.techniqueConfig.transparent = this.params.transparent, this.techniqueConfig.sceneHasOcludees = this.params.sceneHasOcludees, 0 !== e && 7 !== e || (this.techniqueConfig.doubleSidedMode = this.params.doubleSided && \"normal\" === this.params.doubleSidedType ? 1 : this.params.doubleSided && \"winding-order\" === this.params.doubleSidedType ? 2 : 0, this.techniqueConfig.receiveShadows = this.params.receiveShadows, this.techniqueConfig.receiveSSAO = !(!t || !t.ssaoEnabled) && this.params.receiveSSAO), this.techniqueConfig.transparencyPassType = t ? t.transparencyPassType : 3, this.techniqueConfig.multipassTerrainEnabled = !!t && t.multipassTerrainEnabled, this.techniqueConfig.cullAboveGround = !!t && t.cullAboveGround, this.techniqueConfig;\n  }\n\n  getPassParameters() {\n    return this.params;\n  }\n\n  isVisibleInPass(e) {\n    return 4 !== e && 6 !== e && 7 !== e || this.params.castShadows;\n  }\n\n  isVisible() {\n    const e = this.params;\n    return !!super.isVisible() && e.opacity > 0;\n  }\n\n  intersect(s, a, r, n, o, u, c) {\n    const l = s;\n    if (!h(l)) return;\n    const p = l.path,\n          d = [this.params.size[0], this.params.size[1]];\n\n    if (this.params.vvSizeEnabled) {\n      const t = this.params.vvSizeOffset,\n            i = this.params.vvSizeFactor,\n            s = this.params.vvSizeMinSize,\n            a = this.params.vvSizeMaxSize,\n            r = p.sizeAttributeValue;\n      d[0] *= e(t[0] + r * i[0], s[0], a[0]), d[1] *= e(t[2] + r * i[2], s[2], a[2]);\n    }\n\n    const f = Math.max(d[0], d[1]),\n          m = s.boundingInfo;\n    if (t(m)) return void this._intersectTriangles(p, d, o, u, c);\n    const b = i(m.bbMin[0] - f, m.bbMin[1] - f, m.bbMin[2] - f, m.bbMax[0] + f, m.bbMax[1] + f, m.bbMax[2] + f),\n          g = [u[0] - o[0], u[1] - o[1], u[2] - o[2]],\n          S = Math.sqrt(g[0] * g[0] + g[1] * g[1] + g[2] * g[2]),\n          q = [S / g[0], S / g[1], S / g[2]];\n    v(b, o, q, n.tolerance) && this._intersectTriangles(p, d, o, u, c);\n  }\n\n  _intersectTriangles(e, t, i, s, a) {\n    e.baked.size && e.baked.size[0] === t[0] && e.baked.size[1] === t[1] || e.baked.bake(t), e.baked.intersect(i, s, a);\n  }\n\n  computeAttachmentOrigin(e, t) {\n    const i = e.vertexAttributes;\n    if (!i) return null;\n    const s = i.get(\"position\");\n    return r(s, null, !1, t);\n  }\n\n  createBufferWriter() {\n    return new x(this.vertexBufferLayout);\n  }\n\n  getGLMaterial(e) {\n    if (0 === e.output || 7 === e.output || 1 === e.output || 2 === e.output || 4 === e.output || 3 === e.output && this.params.castShadows) return new q(e);\n  }\n\n  static getVertexBufferLayout(e) {\n    let t = a().vec3f(\"position\").vec4f(\"profileRight\").vec4f(\"profileUp\").vec4f(\"profileVertexAndNormal\");\n    return (e.vvColorEnabled || e.vvSizeEnabled || e.vvOpacityEnabled) && (t = t.vec4f(\"featureValue\")), t;\n  }\n\n}\n\nclass q extends n {\n  constructor(e) {\n    super(e), this.updateParameters();\n  }\n\n  updateParameters(e) {\n    this._technique = this._techniqueRep.releaseAndAcquire(d, this._material.getTechniqueConfig(this._output, e), this._technique);\n  }\n\n  beginSlot(e) {\n    return e === (this._technique.configuration.transparent ? 5 : 3);\n  }\n\n  _updateOccludeeState(e) {\n    e.hasOccludees !== this._material.params.sceneHasOcludees && this._material.setParameterValues({\n      sceneHasOcludees: e.hasOccludees\n    });\n  }\n\n  _updateShadowState(e) {\n    e.shadowMappingEnabled !== this._technique.configuration.receiveShadows && this._material.setParameterValues({\n      receiveShadows: e.shadowMappingEnabled\n    });\n  }\n\n  ensureParameters(e) {\n    0 !== this._output && 7 !== this._output || (this._updateShadowState(e), this._updateOccludeeState(e)), this.updateParameters(e);\n  }\n\n  bind(e) {\n    this._technique.bindPass(this._material.getPassParameters(), e);\n  }\n\n}\n\nconst y = {\n  size: [1, 1, 1],\n  ambient: [.2, .2, .2],\n  diffuse: [.8, .8, .8],\n  specular: [0, 0, 0],\n  opacity: 1,\n  doubleSided: !1,\n  doubleSidedType: \"normal\",\n  receiveSSAO: !0,\n  receiveShadows: !1,\n  castShadows: !0,\n  slicePlaneEnabled: !1,\n  transparent: !1,\n  sceneHasOcludees: !1,\n  ...f.Default,\n  ...u\n};\n\nclass x {\n  constructor(e) {\n    this.vertexBufferLayout = e;\n  }\n\n  allocate(e) {\n    return this.vertexBufferLayout.createBuffer(e);\n  }\n\n  elementCount(e) {\n    return e.indices.get(\"position\").length;\n  }\n\n  write(e, t, i, a) {\n    const r = e => {\n      if (t.vertexAttributes.has(e)) {\n        const r = t.vertexAttributes.get(e),\n              n = t.indices.get(e);\n        g(4 === r.size);\n        const o = i.getField(e, s);\n        if (!o) throw new Error(\"unable to acquire view for \" + e);\n        b(n, r.data, o, a);\n      }\n    };\n\n    r(\"profileRight\"), r(\"profileUp\"), r(\"profileVertexAndNormal\"), this.vertexBufferLayout.hasField(\"featureValue\") && r(\"featureValue\"), m(t, this.vertexBufferLayout, e.transformation, e.invTranspTransformation, i, a);\n  }\n\n}\n\nexport { S as PathMaterial };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/materials/PathMaterial.js"],"names":["clamp","e","isNone","t","fromValues","i","BufferViewVec4f","s","newLayout","a","computeAttachmentOriginLines","r","n","Material","o","materialParametersDefaults","u","isPathGeometry","h","assert","c","pathVertexAttributeLocations","l","PathTechniqueConfiguration","p","PathTechnique","d","f","writeDefaultAttributes","m","writeBufferVec4","b","intersectAabbInvDir","v","g","S","constructor","y","supportsEdges","_vertexAttributeLocations","techniqueConfig","vertexBufferLayout","getVertexBufferLayout","params","getTechniqueConfig","output","vvSize","vvSizeEnabled","vvColor","vvColorEnabled","vvOpacity","vvOpacityEnabled","slicePlaneEnabled","transparent","sceneHasOcludees","doubleSidedMode","doubleSided","doubleSidedType","receiveShadows","receiveSSAO","ssaoEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","getPassParameters","isVisibleInPass","castShadows","isVisible","opacity","intersect","path","size","vvSizeOffset","vvSizeFactor","vvSizeMinSize","vvSizeMaxSize","sizeAttributeValue","Math","max","boundingInfo","_intersectTriangles","bbMin","bbMax","sqrt","q","tolerance","baked","bake","computeAttachmentOrigin","vertexAttributes","get","createBufferWriter","x","getGLMaterial","vec3f","vec4f","updateParameters","_technique","_techniqueRep","releaseAndAcquire","_material","_output","beginSlot","configuration","_updateOccludeeState","hasOccludees","setParameterValues","_updateShadowState","shadowMappingEnabled","ensureParameters","bind","bindPass","ambient","diffuse","specular","Default","allocate","createBuffer","elementCount","indices","length","write","has","getField","Error","data","hasField","transformation","invTranspTransformation","PathMaterial"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,KAAK,IAAIC,CAAhB,QAAsB,+BAAtB;AAAsD,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,2BAAvB;AAAmD,SAAOC,UAAU,IAAIC,CAArB,QAA2B,+CAA3B;AAA2E,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,mDAAhC;AAAoF,SAAOC,SAAS,IAAIC,CAApB,QAA0B,2CAA1B;AAAsE,SAAOC,4BAA4B,IAAIC,CAAvC,QAA6C,6BAA7C;AAA2E,OAAOC,CAAP,MAAa,sBAAb;AAAoC,SAAOC,QAAQ,IAAIC,CAAnB,EAAqBC,0BAA0B,IAAIC,CAAnD,QAAyD,oBAAzD;AAA8E,SAAOC,cAAc,IAAIC,CAAzB,QAA+B,wBAA/B;AAAwD,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,gBAAvB;AAAwC,SAAOC,4BAA4B,IAAIC,CAAvC,EAAyCC,0BAA0B,IAAIC,CAAvE,EAAyEC,aAAa,IAAIC,CAA1F,QAAgG,oBAAhG;AAAqH,OAAOC,CAAP,MAAa,uCAAb;AAAqD,SAAOC,sBAAsB,IAAIC,CAAjC,EAAmCC,eAAe,IAAIC,CAAtD,QAA4D,iCAA5D;AAA8F,SAAOC,mBAAmB,IAAIC,CAA9B,QAAoC,4BAApC;AAAiE,MAAMC,CAAC,GAACd,CAAR;;AAAU,MAAMe,CAAN,SAAgBrB,CAAhB,CAAiB;AAACsB,EAAAA,WAAW,CAACnC,CAAD,EAAG;AAAC,UAAMA,CAAN,EAAQoC,CAAR,GAAW,KAAKC,aAAL,GAAmB,CAAC,CAA/B,EAAiC,KAAKC,yBAAL,GAA+BjB,CAAhE,EAAkE,KAAKkB,eAAL,GAAqB,IAAIhB,CAAJ,EAAvF,EAA6F,KAAKiB,kBAAL,GAAwBN,CAAC,CAACO,qBAAF,CAAwB,KAAKC,MAA7B,CAArH;AAA0J;;AAAAC,EAAAA,kBAAkB,CAAC3C,CAAD,EAAGE,CAAH,EAAK;AAAC,WAAO,KAAKqC,eAAL,CAAqBK,MAArB,GAA4B5C,CAA5B,EAA8B,KAAKuC,eAAL,CAAqBM,MAArB,GAA4B,KAAKH,MAAL,CAAYI,aAAtE,EAAoF,KAAKP,eAAL,CAAqBQ,OAArB,GAA6B,KAAKL,MAAL,CAAYM,cAA7H,EAA4I,KAAKT,eAAL,CAAqBU,SAArB,GAA+B,KAAKP,MAAL,CAAYQ,gBAAvL,EAAwM,KAAKX,eAAL,CAAqBY,iBAArB,GAAuC,KAAKT,MAAL,CAAYS,iBAA3P,EAA6Q,KAAKZ,eAAL,CAAqBa,WAArB,GAAiC,KAAKV,MAAL,CAAYU,WAA1T,EAAsU,KAAKb,eAAL,CAAqBc,gBAArB,GAAsC,KAAKX,MAAL,CAAYW,gBAAxX,EAAyY,MAAIrD,CAAJ,IAAO,MAAIA,CAAX,KAAe,KAAKuC,eAAL,CAAqBe,eAArB,GAAqC,KAAKZ,MAAL,CAAYa,WAAZ,IAAyB,aAAW,KAAKb,MAAL,CAAYc,eAAhD,GAAgE,CAAhE,GAAkE,KAAKd,MAAL,CAAYa,WAAZ,IAAyB,oBAAkB,KAAKb,MAAL,CAAYc,eAAvD,GAAuE,CAAvE,GAAyE,CAAhL,EAAkL,KAAKjB,eAAL,CAAqBkB,cAArB,GAAoC,KAAKf,MAAL,CAAYe,cAAlO,EAAiP,KAAKlB,eAAL,CAAqBmB,WAArB,GAAiC,EAAE,CAACxD,CAAD,IAAI,CAACA,CAAC,CAACyD,WAAT,KAAuB,KAAKjB,MAAL,CAAYgB,WAApU,CAAzY,EAA0tB,KAAKnB,eAAL,CAAqBqB,oBAArB,GAA0C1D,CAAC,GAACA,CAAC,CAAC0D,oBAAH,GAAwB,CAA7xB,EAA+xB,KAAKrB,eAAL,CAAqBsB,uBAArB,GAA6C,CAAC,CAAC3D,CAAF,IAAKA,CAAC,CAAC2D,uBAAn1B,EAA22B,KAAKtB,eAAL,CAAqBuB,eAArB,GAAqC,CAAC,CAAC5D,CAAF,IAAKA,CAAC,CAAC4D,eAAv5B,EAAu6B,KAAKvB,eAAn7B;AAAm8B;;AAAAwB,EAAAA,iBAAiB,GAAE;AAAC,WAAO,KAAKrB,MAAZ;AAAmB;;AAAAsB,EAAAA,eAAe,CAAChE,CAAD,EAAG;AAAC,WAAO,MAAIA,CAAJ,IAAO,MAAIA,CAAX,IAAc,MAAIA,CAAlB,IAAqB,KAAK0C,MAAL,CAAYuB,WAAxC;AAAoD;;AAAAC,EAAAA,SAAS,GAAE;AAAC,UAAMlE,CAAC,GAAC,KAAK0C,MAAb;AAAoB,WAAM,CAAC,CAAC,MAAMwB,SAAN,EAAF,IAAqBlE,CAAC,CAACmE,OAAF,GAAU,CAArC;AAAuC;;AAAAC,EAAAA,SAAS,CAAC9D,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAASE,CAAT,EAAWE,CAAX,EAAaI,CAAb,EAAe;AAAC,UAAME,CAAC,GAACf,CAAR;AAAU,QAAG,CAACW,CAAC,CAACI,CAAD,CAAL,EAAS;AAAO,UAAME,CAAC,GAACF,CAAC,CAACgD,IAAV;AAAA,UAAe5C,CAAC,GAAC,CAAC,KAAKiB,MAAL,CAAY4B,IAAZ,CAAiB,CAAjB,CAAD,EAAqB,KAAK5B,MAAL,CAAY4B,IAAZ,CAAiB,CAAjB,CAArB,CAAjB;;AAA2D,QAAG,KAAK5B,MAAL,CAAYI,aAAf,EAA6B;AAAC,YAAM5C,CAAC,GAAC,KAAKwC,MAAL,CAAY6B,YAApB;AAAA,YAAiCnE,CAAC,GAAC,KAAKsC,MAAL,CAAY8B,YAA/C;AAAA,YAA4DlE,CAAC,GAAC,KAAKoC,MAAL,CAAY+B,aAA1E;AAAA,YAAwFjE,CAAC,GAAC,KAAKkC,MAAL,CAAYgC,aAAtG;AAAA,YAAoHhE,CAAC,GAACa,CAAC,CAACoD,kBAAxH;AAA2IlD,MAAAA,CAAC,CAAC,CAAD,CAAD,IAAMzB,CAAC,CAACE,CAAC,CAAC,CAAD,CAAD,GAAKQ,CAAC,GAACN,CAAC,CAAC,CAAD,CAAT,EAAaE,CAAC,CAAC,CAAD,CAAd,EAAkBE,CAAC,CAAC,CAAD,CAAnB,CAAP,EAA+BiB,CAAC,CAAC,CAAD,CAAD,IAAMzB,CAAC,CAACE,CAAC,CAAC,CAAD,CAAD,GAAKQ,CAAC,GAACN,CAAC,CAAC,CAAD,CAAT,EAAaE,CAAC,CAAC,CAAD,CAAd,EAAkBE,CAAC,CAAC,CAAD,CAAnB,CAAtC;AAA8D;;AAAA,UAAMkB,CAAC,GAACkD,IAAI,CAACC,GAAL,CAASpD,CAAC,CAAC,CAAD,CAAV,EAAcA,CAAC,CAAC,CAAD,CAAf,CAAR;AAAA,UAA4BG,CAAC,GAACtB,CAAC,CAACwE,YAAhC;AAA6C,QAAG5E,CAAC,CAAC0B,CAAD,CAAJ,EAAQ,OAAO,KAAK,KAAKmD,mBAAL,CAAyBxD,CAAzB,EAA2BE,CAA3B,EAA6BZ,CAA7B,EAA+BE,CAA/B,EAAiCI,CAAjC,CAAZ;AAAgD,UAAMW,CAAC,GAAC1B,CAAC,CAACwB,CAAC,CAACoD,KAAF,CAAQ,CAAR,IAAWtD,CAAZ,EAAcE,CAAC,CAACoD,KAAF,CAAQ,CAAR,IAAWtD,CAAzB,EAA2BE,CAAC,CAACoD,KAAF,CAAQ,CAAR,IAAWtD,CAAtC,EAAwCE,CAAC,CAACqD,KAAF,CAAQ,CAAR,IAAWvD,CAAnD,EAAqDE,CAAC,CAACqD,KAAF,CAAQ,CAAR,IAAWvD,CAAhE,EAAkEE,CAAC,CAACqD,KAAF,CAAQ,CAAR,IAAWvD,CAA7E,CAAT;AAAA,UAAyFO,CAAC,GAAC,CAAClB,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC,CAAD,CAAP,EAAWE,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC,CAAD,CAAjB,EAAqBE,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC,CAAD,CAA3B,CAA3F;AAAA,UAA2HqB,CAAC,GAAC0C,IAAI,CAACM,IAAL,CAAUjD,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAAN,GAAUA,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAAhB,GAAoBA,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAApC,CAA7H;AAAA,UAAsKkD,CAAC,GAAC,CAACjD,CAAC,GAACD,CAAC,CAAC,CAAD,CAAJ,EAAQC,CAAC,GAACD,CAAC,CAAC,CAAD,CAAX,EAAeC,CAAC,GAACD,CAAC,CAAC,CAAD,CAAlB,CAAxK;AAA+LD,IAAAA,CAAC,CAACF,CAAD,EAAGjB,CAAH,EAAKsE,CAAL,EAAOxE,CAAC,CAACyE,SAAT,CAAD,IAAsB,KAAKL,mBAAL,CAAyBxD,CAAzB,EAA2BE,CAA3B,EAA6BZ,CAA7B,EAA+BE,CAA/B,EAAiCI,CAAjC,CAAtB;AAA0D;;AAAA4D,EAAAA,mBAAmB,CAAC/E,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASE,CAAT,EAAW;AAACR,IAAAA,CAAC,CAACqF,KAAF,CAAQf,IAAR,IAActE,CAAC,CAACqF,KAAF,CAAQf,IAAR,CAAa,CAAb,MAAkBpE,CAAC,CAAC,CAAD,CAAjC,IAAsCF,CAAC,CAACqF,KAAF,CAAQf,IAAR,CAAa,CAAb,MAAkBpE,CAAC,CAAC,CAAD,CAAzD,IAA8DF,CAAC,CAACqF,KAAF,CAAQC,IAAR,CAAapF,CAAb,CAA9D,EAA8EF,CAAC,CAACqF,KAAF,CAAQjB,SAAR,CAAkBhE,CAAlB,EAAoBE,CAApB,EAAsBE,CAAtB,CAA9E;AAAuG;;AAAA+E,EAAAA,uBAAuB,CAACvF,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAME,CAAC,GAACJ,CAAC,CAACwF,gBAAV;AAA2B,QAAG,CAACpF,CAAJ,EAAM,OAAO,IAAP;AAAY,UAAME,CAAC,GAACF,CAAC,CAACqF,GAAF,CAAM,UAAN,CAAR;AAA0B,WAAO/E,CAAC,CAACJ,CAAD,EAAG,IAAH,EAAQ,CAAC,CAAT,EAAWJ,CAAX,CAAR;AAAsB;;AAAAwF,EAAAA,kBAAkB,GAAE;AAAC,WAAO,IAAIC,CAAJ,CAAM,KAAKnD,kBAAX,CAAP;AAAsC;;AAAAoD,EAAAA,aAAa,CAAC5F,CAAD,EAAG;AAAC,QAAG,MAAIA,CAAC,CAAC4C,MAAN,IAAc,MAAI5C,CAAC,CAAC4C,MAApB,IAA4B,MAAI5C,CAAC,CAAC4C,MAAlC,IAA0C,MAAI5C,CAAC,CAAC4C,MAAhD,IAAwD,MAAI5C,CAAC,CAAC4C,MAA9D,IAAsE,MAAI5C,CAAC,CAAC4C,MAAN,IAAc,KAAKF,MAAL,CAAYuB,WAAnG,EAA+G,OAAO,IAAIkB,CAAJ,CAAMnF,CAAN,CAAP;AAAgB;;AAA4B,SAArByC,qBAAqB,CAACzC,CAAD,EAAG;AAAC,QAAIE,CAAC,GAACM,CAAC,GAAGqF,KAAJ,CAAU,UAAV,EAAsBC,KAAtB,CAA4B,cAA5B,EAA4CA,KAA5C,CAAkD,WAAlD,EAA+DA,KAA/D,CAAqE,wBAArE,CAAN;AAAqG,WAAM,CAAC9F,CAAC,CAACgD,cAAF,IAAkBhD,CAAC,CAAC8C,aAApB,IAAmC9C,CAAC,CAACkD,gBAAtC,MAA0DhD,CAAC,GAACA,CAAC,CAAC4F,KAAF,CAAQ,cAAR,CAA5D,GAAqF5F,CAA3F;AAA6F;;AAA1pF;;AAA2pF,MAAMiF,CAAN,SAAgBxE,CAAhB,CAAiB;AAACwB,EAAAA,WAAW,CAACnC,CAAD,EAAG;AAAC,UAAMA,CAAN,GAAS,KAAK+F,gBAAL,EAAT;AAAiC;;AAAAA,EAAAA,gBAAgB,CAAC/F,CAAD,EAAG;AAAC,SAAKgG,UAAL,GAAgB,KAAKC,aAAL,CAAmBC,iBAAnB,CAAqCzE,CAArC,EAAuC,KAAK0E,SAAL,CAAexD,kBAAf,CAAkC,KAAKyD,OAAvC,EAA+CpG,CAA/C,CAAvC,EAAyF,KAAKgG,UAA9F,CAAhB;AAA0H;;AAAAK,EAAAA,SAAS,CAACrG,CAAD,EAAG;AAAC,WAAOA,CAAC,MAAI,KAAKgG,UAAL,CAAgBM,aAAhB,CAA8BlD,WAA9B,GAA0C,CAA1C,GAA4C,CAAhD,CAAR;AAA2D;;AAAAmD,EAAAA,oBAAoB,CAACvG,CAAD,EAAG;AAACA,IAAAA,CAAC,CAACwG,YAAF,KAAiB,KAAKL,SAAL,CAAezD,MAAf,CAAsBW,gBAAvC,IAAyD,KAAK8C,SAAL,CAAeM,kBAAf,CAAkC;AAACpD,MAAAA,gBAAgB,EAACrD,CAAC,CAACwG;AAApB,KAAlC,CAAzD;AAA8H;;AAAAE,EAAAA,kBAAkB,CAAC1G,CAAD,EAAG;AAACA,IAAAA,CAAC,CAAC2G,oBAAF,KAAyB,KAAKX,UAAL,CAAgBM,aAAhB,CAA8B7C,cAAvD,IAAuE,KAAK0C,SAAL,CAAeM,kBAAf,CAAkC;AAAChD,MAAAA,cAAc,EAACzD,CAAC,CAAC2G;AAAlB,KAAlC,CAAvE;AAAkJ;;AAAAC,EAAAA,gBAAgB,CAAC5G,CAAD,EAAG;AAAC,UAAI,KAAKoG,OAAT,IAAkB,MAAI,KAAKA,OAA3B,KAAqC,KAAKM,kBAAL,CAAwB1G,CAAxB,GAA2B,KAAKuG,oBAAL,CAA0BvG,CAA1B,CAAhE,GAA8F,KAAK+F,gBAAL,CAAsB/F,CAAtB,CAA9F;AAAuH;;AAAA6G,EAAAA,IAAI,CAAC7G,CAAD,EAAG;AAAC,SAAKgG,UAAL,CAAgBc,QAAhB,CAAyB,KAAKX,SAAL,CAAepC,iBAAf,EAAzB,EAA4D/D,CAA5D;AAA+D;;AAAvxB;;AAAwxB,MAAMoC,CAAC,GAAC;AAACkC,EAAAA,IAAI,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAN;AAAcyC,EAAAA,OAAO,EAAC,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP,CAAtB;AAAiCC,EAAAA,OAAO,EAAC,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP,CAAzC;AAAoDC,EAAAA,QAAQ,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAA7D;AAAqE9C,EAAAA,OAAO,EAAC,CAA7E;AAA+EZ,EAAAA,WAAW,EAAC,CAAC,CAA5F;AAA8FC,EAAAA,eAAe,EAAC,QAA9G;AAAuHE,EAAAA,WAAW,EAAC,CAAC,CAApI;AAAsID,EAAAA,cAAc,EAAC,CAAC,CAAtJ;AAAwJQ,EAAAA,WAAW,EAAC,CAAC,CAArK;AAAuKd,EAAAA,iBAAiB,EAAC,CAAC,CAA1L;AAA4LC,EAAAA,WAAW,EAAC,CAAC,CAAzM;AAA2MC,EAAAA,gBAAgB,EAAC,CAAC,CAA7N;AAA+N,KAAG3B,CAAC,CAACwF,OAApO;AAA4O,KAAGnG;AAA/O,CAAR;;AAA0P,MAAM4E,CAAN,CAAO;AAACxD,EAAAA,WAAW,CAACnC,CAAD,EAAG;AAAC,SAAKwC,kBAAL,GAAwBxC,CAAxB;AAA0B;;AAAAmH,EAAAA,QAAQ,CAACnH,CAAD,EAAG;AAAC,WAAO,KAAKwC,kBAAL,CAAwB4E,YAAxB,CAAqCpH,CAArC,CAAP;AAA+C;;AAAAqH,EAAAA,YAAY,CAACrH,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACsH,OAAF,CAAU7B,GAAV,CAAc,UAAd,EAA0B8B,MAAjC;AAAwC;;AAAAC,EAAAA,KAAK,CAACxH,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOI,CAAP,EAAS;AAAC,UAAME,CAAC,GAACV,CAAC,IAAE;AAAC,UAAGE,CAAC,CAACsF,gBAAF,CAAmBiC,GAAnB,CAAuBzH,CAAvB,CAAH,EAA6B;AAAC,cAAMU,CAAC,GAACR,CAAC,CAACsF,gBAAF,CAAmBC,GAAnB,CAAuBzF,CAAvB,CAAR;AAAA,cAAkCW,CAAC,GAACT,CAAC,CAACoH,OAAF,CAAU7B,GAAV,CAAczF,CAAd,CAApC;AAAqDiC,QAAAA,CAAC,CAAC,MAAIvB,CAAC,CAAC4D,IAAP,CAAD;AAAc,cAAMzD,CAAC,GAACT,CAAC,CAACsH,QAAF,CAAW1H,CAAX,EAAaM,CAAb,CAAR;AAAwB,YAAG,CAACO,CAAJ,EAAM,MAAM,IAAI8G,KAAJ,CAAU,gCAA8B3H,CAAxC,CAAN;AAAiD8B,QAAAA,CAAC,CAACnB,CAAD,EAAGD,CAAC,CAACkH,IAAL,EAAU/G,CAAV,EAAYL,CAAZ,CAAD;AAAgB;AAAC,KAA7M;;AAA8ME,IAAAA,CAAC,CAAC,cAAD,CAAD,EAAkBA,CAAC,CAAC,WAAD,CAAnB,EAAiCA,CAAC,CAAC,wBAAD,CAAlC,EAA6D,KAAK8B,kBAAL,CAAwBqF,QAAxB,CAAiC,cAAjC,KAAkDnH,CAAC,CAAC,cAAD,CAAhH,EAAiIkB,CAAC,CAAC1B,CAAD,EAAG,KAAKsC,kBAAR,EAA2BxC,CAAC,CAAC8H,cAA7B,EAA4C9H,CAAC,CAAC+H,uBAA9C,EAAsE3H,CAAtE,EAAwEI,CAAxE,CAAlI;AAA6M;;AAAvkB;;AAAwkB,SAAO0B,CAAC,IAAI8F,YAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{clamp as e}from\"../../../../core/mathUtils.js\";import{isNone as t}from\"../../../../core/maybe.js\";import{fromValues as i}from\"../../../../geometry/support/aaBoundingBox.js\";import{BufferViewVec4f as s}from\"../../../../geometry/support/buffer/BufferView.js\";import{newLayout as a}from\"../../support/buffer/InterleavedLayout.js\";import{computeAttachmentOriginLines as r}from\"../lib/geometryDataUtils.js\";import n from\"../lib/GLMaterial.js\";import{Material as o,materialParametersDefaults as u}from\"../lib/Material.js\";import{isPathGeometry as h}from\"../lib/PathGeometry.js\";import{assert as c}from\"../lib/Util.js\";import{pathVertexAttributeLocations as l,PathTechniqueConfiguration as p,PathTechnique as d}from\"./PathTechnique.js\";import f from\"./VisualVariableMaterialParameters.js\";import{writeDefaultAttributes as m,writeBufferVec4 as b}from\"./internal/bufferWriterUtils.js\";import{intersectAabbInvDir as v}from\"./internal/MaterialUtil.js\";const g=c;class S extends o{constructor(e){super(e,y),this.supportsEdges=!0,this._vertexAttributeLocations=l,this.techniqueConfig=new p,this.vertexBufferLayout=S.getVertexBufferLayout(this.params)}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,0!==e&&7!==e||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&\"normal\"===this.params.doubleSidedType?1:this.params.doubleSided&&\"winding-order\"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO),this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}isVisible(){const e=this.params;return!!super.isVisible()&&e.opacity>0}intersect(s,a,r,n,o,u,c){const l=s;if(!h(l))return;const p=l.path,d=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){const t=this.params.vvSizeOffset,i=this.params.vvSizeFactor,s=this.params.vvSizeMinSize,a=this.params.vvSizeMaxSize,r=p.sizeAttributeValue;d[0]*=e(t[0]+r*i[0],s[0],a[0]),d[1]*=e(t[2]+r*i[2],s[2],a[2])}const f=Math.max(d[0],d[1]),m=s.boundingInfo;if(t(m))return void this._intersectTriangles(p,d,o,u,c);const b=i(m.bbMin[0]-f,m.bbMin[1]-f,m.bbMin[2]-f,m.bbMax[0]+f,m.bbMax[1]+f,m.bbMax[2]+f),g=[u[0]-o[0],u[1]-o[1],u[2]-o[2]],S=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),q=[S/g[0],S/g[1],S/g[2]];v(b,o,q,n.tolerance)&&this._intersectTriangles(p,d,o,u,c)}_intersectTriangles(e,t,i,s,a){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(i,s,a)}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const s=i.get(\"position\");return r(s,null,!1,t)}createBufferWriter(){return new x(this.vertexBufferLayout)}getGLMaterial(e){if(0===e.output||7===e.output||1===e.output||2===e.output||4===e.output||3===e.output&&this.params.castShadows)return new q(e)}static getVertexBufferLayout(e){let t=a().vec3f(\"position\").vec4f(\"profileRight\").vec4f(\"profileUp\").vec4f(\"profileVertexAndNormal\");return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f(\"featureValue\")),t}}class q extends n{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(d,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return e===(this._technique.configuration.transparent?5:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}_updateShadowState(e){e.shadowMappingEnabled!==this._technique.configuration.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}ensureParameters(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const y={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:\"normal\",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...f.Default,...u};class x{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(\"position\").length}write(e,t,i,a){const r=e=>{if(t.vertexAttributes.has(e)){const r=t.vertexAttributes.get(e),n=t.indices.get(e);g(4===r.size);const o=i.getField(e,s);if(!o)throw new Error(\"unable to acquire view for \"+e);b(n,r.data,o,a)}};r(\"profileRight\"),r(\"profileUp\"),r(\"profileVertexAndNormal\"),this.vertexBufferLayout.hasField(\"featureValue\")&&r(\"featureValue\"),m(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a)}}export{S as PathMaterial};\n"]},"metadata":{},"sourceType":"module"}