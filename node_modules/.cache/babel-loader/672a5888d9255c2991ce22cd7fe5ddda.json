{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { i as t, r as s, m as e, b as i, t as h } from \"../../../../../../chunks/mat2d.js\";\nimport { c as n, t as o } from \"../../../../../../chunks/mat2df32.js\";\nimport { s as r, t as a } from \"../../../../../../chunks/vec2.js\";\nimport { c } from \"../../../../../../chunks/vec2f32.js\";\nimport { VAlign as d } from \"../../alignmentUtils.js\";\nimport { i1616to32 as f } from \"../../number.js\";\nimport l from \"../../Rect.js\";\nimport m from \"../../collisions/BoundingBox.js\";\n\nconst u = 26,\n      g = 4,\n      _ = u + g,\n      p = u - 6,\n      x = 3,\n      w = 8,\n      y = Math.PI / 180;\n\nclass T {\n  constructor(t, s, e, i) {\n    this._rotationT = n(), this._xBounds = 0, this._yBounds = 0, this.minZoom = 0, this.maxZoom = 255, this._bounds = null;\n    const h = e.rect,\n          o = new Float32Array(8);\n    t *= i, s *= i;\n    const r = e.code ? h.width * i : e.metrics.width,\n          a = e.code ? h.height * i : e.metrics.height;\n    o[0] = t, o[1] = s, o[2] = t + r, o[3] = s, o[4] = t, o[5] = s + a, o[6] = t + r, o[7] = s + a, this._data = o, this._setTextureCoords(h), this._scale = i, this._mosaic = e, this.x = t, this.y = s, this.maxOffset = Math.max(t + r, s + a);\n  }\n\n  get width() {\n    return this._mosaic.metrics.width * this._scale;\n  }\n\n  get mosaic() {\n    return this._mosaic;\n  }\n\n  set angle(e) {\n    this._angle = e, t(this._rotationT), s(this._rotationT, this._rotationT, -e), this._setOffsets(this._data);\n  }\n\n  get angle() {\n    return this._angle;\n  }\n\n  get xTopLeft() {\n    return this._data[0];\n  }\n\n  get yTopLeft() {\n    return this._data[1];\n  }\n\n  get xBottomRight() {\n    return this._data[6];\n  }\n\n  get yBottomRight() {\n    return this._data[7];\n  }\n\n  get texcoords() {\n    return this._texcoords;\n  }\n\n  get textureBinding() {\n    return this._mosaic.textureBinding;\n  }\n\n  get offsets() {\n    return this._offsets || this._setOffsets(this._data), this._offsets;\n  }\n\n  get char() {\n    return String.fromCharCode(this._mosaic.code);\n  }\n\n  get code() {\n    return this._mosaic.code;\n  }\n\n  get bounds() {\n    if (!this._bounds) {\n      const {\n        height: t,\n        width: s\n      } = this._mosaic.metrics,\n            i = s * this._scale,\n            h = Math.abs(t) * this._scale,\n            r = new Float32Array(8);\n\n      r[0] = this.x, r[1] = this.y, r[2] = this.x + i, r[3] = this.y, r[4] = this.x, r[5] = this.y + h, r[6] = this.x + i, r[7] = this.y + h;\n      const a = e(n(), this._rotationT, this._T);\n      o(r, r, a);\n      let c = 1 / 0,\n          d = 1 / 0,\n          f = 0,\n          l = 0;\n\n      for (let e = 0; e < 4; e++) {\n        const t = r[2 * e],\n              s = r[2 * e + 1];\n        c = Math.min(c, t), d = Math.min(d, s), f = Math.max(f, t), l = Math.max(l, s);\n      }\n\n      const u = f - c,\n            g = l - d,\n            _ = c + u / 2,\n            p = d + g / 2;\n\n      this._bounds = new m(_, p, u, g);\n    }\n\n    return this._bounds;\n  }\n\n  setTransform(t) {\n    this._T = t, this._offsets = null;\n  }\n\n  _setOffsets(t) {\n    this._offsets || (this._offsets = {\n      upperLeft: 0,\n      upperRight: 0,\n      lowerLeft: 0,\n      lowerRight: 0\n    });\n    const s = this._offsets,\n          i = new Float32Array(8),\n          h = e(n(), this._rotationT, this._T);\n    o(i, t, h), s.upperLeft = f(i[0] * w, i[1] * w), s.upperRight = f(i[2] * w, i[3] * w), s.lowerLeft = f(i[4] * w, i[5] * w), s.lowerRight = f(i[6] * w, i[7] * w);\n  }\n\n  _setTextureCoords({\n    x: t,\n    y: s,\n    width: e,\n    height: i\n  }) {\n    this._texcoords = {\n      upperLeft: f(t, s),\n      upperRight: f(t + e, s),\n      lowerLeft: f(t, s + i),\n      lowerRight: f(t + e, s + i)\n    };\n  }\n\n}\n\nconst M = (t, s) => ({\n  code: 0,\n  page: 0,\n  sdf: !0,\n  rect: new l(0, 0, 11, 8),\n  textureBinding: s,\n  metrics: {\n    advance: 0,\n    height: 4,\n    width: t,\n    left: 0,\n    top: 0\n  }\n});\n\nclass B {\n  constructor(t, s, e) {\n    this._rotation = 0, this._decorate(t, s, e), this.glyphs = t, this.bounds = this._createBounds(t), this.isMultiline = s.length > 1, this._hasRotation = 0 !== e.angle, this._T = this._createGlyphTransform(this.bounds, e);\n\n    for (const i of t) i.setTransform(this._T);\n  }\n\n  setRotation(t) {\n    if (0 === t && 0 === this._rotation) return;\n    this._rotation = t;\n    const s = this._T,\n          h = i(n(), t);\n    e(s, h, s);\n\n    for (const e of this.glyphs) e.setTransform(this._T);\n  }\n\n  _decorate(t, s, e) {\n    if (!e.decoration || \"none\" === e.decoration || !t.length) return;\n    const i = e.scale,\n          h = \"underline\" === e.decoration ? _ : p,\n          n = t[0].textureBinding;\n\n    for (const o of s) {\n      const s = o.startX * i,\n            e = o.startY * i,\n            r = (o.width + o.glyphWidthEnd) * i;\n      t.push(new T(s, e + h * i, M(r, n), 1));\n    }\n  }\n\n  get boundsT() {\n    const t = this.bounds,\n          s = r(c(), t.x, t.y);\n\n    if (a(s, s, this._T), this._hasRotation) {\n      const e = Math.max(t.width, t.height);\n      return new m(s[0], s[1], e, e);\n    }\n\n    return new m(s[0], s[1], t.width, t.height);\n  }\n\n  _createBounds(t) {\n    let s = 1 / 0,\n        e = 1 / 0,\n        i = 0,\n        h = 0;\n\n    for (const r of t) s = Math.min(s, r.xTopLeft), e = Math.min(e, r.yTopLeft), i = Math.max(i, r.xTopLeft + r.width), h = Math.max(h, r.yBottomRight);\n\n    const n = i - s,\n          o = h - e;\n    return new m(s + n / 2, e + o / 2, n, o);\n  }\n\n  _createGlyphTransform(t, e) {\n    const i = y * e.angle,\n          o = n(),\n          a = c();\n    return h(o, o, r(a, e.xOffset, -e.yOffset)), e.isCIM ? s(o, o, i) : (h(o, o, r(a, t.x, t.y)), s(o, o, i), h(o, o, r(a, -t.x, -t.y))), o;\n  }\n\n}\n\nclass b {\n  constructor(t, s, e, i, h, n) {\n    this.glyphWidthEnd = 0, this.startX = 0, this.startY = 0, this.start = Math.max(0, Math.min(s, e)), this.end = Math.max(0, Math.max(s, e)), this.end < t.length && (this.glyphWidthEnd = t[this.end].metrics.width), this.width = i, this.yMin = h, this.yMax = n;\n  }\n\n}\n\nconst R = t => 10 === t,\n      L = t => 32 === t;\n\nfunction v(t, s, e) {\n  const i = new Array(),\n        h = 1 / e.scale,\n        n = e.maxLineWidth * h,\n        o = s ? t.length - 1 : 0,\n        r = s ? -1 : t.length,\n        a = s ? -1 : 1;\n  let c = o,\n      d = 0,\n      f = 0,\n      l = c,\n      m = l,\n      u = 0,\n      g = 1 / 0,\n      _ = 0;\n\n  for (; c !== r;) {\n    const {\n      code: s,\n      metrics: e\n    } = t[c],\n          h = Math.abs(e.top);\n    if (R(s) || L(s) || (g = Math.min(g, h), _ = Math.max(_, h + e.height)), R(s)) c !== o && (i.push(new b(t, l, c - a, d, g, _)), g = 1 / 0, _ = 0), d = 0, l = c + a, m = c + a, f = 0;else if (L(s)) m = c + a, f = 0, u = e.advance, d += e.advance;else if (d > n) {\n      if (m !== l) {\n        const s = m - 2 * a;\n        d -= u, i.push(new b(t, l, s, d - f, g, _)), g = 1 / 0, _ = 0, l = m, d = f;\n      } else i.push(new b(t, l, c - a, d, g, _)), g = 1 / 0, _ = 0, l = c, m = c, d = 0;\n\n      d += e.advance, f += e.advance;\n    } else d += e.advance, f += e.advance;\n    c += a;\n  }\n\n  const p = new b(t, l, c - a, d, g, _);\n  return p.start >= 0 && p.end < t.length && i.push(p), i;\n}\n\nfunction j(t, s) {\n  let e = 0;\n\n  for (let n = 0; n < t.length; n++) {\n    const {\n      width: s\n    } = t[n];\n    e = Math.max(s, e);\n  }\n\n  const i = \"underline\" === s.decoration ? g : 0,\n        h = t[0].yMin;\n  return {\n    x: 0,\n    y: h,\n    height: t[t.length - 1].yMax + s.lineHeight * (t.length - 1) + i - h,\n    width: e\n  };\n}\n\nfunction A(t, s, e) {\n  const i = e.scale,\n        h = new Array(),\n        n = v(t, s, e),\n        o = j(n, e),\n        {\n    vAlign: r,\n    hAlign: a\n  } = e,\n        c = r === d.Baseline ? 1 : 0,\n        f = c ? 0 : r - 1,\n        l = (1 - c) * -o.y + f * (o.height / 2) + (c ? 1 : 0) * -u;\n\n  for (let d = 0; d < n.length; d++) {\n    const {\n      start: s,\n      end: o,\n      width: r\n    } = n[d];\n    let c = -1 * (a + 1) * (r / 2) - x;\n    const f = d * e.lineHeight + l - x;\n    n[d].startX = c, n[d].startY = f;\n\n    for (let e = s; e <= o; e++) {\n      const s = t[e];\n      if (R(s.code)) continue;\n      const n = new T(c + s.metrics.left, f - s.metrics.top, s, i);\n      c += s.metrics.advance, h.push(n);\n    }\n  }\n\n  return new B(h, n, e);\n}\n\nexport { T as ShapedGlyph, B as ShapingInfo, A as shapeGlyphs };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/shapingUtils.js"],"names":["i","t","r","s","m","e","b","h","c","n","o","a","VAlign","d","i1616to32","f","l","u","g","_","p","x","w","y","Math","PI","T","constructor","_rotationT","_xBounds","_yBounds","minZoom","maxZoom","_bounds","rect","Float32Array","code","width","metrics","height","_data","_setTextureCoords","_scale","_mosaic","maxOffset","max","mosaic","angle","_angle","_setOffsets","xTopLeft","yTopLeft","xBottomRight","yBottomRight","texcoords","_texcoords","textureBinding","offsets","_offsets","char","String","fromCharCode","bounds","abs","_T","min","setTransform","upperLeft","upperRight","lowerLeft","lowerRight","M","page","sdf","advance","left","top","B","_rotation","_decorate","glyphs","_createBounds","isMultiline","length","_hasRotation","_createGlyphTransform","setRotation","decoration","scale","startX","startY","glyphWidthEnd","push","boundsT","xOffset","yOffset","isCIM","start","end","yMin","yMax","R","L","v","Array","maxLineWidth","j","lineHeight","A","vAlign","hAlign","Baseline","ShapedGlyph","ShapingInfo","shapeGlyphs"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{i as t,r as s,m as e,b as i,t as h}from\"../../../../../../chunks/mat2d.js\";import{c as n,t as o}from\"../../../../../../chunks/mat2df32.js\";import{s as r,t as a}from\"../../../../../../chunks/vec2.js\";import{c}from\"../../../../../../chunks/vec2f32.js\";import{VAlign as d}from\"../../alignmentUtils.js\";import{i1616to32 as f}from\"../../number.js\";import l from\"../../Rect.js\";import m from\"../../collisions/BoundingBox.js\";const u=26,g=4,_=u+g,p=u-6,x=3,w=8,y=Math.PI/180;class T{constructor(t,s,e,i){this._rotationT=n(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const h=e.rect,o=new Float32Array(8);t*=i,s*=i;const r=e.code?h.width*i:e.metrics.width,a=e.code?h.height*i:e.metrics.height;o[0]=t,o[1]=s,o[2]=t+r,o[3]=s,o[4]=t,o[5]=s+a,o[6]=t+r,o[7]=s+a,this._data=o,this._setTextureCoords(h),this._scale=i,this._mosaic=e,this.x=t,this.y=s,this.maxOffset=Math.max(t+r,s+a)}get width(){return this._mosaic.metrics.width*this._scale}get mosaic(){return this._mosaic}set angle(e){this._angle=e,t(this._rotationT),s(this._rotationT,this._rotationT,-e),this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(this._data),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:s}=this._mosaic.metrics,i=s*this._scale,h=Math.abs(t)*this._scale,r=new Float32Array(8);r[0]=this.x,r[1]=this.y,r[2]=this.x+i,r[3]=this.y,r[4]=this.x,r[5]=this.y+h,r[6]=this.x+i,r[7]=this.y+h;const a=e(n(),this._rotationT,this._T);o(r,r,a);let c=1/0,d=1/0,f=0,l=0;for(let e=0;e<4;e++){const t=r[2*e],s=r[2*e+1];c=Math.min(c,t),d=Math.min(d,s),f=Math.max(f,t),l=Math.max(l,s)}const u=f-c,g=l-d,_=c+u/2,p=d+g/2;this._bounds=new m(_,p,u,g)}return this._bounds}setTransform(t){this._T=t,this._offsets=null}_setOffsets(t){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const s=this._offsets,i=new Float32Array(8),h=e(n(),this._rotationT,this._T);o(i,t,h),s.upperLeft=f(i[0]*w,i[1]*w),s.upperRight=f(i[2]*w,i[3]*w),s.lowerLeft=f(i[4]*w,i[5]*w),s.lowerRight=f(i[6]*w,i[7]*w)}_setTextureCoords({x:t,y:s,width:e,height:i}){this._texcoords={upperLeft:f(t,s),upperRight:f(t+e,s),lowerLeft:f(t,s+i),lowerRight:f(t+e,s+i)}}}const M=(t,s)=>({code:0,page:0,sdf:!0,rect:new l(0,0,11,8),textureBinding:s,metrics:{advance:0,height:4,width:t,left:0,top:0}});class B{constructor(t,s,e){this._rotation=0,this._decorate(t,s,e),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=s.length>1,this._hasRotation=0!==e.angle,this._T=this._createGlyphTransform(this.bounds,e);for(const i of t)i.setTransform(this._T)}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const s=this._T,h=i(n(),t);e(s,h,s);for(const e of this.glyphs)e.setTransform(this._T)}_decorate(t,s,e){if(!e.decoration||\"none\"===e.decoration||!t.length)return;const i=e.scale,h=\"underline\"===e.decoration?_:p,n=t[0].textureBinding;for(const o of s){const s=o.startX*i,e=o.startY*i,r=(o.width+o.glyphWidthEnd)*i;t.push(new T(s,e+h*i,M(r,n),1))}}get boundsT(){const t=this.bounds,s=r(c(),t.x,t.y);if(a(s,s,this._T),this._hasRotation){const e=Math.max(t.width,t.height);return new m(s[0],s[1],e,e)}return new m(s[0],s[1],t.width,t.height)}_createBounds(t){let s=1/0,e=1/0,i=0,h=0;for(const r of t)s=Math.min(s,r.xTopLeft),e=Math.min(e,r.yTopLeft),i=Math.max(i,r.xTopLeft+r.width),h=Math.max(h,r.yBottomRight);const n=i-s,o=h-e;return new m(s+n/2,e+o/2,n,o)}_createGlyphTransform(t,e){const i=y*e.angle,o=n(),a=c();return h(o,o,r(a,e.xOffset,-e.yOffset)),e.isCIM?s(o,o,i):(h(o,o,r(a,t.x,t.y)),s(o,o,i),h(o,o,r(a,-t.x,-t.y))),o}}class b{constructor(t,s,e,i,h,n){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(s,e)),this.end=Math.max(0,Math.max(s,e)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=i,this.yMin=h,this.yMax=n}}const R=t=>10===t,L=t=>32===t;function v(t,s,e){const i=new Array,h=1/e.scale,n=e.maxLineWidth*h,o=s?t.length-1:0,r=s?-1:t.length,a=s?-1:1;let c=o,d=0,f=0,l=c,m=l,u=0,g=1/0,_=0;for(;c!==r;){const{code:s,metrics:e}=t[c],h=Math.abs(e.top);if(R(s)||L(s)||(g=Math.min(g,h),_=Math.max(_,h+e.height)),R(s))c!==o&&(i.push(new b(t,l,c-a,d,g,_)),g=1/0,_=0),d=0,l=c+a,m=c+a,f=0;else if(L(s))m=c+a,f=0,u=e.advance,d+=e.advance;else if(d>n){if(m!==l){const s=m-2*a;d-=u,i.push(new b(t,l,s,d-f,g,_)),g=1/0,_=0,l=m,d=f}else i.push(new b(t,l,c-a,d,g,_)),g=1/0,_=0,l=c,m=c,d=0;d+=e.advance,f+=e.advance}else d+=e.advance,f+=e.advance;c+=a}const p=new b(t,l,c-a,d,g,_);return p.start>=0&&p.end<t.length&&i.push(p),i}function j(t,s){let e=0;for(let n=0;n<t.length;n++){const{width:s}=t[n];e=Math.max(s,e)}const i=\"underline\"===s.decoration?g:0,h=t[0].yMin;return{x:0,y:h,height:t[t.length-1].yMax+s.lineHeight*(t.length-1)+i-h,width:e}}function A(t,s,e){const i=e.scale,h=new Array,n=v(t,s,e),o=j(n,e),{vAlign:r,hAlign:a}=e,c=r===d.Baseline?1:0,f=c?0:r-1,l=(1-c)*-o.y+f*(o.height/2)+(c?1:0)*-u;for(let d=0;d<n.length;d++){const{start:s,end:o,width:r}=n[d];let c=-1*(a+1)*(r/2)-x;const f=d*e.lineHeight+l-x;n[d].startX=c,n[d].startY=f;for(let e=s;e<=o;e++){const s=t[e];if(R(s.code))continue;const n=new T(c+s.metrics.left,f-s.metrics.top,s,i);c+=s.metrics.advance,h.push(n)}}return new B(h,n,e)}export{T as ShapedGlyph,B as ShapingInfo,A as shapeGlyphs};\n"]},"metadata":{},"sourceType":"module"}