{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Handles.js\";\nimport { isNone as r, isSome as t } from \"../../../../core/maybe.js\";\nimport { c as s } from \"../../../../chunks/mat4f64.js\";\nimport { f as i } from \"../../../../chunks/vec3.js\";\nimport { c as a } from \"../../../../chunks/vec3f64.js\";\nimport { sv3d as o } from \"../../../../geometry/support/vectorStacks.js\";\nimport { Object3DVisualElement as n } from \"./Object3DVisualElement.js\";\nimport h from \"../../webgl-engine/lib/GeometryUtil.js\";\nimport { MeasurementArrowMaterial as l } from \"../../webgl-engine/materials/MeasurementArrowMaterial.js\";\n\nclass d extends n {\n  constructor(e) {\n    super(e), this._parameters = c, this._handles = null, this._origin = a(), this._originTransform = s(), this._arrowCenter = a(), this._renderOccluded = 4, this._geometry = null, this._stripeLength = 1, this._stripesEnabled = !0, this.applyProps(e);\n  }\n\n  get renderOccluded() {\n    return this._renderOccluded;\n  }\n\n  set renderOccluded(e) {\n    e !== this._renderOccluded && (this._renderOccluded = e, this._arrowMaterial && this._arrowMaterial.setParameterValues({\n      renderOccluded: e\n    }));\n  }\n\n  get geometry() {\n    return this._geometry;\n  }\n\n  set geometry(e) {\n    this._geometry = e, this.geometryChanged();\n  }\n\n  get stripeLength() {\n    return this._stripeLength;\n  }\n\n  set stripeLength(e) {\n    this._stripeLength = e, this.attached && this._arrowMaterial.setParameterValues({\n      stripeLength: this._stripeLength\n    });\n  }\n\n  get stripesEnabled() {\n    return this._stripesEnabled;\n  }\n\n  set stripesEnabled(e) {\n    if (this._stripesEnabled = e, this.attached) {\n      const e = this._stripesEnabled ? this._parameters.arrowStripeEvenColor : this._parameters.arrowStripeOddColor;\n\n      this._arrowMaterial.setParameterValues({\n        stripeEvenColor: e\n      });\n    }\n  }\n\n  createExternalResources() {\n    const r = this._stripesEnabled ? this._parameters.arrowStripeEvenColor : this._parameters.arrowStripeOddColor;\n    this._arrowMaterial = new l({\n      outlineColor: this._parameters.arrowOutlineColor,\n      stripeEvenColor: r,\n      stripeOddColor: this._parameters.arrowStripeOddColor,\n      renderOccluded: this.renderOccluded,\n      polygonOffset: !0\n    }), this._handles = new e(), this._handles.add(this.view.state.watch(\"camera\", () => {\n      this.viewChanged();\n    }));\n  }\n\n  destroyExternalResources() {\n    this._arrowMaterial = null, this._handles.destroy(), this._handles = null;\n  }\n\n  forEachExternalMaterial(e) {\n    e(this._arrowMaterial);\n  }\n\n  createGeometries(e) {\n    if (r(this._geometry) || r(this._geometry.startRenderSpace) || r(this._geometry.endRenderSpace)) return;\n\n    const t = this._createArrowGeometry(this._geometry.startRenderSpace, this._geometry.endRenderSpace, this._origin, this._geometry);\n\n    e.addGeometry(t, this._arrowMaterial, this._originTransform), this.viewChanged();\n  }\n\n  _createArrowGeometry(e, r, t, s) {\n    const a = this.view.renderCoordsHelper,\n          n = [],\n          l = [],\n          d = (e, r) => {\n      const s = o.get();\n      i(s, e, t), n.push(s), l.push(r);\n    };\n\n    if (\"euclidean\" === s.type) {\n      s.eval(.5, this._arrowCenter);\n      const t = o.get();\n      a.worldUpAtPosition(this._arrowCenter, t), d(e, t), d(r, t);\n    } else {\n      s.eval(.5, this._arrowCenter);\n      const e = this._parameters.arrowSubdivisions + 1 & -2;\n\n      for (let r = 0; r < e; ++r) {\n        const t = r / (e - 1),\n              i = o.get(),\n              n = o.get();\n        s.eval(t, i), a.worldUpAtPosition(i, n), d(i, n);\n      }\n    }\n\n    return h.createPolylineGeometry(n, l);\n  }\n\n  geometryChanged() {\n    this.recreateGeometry();\n  }\n\n  viewChanged() {\n    if (this.view.ready && this.attached && t(this._geometry)) {\n      const e = this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);\n\n      this._arrowMaterial.setParameterValues({\n        width: this._parameters.arrowWidth * e\n      });\n    }\n  }\n\n}\n\nconst c = {\n  arrowWidth: 16,\n  arrowOutlineColor: [1, .5, 0, 1],\n  arrowOutlineWidth: .2,\n  arrowStripeEvenColor: [1, 1, 1, 1],\n  arrowStripeOddColor: [1, .5, 0, 1],\n  arrowStripeLength: 16,\n  arrowSubdivisions: 128\n};\nexport { d as MeasurementArrowVisualElement };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/interactive/visualElements/MeasurementArrowVisualElement.js"],"names":["e","isNone","r","isSome","t","c","s","f","i","a","sv3d","o","Object3DVisualElement","n","h","MeasurementArrowMaterial","l","d","constructor","_parameters","_handles","_origin","_originTransform","_arrowCenter","_renderOccluded","_geometry","_stripeLength","_stripesEnabled","applyProps","renderOccluded","_arrowMaterial","setParameterValues","geometry","geometryChanged","stripeLength","attached","stripesEnabled","arrowStripeEvenColor","arrowStripeOddColor","stripeEvenColor","createExternalResources","outlineColor","arrowOutlineColor","stripeOddColor","polygonOffset","add","view","state","watch","viewChanged","destroyExternalResources","destroy","forEachExternalMaterial","createGeometries","startRenderSpace","endRenderSpace","_createArrowGeometry","addGeometry","renderCoordsHelper","get","push","type","eval","worldUpAtPosition","arrowSubdivisions","createPolylineGeometry","recreateGeometry","ready","camera","computeScreenPixelSizeAt","width","arrowWidth","arrowOutlineWidth","arrowStripeLength","MeasurementArrowVisualElement"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Handles.js\";import{isNone as r,isSome as t}from\"../../../../core/maybe.js\";import{c as s}from\"../../../../chunks/mat4f64.js\";import{f as i}from\"../../../../chunks/vec3.js\";import{c as a}from\"../../../../chunks/vec3f64.js\";import{sv3d as o}from\"../../../../geometry/support/vectorStacks.js\";import{Object3DVisualElement as n}from\"./Object3DVisualElement.js\";import h from\"../../webgl-engine/lib/GeometryUtil.js\";import{MeasurementArrowMaterial as l}from\"../../webgl-engine/materials/MeasurementArrowMaterial.js\";class d extends n{constructor(e){super(e),this._parameters=c,this._handles=null,this._origin=a(),this._originTransform=s(),this._arrowCenter=a(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:e})}}createExternalResources(){const r=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new l({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:r,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new e,this._handles.add(this.view.state.watch(\"camera\",(()=>{this.viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(r(this._geometry)||r(this._geometry.startRenderSpace)||r(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}_createArrowGeometry(e,r,t,s){const a=this.view.renderCoordsHelper,n=[],l=[],d=(e,r)=>{const s=o.get();i(s,e,t),n.push(s),l.push(r)};if(\"euclidean\"===s.type){s.eval(.5,this._arrowCenter);const t=o.get();a.worldUpAtPosition(this._arrowCenter,t),d(e,t),d(r,t)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let r=0;r<e;++r){const t=r/(e-1),i=o.get(),n=o.get();s.eval(t,i),a.worldUpAtPosition(i,n),d(i,n)}}return h.createPolylineGeometry(n,l)}geometryChanged(){this.recreateGeometry()}viewChanged(){if(this.view.ready&&this.attached&&t(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}const c={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};export{d as MeasurementArrowVisualElement};\n"]},"metadata":{},"sourceType":"module"}