{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../../core/maybe.js\";\nimport { VTLSymbol as e } from \"./core.js\";\n\nclass r {\n  constructor(t) {\n    this.tile = t, this.parent = null, this.children = new Set();\n  }\n\n}\n\nclass s {\n  constructor() {\n    this.nodes = new Map(), this.roots = new Set();\n  }\n\n  create(t) {\n    const e = new r(t);\n    let s;\n    const i = [];\n\n    if (this.nodes.forEach(t => {\n      this._canConnectDirectly(e, t) && i.push(t), !s && this._canConnectDirectly(t, e) && (s = t);\n    }), s) {\n      for (const t of i) s.children.delete(t), e.children.add(t), t.parent = e;\n\n      s.children.add(e), e.parent = s;\n    } else {\n      this.roots.add(e);\n\n      for (const t of i) e.children.add(t), t.parent = e, this.roots.delete(t);\n    }\n\n    return this.nodes.set(t.key.id, e), e;\n  }\n\n  destroy(e) {\n    t(e.parent) ? (e.parent.children.delete(e), e.children.forEach(r => {\n      t(e.parent) && e.parent.children.add(r);\n    })) : this.roots.delete(e), e.children.forEach(t => {\n      t.parent = e.parent, e.parent || this.roots.add(t);\n    }), this.nodes.delete(e.tile.key.id);\n  }\n\n  clear() {\n    this.roots.clear(), this.nodes.clear();\n  }\n\n  _canConnectDirectly(t, e) {\n    let {\n      level: r,\n      row: s,\n      col: i\n    } = e.tile.key;\n    const {\n      world: l\n    } = e.tile.key;\n\n    for (; r > 0;) {\n      if (r--, s >>= 1, i >>= 1, t.tile.key.level === r && t.tile.key.row === s && t.tile.key.col === i && t.tile.key.world === l) return !0;\n      if (this.nodes.has(`${r}/${s}/${i}/${l}`)) return !1;\n    }\n\n    return !1;\n  }\n\n}\n\nclass i {\n  constructor() {\n    this._tileGraph = new s(), this._tileArray = null;\n  }\n\n  has(t) {\n    return \"string\" == typeof t ? this._tileGraph.nodes.has(t) : this._tileGraph.nodes.has(t.key.id);\n  }\n\n  getAll() {\n    return this._tileArray || (this._tileArray = [], this._tileGraph.nodes.forEach(t => {\n      this._tileArray.push(t.tile);\n    })), this._tileArray;\n  }\n\n  getRoots() {\n    const t = [];\n    return this._tileGraph.roots.forEach(e => {\n      t.push(e.tile);\n    }), t;\n  }\n\n  getParent(e) {\n    const r = this._tileGraph.nodes.get(\"string\" == typeof e ? e : e.key.id);\n\n    return t(r.parent) && r.parent.tile;\n  }\n\n  getChildren(t) {\n    const e = [];\n    return this._tileGraph.nodes.get(\"string\" == typeof t ? t : t.key.id).children.forEach(t => {\n      e.push(t.tile);\n    }), e;\n  }\n\n  get(t) {\n    return this._tileGraph.nodes.get(t).tile;\n  }\n\n  removeKey(t) {\n    const e = this._tileGraph.nodes.get(t);\n\n    this._tileGraph.destroy(e), this._tileArray = null;\n  }\n\n  forEach(t) {\n    this._tileGraph.nodes.forEach((e, r) => t(e.tile, r));\n  }\n\n  add(t) {\n    this._tileGraph.create(t), this._tileArray = null;\n  }\n\n  remove(t) {\n    const e = this._tileGraph.nodes.get(t.key.id);\n\n    this._tileGraph.destroy(e), this._tileArray = null;\n  }\n\n  clear() {\n    this._tileGraph.clear(), this._tileArray = [];\n  }\n\n}\n\nfunction l(t, e, r, s, i, l) {\n  const o = r - i;\n  if (o >= 0) return (e >> o) + (s - (l << o)) * (t >> o);\n  const n = -o;\n  return e - (l - (s << n)) * (t >> n) << n;\n}\n\nclass o {\n  constructor(t, e, r) {\n    this._rows = Math.ceil(e / r), this._columns = Math.ceil(t / r), this._cellSize = r, this.cells = new Array(this._rows);\n\n    for (let s = 0; s < this._rows; s++) {\n      this.cells[s] = new Array(this._columns);\n\n      for (let t = 0; t < this._columns; t++) this.cells[s][t] = [];\n    }\n  }\n\n  getCell(t, e) {\n    const r = Math.min(Math.max(Math.floor(e / this._cellSize), 0), this._rows - 1),\n          s = Math.min(Math.max(Math.floor(t / this._cellSize), 0), this._columns - 1);\n    return this.cells[r] && this.cells[r][s] || null;\n  }\n\n  getCellSpan(t, e, r, s) {\n    return [Math.min(Math.max(Math.floor(t / this._cellSize), 0), this.columns - 1), Math.min(Math.max(Math.floor(e / this._cellSize), 0), this.rows - 1), Math.min(Math.max(Math.floor(r / this._cellSize), 0), this.columns - 1), Math.min(Math.max(Math.floor(s / this._cellSize), 0), this.rows - 1)];\n  }\n\n  get cellSize() {\n    return this._cellSize;\n  }\n\n  get columns() {\n    return this._columns;\n  }\n\n  get rows() {\n    return this._rows;\n  }\n\n}\n\nfunction n(t, r, s, i, l, o) {\n  const n = r[i++];\n\n  for (let h = 0; h < n; h++) {\n    const n = new e(o);\n    n.xTile = r[i++], n.yTile = r[i++], n.hash = r[i++], n.priority = r[i++];\n    const h = r[i++];\n\n    for (let t = 0; t < h; t++) {\n      const t = r[i++],\n            e = r[i++],\n            l = r[i++],\n            o = r[i++],\n            h = !!r[i++],\n            a = r[i++],\n            c = s[i++],\n            d = s[i++],\n            p = r[i++],\n            u = r[i++];\n      n.colliders.push({\n        xTile: t,\n        yTile: e,\n        dxPixels: l,\n        dyPixels: o,\n        hard: h,\n        partIndex: a,\n        width: p,\n        height: u,\n        minLod: c,\n        maxLod: d\n      });\n    }\n\n    const a = t[i++];\n\n    for (let e = 0; e < a; e++) n.textVertexRanges.push([t[i++], t[i++]]);\n\n    const c = t[i++];\n\n    for (let e = 0; e < c; e++) n.iconVertexRanges.push([t[i++], t[i++]]);\n\n    l.push(n);\n  }\n\n  return i;\n}\n\nfunction h(t, e, r) {\n  for (const [s, i] of t.symbols) a(t, e, r, i, s);\n}\n\nfunction a(t, e, r, s, i) {\n  const l = t.layerData.get(i);\n\n  if (3 === l.type) {\n    for (const e of s) {\n      const s = e.unique;\n      let i;\n\n      if (e.selectedForRendering) {\n        const e = s.parts[0],\n              l = e.startOpacity,\n              o = e.targetOpacity;\n        t.allSymbolsFadingOut = t.allSymbolsFadingOut && 0 === o;\n        const n = r ? Math.floor(127 * l) | o << 7 : o ? 255 : 0;\n        i = n << 24 | n << 16 | n << 8 | n;\n      } else i = 0;\n\n      for (const [t, r] of e.iconVertexRanges) for (let e = t; e < t + r; e += 4) l.iconOpacity[e / 4] = i;\n\n      if (e.selectedForRendering) {\n        const e = s.parts[1],\n              l = e.startOpacity,\n              o = e.targetOpacity;\n        t.allSymbolsFadingOut = t.allSymbolsFadingOut && 0 === o;\n        const n = r ? Math.floor(127 * l) | o << 7 : o ? 255 : 0;\n        i = n << 24 | n << 16 | n << 8 | n;\n      } else i = 0;\n\n      for (const [t, r] of e.textVertexRanges) for (let e = t; e < t + r; e += 4) l.textOpacity[e / 4] = i;\n    }\n\n    l.lastOpacityUpdate = e, l.opacityChanged = !0;\n  }\n}\n\nexport { o as GridIndex, i as TileForest, s as TileGraph, r as TileNode, n as deserializeSymbols, l as tileCoordChange, h as writeOpacityToBuffers };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/decluttering/util.js"],"names":["isSome","t","VTLSymbol","e","r","constructor","tile","parent","children","Set","s","nodes","Map","roots","create","i","forEach","_canConnectDirectly","push","delete","add","set","key","id","destroy","clear","level","row","col","world","l","has","_tileGraph","_tileArray","getAll","getRoots","getParent","get","getChildren","removeKey","remove","o","n","_rows","Math","ceil","_columns","_cellSize","cells","Array","getCell","min","max","floor","getCellSpan","columns","rows","cellSize","h","xTile","yTile","hash","priority","a","c","d","p","u","colliders","dxPixels","dyPixels","hard","partIndex","width","height","minLod","maxLod","textVertexRanges","iconVertexRanges","symbols","layerData","type","unique","selectedForRendering","parts","startOpacity","targetOpacity","allSymbolsFadingOut","iconOpacity","textOpacity","lastOpacityUpdate","opacityChanged","GridIndex","TileForest","TileGraph","TileNode","deserializeSymbols","tileCoordChange","writeOpacityToBuffers"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../../core/maybe.js\";import{VTLSymbol as e}from\"./core.js\";class r{constructor(t){this.tile=t,this.parent=null,this.children=new Set}}class s{constructor(){this.nodes=new Map,this.roots=new Set}create(t){const e=new r(t);let s;const i=[];if(this.nodes.forEach((t=>{this._canConnectDirectly(e,t)&&i.push(t),!s&&this._canConnectDirectly(t,e)&&(s=t)})),s){for(const t of i)s.children.delete(t),e.children.add(t),t.parent=e;s.children.add(e),e.parent=s}else{this.roots.add(e);for(const t of i)e.children.add(t),t.parent=e,this.roots.delete(t)}return this.nodes.set(t.key.id,e),e}destroy(e){t(e.parent)?(e.parent.children.delete(e),e.children.forEach((r=>{t(e.parent)&&e.parent.children.add(r)}))):this.roots.delete(e),e.children.forEach((t=>{t.parent=e.parent,e.parent||this.roots.add(t)})),this.nodes.delete(e.tile.key.id)}clear(){this.roots.clear(),this.nodes.clear()}_canConnectDirectly(t,e){let{level:r,row:s,col:i}=e.tile.key;const{world:l}=e.tile.key;for(;r>0;){if(r--,s>>=1,i>>=1,t.tile.key.level===r&&t.tile.key.row===s&&t.tile.key.col===i&&t.tile.key.world===l)return!0;if(this.nodes.has(`${r}/${s}/${i}/${l}`))return!1}return!1}}class i{constructor(){this._tileGraph=new s,this._tileArray=null}has(t){return\"string\"==typeof t?this._tileGraph.nodes.has(t):this._tileGraph.nodes.has(t.key.id)}getAll(){return this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach((t=>{this._tileArray.push(t.tile)}))),this._tileArray}getRoots(){const t=[];return this._tileGraph.roots.forEach((e=>{t.push(e.tile)})),t}getParent(e){const r=this._tileGraph.nodes.get(\"string\"==typeof e?e:e.key.id);return t(r.parent)&&r.parent.tile}getChildren(t){const e=[];return this._tileGraph.nodes.get(\"string\"==typeof t?t:t.key.id).children.forEach((t=>{e.push(t.tile)})),e}get(t){return this._tileGraph.nodes.get(t).tile}removeKey(t){const e=this._tileGraph.nodes.get(t);this._tileGraph.destroy(e),this._tileArray=null}forEach(t){this._tileGraph.nodes.forEach(((e,r)=>t(e.tile,r)))}add(t){this._tileGraph.create(t),this._tileArray=null}remove(t){const e=this._tileGraph.nodes.get(t.key.id);this._tileGraph.destroy(e),this._tileArray=null}clear(){this._tileGraph.clear(),this._tileArray=[]}}function l(t,e,r,s,i,l){const o=r-i;if(o>=0)return(e>>o)+(s-(l<<o))*(t>>o);const n=-o;return e-(l-(s<<n))*(t>>n)<<n}class o{constructor(t,e,r){this._rows=Math.ceil(e/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[s][t]=[]}}getCell(t,e){const r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,e,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function n(t,r,s,i,l,o){const n=r[i++];for(let h=0;h<n;h++){const n=new e(o);n.xTile=r[i++],n.yTile=r[i++],n.hash=r[i++],n.priority=r[i++];const h=r[i++];for(let t=0;t<h;t++){const t=r[i++],e=r[i++],l=r[i++],o=r[i++],h=!!r[i++],a=r[i++],c=s[i++],d=s[i++],p=r[i++],u=r[i++];n.colliders.push({xTile:t,yTile:e,dxPixels:l,dyPixels:o,hard:h,partIndex:a,width:p,height:u,minLod:c,maxLod:d})}const a=t[i++];for(let e=0;e<a;e++)n.textVertexRanges.push([t[i++],t[i++]]);const c=t[i++];for(let e=0;e<c;e++)n.iconVertexRanges.push([t[i++],t[i++]]);l.push(n)}return i}function h(t,e,r){for(const[s,i]of t.symbols)a(t,e,r,i,s)}function a(t,e,r,s,i){const l=t.layerData.get(i);if(3===l.type){for(const e of s){const s=e.unique;let i;if(e.selectedForRendering){const e=s.parts[0],l=e.startOpacity,o=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===o;const n=r?Math.floor(127*l)|o<<7:o?255:0;i=n<<24|n<<16|n<<8|n}else i=0;for(const[t,r]of e.iconVertexRanges)for(let e=t;e<t+r;e+=4)l.iconOpacity[e/4]=i;if(e.selectedForRendering){const e=s.parts[1],l=e.startOpacity,o=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===o;const n=r?Math.floor(127*l)|o<<7:o?255:0;i=n<<24|n<<16|n<<8|n}else i=0;for(const[t,r]of e.textVertexRanges)for(let e=t;e<t+r;e+=4)l.textOpacity[e/4]=i}l.lastOpacityUpdate=e,l.opacityChanged=!0}}export{o as GridIndex,i as TileForest,s as TileGraph,r as TileNode,n as deserializeSymbols,l as tileCoordChange,h as writeOpacityToBuffers};\n"]},"metadata":{},"sourceType":"module"}