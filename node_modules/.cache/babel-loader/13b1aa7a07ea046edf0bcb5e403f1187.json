{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Accessor.js\";\nimport r from \"../../../core/Evented.js\";\nimport { destroyMaybe as s, isNone as o, isSome as i } from \"../../../core/maybe.js\";\nimport { createResolver as n, isAbortError as a } from \"../../../core/promiseUtils.js\";\nimport { property as c } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as l } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { ElevationQuery as h } from \"../layers/graphics/ElevationQuery.js\";\nlet p = class extends r.EventedMixin(t) {\n  constructor(e) {\n    super(e), this.im = new Array(), this.ground = new Array(), this.scene = new Array(), this.handles = new Map();\n  }\n\n  destroy() {\n    this._elevationQuery = s(this._elevationQuery);\n  }\n\n  get elevationQuery() {\n    return o(this._elevationQuery) && (this._elevationQuery = new h(this.view.resourceController.scheduler, this.view.spatialReference, () => this.view.map && this.view.map.ground, {\n      maximumAutoTileRequests: 4\n    })), this._elevationQuery;\n  }\n\n  getElevation(e, t, r, s, i) {\n    let n = null;\n    return n = u(n, this.im, e, t, r, s, i), o(n) && (n = u(n, this.ground, e, t, r, s, i)), \"scene\" === i && (n = u(n, this.scene, e, t, r, s, i)), n;\n  }\n\n  queryElevation(e, t, r, s, o, i = null, c = 0) {\n    const l = n();\n    return this.elevationQuery.queryElevation(e, t, i, c).then(i => {\n      \"scene\" === o && (i = u(i, this.scene, e, t, r, s, o)), l.resolve(i);\n    }).catch(i => {\n      a(i) ? l.reject(i) : l.resolve(this.getElevation(e, t, r, s, o));\n    }), l.promise;\n  }\n\n  register(e, t) {\n    this.handles.set(t, t.on(\"elevation-change\", e => this.emit(\"elevation-change\", e))), this[e].push(t);\n  }\n\n  unregister(e) {\n    this.handles.has(e) && (this.handles.get(e).remove(), this.handles.delete(e));\n\n    for (const t of [this.im, this.ground, this.scene]) {\n      const r = t.indexOf(e);\n      r > -1 && t.splice(r, 1);\n    }\n  }\n\n};\n\nfunction u(e, t, r, s, o, n, a) {\n  for (const c of t) {\n    const t = c.getElevation(r, s, o, n, a);\n    i(t) && (e = i(e) ? Math.max(t, e) : t);\n  }\n\n  return e;\n}\n\ne([c({\n  constructOnly: !0\n})], p.prototype, \"view\", void 0), e([c({\n  readOnly: !0,\n  aliasOf: \"view.basemapTerrain.spatialReference\"\n})], p.prototype, \"spatialReference\", void 0), p = e([l(\"esri.views.3d.support.CombinedElevationProvider\")], p);\nexport { p as CombinedElevationProvider };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/support/CombinedElevationProvider.js"],"names":["_","e","t","r","destroyMaybe","s","isNone","o","isSome","i","createResolver","n","isAbortError","a","property","c","subclass","l","ElevationQuery","h","p","EventedMixin","constructor","im","Array","ground","scene","handles","Map","destroy","_elevationQuery","elevationQuery","view","resourceController","scheduler","spatialReference","map","maximumAutoTileRequests","getElevation","u","queryElevation","then","resolve","catch","reject","promise","register","set","on","emit","push","unregister","has","get","remove","delete","indexOf","splice","Math","max","constructOnly","prototype","readOnly","aliasOf","CombinedElevationProvider"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import r from\"../../../core/Evented.js\";import{destroyMaybe as s,isNone as o,isSome as i}from\"../../../core/maybe.js\";import{createResolver as n,isAbortError as a}from\"../../../core/promiseUtils.js\";import{property as c}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{ElevationQuery as h}from\"../layers/graphics/ElevationQuery.js\";let p=class extends(r.EventedMixin(t)){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map}destroy(){this._elevationQuery=s(this._elevationQuery)}get elevationQuery(){return o(this._elevationQuery)&&(this._elevationQuery=new h(this.view.resourceController.scheduler,this.view.spatialReference,(()=>this.view.map&&this.view.map.ground),{maximumAutoTileRequests:4})),this._elevationQuery}getElevation(e,t,r,s,i){let n=null;return n=u(n,this.im,e,t,r,s,i),o(n)&&(n=u(n,this.ground,e,t,r,s,i)),\"scene\"===i&&(n=u(n,this.scene,e,t,r,s,i)),n}queryElevation(e,t,r,s,o,i=null,c=0){const l=n();return this.elevationQuery.queryElevation(e,t,i,c).then((i=>{\"scene\"===o&&(i=u(i,this.scene,e,t,r,s,o)),l.resolve(i)})).catch((i=>{a(i)?l.reject(i):l.resolve(this.getElevation(e,t,r,s,o))})),l.promise}register(e,t){this.handles.set(t,t.on(\"elevation-change\",(e=>this.emit(\"elevation-change\",e)))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}};function u(e,t,r,s,o,n,a){for(const c of t){const t=c.getElevation(r,s,o,n,a);i(t)&&(e=i(e)?Math.max(t,e):t)}return e}e([c({constructOnly:!0})],p.prototype,\"view\",void 0),e([c({readOnly:!0,aliasOf:\"view.basemapTerrain.spatialReference\"})],p.prototype,\"spatialReference\",void 0),p=e([l(\"esri.views.3d.support.CombinedElevationProvider\")],p);export{p as CombinedElevationProvider};\n"]},"metadata":{},"sourceType":"module"}