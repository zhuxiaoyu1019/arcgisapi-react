{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../Graphic.js\";\nimport r from \"../../../core/Accessor.js\";\nimport { HandleOwnerMixin as o } from \"../../../core/HandleOwner.js\";\nimport { isSome as s } from \"../../../core/maybe.js\";\nimport { EsriPromiseMixin as i } from \"../../../core/Promise.js\";\nimport { property as a } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as n } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport c from \"../data/StreamFeatureManager.js\";\nimport { createConnection as p } from \"../sources/connections/createConnection.js\";\nimport { EventedSet as h } from \"../../../views/3d/support/EventedSet.js\";\nimport { featureGeometryTypeKebabDictionary as d } from \"../../../geometry/support/typeUtils.js\";\nvar l;\nconst u = 2500;\nlet m = l = class extends t {\n  getObjectId() {\n    return this.objectId;\n  }\n\n  clone() {\n    return new l({\n      objectId: this.objectId,\n      ...this.cloneProperties()\n    });\n  }\n\n};\ne([a({\n  type: Number,\n  json: {\n    read: !0\n  }\n})], m.prototype, \"objectId\", void 0), m = l = e([n(\"esri.layers.graphics.controllers.StreamGraphic\")], m);\n\nclass y {\n  constructor(e) {\n    this.onUpdate = e, this._idToGraphic = new Map();\n  }\n\n  destroy() {\n    this._idToGraphic.clear();\n  }\n\n  add(e) {\n    this._idToGraphic.set(e.objectId, e);\n  }\n\n  get(e) {\n    return this._idToGraphic.get(e);\n  }\n\n  forEach(e) {\n    this._idToGraphic.forEach(e);\n  }\n\n  removeById(e) {\n    const t = this._idToGraphic.get(e);\n\n    return t ? (t.sourceLayer = t.layer = null, this._idToGraphic.delete(e), t) : null;\n  }\n\n  update(e, t) {\n    this.onUpdate(e, t);\n  }\n\n  get size() {\n    return this._idToGraphic.size;\n  }\n\n}\n\nlet f = class extends o(i(r)) {\n  constructor() {\n    super(...arguments), this._updateInfo = {\n      websocket: 0,\n      client: 0\n    }, this.graphics = new h();\n  }\n\n  initialize() {\n    this.addResolvingPromise(this.layer.when(() => this._startup()));\n  }\n\n  destroy() {\n    this.clear();\n  }\n\n  clear() {\n    this._updateIntervalId && (clearInterval(this._updateIntervalId), this._updateIntervalId = 0), this.connection && (this.connection.destroy(), this.connection = null), this.store && (this.store.destroy(), this.store = null), this.graphics.clear(), this.handles.removeAll();\n  }\n\n  get updating() {\n    return !this.connection || \"connected\" === this.connection.connectionStatus;\n  }\n\n  _startup() {\n    const {\n      parsedUrl: e,\n      spatialReference: t,\n      definitionExpression: r,\n      geometryDefinition: o,\n      objectIdField: s,\n      timeInfo: i,\n      purgeOptions: a,\n      maxReconnectionAttempts: n,\n      maxReconnectionInterval: h,\n      updateInterval: l\n    } = this.layer,\n          m = d.toJSON(this.layer.geometryType),\n          f = t,\n          g = this.layerView.view.spatialReference,\n          _ = {\n      geometry: o,\n      where: r\n    };\n    this.clear(), this._set(\"connection\", p(e, f, g, m, _, n, h)), this._outSpatialReference = g.toJSON(), this.store = new y(this._onUpdate.bind(this)), this.featuresManager = new c(this.store, s, i.toJSON(), a), this.handles.add([this.connection.on(\"feature\", e => this._onFeature(e)), this.layer.watch(\"definitionExpression\", () => this._startup()), this.layer.watch(\"geometryDefinition\", () => this._startup()), this.layer.watch(\"purgeOptions\", () => this._startup())]);\n    let I = performance.now();\n    this._updateIntervalId = setInterval(() => {\n      const e = performance.now(),\n            t = e - I;\n\n      if (t > u) {\n        I = e;\n        const r = Math.round(this._updateInfo.client / (t / 1e3)),\n              o = Math.round(this._updateInfo.websocket / (t / 1e3));\n        this._updateInfo.client = 0, this._updateInfo.websocket = 0, this.layerView.emit(\"update-rate\", {\n          client: r,\n          websocket: o\n        });\n      }\n\n      this.featuresManager.checkForUpdates();\n    }, l);\n  }\n\n  _onFeature(e) {\n    this._updateInfo.websocket++, this.layerView.hasEventListener(\"data-received\") && this.layerView.emit(\"data-received\", {\n      attributes: e.attributes,\n      centroid: e.centroid,\n      geometry: e.geometry\n    });\n\n    try {\n      e.geometry && !e.geometry.spatialReference && (e.geometry.spatialReference = this._outSpatialReference);\n      const t = m.fromJSON(e);\n      t.sourceLayer = t.layer = this.layer, this.featuresManager.add(t);\n    } catch {}\n  }\n\n  _onUpdate(e, t) {\n    s(t) && this.graphics.removeMany(t), s(e) && (this._updateInfo.client += e.length, this.graphics.addMany(e));\n  }\n\n};\ne([a()], f.prototype, \"connection\", void 0), e([a()], f.prototype, \"layer\", void 0), e([a()], f.prototype, \"layerView\", void 0), e([a({\n  readOnly: !0\n})], f.prototype, \"updating\", null), f = e([n(\"esri.layers.graphics.controllers.StreamController\")], f);\nvar g = f;\nexport default g;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/graphics/controllers/StreamController.js"],"names":["_","e","t","r","HandleOwnerMixin","o","isSome","s","EsriPromiseMixin","i","property","a","subclass","n","c","createConnection","p","EventedSet","h","featureGeometryTypeKebabDictionary","d","l","u","m","getObjectId","objectId","clone","cloneProperties","type","Number","json","read","prototype","y","constructor","onUpdate","_idToGraphic","Map","destroy","clear","add","set","get","forEach","removeById","sourceLayer","layer","delete","update","size","f","arguments","_updateInfo","websocket","client","graphics","initialize","addResolvingPromise","when","_startup","_updateIntervalId","clearInterval","connection","store","handles","removeAll","updating","connectionStatus","parsedUrl","spatialReference","definitionExpression","geometryDefinition","objectIdField","timeInfo","purgeOptions","maxReconnectionAttempts","maxReconnectionInterval","updateInterval","toJSON","geometryType","g","layerView","view","geometry","where","_set","_outSpatialReference","_onUpdate","bind","featuresManager","on","_onFeature","watch","I","performance","now","setInterval","Math","round","emit","checkForUpdates","hasEventListener","attributes","centroid","fromJSON","removeMany","length","addMany","readOnly"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../Graphic.js\";import r from\"../../../core/Accessor.js\";import{HandleOwnerMixin as o}from\"../../../core/HandleOwner.js\";import{isSome as s}from\"../../../core/maybe.js\";import{EsriPromiseMixin as i}from\"../../../core/Promise.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as n}from\"../../../core/accessorSupport/decorators/subclass.js\";import c from\"../data/StreamFeatureManager.js\";import{createConnection as p}from\"../sources/connections/createConnection.js\";import{EventedSet as h}from\"../../../views/3d/support/EventedSet.js\";import{featureGeometryTypeKebabDictionary as d}from\"../../../geometry/support/typeUtils.js\";var l;const u=2500;let m=l=class extends t{getObjectId(){return this.objectId}clone(){return new l({objectId:this.objectId,...this.cloneProperties()})}};e([a({type:Number,json:{read:!0}})],m.prototype,\"objectId\",void 0),m=l=e([n(\"esri.layers.graphics.controllers.StreamGraphic\")],m);class y{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._idToGraphic.size}}let f=class extends(o(i(r))){constructor(){super(...arguments),this._updateInfo={websocket:0,client:0},this.graphics=new h}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}clear(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}get updating(){return!this.connection||\"connected\"===this.connection.connectionStatus}_startup(){const{parsedUrl:e,spatialReference:t,definitionExpression:r,geometryDefinition:o,objectIdField:s,timeInfo:i,purgeOptions:a,maxReconnectionAttempts:n,maxReconnectionInterval:h,updateInterval:l}=this.layer,m=d.toJSON(this.layer.geometryType),f=t,g=this.layerView.view.spatialReference,_={geometry:o,where:r};this.clear(),this._set(\"connection\",p(e,f,g,m,_,n,h)),this._outSpatialReference=g.toJSON(),this.store=new y(this._onUpdate.bind(this)),this.featuresManager=new c(this.store,s,i.toJSON(),a),this.handles.add([this.connection.on(\"feature\",(e=>this._onFeature(e))),this.layer.watch(\"definitionExpression\",(()=>this._startup())),this.layer.watch(\"geometryDefinition\",(()=>this._startup())),this.layer.watch(\"purgeOptions\",(()=>this._startup()))]);let I=performance.now();this._updateIntervalId=setInterval((()=>{const e=performance.now(),t=e-I;if(t>u){I=e;const r=Math.round(this._updateInfo.client/(t/1e3)),o=Math.round(this._updateInfo.websocket/(t/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit(\"update-rate\",{client:r,websocket:o})}this.featuresManager.checkForUpdates()}),l)}_onFeature(e){this._updateInfo.websocket++,this.layerView.hasEventListener(\"data-received\")&&this.layerView.emit(\"data-received\",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._outSpatialReference);const t=m.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(e,t){s(t)&&this.graphics.removeMany(t),s(e)&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}};e([a()],f.prototype,\"connection\",void 0),e([a()],f.prototype,\"layer\",void 0),e([a()],f.prototype,\"layerView\",void 0),e([a({readOnly:!0})],f.prototype,\"updating\",null),f=e([n(\"esri.layers.graphics.controllers.StreamController\")],f);var g=f;export default g;\n"]},"metadata":{},"sourceType":"module"}