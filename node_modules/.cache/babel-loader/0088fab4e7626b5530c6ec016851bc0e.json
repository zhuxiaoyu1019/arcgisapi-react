{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport { createAbortController as e, isAbortError as r } from \"../../../../core/promiseUtils.js\";\nimport { on as o } from \"../../../../core/watchUtils.js\";\nimport { property as i } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as s } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { i as n, k as a, g as c } from \"../../../../chunks/vec3.js\";\nimport { c as d } from \"../../../../chunks/vec3f64.js\";\nimport l from \"../../../../geometry/Point.js\";\nimport { distanceToScale as p } from \"../cameraUtils.js\";\nimport { PropertiesPool as h } from \"../PropertiesPool.js\";\nimport { PointOfInterest as u } from \"./PointOfInterest.js\";\nconst m = Array;\nlet y = class extends u {\n  constructor(t) {\n    super(t), this._dirty = !1, this._propertiesPool = new h({\n      location: l,\n      renderLocation: m\n    }, this), this._estimatedSurfaceAltitude = 0, this._pendingElevationQueryController = null, this.cameraName = \"camera\", this.renderLocation = d(), this.tmpPoint = new l();\n  }\n\n  initialize() {\n    if (this.scheduler && this.handles.add(this.scheduler.registerTask(this.task, this)), this.runTask(), this.map) {\n      const t = () => this._setDirty();\n\n      this.handles.add(o(this.map, \"ground.layers\", \"change\", t, t, t));\n    }\n\n    this._updateRenderLocation();\n  }\n\n  destroy() {\n    this._cancelPendingRequest(), this._propertiesPool.destroy(), this._propertiesPool = null;\n  }\n\n  get _camera() {\n    return this.state[this.cameraName];\n  }\n\n  get location() {\n    const t = this._propertiesPool.get(\"location\");\n\n    return this.renderCoordsHelper.fromRenderCoords(this.renderLocation, t, this.state.spatialReference), t;\n  }\n\n  get scale() {\n    const t = this._camera,\n          e = n(t.eye, this.renderLocation),\n          r = {\n      renderCoordsHelper: this.renderCoordsHelper,\n      state: {\n        camera: t\n      }\n    };\n    return p(r, e, 0);\n  }\n\n  get updating() {\n    return this._dirty || null != this._pendingElevationQueryController;\n  }\n\n  updateRenderLocation() {\n    this._setDirty(), this._updateRenderLocation();\n  }\n\n  _setDirty() {\n    this._dirty || (this._dirty = !0, this.notifyChange(\"updating\"));\n  }\n\n  _cancelPendingRequest() {\n    const t = this._pendingElevationQueryController;\n    t && (this._pendingElevationQueryController = null, t.abort(), this.notifyChange(\"updating\"));\n  }\n\n  get running() {\n    return !this._pendingElevationQueryController && this._dirty;\n  }\n\n  runTask() {\n    if (this._cancelPendingRequest(), this._dirty = !1, this.notifyChange(\"updating\"), !this.map || !this.map.ground) return void this._updateSurfaceAltitude(0);\n    this.renderCoordsHelper.fromRenderCoords(this._camera.eye, this.tmpPoint, this.state.spatialReference);\n    let t = e();\n    this.map.ground.queryElevation(this.tmpPoint, {\n      signal: t.signal,\n      cache: this.cache\n    }).then(t => this._updateSurfaceAltitude(t.geometry.z)).catch(t => {\n      r(t) || this._updateSurfaceAltitude(0);\n    }).catch(() => {}).then(() => {\n      this._pendingElevationQueryController === t && (this._pendingElevationQueryController = null, this.notifyChange(\"updating\")), t = null;\n    }), this._pendingElevationQueryController = t;\n  }\n\n  _updateSurfaceAltitude(t) {\n    this._estimatedSurfaceAltitude !== t && (this._estimatedSurfaceAltitude = t, this._updateRenderLocation());\n  }\n\n  _updateRenderLocation() {\n    this.renderCoordsHelper.setAltitude(_, this._estimatedSurfaceAltitude, this._camera.eye), a(this._get(\"renderLocation\"), _) || this._set(\"renderLocation\", c(this._propertiesPool.get(\"renderLocation\"), _));\n  }\n\n};\nt([i({\n  constructOnly: !0\n})], y.prototype, \"scheduler\", void 0), t([i({\n  constructOnly: !0\n})], y.prototype, \"cache\", void 0), t([i({\n  constructOnly: !0\n})], y.prototype, \"task\", void 0), t([i({\n  constructOnly: !0\n})], y.prototype, \"cameraName\", void 0), t([i({\n  readOnly: !0\n})], y.prototype, \"location\", null), t([i({\n  constructOnly: !0\n})], y.prototype, \"map\", void 0), t([i({\n  readOnly: !0\n})], y.prototype, \"renderLocation\", void 0), t([i({\n  readOnly: !0\n})], y.prototype, \"scale\", null), t([i({\n  readOnly: !0\n})], y.prototype, \"updating\", null), y = t([s(\"esri.views.3d.support.CameraOnSurface\")], y);\n\nconst _ = d();\n\nvar g = y;\nexport default g;\nexport { y as CameraOnSurface };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/support/pointsOfInterest/CameraOnSurface.js"],"names":["_","t","createAbortController","e","isAbortError","r","on","o","property","i","subclass","s","n","k","a","g","c","d","l","distanceToScale","p","PropertiesPool","h","PointOfInterest","u","m","Array","y","constructor","_dirty","_propertiesPool","location","renderLocation","_estimatedSurfaceAltitude","_pendingElevationQueryController","cameraName","tmpPoint","initialize","scheduler","handles","add","registerTask","task","runTask","map","_setDirty","_updateRenderLocation","destroy","_cancelPendingRequest","_camera","state","get","renderCoordsHelper","fromRenderCoords","spatialReference","scale","eye","camera","updating","updateRenderLocation","notifyChange","abort","running","ground","_updateSurfaceAltitude","queryElevation","signal","cache","then","geometry","z","catch","setAltitude","_get","_set","constructOnly","prototype","readOnly","CameraOnSurface"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import{createAbortController as e,isAbortError as r}from\"../../../../core/promiseUtils.js\";import{on as o}from\"../../../../core/watchUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{i as n,k as a,g as c}from\"../../../../chunks/vec3.js\";import{c as d}from\"../../../../chunks/vec3f64.js\";import l from\"../../../../geometry/Point.js\";import{distanceToScale as p}from\"../cameraUtils.js\";import{PropertiesPool as h}from\"../PropertiesPool.js\";import{PointOfInterest as u}from\"./PointOfInterest.js\";const m=Array;let y=class extends u{constructor(t){super(t),this._dirty=!1,this._propertiesPool=new h({location:l,renderLocation:m},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName=\"camera\",this.renderLocation=d(),this.tmpPoint=new l}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const t=()=>this._setDirty();this.handles.add(o(this.map,\"ground.layers\",\"change\",t,t,t))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const t=this._propertiesPool.get(\"location\");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,t,this.state.spatialReference),t}get scale(){const t=this._camera,e=n(t.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:t}};return p(r,e,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange(\"updating\"))}_cancelPendingRequest(){const t=this._pendingElevationQueryController;t&&(this._pendingElevationQueryController=null,t.abort(),this.notifyChange(\"updating\"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange(\"updating\"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let t=e();this.map.ground.queryElevation(this.tmpPoint,{signal:t.signal,cache:this.cache}).then((t=>this._updateSurfaceAltitude(t.geometry.z))).catch((t=>{r(t)||this._updateSurfaceAltitude(0)})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===t&&(this._pendingElevationQueryController=null,this.notifyChange(\"updating\")),t=null})),this._pendingElevationQueryController=t}_updateSurfaceAltitude(t){this._estimatedSurfaceAltitude!==t&&(this._estimatedSurfaceAltitude=t,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(_,this._estimatedSurfaceAltitude,this._camera.eye),a(this._get(\"renderLocation\"),_)||this._set(\"renderLocation\",c(this._propertiesPool.get(\"renderLocation\"),_))}};t([i({constructOnly:!0})],y.prototype,\"scheduler\",void 0),t([i({constructOnly:!0})],y.prototype,\"cache\",void 0),t([i({constructOnly:!0})],y.prototype,\"task\",void 0),t([i({constructOnly:!0})],y.prototype,\"cameraName\",void 0),t([i({readOnly:!0})],y.prototype,\"location\",null),t([i({constructOnly:!0})],y.prototype,\"map\",void 0),t([i({readOnly:!0})],y.prototype,\"renderLocation\",void 0),t([i({readOnly:!0})],y.prototype,\"scale\",null),t([i({readOnly:!0})],y.prototype,\"updating\",null),y=t([s(\"esri.views.3d.support.CameraOnSurface\")],y);const _=d();var g=y;export default g;export{y as CameraOnSurface};\n"]},"metadata":{},"sourceType":"module"}