{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as t, unwrapOr as e, isNone as s } from \"../../../../core/maybe.js\";\nimport { d as i, m as r } from \"../../../../chunks/mat4.js\";\nimport { c as o, b as a, I as n } from \"../../../../chunks/mat4f64.js\";\nimport { e as h, m, i as c, g as d, s as l } from \"../../../../chunks/vec3.js\";\nimport { a as g, f as u, c as _ } from \"../../../../chunks/vec3f64.js\";\nimport { c as b, a as f } from \"../../../../chunks/sphere.js\";\nimport { maxScale as p } from \"../../support/mathUtils.js\";\nimport { ContentObject as y } from \"./ContentObject.js\";\nimport { GeometryRecord as v } from \"./GeometryRecord.js\";\nimport { Object3DStateID as j } from \"./Object3DStateID.js\";\nimport { assert as V } from \"./Util.js\";\nimport { addObject3DStateID as S, removeObject3DStateID as A } from \"../materials/renderers/utils.js\";\n\nclass R extends y {\n  constructor(t = {}) {\n    super(), this.type = 1, this._geometryRecords = new Array(), this._geometries = new Array(), this._objectTransformation = o(), this._bvObjectSpace = new T(), this._bvWorldSpace = new T(), this._bvDirty = !0, this._hasVolatileTransformation = !1, this._visible = !0, this.castShadow = null == t.castShadow || t.castShadow, this.metadata = t.metadata, this.metadata && this.metadata.isElevationSource && (this.metadata.lastValidElevationBB = new x()), this.transformation = o();\n    const {\n      geometries: e,\n      materials: s,\n      transformations: i,\n      origins: r\n    } = t;\n\n    if (Array.isArray(e)) {\n      V(s.length === e.length, \"Object3D: materials don't match geometries\"), V(i.length === e.length, \"Object3D: transformations don't match geometries\"), this._geometryRecords.length = e.length, this._geometries.length = e.length;\n\n      for (let t = 0; t < e.length; t++) this._geometries[t] = e[t], this._geometryRecords[t] = v.pool.acquire(e[t], s[t], a(i[t]), {\n        highlights: null,\n        occludees: null,\n        visible: !0\n      }, r && r[t]);\n    }\n  }\n\n  get geometryRecords() {\n    return this._geometryRecords;\n  }\n\n  get geometries() {\n    return this._geometries;\n  }\n\n  get transformation() {\n    return this._objectTransformation;\n  }\n\n  set transformation(t) {\n    i(this._objectTransformation, t), this._invalidateBoundingVolume(), this._emit(\"objectTransformation\", this);\n  }\n\n  dispose() {\n    this._geometryRecords.length = 0, this._geometries.length = 0;\n  }\n\n  get parentLayer() {\n    return this._parentLayer;\n  }\n\n  set parentLayer(t) {\n    V(null == this._parentLayer || null == t, \"Object3D can only be added to a single Layer\"), this._parentLayer = t;\n  }\n\n  getNumGeometryRecords() {\n    return this._geometryRecords.length;\n  }\n\n  getGeometryRecord(t) {\n    return V(t >= 0 && t < this._geometryRecords.length, \"Object3d.getGeometryDataByIndex: index out of range\"), this._geometryRecords[t];\n  }\n\n  addGeometry(e, s, i, r, o, a) {\n    i = i || n, this._geometries.push(e);\n    const h = v.pool.acquire(e, s, i, r || {\n      highlights: null,\n      occludees: null,\n      visible: !0\n    }, o, a);\n    return this._geometryRecords.push(h), this._hasVolatileTransformation = this._hasVolatileTransformation || t(h.shaderTransformation), this._emit(\"objectGeometryAdded\", {\n      object: this,\n      record: h\n    }), this._invalidateBoundingVolume(), h;\n  }\n\n  removeGeometry(e) {\n    const s = this._geometryRecords.splice(e, 1)[0];\n\n    return this._hasVolatileTransformation = t(s.shaderTransformation) ? this._geometryRecords.some(e => t(e.shaderTransformation)) : this._hasVolatileTransformation, s.dispose(), this._geometries.splice(e, 1), this._emit(\"objectGeometryRemoved\", {\n      object: this,\n      record: s\n    }), this._invalidateBoundingVolume(), s;\n  }\n\n  removeAllGeometries() {\n    for (; this.getNumGeometryRecords() > 0;) this.removeGeometry(0);\n  }\n\n  geometryVertexAttrsUpdated(t) {\n    this._emit(\"vertexAttrsUpdated\", {\n      object: this,\n      record: this._geometryRecords[t]\n    }), this._invalidateBoundingVolume();\n  }\n\n  get isVisible() {\n    return this._visible;\n  }\n\n  setVisible(t) {\n    this._visible = t;\n\n    for (const e of this._geometryRecords) e.instanceParameters.visible = this._visible;\n\n    this._emit(\"visibilityChanged\", this);\n  }\n\n  maskOccludee() {\n    const t = new j(1);\n\n    for (const e of this._geometryRecords) e.instanceParameters.occludees = S(e.instanceParameters.occludees, t);\n\n    return this._emit(\"occlusionChanged\", this), t;\n  }\n\n  removeOcclude(t) {\n    for (const e of this._geometryRecords) e.instanceParameters.occludees = A(e.instanceParameters.occludees, t);\n\n    this._emit(\"occlusionChanged\", this);\n  }\n\n  highlight() {\n    const t = new j(0);\n\n    for (const e of this._geometryRecords) e.instanceParameters.highlights = S(e.instanceParameters.highlights, t);\n\n    return this._emit(\"highlightChanged\", this), t;\n  }\n\n  removeHighlight(t) {\n    for (const e of this._geometryRecords) e.instanceParameters.highlights = A(e.instanceParameters.highlights, t);\n\n    this._emit(\"highlightChanged\", this);\n  }\n\n  getCombinedStaticTransformation(t, s) {\n    return r(e(s, o()), this.transformation, t.getStaticTransformation());\n  }\n\n  getCombinedShaderTransformation(t, e) {\n    return e = e || o(), r(e, this.transformation, t.getShaderTransformation()), e;\n  }\n\n  hasVolativeTransformation() {\n    return this._hasVolatileTransformation;\n  }\n\n  get boundingVolumeWorldSpace() {\n    return this._validateBoundingVolume(), this._bvWorldSpace;\n  }\n\n  get boundingVolumeObjectSpace() {\n    return this._validateBoundingVolume(), this._bvObjectSpace;\n  }\n\n  _validateBoundingVolume() {\n    if (!this._bvDirty && !this._hasVolatileTransformation) return;\n    this._bvObjectSpace.init(), this._bvWorldSpace.init();\n\n    for (let s = 0; s < this._geometryRecords.length; ++s) {\n      const e = this._geometries[s],\n            i = this._geometryRecords[s],\n            r = e.boundingInfo;\n      t(r) && (this._calculateTransformedBoundingVolume(r, this._bvObjectSpace, i.getShaderTransformation()), this._calculateTransformedBoundingVolume(r, this._bvWorldSpace, this.getCombinedShaderTransformation(i)));\n    }\n\n    h(this._bvObjectSpace.bounds, this._bvObjectSpace.min, this._bvObjectSpace.max, .5), h(this._bvWorldSpace.bounds, this._bvWorldSpace.min, this._bvWorldSpace.max, .5);\n\n    const e = _(),\n          i = _(),\n          r = p(this.transformation);\n\n    for (let t = 0; t < this._geometryRecords.length; ++t) {\n      const o = this._geometries[t].boundingInfo;\n      if (s(o)) continue;\n\n      const a = this._geometryRecords[t].getShaderTransformation(),\n            n = p(a);\n\n      m(e, o.getCenter(), a);\n      const h = c(e, this._bvObjectSpace.bounds),\n            d = o.getBSRadius() * n;\n      this._bvObjectSpace.bounds[3] = Math.max(this._bvObjectSpace.bounds[3], h + d), m(i, e, this.transformation);\n      const l = c(i, this._bvWorldSpace.bounds),\n            g = d * r;\n      this._bvWorldSpace.bounds[3] = Math.max(this._bvWorldSpace.bounds[3], l + g);\n    }\n\n    this._bvDirty = !1;\n  }\n\n  _calculateTransformedBoundingVolume(t, e, s) {\n    const i = t.getBBMin(),\n          r = t.getBBMax(),\n          o = g(i),\n          a = g(r);\n    m(o, o, s), m(a, a, s);\n\n    for (let n = 0; n < 3; ++n) e.min[n] = Math.min(e.min[n], o[n], a[n]), e.max[n] = Math.max(e.max[n], o[n], a[n]);\n\n    for (let n = 0; n < 3; ++n) {\n      d(o, i), d(a, r), o[n] = r[n], a[n] = i[n], m(o, o, s), m(a, a, s);\n\n      for (let t = 0; t < 3; ++t) e.min[t] = Math.min(e.min[t], o[t], a[t]), e.max[t] = Math.max(e.max[t], o[t], a[t]);\n    }\n  }\n\n  _invalidateBoundingVolume() {\n    this._bvDirty = !0, t(this._parentLayer) && this._parentLayer.notifyObjectBBChanged(this, this._bvWorldSpace.bounds);\n  }\n\n  _emit(e, s) {\n    t(this._parentLayer) && this._parentLayer.events.emit(e, s);\n  }\n\n  get test() {\n    const t = this;\n    return {\n      hasGeometry: e => t._geometries.indexOf(e) > -1,\n      getGeometryIndex: e => t._geometries.indexOf(e)\n    };\n  }\n\n}\n\nclass x {\n  constructor() {\n    this.min = u(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this.max = u(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\n  }\n\n  isEmpty() {\n    return this.max[0] < this.min[0] && this.max[1] < this.min[1] && this.max[2] < this.min[2];\n  }\n\n}\n\nclass T extends x {\n  constructor() {\n    super(...arguments), this.bounds = b();\n  }\n\n  init() {\n    l(this.min, Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), l(this.max, -Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), f(this.bounds);\n  }\n\n}\n\nexport { R as Object3D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3D.js"],"names":["isSome","t","unwrapOr","e","isNone","s","d","i","m","r","c","o","b","a","I","n","h","g","l","f","u","_","maxScale","p","ContentObject","y","GeometryRecord","v","Object3DStateID","j","assert","V","addObject3DStateID","S","removeObject3DStateID","A","R","constructor","type","_geometryRecords","Array","_geometries","_objectTransformation","_bvObjectSpace","T","_bvWorldSpace","_bvDirty","_hasVolatileTransformation","_visible","castShadow","metadata","isElevationSource","lastValidElevationBB","x","transformation","geometries","materials","transformations","origins","isArray","length","pool","acquire","highlights","occludees","visible","geometryRecords","_invalidateBoundingVolume","_emit","dispose","parentLayer","_parentLayer","getNumGeometryRecords","getGeometryRecord","addGeometry","push","shaderTransformation","object","record","removeGeometry","splice","some","removeAllGeometries","geometryVertexAttrsUpdated","isVisible","setVisible","instanceParameters","maskOccludee","removeOcclude","highlight","removeHighlight","getCombinedStaticTransformation","getStaticTransformation","getCombinedShaderTransformation","getShaderTransformation","hasVolativeTransformation","boundingVolumeWorldSpace","_validateBoundingVolume","boundingVolumeObjectSpace","init","boundingInfo","_calculateTransformedBoundingVolume","bounds","min","max","getCenter","getBSRadius","Math","getBBMin","getBBMax","notifyObjectBBChanged","events","emit","test","hasGeometry","indexOf","getGeometryIndex","Number","MAX_VALUE","isEmpty","arguments","Object3D"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t,unwrapOr as e,isNone as s}from\"../../../../core/maybe.js\";import{d as i,m as r}from\"../../../../chunks/mat4.js\";import{c as o,b as a,I as n}from\"../../../../chunks/mat4f64.js\";import{e as h,m,i as c,g as d,s as l}from\"../../../../chunks/vec3.js\";import{a as g,f as u,c as _}from\"../../../../chunks/vec3f64.js\";import{c as b,a as f}from\"../../../../chunks/sphere.js\";import{maxScale as p}from\"../../support/mathUtils.js\";import{ContentObject as y}from\"./ContentObject.js\";import{GeometryRecord as v}from\"./GeometryRecord.js\";import{Object3DStateID as j}from\"./Object3DStateID.js\";import{assert as V}from\"./Util.js\";import{addObject3DStateID as S,removeObject3DStateID as A}from\"../materials/renderers/utils.js\";class R extends y{constructor(t={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=o(),this._bvObjectSpace=new T,this._bvWorldSpace=new T,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new x),this.transformation=o();const{geometries:e,materials:s,transformations:i,origins:r}=t;if(Array.isArray(e)){V(s.length===e.length,\"Object3D: materials don't match geometries\"),V(i.length===e.length,\"Object3D: transformations don't match geometries\"),this._geometryRecords.length=e.length,this._geometries.length=e.length;for(let t=0;t<e.length;t++)this._geometries[t]=e[t],this._geometryRecords[t]=v.pool.acquire(e[t],s[t],a(i[t]),{highlights:null,occludees:null,visible:!0},r&&r[t])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){i(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit(\"objectTransformation\",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){V(null==this._parentLayer||null==t,\"Object3D can only be added to a single Layer\"),this._parentLayer=t}getNumGeometryRecords(){return this._geometryRecords.length}getGeometryRecord(t){return V(t>=0&&t<this._geometryRecords.length,\"Object3d.getGeometryDataByIndex: index out of range\"),this._geometryRecords[t]}addGeometry(e,s,i,r,o,a){i=i||n,this._geometries.push(e);const h=v.pool.acquire(e,s,i,r||{highlights:null,occludees:null,visible:!0},o,a);return this._geometryRecords.push(h),this._hasVolatileTransformation=this._hasVolatileTransformation||t(h.shaderTransformation),this._emit(\"objectGeometryAdded\",{object:this,record:h}),this._invalidateBoundingVolume(),h}removeGeometry(e){const s=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=t(s.shaderTransformation)?this._geometryRecords.some((e=>t(e.shaderTransformation))):this._hasVolatileTransformation,s.dispose(),this._geometries.splice(e,1),this._emit(\"objectGeometryRemoved\",{object:this,record:s}),this._invalidateBoundingVolume(),s}removeAllGeometries(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit(\"vertexAttrsUpdated\",{object:this,record:this._geometryRecords[t]}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){this._visible=t;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit(\"visibilityChanged\",this)}maskOccludee(){const t=new j(1);for(const e of this._geometryRecords)e.instanceParameters.occludees=S(e.instanceParameters.occludees,t);return this._emit(\"occlusionChanged\",this),t}removeOcclude(t){for(const e of this._geometryRecords)e.instanceParameters.occludees=A(e.instanceParameters.occludees,t);this._emit(\"occlusionChanged\",this)}highlight(){const t=new j(0);for(const e of this._geometryRecords)e.instanceParameters.highlights=S(e.instanceParameters.highlights,t);return this._emit(\"highlightChanged\",this),t}removeHighlight(t){for(const e of this._geometryRecords)e.instanceParameters.highlights=A(e.instanceParameters.highlights,t);this._emit(\"highlightChanged\",this)}getCombinedStaticTransformation(t,s){return r(e(s,o()),this.transformation,t.getStaticTransformation())}getCombinedShaderTransformation(t,e){return e=e||o(),r(e,this.transformation,t.getShaderTransformation()),e}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const e=this._geometries[s],i=this._geometryRecords[s],r=e.boundingInfo;t(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,i.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(i)))}h(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),h(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=_(),i=_(),r=p(this.transformation);for(let t=0;t<this._geometryRecords.length;++t){const o=this._geometries[t].boundingInfo;if(s(o))continue;const a=this._geometryRecords[t].getShaderTransformation(),n=p(a);m(e,o.getCenter(),a);const h=c(e,this._bvObjectSpace.bounds),d=o.getBSRadius()*n;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],h+d),m(i,e,this.transformation);const l=c(i,this._bvWorldSpace.bounds),g=d*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],l+g)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,e,s){const i=t.getBBMin(),r=t.getBBMax(),o=g(i),a=g(r);m(o,o,s),m(a,a,s);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],o[n],a[n]),e.max[n]=Math.max(e.max[n],o[n],a[n]);for(let n=0;n<3;++n){d(o,i),d(a,r),o[n]=r[n],a[n]=i[n],m(o,o,s),m(a,a,s);for(let t=0;t<3;++t)e.min[t]=Math.min(e.min[t],o[t],a[t]),e.max[t]=Math.max(e.max[t],o[t],a[t])}}_invalidateBoundingVolume(){this._bvDirty=!0,t(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,s){t(this._parentLayer)&&this._parentLayer.events.emit(e,s)}get test(){const t=this;return{hasGeometry:e=>t._geometries.indexOf(e)>-1,getGeometryIndex:e=>t._geometries.indexOf(e)}}}class x{constructor(){this.min=u(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=u(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class T extends x{constructor(){super(...arguments),this.bounds=b()}init(){l(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f(this.bounds)}}export{R as Object3D};\n"]},"metadata":{},"sourceType":"module"}