{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isLineBreak as t, isWhiteSpace as e, allowsIdeographicBreak as i, hasVerticalOrientation as s } from \"./ScriptUtils.js\";\nimport o from \"../webgl/Rect.js\";\nconst c = 24,\n      h = 17;\n\nclass a {\n  constructor(t, e, i, s, o, c, h) {\n    this._glyphItems = t, this._maxWidth = e, this._lineHeight = i, this._letterSpacing = s, this._hAnchor = o, this._vAnchor = c, this._justify = h;\n  }\n\n  getShaping(o, c, h) {\n    const a = this._letterSpacing,\n          l = this._lineHeight,\n          r = this._justify,\n          n = this._maxWidth,\n          m = [];\n    let f = 0,\n        p = 0;\n    const g = o.length;\n\n    for (let t = 0; t < g; t++) {\n      const e = o.charCodeAt(t),\n            i = h && s(e);\n      let c;\n\n      for (const t of this._glyphItems) if (c = t[e], c) break;\n\n      m.push({\n        codePoint: e,\n        x: f,\n        y: p,\n        vertical: i,\n        glyphMosaicItem: c\n      }), c && (f += c.metrics.advance + a);\n    }\n\n    let y = f;\n\n    if (n > 0) {\n      y = f / Math.max(1, Math.ceil(f / n));\n    }\n\n    const d = o.indexOf(\"​\") >= 0,\n          x = [];\n\n    for (let e = 0; e < g - 1; e++) {\n      const s = m[e].codePoint,\n            o = i(s);\n\n      if (t(s) || o) {\n        let t = 0;\n        if (10 === s) t -= 1e4;else if (o && d) t += 150;else {\n          40 !== s && 65288 !== s || (t += 50);\n          const i = m[e + 1].codePoint;\n          41 !== i && 65289 !== i || (t += 50);\n        }\n        x.push(this._buildBreak(e + 1, m[e].x, y, x, t, !1));\n      }\n    }\n\n    const M = this._optimalBreaks(this._buildBreak(g, f, y, x, 0, !0));\n\n    let u = 0;\n\n    const _ = c ? -l : l;\n\n    let I = 0;\n\n    for (let t = 0; t < M.length; t++) {\n      const i = M[t];\n      let s = I;\n\n      for (; s < i && e(m[s].codePoint);) m[s].glyphMosaicItem = null, ++s;\n\n      let o = i - 1;\n\n      for (; o > s && e(m[o].codePoint);) m[o].glyphMosaicItem = null, --o;\n\n      if (s <= o) {\n        const t = m[s].x;\n\n        for (let i = s; i <= o; i++) m[i].x -= t, m[i].y = p;\n\n        let e = m[o].x;\n        m[o].glyphMosaicItem && (e += m[o].glyphMosaicItem.metrics.advance), u = Math.max(e, u), r && this._applyJustification(m, s, o);\n      }\n\n      I = i, p += _;\n    }\n\n    if (m.length > 0) {\n      const t = M.length - 1,\n            e = (r - this._hAnchor) * u;\n      let i = (-this._vAnchor * (t + 1) + .5) * l;\n      c && t && (i += t * l);\n\n      for (const s of m) s.x += e, s.y += i;\n    }\n\n    return m.filter(t => t.glyphMosaicItem);\n  }\n\n  static getTextBox(t, e) {\n    if (!t.length) return null;\n    let i = 1 / 0,\n        s = 1 / 0,\n        o = 0,\n        c = 0;\n\n    for (const a of t) {\n      const t = a.glyphMosaicItem.metrics.advance,\n            l = a.x,\n            r = a.y - h,\n            n = l + t,\n            m = r + e;\n      i = Math.min(i, l), o = Math.max(o, n), s = Math.min(s, r), c = Math.max(c, m);\n    }\n\n    return {\n      x: i,\n      y: s,\n      width: o - i,\n      height: c - s\n    };\n  }\n\n  static getBox(t) {\n    if (!t.length) return null;\n    let e = 1 / 0,\n        i = 1 / 0,\n        s = 0,\n        o = 0;\n\n    for (const c of t) {\n      const {\n        height: t,\n        left: h,\n        top: a,\n        width: l\n      } = c.glyphMosaicItem.metrics,\n            r = c.x,\n            n = c.y - (t - Math.abs(a)),\n            m = r + l + h,\n            f = n + t;\n      e = Math.min(e, r), s = Math.max(s, m), i = Math.min(i, n), o = Math.max(o, f);\n    }\n\n    return {\n      x: e,\n      y: i,\n      width: s - e,\n      height: o - i\n    };\n  }\n\n  static addDecoration(t, e) {\n    const i = t.length;\n    if (0 === i) return;\n    const s = 3;\n    let c = t[0].x + t[0].glyphMosaicItem.metrics.left,\n        h = t[0].y;\n\n    for (let l = 1; l < i; l++) {\n      const i = t[l];\n\n      if (i.y !== h) {\n        const a = t[l - 1].x + t[l - 1].glyphMosaicItem.metrics.left + t[l - 1].glyphMosaicItem.metrics.width;\n        t.push({\n          codePoint: 0,\n          x: c,\n          y: h + e - s,\n          vertical: !1,\n          glyphMosaicItem: {\n            sdf: !0,\n            rect: new o(4, 0, 4, 8),\n            metrics: {\n              width: a - c,\n              height: 2 + 2 * s,\n              left: 0,\n              top: 0,\n              advance: 0\n            },\n            page: 0,\n            code: 0\n          }\n        }), h = i.y, c = i.x + i.glyphMosaicItem.metrics.left;\n      }\n    }\n\n    const a = t[i - 1].x + t[i - 1].glyphMosaicItem.metrics.left + t[i - 1].glyphMosaicItem.metrics.width;\n    t.push({\n      codePoint: 0,\n      x: c,\n      y: h + e - s,\n      vertical: !1,\n      glyphMosaicItem: {\n        sdf: !0,\n        rect: new o(4, 0, 4, 8),\n        metrics: {\n          width: a - c,\n          height: 2 + 2 * s,\n          left: 0,\n          top: 0,\n          advance: 0\n        },\n        page: 0,\n        code: 0\n      }\n    });\n  }\n\n  _breakScore(t, e, i, s) {\n    const o = (t - e) * (t - e);\n    return s ? t < e ? o / 2 : 2 * o : o + Math.abs(i) * i;\n  }\n\n  _buildBreak(t, e, i, s, o, c) {\n    let h = null,\n        a = this._breakScore(e, i, o, c);\n\n    for (const l of s) {\n      const t = e - l.x,\n            s = this._breakScore(t, i, o, c) + l.score;\n      s <= a && (h = l, a = s);\n    }\n\n    return {\n      index: t,\n      x: e,\n      score: a,\n      previousBreak: h\n    };\n  }\n\n  _optimalBreaks(t) {\n    return t ? this._optimalBreaks(t.previousBreak).concat(t.index) : [];\n  }\n\n  _applyJustification(t, e, i) {\n    const s = t[i],\n          o = s.vertical ? c : s.glyphMosaicItem ? s.glyphMosaicItem.metrics.advance : 0,\n          h = (s.x + o) * this._justify;\n\n    for (let c = e; c <= i; c++) t[c].x -= h;\n  }\n\n}\n\nexport { h as SDF_GLYPH_BASELINE, c as SDF_GLYPH_SIZE, a as TextShaping };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/TextShaping.js"],"names":["isLineBreak","t","isWhiteSpace","e","allowsIdeographicBreak","i","hasVerticalOrientation","s","o","c","h","a","constructor","_glyphItems","_maxWidth","_lineHeight","_letterSpacing","_hAnchor","_vAnchor","_justify","getShaping","l","r","n","m","f","p","g","length","charCodeAt","push","codePoint","x","y","vertical","glyphMosaicItem","metrics","advance","Math","max","ceil","d","indexOf","_buildBreak","M","_optimalBreaks","u","_","I","_applyJustification","filter","getTextBox","min","width","height","getBox","left","top","abs","addDecoration","sdf","rect","page","code","_breakScore","score","index","previousBreak","concat","SDF_GLYPH_BASELINE","SDF_GLYPH_SIZE","TextShaping"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,WAAW,IAAIC,CAAtB,EAAwBC,YAAY,IAAIC,CAAxC,EAA0CC,sBAAsB,IAAIC,CAApE,EAAsEC,sBAAsB,IAAIC,CAAhG,QAAsG,kBAAtG;AAAyH,OAAOC,CAAP,MAAa,kBAAb;AAAgC,MAAMC,CAAC,GAAC,EAAR;AAAA,MAAWC,CAAC,GAAC,EAAb;;AAAgB,MAAMC,CAAN,CAAO;AAACC,EAAAA,WAAW,CAACX,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAe;AAAC,SAAKG,WAAL,GAAiBZ,CAAjB,EAAmB,KAAKa,SAAL,GAAeX,CAAlC,EAAoC,KAAKY,WAAL,GAAiBV,CAArD,EAAuD,KAAKW,cAAL,GAAoBT,CAA3E,EAA6E,KAAKU,QAAL,GAAcT,CAA3F,EAA6F,KAAKU,QAAL,GAAcT,CAA3G,EAA6G,KAAKU,QAAL,GAAcT,CAA3H;AAA6H;;AAAAU,EAAAA,UAAU,CAACZ,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAO;AAAC,UAAMC,CAAC,GAAC,KAAKK,cAAb;AAAA,UAA4BK,CAAC,GAAC,KAAKN,WAAnC;AAAA,UAA+CO,CAAC,GAAC,KAAKH,QAAtD;AAAA,UAA+DI,CAAC,GAAC,KAAKT,SAAtE;AAAA,UAAgFU,CAAC,GAAC,EAAlF;AAAqF,QAAIC,CAAC,GAAC,CAAN;AAAA,QAAQC,CAAC,GAAC,CAAV;AAAY,UAAMC,CAAC,GAACnB,CAAC,CAACoB,MAAV;;AAAiB,SAAI,IAAI3B,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC0B,CAAd,EAAgB1B,CAAC,EAAjB,EAAoB;AAAC,YAAME,CAAC,GAACK,CAAC,CAACqB,UAAF,CAAa5B,CAAb,CAAR;AAAA,YAAwBI,CAAC,GAACK,CAAC,IAAEH,CAAC,CAACJ,CAAD,CAA9B;AAAkC,UAAIM,CAAJ;;AAAM,WAAI,MAAMR,CAAV,IAAe,KAAKY,WAApB,EAAgC,IAAGJ,CAAC,GAACR,CAAC,CAACE,CAAD,CAAH,EAAOM,CAAV,EAAY;;AAAMe,MAAAA,CAAC,CAACM,IAAF,CAAO;AAACC,QAAAA,SAAS,EAAC5B,CAAX;AAAa6B,QAAAA,CAAC,EAACP,CAAf;AAAiBQ,QAAAA,CAAC,EAACP,CAAnB;AAAqBQ,QAAAA,QAAQ,EAAC7B,CAA9B;AAAgC8B,QAAAA,eAAe,EAAC1B;AAAhD,OAAP,GAA2DA,CAAC,KAAGgB,CAAC,IAAEhB,CAAC,CAAC2B,OAAF,CAAUC,OAAV,GAAkB1B,CAAxB,CAA5D;AAAuF;;AAAA,QAAIsB,CAAC,GAACR,CAAN;;AAAQ,QAAGF,CAAC,GAAC,CAAL,EAAO;AAACU,MAAAA,CAAC,GAACR,CAAC,GAACa,IAAI,CAACC,GAAL,CAAS,CAAT,EAAWD,IAAI,CAACE,IAAL,CAAUf,CAAC,GAACF,CAAZ,CAAX,CAAJ;AAA+B;;AAAA,UAAMkB,CAAC,GAACjC,CAAC,CAACkC,OAAF,CAAU,GAAV,KAAgB,CAAxB;AAAA,UAA0BV,CAAC,GAAC,EAA5B;;AAA+B,SAAI,IAAI7B,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACwB,CAAC,GAAC,CAAhB,EAAkBxB,CAAC,EAAnB,EAAsB;AAAC,YAAMI,CAAC,GAACiB,CAAC,CAACrB,CAAD,CAAD,CAAK4B,SAAb;AAAA,YAAuBvB,CAAC,GAACH,CAAC,CAACE,CAAD,CAA1B;;AAA8B,UAAGN,CAAC,CAACM,CAAD,CAAD,IAAMC,CAAT,EAAW;AAAC,YAAIP,CAAC,GAAC,CAAN;AAAQ,YAAG,OAAKM,CAAR,EAAUN,CAAC,IAAE,GAAH,CAAV,KAAsB,IAAGO,CAAC,IAAEiC,CAAN,EAAQxC,CAAC,IAAE,GAAH,CAAR,KAAmB;AAAC,iBAAKM,CAAL,IAAQ,UAAQA,CAAhB,KAAoBN,CAAC,IAAE,EAAvB;AAA2B,gBAAMI,CAAC,GAACmB,CAAC,CAACrB,CAAC,GAAC,CAAH,CAAD,CAAO4B,SAAf;AAAyB,iBAAK1B,CAAL,IAAQ,UAAQA,CAAhB,KAAoBJ,CAAC,IAAE,EAAvB;AAA2B;AAAA+B,QAAAA,CAAC,CAACF,IAAF,CAAO,KAAKa,WAAL,CAAiBxC,CAAC,GAAC,CAAnB,EAAqBqB,CAAC,CAACrB,CAAD,CAAD,CAAK6B,CAA1B,EAA4BC,CAA5B,EAA8BD,CAA9B,EAAgC/B,CAAhC,EAAkC,CAAC,CAAnC,CAAP;AAA8C;AAAC;;AAAA,UAAM2C,CAAC,GAAC,KAAKC,cAAL,CAAoB,KAAKF,WAAL,CAAiBhB,CAAjB,EAAmBF,CAAnB,EAAqBQ,CAArB,EAAuBD,CAAvB,EAAyB,CAAzB,EAA2B,CAAC,CAA5B,CAApB,CAAR;;AAA4D,QAAIc,CAAC,GAAC,CAAN;;AAAQ,UAAMC,CAAC,GAACtC,CAAC,GAAC,CAACY,CAAF,GAAIA,CAAb;;AAAe,QAAI2B,CAAC,GAAC,CAAN;;AAAQ,SAAI,IAAI/C,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC2C,CAAC,CAAChB,MAAhB,EAAuB3B,CAAC,EAAxB,EAA2B;AAAC,YAAMI,CAAC,GAACuC,CAAC,CAAC3C,CAAD,CAAT;AAAa,UAAIM,CAAC,GAACyC,CAAN;;AAAQ,aAAKzC,CAAC,GAACF,CAAF,IAAKF,CAAC,CAACqB,CAAC,CAACjB,CAAD,CAAD,CAAKwB,SAAN,CAAX,GAA6BP,CAAC,CAACjB,CAAD,CAAD,CAAK4B,eAAL,GAAqB,IAArB,EAA0B,EAAE5B,CAA5B;;AAA8B,UAAIC,CAAC,GAACH,CAAC,GAAC,CAAR;;AAAU,aAAKG,CAAC,GAACD,CAAF,IAAKJ,CAAC,CAACqB,CAAC,CAAChB,CAAD,CAAD,CAAKuB,SAAN,CAAX,GAA6BP,CAAC,CAAChB,CAAD,CAAD,CAAK2B,eAAL,GAAqB,IAArB,EAA0B,EAAE3B,CAA5B;;AAA8B,UAAGD,CAAC,IAAEC,CAAN,EAAQ;AAAC,cAAMP,CAAC,GAACuB,CAAC,CAACjB,CAAD,CAAD,CAAKyB,CAAb;;AAAe,aAAI,IAAI3B,CAAC,GAACE,CAAV,EAAYF,CAAC,IAAEG,CAAf,EAAiBH,CAAC,EAAlB,EAAqBmB,CAAC,CAACnB,CAAD,CAAD,CAAK2B,CAAL,IAAQ/B,CAAR,EAAUuB,CAAC,CAACnB,CAAD,CAAD,CAAK4B,CAAL,GAAOP,CAAjB;;AAAmB,YAAIvB,CAAC,GAACqB,CAAC,CAAChB,CAAD,CAAD,CAAKwB,CAAX;AAAaR,QAAAA,CAAC,CAAChB,CAAD,CAAD,CAAK2B,eAAL,KAAuBhC,CAAC,IAAEqB,CAAC,CAAChB,CAAD,CAAD,CAAK2B,eAAL,CAAqBC,OAArB,CAA6BC,OAAvD,GAAgES,CAAC,GAACR,IAAI,CAACC,GAAL,CAASpC,CAAT,EAAW2C,CAAX,CAAlE,EAAgFxB,CAAC,IAAE,KAAK2B,mBAAL,CAAyBzB,CAAzB,EAA2BjB,CAA3B,EAA6BC,CAA7B,CAAnF;AAAmH;;AAAAwC,MAAAA,CAAC,GAAC3C,CAAF,EAAIqB,CAAC,IAAEqB,CAAP;AAAS;;AAAA,QAAGvB,CAAC,CAACI,MAAF,GAAS,CAAZ,EAAc;AAAC,YAAM3B,CAAC,GAAC2C,CAAC,CAAChB,MAAF,GAAS,CAAjB;AAAA,YAAmBzB,CAAC,GAAC,CAACmB,CAAC,GAAC,KAAKL,QAAR,IAAkB6B,CAAvC;AAAyC,UAAIzC,CAAC,GAAC,CAAC,CAAC,KAAKa,QAAN,IAAgBjB,CAAC,GAAC,CAAlB,IAAqB,EAAtB,IAA0BoB,CAAhC;AAAkCZ,MAAAA,CAAC,IAAER,CAAH,KAAOI,CAAC,IAAEJ,CAAC,GAACoB,CAAZ;;AAAe,WAAI,MAAMd,CAAV,IAAeiB,CAAf,EAAiBjB,CAAC,CAACyB,CAAF,IAAK7B,CAAL,EAAOI,CAAC,CAAC0B,CAAF,IAAK5B,CAAZ;AAAc;;AAAA,WAAOmB,CAAC,CAAC0B,MAAF,CAAUjD,CAAC,IAAEA,CAAC,CAACkC,eAAf,CAAP;AAAwC;;AAAiB,SAAVgB,UAAU,CAAClD,CAAD,EAAGE,CAAH,EAAK;AAAC,QAAG,CAACF,CAAC,CAAC2B,MAAN,EAAa,OAAO,IAAP;AAAY,QAAIvB,CAAC,GAAC,IAAE,CAAR;AAAA,QAAUE,CAAC,GAAC,IAAE,CAAd;AAAA,QAAgBC,CAAC,GAAC,CAAlB;AAAA,QAAoBC,CAAC,GAAC,CAAtB;;AAAwB,SAAI,MAAME,CAAV,IAAeV,CAAf,EAAiB;AAAC,YAAMA,CAAC,GAACU,CAAC,CAACwB,eAAF,CAAkBC,OAAlB,CAA0BC,OAAlC;AAAA,YAA0ChB,CAAC,GAACV,CAAC,CAACqB,CAA9C;AAAA,YAAgDV,CAAC,GAACX,CAAC,CAACsB,CAAF,GAAIvB,CAAtD;AAAA,YAAwDa,CAAC,GAACF,CAAC,GAACpB,CAA5D;AAAA,YAA8DuB,CAAC,GAACF,CAAC,GAACnB,CAAlE;AAAoEE,MAAAA,CAAC,GAACiC,IAAI,CAACc,GAAL,CAAS/C,CAAT,EAAWgB,CAAX,CAAF,EAAgBb,CAAC,GAAC8B,IAAI,CAACC,GAAL,CAAS/B,CAAT,EAAWe,CAAX,CAAlB,EAAgChB,CAAC,GAAC+B,IAAI,CAACc,GAAL,CAAS7C,CAAT,EAAWe,CAAX,CAAlC,EAAgDb,CAAC,GAAC6B,IAAI,CAACC,GAAL,CAAS9B,CAAT,EAAWe,CAAX,CAAlD;AAAgE;;AAAA,WAAM;AAACQ,MAAAA,CAAC,EAAC3B,CAAH;AAAK4B,MAAAA,CAAC,EAAC1B,CAAP;AAAS8C,MAAAA,KAAK,EAAC7C,CAAC,GAACH,CAAjB;AAAmBiD,MAAAA,MAAM,EAAC7C,CAAC,GAACF;AAA5B,KAAN;AAAqC;;AAAa,SAANgD,MAAM,CAACtD,CAAD,EAAG;AAAC,QAAG,CAACA,CAAC,CAAC2B,MAAN,EAAa,OAAO,IAAP;AAAY,QAAIzB,CAAC,GAAC,IAAE,CAAR;AAAA,QAAUE,CAAC,GAAC,IAAE,CAAd;AAAA,QAAgBE,CAAC,GAAC,CAAlB;AAAA,QAAoBC,CAAC,GAAC,CAAtB;;AAAwB,SAAI,MAAMC,CAAV,IAAeR,CAAf,EAAiB;AAAC,YAAK;AAACqD,QAAAA,MAAM,EAACrD,CAAR;AAAUuD,QAAAA,IAAI,EAAC9C,CAAf;AAAiB+C,QAAAA,GAAG,EAAC9C,CAArB;AAAuB0C,QAAAA,KAAK,EAAChC;AAA7B,UAAgCZ,CAAC,CAAC0B,eAAF,CAAkBC,OAAvD;AAAA,YAA+Dd,CAAC,GAACb,CAAC,CAACuB,CAAnE;AAAA,YAAqET,CAAC,GAACd,CAAC,CAACwB,CAAF,IAAKhC,CAAC,GAACqC,IAAI,CAACoB,GAAL,CAAS/C,CAAT,CAAP,CAAvE;AAAA,YAA2Fa,CAAC,GAACF,CAAC,GAACD,CAAF,GAAIX,CAAjG;AAAA,YAAmGe,CAAC,GAACF,CAAC,GAACtB,CAAvG;AAAyGE,MAAAA,CAAC,GAACmC,IAAI,CAACc,GAAL,CAASjD,CAAT,EAAWmB,CAAX,CAAF,EAAgBf,CAAC,GAAC+B,IAAI,CAACC,GAAL,CAAShC,CAAT,EAAWiB,CAAX,CAAlB,EAAgCnB,CAAC,GAACiC,IAAI,CAACc,GAAL,CAAS/C,CAAT,EAAWkB,CAAX,CAAlC,EAAgDf,CAAC,GAAC8B,IAAI,CAACC,GAAL,CAAS/B,CAAT,EAAWiB,CAAX,CAAlD;AAAgE;;AAAA,WAAM;AAACO,MAAAA,CAAC,EAAC7B,CAAH;AAAK8B,MAAAA,CAAC,EAAC5B,CAAP;AAASgD,MAAAA,KAAK,EAAC9C,CAAC,GAACJ,CAAjB;AAAmBmD,MAAAA,MAAM,EAAC9C,CAAC,GAACH;AAA5B,KAAN;AAAqC;;AAAoB,SAAbsD,aAAa,CAAC1D,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAME,CAAC,GAACJ,CAAC,CAAC2B,MAAV;AAAiB,QAAG,MAAIvB,CAAP,EAAS;AAAO,UAAME,CAAC,GAAC,CAAR;AAAU,QAAIE,CAAC,GAACR,CAAC,CAAC,CAAD,CAAD,CAAK+B,CAAL,GAAO/B,CAAC,CAAC,CAAD,CAAD,CAAKkC,eAAL,CAAqBC,OAArB,CAA6BoB,IAA1C;AAAA,QAA+C9C,CAAC,GAACT,CAAC,CAAC,CAAD,CAAD,CAAKgC,CAAtD;;AAAwD,SAAI,IAAIZ,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAChB,CAAd,EAAgBgB,CAAC,EAAjB,EAAoB;AAAC,YAAMhB,CAAC,GAACJ,CAAC,CAACoB,CAAD,CAAT;;AAAa,UAAGhB,CAAC,CAAC4B,CAAF,KAAMvB,CAAT,EAAW;AAAC,cAAMC,CAAC,GAACV,CAAC,CAACoB,CAAC,GAAC,CAAH,CAAD,CAAOW,CAAP,GAAS/B,CAAC,CAACoB,CAAC,GAAC,CAAH,CAAD,CAAOc,eAAP,CAAuBC,OAAvB,CAA+BoB,IAAxC,GAA6CvD,CAAC,CAACoB,CAAC,GAAC,CAAH,CAAD,CAAOc,eAAP,CAAuBC,OAAvB,CAA+BiB,KAApF;AAA0FpD,QAAAA,CAAC,CAAC6B,IAAF,CAAO;AAACC,UAAAA,SAAS,EAAC,CAAX;AAAaC,UAAAA,CAAC,EAACvB,CAAf;AAAiBwB,UAAAA,CAAC,EAACvB,CAAC,GAACP,CAAF,GAAII,CAAvB;AAAyB2B,UAAAA,QAAQ,EAAC,CAAC,CAAnC;AAAqCC,UAAAA,eAAe,EAAC;AAACyB,YAAAA,GAAG,EAAC,CAAC,CAAN;AAAQC,YAAAA,IAAI,EAAC,IAAIrD,CAAJ,CAAM,CAAN,EAAQ,CAAR,EAAU,CAAV,EAAY,CAAZ,CAAb;AAA4B4B,YAAAA,OAAO,EAAC;AAACiB,cAAAA,KAAK,EAAC1C,CAAC,GAACF,CAAT;AAAW6C,cAAAA,MAAM,EAAC,IAAE,IAAE/C,CAAtB;AAAwBiD,cAAAA,IAAI,EAAC,CAA7B;AAA+BC,cAAAA,GAAG,EAAC,CAAnC;AAAqCpB,cAAAA,OAAO,EAAC;AAA7C,aAApC;AAAoFyB,YAAAA,IAAI,EAAC,CAAzF;AAA2FC,YAAAA,IAAI,EAAC;AAAhG;AAArD,SAAP,GAAiKrD,CAAC,GAACL,CAAC,CAAC4B,CAArK,EAAuKxB,CAAC,GAACJ,CAAC,CAAC2B,CAAF,GAAI3B,CAAC,CAAC8B,eAAF,CAAkBC,OAAlB,CAA0BoB,IAAvM;AAA4M;AAAC;;AAAA,UAAM7C,CAAC,GAACV,CAAC,CAACI,CAAC,GAAC,CAAH,CAAD,CAAO2B,CAAP,GAAS/B,CAAC,CAACI,CAAC,GAAC,CAAH,CAAD,CAAO8B,eAAP,CAAuBC,OAAvB,CAA+BoB,IAAxC,GAA6CvD,CAAC,CAACI,CAAC,GAAC,CAAH,CAAD,CAAO8B,eAAP,CAAuBC,OAAvB,CAA+BiB,KAApF;AAA0FpD,IAAAA,CAAC,CAAC6B,IAAF,CAAO;AAACC,MAAAA,SAAS,EAAC,CAAX;AAAaC,MAAAA,CAAC,EAACvB,CAAf;AAAiBwB,MAAAA,CAAC,EAACvB,CAAC,GAACP,CAAF,GAAII,CAAvB;AAAyB2B,MAAAA,QAAQ,EAAC,CAAC,CAAnC;AAAqCC,MAAAA,eAAe,EAAC;AAACyB,QAAAA,GAAG,EAAC,CAAC,CAAN;AAAQC,QAAAA,IAAI,EAAC,IAAIrD,CAAJ,CAAM,CAAN,EAAQ,CAAR,EAAU,CAAV,EAAY,CAAZ,CAAb;AAA4B4B,QAAAA,OAAO,EAAC;AAACiB,UAAAA,KAAK,EAAC1C,CAAC,GAACF,CAAT;AAAW6C,UAAAA,MAAM,EAAC,IAAE,IAAE/C,CAAtB;AAAwBiD,UAAAA,IAAI,EAAC,CAA7B;AAA+BC,UAAAA,GAAG,EAAC,CAAnC;AAAqCpB,UAAAA,OAAO,EAAC;AAA7C,SAApC;AAAoFyB,QAAAA,IAAI,EAAC,CAAzF;AAA2FC,QAAAA,IAAI,EAAC;AAAhG;AAArD,KAAP;AAAiK;;AAAAC,EAAAA,WAAW,CAAC/D,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;AAAC,UAAMC,CAAC,GAAC,CAACP,CAAC,GAACE,CAAH,KAAOF,CAAC,GAACE,CAAT,CAAR;AAAoB,WAAOI,CAAC,GAACN,CAAC,GAACE,CAAF,GAAIK,CAAC,GAAC,CAAN,GAAQ,IAAEA,CAAX,GAAaA,CAAC,GAAC8B,IAAI,CAACoB,GAAL,CAASrD,CAAT,IAAYA,CAAnC;AAAqC;;AAAAsC,EAAAA,WAAW,CAAC1C,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAa;AAAC,QAAIC,CAAC,GAAC,IAAN;AAAA,QAAWC,CAAC,GAAC,KAAKqD,WAAL,CAAiB7D,CAAjB,EAAmBE,CAAnB,EAAqBG,CAArB,EAAuBC,CAAvB,CAAb;;AAAuC,SAAI,MAAMY,CAAV,IAAed,CAAf,EAAiB;AAAC,YAAMN,CAAC,GAACE,CAAC,GAACkB,CAAC,CAACW,CAAZ;AAAA,YAAczB,CAAC,GAAC,KAAKyD,WAAL,CAAiB/D,CAAjB,EAAmBI,CAAnB,EAAqBG,CAArB,EAAuBC,CAAvB,IAA0BY,CAAC,CAAC4C,KAA5C;AAAkD1D,MAAAA,CAAC,IAAEI,CAAH,KAAOD,CAAC,GAACW,CAAF,EAAIV,CAAC,GAACJ,CAAb;AAAgB;;AAAA,WAAM;AAAC2D,MAAAA,KAAK,EAACjE,CAAP;AAAS+B,MAAAA,CAAC,EAAC7B,CAAX;AAAa8D,MAAAA,KAAK,EAACtD,CAAnB;AAAqBwD,MAAAA,aAAa,EAACzD;AAAnC,KAAN;AAA4C;;AAAAmC,EAAAA,cAAc,CAAC5C,CAAD,EAAG;AAAC,WAAOA,CAAC,GAAC,KAAK4C,cAAL,CAAoB5C,CAAC,CAACkE,aAAtB,EAAqCC,MAArC,CAA4CnE,CAAC,CAACiE,KAA9C,CAAD,GAAsD,EAA9D;AAAiE;;AAAAjB,EAAAA,mBAAmB,CAAChD,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;AAAC,UAAME,CAAC,GAACN,CAAC,CAACI,CAAD,CAAT;AAAA,UAAaG,CAAC,GAACD,CAAC,CAAC2B,QAAF,GAAWzB,CAAX,GAAaF,CAAC,CAAC4B,eAAF,GAAkB5B,CAAC,CAAC4B,eAAF,CAAkBC,OAAlB,CAA0BC,OAA5C,GAAoD,CAAhF;AAAA,UAAkF3B,CAAC,GAAC,CAACH,CAAC,CAACyB,CAAF,GAAIxB,CAAL,IAAQ,KAAKW,QAAjG;;AAA0G,SAAI,IAAIV,CAAC,GAACN,CAAV,EAAYM,CAAC,IAAEJ,CAAf,EAAiBI,CAAC,EAAlB,EAAqBR,CAAC,CAACQ,CAAD,CAAD,CAAKuB,CAAL,IAAQtB,CAAR;AAAU;;AAA9pG;;AAA+pG,SAAOA,CAAC,IAAI2D,kBAAZ,EAA+B5D,CAAC,IAAI6D,cAApC,EAAmD3D,CAAC,IAAI4D,WAAxD","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isLineBreak as t,isWhiteSpace as e,allowsIdeographicBreak as i,hasVerticalOrientation as s}from\"./ScriptUtils.js\";import o from\"../webgl/Rect.js\";const c=24,h=17;class a{constructor(t,e,i,s,o,c,h){this._glyphItems=t,this._maxWidth=e,this._lineHeight=i,this._letterSpacing=s,this._hAnchor=o,this._vAnchor=c,this._justify=h}getShaping(o,c,h){const a=this._letterSpacing,l=this._lineHeight,r=this._justify,n=this._maxWidth,m=[];let f=0,p=0;const g=o.length;for(let t=0;t<g;t++){const e=o.charCodeAt(t),i=h&&s(e);let c;for(const t of this._glyphItems)if(c=t[e],c)break;m.push({codePoint:e,x:f,y:p,vertical:i,glyphMosaicItem:c}),c&&(f+=c.metrics.advance+a)}let y=f;if(n>0){y=f/Math.max(1,Math.ceil(f/n))}const d=o.indexOf(\"​\")>=0,x=[];for(let e=0;e<g-1;e++){const s=m[e].codePoint,o=i(s);if(t(s)||o){let t=0;if(10===s)t-=1e4;else if(o&&d)t+=150;else{40!==s&&65288!==s||(t+=50);const i=m[e+1].codePoint;41!==i&&65289!==i||(t+=50)}x.push(this._buildBreak(e+1,m[e].x,y,x,t,!1))}}const M=this._optimalBreaks(this._buildBreak(g,f,y,x,0,!0));let u=0;const _=c?-l:l;let I=0;for(let t=0;t<M.length;t++){const i=M[t];let s=I;for(;s<i&&e(m[s].codePoint);)m[s].glyphMosaicItem=null,++s;let o=i-1;for(;o>s&&e(m[o].codePoint);)m[o].glyphMosaicItem=null,--o;if(s<=o){const t=m[s].x;for(let i=s;i<=o;i++)m[i].x-=t,m[i].y=p;let e=m[o].x;m[o].glyphMosaicItem&&(e+=m[o].glyphMosaicItem.metrics.advance),u=Math.max(e,u),r&&this._applyJustification(m,s,o)}I=i,p+=_}if(m.length>0){const t=M.length-1,e=(r-this._hAnchor)*u;let i=(-this._vAnchor*(t+1)+.5)*l;c&&t&&(i+=t*l);for(const s of m)s.x+=e,s.y+=i}return m.filter((t=>t.glyphMosaicItem))}static getTextBox(t,e){if(!t.length)return null;let i=1/0,s=1/0,o=0,c=0;for(const a of t){const t=a.glyphMosaicItem.metrics.advance,l=a.x,r=a.y-h,n=l+t,m=r+e;i=Math.min(i,l),o=Math.max(o,n),s=Math.min(s,r),c=Math.max(c,m)}return{x:i,y:s,width:o-i,height:c-s}}static getBox(t){if(!t.length)return null;let e=1/0,i=1/0,s=0,o=0;for(const c of t){const{height:t,left:h,top:a,width:l}=c.glyphMosaicItem.metrics,r=c.x,n=c.y-(t-Math.abs(a)),m=r+l+h,f=n+t;e=Math.min(e,r),s=Math.max(s,m),i=Math.min(i,n),o=Math.max(o,f)}return{x:e,y:i,width:s-e,height:o-i}}static addDecoration(t,e){const i=t.length;if(0===i)return;const s=3;let c=t[0].x+t[0].glyphMosaicItem.metrics.left,h=t[0].y;for(let l=1;l<i;l++){const i=t[l];if(i.y!==h){const a=t[l-1].x+t[l-1].glyphMosaicItem.metrics.left+t[l-1].glyphMosaicItem.metrics.width;t.push({codePoint:0,x:c,y:h+e-s,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new o(4,0,4,8),metrics:{width:a-c,height:2+2*s,left:0,top:0,advance:0},page:0,code:0}}),h=i.y,c=i.x+i.glyphMosaicItem.metrics.left}}const a=t[i-1].x+t[i-1].glyphMosaicItem.metrics.left+t[i-1].glyphMosaicItem.metrics.width;t.push({codePoint:0,x:c,y:h+e-s,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new o(4,0,4,8),metrics:{width:a-c,height:2+2*s,left:0,top:0,advance:0},page:0,code:0}})}_breakScore(t,e,i,s){const o=(t-e)*(t-e);return s?t<e?o/2:2*o:o+Math.abs(i)*i}_buildBreak(t,e,i,s,o,c){let h=null,a=this._breakScore(e,i,o,c);for(const l of s){const t=e-l.x,s=this._breakScore(t,i,o,c)+l.score;s<=a&&(h=l,a=s)}return{index:t,x:e,score:a,previousBreak:h}}_optimalBreaks(t){return t?this._optimalBreaks(t.previousBreak).concat(t.index):[]}_applyJustification(t,e,i){const s=t[i],o=s.vertical?c:s.glyphMosaicItem?s.glyphMosaicItem.metrics.advance:0,h=(s.x+o)*this._justify;for(let c=e;c<=i;c++)t[c].x-=h}}export{h as SDF_GLYPH_BASELINE,c as SDF_GLYPH_SIZE,a as TextShaping};\n"]},"metadata":{},"sourceType":"module"}