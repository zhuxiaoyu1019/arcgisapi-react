{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport r from \"../../core/Error.js\";\nimport { isSome as t } from \"../../core/maybe.js\";\nimport { eachAlways as o } from \"../../core/promiseUtils.js\";\nimport { property as s } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport \"../../core/Logger.js\";\nimport { subclass as a } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { combinedViewLayerTimeExtentProperty as p } from \"../../layers/support/commonProperties.js\";\nimport { ExportImageParameters as i } from \"../../layers/support/ExportImageParameters.js\";\nimport { calculateTolerance as m } from \"../../renderers/support/clickToleranceUtils.js\";\nimport { loadArcade as l } from \"../../support/arcadeOnDemand.js\";\nimport { getRequiredFields as n, getFetchPopupTemplate as u } from \"./support/popupUtils.js\";\n\nconst c = c => {\n  let y = class extends c {\n    initialize() {\n      this.exportImageParameters = new i({\n        layer: this.layer\n      });\n    }\n\n    destroy() {\n      this.exportImageParameters.destroy(), this.exportImageParameters = null;\n    }\n\n    get exportImageVersion() {\n      var e;\n      return null == (e = this.exportImageParameters) || e.commitProperty(\"version\"), this.commitProperty(\"timeExtent\"), (this._get(\"exportImageVersion\") || 0) + 1;\n    }\n\n    async fetchPopupFeatures(e, s) {\n      const {\n        layer: a\n      } = this;\n      if (!e) return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\", \"Nothing to fetch without area\", {\n        layer: a\n      }));\n\n      const p = this.get(\"view.scale\"),\n            i = [],\n            l = async e => {\n        const r = 0 === e.minScale || p <= e.minScale,\n              o = 0 === e.maxScale || p >= e.maxScale;\n        if (e.visible && r && o) if (e.sublayers) e.sublayers.forEach(l);else if (e.popupEnabled) {\n          const r = u(e, { ...s,\n            defaultPopupTemplateEnabled: !1\n          });\n          t(r) && i.unshift({\n            sublayer: e,\n            popupTemplate: r\n          });\n        }\n      },\n            c = a.sublayers.toArray().reverse().map(l);\n\n      await Promise.all(c);\n      const y = i.map(async ({\n        sublayer: r,\n        popupTemplate: o\n      }) => {\n        await r.load().catch(() => {});\n        const a = r.createQuery(),\n              p = t(s) ? s.event : null,\n              i = m({\n          renderer: r.renderer,\n          event: p\n        }),\n              l = this.createFetchPopupFeaturesQueryGeometry(e, i);\n        a.geometry = l, a.outFields = await n(r, o);\n        const u = await this._loadArcadeModules(o);\n        u && u.arcadeUtils.hasGeometryOperations(o) || (a.maxAllowableOffset = l.width / i);\n        return (await r.queryFeatures(a)).features;\n      });\n      return (await o(y)).reduce((e, r) => r.value ? [...e, ...r.value] : e, []).filter(e => null != e);\n    }\n\n    canResume() {\n      var e;\n      return !!super.canResume() && (null == (e = this.timeExtent) || !e.isEmpty);\n    }\n\n    _loadArcadeModules(e) {\n      if (e.get(\"expressionInfos.length\")) return l();\n    }\n\n  };\n  return e([s()], y.prototype, \"exportImageParameters\", void 0), e([s({\n    readOnly: !0\n  })], y.prototype, \"exportImageVersion\", null), e([s()], y.prototype, \"layer\", void 0), e([s()], y.prototype, \"suspended\", void 0), e([s(p)], y.prototype, \"timeExtent\", void 0), y = e([a(\"esri.views.layers.MapImageLayerView\")], y), y;\n};\n\nexport default c;\nexport { c as MapImageLayerView };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/layers/MapImageLayerView.js"],"names":["_","e","r","isSome","t","eachAlways","o","property","s","subclass","a","combinedViewLayerTimeExtentProperty","p","ExportImageParameters","i","calculateTolerance","m","loadArcade","l","getRequiredFields","n","getFetchPopupTemplate","u","c","y","initialize","exportImageParameters","layer","destroy","exportImageVersion","commitProperty","_get","fetchPopupFeatures","Promise","reject","get","minScale","maxScale","visible","sublayers","forEach","popupEnabled","defaultPopupTemplateEnabled","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","renderer","createFetchPopupFeaturesQueryGeometry","geometry","outFields","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","canResume","timeExtent","isEmpty","prototype","readOnly","MapImageLayerView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as p}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as i}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as m}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as l}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new i({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const p=this.get(\"view.scale\"),i=[],l=async e=>{const r=0===e.minScale||p<=e.minScale,o=0===e.maxScale||p>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(l);else if(e.popupEnabled){const r=u(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&i.unshift({sublayer:e,popupTemplate:r})}},c=a.sublayers.toArray().reverse().map(l);await Promise.all(c);const y=i.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),p=t(s)?s.event:null,i=m({renderer:r.renderer,event:p}),l=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=l,a.outFields=await n(r,o);const u=await this._loadArcadeModules(o);u&&u.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=l.width/i);return(await r.queryFeatures(a)).features}));return(await o(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return l()}};return e([s()],y.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],y.prototype,\"exportImageVersion\",null),e([s()],y.prototype,\"layer\",void 0),e([s()],y.prototype,\"suspended\",void 0),e([s(p)],y.prototype,\"timeExtent\",void 0),y=e([a(\"esri.views.layers.MapImageLayerView\")],y),y};export default c;export{c as MapImageLayerView};\n"]},"metadata":{},"sourceType":"module"}