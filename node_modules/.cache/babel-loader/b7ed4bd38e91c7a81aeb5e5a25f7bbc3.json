{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { remove as t } from \"../../../../core/arrayUtils.js\";\nimport { isSome as i } from \"../../../../core/maybe.js\";\nimport { getObjectId as e } from \"../../../../layers/graphics/dehydratedFeatures.js\";\n\nclass s {\n  constructor(t) {\n    this.graphicsCore = t, this.idToState = new Map(), this.states = new Set();\n    const i = t.owner.layer && t.owner.layer.objectIdField;\n    i ? (this.getGraphicId = t => e(t, i), this.getGraphics3DGraphicById = t => this.graphicsCore.getGraphics3DGraphicByObjectId(t)) : (this.getGraphicId = t => t.uid, this.getGraphics3DGraphicById = t => this.graphicsCore.getGraphics3DGraphicById(t));\n  }\n\n  destroy() {\n    this.idToState.clear(), this.states.forEach((t, i) => this.remove(i));\n  }\n\n  add(t) {\n    const e = {\n      remove: () => this.remove(t)\n    };\n    if (this.states.has(t)) return e;\n    const s = this.getGraphicId(t.graphic),\n          a = this.getGraphics3DGraphicById(s);\n    this.states.has(t) || this.states.add(t);\n    return this.ensureStateList(s).push(t), t.displaying = !!i(a) && a.isVisible(), t.isDraped = !!i(a) && a.isDraped, t.tracking = !0, i(a) && t.emit(\"changed\", {}), e;\n  }\n\n  remove(i) {\n    if (this.states.has(i)) {\n      if (this.idToState.size) {\n        const e = this.getGraphicId(i.graphic),\n              s = this.idToState.get(e);\n        s && (t(s, i), 0 === s.length && this.idToState.delete(e));\n      }\n\n      this.states.delete(i), i.tracking = !1, i.displaying = !1;\n    }\n  }\n\n  addGraphic(t) {\n    this.forEachState(t, i => {\n      i.displaying = t.isVisible(), i.isDraped = t.isDraped, i.emit(\"changed\", {});\n    });\n  }\n\n  removeGraphic(t) {\n    this.forEachState(t, t => {\n      t.displaying = !1, t.isDraped = !1;\n    });\n  }\n\n  updateGraphicGeometry(t) {\n    this.forEachState(t, t => {\n      t.emit(\"changed\", {});\n    });\n  }\n\n  updateGraphicVisibility(t) {\n    this.forEachState(t, i => {\n      i.displaying = t.isVisible();\n    });\n  }\n\n  allGraphicsDeleted() {\n    this.states.forEach(t => {\n      t.displaying = !1;\n    });\n  }\n\n  ensureStateList(t) {\n    const i = this.idToState.get(t);\n    if (i) return i;\n    const e = new Array();\n    return this.idToState.set(t, e), e;\n  }\n\n  forEachState(t, i) {\n    if (0 === this.states.size || 0 === this.idToState.size) return;\n    const e = this.getGraphicId(t.graphic),\n          s = this.idToState.get(e);\n    null != s && s.forEach(i);\n  }\n\n}\n\nexport { s as GraphicStateTracking };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/GraphicStateTracking.js"],"names":["remove","t","isSome","i","getObjectId","e","s","constructor","graphicsCore","idToState","Map","states","Set","owner","layer","objectIdField","getGraphicId","getGraphics3DGraphicById","getGraphics3DGraphicByObjectId","uid","destroy","clear","forEach","add","has","graphic","a","ensureStateList","push","displaying","isVisible","isDraped","tracking","emit","size","get","length","delete","addGraphic","forEachState","removeGraphic","updateGraphicGeometry","updateGraphicVisibility","allGraphicsDeleted","Array","set","GraphicStateTracking"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{remove as t}from\"../../../../core/arrayUtils.js\";import{isSome as i}from\"../../../../core/maybe.js\";import{getObjectId as e}from\"../../../../layers/graphics/dehydratedFeatures.js\";class s{constructor(t){this.graphicsCore=t,this.idToState=new Map,this.states=new Set;const i=t.owner.layer&&t.owner.layer.objectIdField;i?(this.getGraphicId=t=>e(t,i),this.getGraphics3DGraphicById=t=>this.graphicsCore.getGraphics3DGraphicByObjectId(t)):(this.getGraphicId=t=>t.uid,this.getGraphics3DGraphicById=t=>this.graphicsCore.getGraphics3DGraphicById(t))}destroy(){this.idToState.clear(),this.states.forEach(((t,i)=>this.remove(i)))}add(t){const e={remove:()=>this.remove(t)};if(this.states.has(t))return e;const s=this.getGraphicId(t.graphic),a=this.getGraphics3DGraphicById(s);this.states.has(t)||this.states.add(t);return this.ensureStateList(s).push(t),t.displaying=!!i(a)&&a.isVisible(),t.isDraped=!!i(a)&&a.isDraped,t.tracking=!0,i(a)&&t.emit(\"changed\",{}),e}remove(i){if(this.states.has(i)){if(this.idToState.size){const e=this.getGraphicId(i.graphic),s=this.idToState.get(e);s&&(t(s,i),0===s.length&&this.idToState.delete(e))}this.states.delete(i),i.tracking=!1,i.displaying=!1}}addGraphic(t){this.forEachState(t,(i=>{i.displaying=t.isVisible(),i.isDraped=t.isDraped,i.emit(\"changed\",{})}))}removeGraphic(t){this.forEachState(t,(t=>{t.displaying=!1,t.isDraped=!1}))}updateGraphicGeometry(t){this.forEachState(t,(t=>{t.emit(\"changed\",{})}))}updateGraphicVisibility(t){this.forEachState(t,(i=>{i.displaying=t.isVisible()}))}allGraphicsDeleted(){this.states.forEach((t=>{t.displaying=!1}))}ensureStateList(t){const i=this.idToState.get(t);if(i)return i;const e=new Array;return this.idToState.set(t,e),e}forEachState(t,i){if(0===this.states.size||0===this.idToState.size)return;const e=this.getGraphicId(t.graphic),s=this.idToState.get(e);null!=s&&s.forEach(i)}}export{s as GraphicStateTracking};\n"]},"metadata":{},"sourceType":"module"}