{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { adjustStaticAGOUrl as e } from \"../../../../core/devEnvironmentUtils.js\";\nimport { get as t, isSome as r, isNone as s } from \"../../../../core/maybe.js\";\nimport { a as o } from \"../../../../chunks/mat3.js\";\nimport { c as i } from \"../../../../chunks/mat3f64.js\";\nimport { a } from \"../../../../chunks/mat4.js\";\nimport { c as u } from \"../../../../chunks/mat4f64.js\";\nimport { m as n, f as l, E as c, l as m, n as d, e as f } from \"../../../../chunks/vec3.js\";\nimport { c as p } from \"../../../../chunks/vec3f64.js\";\nimport { empty as x, expandWithVec3 as g } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { BufferViewVec3f as h, BufferViewVec4f as b, BufferViewVec2f as v, BufferViewVec4u8 as R, BufferViewVec4u16 as y, BufferViewVec3u8 as M, BufferViewVec3u16 as B } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { t as w, a as j, s as C } from \"../../../../chunks/vec32.js\";\nimport { t as E, s as T } from \"../../../../chunks/vec42.js\";\nimport { createBuffer as S } from \"../../../../geometry/support/buffer/utils.js\";\nimport { DefaultLoadingContext as A } from \"../../glTF/DefaultLoadingContext.js\";\nimport { load as O } from \"../../glTF/loader.js\";\nimport { triangleFanToTriangles as F, triangleStripToTriangles as I, trianglesToTriangles as k } from \"../../glTF/internal/indexUtils.js\";\nimport { load as L, processLoadResult as N } from \"./wosrLoader.js\";\nimport { Geometry as P } from \"../../webgl-engine/lib/Geometry.js\";\nimport { Texture as D } from \"../../webgl-engine/lib/Texture.js\";\nimport { DefaultMaterial as _ } from \"../../webgl-engine/materials/DefaultMaterial.js\";\nimport { COLOR_GAMMA as z } from \"../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";\nimport { n as V } from \"../../../../chunks/vec22.js\";\nimport { c as W, f as G } from \"../../../../chunks/vec43.js\";\nimport { c as U } from \"../../../../chunks/vec33.js\";\n\nasync function $(s, o) {\n  const i = q(e(s));\n\n  if (\"wosr\" === i.fileType) {\n    const e = await (o.cache ? o.cache.loadWOSR(i.url, o) : L(i.url, o)),\n          t = N(e, o);\n    return {\n      lods: [t],\n      referenceBoundingBox: t.boundingBox,\n      isEsriSymbolResource: !1,\n      isWosr: !0,\n      remove: e.remove\n    };\n  }\n\n  const a = await (o.cache ? o.cache.loadGLTF(i.url, o, o.usePBR) : O(new A(o.streamDataRequester), i.url, o, o.usePBR)),\n        u = t(a.model.meta, \"ESRI_proxyEllipsoid\");\n  a.meta.isEsriSymbolResource && r(u) && -1 !== a.meta.uri.indexOf(\"/RealisticTrees/\") && J(a, u);\n  const n = a.meta.isEsriSymbolResource ? {\n    usePBR: o.usePBR,\n    isSchematic: !1,\n    treeRendering: a.customMeta.esriTreeRendering,\n    mrrFactors: [0, 1, .2]\n  } : {\n    usePBR: o.usePBR,\n    isSchematic: !1,\n    mrrFactors: [0, 1, .5]\n  },\n        l = { ...o.materialParamsMixin,\n    treeRendering: a.customMeta.esriTreeRendering\n  };\n\n  if (null != i.specifiedLodIndex) {\n    const e = K(a, n, l, i.specifiedLodIndex);\n    let t = e[0].boundingBox;\n\n    if (0 !== i.specifiedLodIndex) {\n      t = K(a, n, l, 0)[0].boundingBox;\n    }\n\n    return {\n      lods: e,\n      referenceBoundingBox: t,\n      isEsriSymbolResource: a.meta.isEsriSymbolResource,\n      isWosr: !1,\n      remove: a.remove\n    };\n  }\n\n  const c = K(a, n, l);\n  return {\n    lods: c,\n    referenceBoundingBox: c[0].boundingBox,\n    isEsriSymbolResource: a.meta.isEsriSymbolResource,\n    isWosr: !1,\n    remove: a.remove\n  };\n}\n\nfunction q(e) {\n  const t = e.match(/(.*\\.(gltf|glb))(\\?lod=([0-9]+))?$/);\n  if (t) return {\n    fileType: \"gltf\",\n    url: t[1],\n    specifiedLodIndex: null != t[4] ? Number(t[4]) : null\n  };\n  return e.match(/(.*\\.(json|json\\.gz))$/) ? {\n    fileType: \"wosr\",\n    url: e,\n    specifiedLodIndex: null\n  } : {\n    fileType: \"unknown\",\n    url: e,\n    specifiedLodIndex: null\n  };\n}\n\nfunction K(e, t, s, a) {\n  const u = e.model,\n        n = i(),\n        l = new Array(),\n        c = new Map(),\n        m = new Map();\n  return u.lods.forEach((e, i) => {\n    if (void 0 !== a && i !== a) return;\n    const d = {\n      name: e.name,\n      stageResources: {\n        textures: new Array(),\n        materials: new Array(),\n        geometries: new Array()\n      },\n      lodThreshold: r(e.lodThreshold) ? e.lodThreshold : null,\n      pivotOffset: [0, 0, 0],\n      numberOfVertices: 0,\n      boundingBox: x()\n    };\n    l.push(d), e.parts.forEach(e => {\n      const i = e.material + (e.attributes.normal ? \"_normal\" : \"\") + (e.attributes.color ? \"_color\" : \"\") + (e.attributes.texCoord0 ? \"_texCoord0\" : \"\") + (e.attributes.tangent ? \"_tangent\" : \"\"),\n            a = u.materials.get(e.material),\n            l = r(e.attributes.texCoord0),\n            f = r(e.attributes.normal);\n\n      if (!c.has(i)) {\n        if (l) {\n          if (r(a.textureColor) && !m.has(a.textureColor)) {\n            const e = u.textures.get(a.textureColor),\n                  t = { ...e.parameters,\n              preMultiplyAlpha: !0\n            };\n            m.set(a.textureColor, new D(e.data, t));\n          }\n\n          if (r(a.textureNormal) && !m.has(a.textureNormal)) {\n            const e = u.textures.get(a.textureNormal),\n                  t = { ...e.parameters,\n              preMultiplyAlpha: !0\n            };\n            m.set(a.textureNormal, new D(e.data, t));\n          }\n\n          if (r(a.textureOcclusion) && !m.has(a.textureOcclusion)) {\n            const e = u.textures.get(a.textureOcclusion),\n                  t = { ...e.parameters,\n              preMultiplyAlpha: !0\n            };\n            m.set(a.textureOcclusion, new D(e.data, t));\n          }\n\n          if (r(a.textureEmissive) && !m.has(a.textureEmissive)) {\n            const e = u.textures.get(a.textureEmissive),\n                  t = { ...e.parameters,\n              preMultiplyAlpha: !0\n            };\n            m.set(a.textureEmissive, new D(e.data, t));\n          }\n\n          if (r(a.textureMetallicRoughness) && !m.has(a.textureMetallicRoughness)) {\n            const e = u.textures.get(a.textureMetallicRoughness),\n                  t = { ...e.parameters,\n              preMultiplyAlpha: !0\n            };\n            m.set(a.textureMetallicRoughness, new D(e.data, t));\n          }\n        }\n\n        const o = a.color[0] ** (1 / z),\n              n = a.color[1] ** (1 / z),\n              d = a.color[2] ** (1 / z),\n              p = a.emissiveFactor[0] ** (1 / z),\n              x = a.emissiveFactor[1] ** (1 / z),\n              g = a.emissiveFactor[2] ** (1 / z);\n        c.set(i, new _({ ...t,\n          transparent: \"BLEND\" === a.alphaMode,\n          textureAlphaMode: Q(a.alphaMode),\n          textureAlphaCutoff: a.alphaCutoff,\n          diffuse: [o, n, d],\n          ambient: [o, n, d],\n          opacity: a.opacity,\n          doubleSided: a.doubleSided,\n          doubleSidedType: \"winding-order\",\n          cullFace: a.doubleSided ? 0 : 2,\n          vertexColors: !!e.attributes.color,\n          vertexTangents: !!e.attributes.tangent,\n          normals: f ? \"default\" : \"screenDerivative\",\n          castShadows: !0,\n          receiveSSAO: !0,\n          textureId: r(a.textureColor) && l ? m.get(a.textureColor).id : void 0,\n          colorMixMode: a.colorMixMode,\n          normalTextureId: r(a.textureNormal) && l ? m.get(a.textureNormal).id : void 0,\n          textureAlphaPremultiplied: !0,\n          occlusionTextureId: r(a.textureOcclusion) && l ? m.get(a.textureOcclusion).id : void 0,\n          emissiveTextureId: r(a.textureEmissive) && l ? m.get(a.textureEmissive).id : void 0,\n          metallicRoughnessTextureId: r(a.textureMetallicRoughness) && l ? m.get(a.textureMetallicRoughness).id : void 0,\n          emissiveFactor: [p, x, g],\n          mrrFactors: [a.metallicFactor, a.roughnessFactor, t.mrrFactors[2]],\n          isSchematic: !1,\n          ...s\n        }));\n      }\n\n      const p = H(e.indices || e.attributes.position.count, e.primitiveType),\n            x = e.attributes.position.count,\n            A = S(h, x);\n      w(A, e.attributes.position, e.transform);\n      const O = [[\"position\", {\n        data: A.typedBuffer,\n        size: A.elementCount,\n        exclusive: !0\n      }]],\n            F = [[\"position\", p]];\n\n      if (r(e.attributes.normal)) {\n        const t = S(h, x);\n        o(n, e.transform), j(t, e.attributes.normal, n), O.push([\"normal\", {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), F.push([\"normal\", p]);\n      }\n\n      if (r(e.attributes.tangent)) {\n        const t = S(b, x);\n        o(n, e.transform), E(t, e.attributes.tangent, n), O.push([\"tangent\", {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), F.push([\"tangent\", p]);\n      }\n\n      if (r(e.attributes.texCoord0)) {\n        const t = S(v, x);\n        V(t, e.attributes.texCoord0), O.push([\"uv0\", {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), F.push([\"uv0\", p]);\n      }\n\n      if (r(e.attributes.color)) {\n        const t = S(R, x);\n        if (4 === e.attributes.color.elementCount) e.attributes.color instanceof b ? T(t, e.attributes.color, 255) : e.attributes.color instanceof R ? W(t, e.attributes.color) : e.attributes.color instanceof y && T(t, e.attributes.color, 1 / 256);else {\n          G(t, 255, 255, 255, 255);\n          const r = new M(t.buffer, 0, 4);\n          e.attributes.color instanceof h ? C(r, e.attributes.color, 255) : e.attributes.color instanceof M ? U(r, e.attributes.color) : e.attributes.color instanceof B && C(r, e.attributes.color, 1 / 256);\n        }\n        O.push([\"color\", {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), F.push([\"color\", p]);\n      }\n\n      const I = new P(O, F);\n      d.stageResources.geometries.push(I), d.stageResources.materials.push(c.get(i)), l && (r(a.textureColor) && d.stageResources.textures.push(m.get(a.textureColor)), r(a.textureNormal) && d.stageResources.textures.push(m.get(a.textureNormal)), r(a.textureOcclusion) && d.stageResources.textures.push(m.get(a.textureOcclusion)), r(a.textureEmissive) && d.stageResources.textures.push(m.get(a.textureEmissive)), r(a.textureMetallicRoughness) && d.stageResources.textures.push(m.get(a.textureMetallicRoughness))), d.numberOfVertices += x;\n      const k = I.boundingInfo;\n      r(k) && (g(d.boundingBox, k.getBBMin()), g(d.boundingBox, k.getBBMax()));\n    });\n  }), l;\n}\n\nfunction Q(e) {\n  switch (e) {\n    case \"BLEND\":\n      return 0;\n\n    case \"MASK\":\n      return 2;\n\n    case \"OPAQUE\":\n      return 1;\n\n    default:\n      return 0;\n  }\n}\n\nfunction H(e, t) {\n  switch (t) {\n    case 4:\n      return k(e);\n\n    case 5:\n      return I(e);\n\n    case 6:\n      return F(e);\n  }\n}\n\nfunction J(e, t) {\n  for (let r = 0; r < e.model.lods.length; ++r) {\n    const o = e.model.lods[r];\n    e.customMeta.esriTreeRendering = !0;\n\n    for (const i of o.parts) {\n      const o = i.attributes.normal;\n      if (s(o)) return;\n      const x = i.attributes.position,\n            g = x.count,\n            b = p(),\n            v = p(),\n            y = p(),\n            M = S(R, g),\n            B = S(h, g),\n            w = a(u(), i.transform);\n\n      for (let s = 0; s < g; s++) {\n        x.getVec(s, v), o.getVec(s, b), n(v, v, i.transform), l(y, v, t.center), c(y, y, t.radius);\n        const a = y[2],\n              u = m(y),\n              p = Math.min(.45 + .55 * u * u, 1);\n        c(y, y, t.radius), n(y, y, w), d(y, y), r + 1 !== e.model.lods.length && e.model.lods.length > 1 && f(y, y, b, a > -1 ? .2 : Math.min(-4 * a - 3.8, 1)), B.setVec(s, y), M.set(s, 0, 255 * p), M.set(s, 1, 255 * p), M.set(s, 2, 255 * p), M.set(s, 3, 255);\n      }\n\n      i.attributes.normal = B, i.attributes.color = M;\n    }\n  }\n}\n\nexport { $ as fetch, K as gltfToEngineResources, q as parseUrl };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/objectResourceUtils.js"],"names":["adjustStaticAGOUrl","e","get","t","isSome","r","isNone","s","a","o","c","i","u","m","n","f","l","E","d","p","empty","x","expandWithVec3","g","BufferViewVec3f","h","BufferViewVec4f","b","BufferViewVec2f","v","BufferViewVec4u8","R","BufferViewVec4u16","y","BufferViewVec3u8","M","BufferViewVec3u16","B","w","j","C","T","createBuffer","S","DefaultLoadingContext","A","load","O","triangleFanToTriangles","F","triangleStripToTriangles","I","trianglesToTriangles","k","L","processLoadResult","N","Geometry","P","Texture","D","DefaultMaterial","_","COLOR_GAMMA","z","V","W","G","U","$","q","fileType","cache","loadWOSR","url","lods","referenceBoundingBox","boundingBox","isEsriSymbolResource","isWosr","remove","loadGLTF","usePBR","streamDataRequester","model","meta","uri","indexOf","J","isSchematic","treeRendering","customMeta","esriTreeRendering","mrrFactors","materialParamsMixin","specifiedLodIndex","K","match","Number","Array","Map","forEach","name","stageResources","textures","materials","geometries","lodThreshold","pivotOffset","numberOfVertices","push","parts","material","attributes","normal","color","texCoord0","tangent","has","textureColor","parameters","preMultiplyAlpha","set","data","textureNormal","textureOcclusion","textureEmissive","textureMetallicRoughness","emissiveFactor","transparent","alphaMode","textureAlphaMode","Q","textureAlphaCutoff","alphaCutoff","diffuse","ambient","opacity","doubleSided","doubleSidedType","cullFace","vertexColors","vertexTangents","normals","castShadows","receiveSSAO","textureId","id","colorMixMode","normalTextureId","textureAlphaPremultiplied","occlusionTextureId","emissiveTextureId","metallicRoughnessTextureId","metallicFactor","roughnessFactor","H","indices","position","count","primitiveType","transform","typedBuffer","size","elementCount","exclusive","buffer","boundingInfo","getBBMin","getBBMax","length","getVec","center","radius","Math","min","setVec","fetch","gltfToEngineResources","parseUrl"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{adjustStaticAGOUrl as e}from\"../../../../core/devEnvironmentUtils.js\";import{get as t,isSome as r,isNone as s}from\"../../../../core/maybe.js\";import{a as o}from\"../../../../chunks/mat3.js\";import{c as i}from\"../../../../chunks/mat3f64.js\";import{a}from\"../../../../chunks/mat4.js\";import{c as u}from\"../../../../chunks/mat4f64.js\";import{m as n,f as l,E as c,l as m,n as d,e as f}from\"../../../../chunks/vec3.js\";import{c as p}from\"../../../../chunks/vec3f64.js\";import{empty as x,expandWithVec3 as g}from\"../../../../geometry/support/aaBoundingBox.js\";import{BufferViewVec3f as h,BufferViewVec4f as b,BufferViewVec2f as v,BufferViewVec4u8 as R,BufferViewVec4u16 as y,BufferViewVec3u8 as M,BufferViewVec3u16 as B}from\"../../../../geometry/support/buffer/BufferView.js\";import{t as w,a as j,s as C}from\"../../../../chunks/vec32.js\";import{t as E,s as T}from\"../../../../chunks/vec42.js\";import{createBuffer as S}from\"../../../../geometry/support/buffer/utils.js\";import{DefaultLoadingContext as A}from\"../../glTF/DefaultLoadingContext.js\";import{load as O}from\"../../glTF/loader.js\";import{triangleFanToTriangles as F,triangleStripToTriangles as I,trianglesToTriangles as k}from\"../../glTF/internal/indexUtils.js\";import{load as L,processLoadResult as N}from\"./wosrLoader.js\";import{Geometry as P}from\"../../webgl-engine/lib/Geometry.js\";import{Texture as D}from\"../../webgl-engine/lib/Texture.js\";import{DefaultMaterial as _}from\"../../webgl-engine/materials/DefaultMaterial.js\";import{COLOR_GAMMA as z}from\"../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";import{n as V}from\"../../../../chunks/vec22.js\";import{c as W,f as G}from\"../../../../chunks/vec43.js\";import{c as U}from\"../../../../chunks/vec33.js\";async function $(s,o){const i=q(e(s));if(\"wosr\"===i.fileType){const e=await(o.cache?o.cache.loadWOSR(i.url,o):L(i.url,o)),t=N(e,o);return{lods:[t],referenceBoundingBox:t.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const a=await(o.cache?o.cache.loadGLTF(i.url,o,o.usePBR):O(new A(o.streamDataRequester),i.url,o,o.usePBR)),u=t(a.model.meta,\"ESRI_proxyEllipsoid\");a.meta.isEsriSymbolResource&&r(u)&&-1!==a.meta.uri.indexOf(\"/RealisticTrees/\")&&J(a,u);const n=a.meta.isEsriSymbolResource?{usePBR:o.usePBR,isSchematic:!1,treeRendering:a.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:o.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},l={...o.materialParamsMixin,treeRendering:a.customMeta.esriTreeRendering};if(null!=i.specifiedLodIndex){const e=K(a,n,l,i.specifiedLodIndex);let t=e[0].boundingBox;if(0!==i.specifiedLodIndex){t=K(a,n,l,0)[0].boundingBox}return{lods:e,referenceBoundingBox:t,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}const c=K(a,n,l);return{lods:c,referenceBoundingBox:c[0].boundingBox,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}function q(e){const t=e.match(/(.*\\.(gltf|glb))(\\?lod=([0-9]+))?$/);if(t)return{fileType:\"gltf\",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null};return e.match(/(.*\\.(json|json\\.gz))$/)?{fileType:\"wosr\",url:e,specifiedLodIndex:null}:{fileType:\"unknown\",url:e,specifiedLodIndex:null}}function K(e,t,s,a){const u=e.model,n=i(),l=new Array,c=new Map,m=new Map;return u.lods.forEach(((e,i)=>{if(void 0!==a&&i!==a)return;const d={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:r(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:x()};l.push(d),e.parts.forEach((e=>{const i=e.material+(e.attributes.normal?\"_normal\":\"\")+(e.attributes.color?\"_color\":\"\")+(e.attributes.texCoord0?\"_texCoord0\":\"\")+(e.attributes.tangent?\"_tangent\":\"\"),a=u.materials.get(e.material),l=r(e.attributes.texCoord0),f=r(e.attributes.normal);if(!c.has(i)){if(l){if(r(a.textureColor)&&!m.has(a.textureColor)){const e=u.textures.get(a.textureColor),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureColor,new D(e.data,t))}if(r(a.textureNormal)&&!m.has(a.textureNormal)){const e=u.textures.get(a.textureNormal),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureNormal,new D(e.data,t))}if(r(a.textureOcclusion)&&!m.has(a.textureOcclusion)){const e=u.textures.get(a.textureOcclusion),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureOcclusion,new D(e.data,t))}if(r(a.textureEmissive)&&!m.has(a.textureEmissive)){const e=u.textures.get(a.textureEmissive),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureEmissive,new D(e.data,t))}if(r(a.textureMetallicRoughness)&&!m.has(a.textureMetallicRoughness)){const e=u.textures.get(a.textureMetallicRoughness),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureMetallicRoughness,new D(e.data,t))}}const o=a.color[0]**(1/z),n=a.color[1]**(1/z),d=a.color[2]**(1/z),p=a.emissiveFactor[0]**(1/z),x=a.emissiveFactor[1]**(1/z),g=a.emissiveFactor[2]**(1/z);c.set(i,new _({...t,transparent:\"BLEND\"===a.alphaMode,textureAlphaMode:Q(a.alphaMode),textureAlphaCutoff:a.alphaCutoff,diffuse:[o,n,d],ambient:[o,n,d],opacity:a.opacity,doubleSided:a.doubleSided,doubleSidedType:\"winding-order\",cullFace:a.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:f?\"default\":\"screenDerivative\",castShadows:!0,receiveSSAO:!0,textureId:r(a.textureColor)&&l?m.get(a.textureColor).id:void 0,colorMixMode:a.colorMixMode,normalTextureId:r(a.textureNormal)&&l?m.get(a.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:r(a.textureOcclusion)&&l?m.get(a.textureOcclusion).id:void 0,emissiveTextureId:r(a.textureEmissive)&&l?m.get(a.textureEmissive).id:void 0,metallicRoughnessTextureId:r(a.textureMetallicRoughness)&&l?m.get(a.textureMetallicRoughness).id:void 0,emissiveFactor:[p,x,g],mrrFactors:[a.metallicFactor,a.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...s}))}const p=H(e.indices||e.attributes.position.count,e.primitiveType),x=e.attributes.position.count,A=S(h,x);w(A,e.attributes.position,e.transform);const O=[[\"position\",{data:A.typedBuffer,size:A.elementCount,exclusive:!0}]],F=[[\"position\",p]];if(r(e.attributes.normal)){const t=S(h,x);o(n,e.transform),j(t,e.attributes.normal,n),O.push([\"normal\",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),F.push([\"normal\",p])}if(r(e.attributes.tangent)){const t=S(b,x);o(n,e.transform),E(t,e.attributes.tangent,n),O.push([\"tangent\",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),F.push([\"tangent\",p])}if(r(e.attributes.texCoord0)){const t=S(v,x);V(t,e.attributes.texCoord0),O.push([\"uv0\",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),F.push([\"uv0\",p])}if(r(e.attributes.color)){const t=S(R,x);if(4===e.attributes.color.elementCount)e.attributes.color instanceof b?T(t,e.attributes.color,255):e.attributes.color instanceof R?W(t,e.attributes.color):e.attributes.color instanceof y&&T(t,e.attributes.color,1/256);else{G(t,255,255,255,255);const r=new M(t.buffer,0,4);e.attributes.color instanceof h?C(r,e.attributes.color,255):e.attributes.color instanceof M?U(r,e.attributes.color):e.attributes.color instanceof B&&C(r,e.attributes.color,1/256)}O.push([\"color\",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),F.push([\"color\",p])}const I=new P(O,F);d.stageResources.geometries.push(I),d.stageResources.materials.push(c.get(i)),l&&(r(a.textureColor)&&d.stageResources.textures.push(m.get(a.textureColor)),r(a.textureNormal)&&d.stageResources.textures.push(m.get(a.textureNormal)),r(a.textureOcclusion)&&d.stageResources.textures.push(m.get(a.textureOcclusion)),r(a.textureEmissive)&&d.stageResources.textures.push(m.get(a.textureEmissive)),r(a.textureMetallicRoughness)&&d.stageResources.textures.push(m.get(a.textureMetallicRoughness))),d.numberOfVertices+=x;const k=I.boundingInfo;r(k)&&(g(d.boundingBox,k.getBBMin()),g(d.boundingBox,k.getBBMax()))}))})),l}function Q(e){switch(e){case\"BLEND\":return 0;case\"MASK\":return 2;case\"OPAQUE\":return 1;default:return 0}}function H(e,t){switch(t){case 4:return k(e);case 5:return I(e);case 6:return F(e)}}function J(e,t){for(let r=0;r<e.model.lods.length;++r){const o=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(const i of o.parts){const o=i.attributes.normal;if(s(o))return;const x=i.attributes.position,g=x.count,b=p(),v=p(),y=p(),M=S(R,g),B=S(h,g),w=a(u(),i.transform);for(let s=0;s<g;s++){x.getVec(s,v),o.getVec(s,b),n(v,v,i.transform),l(y,v,t.center),c(y,y,t.radius);const a=y[2],u=m(y),p=Math.min(.45+.55*u*u,1);c(y,y,t.radius),n(y,y,w),d(y,y),r+1!==e.model.lods.length&&e.model.lods.length>1&&f(y,y,b,a>-1?.2:Math.min(-4*a-3.8,1)),B.setVec(s,y),M.set(s,0,255*p),M.set(s,1,255*p),M.set(s,2,255*p),M.set(s,3,255)}i.attributes.normal=B,i.attributes.color=M}}}export{$ as fetch,K as gltfToEngineResources,q as parseUrl};\n"]},"metadata":{},"sourceType":"module"}