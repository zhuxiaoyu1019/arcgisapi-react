{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Evented.js\";\nimport t from \"../../../../../core/has.js\";\nimport { r as s } from \"../../../../../chunks/rbush.js\";\nimport { Tile as i } from \"./Tile.js\";\nimport o from \"../../../tiling/TileCoverage.js\";\nimport h from \"../../../tiling/TileKey.js\";\nconst n = {\n  added: [],\n  removed: []\n},\n      d = new Set(),\n      r = new h(0, 0, 0, 0);\n\nclass l extends e {\n  constructor(e) {\n    super(), this._tiles = new Map(), this._index = s(9, t(\"csp-restrictions\") ? e => ({\n      minX: e.bounds[0],\n      minY: e.bounds[1],\n      maxX: e.bounds[2],\n      maxY: e.bounds[3]\n    }) : [\".bounds[0]\", \".bounds[1]\", \".bounds[2]\", \".bounds[3]\"]), this.tiles = [], this.tileScheme = e;\n  }\n\n  destroy() {\n    this.clear();\n  }\n\n  clear() {\n    this.tiles.length = 0, this._tiles.clear(), this._index.clear();\n  }\n\n  has(e) {\n    return this._tiles.has(e);\n  }\n\n  get(e) {\n    return this._tiles.get(e);\n  }\n\n  boundsIntersections(e) {\n    return this._index.search({\n      minX: e[0],\n      minY: e[1],\n      maxX: e[2],\n      maxY: e[3]\n    });\n  }\n\n  updateTiles(e) {\n    const t = {\n      added: [],\n      removed: []\n    };\n\n    for (const s of e.added) if (!this.has(s)) {\n      const e = new i(this.tileScheme, s);\n      this._tiles.set(s, e), this._index.insert(e), t.added.push(e);\n    }\n\n    for (const s of e.removed) if (this.has(s)) {\n      const e = this.get(s);\n      this._tiles.delete(s), this._index.remove(e), t.removed.push(e);\n    }\n\n    this.tiles.length = 0, this._tiles.forEach(e => this.tiles.push(e)), (t.added.length || t.removed.length) && this.emit(\"update\", t);\n  }\n\n  setViewState(e) {\n    const t = this.tileScheme.getTileCoverage(e, 0);\n    if (!t) return;\n    const {\n      spans: s,\n      lodInfo: h\n    } = t,\n          {\n      level: l\n    } = h;\n    if (s.length > 0) for (const {\n      row: o,\n      colFrom: a,\n      colTo: m\n    } of s) for (let e = a; e <= m; e++) {\n      const t = r.set(l, o, h.normalizeCol(e), h.getWorldForColumn(e)).id;\n\n      if (d.add(t), !this.has(t)) {\n        const e = new i(this.tileScheme, t);\n        this._tiles.set(t, e), this._index.insert(e), this.tiles.push(e), n.added.push(e);\n      }\n    }\n\n    for (let i = this.tiles.length - 1; i >= 0; i--) {\n      const e = this.tiles[i];\n      d.has(e.id) || (this._tiles.delete(e.id), this.tiles.splice(i, 1), this._index.remove(e), n.removed.push(e));\n    }\n\n    (n.added.length || n.removed.length) && this.emit(\"update\", n), o.pool.release(t), d.clear(), n.added.length = 0, n.removed.length = 0;\n  }\n\n}\n\nexport default l;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/layers/features/support/TileStore.js"],"names":["e","t","r","s","Tile","i","o","h","n","added","removed","d","Set","l","constructor","_tiles","Map","_index","minX","bounds","minY","maxX","maxY","tiles","tileScheme","destroy","clear","length","has","get","boundsIntersections","search","updateTiles","set","insert","push","delete","remove","forEach","emit","setViewState","getTileCoverage","spans","lodInfo","level","row","colFrom","a","colTo","m","normalizeCol","getWorldForColumn","id","add","splice","pool","release"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Evented.js\";import t from\"../../../../../core/has.js\";import{r as s}from\"../../../../../chunks/rbush.js\";import{Tile as i}from\"./Tile.js\";import o from\"../../../tiling/TileCoverage.js\";import h from\"../../../tiling/TileKey.js\";const n={added:[],removed:[]},d=new Set,r=new h(0,0,0,0);class l extends e{constructor(e){super(),this._tiles=new Map,this._index=s(9,t(\"csp-restrictions\")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[\".bounds[0]\",\".bounds[1]\",\".bounds[2]\",\".bounds[3]\"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const s of e.added)if(!this.has(s)){const e=new i(this.tileScheme,s);this._tiles.set(s,e),this._index.insert(e),t.added.push(e)}for(const s of e.removed)if(this.has(s)){const e=this.get(s);this._tiles.delete(s),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit(\"update\",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:s,lodInfo:h}=t,{level:l}=h;if(s.length>0)for(const{row:o,colFrom:a,colTo:m}of s)for(let e=a;e<=m;e++){const t=r.set(l,o,h.normalizeCol(e),h.getWorldForColumn(e)).id;if(d.add(t),!this.has(t)){const e=new i(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),n.added.push(e)}}for(let i=this.tiles.length-1;i>=0;i--){const e=this.tiles[i];d.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(i,1),this._index.remove(e),n.removed.push(e))}(n.added.length||n.removed.length)&&this.emit(\"update\",n),o.pool.release(t),d.clear(),n.added.length=0,n.removed.length=0}}export default l;\n"]},"metadata":{},"sourceType":"module"}