{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { BufferViewMat3f as e, BufferViewVec4f as t, BufferViewVec4u8 as i, BufferViewVec3f as s } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { newLayout as r } from \"../../support/buffer/InterleavedLayout.js\";\nimport a from \"../lib/GLMaterial.js\";\nimport { Material as n, materialParametersDefaults as o } from \"../lib/Material.js\";\nimport { OITPolygonOffsetLimit as u } from \"../lib/OrderIndependentTransparency.js\";\nimport { assert as c } from \"../lib/Util.js\";\nimport { writeBufferVec4 as h, writeColor as p, writePosition as l } from \"./internal/bufferWriterUtils.js\";\nimport { DefaultBufferWriter as f } from \"./internal/DefaultBufferWriter.js\";\nimport { intersectTriangleGeometry as d } from \"./internal/MaterialUtil.js\";\nimport { patternVertexAttributeLocations as m, PatternTechniqueConfiguration as g, PatternTechnique as q } from \"../shaders/PatternTechnique.js\";\n\nclass b extends n {\n  constructor(e) {\n    super(e, P), this.supportsEdges = !0, this._vertexAttributeLocations = m, this.techniqueConfig = new g();\n  }\n\n  getTechniqueConfig(e, t) {\n    return this.techniqueConfig.output = e, this.techniqueConfig.cullFace = this.params.cullFace, this.techniqueConfig.vertexColors = this.params.vertexColors, this.techniqueConfig.slicePlaneEnabled = this.params.slicePlaneEnabled, this.techniqueConfig.polygonOffset = this.params.polygonOffset, this.techniqueConfig.writeDepth = this.params.writeDepth, this.techniqueConfig.style = this.params.style, this.techniqueConfig.patternSpacing = this.params.patternSpacing, this.techniqueConfig.lineWidth = this.params.lineWidth, this.techniqueConfig.draped = this.params.draped, this.techniqueConfig.transparencyPassType = t ? t.transparencyPassType : 3, this.techniqueConfig.enableOffset = !t || t.camera.relativeElevation < u, this.techniqueConfig.multipassTerrainEnabled = !!t && t.multipassTerrainEnabled, this.techniqueConfig.cullAboveGround = !!t && t.cullAboveGround, this.techniqueConfig;\n  }\n\n  getPassParameters() {\n    return this.params;\n  }\n\n  intersect(e, t, i, s, r, a, n) {\n    d(e, t, s, r, a, void 0, n);\n  }\n\n  getGLMaterial(e) {\n    return 0 === e.output || 7 === e.output || 4 === e.output || 1 === e.output && this.params.writeLinearDepth ? new C(e) : void 0;\n  }\n\n  createBufferWriter() {\n    const e = r().vec3f(\"position\").vec4u8(\"color\").vec4f(\"uvMapSpace\");\n    return this.params.draped || e.mat3f(\"boundingRect\"), new v(e);\n  }\n\n}\n\nclass C extends a {\n  constructor(e) {\n    super(e), this.updateParameters();\n  }\n\n  updateParameters(e) {\n    this._technique = this._techniqueRep.releaseAndAcquire(q, this._material.getTechniqueConfig(this._output, e), this._technique);\n  }\n\n  beginSlot(e) {\n    if (4 === this._output) return 3 === e;\n    return e === (this._technique.configuration.transparent ? this._technique.configuration.writeDepth ? 5 : 8 : 3);\n  }\n\n  _updateOccludeeState(e) {\n    e.hasOccludees !== this._material.params.sceneHasOcludees && this._material.setParameterValues({\n      sceneHasOcludees: e.hasOccludees\n    });\n  }\n\n  ensureParameters(e) {\n    0 !== this._output && 7 !== this._output || this._updateOccludeeState(e), this.updateParameters(e);\n  }\n\n  bind(e) {\n    this._technique.bindPass(this._material.getPassParameters(), e);\n  }\n\n  getPipelineState(e, t) {\n    return this._technique.getPipelineState(t);\n  }\n\n}\n\nclass v extends f {\n  write(r, a, n, o) {\n    for (const u of this.vertexBufferLayout.fieldNames) {\n      const f = a.vertexAttributes.get(u),\n            d = a.indices.get(u);\n      if (f && d) switch (u) {\n        case \"position\":\n          {\n            c(3 === f.size);\n            const e = n.getField(u, s);\n            e && l(d, f.data, r.transformation, e, o);\n            break;\n          }\n\n        case \"color\":\n          {\n            c(3 === f.size || 4 === f.size);\n            const e = n.getField(u, i);\n            e && p(d, f.data, f.size, e, o);\n            break;\n          }\n\n        case \"uvMapSpace\":\n          {\n            c(4 === f.size);\n            const e = n.getField(u, t);\n            e && h(d, f.data, e, o);\n            break;\n          }\n\n        case \"boundingRect\":\n          {\n            c(9 === f.size);\n            const t = n.getField(u, e);\n            t && this.writeBoundingRect(d, f.data, r.transformation, t, o);\n            break;\n          }\n      }\n    }\n  }\n\n  writeBoundingRect(e, t, i, s, r) {\n    const a = i,\n          n = s.typedBuffer,\n          o = s.typedBufferStride,\n          u = e.length;\n    r *= o;\n\n    for (let c = 0; c < u; ++c) {\n      const i = 9 * e[c],\n            s = t[i],\n            u = t[i + 1],\n            h = t[i + 2];\n      n[r] = a[0] * s + a[4] * u + a[8] * h + a[12], n[r + 1] = a[1] * s + a[5] * u + a[9] * h + a[13], n[r + 2] = a[2] * s + a[6] * u + a[10] * h + a[14];\n\n      for (let e = 3; e < 9; ++e) n[r + e] = t[i + e];\n\n      r += o;\n    }\n  }\n\n}\n\nconst P = {\n  color: [1, 1, 1, 1],\n  writeDepth: !0,\n  writeLinearDepth: !1,\n  vertexColors: !1,\n  polygonOffset: !1,\n  slicePlaneEnabled: !1,\n  cullFace: 0,\n  sceneHasOcludees: !1,\n  style: 2,\n  patternSpacing: 10,\n  lineWidth: 1,\n  draped: !0,\n  ...o\n};\nexport { b as PatternMaterial };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/materials/PatternMaterial.js"],"names":["BufferViewMat3f","e","BufferViewVec4f","t","BufferViewVec4u8","i","BufferViewVec3f","s","newLayout","r","a","Material","n","materialParametersDefaults","o","OITPolygonOffsetLimit","u","assert","c","writeBufferVec4","h","writeColor","p","writePosition","l","DefaultBufferWriter","f","intersectTriangleGeometry","d","patternVertexAttributeLocations","m","PatternTechniqueConfiguration","g","PatternTechnique","q","b","constructor","P","supportsEdges","_vertexAttributeLocations","techniqueConfig","getTechniqueConfig","output","cullFace","params","vertexColors","slicePlaneEnabled","polygonOffset","writeDepth","style","patternSpacing","lineWidth","draped","transparencyPassType","enableOffset","camera","relativeElevation","multipassTerrainEnabled","cullAboveGround","getPassParameters","intersect","getGLMaterial","writeLinearDepth","C","createBufferWriter","vec3f","vec4u8","vec4f","mat3f","v","updateParameters","_technique","_techniqueRep","releaseAndAcquire","_material","_output","beginSlot","configuration","transparent","_updateOccludeeState","hasOccludees","sceneHasOcludees","setParameterValues","ensureParameters","bind","bindPass","getPipelineState","write","vertexBufferLayout","fieldNames","vertexAttributes","get","indices","size","getField","data","transformation","writeBoundingRect","typedBuffer","typedBufferStride","length","color","PatternMaterial"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{BufferViewMat3f as e,BufferViewVec4f as t,BufferViewVec4u8 as i,BufferViewVec3f as s}from\"../../../../geometry/support/buffer/BufferView.js\";import{newLayout as r}from\"../../support/buffer/InterleavedLayout.js\";import a from\"../lib/GLMaterial.js\";import{Material as n,materialParametersDefaults as o}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as u}from\"../lib/OrderIndependentTransparency.js\";import{assert as c}from\"../lib/Util.js\";import{writeBufferVec4 as h,writeColor as p,writePosition as l}from\"./internal/bufferWriterUtils.js\";import{DefaultBufferWriter as f}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as d}from\"./internal/MaterialUtil.js\";import{patternVertexAttributeLocations as m,PatternTechniqueConfiguration as g,PatternTechnique as q}from\"../shaders/PatternTechnique.js\";class b extends n{constructor(e){super(e,P),this.supportsEdges=!0,this._vertexAttributeLocations=m,this.techniqueConfig=new g}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.style=this.params.style,this.techniqueConfig.patternSpacing=this.params.patternSpacing,this.techniqueConfig.lineWidth=this.params.lineWidth,this.techniqueConfig.draped=this.params.draped,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<u,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,s,r,a,n){d(e,t,s,r,a,void 0,n)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new C(e):void 0}createBufferWriter(){const e=r().vec3f(\"position\").vec4u8(\"color\").vec4f(\"uvMapSpace\");return this.params.draped||e.mat3f(\"boundingRect\"),new v(e)}}class C extends a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(q,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(4===this._output)return 3===e;return e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}class v extends f{write(r,a,n,o){for(const u of this.vertexBufferLayout.fieldNames){const f=a.vertexAttributes.get(u),d=a.indices.get(u);if(f&&d)switch(u){case\"position\":{c(3===f.size);const e=n.getField(u,s);e&&l(d,f.data,r.transformation,e,o);break}case\"color\":{c(3===f.size||4===f.size);const e=n.getField(u,i);e&&p(d,f.data,f.size,e,o);break}case\"uvMapSpace\":{c(4===f.size);const e=n.getField(u,t);e&&h(d,f.data,e,o);break}case\"boundingRect\":{c(9===f.size);const t=n.getField(u,e);t&&this.writeBoundingRect(d,f.data,r.transformation,t,o);break}}}}writeBoundingRect(e,t,i,s,r){const a=i,n=s.typedBuffer,o=s.typedBufferStride,u=e.length;r*=o;for(let c=0;c<u;++c){const i=9*e[c],s=t[i],u=t[i+1],h=t[i+2];n[r]=a[0]*s+a[4]*u+a[8]*h+a[12],n[r+1]=a[1]*s+a[5]*u+a[9]*h+a[13],n[r+2]=a[2]*s+a[6]*u+a[10]*h+a[14];for(let e=3;e<9;++e)n[r+e]=t[i+e];r+=o}}}const P={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...o};export{b as PatternMaterial};\n"]},"metadata":{},"sourceType":"module"}