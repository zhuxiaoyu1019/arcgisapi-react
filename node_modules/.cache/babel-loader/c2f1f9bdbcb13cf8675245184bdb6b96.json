{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../PixelBlock.js\";\n\nconst e = function (t) {\n  return t && \"esri.layers.support.PixelBlock\" === t.declaredClass && t.pixels && t.pixels.length > 0;\n};\n\nfunction i(t) {\n  let {\n    altitude: e,\n    azimuth: i\n  } = t;\n  const {\n    hillshadeType: s,\n    pixelSizePower: n,\n    pixelSizeFactor: l,\n    scalingType: a,\n    isGCS: o,\n    resolution: r\n  } = t,\n        c = \"multi-directional\" === s ? 2 * t.zFactor : t.zFactor,\n        {\n    x: h,\n    y: u\n  } = r;\n  let f = c / (8 * h),\n      d = c / (8 * u);\n  if (o && c > .001 && (f /= 111e3, d /= 111e3), \"adjusted\" === a) if (o) {\n    const t = 111e3 * h,\n          e = 111e3 * u;\n    f = (c + t ** n * l) / (8 * t), d = (c + e ** n * l) / (8 * e);\n  } else f = (c + h ** n * l) / (8 * h), d = (c + u ** n * l) / (8 * u);\n  let p = (90 - e) * Math.PI / 180,\n      x = Math.cos(p),\n      m = (360 - i + 90) * Math.PI / 180,\n      M = Math.sin(p) * Math.cos(m),\n      A = Math.sin(p) * Math.sin(m);\n  const w = [315, 270, 225, 360, 180, 0],\n        y = [60, 60, 60, 60, 60, 90],\n        g = new Float32Array([3, 5, 3, 2, 1, 4]),\n        Z = g.reduce((t, e) => t + e),\n        k = g.map(t => t / Z),\n        P = \"multi-directional\" === s ? w.length : 1,\n        C = new Float32Array(6),\n        F = new Float32Array(6),\n        b = new Float32Array(6);\n  if (\"multi-directional\" === s) for (let z = 0; z < P; z++) e = y[z], i = w[z], p = (90 - e) * Math.PI / 180, x = Math.cos(p), m = (360 - i + 90) * Math.PI / 180, M = Math.sin(p) * Math.cos(m), A = Math.sin(p) * Math.sin(m), C[z] = x, F[z] = M, b[z] = A;else C.fill(x), F.fill(M), b.fill(A);\n  return {\n    resolution: r,\n    factor: [f, d],\n    sinZcosA: M,\n    sinZsinA: A,\n    cosZ: x,\n    sinZcosAs: F,\n    sinZsinAs: b,\n    cosZs: C,\n    weights: k,\n    hillshadeType: [\"traditional\", \"multi-directional\"].indexOf(s)\n  };\n}\n\nfunction s(s, n) {\n  if (!e(s)) return s;\n  const {\n    width: l,\n    height: a,\n    mask: o\n  } = s,\n        r = new Uint8Array(l * a);\n  o && r.set(o);\n  const {\n    factor: c,\n    sinZcosA: h,\n    sinZsinA: u,\n    cosZ: f,\n    sinZcosAs: d,\n    sinZsinAs: p,\n    cosZs: x,\n    weights: m\n  } = i(n),\n        [M, A] = c,\n        {\n    hillshadeType: w\n  } = n,\n        y = s.pixels[0],\n        g = new Uint8Array(l * a);\n  let Z, k, P, C, F, b, z, T;\n  const U = 1;\n\n  for (let t = U; t < a - U; t++) {\n    const e = t * l;\n\n    for (let t = U; t < l - U; t++) {\n      if (o && !o[e + t]) {\n        g[e + t] = 0;\n        continue;\n      }\n\n      let i = 8;\n\n      if (o && (i = o[e - l + t - 1] + o[e - l + t] + o[e - l + t + 1] + o[e + t - 1] + o[e + t + 1] + o[e + l + t - 1] + o[e + l + t] + o[e + l + t + 1], i < 7)) {\n        g[e + t] = 0, r[e + t] = 0;\n        continue;\n      }\n\n      7 === i ? (Z = o[e - l + t - 1] ? y[e - l + t - 1] : y[e + t], k = o[e - l + t] ? y[e - l + t] : y[e + t], P = o[e - l + t + 1] ? y[e - l + t + 1] : y[e + t], C = o[e + t - 1] ? y[e + t - 1] : y[e + t], F = o[e + t + 1] ? y[e + t + 1] : y[e + t], b = o[e + l + t - 1] ? y[e + l + t - 1] : y[e + t], z = o[e + l + t] ? y[e + l + t] : y[e + t], T = o[e + l + t + 1] ? y[e + l + t + 1] : y[e + t]) : (Z = y[e - l + t - 1], k = y[e - l + t], P = y[e - l + t + 1], C = y[e + t - 1], F = y[e + t + 1], b = y[e + l + t - 1], z = y[e + l + t], T = y[e + l + t + 1]);\n      const s = (P + F + F + T - (Z + C + C + b)) * M,\n            n = (b + z + z + T - (Z + k + k + P)) * A,\n            a = Math.sqrt(1 + s * s + n * n);\n      let c = 0;\n\n      if (\"traditional\" === w) {\n        let t = 255 * (f + u * n - h * s) / a;\n        t < 0 && (t = 0), c = t;\n      } else {\n        const t = p.length;\n\n        for (let e = 0; e < t; e++) {\n          let t = 255 * (x[e] + p[e] * n - d[e] * s) / a;\n          t < 0 && (t = 0), c += t * m[e];\n        }\n      }\n\n      g[e + t] = 255 & c;\n    }\n  }\n\n  for (let t = 0; t < a; t++) g[t * l] = g[t * l + 1], g[(t + 1) * l - 1] = g[(t + 1) * l - 2];\n\n  for (let t = 1; t < l - 1; t++) g[t] = g[t + l], g[t + (a - 1) * l] = g[t + (a - 2) * l];\n\n  return new t({\n    width: l,\n    height: a,\n    pixels: [g],\n    mask: o ? r : null,\n    pixelType: \"u8\",\n    validPixelCount: s.validPixelCount,\n    statistics: [{\n      minValue: 0,\n      maxValue: 255\n    }]\n  });\n}\n\nfunction n(t, i, s, n) {\n  if (!e(t) || !e(i)) return;\n  const {\n    min: l,\n    max: a\n  } = n,\n        o = t.pixels[0],\n        {\n    pixels: r,\n    mask: c\n  } = i,\n        h = r[0],\n        u = 255.00001 / (a - l),\n        f = new Uint8ClampedArray(h.length),\n        d = new Uint8ClampedArray(h.length),\n        p = new Uint8ClampedArray(h.length),\n        x = s.length - 1;\n\n  for (let e = 0; e < h.length; e++) {\n    if (c && 0 === c[e]) continue;\n    const t = Math.floor((h[e] - l) * u),\n          [i, n] = s[t < 0 ? 0 : t > x ? x : t],\n          a = o[e],\n          r = a * n,\n          m = r * (1 - Math.abs(i % 2 - 1)),\n          M = a - r;\n\n    switch (Math.floor(i)) {\n      case 0:\n        f[e] = r + M, d[e] = m + M, p[e] = M;\n        break;\n\n      case 1:\n        f[e] = m + M, d[e] = r + M, p[e] = M;\n        break;\n\n      case 2:\n        f[e] = M, d[e] = r + M, p[e] = m + M;\n        break;\n\n      case 3:\n        f[e] = M, d[e] = m + M, p[e] = r + M;\n        break;\n\n      case 4:\n        f[e] = m + M, d[e] = M, p[e] = r + M;\n        break;\n\n      case 5:\n      case 6:\n        f[e] = r + M, d[e] = M, p[e] = m + M;\n    }\n  }\n\n  t.pixels = [f, d, p], t.updateStatistics();\n}\n\nexport { i as calculateHillshadeParams, s as hillshade, n as tintHillshade };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/rasterFunctions/surfaceUtils.js"],"names":["t","e","declaredClass","pixels","length","i","altitude","azimuth","hillshadeType","s","pixelSizePower","n","pixelSizeFactor","l","scalingType","a","isGCS","o","resolution","r","c","zFactor","x","h","y","u","f","d","p","Math","PI","cos","m","M","sin","A","w","g","Float32Array","Z","reduce","k","map","P","C","F","b","z","fill","factor","sinZcosA","sinZsinA","cosZ","sinZcosAs","sinZsinAs","cosZs","weights","indexOf","width","height","mask","Uint8Array","set","T","U","sqrt","pixelType","validPixelCount","statistics","minValue","maxValue","min","max","Uint8ClampedArray","floor","abs","updateStatistics","calculateHillshadeParams","hillshade","tintHillshade"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../PixelBlock.js\";const e=function(t){return t&&\"esri.layers.support.PixelBlock\"===t.declaredClass&&t.pixels&&t.pixels.length>0};function i(t){let{altitude:e,azimuth:i}=t;const{hillshadeType:s,pixelSizePower:n,pixelSizeFactor:l,scalingType:a,isGCS:o,resolution:r}=t,c=\"multi-directional\"===s?2*t.zFactor:t.zFactor,{x:h,y:u}=r;let f=c/(8*h),d=c/(8*u);if(o&&c>.001&&(f/=111e3,d/=111e3),\"adjusted\"===a)if(o){const t=111e3*h,e=111e3*u;f=(c+t**n*l)/(8*t),d=(c+e**n*l)/(8*e)}else f=(c+h**n*l)/(8*h),d=(c+u**n*l)/(8*u);let p=(90-e)*Math.PI/180,x=Math.cos(p),m=(360-i+90)*Math.PI/180,M=Math.sin(p)*Math.cos(m),A=Math.sin(p)*Math.sin(m);const w=[315,270,225,360,180,0],y=[60,60,60,60,60,90],g=new Float32Array([3,5,3,2,1,4]),Z=g.reduce(((t,e)=>t+e)),k=g.map((t=>t/Z)),P=\"multi-directional\"===s?w.length:1,C=new Float32Array(6),F=new Float32Array(6),b=new Float32Array(6);if(\"multi-directional\"===s)for(let z=0;z<P;z++)e=y[z],i=w[z],p=(90-e)*Math.PI/180,x=Math.cos(p),m=(360-i+90)*Math.PI/180,M=Math.sin(p)*Math.cos(m),A=Math.sin(p)*Math.sin(m),C[z]=x,F[z]=M,b[z]=A;else C.fill(x),F.fill(M),b.fill(A);return{resolution:r,factor:[f,d],sinZcosA:M,sinZsinA:A,cosZ:x,sinZcosAs:F,sinZsinAs:b,cosZs:C,weights:k,hillshadeType:[\"traditional\",\"multi-directional\"].indexOf(s)}}function s(s,n){if(!e(s))return s;const{width:l,height:a,mask:o}=s,r=new Uint8Array(l*a);o&&r.set(o);const{factor:c,sinZcosA:h,sinZsinA:u,cosZ:f,sinZcosAs:d,sinZsinAs:p,cosZs:x,weights:m}=i(n),[M,A]=c,{hillshadeType:w}=n,y=s.pixels[0],g=new Uint8Array(l*a);let Z,k,P,C,F,b,z,T;const U=1;for(let t=U;t<a-U;t++){const e=t*l;for(let t=U;t<l-U;t++){if(o&&!o[e+t]){g[e+t]=0;continue}let i=8;if(o&&(i=o[e-l+t-1]+o[e-l+t]+o[e-l+t+1]+o[e+t-1]+o[e+t+1]+o[e+l+t-1]+o[e+l+t]+o[e+l+t+1],i<7)){g[e+t]=0,r[e+t]=0;continue}7===i?(Z=o[e-l+t-1]?y[e-l+t-1]:y[e+t],k=o[e-l+t]?y[e-l+t]:y[e+t],P=o[e-l+t+1]?y[e-l+t+1]:y[e+t],C=o[e+t-1]?y[e+t-1]:y[e+t],F=o[e+t+1]?y[e+t+1]:y[e+t],b=o[e+l+t-1]?y[e+l+t-1]:y[e+t],z=o[e+l+t]?y[e+l+t]:y[e+t],T=o[e+l+t+1]?y[e+l+t+1]:y[e+t]):(Z=y[e-l+t-1],k=y[e-l+t],P=y[e-l+t+1],C=y[e+t-1],F=y[e+t+1],b=y[e+l+t-1],z=y[e+l+t],T=y[e+l+t+1]);const s=(P+F+F+T-(Z+C+C+b))*M,n=(b+z+z+T-(Z+k+k+P))*A,a=Math.sqrt(1+s*s+n*n);let c=0;if(\"traditional\"===w){let t=255*(f+u*n-h*s)/a;t<0&&(t=0),c=t}else{const t=p.length;for(let e=0;e<t;e++){let t=255*(x[e]+p[e]*n-d[e]*s)/a;t<0&&(t=0),c+=t*m[e]}}g[e+t]=255&c}}for(let t=0;t<a;t++)g[t*l]=g[t*l+1],g[(t+1)*l-1]=g[(t+1)*l-2];for(let t=1;t<l-1;t++)g[t]=g[t+l],g[t+(a-1)*l]=g[t+(a-2)*l];return new t({width:l,height:a,pixels:[g],mask:o?r:null,pixelType:\"u8\",validPixelCount:s.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function n(t,i,s,n){if(!e(t)||!e(i))return;const{min:l,max:a}=n,o=t.pixels[0],{pixels:r,mask:c}=i,h=r[0],u=255.00001/(a-l),f=new Uint8ClampedArray(h.length),d=new Uint8ClampedArray(h.length),p=new Uint8ClampedArray(h.length),x=s.length-1;for(let e=0;e<h.length;e++){if(c&&0===c[e])continue;const t=Math.floor((h[e]-l)*u),[i,n]=s[t<0?0:t>x?x:t],a=o[e],r=a*n,m=r*(1-Math.abs(i%2-1)),M=a-r;switch(Math.floor(i)){case 0:f[e]=r+M,d[e]=m+M,p[e]=M;break;case 1:f[e]=m+M,d[e]=r+M,p[e]=M;break;case 2:f[e]=M,d[e]=r+M,p[e]=m+M;break;case 3:f[e]=M,d[e]=m+M,p[e]=r+M;break;case 4:f[e]=m+M,d[e]=M,p[e]=r+M;break;case 5:case 6:f[e]=r+M,d[e]=M,p[e]=m+M}}t.pixels=[f,d,p],t.updateStatistics()}export{i as calculateHillshadeParams,s as hillshade,n as tintHillshade};\n"]},"metadata":{},"sourceType":"module"}