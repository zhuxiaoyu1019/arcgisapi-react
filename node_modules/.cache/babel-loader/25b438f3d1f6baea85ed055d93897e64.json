{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/has.js\";\nimport { throwIfAborted as t, isAbortError as r } from \"../../../../../core/promiseUtils.js\";\nimport { BaseFeatureSource as s } from \"./BaseFeatureSource.js\";\nconst i = e(\"esri-mobile\"),\n      a = {\n  maxDrillLevel: i ? 1 : 4,\n  maxRecordCountFactor: i ? 1 : 3\n};\n\nclass o extends s {\n  constructor(e) {\n    super(e);\n  }\n\n  async _fetchDataTile(e) {\n    const s = this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,\n          i = this._subscriptions.get(e.key.id),\n          o = i.signal,\n          n = e.getQuantizationParameters();\n\n    let c = 0;\n\n    const d = async (u, p) => {\n      const l = this._queryInfo,\n            m = this._createQuery(u, {\n        maxRecordCountFactor: s ? a.maxRecordCountFactor : void 0,\n        returnExceededLimitFeatures: !1,\n        quantizationParameters: n\n      });\n\n      c++;\n\n      try {\n        const r = await this._queue.push({\n          tile: e,\n          query: m,\n          signal: o,\n          depth: p\n        });\n        if (c--, t(o), !r) return;\n        if (l !== this._queryInfo) return void d(u, p);\n\n        if (r.exceededTransferLimit && p < a.maxDrillLevel) {\n          for (const e of u.createChildTiles()) d(e, p + 1);\n\n          return;\n        }\n\n        const s = {\n          id: e.id,\n          addOrUpdate: r,\n          end: 0 === c,\n          type: \"append\"\n        };\n        i.add({\n          query: m,\n          message: s\n        }), this._onMessage(s);\n      } catch (h) {\n        r(h) || this._onMessage({\n          id: e.id,\n          addOrUpdate: null,\n          end: !0,\n          type: \"append\"\n        });\n      }\n    };\n\n    d(e, 0);\n  }\n\n}\n\nexport { o as DrillDownFeatureSource };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/layers/features/sources/DrillDownFeatureSource.js"],"names":["e","throwIfAborted","t","isAbortError","r","BaseFeatureSource","s","i","a","maxDrillLevel","maxRecordCountFactor","o","constructor","_fetchDataTile","_serviceInfo","capabilities","query","supportsMaxRecordCountFactor","_subscriptions","get","key","id","signal","n","getQuantizationParameters","c","d","u","p","l","_queryInfo","m","_createQuery","returnExceededLimitFeatures","quantizationParameters","_queue","push","tile","depth","exceededTransferLimit","createChildTiles","addOrUpdate","end","type","add","message","_onMessage","h","DrillDownFeatureSource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/has.js\";import{throwIfAborted as t,isAbortError as r}from\"../../../../../core/promiseUtils.js\";import{BaseFeatureSource as s}from\"./BaseFeatureSource.js\";const i=e(\"esri-mobile\"),a={maxDrillLevel:i?1:4,maxRecordCountFactor:i?1:3};class o extends s{constructor(e){super(e)}async _fetchDataTile(e){const s=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,i=this._subscriptions.get(e.key.id),o=i.signal,n=e.getQuantizationParameters();let c=0;const d=async(u,p)=>{const l=this._queryInfo,m=this._createQuery(u,{maxRecordCountFactor:s?a.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:n});c++;try{const r=await this._queue.push({tile:e,query:m,signal:o,depth:p});if(c--,t(o),!r)return;if(l!==this._queryInfo)return void d(u,p);if(r.exceededTransferLimit&&p<a.maxDrillLevel){for(const e of u.createChildTiles())d(e,p+1);return}const s={id:e.id,addOrUpdate:r,end:0===c,type:\"append\"};i.add({query:m,message:s}),this._onMessage(s)}catch(h){r(h)||this._onMessage({id:e.id,addOrUpdate:null,end:!0,type:\"append\"})}};d(e,0)}}export{o as DrillDownFeatureSource};\n"]},"metadata":{},"sourceType":"module"}