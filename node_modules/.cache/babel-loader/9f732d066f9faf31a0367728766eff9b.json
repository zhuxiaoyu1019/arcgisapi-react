{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { disposeMaybe as e } from \"../../../../core/maybe.js\";\nimport { vtlBrushes as t } from \"../brushes.js\";\nimport r from \"./shaders/VTLMaterialManager.js\";\nconst s = 1e-6;\n\nclass a {\n  constructor(e, t) {\n    this.spriteMosaic = e, this.glyphMosaic = t, this._brushCache = new Map(), this._vtlMaterialManager = new r();\n  }\n\n  dispose() {\n    this._brushCache && (this._brushCache.forEach(e => e.dispose()), this._brushCache = null), this._vtlMaterialManager = e(this._vtlMaterialManager), this.spriteMosaic.dispose(), this.glyphMosaic.dispose();\n  }\n\n  get vectorTilesMaterialManager() {\n    return this._vtlMaterialManager;\n  }\n\n  drawTile(e, t, r) {\n    const {\n      context: s\n    } = e,\n          a = r.layers;\n    r.backgroundBucketIds.length > 0 && (e.renderPass = \"background\", r.backgroundBucketIds.forEach(s => this._renderStyleLayer(r.getLayerById(s), e, t, !0))), s.setBlendingEnabled(!1), s.setDepthTestEnabled(!0), s.setDepthWriteEnabled(!0), s.setDepthFunction(515), e.renderPass = \"opaque\";\n\n    for (let i = a.length - 1; i >= 0; i--) this._renderStyleLayer(a[i], e, t, !1);\n\n    s.setDepthWriteEnabled(!1), s.setBlendingEnabled(!0), s.setBlendFunctionSeparate(1, 771, 1, 771), e.renderPass = \"translucent\";\n\n    for (let i = 0; i < a.length; i++) this._renderStyleLayer(a[i], e, t, !1);\n\n    s.setDepthTestEnabled(!1), e.renderPass = \"symbol\";\n\n    for (let i = 0; i < a.length; i++) this._renderStyleLayer(a[i], e, t, !1);\n\n    s.bindVAO();\n  }\n\n  _renderStyleLayer(e, t, r, a = !1) {\n    if (!(a || e && r.layerData.has(e.uid))) return;\n    const i = e.getLayoutProperty(\"visibility\");\n    if (i && 1 === i.getValue()) return;\n    const {\n      renderPass: n\n    } = t;\n    let l;\n\n    switch (e.type) {\n      case 0:\n        if (\"background\" !== n) return;\n        l = \"vtlBackground\";\n        break;\n\n      case 1:\n        if (\"opaque\" !== n && \"translucent\" !== t.renderPass) return;\n        l = \"vtlFill\";\n        break;\n\n      case 2:\n        if (\"translucent\" !== n) return;\n        l = \"vtlLine\";\n        break;\n\n      case 4:\n        if (\"symbol\" !== n) return;\n        l = \"vtlCircle\";\n        break;\n\n      case 3:\n        if (\"symbol\" !== n) return;\n        l = \"vtlSymbol\";\n    }\n\n    const h = t.displayLevel;\n    void 0 !== e.minzoom && e.minzoom > h + s || void 0 !== e.maxzoom && e.maxzoom <= h - s || (t.styleLayerUID = e.uid, t.styleLayer = e, this.drawWithBrush(t, r, l));\n  }\n\n  drawWithBrush(e, r, s) {\n    if (!this._brushCache.has(s)) {\n      const e = t[s];\n\n      this._brushCache.set(s, new e());\n    }\n\n    this._brushCache.get(s).drawMany(e, [r]);\n  }\n\n}\n\nexport default a;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/VTLPainter3D.js"],"names":["disposeMaybe","e","vtlBrushes","t","r","s","a","constructor","spriteMosaic","glyphMosaic","_brushCache","Map","_vtlMaterialManager","dispose","forEach","vectorTilesMaterialManager","drawTile","context","layers","backgroundBucketIds","length","renderPass","_renderStyleLayer","getLayerById","setBlendingEnabled","setDepthTestEnabled","setDepthWriteEnabled","setDepthFunction","i","setBlendFunctionSeparate","bindVAO","layerData","has","uid","getLayoutProperty","getValue","n","l","type","h","displayLevel","minzoom","maxzoom","styleLayerUID","styleLayer","drawWithBrush","set","get","drawMany"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as e}from\"../../../../core/maybe.js\";import{vtlBrushes as t}from\"../brushes.js\";import r from\"./shaders/VTLMaterialManager.js\";const s=1e-6;class a{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new r}dispose(){this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache=null),this._vtlMaterialManager=e(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawTile(e,t,r){const{context:s}=e,a=r.layers;r.backgroundBucketIds.length>0&&(e.renderPass=\"background\",r.backgroundBucketIds.forEach((s=>this._renderStyleLayer(r.getLayerById(s),e,t,!0)))),s.setBlendingEnabled(!1),s.setDepthTestEnabled(!0),s.setDepthWriteEnabled(!0),s.setDepthFunction(515),e.renderPass=\"opaque\";for(let i=a.length-1;i>=0;i--)this._renderStyleLayer(a[i],e,t,!1);s.setDepthWriteEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunctionSeparate(1,771,1,771),e.renderPass=\"translucent\";for(let i=0;i<a.length;i++)this._renderStyleLayer(a[i],e,t,!1);s.setDepthTestEnabled(!1),e.renderPass=\"symbol\";for(let i=0;i<a.length;i++)this._renderStyleLayer(a[i],e,t,!1);s.bindVAO()}_renderStyleLayer(e,t,r,a=!1){if(!(a||e&&r.layerData.has(e.uid)))return;const i=e.getLayoutProperty(\"visibility\");if(i&&1===i.getValue())return;const{renderPass:n}=t;let l;switch(e.type){case 0:if(\"background\"!==n)return;l=\"vtlBackground\";break;case 1:if(\"opaque\"!==n&&\"translucent\"!==t.renderPass)return;l=\"vtlFill\";break;case 2:if(\"translucent\"!==n)return;l=\"vtlLine\";break;case 4:if(\"symbol\"!==n)return;l=\"vtlCircle\";break;case 3:if(\"symbol\"!==n)return;l=\"vtlSymbol\"}const h=t.displayLevel;void 0!==e.minzoom&&e.minzoom>h+s||void 0!==e.maxzoom&&e.maxzoom<=h-s||(t.styleLayerUID=e.uid,t.styleLayer=e,this.drawWithBrush(t,r,l))}drawWithBrush(e,r,s){if(!this._brushCache.has(s)){const e=t[s];this._brushCache.set(s,new e)}this._brushCache.get(s).drawMany(e,[r])}}export default a;\n"]},"metadata":{},"sourceType":"module"}