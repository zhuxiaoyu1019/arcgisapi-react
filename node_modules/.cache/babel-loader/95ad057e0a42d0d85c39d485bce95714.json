{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e } from \"../../../../../../core/maybe.js\";\nimport { toPt as t, pt2px as s } from \"../../../../../../core/screenUtils.js\";\nimport { premultiplyAlpha as n } from \"../../../../engine/webgl/color.js\";\nimport { NAN_MAGIC_NUMBER as o } from \"../../../../engine/webgl/definitions.js\";\nimport { WGLVVFlag as i } from \"../../../../engine/webgl/enums.js\";\nimport { getTypeOfSizeVisualVariable as l } from \"../../../../engine/webgl/visualVariablesUtils.js\";\n\nfunction r(e, t) {\n  if (!e || !t) return e;\n\n  switch (t) {\n    case \"radius\":\n    case \"distance\":\n      return 2 * e;\n\n    case \"diameter\":\n    case \"width\":\n      return e;\n\n    case \"area\":\n      return Math.sqrt(e);\n  }\n\n  return e;\n}\n\nfunction a(e) {\n  return {\n    value: e.value,\n    size: t(e.size)\n  };\n}\n\nfunction u(e) {\n  return e.map(e => a(e));\n}\n\nfunction c(e) {\n  if (\"string\" == typeof e || \"number\" == typeof e) return t(e);\n  const s = e;\n  return {\n    type: \"size\",\n    expression: s.expression,\n    stops: u(s.stops)\n  };\n}\n\nfunction p(e) {\n  const t = e && e.length > 0 ? {} : null;\n  return t && e.forEach(e => {\n    const s = e.type;\n    e.field && (t[s] = e.field);\n  }), t;\n}\n\nconst f = e => {\n  const t = [],\n        n = [],\n        i = u(e),\n        l = i.length;\n\n  for (let r = 0; r < 6; r++) {\n    const e = i[Math.min(r, l - 1)];\n    t.push(e.value), n.push(null == e.size ? o : s(e.size));\n  }\n\n  return {\n    values: new Float32Array(t),\n    sizes: new Float32Array(n)\n  };\n};\n\nfunction m(e) {\n  const t = e && e.length > 0 ? {} : null,\n        s = t ? {} : null;\n  if (!t) return {\n    vvFields: t,\n    vvRanges: s\n  };\n\n  for (const n of e) if (n.field && (t[n.type] = n.field), \"size\" === n.type) {\n    s.size || (s.size = {});\n    const e = n;\n\n    switch (l(e)) {\n      case i.SIZE_MINMAX_VALUE:\n        s.size.minMaxValue = {\n          minDataValue: e.minDataValue,\n          maxDataValue: e.maxDataValue,\n          minSize: c(e.minSize),\n          maxSize: c(e.maxSize)\n        };\n        break;\n\n      case i.SIZE_SCALE_STOPS:\n        s.size.scaleStops = {\n          stops: u(e.stops)\n        };\n        break;\n\n      case i.SIZE_FIELD_STOPS:\n        if (e.levels) {\n          const t = {};\n\n          for (const s in e.levels) t[s] = f(e.levels[s]);\n\n          s.size.fieldStops = {\n            type: \"level-dependent\",\n            levels: t\n          };\n        } else s.size.fieldStops = {\n          type: \"static\",\n          ...f(e.stops)\n        };\n\n        break;\n\n      case i.SIZE_UNIT_VALUE:\n        s.size.unitValue = {\n          unit: e.valueUnit,\n          valueRepresentation: e.valueRepresentation\n        };\n    }\n  } else if (\"color\" === n.type) s.color = y(n);else if (\"opacity\" === n.type) s.opacity = v(n);else if (\"rotation\" === n.type) {\n    const e = n;\n    s.rotation = {\n      type: e.rotationType\n    };\n  }\n\n  return {\n    vvFields: t,\n    vvRanges: s\n  };\n}\n\nfunction v(e) {\n  const t = {\n    values: [0, 0, 0, 0, 0, 0, 0, 0],\n    opacities: [0, 0, 0, 0, 0, 0, 0, 0]\n  };\n\n  if (\"string\" == typeof e.field) {\n    if (!e.stops) return null;\n    {\n      if (e.stops.length > 8) return null;\n      const s = e.stops;\n\n      for (let e = 0; e < 8; ++e) {\n        const n = s[Math.min(e, s.length - 1)];\n        t.values[e] = n.value, t.opacities[e] = n.opacity;\n      }\n    }\n  } else {\n    if (!(e.stops && e.stops.length >= 0)) return null;\n    {\n      const s = e.stops && e.stops.length >= 0 && e.stops[0].opacity;\n\n      for (let e = 0; e < 8; e++) t.values[e] = 1 / 0, t.opacities[e] = s;\n    }\n  }\n\n  return t;\n}\n\nfunction g(e, t, s) {\n  e[4 * t + 0] = s.r / 255, e[4 * t + 1] = s.g / 255, e[4 * t + 2] = s.b / 255, e[4 * t + 3] = s.a;\n}\n\nfunction y(t) {\n  if (e(t)) return null;\n  if (t.normalizationField) return null;\n  const s = {\n    field: null,\n    values: [0, 0, 0, 0, 0, 0, 0, 0],\n    colors: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n  };\n\n  if (\"string\" == typeof t.field) {\n    if (!t.stops) return null;\n    {\n      if (t.stops.length > 8) return null;\n      s.field = t.field;\n      const e = t.stops;\n\n      for (let t = 0; t < 8; ++t) {\n        const n = e[Math.min(t, e.length - 1)];\n        s.values[t] = n.value, g(s.colors, t, n.color);\n      }\n    }\n  } else {\n    if (!(t.stops && t.stops.length >= 0)) return null;\n    {\n      const e = t.stops && t.stops.length >= 0 && t.stops[0].color;\n\n      for (let t = 0; t < 8; t++) s.values[t] = 1 / 0, g(s.colors, t, e);\n    }\n  }\n\n  for (let e = 0; e < 32; e += 4) n(s.colors, e, !0);\n\n  return s;\n}\n\nexport { y as convertColorVariable, m as convertVisualVariables, r as getVisualVariableSizeValueRepresentationRatio, p as getVisualVariablesFields, c as normalizeSizeElement, u as normalizeSizeStops, a as stopToSizeStop };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/support/visualVariablesUtils.js"],"names":["isNone","e","toPt","t","pt2px","s","premultiplyAlpha","n","NAN_MAGIC_NUMBER","o","WGLVVFlag","i","getTypeOfSizeVisualVariable","l","r","Math","sqrt","a","value","size","u","map","c","type","expression","stops","p","length","forEach","field","f","min","push","values","Float32Array","sizes","m","vvFields","vvRanges","SIZE_MINMAX_VALUE","minMaxValue","minDataValue","maxDataValue","minSize","maxSize","SIZE_SCALE_STOPS","scaleStops","SIZE_FIELD_STOPS","levels","fieldStops","SIZE_UNIT_VALUE","unitValue","unit","valueUnit","valueRepresentation","color","y","opacity","v","rotation","rotationType","opacities","g","b","normalizationField","colors","convertColorVariable","convertVisualVariables","getVisualVariableSizeValueRepresentationRatio","getVisualVariablesFields","normalizeSizeElement","normalizeSizeStops","stopToSizeStop"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e}from\"../../../../../../core/maybe.js\";import{toPt as t,pt2px as s}from\"../../../../../../core/screenUtils.js\";import{premultiplyAlpha as n}from\"../../../../engine/webgl/color.js\";import{NAN_MAGIC_NUMBER as o}from\"../../../../engine/webgl/definitions.js\";import{WGLVVFlag as i}from\"../../../../engine/webgl/enums.js\";import{getTypeOfSizeVisualVariable as l}from\"../../../../engine/webgl/visualVariablesUtils.js\";function r(e,t){if(!e||!t)return e;switch(t){case\"radius\":case\"distance\":return 2*e;case\"diameter\":case\"width\":return e;case\"area\":return Math.sqrt(e)}return e}function a(e){return{value:e.value,size:t(e.size)}}function u(e){return e.map((e=>a(e)))}function c(e){if(\"string\"==typeof e||\"number\"==typeof e)return t(e);const s=e;return{type:\"size\",expression:s.expression,stops:u(s.stops)}}function p(e){const t=e&&e.length>0?{}:null;return t&&e.forEach((e=>{const s=e.type;e.field&&(t[s]=e.field)})),t}const f=e=>{const t=[],n=[],i=u(e),l=i.length;for(let r=0;r<6;r++){const e=i[Math.min(r,l-1)];t.push(e.value),n.push(null==e.size?o:s(e.size))}return{values:new Float32Array(t),sizes:new Float32Array(n)}};function m(e){const t=e&&e.length>0?{}:null,s=t?{}:null;if(!t)return{vvFields:t,vvRanges:s};for(const n of e)if(n.field&&(t[n.type]=n.field),\"size\"===n.type){s.size||(s.size={});const e=n;switch(l(e)){case i.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:c(e.minSize),maxSize:c(e.maxSize)};break;case i.SIZE_SCALE_STOPS:s.size.scaleStops={stops:u(e.stops)};break;case i.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const s in e.levels)t[s]=f(e.levels[s]);s.size.fieldStops={type:\"level-dependent\",levels:t}}else s.size.fieldStops={type:\"static\",...f(e.stops)};break;case i.SIZE_UNIT_VALUE:s.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if(\"color\"===n.type)s.color=y(n);else if(\"opacity\"===n.type)s.opacity=v(n);else if(\"rotation\"===n.type){const e=n;s.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:s}}function v(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(\"string\"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const s=e.stops;for(let e=0;e<8;++e){const n=s[Math.min(e,s.length-1)];t.values[e]=n.value,t.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=s}}return t}function g(e,t,s){e[4*t+0]=s.r/255,e[4*t+1]=s.g/255,e[4*t+2]=s.b/255,e[4*t+3]=s.a}function y(t){if(e(t))return null;if(t.normalizationField)return null;const s={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if(\"string\"==typeof t.field){if(!t.stops)return null;{if(t.stops.length>8)return null;s.field=t.field;const e=t.stops;for(let t=0;t<8;++t){const n=e[Math.min(t,e.length-1)];s.values[t]=n.value,g(s.colors,t,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const e=t.stops&&t.stops.length>=0&&t.stops[0].color;for(let t=0;t<8;t++)s.values[t]=1/0,g(s.colors,t,e)}}for(let e=0;e<32;e+=4)n(s.colors,e,!0);return s}export{y as convertColorVariable,m as convertVisualVariables,r as getVisualVariableSizeValueRepresentationRatio,p as getVisualVariablesFields,c as normalizeSizeElement,u as normalizeSizeStops,a as stopToSizeStop};\n"]},"metadata":{},"sourceType":"module"}