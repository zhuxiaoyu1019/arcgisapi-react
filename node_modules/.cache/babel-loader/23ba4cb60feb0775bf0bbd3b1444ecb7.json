{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as t, isNone as o } from \"../../../../../core/maybe.js\";\nimport { A as s, B as e, t as n } from \"../../../../../chunks/vec3.js\";\nimport { c as i } from \"../../../../../chunks/vec3f64.js\";\nimport { create as r } from \"../../../../../geometry/support/aaBoundingBox.js\";\nimport { BufferViewVec3f as p } from \"../../../../../geometry/support/buffer/BufferView.js\";\nimport { componentMinimalSizeForIntersectionData as m, ComponentIntersectionData as a } from \"./ComponentIntersectionData.js\";\nimport { getVisibility as c } from \"../../lib/ComponentUtils.js\";\nimport { generateDefaultIndexArray as h } from \"../../lib/geometryDataUtils.js\";\nimport { computeInvDir as f, intersectAabbInvDir as _, intersectTriangles as b } from \"../../materials/internal/MaterialUtil.js\";\n\nclass u {\n  constructor(o, s) {\n    this._indices = t(o.indices) ? o.indices : h(o.positions.length / 3), this._positions = new p(o.positions), this._components = s, this._componentIntersectionData = new Array(s.count);\n  }\n\n  getComponentAabb(o, s) {\n    if (t(this._perComponentAabbs)) {\n      for (let t = 0; t < 6; t++) s[t] = this._perComponentAabbs[6 * o + t];\n\n      return s;\n    }\n\n    return this._computePerComponentAabbs(), this.getComponentAabb(o, s);\n  }\n\n  getComponentPositions(t, o) {\n    o.indices = this._indices, o.data = this._positions.typedBuffer, o.stride = this._positions.typedBufferStride, o.startIndex = this._components.offsets[t], o.endIndex = this._components.offsets[t + 1];\n  }\n\n  intersect(s, e, i, r, p, h) {\n    const u = {\n      data: this._positions.typedBuffer,\n      stride: this._positions.typedBufferStride,\n      size: 3\n    },\n          l = this._indices,\n          C = this._components.offsets,\n          y = f(s, e, d);\n\n    this._components.visibility.forEachComponent(f => {\n      if (!c(this._components.pickability, f)) return !0;\n      const d = this.getComponentAabb(f, A);\n      if (t(p) && p.applyToAabb(d), !_(d, s, y, i)) return !0;\n\n      const g = C[f] / 3,\n            B = C[f + 1] / 3,\n            j = (t, o, s) => {\n        h(f, t, n(o, o, r), s);\n      },\n            I = B - g;\n\n      return o(p) && I > m ? (null == this._componentIntersectionData[f] && (this._componentIntersectionData[f] = new a(this._indices, g, B, u)), this._componentIntersectionData[f].intersectRay({\n        r0: s,\n        r1: e\n      }, j)) : b(s, e, g, B, l, u, void 0, p, j), !0;\n    });\n  }\n\n  _computePerComponentAabbs() {\n    const t = this._components.count;\n    this._perComponentAabbs = new Float32Array(6 * t);\n\n    for (let o = 0; o < t; o++) this._computeAABB(o);\n  }\n\n  _computeAABB(t) {\n    const o = this._indices,\n          n = this._positions,\n          i = this._components.offsets,\n          r = i[t],\n          p = i[t + 1],\n          m = [0, 0, 0],\n          a = [1 / 0, 1 / 0, 1 / 0],\n          c = [-1 / 0, -1 / 0, -1 / 0];\n\n    for (let f = r; f < p; f++) {\n      const t = o[f];\n      n.getVec(t, m), s(a, a, m), e(c, c, m);\n    }\n\n    let h = 6 * t;\n    this._perComponentAabbs[h++] = a[0], this._perComponentAabbs[h++] = a[1], this._perComponentAabbs[h++] = a[2], this._perComponentAabbs[h++] = c[0], this._perComponentAabbs[h++] = c[1], this._perComponentAabbs[h] = c[2];\n  }\n\n  get positions() {\n    return this._positions;\n  }\n\n  get indices() {\n    return this._indices;\n  }\n\n}\n\nconst d = i(),\n      A = r();\nexport default u;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/IntersectionGeometry.js"],"names":["isSome","t","isNone","o","A","s","B","e","n","c","i","create","r","BufferViewVec3f","p","componentMinimalSizeForIntersectionData","m","ComponentIntersectionData","a","getVisibility","generateDefaultIndexArray","h","computeInvDir","f","intersectAabbInvDir","_","intersectTriangles","b","u","constructor","_indices","indices","positions","length","_positions","_components","_componentIntersectionData","Array","count","getComponentAabb","_perComponentAabbs","_computePerComponentAabbs","getComponentPositions","data","typedBuffer","stride","typedBufferStride","startIndex","offsets","endIndex","intersect","size","l","C","y","d","visibility","forEachComponent","pickability","applyToAabb","g","j","I","intersectRay","r0","r1","Float32Array","_computeAABB","getVec"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t,isNone as o}from\"../../../../../core/maybe.js\";import{A as s,B as e,t as n}from\"../../../../../chunks/vec3.js\";import{c as i}from\"../../../../../chunks/vec3f64.js\";import{create as r}from\"../../../../../geometry/support/aaBoundingBox.js\";import{BufferViewVec3f as p}from\"../../../../../geometry/support/buffer/BufferView.js\";import{componentMinimalSizeForIntersectionData as m,ComponentIntersectionData as a}from\"./ComponentIntersectionData.js\";import{getVisibility as c}from\"../../lib/ComponentUtils.js\";import{generateDefaultIndexArray as h}from\"../../lib/geometryDataUtils.js\";import{computeInvDir as f,intersectAabbInvDir as _,intersectTriangles as b}from\"../../materials/internal/MaterialUtil.js\";class u{constructor(o,s){this._indices=t(o.indices)?o.indices:h(o.positions.length/3),this._positions=new p(o.positions),this._components=s,this._componentIntersectionData=new Array(s.count)}getComponentAabb(o,s){if(t(this._perComponentAabbs)){for(let t=0;t<6;t++)s[t]=this._perComponentAabbs[6*o+t];return s}return this._computePerComponentAabbs(),this.getComponentAabb(o,s)}getComponentPositions(t,o){o.indices=this._indices,o.data=this._positions.typedBuffer,o.stride=this._positions.typedBufferStride,o.startIndex=this._components.offsets[t],o.endIndex=this._components.offsets[t+1]}intersect(s,e,i,r,p,h){const u={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},l=this._indices,C=this._components.offsets,y=f(s,e,d);this._components.visibility.forEachComponent((f=>{if(!c(this._components.pickability,f))return!0;const d=this.getComponentAabb(f,A);if(t(p)&&p.applyToAabb(d),!_(d,s,y,i))return!0;const g=C[f]/3,B=C[f+1]/3,j=(t,o,s)=>{h(f,t,n(o,o,r),s)},I=B-g;return o(p)&&I>m?(null==this._componentIntersectionData[f]&&(this._componentIntersectionData[f]=new a(this._indices,g,B,u)),this._componentIntersectionData[f].intersectRay({r0:s,r1:e},j)):b(s,e,g,B,l,u,void 0,p,j),!0}))}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);for(let o=0;o<t;o++)this._computeAABB(o)}_computeAABB(t){const o=this._indices,n=this._positions,i=this._components.offsets,r=i[t],p=i[t+1],m=[0,0,0],a=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let f=r;f<p;f++){const t=o[f];n.getVec(t,m),s(a,a,m),e(c,c,m)}let h=6*t;this._perComponentAabbs[h++]=a[0],this._perComponentAabbs[h++]=a[1],this._perComponentAabbs[h++]=a[2],this._perComponentAabbs[h++]=c[0],this._perComponentAabbs[h++]=c[1],this._perComponentAabbs[h]=c[2]}get positions(){return this._positions}get indices(){return this._indices}}const d=i(),A=r();export default u;\n"]},"metadata":{},"sourceType":"module"}