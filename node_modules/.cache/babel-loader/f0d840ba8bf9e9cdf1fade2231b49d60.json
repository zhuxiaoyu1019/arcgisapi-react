{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Collection.js\";\nimport \"../../core/has.js\";\nimport { eachAlways as r } from \"../../core/promiseUtils.js\";\nimport { layerLookupMap as a } from \"./lazyLayerLoader.js\";\nimport t from \"../../portal/PortalItem.js\";\nimport { isMapNotesLayer as y, isRouteLayer as i } from \"../../portal/support/featureCollectionUtils.js\";\nimport { selectLayerClassPath as L } from \"../../portal/support/portalLayers.js\";\nimport { loadStyleRenderer as o } from \"../../renderers/support/styleUtils.js\";\n\nasync function n(e, a, t) {\n  if (!a) return;\n  const y = [];\n\n  for (const r of a) {\n    const e = I(r, t);\n    \"GroupLayer\" === r.layerType ? y.push(M(e, r, t)) : y.push(e);\n  }\n\n  const i = await r(y);\n\n  for (const r of i) !r.value || t.filter && !t.filter(r.value) || e.add(r.value);\n}\n\nconst l = {\n  ArcGISFeatureLayer: \"FeatureLayer\",\n  ArcGISImageServiceLayer: \"ImageryLayer\",\n  ArcGISMapServiceLayer: \"MapImageLayer\",\n  PointCloudLayer: \"PointCloudLayer\",\n  ArcGISSceneServiceLayer: \"SceneLayer\",\n  IntegratedMeshLayer: \"IntegratedMeshLayer\",\n  BuildingSceneLayer: \"BuildingSceneLayer\",\n  ArcGISTiledElevationServiceLayer: \"ElevationLayer\",\n  ArcGISTiledImageServiceLayer: \"ImageryTileLayer\",\n  ArcGISTiledMapServiceLayer: \"TileLayer\",\n  GroupLayer: \"GroupLayer\",\n  WebTiledLayer: \"WebTileLayer\",\n  CSV: \"CSVLayer\",\n  VectorTileLayer: \"VectorTileLayer\",\n  WMS: \"WMSLayer\",\n  DefaultTileLayer: \"TileLayer\",\n  KML: \"KMLLayer\",\n  RasterDataLayer: \"UnsupportedLayer\"\n},\n      c = {\n  ArcGISTiledElevationServiceLayer: \"ElevationLayer\",\n  DefaultTileLayer: \"ElevationLayer\",\n  RasterDataElevationLayer: \"UnsupportedLayer\"\n},\n      s = {\n  ArcGISTiledMapServiceLayer: \"TileLayer\",\n  ArcGISTiledImageServiceLayer: \"ImageryTileLayer\",\n  OpenStreetMap: \"OpenStreetMapLayer\",\n  WebTiledLayer: \"WebTileLayer\",\n  VectorTileLayer: \"VectorTileLayer\",\n  ArcGISImageServiceLayer: \"UnsupportedLayer\",\n  WMS: \"UnsupportedLayer\",\n  ArcGISMapServiceLayer: \"UnsupportedLayer\",\n  DefaultTileLayer: \"TileLayer\"\n},\n      p = {\n  ArcGISFeatureLayer: \"FeatureLayer\",\n  ArcGISImageServiceLayer: \"ImageryLayer\",\n  ArcGISImageServiceVectorLayer: \"ImageryLayer\",\n  ArcGISMapServiceLayer: \"MapImageLayer\",\n  ArcGISStreamLayer: \"StreamLayer\",\n  ArcGISTiledImageServiceLayer: \"ImageryTileLayer\",\n  ArcGISTiledMapServiceLayer: \"TileLayer\",\n  BingMapsAerial: \"BingMapsLayer\",\n  BingMapsRoad: \"BingMapsLayer\",\n  BingMapsHybrid: \"BingMapsLayer\",\n  CSV: \"CSVLayer\",\n  DefaultTileLayer: \"TileLayer\",\n  GeoRSS: \"GeoRSSLayer\",\n  GroupLayer: \"GroupLayer\",\n  KML: \"KMLLayer\",\n  OGCFeatureLayer: \"OGCFeatureLayer\",\n  SubtypeGroupLayer: \"UnsupportedLayer\",\n  VectorTileLayer: \"VectorTileLayer\",\n  WFS: \"WFSLayer\",\n  WMS: \"WMSLayer\",\n  WebTiledLayer: \"WebTileLayer\"\n},\n      S = {\n  ArcGISFeatureLayer: \"FeatureLayer\"\n},\n      u = {\n  ArcGISImageServiceLayer: \"ImageryLayer\",\n  ArcGISImageServiceVectorLayer: \"ImageryLayer\",\n  ArcGISMapServiceLayer: \"MapImageLayer\",\n  ArcGISTiledImageServiceLayer: \"ImageryTileLayer\",\n  ArcGISTiledMapServiceLayer: \"TileLayer\",\n  OpenStreetMap: \"OpenStreetMapLayer\",\n  VectorTileLayer: \"VectorTileLayer\",\n  WebTiledLayer: \"WebTileLayer\",\n  BingMapsAerial: \"BingMapsLayer\",\n  BingMapsRoad: \"BingMapsLayer\",\n  BingMapsHybrid: \"BingMapsLayer\",\n  WMS: \"WMSLayer\",\n  DefaultTileLayer: \"TileLayer\"\n};\n\nasync function I(e, r) {\n  return d(await T(e, r), e, r);\n}\n\nasync function d(e, r, a) {\n  const t = new e();\n  return t.read(r, a.context), \"group\" === t.type && m(r) && (await G(t, r, a.context)), await o(t, a.context), t;\n}\n\nasync function T(e, r) {\n  const o = r.context,\n        n = g(o);\n  let l = e.layerType || e.type;\n  !l && r && r.defaultLayerType && (l = r.defaultLayerType);\n  const c = n[l];\n  let s = c ? a[c] : a.UnknownLayer;\n  const p = o && o.portal;\n\n  if (f(e)) {\n    if (e.itemId) {\n      const r = new t({\n        id: e.itemId,\n        portal: p\n      });\n      await r.load();\n      const y = (await L(r)).className || \"UnknownLayer\";\n      s = a[y];\n    }\n  } else \"ArcGISFeatureLayer\" === l ? (await y(e, p)) ? s = a.MapNotesLayer : (await i(e, p)) ? s = a.RouteLayer : m(e) && (s = a.GroupLayer) : e.wmtsInfo && e.wmtsInfo.url && e.wmtsInfo.layerIdentifier ? s = a.WMTSLayer : \"WFS\" === l && \"2.0.0\" !== e.wfsInfo.version && (s = a.UnsupportedLayer);\n\n  return s();\n}\n\nfunction m(e) {\n  if (\"ArcGISFeatureLayer\" !== e.layerType || f(e)) return !1;\n  const r = e.featureCollection;\n  return !!(r && r.layers && r.layers.length > 1);\n}\n\nfunction f(e) {\n  return \"Feature Collection\" === e.type;\n}\n\nfunction g(e) {\n  let r;\n\n  switch (e.origin) {\n    case \"web-scene\":\n      switch (e.layerContainerType) {\n        case \"basemap\":\n          r = s;\n          break;\n\n        case \"ground\":\n          r = c;\n          break;\n\n        default:\n          r = l;\n      }\n\n      break;\n\n    default:\n      switch (e.layerContainerType) {\n        case \"basemap\":\n          r = u;\n          break;\n\n        case \"tables\":\n          r = S;\n          break;\n\n        default:\n          r = p;\n      }\n\n  }\n\n  return r;\n}\n\nasync function M(r, a, t) {\n  const y = new e(),\n        i = n(y, Array.isArray(a.layers) ? a.layers : [], t),\n        L = await r;\n  if (await i, \"group\" === L.type) return L.layers.addMany(y), L;\n}\n\nasync function G(e, r, t) {\n  const y = a.FeatureLayer,\n        i = await y(),\n        L = r.featureCollection,\n        o = L.showLegend,\n        n = L.layers.map(e => {\n    const r = new i();\n    return r.read(e, t), null != o && r.read({\n      showLegend: o\n    }, t), r;\n  });\n  e.layers.addMany(n);\n}\n\nexport { n as populateOperationalLayers };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/support/layersCreator.js"],"names":["e","eachAlways","r","layerLookupMap","a","t","isMapNotesLayer","y","isRouteLayer","i","selectLayerClassPath","L","loadStyleRenderer","o","n","I","layerType","push","M","value","filter","add","l","ArcGISFeatureLayer","ArcGISImageServiceLayer","ArcGISMapServiceLayer","PointCloudLayer","ArcGISSceneServiceLayer","IntegratedMeshLayer","BuildingSceneLayer","ArcGISTiledElevationServiceLayer","ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","GroupLayer","WebTiledLayer","CSV","VectorTileLayer","WMS","DefaultTileLayer","KML","RasterDataLayer","c","RasterDataElevationLayer","s","OpenStreetMap","p","ArcGISImageServiceVectorLayer","ArcGISStreamLayer","BingMapsAerial","BingMapsRoad","BingMapsHybrid","GeoRSS","OGCFeatureLayer","SubtypeGroupLayer","WFS","S","u","d","T","read","context","type","m","G","g","defaultLayerType","UnknownLayer","portal","f","itemId","id","load","className","MapNotesLayer","RouteLayer","wmtsInfo","url","layerIdentifier","WMTSLayer","wfsInfo","version","UnsupportedLayer","featureCollection","layers","length","origin","layerContainerType","Array","isArray","addMany","FeatureLayer","showLegend","map","populateOperationalLayers"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Collection.js\";import\"../../core/has.js\";import{eachAlways as r}from\"../../core/promiseUtils.js\";import{layerLookupMap as a}from\"./lazyLayerLoader.js\";import t from\"../../portal/PortalItem.js\";import{isMapNotesLayer as y,isRouteLayer as i}from\"../../portal/support/featureCollectionUtils.js\";import{selectLayerClassPath as L}from\"../../portal/support/portalLayers.js\";import{loadStyleRenderer as o}from\"../../renderers/support/styleUtils.js\";async function n(e,a,t){if(!a)return;const y=[];for(const r of a){const e=I(r,t);\"GroupLayer\"===r.layerType?y.push(M(e,r,t)):y.push(e)}const i=await r(y);for(const r of i)!r.value||t.filter&&!t.filter(r.value)||e.add(r.value)}const l={ArcGISFeatureLayer:\"FeatureLayer\",ArcGISImageServiceLayer:\"ImageryLayer\",ArcGISMapServiceLayer:\"MapImageLayer\",PointCloudLayer:\"PointCloudLayer\",ArcGISSceneServiceLayer:\"SceneLayer\",IntegratedMeshLayer:\"IntegratedMeshLayer\",BuildingSceneLayer:\"BuildingSceneLayer\",ArcGISTiledElevationServiceLayer:\"ElevationLayer\",ArcGISTiledImageServiceLayer:\"ImageryTileLayer\",ArcGISTiledMapServiceLayer:\"TileLayer\",GroupLayer:\"GroupLayer\",WebTiledLayer:\"WebTileLayer\",CSV:\"CSVLayer\",VectorTileLayer:\"VectorTileLayer\",WMS:\"WMSLayer\",DefaultTileLayer:\"TileLayer\",KML:\"KMLLayer\",RasterDataLayer:\"UnsupportedLayer\"},c={ArcGISTiledElevationServiceLayer:\"ElevationLayer\",DefaultTileLayer:\"ElevationLayer\",RasterDataElevationLayer:\"UnsupportedLayer\"},s={ArcGISTiledMapServiceLayer:\"TileLayer\",ArcGISTiledImageServiceLayer:\"ImageryTileLayer\",OpenStreetMap:\"OpenStreetMapLayer\",WebTiledLayer:\"WebTileLayer\",VectorTileLayer:\"VectorTileLayer\",ArcGISImageServiceLayer:\"UnsupportedLayer\",WMS:\"UnsupportedLayer\",ArcGISMapServiceLayer:\"UnsupportedLayer\",DefaultTileLayer:\"TileLayer\"},p={ArcGISFeatureLayer:\"FeatureLayer\",ArcGISImageServiceLayer:\"ImageryLayer\",ArcGISImageServiceVectorLayer:\"ImageryLayer\",ArcGISMapServiceLayer:\"MapImageLayer\",ArcGISStreamLayer:\"StreamLayer\",ArcGISTiledImageServiceLayer:\"ImageryTileLayer\",ArcGISTiledMapServiceLayer:\"TileLayer\",BingMapsAerial:\"BingMapsLayer\",BingMapsRoad:\"BingMapsLayer\",BingMapsHybrid:\"BingMapsLayer\",CSV:\"CSVLayer\",DefaultTileLayer:\"TileLayer\",GeoRSS:\"GeoRSSLayer\",GroupLayer:\"GroupLayer\",KML:\"KMLLayer\",OGCFeatureLayer:\"OGCFeatureLayer\",SubtypeGroupLayer:\"UnsupportedLayer\",VectorTileLayer:\"VectorTileLayer\",WFS:\"WFSLayer\",WMS:\"WMSLayer\",WebTiledLayer:\"WebTileLayer\"},S={ArcGISFeatureLayer:\"FeatureLayer\"},u={ArcGISImageServiceLayer:\"ImageryLayer\",ArcGISImageServiceVectorLayer:\"ImageryLayer\",ArcGISMapServiceLayer:\"MapImageLayer\",ArcGISTiledImageServiceLayer:\"ImageryTileLayer\",ArcGISTiledMapServiceLayer:\"TileLayer\",OpenStreetMap:\"OpenStreetMapLayer\",VectorTileLayer:\"VectorTileLayer\",WebTiledLayer:\"WebTileLayer\",BingMapsAerial:\"BingMapsLayer\",BingMapsRoad:\"BingMapsLayer\",BingMapsHybrid:\"BingMapsLayer\",WMS:\"WMSLayer\",DefaultTileLayer:\"TileLayer\"};async function I(e,r){return d(await T(e,r),e,r)}async function d(e,r,a){const t=new e;return t.read(r,a.context),\"group\"===t.type&&m(r)&&await G(t,r,a.context),await o(t,a.context),t}async function T(e,r){const o=r.context,n=g(o);let l=e.layerType||e.type;!l&&r&&r.defaultLayerType&&(l=r.defaultLayerType);const c=n[l];let s=c?a[c]:a.UnknownLayer;const p=o&&o.portal;if(f(e)){if(e.itemId){const r=new t({id:e.itemId,portal:p});await r.load();const y=(await L(r)).className||\"UnknownLayer\";s=a[y]}}else\"ArcGISFeatureLayer\"===l?await y(e,p)?s=a.MapNotesLayer:await i(e,p)?s=a.RouteLayer:m(e)&&(s=a.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?s=a.WMTSLayer:\"WFS\"===l&&\"2.0.0\"!==e.wfsInfo.version&&(s=a.UnsupportedLayer);return s()}function m(e){if(\"ArcGISFeatureLayer\"!==e.layerType||f(e))return!1;const r=e.featureCollection;return!!(r&&r.layers&&r.layers.length>1)}function f(e){return\"Feature Collection\"===e.type}function g(e){let r;switch(e.origin){case\"web-scene\":switch(e.layerContainerType){case\"basemap\":r=s;break;case\"ground\":r=c;break;default:r=l}break;default:switch(e.layerContainerType){case\"basemap\":r=u;break;case\"tables\":r=S;break;default:r=p}}return r}async function M(r,a,t){const y=new e,i=n(y,Array.isArray(a.layers)?a.layers:[],t),L=await r;if(await i,\"group\"===L.type)return L.layers.addMany(y),L}async function G(e,r,t){const y=a.FeatureLayer,i=await y(),L=r.featureCollection,o=L.showLegend,n=L.layers.map((e=>{const r=new i;return r.read(e,t),null!=o&&r.read({showLegend:o},t),r}));e.layers.addMany(n)}export{n as populateOperationalLayers};\n"]},"metadata":{},"sourceType":"module"}