{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../request.js\";\nimport t from \"../../core/Error.js\";\nimport { get as r, isSome as a, isNone as o } from \"../../core/maybe.js\";\nimport { join as s, getPathExtension as n } from \"../../core/urlUtils.js\";\n\nasync function c(e, t = {}, a) {\n  await e.load(a);\n  const o = s(e.itemUrl, \"resources\"),\n        {\n    start: n = 1,\n    num: c = 10,\n    sortOrder: u = \"asc\",\n    sortField: i = \"created\"\n  } = t,\n        l = {\n    query: {\n      start: n,\n      num: c,\n      sortOrder: u,\n      sortField: i,\n      token: e.apiKey\n    },\n    signal: r(a, \"signal\")\n  },\n        p = await e.portal._request(o, l);\n  return {\n    total: p.total,\n    nextStart: p.nextStart,\n    resources: p.resources.map(({\n      created: t,\n      size: r,\n      resource: a\n    }) => ({\n      created: new Date(t),\n      size: r,\n      resource: e.resourceFromPath(a)\n    }))\n  };\n}\n\nasync function u(e, o, n, c) {\n  if (!e.hasPath()) throw new t(`portal-item-resource-${o}:invalid-path`, \"Resource does not have a valid path\");\n  const u = e.portalItem;\n  await u.load(c);\n  const i = s(u.userItemUrl, \"add\" === o ? \"addResources\" : \"updateResources\"),\n        [l, d] = p(e.path),\n        m = await h(n),\n        f = new FormData();\n  return l && \".\" !== l && f.append(\"resourcesPrefix\", l), f.append(\"fileName\", d), f.append(\"file\", m, d), f.append(\"f\", \"json\"), a(c) && c.access && f.append(\"access\", c.access), await u.portal._request(i, {\n    method: \"post\",\n    body: f,\n    signal: r(c, \"signal\")\n  }), e;\n}\n\nasync function i(e, a, o) {\n  if (!a.hasPath()) throw new t(\"portal-item-resources-remove:invalid-path\", \"Resource does not have a valid path\");\n  await e.load(o);\n  const n = s(e.userItemUrl, \"removeResources\");\n  await e.portal._request(n, {\n    method: \"post\",\n    query: {\n      resource: a.path\n    },\n    signal: r(o, \"signal\")\n  }), a.portalItem = null;\n}\n\nasync function l(e, t) {\n  await e.load(t);\n  const a = s(e.userItemUrl, \"removeResources\");\n  return e.portal._request(a, {\n    method: \"post\",\n    query: {\n      deleteAll: !0\n    },\n    signal: r(t, \"signal\")\n  });\n}\n\nfunction p(e) {\n  const t = e.lastIndexOf(\"/\");\n  return -1 === t ? [\".\", e] : [e.slice(0, t), e.slice(t + 1)];\n}\n\nfunction d(e) {\n  const [t, r] = m(e),\n        [a, o] = p(t);\n  return [a, o, r];\n}\n\nfunction m(e) {\n  const t = n(e);\n  return o(t) ? [e, \"\"] : [e.slice(0, e.length - t.length - 1), `.${t}`];\n}\n\nasync function h(t) {\n  if (t instanceof Blob) return t;\n  return (await e(t.url, {\n    responseType: \"blob\"\n  })).data;\n}\n\nfunction f(e, t) {\n  if (!e.hasPath()) return null;\n  const [r,, a] = d(e.path);\n  return e.portalItem.resourceFromPath(s(r, t + a));\n}\n\nfunction w(e, t) {\n  if (!e.hasPath()) return null;\n  const [r,, a] = d(e.path);\n  return e.portalItem.resourceFromPath(s(r, t + a));\n}\n\nexport { u as addOrUpdateResource, h as contentToBlob, c as fetchResources, f as getSiblingOfSameType, w as getSiblingOfSameTypeI, l as removeAllResources, i as removeResource, d as splitPrefixFileNameAndExtension };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/portal/support/resourceUtils.js"],"names":["e","t","get","r","isSome","a","isNone","o","join","s","getPathExtension","n","c","load","itemUrl","start","num","sortOrder","u","sortField","i","l","query","token","apiKey","signal","p","portal","_request","total","nextStart","resources","map","created","size","resource","Date","resourceFromPath","hasPath","portalItem","userItemUrl","d","path","m","h","f","FormData","append","access","method","body","deleteAll","lastIndexOf","slice","length","Blob","url","responseType","data","w","addOrUpdateResource","contentToBlob","fetchResources","getSiblingOfSameType","getSiblingOfSameTypeI","removeAllResources","removeResource","splitPrefixFileNameAndExtension"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import t from\"../../core/Error.js\";import{get as r,isSome as a,isNone as o}from\"../../core/maybe.js\";import{join as s,getPathExtension as n}from\"../../core/urlUtils.js\";async function c(e,t={},a){await e.load(a);const o=s(e.itemUrl,\"resources\"),{start:n=1,num:c=10,sortOrder:u=\"asc\",sortField:i=\"created\"}=t,l={query:{start:n,num:c,sortOrder:u,sortField:i,token:e.apiKey},signal:r(a,\"signal\")},p=await e.portal._request(o,l);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((({created:t,size:r,resource:a})=>({created:new Date(t),size:r,resource:e.resourceFromPath(a)})))}}async function u(e,o,n,c){if(!e.hasPath())throw new t(`portal-item-resource-${o}:invalid-path`,\"Resource does not have a valid path\");const u=e.portalItem;await u.load(c);const i=s(u.userItemUrl,\"add\"===o?\"addResources\":\"updateResources\"),[l,d]=p(e.path),m=await h(n),f=new FormData;return l&&\".\"!==l&&f.append(\"resourcesPrefix\",l),f.append(\"fileName\",d),f.append(\"file\",m,d),f.append(\"f\",\"json\"),a(c)&&c.access&&f.append(\"access\",c.access),await u.portal._request(i,{method:\"post\",body:f,signal:r(c,\"signal\")}),e}async function i(e,a,o){if(!a.hasPath())throw new t(\"portal-item-resources-remove:invalid-path\",\"Resource does not have a valid path\");await e.load(o);const n=s(e.userItemUrl,\"removeResources\");await e.portal._request(n,{method:\"post\",query:{resource:a.path},signal:r(o,\"signal\")}),a.portalItem=null}async function l(e,t){await e.load(t);const a=s(e.userItemUrl,\"removeResources\");return e.portal._request(a,{method:\"post\",query:{deleteAll:!0},signal:r(t,\"signal\")})}function p(e){const t=e.lastIndexOf(\"/\");return-1===t?[\".\",e]:[e.slice(0,t),e.slice(t+1)]}function d(e){const[t,r]=m(e),[a,o]=p(t);return[a,o,r]}function m(e){const t=n(e);return o(t)?[e,\"\"]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function h(t){if(t instanceof Blob)return t;return(await e(t.url,{responseType:\"blob\"})).data}function f(e,t){if(!e.hasPath())return null;const[r,,a]=d(e.path);return e.portalItem.resourceFromPath(s(r,t+a))}function w(e,t){if(!e.hasPath())return null;const[r,,a]=d(e.path);return e.portalItem.resourceFromPath(s(r,t+a))}export{u as addOrUpdateResource,h as contentToBlob,c as fetchResources,f as getSiblingOfSameType,w as getSiblingOfSameTypeI,l as removeAllResources,i as removeResource,d as splitPrefixFileNameAndExtension};\n"]},"metadata":{},"sourceType":"module"}