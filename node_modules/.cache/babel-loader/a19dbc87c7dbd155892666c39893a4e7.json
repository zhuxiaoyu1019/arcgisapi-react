{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport \"../../../../core/has.js\";\nimport { isSome as t, isNone as r, get as o } from \"../../../../core/maybe.js\";\nimport { f as a, t as s } from \"../../../../chunks/mat3.js\";\nimport { c as n } from \"../../../../chunks/mat3f64.js\";\nimport { q as i, m as l, a as c } from \"../../../../chunks/mat4.js\";\nimport { b as u, c as m } from \"../../../../chunks/mat4f64.js\";\nimport { b as h, a as p, d as f, n as d, f as g, c as x } from \"../../../../chunks/vec3.js\";\nimport { Z as _, O as y, c as b } from \"../../../../chunks/vec3f64.js\";\nimport { O as v } from \"../../../../chunks/vec4f64.js\";\nimport { projectVectorToDehydratedPoint as T, projectBuffer as C, computeLinearTransformation as w, canProjectWithoutEngine as A } from \"../../../../geometry/projection.js\";\nimport { empty as M, expandWithBuffer as j, intersectsClippingArea as P, create as B } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport R from \"../../../../geometry/support/MeshComponent.js\";\nimport E from \"../../../../geometry/support/MeshMaterialMetallicRoughness.js\";\nimport { BufferViewVec3f64 as F, BufferViewVec3f as O } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { t as I, a as S } from \"../../../../chunks/vec32.js\";\nimport { transformPosition as N, transformNormal as V, projectNormalToPCPF as U, transformTangent as L, projectTangentToPCPF as G } from \"../../../../geometry/support/meshUtils/projection.js\";\nimport { makeDehydratedPoint as $ } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nimport { perObjectElevationAligner as D } from \"./ElevationAligners.js\";\nimport { needsElevationUpdates3D as z } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as k } from \"./ElevationContext.js\";\nimport { Graphics3DObject3DGraphicLayer as H } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as q } from \"./Graphics3DSymbolLayer.js\";\nimport { createMaterial as W } from \"../support/edgeUtils.js\";\nimport { parseColorMixMode as Y, encodeSymbolColor as Z } from \"../support/symbolColorUtils.js\";\nimport J from \"../../support/debugFlags.js\";\nimport { Geometry as K } from \"../../webgl-engine/lib/Geometry.js\";\nimport { generateDefaultIndexArray as Q } from \"../../webgl-engine/lib/geometryDataUtils.js\";\nimport { Object3D as X } from \"../../webgl-engine/lib/Object3D.js\";\nimport { Texture as ee } from \"../../webgl-engine/lib/Texture.js\";\nimport { DefaultMaterial as te } from \"../../webgl-engine/materials/DefaultMaterial.js\";\nimport { NativeLineMaterial as re } from \"../../webgl-engine/materials/NativeLineMaterial.js\";\nconst oe = [\"mesh\"];\n\nclass ae extends q {\n  constructor(e, t, r, o) {\n    super(e, t, r, o), this._materials = new Map(), this._textures = new Map(), this.ensureDrapedStatus(!1);\n  }\n\n  async doLoad() {\n    J.DRAW_MESH_GEOMETRY_NORMALS && (this._debugVertexNormalMaterial = new re({\n      color: [1, 0, 1, 1]\n    }), this._debugFaceNormalMaterial = new re({\n      color: [0, 1, 1, 1]\n    }));\n  }\n\n  destroy() {\n    super.destroy(), this._context.stage.removeMany(Array.from(this._materials.values(), e => e.material)), this._context.stage.removeMany(Array.from(this._textures.values())), this._materials.clear(), this._textures.clear();\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry, oe, \"fill on mesh-3d\")) return null;\n    const r = this.setGraphicElevationContext(t, new k()),\n          o = e.renderingInfo;\n    return this._createAs3DShape(t, o, r, t.uid);\n  }\n\n  layerOpacityChanged(e, r) {\n    const o = this._getLayerOpacity();\n\n    return this._materials.forEach(e => {\n      e.material.setParameterValues({\n        layerOpacity: o\n      });\n      const t = e.material.params;\n      this._setMaterialTransparentParameter(t, e), e.material.setParameterValues({\n        transparent: t.transparent\n      });\n    }), e.forEach(e => {\n      const a = r(e);\n      t(a) && a.layerOpacityChanged(o, this._context.isAsync);\n    }), !0;\n  }\n\n  layerElevationInfoChanged(e, t) {\n    return this.updateGraphics3DGraphicElevationInfo(e, t, z);\n  }\n\n  slicePlaneEnabledChanged(e, r) {\n    return this._materials.forEach(e => {\n      e.material.setParameterValues({\n        slicePlaneEnabled: this._context.slicePlaneEnabled\n      });\n    }), e.forEach(e => {\n      const o = r(e);\n      t(o) && o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled, this._context.isAsync);\n    }), !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    const e = this._usePBR();\n\n    return this._materials.forEach(t => t.material.setParameterValues({\n      usePBR: e\n    })), !0;\n  }\n\n  pixelRatioChanged() {\n    return !0;\n  }\n\n  _requiresSymbolVertexColors() {\n    return this._drivenProperties.color || this._drivenProperties.opacity;\n  }\n\n  _colorOrTextureUid(t) {\n    return r(t) ? \"-\" : t instanceof e ? t.toHex() : t.contentHash;\n  }\n\n  _materialPropertiesDefault(e, t) {\n    const r = this._requiresSymbolVertexColors(),\n          o = !!e.vertexAttributes.color,\n          a = !!e.vertexAttributes.tangent;\n\n    return {\n      hasSymbolVertexColors: r,\n      hasVertexColors: o,\n      hasVertexTangents: a,\n      uid: `vc:${o},vt:${a},vct${t},svc:${r}`\n    };\n  }\n\n  _materialProperties(e, t, r) {\n    const o = this._materialPropertiesDefault(e, r);\n\n    if (!t.material) return o;\n\n    const {\n      color: a,\n      colorTexture: s,\n      normalTexture: n,\n      doubleSided: i,\n      alphaCutoff: l,\n      alphaMode: c\n    } = t.material,\n          u = this._colorOrTextureUid(a),\n          m = this._colorOrTextureUid(s),\n          h = this._colorOrTextureUid(n);\n\n    if (o.color = a, o.colorTexture = s, o.normalTexture = n, o.uid = `${o.uid},cmuid:${u},ctmuid:${m},ntmuid:${h},ds:${i},ac:${l},am:${c}`, t.material instanceof E) {\n      const {\n        metallic: e,\n        roughness: r,\n        metallicRoughnessTexture: a,\n        emissiveColor: s,\n        emissiveTexture: n,\n        occlusionTexture: i\n      } = t.material,\n            l = this._colorOrTextureUid(a),\n            c = this._colorOrTextureUid(s),\n            u = this._colorOrTextureUid(n),\n            m = this._colorOrTextureUid(i);\n\n      o.metallic = e, o.roughness = r, o.metallicRoughnessTexture = a, o.emissiveColor = s, o.emissiveTexture = n, o.occlusionTexture = i, o.uid = `${o.uid},mrm:${e},mrr:${r},mrt:${l},emuid:${c},etmuid:${u},otmuid:${m}`;\n    }\n\n    return o;\n  }\n\n  _setInternalColorValueParameters(t, r) {\n    r.diffuse = e.toUnitRGB(t), r.opacity = t.a;\n  }\n\n  _getLoadableTextureResource(e) {\n    return e.data ? e.data : e.url;\n  }\n\n  _getInternalTextureId(e) {\n    const t = this._getLoadableTextureResource(e);\n\n    if (!t) return;\n    const r = e.contentHash;\n\n    let o = this._textures.get(r);\n\n    return o || (o = new ee(t, {\n      mipmap: !0,\n      wrap: this._castTextureWrap(e.wrap),\n      noUnpackFlip: !0,\n      preMultiplyAlpha: !0\n    }), this._textures.set(r, o), this._context.stage.add(o)), o.id;\n  }\n\n  _castTextureWrap(e = \"repeat\") {\n    if (\"string\" == typeof e) {\n      const t = this._castTextureWrapIndividual(e);\n\n      return {\n        s: t,\n        t\n      };\n    }\n\n    return {\n      s: this._castTextureWrapIndividual(e.horizontal),\n      t: this._castTextureWrapIndividual(e.vertical)\n    };\n  }\n\n  _castTextureWrapIndividual(e) {\n    switch (e) {\n      case \"clamp\":\n        return 33071;\n\n      case \"mirror\":\n        return 33648;\n\n      case \"repeat\":\n      default:\n        return 10497;\n    }\n  }\n\n  _setInternalMaterialParameters(r, o) {\n    t(r.color) && this._setInternalColorValueParameters(r.color, o), t(r.colorTexture) && (o.textureId = this._getInternalTextureId(r.colorTexture)), t(r.normalTexture) && (o.normalTextureId = this._getInternalTextureId(r.normalTexture)), t(r.emissiveColor) && (o.emissiveFactor = e.toUnitRGB(r.emissiveColor)), t(r.emissiveTexture) && (o.emissiveTextureId = this._getInternalTextureId(r.emissiveTexture)), t(r.occlusionTexture) && (o.occlusionTextureId = this._getInternalTextureId(r.occlusionTexture)), t(r.metallicRoughnessTexture) && (o.metallicRoughnessTextureId = this._getInternalTextureId(r.metallicRoughnessTexture));\n  }\n\n  _setExternalMaterialParameters(r) {\n    const o = this._drivenProperties.color;\n    let a = t(this.symbolLayer.material) ? this.symbolLayer.material.colorMixMode : null;\n    if (o) r.externalColor = v;else {\n      const o = t(this.symbolLayer.material) ? this.symbolLayer.material.color : null;\n      t(o) ? r.externalColor = e.toUnitRGBA(o) : (a = null, r.externalColor = v);\n    }\n    a && (r.colorMixMode = a), r.castShadows = !!this.symbolLayer.castShadows;\n  }\n\n  _hasTransparentVertexColors(e) {\n    const t = e.vertexAttributes.color;\n    if (r(t)) return !1;\n\n    for (let r = 3; r < t.length; r += 4) if (255 !== t[r]) return !0;\n\n    return !1;\n  }\n\n  _getOrCreateMaterial(e, r) {\n    const o = r.material && r.material.color,\n          a = r.material && r.material.colorTexture,\n          s = r.material && \"blend\" === r.material.alphaMode,\n          n = !(r.material && \"opaque\" === r.material.alphaMode) && (this._hasTransparentVertexColors(e) || t(o) && o.a < 1 || t(a) && a.transparent || s),\n          i = this._materialProperties(e, r, n),\n          l = this._materials.get(i.uid);\n\n    if (l) return l.material;\n    const c = {\n      material: null,\n      isComponentTransparent: n,\n      alphaMode: r.material ? r.material.alphaMode : \"opaque\"\n    },\n          u = null == i.metallicRoughnessTexture && null == i.metallic && null == i.roughness,\n          m = {\n      usePBR: this._usePBR(),\n      isSchematic: u,\n      vertexColors: i.hasVertexColors,\n      symbolColors: i.hasSymbolVertexColors,\n      vertexTangents: i.hasVertexTangents,\n      ambient: _,\n      diffuse: y,\n      opacity: 1,\n      doubleSided: !0,\n      doubleSidedType: \"winding-order\",\n      cullFace: 0,\n      textureAlphaPremultiplied: !0,\n      layerOpacity: this._getLayerOpacity(),\n      slicePlaneEnabled: this._context.slicePlaneEnabled,\n      initTextureTransparent: !0\n    };\n    u || (m.mrrFactors = [null != i.metallic ? i.metallic : 1, null != i.roughness ? i.roughness : 1, .5]), r.material && (m.doubleSided = r.material.doubleSided, m.cullFace = r.material.doubleSided ? 0 : 2, m.textureAlphaCutoff = r.material.alphaCutoff), this._setInternalMaterialParameters(i, m), this._setExternalMaterialParameters(m), this._setMaterialTransparentParameter(m, c);\n    const h = new te(m);\n    return c.material = h, this._materials.set(i.uid, c), this._context.stage.add(h), h;\n  }\n\n  _usePBR() {\n    return this._context.physicalBasedRenderingEnabled;\n  }\n\n  _setMaterialTransparentParameter(e, t) {\n    e.transparent = this.needsDrivenTransparentPass || t.isComponentTransparent || e.layerOpacity < 1 || e.opacity < 1 || e.externalColor && e.externalColor[3] < 1, \"auto\" === t.alphaMode ? e.textureAlphaMode = e.transparent ? 3 : 1 : e.textureAlphaMode = \"opaque\" === t.alphaMode ? 1 : \"mask\" === t.alphaMode ? 2 : 0;\n  }\n\n  _addDebugNormals(e, t, r, o) {\n    const a = t.length,\n          s = e.spatialReference.isGeographic ? 20015077 / 180 : 1,\n          n = .1 * Math.max(e.extent.width * s, e.extent.height * s, e.extent.zmax - e.extent.zmin),\n          i = [],\n          l = [],\n          c = [],\n          m = [];\n\n    for (let u = 0; u < a; u++) {\n      const e = t[u],\n            r = e.vertexAttributes.get(\"position\"),\n            o = e.vertexAttributes.get(\"normal\"),\n            a = e.indices.get(\"position\"),\n            s = e.indices.get(\"normal\"),\n            f = r.data,\n            d = o.data;\n\n      for (let t = 0; t < a.length; t++) {\n        const e = 3 * a[t],\n              r = 3 * s[t];\n\n        for (let t = 0; t < 3; t++) i.push(f[e + t]);\n\n        for (let t = 0; t < 3; t++) i.push(f[e + t] + d[r + t] * n);\n\n        if (l.push(l.length), l.push(l.length), t % 3 == 0) {\n          this._calculateFaceNormal(f, a, t, ce), this._getFaceVertices(f, a, t, ne, ie, le), h(ne, ne, ie), h(ne, ne, le), p(ne, ne, 1 / 3);\n\n          for (let e = 0; e < 3; e++) c.push(ne[e]);\n\n          for (let e = 0; e < 3; e++) c.push(ne[e] + ce[e] * n);\n\n          m.push(m.length), m.push(m.length);\n        }\n      }\n    }\n\n    const f = new K([[\"position\", {\n      data: i,\n      size: 3,\n      exclusive: !0\n    }]], [[\"position\", new Uint32Array(l)]], 2);\n    t.push(f), r.push(this._debugVertexNormalMaterial), o.push(u(o[0]));\n    const d = new K([[\"position\", {\n      data: c,\n      size: 3,\n      exclusive: !0\n    }]], [[\"position\", new Uint32Array(m)]], 2);\n    t.push(d), r.push(this._debugFaceNormalMaterial), o.push(u(o[0]));\n  }\n\n  _createAs3DShape(e, r, o, a) {\n    const s = e.geometry;\n    if (\"mesh\" !== s.type) return null;\n\n    const n = this._createGeometryInfo(s, r);\n\n    if (!n) return null;\n    const {\n      geometries: i,\n      materials: l,\n      transformations: c,\n      objectTransformation: u\n    } = n;\n    J.DRAW_MESH_GEOMETRY_NORMALS && this._addDebugNormals(s, i, l, c);\n    const m = new X({\n      geometries: i,\n      materials: l,\n      transformations: c,\n      metadata: {\n        layerUid: this._context.layer.uid,\n        graphicUid: a\n      }\n    });\n    m.transformation = u;\n\n    const h = D,\n          p = this._createEdgeMaterial(),\n          f = t(p) ? {\n      baseMaterial: l[0],\n      edgeMaterials: [p],\n      properties: {\n        mergeGeometries: !0,\n        slicePlaneEnabled: this._context.slicePlaneEnabled\n      }\n    } : null,\n          d = new H(this, m, i, null, null, h, o, f);\n\n    return d.needsElevationUpdates = z(o.mode), d.useObjectOriginAsAttachmentOrigin = !0, d.elevationContext.centerPointInElevationSR = this.getCenterPointInElevationSR(m), d.alignedSampledElevation = h(d, d.elevationContext, this._context.elevationProvider, this._context.renderCoordsHelper), d;\n  }\n\n  getCenterPointInElevationSR(e) {\n    const t = $(0, 0, 0, this._context.elevationProvider.spatialReference);\n    return T([e.transformation[12], e.transformation[13], e.transformation[14]], this._context.renderCoordsHelper.spatialReference, t), t;\n  }\n\n  _createComponentNormals(e, t, r, o) {\n    switch (r.shading || \"flat\") {\n      case \"source\":\n        return this._createComponentNormalsSource(e, t, r, o);\n\n      case \"flat\":\n        return this._createComponentNormalsFlat(e, o);\n\n      case \"smooth\":\n        return this._createComponentNormalsSmooth(e, o);\n\n      default:\n        return;\n    }\n  }\n\n  _createComponentNormalsSource(e, t, o, a) {\n    if (r(t)) return this._createComponentNormalsFlat(e, a);\n    let s = !1;\n    if (!o.trustSourceNormals) for (let r = 0; r < a.length; r += 3) {\n      this._calculateFaceNormal(e, a, r, ce);\n\n      for (let e = 0; e < 3; e++) {\n        const o = 3 * a[r + e];\n        ne[0] = t[o + 0], ne[1] = t[o + 1], ne[2] = t[o + 2], f(ce, ne) < 0 && (t[o + 0] = -t[o + 0], t[o + 1] = -t[o + 1], t[o + 2] = -t[o + 2], s = !0);\n      }\n    }\n    return {\n      normals: t,\n      indices: a,\n      didFlipNormals: s\n    };\n  }\n\n  _createComponentNormalsFlat(e, t) {\n    const r = new Float32Array(t.length),\n          o = new Uint32Array(3 * t.length);\n\n    for (let a = 0; a < t.length; a += 3) {\n      const s = this._calculateFaceNormal(e, t, a, ce);\n\n      for (let e = 0; e < 3; e++) r[a + e] = s[e], o[a + e] = a / 3;\n    }\n\n    return {\n      normals: r,\n      indices: o,\n      didFlipNormals: !1\n    };\n  }\n\n  _createComponentNormalsSmooth(e, t) {\n    const r = {};\n\n    for (let s = 0; s < t.length; s += 3) {\n      const o = this._calculateFaceNormal(e, t, s, ce);\n\n      for (let e = 0; e < 3; e++) {\n        const a = t[s + e];\n        let n = r[a];\n        n || (n = {\n          normal: b(),\n          count: 0\n        }, r[a] = n), h(n.normal, n.normal, o), n.count++;\n      }\n    }\n\n    const o = new Float32Array(3 * t.length),\n          a = new Uint32Array(3 * t.length);\n\n    for (let s = 0; s < t.length; s++) {\n      const e = r[t[s]];\n      1 !== e.count && (d(e.normal, e.normal), e.count = 1);\n\n      for (let t = 0; t < 3; t++) o[3 * s + t] = e.normal[t];\n\n      a[s] = s;\n    }\n\n    return {\n      normals: o,\n      indices: a,\n      didFlipNormals: !1\n    };\n  }\n\n  _getFaceVertices(e, t, r, o, a, s) {\n    const n = 3 * t[r + 0],\n          i = 3 * t[r + 1],\n          l = 3 * t[r + 2];\n    o[0] = e[n + 0], o[1] = e[n + 1], o[2] = e[n + 2], a[0] = e[i + 0], a[1] = e[i + 1], a[2] = e[i + 2], s[0] = e[l + 0], s[1] = e[l + 1], s[2] = e[l + 2];\n  }\n\n  _calculateFaceNormal(e, t, r, o) {\n    return this._getFaceVertices(e, t, r, ne, ie, le), g(ie, ie, ne), g(le, le, ne), x(ne, ie, le), d(o, ne), o;\n  }\n\n  _getOrCreateComponents(e) {\n    return e.components ? e.components : pe;\n  }\n\n  _createPositionBuffer(e, r) {\n    let o = e.vertexAttributes.position;\n    const a = 1 === r.reprojection ? r.transformBeforeProject : null;\n    if (t(a) && (o = N(o, new Float64Array(o.length), a)), 0 === r.reprojection) return r.needsBufferCopy ? new Float64Array(o) : o;\n    const s = t(a) ? o : new Float64Array(o.length);\n    return C(o, e.spatialReference, 0, s, this._context.renderCoordsHelper.spatialReference, 0, o.length / 3), s;\n  }\n\n  _createNormalBuffer(e, o, a) {\n    let s = e.vertexAttributes.normal;\n    if (r(s)) return null;\n    const n = 1 === a.reprojection ? a.transformBeforeProject : null;\n    t(n) && (s = V(s, new Float32Array(s.length), n));\n    if (\"local\" === this._context.layerView.view.viewingMode || 0 === a.reprojection) return a.needsBufferCopy && e.vertexAttributes.normal === s ? new Float32Array(s) : s;\n    const i = e.vertexAttributes.position,\n          l = t(n) ? s : new Float32Array(s.length);\n    return U(s, i, o, e.spatialReference, l);\n  }\n\n  _createTangentBuffer(e, o, a) {\n    let s = e.vertexAttributes.tangent;\n    if (r(s)) return null;\n    const n = 1 === a.reprojection ? a.transformBeforeProject : null;\n    t(n) && (s = L(s, new Float32Array(s.length), n));\n    if (\"local\" === this._context.layerView.view.viewingMode || 0 === a.reprojection) return a.needsBufferCopy && e.vertexAttributes.normal === s ? new Float32Array(s) : s;\n    const i = e.vertexAttributes.position,\n          l = t(n) ? s : new Float32Array(s.length);\n    return G(s, i, o, e.spatialReference, l);\n  }\n\n  _createColorBuffer(e) {\n    return e.vertexAttributes.color;\n  }\n\n  _createSymbolColorBuffer(e) {\n    if (this._requiresSymbolVertexColors()) {\n      const t = this._getVertexOpacityAndColor(e),\n            r = Y(o(this.symbolLayer, \"material\", \"colorMixMode\")),\n            a = new Uint8Array(4);\n\n      return Z(t, r, a), a;\n    }\n\n    return null;\n  }\n\n  _createBuffers(e, r) {\n    const o = e.vertexAttributes && e.vertexAttributes.position;\n    if (!o) return this.logger.warn(\"Mesh geometry must contain position vertex attributes\"), null;\n    const a = e.vertexAttributes.normal,\n          s = e.vertexAttributes.uv,\n          n = e.vertexAttributes.tangent;\n    if (t(a) && a.length !== o.length) return this.logger.warn(\"Mesh normal vertex buffer must contain the same number of elements as the position buffer\"), null;\n    if (t(n) && n.length / 4 != o.length / 3) return this.logger.warn(\"Mesh tangent vertex buffer must contain the same number of elements as the position buffer\"), null;\n    if (t(s) && s.length / 2 != o.length / 3) return this.logger.warn(\"Mesh uv vertex buffer must contain the same number of elements as the position buffer\"), null;\n\n    const i = this._computeReprojectionInfo(e),\n          l = this._createPositionBuffer(e, i),\n          c = this._createColorBuffer(e),\n          u = this._createSymbolColorBuffer(r),\n          h = this._createNormalBuffer(e, l, i),\n          p = this._createTangentBuffer(e, l, i);\n\n    return {\n      positionBuffer: l,\n      normalBuffer: h,\n      tangentBuffer: p,\n      uvBuffer: s,\n      colorBuffer: c,\n      symbolColorBuffer: u,\n      objectTransformation: 0 === i.reprojection && t(i.objectTransformation) ? i.objectTransformation : this._transformOriginLocal(e, l, h, p),\n      geometryTransformation: 0 === i.reprojection && t(i.geometryTransformation) ? i.geometryTransformation : m()\n    };\n  }\n\n  _computeReprojectionInfo(e) {\n    const r = t(e.transform) && e.transform.geographic || 2 === this._context.renderCoordsHelper.viewingMode ? 0 : 1;\n    let o = null;\n\n    if (t(e.transform)) {\n      if (0 === r) {\n        const t = m();\n        w(e.spatialReference, e.transform.origin, t, this._context.renderCoordsHelper.spatialReference);\n        return {\n          reprojection: r,\n          objectTransformation: t,\n          geometryTransformation: u(e.transform.localMatrix),\n          needsBufferCopy: !1\n        };\n      }\n\n      return o = i(m(), e.transform.origin), l(o, o, e.transform.localMatrix), {\n        reprojection: r,\n        transformBeforeProject: o,\n        needsBufferCopy: !0\n      };\n    }\n\n    return {\n      reprojection: r,\n      needsBufferCopy: !0\n    };\n  }\n\n  _transformOriginLocal(e, r, o, n) {\n    const i = this._context.renderCoordsHelper.spatialReference,\n          l = e.anchor;\n    se[0] = l.x, se[1] = l.y, se[2] = l.z;\n    const u = m();\n    w(e.spatialReference, se, u, i);\n    const h = F.fromTypedArray(r);\n\n    if (c(ue, u), I(h, h, ue), t(o) || t(n)) {\n      if (a(me, u), s(me, me), t(o)) {\n        const e = O.fromTypedArray(o);\n        S(e, e, me);\n      }\n\n      if (t(n)) {\n        const e = O.fromTypedArray(n, 4 * n.BYTES_PER_ELEMENT);\n        S(e, e, me);\n      }\n    }\n\n    return u;\n  }\n\n  _validateFaces(e, t) {\n    const r = e.vertexAttributes.position.length / 3,\n          o = t.faces;\n\n    if (o) {\n      let e = -1;\n\n      for (let t = 0; t < o.length; t++) {\n        const r = o[t];\n        r > e && (e = r);\n      }\n\n      if (r <= e) return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`), !1;\n    } else if (r % 3 != 0) return this.logger.warn(\"Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)\"), !1;\n\n    return !0;\n  }\n\n  _getOrCreateFaces(e, t) {\n    return t.faces ? t.faces : Q(e.vertexAttributes.position.length / 3);\n  }\n\n  _isOutsideClippingArea(e) {\n    if (!this._context.clippingExtent) return !1;\n    const t = e.vertexAttributes && e.vertexAttributes.position;\n    if (!t) return !1;\n    const r = this._context.elevationProvider.spatialReference;\n    let o;\n    const a = t.length / 3;\n    return e.spatialReference.equals(r) ? o = t : (o = new Float64Array(t.length), C(e.vertexAttributes.position, e.spatialReference, 0, o, r, 0, a)), M(he), j(he, o, 0, a), !P(he, this._context.clippingExtent);\n  }\n\n  _createGeometryInfo(e, o) {\n    if (!A(e.spatialReference, this._context.layerView.view.spatialReference)) return this.logger.warn(\"Geometry spatial reference is not compatible with the view\"), null;\n    if (this._isOutsideClippingArea(e)) return null;\n\n    const a = this._createBuffers(e, o);\n\n    if (r(a)) return null;\n\n    const {\n      positionBuffer: s,\n      uvBuffer: n,\n      colorBuffer: i,\n      symbolColorBuffer: l,\n      normalBuffer: c,\n      tangentBuffer: u,\n      objectTransformation: m,\n      geometryTransformation: h\n    } = a,\n          p = this._getOrCreateComponents(e),\n          f = [],\n          d = [],\n          g = [];\n\n    let x = !1;\n\n    for (const r of p) {\n      if (!this._validateFaces(e, r)) return null;\n\n      const o = this._getOrCreateFaces(e, r);\n\n      if (0 === o.length) continue;\n\n      const a = this._createComponentNormals(s, c, r, o);\n\n      a.didFlipNormals && (x = !0);\n      const m = [[\"position\", {\n        size: 3,\n        data: s,\n        exclusive: !0\n      }], [\"normal\", {\n        size: 3,\n        data: a.normals,\n        exclusive: !0\n      }]],\n            p = [[\"position\", o], [\"normal\", a.indices]];\n      t(i) && (m.push([\"color\", {\n        size: 4,\n        data: i,\n        exclusive: !0\n      }]), p.push([\"color\", o])), t(l) && (m.push([\"symbolColor\", {\n        size: 4,\n        data: l,\n        exclusive: !0\n      }]), p.push([\"symbolColor\", new Uint16Array(o.length)])), t(n) && (m.push([\"uv0\", {\n        size: 2,\n        data: n,\n        exclusive: !0\n      }]), p.push([\"uv0\", o])), t(u) && (m.push([\"tangent\", {\n        size: 4,\n        data: u,\n        exclusive: !0\n      }]), p.push([\"tangent\", o]));\n\n      const _ = new K(m, p);\n\n      f.push(_), d.push(h), g.push(this._getOrCreateMaterial(e, r));\n    }\n\n    return x && this.logger.warn(\"Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.\"), {\n      geometries: f,\n      transformations: d,\n      materials: g,\n      objectTransformation: m\n    };\n  }\n\n  _createEdgeMaterial() {\n    const e = {\n      opacity: this._getLayerOpacity()\n    };\n    return W(this.symbolLayer, e);\n  }\n\n}\n\nconst se = b(),\n      ne = b(),\n      ie = b(),\n      le = b(),\n      ce = b(),\n      ue = m(),\n      me = n(),\n      he = B(),\n      pe = [new R()];\nexport default ae;\nexport { ae as Graphics3DMeshFillSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer.js"],"names":["e","isSome","t","isNone","r","get","o","f","a","s","c","n","q","i","m","l","b","u","h","p","d","g","x","Z","_","O","y","v","projectVectorToDehydratedPoint","T","projectBuffer","C","computeLinearTransformation","w","canProjectWithoutEngine","A","empty","M","expandWithBuffer","j","intersectsClippingArea","P","create","B","R","E","BufferViewVec3f64","F","BufferViewVec3f","I","S","transformPosition","N","transformNormal","V","projectNormalToPCPF","U","transformTangent","L","projectTangentToPCPF","G","makeDehydratedPoint","$","perObjectElevationAligner","D","needsElevationUpdates3D","z","ElevationContext","k","Graphics3DObject3DGraphicLayer","H","Graphics3DSymbolLayer","createMaterial","W","parseColorMixMode","Y","encodeSymbolColor","J","Geometry","K","generateDefaultIndexArray","Q","Object3D","X","Texture","ee","DefaultMaterial","te","NativeLineMaterial","re","oe","ae","constructor","_materials","Map","_textures","ensureDrapedStatus","doLoad","DRAW_MESH_GEOMETRY_NORMALS","_debugVertexNormalMaterial","color","_debugFaceNormalMaterial","destroy","_context","stage","removeMany","Array","from","values","material","clear","createGraphics3DGraphic","graphic","_validateGeometry","geometry","setGraphicElevationContext","renderingInfo","_createAs3DShape","uid","layerOpacityChanged","_getLayerOpacity","forEach","setParameterValues","layerOpacity","params","_setMaterialTransparentParameter","transparent","isAsync","layerElevationInfoChanged","updateGraphics3DGraphicElevationInfo","slicePlaneEnabledChanged","slicePlaneEnabled","physicalBasedRenderingChanged","_usePBR","usePBR","pixelRatioChanged","_requiresSymbolVertexColors","_drivenProperties","opacity","_colorOrTextureUid","toHex","contentHash","_materialPropertiesDefault","vertexAttributes","tangent","hasSymbolVertexColors","hasVertexColors","hasVertexTangents","_materialProperties","colorTexture","normalTexture","doubleSided","alphaCutoff","alphaMode","metallic","roughness","metallicRoughnessTexture","emissiveColor","emissiveTexture","occlusionTexture","_setInternalColorValueParameters","diffuse","toUnitRGB","_getLoadableTextureResource","data","url","_getInternalTextureId","mipmap","wrap","_castTextureWrap","noUnpackFlip","preMultiplyAlpha","set","add","id","_castTextureWrapIndividual","horizontal","vertical","_setInternalMaterialParameters","textureId","normalTextureId","emissiveFactor","emissiveTextureId","occlusionTextureId","metallicRoughnessTextureId","_setExternalMaterialParameters","symbolLayer","colorMixMode","externalColor","toUnitRGBA","castShadows","_hasTransparentVertexColors","length","_getOrCreateMaterial","isComponentTransparent","isSchematic","vertexColors","symbolColors","vertexTangents","ambient","doubleSidedType","cullFace","textureAlphaPremultiplied","initTextureTransparent","mrrFactors","textureAlphaCutoff","physicalBasedRenderingEnabled","needsDrivenTransparentPass","textureAlphaMode","_addDebugNormals","spatialReference","isGeographic","Math","max","extent","width","height","zmax","zmin","indices","push","_calculateFaceNormal","ce","_getFaceVertices","ne","ie","le","size","exclusive","Uint32Array","type","_createGeometryInfo","geometries","materials","transformations","objectTransformation","metadata","layerUid","layer","graphicUid","transformation","_createEdgeMaterial","baseMaterial","edgeMaterials","properties","mergeGeometries","needsElevationUpdates","mode","useObjectOriginAsAttachmentOrigin","elevationContext","centerPointInElevationSR","getCenterPointInElevationSR","alignedSampledElevation","elevationProvider","renderCoordsHelper","_createComponentNormals","shading","_createComponentNormalsSource","_createComponentNormalsFlat","_createComponentNormalsSmooth","trustSourceNormals","normals","didFlipNormals","Float32Array","normal","count","_getOrCreateComponents","components","pe","_createPositionBuffer","position","reprojection","transformBeforeProject","Float64Array","needsBufferCopy","_createNormalBuffer","layerView","view","viewingMode","_createTangentBuffer","_createColorBuffer","_createSymbolColorBuffer","_getVertexOpacityAndColor","Uint8Array","_createBuffers","logger","warn","uv","_computeReprojectionInfo","positionBuffer","normalBuffer","tangentBuffer","uvBuffer","colorBuffer","symbolColorBuffer","_transformOriginLocal","geometryTransformation","transform","geographic","origin","localMatrix","anchor","se","fromTypedArray","ue","me","BYTES_PER_ELEMENT","_validateFaces","faces","_getOrCreateFaces","_isOutsideClippingArea","clippingExtent","equals","he","Uint16Array","Graphics3DMeshFillSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import\"../../../../core/has.js\";import{isSome as t,isNone as r,get as o}from\"../../../../core/maybe.js\";import{f as a,t as s}from\"../../../../chunks/mat3.js\";import{c as n}from\"../../../../chunks/mat3f64.js\";import{q as i,m as l,a as c}from\"../../../../chunks/mat4.js\";import{b as u,c as m}from\"../../../../chunks/mat4f64.js\";import{b as h,a as p,d as f,n as d,f as g,c as x}from\"../../../../chunks/vec3.js\";import{Z as _,O as y,c as b}from\"../../../../chunks/vec3f64.js\";import{O as v}from\"../../../../chunks/vec4f64.js\";import{projectVectorToDehydratedPoint as T,projectBuffer as C,computeLinearTransformation as w,canProjectWithoutEngine as A}from\"../../../../geometry/projection.js\";import{empty as M,expandWithBuffer as j,intersectsClippingArea as P,create as B}from\"../../../../geometry/support/aaBoundingBox.js\";import R from\"../../../../geometry/support/MeshComponent.js\";import E from\"../../../../geometry/support/MeshMaterialMetallicRoughness.js\";import{BufferViewVec3f64 as F,BufferViewVec3f as O}from\"../../../../geometry/support/buffer/BufferView.js\";import{t as I,a as S}from\"../../../../chunks/vec32.js\";import{transformPosition as N,transformNormal as V,projectNormalToPCPF as U,transformTangent as L,projectTangentToPCPF as G}from\"../../../../geometry/support/meshUtils/projection.js\";import{makeDehydratedPoint as $}from\"../../../../layers/graphics/dehydratedFeatures.js\";import{perObjectElevationAligner as D}from\"./ElevationAligners.js\";import{needsElevationUpdates3D as z}from\"./elevationAlignmentUtils.js\";import{ElevationContext as k}from\"./ElevationContext.js\";import{Graphics3DObject3DGraphicLayer as H}from\"./Graphics3DObject3DGraphicLayer.js\";import{Graphics3DSymbolLayer as q}from\"./Graphics3DSymbolLayer.js\";import{createMaterial as W}from\"../support/edgeUtils.js\";import{parseColorMixMode as Y,encodeSymbolColor as Z}from\"../support/symbolColorUtils.js\";import J from\"../../support/debugFlags.js\";import{Geometry as K}from\"../../webgl-engine/lib/Geometry.js\";import{generateDefaultIndexArray as Q}from\"../../webgl-engine/lib/geometryDataUtils.js\";import{Object3D as X}from\"../../webgl-engine/lib/Object3D.js\";import{Texture as ee}from\"../../webgl-engine/lib/Texture.js\";import{DefaultMaterial as te}from\"../../webgl-engine/materials/DefaultMaterial.js\";import{NativeLineMaterial as re}from\"../../webgl-engine/materials/NativeLineMaterial.js\";const oe=[\"mesh\"];class ae extends q{constructor(e,t,r,o){super(e,t,r,o),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){J.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new re({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new re({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),(e=>e.material))),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,oe,\"fill on mesh-3d\"))return null;const r=this.setGraphicElevationContext(t,new k),o=e.renderingInfo;return this._createAs3DShape(t,o,r,t.uid)}layerOpacityChanged(e,r){const o=this._getLayerOpacity();return this._materials.forEach((e=>{e.material.setParameterValues({layerOpacity:o});const t=e.material.params;this._setMaterialTransparentParameter(t,e),e.material.setParameterValues({transparent:t.transparent})})),e.forEach((e=>{const a=r(e);t(a)&&a.layerOpacityChanged(o,this._context.isAsync)})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,z)}slicePlaneEnabledChanged(e,r){return this._materials.forEach((e=>{e.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})})),e.forEach((e=>{const o=r(e);t(o)&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach((t=>t.material.setParameterValues({usePBR:e}))),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return r(t)?\"-\":t instanceof e?t.toHex():t.contentHash}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),o=!!e.vertexAttributes.color,a=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:o,hasVertexTangents:a,uid:`vc:${o},vt:${a},vct${t},svc:${r}`}}_materialProperties(e,t,r){const o=this._materialPropertiesDefault(e,r);if(!t.material)return o;const{color:a,colorTexture:s,normalTexture:n,doubleSided:i,alphaCutoff:l,alphaMode:c}=t.material,u=this._colorOrTextureUid(a),m=this._colorOrTextureUid(s),h=this._colorOrTextureUid(n);if(o.color=a,o.colorTexture=s,o.normalTexture=n,o.uid=`${o.uid},cmuid:${u},ctmuid:${m},ntmuid:${h},ds:${i},ac:${l},am:${c}`,t.material instanceof E){const{metallic:e,roughness:r,metallicRoughnessTexture:a,emissiveColor:s,emissiveTexture:n,occlusionTexture:i}=t.material,l=this._colorOrTextureUid(a),c=this._colorOrTextureUid(s),u=this._colorOrTextureUid(n),m=this._colorOrTextureUid(i);o.metallic=e,o.roughness=r,o.metallicRoughnessTexture=a,o.emissiveColor=s,o.emissiveTexture=n,o.occlusionTexture=i,o.uid=`${o.uid},mrm:${e},mrr:${r},mrt:${l},emuid:${c},etmuid:${u},otmuid:${m}`}return o}_setInternalColorValueParameters(t,r){r.diffuse=e.toUnitRGB(t),r.opacity=t.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getLoadableTextureResource(e);if(!t)return;const r=e.contentHash;let o=this._textures.get(r);return o||(o=new ee(t,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(r,o),this._context.stage.add(o)),o.id}_castTextureWrap(e=\"repeat\"){if(\"string\"==typeof e){const t=this._castTextureWrapIndividual(e);return{s:t,t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case\"clamp\":return 33071;case\"mirror\":return 33648;case\"repeat\":default:return 10497}}_setInternalMaterialParameters(r,o){t(r.color)&&this._setInternalColorValueParameters(r.color,o),t(r.colorTexture)&&(o.textureId=this._getInternalTextureId(r.colorTexture)),t(r.normalTexture)&&(o.normalTextureId=this._getInternalTextureId(r.normalTexture)),t(r.emissiveColor)&&(o.emissiveFactor=e.toUnitRGB(r.emissiveColor)),t(r.emissiveTexture)&&(o.emissiveTextureId=this._getInternalTextureId(r.emissiveTexture)),t(r.occlusionTexture)&&(o.occlusionTextureId=this._getInternalTextureId(r.occlusionTexture)),t(r.metallicRoughnessTexture)&&(o.metallicRoughnessTextureId=this._getInternalTextureId(r.metallicRoughnessTexture))}_setExternalMaterialParameters(r){const o=this._drivenProperties.color;let a=t(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(o)r.externalColor=v;else{const o=t(this.symbolLayer.material)?this.symbolLayer.material.color:null;t(o)?r.externalColor=e.toUnitRGBA(o):(a=null,r.externalColor=v)}a&&(r.colorMixMode=a),r.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(r(t))return!1;for(let r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}_getOrCreateMaterial(e,r){const o=r.material&&r.material.color,a=r.material&&r.material.colorTexture,s=r.material&&\"blend\"===r.material.alphaMode,n=!(r.material&&\"opaque\"===r.material.alphaMode)&&(this._hasTransparentVertexColors(e)||t(o)&&o.a<1||t(a)&&a.transparent||s),i=this._materialProperties(e,r,n),l=this._materials.get(i.uid);if(l)return l.material;const c={material:null,isComponentTransparent:n,alphaMode:r.material?r.material.alphaMode:\"opaque\"},u=null==i.metallicRoughnessTexture&&null==i.metallic&&null==i.roughness,m={usePBR:this._usePBR(),isSchematic:u,vertexColors:i.hasVertexColors,symbolColors:i.hasSymbolVertexColors,vertexTangents:i.hasVertexTangents,ambient:_,diffuse:y,opacity:1,doubleSided:!0,doubleSidedType:\"winding-order\",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};u||(m.mrrFactors=[null!=i.metallic?i.metallic:1,null!=i.roughness?i.roughness:1,.5]),r.material&&(m.doubleSided=r.material.doubleSided,m.cullFace=r.material.doubleSided?0:2,m.textureAlphaCutoff=r.material.alphaCutoff),this._setInternalMaterialParameters(i,m),this._setExternalMaterialParameters(m),this._setMaterialTransparentParameter(m,c);const h=new te(m);return c.material=h,this._materials.set(i.uid,c),this._context.stage.add(h),h}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,\"auto\"===t.alphaMode?e.textureAlphaMode=e.transparent?3:1:e.textureAlphaMode=\"opaque\"===t.alphaMode?1:\"mask\"===t.alphaMode?2:0}_addDebugNormals(e,t,r,o){const a=t.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),i=[],l=[],c=[],m=[];for(let u=0;u<a;u++){const e=t[u],r=e.vertexAttributes.get(\"position\"),o=e.vertexAttributes.get(\"normal\"),a=e.indices.get(\"position\"),s=e.indices.get(\"normal\"),f=r.data,d=o.data;for(let t=0;t<a.length;t++){const e=3*a[t],r=3*s[t];for(let t=0;t<3;t++)i.push(f[e+t]);for(let t=0;t<3;t++)i.push(f[e+t]+d[r+t]*n);if(l.push(l.length),l.push(l.length),t%3==0){this._calculateFaceNormal(f,a,t,ce),this._getFaceVertices(f,a,t,ne,ie,le),h(ne,ne,ie),h(ne,ne,le),p(ne,ne,1/3);for(let e=0;e<3;e++)c.push(ne[e]);for(let e=0;e<3;e++)c.push(ne[e]+ce[e]*n);m.push(m.length),m.push(m.length)}}}const f=new K([[\"position\",{data:i,size:3,exclusive:!0}]],[[\"position\",new Uint32Array(l)]],2);t.push(f),r.push(this._debugVertexNormalMaterial),o.push(u(o[0]));const d=new K([[\"position\",{data:c,size:3,exclusive:!0}]],[[\"position\",new Uint32Array(m)]],2);t.push(d),r.push(this._debugFaceNormalMaterial),o.push(u(o[0]))}_createAs3DShape(e,r,o,a){const s=e.geometry;if(\"mesh\"!==s.type)return null;const n=this._createGeometryInfo(s,r);if(!n)return null;const{geometries:i,materials:l,transformations:c,objectTransformation:u}=n;J.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,i,l,c);const m=new X({geometries:i,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:a}});m.transformation=u;const h=D,p=this._createEdgeMaterial(),f=t(p)?{baseMaterial:l[0],edgeMaterials:[p],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,d=new H(this,m,i,null,null,h,o,f);return d.needsElevationUpdates=z(o.mode),d.useObjectOriginAsAttachmentOrigin=!0,d.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(m),d.alignedSampledElevation=h(d,d.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),d}getCenterPointInElevationSR(e){const t=$(0,0,0,this._context.elevationProvider.spatialReference);return T([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,r,o){switch(r.shading||\"flat\"){case\"source\":return this._createComponentNormalsSource(e,t,r,o);case\"flat\":return this._createComponentNormalsFlat(e,o);case\"smooth\":return this._createComponentNormalsSmooth(e,o);default:return}}_createComponentNormalsSource(e,t,o,a){if(r(t))return this._createComponentNormalsFlat(e,a);let s=!1;if(!o.trustSourceNormals)for(let r=0;r<a.length;r+=3){this._calculateFaceNormal(e,a,r,ce);for(let e=0;e<3;e++){const o=3*a[r+e];ne[0]=t[o+0],ne[1]=t[o+1],ne[2]=t[o+2],f(ce,ne)<0&&(t[o+0]=-t[o+0],t[o+1]=-t[o+1],t[o+2]=-t[o+2],s=!0)}}return{normals:t,indices:a,didFlipNormals:s}}_createComponentNormalsFlat(e,t){const r=new Float32Array(t.length),o=new Uint32Array(3*t.length);for(let a=0;a<t.length;a+=3){const s=this._calculateFaceNormal(e,t,a,ce);for(let e=0;e<3;e++)r[a+e]=s[e],o[a+e]=a/3}return{normals:r,indices:o,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const r={};for(let s=0;s<t.length;s+=3){const o=this._calculateFaceNormal(e,t,s,ce);for(let e=0;e<3;e++){const a=t[s+e];let n=r[a];n||(n={normal:b(),count:0},r[a]=n),h(n.normal,n.normal,o),n.count++}}const o=new Float32Array(3*t.length),a=new Uint32Array(3*t.length);for(let s=0;s<t.length;s++){const e=r[t[s]];1!==e.count&&(d(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)o[3*s+t]=e.normal[t];a[s]=s}return{normals:o,indices:a,didFlipNormals:!1}}_getFaceVertices(e,t,r,o,a,s){const n=3*t[r+0],i=3*t[r+1],l=3*t[r+2];o[0]=e[n+0],o[1]=e[n+1],o[2]=e[n+2],a[0]=e[i+0],a[1]=e[i+1],a[2]=e[i+2],s[0]=e[l+0],s[1]=e[l+1],s[2]=e[l+2]}_calculateFaceNormal(e,t,r,o){return this._getFaceVertices(e,t,r,ne,ie,le),g(ie,ie,ne),g(le,le,ne),x(ne,ie,le),d(o,ne),o}_getOrCreateComponents(e){return e.components?e.components:pe}_createPositionBuffer(e,r){let o=e.vertexAttributes.position;const a=1===r.reprojection?r.transformBeforeProject:null;if(t(a)&&(o=N(o,new Float64Array(o.length),a)),0===r.reprojection)return r.needsBufferCopy?new Float64Array(o):o;const s=t(a)?o:new Float64Array(o.length);return C(o,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,o.length/3),s}_createNormalBuffer(e,o,a){let s=e.vertexAttributes.normal;if(r(s))return null;const n=1===a.reprojection?a.transformBeforeProject:null;t(n)&&(s=V(s,new Float32Array(s.length),n));if(\"local\"===this._context.layerView.view.viewingMode||0===a.reprojection)return a.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const i=e.vertexAttributes.position,l=t(n)?s:new Float32Array(s.length);return U(s,i,o,e.spatialReference,l)}_createTangentBuffer(e,o,a){let s=e.vertexAttributes.tangent;if(r(s))return null;const n=1===a.reprojection?a.transformBeforeProject:null;t(n)&&(s=L(s,new Float32Array(s.length),n));if(\"local\"===this._context.layerView.view.viewingMode||0===a.reprojection)return a.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const i=e.vertexAttributes.position,l=t(n)?s:new Float32Array(s.length);return G(s,i,o,e.spatialReference,l)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=Y(o(this.symbolLayer,\"material\",\"colorMixMode\")),a=new Uint8Array(4);return Z(t,r,a),a}return null}_createBuffers(e,r){const o=e.vertexAttributes&&e.vertexAttributes.position;if(!o)return this.logger.warn(\"Mesh geometry must contain position vertex attributes\"),null;const a=e.vertexAttributes.normal,s=e.vertexAttributes.uv,n=e.vertexAttributes.tangent;if(t(a)&&a.length!==o.length)return this.logger.warn(\"Mesh normal vertex buffer must contain the same number of elements as the position buffer\"),null;if(t(n)&&n.length/4!=o.length/3)return this.logger.warn(\"Mesh tangent vertex buffer must contain the same number of elements as the position buffer\"),null;if(t(s)&&s.length/2!=o.length/3)return this.logger.warn(\"Mesh uv vertex buffer must contain the same number of elements as the position buffer\"),null;const i=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,i),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),h=this._createNormalBuffer(e,l,i),p=this._createTangentBuffer(e,l,i);return{positionBuffer:l,normalBuffer:h,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:0===i.reprojection&&t(i.objectTransformation)?i.objectTransformation:this._transformOriginLocal(e,l,h,p),geometryTransformation:0===i.reprojection&&t(i.geometryTransformation)?i.geometryTransformation:m()}}_computeReprojectionInfo(e){const r=t(e.transform)&&e.transform.geographic||2===this._context.renderCoordsHelper.viewingMode?0:1;let o=null;if(t(e.transform)){if(0===r){const t=m();w(e.spatialReference,e.transform.origin,t,this._context.renderCoordsHelper.spatialReference);return{reprojection:r,objectTransformation:t,geometryTransformation:u(e.transform.localMatrix),needsBufferCopy:!1}}return o=i(m(),e.transform.origin),l(o,o,e.transform.localMatrix),{reprojection:r,transformBeforeProject:o,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(e,r,o,n){const i=this._context.renderCoordsHelper.spatialReference,l=e.anchor;se[0]=l.x,se[1]=l.y,se[2]=l.z;const u=m();w(e.spatialReference,se,u,i);const h=F.fromTypedArray(r);if(c(ue,u),I(h,h,ue),t(o)||t(n)){if(a(me,u),s(me,me),t(o)){const e=O.fromTypedArray(o);S(e,e,me)}if(t(n)){const e=O.fromTypedArray(n,4*n.BYTES_PER_ELEMENT);S(e,e,me)}}return u}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,o=t.faces;if(o){let e=-1;for(let t=0;t<o.length;t++){const r=o[t];r>e&&(e=r)}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn(\"Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)\"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:Q(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference;let o;const a=t.length/3;return e.spatialReference.equals(r)?o=t:(o=new Float64Array(t.length),C(e.vertexAttributes.position,e.spatialReference,0,o,r,0,a)),M(he),j(he,o,0,a),!P(he,this._context.clippingExtent)}_createGeometryInfo(e,o){if(!A(e.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn(\"Geometry spatial reference is not compatible with the view\"),null;if(this._isOutsideClippingArea(e))return null;const a=this._createBuffers(e,o);if(r(a))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:i,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:m,geometryTransformation:h}=a,p=this._getOrCreateComponents(e),f=[],d=[],g=[];let x=!1;for(const r of p){if(!this._validateFaces(e,r))return null;const o=this._getOrCreateFaces(e,r);if(0===o.length)continue;const a=this._createComponentNormals(s,c,r,o);a.didFlipNormals&&(x=!0);const m=[[\"position\",{size:3,data:s,exclusive:!0}],[\"normal\",{size:3,data:a.normals,exclusive:!0}]],p=[[\"position\",o],[\"normal\",a.indices]];t(i)&&(m.push([\"color\",{size:4,data:i,exclusive:!0}]),p.push([\"color\",o])),t(l)&&(m.push([\"symbolColor\",{size:4,data:l,exclusive:!0}]),p.push([\"symbolColor\",new Uint16Array(o.length)])),t(n)&&(m.push([\"uv0\",{size:2,data:n,exclusive:!0}]),p.push([\"uv0\",o])),t(u)&&(m.push([\"tangent\",{size:4,data:u,exclusive:!0}]),p.push([\"tangent\",o]));const _=new K(m,p);f.push(_),d.push(h),g.push(this._getOrCreateMaterial(e,r))}return x&&this.logger.warn(\"Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.\"),{geometries:f,transformations:d,materials:g,objectTransformation:m}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return W(this.symbolLayer,e)}}const se=b(),ne=b(),ie=b(),le=b(),ce=b(),ue=m(),me=n(),he=B(),pe=[new R];export default ae;export{ae as Graphics3DMeshFillSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}