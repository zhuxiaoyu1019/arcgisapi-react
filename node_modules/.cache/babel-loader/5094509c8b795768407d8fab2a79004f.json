{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { forEach as t } from \"../../../../core/asyncUtils.js\";\nimport { isNone as e, isSome as s, get as r } from \"../../../../core/maybe.js\";\nimport { onAbortOrThrow as o, throwIfAborted as a } from \"../../../../core/promiseUtils.js\";\nimport i from \"./Graphics3DGraphic.js\";\nimport { Graphics3DObject3DGraphicLayer as n } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { make as y } from \"./Graphics3DSymbolLayerFactory.js\";\nimport { Loadable as l } from \"./Loadable.js\";\nimport { totalSymbolComplexities as h } from \"./symbolComplexity.js\";\n\nclass c extends l {\n  constructor(t, e, s) {\n    super(e.schedule), this._symbol = t, this._context = e, this._backgroundLayers = s, this._destroyed = !1, this.symbolLayers = [], this.referenced = 0, this._extentPadding = 0;\n  }\n\n  set symbol(t) {\n    if (this._symbol = t, this.symbolLayers) for (let s = 0; s < t.symbolLayers.length; s++) {\n      const r = this.symbolLayers[s];\n      e(r) || (r.symbol = t, r.symbolLayer = t.symbolLayers.items[s]);\n    }\n  }\n\n  get symbol() {\n    return this._symbol;\n  }\n\n  async doLoad(e) {\n    let r = this._symbol.symbolLayers;\n    this._extentPadding = 0, this._backgroundLayers && (r = this._backgroundLayers.concat(r));\n    const i = r.length;\n\n    for (; this.symbolLayers.length < r.length;) this.symbolLayers.push(null);\n\n    this.symbolLayers.length = r.length;\n    const n = [];\n\n    for (let t = 0; t < i; t++) {\n      const s = r.getItemAt(t);\n      if (!1 === s.enabled) continue;\n      m.renderPriority = 1 - (1 + t) / i, m.renderPriorityStep = 1 / i, m.ignoreDrivers = s._ignoreDrivers;\n      const a = y(this.symbol, s, this._context, m);\n      n.push(o(e, () => {\n        this.symbolLayers[t] = null, a.destroy();\n      })), this.symbolLayers[t] = a;\n    }\n\n    await t(this.symbolLayers, async (t, e) => {\n      if (s(t)) try {\n        await t.load(), this._extentPadding += Math.max(this._extentPadding, t.extentPadding);\n      } catch {\n        this.symbolLayers[e] = null;\n      }\n    });\n\n    for (const t of n) null == t || t.remove();\n\n    if (n.length = 0, a(e), this.symbolLayers.length && !this.symbolLayers.some(t => !!t)) throw new Error();\n  }\n\n  getSymbolLayerSize(t) {\n    const e = this.symbolLayers[t];\n    return s(e) ? e.getCachedSize() : null;\n  }\n\n  get extentPadding() {\n    return this._extentPadding;\n  }\n\n  createGraphics3DGraphic(t, e) {\n    const r = t.graphic,\n          o = new Array(this.symbolLayers.length);\n\n    for (let i = 0; i < this.symbolLayers.length; i++) {\n      const e = this.symbolLayers[i];\n      o[i] = s(e) ? e.createGraphics3DGraphic(t) : null;\n    }\n\n    const a = this._context.arcade || this._context.featureExpressionInfoContext && this._context.featureExpressionInfoContext.arcade && this._context.featureExpressionInfoContext.arcade.modules || null;\n    return new i(r, e || this, o, t.layer, a);\n  }\n\n  get complexity() {\n    return h(this.symbolLayers.map(t => r(t, \"complexity\")));\n  }\n\n  globalPropertyChanged(t, e) {\n    const r = this.symbolLayers.length;\n\n    for (let o = 0; o < r; o++) {\n      const r = this.symbolLayers[o],\n            a = t => {\n        const e = t._graphics[o];\n        return e instanceof n ? e : null;\n      };\n\n      if (s(r) && !r.globalPropertyChanged(t, e, a)) return !1;\n    }\n\n    return !0;\n  }\n\n  applyRendererDiff(t, s) {\n    return 1 === this.loadStatus && this.symbolLayers.reduce((r, o) => r && (e(o) || o.applyRendererDiff(t, s)), !0);\n  }\n\n  prepareSymbolPatch(t) {\n    if (2 === this.loadStatus) return;\n    if (\"partial\" !== t.diff.type) return;\n    const r = t.diff.diff;\n    if (!r.symbolLayers || \"partial\" !== r.symbolLayers.type) return;\n    const o = r.symbolLayers.diff;\n    this.symbolLayers.forEach((r, a) => {\n      if (e(r)) return;\n      const i = o[a];\n\n      if (i) {\n        const e = {\n          diff: i,\n          graphics3DGraphicPatches: [],\n          symbolLayerStatePatches: []\n        };\n        r.prepareSymbolLayerPatch(e), t.symbolStatePatches.push(...e.symbolLayerStatePatches), e.graphics3DGraphicPatches.length && t.graphics3DGraphicPatches.push((t, r) => {\n          const o = t._graphics[a];\n          s(o) && e.graphics3DGraphicPatches.forEach(t => t(o, r));\n        });\n      }\n    });\n  }\n\n  updateGeometry(t, s) {\n    for (let r = 0; r < this.symbolLayers.length; r++) {\n      const o = this.symbolLayers[r];\n      if (e(o)) continue;\n      const a = t._graphics[r];\n      if (e(a) || !o.updateGeometry(a, s)) return !1;\n    }\n\n    return !0;\n  }\n\n  onRemoveGraphic(t) {\n    for (let r = 0; r < this.symbolLayers.length; r++) {\n      const o = this.symbolLayers[r];\n      if (e(o)) continue;\n      const a = t._graphics[r];\n      s(a) && o.onRemoveGraphic(a);\n    }\n  }\n\n  getFastUpdateStatus() {\n    let t = 0,\n        s = 0,\n        r = 0;\n    return this.symbolLayers.forEach(o => {\n      e(o) || (0 === o.loadStatus ? t++ : o.isFastUpdatesEnabled() ? r++ : s++);\n    }), {\n      loading: t,\n      slow: s,\n      fast: r\n    };\n  }\n\n  destroy() {\n    if (this.destroyed) console.error(\"Graphics3DSymbol.destroy called when already destroyed!\");else {\n      this.abortLoad();\n\n      for (const t of this.symbolLayers) s(t) && t.destroy();\n\n      this.symbolLayers.length = 0, this._destroyed = !0;\n    }\n  }\n\n  get destroyed() {\n    return this._destroyed;\n  }\n\n}\n\nconst m = {\n  renderPriority: 0,\n  renderPriorityStep: 1,\n  ignoreDrivers: !1\n};\nexport default c;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbol.js"],"names":["forEach","t","isNone","e","isSome","s","get","r","onAbortOrThrow","o","throwIfAborted","a","i","Graphics3DObject3DGraphicLayer","n","make","y","Loadable","l","totalSymbolComplexities","h","c","constructor","schedule","_symbol","_context","_backgroundLayers","_destroyed","symbolLayers","referenced","_extentPadding","symbol","length","symbolLayer","items","doLoad","concat","push","getItemAt","enabled","m","renderPriority","renderPriorityStep","ignoreDrivers","_ignoreDrivers","destroy","load","Math","max","extentPadding","remove","some","Error","getSymbolLayerSize","getCachedSize","createGraphics3DGraphic","graphic","Array","arcade","featureExpressionInfoContext","modules","layer","complexity","map","globalPropertyChanged","_graphics","applyRendererDiff","loadStatus","reduce","prepareSymbolPatch","diff","type","graphics3DGraphicPatches","symbolLayerStatePatches","prepareSymbolLayerPatch","symbolStatePatches","updateGeometry","onRemoveGraphic","getFastUpdateStatus","isFastUpdatesEnabled","loading","slow","fast","destroyed","console","error","abortLoad"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{forEach as t}from\"../../../../core/asyncUtils.js\";import{isNone as e,isSome as s,get as r}from\"../../../../core/maybe.js\";import{onAbortOrThrow as o,throwIfAborted as a}from\"../../../../core/promiseUtils.js\";import i from\"./Graphics3DGraphic.js\";import{Graphics3DObject3DGraphicLayer as n}from\"./Graphics3DObject3DGraphicLayer.js\";import{make as y}from\"./Graphics3DSymbolLayerFactory.js\";import{Loadable as l}from\"./Loadable.js\";import{totalSymbolComplexities as h}from\"./symbolComplexity.js\";class c extends l{constructor(t,e,s){super(e.schedule),this._symbol=t,this._context=e,this._backgroundLayers=s,this._destroyed=!1,this.symbolLayers=[],this.referenced=0,this._extentPadding=0}set symbol(t){if(this._symbol=t,this.symbolLayers)for(let s=0;s<t.symbolLayers.length;s++){const r=this.symbolLayers[s];e(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[s])}}get symbol(){return this._symbol}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let t=0;t<i;t++){const s=r.getItemAt(t);if(!1===s.enabled)continue;m.renderPriority=1-(1+t)/i,m.renderPriorityStep=1/i,m.ignoreDrivers=s._ignoreDrivers;const a=y(this.symbol,s,this._context,m);n.push(o(e,(()=>{this.symbolLayers[t]=null,a.destroy()}))),this.symbolLayers[t]=a}await t(this.symbolLayers,(async(t,e)=>{if(s(t))try{await t.load(),this._extentPadding+=Math.max(this._extentPadding,t.extentPadding)}catch{this.symbolLayers[e]=null}}));for(const t of n)null==t||t.remove();if(n.length=0,a(e),this.symbolLayers.length&&!this.symbolLayers.some((t=>!!t)))throw new Error}getSymbolLayerSize(t){const e=this.symbolLayers[t];return s(e)?e.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,e){const r=t.graphic,o=new Array(this.symbolLayers.length);for(let i=0;i<this.symbolLayers.length;i++){const e=this.symbolLayers[i];o[i]=s(e)?e.createGraphics3DGraphic(t):null}const a=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new i(r,e||this,o,t.layer,a)}get complexity(){return h(this.symbolLayers.map((t=>r(t,\"complexity\"))))}globalPropertyChanged(t,e){const r=this.symbolLayers.length;for(let o=0;o<r;o++){const r=this.symbolLayers[o],a=t=>{const e=t._graphics[o];return e instanceof n?e:null};if(s(r)&&!r.globalPropertyChanged(t,e,a))return!1}return!0}applyRendererDiff(t,s){return 1===this.loadStatus&&this.symbolLayers.reduce(((r,o)=>r&&(e(o)||o.applyRendererDiff(t,s))),!0)}prepareSymbolPatch(t){if(2===this.loadStatus)return;if(\"partial\"!==t.diff.type)return;const r=t.diff.diff;if(!r.symbolLayers||\"partial\"!==r.symbolLayers.type)return;const o=r.symbolLayers.diff;this.symbolLayers.forEach(((r,a)=>{if(e(r))return;const i=o[a];if(i){const e={diff:i,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};r.prepareSymbolLayerPatch(e),t.symbolStatePatches.push(...e.symbolLayerStatePatches),e.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push(((t,r)=>{const o=t._graphics[a];s(o)&&e.graphics3DGraphicPatches.forEach((t=>t(o,r)))}))}}))}updateGeometry(t,s){for(let r=0;r<this.symbolLayers.length;r++){const o=this.symbolLayers[r];if(e(o))continue;const a=t._graphics[r];if(e(a)||!o.updateGeometry(a,s))return!1}return!0}onRemoveGraphic(t){for(let r=0;r<this.symbolLayers.length;r++){const o=this.symbolLayers[r];if(e(o))continue;const a=t._graphics[r];s(a)&&o.onRemoveGraphic(a)}}getFastUpdateStatus(){let t=0,s=0,r=0;return this.symbolLayers.forEach((o=>{e(o)||(0===o.loadStatus?t++:o.isFastUpdatesEnabled()?r++:s++)})),{loading:t,slow:s,fast:r}}destroy(){if(this.destroyed)console.error(\"Graphics3DSymbol.destroy called when already destroyed!\");else{this.abortLoad();for(const t of this.symbolLayers)s(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const m={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};export default c;\n"]},"metadata":{},"sourceType":"module"}