{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Graphic.js\";\nimport { isSome as r, isNone as o } from \"../../../core/maybe.js\";\nimport { property as i } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as a } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { f as s, c as l } from \"../../../chunks/vec4f64.js\";\nimport { area as n, width as h, height as d } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { I3SMeshView3D as c } from \"./I3SMeshView3D.js\";\nimport { LayerView3D as p } from \"./LayerView3D.js\";\nimport { updatingProgress as y } from \"../support/updatingProperties.js\";\nimport u from \"../../layers/LayerView.js\";\nconst v = .2;\nlet g = class extends c(p(u)) {\n  constructor() {\n    super(...arguments), this.type = \"integrated-mesh-3d\", this.lodFactor = 1, this._elevationContext = \"im\", this._isIntegratedMesh = !0, this._supportsLabeling = !1, this.drapeTargetType = 1, this._overlayTexOffset = s(-1, -1, -1, -1), this._overlayTexScale = l(), this._overlayColor = null, this._overlayHighlight = null, this._overlayNormal = null;\n  }\n\n  get progressiveLoadFactor() {\n    return this.lodFactor >= 1 ? v : 1;\n  }\n\n  setDrapingTextures(e) {\n    const t = e.index,\n          o = e.extent,\n          i = e.needsColorWithoutRasterImage ? e.getValidTarget(1) : e.hasDrapedFeatureSource ? e.getValidTarget(0) : null;\n\n    if (r(i) && n(o) > 0) {\n      this._overlayTexOffset[2 * t] = -o[0] / h(o), this._overlayTexOffset[2 * t + 1] = -o[1] / d(o), this._overlayTexScale[2 * t] = 1 / h(o), this._overlayTexScale[2 * t + 1] = 1 / d(o);\n      const r = e.getValidTarget(2),\n            a = e.getValidTarget(3);\n      this._overlayColor = i.getTexture(), this._overlayHighlight = r ? r.getTexture() : null, this._overlayNormal = a ? a.getTexture() : null;\n    } else this._overlayTexOffset[2 * t] = -1, this._overlayTexOffset[2 * t + 1] = -1, this._overlayTexScale[2 * t] = 0, this._overlayTexScale[2 * t + 1] = 0, 0 === t && (this._overlayColor = null, this._overlayHighlight = null, this._overlayNormal = null);\n\n    this._forAllNodes(e => r(e) && this._collection.updateMaterial(e.objectHandle, e => this._updateMaterialOverlay(e)));\n  }\n\n  _updateMaterialOverlay(e) {\n    e.overlayColor = this._overlayColor, e.overlayHighlight = this._overlayHighlight, e.overlayNormal = this._overlayNormal, e.overlayTexOffset = this._overlayTexOffset, e.overlayTexScale = this._overlayTexScale;\n  }\n\n  initialize() {\n    this.updatingHandles.add(this.layer, \"modifications\", () => this._loadModifications(), 2);\n  }\n\n  _createLayerGraphic() {\n    const e = new t();\n    return e.layer = this.layer, e.sourceLayer = this.layer, e;\n  }\n\n  canResume() {\n    return super.canResume() && (!this._controller || this._controller.rootNodeVisible);\n  }\n\n  _loadModifications() {\n    if (this.handles.remove(\"modifications\"), o(this.layer.modifications)) return void (this._modifications = []);\n    const e = this.layer.modifications;\n    this.handles.add(this.updatingHandles.addOnCollectionChange(e, () => this._modifications = e.toArray(), 2), \"modifications\");\n  }\n\n};\ne([i()], g.prototype, \"layer\", void 0), e([i({\n  aliasOf: \"layer\"\n})], g.prototype, \"i3slayer\", void 0), e([i()], g.prototype, \"suspended\", void 0), e([i(y)], g.prototype, \"updatingProgress\", void 0), e([i({\n  readOnly: !0,\n  aliasOf: \"_controller.updatingProgress\"\n})], g.prototype, \"updatingProgressValue\", void 0), e([i({\n  readOnly: !0,\n  aliasOf: \"view.qualitySettings.sceneService.integratedMesh.lodFactor\"\n})], g.prototype, \"lodFactor\", void 0), e([i({\n  readOnly: !0\n})], g.prototype, \"progressiveLoadFactor\", null), g = e([a(\"esri.views.3d.layers.SceneLayerView3D\")], g);\nvar m = g;\nexport default m;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/IntegratedMeshLayerView3D.js"],"names":["_","e","t","isSome","r","isNone","o","property","i","subclass","a","f","s","c","l","area","n","width","h","height","d","I3SMeshView3D","LayerView3D","p","updatingProgress","y","u","v","g","constructor","arguments","type","lodFactor","_elevationContext","_isIntegratedMesh","_supportsLabeling","drapeTargetType","_overlayTexOffset","_overlayTexScale","_overlayColor","_overlayHighlight","_overlayNormal","progressiveLoadFactor","setDrapingTextures","index","extent","needsColorWithoutRasterImage","getValidTarget","hasDrapedFeatureSource","getTexture","_forAllNodes","_collection","updateMaterial","objectHandle","_updateMaterialOverlay","overlayColor","overlayHighlight","overlayNormal","overlayTexOffset","overlayTexScale","initialize","updatingHandles","add","layer","_loadModifications","_createLayerGraphic","sourceLayer","canResume","_controller","rootNodeVisible","handles","remove","modifications","_modifications","addOnCollectionChange","toArray","prototype","aliasOf","readOnly","m"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Graphic.js\";import{isSome as r,isNone as o}from\"../../../core/maybe.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{f as s,c as l}from\"../../../chunks/vec4f64.js\";import{area as n,width as h,height as d}from\"../../../geometry/support/aaBoundingRect.js\";import{I3SMeshView3D as c}from\"./I3SMeshView3D.js\";import{LayerView3D as p}from\"./LayerView3D.js\";import{updatingProgress as y}from\"../support/updatingProperties.js\";import u from\"../../layers/LayerView.js\";const v=.2;let g=class extends(c(p(u))){constructor(){super(...arguments),this.type=\"integrated-mesh-3d\",this.lodFactor=1,this._elevationContext=\"im\",this._isIntegratedMesh=!0,this._supportsLabeling=!1,this.drapeTargetType=1,this._overlayTexOffset=s(-1,-1,-1,-1),this._overlayTexScale=l(),this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}get progressiveLoadFactor(){return this.lodFactor>=1?v:1}setDrapingTextures(e){const t=e.index,o=e.extent,i=e.needsColorWithoutRasterImage?e.getValidTarget(1):e.hasDrapedFeatureSource?e.getValidTarget(0):null;if(r(i)&&n(o)>0){this._overlayTexOffset[2*t]=-o[0]/h(o),this._overlayTexOffset[2*t+1]=-o[1]/d(o),this._overlayTexScale[2*t]=1/h(o),this._overlayTexScale[2*t+1]=1/d(o);const r=e.getValidTarget(2),a=e.getValidTarget(3);this._overlayColor=i.getTexture(),this._overlayHighlight=r?r.getTexture():null,this._overlayNormal=a?a.getTexture():null}else this._overlayTexOffset[2*t]=-1,this._overlayTexOffset[2*t+1]=-1,this._overlayTexScale[2*t]=0,this._overlayTexScale[2*t+1]=0,0===t&&(this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null);this._forAllNodes((e=>r(e)&&this._collection.updateMaterial(e.objectHandle,(e=>this._updateMaterialOverlay(e)))))}_updateMaterialOverlay(e){e.overlayColor=this._overlayColor,e.overlayHighlight=this._overlayHighlight,e.overlayNormal=this._overlayNormal,e.overlayTexOffset=this._overlayTexOffset,e.overlayTexScale=this._overlayTexScale}initialize(){this.updatingHandles.add(this.layer,\"modifications\",(()=>this._loadModifications()),2)}_createLayerGraphic(){const e=new t;return e.layer=this.layer,e.sourceLayer=this.layer,e}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}_loadModifications(){if(this.handles.remove(\"modifications\"),o(this.layer.modifications))return void(this._modifications=[]);const e=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(e,(()=>this._modifications=e.toArray()),2),\"modifications\")}};e([i()],g.prototype,\"layer\",void 0),e([i({aliasOf:\"layer\"})],g.prototype,\"i3slayer\",void 0),e([i()],g.prototype,\"suspended\",void 0),e([i(y)],g.prototype,\"updatingProgress\",void 0),e([i({readOnly:!0,aliasOf:\"_controller.updatingProgress\"})],g.prototype,\"updatingProgressValue\",void 0),e([i({readOnly:!0,aliasOf:\"view.qualitySettings.sceneService.integratedMesh.lodFactor\"})],g.prototype,\"lodFactor\",void 0),e([i({readOnly:!0})],g.prototype,\"progressiveLoadFactor\",null),g=e([a(\"esri.views.3d.layers.SceneLayerView3D\")],g);var m=g;export default m;\n"]},"metadata":{},"sourceType":"module"}