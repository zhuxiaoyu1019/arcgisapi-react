{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport r from \"../../../../core/Evented.js\";\nimport s from \"../../../../core/Handles.js\";\nimport { property as o } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { c as i } from \"../../../../chunks/vec3f64.js\";\nimport { empty as c, expand as a, intersects as p } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { TaskPriority as d } from \"../../../support/Scheduler.js\";\nlet h = class extends t {\n  constructor() {\n    super(...arguments), this.handles = new s(), this._tileGeometryUpdateExtent = c(), this._tileGeometryUpdateSpatialReference = null, this.events = new r(), this.updating = !1;\n  }\n\n  initialize() {\n    this.handles.add([this.surface.on(\"elevation-change\", e => this._tileGeometryChanged(e)), this.scheduler.registerTask(d.SURFACE_GEOMETRY_UPDATES, this)]);\n  }\n\n  destroy() {\n    this.handles && (this.handles.destroy(), this.handles = null);\n  }\n\n  get running() {\n    return this.updating;\n  }\n\n  runTask() {\n    this.updating && (this._centerIntersectsExtent(this._tileGeometryUpdateExtent, this._tileGeometryUpdateSpatialReference) && this.events.emit(\"request-update\", u), c(this._tileGeometryUpdateExtent), this._set(\"updating\", !1));\n  }\n\n  _tileGeometryChanged(e) {\n    this._tileGeometryUpdateSpatialReference = e.spatialReference, a(this._tileGeometryUpdateExtent, e.tile.extent), this._set(\"updating\", !0);\n  }\n\n  _furthestCenterOnSurface() {\n    let e = this.centerOnSurfaces[0];\n\n    for (let t = 1; t < this.centerOnSurfaces.length; t++) {\n      const r = this.centerOnSurfaces[t];\n      r.distance > e.distance && (e = r);\n    }\n\n    return e;\n  }\n\n  _centerIntersectsExtent(e, t) {\n    const r = this.state.camera.eye,\n          s = f,\n          o = this._furthestCenterOnSurface();\n\n    return this.renderCoordsHelper.fromRenderCoords(r, l, t), this.renderCoordsHelper.fromRenderCoords(o.renderLocation, m, t), l[0] < m[0] ? (s[0] = l[0], s[2] = m[0]) : (s[0] = m[0], s[2] = l[0]), l[1] < m[1] ? (s[1] = l[1], s[3] = m[1]) : (s[1] = m[1], s[3] = l[1]), p(s, e);\n  }\n\n};\ne([o({\n  constructOnly: !0\n})], h.prototype, \"state\", void 0), e([o({\n  constructOnly: !0\n})], h.prototype, \"centerOnSurfaces\", void 0), e([o({\n  constructOnly: !0\n})], h.prototype, \"renderCoordsHelper\", void 0), e([o({\n  constructOnly: !0\n})], h.prototype, \"scheduler\", void 0), e([o({\n  constructOnly: !0\n})], h.prototype, \"surface\", void 0), e([o({\n  readOnly: !0\n})], h.prototype, \"updating\", void 0), h = e([n(\"esri.views.3d.support.SurfaceGeometryUpdates\")], h);\nconst u = {},\n      l = i(),\n      m = i(),\n      f = c();\nvar y = h;\nexport default y;\nexport { h as SurfaceGeometryUpdates };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates.js"],"names":["_","e","t","r","s","property","o","subclass","n","c","i","empty","expand","a","intersects","p","TaskPriority","d","h","constructor","arguments","handles","_tileGeometryUpdateExtent","_tileGeometryUpdateSpatialReference","events","updating","initialize","add","surface","on","_tileGeometryChanged","scheduler","registerTask","SURFACE_GEOMETRY_UPDATES","destroy","running","runTask","_centerIntersectsExtent","emit","u","_set","spatialReference","tile","extent","_furthestCenterOnSurface","centerOnSurfaces","length","distance","state","camera","eye","f","renderCoordsHelper","fromRenderCoords","l","renderLocation","m","constructOnly","prototype","readOnly","y","SurfaceGeometryUpdates"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Evented.js\";import s from\"../../../../core/Handles.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{c as i}from\"../../../../chunks/vec3f64.js\";import{empty as c,expand as a,intersects as p}from\"../../../../geometry/support/aaBoundingRect.js\";import{TaskPriority as d}from\"../../../support/Scheduler.js\";let h=class extends t{constructor(){super(...arguments),this.handles=new s,this._tileGeometryUpdateExtent=c(),this._tileGeometryUpdateSpatialReference=null,this.events=new r,this.updating=!1}initialize(){this.handles.add([this.surface.on(\"elevation-change\",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(d.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit(\"request-update\",u),c(this._tileGeometryUpdateExtent),this._set(\"updating\",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,a(this._tileGeometryUpdateExtent,e.tile.extent),this._set(\"updating\",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.camera.eye,s=f,o=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,l,t),this.renderCoordsHelper.fromRenderCoords(o.renderLocation,m,t),l[0]<m[0]?(s[0]=l[0],s[2]=m[0]):(s[0]=m[0],s[2]=l[0]),l[1]<m[1]?(s[1]=l[1],s[3]=m[1]):(s[1]=m[1],s[3]=l[1]),p(s,e)}};e([o({constructOnly:!0})],h.prototype,\"state\",void 0),e([o({constructOnly:!0})],h.prototype,\"centerOnSurfaces\",void 0),e([o({constructOnly:!0})],h.prototype,\"renderCoordsHelper\",void 0),e([o({constructOnly:!0})],h.prototype,\"scheduler\",void 0),e([o({constructOnly:!0})],h.prototype,\"surface\",void 0),e([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=e([n(\"esri.views.3d.support.SurfaceGeometryUpdates\")],h);const u={},l=i(),m=i(),f=c();var y=h;export default y;export{h as SurfaceGeometryUpdates};\n"]},"metadata":{},"sourceType":"module"}