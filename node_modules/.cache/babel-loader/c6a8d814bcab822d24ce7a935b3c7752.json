{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../Graphic.js\";\nimport r from \"../../../request.js\";\nimport s from \"../../../TimeExtent.js\";\nimport a from \"../../../core/Error.js\";\nimport i from \"../../../core/has.js\";\nimport { JSONMap as o } from \"../../../core/jsonMap.js\";\nimport u from \"../../../core/Loadable.js\";\nimport { isSome as n, isNone as l } from \"../../../core/maybe.js\";\nimport { setDeepValue as d } from \"../../../core/object.js\";\nimport { dataComponents as c } from \"../../../core/urlUtils.js\";\nimport { property as h } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as p } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport y from \"../../../geometry/Extent.js\";\nimport { fromJSON as m } from \"../../../geometry/support/jsonUtils.js\";\nimport { createDrawingInfo as f } from \"./support/clientSideDefaults.js\";\nimport { processAttachmentQueryResult as g } from \"../../../rest/query/operations/queryAttachments.js\";\nimport { unapplyEditsZUnitScaling as F } from \"../../../rest/query/operations/zscale.js\";\nimport R from \"../../../tasks/QueryTask.js\";\nimport b from \"../../../geometry/SpatialReference.js\";\nconst q = new o({\n  originalAndCurrentFeatures: \"original-and-current-features\",\n  none: \"none\"\n});\n\nasync function _(e) {\n  if (\"string\" == typeof e) {\n    const t = c(e);\n    return t || {\n      data: e\n    };\n  }\n\n  return new Promise((t, r) => {\n    const s = new FileReader();\n    s.readAsDataURL(e), s.onload = () => t(c(s.result)), s.onerror = e => r(e);\n  });\n}\n\nconst I = new Set([\"Feature Layer\", \"Table\"]);\nlet O = class extends u {\n  constructor() {\n    super(...arguments), this.type = \"feature-layer\";\n  }\n\n  load(e) {\n    const t = n(e) ? e.signal : null;\n    return this.addResolvingPromise(this._fetchService(t)), Promise.resolve(this);\n  }\n\n  get queryTask() {\n    const {\n      capabilities: {\n        query: {\n          supportsFormatPBF: e\n        }\n      },\n      parsedUrl: t,\n      dynamicDataSource: r,\n      infoFor3D: s,\n      gdbVersion: a,\n      spatialReference: o,\n      fieldsIndex: u\n    } = this.layer,\n          n = i(\"featurelayer-pbf\") && e && l(s) ? \"pbf\" : \"json\";\n    return new R({\n      url: t.path,\n      format: n,\n      fieldsIndex: u,\n      infoFor3D: s,\n      dynamicDataSource: r,\n      gdbVersion: a,\n      sourceSpatialReference: o\n    });\n  }\n\n  async addAttachment(e, t) {\n    await this.load();\n\n    const s = e.attributes[this.layer.objectIdField],\n          a = this.layer.parsedUrl.path + \"/\" + s + \"/addAttachment\",\n          i = this._getLayerRequestOptions(),\n          o = this._getFormDataForAttachment(t, i.query);\n\n    try {\n      const e = await r(a, {\n        body: o\n      });\n      return this._createFeatureEditResult(e.data.addAttachmentResult);\n    } catch (u) {\n      throw this._createAttachmentErrorResult(s, u);\n    }\n  }\n\n  async updateAttachment(e, t, s) {\n    await this.load();\n\n    const a = e.attributes[this.layer.objectIdField],\n          i = this.layer.parsedUrl.path + \"/\" + a + \"/updateAttachment\",\n          o = this._getLayerRequestOptions({\n      query: {\n        attachmentId: t\n      }\n    }),\n          u = this._getFormDataForAttachment(s, o.query);\n\n    try {\n      const e = await r(i, {\n        body: u\n      });\n      return this._createFeatureEditResult(e.data.updateAttachmentResult);\n    } catch (n) {\n      throw this._createAttachmentErrorResult(a, n);\n    }\n  }\n\n  async applyEdits(e, t) {\n    await this.load();\n\n    const s = e.addFeatures.map(this._serializeFeature, this),\n          a = e.updateFeatures.map(this._serializeFeature, this),\n          i = this._getFeatureIds(e.deleteFeatures, null == t ? void 0 : t.globalIdUsed);\n\n    F(s, a, this.layer.spatialReference);\n    const o = [],\n          u = [],\n          n = [...e.deleteAttachments];\n\n    for (const r of e.addAttachments) o.push(await this._serializeAttachment(r));\n\n    for (const r of e.updateAttachments) u.push(await this._serializeAttachment(r));\n\n    const l = o.length || u.length || n.length ? {\n      adds: o,\n      updates: u,\n      deletes: n\n    } : null,\n          d = {\n      gdbVersion: (null == t ? void 0 : t.gdbVersion) || this.layer.gdbVersion,\n      rollbackOnFailure: null == t ? void 0 : t.rollbackOnFailureEnabled,\n      useGlobalIds: null == t ? void 0 : t.globalIdUsed,\n      returnEditMoment: null == t ? void 0 : t.returnEditMoment,\n      usePreviousEditMoment: null == t ? void 0 : t.usePreviousEditMoment,\n      sessionId: null == t ? void 0 : t.sessionId\n    };\n    null != t && t.returnServiceEditsOption ? (d.edits = JSON.stringify([{\n      id: this.layer.layerId,\n      adds: s,\n      updates: a,\n      deletes: i,\n      attachments: l\n    }]), d.returnServiceEditsOption = q.toJSON(null == t ? void 0 : t.returnServiceEditsOption), d.returnServiceEditsInSourceSR = null == t ? void 0 : t.returnServiceEditsInSourceSR) : (d.adds = s.length ? JSON.stringify(s) : null, d.updates = a.length ? JSON.stringify(a) : null, d.deletes = i.length ? null != t && t.globalIdUsed ? JSON.stringify(i) : i.join(\",\") : null, d.attachments = l && JSON.stringify(l));\n\n    const c = this._getLayerRequestOptions({\n      method: \"post\",\n      query: d\n    }),\n          h = null != t && t.returnServiceEditsOption ? this.layer.url : this.layer.parsedUrl.path,\n          p = await r(h + \"/applyEdits\", c);\n\n    return this._createEditsResult(p);\n  }\n\n  async deleteAttachments(e, t) {\n    await this.load();\n    const s = e.attributes[this.layer.objectIdField],\n          a = this.layer.parsedUrl.path + \"/\" + s + \"/deleteAttachments\";\n\n    try {\n      return (await r(a, this._getLayerRequestOptions({\n        query: {\n          attachmentIds: t.join(\",\")\n        },\n        method: \"post\"\n      }))).data.deleteAttachmentResults.map(this._createFeatureEditResult);\n    } catch (i) {\n      throw this._createAttachmentErrorResult(s, i);\n    }\n  }\n\n  fetchRecomputedExtents(e = {}) {\n    const t = e.signal;\n    return this.load({\n      signal: t\n    }).then(async () => {\n      const t = this._getLayerRequestOptions({ ...e,\n        query: {\n          returnUpdates: !0\n        }\n      }),\n            {\n        layerId: a,\n        url: i\n      } = this.layer,\n            {\n        data: o\n      } = await r(`${i}/${a}`, t),\n            {\n        id: u,\n        extent: n,\n        fullExtent: l,\n        timeExtent: d\n      } = o,\n            c = n || l;\n\n      return {\n        id: u,\n        fullExtent: c && y.fromJSON(c),\n        timeExtent: d && s.fromJSON({\n          start: d[0],\n          end: d[1]\n        })\n      };\n    });\n  }\n\n  async queryAttachments(e, t = {}) {\n    const {\n      parsedUrl: s\n    } = this.layer,\n          a = s.path;\n    await this.load();\n\n    const i = this._getLayerRequestOptions(t);\n\n    if (!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")) {\n      const {\n        objectIds: t\n      } = e,\n            s = [];\n\n      for (const e of t) {\n        const t = a + \"/\" + e + \"/attachments\";\n        s.push(r(t, i));\n      }\n\n      return Promise.all(s).then(e => t.map((t, r) => ({\n        parentObjectId: t,\n        attachmentInfos: e[r].data.attachmentInfos\n      }))).then(e => g(e, a));\n    }\n\n    return this.queryTask.executeAttachmentQuery(e, i);\n  }\n\n  async queryFeatures(e, t) {\n    return await this.load(), this.queryTask.execute(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryFeaturesJSON(e, t) {\n    return await this.load(), this.queryTask.executeJSON(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryObjectIds(e, t) {\n    return await this.load(), this.queryTask.executeForIds(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryFeatureCount(e, t) {\n    return await this.load(), this.queryTask.executeForCount(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryExtent(e, t) {\n    return await this.load(), this.queryTask.executeForExtent(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryRelatedFeatures(e, t) {\n    return await this.load(), this.queryTask.executeRelationshipQuery(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryRelatedFeaturesCount(e, t) {\n    return await this.load(), this.queryTask.executeRelationshipQueryForCount(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopFeatures(e, t) {\n    return await this.load(), this.queryTask.executeTopFeaturesQuery(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopObjectIds(e, t) {\n    return await this.load(), this.queryTask.executeForTopIds(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopExtents(e, t) {\n    return await this.load(), this.queryTask.executeForTopExtents(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopCount(e, t) {\n    return await this.load(), this.queryTask.executeForTopCount(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  _createRequestQueryOptions(e) {\n    return { ...this.layer.customParameters,\n      token: this.layer.apiKey,\n      ...(null == e ? void 0 : e.query)\n    };\n  }\n\n  async _fetchService(e) {\n    let t = this.layer.sourceJSON;\n\n    if (!t) {\n      const {\n        data: s\n      } = await r(this.layer.parsedUrl.path, this._getLayerRequestOptions({\n        query: i(\"featurelayer-advanced-symbols\") ? {\n          returnAdvancedSymbols: !0\n        } : {},\n        signal: e\n      }));\n      t = s;\n    }\n\n    this.sourceJSON = this._patchServiceJSON(t);\n    const s = t.type;\n    if (!I.has(s)) throw new a(\"feature-layer-source:unsupported-type\", `Source type \"${s}\" is not supported`);\n  }\n\n  _patchServiceJSON(e) {\n    var t;\n\n    if (\"Table\" !== e.type && e.geometryType && (null == e || null == (t = e.drawingInfo) || !t.renderer) && !e.defaultSymbol) {\n      const t = f(e.geometryType).renderer;\n      d(\"drawingInfo.renderer\", t, e);\n    }\n\n    return \"esriGeometryMultiPatch\" === e.geometryType && e.infoFor3D && (e.geometryType = \"mesh\"), e;\n  }\n\n  _serializeFeature(e) {\n    const {\n      geometry: t,\n      attributes: r\n    } = e;\n    return l(t) ? {\n      attributes: r\n    } : \"mesh\" === t.type || \"extent\" === t.type ? null : {\n      geometry: t.toJSON(),\n      attributes: r\n    };\n  }\n\n  async _serializeAttachment(e) {\n    const {\n      feature: t,\n      attachment: r\n    } = e,\n          {\n      globalId: s,\n      name: a,\n      contentType: i,\n      data: o,\n      uploadId: u\n    } = r,\n          n = {\n      globalId: s,\n      parentGlobalId: null,\n      contentType: null,\n      name: null,\n      uploadId: null,\n      data: null\n    };\n    if (t && (n.parentGlobalId = \"attributes\" in t ? t.attributes && t.attributes[this.layer.globalIdField] : t.globalId), u) n.uploadId = u;else if (o) {\n      const e = await _(o);\n      n.contentType = e.mediaType, n.data = e.data, o instanceof File && (n.name = o.name);\n    }\n    return a && (n.name = a), i && (n.contentType = i), n;\n  }\n\n  _getFeatureIds(e, t) {\n    const r = e[0];\n    return r ? this._canUseGlobalIds(t, e) ? this._getGlobalIdsFromFeatureIdentifier(e) : \"objectId\" in r ? this._getObjectIdsFromFeatureIdentifier(e) : this._getIdsFromFeatures(e) : [];\n  }\n\n  _getIdsFromFeatures(e) {\n    const t = this.layer.objectIdField;\n    return e.map(e => e.attributes && e.attributes[t]);\n  }\n\n  _canUseGlobalIds(e, t) {\n    return e && \"globalId\" in t[0];\n  }\n\n  _getObjectIdsFromFeatureIdentifier(e) {\n    return e.map(e => e.objectId);\n  }\n\n  _getGlobalIdsFromFeatureIdentifier(e) {\n    return e.map(e => e.globalId);\n  }\n\n  _createEditsResult(e) {\n    var t;\n    const r = e.data,\n          {\n      layerId: s\n    } = this.layer,\n          a = [];\n    let i = null;\n    if (Array.isArray(r)) for (const n of r) a.push({\n      id: n.id,\n      editedFeatures: n.editedFeatures\n    }), n.id === s && (i = {\n      addResults: n.addResults,\n      updateResults: n.updateResults,\n      deleteResults: n.deleteResults,\n      attachments: n.attachments,\n      editMoment: n.editMoment\n    });else i = r;\n    const o = null == (t = i) ? void 0 : t.attachments,\n          u = {\n      addFeatureResults: i.addResults ? i.addResults.map(this._createFeatureEditResult, this) : [],\n      updateFeatureResults: i.updateResults ? i.updateResults.map(this._createFeatureEditResult, this) : [],\n      deleteFeatureResults: i.deleteResults ? i.deleteResults.map(this._createFeatureEditResult, this) : [],\n      addAttachmentResults: o && o.addResults ? o.addResults.map(this._createFeatureEditResult, this) : [],\n      updateAttachmentResults: o && o.updateResults ? o.updateResults.map(this._createFeatureEditResult, this) : [],\n      deleteAttachmentResults: o && o.deleteResults ? o.deleteResults.map(this._createFeatureEditResult, this) : []\n    };\n\n    if (i.editMoment && (u.editMoment = i.editMoment), a.length > 0) {\n      u.editedFeatureResults = [];\n\n      for (const e of a) {\n        const {\n          adds: t,\n          updates: r,\n          deletes: s,\n          spatialReference: a\n        } = e.editedFeatures,\n              i = a ? new b(a) : null;\n        u.editedFeatureResults.push({\n          layerId: e.id,\n          editedFeatures: {\n            adds: (null == t ? void 0 : t.map(e => this._createEditedFeature(e, i))) || [],\n            updates: (null == r ? void 0 : r.map(e => ({\n              original: this._createEditedFeature(e[0], i),\n              current: this._createEditedFeature(e[1], i)\n            }))) || [],\n            deletes: (null == s ? void 0 : s.map(e => this._createEditedFeature(e, i))) || [],\n            spatialReference: i\n          }\n        });\n      }\n    }\n\n    return u;\n  }\n\n  _createEditedFeature(e, r) {\n    return new t({\n      attributes: e.attributes,\n      geometry: m({ ...e.geometry,\n        spatialReference: r\n      })\n    });\n  }\n\n  _createFeatureEditResult(e) {\n    const t = !0 === e.success ? null : e.error || {\n      code: void 0,\n      description: void 0\n    };\n    return {\n      objectId: e.objectId,\n      globalId: e.globalId,\n      error: t ? new a(\"feature-layer-source:edit-failure\", t.description, {\n        code: t.code\n      }) : null\n    };\n  }\n\n  _createAttachmentErrorResult(e, t) {\n    const r = t.details.messages && t.details.messages[0] || t.message,\n          s = t.details.httpStatus || t.details.messageCode;\n    return {\n      objectId: e,\n      globalId: null,\n      error: new a(\"feature-layer-source:attachment-failure\", r, {\n        code: s\n      })\n    };\n  }\n\n  _getFormDataForAttachment(e, t) {\n    const r = e instanceof FormData ? e : e && e.elements ? new FormData(e) : null;\n    if (r) for (const s in t) {\n      const e = t[s];\n      null != e && (r.set ? r.set(s, e) : r.append(s, e));\n    }\n    return r;\n  }\n\n  _getLayerRequestOptions(e = {}) {\n    const {\n      parsedUrl: t,\n      gdbVersion: r,\n      dynamicDataSource: s\n    } = this.layer;\n    return { ...e,\n      query: {\n        gdbVersion: r,\n        layer: s ? JSON.stringify({\n          source: s\n        }) : void 0,\n        ...t.query,\n        f: \"json\",\n        ...this._createRequestQueryOptions(e)\n      },\n      responseType: \"json\"\n    };\n  }\n\n};\ne([h()], O.prototype, \"type\", void 0), e([h({\n  constructOnly: !0\n})], O.prototype, \"layer\", void 0), e([h({\n  readOnly: !0\n})], O.prototype, \"queryTask\", null), O = e([p(\"esri.layers.graphics.sources.FeatureLayerSource\")], O);\nvar j = O;\nexport default j;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js"],"names":["_","e","t","r","s","a","i","JSONMap","o","u","isSome","n","isNone","l","setDeepValue","d","dataComponents","c","property","h","subclass","p","y","fromJSON","m","createDrawingInfo","f","processAttachmentQueryResult","g","unapplyEditsZUnitScaling","F","R","b","q","originalAndCurrentFeatures","none","data","Promise","FileReader","readAsDataURL","onload","result","onerror","I","Set","O","constructor","arguments","type","load","signal","addResolvingPromise","_fetchService","resolve","queryTask","capabilities","query","supportsFormatPBF","parsedUrl","dynamicDataSource","infoFor3D","gdbVersion","spatialReference","fieldsIndex","layer","url","path","format","sourceSpatialReference","addAttachment","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","body","_createFeatureEditResult","addAttachmentResult","_createAttachmentErrorResult","updateAttachment","attachmentId","updateAttachmentResult","applyEdits","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","globalIdUsed","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","length","adds","updates","deletes","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","returnEditMoment","usePreviousEditMoment","sessionId","returnServiceEditsOption","edits","JSON","stringify","id","layerId","attachments","toJSON","returnServiceEditsInSourceSR","join","method","_createEditsResult","attachmentIds","deleteAttachmentResults","fetchRecomputedExtents","then","returnUpdates","extent","fullExtent","timeExtent","start","end","queryAttachments","get","objectIds","all","parentObjectId","attachmentInfos","executeAttachmentQuery","queryFeatures","execute","_createRequestQueryOptions","queryFeaturesJSON","executeJSON","queryObjectIds","executeForIds","queryFeatureCount","executeForCount","queryExtent","executeForExtent","queryRelatedFeatures","executeRelationshipQuery","queryRelatedFeaturesCount","executeRelationshipQueryForCount","queryTopFeatures","executeTopFeaturesQuery","queryTopObjectIds","executeForTopIds","queryTopExtents","executeForTopExtents","queryTopCount","executeForTopCount","customParameters","token","apiKey","sourceJSON","returnAdvancedSymbols","_patchServiceJSON","has","geometryType","drawingInfo","renderer","defaultSymbol","geometry","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","mediaType","File","_canUseGlobalIds","_getGlobalIdsFromFeatureIdentifier","_getObjectIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","Array","isArray","editedFeatures","addResults","updateResults","deleteResults","editMoment","addFeatureResults","updateFeatureResults","deleteFeatureResults","addAttachmentResults","updateAttachmentResults","editedFeatureResults","_createEditedFeature","original","current","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","responseType","prototype","constructOnly","readOnly","j"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../Graphic.js\";import r from\"../../../request.js\";import s from\"../../../TimeExtent.js\";import a from\"../../../core/Error.js\";import i from\"../../../core/has.js\";import{JSONMap as o}from\"../../../core/jsonMap.js\";import u from\"../../../core/Loadable.js\";import{isSome as n,isNone as l}from\"../../../core/maybe.js\";import{setDeepValue as d}from\"../../../core/object.js\";import{dataComponents as c}from\"../../../core/urlUtils.js\";import{property as h}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import y from\"../../../geometry/Extent.js\";import{fromJSON as m}from\"../../../geometry/support/jsonUtils.js\";import{createDrawingInfo as f}from\"./support/clientSideDefaults.js\";import{processAttachmentQueryResult as g}from\"../../../rest/query/operations/queryAttachments.js\";import{unapplyEditsZUnitScaling as F}from\"../../../rest/query/operations/zscale.js\";import R from\"../../../tasks/QueryTask.js\";import b from\"../../../geometry/SpatialReference.js\";const q=new o({originalAndCurrentFeatures:\"original-and-current-features\",none:\"none\"});async function _(e){if(\"string\"==typeof e){const t=c(e);return t||{data:e}}return new Promise(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(c(s.result)),s.onerror=e=>r(e)}))}const I=new Set([\"Feature Layer\",\"Table\"]);let O=class extends u{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=n(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,infoFor3D:s,gdbVersion:a,spatialReference:o,fieldsIndex:u}=this.layer,n=i(\"featurelayer-pbf\")&&e&&l(s)?\"pbf\":\"json\";return new R({url:t.path,format:n,fieldsIndex:u,infoFor3D:s,dynamicDataSource:r,gdbVersion:a,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+s+\"/addAttachment\",i=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,i.query);try{const e=await r(a,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(s,u)}}async updateAttachment(e,t,s){await this.load();const a=e.attributes[this.layer.objectIdField],i=this.layer.parsedUrl.path+\"/\"+a+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),u=this._getFormDataForAttachment(s,o.query);try{const e=await r(i,{body:u});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(n){throw this._createAttachmentErrorResult(a,n)}}async applyEdits(e,t){await this.load();const s=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),i=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);F(s,a,this.layer.spatialReference);const o=[],u=[],n=[...e.deleteAttachments];for(const r of e.addAttachments)o.push(await this._serializeAttachment(r));for(const r of e.updateAttachments)u.push(await this._serializeAttachment(r));const l=o.length||u.length||n.length?{adds:o,updates:u,deletes:n}:null,d={gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,sessionId:null==t?void 0:t.sessionId};null!=t&&t.returnServiceEditsOption?(d.edits=JSON.stringify([{id:this.layer.layerId,adds:s,updates:a,deletes:i,attachments:l}]),d.returnServiceEditsOption=q.toJSON(null==t?void 0:t.returnServiceEditsOption),d.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(d.adds=s.length?JSON.stringify(s):null,d.updates=a.length?JSON.stringify(a):null,d.deletes=i.length?null!=t&&t.globalIdUsed?JSON.stringify(i):i.join(\",\"):null,d.attachments=l&&JSON.stringify(l));const c=this._getLayerRequestOptions({method:\"post\",query:d}),h=null!=t&&t.returnServiceEditsOption?this.layer.url:this.layer.parsedUrl.path,p=await r(h+\"/applyEdits\",c);return this._createEditsResult(p)}async deleteAttachments(e,t){await this.load();const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+s+\"/deleteAttachments\";try{return(await r(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(i){throw this._createAttachmentErrorResult(s,i)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:a,url:i}=this.layer,{data:o}=await r(`${i}/${a}`,t),{id:u,extent:n,fullExtent:l,timeExtent:d}=o,c=n||l;return{id:u,fullExtent:c&&y.fromJSON(c),timeExtent:d&&s.fromJSON({start:d[0],end:d[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:s}=this.layer,a=s.path;await this.load();const i=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,s=[];for(const e of t){const t=a+\"/\"+e+\"/attachments\";s.push(r(t,i))}return Promise.all(s).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>g(e,a)))}return this.queryTask.executeAttachmentQuery(e,i)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}_createRequestQueryOptions(e){return{...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query}}async _fetchService(e){let t=this.layer.sourceJSON;if(!t){const{data:s}=await r(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:i(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));t=s}this.sourceJSON=this._patchServiceJSON(t);const s=t.type;if(!I.has(s))throw new a(\"feature-layer-source:unsupported-type\",`Source type \"${s}\" is not supported`)}_patchServiceJSON(e){var t;if(\"Table\"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=f(e.geometryType).renderer;d(\"drawingInfo.renderer\",t,e)}return\"esriGeometryMultiPatch\"===e.geometryType&&e.infoFor3D&&(e.geometryType=\"mesh\"),e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return l(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:a,contentType:i,data:o,uploadId:u}=r,n={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(n.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),u)n.uploadId=u;else if(o){const e=await _(o);n.contentType=e.mediaType,n.data=e.data,o instanceof File&&(n.name=o.name)}return a&&(n.name=a),i&&(n.contentType=i),n}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):\"objectId\"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&\"globalId\"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){var t;const r=e.data,{layerId:s}=this.layer,a=[];let i=null;if(Array.isArray(r))for(const n of r)a.push({id:n.id,editedFeatures:n.editedFeatures}),n.id===s&&(i={addResults:n.addResults,updateResults:n.updateResults,deleteResults:n.deleteResults,attachments:n.attachments,editMoment:n.editMoment});else i=r;const o=null==(t=i)?void 0:t.attachments,u={addFeatureResults:i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:o&&o.addResults?o.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:o&&o.updateResults?o.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:o&&o.deleteResults?o.deleteResults.map(this._createFeatureEditResult,this):[]};if(i.editMoment&&(u.editMoment=i.editMoment),a.length>0){u.editedFeatureResults=[];for(const e of a){const{adds:t,updates:r,deletes:s,spatialReference:a}=e.editedFeatures,i=a?new b(a):null;u.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null==t?void 0:t.map((e=>this._createEditedFeature(e,i))))||[],updates:(null==r?void 0:r.map((e=>({original:this._createEditedFeature(e[0],i),current:this._createEditedFeature(e[1],i)}))))||[],deletes:(null==s?void 0:s.map((e=>this._createEditedFeature(e,i))))||[],spatialReference:i}})}}return u}_createEditedFeature(e,r){return new t({attributes:e.attributes,geometry:m({...e.geometry,spatialReference:r})})}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new a(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new a(\"feature-layer-source:attachment-failure\",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const s in t){const e=t[s];null!=e&&(r.set?r.set(s,e):r.append(s,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:{gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:\"json\",...this._createRequestQueryOptions(e)},responseType:\"json\"}}};e([h()],O.prototype,\"type\",void 0),e([h({constructOnly:!0})],O.prototype,\"layer\",void 0),e([h({readOnly:!0})],O.prototype,\"queryTask\",null),O=e([p(\"esri.layers.graphics.sources.FeatureLayerSource\")],O);var j=O;export default j;\n"]},"metadata":{},"sourceType":"module"}