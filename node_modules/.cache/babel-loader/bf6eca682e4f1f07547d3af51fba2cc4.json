{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { disposeMaybe as t, abortMaybe as s, isNone as e } from \"../../../core/maybe.js\";\nimport i from \"../../../core/ObjectPool.js\";\nimport a from \"../../../core/PooledArray.js\";\nimport { releaseTileData as n } from \"./terrainUtils.js\";\nimport { computeUpsampleInfo as o } from \"./tileUtils.js\";\n\nclass l {\n  constructor() {\n    this.waitingAgents = new a(), this._upsampleInfo = null, this.loadingAgent = null, this.requestPromise = null, this.requestAbort = null, this.pendingUpdates = 0;\n  }\n\n  static acquire(t) {\n    const s = p.acquire();\n    return s._init(t), s;\n  }\n\n  release() {\n    this.dispose(), r.delete(this), p.release(this);\n  }\n\n  dispose() {\n    this.loadingAgent = t(this.loadingAgent), this.abortRequest(), this._unsetUpsampleInfo(), this.pendingUpdates = 0, this._data = n(this._data);\n  }\n\n  static prune() {\n    p.prune(0);\n  }\n\n  _init(t) {\n    this.waitingAgents.clear(), this._data = n(this._data), this.dataMissing = !1, this.dataInvalidated = !1, this._unsetUpsampleInfo(), this.abortRequest(), this.loadingAgent = null, this.pendingUpdates = 0, this._pool = t, this.elevationBounds = null;\n  }\n\n  invalidateSourceData() {\n    this.dataInvalidated = !0, this.dataMissing = !1, this._unsetUpsampleInfo();\n  }\n\n  abortRequest() {\n    this.requestAbort = s(this.requestAbort), this.requestPromise = null;\n  }\n\n  get upsampleInfo() {\n    return this._upsampleInfo;\n  }\n\n  _unsetUpsampleInfo() {\n    this._upsampleInfo && (this._upsampleInfo.tile.unrefMapData(), this._pool.release(this._upsampleInfo), this._upsampleInfo = null);\n  }\n\n  setUpsampleInfo(t, s) {\n    if (t === s || e(s)) this._unsetUpsampleInfo();else {\n      if (null == this._upsampleInfo) this._upsampleInfo = this._pool.acquire();else {\n        if (this._upsampleInfo.tile === s) return;\n\n        this._upsampleInfo.tile.unrefMapData();\n      }\n      s.refMapData(), o(t, s, this._upsampleInfo);\n    }\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  set data(t) {\n    n(this._data), this._data = t;\n  }\n\n}\n\nconst p = new i(l, null, () => {}),\n      r = new Map();\n\nfunction h() {\n  r.size > 0 && (console.log(`${r.size} live TilePerLayerInfo allocations:`), r.forEach(t => console.log(t, \"\\n\")));\n}\n\nexport { l as TilePerLayerInfo, h as printAllocations };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/terrain/TilePerLayerInfo.js"],"names":["disposeMaybe","t","abortMaybe","s","isNone","e","i","a","releaseTileData","n","computeUpsampleInfo","o","l","constructor","waitingAgents","_upsampleInfo","loadingAgent","requestPromise","requestAbort","pendingUpdates","acquire","p","_init","release","dispose","r","delete","abortRequest","_unsetUpsampleInfo","_data","prune","clear","dataMissing","dataInvalidated","_pool","elevationBounds","invalidateSourceData","upsampleInfo","tile","unrefMapData","setUpsampleInfo","refMapData","data","Map","h","size","console","log","forEach","TilePerLayerInfo","printAllocations"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t,abortMaybe as s,isNone as e}from\"../../../core/maybe.js\";import i from\"../../../core/ObjectPool.js\";import a from\"../../../core/PooledArray.js\";import{releaseTileData as n}from\"./terrainUtils.js\";import{computeUpsampleInfo as o}from\"./tileUtils.js\";class l{constructor(){this.waitingAgents=new a,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const s=p.acquire();return s._init(t),s}release(){this.dispose(),r.delete(this),p.release(this)}dispose(){this.loadingAgent=t(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=n(this._data)}static prune(){p.prune(0)}_init(t){this.waitingAgents.clear(),this._data=n(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=s(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,s){if(t===s||e(s))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===s)return;this._upsampleInfo.tile.unrefMapData()}s.refMapData(),o(t,s,this._upsampleInfo)}}get data(){return this._data}set data(t){n(this._data),this._data=t}}const p=new i(l,null,(()=>{})),r=new Map;function h(){r.size>0&&(console.log(`${r.size} live TilePerLayerInfo allocations:`),r.forEach((t=>console.log(t,\"\\n\"))))}export{l as TilePerLayerInfo,h as printAllocations};\n"]},"metadata":{},"sourceType":"module"}