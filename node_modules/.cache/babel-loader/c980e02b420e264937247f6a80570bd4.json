{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { c as e } from \"../../../../chunks/mat3f64.js\";\nimport { s as t, g as i, n as s, f as a, l as r, a as n, d as o, t as l } from \"../../../../chunks/vec3.js\";\nimport { c as u, f as c } from \"../../../../chunks/vec3f64.js\";\nimport { newLayout as h } from \"../../support/buffer/InterleavedLayout.js\";\nimport { defaultMaskAlphaCutoff as d } from \"../core/shaderLibrary/util/AlphaDiscard.glsl.js\";\nimport p from \"../lib/GLMaterialTexture.js\";\nimport { Material as m, materialParametersDefaults as f } from \"../lib/Material.js\";\nimport { OITPolygonOffsetLimit as v } from \"../lib/OrderIndependentTransparency.js\";\nimport { getVerticalOffsetObject3D as g } from \"../lib/verticalOffsetUtils.js\";\nimport { writeDefaultAttributes as C } from \"./internal/bufferWriterUtils.js\";\nimport { verticalOffsetAtDistance as b, intersectTriangleGeometry as x } from \"./internal/MaterialUtil.js\";\nimport { DefaultMaterialTechniqueConfiguration as q, DefaultMaterialTechnique as S } from \"../shaders/DefaultMaterialTechnique.js\";\nimport { RealisticTreeTechnique as T } from \"../shaders/RealisticTreeTechnique.js\";\n\nclass y extends m {\n  constructor(e) {\n    super(e, O), this.supportsEdges = !0, this.techniqueConfig = new q(), this.vertexBufferLayout = y.getVertexBufferLayout(this.params), this.instanceBufferLayout = e.instanced ? y.getInstanceBufferLayout(this.params) : null;\n  }\n\n  isVisibleInPass(e) {\n    return 4 !== e && 6 !== e && 7 !== e || this.params.castShadows;\n  }\n\n  isVisible() {\n    const e = this.params;\n    if (!super.isVisible() || 0 === e.layerOpacity) return !1;\n    const t = e.instanced,\n          i = e.vertexColors,\n          s = e.symbolColors,\n          a = !!t && t.indexOf(\"color\") > -1,\n          r = e.vvColorEnabled,\n          n = \"replace\" === e.colorMixMode,\n          o = e.opacity > 0,\n          l = e.externalColor && e.externalColor[3] > 0;\n    return i && (a || r || s) ? !!n || o : i ? n ? l : o : a || r || s ? !!n || o : n ? l : o;\n  }\n\n  getTechniqueConfig(e, t) {\n    return this.techniqueConfig.output = e, this.techniqueConfig.hasNormalTexture = !!this.params.normalTextureId, this.techniqueConfig.hasColorTexture = !!this.params.textureId, this.techniqueConfig.vertexTangents = this.params.vertexTangents, this.techniqueConfig.instanced = !!this.params.instanced, this.techniqueConfig.instancedDoublePrecision = this.params.instancedDoublePrecision, this.techniqueConfig.vvSize = this.params.vvSizeEnabled, this.techniqueConfig.verticalOffset = null !== this.params.verticalOffset, this.techniqueConfig.screenSizePerspective = null !== this.params.screenSizePerspective, this.techniqueConfig.slicePlaneEnabled = this.params.slicePlaneEnabled, this.techniqueConfig.sliceHighlightDisabled = this.params.sliceHighlightDisabled, this.techniqueConfig.alphaDiscardMode = this.params.textureAlphaMode, this.techniqueConfig.normalsTypeDerivate = \"screenDerivative\" === this.params.normals, this.techniqueConfig.transparent = this.params.transparent, this.techniqueConfig.writeDepth = this.params.writeDepth, this.techniqueConfig.sceneHasOcludees = this.params.sceneHasOcludees, this.techniqueConfig.cullFace = this.params.slicePlaneEnabled ? 0 : this.params.cullFace, this.techniqueConfig.multipassTerrainEnabled = !!t && t.multipassTerrainEnabled, this.techniqueConfig.cullAboveGround = !!t && t.cullAboveGround, 0 !== e && 7 !== e || (this.techniqueConfig.vertexColors = this.params.vertexColors, this.techniqueConfig.symbolColors = this.params.symbolColors, this.params.treeRendering ? this.techniqueConfig.doubleSidedMode = 2 : this.techniqueConfig.doubleSidedMode = this.params.doubleSided && \"normal\" === this.params.doubleSidedType ? 1 : this.params.doubleSided && \"winding-order\" === this.params.doubleSidedType ? 2 : 0, this.techniqueConfig.instancedColor = !!this.params.instanced && this.params.instanced.indexOf(\"color\") > -1, this.techniqueConfig.receiveShadows = this.params.receiveShadows && this.params.shadowMappingEnabled, this.techniqueConfig.receiveAmbientOcclusion = !(!t || !t.ssaoEnabled) && this.params.receiveSSAO, this.techniqueConfig.vvColor = this.params.vvColorEnabled, this.techniqueConfig.textureAlphaPremultiplied = !!this.params.textureAlphaPremultiplied, this.techniqueConfig.usePBR = this.params.usePBR, this.techniqueConfig.hasMetalnessAndRoughnessTexture = !!this.params.metallicRoughnessTextureId, this.techniqueConfig.hasEmissionTexture = !!this.params.emissiveTextureId, this.techniqueConfig.hasOcclusionTexture = !!this.params.occlusionTextureId, this.techniqueConfig.offsetBackfaces = !(!this.params.transparent || !this.params.offsetTransparentBackfaces), this.techniqueConfig.isSchematic = this.params.usePBR && this.params.isSchematic, this.techniqueConfig.transparencyPassType = t ? t.transparencyPassType : 3, this.techniqueConfig.enableOffset = !t || t.camera.relativeElevation < v), this.techniqueConfig;\n  }\n\n  intersect(e, u, c, h, d, p, m) {\n    if (null !== this.params.verticalOffset) {\n      const e = h.camera;\n      t(A, c[12], c[13], c[14]);\n      let u = null;\n\n      switch (h.viewingMode) {\n        case 1:\n          u = s(E, A);\n          break;\n\n        case 2:\n          u = i(E, B);\n      }\n\n      let m = 0;\n\n      if (null !== this.params.verticalOffset) {\n        const t = a(L, A, e.eye),\n              i = r(t),\n              s = n(t, t, 1 / i);\n        let l = null;\n        this.params.screenSizePerspective && (l = o(u, s)), m += b(e, i, this.params.verticalOffset, l, this.params.screenSizePerspective);\n      }\n\n      n(u, u, m), l(I, u, h.transform.inverseRotation), d = a(w, d, I), p = a(_, p, I);\n    }\n\n    x(e, u, h, d, p, g(h.verticalOffset), m);\n  }\n\n  getGLMaterial(e) {\n    if (0 === e.output || 7 === e.output || 1 === e.output || 2 === e.output || 3 === e.output || 4 === e.output) return new P(e);\n  }\n\n  createBufferWriter() {\n    return new M(this.vertexBufferLayout, this.instanceBufferLayout);\n  }\n\n  static getVertexBufferLayout(e) {\n    const t = e.textureId || e.normalTextureId || e.metallicRoughnessTextureId || e.emissiveTextureId || e.occlusionTextureId,\n          i = h().vec3f(\"position\").vec3f(\"normal\");\n    return e.vertexTangents && i.vec4f(\"tangent\"), t && i.vec2f(\"uv0\"), e.vertexColors && i.vec4u8(\"color\"), e.symbolColors && i.vec4u8(\"symbolColor\"), i;\n  }\n\n  static getInstanceBufferLayout(e) {\n    let t = h();\n    return t = e.instancedDoublePrecision ? t.vec3f(\"modelOriginHi\").vec3f(\"modelOriginLo\").mat3f(\"model\").mat3f(\"modelNormal\") : t.mat4f(\"model\").mat4f(\"modelNormal\"), e.instanced && e.instanced.indexOf(\"color\") > -1 && (t = t.vec4f(\"instanceColor\")), e.instanced && e.instanced.indexOf(\"featureAttribute\") > -1 && (t = t.vec4f(\"instanceFeatureAttribute\")), t;\n  }\n\n}\n\nclass P extends p {\n  constructor(e) {\n    const t = e.material;\n    super({ ...e,\n      ...t.params\n    }), this.updateParameters();\n  }\n\n  updateParameters(e) {\n    const t = this._material.params;\n    this.updateTexture(t.textureId), this._technique = this._techniqueRep.releaseAndAcquire(t.treeRendering ? T : S, this._material.getTechniqueConfig(this._output, e), this._technique);\n  }\n\n  selectPipelines() {}\n\n  _updateShadowState(e) {\n    e.shadowMappingEnabled !== this._material.params.shadowMappingEnabled && this._material.setParameterValues({\n      shadowMappingEnabled: e.shadowMappingEnabled\n    });\n  }\n\n  _updateOccludeeState(e) {\n    e.hasOccludees !== this._material.params.sceneHasOcludees && this._material.setParameterValues({\n      sceneHasOcludees: e.hasOccludees\n    });\n  }\n\n  ensureParameters(e) {\n    0 !== this._output && 7 !== this._output || (this._updateShadowState(e), this._updateOccludeeState(e)), this.updateParameters(e);\n  }\n\n  bind(e) {\n    this._technique.bindPass(this._material.params, e), this.bindTextures(this._technique.program);\n  }\n\n  beginSlot(e) {\n    return e === (this._material.params.transparent ? this._material.params.writeDepth ? 5 : 8 : 3);\n  }\n\n  getPipelineState(e, t) {\n    return this._technique.getPipelineState(t);\n  }\n\n}\n\nconst O = {\n  textureId: void 0,\n  initTextureTransparent: !1,\n  isSchematic: !1,\n  usePBR: !1,\n  normalTextureId: void 0,\n  vertexTangents: !1,\n  occlusionTextureId: void 0,\n  emissiveTextureId: void 0,\n  metallicRoughnessTextureId: void 0,\n  emissiveFactor: [0, 0, 0],\n  mrrFactors: [0, 1, .5],\n  ambient: [.2, .2, .2],\n  diffuse: [.8, .8, .8],\n  externalColor: [1, 1, 1, 1],\n  colorMixMode: \"multiply\",\n  opacity: 1,\n  layerOpacity: 1,\n  vertexColors: !1,\n  symbolColors: !1,\n  doubleSided: !1,\n  doubleSidedType: \"normal\",\n  cullFace: 2,\n  instanced: void 0,\n  instancedDoublePrecision: !1,\n  normals: \"default\",\n  receiveSSAO: !0,\n  receiveShadows: !0,\n  castShadows: !0,\n  shadowMappingEnabled: !1,\n  verticalOffset: null,\n  screenSizePerspective: null,\n  slicePlaneEnabled: !1,\n  sliceHighlightDisabled: !1,\n  offsetTransparentBackfaces: !1,\n  vvSizeEnabled: !1,\n  vvSizeMinSize: [1, 1, 1],\n  vvSizeMaxSize: [100, 100, 100],\n  vvSizeOffset: [0, 0, 0],\n  vvSizeFactor: [1, 1, 1],\n  vvSizeValue: [1, 1, 1],\n  vvColorEnabled: !1,\n  vvColorValues: [0, 0, 0, 0, 0, 0, 0, 0],\n  vvColorColors: [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],\n  vvSymbolAnchor: [0, 0, 0],\n  vvSymbolRotationMatrix: e(),\n  transparent: !1,\n  writeDepth: !0,\n  textureAlphaMode: 0,\n  textureAlphaCutoff: d,\n  textureAlphaPremultiplied: !1,\n  sceneHasOcludees: !1,\n  ...f\n};\n\nclass M {\n  constructor(e, t) {\n    this.vertexBufferLayout = e, this.instanceBufferLayout = t;\n  }\n\n  allocate(e) {\n    return this.vertexBufferLayout.createBuffer(e);\n  }\n\n  elementCount(e) {\n    return e.indices.get(\"position\").length;\n  }\n\n  write(e, t, i, s) {\n    C(t, this.vertexBufferLayout, e.transformation, e.invTranspTransformation, i, s);\n  }\n\n}\n\nconst w = u(),\n      _ = u(),\n      B = c(0, 0, 1),\n      E = u(),\n      I = u(),\n      A = u(),\n      L = u();\n\nexport { y as DefaultMaterial };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultMaterial.js"],"names":["c","e","s","t","g","i","n","f","a","l","r","d","o","u","newLayout","h","defaultMaskAlphaCutoff","p","Material","m","materialParametersDefaults","OITPolygonOffsetLimit","v","getVerticalOffsetObject3D","writeDefaultAttributes","C","verticalOffsetAtDistance","b","intersectTriangleGeometry","x","DefaultMaterialTechniqueConfiguration","q","DefaultMaterialTechnique","S","RealisticTreeTechnique","T","y","constructor","O","supportsEdges","techniqueConfig","vertexBufferLayout","getVertexBufferLayout","params","instanceBufferLayout","instanced","getInstanceBufferLayout","isVisibleInPass","castShadows","isVisible","layerOpacity","vertexColors","symbolColors","indexOf","vvColorEnabled","colorMixMode","opacity","externalColor","getTechniqueConfig","output","hasNormalTexture","normalTextureId","hasColorTexture","textureId","vertexTangents","instancedDoublePrecision","vvSize","vvSizeEnabled","verticalOffset","screenSizePerspective","slicePlaneEnabled","sliceHighlightDisabled","alphaDiscardMode","textureAlphaMode","normalsTypeDerivate","normals","transparent","writeDepth","sceneHasOcludees","cullFace","multipassTerrainEnabled","cullAboveGround","treeRendering","doubleSidedMode","doubleSided","doubleSidedType","instancedColor","receiveShadows","shadowMappingEnabled","receiveAmbientOcclusion","ssaoEnabled","receiveSSAO","vvColor","textureAlphaPremultiplied","usePBR","hasMetalnessAndRoughnessTexture","metallicRoughnessTextureId","hasEmissionTexture","emissiveTextureId","hasOcclusionTexture","occlusionTextureId","offsetBackfaces","offsetTransparentBackfaces","isSchematic","transparencyPassType","enableOffset","camera","relativeElevation","intersect","A","viewingMode","E","B","L","eye","I","transform","inverseRotation","w","_","getGLMaterial","P","createBufferWriter","M","vec3f","vec4f","vec2f","vec4u8","mat3f","mat4f","material","updateParameters","_material","updateTexture","_technique","_techniqueRep","releaseAndAcquire","_output","selectPipelines","_updateShadowState","setParameterValues","_updateOccludeeState","hasOccludees","ensureParameters","bind","bindPass","bindTextures","program","beginSlot","getPipelineState","initTextureTransparent","emissiveFactor","mrrFactors","ambient","diffuse","vvSizeMinSize","vvSizeMaxSize","vvSizeOffset","vvSizeFactor","vvSizeValue","vvColorValues","vvColorColors","vvSymbolAnchor","vvSymbolRotationMatrix","textureAlphaCutoff","allocate","createBuffer","elementCount","indices","get","length","write","transformation","invTranspTransformation","DefaultMaterial"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{c as e}from\"../../../../chunks/mat3f64.js\";import{s as t,g as i,n as s,f as a,l as r,a as n,d as o,t as l}from\"../../../../chunks/vec3.js\";import{c as u,f as c}from\"../../../../chunks/vec3f64.js\";import{newLayout as h}from\"../../support/buffer/InterleavedLayout.js\";import{defaultMaskAlphaCutoff as d}from\"../core/shaderLibrary/util/AlphaDiscard.glsl.js\";import p from\"../lib/GLMaterialTexture.js\";import{Material as m,materialParametersDefaults as f}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as v}from\"../lib/OrderIndependentTransparency.js\";import{getVerticalOffsetObject3D as g}from\"../lib/verticalOffsetUtils.js\";import{writeDefaultAttributes as C}from\"./internal/bufferWriterUtils.js\";import{verticalOffsetAtDistance as b,intersectTriangleGeometry as x}from\"./internal/MaterialUtil.js\";import{DefaultMaterialTechniqueConfiguration as q,DefaultMaterialTechnique as S}from\"../shaders/DefaultMaterialTechnique.js\";import{RealisticTreeTechnique as T}from\"../shaders/RealisticTreeTechnique.js\";class y extends m{constructor(e){super(e,O),this.supportsEdges=!0,this.techniqueConfig=new q,this.vertexBufferLayout=y.getVertexBufferLayout(this.params),this.instanceBufferLayout=e.instanced?y.getInstanceBufferLayout(this.params):null}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}isVisible(){const e=this.params;if(!super.isVisible()||0===e.layerOpacity)return!1;const t=e.instanced,i=e.vertexColors,s=e.symbolColors,a=!!t&&t.indexOf(\"color\")>-1,r=e.vvColorEnabled,n=\"replace\"===e.colorMixMode,o=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return i&&(a||r||s)?!!n||o:i?n?l:o:a||r||s?!!n||o:n?l:o}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate=\"screenDerivative\"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&\"normal\"===this.params.doubleSidedType?1:this.params.doubleSided&&\"winding-order\"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf(\"color\")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<v),this.techniqueConfig}intersect(e,u,c,h,d,p,m){if(null!==this.params.verticalOffset){const e=h.camera;t(A,c[12],c[13],c[14]);let u=null;switch(h.viewingMode){case 1:u=s(E,A);break;case 2:u=i(E,B)}let m=0;if(null!==this.params.verticalOffset){const t=a(L,A,e.eye),i=r(t),s=n(t,t,1/i);let l=null;this.params.screenSizePerspective&&(l=o(u,s)),m+=b(e,i,this.params.verticalOffset,l,this.params.screenSizePerspective)}n(u,u,m),l(I,u,h.transform.inverseRotation),d=a(w,d,I),p=a(_,p,I)}x(e,u,h,d,p,g(h.verticalOffset),m)}getGLMaterial(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new P(e)}createBufferWriter(){return new M(this.vertexBufferLayout,this.instanceBufferLayout)}static getVertexBufferLayout(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=h().vec3f(\"position\").vec3f(\"normal\");return e.vertexTangents&&i.vec4f(\"tangent\"),t&&i.vec2f(\"uv0\"),e.vertexColors&&i.vec4u8(\"color\"),e.symbolColors&&i.vec4u8(\"symbolColor\"),i}static getInstanceBufferLayout(e){let t=h();return t=e.instancedDoublePrecision?t.vec3f(\"modelOriginHi\").vec3f(\"modelOriginLo\").mat3f(\"model\").mat3f(\"modelNormal\"):t.mat4f(\"model\").mat4f(\"modelNormal\"),e.instanced&&e.instanced.indexOf(\"color\")>-1&&(t=t.vec4f(\"instanceColor\")),e.instanced&&e.instanced.indexOf(\"featureAttribute\")>-1&&(t=t.vec4f(\"instanceFeatureAttribute\")),t}}class P extends p{constructor(e){const t=e.material;super({...e,...t.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(t.treeRendering?T:S,this._material.getTechniqueConfig(this._output,e),this._technique)}selectPipelines(){}_updateShadowState(e){e.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.params,e),this.bindTextures(this._technique.program)}beginSlot(e){return e===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const O={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:\"multiply\",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:\"normal\",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:\"default\",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:e(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:d,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...f};class M{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(\"position\").length}write(e,t,i,s){C(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,s)}}const w=u(),_=u(),B=c(0,0,1),E=u(),I=u(),A=u(),L=u();export{y as DefaultMaterial};\n"]},"metadata":{},"sourceType":"module"}