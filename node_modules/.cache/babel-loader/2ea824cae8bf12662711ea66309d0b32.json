{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport r from \"../../../../core/Evented.js\";\nimport s from \"../../../../core/has.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { isNone as o } from \"../../../../core/maybe.js\";\nimport { addFrameTask as n } from \"../../../../core/scheduling.js\";\nimport { Milliseconds as a } from \"../../../../core/time.js\";\nimport { init as d } from \"../../../../core/watchUtils.js\";\nimport { property as p } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as h } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { DESIRED_ANIMATION_MS as c } from \"../../support/animationUtils.js\";\nimport { ComponentObjectCollection as l } from \"../collections/Component/ComponentObjectCollection.js\";\nimport { ShaderTechniqueRepository as u } from \"../core/shaderTechnique/ShaderTechniqueRepository.js\";\nimport { AutoDisposableMixin as m, autoDispose as _ } from \"../lib/AutoDisposable.js\";\nimport g from \"../lib/CompositingHelper.js\";\nimport { textureToDepth as f } from \"../lib/depthRangeUtils.js\";\nimport y from \"../lib/GLMaterialRep.js\";\nimport { MagnifierHelper as x } from \"../lib/MagnifierHelper.js\";\nimport R from \"../lib/Renderer.js\";\nimport { TextureRepository as b } from \"../lib/TextureRepository.js\";\nimport { clearTestWebGLDriver as v, testWebGLDriver as w } from \"../lib/WebGLDriverTest.js\";\nimport { StippleTextureRepository as j } from \"../materials/StippleTextureRepository.js\";\nimport { WaterTextureRepository as T } from \"../materials/internal/WaterTextureRepository.js\";\nimport { removeLoadedShaderModules as U } from \"./requireUtils.js\";\nimport { ScreenshotManager as C } from \"./ScreenshotManager.js\";\nimport { createContextOrErrorHTML as S } from \"../../../webgl/context-util.js\";\nimport M from \"../../../webgl/RenderingContext.js\";\nconst L = i.getLogger(\"esri.views.3d.webgl-engine.parts.View\");\nlet O = class extends m(t) {\n  constructor(e) {\n    super({}), this.events = new r(), this.waterTextureRepository = new T(), this._magnifierHelper = new x(), this._componentObjectCollection = null, this._needsUpdate = !0, this._needsRender = !0, this._idleSuspend = !0, this._needsWaterReflectionUpdate = !1, this._logicUpdateLast = 0, this._container = e.container, this._initializeContext(e.options), d(this.waterTextureRepository, \"loadingState\", () => this.setNeedsRender()), this._magnifierHelper.events.on(\"request-render\", () => this.setNeedsRender()), this._stippleTextureRepository = new j(this._rctx), this._shaderTechniqueRepository = new u({\n      rctx: this._rctx,\n      viewingMode: e.viewingMode,\n      stippleTextureRepository: this._stippleTextureRepository,\n      waterTextureRepository: this.waterTextureRepository\n    }), this._textureRepository = new b(e, this._shaderTechniqueRepository, this._rctx), this._textureRepository.events.on(\"changed\", e => this.setNeedsRender(e)), this._materialRepository = new y(this._textureRepository, this._shaderTechniqueRepository, () => this.setNeedsRender()), this._compositingHelper = new g(this._rctx, this._shaderTechniqueRepository), this._renderer = new R(this._materialRepository, this._textureRepository, this._shaderTechniqueRepository, this._rctx, this._compositingHelper, this._magnifierHelper, (e = 1) => this.setNeedsRender(e), (t, r) => e.schedule(t, r), e), this._screenshotManager = new C(this._rctx, (e, t, r) => this._renderer.render(e, t, t, r), () => this.setNeedsRender(), e.options.screenshot.renderOverlay, e => this.events.emit(\"force-camera-for-screenshot\", e)), this._registerFrameTask(e);\n  }\n\n  normalizeCtorArgs() {\n    return {};\n  }\n\n  dispose() {\n    this._container.contains(this._canvas) && this._container.removeChild(this._canvas), this._frameTask && (this._frameTask.remove(), this._frameTask = null), this._shaderTechniqueRepository.dispose(), this._shaderTechniqueRepository = null, v(this._rctx), super.dispose(), this._tmpDepthBuffer = null, this._rctx = null;\n  }\n\n  get performanceInfo() {\n    const e = this._rctx.gl;\n    return {\n      renderer: this._renderer.performanceInfo,\n      textureMemory: void 0 !== e.getUsedTextureMemory ? e.getUsedTextureMemory() : void 0,\n      renderbufferMemory: void 0 !== e.getUsedRenderbufferMemory ? e.getUsedRenderbufferMemory() : void 0,\n      VBOMemory: void 0 !== e.getUsedVBOMemory ? e.getUsedVBOMemory() : void 0\n    };\n  }\n\n  setNeedsRender(e = 1) {\n    1 === e ? this._needsUpdate || (this._needsUpdate = !0, this.notifyChange(\"updating\")) : this._needsRender = !0;\n  }\n\n  get needsUpdate() {\n    return this._needsUpdate;\n  }\n\n  get updating() {\n    return this.evaluateUpdating();\n  }\n\n  evaluateUpdating() {\n    return this.needsUpdate || this._needsWaterReflectionUpdate || this._renderer.updating || this._textureRepository.updating || this.waterTextureRepository.updating || this._magnifierHelper.updating;\n  }\n\n  ensureEdgeView() {\n    return this._renderer.ensureEdgeView();\n  }\n\n  get edgeView() {\n    return this._renderer.edgeView;\n  }\n\n  get textureRepository() {\n    return this._textureRepository;\n  }\n\n  get compositingHelper() {\n    return this._compositingHelper;\n  }\n\n  set magnifier(e) {\n    this._magnifierHelper.magnifier = e;\n  }\n\n  updateLightSources(e, t, r) {\n    this._renderer.updateLightSources(e, t, r), this.setNeedsRender();\n  }\n\n  setRenderParameters(e) {\n    void 0 !== e.idleSuspend && this._idleSuspend !== !!e.idleSuspend && (this._idleSuspend = !!e.idleSuspend, this.setNeedsRender()), this._renderer.setRenderParameters(e);\n  }\n\n  get renderingContext() {\n    return this._rctx;\n  }\n\n  has(e) {\n    switch (e) {\n      case 0:\n        return !!this._rctx.capabilities.compressedTextureETC;\n\n      case 1:\n        return !!this._rctx.capabilities.compressedTextureS3TC;\n\n      case 2:\n        return !!this._rctx.capabilities.shaderTextureLOD;\n\n      case 3:\n        return this._renderer.hasShadowsEnabled;\n\n      default:\n        return !1;\n    }\n  }\n\n  modify(e) {\n    this._renderer.modify(e), e.clear();\n  }\n\n  get canvas() {\n    return this._canvas;\n  }\n\n  takeScreenshot(e) {\n    return this._screenshotManager.takeScreenshot(e);\n  }\n\n  readAccumulatedShadow(e) {\n    return this._renderer.readAccumulatedShadow(e[0], e[1]);\n  }\n\n  getMinimalDepthForArea(e, t, r, s, i = s) {\n    const o = r.constrainWindowSize(e, t, s * r.pixelRatio, i * r.pixelRatio),\n          n = this._ensureDepthBuffer(o);\n\n    this._renderer.readDepthPixels(r, o[0], o[1], o[2], o[3], n);\n\n    let a = Number.MAX_VALUE;\n\n    for (let d = 0; d < o[2] * o[3]; d++) {\n      const e = f(4 * d, n, r.nearFar);\n      a > e && e !== r.nearFar[0] && e !== r.nearFar[1] && (a = e);\n    }\n\n    return a === Number.MAX_VALUE ? void 0 : a;\n  }\n\n  _ensureDepthBuffer(e) {\n    const t = 4 * e[2] * e[3];\n    return (o(this._tmpDepthBuffer) || this._tmpDepthBuffer.byteLength < t) && (this._tmpDepthBuffer = new Uint8Array(t)), this._tmpDepthBuffer;\n  }\n\n  get renderPlugins() {\n    return this._renderer.renderPlugins;\n  }\n\n  get test() {\n    return {\n      renderer: this._renderer\n    };\n  }\n\n  getGpuMemoryUsage() {\n    return this._renderer.getGpuMemoryUsage();\n  }\n\n  async hotReloadShaders() {\n    U(), await this._shaderTechniqueRepository.hotReload(), this.setNeedsRender();\n  }\n\n  _registerFrameTask(e) {\n    const t = e.state,\n          r = {\n      viewCamera: t.camera,\n      frameHasDecorations: !1\n    };\n    let s = !1;\n    const i = {\n      preRender: r => {\n        s = this.evaluateUpdating(), e.processSyncLayers();\n        const i = a(r.time - this._logicUpdateLast);\n\n        if (i > c) {\n          const e = {\n            camera: t.camera,\n            dt: i\n          };\n          this._logicUpdateLast = r.time, this._renderer.updateLogic(e) && this.setNeedsRender(0);\n        }\n      },\n      render: () => {\n        if ((this.needsUpdate || this._needsRender || !this._idleSuspend || !this._renderer.isCameraFinal || this._needsWaterReflectionUpdate) && t.camera.fullWidth > 0 && t.camera.fullHeight > 0) {\n          const e = this._needsUpdate && this._idleSuspend && this._renderer.isCameraFinal;\n          this._needsRender = !1, this._needsUpdate = !1, this._needsWaterReflectionUpdate = !1, this._renderer.render(null, t.camera, t.contentCamera, !1), e && this._renderer.hasWaterReflection && (this.setNeedsRender(0), this._needsWaterReflectionUpdate = !0);\n        }\n      },\n      postRender: () => {\n        s === this.updating && s === this.evaluateUpdating() || this.notifyChange(\"updating\");\n      },\n      update: () => {\n        r.viewCamera = t.camera, r.frameHasDecorations = this._renderer.hasSlicePlane || this._magnifierHelper.enabled, this._textureRepository.update(), this._screenshotManager.update(r);\n      }\n    };\n    this._frameTask = n(i);\n  }\n\n  _initializeContext(e) {\n    this._canvas = e.canvas, this._canvas || (this._canvas = document.createElement(\"canvas\")), this._canvas.setAttribute(\"style\", \"width: 100%; height:100%; display:block;\");\n    const t = {\n      alpha: e.alpha || !1,\n      premultipliedAlpha: !0,\n      antialias: !1,\n      depth: !0,\n      stencil: null == e.stencil || e.stencil,\n      powerPreference: \"high-performance\"\n    },\n          r = S(this._canvas, t, e.renderContext),\n          i = {\n      disabledExtensions: e.deactivatedWebGLExtensions || {},\n      debugWebGLExtensions: e.debugWebGLExtensions || {},\n      maxAnisotropy: 8\n    };\n    this._rctx = new M(r, i), w(this._rctx), this._loadShaderOnlyExtensions(this._rctx), !e.alpha && this._rctx.contextAttributes.alpha && L.error(\"WebGL context has alpha channel even though no alpha channel was requested\"), !this._rctx.contextAttributes.alpha && s(\"safari\") >= 11 && (this._container.style.backgroundColor = \"black\"), this._container.appendChild(this._canvas);\n  }\n\n  _loadShaderOnlyExtensions(e) {\n    const t = e.capabilities;\n    t.enable(\"standardDerivatives\"), t.enable(\"shaderTextureLOD\"), t.enable(\"textureFloat\");\n  }\n\n  get componentObjectCollection() {\n    return o(this._componentObjectCollection) && (this._componentObjectCollection = new l(this._renderer.renderPassManager)), this._componentObjectCollection;\n  }\n\n  set componentObjectCollection(e) {\n    this._componentObjectCollection = e;\n  }\n\n};\ne([p({\n  type: Boolean,\n  readOnly: !0\n})], O.prototype, \"updating\", null), e([_()], O.prototype, \"_rctx\", void 0), e([_()], O.prototype, \"_container\", void 0), e([_()], O.prototype, \"_canvas\", void 0), e([_()], O.prototype, \"_stippleTextureRepository\", void 0), e([_(), p()], O.prototype, \"waterTextureRepository\", void 0), e([_(), p()], O.prototype, \"_magnifierHelper\", void 0), e([_(), p()], O.prototype, \"_textureRepository\", void 0), e([_()], O.prototype, \"_compositingHelper\", void 0), e([_()], O.prototype, \"_renderer\", void 0), e([_()], O.prototype, \"_screenshotManager\", void 0), e([_()], O.prototype, \"componentObjectCollection\", null), e([_()], O.prototype, \"_componentObjectCollection\", void 0), O = e([h(\"esri.views.3d.webgl-engine.parts.RenderView\")], O);\nexport { O as RenderView };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/parts/RenderView.js"],"names":["_","e","t","r","s","i","isNone","o","addFrameTask","n","Milliseconds","a","init","d","property","p","subclass","h","DESIRED_ANIMATION_MS","c","ComponentObjectCollection","l","ShaderTechniqueRepository","u","AutoDisposableMixin","m","autoDispose","g","textureToDepth","f","y","MagnifierHelper","x","R","TextureRepository","b","clearTestWebGLDriver","v","testWebGLDriver","w","StippleTextureRepository","j","WaterTextureRepository","T","removeLoadedShaderModules","U","ScreenshotManager","C","createContextOrErrorHTML","S","M","L","getLogger","O","constructor","events","waterTextureRepository","_magnifierHelper","_componentObjectCollection","_needsUpdate","_needsRender","_idleSuspend","_needsWaterReflectionUpdate","_logicUpdateLast","_container","container","_initializeContext","options","setNeedsRender","on","_stippleTextureRepository","_rctx","_shaderTechniqueRepository","rctx","viewingMode","stippleTextureRepository","_textureRepository","_materialRepository","_compositingHelper","_renderer","schedule","_screenshotManager","render","screenshot","renderOverlay","emit","_registerFrameTask","normalizeCtorArgs","dispose","contains","_canvas","removeChild","_frameTask","remove","_tmpDepthBuffer","performanceInfo","gl","renderer","textureMemory","getUsedTextureMemory","renderbufferMemory","getUsedRenderbufferMemory","VBOMemory","getUsedVBOMemory","notifyChange","needsUpdate","updating","evaluateUpdating","ensureEdgeView","edgeView","textureRepository","compositingHelper","magnifier","updateLightSources","setRenderParameters","idleSuspend","renderingContext","has","capabilities","compressedTextureETC","compressedTextureS3TC","shaderTextureLOD","hasShadowsEnabled","modify","clear","canvas","takeScreenshot","readAccumulatedShadow","getMinimalDepthForArea","constrainWindowSize","pixelRatio","_ensureDepthBuffer","readDepthPixels","Number","MAX_VALUE","nearFar","byteLength","Uint8Array","renderPlugins","test","getGpuMemoryUsage","hotReloadShaders","hotReload","state","viewCamera","camera","frameHasDecorations","preRender","processSyncLayers","time","dt","updateLogic","isCameraFinal","fullWidth","fullHeight","contentCamera","hasWaterReflection","postRender","update","hasSlicePlane","enabled","document","createElement","setAttribute","alpha","premultipliedAlpha","antialias","depth","stencil","powerPreference","renderContext","disabledExtensions","deactivatedWebGLExtensions","debugWebGLExtensions","maxAnisotropy","_loadShaderOnlyExtensions","contextAttributes","error","style","backgroundColor","appendChild","enable","componentObjectCollection","renderPassManager","type","Boolean","readOnly","prototype","RenderView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Evented.js\";import s from\"../../../../core/has.js\";import i from\"../../../../core/Logger.js\";import{isNone as o}from\"../../../../core/maybe.js\";import{addFrameTask as n}from\"../../../../core/scheduling.js\";import{Milliseconds as a}from\"../../../../core/time.js\";import{init as d}from\"../../../../core/watchUtils.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as h}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{DESIRED_ANIMATION_MS as c}from\"../../support/animationUtils.js\";import{ComponentObjectCollection as l}from\"../collections/Component/ComponentObjectCollection.js\";import{ShaderTechniqueRepository as u}from\"../core/shaderTechnique/ShaderTechniqueRepository.js\";import{AutoDisposableMixin as m,autoDispose as _}from\"../lib/AutoDisposable.js\";import g from\"../lib/CompositingHelper.js\";import{textureToDepth as f}from\"../lib/depthRangeUtils.js\";import y from\"../lib/GLMaterialRep.js\";import{MagnifierHelper as x}from\"../lib/MagnifierHelper.js\";import R from\"../lib/Renderer.js\";import{TextureRepository as b}from\"../lib/TextureRepository.js\";import{clearTestWebGLDriver as v,testWebGLDriver as w}from\"../lib/WebGLDriverTest.js\";import{StippleTextureRepository as j}from\"../materials/StippleTextureRepository.js\";import{WaterTextureRepository as T}from\"../materials/internal/WaterTextureRepository.js\";import{removeLoadedShaderModules as U}from\"./requireUtils.js\";import{ScreenshotManager as C}from\"./ScreenshotManager.js\";import{createContextOrErrorHTML as S}from\"../../../webgl/context-util.js\";import M from\"../../../webgl/RenderingContext.js\";const L=i.getLogger(\"esri.views.3d.webgl-engine.parts.View\");let O=class extends(m(t)){constructor(e){super({}),this.events=new r,this.waterTextureRepository=new T,this._magnifierHelper=new x,this._componentObjectCollection=null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._logicUpdateLast=0,this._container=e.container,this._initializeContext(e.options),d(this.waterTextureRepository,\"loadingState\",(()=>this.setNeedsRender())),this._magnifierHelper.events.on(\"request-render\",(()=>this.setNeedsRender())),this._stippleTextureRepository=new j(this._rctx),this._shaderTechniqueRepository=new u({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new b(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on(\"changed\",(e=>this.setNeedsRender(e))),this._materialRepository=new y(this._textureRepository,this._shaderTechniqueRepository,(()=>this.setNeedsRender())),this._compositingHelper=new g(this._rctx,this._shaderTechniqueRepository),this._renderer=new R(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,((e=1)=>this.setNeedsRender(e)),((t,r)=>e.schedule(t,r)),e),this._screenshotManager=new C(this._rctx,((e,t,r)=>this._renderer.render(e,t,t,r)),(()=>this.setNeedsRender()),e.options.screenshot.renderOverlay,(e=>this.events.emit(\"force-camera-for-screenshot\",e))),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null,v(this._rctx),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==e.getUsedTextureMemory?e.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==e.getUsedRenderbufferMemory?e.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==e.getUsedVBOMemory?e.getUsedVBOMemory():void 0}}setNeedsRender(e=1){1===e?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange(\"updating\")):this._needsRender=!0}get needsUpdate(){return this._needsUpdate}get updating(){return this.evaluateUpdating()}evaluateUpdating(){return this.needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,r){this._renderer.updateLightSources(e,t,r),this.setNeedsRender()}setRenderParameters(e){void 0!==e.idleSuspend&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.setNeedsRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}has(e){switch(e){case 0:return!!this._rctx.capabilities.compressedTextureETC;case 1:return!!this._rctx.capabilities.compressedTextureS3TC;case 2:return!!this._rctx.capabilities.shaderTextureLOD;case 3:return this._renderer.hasShadowsEnabled;default:return!1}}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}getMinimalDepthForArea(e,t,r,s,i=s){const o=r.constrainWindowSize(e,t,s*r.pixelRatio,i*r.pixelRatio),n=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o[0],o[1],o[2],o[3],n);let a=Number.MAX_VALUE;for(let d=0;d<o[2]*o[3];d++){const e=f(4*d,n,r.nearFar);a>e&&e!==r.nearFar[0]&&e!==r.nearFar[1]&&(a=e)}return a===Number.MAX_VALUE?void 0:a}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(o(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}getGpuMemoryUsage(){return this._renderer.getGpuMemoryUsage()}async hotReloadShaders(){U(),await this._shaderTechniqueRepository.hotReload(),this.setNeedsRender()}_registerFrameTask(e){const t=e.state,r={viewCamera:t.camera,frameHasDecorations:!1};let s=!1;const i={preRender:r=>{s=this.evaluateUpdating(),e.processSyncLayers();const i=a(r.time-this._logicUpdateLast);if(i>c){const e={camera:t.camera,dt:i};this._logicUpdateLast=r.time,this._renderer.updateLogic(e)&&this.setNeedsRender(0)}},render:()=>{if((this.needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const e=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,!1),e&&this._renderer.hasWaterReflection&&(this.setNeedsRender(0),this._needsWaterReflectionUpdate=!0)}},postRender:()=>{s===this.updating&&s===this.evaluateUpdating()||this.notifyChange(\"updating\")},update:()=>{r.viewCamera=t.camera,r.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(r)}};this._frameTask=n(i)}_initializeContext(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement(\"canvas\")),this._canvas.setAttribute(\"style\",\"width: 100%; height:100%; display:block;\");const t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil,powerPreference:\"high-performance\"},r=S(this._canvas,t,e.renderContext),i={disabledExtensions:e.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.debugWebGLExtensions||{},maxAnisotropy:8};this._rctx=new M(r,i),w(this._rctx),this._loadShaderOnlyExtensions(this._rctx),!e.alpha&&this._rctx.contextAttributes.alpha&&L.error(\"WebGL context has alpha channel even though no alpha channel was requested\"),!this._rctx.contextAttributes.alpha&&s(\"safari\")>=11&&(this._container.style.backgroundColor=\"black\"),this._container.appendChild(this._canvas)}_loadShaderOnlyExtensions(e){const t=e.capabilities;t.enable(\"standardDerivatives\"),t.enable(\"shaderTextureLOD\"),t.enable(\"textureFloat\")}get componentObjectCollection(){return o(this._componentObjectCollection)&&(this._componentObjectCollection=new l(this._renderer.renderPassManager)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};e([p({type:Boolean,readOnly:!0})],O.prototype,\"updating\",null),e([_()],O.prototype,\"_rctx\",void 0),e([_()],O.prototype,\"_container\",void 0),e([_()],O.prototype,\"_canvas\",void 0),e([_()],O.prototype,\"_stippleTextureRepository\",void 0),e([_(),p()],O.prototype,\"waterTextureRepository\",void 0),e([_(),p()],O.prototype,\"_magnifierHelper\",void 0),e([_(),p()],O.prototype,\"_textureRepository\",void 0),e([_()],O.prototype,\"_compositingHelper\",void 0),e([_()],O.prototype,\"_renderer\",void 0),e([_()],O.prototype,\"_screenshotManager\",void 0),e([_()],O.prototype,\"componentObjectCollection\",null),e([_()],O.prototype,\"_componentObjectCollection\",void 0),O=e([h(\"esri.views.3d.webgl-engine.parts.RenderView\")],O);export{O as RenderView};\n"]},"metadata":{},"sourceType":"module"}