{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../core/Error.js\";\nimport s from \"../../../core/Loadable.js\";\nimport { isNone as r, isSome as o } from \"../../../core/maybe.js\";\nimport { property as i } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as p } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { equals as n } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { queryFeatureSet as a, queryFeatureSetJSON as u, getSpatialReference as l, getServerLandingPage as c, getServerConformance as m, getServerCollections as d, getServerOpenApi as y, getCollectionDefinition as f } from \"../../ogc/ogcFeatureUtils.js\";\nimport h from \"../../../geometry/SpatialReference.js\";\nimport { typeKebabDictionary as g } from \"../../../geometry/support/typeUtils.js\";\nconst S = \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\";\nlet v = class extends s {\n  constructor() {\n    super(...arguments), this.featureDefinition = null, this.type = \"ogc-feature\";\n  }\n\n  load(e) {\n    return this.addResolvingPromise(this._loadOGCServices(this.layer, e)), this.when();\n  }\n\n  getFeatureDefinition() {\n    const {\n      featureDefinition: {\n        collection: e,\n        layerDefinition: t,\n        spatialReference: s,\n        supportedCrs: r\n      },\n      layer: {\n        apiKey: o,\n        capabilities: i,\n        customParameters: p\n      }\n    } = this;\n    return {\n      capabilities: i,\n      collection: e,\n      layerDefinition: t,\n      queryParameters: {\n        apiKey: o,\n        customParameters: p\n      },\n      spatialReference: s,\n      supportedCrs: r\n    };\n  }\n\n  queryExtent(e, t = {}) {\n    return null;\n  }\n\n  queryFeatureCount(e, t = {}) {\n    return null;\n  }\n\n  queryFeatures(e, t = {}) {\n    const s = this.getFeatureDefinition();\n    return this.load(t).then(() => a(s, e, t));\n  }\n\n  queryFeaturesJSON(e, t = {}) {\n    const s = this.getFeatureDefinition();\n    return this.load(t).then(() => u(s, e, t));\n  }\n\n  queryObjectIds(e, t = {}) {\n    return null;\n  }\n\n  supportsSpatialReference(e) {\n    return !(!e.isWGS84 && !e.isWebMercator) || this.featureDefinition.supportedCrs.some(t => {\n      const s = l(t);\n      return !r(s) && n(s, e);\n    });\n  }\n\n  _conformsToType(e, t) {\n    var s;\n    const r = new RegExp(`^${t}$`, \"i\");\n    return null != (s = e.conformsTo.some(e => r.test(e))) && s;\n  }\n\n  _getCapabilities(e, t) {\n    var s, r, i, p, n, a, u;\n    const l = o(t) ? null == (s = t.components) ? void 0 : s.parameters : null;\n    return {\n      attachment: null,\n      data: {\n        isVersioned: !1,\n        supportsAttachment: !1,\n        supportsM: !1,\n        supportsZ: e\n      },\n      metadata: {\n        supportsAdvancedFieldProperties: !1\n      },\n      operations: {\n        supportsCalculate: !1,\n        supportsTruncate: !1,\n        supportsValidateSql: !1,\n        supportsAdd: !1,\n        supportsDelete: !1,\n        supportsEditing: !1,\n        supportsChangeTracking: !1,\n        supportsQuery: !1,\n        supportsQueryAttachments: !1,\n        supportsResizeAttachments: !1,\n        supportsSync: !1,\n        supportsUpdate: !1,\n        supportsExceedsLimitStatistics: !1\n      },\n      query: {\n        maxRecordCount: null != (r = null != (i = null == l || null == (p = l.limit) || null == (n = p.schema) ? void 0 : n.maximum) ? i : null == l || null == (a = l.limitFeatures) || null == (u = a.schema) ? void 0 : u.maximum) ? r : 5e3,\n        maxRecordCountFactor: void 0,\n        standardMaxRecordCount: void 0,\n        supportsCacheHint: !1,\n        supportsCentroid: !1,\n        supportsDisjointSpatialRelationship: !1,\n        supportsDistance: !1,\n        supportsDistinct: !1,\n        supportsExtent: !1,\n        supportsFormatPBF: !1,\n        supportsGeometryProperties: !1,\n        supportsHavingClause: !1,\n        supportsHistoricMoment: !1,\n        supportsMaxRecordCountFactor: !1,\n        supportsOrderBy: !1,\n        supportsPagination: !1,\n        supportsPercentileStatistics: !1,\n        supportsQuantization: !1,\n        supportsQuantizationEditMode: !1,\n        supportsQueryByOthers: !1,\n        supportsQueryGeometry: !1,\n        supportsResultType: !1,\n        supportsStandardizedQueriesOnly: !1,\n        supportsTopFeaturesQuery: !1,\n        supportsStatistics: !1,\n        supportsSqlExpression: !1,\n        tileMaxRecordCount: void 0\n      },\n      queryRelated: {\n        supportsCount: !1,\n        supportsOrderBy: !1,\n        supportsPagination: !1\n      },\n      editing: {\n        supportsDeleteByAnonymous: !1,\n        supportsDeleteByOthers: !1,\n        supportsGeometryUpdate: !1,\n        supportsGlobalId: !1,\n        supportsReturnServiceEditsInSourceSpatialReference: !1,\n        supportsRollbackOnFailure: !1,\n        supportsUpdateByAnonymous: !1,\n        supportsUpdateByOthers: !1,\n        supportsUploadWithItemId: !1,\n        supportsUpdateWithoutM: !1\n      }\n    };\n  }\n\n  _getExtent(e) {\n    var t;\n    const s = null == (t = e.extent) ? void 0 : t.spatial;\n    if (!s) return null;\n    const r = s.bbox[0],\n          o = 4 === r.length,\n          i = r[0],\n          p = r[1],\n          n = o ? void 0 : r[2];\n    return {\n      xmin: i,\n      ymin: p,\n      xmax: o ? r[2] : r[3],\n      ymax: o ? r[3] : r[4],\n      zmin: n,\n      zmax: o ? void 0 : r[5],\n      spatialReference: h.WGS84.toJSON()\n    };\n  }\n\n  _getSpatialReference(e) {\n    var t;\n    const s = null != (t = e.storageCrs) ? t : S,\n          o = l(s);\n    return r(o) ? h.WGS84 : o;\n  }\n\n  _getSupportedSpatialReferences(e, t) {\n    var s;\n    const r = \"#/crs\",\n          o = null != (s = e.crs) ? s : [S],\n          i = o.includes(r) ? o.filter(e => e !== r).concat(t.crs) : o,\n          p = /^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/epsg\\/.*\\/3785$/i;\n    return i.filter(e => !p.test(e));\n  }\n\n  async _loadOGCServices(e, s) {\n    const r = o(s) ? s.signal : null,\n          {\n      apiKey: i,\n      collectionId: p,\n      customParameters: n,\n      fields: a,\n      geometryType: u,\n      hasZ: l,\n      objectIdField: h,\n      timeInfo: S,\n      url: v\n    } = e,\n          R = {\n      fields: null == a ? void 0 : a.map(e => e.toJSON()),\n      geometryType: g.toJSON(u),\n      hasZ: l,\n      objectIdField: h,\n      timeInfo: null == S ? void 0 : S.toJSON()\n    },\n          x = {\n      apiKey: i,\n      customParameters: n,\n      signal: r\n    },\n          C = await c(v, x),\n          [w, j] = await Promise.all([m(C, x), d(C, x)]);\n    if (!this._conformsToType(w, \"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson\")) throw new t(\"ogc-feature-layer:no-geojson-support\", \"Server does not support geojson\");\n    const O = j.collections.find(e => e.id === p);\n    if (!O) throw new t(\"ogc-feature-layer:collection-not-found\", \"Server does not contain the named collection\");\n\n    const F = this._conformsToType(w, \"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30\") ? await y(C, x) : null,\n          b = await f(O, R, x),\n          D = this._getCapabilities(b.hasZ, F),\n          P = this._getExtent(O),\n          T = this._getSpatialReference(O).toJSON(),\n          _ = this._getSupportedSpatialReferences(O, j);\n\n    b.extent = P, this.featureDefinition = {\n      capabilities: D,\n      collection: O,\n      layerDefinition: b,\n      queryParameters: {},\n      spatialReference: T,\n      supportedCrs: _\n    };\n  }\n\n};\ne([i()], v.prototype, \"featureDefinition\", void 0), e([i({\n  constructOnly: !0\n})], v.prototype, \"layer\", void 0), e([i()], v.prototype, \"type\", void 0), v = e([p(\"esri.layers.graphics.sources.OGCFeatureSource\")], v);\nvar R = v;\nexport default R;\nexport { v as OGCFeatureSource };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/graphics/sources/OGCFeatureSource.js"],"names":["_","e","t","s","isNone","r","isSome","o","property","i","subclass","p","equals","n","queryFeatureSet","a","queryFeatureSetJSON","u","getSpatialReference","l","getServerLandingPage","c","getServerConformance","m","getServerCollections","d","getServerOpenApi","y","getCollectionDefinition","f","h","typeKebabDictionary","g","S","v","constructor","arguments","featureDefinition","type","load","addResolvingPromise","_loadOGCServices","layer","when","getFeatureDefinition","collection","layerDefinition","spatialReference","supportedCrs","apiKey","capabilities","customParameters","queryParameters","queryExtent","queryFeatureCount","queryFeatures","then","queryFeaturesJSON","queryObjectIds","supportsSpatialReference","isWGS84","isWebMercator","some","_conformsToType","RegExp","conformsTo","test","_getCapabilities","components","parameters","attachment","data","isVersioned","supportsAttachment","supportsM","supportsZ","metadata","supportsAdvancedFieldProperties","operations","supportsCalculate","supportsTruncate","supportsValidateSql","supportsAdd","supportsDelete","supportsEditing","supportsChangeTracking","supportsQuery","supportsQueryAttachments","supportsResizeAttachments","supportsSync","supportsUpdate","supportsExceedsLimitStatistics","query","maxRecordCount","limit","schema","maximum","limitFeatures","maxRecordCountFactor","standardMaxRecordCount","supportsCacheHint","supportsCentroid","supportsDisjointSpatialRelationship","supportsDistance","supportsDistinct","supportsExtent","supportsFormatPBF","supportsGeometryProperties","supportsHavingClause","supportsHistoricMoment","supportsMaxRecordCountFactor","supportsOrderBy","supportsPagination","supportsPercentileStatistics","supportsQuantization","supportsQuantizationEditMode","supportsQueryByOthers","supportsQueryGeometry","supportsResultType","supportsStandardizedQueriesOnly","supportsTopFeaturesQuery","supportsStatistics","supportsSqlExpression","tileMaxRecordCount","queryRelated","supportsCount","editing","supportsDeleteByAnonymous","supportsDeleteByOthers","supportsGeometryUpdate","supportsGlobalId","supportsReturnServiceEditsInSourceSpatialReference","supportsRollbackOnFailure","supportsUpdateByAnonymous","supportsUpdateByOthers","supportsUploadWithItemId","supportsUpdateWithoutM","_getExtent","extent","spatial","bbox","length","xmin","ymin","xmax","ymax","zmin","zmax","WGS84","toJSON","_getSpatialReference","storageCrs","_getSupportedSpatialReferences","crs","includes","filter","concat","signal","collectionId","fields","geometryType","hasZ","objectIdField","timeInfo","url","R","map","x","C","w","j","Promise","all","O","collections","find","id","F","b","D","P","T","prototype","constructOnly","OGCFeatureSource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../core/Error.js\";import s from\"../../../core/Loadable.js\";import{isNone as r,isSome as o}from\"../../../core/maybe.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import{equals as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{queryFeatureSet as a,queryFeatureSetJSON as u,getSpatialReference as l,getServerLandingPage as c,getServerConformance as m,getServerCollections as d,getServerOpenApi as y,getCollectionDefinition as f}from\"../../ogc/ogcFeatureUtils.js\";import h from\"../../../geometry/SpatialReference.js\";import{typeKebabDictionary as g}from\"../../../geometry/support/typeUtils.js\";const S=\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\";let v=class extends s{constructor(){super(...arguments),this.featureDefinition=null,this.type=\"ogc-feature\"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getFeatureDefinition(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:s,supportedCrs:r},layer:{apiKey:o,capabilities:i,customParameters:p}}=this;return{capabilities:i,collection:e,layerDefinition:t,queryParameters:{apiKey:o,customParameters:p},spatialReference:s,supportedCrs:r}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){const s=this.getFeatureDefinition();return this.load(t).then((()=>a(s,e,t)))}queryFeaturesJSON(e,t={}){const s=this.getFeatureDefinition();return this.load(t).then((()=>u(s,e,t)))}queryObjectIds(e,t={}){return null}supportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator)||this.featureDefinition.supportedCrs.some((t=>{const s=l(t);return!r(s)&&n(s,e)}))}_conformsToType(e,t){var s;const r=new RegExp(`^${t}$`,\"i\");return null!=(s=e.conformsTo.some((e=>r.test(e))))&&s}_getCapabilities(e,t){var s,r,i,p,n,a,u;const l=o(t)?null==(s=t.components)?void 0:s.parameters:null;return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:null!=(r=null!=(i=null==l||null==(p=l.limit)||null==(n=p.schema)?void 0:n.maximum)?i:null==l||null==(a=l.limitFeatures)||null==(u=a.schema)?void 0:u.maximum)?r:5e3,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}}_getExtent(e){var t;const s=null==(t=e.extent)?void 0:t.spatial;if(!s)return null;const r=s.bbox[0],o=4===r.length,i=r[0],p=r[1],n=o?void 0:r[2];return{xmin:i,ymin:p,xmax:o?r[2]:r[3],ymax:o?r[3]:r[4],zmin:n,zmax:o?void 0:r[5],spatialReference:h.WGS84.toJSON()}}_getSpatialReference(e){var t;const s=null!=(t=e.storageCrs)?t:S,o=l(s);return r(o)?h.WGS84:o}_getSupportedSpatialReferences(e,t){var s;const r=\"#/crs\",o=null!=(s=e.crs)?s:[S],i=o.includes(r)?o.filter((e=>e!==r)).concat(t.crs):o,p=/^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/epsg\\/.*\\/3785$/i;return i.filter((e=>!p.test(e)))}async _loadOGCServices(e,s){const r=o(s)?s.signal:null,{apiKey:i,collectionId:p,customParameters:n,fields:a,geometryType:u,hasZ:l,objectIdField:h,timeInfo:S,url:v}=e,R={fields:null==a?void 0:a.map((e=>e.toJSON())),geometryType:g.toJSON(u),hasZ:l,objectIdField:h,timeInfo:null==S?void 0:S.toJSON()},x={apiKey:i,customParameters:n,signal:r},C=await c(v,x),[w,j]=await Promise.all([m(C,x),d(C,x)]);if(!this._conformsToType(w,\"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson\"))throw new t(\"ogc-feature-layer:no-geojson-support\",\"Server does not support geojson\");const O=j.collections.find((e=>e.id===p));if(!O)throw new t(\"ogc-feature-layer:collection-not-found\",\"Server does not contain the named collection\");const F=this._conformsToType(w,\"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30\")?await y(C,x):null,b=await f(O,R,x),D=this._getCapabilities(b.hasZ,F),P=this._getExtent(O),T=this._getSpatialReference(O).toJSON(),_=this._getSupportedSpatialReferences(O,j);b.extent=P,this.featureDefinition={capabilities:D,collection:O,layerDefinition:b,queryParameters:{},spatialReference:T,supportedCrs:_}}};e([i()],v.prototype,\"featureDefinition\",void 0),e([i({constructOnly:!0})],v.prototype,\"layer\",void 0),e([i()],v.prototype,\"type\",void 0),v=e([p(\"esri.layers.graphics.sources.OGCFeatureSource\")],v);var R=v;export default R;export{v as OGCFeatureSource};\n"]},"metadata":{},"sourceType":"module"}