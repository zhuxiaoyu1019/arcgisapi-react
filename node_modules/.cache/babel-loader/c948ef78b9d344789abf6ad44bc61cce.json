{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport { isSome as t, unwrap as i, unwrapOr as r } from \"../../../../core/maybe.js\";\nimport { bindSliceUniformsWithOrigin as o } from \"../core/shaderLibrary/Slice.glsl.js\";\nimport { bindOutputHighlight as s } from \"../core/shaderLibrary/output/OutputHighlight.glsl.js\";\nimport { bindMultipassTerrainTexture as n } from \"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";\nimport { bindVisualVariablesUniformsWithOpacity as l } from \"../core/shaderLibrary/shading/VisualVariables.glsl.js\";\nimport { bindProjectionMatrix as p, bindView as a } from \"../core/shaderLibrary/util/View.glsl.js\";\nimport { ReloadableShaderModule as d } from \"../core/shaderTechnique/ReloadableShaderModule.js\";\nimport { ShaderTechnique as c } from \"../core/shaderTechnique/ShaderTechnique.js\";\nimport { ShaderTechniqueConfiguration as u, parameter as h } from \"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";\nimport { blendingDefault as f, OITBlending as m, OITDepthTest as b, OITDepthWrite as g, OITPolygonOffset as v } from \"../lib/OrderIndependentTransparency.js\";\nimport { Program as y } from \"../lib/Program.js\";\nimport { stencilWriteMaskOn as T, stencilToolMaskBaseParams as E, stencilBaseAllZerosParams as P, depthCompareAlways as O, stencilToolTransparentOccluderParams as C, stencilWriteMaskOff as x, stencilToolMaskOccluderParams as j, depthCompareLess as S } from \"../lib/StencilUtils.js\";\nimport { R } from \"../../../../chunks/RibbonLine.glsl.js\";\nimport { makePipelineState as W, defaultDepthWriteParams as w, defaultColorWriteParams as U } from \"../../../webgl/renderState.js\";\nconst z = new Map([[\"position\", 0], [\"subdivisionFactor\", 1], [\"uv0\", 2], [\"auxpos1\", 3], [\"auxpos2\", 4], [\"size\", 6], [\"sizeFeatureAttribute\", 6], [\"color\", 5], [\"colorFeatureAttribute\", 5], [\"opacityFeatureAttribute\", 7]]);\n\nclass I extends c {\n  constructor(e, t, i) {\n    super(e, t, i), this.stippleTextureRepository = e.stippleTextureRepository;\n  }\n\n  initializeProgram(e) {\n    const t = I.shader.get(),\n          i = this.configuration,\n          r = t.build({\n      OITEnabled: 0 === i.transparencyPassType,\n      output: i.output,\n      slicePlaneEnabled: i.slicePlaneEnabled,\n      sliceHighlightDisabled: !1,\n      sliceEnabledForVertexPrograms: !1,\n      stippleEnabled: i.stippleEnabled,\n      stippleOffColorEnabled: i.stippleOffColorEnabled,\n      stippleUVMaxEnabled: i.stippleIntegerRepeatsEnabled,\n      stippleIntegerRepeatsEnabled: i.stippleIntegerRepeatsEnabled,\n      roundCaps: i.roundCaps,\n      roundJoins: i.roundJoins,\n      vvColor: i.vvColor,\n      vvSize: i.vvSize,\n      vvInstancingEnabled: !0,\n      vvOpacity: i.vvOpacity,\n      falloffEnabled: i.falloffEnabled,\n      innerColorEnabled: i.innerColorEnabled,\n      multipassTerrainEnabled: i.multipassTerrainEnabled,\n      cullAboveGround: i.cullAboveGround\n    });\n    return new y(e.rctx, r, z);\n  }\n\n  dispose() {\n    super.dispose(), this.stippleTextureRepository.release(this.stipplePattern), this.stipplePattern = null, this.stippleTextureBind = null;\n  }\n\n  bindPass(e, o) {\n    if (p(this.program, o.camera.projectionMatrix), 4 === this.configuration.output && s(this.program, o), o.multipassTerrainEnabled && (this.program.setUniform2fv(\"inverseViewport\", o.inverseViewport), n(this.program, o)), this.program.setUniform1f(\"intrinsicWidth\", e.width), this.program.setUniform4fv(\"intrinsicColor\", e.color), this.program.setUniform1f(\"miterLimit\", \"miter\" !== e.join ? 0 : e.miterLimit), this.program.setUniform2fv(\"cameraNearFar\", o.camera.nearFar), this.program.setUniform1f(\"pixelRatio\", o.camera.pixelRatio), this.program.setUniform2f(\"screenSize\", o.camera.fullViewport[2], o.camera.fullViewport[3]), l(this.program, e), this.stipplePattern !== e.stipplePattern) {\n      const t = e.stipplePattern;\n      this.stippleTextureBind = this.stippleTextureRepository.swap(this.stipplePattern, t), this.stipplePattern = t;\n    }\n\n    if (this.configuration.stippleEnabled) {\n      const r = t(this.stippleTextureBind) ? this.stippleTextureBind(this.program) * o.camera.pixelRatio : 1;\n\n      if (this.program.setUniform1f(\"stipplePatternPixelSizeInv\", 1 / r), this.configuration.stippleOffColorEnabled) {\n        const t = i(e.stippleOffColor);\n        this.program.setUniform4f(\"stippleOffColor\", t[0], t[1], t[2], t.length > 3 ? t[3] : 1);\n      }\n    }\n\n    this.configuration.falloffEnabled && this.program.setUniform1f(\"falloff\", e.falloff), this.configuration.innerColorEnabled && (this.program.setUniform4fv(\"innerColor\", r(e.innerColor, e.color)), this.program.setUniform1f(\"innerWidth\", e.innerWidth * o.camera.pixelRatio));\n  }\n\n  bindDraw(e) {\n    a(this.program, e), o(this.program, this.configuration, e), this.program.rebindTextures();\n  }\n\n  setPipelineState(e, t) {\n    const i = this.configuration,\n          r = 3 === e,\n          o = 2 === e;\n    return W({\n      blending: 0 === i.output || 7 === i.output ? r ? f : m(e) : null,\n      depthTest: {\n        func: b(e)\n      },\n      depthWrite: r ? !i.transparent && i.writeDepth && w : g(e),\n      colorWrite: U,\n      stencilWrite: i.sceneHasOcludees ? T : null,\n      stencilTest: i.sceneHasOcludees ? t ? E : P : null,\n      polygonOffset: r || o ? i.polygonOffset && L : v\n    });\n  }\n\n  initializePipeline() {\n    const e = this.configuration,\n          t = e.polygonOffset && L;\n    return e.occluder && (this._occluderPipelineTransparent = W({\n      blending: f,\n      polygonOffset: t,\n      depthTest: O,\n      depthWrite: null,\n      colorWrite: U,\n      stencilWrite: null,\n      stencilTest: C\n    }), this._occluderPipelineOpaque = W({\n      blending: f,\n      polygonOffset: t,\n      depthTest: O,\n      depthWrite: null,\n      colorWrite: U,\n      stencilWrite: x,\n      stencilTest: j\n    }), this._occluderPipelineMaskWrite = W({\n      blending: null,\n      polygonOffset: t,\n      depthTest: S,\n      depthWrite: null,\n      colorWrite: null,\n      stencilWrite: T,\n      stencilTest: E\n    })), this._occludeePipelineState = this.setPipelineState(this.configuration.transparencyPassType, !0), this.setPipelineState(this.configuration.transparencyPassType, !1);\n  }\n\n  get primitiveType() {\n    return 5;\n  }\n\n  getPipelineState(e, t) {\n    return t ? this._occludeePipelineState : this.configuration.occluder ? 11 === e ? this._occluderPipelineTransparent : 10 === e ? this._occluderPipelineOpaque : this._occluderPipelineMaskWrite : this.pipeline;\n  }\n\n}\n\nI.shader = new d(R, () => import(\"./RibbonLine.glsl.js\"));\nconst L = {\n  factor: 0,\n  units: -4\n};\n\nclass V extends u {\n  constructor() {\n    super(...arguments), this.output = 0, this.occluder = !1, this.slicePlaneEnabled = !1, this.transparent = !1, this.polygonOffset = !1, this.writeDepth = !1, this.stippleEnabled = !1, this.stippleOffColorEnabled = !1, this.stippleIntegerRepeatsEnabled = !1, this.roundCaps = !1, this.roundJoins = !1, this.vvSize = !1, this.vvColor = !1, this.vvOpacity = !1, this.falloffEnabled = !1, this.innerColorEnabled = !1, this.sceneHasOcludees = !1, this.transparencyPassType = 3, this.multipassTerrainEnabled = !1, this.cullAboveGround = !1;\n  }\n\n}\n\ne([h({\n  count: 8\n})], V.prototype, \"output\", void 0), e([h()], V.prototype, \"occluder\", void 0), e([h()], V.prototype, \"slicePlaneEnabled\", void 0), e([h()], V.prototype, \"transparent\", void 0), e([h()], V.prototype, \"polygonOffset\", void 0), e([h()], V.prototype, \"writeDepth\", void 0), e([h()], V.prototype, \"stippleEnabled\", void 0), e([h()], V.prototype, \"stippleOffColorEnabled\", void 0), e([h()], V.prototype, \"stippleIntegerRepeatsEnabled\", void 0), e([h()], V.prototype, \"roundCaps\", void 0), e([h()], V.prototype, \"roundJoins\", void 0), e([h()], V.prototype, \"vvSize\", void 0), e([h()], V.prototype, \"vvColor\", void 0), e([h()], V.prototype, \"vvOpacity\", void 0), e([h()], V.prototype, \"falloffEnabled\", void 0), e([h()], V.prototype, \"innerColorEnabled\", void 0), e([h()], V.prototype, \"sceneHasOcludees\", void 0), e([h({\n  count: 4\n})], V.prototype, \"transparencyPassType\", void 0), e([h()], V.prototype, \"multipassTerrainEnabled\", void 0), e([h()], V.prototype, \"cullAboveGround\", void 0);\nexport { I as RibbonLineTechnique, V as RibbonLineTechniqueConfiguration, z as ribbonVertexAttributeLocations };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/shaders/RibbonLineTechnique.js"],"names":["_","e","isSome","t","unwrap","i","unwrapOr","r","bindSliceUniformsWithOrigin","o","bindOutputHighlight","s","bindMultipassTerrainTexture","n","bindVisualVariablesUniformsWithOpacity","l","bindProjectionMatrix","p","bindView","a","ReloadableShaderModule","d","ShaderTechnique","c","ShaderTechniqueConfiguration","u","parameter","h","blendingDefault","f","OITBlending","m","OITDepthTest","b","OITDepthWrite","g","OITPolygonOffset","v","Program","y","stencilWriteMaskOn","T","stencilToolMaskBaseParams","E","stencilBaseAllZerosParams","P","depthCompareAlways","O","stencilToolTransparentOccluderParams","C","stencilWriteMaskOff","x","stencilToolMaskOccluderParams","j","depthCompareLess","S","R","makePipelineState","W","defaultDepthWriteParams","w","defaultColorWriteParams","U","z","Map","I","constructor","stippleTextureRepository","initializeProgram","shader","get","configuration","build","OITEnabled","transparencyPassType","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","stippleEnabled","stippleOffColorEnabled","stippleUVMaxEnabled","stippleIntegerRepeatsEnabled","roundCaps","roundJoins","vvColor","vvSize","vvInstancingEnabled","vvOpacity","falloffEnabled","innerColorEnabled","multipassTerrainEnabled","cullAboveGround","rctx","dispose","release","stipplePattern","stippleTextureBind","bindPass","program","camera","projectionMatrix","setUniform2fv","inverseViewport","setUniform1f","width","setUniform4fv","color","join","miterLimit","nearFar","pixelRatio","setUniform2f","fullViewport","swap","stippleOffColor","setUniform4f","length","falloff","innerColor","innerWidth","bindDraw","rebindTextures","setPipelineState","blending","depthTest","func","depthWrite","transparent","writeDepth","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","L","initializePipeline","occluder","_occluderPipelineTransparent","_occluderPipelineOpaque","_occluderPipelineMaskWrite","_occludeePipelineState","primitiveType","getPipelineState","pipeline","factor","units","V","arguments","count","prototype","RibbonLineTechnique","RibbonLineTechniqueConfiguration","ribbonVertexAttributeLocations"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{isSome as t,unwrap as i,unwrapOr as r}from\"../../../../core/maybe.js\";import{bindSliceUniformsWithOrigin as o}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindOutputHighlight as s}from\"../core/shaderLibrary/output/OutputHighlight.glsl.js\";import{bindMultipassTerrainTexture as n}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindVisualVariablesUniformsWithOpacity as l}from\"../core/shaderLibrary/shading/VisualVariables.glsl.js\";import{bindProjectionMatrix as p,bindView as a}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as d}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as c}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as u,parameter as h}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{blendingDefault as f,OITBlending as m,OITDepthTest as b,OITDepthWrite as g,OITPolygonOffset as v}from\"../lib/OrderIndependentTransparency.js\";import{Program as y}from\"../lib/Program.js\";import{stencilWriteMaskOn as T,stencilToolMaskBaseParams as E,stencilBaseAllZerosParams as P,depthCompareAlways as O,stencilToolTransparentOccluderParams as C,stencilWriteMaskOff as x,stencilToolMaskOccluderParams as j,depthCompareLess as S}from\"../lib/StencilUtils.js\";import{R}from\"../../../../chunks/RibbonLine.glsl.js\";import{makePipelineState as W,defaultDepthWriteParams as w,defaultColorWriteParams as U}from\"../../../webgl/renderState.js\";const z=new Map([[\"position\",0],[\"subdivisionFactor\",1],[\"uv0\",2],[\"auxpos1\",3],[\"auxpos2\",4],[\"size\",6],[\"sizeFeatureAttribute\",6],[\"color\",5],[\"colorFeatureAttribute\",5],[\"opacityFeatureAttribute\",7]]);class I extends c{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=I.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:i.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new y(e.rctx,r,z)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,o){if(p(this.program,o.camera.projectionMatrix),4===this.configuration.output&&s(this.program,o),o.multipassTerrainEnabled&&(this.program.setUniform2fv(\"inverseViewport\",o.inverseViewport),n(this.program,o)),this.program.setUniform1f(\"intrinsicWidth\",e.width),this.program.setUniform4fv(\"intrinsicColor\",e.color),this.program.setUniform1f(\"miterLimit\",\"miter\"!==e.join?0:e.miterLimit),this.program.setUniform2fv(\"cameraNearFar\",o.camera.nearFar),this.program.setUniform1f(\"pixelRatio\",o.camera.pixelRatio),this.program.setUniform2f(\"screenSize\",o.camera.fullViewport[2],o.camera.fullViewport[3]),l(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const r=t(this.stippleTextureBind)?this.stippleTextureBind(this.program)*o.camera.pixelRatio:1;if(this.program.setUniform1f(\"stipplePatternPixelSizeInv\",1/r),this.configuration.stippleOffColorEnabled){const t=i(e.stippleOffColor);this.program.setUniform4f(\"stippleOffColor\",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f(\"falloff\",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv(\"innerColor\",r(e.innerColor,e.color)),this.program.setUniform1f(\"innerWidth\",e.innerWidth*o.camera.pixelRatio))}bindDraw(e){a(this.program,e),o(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,r=3===e,o=2===e;return W({blending:0===i.output||7===i.output?r?f:m(e):null,depthTest:{func:b(e)},depthWrite:r?!i.transparent&&i.writeDepth&&w:g(e),colorWrite:U,stencilWrite:i.sceneHasOcludees?T:null,stencilTest:i.sceneHasOcludees?t?E:P:null,polygonOffset:r||o?i.polygonOffset&&L:v})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&L;return e.occluder&&(this._occluderPipelineTransparent=W({blending:f,polygonOffset:t,depthTest:O,depthWrite:null,colorWrite:U,stencilWrite:null,stencilTest:C}),this._occluderPipelineOpaque=W({blending:f,polygonOffset:t,depthTest:O,depthWrite:null,colorWrite:U,stencilWrite:x,stencilTest:j}),this._occluderPipelineMaskWrite=W({blending:null,polygonOffset:t,depthTest:S,depthWrite:null,colorWrite:null,stencilWrite:T,stencilTest:E})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}I.shader=new d(R,(()=>import(\"./RibbonLine.glsl.js\")));const L={factor:0,units:-4};class V extends u{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([h({count:8})],V.prototype,\"output\",void 0),e([h()],V.prototype,\"occluder\",void 0),e([h()],V.prototype,\"slicePlaneEnabled\",void 0),e([h()],V.prototype,\"transparent\",void 0),e([h()],V.prototype,\"polygonOffset\",void 0),e([h()],V.prototype,\"writeDepth\",void 0),e([h()],V.prototype,\"stippleEnabled\",void 0),e([h()],V.prototype,\"stippleOffColorEnabled\",void 0),e([h()],V.prototype,\"stippleIntegerRepeatsEnabled\",void 0),e([h()],V.prototype,\"roundCaps\",void 0),e([h()],V.prototype,\"roundJoins\",void 0),e([h()],V.prototype,\"vvSize\",void 0),e([h()],V.prototype,\"vvColor\",void 0),e([h()],V.prototype,\"vvOpacity\",void 0),e([h()],V.prototype,\"falloffEnabled\",void 0),e([h()],V.prototype,\"innerColorEnabled\",void 0),e([h()],V.prototype,\"sceneHasOcludees\",void 0),e([h({count:4})],V.prototype,\"transparencyPassType\",void 0),e([h()],V.prototype,\"multipassTerrainEnabled\",void 0),e([h()],V.prototype,\"cullAboveGround\",void 0);export{I as RibbonLineTechnique,V as RibbonLineTechniqueConfiguration,z as ribbonVertexAttributeLocations};\n"]},"metadata":{},"sourceType":"module"}