{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as i } from \"../../../chunks/tslib.es6.js\";\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport { whenTrueOnce as s, init as t, watch as r } from \"../../../core/watchUtils.js\";\nimport { property as a } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as p } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { LayerView3D as h } from \"./LayerView3D.js\";\nimport n from \"./graphics/Graphics3DFrustumVisibility.js\";\nimport o from \"./graphics/Graphics3DGraphicLikeLayerView.js\";\nimport { enlargeExtent as c } from \"./graphics/graphicUtils.js\";\nimport { toViewIfLocal as d } from \"./support/projectExtentUtils.js\";\nimport u from \"../../layers/LayerView.js\";\nconst l = 1.2;\nlet g = class extends h(u) {\n  constructor() {\n    super(...arguments), this.type = \"graphics-3d\", this.frustumVisibility = new n(), this.slicePlaneEnabled = !1, this.drapeSourceType = 1, this.suspendResumeExtent = null, this.fullExtentInLocalViewSpatialReference = null;\n  }\n\n  initialize() {\n    this._set(\"graphics3d\", new o({\n      owner: this,\n      layer: this.layer,\n      scaleVisibilityEnabled: !0\n    })), this.graphics3d.setup(), this.frustumVisibility.setup(this), this.setupSuspendResumeExtent(), this.updatingHandles.add(this, \"fullOpacity\", () => this.graphics3d.graphicsCore.opacityChange()), this.handles.add(this.layer.on(\"graphic-update\", i => this.graphics3d.graphicsCore.graphicUpdateHandler(i))), this.addResolvingPromise(d(this).then(i => this.fullExtentInLocalViewSpatialReference = i)), this.layer.internal ? this.notifyChange(\"updating\") : this.handles.add(s(this.view, \"basemapTerrain.ready\", () => this.notifyChange(\"updating\")));\n  }\n\n  destroy() {\n    this.frustumVisibility && (this.frustumVisibility.destroy(), this._set(\"frustumVisibility\", null)), this.graphics3d && (this.graphics3d.destroy(), this._set(\"graphics3d\", null));\n  }\n\n  get legendEnabled() {\n    return this.canResume() && !this.frustumVisibility.suspended;\n  }\n\n  get suspendInfo() {\n    var i;\n    const s = {};\n    return e(this.graphics3d.scaleVisibility) && this.graphics3d.scaleVisibility.suspended && (s.outsideScaleRange = !0), s.outsideOfView = !(null == (i = this.frustumVisibility) || !i.suspended), s;\n  }\n\n  async fetchPopupFeatures(i, s) {\n    return e(s) ? s.clientGraphics : null;\n  }\n\n  notifyGraphicGeometryChanged(i) {\n    this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(i);\n  }\n\n  notifyGraphicVisibilityChanged(i) {\n    this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(i);\n  }\n\n  get graphics3DGraphics() {\n    return this.graphics3d.graphicsCore.graphics3DGraphics;\n  }\n\n  get graphics3DGraphicsByObjectID() {\n    return this.graphics3d ? this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID : null;\n  }\n\n  get symbolUpdateType() {\n    return this.graphics3d.graphicsCore.symbolUpdateType;\n  }\n\n  getGraphicFromGraphicUid(i) {\n    return this.graphics3d.getGraphicFromGraphicUid(i);\n  }\n\n  whenGraphicBounds(i, e) {\n    return this.graphics3d.whenGraphicBounds(i, e);\n  }\n\n  computeAttachmentOrigin(i, e) {\n    return this.graphics3d ? this.graphics3d.graphicsCore.computeAttachmentOrigin(i, e) : null;\n  }\n\n  getSymbolLayerSize(i, e) {\n    return this.graphics3d.getSymbolLayerSize(i, e);\n  }\n\n  queryGraphics() {\n    return Promise.resolve(this.loadedGraphics);\n  }\n\n  maskOccludee(i) {\n    return this.graphics3d.maskOccludee(i);\n  }\n\n  highlight(i) {\n    return this.graphics3d.highlight(i);\n  }\n\n  get updatePolicy() {\n    var i;\n    return (null == (i = this.graphics3d) ? void 0 : i.graphicsCore.effectiveUpdatePolicy) || 1;\n  }\n\n  canResume() {\n    var i;\n    return super.canResume() && !(null != (i = this.graphics3d) && i.suspended);\n  }\n\n  isUpdating() {\n    var i, e;\n    return !(!(this.graphics3d && this.graphics3d.updating || this.frustumVisibility && this.frustumVisibility.updating) && (this.layer.internal || null != (i = this.view) && null != (e = i.basemapTerrain) && e.ready));\n  }\n\n  setupSuspendResumeExtent() {\n    const i = () => {\n      this.suspendResumeExtent = c(this.graphics3d.graphicsCore.computedExtent, this.suspendResumeExtent, l, this.graphics3d.graphicsCore.extentPadding), this.frustumVisibility.setExtent(this.suspendResumeExtent);\n    };\n\n    t(this.graphics3d.graphicsCore, \"computedExtent\", () => i(), !0), r(this.graphics3d.graphicsCore, \"extentPadding\", () => i(), !0);\n  }\n\n  get performanceInfo() {\n    return {\n      displayedNumberOfFeatures: this.loadedGraphics.length,\n      maximumNumberOfFeatures: -1,\n      totalNumberOfFeatures: -1,\n      nodes: 0,\n      core: null,\n      updating: this.updating,\n      elevationUpdating: this.graphics3d.elevationAlignment.updating,\n      visibilityFrustum: !this.frustumVisibility.suspended\n    };\n  }\n\n};\ni([a({\n  aliasOf: \"layer.graphics\"\n})], g.prototype, \"loadedGraphics\", void 0), i([a({\n  readOnly: !0\n})], g.prototype, \"suspended\", void 0), i([a({\n  readOnly: !0\n})], g.prototype, \"legendEnabled\", null), i([a({\n  readOnly: !0\n})], g.prototype, \"updating\", void 0), i([a()], g.prototype, \"layer\", void 0), i([a({\n  readOnly: !0\n})], g.prototype, \"frustumVisibility\", void 0), i([a({\n  readOnly: !0\n})], g.prototype, \"graphics3d\", void 0), i([a({\n  type: Boolean\n})], g.prototype, \"slicePlaneEnabled\", void 0), i([a({\n  readOnly: !0\n})], g.prototype, \"suspendInfo\", null), g = i([p(\"esri.views.3d.layers.GraphicsLayerView3D\")], g);\nvar y = g;\nexport default y;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/GraphicsLayerView3D.js"],"names":["_","i","isSome","e","whenTrueOnce","s","init","t","watch","r","property","a","subclass","p","LayerView3D","h","n","o","enlargeExtent","c","toViewIfLocal","d","u","l","g","constructor","arguments","type","frustumVisibility","slicePlaneEnabled","drapeSourceType","suspendResumeExtent","fullExtentInLocalViewSpatialReference","initialize","_set","owner","layer","scaleVisibilityEnabled","graphics3d","setup","setupSuspendResumeExtent","updatingHandles","add","graphicsCore","opacityChange","handles","on","graphicUpdateHandler","addResolvingPromise","then","internal","notifyChange","view","destroy","legendEnabled","canResume","suspended","suspendInfo","scaleVisibility","outsideScaleRange","outsideOfView","fetchPopupFeatures","clientGraphics","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","graphics3DGraphics","graphics3DGraphicsByObjectID","symbolUpdateType","getGraphicFromGraphicUid","whenGraphicBounds","computeAttachmentOrigin","getSymbolLayerSize","queryGraphics","Promise","resolve","loadedGraphics","maskOccludee","highlight","updatePolicy","effectiveUpdatePolicy","isUpdating","updating","basemapTerrain","ready","computedExtent","extentPadding","setExtent","performanceInfo","displayedNumberOfFeatures","length","maximumNumberOfFeatures","totalNumberOfFeatures","nodes","core","elevationUpdating","elevationAlignment","visibilityFrustum","aliasOf","prototype","readOnly","Boolean","y"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as i}from\"../../../chunks/tslib.es6.js\";import{isSome as e}from\"../../../core/maybe.js\";import{whenTrueOnce as s,init as t,watch as r}from\"../../../core/watchUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as h}from\"./LayerView3D.js\";import n from\"./graphics/Graphics3DFrustumVisibility.js\";import o from\"./graphics/Graphics3DGraphicLikeLayerView.js\";import{enlargeExtent as c}from\"./graphics/graphicUtils.js\";import{toViewIfLocal as d}from\"./support/projectExtentUtils.js\";import u from\"../../layers/LayerView.js\";const l=1.2;let g=class extends(h(u)){constructor(){super(...arguments),this.type=\"graphics-3d\",this.frustumVisibility=new n,this.slicePlaneEnabled=!1,this.drapeSourceType=1,this.suspendResumeExtent=null,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set(\"graphics3d\",new o({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,\"fullOpacity\",(()=>this.graphics3d.graphicsCore.opacityChange())),this.handles.add(this.layer.on(\"graphic-update\",(i=>this.graphics3d.graphicsCore.graphicUpdateHandler(i)))),this.addResolvingPromise(d(this).then((i=>this.fullExtentInLocalViewSpatialReference=i))),this.layer.internal?this.notifyChange(\"updating\"):this.handles.add(s(this.view,\"basemapTerrain.ready\",(()=>this.notifyChange(\"updating\"))))}destroy(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set(\"frustumVisibility\",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set(\"graphics3d\",null))}get legendEnabled(){return this.canResume()&&!this.frustumVisibility.suspended}get suspendInfo(){var i;const s={};return e(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(s.outsideScaleRange=!0),s.outsideOfView=!(null==(i=this.frustumVisibility)||!i.suspended),s}async fetchPopupFeatures(i,s){return e(s)?s.clientGraphics:null}notifyGraphicGeometryChanged(i){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(i)}notifyGraphicVisibilityChanged(i){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(i)}get graphics3DGraphics(){return this.graphics3d.graphicsCore.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}get symbolUpdateType(){return this.graphics3d.graphicsCore.symbolUpdateType}getGraphicFromGraphicUid(i){return this.graphics3d.getGraphicFromGraphicUid(i)}whenGraphicBounds(i,e){return this.graphics3d.whenGraphicBounds(i,e)}computeAttachmentOrigin(i,e){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(i,e):null}getSymbolLayerSize(i,e){return this.graphics3d.getSymbolLayerSize(i,e)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(i){return this.graphics3d.maskOccludee(i)}highlight(i){return this.graphics3d.highlight(i)}get updatePolicy(){var i;return(null==(i=this.graphics3d)?void 0:i.graphicsCore.effectiveUpdatePolicy)||1}canResume(){var i;return super.canResume()&&!(null!=(i=this.graphics3d)&&i.suspended)}isUpdating(){var i,e;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(i=this.view)&&null!=(e=i.basemapTerrain)&&e.ready))}setupSuspendResumeExtent(){const i=()=>{this.suspendResumeExtent=c(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,l,this.graphics3d.graphicsCore.extentPadding),this.frustumVisibility.setExtent(this.suspendResumeExtent)};t(this.graphics3d.graphicsCore,\"computedExtent\",(()=>i()),!0),r(this.graphics3d.graphicsCore,\"extentPadding\",(()=>i()),!0)}get performanceInfo(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}};i([a({aliasOf:\"layer.graphics\"})],g.prototype,\"loadedGraphics\",void 0),i([a({readOnly:!0})],g.prototype,\"suspended\",void 0),i([a({readOnly:!0})],g.prototype,\"legendEnabled\",null),i([a({readOnly:!0})],g.prototype,\"updating\",void 0),i([a()],g.prototype,\"layer\",void 0),i([a({readOnly:!0})],g.prototype,\"frustumVisibility\",void 0),i([a({readOnly:!0})],g.prototype,\"graphics3d\",void 0),i([a({type:Boolean})],g.prototype,\"slicePlaneEnabled\",void 0),i([a({readOnly:!0})],g.prototype,\"suspendInfo\",null),g=i([p(\"esri.views.3d.layers.GraphicsLayerView3D\")],g);var y=g;export default y;\n"]},"metadata":{},"sourceType":"module"}