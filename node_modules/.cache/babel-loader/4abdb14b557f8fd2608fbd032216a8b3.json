{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport { isSome as t, get as i, isNone as r, unwrap as n } from \"../../../../core/maybe.js\";\nimport { pt2px as o } from \"../../../../core/screenUtils.js\";\nimport { e as a } from \"../../../../chunks/earcut.js\";\nimport { I as s } from \"../../../../chunks/mat4f64.js\";\nimport { s as l } from \"../../../../chunks/vec4.js\";\nimport { empty as u, expandWithBuffer as p, intersectsClippingArea as c, expandWithAABB as h, create as m } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { BufferViewMat3f64 as d, BufferViewVec3f64 as _, BufferViewVec4f as y } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { elevationModeChangeUpdateType as g, SymbolUpdateType as f, needsElevationUpdates2D as b } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as M } from \"./ElevationContext.js\";\nimport E from \"./Graphics3DDrapedGraphicLayer.js\";\nimport { Graphics3DObject3DGraphicLayer as x } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as v } from \"./Graphics3DSymbolLayer.js\";\nimport { mixinColorAndOpacity as O } from \"./graphicUtils.js\";\nimport { createGeometry as D } from \"./lineUtils.js\";\nimport { geometryAsPolygon as A, geometryToRenderInfo as S, createColorGeometry as P, geometryToRenderInfoDraped as C } from \"./polygonUtils.js\";\nimport { createMaterial as U, uvElevationAligner as G } from \"../support/patternUtils.js\";\nimport { createMapSpaceUVCoords as w, createMapSpaceUVCoordsDraped as j } from \"../support/uvUtils.js\";\nimport { Object3D as T } from \"../../webgl-engine/lib/Object3D.js\";\nimport { RenderGeometry as R } from \"../../webgl-engine/lib/RenderGeometry.js\";\nimport { createStipplePattern as B } from \"../../webgl-engine/materials/lineStippleUtils.js\";\nimport { NativeLineMaterial as L } from \"../../webgl-engine/materials/NativeLineMaterial.js\";\nimport { PatternMaterial as N } from \"../../webgl-engine/materials/PatternMaterial.js\";\nimport { RibbonLineMaterial as V } from \"../../webgl-engine/materials/RibbonLineMaterial.js\";\nconst F = [\"polyline\", \"polygon\", \"extent\"];\n\nclass I extends v {\n  constructor(e, t, i, r) {\n    super(e, t, i, r), this._needsUV = !1, this._hasOutline = !1;\n  }\n\n  async doLoad() {}\n\n  ensureMaterials() {\n    this.ensureFillMaterial(), this.ensureOutlineMaterial();\n  }\n\n  ensureFillMaterial() {\n    if (t(this._material)) return;\n\n    const e = i(this.symbolLayer, \"material\", \"color\"),\n          r = this._getCombinedOpacityAndColor(e);\n\n    this._material = U(this.symbolLayer, {\n      color: r,\n      transparent: r[3] < 1 || this.needsDrivenTransparentPass,\n      polygonOffset: !1,\n      vertexColors: !0,\n      writeLinearDepth: !0,\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    }, {\n      isDraped: this.draped\n    }), this._needsUV = this._material instanceof N, this._context.stage.add(this._material);\n  }\n\n  ensureOutlineMaterial() {\n    const i = this.symbolLayer.outline;\n    if (t(this._outlineMaterial) || !this._isValidOutline(i)) return;\n    this._hasOutline = !0;\n\n    const r = t => {\n      const r = i.stipplePattern ? B(i.stipplePattern.map(o)) : null,\n            n = i.stippleOffColor ? e.toUnitRGBA(i.stippleOffColor) : null;\n      return t > 1.5 ? new V({\n        width: t,\n        color: this._getOutlineColor(),\n        polygonOffset: !0,\n        slicePlaneEnabled: this._context.slicePlaneEnabled,\n        isClosed: !0,\n        stipplePattern: r,\n        stippleIntegerRepeats: !0,\n        stippleOffColor: n\n      }) : new L({\n        color: this._getOutlineColor(),\n        slicePlaneEnabled: this._context.slicePlaneEnabled,\n        width: t,\n        stipplePattern: r,\n        stippleIntegerRepeats: !0,\n        stippleOffColor: n\n      });\n    };\n\n    this._outlineMaterial = r(o(i.size)), this._context.stage.add(this._outlineMaterial);\n  }\n\n  _isValidOutline(e) {\n    return t(e) && e.size && e.size > 0 && t(e.color);\n  }\n\n  destroy() {\n    super.destroy(), this._context.stage.remove(this._material), this._material = null, this._context.stage.remove(this._outlineMaterial), this._outlineMaterial = null;\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry, F, this.symbolLayer.type)) return null;\n\n    const i = this._getVertexOpacityAndColor(e.renderingInfo, 255),\n          r = this.setGraphicElevationContext(t, new M());\n\n    return this.ensureDrapedStatus(\"on-the-ground\" === r.mode), this.ensureMaterials(), this.draped ? this._createAsOverlay(t, i) : this._createAs3DShape(t, i, r);\n  }\n\n  layerOpacityChanged() {\n    if (t(this._material)) {\n      const e = this._material.params.color,\n            t = i(this.symbolLayer, \"material\", \"color\"),\n            r = this._getCombinedOpacity(t);\n\n      this._material.setParameterValues({\n        color: [e[0], e[1], e[2], r],\n        transparent: r < 1 || this.needsDrivenTransparentPass\n      });\n    }\n\n    if (t(this._outlineMaterial)) {\n      const e = this._outlineMaterial.params.color;\n\n      this._outlineMaterial.setParameterValues({\n        color: [e[0], e[1], e[2], this._getOutlineOpacity()]\n      });\n    }\n\n    return !0;\n  }\n\n  layerElevationInfoChanged(e, t, i) {\n    const r = this._elevationContext.mode,\n          n = g(I.elevationModeChangeTypes, i, r);\n    if (n !== f.UPDATE) return n;\n    const o = b(r);\n    return this.updateGraphics3DGraphicElevationInfo(e, t, () => o);\n  }\n\n  slicePlaneEnabledChanged() {\n    if (t(this._material) && this._material.setParameterValues({\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    }), t(this._outlineMaterial)) {\n      const e = {\n        slicePlaneEnabled: this._context.slicePlaneEnabled\n      };\n\n      this._outlineMaterial.setParameterValues(e);\n    }\n\n    return !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    return !0;\n  }\n\n  pixelRatioChanged() {\n    return !0;\n  }\n\n  _createAs3DShape(e, t, i) {\n    const n = A(e.geometry);\n    if (r(n)) return null;\n    z.renderData = S(n, this._context.elevationProvider, this._context.renderCoordsHelper, i), z.color = t;\n    const o = z.renderData.position.length / 3;\n    if (this._needsUV && (z.uvMapSpace = new Float32Array(4 * o), z.boundingRect = new Float64Array(9 * o)), z.outNum = 0, z.outGeometries = [], z.outTransforms = [], z.outMaterials = [], this._createAs3DShapeFill(z), this._hasOutline && this._createAs3DShapeOutline(z), this._logGeometryCreationWarnings(z.renderData, n.rings, \"rings\", \"FillSymbol3DLayer\"), 0 === z.outNum) return null;\n    this._needsUV && w(y.fromTypedArray(z.uvMapSpace), _.fromTypedArray(z.renderData.position), this._context.renderCoordsHelper, d.fromTypedArray(z.boundingRect));\n    const a = new T({\n      geometries: z.outGeometries,\n      materials: z.outMaterials,\n      transformations: z.outTransforms,\n      castShadow: !1,\n      metadata: {\n        layerUid: this._context.layer.uid,\n        graphicUid: e.uid\n      }\n    }),\n          s = G,\n          l = new x(this, a, z.outGeometries, null, null, s, i);\n    return l.alignedSampledElevation = z.renderData.sampledElevation, l.needsElevationUpdates = b(i.mode), l;\n  }\n\n  _createAs3DShapeFill(e) {\n    const i = e.renderData.polygons;\n\n    for (const {\n      position: r,\n      mapPosition: o,\n      holeIndices: l,\n      index: h,\n      count: m\n    } of i) {\n      if (t(this._context.clippingExtent) && (u(k), p(k, o), !c(k, this._context.clippingExtent))) continue;\n      const i = a(o, l, 3);\n      if (0 === i.length) continue;\n\n      const d = new Uint32Array(i),\n            _ = P({\n        indices: d,\n        attributeData: {\n          position: r,\n          color: e.color,\n          mapPosition: o,\n          uvMapSpace: this._needsUV ? new Float32Array(e.uvMapSpace.buffer, 4 * h * e.uvMapSpace.BYTES_PER_ELEMENT, 4 * m) : null,\n          boundingRect: this._needsUV ? new Float64Array(e.boundingRect.buffer, 9 * h * e.boundingRect.BYTES_PER_ELEMENT, 9 * m) : null\n        }\n      });\n\n      e.outGeometries.push(_), e.outMaterials.push(n(this._material)), e.outTransforms.push(s), e.outNum++;\n    }\n  }\n\n  _createAs3DShapeOutline(e) {\n    if (!this._hasOutline) return;\n    const i = e.renderData.outlines,\n          r = this._outlineMaterial instanceof L;\n\n    for (let o = 0; o < i.length; ++o) {\n      const {\n        mapPosition: a,\n        position: l\n      } = i[o];\n      if (t(this._context.clippingExtent) && (u(k), p(k, a), !c(k, this._context.clippingExtent))) continue;\n      const h = D({\n        removeDuplicateStartEnd: r ? 0 : 1,\n        attributeData: {\n          position: l,\n          mapPosition: a\n        }\n      }),\n            m = h.vertexAttributes.get(\"position\");\n      m.data === l && (m.data = new Float64Array(l)), e.outGeometries.push(h), e.outMaterials.push(n(this._outlineMaterial)), e.outTransforms.push(s), e.outNum++;\n    }\n  }\n\n  _createAsOverlay(e, i) {\n    const o = A(e.geometry);\n    if (r(o)) return null;\n    n(this._material).renderPriority = this._renderPriority + this._renderPriorityStep / 2, t(this._outlineMaterial) && (this._outlineMaterial.renderPriority = this._renderPriority), Y.renderData = C(o, this._context.overlaySR), Y.color = i;\n    const a = Y.renderData.position.length / 3;\n    return this._needsUV && (Y.uvMapSpace = new Float32Array(4 * a)), Y.outNum = 0, Y.outGeometries = [], Y.outBoundingBox = u(), Y.layerUid = this._context.layer.uid, Y.graphicsUid = e.uid, this._createAsOverlayFill(Y), this._hasOutline && this._createAsOverlayOutline(Y), this._logGeometryCreationWarnings(Y.renderData, o.rings, \"rings\", \"FillSymbol3DLayer\"), 0 === Y.outNum ? null : (this._needsUV && j(y.fromTypedArray(Y.uvMapSpace), _.fromTypedArray(Y.renderData.position), this._context.overlaySR), Y.outNum > 0 ? new E(this, Y.outGeometries, Y.outBoundingBox) : null);\n  }\n\n  _createAsOverlayFill(e) {\n    const t = e.renderData.polygons;\n\n    for (const {\n      position: i,\n      holeIndices: r,\n      index: o,\n      count: s\n    } of t) {\n      if (u(k), p(k, i), !c(k, this._context.clippingExtent)) continue;\n      const t = a(i, r, 3);\n      if (0 === t.length) continue;\n      h(e.outBoundingBox, k);\n\n      const m = new Uint32Array(t),\n            d = P({\n        indices: m,\n        attributeData: {\n          position: i,\n          color: e.color,\n          uvMapSpace: this._needsUV ? new Float32Array(e.uvMapSpace.buffer, 4 * o * e.uvMapSpace.BYTES_PER_ELEMENT, 4 * s) : null\n        }\n      }),\n            _ = new R(d, n(this._material), e.layerUid, e.graphicsUid),\n            y = k;\n\n      l(_.boundingSphere, .5 * (y[0] + y[3]), .5 * (y[1] + y[4]), 0, .5 * Math.sqrt((y[3] - y[0]) * (y[3] - y[0]) + (y[4] - y[1]) * (y[4] - y[1]))), e.outGeometries.push(_), e.outNum++;\n    }\n  }\n\n  _createAsOverlayOutline(e) {\n    if (!this._hasOutline) return;\n    const t = e.renderData.outlines;\n\n    for (let i = 0; i < t.length; ++i) {\n      const {\n        position: r\n      } = t[i];\n      if (u(k), p(k, r), !c(k, this._context.clippingExtent)) continue;\n      h(e.outBoundingBox, k);\n      const o = this._outlineMaterial instanceof L,\n            a = D({\n        removeDuplicateStartEnd: o ? 0 : 1,\n        attributeData: {\n          position: r\n        }\n      }),\n            s = new R(a, n(this._outlineMaterial), e.layerUid, e.graphicsUid),\n            m = k;\n      l(s.boundingSphere, .5 * (m[0] + m[3]), .5 * (m[1] + m[4]), 0, .5 * Math.sqrt((m[3] - m[0]) * (m[3] - m[0]) + (m[4] - m[1]) * (m[4] - m[1]))), e.outGeometries.push(s), e.outNum++;\n    }\n  }\n\n  _getOutlineOpacity() {\n    const e = i(this.symbolLayer, \"outline\", \"color\");\n    return (this.draped ? 1 : this._getLayerOpacity()) * (t(e) ? e.a : 0);\n  }\n\n  _getOutlineColor() {\n    const r = i(this.symbolLayer, \"outline\", \"color\"),\n          n = this._getOutlineOpacity();\n\n    return O(t(r) ? e.toUnitRGB(r) : null, n);\n  }\n\n  get test() {\n    return {\n      createAsOverlay: (e, t) => this._createAsOverlay(e, t),\n      createAs3DShape: (e, t, i) => this._createAs3DShape(e, t, i)\n    };\n  }\n\n}\n\nI.elevationModeChangeTypes = {\n  definedChanged: f.RECREATE,\n  staysOnTheGround: f.NONE,\n  onTheGroundChanged: f.RECREATE\n};\nconst k = m(),\n      z = {\n  renderData: null,\n  color: null,\n  uvMapSpace: null,\n  boundingRect: null,\n  outNum: 0,\n  outBoundingBox: null,\n  outGeometries: null,\n  outMaterials: null,\n  outTransforms: null\n},\n      Y = {\n  renderData: null,\n  color: null,\n  uvMapSpace: null,\n  outNum: 0,\n  outBoundingBox: null,\n  outGeometries: null,\n  outMaterials: null,\n  outTransforms: null\n};\nexport default I;\nexport { I as Graphics3DPolygonFillSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer.js"],"names":["e","isSome","t","get","i","isNone","r","unwrap","n","pt2px","o","a","I","s","l","empty","u","expandWithBuffer","p","intersectsClippingArea","c","expandWithAABB","h","create","m","BufferViewMat3f64","d","BufferViewVec3f64","_","BufferViewVec4f","y","elevationModeChangeUpdateType","g","SymbolUpdateType","f","needsElevationUpdates2D","b","ElevationContext","M","E","Graphics3DObject3DGraphicLayer","x","Graphics3DSymbolLayer","v","mixinColorAndOpacity","O","createGeometry","D","geometryAsPolygon","A","geometryToRenderInfo","S","createColorGeometry","P","geometryToRenderInfoDraped","C","createMaterial","U","uvElevationAligner","G","createMapSpaceUVCoords","w","createMapSpaceUVCoordsDraped","j","Object3D","T","RenderGeometry","R","createStipplePattern","B","NativeLineMaterial","L","PatternMaterial","N","RibbonLineMaterial","V","F","constructor","_needsUV","_hasOutline","doLoad","ensureMaterials","ensureFillMaterial","ensureOutlineMaterial","_material","symbolLayer","_getCombinedOpacityAndColor","color","transparent","needsDrivenTransparentPass","polygonOffset","vertexColors","writeLinearDepth","slicePlaneEnabled","_context","isDraped","draped","stage","add","outline","_outlineMaterial","_isValidOutline","stipplePattern","map","stippleOffColor","toUnitRGBA","width","_getOutlineColor","isClosed","stippleIntegerRepeats","size","destroy","remove","createGraphics3DGraphic","graphic","_validateGeometry","geometry","type","_getVertexOpacityAndColor","renderingInfo","setGraphicElevationContext","ensureDrapedStatus","mode","_createAsOverlay","_createAs3DShape","layerOpacityChanged","params","_getCombinedOpacity","setParameterValues","_getOutlineOpacity","layerElevationInfoChanged","_elevationContext","elevationModeChangeTypes","UPDATE","updateGraphics3DGraphicElevationInfo","slicePlaneEnabledChanged","physicalBasedRenderingChanged","pixelRatioChanged","z","renderData","elevationProvider","renderCoordsHelper","position","length","uvMapSpace","Float32Array","boundingRect","Float64Array","outNum","outGeometries","outTransforms","outMaterials","_createAs3DShapeFill","_createAs3DShapeOutline","_logGeometryCreationWarnings","rings","fromTypedArray","geometries","materials","transformations","castShadow","metadata","layerUid","layer","uid","graphicUid","alignedSampledElevation","sampledElevation","needsElevationUpdates","polygons","mapPosition","holeIndices","index","count","clippingExtent","k","Uint32Array","indices","attributeData","buffer","BYTES_PER_ELEMENT","push","outlines","removeDuplicateStartEnd","vertexAttributes","data","renderPriority","_renderPriority","_renderPriorityStep","Y","overlaySR","outBoundingBox","graphicsUid","_createAsOverlayFill","_createAsOverlayOutline","boundingSphere","Math","sqrt","_getLayerOpacity","toUnitRGB","test","createAsOverlay","createAs3DShape","definedChanged","RECREATE","staysOnTheGround","NONE","onTheGroundChanged","Graphics3DPolygonFillSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import{isSome as t,get as i,isNone as r,unwrap as n}from\"../../../../core/maybe.js\";import{pt2px as o}from\"../../../../core/screenUtils.js\";import{e as a}from\"../../../../chunks/earcut.js\";import{I as s}from\"../../../../chunks/mat4f64.js\";import{s as l}from\"../../../../chunks/vec4.js\";import{empty as u,expandWithBuffer as p,intersectsClippingArea as c,expandWithAABB as h,create as m}from\"../../../../geometry/support/aaBoundingBox.js\";import{BufferViewMat3f64 as d,BufferViewVec3f64 as _,BufferViewVec4f as y}from\"../../../../geometry/support/buffer/BufferView.js\";import{elevationModeChangeUpdateType as g,SymbolUpdateType as f,needsElevationUpdates2D as b}from\"./elevationAlignmentUtils.js\";import{ElevationContext as M}from\"./ElevationContext.js\";import E from\"./Graphics3DDrapedGraphicLayer.js\";import{Graphics3DObject3DGraphicLayer as x}from\"./Graphics3DObject3DGraphicLayer.js\";import{Graphics3DSymbolLayer as v}from\"./Graphics3DSymbolLayer.js\";import{mixinColorAndOpacity as O}from\"./graphicUtils.js\";import{createGeometry as D}from\"./lineUtils.js\";import{geometryAsPolygon as A,geometryToRenderInfo as S,createColorGeometry as P,geometryToRenderInfoDraped as C}from\"./polygonUtils.js\";import{createMaterial as U,uvElevationAligner as G}from\"../support/patternUtils.js\";import{createMapSpaceUVCoords as w,createMapSpaceUVCoordsDraped as j}from\"../support/uvUtils.js\";import{Object3D as T}from\"../../webgl-engine/lib/Object3D.js\";import{RenderGeometry as R}from\"../../webgl-engine/lib/RenderGeometry.js\";import{createStipplePattern as B}from\"../../webgl-engine/materials/lineStippleUtils.js\";import{NativeLineMaterial as L}from\"../../webgl-engine/materials/NativeLineMaterial.js\";import{PatternMaterial as N}from\"../../webgl-engine/materials/PatternMaterial.js\";import{RibbonLineMaterial as V}from\"../../webgl-engine/materials/RibbonLineMaterial.js\";const F=[\"polyline\",\"polygon\",\"extent\"];class I extends v{constructor(e,t,i,r){super(e,t,i,r),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}ensureMaterials(){this.ensureFillMaterial(),this.ensureOutlineMaterial()}ensureFillMaterial(){if(t(this._material))return;const e=i(this.symbolLayer,\"material\",\"color\"),r=this._getCombinedOpacityAndColor(e);this._material=U(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof N,this._context.stage.add(this._material)}ensureOutlineMaterial(){const i=this.symbolLayer.outline;if(t(this._outlineMaterial)||!this._isValidOutline(i))return;this._hasOutline=!0;const r=t=>{const r=i.stipplePattern?B(i.stipplePattern.map(o)):null,n=i.stippleOffColor?e.toUnitRGBA(i.stippleOffColor):null;return t>1.5?new V({width:t,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:r,stippleIntegerRepeats:!0,stippleOffColor:n}):new L({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:t,stipplePattern:r,stippleIntegerRepeats:!0,stippleOffColor:n})};this._outlineMaterial=r(o(i.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return t(e)&&e.size&&e.size>0&&t(e.color)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,F,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new M);return this.ensureDrapedStatus(\"on-the-ground\"===r.mode),this.ensureMaterials(),this.draped?this._createAsOverlay(t,i):this._createAs3DShape(t,i,r)}layerOpacityChanged(){if(t(this._material)){const e=this._material.params.color,t=i(this.symbolLayer,\"material\",\"color\"),r=this._getCombinedOpacity(t);this._material.setParameterValues({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(t(this._outlineMaterial)){const e=this._outlineMaterial.params.color;this._outlineMaterial.setParameterValues({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=g(I.elevationModeChangeTypes,i,r);if(n!==f.UPDATE)return n;const o=b(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>o))}slicePlaneEnabledChanged(){if(t(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),t(this._outlineMaterial)){const e={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameterValues(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const n=A(e.geometry);if(r(n))return null;z.renderData=S(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),z.color=t;const o=z.renderData.position.length/3;if(this._needsUV&&(z.uvMapSpace=new Float32Array(4*o),z.boundingRect=new Float64Array(9*o)),z.outNum=0,z.outGeometries=[],z.outTransforms=[],z.outMaterials=[],this._createAs3DShapeFill(z),this._hasOutline&&this._createAs3DShapeOutline(z),this._logGeometryCreationWarnings(z.renderData,n.rings,\"rings\",\"FillSymbol3DLayer\"),0===z.outNum)return null;this._needsUV&&w(y.fromTypedArray(z.uvMapSpace),_.fromTypedArray(z.renderData.position),this._context.renderCoordsHelper,d.fromTypedArray(z.boundingRect));const a=new T({geometries:z.outGeometries,materials:z.outMaterials,transformations:z.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),s=G,l=new x(this,a,z.outGeometries,null,null,s,i);return l.alignedSampledElevation=z.renderData.sampledElevation,l.needsElevationUpdates=b(i.mode),l}_createAs3DShapeFill(e){const i=e.renderData.polygons;for(const{position:r,mapPosition:o,holeIndices:l,index:h,count:m}of i){if(t(this._context.clippingExtent)&&(u(k),p(k,o),!c(k,this._context.clippingExtent)))continue;const i=a(o,l,3);if(0===i.length)continue;const d=new Uint32Array(i),_=P({indices:d,attributeData:{position:r,color:e.color,mapPosition:o,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*h*e.uvMapSpace.BYTES_PER_ELEMENT,4*m):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*h*e.boundingRect.BYTES_PER_ELEMENT,9*m):null}});e.outGeometries.push(_),e.outMaterials.push(n(this._material)),e.outTransforms.push(s),e.outNum++}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines,r=this._outlineMaterial instanceof L;for(let o=0;o<i.length;++o){const{mapPosition:a,position:l}=i[o];if(t(this._context.clippingExtent)&&(u(k),p(k,a),!c(k,this._context.clippingExtent)))continue;const h=D({removeDuplicateStartEnd:r?0:1,attributeData:{position:l,mapPosition:a}}),m=h.vertexAttributes.get(\"position\");m.data===l&&(m.data=new Float64Array(l)),e.outGeometries.push(h),e.outMaterials.push(n(this._outlineMaterial)),e.outTransforms.push(s),e.outNum++}}_createAsOverlay(e,i){const o=A(e.geometry);if(r(o))return null;n(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,t(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Y.renderData=C(o,this._context.overlaySR),Y.color=i;const a=Y.renderData.position.length/3;return this._needsUV&&(Y.uvMapSpace=new Float32Array(4*a)),Y.outNum=0,Y.outGeometries=[],Y.outBoundingBox=u(),Y.layerUid=this._context.layer.uid,Y.graphicsUid=e.uid,this._createAsOverlayFill(Y),this._hasOutline&&this._createAsOverlayOutline(Y),this._logGeometryCreationWarnings(Y.renderData,o.rings,\"rings\",\"FillSymbol3DLayer\"),0===Y.outNum?null:(this._needsUV&&j(y.fromTypedArray(Y.uvMapSpace),_.fromTypedArray(Y.renderData.position),this._context.overlaySR),Y.outNum>0?new E(this,Y.outGeometries,Y.outBoundingBox):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:i,holeIndices:r,index:o,count:s}of t){if(u(k),p(k,i),!c(k,this._context.clippingExtent))continue;const t=a(i,r,3);if(0===t.length)continue;h(e.outBoundingBox,k);const m=new Uint32Array(t),d=P({indices:m,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*o*e.uvMapSpace.BYTES_PER_ELEMENT,4*s):null}}),_=new R(d,n(this._material),e.layerUid,e.graphicsUid),y=k;l(_.boundingSphere,.5*(y[0]+y[3]),.5*(y[1]+y[4]),0,.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1]))),e.outGeometries.push(_),e.outNum++}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{position:r}=t[i];if(u(k),p(k,r),!c(k,this._context.clippingExtent))continue;h(e.outBoundingBox,k);const o=this._outlineMaterial instanceof L,a=D({removeDuplicateStartEnd:o?0:1,attributeData:{position:r}}),s=new R(a,n(this._outlineMaterial),e.layerUid,e.graphicsUid),m=k;l(s.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),e.outGeometries.push(s),e.outNum++}}_getOutlineOpacity(){const e=i(this.symbolLayer,\"outline\",\"color\");return(this.draped?1:this._getLayerOpacity())*(t(e)?e.a:0)}_getOutlineColor(){const r=i(this.symbolLayer,\"outline\",\"color\"),n=this._getOutlineOpacity();return O(t(r)?e.toUnitRGB(r):null,n)}get test(){return{createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,i)=>this._createAs3DShape(e,t,i)}}}I.elevationModeChangeTypes={definedChanged:f.RECREATE,staysOnTheGround:f.NONE,onTheGroundChanged:f.RECREATE};const k=m(),z={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Y={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};export default I;export{I as Graphics3DPolygonFillSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}