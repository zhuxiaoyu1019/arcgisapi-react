{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { lerp as t } from \"../../../core/mathUtils.js\";\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport { s as n } from \"../../../chunks/vec3.js\";\nimport { c as r } from \"../../../chunks/vec3f64.js\";\nimport { s as o } from \"../../../chunks/vec4.js\";\nimport { c as s } from \"../../../chunks/vec4f64.js\";\nimport { empty as i } from \"../../../geometry/support/aaBoundingBox.js\";\nimport { BufferPool as c } from \"../../../geometry/support/buffer/BufferPool.js\";\nimport { newLayout as u } from \"../support/buffer/InterleavedLayout.js\";\nimport { ElevationData as f } from \"./ElevationData.js\";\nimport { MAX_PATCH_TESSELATION as a, GEOMETRY_VERTEX_STRIDE as m } from \"./TerrainConst.js\";\nimport { computeNormal as l } from \"../webgl-engine/materials/internal/MaterialUtil.js\";\nconst p = u().vec3f(\"position\").vec2f(\"uv0\"),\n      g = new c(t => p.createBuffer(t), t => t.count);\n\nclass h {\n  constructor() {\n    this.indices = null, this.vertexAttributes = null, this.boundingBox = i(), this.numSurfaceIndices = 0, this.numSkirtIndices = 0, this.numWithoutSkirtIndices = 0, this.numVertsPerRow = 0, this.skirtLength = 0, this.uvOffsetAndScale = s();\n  }\n\n}\n\nclass d {\n  constructor(t, e, n) {\n    this.values = t, this.numSurfaceIndices = e, this.numSkirtIndices = n;\n  }\n\n}\n\nfunction y() {\n  g.clear(), V.clear();\n}\n\nfunction w(t) {\n  g.release(t.vertexAttributes), t.vertexAttributes = null, t.indices = null;\n}\n\nconst I = 65536;\n\nfunction v(e, n, r, s, c, u, a, l) {\n  const p = c[0],\n        h = c[1],\n        d = c[2],\n        y = c[3],\n        w = .1 * a.radius * (y - h),\n        I = e.numVertsPerRow - 1,\n        v = e.numVertsPerRow - 1,\n        P = e.numVertsPerRow * e.numVertsPerRow,\n        V = 2 * I + 2 * v,\n        A = g.acquire(P + V),\n        M = A.position.typedBuffer,\n        j = A.uv0.typedBuffer,\n        O = s.geometryInfo.boundingBox;\n  i(O);\n  const T = n[2] - n[0],\n        U = n[3] - n[1],\n        q = d - p,\n        E = r[0],\n        N = r[1],\n        W = r[2];\n\n  for (let t = 0; t <= I; t++) {\n    const e = t / I,\n          r = p + e * q;\n    k[t] = Math.sin(r), B[t] = Math.cos(r), D[t] = e, L[t] = n[0] + e * T;\n  }\n\n  const C = u && !!(1 & l),\n        z = u && !!(2 & l);\n  let F = 0;\n\n  for (let o = 0; o <= v; o++) {\n    let r = o / v;\n    const s = t(h, y, r),\n          i = Math.cos(s),\n          c = Math.sin(s);\n    let l;\n    u ? (l = a.halfSemiMajorAxis * Math.log((1 + c) / (1 - c)), r = (l - n[1]) / U) : l = 180 * s / Math.PI;\n\n    for (let t = 0; t <= I; t++) {\n      const n = D[t],\n            s = k[t],\n            u = B[t];\n      let p = a.radius;\n      e.samplerData && (p += f.sample(L[t], l, e.samplerData) || 0);\n      const g = u * i * p - E,\n            h = s * i * p - N,\n            d = c * p - W;\n      S(g, h, d, O);\n      const y = m * F;\n      M[y + 0] = g, M[y + 1] = h, M[y + 2] = d, j[y + 0] = n, j[y + 1] = r;\n      const V = b(t, o, I, v);\n\n      if (V > -1) {\n        const t = m * (P + V),\n              e = C && 0 === o ? -1 : z && o === v ? 1 : 0,\n              s = 0 === e ? g : -E,\n              i = 0 === e ? h : -N,\n              c = 0 === e ? d : a.radius * e - W;\n        M[t + 0] = s, M[t + 1] = i, M[t + 2] = c, j[t + 0] = 0 === e ? R(n, r) : n, j[t + 1] = 0 === e ? w : r, 0 !== e && S(s, i, c, O);\n      }\n\n      ++F;\n    }\n  }\n\n  s.geometryInfo.numVertsPerRow = e.numVertsPerRow, s.geometryInfo.vertexAttributes = A, s.geometryInfo.skirtLength = w, o(s.geometryInfo.uvOffsetAndScale, 0, 0, 1, 1), x(s.geometryInfo, e.numVertsPerRow, u ? l : 0, e.wireframe);\n}\n\nfunction P(t, n, r, s) {\n  const c = n[0],\n        u = n[1],\n        a = n[2] - c,\n        l = n[3] - u,\n        p = t.clippingArea,\n        h = e(p) ? Math.max(0, (p[0] - n[0]) / a) : 0,\n        d = e(p) ? Math.max(0, (p[1] - n[1]) / l) : 0,\n        y = e(p) ? Math.min(1, (p[2] - n[0]) / a) : 1,\n        w = e(p) ? Math.min(1, (p[3] - n[1]) / l) : 1,\n        I = y > h ? 1 / (y - h) : 1,\n        v = w > d ? 1 / (w - d) : 1,\n        P = -h * I,\n        V = -d * v,\n        A = .1 * a,\n        M = t.numVertsPerRow - 1,\n        j = t.numVertsPerRow - 1,\n        k = t.numVertsPerRow * t.numVertsPerRow,\n        B = 2 * M + 2 * j,\n        D = g.acquire(k + B),\n        L = D.position.typedBuffer,\n        O = D.uv0.typedBuffer,\n        T = s.geometryInfo.boundingBox;\n  i(T);\n  let U = 0;\n\n  for (let o = 0; o <= j; o++) {\n    const n = o / j;\n    let s = V + n * v,\n        i = u + n * l;\n    e(p) && (i < p[1] ? (i = p[1], s = 0) : i > p[3] && (i = p[3], s = 1));\n\n    for (let u = 0; u <= M; u++) {\n      const n = u / M;\n      let l = P + n * I,\n          g = c + n * a;\n      e(p) && (g < p[0] ? (g = p[0], l = 0) : g > p[2] && (g = p[2], l = 1));\n      const h = t.samplerData && f.sample(g, i, t.samplerData) || 0,\n            d = g - r[0],\n            y = i - r[1],\n            w = h - r[2];\n      S(d, y, w, T);\n      const v = m * U;\n      L[v + 0] = d, L[v + 1] = y, L[v + 2] = w, O[v + 0] = l, O[v + 1] = s;\n      const V = b(u, o, M, M);\n\n      if (V > -1) {\n        const t = m * (k + V);\n        L[t + 0] = d, L[t + 1] = y, L[t + 2] = w, O[t + 0] = R(l, s), O[t + 1] = A;\n      }\n\n      ++U;\n    }\n  }\n\n  s.geometryInfo.numVertsPerRow = t.numVertsPerRow, s.geometryInfo.vertexAttributes = D, s.geometryInfo.skirtLength = A, o(s.geometryInfo.uvOffsetAndScale, h, d, y - h, w - d), x(s.geometryInfo, t.numVertsPerRow, 0, t.wireframe);\n}\n\nconst V = new Map();\n\nfunction x(t, e, n, r) {\n  const o = (2 & n) > 0,\n        s = e + (r ? 1024 : 0) + (o ? 2048 : 0);\n  let i = V.get(s);\n  i || (i = A(e, o, r), V.set(s, i)), t.indices = i.values, t.numSurfaceIndices = i.numSurfaceIndices, t.numSkirtIndices = i.numSkirtIndices, t.numWithoutSkirtIndices = t.numSurfaceIndices + (n ? 6 * (e - 1) * (r ? 2 : 1) : 0);\n}\n\nfunction A(t, e, n) {\n  const r = t - 1,\n        o = t - 1,\n        s = t * t,\n        i = 2 * r + 2 * o;\n  let c = r * o * 2 * 3,\n      u = 6 * i,\n      f = 6 * (2 * r + o - 1);\n  n && (c *= 2, u *= 2, f *= 2);\n  const a = s + i > I ? new Uint32Array(c + u) : new Uint16Array(c + u);\n  let m,\n      l,\n      p,\n      g,\n      h = 0,\n      y = 0,\n      w = c,\n      v = 0;\n\n  for (let d = 0; d <= o; d++) {\n    e && (v = 0 === d ? f : d === o ? -f : 0), w += v;\n\n    for (let t = 0; t <= r; t++) {\n      const e = b(t, d, r, o);\n\n      if (e > -1) {\n        const i = M(t, d, r, o);\n        0 !== i && (m = h, l = s + e, p = s + (0 === t && 1 === d ? 0 : e + 1), g = h + i, n ? (a[w + 0] = m, a[w + 1] = l, a[w + 2] = l, a[w + 3] = p, a[w + 4] = p, a[w + 5] = m, a[w + 6] = p, a[w + 7] = g, a[w + 8] = g, a[w + 9] = m, a[w + 10] = m, a[w + 11] = p, w += 12) : (a[w + 0] = m, a[w + 1] = l, a[w + 2] = p, a[w + 3] = p, a[w + 4] = g, a[w + 5] = m, w += 6));\n      }\n\n      ++h, t < r && d < o && (m = d * (r + 1) + t, l = m + 1, p = l + (r + 1), g = p - 1, n ? (a[y + 0] = m, a[y + 1] = l, a[y + 2] = l, a[y + 3] = p, a[y + 4] = p, a[y + 5] = m, a[y + 6] = p, a[y + 7] = g, a[y + 8] = g, a[y + 9] = m, a[y + 10] = m, a[y + 11] = p, y += 12) : (a[y + 0] = m, a[y + 1] = l, a[y + 2] = p, a[y + 3] = p, a[y + 4] = g, a[y + 5] = m, y += 6));\n    }\n\n    w -= v;\n  }\n\n  return new d(a, c, u);\n}\n\nfunction S(t, e, n, r) {\n  t < r[0] && (r[0] = t), t > r[3] && (r[3] = t), e < r[1] && (r[1] = e), e > r[4] && (r[4] = e), n < r[2] && (r[2] = n), n > r[5] && (r[5] = n);\n}\n\nfunction R(t, e) {\n  const n = e > t ? 1 : 0;\n  return 2 + 4 * n + (1 - 2 * n) * (t + e);\n}\n\nfunction b(t, e, n, r) {\n  return 0 === e ? t : t === n ? n + e : e === r ? n + r + (n - t) : 0 === t && e > 0 ? 2 * n + r + (r - e) : -1;\n}\n\nfunction M(t, e, n, r) {\n  return 0 === e && t !== n ? 1 : t === n && e !== r ? n + 1 : e === r && 0 !== t ? -1 : 0 === t && 0 !== e ? -(n + 1) : 0;\n}\n\nfunction j(t, r, o, s, i, c, u, f, a) {\n  const m = c.position,\n        p = c.uv0,\n        g = t[0],\n        h = t[1],\n        d = t[2],\n        y = r[0] - g,\n        w = r[1] - h,\n        I = r[2] - d;\n  s *= 3;\n\n  for (let v = o *= 3; v < s; v += 3) {\n    const t = i[v],\n          r = i[v + 1],\n          o = i[v + 2];\n    let s = m.get(t, 0),\n        c = m.get(t, 1),\n        P = m.get(t, 2),\n        V = m.get(r, 0),\n        x = m.get(r, 1),\n        A = m.get(r, 2),\n        S = m.get(o, 0),\n        R = m.get(o, 1),\n        b = m.get(o, 2);\n    p.get(t, 0) >= 2 && (n(O, s, c, P), u(O), s += O[0], c += O[1], P += O[2]);\n    p.get(r, 0) >= 2 && (n(O, V, x, A), u(O), V += O[0], x += O[1], A += O[2]);\n    p.get(o, 0) >= 2 && (n(O, S, R, b), u(O), S += O[0], R += O[1], b += O[2]), e(f) && ([s, c, P] = f.applyToVertex(s, c, P), [V, x, A] = f.applyToVertex(V, x, A), [S, R, b] = f.applyToVertex(S, R, b));\n    const M = V - s,\n          j = x - c,\n          k = A - P,\n          B = S - s,\n          D = R - c,\n          L = b - P,\n          U = w * L - D * I,\n          q = I * B - L * y,\n          E = y * D - B * w,\n          N = M * U + j * q + k * E;\n    if (Math.abs(N) <= Number.EPSILON) continue;\n    const W = g - s,\n          C = h - c,\n          z = d - P,\n          F = W * U + C * q + z * E;\n\n    if (N > 0) {\n      if (F < 0 || F > N) continue;\n    } else if (F > 0 || F < N) continue;\n\n    const G = C * k - j * z,\n          H = z * M - k * W,\n          J = W * j - M * C,\n          K = y * G + w * H + I * J;\n\n    if (N > 0) {\n      if (K < 0 || F + K > N) continue;\n    } else if (K > 0 || F + K < N) continue;\n\n    const Q = (B * G + D * H + L * J) / N;\n\n    if (Q >= 0) {\n      a(Q, l(M, j, k, B, D, L, T));\n    }\n  }\n}\n\nconst k = new Array(a + 1),\n      B = new Array(a + 1),\n      D = new Array(a + 1),\n      L = new Array(a + 1),\n      O = r(),\n      T = r();\nexport { h as PatchGeometry, y as clearCaches, P as createPlanarGlobePatch, v as createSphericalGlobePatch, j as intersectSkirts, w as releaseGeometry };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/terrain/PatchGeometryFactory.js"],"names":["lerp","t","isSome","e","s","n","c","r","o","empty","i","BufferPool","newLayout","u","ElevationData","f","MAX_PATCH_TESSELATION","a","GEOMETRY_VERTEX_STRIDE","m","computeNormal","l","p","vec3f","vec2f","g","createBuffer","count","h","constructor","indices","vertexAttributes","boundingBox","numSurfaceIndices","numSkirtIndices","numWithoutSkirtIndices","numVertsPerRow","skirtLength","uvOffsetAndScale","d","values","y","clear","V","w","release","I","v","radius","P","A","acquire","M","position","typedBuffer","j","uv0","O","geometryInfo","T","U","q","E","N","W","k","Math","sin","B","cos","D","L","C","z","F","halfSemiMajorAxis","log","PI","samplerData","sample","S","b","R","x","wireframe","clippingArea","max","min","Map","get","set","Uint32Array","Uint16Array","applyToVertex","abs","Number","EPSILON","G","H","J","K","Q","Array","PatchGeometry","clearCaches","createPlanarGlobePatch","createSphericalGlobePatch","intersectSkirts","releaseGeometry"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{lerp as t}from\"../../../core/mathUtils.js\";import{isSome as e}from\"../../../core/maybe.js\";import{s as n}from\"../../../chunks/vec3.js\";import{c as r}from\"../../../chunks/vec3f64.js\";import{s as o}from\"../../../chunks/vec4.js\";import{c as s}from\"../../../chunks/vec4f64.js\";import{empty as i}from\"../../../geometry/support/aaBoundingBox.js\";import{BufferPool as c}from\"../../../geometry/support/buffer/BufferPool.js\";import{newLayout as u}from\"../support/buffer/InterleavedLayout.js\";import{ElevationData as f}from\"./ElevationData.js\";import{MAX_PATCH_TESSELATION as a,GEOMETRY_VERTEX_STRIDE as m}from\"./TerrainConst.js\";import{computeNormal as l}from\"../webgl-engine/materials/internal/MaterialUtil.js\";const p=u().vec3f(\"position\").vec2f(\"uv0\"),g=new c((t=>p.createBuffer(t)),(t=>t.count));class h{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=i(),this.numSurfaceIndices=0,this.numSkirtIndices=0,this.numWithoutSkirtIndices=0,this.numVertsPerRow=0,this.skirtLength=0,this.uvOffsetAndScale=s()}}class d{constructor(t,e,n){this.values=t,this.numSurfaceIndices=e,this.numSkirtIndices=n}}function y(){g.clear(),V.clear()}function w(t){g.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const I=65536;function v(e,n,r,s,c,u,a,l){const p=c[0],h=c[1],d=c[2],y=c[3],w=.1*a.radius*(y-h),I=e.numVertsPerRow-1,v=e.numVertsPerRow-1,P=e.numVertsPerRow*e.numVertsPerRow,V=2*I+2*v,A=g.acquire(P+V),M=A.position.typedBuffer,j=A.uv0.typedBuffer,O=s.geometryInfo.boundingBox;i(O);const T=n[2]-n[0],U=n[3]-n[1],q=d-p,E=r[0],N=r[1],W=r[2];for(let t=0;t<=I;t++){const e=t/I,r=p+e*q;k[t]=Math.sin(r),B[t]=Math.cos(r),D[t]=e,L[t]=n[0]+e*T}const C=u&&!!(1&l),z=u&&!!(2&l);let F=0;for(let o=0;o<=v;o++){let r=o/v;const s=t(h,y,r),i=Math.cos(s),c=Math.sin(s);let l;u?(l=a.halfSemiMajorAxis*Math.log((1+c)/(1-c)),r=(l-n[1])/U):l=180*s/Math.PI;for(let t=0;t<=I;t++){const n=D[t],s=k[t],u=B[t];let p=a.radius;e.samplerData&&(p+=f.sample(L[t],l,e.samplerData)||0);const g=u*i*p-E,h=s*i*p-N,d=c*p-W;S(g,h,d,O);const y=m*F;M[y+0]=g,M[y+1]=h,M[y+2]=d,j[y+0]=n,j[y+1]=r;const V=b(t,o,I,v);if(V>-1){const t=m*(P+V),e=C&&0===o?-1:z&&o===v?1:0,s=0===e?g:-E,i=0===e?h:-N,c=0===e?d:a.radius*e-W;M[t+0]=s,M[t+1]=i,M[t+2]=c,j[t+0]=0===e?R(n,r):n,j[t+1]=0===e?w:r,0!==e&&S(s,i,c,O)}++F}}s.geometryInfo.numVertsPerRow=e.numVertsPerRow,s.geometryInfo.vertexAttributes=A,s.geometryInfo.skirtLength=w,o(s.geometryInfo.uvOffsetAndScale,0,0,1,1),x(s.geometryInfo,e.numVertsPerRow,u?l:0,e.wireframe)}function P(t,n,r,s){const c=n[0],u=n[1],a=n[2]-c,l=n[3]-u,p=t.clippingArea,h=e(p)?Math.max(0,(p[0]-n[0])/a):0,d=e(p)?Math.max(0,(p[1]-n[1])/l):0,y=e(p)?Math.min(1,(p[2]-n[0])/a):1,w=e(p)?Math.min(1,(p[3]-n[1])/l):1,I=y>h?1/(y-h):1,v=w>d?1/(w-d):1,P=-h*I,V=-d*v,A=.1*a,M=t.numVertsPerRow-1,j=t.numVertsPerRow-1,k=t.numVertsPerRow*t.numVertsPerRow,B=2*M+2*j,D=g.acquire(k+B),L=D.position.typedBuffer,O=D.uv0.typedBuffer,T=s.geometryInfo.boundingBox;i(T);let U=0;for(let o=0;o<=j;o++){const n=o/j;let s=V+n*v,i=u+n*l;e(p)&&(i<p[1]?(i=p[1],s=0):i>p[3]&&(i=p[3],s=1));for(let u=0;u<=M;u++){const n=u/M;let l=P+n*I,g=c+n*a;e(p)&&(g<p[0]?(g=p[0],l=0):g>p[2]&&(g=p[2],l=1));const h=t.samplerData&&f.sample(g,i,t.samplerData)||0,d=g-r[0],y=i-r[1],w=h-r[2];S(d,y,w,T);const v=m*U;L[v+0]=d,L[v+1]=y,L[v+2]=w,O[v+0]=l,O[v+1]=s;const V=b(u,o,M,M);if(V>-1){const t=m*(k+V);L[t+0]=d,L[t+1]=y,L[t+2]=w,O[t+0]=R(l,s),O[t+1]=A}++U}}s.geometryInfo.numVertsPerRow=t.numVertsPerRow,s.geometryInfo.vertexAttributes=D,s.geometryInfo.skirtLength=A,o(s.geometryInfo.uvOffsetAndScale,h,d,y-h,w-d),x(s.geometryInfo,t.numVertsPerRow,0,t.wireframe)}const V=new Map;function x(t,e,n,r){const o=(2&n)>0,s=e+(r?1024:0)+(o?2048:0);let i=V.get(s);i||(i=A(e,o,r),V.set(s,i)),t.indices=i.values,t.numSurfaceIndices=i.numSurfaceIndices,t.numSkirtIndices=i.numSkirtIndices,t.numWithoutSkirtIndices=t.numSurfaceIndices+(n?6*(e-1)*(r?2:1):0)}function A(t,e,n){const r=t-1,o=t-1,s=t*t,i=2*r+2*o;let c=r*o*2*3,u=6*i,f=6*(2*r+o-1);n&&(c*=2,u*=2,f*=2);const a=s+i>I?new Uint32Array(c+u):new Uint16Array(c+u);let m,l,p,g,h=0,y=0,w=c,v=0;for(let d=0;d<=o;d++){e&&(v=0===d?f:d===o?-f:0),w+=v;for(let t=0;t<=r;t++){const e=b(t,d,r,o);if(e>-1){const i=M(t,d,r,o);0!==i&&(m=h,l=s+e,p=s+(0===t&&1===d?0:e+1),g=h+i,n?(a[w+0]=m,a[w+1]=l,a[w+2]=l,a[w+3]=p,a[w+4]=p,a[w+5]=m,a[w+6]=p,a[w+7]=g,a[w+8]=g,a[w+9]=m,a[w+10]=m,a[w+11]=p,w+=12):(a[w+0]=m,a[w+1]=l,a[w+2]=p,a[w+3]=p,a[w+4]=g,a[w+5]=m,w+=6))}++h,t<r&&d<o&&(m=d*(r+1)+t,l=m+1,p=l+(r+1),g=p-1,n?(a[y+0]=m,a[y+1]=l,a[y+2]=l,a[y+3]=p,a[y+4]=p,a[y+5]=m,a[y+6]=p,a[y+7]=g,a[y+8]=g,a[y+9]=m,a[y+10]=m,a[y+11]=p,y+=12):(a[y+0]=m,a[y+1]=l,a[y+2]=p,a[y+3]=p,a[y+4]=g,a[y+5]=m,y+=6))}w-=v}return new d(a,c,u)}function S(t,e,n,r){t<r[0]&&(r[0]=t),t>r[3]&&(r[3]=t),e<r[1]&&(r[1]=e),e>r[4]&&(r[4]=e),n<r[2]&&(r[2]=n),n>r[5]&&(r[5]=n)}function R(t,e){const n=e>t?1:0;return 2+4*n+(1-2*n)*(t+e)}function b(t,e,n,r){return 0===e?t:t===n?n+e:e===r?n+r+(n-t):0===t&&e>0?2*n+r+(r-e):-1}function M(t,e,n,r){return 0===e&&t!==n?1:t===n&&e!==r?n+1:e===r&&0!==t?-1:0===t&&0!==e?-(n+1):0}function j(t,r,o,s,i,c,u,f,a){const m=c.position,p=c.uv0,g=t[0],h=t[1],d=t[2],y=r[0]-g,w=r[1]-h,I=r[2]-d;s*=3;for(let v=o*=3;v<s;v+=3){const t=i[v],r=i[v+1],o=i[v+2];let s=m.get(t,0),c=m.get(t,1),P=m.get(t,2),V=m.get(r,0),x=m.get(r,1),A=m.get(r,2),S=m.get(o,0),R=m.get(o,1),b=m.get(o,2);p.get(t,0)>=2&&(n(O,s,c,P),u(O),s+=O[0],c+=O[1],P+=O[2]);p.get(r,0)>=2&&(n(O,V,x,A),u(O),V+=O[0],x+=O[1],A+=O[2]);p.get(o,0)>=2&&(n(O,S,R,b),u(O),S+=O[0],R+=O[1],b+=O[2]),e(f)&&([s,c,P]=f.applyToVertex(s,c,P),[V,x,A]=f.applyToVertex(V,x,A),[S,R,b]=f.applyToVertex(S,R,b));const M=V-s,j=x-c,k=A-P,B=S-s,D=R-c,L=b-P,U=w*L-D*I,q=I*B-L*y,E=y*D-B*w,N=M*U+j*q+k*E;if(Math.abs(N)<=Number.EPSILON)continue;const W=g-s,C=h-c,z=d-P,F=W*U+C*q+z*E;if(N>0){if(F<0||F>N)continue}else if(F>0||F<N)continue;const G=C*k-j*z,H=z*M-k*W,J=W*j-M*C,K=y*G+w*H+I*J;if(N>0){if(K<0||F+K>N)continue}else if(K>0||F+K<N)continue;const Q=(B*G+D*H+L*J)/N;if(Q>=0){a(Q,l(M,j,k,B,D,L,T))}}}const k=new Array(a+1),B=new Array(a+1),D=new Array(a+1),L=new Array(a+1),O=r(),T=r();export{h as PatchGeometry,y as clearCaches,P as createPlanarGlobePatch,v as createSphericalGlobePatch,j as intersectSkirts,w as releaseGeometry};\n"]},"metadata":{},"sourceType":"module"}