{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as t } from \"../../../../core/maybe.js\";\n\nclass i {\n  constructor(e, t, i = 2048) {\n    this.text = e, this._parameters = t, this.maxSize = i, this._lineWidths = new Array(), this._renderPixelRatio = null, this._displayWidth = null, this.key = `${this._parameters.key}--${e}`, this._lines = e.split(/\\r?\\n/), this._lineHeight = this.computeLineHeight();\n  }\n\n  get displayWidth() {\n    return this._ensureTextWidth();\n  }\n\n  get displayHeight() {\n    return this._lineHeight * this._lines.length;\n  }\n\n  get renderedWidth() {\n    return Math.round(this.displayWidth * this.renderPixelRatio);\n  }\n\n  get renderedHeight() {\n    return Math.round(this.displayHeight * this.renderPixelRatio);\n  }\n\n  get renderedLineHeight() {\n    return Math.round(this._lineHeight * this.renderPixelRatio);\n  }\n\n  get renderedFontSize() {\n    return this._parameters.definition.size * this.renderPixelRatio;\n  }\n\n  get renderedHaloSize() {\n    return this._parameters.haloSize * this.renderPixelRatio;\n  }\n\n  get renderPixelRatio() {\n    if (e(this._renderPixelRatio)) {\n      const e = this._parameters.definition.pixelRatio;\n      this.maxSize > 0 ? this._renderPixelRatio = Math.min(e, Math.min(this.maxSize / (this.displayWidth * e), this.maxSize / (this.displayHeight * e))) : this._renderPixelRatio = e;\n    }\n\n    return this._renderPixelRatio;\n  }\n\n  getLineXOffset(e) {\n    return Math.round((this.renderedWidth - this._lineWidths[e] * this.renderPixelRatio) / 2);\n  }\n\n  render(e, t = 0, i = 0) {\n    const n = this.renderedLineHeight,\n          h = this.renderedHaloSize,\n          a = s(e.textAlign, this.renderedWidth) + h,\n          l = h + r;\n    e.save(), h > 0 && this.renderHalo(e, a, l, t, i), this.setFontProperties(e, this.renderedFontSize), i += l, t += a;\n\n    for (let s = 0; s < this._lines.length; ++s) {\n      e.globalCompositeOperation = \"destination-out\", e.fillStyle = \"rgb(0, 0, 0)\";\n      const r = this._lines[s],\n            h = this.getLineXOffset(s);\n      e.fillText(r, t + h, i), e.globalCompositeOperation = \"source-over\", e.fillStyle = this._parameters.fillStyle, e.fillText(r, t + this.getLineXOffset(s), i), i += n;\n    }\n\n    e.restore();\n  }\n\n  renderHalo(e, t, i, s, r) {\n    const n = this.renderedWidth,\n          o = this.renderedHeight,\n          d = h(a, Math.max(n, l), Math.max(o, l)),\n          g = d.getContext(\"2d\");\n    g.clearRect(0, 0, n, o), this.setFontProperties(g, this.renderedFontSize), g.fillStyle = this._parameters.haloStyle, g.strokeStyle = this._parameters.haloStyle;\n    const p = this.renderedHaloSize < 3;\n    g.lineJoin = p ? \"miter\" : \"round\", p ? this.renderHaloEmulated(g, t, i) : this.renderHaloNative(g, t, i), e.globalAlpha = this._parameters.definition.halo.color[3], e.drawImage(d, 0, 0, n, o, s, r, n, o), e.globalAlpha = 1;\n  }\n\n  renderHaloEmulated(e, t, i) {\n    const s = this.renderedLineHeight,\n          r = this.renderedHaloSize;\n\n    for (let h = 0; h < this._lines.length; ++h) {\n      const a = this._lines[h],\n            l = this.getLineXOffset(h);\n\n      for (const [s, h] of n) e.fillText(a, t + l + r * s, i + r * h);\n\n      i += s;\n    }\n  }\n\n  renderHaloNative(e, t, i) {\n    const s = this.renderedLineHeight,\n          r = this.renderedHaloSize;\n\n    for (let n = 0; n < this._lines.length; ++n) {\n      const h = 2 * r,\n            a = this._lines[n],\n            l = this.getLineXOffset(n),\n            o = 5,\n            d = .1;\n\n      for (let s = 0; s < o; s++) {\n        const r = 1 - (o - 1) * d + s * d;\n        e.lineWidth = r * h, e.strokeText(a, t + l, i);\n      }\n\n      i += s;\n    }\n  }\n\n  setFontProperties(e, t) {\n    const i = this._parameters.definition.font,\n          s = `${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`;\n    e.font = s, e.textAlign = \"left\", e.textBaseline = \"top\";\n  }\n\n  _ensureTextWidth() {\n    if (t(this._displayWidth)) return this._displayWidth;\n    const e = h(a, l, l).getContext(\"2d\");\n    this.setFontProperties(e, this._parameters.definition.size);\n    let i = 0,\n        s = 2 * this._parameters.haloSize;\n    this._lineWidths.length = 0;\n    const r = this._parameters.definition.font;\n    (\"italic\" === r.style || \"oblique\" === r.style || \"string\" == typeof r.weight && (\"bold\" === r.weight || \"bolder\" === r.weight) || \"number\" == typeof r.weight && r.weight > 600) && (s += .3 * e.measureText(\"A\").width);\n\n    for (const t of this._lines) {\n      const r = Math.round(e.measureText(t).width + s);\n      this._lineWidths.push(r), i = Math.max(i, r);\n    }\n\n    return this._displayWidth = i, this._displayWidth;\n  }\n\n  computeLineHeight() {\n    const e = 1.275 * this._parameters.definition.size;\n    return Math.ceil(e + 2 * this._parameters.haloSize) + r;\n  }\n\n}\n\nfunction s(e, t) {\n  return \"center\" === e ? .5 * t : \"right\" === e ? t : 0;\n}\n\nconst r = 1,\n      n = [];\n{\n  const e = 16;\n\n  for (let t = 0; t < 360; t += 360 / e) n.push([Math.cos(Math.PI * t / 180), Math.sin(Math.PI * t / 180)]);\n}\n\nfunction h(e, t, i) {\n  return e.canvas || (e.canvas = document.createElement(\"canvas\")), e.canvas.width = t, e.canvas.height = i, e.canvas;\n}\n\nconst a = {\n  canvas: null\n},\n      l = 512;\nexport default i;\nexport { i as TextRenderer, h as getTextHelperCanvas };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextRenderer.js"],"names":["isNone","e","isSome","t","i","constructor","text","_parameters","maxSize","_lineWidths","Array","_renderPixelRatio","_displayWidth","key","_lines","split","_lineHeight","computeLineHeight","displayWidth","_ensureTextWidth","displayHeight","length","renderedWidth","Math","round","renderPixelRatio","renderedHeight","renderedLineHeight","renderedFontSize","definition","size","renderedHaloSize","haloSize","pixelRatio","min","getLineXOffset","render","n","h","a","s","textAlign","l","r","save","renderHalo","setFontProperties","globalCompositeOperation","fillStyle","fillText","restore","o","d","max","g","getContext","clearRect","haloStyle","strokeStyle","p","lineJoin","renderHaloEmulated","renderHaloNative","globalAlpha","halo","color","drawImage","lineWidth","strokeText","font","style","weight","family","textBaseline","measureText","width","push","ceil","cos","PI","sin","canvas","document","createElement","height","TextRenderer","getTextHelperCanvas"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as t}from\"../../../../core/maybe.js\";class i{constructor(e,t,i=2048){this.text=e,this._parameters=t,this.maxSize=i,this._lineWidths=new Array,this._renderPixelRatio=null,this._displayWidth=null,this.key=`${this._parameters.key}--${e}`,this._lines=e.split(/\\r?\\n/),this._lineHeight=this.computeLineHeight()}get displayWidth(){return this._ensureTextWidth()}get displayHeight(){return this._lineHeight*this._lines.length}get renderedWidth(){return Math.round(this.displayWidth*this.renderPixelRatio)}get renderedHeight(){return Math.round(this.displayHeight*this.renderPixelRatio)}get renderedLineHeight(){return Math.round(this._lineHeight*this.renderPixelRatio)}get renderedFontSize(){return this._parameters.definition.size*this.renderPixelRatio}get renderedHaloSize(){return this._parameters.haloSize*this.renderPixelRatio}get renderPixelRatio(){if(e(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio}getLineXOffset(e){return Math.round((this.renderedWidth-this._lineWidths[e]*this.renderPixelRatio)/2)}render(e,t=0,i=0){const n=this.renderedLineHeight,h=this.renderedHaloSize,a=s(e.textAlign,this.renderedWidth)+h,l=h+r;e.save(),h>0&&this.renderHalo(e,a,l,t,i),this.setFontProperties(e,this.renderedFontSize),i+=l,t+=a;for(let s=0;s<this._lines.length;++s){e.globalCompositeOperation=\"destination-out\",e.fillStyle=\"rgb(0, 0, 0)\";const r=this._lines[s],h=this.getLineXOffset(s);e.fillText(r,t+h,i),e.globalCompositeOperation=\"source-over\",e.fillStyle=this._parameters.fillStyle,e.fillText(r,t+this.getLineXOffset(s),i),i+=n}e.restore()}renderHalo(e,t,i,s,r){const n=this.renderedWidth,o=this.renderedHeight,d=h(a,Math.max(n,l),Math.max(o,l)),g=d.getContext(\"2d\");g.clearRect(0,0,n,o),this.setFontProperties(g,this.renderedFontSize),g.fillStyle=this._parameters.haloStyle,g.strokeStyle=this._parameters.haloStyle;const p=this.renderedHaloSize<3;g.lineJoin=p?\"miter\":\"round\",p?this.renderHaloEmulated(g,t,i):this.renderHaloNative(g,t,i),e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(d,0,0,n,o,s,r,n,o),e.globalAlpha=1}renderHaloEmulated(e,t,i){const s=this.renderedLineHeight,r=this.renderedHaloSize;for(let h=0;h<this._lines.length;++h){const a=this._lines[h],l=this.getLineXOffset(h);for(const[s,h]of n)e.fillText(a,t+l+r*s,i+r*h);i+=s}}renderHaloNative(e,t,i){const s=this.renderedLineHeight,r=this.renderedHaloSize;for(let n=0;n<this._lines.length;++n){const h=2*r,a=this._lines[n],l=this.getLineXOffset(n),o=5,d=.1;for(let s=0;s<o;s++){const r=1-(o-1)*d+s*d;e.lineWidth=r*h,e.strokeText(a,t+l,i)}i+=s}}setFontProperties(e,t){const i=this._parameters.definition.font,s=`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`;e.font=s,e.textAlign=\"left\",e.textBaseline=\"top\"}_ensureTextWidth(){if(t(this._displayWidth))return this._displayWidth;const e=h(a,l,l).getContext(\"2d\");this.setFontProperties(e,this._parameters.definition.size);let i=0,s=2*this._parameters.haloSize;this._lineWidths.length=0;const r=this._parameters.definition.font;(\"italic\"===r.style||\"oblique\"===r.style||\"string\"==typeof r.weight&&(\"bold\"===r.weight||\"bolder\"===r.weight)||\"number\"==typeof r.weight&&r.weight>600)&&(s+=.3*e.measureText(\"A\").width);for(const t of this._lines){const r=Math.round(e.measureText(t).width+s);this._lineWidths.push(r),i=Math.max(i,r)}return this._displayWidth=i,this._displayWidth}computeLineHeight(){const e=1.275*this._parameters.definition.size;return Math.ceil(e+2*this._parameters.haloSize)+r}}function s(e,t){return\"center\"===e?.5*t:\"right\"===e?t:0}const r=1,n=[];{const e=16;for(let t=0;t<360;t+=360/e)n.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}function h(e,t,i){return e.canvas||(e.canvas=document.createElement(\"canvas\")),e.canvas.width=t,e.canvas.height=i,e.canvas}const a={canvas:null},l=512;export default i;export{i as TextRenderer,h as getTextHelperCanvas};\n"]},"metadata":{},"sourceType":"module"}