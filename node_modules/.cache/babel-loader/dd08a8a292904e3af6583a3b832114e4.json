{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../../core/Logger.js\";\nimport { analyzeCIMResource as t } from \"../../../../../../symbols/cim/cimAnalyzer.js\";\nimport a from \"./WGLMeshTemplate.js\";\nconst i = e.getLogger(\"esri.views.2d.engine.webgl.WGLDynamicMeshTemplate\");\n\nclass s extends a {\n  constructor(e) {\n    super(), this._ongoingMaterialRequestMap = new Map(), this._materialCache = new Map(), this._dynamicPropertyMap = new Map(), this._cimLayer = e;\n  }\n\n  analyze(e, a, s, r) {\n    const o = a.readLegacyFeature(),\n          n = this._materialCache,\n          m = this._cimLayer.materialHash;\n    if (!m) return i.error(\"A Dynamic mesh template must have a material hash value or function!\"), Promise.reject(null);\n    const c = \"function\" == typeof m ? m(o, s, r) : m;\n\n    if (n.has(c)) {\n      const e = n.get(c);\n      return Promise.resolve(e);\n    }\n\n    if (this._ongoingMaterialRequestMap.has(c)) return this._ongoingMaterialRequestMap.get(c);\n    const l = t(this._cimLayer.cim, this._cimLayer.materialOverrides);\n    l.mosaicHash = c;\n    const h = e.getMosaicItem(l).then(e => (this._ongoingMaterialRequestMap.delete(c), n.set(c, e), e)).catch(e => (this._ongoingMaterialRequestMap.delete(c), i.error(\".analyze()\", e.message), null));\n    return this._ongoingMaterialRequestMap.set(c, h), h;\n  }\n\n}\n\nexport default s;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate.js"],"names":["e","analyzeCIMResource","t","a","i","getLogger","s","constructor","_ongoingMaterialRequestMap","Map","_materialCache","_dynamicPropertyMap","_cimLayer","analyze","r","o","readLegacyFeature","n","m","materialHash","error","Promise","reject","c","has","get","resolve","l","cim","materialOverrides","mosaicHash","h","getMosaicItem","then","delete","set","catch","message"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,kCAAb;AAAgD,SAAOC,kBAAkB,IAAIC,CAA7B,QAAmC,8CAAnC;AAAkF,OAAOC,CAAP,MAAa,sBAAb;AAAoC,MAAMC,CAAC,GAACJ,CAAC,CAACK,SAAF,CAAY,mDAAZ,CAAR;;AAAyE,MAAMC,CAAN,SAAgBH,CAAhB,CAAiB;AAACI,EAAAA,WAAW,CAACP,CAAD,EAAG;AAAC,aAAQ,KAAKQ,0BAAL,GAAgC,IAAIC,GAAJ,EAAxC,EAAgD,KAAKC,cAAL,GAAoB,IAAID,GAAJ,EAApE,EAA4E,KAAKE,mBAAL,GAAyB,IAAIF,GAAJ,EAArG,EAA6G,KAAKG,SAAL,GAAeZ,CAA5H;AAA8H;;AAAAa,EAAAA,OAAO,CAACb,CAAD,EAAGG,CAAH,EAAKG,CAAL,EAAOQ,CAAP,EAAS;AAAC,UAAMC,CAAC,GAACZ,CAAC,CAACa,iBAAF,EAAR;AAAA,UAA8BC,CAAC,GAAC,KAAKP,cAArC;AAAA,UAAoDQ,CAAC,GAAC,KAAKN,SAAL,CAAeO,YAArE;AAAkF,QAAG,CAACD,CAAJ,EAAM,OAAOd,CAAC,CAACgB,KAAF,CAAQ,sEAAR,GAAgFC,OAAO,CAACC,MAAR,CAAe,IAAf,CAAvF;AAA4G,UAAMC,CAAC,GAAC,cAAY,OAAOL,CAAnB,GAAqBA,CAAC,CAACH,CAAD,EAAGT,CAAH,EAAKQ,CAAL,CAAtB,GAA8BI,CAAtC;;AAAwC,QAAGD,CAAC,CAACO,GAAF,CAAMD,CAAN,CAAH,EAAY;AAAC,YAAMvB,CAAC,GAACiB,CAAC,CAACQ,GAAF,CAAMF,CAAN,CAAR;AAAiB,aAAOF,OAAO,CAACK,OAAR,CAAgB1B,CAAhB,CAAP;AAA0B;;AAAA,QAAG,KAAKQ,0BAAL,CAAgCgB,GAAhC,CAAoCD,CAApC,CAAH,EAA0C,OAAO,KAAKf,0BAAL,CAAgCiB,GAAhC,CAAoCF,CAApC,CAAP;AAA8C,UAAMI,CAAC,GAACzB,CAAC,CAAC,KAAKU,SAAL,CAAegB,GAAhB,EAAoB,KAAKhB,SAAL,CAAeiB,iBAAnC,CAAT;AAA+DF,IAAAA,CAAC,CAACG,UAAF,GAAaP,CAAb;AAAe,UAAMQ,CAAC,GAAC/B,CAAC,CAACgC,aAAF,CAAgBL,CAAhB,EAAmBM,IAAnB,CAAyBjC,CAAC,KAAG,KAAKQ,0BAAL,CAAgC0B,MAAhC,CAAuCX,CAAvC,GAA0CN,CAAC,CAACkB,GAAF,CAAMZ,CAAN,EAAQvB,CAAR,CAA1C,EAAqDA,CAAxD,CAA1B,EAAuFoC,KAAvF,CAA8FpC,CAAC,KAAG,KAAKQ,0BAAL,CAAgC0B,MAAhC,CAAuCX,CAAvC,GAA0CnB,CAAC,CAACgB,KAAF,CAAQ,YAAR,EAAqBpB,CAAC,CAACqC,OAAvB,CAA1C,EAA0E,IAA7E,CAA/F,CAAR;AAA4L,WAAO,KAAK7B,0BAAL,CAAgC2B,GAAhC,CAAoCZ,CAApC,EAAsCQ,CAAtC,GAAyCA,CAAhD;AAAkD;;AAAv1B;;AAAw1B,eAAezB,CAAf","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../../core/Logger.js\";import{analyzeCIMResource as t}from\"../../../../../../symbols/cim/cimAnalyzer.js\";import a from\"./WGLMeshTemplate.js\";const i=e.getLogger(\"esri.views.2d.engine.webgl.WGLDynamicMeshTemplate\");class s extends a{constructor(e){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=e}analyze(e,a,s,r){const o=a.readLegacyFeature(),n=this._materialCache,m=this._cimLayer.materialHash;if(!m)return i.error(\"A Dynamic mesh template must have a material hash value or function!\"),Promise.reject(null);const c=\"function\"==typeof m?m(o,s,r):m;if(n.has(c)){const e=n.get(c);return Promise.resolve(e)}if(this._ongoingMaterialRequestMap.has(c))return this._ongoingMaterialRequestMap.get(c);const l=t(this._cimLayer.cim,this._cimLayer.materialOverrides);l.mosaicHash=c;const h=e.getMosaicItem(l).then((e=>(this._ongoingMaterialRequestMap.delete(c),n.set(c,e),e))).catch((e=>(this._ongoingMaterialRequestMap.delete(c),i.error(\".analyze()\",e.message),null)));return this._ongoingMaterialRequestMap.set(c,h),h}}export default s;\n"]},"metadata":{},"sourceType":"module"}