{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport i from \"../../../../core/has.js\";\nimport { acosClamped as s, clamp as o } from \"../../../../core/mathUtils.js\";\nimport { createScreenPointArray as r } from \"../../../../core/screenUtils.js\";\nimport { property as e } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as a } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { i as n, c as p } from \"../../../../chunks/mat4.js\";\nimport { c as h } from \"../../../../chunks/mat4f64.js\";\nimport { c } from \"../../../../chunks/vec2.js\";\nimport { a as m } from \"../../../../chunks/vec2f64.js\";\nimport { g as l, f as v, l as u, n as f, b as P, a as d, d as C, c as w, m as j } from \"../../../../chunks/vec3.js\";\nimport { c as y } from \"../../../../chunks/vec3f64.js\";\nimport { getReferenceEllipsoid as R } from \"../../../../geometry/projectionEllipsoid.js\";\nimport { applyAll as g } from \"../../camera/constraintUtils.js\";\nimport { TiltDefault as x } from \"../Constraints.js\";\nimport { InteractiveController as T } from \"./InteractiveController.js\";\nimport { normalizeCoordinate as D, decideNavigationMode as M, NavigationMode as k } from \"../utils/navigationUtils.js\";\nconst O = 7,\n      V = 90;\nlet b = class extends T {\n  constructor(t) {\n    super(t), this.view = null, this.pivot = 0, this.lastPoint = m(), this.tmpWorldUp = y(), this.tmpViewDir = y(), this.tmpRotCurPoint = m(), this.tmpTransf = h(), this.tmpAxis = y(), this.tmpPivotPoint = y(), this.pivotPos = y(), this.constraintOptions = {\n      selection: 15,\n      interactionType: 2,\n      interactionFactor: 0,\n      interactionStartCamera: null,\n      interactionDirection: null,\n      tiltMode: 0\n    };\n  }\n\n  get intersectionHelper() {\n    return this.view.sceneIntersectionHelper;\n  }\n\n  initialize() {\n    this.rotScale = 0 === this.pivot ? 3 : 1.5;\n  }\n\n  begin(t) {\n    if (this.active) {\n      switch (this.pivot) {\n        case 1:\n          l(this.pivotPos, this.startCamera.eye), this.constraintOptions.interactionType = 3, this.constraintOptions.tiltMode = 1, this.constraintOptions.selection = 0;\n          break;\n\n        case 0:\n          this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray, this.pivotPos) || l(this.pivotPos, this.startCamera.center), i(\"disable-feature:context-navigation\") || this.constrainPivotPoint(t), this.startCamera.center = this.pivotPos, this.constraintOptions.interactionType = 2, this.constraintOptions.tiltMode = 0, this.constraintOptions.selection = 11;\n      }\n\n      this.constraintOptions.interactionStartCamera = this.startCamera, D(this.startCamera, t, this.lastPoint);\n    }\n  }\n\n  constrainPivotPoint(t) {\n    const i = this.startCamera,\n          s = y();\n    v(s, this.pivotPos, i.eye);\n    let o = u(s);\n    this.view.camera.position.hasZ && (o = Math.min(o, O * Math.abs(this.view.camera.position.z)));\n    const e = R(this.view.spatialReference),\n          a = r(i.width / i.pixelRatio * .5, i.height / i.pixelRatio * .5),\n          n = M(this.startCamera, a, !0, e);\n\n    let p = this.view._stage.renderView.getMinimalDepthForArea(i.fullWidth / i.pixelRatio * .5, i.fullHeight / i.pixelRatio * .5, i, 2.5 * V, V),\n        h = this.view._stage.renderView.getMinimalDepthForArea(t[0], t[1], i, V);\n\n    void 0 === p && void 0 === h || (p = void 0 === p ? h : p, h = void 0 === h || n === k.Horizontal ? p : h, o = p > h ? h : p), f(s, s), l(this.pivotPos, P(this.tmpPivotPoint, i.eye, d(this.tmpPivotPoint, s, o)));\n  }\n\n  update(t) {\n    if (this.active) {\n      switch (this.pivot) {\n        case 1:\n          this.currentCamera.center = this.applyRotation(this.currentCamera, t, this.currentCamera.center, this.pivotPos);\n          break;\n\n        case 0:\n          this.currentCamera.center = this.pivotPos, this.currentCamera.eye = this.applyRotation(this.currentCamera, t, this.currentCamera.eye, this.pivotPos);\n      }\n\n      g(this.view, this.currentCamera, this.constraintOptions);\n    }\n  }\n\n  end() {\n    this.active && this.finishController();\n  }\n\n  applyRotation(t, i, r, e) {\n    this.view.renderCoordsHelper.worldUpAtPosition(e, this.tmpWorldUp), D(t, i, this.tmpRotCurPoint);\n    let a = (this.lastPoint[1] - this.tmpRotCurPoint[1]) * this.rotScale,\n        h = (this.tmpRotCurPoint[0] - this.lastPoint[0]) * this.rotScale;\n    v(this.tmpViewDir, r, e);\n    const m = u(this.tmpViewDir),\n          l = s(C(this.tmpViewDir, this.tmpWorldUp) / m);\n\n    if (1 === this.pivot) {\n      a *= -.5;\n      const t = .5 * Math.PI - l,\n            i = .5 * Math.PI * .99;\n      a = t - Math.max(-i, Math.min(i, t + a));\n    }\n\n    return a = o(a + l, x.min, x.max) - l, n(this.tmpTransf), w(this.tmpAxis, t.up, this.tmpViewDir), 0 === this.pivot && (h = -h), p(this.tmpTransf, this.tmpTransf, h, this.tmpWorldUp), p(this.tmpTransf, this.tmpTransf, a, this.tmpAxis), j(this.tmpViewDir, this.tmpViewDir, this.tmpTransf), t.up = j(U, t.up, this.tmpTransf), P(U, e, this.tmpViewDir), c(this.lastPoint, this.tmpRotCurPoint), U;\n  }\n\n};\nt([e({\n  constructOnly: !0\n})], b.prototype, \"view\", void 0), t([e()], b.prototype, \"pivot\", void 0), b = t([a(\"esri.views.3d.state.controllers.RotateController\")], b);\nconst U = y();\nexport { b as RotateController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/state/controllers/RotateController.js"],"names":["_","t","i","acosClamped","s","clamp","o","createScreenPointArray","r","property","e","subclass","a","n","c","p","h","m","g","l","f","v","u","b","P","d","C","w","j","y","getReferenceEllipsoid","R","applyAll","TiltDefault","x","InteractiveController","T","normalizeCoordinate","D","decideNavigationMode","M","NavigationMode","k","O","V","constructor","view","pivot","lastPoint","tmpWorldUp","tmpViewDir","tmpRotCurPoint","tmpTransf","tmpAxis","tmpPivotPoint","pivotPos","constraintOptions","selection","interactionType","interactionFactor","interactionStartCamera","interactionDirection","tiltMode","intersectionHelper","sceneIntersectionHelper","initialize","rotScale","begin","active","startCamera","eye","intersectRayFreePointFallback","ray","center","constrainPivotPoint","camera","position","hasZ","Math","min","abs","z","spatialReference","width","pixelRatio","height","_stage","renderView","getMinimalDepthForArea","fullWidth","fullHeight","Horizontal","update","currentCamera","applyRotation","end","finishController","renderCoordsHelper","worldUpAtPosition","PI","max","up","U","constructOnly","prototype","RotateController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/has.js\";import{acosClamped as s,clamp as o}from\"../../../../core/mathUtils.js\";import{createScreenPointArray as r}from\"../../../../core/screenUtils.js\";import{property as e}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{i as n,c as p}from\"../../../../chunks/mat4.js\";import{c as h}from\"../../../../chunks/mat4f64.js\";import{c}from\"../../../../chunks/vec2.js\";import{a as m}from\"../../../../chunks/vec2f64.js\";import{g as l,f as v,l as u,n as f,b as P,a as d,d as C,c as w,m as j}from\"../../../../chunks/vec3.js\";import{c as y}from\"../../../../chunks/vec3f64.js\";import{getReferenceEllipsoid as R}from\"../../../../geometry/projectionEllipsoid.js\";import{applyAll as g}from\"../../camera/constraintUtils.js\";import{TiltDefault as x}from\"../Constraints.js\";import{InteractiveController as T}from\"./InteractiveController.js\";import{normalizeCoordinate as D,decideNavigationMode as M,NavigationMode as k}from\"../utils/navigationUtils.js\";const O=7,V=90;let b=class extends T{constructor(t){super(t),this.view=null,this.pivot=0,this.lastPoint=m(),this.tmpWorldUp=y(),this.tmpViewDir=y(),this.tmpRotCurPoint=m(),this.tmpTransf=h(),this.tmpAxis=y(),this.tmpPivotPoint=y(),this.pivotPos=y(),this.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=0===this.pivot?3:1.5}begin(t){if(this.active){switch(this.pivot){case 1:l(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=3,this.constraintOptions.tiltMode=1,this.constraintOptions.selection=0;break;case 0:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||l(this.pivotPos,this.startCamera.center),i(\"disable-feature:context-navigation\")||this.constrainPivotPoint(t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.startCamera,D(this.startCamera,t,this.lastPoint)}}constrainPivotPoint(t){const i=this.startCamera,s=y();v(s,this.pivotPos,i.eye);let o=u(s);this.view.camera.position.hasZ&&(o=Math.min(o,O*Math.abs(this.view.camera.position.z)));const e=R(this.view.spatialReference),a=r(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),n=M(this.startCamera,a,!0,e);let p=this.view._stage.renderView.getMinimalDepthForArea(i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*V,V),h=this.view._stage.renderView.getMinimalDepthForArea(t[0],t[1],i,V);void 0===p&&void 0===h||(p=void 0===p?h:p,h=void 0===h||n===k.Horizontal?p:h,o=p>h?h:p),f(s,s),l(this.pivotPos,P(this.tmpPivotPoint,i.eye,d(this.tmpPivotPoint,s,o)))}update(t){if(this.active){switch(this.pivot){case 1:this.currentCamera.center=this.applyRotation(this.currentCamera,t,this.currentCamera.center,this.pivotPos);break;case 0:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this.applyRotation(this.currentCamera,t,this.currentCamera.eye,this.pivotPos)}g(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}applyRotation(t,i,r,e){this.view.renderCoordsHelper.worldUpAtPosition(e,this.tmpWorldUp),D(t,i,this.tmpRotCurPoint);let a=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,h=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;v(this.tmpViewDir,r,e);const m=u(this.tmpViewDir),l=s(C(this.tmpViewDir,this.tmpWorldUp)/m);if(1===this.pivot){a*=-.5;const t=.5*Math.PI-l,i=.5*Math.PI*.99;a=t-Math.max(-i,Math.min(i,t+a))}return a=o(a+l,x.min,x.max)-l,n(this.tmpTransf),w(this.tmpAxis,t.up,this.tmpViewDir),0===this.pivot&&(h=-h),p(this.tmpTransf,this.tmpTransf,h,this.tmpWorldUp),p(this.tmpTransf,this.tmpTransf,a,this.tmpAxis),j(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),t.up=j(U,t.up,this.tmpTransf),P(U,e,this.tmpViewDir),c(this.lastPoint,this.tmpRotCurPoint),U}};t([e({constructOnly:!0})],b.prototype,\"view\",void 0),t([e()],b.prototype,\"pivot\",void 0),b=t([a(\"esri.views.3d.state.controllers.RotateController\")],b);const U=y();export{b as RotateController};\n"]},"metadata":{},"sourceType":"module"}