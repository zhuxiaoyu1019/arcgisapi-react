{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { Syntax as t } from \"./syntax.js\";\n\nclass e {\n  constructor() {\n    this.attach = !1, this.comments = [], this.stack = [], this.leading = [], this.trailing = [];\n  }\n\n  insertInnerComments(e, n) {\n    if (e.type === t.BlockStatement && 0 === e.body.length) {\n      const t = [];\n\n      for (let e = this.leading.length - 1; e >= 0; --e) {\n        const s = this.leading[e];\n        n.end.offset >= s.start && (t.unshift(s.comment), this.leading.splice(e, 1), this.trailing.splice(e, 1));\n      }\n\n      t.length && (e.innerComments = t);\n    }\n  }\n\n  findTrailingComments(t) {\n    let e = [];\n\n    if (this.trailing.length > 0) {\n      for (let n = this.trailing.length - 1; n >= 0; --n) {\n        const s = this.trailing[n];\n        s.start >= t.end.offset && e.unshift(s.comment);\n      }\n\n      return this.trailing.length = 0, e;\n    }\n\n    const n = this.stack[this.stack.length - 1];\n\n    if (n && n.node.trailingComments) {\n      const s = n.node.trailingComments[0];\n      s && s.range[0] >= t.end.offset && (e = n.node.trailingComments, delete n.node.trailingComments);\n    }\n\n    return e;\n  }\n\n  findLeadingComments(t) {\n    const e = [];\n    let n;\n\n    for (; this.stack.length > 0;) {\n      const e = this.stack[this.stack.length - 1];\n      if (!(e && e.start >= t.start.offset)) break;\n      n = e.node, this.stack.pop();\n    }\n\n    if (n) {\n      for (let s = (n.leadingComments ? n.leadingComments.length : 0) - 1; s >= 0; --s) {\n        const i = n.leadingComments[s];\n        i.range[1] <= t.start.offset && (e.unshift(i), n.leadingComments.splice(s, 1));\n      }\n\n      return n.leadingComments && 0 === n.leadingComments.length && delete n.leadingComments, e;\n    }\n\n    for (let s = this.leading.length - 1; s >= 0; --s) {\n      const n = this.leading[s];\n      n.start <= t.start.offset && (e.unshift(n.comment), this.leading.splice(s, 1));\n    }\n\n    return e;\n  }\n\n  visitNode(e, n) {\n    if (e.type === t.Program && e.body.length > 0) return;\n    this.insertInnerComments(e, n);\n    const s = this.findTrailingComments(n),\n          i = this.findLeadingComments(n);\n    i.length > 0 && (e.leadingComments = i), s.length > 0 && (e.trailingComments = s), this.stack.push({\n      node: e,\n      start: n.start.offset\n    });\n  }\n\n  visitComment(t, e) {\n    const n = \"L\" === t.type[0] ? \"Line\" : \"Block\",\n          s = {\n      type: n,\n      value: t.value\n    };\n\n    if (t.range && (s.range = t.range), t.loc && (s.loc = t.loc), this.comments.push(s), this.attach) {\n      const s = {\n        comment: {\n          type: n,\n          value: t.value,\n          range: [e.start.offset, e.end.offset]\n        },\n        start: e.start.offset\n      };\n      t.loc && (s.comment.loc = t.loc), t.type = n, this.leading.push(s), this.trailing.push(s);\n    }\n  }\n\n  visit(t, e) {\n    \"LineComment\" === t.type || \"BlockComment\" === t.type ? this.visitComment(t, e) : this.attach && this.visitNode(t, e);\n  }\n\n}\n\nexport { e as CommentHandler };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/arcade/lib/comment-handler.js"],"names":["Syntax","t","e","constructor","attach","comments","stack","leading","trailing","insertInnerComments","n","type","BlockStatement","body","length","s","end","offset","start","unshift","comment","splice","innerComments","findTrailingComments","node","trailingComments","range","findLeadingComments","pop","leadingComments","i","visitNode","Program","push","visitComment","value","loc","visit","CommentHandler"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{Syntax as t}from\"./syntax.js\";class e{constructor(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}insertInnerComments(e,n){if(e.type===t.BlockStatement&&0===e.body.length){const t=[];for(let e=this.leading.length-1;e>=0;--e){const s=this.leading[e];n.end.offset>=s.start&&(t.unshift(s.comment),this.leading.splice(e,1),this.trailing.splice(e,1))}t.length&&(e.innerComments=t)}}findTrailingComments(t){let e=[];if(this.trailing.length>0){for(let n=this.trailing.length-1;n>=0;--n){const s=this.trailing[n];s.start>=t.end.offset&&e.unshift(s.comment)}return this.trailing.length=0,e}const n=this.stack[this.stack.length-1];if(n&&n.node.trailingComments){const s=n.node.trailingComments[0];s&&s.range[0]>=t.end.offset&&(e=n.node.trailingComments,delete n.node.trailingComments)}return e}findLeadingComments(t){const e=[];let n;for(;this.stack.length>0;){const e=this.stack[this.stack.length-1];if(!(e&&e.start>=t.start.offset))break;n=e.node,this.stack.pop()}if(n){for(let s=(n.leadingComments?n.leadingComments.length:0)-1;s>=0;--s){const i=n.leadingComments[s];i.range[1]<=t.start.offset&&(e.unshift(i),n.leadingComments.splice(s,1))}return n.leadingComments&&0===n.leadingComments.length&&delete n.leadingComments,e}for(let s=this.leading.length-1;s>=0;--s){const n=this.leading[s];n.start<=t.start.offset&&(e.unshift(n.comment),this.leading.splice(s,1))}return e}visitNode(e,n){if(e.type===t.Program&&e.body.length>0)return;this.insertInnerComments(e,n);const s=this.findTrailingComments(n),i=this.findLeadingComments(n);i.length>0&&(e.leadingComments=i),s.length>0&&(e.trailingComments=s),this.stack.push({node:e,start:n.start.offset})}visitComment(t,e){const n=\"L\"===t.type[0]?\"Line\":\"Block\",s={type:n,value:t.value};if(t.range&&(s.range=t.range),t.loc&&(s.loc=t.loc),this.comments.push(s),this.attach){const s={comment:{type:n,value:t.value,range:[e.start.offset,e.end.offset]},start:e.start.offset};t.loc&&(s.comment.loc=t.loc),t.type=n,this.leading.push(s),this.trailing.push(s)}}visit(t,e){\"LineComment\"===t.type||\"BlockComment\"===t.type?this.visitComment(t,e):this.attach&&this.visitNode(t,e)}}export{e as CommentHandler};\n"]},"metadata":{},"sourceType":"module"}