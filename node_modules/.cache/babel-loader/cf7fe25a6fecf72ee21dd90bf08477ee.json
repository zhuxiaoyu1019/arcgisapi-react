{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Evented.js\";\nimport { someMap as t } from \"../../../core/MapUtils.js\";\nimport { GraphicsMap as s } from \"./GraphicsMap.js\";\n\nclass i extends e {\n  constructor(e) {\n    super(), this._limit = e, this._all = new s(), this._active = new a(this), this._pending = new Map(), this._handle = this._all.on(\"change\", e => this._handleChanges(e));\n  }\n\n  destroy() {\n    this._handle.remove();\n  }\n\n  get length() {\n    return this._active.length;\n  }\n\n  toArray() {\n    return this._active.toArray();\n  }\n\n  find(e) {\n    return this._active.find(e);\n  }\n\n  forEach(e) {\n    this._active.forEach(e);\n  }\n\n  addMany(e) {\n    this._all.addMany(e);\n  }\n\n  removeManyByObjectId(e) {\n    this._all.removeManyByObjectId(e);\n  }\n\n  _handleChanges(e) {\n    let t = e.removed;\n\n    if (this._pending.size > 0) {\n      t = new Array();\n\n      for (const s of e.removed) this._pending.delete(s.objectId) || t.push(s);\n    }\n\n    let s = this._limit - this._active.length + t.length;\n    s < e.added.length && (this._active.removeMany(t), t = [], h.reset(1 - this._limit / (this._active.length + e.added.length)), this._active.forEach(e => {\n      h.sample() && (t.push(e), this._pending.set(e.objectId, e));\n    }), s = this._limit - this._active.length + t.length);\n    let i = e.added;\n\n    if (s < e.added.length) {\n      i = new Array(), h.reset(s / e.added.length);\n\n      for (const t of e.added) h.sample() ? i.push(t) : this._pending.set(t.objectId, t);\n    }\n\n    const n = s - i.length;\n    n > 0 && this._pending.size > 0 && (h.reset(n / this._pending.size), this._pending.forEach(e => {\n      h.sample() && (i.push(e), this._pending.delete(e.objectId));\n    })), this._active.addAndRemove(i, t);\n  }\n\n}\n\nclass n {\n  constructor() {\n    this.percentage = 1, this.last = -1, this.index = 0;\n  }\n\n  reset(e) {\n    this.percentage = e, this.last = -1;\n  }\n\n  sample() {\n    const e = Math.floor(this.index * this.percentage);\n    return ++this.index, e !== this.last && (this.last = e, !0);\n  }\n\n}\n\nconst h = new n();\n\nclass a {\n  constructor(e) {\n    this._parent = e, this._map = new Map();\n  }\n\n  get length() {\n    return this._map.size;\n  }\n\n  forEach(e) {\n    this._map.forEach(t => e(t));\n  }\n\n  find(e) {\n    let s;\n    return t(this._map, t => !!e(t) && (s = t, !0)), s;\n  }\n\n  toArray() {\n    return [...this._map.values()];\n  }\n\n  addAndRemove(e, t) {\n    for (const s of e) this._map.set(s.objectId, s);\n\n    for (const s of t) this._map.delete(s.objectId);\n\n    (e.length > 0 || t.length > 0) && this._parent.emit(\"change\", {\n      added: e,\n      removed: t\n    });\n  }\n\n  removeMany(e) {\n    for (const t of e) this._map.delete(t.objectId);\n\n    e.length > 0 && this._parent.emit(\"change\", {\n      added: [],\n      removed: e\n    });\n  }\n\n}\n\nexport { i as LimitGraphicsMap };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/support/LimitGraphicsMap.js"],"names":["e","someMap","t","GraphicsMap","s","i","constructor","_limit","_all","_active","a","_pending","Map","_handle","on","_handleChanges","destroy","remove","length","toArray","find","forEach","addMany","removeManyByObjectId","removed","size","Array","delete","objectId","push","added","removeMany","h","reset","sample","set","n","addAndRemove","percentage","last","index","Math","floor","_parent","_map","values","emit","LimitGraphicsMap"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Evented.js\";import{someMap as t}from\"../../../core/MapUtils.js\";import{GraphicsMap as s}from\"./GraphicsMap.js\";class i extends e{constructor(e){super(),this._limit=e,this._all=new s,this._active=new a(this),this._pending=new Map,this._handle=this._all.on(\"change\",(e=>this._handleChanges(e)))}destroy(){this._handle.remove()}get length(){return this._active.length}toArray(){return this._active.toArray()}find(e){return this._active.find(e)}forEach(e){this._active.forEach(e)}addMany(e){this._all.addMany(e)}removeManyByObjectId(e){this._all.removeManyByObjectId(e)}_handleChanges(e){let t=e.removed;if(this._pending.size>0){t=new Array;for(const s of e.removed)this._pending.delete(s.objectId)||t.push(s)}let s=this._limit-this._active.length+t.length;s<e.added.length&&(this._active.removeMany(t),t=[],h.reset(1-this._limit/(this._active.length+e.added.length)),this._active.forEach((e=>{h.sample()&&(t.push(e),this._pending.set(e.objectId,e))})),s=this._limit-this._active.length+t.length);let i=e.added;if(s<e.added.length){i=new Array,h.reset(s/e.added.length);for(const t of e.added)h.sample()?i.push(t):this._pending.set(t.objectId,t)}const n=s-i.length;n>0&&this._pending.size>0&&(h.reset(n/this._pending.size),this._pending.forEach((e=>{h.sample()&&(i.push(e),this._pending.delete(e.objectId))}))),this._active.addAndRemove(i,t)}}class n{constructor(){this.percentage=1,this.last=-1,this.index=0}reset(e){this.percentage=e,this.last=-1}sample(){const e=Math.floor(this.index*this.percentage);return++this.index,e!==this.last&&(this.last=e,!0)}}const h=new n;class a{constructor(e){this._parent=e,this._map=new Map}get length(){return this._map.size}forEach(e){this._map.forEach((t=>e(t)))}find(e){let s;return t(this._map,(t=>!!e(t)&&(s=t,!0))),s}toArray(){return[...this._map.values()]}addAndRemove(e,t){for(const s of e)this._map.set(s.objectId,s);for(const s of t)this._map.delete(s.objectId);(e.length>0||t.length>0)&&this._parent.emit(\"change\",{added:e,removed:t})}removeMany(e){for(const t of e)this._map.delete(t.objectId);e.length>0&&this._parent.emit(\"change\",{added:[],removed:e})}}export{i as LimitGraphicsMap};\n"]},"metadata":{},"sourceType":"module"}