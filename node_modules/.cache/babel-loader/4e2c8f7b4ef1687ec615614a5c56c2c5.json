{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../core/Logger.js\";\nimport { isSome as e, disposeMaybe as i } from \"../../core/maybe.js\";\nimport { ResourceType as s } from \"./enums.js\";\nimport { bindVertexBufferLayout as r, unbindVertexBufferLayout as n } from \"./Util.js\";\nconst o = t.getLogger(\"esri.views.webgl.VertexArrayObject\");\n\nclass f {\n  constructor(t, e, i, r, n = null) {\n    this._context = t, this._locations = e, this._layout = i, this._buffers = r, this._indexBuffer = n, this._glName = null, this._initialized = !1, t.instanceCounter.increment(s.VAO, this);\n  }\n\n  get glName() {\n    return this._glName;\n  }\n\n  get vertexBuffers() {\n    return this._buffers;\n  }\n\n  get indexBuffer() {\n    return this._indexBuffer;\n  }\n\n  get size() {\n    return Object.keys(this._buffers).reduce((t, e) => t + this._buffers[e].size, e(this._indexBuffer) ? this._indexBuffer.size : 0);\n  }\n\n  get layout() {\n    return this._layout;\n  }\n\n  get locations() {\n    return this._locations;\n  }\n\n  dispose(t = !0) {\n    if (!this._context) return void ((this._glName || t && Object.getOwnPropertyNames(this._buffers).length > 0) && o.warn(\"Leaked WebGL VAO\"));\n\n    if (this._glName) {\n      var e, r;\n      const t = null == (e = this._context) || null == (r = e.capabilities) ? void 0 : r.vao;\n      t ? (t.deleteVertexArray(this._glName), this._glName = null) : o.warn(\"Leaked WebGL VAO\");\n    }\n\n    if (this._context.getBoundVAO() === this && this._context.bindVAO(null), t) {\n      for (const t in this._buffers) this._buffers[t].dispose(), delete this._buffers[t];\n\n      this._indexBuffer = i(this._indexBuffer);\n    }\n\n    this._context.instanceCounter.decrement(s.VAO, this), this._context = null;\n  }\n\n  initialize() {\n    if (this._initialized) return;\n    const t = this._context.capabilities.vao;\n\n    if (t) {\n      const e = t.createVertexArray();\n      t.bindVertexArray(e), this._bindLayout(), t.bindVertexArray(null), this._glName = e;\n    }\n\n    this._initialized = !0;\n  }\n\n  bind() {\n    this.initialize();\n    const t = this._context.capabilities.vao;\n    t ? t.bindVertexArray(this.glName) : (this._context.bindVAO(null), this._bindLayout());\n  }\n\n  _bindLayout() {\n    const {\n      _buffers: t,\n      _layout: i,\n      _indexBuffer: s\n    } = this;\n    t || o.error(\"Vertex buffer dictionary is empty!\");\n    const n = this._context.gl;\n\n    for (const e in t) {\n      const s = t[e];\n      s || o.error(\"Vertex buffer is uninitialized!\");\n      const n = i[e];\n      n || o.error(\"Vertex element descriptor is empty!\"), r(this._context, this._locations, s, n);\n    }\n\n    if (e(s)) {\n      !!this._context.capabilities.vao ? n.bindBuffer(n.ELEMENT_ARRAY_BUFFER, s.glName) : this._context.bindBuffer(s);\n    }\n  }\n\n  unbind() {\n    this.initialize();\n    const t = this._context.capabilities.vao;\n    t ? t.bindVertexArray(null) : this._unbindLayout();\n  }\n\n  _unbindLayout() {\n    const {\n      _buffers: t,\n      _layout: i\n    } = this;\n    t || o.error(\"Vertex buffer dictionary is empty!\");\n\n    for (const e in t) {\n      const s = t[e];\n      s || o.error(\"Vertex buffer is uninitialized!\");\n      const r = i[e];\n      n(this._context, this._locations, s, r);\n    }\n\n    e(this._indexBuffer) && this._context.unbindBuffer(this._indexBuffer.bufferType);\n  }\n\n}\n\nexport default f;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"],"names":["t","isSome","e","disposeMaybe","i","ResourceType","s","bindVertexBufferLayout","r","unbindVertexBufferLayout","n","o","getLogger","f","constructor","_context","_locations","_layout","_buffers","_indexBuffer","_glName","_initialized","instanceCounter","increment","VAO","glName","vertexBuffers","indexBuffer","size","Object","keys","reduce","layout","locations","dispose","getOwnPropertyNames","length","warn","capabilities","vao","deleteVertexArray","getBoundVAO","bindVAO","decrement","initialize","createVertexArray","bindVertexArray","_bindLayout","bind","error","gl","bindBuffer","ELEMENT_ARRAY_BUFFER","unbind","_unbindLayout","unbindBuffer","bufferType"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../core/Logger.js\";import{isSome as e,disposeMaybe as i}from\"../../core/maybe.js\";import{ResourceType as s}from\"./enums.js\";import{bindVertexBufferLayout as r,unbindVertexBufferLayout as n}from\"./Util.js\";const o=t.getLogger(\"esri.views.webgl.VertexArrayObject\");class f{constructor(t,e,i,r,n=null){this._context=t,this._locations=e,this._layout=i,this._buffers=r,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(s.VAO,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce(((t,e)=>t+this._buffers[e].size),e(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&o.warn(\"Leaked WebGL VAO\"));if(this._glName){var e,r;const t=null==(e=this._context)||null==(r=e.capabilities)?void 0:r.vao;t?(t.deleteVertexArray(this._glName),this._glName=null):o.warn(\"Leaked WebGL VAO\")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const t in this._buffers)this._buffers[t].dispose(),delete this._buffers[t];this._indexBuffer=i(this._indexBuffer)}this._context.instanceCounter.decrement(s.VAO,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:s}=this;t||o.error(\"Vertex buffer dictionary is empty!\");const n=this._context.gl;for(const e in t){const s=t[e];s||o.error(\"Vertex buffer is uninitialized!\");const n=i[e];n||o.error(\"Vertex element descriptor is empty!\"),r(this._context,this._locations,s,n)}if(e(s)){!!this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.glName):this._context.bindBuffer(s)}}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||o.error(\"Vertex buffer dictionary is empty!\");for(const e in t){const s=t[e];s||o.error(\"Vertex buffer is uninitialized!\");const r=i[e];n(this._context,this._locations,s,r)}e(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}export default f;\n"]},"metadata":{},"sourceType":"module"}