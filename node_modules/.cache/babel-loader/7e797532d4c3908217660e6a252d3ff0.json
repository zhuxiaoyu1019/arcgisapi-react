{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/RandomLCG.js\";\nimport { b as o, n as e } from \"../../../../../chunks/vec3.js\";\nimport { c as n } from \"../../../../../chunks/vec3f64.js\";\nimport { glLayout as i } from \"../../../support/buffer/glUtil.js\";\nimport { RegularEdgeInstancesLayout as r, SilhouetteEdgeInstancesLayout as s } from \"./bufferLayouts.js\";\n\nclass a {\n  updateSettings(t) {\n    this.settings = t, this.edgeHashFunction = t.reducedPrecision ? f : p;\n  }\n\n  write(t, o, e) {\n    const n = this.edgeHashFunction(e);\n    W.seed = n;\n    const i = W.getIntRange(0, 255),\n          r = W.getIntRange(0, this.settings.variants - 1),\n          s = .7,\n          a = W.getFloat(),\n          c = 255 * (.5 * g(-(1 - Math.min(a / s, 1)) + Math.max(0, a - s) / (1 - s), 1.2) + .5);\n    t.position0.setVec(o, e.position0), t.position1.setVec(o, e.position1), t.componentIndex.set(o, e.componentIndex), t.variantOffset.set(o, i), t.variantStroke.set(o, r), t.variantExtension.set(o, c);\n  }\n\n  trim(t, o) {\n    return t.slice(0, o);\n  }\n\n}\n\nconst c = new Float32Array(6),\n      m = new Uint32Array(c.buffer),\n      u = new Uint32Array(1);\n\nfunction p(t) {\n  const o = c;\n  o[0] = t.position0[0], o[1] = t.position0[1], o[2] = t.position0[2], o[3] = t.position1[0], o[4] = t.position1[1], o[5] = t.position1[2], u[0] = 5381;\n\n  for (let e = 0; e < m.length; e++) u[0] = 31 * u[0] + m[e];\n\n  return u[0];\n}\n\nfunction f(t) {\n  const o = c;\n  o[0] = h(t.position0[0]), o[1] = h(t.position0[1]), o[2] = h(t.position0[2]), o[3] = h(t.position1[0]), o[4] = h(t.position1[1]), o[5] = h(t.position1[2]), u[0] = 5381;\n\n  for (let e = 0; e < m.length; e++) u[0] = 31 * u[0] + m[e];\n\n  return u[0];\n}\n\nconst l = 1e4;\n\nfunction h(t) {\n  return Math.round(t * l) / l;\n}\n\nfunction g(t, o) {\n  const e = t < 0 ? -1 : 1;\n  return Math.abs(t) ** o * e;\n}\n\nclass d {\n  constructor() {\n    this.commonWriter = new a();\n  }\n\n  updateSettings(t) {\n    this.commonWriter.updateSettings(t);\n  }\n\n  allocate(t) {\n    return r.createBuffer(t);\n  }\n\n  write(t, n, i) {\n    this.commonWriter.write(t, n, i), o(y, i.faceNormal0, i.faceNormal1), e(y, y), t.normal.setVec(n, y);\n  }\n\n  trim(t, o) {\n    return this.commonWriter.trim(t, o);\n  }\n\n}\n\nd.Layout = r, d.glLayout = i(r, 1);\n\nclass w {\n  constructor() {\n    this.commonWriter = new a();\n  }\n\n  updateSettings(t) {\n    this.commonWriter.updateSettings(t);\n  }\n\n  allocate(t) {\n    return s.createBuffer(t);\n  }\n\n  write(t, o, e) {\n    this.commonWriter.write(t, o, e), t.normalA.setVec(o, e.faceNormal0), t.normalB.setVec(o, e.faceNormal1);\n  }\n\n  trim(t, o) {\n    return this.commonWriter.trim(t, o);\n  }\n\n}\n\nw.Layout = s, w.glLayout = i(s, 1);\nconst y = n(),\n      W = new t();\nexport { a as CommonBufferWriter, d as RegularEdgeBufferWriter, w as SilhouetteEdgeBufferWriter };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters.js"],"names":["t","b","o","n","e","c","glLayout","i","RegularEdgeInstancesLayout","r","SilhouetteEdgeInstancesLayout","s","a","updateSettings","settings","edgeHashFunction","reducedPrecision","f","p","write","W","seed","getIntRange","variants","getFloat","g","Math","min","max","position0","setVec","position1","componentIndex","set","variantOffset","variantStroke","variantExtension","trim","slice","Float32Array","m","Uint32Array","buffer","u","length","h","l","round","abs","d","constructor","commonWriter","allocate","createBuffer","y","faceNormal0","faceNormal1","normal","Layout","w","normalA","normalB","CommonBufferWriter","RegularEdgeBufferWriter","SilhouetteEdgeBufferWriter"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,kCAAb;AAAgD,SAAOC,CAAC,IAAIC,CAAZ,EAAcC,CAAC,IAAIC,CAAnB,QAAyB,+BAAzB;AAAyD,SAAOC,CAAC,IAAIF,CAAZ,QAAkB,kCAAlB;AAAqD,SAAOG,QAAQ,IAAIC,CAAnB,QAAyB,mCAAzB;AAA6D,SAAOC,0BAA0B,IAAIC,CAArC,EAAuCC,6BAA6B,IAAIC,CAAxE,QAA8E,oBAA9E;;AAAmG,MAAMC,CAAN,CAAO;AAACC,EAAAA,cAAc,CAACb,CAAD,EAAG;AAAC,SAAKc,QAAL,GAAcd,CAAd,EAAgB,KAAKe,gBAAL,GAAsBf,CAAC,CAACgB,gBAAF,GAAmBC,CAAnB,GAAqBC,CAA3D;AAA6D;;AAAAC,EAAAA,KAAK,CAACnB,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;AAAC,UAAMD,CAAC,GAAC,KAAKY,gBAAL,CAAsBX,CAAtB,CAAR;AAAiCgB,IAAAA,CAAC,CAACC,IAAF,GAAOlB,CAAP;AAAS,UAAMI,CAAC,GAACa,CAAC,CAACE,WAAF,CAAc,CAAd,EAAgB,GAAhB,CAAR;AAAA,UAA6Bb,CAAC,GAACW,CAAC,CAACE,WAAF,CAAc,CAAd,EAAgB,KAAKR,QAAL,CAAcS,QAAd,GAAuB,CAAvC,CAA/B;AAAA,UAAyEZ,CAAC,GAAC,EAA3E;AAAA,UAA8EC,CAAC,GAACQ,CAAC,CAACI,QAAF,EAAhF;AAAA,UAA6FnB,CAAC,GAAC,OAAK,KAAGoB,CAAC,CAAC,EAAE,IAAEC,IAAI,CAACC,GAAL,CAASf,CAAC,GAACD,CAAX,EAAa,CAAb,CAAJ,IAAqBe,IAAI,CAACE,GAAL,CAAS,CAAT,EAAWhB,CAAC,GAACD,CAAb,KAAiB,IAAEA,CAAnB,CAAtB,EAA4C,GAA5C,CAAJ,GAAqD,EAA1D,CAA/F;AAA6JX,IAAAA,CAAC,CAAC6B,SAAF,CAAYC,MAAZ,CAAmB5B,CAAnB,EAAqBE,CAAC,CAACyB,SAAvB,GAAkC7B,CAAC,CAAC+B,SAAF,CAAYD,MAAZ,CAAmB5B,CAAnB,EAAqBE,CAAC,CAAC2B,SAAvB,CAAlC,EAAoE/B,CAAC,CAACgC,cAAF,CAAiBC,GAAjB,CAAqB/B,CAArB,EAAuBE,CAAC,CAAC4B,cAAzB,CAApE,EAA6GhC,CAAC,CAACkC,aAAF,CAAgBD,GAAhB,CAAoB/B,CAApB,EAAsBK,CAAtB,CAA7G,EAAsIP,CAAC,CAACmC,aAAF,CAAgBF,GAAhB,CAAoB/B,CAApB,EAAsBO,CAAtB,CAAtI,EAA+JT,CAAC,CAACoC,gBAAF,CAAmBH,GAAnB,CAAuB/B,CAAvB,EAAyBG,CAAzB,CAA/J;AAA2L;;AAAAgC,EAAAA,IAAI,CAACrC,CAAD,EAAGE,CAAH,EAAK;AAAC,WAAOF,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAUpC,CAAV,CAAP;AAAoB;;AAA7f;;AAA8f,MAAMG,CAAC,GAAC,IAAIkC,YAAJ,CAAiB,CAAjB,CAAR;AAAA,MAA4BC,CAAC,GAAC,IAAIC,WAAJ,CAAgBpC,CAAC,CAACqC,MAAlB,CAA9B;AAAA,MAAwDC,CAAC,GAAC,IAAIF,WAAJ,CAAgB,CAAhB,CAA1D;;AAA6E,SAASvB,CAAT,CAAWlB,CAAX,EAAa;AAAC,QAAME,CAAC,GAACG,CAAR;AAAUH,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC6B,SAAF,CAAY,CAAZ,CAAL,EAAoB3B,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC6B,SAAF,CAAY,CAAZ,CAAzB,EAAwC3B,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC6B,SAAF,CAAY,CAAZ,CAA7C,EAA4D3B,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC+B,SAAF,CAAY,CAAZ,CAAjE,EAAgF7B,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC+B,SAAF,CAAY,CAAZ,CAArF,EAAoG7B,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAC,CAAC+B,SAAF,CAAY,CAAZ,CAAzG,EAAwHY,CAAC,CAAC,CAAD,CAAD,GAAK,IAA7H;;AAAkI,OAAI,IAAIvC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACoC,CAAC,CAACI,MAAhB,EAAuBxC,CAAC,EAAxB,EAA2BuC,CAAC,CAAC,CAAD,CAAD,GAAK,KAAGA,CAAC,CAAC,CAAD,CAAJ,GAAQH,CAAC,CAACpC,CAAD,CAAd;;AAAkB,SAAOuC,CAAC,CAAC,CAAD,CAAR;AAAY;;AAAA,SAAS1B,CAAT,CAAWjB,CAAX,EAAa;AAAC,QAAME,CAAC,GAACG,CAAR;AAAUH,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAK2C,CAAC,CAAC7C,CAAC,CAAC6B,SAAF,CAAY,CAAZ,CAAD,CAAN,EAAuB3B,CAAC,CAAC,CAAD,CAAD,GAAK2C,CAAC,CAAC7C,CAAC,CAAC6B,SAAF,CAAY,CAAZ,CAAD,CAA7B,EAA8C3B,CAAC,CAAC,CAAD,CAAD,GAAK2C,CAAC,CAAC7C,CAAC,CAAC6B,SAAF,CAAY,CAAZ,CAAD,CAApD,EAAqE3B,CAAC,CAAC,CAAD,CAAD,GAAK2C,CAAC,CAAC7C,CAAC,CAAC+B,SAAF,CAAY,CAAZ,CAAD,CAA3E,EAA4F7B,CAAC,CAAC,CAAD,CAAD,GAAK2C,CAAC,CAAC7C,CAAC,CAAC+B,SAAF,CAAY,CAAZ,CAAD,CAAlG,EAAmH7B,CAAC,CAAC,CAAD,CAAD,GAAK2C,CAAC,CAAC7C,CAAC,CAAC+B,SAAF,CAAY,CAAZ,CAAD,CAAzH,EAA0IY,CAAC,CAAC,CAAD,CAAD,GAAK,IAA/I;;AAAoJ,OAAI,IAAIvC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACoC,CAAC,CAACI,MAAhB,EAAuBxC,CAAC,EAAxB,EAA2BuC,CAAC,CAAC,CAAD,CAAD,GAAK,KAAGA,CAAC,CAAC,CAAD,CAAJ,GAAQH,CAAC,CAACpC,CAAD,CAAd;;AAAkB,SAAOuC,CAAC,CAAC,CAAD,CAAR;AAAY;;AAAA,MAAMG,CAAC,GAAC,GAAR;;AAAY,SAASD,CAAT,CAAW7C,CAAX,EAAa;AAAC,SAAO0B,IAAI,CAACqB,KAAL,CAAW/C,CAAC,GAAC8C,CAAb,IAAgBA,CAAvB;AAAyB;;AAAA,SAASrB,CAAT,CAAWzB,CAAX,EAAaE,CAAb,EAAe;AAAC,QAAME,CAAC,GAACJ,CAAC,GAAC,CAAF,GAAI,CAAC,CAAL,GAAO,CAAf;AAAiB,SAAO0B,IAAI,CAACsB,GAAL,CAAShD,CAAT,KAAaE,CAAb,GAAeE,CAAtB;AAAwB;;AAAA,MAAM6C,CAAN,CAAO;AAACC,EAAAA,WAAW,GAAE;AAAC,SAAKC,YAAL,GAAkB,IAAIvC,CAAJ,EAAlB;AAAwB;;AAAAC,EAAAA,cAAc,CAACb,CAAD,EAAG;AAAC,SAAKmD,YAAL,CAAkBtC,cAAlB,CAAiCb,CAAjC;AAAoC;;AAAAoD,EAAAA,QAAQ,CAACpD,CAAD,EAAG;AAAC,WAAOS,CAAC,CAAC4C,YAAF,CAAerD,CAAf,CAAP;AAAyB;;AAAAmB,EAAAA,KAAK,CAACnB,CAAD,EAAGG,CAAH,EAAKI,CAAL,EAAO;AAAC,SAAK4C,YAAL,CAAkBhC,KAAlB,CAAwBnB,CAAxB,EAA0BG,CAA1B,EAA4BI,CAA5B,GAA+BL,CAAC,CAACoD,CAAD,EAAG/C,CAAC,CAACgD,WAAL,EAAiBhD,CAAC,CAACiD,WAAnB,CAAhC,EAAgEpD,CAAC,CAACkD,CAAD,EAAGA,CAAH,CAAjE,EAAuEtD,CAAC,CAACyD,MAAF,CAAS3B,MAAT,CAAgB3B,CAAhB,EAAkBmD,CAAlB,CAAvE;AAA4F;;AAAAjB,EAAAA,IAAI,CAACrC,CAAD,EAAGE,CAAH,EAAK;AAAC,WAAO,KAAKiD,YAAL,CAAkBd,IAAlB,CAAuBrC,CAAvB,EAAyBE,CAAzB,CAAP;AAAmC;;AAAxR;;AAAyR+C,CAAC,CAACS,MAAF,GAASjD,CAAT,EAAWwC,CAAC,CAAC3C,QAAF,GAAWC,CAAC,CAACE,CAAD,EAAG,CAAH,CAAvB;;AAA6B,MAAMkD,CAAN,CAAO;AAACT,EAAAA,WAAW,GAAE;AAAC,SAAKC,YAAL,GAAkB,IAAIvC,CAAJ,EAAlB;AAAwB;;AAAAC,EAAAA,cAAc,CAACb,CAAD,EAAG;AAAC,SAAKmD,YAAL,CAAkBtC,cAAlB,CAAiCb,CAAjC;AAAoC;;AAAAoD,EAAAA,QAAQ,CAACpD,CAAD,EAAG;AAAC,WAAOW,CAAC,CAAC0C,YAAF,CAAerD,CAAf,CAAP;AAAyB;;AAAAmB,EAAAA,KAAK,CAACnB,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;AAAC,SAAK+C,YAAL,CAAkBhC,KAAlB,CAAwBnB,CAAxB,EAA0BE,CAA1B,EAA4BE,CAA5B,GAA+BJ,CAAC,CAAC4D,OAAF,CAAU9B,MAAV,CAAiB5B,CAAjB,EAAmBE,CAAC,CAACmD,WAArB,CAA/B,EAAiEvD,CAAC,CAAC6D,OAAF,CAAU/B,MAAV,CAAiB5B,CAAjB,EAAmBE,CAAC,CAACoD,WAArB,CAAjE;AAAmG;;AAAAnB,EAAAA,IAAI,CAACrC,CAAD,EAAGE,CAAH,EAAK;AAAC,WAAO,KAAKiD,YAAL,CAAkBd,IAAlB,CAAuBrC,CAAvB,EAAyBE,CAAzB,CAAP;AAAmC;;AAA/R;;AAAgSyD,CAAC,CAACD,MAAF,GAAS/C,CAAT,EAAWgD,CAAC,CAACrD,QAAF,GAAWC,CAAC,CAACI,CAAD,EAAG,CAAH,CAAvB;AAA6B,MAAM2C,CAAC,GAACnD,CAAC,EAAT;AAAA,MAAYiB,CAAC,GAAC,IAAIpB,CAAJ,EAAd;AAAoB,SAAOY,CAAC,IAAIkD,kBAAZ,EAA+Bb,CAAC,IAAIc,uBAApC,EAA4DJ,CAAC,IAAIK,0BAAjE","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/RandomLCG.js\";import{b as o,n as e}from\"../../../../../chunks/vec3.js\";import{c as n}from\"../../../../../chunks/vec3f64.js\";import{glLayout as i}from\"../../../support/buffer/glUtil.js\";import{RegularEdgeInstancesLayout as r,SilhouetteEdgeInstancesLayout as s}from\"./bufferLayouts.js\";class a{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?f:p}write(t,o,e){const n=this.edgeHashFunction(e);W.seed=n;const i=W.getIntRange(0,255),r=W.getIntRange(0,this.settings.variants-1),s=.7,a=W.getFloat(),c=255*(.5*g(-(1-Math.min(a/s,1))+Math.max(0,a-s)/(1-s),1.2)+.5);t.position0.setVec(o,e.position0),t.position1.setVec(o,e.position1),t.componentIndex.set(o,e.componentIndex),t.variantOffset.set(o,i),t.variantStroke.set(o,r),t.variantExtension.set(o,c)}trim(t,o){return t.slice(0,o)}}const c=new Float32Array(6),m=new Uint32Array(c.buffer),u=new Uint32Array(1);function p(t){const o=c;o[0]=t.position0[0],o[1]=t.position0[1],o[2]=t.position0[2],o[3]=t.position1[0],o[4]=t.position1[1],o[5]=t.position1[2],u[0]=5381;for(let e=0;e<m.length;e++)u[0]=31*u[0]+m[e];return u[0]}function f(t){const o=c;o[0]=h(t.position0[0]),o[1]=h(t.position0[1]),o[2]=h(t.position0[2]),o[3]=h(t.position1[0]),o[4]=h(t.position1[1]),o[5]=h(t.position1[2]),u[0]=5381;for(let e=0;e<m.length;e++)u[0]=31*u[0]+m[e];return u[0]}const l=1e4;function h(t){return Math.round(t*l)/l}function g(t,o){const e=t<0?-1:1;return Math.abs(t)**o*e}class d{constructor(){this.commonWriter=new a}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return r.createBuffer(t)}write(t,n,i){this.commonWriter.write(t,n,i),o(y,i.faceNormal0,i.faceNormal1),e(y,y),t.normal.setVec(n,y)}trim(t,o){return this.commonWriter.trim(t,o)}}d.Layout=r,d.glLayout=i(r,1);class w{constructor(){this.commonWriter=new a}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return s.createBuffer(t)}write(t,o,e){this.commonWriter.write(t,o,e),t.normalA.setVec(o,e.faceNormal0),t.normalB.setVec(o,e.faceNormal1)}trim(t,o){return this.commonWriter.trim(t,o)}}w.Layout=s,w.glLayout=i(s,1);const y=n(),W=new t;export{a as CommonBufferWriter,d as RegularEdgeBufferWriter,w as SilhouetteEdgeBufferWriter};\n"]},"metadata":{},"sourceType":"module"}