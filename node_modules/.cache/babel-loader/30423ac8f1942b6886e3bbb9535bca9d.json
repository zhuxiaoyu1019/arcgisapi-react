{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as t, isNone as e } from \"../../../../../core/maybe.js\";\nimport { convertFromFeatures as r, convertFromFeatureSet as s, convertToFeature as i, convertToGeometry as n, getQuantizedArea as o, unquantizeOptimizedGeometry as a } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { FeatureSetReader as u } from \"./FeatureSetReader.js\";\n\nfunction h({\n  coords: t,\n  lengths: e\n}) {\n  let r = 0;\n\n  for (const s of e) {\n    for (let e = 1; e < s; e++) t[2 * (r + e)] += t[2 * (r + e) - 2], t[2 * (r + e) + 1] += t[2 * (r + e) - 1];\n\n    r += s;\n  }\n}\n\nclass c extends u {\n  constructor(t, e, r) {\n    super(t), this._featureIndex = -1, this._dateFields = new Set(), this._geometryType = r, this._features = e;\n  }\n\n  static fromFeatures(t, e, s) {\n    const i = r([], t, e, !1, !1, s);\n\n    for (let r = 0; r < i.length; r++) i[r].displayId = t[r].displayId;\n\n    return c.fromOptimizedFeatures(i, e);\n  }\n\n  static fromFeatureSet(t, e) {\n    const r = s(t, e);\n    return c.fromOptimizedFeatureSet(r);\n  }\n\n  static fromOptimizedFeatureSet(t) {\n    const {\n      features: e,\n      geometryType: r\n    } = t,\n          s = c.fromOptimizedFeatures(e, r);\n    s._exceededTransferLimit = t.exceededTransferLimit, s._transform = t.transform;\n\n    for (const i of t.fields) \"esriFieldTypeDate\" === i.type && s._dateFields.add(i.name);\n\n    return s;\n  }\n\n  static fromOptimizedFeatures(t, e, r) {\n    const s = u.createInstance(),\n          i = new c(s, t, e);\n    return i._transform = r, i;\n  }\n\n  get _current() {\n    return this._features[this._featureIndex];\n  }\n\n  get geometryType() {\n    return this._geometryType;\n  }\n\n  get hasFeatures() {\n    return !!this._features.length;\n  }\n\n  get hasNext() {\n    return this._featureIndex + 1 < this._features.length;\n  }\n\n  get exceededTransferLimit() {\n    return this._exceededTransferLimit;\n  }\n\n  get hasZ() {\n    return !1;\n  }\n\n  get hasM() {\n    return !1;\n  }\n\n  removeIds(t) {\n    const e = new Set(t);\n    this._features = this._features.filter(t => !e.has(t.objectId));\n  }\n\n  append(t) {\n    for (const e of t) this._features.push(e);\n  }\n\n  getSize() {\n    return this._features.length;\n  }\n\n  getCursor() {\n    return this.copy();\n  }\n\n  getQuantizationTransform() {\n    return this._transform;\n  }\n\n  getAttributeHash() {\n    let t = \"\";\n\n    for (const e in this._current.attributes) t += this._current.attributes[e];\n\n    return t;\n  }\n\n  getIndex() {\n    return this._featureIndex;\n  }\n\n  setIndex(t) {\n    this._featureIndex = t;\n  }\n\n  getObjectId() {\n    return this._current.objectId;\n  }\n\n  getDisplayId() {\n    return this._current.displayId;\n  }\n\n  setDisplayId(t) {\n    this._current.displayId = t;\n  }\n\n  getGroupId() {\n    return this._current.groupId;\n  }\n\n  setGroupId(t) {\n    this._current.groupId = t;\n  }\n\n  copy() {\n    const t = new c(this.instance, this._features, this.geometryType);\n    return this.copyInto(t), t;\n  }\n\n  next() {\n    for (; ++this._featureIndex < this._features.length && !this._getExists(););\n\n    return this._featureIndex < this._features.length;\n  }\n\n  readLegacyFeature() {\n    return i(this._current, this.geometryType, this.hasZ, this.hasM);\n  }\n\n  readOptimizedFeature() {\n    return this._current;\n  }\n\n  readLegacyPointGeometry() {\n    return this.readGeometry() ? {\n      x: this.getX(),\n      y: this.getY()\n    } : null;\n  }\n\n  readLegacyGeometry() {\n    const t = this.readGeometry();\n    return n(t, this.geometryType, this.hasZ, this.hasM);\n  }\n\n  readLegacyCentroid() {\n    const t = this.readCentroid();\n    return t ? {\n      x: t.coords[0] * this._sx + this._tx,\n      y: t.coords[1] * this._sy + this._ty\n    } : null;\n  }\n\n  readGeometryArea() {\n    return o(this._current.geometry, 2);\n  }\n\n  readUnquantizedGeometry() {\n    const t = this.readGeometry();\n    if (\"esriGeometryPoint\" === this.geometryType || !t) return t;\n    const e = t.clone();\n    return h(e), e;\n  }\n\n  readHydratedGeometry() {\n    const e = this._current.geometry;\n    if (!e) return null;\n    const r = e.clone();\n    return t(this._transform) && a(r, r, this.hasZ, this.hasM, this._transform), r;\n  }\n\n  getXHydrate() {\n    const t = this._current.geometry.coords[0],\n          r = this.getQuantizationTransform();\n    return e(r) ? t : t * r.scale[0] + r.translate[0];\n  }\n\n  getYHydrate() {\n    const t = this._current.geometry.coords[1],\n          r = this.getQuantizationTransform();\n    return e(r) ? t : r.translate[1] - t * r.scale[1];\n  }\n\n  getX() {\n    return this._current.geometry.coords[0] * this._sx + this._tx;\n  }\n\n  getY() {\n    return this._current.geometry.coords[1] * this._sy + this._ty;\n  }\n\n  readGeometry() {\n    if (!this._current.hasGeometry) return null;\n\n    const t = this._current.geometry.clone();\n\n    if (t.isPoint) return t.coords[0] = t.coords[0] * this._sx + this._tx, t.coords[1] = t.coords[1] * this._sy + this._ty, t;\n    let e = 0;\n\n    for (const r of t.lengths) t.coords[2 * e] = t.coords[2 * e] * this._sx + this._tx, t.coords[2 * e + 1] = t.coords[2 * e + 1] * this._sy + this._ty, e += r;\n\n    return t;\n  }\n\n  readCentroid() {\n    if (!this._current.hasGeometry) return null;\n\n    if (!this._current.centroid) {\n      const t = this._computeCentroid();\n\n      if (!t) return null;\n      t.coords[0] = (t.coords[0] - this._tx) / this._sx, t.coords[1] = (t.coords[1] - this._ty) / this._sy, this._current.centroid = t;\n    }\n\n    const t = this._current.centroid.clone();\n\n    return t.coords[0] = t.coords[0] * this._sx + this._tx, t.coords[1] = t.coords[1] * this._sx + this._ty, t;\n  }\n\n  _readAttribute(t, e) {\n    const r = this._current.attributes[t];\n    if (void 0 !== r) return null != r && e && this._dateFields.has(t) ? new Date(r) : r;\n    const s = this.readAttributes(),\n          i = t.toLocaleLowerCase().trim();\n\n    for (const n in s) if (n.toLocaleLowerCase().trim() === i) {\n      const t = this._current.attributes[n];\n      return null != t && e && this._dateFields.has(n) ? new Date(t) : t;\n    }\n  }\n\n  copyInto(t) {\n    super.copyInto(t), t._featureIndex = this._featureIndex, t._transform = this._transform, t._dateFields = this._dateFields;\n  }\n\n  _readAttributes() {\n    return this._current.attributes;\n  }\n\n}\n\nexport { c as FeatureSetReaderJSON };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReaderJSON.js"],"names":["isSome","t","isNone","e","convertFromFeatures","r","convertFromFeatureSet","s","convertToFeature","i","convertToGeometry","n","getQuantizedArea","o","unquantizeOptimizedGeometry","a","FeatureSetReader","u","h","coords","lengths","c","constructor","_featureIndex","_dateFields","Set","_geometryType","_features","fromFeatures","length","displayId","fromOptimizedFeatures","fromFeatureSet","fromOptimizedFeatureSet","features","geometryType","_exceededTransferLimit","exceededTransferLimit","_transform","transform","fields","type","add","name","createInstance","_current","hasFeatures","hasNext","hasZ","hasM","removeIds","filter","has","objectId","append","push","getSize","getCursor","copy","getQuantizationTransform","getAttributeHash","attributes","getIndex","setIndex","getObjectId","getDisplayId","setDisplayId","getGroupId","groupId","setGroupId","instance","copyInto","next","_getExists","readLegacyFeature","readOptimizedFeature","readLegacyPointGeometry","readGeometry","x","getX","y","getY","readLegacyGeometry","readLegacyCentroid","readCentroid","_sx","_tx","_sy","_ty","readGeometryArea","geometry","readUnquantizedGeometry","clone","readHydratedGeometry","getXHydrate","scale","translate","getYHydrate","hasGeometry","isPoint","centroid","_computeCentroid","_readAttribute","Date","readAttributes","toLocaleLowerCase","trim","_readAttributes","FeatureSetReaderJSON"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t,isNone as e}from\"../../../../../core/maybe.js\";import{convertFromFeatures as r,convertFromFeatureSet as s,convertToFeature as i,convertToGeometry as n,getQuantizedArea as o,unquantizeOptimizedGeometry as a}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{FeatureSetReader as u}from\"./FeatureSetReader.js\";function h({coords:t,lengths:e}){let r=0;for(const s of e){for(let e=1;e<s;e++)t[2*(r+e)]+=t[2*(r+e)-2],t[2*(r+e)+1]+=t[2*(r+e)-1];r+=s}}class c extends u{constructor(t,e,r){super(t),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=e}static fromFeatures(t,e,s){const i=r([],t,e,!1,!1,s);for(let r=0;r<i.length;r++)i[r].displayId=t[r].displayId;return c.fromOptimizedFeatures(i,e)}static fromFeatureSet(t,e){const r=s(t,e);return c.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(t){const{features:e,geometryType:r}=t,s=c.fromOptimizedFeatures(e,r);s._exceededTransferLimit=t.exceededTransferLimit,s._transform=t.transform;for(const i of t.fields)\"esriFieldTypeDate\"===i.type&&s._dateFields.add(i.name);return s}static fromOptimizedFeatures(t,e,r){const s=u.createInstance(),i=new c(s,t,e);return i._transform=r,i}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(t){const e=new Set(t);this._features=this._features.filter((t=>!e.has(t.objectId)))}append(t){for(const e of t)this._features.push(e)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let t=\"\";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getIndex(){return this._featureIndex}setIndex(t){this._featureIndex=t}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){this._current.displayId=t}getGroupId(){return this._current.groupId}setGroupId(t){this._current.groupId=t}copy(){const t=new c(this.instance,this._features,this.geometryType);return this.copyInto(t),t}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return i(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const t=this.readGeometry();return n(t,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const t=this.readCentroid();return t?{x:t.coords[0]*this._sx+this._tx,y:t.coords[1]*this._sy+this._ty}:null}readGeometryArea(){return o(this._current.geometry,2)}readUnquantizedGeometry(){const t=this.readGeometry();if(\"esriGeometryPoint\"===this.geometryType||!t)return t;const e=t.clone();return h(e),e}readHydratedGeometry(){const e=this._current.geometry;if(!e)return null;const r=e.clone();return t(this._transform)&&a(r,r,this.hasZ,this.hasM,this._transform),r}getXHydrate(){const t=this._current.geometry.coords[0],r=this.getQuantizationTransform();return e(r)?t:t*r.scale[0]+r.translate[0]}getYHydrate(){const t=this._current.geometry.coords[1],r=this.getQuantizationTransform();return e(r)?t:r.translate[1]-t*r.scale[1]}getX(){return this._current.geometry.coords[0]*this._sx+this._tx}getY(){return this._current.geometry.coords[1]*this._sy+this._ty}readGeometry(){if(!this._current.hasGeometry)return null;const t=this._current.geometry.clone();if(t.isPoint)return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sy+this._ty,t;let e=0;for(const r of t.lengths)t.coords[2*e]=t.coords[2*e]*this._sx+this._tx,t.coords[2*e+1]=t.coords[2*e+1]*this._sy+this._ty,e+=r;return t}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const t=this._computeCentroid();if(!t)return null;t.coords[0]=(t.coords[0]-this._tx)/this._sx,t.coords[1]=(t.coords[1]-this._ty)/this._sy,this._current.centroid=t}const t=this._current.centroid.clone();return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sx+this._ty,t}_readAttribute(t,e){const r=this._current.attributes[t];if(void 0!==r)return null!=r&&e&&this._dateFields.has(t)?new Date(r):r;const s=this.readAttributes(),i=t.toLocaleLowerCase().trim();for(const n in s)if(n.toLocaleLowerCase().trim()===i){const t=this._current.attributes[n];return null!=t&&e&&this._dateFields.has(n)?new Date(t):t}}copyInto(t){super.copyInto(t),t._featureIndex=this._featureIndex,t._transform=this._transform,t._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}}export{c as FeatureSetReaderJSON};\n"]},"metadata":{},"sourceType":"module"}