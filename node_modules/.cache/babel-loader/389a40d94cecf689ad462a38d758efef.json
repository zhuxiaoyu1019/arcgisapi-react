{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { someMap as t } from \"../../core/MapUtils.js\";\nimport { clamp as e } from \"../../core/mathUtils.js\";\nimport { isNone as i, isSome as o, applySome as r, unwrap as n } from \"../../core/maybe.js\";\nimport { createScreenPoint as a } from \"../../core/screenUtils.js\";\nimport { areToolManipulatorsEditable as s } from \"./interactiveToolUtils.js\";\nimport { createScreenPointFromEvent as l } from \"../support/screenUtils.js\";\n\nclass p {\n  constructor() {\n    this._pointerLocations = new Map(), this._hoveredManipulators = new Map(), this._grabbedManipulators = new Map(), this._draggedManipulators = new Map(), this._stopDrag = !1, this._revertToActiveTool = null, this._cursor = null;\n  }\n\n  get cursor() {\n    return this._cursor;\n  }\n\n  handleInputEvent(t, a) {\n    const s = () => t.stopPropagation();\n\n    switch (t.type) {\n      case \"pointer-move\":\n        c(t.pointerType) && this._pointerLocations.set(t.pointerId, {\n          x: t.x,\n          y: t.y,\n          pointerType: t.pointerType\n        });\n        break;\n\n      case \"drag\":\n        this._grabbedManipulators.size > 0 && (this._stopDrag = !0), this._stopDrag && (s(), \"end\" === t.action && (this._stopDrag = !1));\n        break;\n\n      case \"pointer-down\":\n        {\n          if (!u(t)) break;\n\n          const e = l(t),\n                n = this._intersect(e, t.pointerType, a.forEachTool);\n\n          if (i(n)) break;\n\n          const p = this._findToolAndManipulatorByKey(n, a.forEachTool, h),\n                c = r(p, t => t.manipulator),\n                d = r(p, t => t.tool);\n\n          !(o(c) && o(d) && c.interactive) || c.grabbable && c.grabbableForEvent(t) || !c.grabbing || c.dragging || this._ungrabManipulatorBeforeDragging(c, d, t), o(c) && c.interactive && c.grabbable && c.grabbableForEvent(t) && !c.grabbing && (this._grabbedManipulators.set(t.pointerId, {\n            key: n,\n            start: e\n          }), 1 === this._grabbedManipulators.size && (this._revertToActiveTool = a.activeTool, a.setActiveTool(n.tool)), c.grabbing = !0, c.events.emit(\"grab-changed\", {\n            action: \"start\",\n            screenPoint: e\n          }), s());\n          break;\n        }\n\n      case \"pointer-up\":\n        this._handlePointerEnd(t, a);\n\n        break;\n\n      case \"pointer-drag\":\n        {\n          if (!u(t)) break;\n\n          const o = this._grabbedManipulators.get(t.pointerId),\n                p = this._draggedManipulators.get(t.pointerId),\n                c = r(o || p, ({\n            key: t\n          }) => t),\n                d = this._findManipulatorByKey(c, a.forEachTool);\n\n          if (i(d)) break;\n          const h = l(t);\n          h.x = e(h.x, 0, a.view.width), h.y = e(h.y, 0, a.view.height);\n          const g = n(o || p).start;\n\n          switch (t.action) {\n            case \"start\":\n            case \"update\":\n              \"update\" !== t.action && 1 !== this._grabbedManipulators.size || (d.dragging = !0, p ? d.events.emit(\"drag\", {\n                action: \"update\",\n                start: g,\n                screenPoint: h\n              }) : d.events.emit(\"drag\", {\n                action: \"start\",\n                start: g,\n                screenPoint: h,\n                pointerType: t.pointerType\n              }), this._draggedManipulators.set(t.pointerId, {\n                key: n(c),\n                start: g\n              }));\n              break;\n\n            case \"end\":\n              d.dragging = !1, p && d.events.emit(\"drag\", {\n                action: \"end\",\n                start: g,\n                screenPoint: h\n              }), this._draggedManipulators.delete(t.pointerId), this._handlePointerEnd(t, a);\n          }\n\n          s();\n          break;\n        }\n\n      case \"immediate-click\":\n        {\n          const e = l(t),\n                r = this._intersect(e, t.pointerType, a.forEachTool),\n                n = this._findToolAndManipulatorByKey(r, a.forEachTool, h);\n\n          if (d(t) || a.forEachTool(t => {\n            if ((!o(n) || n.tool !== t || !t.selectionManagementDisabled) && t.manipulators) {\n              let e = !1;\n              t.manipulators.forEach(({\n                manipulator: t\n              }) => {\n                t.selected && (t.selected = !1, e = !0);\n              }), e && t.manipulatorSelectionChanged && t.manipulatorSelectionChanged();\n            }\n          }), i(n)) break;\n          const {\n            manipulator: p,\n            tool: c\n          } = n;\n          if (!p.interactive) break;\n          p.selectable && !c.selectionManagementDisabled && (p.selected = !p.selected, c.manipulatorSelectionChanged && c.manipulatorSelectionChanged());\n          const u = t.native.shiftKey;\n          p.events.emit(\"immediate-click\", {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: u,\n            stopPropagation: s\n          });\n          break;\n        }\n\n      case \"click\":\n        {\n          const e = l(t),\n                o = this._intersect(e, t.pointerType, a.forEachTool),\n                r = this._findManipulatorByKey(o, a.forEachTool);\n\n          if (i(r) || !r.interactive) break;\n          const n = t.native.shiftKey;\n          r.events.emit(t.type, {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: n\n          }), s();\n          break;\n        }\n\n      case \"double-click\":\n        {\n          const e = l(t),\n                o = this._intersect(e, t.pointerType, a.forEachTool),\n                r = this._findManipulatorByKey(o, a.forEachTool);\n\n          if (i(r) || !r.interactive) break;\n          const n = t.native.shiftKey;\n          r.events.emit(\"double-click\", {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: n,\n            stopPropagation: s\n          });\n          break;\n        }\n\n      case \"immediate-double-click\":\n        {\n          const e = l(t),\n                o = this._intersect(e, t.pointerType, a.forEachTool),\n                r = this._findManipulatorByKey(o, a.forEachTool);\n\n          if (i(r) || !r.interactive) break;\n          const n = t.native.shiftKey;\n          r.events.emit(\"immediate-double-click\", {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: n,\n            stopPropagation: s\n          });\n          break;\n        }\n    }\n\n    this._updateCursor(a.forEachTool);\n  }\n\n  _ungrabManipulatorBeforeDragging(t, e, i) {\n    t.grabbing = !1, t.events.emit(\"grab-changed\", {\n      action: \"end\",\n      screenPoint: l(i)\n    }), this._grabbedManipulators.forEach(({\n      key: i\n    }, o) => {\n      i.tool === e && e.manipulators.findById(i.manipulatorId) === t && this._grabbedManipulators.delete(o);\n    });\n  }\n\n  _handlePointerEnd(t, e) {\n    const i = r(this._grabbedManipulators.get(t.pointerId), ({\n      key: t\n    }) => t),\n          a = this._findManipulatorByKey(i, e.forEachTool);\n\n    if (o(a) && !a.dragging) {\n      const r = o(e.creatingTool) && e.creatingTool === n(i).tool;\n      1 !== this._grabbedManipulators.size || 0 !== this._draggedManipulators.size || r || (e.setActiveTool(this._revertToActiveTool), this._revertToActiveTool = null), a.grabbing && (a.grabbing = !1, a.events.emit(\"grab-changed\", {\n        action: \"end\",\n        screenPoint: l(t)\n      })), this._grabbedManipulators.delete(t.pointerId);\n    }\n  }\n\n  _cursorFromMap(e, i) {\n    let r = null;\n    return t(e, ({\n      key: t\n    }) => {\n      const e = this._findManipulatorByKey(t, i);\n\n      return !!(o(e) && e.interactive && \"cursor\" in e && e.cursor) && (r = e.cursor, !0);\n    }), r;\n  }\n\n  _updateCursor(t) {\n    this._grabbedManipulators.size > 0 ? this._cursor = this._cursorFromMap(this._grabbedManipulators, t) || \"grabbing\" : this._hoveredManipulators.size > 0 ? this._cursor = this._cursorFromMap(this._hoveredManipulators, t) || \"pointer\" : this._cursor = null;\n  }\n\n  clearPointers(t, e, r = !0, n) {\n    const a = e => e.tool === t && (i(n) || e.manipulatorId === n);\n\n    this._grabbedManipulators.forEach(({\n      key: t\n    }, i) => {\n      if (a(t)) {\n        this._grabbedManipulators.delete(i);\n\n        const r = this._findManipulatorByKey(t, e);\n\n        o(r) && (r.grabbing = !1, r.events.emit(\"grab-changed\", {\n          action: \"end\",\n          screenPoint: null\n        }));\n      }\n    }), this._draggedManipulators.forEach(({\n      key: t\n    }, i) => {\n      if (a(t)) {\n        this._draggedManipulators.delete(i);\n\n        const r = this._findManipulatorByKey(t, e);\n\n        o(r) && (r.dragging = !1, r.events.emit(\"drag\", {\n          action: \"cancel\"\n        }));\n      }\n    }), r && this._hoveredManipulators.forEach(({\n      key: t\n    }, i) => {\n      if (a(t)) {\n        this._hoveredManipulators.delete(i);\n\n        const r = this._findManipulatorByKey(t, e);\n\n        o(r) && (r.hovering = !1);\n      }\n    }), this._updateCursor(e);\n  }\n\n  _intersect(t, e, o) {\n    let r = null;\n    return o(o => {\n      if (null == o.manipulators || !s(o)) return !1;\n      const n = o.manipulators.intersect(t, e);\n      return !i(n) && (r = {\n        manipulatorId: n.id,\n        tool: o\n      }, !0);\n    }), r;\n  }\n\n  updateHoveredStateFromKnownPointers(t) {\n    this._pointerLocations.forEach((e, i) => {\n      this._updateHoveredStateForPointerAtScreenPosition(a(e.x, e.y), i, e.pointerType, t);\n    });\n  }\n\n  handleHoverEvent(t, e) {\n    \"pointer-up\" !== t.type && \"immediate-click\" !== t.type && \"pointer-move\" !== t.type || !c(t.pointerType) || this._updateHoveredStateForPointerAtScreenPosition(l(t), t.pointerId, t.pointerType, e);\n  }\n\n  _updateHoveredStateForPointerAtScreenPosition(t, e, i, a) {\n    const s = this._intersect(t, i, a);\n\n    let l = this._findManipulatorByKey(s, a);\n\n    const p = r(this._hoveredManipulators.get(e), ({\n      key: t\n    }) => t),\n          c = this._findManipulatorByKey(p, a);\n\n    o(l) && !l.interactive && (l = null), c !== l && (o(c) && (c.hovering = !1), o(l) ? (l.hovering = !0, this._hoveredManipulators.set(e, {\n      key: n(s)\n    })) : this._hoveredManipulators.delete(e), this._updateCursor(a));\n  }\n\n  _findManipulatorByKey(t, e) {\n    return this._findToolAndManipulatorByKey(t, e, h) ? h.manipulator : null;\n  }\n\n  _findToolAndManipulatorByKey(t, e, r) {\n    return i(t) ? null : (r.tool = null, r.manipulator = null, e(e => {\n      if (e !== t.tool || null == e.manipulators || !s(e)) return !1;\n      const i = e.manipulators.findById(t.manipulatorId);\n      return !!o(i) && (r.manipulator = i, r.tool = e, !0);\n    }), r.manipulator ? r : null);\n  }\n\n}\n\nfunction c(t) {\n  return \"mouse\" === t;\n}\n\nfunction u(t) {\n  return \"mouse\" !== t.pointerType || 0 === t.button;\n}\n\nfunction d(t) {\n  return !!t.native.shiftKey;\n}\n\nconst h = {\n  manipulator: null,\n  tool: null\n};\nexport default p;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/interactive/ToolViewManagerManipulatorState.js"],"names":["someMap","t","clamp","e","isNone","i","isSome","o","applySome","r","unwrap","n","createScreenPoint","a","areToolManipulatorsEditable","s","createScreenPointFromEvent","l","p","constructor","_pointerLocations","Map","_hoveredManipulators","_grabbedManipulators","_draggedManipulators","_stopDrag","_revertToActiveTool","_cursor","cursor","handleInputEvent","stopPropagation","type","c","pointerType","set","pointerId","x","y","size","action","u","_intersect","forEachTool","_findToolAndManipulatorByKey","h","manipulator","d","tool","interactive","grabbable","grabbableForEvent","grabbing","dragging","_ungrabManipulatorBeforeDragging","key","start","activeTool","setActiveTool","events","emit","screenPoint","_handlePointerEnd","get","_findManipulatorByKey","view","width","height","g","delete","selectionManagementDisabled","manipulators","forEach","selected","manipulatorSelectionChanged","selectable","native","shiftKey","button","_updateCursor","findById","manipulatorId","creatingTool","_cursorFromMap","clearPointers","hovering","intersect","id","updateHoveredStateFromKnownPointers","_updateHoveredStateForPointerAtScreenPosition","handleHoverEvent"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{someMap as t}from\"../../core/MapUtils.js\";import{clamp as e}from\"../../core/mathUtils.js\";import{isNone as i,isSome as o,applySome as r,unwrap as n}from\"../../core/maybe.js\";import{createScreenPoint as a}from\"../../core/screenUtils.js\";import{areToolManipulatorsEditable as s}from\"./interactiveToolUtils.js\";import{createScreenPointFromEvent as l}from\"../support/screenUtils.js\";class p{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,a){const s=()=>t.stopPropagation();switch(t.type){case\"pointer-move\":c(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case\"drag\":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(s(),\"end\"===t.action&&(this._stopDrag=!1));break;case\"pointer-down\":{if(!u(t))break;const e=l(t),n=this._intersect(e,t.pointerType,a.forEachTool);if(i(n))break;const p=this._findToolAndManipulatorByKey(n,a.forEachTool,h),c=r(p,(t=>t.manipulator)),d=r(p,(t=>t.tool));!(o(c)&&o(d)&&c.interactive)||c.grabbable&&c.grabbableForEvent(t)||!c.grabbing||c.dragging||this._ungrabManipulatorBeforeDragging(c,d,t),o(c)&&c.interactive&&c.grabbable&&c.grabbableForEvent(t)&&!c.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:e}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=a.activeTool,a.setActiveTool(n.tool)),c.grabbing=!0,c.events.emit(\"grab-changed\",{action:\"start\",screenPoint:e}),s());break}case\"pointer-up\":this._handlePointerEnd(t,a);break;case\"pointer-drag\":{if(!u(t))break;const o=this._grabbedManipulators.get(t.pointerId),p=this._draggedManipulators.get(t.pointerId),c=r(o||p,(({key:t})=>t)),d=this._findManipulatorByKey(c,a.forEachTool);if(i(d))break;const h=l(t);h.x=e(h.x,0,a.view.width),h.y=e(h.y,0,a.view.height);const g=n(o||p).start;switch(t.action){case\"start\":case\"update\":\"update\"!==t.action&&1!==this._grabbedManipulators.size||(d.dragging=!0,p?d.events.emit(\"drag\",{action:\"update\",start:g,screenPoint:h}):d.events.emit(\"drag\",{action:\"start\",start:g,screenPoint:h,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:n(c),start:g}));break;case\"end\":d.dragging=!1,p&&d.events.emit(\"drag\",{action:\"end\",start:g,screenPoint:h}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,a)}s();break}case\"immediate-click\":{const e=l(t),r=this._intersect(e,t.pointerType,a.forEachTool),n=this._findToolAndManipulatorByKey(r,a.forEachTool,h);if(d(t)||a.forEachTool((t=>{if((!o(n)||n.tool!==t||!t.selectionManagementDisabled)&&t.manipulators){let e=!1;t.manipulators.forEach((({manipulator:t})=>{t.selected&&(t.selected=!1,e=!0)})),e&&t.manipulatorSelectionChanged&&t.manipulatorSelectionChanged()}})),i(n))break;const{manipulator:p,tool:c}=n;if(!p.interactive)break;p.selectable&&!c.selectionManagementDisabled&&(p.selected=!p.selected,c.manipulatorSelectionChanged&&c.manipulatorSelectionChanged());const u=t.native.shiftKey;p.events.emit(\"immediate-click\",{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:u,stopPropagation:s});break}case\"click\":{const e=l(t),o=this._intersect(e,t.pointerType,a.forEachTool),r=this._findManipulatorByKey(o,a.forEachTool);if(i(r)||!r.interactive)break;const n=t.native.shiftKey;r.events.emit(t.type,{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:n}),s();break}case\"double-click\":{const e=l(t),o=this._intersect(e,t.pointerType,a.forEachTool),r=this._findManipulatorByKey(o,a.forEachTool);if(i(r)||!r.interactive)break;const n=t.native.shiftKey;r.events.emit(\"double-click\",{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:n,stopPropagation:s});break}case\"immediate-double-click\":{const e=l(t),o=this._intersect(e,t.pointerType,a.forEachTool),r=this._findManipulatorByKey(o,a.forEachTool);if(i(r)||!r.interactive)break;const n=t.native.shiftKey;r.events.emit(\"immediate-double-click\",{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:n,stopPropagation:s});break}}this._updateCursor(a.forEachTool)}_ungrabManipulatorBeforeDragging(t,e,i){t.grabbing=!1,t.events.emit(\"grab-changed\",{action:\"end\",screenPoint:l(i)}),this._grabbedManipulators.forEach((({key:i},o)=>{i.tool===e&&e.manipulators.findById(i.manipulatorId)===t&&this._grabbedManipulators.delete(o)}))}_handlePointerEnd(t,e){const i=r(this._grabbedManipulators.get(t.pointerId),(({key:t})=>t)),a=this._findManipulatorByKey(i,e.forEachTool);if(o(a)&&!a.dragging){const r=o(e.creatingTool)&&e.creatingTool===n(i).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||r||(e.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),a.grabbing&&(a.grabbing=!1,a.events.emit(\"grab-changed\",{action:\"end\",screenPoint:l(t)})),this._grabbedManipulators.delete(t.pointerId)}}_cursorFromMap(e,i){let r=null;return t(e,(({key:t})=>{const e=this._findManipulatorByKey(t,i);return!!(o(e)&&e.interactive&&\"cursor\"in e&&e.cursor)&&(r=e.cursor,!0)})),r}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||\"grabbing\":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||\"pointer\":this._cursor=null}clearPointers(t,e,r=!0,n){const a=e=>e.tool===t&&(i(n)||e.manipulatorId===n);this._grabbedManipulators.forEach((({key:t},i)=>{if(a(t)){this._grabbedManipulators.delete(i);const r=this._findManipulatorByKey(t,e);o(r)&&(r.grabbing=!1,r.events.emit(\"grab-changed\",{action:\"end\",screenPoint:null}))}})),this._draggedManipulators.forEach((({key:t},i)=>{if(a(t)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(t,e);o(r)&&(r.dragging=!1,r.events.emit(\"drag\",{action:\"cancel\"}))}})),r&&this._hoveredManipulators.forEach((({key:t},i)=>{if(a(t)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(t,e);o(r)&&(r.hovering=!1)}})),this._updateCursor(e)}_intersect(t,e,o){let r=null;return o((o=>{if(null==o.manipulators||!s(o))return!1;const n=o.manipulators.intersect(t,e);return!i(n)&&(r={manipulatorId:n.id,tool:o},!0)})),r}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach(((e,i)=>{this._updateHoveredStateForPointerAtScreenPosition(a(e.x,e.y),i,e.pointerType,t)}))}handleHoverEvent(t,e){\"pointer-up\"!==t.type&&\"immediate-click\"!==t.type&&\"pointer-move\"!==t.type||!c(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(l(t),t.pointerId,t.pointerType,e)}_updateHoveredStateForPointerAtScreenPosition(t,e,i,a){const s=this._intersect(t,i,a);let l=this._findManipulatorByKey(s,a);const p=r(this._hoveredManipulators.get(e),(({key:t})=>t)),c=this._findManipulatorByKey(p,a);o(l)&&!l.interactive&&(l=null),c!==l&&(o(c)&&(c.hovering=!1),o(l)?(l.hovering=!0,this._hoveredManipulators.set(e,{key:n(s)})):this._hoveredManipulators.delete(e),this._updateCursor(a))}_findManipulatorByKey(t,e){return this._findToolAndManipulatorByKey(t,e,h)?h.manipulator:null}_findToolAndManipulatorByKey(t,e,r){return i(t)?null:(r.tool=null,r.manipulator=null,e((e=>{if(e!==t.tool||null==e.manipulators||!s(e))return!1;const i=e.manipulators.findById(t.manipulatorId);return!!o(i)&&(r.manipulator=i,r.tool=e,!0)})),r.manipulator?r:null)}}function c(t){return\"mouse\"===t}function u(t){return\"mouse\"!==t.pointerType||0===t.button}function d(t){return!!t.native.shiftKey}const h={manipulator:null,tool:null};export default p;\n"]},"metadata":{},"sourceType":"module"}