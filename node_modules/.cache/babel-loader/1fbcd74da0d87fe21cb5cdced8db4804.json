{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Error.js\";\nimport { destroyMaybe as r, isSome as i, get as s, isNone as n } from \"../../../core/maybe.js\";\nimport { whenTrueOnce as o } from \"../../../core/watchUtils.js\";\nimport { property as a } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as l } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { hydrateGraphic as h } from \"../../../layers/graphics/hydratedFeatures.js\";\nimport { FeatureTileController3D as p } from \"../../../layers/graphics/controllers/FeatureTileController3D.js\";\nimport { getRenderingInfo as d, getRenderingInfoAsync as u } from \"../../../renderers/support/renderingInfoUtils.js\";\nimport c from \"../../../rest/support/Query.js\";\nimport g from \"./graphics/Graphics3DFeatureLikeLayerView.js\";\nimport y from \"./graphics/QueryEngine.js\";\nimport { toViewIfLocal as m } from \"./support/projectExtentUtils.js\";\nimport { TaskPriority as f } from \"../../support/Scheduler.js\";\n\nconst E = E => {\n  let b = class extends E {\n    constructor() {\n      super(...arguments), this.controller = null, this.updatePolicy = 1, this.suspendResumeExtentMode = \"computed\", this.slicePlaneEnabled = !1, this.drapeSourceType = 1, this.fullExtentInLocalViewSpatialReference = null, this.suspendResumeExtent = null, this._controllerCreated = !1, this.clippingExtent = null, this.supportsHeightUnitConversion = !0, this.pendingController = null, this.queryEngine = null;\n    }\n\n    initialize() {\n      const e = this.layer;\n      \"isTable\" in e && e.isTable ? this.addResolvingPromise(Promise.reject(new t(\"featurelayerview:table-not-supported\", \"table feature layer can't be displayed\", {\n        layer: e\n      }))) : (this._set(\"graphics3d\", new g({\n        owner: this,\n        layer: e,\n        frustumVisibilityEnabled: !0,\n        scaleVisibilityEnabled: !0,\n        filterVisibilityEnabled: !0,\n        timeExtentVisibilityEnabled: !0,\n        elevationAlignmentEnabled: !0,\n        elevationFeatureExpressionEnabled: !0,\n        preferredUpdatePolicy: this.updatePolicy,\n        suspendResumeExtentMode: this.suspendResumeExtentMode,\n        updateClippingExtent: e => this.updateClippingExtent(e)\n      })), this.updatingHandles.add(this, \"updatePolicy\", e => this.graphics3d.graphicsCore.preferredUpdatePolicy = e), this.updatingHandles.add(this, \"suspendResumeExtentMode\", e => {\n        this.graphics3d.suspendResumeExtentMode = e;\n      }), this.addResolvingPromise(this.graphics3d.setup().then(() => this.validateGeometryType()).then(() => this.queryEngine = new y({\n        layerView: this,\n        priority: f.FEATURE_QUERY_ENGINE\n      })).then(() => m(this)).then(e => this.fullExtentInLocalViewSpatialReference = e).then(() => this.initializeController())), this.notifyChange(\"updating\"));\n    }\n\n    destroy() {\n      this.destroyPendingController(), this.controller = r(this.controller), this._set(\"graphics3d\", r(this.graphics3d)), this.queryEngine = r(this.queryEngine), this.loadedGraphics = null;\n    }\n\n    destroyPendingController() {\n      this.pendingController && (this.pendingController.destroy(), this.pendingController = null);\n    }\n\n    get legendEnabled() {\n      var e, t;\n      return this.canResume() && !(null != (e = this.graphics3d) && null != (t = e.frustumVisibility) && t.suspended);\n    }\n\n    notifyGraphicGeometryChanged(e) {\n      this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e);\n    }\n\n    notifyGraphicVisibilityChanged(e) {\n      this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e);\n    }\n\n    getRenderingInfo(e, t, r) {\n      const s = d(e, {\n        renderer: t,\n        arcade: r\n      });\n\n      if (i(s) && s.color) {\n        const e = s.color;\n        e[0] = e[0] / 255, e[1] = e[1] / 255, e[2] = e[2] / 255;\n      }\n\n      return s;\n    }\n\n    async getRenderingInfoAsync(e, t, r, i) {\n      return u(e, {\n        renderer: t,\n        arcade: r,\n        ...i\n      });\n    }\n\n    getGraphicFromGraphicUid(e) {\n      var t;\n      let r = null;\n      return null == (t = this.loadedGraphics) || t.forEach(t => {\n        t.uid === e && (r = h(t, this.layer));\n      }), r;\n    }\n\n    get graphics3DGraphics() {\n      return this.graphics3d ? this.graphics3d.graphicsCore.graphics3DGraphics : null;\n    }\n\n    get graphics3DGraphicsByObjectID() {\n      return this.graphics3d ? this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID : null;\n    }\n\n    get symbolUpdateType() {\n      return this.graphics3d ? this.graphics3d.graphicsCore.symbolUpdateType : null;\n    }\n\n    whenGraphicBounds(e, t) {\n      return this.graphics3d ? this.graphics3d.graphicsCore.whenGraphicBounds(e, t) : null;\n    }\n\n    computeAttachmentOrigin(e, t) {\n      return this.graphics3d ? this.graphics3d.graphicsCore.computeAttachmentOrigin(e, t) : null;\n    }\n\n    getSymbolLayerSize(e, t) {\n      return this.graphics3d ? this.graphics3d.graphicsCore.getSymbolLayerSize(e, t) : null;\n    }\n\n    queryFeatures(e, t) {\n      return this.queryEngine.executeQuery(this._ensureQuery(e), s(t, \"signal\"));\n    }\n\n    queryObjectIds(e, t) {\n      return this.queryEngine.executeQueryForIds(this._ensureQuery(e), s(t, \"signal\"));\n    }\n\n    queryFeatureCount(e, t) {\n      return this.queryEngine.executeQueryForCount(this._ensureQuery(e), s(t, \"signal\"));\n    }\n\n    queryExtent(e, t) {\n      return this.queryEngine.executeQueryForExtent(this._ensureQuery(e), s(t, \"signal\"));\n    }\n\n    _ensureQuery(e) {\n      return n(e) ? this.createQuery() : c.from(e);\n    }\n\n    highlight(e) {\n      return this.graphics3d.highlight(e, this.layer.objectIdField);\n    }\n\n    maskOccludee(e) {\n      return this.graphics3d.maskOccludee(e);\n    }\n\n    canResume() {\n      return super.canResume() && (!this.graphics3d || !this.graphics3d.suspended);\n    }\n\n    getSuspendInfo() {\n      const e = super.getSuspendInfo();\n      return this.graphics3d ? { ...e,\n        ...this.graphics3d.suspendInfo\n      } : e;\n    }\n\n    isUpdating() {\n      var e, t;\n      return !(!this.graphics3d || this.graphics3d.destroyed) && !(this._controllerCreated && (null == (e = this.controller) || !e.updating) && null != (t = this.view.basemapTerrain) && t.ready && !this.graphics3d.updating);\n    }\n\n    async initializeController() {\n      const e = this.createController();\n      this.pendingController = e, await e.when(), this.setControllerWhenInitialized(e);\n    }\n\n    async setControllerWhenInitialized(e) {\n      try {\n        await this.when();\n      } catch (t) {}\n\n      this._controllerCreated = !0, this.notifyChange(\"updating\"), this.isResolved() && !this.destroyed ? (await o(this.view, \"basemapTerrain.ready\"), this.beforeSetController(e), this.pendingController = null, this.controller = e, this.loadedGraphics = e.graphics, this.notifyChange(\"updating\")) : this.destroyPendingController();\n    }\n\n    updateClippingExtent(e) {\n      if (this.clippingExtent = e, !this.controller) return !1;\n\n      switch (this.controller.type) {\n        case \"stream\":\n          return !1;\n\n        case \"feature-tile-3d\":\n          return this.controller.extent = e, !0;\n      }\n    }\n\n    validateGeometryType() {\n      switch (this.layer.geometryType) {\n        case \"multipatch\":\n        case \"multipoint\":\n          return Promise.reject(new t(\"featurelayerview3d:unsupported-geometry-type\", \"Unsupported geometry type ${geometryType}\", {\n            geometryType: this.layer.geometryType\n          }));\n      }\n    }\n\n    _getResourceInfo() {\n      const e = this.controller && this.controller instanceof p ? this.controller : null;\n      return {\n        displayedNumberOfFeatures: this.loadedGraphics.length,\n        maximumNumberOfFeatures: e ? e.maximumNumberOfFeatures : -1,\n        totalNumberOfFeatures: e ? e.serviceDataCount : -1,\n        nodes: 0,\n        core: this.graphics3d.graphicsCore.performanceInfo,\n        elevationUpdating: this.graphics3d.elevationAlignment.updating,\n        visibilityFrustum: !this.graphics3d.frustumVisibility.suspended,\n        visibilityScale: !this.graphics3d.scaleVisibility.suspended\n      };\n    }\n\n    get performanceInfo() {\n      return this._getResourceInfo();\n    }\n\n  };\n  return e([a()], b.prototype, \"loadedGraphics\", void 0), e([a()], b.prototype, \"suspended\", void 0), e([a({\n    readOnly: !0\n  })], b.prototype, \"legendEnabled\", null), e([a()], b.prototype, \"updating\", void 0), e([a()], b.prototype, \"controller\", void 0), e([a()], b.prototype, \"graphics3d\", void 0), e([a({\n    readOnly: !0\n  })], b.prototype, \"updatePolicy\", void 0), e([a({\n    readOnly: !0\n  })], b.prototype, \"suspendResumeExtentMode\", void 0), e([a({\n    type: Boolean\n  })], b.prototype, \"slicePlaneEnabled\", void 0), e([a({\n    readOnly: !0\n  })], b.prototype, \"suspendInfo\", void 0), b = e([l(\"esri.views.3d.layers.FeatureLikeLayerView3D\")], b), b;\n};\n\nexport { E as FeatureLikeLayerView3D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/FeatureLikeLayerView3D.js"],"names":["_","e","t","destroyMaybe","r","isSome","i","get","s","isNone","n","whenTrueOnce","o","property","a","subclass","l","hydrateGraphic","h","FeatureTileController3D","p","getRenderingInfo","d","getRenderingInfoAsync","u","c","g","y","toViewIfLocal","m","TaskPriority","f","E","b","constructor","arguments","controller","updatePolicy","suspendResumeExtentMode","slicePlaneEnabled","drapeSourceType","fullExtentInLocalViewSpatialReference","suspendResumeExtent","_controllerCreated","clippingExtent","supportsHeightUnitConversion","pendingController","queryEngine","initialize","layer","isTable","addResolvingPromise","Promise","reject","_set","owner","frustumVisibilityEnabled","scaleVisibilityEnabled","filterVisibilityEnabled","timeExtentVisibilityEnabled","elevationAlignmentEnabled","elevationFeatureExpressionEnabled","preferredUpdatePolicy","updateClippingExtent","updatingHandles","add","graphics3d","graphicsCore","setup","then","validateGeometryType","layerView","priority","FEATURE_QUERY_ENGINE","initializeController","notifyChange","destroy","destroyPendingController","loadedGraphics","legendEnabled","canResume","frustumVisibility","suspended","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","renderer","arcade","color","getGraphicFromGraphicUid","forEach","uid","graphics3DGraphics","graphics3DGraphicsByObjectID","symbolUpdateType","whenGraphicBounds","computeAttachmentOrigin","getSymbolLayerSize","queryFeatures","executeQuery","_ensureQuery","queryObjectIds","executeQueryForIds","queryFeatureCount","executeQueryForCount","queryExtent","executeQueryForExtent","createQuery","from","highlight","objectIdField","maskOccludee","getSuspendInfo","suspendInfo","isUpdating","destroyed","updating","view","basemapTerrain","ready","createController","when","setControllerWhenInitialized","isResolved","beforeSetController","graphics","type","extent","geometryType","_getResourceInfo","displayedNumberOfFeatures","length","maximumNumberOfFeatures","totalNumberOfFeatures","serviceDataCount","nodes","core","performanceInfo","elevationUpdating","elevationAlignment","visibilityFrustum","visibilityScale","scaleVisibility","prototype","readOnly","Boolean","FeatureLikeLayerView3D"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import{destroyMaybe as r,isSome as i,get as s,isNone as n}from\"../../../core/maybe.js\";import{whenTrueOnce as o}from\"../../../core/watchUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{hydrateGraphic as h}from\"../../../layers/graphics/hydratedFeatures.js\";import{FeatureTileController3D as p}from\"../../../layers/graphics/controllers/FeatureTileController3D.js\";import{getRenderingInfo as d,getRenderingInfoAsync as u}from\"../../../renderers/support/renderingInfoUtils.js\";import c from\"../../../rest/support/Query.js\";import g from\"./graphics/Graphics3DFeatureLikeLayerView.js\";import y from\"./graphics/QueryEngine.js\";import{toViewIfLocal as m}from\"./support/projectExtentUtils.js\";import{TaskPriority as f}from\"../../support/Scheduler.js\";const E=E=>{let b=class extends E{constructor(){super(...arguments),this.controller=null,this.updatePolicy=1,this.suspendResumeExtentMode=\"computed\",this.slicePlaneEnabled=!1,this.drapeSourceType=1,this.fullExtentInLocalViewSpatialReference=null,this.suspendResumeExtent=null,this._controllerCreated=!1,this.clippingExtent=null,this.supportsHeightUnitConversion=!0,this.pendingController=null,this.queryEngine=null}initialize(){const e=this.layer;\"isTable\"in e&&e.isTable?this.addResolvingPromise(Promise.reject(new t(\"featurelayerview:table-not-supported\",\"table feature layer can't be displayed\",{layer:e}))):(this._set(\"graphics3d\",new g({owner:this,layer:e,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:e=>this.updateClippingExtent(e)})),this.updatingHandles.add(this,\"updatePolicy\",(e=>this.graphics3d.graphicsCore.preferredUpdatePolicy=e)),this.updatingHandles.add(this,\"suspendResumeExtentMode\",(e=>{this.graphics3d.suspendResumeExtentMode=e})),this.addResolvingPromise(this.graphics3d.setup().then((()=>this.validateGeometryType())).then((()=>this.queryEngine=new y({layerView:this,priority:f.FEATURE_QUERY_ENGINE}))).then((()=>m(this))).then((e=>this.fullExtentInLocalViewSpatialReference=e)).then((()=>this.initializeController()))),this.notifyChange(\"updating\"))}destroy(){this.destroyPendingController(),this.controller=r(this.controller),this._set(\"graphics3d\",r(this.graphics3d)),this.queryEngine=r(this.queryEngine),this.loadedGraphics=null}destroyPendingController(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)}get legendEnabled(){var e,t;return this.canResume()&&!(null!=(e=this.graphics3d)&&null!=(t=e.frustumVisibility)&&t.suspended)}notifyGraphicGeometryChanged(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,t,r){const s=d(e,{renderer:t,arcade:r});if(i(s)&&s.color){const e=s.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return s}async getRenderingInfoAsync(e,t,r,i){return u(e,{renderer:t,arcade:r,...i})}getGraphicFromGraphicUid(e){var t;let r=null;return null==(t=this.loadedGraphics)||t.forEach((t=>{t.uid===e&&(r=h(t,this.layer))})),r}get graphics3DGraphics(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null}get graphics3DGraphicsByObjectID(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}get symbolUpdateType(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null}whenGraphicBounds(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null}computeAttachmentOrigin(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(e,t):null}queryFeatures(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),s(t,\"signal\"))}queryObjectIds(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),s(t,\"signal\"))}queryFeatureCount(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),s(t,\"signal\"))}queryExtent(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),s(t,\"signal\"))}_ensureQuery(e){return n(e)?this.createQuery():c.from(e)}highlight(e){return this.graphics3d.highlight(e,this.layer.objectIdField)}maskOccludee(e){return this.graphics3d.maskOccludee(e)}canResume(){return super.canResume()&&(!this.graphics3d||!this.graphics3d.suspended)}getSuspendInfo(){const e=super.getSuspendInfo();return this.graphics3d?{...e,...this.graphics3d.suspendInfo}:e}isUpdating(){var e,t;return!(!this.graphics3d||this.graphics3d.destroyed)&&!(this._controllerCreated&&(null==(e=this.controller)||!e.updating)&&null!=(t=this.view.basemapTerrain)&&t.ready&&!this.graphics3d.updating)}async initializeController(){const e=this.createController();this.pendingController=e,await e.when(),this.setControllerWhenInitialized(e)}async setControllerWhenInitialized(e){try{await this.when()}catch(t){}this._controllerCreated=!0,this.notifyChange(\"updating\"),this.isResolved()&&!this.destroyed?(await o(this.view,\"basemapTerrain.ready\"),this.beforeSetController(e),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange(\"updating\")):this.destroyPendingController()}updateClippingExtent(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case\"stream\":return!1;case\"feature-tile-3d\":return this.controller.extent=e,!0}}validateGeometryType(){switch(this.layer.geometryType){case\"multipatch\":case\"multipoint\":return Promise.reject(new t(\"featurelayerview3d:unsupported-geometry-type\",\"Unsupported geometry type ${geometryType}\",{geometryType:this.layer.geometryType}))}}_getResourceInfo(){const e=this.controller&&this.controller instanceof p?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:e?e.maximumNumberOfFeatures:-1,totalNumberOfFeatures:e?e.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}}get performanceInfo(){return this._getResourceInfo()}};return e([a()],b.prototype,\"loadedGraphics\",void 0),e([a()],b.prototype,\"suspended\",void 0),e([a({readOnly:!0})],b.prototype,\"legendEnabled\",null),e([a()],b.prototype,\"updating\",void 0),e([a()],b.prototype,\"controller\",void 0),e([a()],b.prototype,\"graphics3d\",void 0),e([a({readOnly:!0})],b.prototype,\"updatePolicy\",void 0),e([a({readOnly:!0})],b.prototype,\"suspendResumeExtentMode\",void 0),e([a({type:Boolean})],b.prototype,\"slicePlaneEnabled\",void 0),e([a({readOnly:!0})],b.prototype,\"suspendInfo\",void 0),b=e([l(\"esri.views.3d.layers.FeatureLikeLayerView3D\")],b),b};export{E as FeatureLikeLayerView3D};\n"]},"metadata":{},"sourceType":"module"}