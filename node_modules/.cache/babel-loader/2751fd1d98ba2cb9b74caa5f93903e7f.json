{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Logger.js\";\nimport { isSome as t, isNone as r } from \"../../../../core/maybe.js\";\nimport { createRenderScreenPointArray3 as s } from \"../../../../core/screenUtils.js\";\nimport { c as i } from \"../../../../chunks/vec2.js\";\nimport { s as n, f as o, d as a, a as c, b as u, g as l, l as p, i as m } from \"../../../../chunks/vec3.js\";\nimport { c as f } from \"../../../../chunks/vec3f64.js\";\nimport { distance2 as h, fromPoints as d, closestLineSegmentPoint as g, create as b } from \"../../../../geometry/support/lineSegment.js\";\nimport { fromPoints as j, signedDistance as P, normal as v, create as C } from \"../../../../geometry/support/plane.js\";\nimport { BufferViewVec3f as q } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { computeAttachmentOriginLines as y } from \"../lib/geometryDataUtils.js\";\nimport x from \"../lib/GLMaterial.js\";\nimport { Material as _, materialParametersDefaults as L } from \"../lib/Material.js\";\nimport { isTranslationMatrix as O } from \"../lib/Util.js\";\nimport { writeDefaultAttributes as w } from \"./internal/bufferWriterUtils.js\";\nimport { PositionColorLayout as A, PositionLayout as S, DefaultBufferWriter as B } from \"./internal/DefaultBufferWriter.js\";\nimport { intersectDrapedRenderLineGeometry as E } from \"./internal/MaterialUtil.js\";\nimport { isInstanceHidden as R } from \"./renderers/utils.js\";\nimport { NativeLineTechniqueConfiguration as T, NativeLineTechnique as M } from \"../shaders/NativeLineTechnique.js\";\nconst U = e.getLogger(\"esri.views.3d.webgl-engine.materials.NativeLineMaterial\");\n\nclass H extends _ {\n  constructor(e) {\n    super(e, V), this.techniqueConfig = new T();\n  }\n\n  getTechniqueConfig(e) {\n    this.techniqueConfig.output = e, this.techniqueConfig.slicePlaneEnabled = this.params.slicePlaneEnabled, this.techniqueConfig.vertexColors = this.params.vertexColors, this.techniqueConfig.transparent = this.params.color[3] < 1 || this.params.width < 1;\n    const r = t(this.params.stipplePattern);\n    return this.techniqueConfig.stippleEnabled = r, this.techniqueConfig.stippleOffColorEnabled = r && t(this.params.stippleOffColor), this.techniqueConfig.stippleIntegerRepeatsEnabled = r && this.params.stippleIntegerRepeats, this.techniqueConfig.sceneHasOcludees = this.params.sceneHasOcludees, this.techniqueConfig;\n  }\n\n  getPassParameters() {\n    return this.params;\n  }\n\n  intersect(e, t, r, s, i, n, o, a, c) {\n    c ? E(e, s, n, 1, o) : this.intersectLineGeometry(e, t, r, s, o);\n  }\n\n  intersectLineGeometry(e, t, r, s, f) {\n    if (!s.options.selectionMode || R(t)) return;\n    if (!O(r)) return void U.error(\"intersection assumes a translation-only matrix\");\n    const b = e.vertexAttributes.get(\"position\").data,\n          C = s.camera,\n          q = Y;\n    i(q, s.point);\n    const y = 2;\n    n(Z[0], q[0] - y, q[1] + y, 0), n(Z[1], q[0] + y, q[1] + y, 0), n(Z[2], q[0] + y, q[1] - y, 0), n(Z[3], q[0] - y, q[1] - y, 0);\n\n    for (let i = 0; i < 4; i++) if (!C.unprojectFromRenderScreen(Z[i], $[i])) return;\n\n    j(C.eye, $[0], $[1], ee), j(C.eye, $[1], $[2], te), j(C.eye, $[2], $[3], re), j(C.eye, $[3], $[0], se);\n    let x = Number.MAX_VALUE;\n\n    for (let i = 0; i < b.length - 5; i += 3) {\n      if (k[0] = b[i] + r[12], k[1] = b[i + 1] + r[13], k[2] = b[i + 2] + r[14], I[0] = b[i + 3] + r[12], I[1] = b[i + 4] + r[13], I[2] = b[i + 5] + r[14], P(ee, k) < 0 && P(ee, I) < 0 || P(te, k) < 0 && P(te, I) < 0 || P(re, k) < 0 && P(re, I) < 0 || P(se, k) < 0 && P(se, I) < 0) continue;\n\n      if (C.projectToRenderScreen(k, F), C.projectToRenderScreen(I, X), F[2] < 0 && X[2] > 0) {\n        o(W, k, I);\n        const e = C.frustum,\n              t = -P(e[4], k) / a(W, v(e[4]));\n        c(W, W, t), u(k, k, W), C.projectToRenderScreen(k, F);\n      } else if (F[2] > 0 && X[2] < 0) {\n        o(W, I, k);\n        const e = C.frustum,\n              t = -P(e[4], I) / a(W, v(e[4]));\n        c(W, W, t), u(I, I, W), C.projectToRenderScreen(I, X);\n      } else if (F[2] < 0 && X[2] < 0) continue;\n\n      F[2] = 0, X[2] = 0;\n      const e = h(d(F, X, K), q);\n      e < x && (x = e, l(z, k), l(J, I));\n    }\n\n    const _ = s.rayBeginPoint,\n          L = s.rayEndPoint;\n\n    if (x < y * y) {\n      let e = Number.MAX_VALUE;\n\n      if (g(d(z, J, K), d(_, L, Q), D)) {\n        o(D, D, _);\n        const t = p(D);\n        c(D, D, 1 / t), e = t / m(_, L);\n      }\n\n      f(e, D);\n    }\n  }\n\n  computeAttachmentOrigin(e, t) {\n    const r = e.vertexAttributes;\n    if (!r) return !1;\n    const s = r.get(\"position\");\n    return y(s, null, !1, t);\n  }\n\n  createBufferWriter() {\n    const e = this.params.vertexColors ? A : S;\n    return r(this.params.stipplePattern) ? new B(e) : new N(e.clone().vec3f(\"auxpos1\"));\n  }\n\n  getGLMaterial(e) {\n    return 0 === e.output || 4 === e.output ? new G(e) : void 0;\n  }\n\n}\n\nclass G extends x {\n  constructor(e) {\n    super(e), this.updateParameters();\n  }\n\n  updateParameters() {\n    this._technique = this._techniqueRep.releaseAndAcquire(M, this._material.getTechniqueConfig(this._output), this._technique);\n  }\n\n  beginSlot(e) {\n    return 3 === e;\n  }\n\n  _updateOccludeeState(e) {\n    e.hasOccludees !== this._material.params.sceneHasOcludees && (this._material.setParameterValues({\n      sceneHasOcludees: e.hasOccludees\n    }), this.updateParameters());\n  }\n\n  ensureParameters(e) {\n    0 === this._output && this._updateOccludeeState(e);\n  }\n\n  bind(e) {\n    this._technique.bindPass(this._material.getPassParameters(), e);\n  }\n\n  getPipelineState(e, t) {\n    return this._technique.getPipelineState(t);\n  }\n\n}\n\nclass N {\n  constructor(e) {\n    this.vertexBufferLayout = e;\n  }\n\n  allocate(e) {\n    return this.vertexBufferLayout.createBuffer(e);\n  }\n\n  elementCount(e) {\n    return e.indices.get(\"position\").length;\n  }\n\n  write(e, t, r, s) {\n    w(t, this.vertexBufferLayout, e.transformation, e.invTranspTransformation, r, s), this.writeAuxpos1(e, t, r, s);\n  }\n\n  writeAuxpos1(e, t, r, s) {\n    const i = r.getField(\"auxpos1\", q),\n          n = t.indices.get(\"position\"),\n          o = t.vertexAttributes.get(\"position\").data,\n          a = e.transformation,\n          c = i.typedBufferStride,\n          u = i.typedBuffer;\n    s *= c;\n\n    for (let l = 0; l < n.length; l += 2) {\n      const e = 3 * n[l],\n            t = o[e],\n            r = o[e + 1],\n            i = o[e + 2],\n            p = a[0] * t + a[4] * r + a[8] * i + a[12],\n            m = a[1] * t + a[5] * r + a[9] * i + a[13],\n            f = a[2] * t + a[6] * r + a[10] * i + a[14];\n\n      for (let n = 0; n < 2; ++n) u[s] = p, u[s + 1] = m, u[s + 2] = f, s += c;\n    }\n  }\n\n}\n\nconst V = {\n  color: [1, 1, 1, 1],\n  vertexColors: !1,\n  slicePlaneEnabled: !1,\n  width: 1,\n  stipplePattern: null,\n  stippleIntegerRepeats: !1,\n  stippleOffColor: null,\n  sceneHasOcludees: !1,\n  ...L\n},\n      k = f(),\n      I = f(),\n      W = f(),\n      D = f(),\n      F = s(),\n      X = s(),\n      z = f(),\n      J = f(),\n      K = b(),\n      Q = b(),\n      Y = f(),\n      Z = [s(), s(), s(), s()],\n      $ = [f(), f(), f(), f()],\n      ee = C(),\n      te = C(),\n      re = C(),\n      se = C();\nexport { H as NativeLineMaterial };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/materials/NativeLineMaterial.js"],"names":["e","isSome","t","isNone","r","createRenderScreenPointArray3","s","c","i","n","f","o","d","a","b","u","g","l","p","m","distance2","h","fromPoints","closestLineSegmentPoint","create","j","signedDistance","P","normal","v","C","BufferViewVec3f","q","computeAttachmentOriginLines","y","x","Material","_","materialParametersDefaults","L","isTranslationMatrix","O","writeDefaultAttributes","w","PositionColorLayout","A","PositionLayout","S","DefaultBufferWriter","B","intersectDrapedRenderLineGeometry","E","isInstanceHidden","R","NativeLineTechniqueConfiguration","T","NativeLineTechnique","M","U","getLogger","H","constructor","V","techniqueConfig","getTechniqueConfig","output","slicePlaneEnabled","params","vertexColors","transparent","color","width","stipplePattern","stippleEnabled","stippleOffColorEnabled","stippleOffColor","stippleIntegerRepeatsEnabled","stippleIntegerRepeats","sceneHasOcludees","getPassParameters","intersect","intersectLineGeometry","options","selectionMode","error","vertexAttributes","get","data","camera","Y","point","Z","unprojectFromRenderScreen","$","eye","ee","te","re","se","Number","MAX_VALUE","length","k","I","projectToRenderScreen","F","X","W","frustum","K","z","J","rayBeginPoint","rayEndPoint","Q","D","computeAttachmentOrigin","createBufferWriter","N","clone","vec3f","getGLMaterial","G","updateParameters","_technique","_techniqueRep","releaseAndAcquire","_material","_output","beginSlot","_updateOccludeeState","hasOccludees","setParameterValues","ensureParameters","bind","bindPass","getPipelineState","vertexBufferLayout","allocate","createBuffer","elementCount","indices","write","transformation","invTranspTransformation","writeAuxpos1","getField","typedBufferStride","typedBuffer","NativeLineMaterial"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Logger.js\";import{isSome as t,isNone as r}from\"../../../../core/maybe.js\";import{createRenderScreenPointArray3 as s}from\"../../../../core/screenUtils.js\";import{c as i}from\"../../../../chunks/vec2.js\";import{s as n,f as o,d as a,a as c,b as u,g as l,l as p,i as m}from\"../../../../chunks/vec3.js\";import{c as f}from\"../../../../chunks/vec3f64.js\";import{distance2 as h,fromPoints as d,closestLineSegmentPoint as g,create as b}from\"../../../../geometry/support/lineSegment.js\";import{fromPoints as j,signedDistance as P,normal as v,create as C}from\"../../../../geometry/support/plane.js\";import{BufferViewVec3f as q}from\"../../../../geometry/support/buffer/BufferView.js\";import{computeAttachmentOriginLines as y}from\"../lib/geometryDataUtils.js\";import x from\"../lib/GLMaterial.js\";import{Material as _,materialParametersDefaults as L}from\"../lib/Material.js\";import{isTranslationMatrix as O}from\"../lib/Util.js\";import{writeDefaultAttributes as w}from\"./internal/bufferWriterUtils.js\";import{PositionColorLayout as A,PositionLayout as S,DefaultBufferWriter as B}from\"./internal/DefaultBufferWriter.js\";import{intersectDrapedRenderLineGeometry as E}from\"./internal/MaterialUtil.js\";import{isInstanceHidden as R}from\"./renderers/utils.js\";import{NativeLineTechniqueConfiguration as T,NativeLineTechnique as M}from\"../shaders/NativeLineTechnique.js\";const U=e.getLogger(\"esri.views.3d.webgl-engine.materials.NativeLineMaterial\");class H extends _{constructor(e){super(e,V),this.techniqueConfig=new T}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;const r=t(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&t(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=r&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,r,s,i,n,o,a,c){c?E(e,s,n,1,o):this.intersectLineGeometry(e,t,r,s,o)}intersectLineGeometry(e,t,r,s,f){if(!s.options.selectionMode||R(t))return;if(!O(r))return void U.error(\"intersection assumes a translation-only matrix\");const b=e.vertexAttributes.get(\"position\").data,C=s.camera,q=Y;i(q,s.point);const y=2;n(Z[0],q[0]-y,q[1]+y,0),n(Z[1],q[0]+y,q[1]+y,0),n(Z[2],q[0]+y,q[1]-y,0),n(Z[3],q[0]-y,q[1]-y,0);for(let i=0;i<4;i++)if(!C.unprojectFromRenderScreen(Z[i],$[i]))return;j(C.eye,$[0],$[1],ee),j(C.eye,$[1],$[2],te),j(C.eye,$[2],$[3],re),j(C.eye,$[3],$[0],se);let x=Number.MAX_VALUE;for(let i=0;i<b.length-5;i+=3){if(k[0]=b[i]+r[12],k[1]=b[i+1]+r[13],k[2]=b[i+2]+r[14],I[0]=b[i+3]+r[12],I[1]=b[i+4]+r[13],I[2]=b[i+5]+r[14],P(ee,k)<0&&P(ee,I)<0||P(te,k)<0&&P(te,I)<0||P(re,k)<0&&P(re,I)<0||P(se,k)<0&&P(se,I)<0)continue;if(C.projectToRenderScreen(k,F),C.projectToRenderScreen(I,X),F[2]<0&&X[2]>0){o(W,k,I);const e=C.frustum,t=-P(e[4],k)/a(W,v(e[4]));c(W,W,t),u(k,k,W),C.projectToRenderScreen(k,F)}else if(F[2]>0&&X[2]<0){o(W,I,k);const e=C.frustum,t=-P(e[4],I)/a(W,v(e[4]));c(W,W,t),u(I,I,W),C.projectToRenderScreen(I,X)}else if(F[2]<0&&X[2]<0)continue;F[2]=0,X[2]=0;const e=h(d(F,X,K),q);e<x&&(x=e,l(z,k),l(J,I))}const _=s.rayBeginPoint,L=s.rayEndPoint;if(x<y*y){let e=Number.MAX_VALUE;if(g(d(z,J,K),d(_,L,Q),D)){o(D,D,_);const t=p(D);c(D,D,1/t),e=t/m(_,L)}f(e,D)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const s=r.get(\"position\");return y(s,null,!1,t)}createBufferWriter(){const e=this.params.vertexColors?A:S;return r(this.params.stipplePattern)?new B(e):new N(e.clone().vec3f(\"auxpos1\"))}getGLMaterial(e){return 0===e.output||4===e.output?new G(e):void 0}}class G extends x{constructor(e){super(e),this.updateParameters()}updateParameters(){this._technique=this._techniqueRep.releaseAndAcquire(M,this._material.getTechniqueConfig(this._output),this._technique)}beginSlot(e){return 3===e}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this._output&&this._updateOccludeeState(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}class N{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(\"position\").length}write(e,t,r,s){w(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,s),this.writeAuxpos1(e,t,r,s)}writeAuxpos1(e,t,r,s){const i=r.getField(\"auxpos1\",q),n=t.indices.get(\"position\"),o=t.vertexAttributes.get(\"position\").data,a=e.transformation,c=i.typedBufferStride,u=i.typedBuffer;s*=c;for(let l=0;l<n.length;l+=2){const e=3*n[l],t=o[e],r=o[e+1],i=o[e+2],p=a[0]*t+a[4]*r+a[8]*i+a[12],m=a[1]*t+a[5]*r+a[9]*i+a[13],f=a[2]*t+a[6]*r+a[10]*i+a[14];for(let n=0;n<2;++n)u[s]=p,u[s+1]=m,u[s+2]=f,s+=c}}}const V={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...L},k=f(),I=f(),W=f(),D=f(),F=s(),X=s(),z=f(),J=f(),K=b(),Q=b(),Y=f(),Z=[s(),s(),s(),s()],$=[f(),f(),f(),f()],ee=C(),te=C(),re=C(),se=C();export{H as NativeLineMaterial};\n"]},"metadata":{},"sourceType":"module"}