{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { removeUnordered as t } from \"../../../../core/arrayUtils.js\";\nimport { TaskPriority as e } from \"../../../support/Scheduler.js\";\n\nclass r {\n  constructor(t) {\n    this.referenceCount = 0, this.callbacks = [], this.runIndex = 0, this.handle = t.registerTask(e.I3S_CONTROLLER, this);\n  }\n\n  destroy() {\n    this.handle && (this.handle.remove(), this.handle = null);\n  }\n\n  get running() {\n    for (const t of this.callbacks) if (t.needsUpdate()) return !0;\n\n    return !1;\n  }\n\n  runTask(t) {\n    this.sort();\n    const e = this.callbacks,\n          r = {\n      numIndexLoading: 0,\n      numNodesLoading: 0\n    };\n\n    for (let s = 0; s < e.length && !t.done; ++s) e[s].priority = e[s].update(t, r), this.runIndex = s;\n  }\n\n  sort() {\n    const t = this.callbacks;\n    let e = t.length;\n\n    for (let r = this.runIndex; r > 0; r--) {\n      const s = t[r - 1];\n      let n = r;\n\n      for (; n < t.length && s.priority <= t[n].priority && (n !== e || s.priority < t[n].priority);) t[n - 1] = t[n], n++;\n\n      t[n - 1] = s, e = n - 1;\n    }\n\n    this.runIndex = 0;\n  }\n\n  add(t) {\n    this.sort(), t.priority = 1 / 0, this.callbacks.unshift(t);\n  }\n\n  remove(e) {\n    t(this.callbacks, e), this.runIndex = this.callbacks.length, this.sort();\n  }\n\n}\n\nconst s = new Map();\n\nfunction n(t, e) {\n  let n = s.get(t);\n  return null == n && (n = new r(t), s.set(t, n)), n.add(e), {\n    remove: () => {\n      if (null == n) return;\n      n.remove(e);\n      n.callbacks.length > 0 || (s.delete(t), n.destroy()), n = null;\n    }\n  };\n}\n\nexport { n as addTask };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/i3s/I3SFrameTask.js"],"names":["removeUnordered","t","TaskPriority","e","r","constructor","referenceCount","callbacks","runIndex","handle","registerTask","I3S_CONTROLLER","destroy","remove","running","needsUpdate","runTask","sort","numIndexLoading","numNodesLoading","s","length","done","priority","update","n","add","unshift","Map","get","set","delete","addTask"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{removeUnordered as t}from\"../../../../core/arrayUtils.js\";import{TaskPriority as e}from\"../../../support/Scheduler.js\";class r{constructor(t){this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=t.registerTask(e.I3S_CONTROLLER,this)}destroy(){this.handle&&(this.handle.remove(),this.handle=null)}get running(){for(const t of this.callbacks)if(t.needsUpdate())return!0;return!1}runTask(t){this.sort();const e=this.callbacks,r={numIndexLoading:0,numNodesLoading:0};for(let s=0;s<e.length&&!t.done;++s)e[s].priority=e[s].update(t,r),this.runIndex=s}sort(){const t=this.callbacks;let e=t.length;for(let r=this.runIndex;r>0;r--){const s=t[r-1];let n=r;for(;n<t.length&&s.priority<=t[n].priority&&(n!==e||s.priority<t[n].priority);)t[n-1]=t[n],n++;t[n-1]=s,e=n-1}this.runIndex=0}add(t){this.sort(),t.priority=1/0,this.callbacks.unshift(t)}remove(e){t(this.callbacks,e),this.runIndex=this.callbacks.length,this.sort()}}const s=new Map;function n(t,e){let n=s.get(t);return null==n&&(n=new r(t),s.set(t,n)),n.add(e),{remove:()=>{if(null==n)return;n.remove(e);n.callbacks.length>0||(s.delete(t),n.destroy()),n=null}}}export{n as addTask};\n"]},"metadata":{},"sourceType":"module"}