{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Camera.js\";\nimport i from \"../../../Viewpoint.js\";\nimport r from \"../../../core/Accessor.js\";\nimport a from \"../../../core/Handles.js\";\nimport s from \"../../../core/Logger.js\";\nimport { isNone as n, isSome as o } from \"../../../core/maybe.js\";\nimport { addFrameTask as p } from \"../../../core/scheduling.js\";\nimport { createScreenPoint as h } from \"../../../core/screenUtils.js\";\nimport { on as c, once as l, whenOnce as m } from \"../../../core/watchUtils.js\";\nimport { property as d } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as v } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { h as u } from \"../../../chunks/vec3.js\";\nimport { d as w } from \"../../../chunks/vec3f64.js\";\nimport { s as y } from \"../../../chunks/vec4.js\";\nimport { c as f } from \"../../../chunks/vec4f64.js\";\nimport C from \"../../../geometry/Extent.js\";\nimport g from \"../../../geometry/Point.js\";\nimport { canProject as O } from \"../../../geometry/support/webMercatorUtils.js\";\nimport { applyAll as R } from \"../camera/constraintUtils.js\";\nimport { cameraOnContentAlongViewDirection as x, surfaceElevationBelowRenderLocation as b } from \"../camera/intersectionUtils.js\";\nimport T from \"./ConstraintsManager.js\";\nimport { Frustum as S } from \"./Frustum.js\";\nimport { GoToOperation as j } from \"./GoToOperation.js\";\nimport { SurfaceCollisionCorrectionController as P } from \"./controllers/SurfaceCollisionCorrectionController.js\";\nimport { internalToExternal as I, externalToInternal as _, toExtent as M, distanceToScale as B, scaleToZoom as k, fromExtent as z, getObserverForPointAtDistance as U, scaleToDistance as V, zoomToScale as E } from \"../support/cameraUtils.js\";\nimport { PropertiesPool as N } from \"../support/PropertiesPool.js\";\nimport { fromCamera as A, toCamera as H } from \"../support/viewpointUtils.js\";\nimport F from \"../webgl-engine/lib/Camera.js\";\nconst G = s.getLogger(\"esri.views.3d.state.ViewStateManager\");\nlet D = class extends r {\n  constructor(e) {\n    super(e), this.propertiesPool = new N({\n      frustum: S\n    }, this), this.handles = new a(), this.cameraSetByUser = !1, this.gotoOperation = null, this.ready = !1, this.updateDevicePixelRatio = null, this.test = {\n      contentCameraResetState: new Map()\n    };\n  }\n\n  get camera() {\n    const e = this._get(\"camera\");\n\n    if (!this.ready) return e;\n    const t = I(this.view, this.view.state.camera);\n    return t && e && t.equals(e) ? e : t;\n  }\n\n  set camera(e) {\n    this.updatePropertyBeforeReady(\"camera\", e) || this.setStateCamera(_(this.view, e), {\n      applyConstraints: !1\n    }) || G.error(\"#camera=\", \"Invalid camera\", e);\n  }\n\n  get contentCamera() {\n    const e = this._get(\"contentCamera\");\n\n    if (!this.ready) return e;\n    const t = I(this.view, this.view.state.contentCamera);\n    return t && e && t.equals(e) ? e : t;\n  }\n\n  set contentCamera(e) {\n    if (this.updatePropertyBeforeReady(\"contentCamera\", e)) return;\n\n    const t = _(this.view, e);\n\n    n(t) ? this.view.state.contentCamera = null : (this.updateElevation(t), this.view.state.contentCamera = t);\n  }\n\n  installContentCameraReset(e) {\n    if (this.handles.remove(\"contentCameraReset\"), this.test.contentCameraResetState.clear(), !this.view.state.fixedContentCamera) return !1;\n    const t = this.zoom,\n          i = this.view.state.camera.distance ** 2,\n          r = w(this.view.state.camera.center),\n          a = e.sticky ? this.contentCamera.clone() : null;\n    return this.handles.add([this.watch(\"contentCamera\", () => {\n      e.sticky || (this.handles.remove(\"contentCameraReset\"), this.test.contentCameraResetState.clear());\n    }), this.watch(\"zoom\", e => {\n      this.test.contentCameraResetState.set(\"view.zoom\", Math.abs(e - t) / 2), Math.abs(e - t) > 2 ? this.contentCamera = null : this.view.state.fixedContentCamera || (this.contentCamera = a);\n    }), this.view.state.watch(\"camera\", e => {\n      const t = u(r, e.center);\n      this.test.contentCameraResetState.set(\"camera.center\", t / i), t > i ? this.contentCamera = null : this.view.state.fixedContentCamera || (this.contentCamera = a);\n    })], \"contentCameraReset\"), !0;\n  }\n\n  get center() {\n    return this.ready ? this.view.pointsOfInterest.centerOnContent.location : this._get(\"center\");\n  }\n\n  set center(e) {\n    this.updatePropertyBeforeReady(\"center\", e) || (e ? this.isCompatible(e) ? this.setStateCamera(this.centerToCamera(e), {\n      applyConstraints: !0\n    }) ? this.view.pointsOfInterest.centerOnContent.runTask() : G.error(\"#center=\", \"Invalid center\", e) : G.error(\"#center=\", \"Center has an incompatible spatial reference (center: \" + (e.spatialReference ? e.spatialReference.wkid : \"none\") + \", view: \" + this.view.spatialReference.wkid + \")\", e) : G.error(\"#center=\", \"Center may not be null or undefined\"));\n  }\n\n  get extent() {\n    if (!this.ready) return this._get(\"extent\");\n    const e = this.view,\n          t = M(e, e.state.camera, e.pointsOfInterest.centerOnContent.renderLocation);\n    return o(t) ? t : this._get(\"extent\");\n  }\n\n  set extent(e) {\n    this.updatePropertyBeforeReady(\"extent\", e) || (e ? this.isCompatible(e) ? this.setStateCamera(this.extentToCamera(e), {\n      applyConstraints: !0\n    }) || G.error(\"#extent=\", \"Invalid extent\", e) : G.error(\"#extent=\", \"Extent has an incompatible spatial reference (extent: \" + (e.spatialReference ? e.spatialReference.wkid : \"none\") + \", view: \" + this.view.spatialReference.wkid + \")\", e) : G.error(\"#extent=\", \"Extent may not be null or undefined\"));\n  }\n\n  get frustum() {\n    const e = this.propertiesPool.get(\"frustum\");\n    return e.renderCoordsHelper = this.view.renderCoordsHelper, e.update(this.view.state.camera), e;\n  }\n\n  get hasInitialView() {\n    return !!this.view.get(\"map.initialViewProperties.viewpoint\");\n  }\n\n  get scale() {\n    if (this.ready) {\n      const e = this.view.pointsOfInterest.centerOnContent;\n      return B(this.view, e.distance, e.location.latitude);\n    }\n\n    return this._get(\"scale\");\n  }\n\n  set scale(e) {\n    this.updatePropertyBeforeReady(\"scale\", e) || this.setStateCamera(this.scaleToCamera(e), {\n      applyConstraints: !0\n    }) || G.error(\"#scale=\", \"Invalid scale\", e);\n  }\n\n  get padding() {\n    if (!this.ready) return this._get(\"padding\");\n\n    const e = this.view.state.camera,\n          t = e.padding,\n          i = e.pixelRatio,\n          r = this._get(\"padding\"),\n          a = Math.round(t[0] / i),\n          s = Math.round(t[1] / i),\n          n = Math.round(t[2] / i),\n          o = Math.round(t[3] / i);\n\n    return null != r && r.top === a && r.right === s && r.bottom === n && r.left === o ? r : {\n      top: a,\n      right: s,\n      bottom: n,\n      left: o\n    };\n  }\n\n  set padding(e) {\n    this.updatePropertyBeforeReady(\"padding\", e) || (this.paddingToArray(e, this.view.state.camera.pixelRatio, X), this.view.state.updateCamera(e => e.padding = X));\n  }\n\n  paddingToArray(e, t, i) {\n    e ? y(i, e.top || 0, e.right || 0, e.bottom || 0, e.left || 0) : y(i, 0, 0, 0, 0);\n\n    for (let r = 0; r < 4; r++) i[r] = Math.round(i[r] * t);\n  }\n\n  get screenCenter() {\n    const e = this.padding;\n    return h((this.view.width - (e.left + e.right)) / 2 + e.left, (this.view.height - (e.top + e.bottom)) / 2 + e.top);\n  }\n\n  get viewpoint() {\n    return this.ready ? A(this.view, this.camera) : this._get(\"viewpoint\");\n  }\n\n  set viewpoint(e) {\n    if (!this.updatePropertyBeforeReady(\"viewpoint\", e)) if (e) {\n      if (this.isCompatible(e)) this.setStateCamera(this.viewpointToCamera(e), {\n        applyConstraints: !e.camera\n      }) || G.error(\"#viewpoint=\", \"Invalid viewpoint\", e);else {\n        const t = o(e.camera) ? e.camera.position : e.targetGeometry,\n              i = o(t) && t.spatialReference;\n        G.error(\"#viewpoint=\", \"Viewpoint has an incompatible spatial reference (viewpoint: \" + (i ? i.wkid : \"none\") + \", view: \" + this.view.spatialReference.wkid + \")\", e);\n      }\n    } else G.error(\"#viewpoint=\", \"Viewpoint may not be null or undefined\");\n  }\n\n  get zoom() {\n    return this.ready ? k(this.view, this.scale) : this._get(\"zoom\");\n  }\n\n  set zoom(e) {\n    this.updatePropertyBeforeReady(\"zoom\", e) || this.setStateCamera(this.zoomToCamera(e), {\n      applyConstraints: !0\n    }) || G.error(\"#zoom=\", \"Invalid zoom\", e);\n  }\n\n  initialize() {\n    this.handles.add([c(this.view, \"state.events\", \"before-camera-change\", e => this.updateElevation(e.camera))]), l(this.view.state, \"camera\", e => this.updateElevation(e), !0), this.handles.add(p({\n      prepare: () => this.prepareFrame()\n    })), this.handles.add(this.view.state.watch(\"cameraController\", () => {\n      this.cameraSetByUser = !0, this.handles.remove(Y);\n    })), this.handles.add(c(this.view, \"state.events\", \"camera-projection-changed\", () => this.notifyChange(\"scale\")));\n  }\n\n  destroy() {\n    this.deinit(), this.handles && (this.handles.destroy(), this.handles = null), this.propertiesPool && (this.propertiesPool.destroy(), this.propertiesPool = null);\n  }\n\n  init() {\n    this.constraintsManager = new T({\n      view: this.view\n    }), this.prepareFrame();\n    const e = this.getInitialProperties();\n    this.cameraSetByUser = !1, this._set(\"ready\", !0);\n\n    for (const t of e) this.set(t.name, t.value);\n\n    if (!this.cameraSetByUser) {\n      const e = this.view.get(\"map.initialViewProperties.viewpoint\") || this.view.initialExtent;\n      e && this.isCompatible(e) ? this.setInitialView(e) : 2 === this.view.state.viewingMode && this.handles.add(m(this.view.basemapTerrain, \"ready\", () => {\n        this.handles.remove(Y), this.setInitialView(this.view.groundExtent);\n      }), Y);\n    }\n  }\n\n  deinit() {\n    this.cancelGoToOperation(), this.ready && (this._override(\"padding\", this.padding), this._set(\"ready\", !1), this._clearOverride(\"hasInitialView\"), this.cameraSetByUser = !1, this.handles.remove(Y), this.constraintsManager && (this.constraintsManager.destroy(), this.constraintsManager = null));\n  }\n\n  async goTo(e, t) {\n    const i = {\n      animate: !0,\n      ...t\n    };\n    return o(this.gotoOperation) && this.gotoOperation.abort(i.animate), this.gotoOperation = new j(e, i, this.view), this.view.resourceController.scheduler.stopFrame(), this.gotoOperation;\n  }\n\n  debugSetCameraOnContent() {\n    this.setStateCamera(x(this.view), {\n      applyConstraints: !1\n    });\n  }\n\n  step(e) {\n    const t = this.view.state,\n          i = t && this.view.state.cameraController;\n    i && (t.updateCamera(t => {\n      i.stepController(e, t);\n    }), i.steppingFinished && i.finishController());\n  }\n\n  cancelGoToOperation() {\n    o(this.gotoOperation) && (this.gotoOperation.abort(), this.gotoOperation = null);\n  }\n\n  getInitialProperties() {\n    const e = new Set(),\n          t = [];\n\n    for (const {\n      propertyName: i,\n      overrides: r\n    } of q) {\n      const a = e.has(i),\n            s = this._isOverridden(i);\n\n      !a && s && t.push({\n        name: i,\n        value: this._get(i)\n      }), this._clearOverride(i), (a || s) && r.forEach(t => e.add(t));\n    }\n\n    return t;\n  }\n\n  setInitialView(e) {\n    if (!e || this.cameraSetByUser) return;\n    if (e instanceof t) return void this.setStateCamera(_(this.view, e), {\n      applyConstraints: !1\n    });\n\n    if (e instanceof i) {\n      if (e.targetGeometry instanceof C) {\n        const t = z(this.view, e.targetGeometry, 0, .5, 0);\n        return void (o(t) && this.setStateCamera(_(this.view, t), {\n          applyConstraints: !0\n        }));\n      }\n\n      const t = {\n        applyConstraints: !e.camera\n      },\n            i = this.viewpointToCamera(e);\n      return void this.setStateCamera(i, t);\n    }\n\n    const r = z(this.view, e, 0, .5, 0);\n    o(r) && this.setStateCamera(_(this.view, r), {\n      applyConstraints: !0\n    });\n  }\n\n  updatePropertyBeforeReady(e, t) {\n    return !this.ready && (this._override(e, t), t && -1 !== W.indexOf(e) && this._override(\"hasInitialView\", !0), !0);\n  }\n\n  isCompatible(e) {\n    return !n(e) && (e instanceof i ? e.camera ? this.isCompatible(e.camera) : this.isCompatible(e.targetGeometry) : e instanceof t ? this.isCompatible(e.position) : e.spatialReference && O(e.spatialReference, this.view.spatialReference));\n  }\n\n  getPreservingHeadingTilt(e = J) {\n    return this.cameraSetByUser ? (e.heading = this.camera.heading, e.tilt = this.camera.tilt) : (e.heading = 0, e.tilt = .5), e;\n  }\n\n  centerPointAtDistanceToCamera(e, t, i = Q) {\n    const {\n      heading: r,\n      tilt: a\n    } = this.getPreservingHeadingTilt(),\n          s = U(this.view, r, a, e, t, 1);\n    return n(s) ? null : (i.copyFrom(this.view.state.camera), i.eye = s.eye, i.center = s.center, i.up = s.up, i);\n  }\n\n  centerToCamera(e) {\n    const t = this.view.pointsOfInterest.centerOnContent;\n    t.runTask();\n    const i = t.distance;\n    return this.centerPointAtDistanceToCamera(e, i);\n  }\n\n  extentToCamera(e) {\n    const {\n      heading: t,\n      tilt: i\n    } = this.getPreservingHeadingTilt(),\n          r = z(this.view, e, t, i, 1, K);\n    return o(r) ? _(this.view, r) : null;\n  }\n\n  scaleToCamera(e) {\n    if (null == e) return null;\n    const t = this.view.pointsOfInterest.centerOnContent;\n    t.runTask();\n    const i = t.renderLocation,\n          r = t.location.latitude,\n          a = V(this.view, e, r);\n    return this.centerPointAtDistanceToCamera(i, a);\n  }\n\n  zoomToCamera(e) {\n    return this.scaleToCamera(E(this.view, e));\n  }\n\n  viewpointToCamera(e) {\n    return _(this.view, H(this.view, e));\n  }\n\n  setStateCamera(e, t) {\n    return !(n(e) || !this.view.state.stopActiveCameraController()) && (this.cameraSetByUser = !0, t.doNotCancelGoToOperation || this.cancelGoToOperation(), this.view.state.updateCamera(i => {\n      t.positionAndOrientationOnly ? (i.eye = e.eye, i.center = e.center, i.up = e.up) : i.copyFrom(e), t.applyConstraints && R(this.view, i);\n    }), t.applyConstraints || (this.view.state.cameraController = new P({\n      view: this.view,\n      desiredCamera: e\n    })), !0);\n  }\n\n  prepareFrame() {\n    const {\n      container: e,\n      canvas: t\n    } = this.view;\n    if (!e || !t) return;\n    o(this.updateDevicePixelRatio) && this.updateDevicePixelRatio();\n    const i = this.view.pixelRatio,\n          r = Math.round(e.clientWidth * i),\n          a = Math.round(e.clientHeight * i);\n\n    if (0 !== r && 0 !== a && (t.width === r && t.height === a || (t.width = r, t.height = a), this.view.state)) {\n      const e = this.view.state.camera;\n      e.fullWidth === r && e.fullHeight === a && e.pixelRatio === i || (Q.copyFrom(e), Q.pixelRatio !== i && (this.paddingToArray(this.padding, i, X), Q.padding = X), Q.fullWidth = r, Q.fullHeight = a, Q.pixelRatio = i, this.view.state.camera = Q);\n    }\n  }\n\n  updateElevation(e) {\n    const t = this.view.basemapTerrain && this.view.basemapTerrain.spatialReference,\n          i = this.view.renderCoordsHelper.getAltitude(e.eye),\n          r = t ? b(this.view, e.eye) : 0;\n    e.relativeElevation = i - r;\n  }\n\n};\ne([d({\n  type: t,\n  dependsOn: [\"view.state.camera\", \"ready\"]\n})], D.prototype, \"camera\", null), e([d({\n  type: t,\n  dependsOn: [\"view.state.contentCamera\", \"ready\"]\n})], D.prototype, \"contentCamera\", null), e([d({\n  type: g\n})], D.prototype, \"center\", null), e([d({\n  type: C\n})], D.prototype, \"extent\", null), e([d({\n  readOnly: !0\n})], D.prototype, \"frustum\", null), e([d({\n  readOnly: !0\n})], D.prototype, \"hasInitialView\", null), e([d({\n  readOnly: !0,\n  type: Boolean\n})], D.prototype, \"ready\", void 0), e([d({\n  type: Number\n})], D.prototype, \"scale\", null), e([d()], D.prototype, \"padding\", null), e([d({\n  readOnly: !0\n})], D.prototype, \"screenCenter\", null), e([d({\n  constructOnly: !0\n})], D.prototype, \"view\", void 0), e([d({\n  type: i\n})], D.prototype, \"viewpoint\", null), e([d({\n  type: Number\n})], D.prototype, \"zoom\", null), e([d({\n  constructOnly: !0\n})], D.prototype, \"updateDevicePixelRatio\", void 0), D = e([v(\"esri.views.3d.state.ViewStateManager\")], D);\nvar L = D;\nconst W = [\"camera\", \"viewpoint\", \"extent\", \"scale\", \"center\", \"zoom\"],\n      q = [{\n  propertyName: \"camera\",\n  overrides: [\"viewpoint\"]\n}, {\n  propertyName: \"viewpoint\",\n  overrides: [\"extent\"]\n}, {\n  propertyName: \"extent\",\n  overrides: [\"center\", \"scale\"]\n}, {\n  propertyName: \"center\",\n  overrides: []\n}, {\n  propertyName: \"scale\",\n  overrides: [\"zoom\"]\n}, {\n  propertyName: \"zoom\",\n  overrides: []\n}, {\n  propertyName: \"padding\",\n  overrides: []\n}],\n      J = {\n  heading: 0,\n  tilt: 0\n},\n      K = new t(),\n      Q = new F(),\n      X = f(),\n      Y = \"pending-initial-view\";\nexport default L;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/state/ViewStateManager.js"],"names":["_","e","t","i","r","a","s","isNone","n","isSome","o","addFrameTask","p","createScreenPoint","h","on","c","once","l","whenOnce","m","property","d","subclass","v","u","w","y","f","C","g","canProject","O","applyAll","R","cameraOnContentAlongViewDirection","x","surfaceElevationBelowRenderLocation","b","T","Frustum","S","GoToOperation","j","SurfaceCollisionCorrectionController","P","internalToExternal","I","externalToInternal","toExtent","M","distanceToScale","B","scaleToZoom","k","fromExtent","z","getObserverForPointAtDistance","U","scaleToDistance","V","zoomToScale","E","PropertiesPool","N","fromCamera","A","toCamera","H","F","G","getLogger","D","constructor","propertiesPool","frustum","handles","cameraSetByUser","gotoOperation","ready","updateDevicePixelRatio","test","contentCameraResetState","Map","camera","_get","view","state","equals","updatePropertyBeforeReady","setStateCamera","applyConstraints","error","contentCamera","updateElevation","installContentCameraReset","remove","clear","fixedContentCamera","zoom","distance","center","sticky","clone","add","watch","set","Math","abs","pointsOfInterest","centerOnContent","location","isCompatible","centerToCamera","runTask","spatialReference","wkid","extent","renderLocation","extentToCamera","get","renderCoordsHelper","update","hasInitialView","scale","latitude","scaleToCamera","padding","pixelRatio","round","top","right","bottom","left","paddingToArray","X","updateCamera","screenCenter","width","height","viewpoint","viewpointToCamera","position","targetGeometry","zoomToCamera","initialize","prepare","prepareFrame","Y","notifyChange","destroy","deinit","init","constraintsManager","getInitialProperties","_set","name","value","initialExtent","setInitialView","viewingMode","basemapTerrain","groundExtent","cancelGoToOperation","_override","_clearOverride","goTo","animate","abort","resourceController","scheduler","stopFrame","debugSetCameraOnContent","step","cameraController","stepController","steppingFinished","finishController","Set","propertyName","overrides","q","has","_isOverridden","push","forEach","W","indexOf","getPreservingHeadingTilt","J","heading","tilt","centerPointAtDistanceToCamera","Q","copyFrom","eye","up","K","stopActiveCameraController","doNotCancelGoToOperation","positionAndOrientationOnly","desiredCamera","container","canvas","clientWidth","clientHeight","fullWidth","fullHeight","getAltitude","relativeElevation","type","dependsOn","prototype","readOnly","Boolean","Number","constructOnly","L"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Camera.js\";import i from\"../../../Viewpoint.js\";import r from\"../../../core/Accessor.js\";import a from\"../../../core/Handles.js\";import s from\"../../../core/Logger.js\";import{isNone as n,isSome as o}from\"../../../core/maybe.js\";import{addFrameTask as p}from\"../../../core/scheduling.js\";import{createScreenPoint as h}from\"../../../core/screenUtils.js\";import{on as c,once as l,whenOnce as m}from\"../../../core/watchUtils.js\";import{property as d}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as v}from\"../../../core/accessorSupport/decorators/subclass.js\";import{h as u}from\"../../../chunks/vec3.js\";import{d as w}from\"../../../chunks/vec3f64.js\";import{s as y}from\"../../../chunks/vec4.js\";import{c as f}from\"../../../chunks/vec4f64.js\";import C from\"../../../geometry/Extent.js\";import g from\"../../../geometry/Point.js\";import{canProject as O}from\"../../../geometry/support/webMercatorUtils.js\";import{applyAll as R}from\"../camera/constraintUtils.js\";import{cameraOnContentAlongViewDirection as x,surfaceElevationBelowRenderLocation as b}from\"../camera/intersectionUtils.js\";import T from\"./ConstraintsManager.js\";import{Frustum as S}from\"./Frustum.js\";import{GoToOperation as j}from\"./GoToOperation.js\";import{SurfaceCollisionCorrectionController as P}from\"./controllers/SurfaceCollisionCorrectionController.js\";import{internalToExternal as I,externalToInternal as _,toExtent as M,distanceToScale as B,scaleToZoom as k,fromExtent as z,getObserverForPointAtDistance as U,scaleToDistance as V,zoomToScale as E}from\"../support/cameraUtils.js\";import{PropertiesPool as N}from\"../support/PropertiesPool.js\";import{fromCamera as A,toCamera as H}from\"../support/viewpointUtils.js\";import F from\"../webgl-engine/lib/Camera.js\";const G=s.getLogger(\"esri.views.3d.state.ViewStateManager\");let D=class extends r{constructor(e){super(e),this.propertiesPool=new N({frustum:S},this),this.handles=new a,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this.updateDevicePixelRatio=null,this.test={contentCameraResetState:new Map}}get camera(){const e=this._get(\"camera\");if(!this.ready)return e;const t=I(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this.updatePropertyBeforeReady(\"camera\",e)||this.setStateCamera(_(this.view,e),{applyConstraints:!1})||G.error(\"#camera=\",\"Invalid camera\",e)}get contentCamera(){const e=this._get(\"contentCamera\");if(!this.ready)return e;const t=I(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this.updatePropertyBeforeReady(\"contentCamera\",e))return;const t=_(this.view,e);n(t)?this.view.state.contentCamera=null:(this.updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove(\"contentCameraReset\"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=w(this.view.state.camera.center),a=e.sticky?this.contentCamera.clone():null;return this.handles.add([this.watch(\"contentCamera\",(()=>{e.sticky||(this.handles.remove(\"contentCameraReset\"),this.test.contentCameraResetState.clear())})),this.watch(\"zoom\",(e=>{this.test.contentCameraResetState.set(\"view.zoom\",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=a)})),this.view.state.watch(\"camera\",(e=>{const t=u(r,e.center);this.test.contentCameraResetState.set(\"camera.center\",t/i),t>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=a)}))],\"contentCameraReset\"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get(\"center\")}set center(e){this.updatePropertyBeforeReady(\"center\",e)||(e?this.isCompatible(e)?this.setStateCamera(this.centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():G.error(\"#center=\",\"Invalid center\",e):G.error(\"#center=\",\"Center has an incompatible spatial reference (center: \"+(e.spatialReference?e.spatialReference.wkid:\"none\")+\", view: \"+this.view.spatialReference.wkid+\")\",e):G.error(\"#center=\",\"Center may not be null or undefined\"))}get extent(){if(!this.ready)return this._get(\"extent\");const e=this.view,t=M(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return o(t)?t:this._get(\"extent\")}set extent(e){this.updatePropertyBeforeReady(\"extent\",e)||(e?this.isCompatible(e)?this.setStateCamera(this.extentToCamera(e),{applyConstraints:!0})||G.error(\"#extent=\",\"Invalid extent\",e):G.error(\"#extent=\",\"Extent has an incompatible spatial reference (extent: \"+(e.spatialReference?e.spatialReference.wkid:\"none\")+\", view: \"+this.view.spatialReference.wkid+\")\",e):G.error(\"#extent=\",\"Extent may not be null or undefined\"))}get frustum(){const e=this.propertiesPool.get(\"frustum\");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get(\"map.initialViewProperties.viewpoint\")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return B(this.view,e.distance,e.location.latitude)}return this._get(\"scale\")}set scale(e){this.updatePropertyBeforeReady(\"scale\",e)||this.setStateCamera(this.scaleToCamera(e),{applyConstraints:!0})||G.error(\"#scale=\",\"Invalid scale\",e)}get padding(){if(!this.ready)return this._get(\"padding\");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get(\"padding\"),a=Math.round(t[0]/i),s=Math.round(t[1]/i),n=Math.round(t[2]/i),o=Math.round(t[3]/i);return null!=r&&r.top===a&&r.right===s&&r.bottom===n&&r.left===o?r:{top:a,right:s,bottom:n,left:o}}set padding(e){this.updatePropertyBeforeReady(\"padding\",e)||(this.paddingToArray(e,this.view.state.camera.pixelRatio,X),this.view.state.updateCamera((e=>e.padding=X)))}paddingToArray(e,t,i){e?y(i,e.top||0,e.right||0,e.bottom||0,e.left||0):y(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return h((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?A(this.view,this.camera):this._get(\"viewpoint\")}set viewpoint(e){if(!this.updatePropertyBeforeReady(\"viewpoint\",e))if(e)if(this.isCompatible(e))this.setStateCamera(this.viewpointToCamera(e),{applyConstraints:!e.camera})||G.error(\"#viewpoint=\",\"Invalid viewpoint\",e);else{const t=o(e.camera)?e.camera.position:e.targetGeometry,i=o(t)&&t.spatialReference;G.error(\"#viewpoint=\",\"Viewpoint has an incompatible spatial reference (viewpoint: \"+(i?i.wkid:\"none\")+\", view: \"+this.view.spatialReference.wkid+\")\",e)}else G.error(\"#viewpoint=\",\"Viewpoint may not be null or undefined\")}get zoom(){return this.ready?k(this.view,this.scale):this._get(\"zoom\")}set zoom(e){this.updatePropertyBeforeReady(\"zoom\",e)||this.setStateCamera(this.zoomToCamera(e),{applyConstraints:!0})||G.error(\"#zoom=\",\"Invalid zoom\",e)}initialize(){this.handles.add([c(this.view,\"state.events\",\"before-camera-change\",(e=>this.updateElevation(e.camera)))]),l(this.view.state,\"camera\",(e=>this.updateElevation(e)),!0),this.handles.add(p({prepare:()=>this.prepareFrame()})),this.handles.add(this.view.state.watch(\"cameraController\",(()=>{this.cameraSetByUser=!0,this.handles.remove(Y)}))),this.handles.add(c(this.view,\"state.events\",\"camera-projection-changed\",(()=>this.notifyChange(\"scale\"))))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new T({view:this.view}),this.prepareFrame();const e=this.getInitialProperties();this.cameraSetByUser=!1,this._set(\"ready\",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const e=this.view.get(\"map.initialViewProperties.viewpoint\")||this.view.initialExtent;e&&this.isCompatible(e)?this.setInitialView(e):2===this.view.state.viewingMode&&this.handles.add(m(this.view.basemapTerrain,\"ready\",(()=>{this.handles.remove(Y),this.setInitialView(this.view.groundExtent)})),Y)}}deinit(){this.cancelGoToOperation(),this.ready&&(this._override(\"padding\",this.padding),this._set(\"ready\",!1),this._clearOverride(\"hasInitialView\"),this.cameraSetByUser=!1,this.handles.remove(Y),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i={animate:!0,...t};return o(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new j(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(x(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera((t=>{i.stepController(e,t)})),i.steppingFinished&&i.finishController())}cancelGoToOperation(){o(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of q){const a=e.has(i),s=this._isOverridden(i);!a&&s&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(a||s)&&r.forEach((t=>e.add(t)))}return t}setInitialView(e){if(!e||this.cameraSetByUser)return;if(e instanceof t)return void this.setStateCamera(_(this.view,e),{applyConstraints:!1});if(e instanceof i){if(e.targetGeometry instanceof C){const t=z(this.view,e.targetGeometry,0,.5,0);return void(o(t)&&this.setStateCamera(_(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},i=this.viewpointToCamera(e);return void this.setStateCamera(i,t)}const r=z(this.view,e,0,.5,0);o(r)&&this.setStateCamera(_(this.view,r),{applyConstraints:!0})}updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&-1!==W.indexOf(e)&&this._override(\"hasInitialView\",!0),!0)}isCompatible(e){return!n(e)&&(e instanceof i?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof t?this.isCompatible(e.position):e.spatialReference&&O(e.spatialReference,this.view.spatialReference))}getPreservingHeadingTilt(e=J){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}centerPointAtDistanceToCamera(e,t,i=Q){const{heading:r,tilt:a}=this.getPreservingHeadingTilt(),s=U(this.view,r,a,e,t,1);return n(s)?null:(i.copyFrom(this.view.state.camera),i.eye=s.eye,i.center=s.center,i.up=s.up,i)}centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this.centerPointAtDistanceToCamera(e,i)}extentToCamera(e){const{heading:t,tilt:i}=this.getPreservingHeadingTilt(),r=z(this.view,e,t,i,1,K);return o(r)?_(this.view,r):null}scaleToCamera(e){if(null==e)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,a=V(this.view,e,r);return this.centerPointAtDistanceToCamera(i,a)}zoomToCamera(e){return this.scaleToCamera(E(this.view,e))}viewpointToCamera(e){return _(this.view,H(this.view,e))}setStateCamera(e,t){return!(n(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this.cancelGoToOperation(),this.view.state.updateCamera((i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&R(this.view,i)})),t.applyConstraints||(this.view.state.cameraController=new P({view:this.view,desiredCamera:e})),!0)}prepareFrame(){const{container:e,canvas:t}=this.view;if(!e||!t)return;o(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();const i=this.view.pixelRatio,r=Math.round(e.clientWidth*i),a=Math.round(e.clientHeight*i);if(0!==r&&0!==a&&(t.width===r&&t.height===a||(t.width=r,t.height=a),this.view.state)){const e=this.view.state.camera;e.fullWidth===r&&e.fullHeight===a&&e.pixelRatio===i||(Q.copyFrom(e),Q.pixelRatio!==i&&(this.paddingToArray(this.padding,i,X),Q.padding=X),Q.fullWidth=r,Q.fullHeight=a,Q.pixelRatio=i,this.view.state.camera=Q)}}updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?b(this.view,e.eye):0;e.relativeElevation=i-r}};e([d({type:t,dependsOn:[\"view.state.camera\",\"ready\"]})],D.prototype,\"camera\",null),e([d({type:t,dependsOn:[\"view.state.contentCamera\",\"ready\"]})],D.prototype,\"contentCamera\",null),e([d({type:g})],D.prototype,\"center\",null),e([d({type:C})],D.prototype,\"extent\",null),e([d({readOnly:!0})],D.prototype,\"frustum\",null),e([d({readOnly:!0})],D.prototype,\"hasInitialView\",null),e([d({readOnly:!0,type:Boolean})],D.prototype,\"ready\",void 0),e([d({type:Number})],D.prototype,\"scale\",null),e([d()],D.prototype,\"padding\",null),e([d({readOnly:!0})],D.prototype,\"screenCenter\",null),e([d({constructOnly:!0})],D.prototype,\"view\",void 0),e([d({type:i})],D.prototype,\"viewpoint\",null),e([d({type:Number})],D.prototype,\"zoom\",null),e([d({constructOnly:!0})],D.prototype,\"updateDevicePixelRatio\",void 0),D=e([v(\"esri.views.3d.state.ViewStateManager\")],D);var L=D;const W=[\"camera\",\"viewpoint\",\"extent\",\"scale\",\"center\",\"zoom\"],q=[{propertyName:\"camera\",overrides:[\"viewpoint\"]},{propertyName:\"viewpoint\",overrides:[\"extent\"]},{propertyName:\"extent\",overrides:[\"center\",\"scale\"]},{propertyName:\"center\",overrides:[]},{propertyName:\"scale\",overrides:[\"zoom\"]},{propertyName:\"zoom\",overrides:[]},{propertyName:\"padding\",overrides:[]}],J={heading:0,tilt:0},K=new t,Q=new F,X=f(),Y=\"pending-initial-view\";export default L;\n"]},"metadata":{},"sourceType":"module"}