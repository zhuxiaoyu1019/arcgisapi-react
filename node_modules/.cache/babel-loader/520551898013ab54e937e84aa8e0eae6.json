{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport i from \"../../core/Collection.js\";\nimport { referenceSetter as s, castForReferenceSetter as r } from \"../../core/collectionUtils.js\";\nimport { property as t } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport \"../../core/Logger.js\";\nimport { subclass as a } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport l from \"./LayerView.js\";\nlet o = class extends l {\n  constructor(e) {\n    super(e), this.type = \"group\", this.layerViews = new i();\n  }\n\n  initialize() {\n    this.handles.add([this.layerViews.on(\"change\", e => this._layerViewsChangeHandler(e)), this.layerViews.on(\"after-changes\", () => this._layerViewsAfterChangesHandler()), this.layer.watch(\"visibilityMode\", () => this._visibilityModeHandler(), !0), this.watch(\"visible\", () => this._visibleHandler(), !0)], \"grouplayerview\"), this._layerViewsChangeHandler({\n      target: null,\n      added: this.layerViews.toArray(),\n      removed: [],\n      moved: []\n    }), this._layerViewsAfterChangesHandler();\n  }\n\n  set layerViews(e) {\n    this._set(\"layerViews\", s(e, this._get(\"layerViews\")));\n  }\n\n  isUpdating() {\n    return this.layerViews.some(e => e.updating);\n  }\n\n  get updatingProgress() {\n    return 0 === this.layerViews.length ? 1 : this.layerViews.reduce((e, i) => e + i.updatingProgress, 0) / this.layerViews.length;\n  }\n\n  _hasLayerViewVisibleOverrides() {\n    return this.layerViews.some(e => e._isOverridden(\"visible\"));\n  }\n\n  _findLayerViewForLayer(e) {\n    return e && this.layerViews.find(i => i.layer === e);\n  }\n\n  _firstVisibleOnLayerOrder() {\n    const e = this.layer.layers.find(e => {\n      const i = this._findLayerViewForLayer(e);\n\n      return i && i.visible;\n    });\n    return e && this._findLayerViewForLayer(e);\n  }\n\n  _enforceExclusiveVisibility(e) {\n    this._hasLayerViewVisibleOverrides() && (e || !(e = this._firstVisibleOnLayerOrder()) && this.layerViews.length > 0 && (e = this._findLayerViewForLayer(this.layer.layers.getItemAt(0))), this.layerViews.forEach(i => {\n      i.visible = i === e;\n    }));\n  }\n\n  _layerViewsChangeHandler(e) {\n    this.handles.remove(\"grouplayerview:visible\"), this.handles.add(this.layerViews.map(e => e.watch(\"visible\", i => this._layerViewVisibleHandler(i, e), !0)).toArray(), \"grouplayerview:visible\");\n    const i = e.added[e.added.length - 1];\n    let s = null;\n    i && i.visible && (s = i), this._enforceVisibility(s);\n  }\n\n  _layerViewsAfterChangesHandler() {\n    this.handles.remove(\"grouplayerview:updating\"), this.handles.add(this.layerViews.map(e => e.watch(\"updating\", () => this._updateUpdating(), !0)).toArray(), \"grouplayerview:updating\"), this._updateUpdating();\n  }\n\n  _enforceVisibility(e) {\n    if (this._hasLayerViewVisibleOverrides()) switch (this.layer.visibilityMode) {\n      case \"inherited\":\n        {\n          const e = this.visible;\n          this.layerViews.forEach(i => {\n            i.visible = e;\n          });\n          break;\n        }\n\n      case \"exclusive\":\n        this._enforceExclusiveVisibility(e);\n\n    }\n  }\n\n  _visibilityModeHandler() {\n    this._enforceVisibility();\n  }\n\n  _layerViewVisibleHandler(e, i) {\n    if (this._hasLayerViewVisibleOverrides()) switch (this.layer.visibilityMode) {\n      case \"inherited\":\n        e !== this.visible && (i.visible = this.visible);\n        break;\n\n      case \"exclusive\":\n        this._enforceExclusiveVisibility(e && i);\n\n    }\n  }\n\n  _visibleHandler() {\n    var e;\n    this._hasLayerViewVisibleOverrides() && \"inherited\" === (null == (e = this.layer) ? void 0 : e.visibilityMode) && this._enforceVisibility();\n  }\n\n  _updateUpdating() {\n    this.notifyChange(\"updating\");\n  }\n\n};\ne([t({\n  cast: r\n})], o.prototype, \"layerViews\", null), e([t()], o.prototype, \"view\", void 0), e([t({\n  readOnly: !0\n})], o.prototype, \"updatingProgress\", null), o = e([a(\"esri.views.layers.GroupLayerView\")], o);\nvar h = o;\nexport default h;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/layers/GroupLayerView.js"],"names":["_","e","i","referenceSetter","s","castForReferenceSetter","r","property","t","subclass","a","l","o","constructor","type","layerViews","initialize","handles","add","on","_layerViewsChangeHandler","_layerViewsAfterChangesHandler","layer","watch","_visibilityModeHandler","_visibleHandler","target","added","toArray","removed","moved","_set","_get","isUpdating","some","updating","updatingProgress","length","reduce","_hasLayerViewVisibleOverrides","_isOverridden","_findLayerViewForLayer","find","_firstVisibleOnLayerOrder","layers","visible","_enforceExclusiveVisibility","getItemAt","forEach","remove","map","_layerViewVisibleHandler","_enforceVisibility","_updateUpdating","visibilityMode","notifyChange","cast","prototype","readOnly","h"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import i from\"../../core/Collection.js\";import{referenceSetter as s,castForReferenceSetter as r}from\"../../core/collectionUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import l from\"./LayerView.js\";let o=class extends l{constructor(e){super(e),this.type=\"group\",this.layerViews=new i}initialize(){this.handles.add([this.layerViews.on(\"change\",(e=>this._layerViewsChangeHandler(e))),this.layerViews.on(\"after-changes\",(()=>this._layerViewsAfterChangesHandler())),this.layer.watch(\"visibilityMode\",(()=>this._visibilityModeHandler()),!0),this.watch(\"visible\",(()=>this._visibleHandler()),!0)],\"grouplayerview\"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]}),this._layerViewsAfterChangesHandler()}set layerViews(e){this._set(\"layerViews\",s(e,this._get(\"layerViews\")))}isUpdating(){return this.layerViews.some((e=>e.updating))}get updatingProgress(){return 0===this.layerViews.length?1:this.layerViews.reduce(((e,i)=>e+i.updatingProgress),0)/this.layerViews.length}_hasLayerViewVisibleOverrides(){return this.layerViews.some((e=>e._isOverridden(\"visible\")))}_findLayerViewForLayer(e){return e&&this.layerViews.find((i=>i.layer===e))}_firstVisibleOnLayerOrder(){const e=this.layer.layers.find((e=>{const i=this._findLayerViewForLayer(e);return i&&i.visible}));return e&&this._findLayerViewForLayer(e)}_enforceExclusiveVisibility(e){this._hasLayerViewVisibleOverrides()&&(e||!(e=this._firstVisibleOnLayerOrder())&&this.layerViews.length>0&&(e=this._findLayerViewForLayer(this.layer.layers.getItemAt(0))),this.layerViews.forEach((i=>{i.visible=i===e})))}_layerViewsChangeHandler(e){this.handles.remove(\"grouplayerview:visible\"),this.handles.add(this.layerViews.map((e=>e.watch(\"visible\",(i=>this._layerViewVisibleHandler(i,e)),!0))).toArray(),\"grouplayerview:visible\");const i=e.added[e.added.length-1];let s=null;i&&i.visible&&(s=i),this._enforceVisibility(s)}_layerViewsAfterChangesHandler(){this.handles.remove(\"grouplayerview:updating\"),this.handles.add(this.layerViews.map((e=>e.watch(\"updating\",(()=>this._updateUpdating()),!0))).toArray(),\"grouplayerview:updating\"),this._updateUpdating()}_enforceVisibility(e){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case\"inherited\":{const e=this.visible;this.layerViews.forEach((i=>{i.visible=e}));break}case\"exclusive\":this._enforceExclusiveVisibility(e)}}_visibilityModeHandler(){this._enforceVisibility()}_layerViewVisibleHandler(e,i){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case\"inherited\":e!==this.visible&&(i.visible=this.visible);break;case\"exclusive\":this._enforceExclusiveVisibility(e&&i)}}_visibleHandler(){var e;this._hasLayerViewVisibleOverrides()&&\"inherited\"===(null==(e=this.layer)?void 0:e.visibilityMode)&&this._enforceVisibility()}_updateUpdating(){this.notifyChange(\"updating\")}};e([t({cast:r})],o.prototype,\"layerViews\",null),e([t()],o.prototype,\"view\",void 0),e([t({readOnly:!0})],o.prototype,\"updatingProgress\",null),o=e([a(\"esri.views.layers.GroupLayerView\")],o);var h=o;export default h;\n"]},"metadata":{},"sourceType":"module"}