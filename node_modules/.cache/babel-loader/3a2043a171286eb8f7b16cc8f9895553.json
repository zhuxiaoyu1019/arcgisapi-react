{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { p as t, w as i } from \"../../../../../chunks/vec3.js\";\nimport { f as e, c as n } from \"../../../../../chunks/vec3f64.js\";\nimport { fromValues as r } from \"../../../../../geometry/support/aaBoundingBox.js\";\nimport { computeNormal as s } from \"../../materials/internal/MaterialUtil.js\";\nconst o = 40,\n      a = 20,\n      c = .8,\n      f = 15,\n      h = 1e-6;\n\nfunction u(t, i, e) {\n  const n = i,\n        r = e;\n  let s = 0,\n      o = 1 / 0;\n\n  for (let a = 0; a < 3; ++a) {\n    {\n      const i = t[a];\n\n      if (n[a] < i) {\n        if (r[a] <= h) return !1;\n        const t = (i - n[a]) / r[a];\n        s = Math.max(s, t);\n      } else if (r[a] <= -h) {\n        const t = (i - n[a]) / r[a];\n        o = Math.min(o, t);\n      }\n\n      if (s >= o) return !1;\n    }\n    {\n      const i = t[a + 3];\n\n      if (n[a] > i) {\n        if (r[a] >= -h) return !1;\n        const t = (i - n[a]) / r[a];\n        s = Math.max(s, t);\n      } else if (r[a] >= h) {\n        const t = (i - n[a]) / r[a];\n        o = Math.min(o, t);\n      }\n\n      if (s >= o) return !1;\n    }\n  }\n\n  return !0;\n}\n\nclass l {\n  constructor(t, i, e, n, r) {\n    this.aabb = t, this.axis = i, this.d = e, this.midStartIndex = n, this.rightStartIndex = r;\n  }\n\n}\n\nclass d {\n  constructor(t, i, e, n) {\n    this.globalTriangleVertexIndices = t, this.firstTriangleIndex = i, this.positionAttribute = n, this.bspNodeTree = new Array(), this.vertexPositionBuffer = n.data, this.vertexPositionStride = n.stride;\n    const r = e - i,\n          s = r <= R ? new Uint16Array(r) : new Uint32Array(r);\n    this.indices = s;\n\n    for (let o = 0; o < r; ++o) s[o] = o;\n\n    {\n      const o = T(t, i, e, n.data, n.stride),\n            h = (t, i, e) => {\n        const n = p(s, o, t, i),\n              r = i - t;\n\n        if (r <= a) {\n          const e = new l(n, void 0, 0, t, i);\n          return this.bspNodeTree.push(e), e;\n        }\n\n        const {\n          axis: u,\n          midValue: d\n        } = b(n),\n              m = N(s, o, t, i, u, d),\n              x = (t, i) => {\n          if (e > f) return;\n          const n = i - t;\n          return n < a || n >= c * r ? void 0 : h(t, i, e + 1);\n        },\n              g = new l(n, u, d, m.next, m.mid);\n\n        return this.bspNodeTree.push(g), g.leftNode = x(t, m.next), g.rightNode = x(m.mid, i), g;\n      };\n\n      h(0, r, 0), this.triangleVertexIndices = I(s, t, i, e);\n    }\n  }\n\n  intersectRayTriangleRange(t, i) {\n    {\n      if (t >= i) return;\n      const e = this.triangleVertexIndices,\n            n = this.positionAttribute.data,\n            r = this.positionAttribute.stride,\n            o = this.rayOrigin,\n            a = o[0],\n            c = o[1],\n            f = o[2],\n            h = this.rayDirection,\n            u = h[0],\n            l = h[1],\n            d = h[2];\n\n      for (let m = t, g = 3 * t; m < i; ++m) {\n        const t = e[g] * r,\n              i = n[t],\n              o = n[t + 1],\n              h = n[t + 2],\n              y = e[g + 1] * r,\n              N = n[y],\n              p = n[y + 1],\n              b = n[y + 2],\n              T = e[g + 2] * r,\n              I = n[T],\n              R = n[T + 1],\n              S = n[T + 2];\n        g += 3;\n        const M = N - i,\n              w = p - o,\n              A = b - h,\n              v = I - i,\n              B = R - o,\n              P = S - h,\n              V = l * P - B * d,\n              U = d * v - P * u,\n              j = u * B - v * l,\n              k = M * V + w * U + A * j;\n        if (Math.abs(k) <= Number.EPSILON) continue;\n        const F = a - i,\n              O = c - o,\n              D = f - h,\n              E = F * V + O * U + D * j;\n\n        if (k > 0) {\n          if (E < 0 || E > k) continue;\n        } else if (E > 0 || E < k) continue;\n\n        const L = O * A - w * D,\n              q = D * M - A * F,\n              z = F * w - M * O,\n              C = u * L + l * q + d * z;\n\n        if (k > 0) {\n          if (C < 0 || E + C > k) continue;\n        } else if (C > 0 || E + C < k) continue;\n\n        const G = (v * L + B * q + P * z) / k;\n\n        if (G >= 0) {\n          const t = this.indices[m] + this.firstTriangleIndex,\n                i = s(M, w, A, v, B, P, x);\n          this.callback(G, i, t);\n        }\n      }\n    }\n    d.numFacesTested += i - t;\n  }\n\n  intersectRay(i, n) {\n    d.numFacesTested = 0;\n    const r = e(i.r0[0], i.r0[1], i.r0[2]),\n          s = m(e(i.r1[0], i.r1[1], i.r1[2]), r);\n    if (t(s) < h) return;\n    this.rayOrigin = r, this.rayDirection = s;\n    const o = this.triangleVertexIndices.length / 3;\n    this.callback = n;\n    const a = this.bspNodeTree[0];\n    this.intersectRayBSP(a, 0, o);\n  }\n\n  intersectRayBSP(t, i, e) {\n    const n = this.rayOrigin,\n          r = this.rayDirection;\n    if (!u(t.aabb, n, r)) return;\n    const s = t.axis,\n          o = t.d;\n\n    if (n[s] < o || r[s] < 0) {\n      const e = i,\n            n = t.midStartIndex;\n\n      if (e < n) {\n        const i = t.leftNode;\n        void 0 !== i ? this.intersectRayBSP(i, e, n) : this.intersectRayTriangleRange(e, n);\n      }\n    }\n\n    if (this.intersectRayTriangleRange(t.midStartIndex, t.rightStartIndex), n[s] > o || r[s] > 0) {\n      const i = t.rightStartIndex,\n            n = e;\n\n      if (i < n) {\n        const e = t.rightNode;\n        void 0 !== e ? this.intersectRayBSP(e, i, n) : this.intersectRayTriangleRange(i, n);\n      }\n    }\n  }\n\n}\n\nfunction m(t, e) {\n  const r = n();\n  return i(r, t, e), r;\n}\n\nd.numFacesTested = 0;\nconst x = n(),\n      g = e(1 / 0, 1 / 0, 1 / 0),\n      y = e(-1 / 0, -1 / 0, -1 / 0);\n\nfunction N(t, i, e, n, r, s) {\n  let o = e,\n      a = n;\n\n  for (; o < a;) {\n    const e = t[o];\n    i[6 * e + r + 3] <= s ? ++o : (--a, t[o] = t[a], t[a] = e);\n  }\n\n  let c = o;\n\n  for (a = n; c < a;) {\n    const e = t[a - 1];\n    i[6 * e + r] >= s ? --a : (t[a - 1] = t[c], t[c] = e, ++c);\n  }\n\n  return {\n    next: o,\n    mid: c\n  };\n}\n\nfunction p(t, i, e, n) {\n  if (n <= e) return r(NaN, NaN, NaN, NaN, NaN, NaN);\n  {\n    const n = 6 * t[e];\n\n    for (let t = 0; t < 3; ++t) g[t] = i[n + 0 + t], y[t] = i[n + 3 + t];\n  }\n\n  for (let r = e + 1; r < n; ++r) {\n    const e = 6 * t[r];\n\n    for (let t = 0; t < 3; ++t) g[t] = Math.min(g[t], i[e + 0 + t]), y[t] = Math.max(y[t], i[e + 3 + t]);\n  }\n\n  return r(g[0], g[1], g[2], y[0], y[1], y[2]);\n}\n\nfunction b(t) {\n  const i = t[3] - t[0],\n        e = t[4] - t[1],\n        n = t[5] - t[2],\n        r = i > e ? i > n ? 0 : e > n ? 1 : 2 : e > n ? 1 : n > i ? 2 : 0;\n  return {\n    axis: r,\n    midValue: (t[r] + t[r + 3]) / 2\n  };\n}\n\nfunction T(t, i, e, n, r) {\n  const s = e - i,\n        o = new Float32Array(6 * s);\n\n  for (let a = 0; a < s; ++a) {\n    const e = 3 * (a + i),\n          s = t[e + 0] * r,\n          c = t[e + 1] * r,\n          f = t[e + 2] * r;\n\n    for (let t = 0; t < 3; ++t) {\n      const i = n[s + t],\n            e = n[c + t],\n            r = n[f + t];\n      o[6 * a + t] = Math.min(i, e, r), o[6 * a + 3 + t] = Math.max(i, e, r);\n    }\n  }\n\n  return o;\n}\n\nfunction I(t, i, e, n) {\n  const r = n - e;\n  let s = 0;\n\n  for (let a = e; a < n; ++a) for (let t = 0; t < 3; ++t) s = Math.max(i[3 * a + t], s);\n\n  const o = s <= R ? new Uint16Array(3 * r) : new Uint32Array(3 * r);\n\n  for (let a = 0; a < r; ++a) {\n    const n = 3 * (t[a] + e);\n\n    for (let t = 0; t < 3; ++t) {\n      const e = i[n + t];\n      o[3 * a + t] = e;\n    }\n  }\n\n  return o;\n}\n\nconst R = 65535;\nexport { d as ComponentIntersectionData, o as componentMinimalSizeForIntersectionData };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentIntersectionData.js"],"names":["p","t","w","i","f","e","c","n","fromValues","r","computeNormal","s","o","a","h","u","Math","max","min","l","constructor","aabb","axis","d","midStartIndex","rightStartIndex","globalTriangleVertexIndices","firstTriangleIndex","positionAttribute","bspNodeTree","Array","vertexPositionBuffer","data","vertexPositionStride","stride","R","Uint16Array","Uint32Array","indices","T","push","midValue","b","m","N","x","g","next","mid","leftNode","rightNode","triangleVertexIndices","I","intersectRayTriangleRange","rayOrigin","rayDirection","y","S","M","A","v","B","P","V","U","j","k","abs","Number","EPSILON","F","O","D","E","L","q","z","C","G","callback","numFacesTested","intersectRay","r0","r1","length","intersectRayBSP","NaN","Float32Array","ComponentIntersectionData","componentMinimalSizeForIntersectionData"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{p as t,w as i}from\"../../../../../chunks/vec3.js\";import{f as e,c as n}from\"../../../../../chunks/vec3f64.js\";import{fromValues as r}from\"../../../../../geometry/support/aaBoundingBox.js\";import{computeNormal as s}from\"../../materials/internal/MaterialUtil.js\";const o=40,a=20,c=.8,f=15,h=1e-6;function u(t,i,e){const n=i,r=e;let s=0,o=1/0;for(let a=0;a<3;++a){{const i=t[a];if(n[a]<i){if(r[a]<=h)return!1;const t=(i-n[a])/r[a];s=Math.max(s,t)}else if(r[a]<=-h){const t=(i-n[a])/r[a];o=Math.min(o,t)}if(s>=o)return!1}{const i=t[a+3];if(n[a]>i){if(r[a]>=-h)return!1;const t=(i-n[a])/r[a];s=Math.max(s,t)}else if(r[a]>=h){const t=(i-n[a])/r[a];o=Math.min(o,t)}if(s>=o)return!1}}return!0}class l{constructor(t,i,e,n,r){this.aabb=t,this.axis=i,this.d=e,this.midStartIndex=n,this.rightStartIndex=r}}class d{constructor(t,i,e,n){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=n,this.bspNodeTree=new Array,this.vertexPositionBuffer=n.data,this.vertexPositionStride=n.stride;const r=e-i,s=r<=R?new Uint16Array(r):new Uint32Array(r);this.indices=s;for(let o=0;o<r;++o)s[o]=o;{const o=T(t,i,e,n.data,n.stride),h=(t,i,e)=>{const n=p(s,o,t,i),r=i-t;if(r<=a){const e=new l(n,void 0,0,t,i);return this.bspNodeTree.push(e),e}const{axis:u,midValue:d}=b(n),m=N(s,o,t,i,u,d),x=(t,i)=>{if(e>f)return;const n=i-t;return n<a||n>=c*r?void 0:h(t,i,e+1)},g=new l(n,u,d,m.next,m.mid);return this.bspNodeTree.push(g),g.leftNode=x(t,m.next),g.rightNode=x(m.mid,i),g};h(0,r,0),this.triangleVertexIndices=I(s,t,i,e)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const e=this.triangleVertexIndices,n=this.positionAttribute.data,r=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],c=o[1],f=o[2],h=this.rayDirection,u=h[0],l=h[1],d=h[2];for(let m=t,g=3*t;m<i;++m){const t=e[g]*r,i=n[t],o=n[t+1],h=n[t+2],y=e[g+1]*r,N=n[y],p=n[y+1],b=n[y+2],T=e[g+2]*r,I=n[T],R=n[T+1],S=n[T+2];g+=3;const M=N-i,w=p-o,A=b-h,v=I-i,B=R-o,P=S-h,V=l*P-B*d,U=d*v-P*u,j=u*B-v*l,k=M*V+w*U+A*j;if(Math.abs(k)<=Number.EPSILON)continue;const F=a-i,O=c-o,D=f-h,E=F*V+O*U+D*j;if(k>0){if(E<0||E>k)continue}else if(E>0||E<k)continue;const L=O*A-w*D,q=D*M-A*F,z=F*w-M*O,C=u*L+l*q+d*z;if(k>0){if(C<0||E+C>k)continue}else if(C>0||E+C<k)continue;const G=(v*L+B*q+P*z)/k;if(G>=0){const t=this.indices[m]+this.firstTriangleIndex,i=s(M,w,A,v,B,P,x);this.callback(G,i,t)}}}d.numFacesTested+=i-t}intersectRay(i,n){d.numFacesTested=0;const r=e(i.r0[0],i.r0[1],i.r0[2]),s=m(e(i.r1[0],i.r1[1],i.r1[2]),r);if(t(s)<h)return;this.rayOrigin=r,this.rayDirection=s;const o=this.triangleVertexIndices.length/3;this.callback=n;const a=this.bspNodeTree[0];this.intersectRayBSP(a,0,o)}intersectRayBSP(t,i,e){const n=this.rayOrigin,r=this.rayDirection;if(!u(t.aabb,n,r))return;const s=t.axis,o=t.d;if(n[s]<o||r[s]<0){const e=i,n=t.midStartIndex;if(e<n){const i=t.leftNode;void 0!==i?this.intersectRayBSP(i,e,n):this.intersectRayTriangleRange(e,n)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),n[s]>o||r[s]>0){const i=t.rightStartIndex,n=e;if(i<n){const e=t.rightNode;void 0!==e?this.intersectRayBSP(e,i,n):this.intersectRayTriangleRange(i,n)}}}}function m(t,e){const r=n();return i(r,t,e),r}d.numFacesTested=0;const x=n(),g=e(1/0,1/0,1/0),y=e(-1/0,-1/0,-1/0);function N(t,i,e,n,r,s){let o=e,a=n;for(;o<a;){const e=t[o];i[6*e+r+3]<=s?++o:(--a,t[o]=t[a],t[a]=e)}let c=o;for(a=n;c<a;){const e=t[a-1];i[6*e+r]>=s?--a:(t[a-1]=t[c],t[c]=e,++c)}return{next:o,mid:c}}function p(t,i,e,n){if(n<=e)return r(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[e];for(let t=0;t<3;++t)g[t]=i[n+0+t],y[t]=i[n+3+t]}for(let r=e+1;r<n;++r){const e=6*t[r];for(let t=0;t<3;++t)g[t]=Math.min(g[t],i[e+0+t]),y[t]=Math.max(y[t],i[e+3+t])}return r(g[0],g[1],g[2],y[0],y[1],y[2])}function b(t){const i=t[3]-t[0],e=t[4]-t[1],n=t[5]-t[2],r=i>e?i>n?0:e>n?1:2:e>n?1:n>i?2:0;return{axis:r,midValue:(t[r]+t[r+3])/2}}function T(t,i,e,n,r){const s=e-i,o=new Float32Array(6*s);for(let a=0;a<s;++a){const e=3*(a+i),s=t[e+0]*r,c=t[e+1]*r,f=t[e+2]*r;for(let t=0;t<3;++t){const i=n[s+t],e=n[c+t],r=n[f+t];o[6*a+t]=Math.min(i,e,r),o[6*a+3+t]=Math.max(i,e,r)}}return o}function I(t,i,e,n){const r=n-e;let s=0;for(let a=e;a<n;++a)for(let t=0;t<3;++t)s=Math.max(i[3*a+t],s);const o=s<=R?new Uint16Array(3*r):new Uint32Array(3*r);for(let a=0;a<r;++a){const n=3*(t[a]+e);for(let t=0;t<3;++t){const e=i[n+t];o[3*a+t]=e}}return o}const R=65535;export{d as ComponentIntersectionData,o as componentMinimalSizeForIntersectionData};\n"]},"metadata":{},"sourceType":"module"}