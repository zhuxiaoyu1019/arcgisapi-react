{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../Graphic.js\";\nimport { isSome as r } from \"../../../core/maybe.js\";\nimport { WorkerHandle as o } from \"../../../core/workers/WorkerHandle.js\";\nimport t from \"../../../geometry/SpatialReference.js\";\nimport s from \"../../../layers/support/Field.js\";\n\nclass i {\n  constructor(e) {\n    this._schedule = e, this._handle = new n(e);\n  }\n\n  destroy() {\n    this._handle.destroy();\n  }\n\n  invoke(o, i) {\n    return o.buffer && 0 !== o.buffer.byteLength ? (o.options.sourceSpatialReference && o.options.sourceSpatialReference instanceof t && (o.options = { ...o.options,\n      sourceSpatialReference: o.options.sourceSpatialReference.toJSON()\n    }), this._handle.invoke(o, i).then(o => this._schedule(() => {\n      if (o.spatialReference = t.fromJSON(o.spatialReference), o.fields) for (let e = 0; e < o.fields.length; e++) o.fields[e] = s.fromJSON(o.fields[e]);\n      const i = o.spatialReference;\n\n      for (const t of o.features) t.uid = e.generateUID(), r(t.geometry) && (t.geometry.spatialReference = i);\n\n      return o;\n    }))) : Promise.resolve(null);\n  }\n\n}\n\nclass n extends o {\n  constructor(e) {\n    super(\"PBFDecoderWorker\", \"_parseFeatureQuery\", e);\n  }\n\n  getTransferList(e) {\n    return [e.buffer];\n  }\n\n}\n\nexport { i as PBFDecoder };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/support/PBFDecoder.js"],"names":["e","isSome","r","WorkerHandle","o","t","s","i","constructor","_schedule","_handle","n","destroy","invoke","buffer","byteLength","options","sourceSpatialReference","toJSON","then","spatialReference","fromJSON","fields","length","features","uid","generateUID","geometry","Promise","resolve","getTransferList","PBFDecoder"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,qBAAb;AAAmC,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,wBAAvB;AAAgD,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,uCAA7B;AAAqE,OAAOC,CAAP,MAAa,uCAAb;AAAqD,OAAOC,CAAP,MAAa,kCAAb;;AAAgD,MAAMC,CAAN,CAAO;AAACC,EAAAA,WAAW,CAACR,CAAD,EAAG;AAAC,SAAKS,SAAL,GAAeT,CAAf,EAAiB,KAAKU,OAAL,GAAa,IAAIC,CAAJ,CAAMX,CAAN,CAA9B;AAAuC;;AAAAY,EAAAA,OAAO,GAAE;AAAC,SAAKF,OAAL,CAAaE,OAAb;AAAuB;;AAAAC,EAAAA,MAAM,CAACT,CAAD,EAAGG,CAAH,EAAK;AAAC,WAAOH,CAAC,CAACU,MAAF,IAAU,MAAIV,CAAC,CAACU,MAAF,CAASC,UAAvB,IAAmCX,CAAC,CAACY,OAAF,CAAUC,sBAAV,IAAkCb,CAAC,CAACY,OAAF,CAAUC,sBAAV,YAA4CZ,CAA9E,KAAkFD,CAAC,CAACY,OAAF,GAAU,EAAC,GAAGZ,CAAC,CAACY,OAAN;AAAcC,MAAAA,sBAAsB,EAACb,CAAC,CAACY,OAAF,CAAUC,sBAAV,CAAiCC,MAAjC;AAArC,KAA5F,GAA6K,KAAKR,OAAL,CAAaG,MAAb,CAAoBT,CAApB,EAAsBG,CAAtB,EAAyBY,IAAzB,CAA+Bf,CAAC,IAAE,KAAKK,SAAL,CAAgB,MAAI;AAAC,UAAGL,CAAC,CAACgB,gBAAF,GAAmBf,CAAC,CAACgB,QAAF,CAAWjB,CAAC,CAACgB,gBAAb,CAAnB,EAAkDhB,CAAC,CAACkB,MAAvD,EAA8D,KAAI,IAAItB,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACI,CAAC,CAACkB,MAAF,CAASC,MAAvB,EAA8BvB,CAAC,EAA/B,EAAkCI,CAAC,CAACkB,MAAF,CAAStB,CAAT,IAAYM,CAAC,CAACe,QAAF,CAAWjB,CAAC,CAACkB,MAAF,CAAStB,CAAT,CAAX,CAAZ;AAAoC,YAAMO,CAAC,GAACH,CAAC,CAACgB,gBAAV;;AAA2B,WAAI,MAAMf,CAAV,IAAeD,CAAC,CAACoB,QAAjB,EAA0BnB,CAAC,CAACoB,GAAF,GAAMzB,CAAC,CAAC0B,WAAF,EAAN,EAAsBxB,CAAC,CAACG,CAAC,CAACsB,QAAH,CAAD,KAAgBtB,CAAC,CAACsB,QAAF,CAAWP,gBAAX,GAA4Bb,CAA5C,CAAtB;;AAAqE,aAAOH,CAAP;AAAS,KAA5R,CAAlC,CAAhN,IAAohBwB,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAA3hB;AAAijB;;AAArpB;;AAAspB,MAAMlB,CAAN,SAAgBP,CAAhB,CAAiB;AAACI,EAAAA,WAAW,CAACR,CAAD,EAAG;AAAC,UAAM,kBAAN,EAAyB,oBAAzB,EAA8CA,CAA9C;AAAiD;;AAAA8B,EAAAA,eAAe,CAAC9B,CAAD,EAAG;AAAC,WAAM,CAACA,CAAC,CAACc,MAAH,CAAN;AAAiB;;AAArG;;AAAsG,SAAOP,CAAC,IAAIwB,UAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../Graphic.js\";import{isSome as r}from\"../../../core/maybe.js\";import{WorkerHandle as o}from\"../../../core/workers/WorkerHandle.js\";import t from\"../../../geometry/SpatialReference.js\";import s from\"../../../layers/support/Field.js\";class i{constructor(e){this._schedule=e,this._handle=new n(e)}destroy(){this._handle.destroy()}invoke(o,i){return o.buffer&&0!==o.buffer.byteLength?(o.options.sourceSpatialReference&&o.options.sourceSpatialReference instanceof t&&(o.options={...o.options,sourceSpatialReference:o.options.sourceSpatialReference.toJSON()}),this._handle.invoke(o,i).then((o=>this._schedule((()=>{if(o.spatialReference=t.fromJSON(o.spatialReference),o.fields)for(let e=0;e<o.fields.length;e++)o.fields[e]=s.fromJSON(o.fields[e]);const i=o.spatialReference;for(const t of o.features)t.uid=e.generateUID(),r(t.geometry)&&(t.geometry.spatialReference=i);return o}))))):Promise.resolve(null)}}class n extends o{constructor(e){super(\"PBFDecoderWorker\",\"_parseFeatureQuery\",e)}getTransferList(e){return[e.buffer]}}export{i as PBFDecoder};\n"]},"metadata":{},"sourceType":"module"}