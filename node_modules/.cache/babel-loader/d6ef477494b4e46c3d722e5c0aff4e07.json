{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport e from \"../../../../core/Accessor.js\";\nimport s from \"../../../../core/has.js\";\nimport { property as i } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as r } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { PooledRBush as n } from \"../../../../core/libs/rbush/PooledRBush.js\";\nimport { fromRect as o } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { getObjectId as a } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nlet d = class extends e {\n  constructor(t) {\n    super(t), this._index = new n(9, s(\"csp-restrictions\") ? t => ({\n      minX: t.extent[0],\n      minY: t.extent[1],\n      maxX: t.extent[2],\n      maxY: t.extent[3]\n    }) : [\".extent[0]\", \".extent[1]\", \".extent[2]\", \".extent[3]\"]), this._missing = new Set(), this._boundsByFeature = new Map(), this.spatialReference = null, this.hasZ = null, this.hasM = null, this.objectIdField = null, this.updating = !1;\n  }\n\n  setup(t) {\n    this._addMany(t);\n  }\n\n  destroy() {\n    this._missing.clear(), this._index.destroy(), this._index = null, this._boundsByFeature.clear(), this._boundsByFeature = null;\n  }\n\n  update() {\n    this._missing.size > 0 && (this._addMany(Array.from(this._missing.values())), this.updating = !1, this._missing.clear());\n  }\n\n  get updatingRemaining() {\n    return this._missing.size;\n  }\n\n  queryGraphicUIDsInExtent(t, e, s) {\n    e.equals(this.spatialReference) && (u.minX = t[0], u.minY = t[1], u.maxX = t[2], u.maxY = t[3], this.update(), this._index.search(u, t => s(t.graphic.uid)));\n  }\n\n  add(t) {\n    this._missing.add(t), this.updating = !0;\n  }\n\n  remove(t) {\n    if (this._missing.delete(t)) return void (this.updating = this._missing.size > 0);\n\n    this._index.remove(t);\n\n    const e = a(t.graphic, this._get(\"objectIdField\"));\n    null != e && this._boundsByFeature.delete(e);\n  }\n\n  _addMany(t) {\n    if (0 === t.length) return;\n\n    const e = this._get(\"objectIdField\");\n\n    for (const s of t) {\n      s.computeExtent(this.spatialReference);\n      const t = a(s.graphic, e);\n      null != t && this._boundsByFeature.set(t, s.extent);\n    }\n\n    this._index.load(t);\n  }\n\n  clear() {\n    this._index.clear(), this._missing.clear(), this._boundsByFeature.clear(), this.updating = !1;\n  }\n\n  forEachInBounds(t, e) {\n    u.minX = t[0], u.minY = t[1], u.maxX = t[2], u.maxY = t[3], this.update(), this._index.search(u, t => {\n      e(t);\n    });\n  }\n\n  getBounds(t, e) {\n    this.update();\n\n    const s = this._boundsByFeature.get(t);\n\n    return s ? o(e, s) : null;\n  }\n\n};\nt([i({\n  constructOnly: !0\n})], d.prototype, \"spatialReference\", void 0), t([i({\n  constructOnly: !0\n})], d.prototype, \"hasZ\", void 0), t([i({\n  constructOnly: !0\n})], d.prototype, \"hasM\", void 0), t([i({\n  constructOnly: !0\n})], d.prototype, \"objectIdField\", void 0), t([i()], d.prototype, \"updating\", void 0), t([i({\n  readOnly: !0\n})], d.prototype, \"updatingRemaining\", null), d = t([r(\"esri.views.3d.layers.graphics.SpatialIndex2D\")], d);\nconst u = {\n  minX: 0,\n  minY: 0,\n  maxX: 0,\n  maxY: 0\n};\nexport { d as SpatialIndex2D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/SpatialIndex2D.js"],"names":["_","t","e","s","property","i","subclass","r","PooledRBush","n","fromRect","o","getObjectId","a","d","constructor","_index","minX","extent","minY","maxX","maxY","_missing","Set","_boundsByFeature","Map","spatialReference","hasZ","hasM","objectIdField","updating","setup","_addMany","destroy","clear","update","size","Array","from","values","updatingRemaining","queryGraphicUIDsInExtent","equals","u","search","graphic","uid","add","remove","delete","_get","length","computeExtent","set","load","forEachInBounds","getBounds","get","constructOnly","prototype","readOnly","SpatialIndex2D"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import s from\"../../../../core/has.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{PooledRBush as n}from\"../../../../core/libs/rbush/PooledRBush.js\";import{fromRect as o}from\"../../../../geometry/support/aaBoundingBox.js\";import{getObjectId as a}from\"../../../../layers/graphics/dehydratedFeatures.js\";let d=class extends e{constructor(t){super(t),this._index=new n(9,s(\"csp-restrictions\")?t=>({minX:t.extent[0],minY:t.extent[1],maxX:t.extent[2],maxY:t.extent[3]}):[\".extent[0]\",\".extent[1]\",\".extent[2]\",\".extent[3]\"]),this._missing=new Set,this._boundsByFeature=new Map,this.spatialReference=null,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.updating=!1}setup(t){this._addMany(t)}destroy(){this._missing.clear(),this._index.destroy(),this._index=null,this._boundsByFeature.clear(),this._boundsByFeature=null}update(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(t,e,s){e.equals(this.spatialReference)&&(u.minX=t[0],u.minY=t[1],u.maxX=t[2],u.maxY=t[3],this.update(),this._index.search(u,(t=>s(t.graphic.uid))))}add(t){this._missing.add(t),this.updating=!0}remove(t){if(this._missing.delete(t))return void(this.updating=this._missing.size>0);this._index.remove(t);const e=a(t.graphic,this._get(\"objectIdField\"));null!=e&&this._boundsByFeature.delete(e)}_addMany(t){if(0===t.length)return;const e=this._get(\"objectIdField\");for(const s of t){s.computeExtent(this.spatialReference);const t=a(s.graphic,e);null!=t&&this._boundsByFeature.set(t,s.extent)}this._index.load(t)}clear(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}forEachInBounds(t,e){u.minX=t[0],u.minY=t[1],u.maxX=t[2],u.maxY=t[3],this.update(),this._index.search(u,(t=>{e(t)}))}getBounds(t,e){this.update();const s=this._boundsByFeature.get(t);return s?o(e,s):null}};t([i({constructOnly:!0})],d.prototype,\"spatialReference\",void 0),t([i({constructOnly:!0})],d.prototype,\"hasZ\",void 0),t([i({constructOnly:!0})],d.prototype,\"hasM\",void 0),t([i({constructOnly:!0})],d.prototype,\"objectIdField\",void 0),t([i()],d.prototype,\"updating\",void 0),t([i({readOnly:!0})],d.prototype,\"updatingRemaining\",null),d=t([r(\"esri.views.3d.layers.graphics.SpatialIndex2D\")],d);const u={minX:0,minY:0,maxX:0,maxY:0};export{d as SpatialIndex2D};\n"]},"metadata":{},"sourceType":"module"}