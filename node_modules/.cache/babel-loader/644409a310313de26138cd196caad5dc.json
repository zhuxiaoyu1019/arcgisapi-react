{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../Color.js\";\nimport t from \"../../core/Logger.js\";\nimport { nextPowerOfTwo as r } from \"../../core/mathUtils.js\";\nimport { Placement as o } from \"./CIMPlacements.js\";\nimport { EnvDrawHelper as s, Transformation as a, CanvasDrawHelper as i } from \"./CIMSymbolDrawHelper.js\";\nimport { packFloatRGBA as n } from \"./packingUtils.js\";\nconst c = Math.PI,\n      l = c / 2,\n      m = 4,\n      y = t.getLogger(\"esri.symbols.cim.CIMSymbolHelper\");\n\nfunction f(e, t) {\n  switch (t.type) {\n    case \"CIMSymbolReference\":\n      {\n        const r = {\n          type: \"point\",\n          x: 0,\n          y: 0\n        };\n        e.drawSymbol(t.symbol, r);\n        break;\n      }\n\n    case \"CIMPointSymbol\":\n      {\n        const r = {\n          type: \"point\",\n          x: 0,\n          y: 0\n        };\n        e.drawSymbol(t, r);\n        break;\n      }\n\n    case \"CIMTextSymbol\":\n      break;\n\n    case \"CIMVectorMarker\":\n      {\n        const r = new o();\n        e.drawMarker(t, r);\n        break;\n      }\n  }\n\n  return e.envelope();\n}\n\nclass h {\n  static getEnvelope(e) {\n    const t = new s();\n\n    if (Array.isArray(e)) {\n      let r;\n\n      for (const o of e) r ? r.union(f(t, o)) : r = f(t, o);\n\n      return r;\n    }\n\n    return f(t, e);\n  }\n\n  static getTextureAnchor(e) {\n    const t = this.getEnvelope(e);\n    if (!t || t.width <= 0 || t.height <= 0) return [0, 0, 0];\n    const r = 96 / 72,\n          o = (t.x + .5 * t.width) * r,\n          s = -(t.y + .5 * t.height) * r,\n          a = t.width * r + 2,\n          i = t.height * r + 2;\n    return [o / a, s / i, i];\n  }\n\n  static rasterize(e, t, r, s = !0) {\n    const n = r || this.getEnvelope(t);\n    if (!n || n.width <= 0 || n.height <= 0) return [null, 0, 0, 0, 0];\n    const c = 96 / 72,\n          l = (n.x + .5 * n.width) * c,\n          m = (n.y + .5 * n.height) * c;\n    e.width = n.width * c, e.height = n.height * c, r || (e.width += 2, e.height += 2);\n    const y = e.getContext(\"2d\"),\n          f = a.createScale(c, -c);\n    f.translate(.5 * e.width - l, .5 * e.height + m);\n    const h = new i(y, f);\n\n    switch (t.type) {\n      case \"CIMPointSymbol\":\n        {\n          const e = {\n            type: \"point\",\n            x: 0,\n            y: 0\n          };\n          h.drawSymbol(t, e);\n          break;\n        }\n\n      case \"CIMVectorMarker\":\n        {\n          const e = new o();\n          h.drawMarker(t, e);\n          break;\n        }\n    }\n\n    const p = y.getImageData(0, 0, e.width, e.height),\n          S = new Uint8Array(p.data);\n\n    if (s) {\n      let e;\n\n      for (let t = 0; t < S.length; t += 4) e = S[t + 3] / 255, S[t] = S[t] * e, S[t + 1] = S[t + 1] * e, S[t + 2] = S[t + 2] * e;\n    }\n\n    return [S, e.width, e.height, -l / e.width, -m / e.height];\n  }\n\n  static fromSimpleMarker(e) {\n    const t = 100,\n          r = 50;\n    let o, s;\n    const a = e.style;\n\n    if (\"circle\" === a || \"esriSMSCircle\" === a) {\n      const e = .25;\n      let t = Math.acos(1 - e / r),\n          a = Math.ceil(c / t / 4);\n      0 === a && (a = 1), t = l / a, a *= 4;\n      const i = [];\n      i.push([r, 0]);\n\n      for (let o = 1; o < a; o++) i.push([r * Math.cos(o * t), -r * Math.sin(o * t)]);\n\n      i.push([r, 0]), o = {\n        rings: [i]\n      }, s = {\n        xmin: -r,\n        ymin: -r,\n        xmax: r,\n        ymax: r\n      };\n    } else if (\"cross\" === a || \"esriSMSCross\" === a) {\n      const e = 0;\n      o = {\n        rings: [[[e, r], [e, e], [r, e], [r, -e], [e, -e], [e, -r], [-e, -r], [-e, -e], [-r, -e], [-r, e], [-e, e], [-e, r], [e, r]]]\n      }, s = {\n        xmin: -r,\n        ymin: -r,\n        xmax: r,\n        ymax: r\n      };\n    } else if (\"diamond\" === a || \"esriSMSDiamond\" === a) o = {\n      rings: [[[-r, 0], [0, r], [r, 0], [0, -r], [-r, 0]]]\n    }, s = {\n      xmin: -r,\n      ymin: -r,\n      xmax: r,\n      ymax: r\n    };else if (\"square\" === a || \"esriSMSSquare\" === a) o = {\n      rings: [[[-r, -r], [-r, r], [r, r], [r, -r], [-r, -r]]]\n    }, s = {\n      xmin: -r,\n      ymin: -r,\n      xmax: r,\n      ymax: r\n    };else if (\"x\" === a || \"esriSMSX\" === a) {\n      const e = 0;\n      o = {\n        rings: [[[0, e], [r - e, r], [r, r - e], [e, 0], [r, e - r], [r - e, -r], [0, -e], [e - r, -r], [-r, e - r], [-e, 0], [-r, r - e], [e - r, r], [0, e]]]\n      }, s = {\n        xmin: -r,\n        ymin: -r,\n        xmax: r,\n        ymax: r\n      };\n    } else if (\"triangle\" === a || \"esriSMSTriangle\" === a) {\n      const e = t * .5773502691896257,\n            r = -e,\n            a = 2 / 3 * t,\n            i = a - t;\n      o = {\n        rings: [[[r, i], [0, a], [e, i], [r, i]]]\n      }, s = {\n        xmin: r,\n        ymin: i,\n        xmax: e,\n        ymax: a\n      };\n    } else \"arrow\" !== a && \"esriSMSArrow\" !== a || (o = {\n      rings: [[[-50, 50], [50, 0], [-50, -50], [-33, -20], [-33, 20], [-50, 50]]]\n    }, s = {\n      xmin: -r,\n      ymin: -r,\n      xmax: r,\n      ymax: r\n    });\n\n    let i;\n\n    if (o && s) {\n      const t = [{\n        type: \"CIMSolidFill\",\n        enable: !0,\n        color: e.color\n      }];\n      e.outline && t.push({\n        type: \"CIMSolidStroke\",\n        enable: !0,\n        width: e.outline.width,\n        color: e.outline.color\n      });\n      const r = {\n        type: \"CIMPolygonSymbol\",\n        symbolLayers: t\n      };\n      i = {\n        type: \"CIMPointSymbol\",\n        symbolLayers: [{\n          type: \"CIMVectorMarker\",\n          enable: !0,\n          rotation: e.angle,\n          size: e.size,\n          offsetX: e.xoffset,\n          offsetY: e.yoffset,\n          frame: s,\n          markerGraphics: [{\n            type: \"CIMMarkerGraphic\",\n            geometry: o,\n            symbol: r\n          }]\n        }]\n      };\n    }\n\n    return i;\n  }\n\n  static fromCIMHatchFill(e) {\n    const t = void 0 !== e.separation ? e.separation : m,\n          r = t / 2;\n    let o = this._getLineSymbolPeriod(e.lineSymbol) || m;\n\n    for (; o < 4;) o *= 2;\n\n    const s = o / 2;\n    return {\n      type: \"CIMVectorMarker\",\n      frame: {\n        xmin: -s,\n        xmax: s,\n        ymin: -r,\n        ymax: r\n      },\n      markerGraphics: [{\n        type: \"CIMMarkerGraphic\",\n        geometry: {\n          paths: [[[-s, 0], [s, 0]]]\n        },\n        symbol: e.lineSymbol\n      }],\n      size: t\n    };\n  }\n\n  static _getLineSymbolPeriod(e) {\n    if (e) {\n      const t = this._getEffectsRepeat(e.effects);\n\n      if (t) return t;\n      if (e.symbolLayers) for (const r of e.symbolLayers) {\n        const e = this._getEffectsRepeat(r.effects);\n\n        if (e) return e;\n\n        if (r) {\n          const e = this._getPlacementRepeat(r.markerPlacement);\n\n          if (e) return e;\n        }\n      }\n    }\n\n    return 0;\n  }\n\n  static _getEffectsRepeat(e) {\n    if (e) for (const t of e) if (t) switch (t.type) {\n      case \"CIMGeometricEffectDashes\":\n        {\n          const e = t.dashTemplate;\n\n          if (e && e.length) {\n            let t = 0;\n\n            for (const r of e) t += r;\n\n            return 1 & e.length && (t *= 2), t;\n          }\n\n          break;\n        }\n\n      case \"CIMGeometricEffectWave\":\n        return t.period;\n\n      default:\n        y.error(`unsupported geometric effect type ${t.type}`);\n    }\n    return 0;\n  }\n\n  static _getPlacementRepeat(e) {\n    if (e) switch (e.type) {\n      case \"CIMMarkerPlacementAlongLineSameSize\":\n      case \"CIMMarkerPlacementAlongLineRandomSize\":\n      case \"CIMMarkerPlacementAlongLineVariableSize\":\n        {\n          const t = e.placementTemplate;\n\n          if (t && t.length) {\n            let e = 0;\n\n            for (const r of t) e += r;\n\n            return 1 & t.length && (e *= 2), e;\n          }\n\n          break;\n        }\n    }\n    return 0;\n  }\n\n  static fromCIMInsidePolygon(e) {\n    const t = e.markerPlacement,\n          r = {\n      type: e.type,\n      ...e\n    };\n    let o, s, a, i;\n\n    if (r.markerPlacement = null, r.anchorPoint = null, !0 === t.shiftOddRows) {\n      s = t.stepX / 2, a = t.stepY, i = 2 * t.stepY;\n      o = [{\n        x: -s,\n        y: 0\n      }, {\n        x: s,\n        y: 0\n      }, {\n        x: 0,\n        y: a\n      }, {\n        x: 0,\n        y: -a\n      }].map(e => ({\n        type: \"CIMMarkerGraphic\",\n        geometry: e,\n        symbol: {\n          type: \"CIMPointSymbol\",\n          symbolLayers: [r]\n        }\n      }));\n    } else s = t.stepX / 2, a = t.stepY / 2, i = t.stepY, o = [{\n      type: \"CIMMarkerGraphic\",\n      geometry: {\n        x: 0,\n        y: 0\n      },\n      symbol: {\n        type: \"CIMPointSymbol\",\n        symbolLayers: [r]\n      }\n    }];\n\n    return {\n      type: \"CIMVectorMarker\",\n      frame: {\n        xmin: -s,\n        xmax: s,\n        ymin: -a,\n        ymax: a\n      },\n      markerGraphics: o,\n      size: i\n    };\n  }\n\n  static getFillColor(e) {\n    if (!e) return null;\n\n    switch (e.type) {\n      case \"CIMPolygonSymbol\":\n        if (e.symbolLayers) for (const t of e.symbolLayers) {\n          const e = h.getFillColor(t);\n          if (null != e) return e;\n        }\n        break;\n\n      case \"CIMTextSymbol\":\n        return h.getFillColor(e.symbol);\n\n      case \"CIMSolidFill\":\n        return e.color;\n    }\n  }\n\n  static getStrokeColor(e) {\n    if (e) switch (e.type) {\n      case \"CIMPolygonSymbol\":\n      case \"CIMLineSymbol\":\n        if (e.symbolLayers) for (const t of e.symbolLayers) {\n          const e = h.getStrokeColor(t);\n          if (void 0 !== e) return e;\n        }\n        break;\n\n      case \"CIMTextSymbol\":\n        return h.getStrokeColor(e.symbol);\n\n      case \"CIMSolidStroke\":\n        return e.color;\n    }\n  }\n\n  static getStrokeWidth(e) {\n    if (e) switch (e.type) {\n      case \"CIMPolygonSymbol\":\n      case \"CIMLineSymbol\":\n        if (e.symbolLayers) for (const t of e.symbolLayers) {\n          const e = h.getStrokeWidth(t);\n          if (void 0 !== e) return e;\n        }\n        break;\n\n      case \"CIMTextSymbol\":\n        return h.getStrokeWidth(e.symbol);\n\n      case \"CIMSolidStroke\":\n      case \"CIMGradientStroke\":\n      case \"CIMPictureStroke\":\n        return e.width;\n    }\n  }\n\n  static getSize(e) {\n    if (e) switch (e.type) {\n      case \"CIMPointSymbol\":\n      case \"CIMLineSymbol\":\n      case \"CIMPolygonSymbol\":\n        {\n          let t = 0;\n          if (e.symbolLayers) for (const r of e.symbolLayers) {\n            const e = h.getSize(r);\n            e > t && (t = e);\n          }\n          return t;\n        }\n\n      case \"CIMSolidStroke\":\n      case \"CIMPictureStroke\":\n      case \"CIMGradientStroke\":\n        return e.width;\n\n      case \"CIMCharacterMarker\":\n      case \"CIMPictureMarker\":\n      case \"CIMVectorMarker\":\n        return e.size;\n    }\n  }\n\n  static getMarkerScaleRatio(e) {\n    if (e) switch (e.type) {\n      case \"CIMVectorMarker\":\n        if (!1 !== e.scaleSymbolsProportionally && e.frame) {\n          const t = e.frame.ymax - e.frame.ymin;\n          return e.size / t;\n        }\n\n    }\n    return 1;\n  }\n\n}\n\nclass p {\n  static rasterizeSimpleFill(e, t, o) {\n    \"solid\" !== t && \"none\" !== t && \"esriSFSSolid\" !== t && \"esriSFSNull\" !== t || console.error(\"Unexpected: style does not require rasterization\");\n    const s = r(Math.ceil(o)),\n          a = this._isHorizontalOrVertical(t) ? 8 * s : 16 * s,\n          i = 2 * s;\n    e.width = a, e.height = a;\n    const n = e.getContext(\"2d\");\n    n.strokeStyle = \"#FFFFFF\", n.lineWidth = s, n.beginPath(), \"vertical\" !== t && \"cross\" !== t && \"esriSFSCross\" !== t && \"esriSFSVertical\" !== t || (n.moveTo(a / 2, -i), n.lineTo(a / 2, a + i)), \"horizontal\" !== t && \"cross\" !== t && \"esriSFSCross\" !== t && \"esriSFSHorizontal\" !== t || (n.moveTo(-i, a / 2), n.lineTo(a + i, a / 2)), \"forward-diagonal\" !== t && \"diagonal-cross\" !== t && \"esriSFSDiagonalCross\" !== t && \"esriSFSForwardDiagonal\" !== t || (n.moveTo(-i, -i), n.lineTo(a + i, a + i), n.moveTo(a - i, -i), n.lineTo(a + i, i), n.moveTo(-i, a - i), n.lineTo(i, a + i)), \"backward-diagonal\" !== t && \"diagonal-cross\" !== t && \"esriSFSBackwardDiagonal\" !== t && \"esriSFSDiagonalCross\" !== t || (n.moveTo(a + i, -i), n.lineTo(-i, a + i), n.moveTo(i, -i), n.lineTo(-i, i), n.moveTo(a + i, a - i), n.lineTo(a - i, a + i)), n.stroke();\n    const c = n.getImageData(0, 0, e.width, e.height),\n          l = new Uint8Array(c.data);\n    let m;\n\n    for (let r = 0; r < l.length; r += 4) m = l[r + 3] / 255, l[r] = l[r] * m, l[r + 1] = l[r + 1] * m, l[r + 2] = l[r + 2] * m;\n\n    return [l, e.width, e.height];\n  }\n\n  static rasterizeSimpleLine(e, t) {\n    let r;\n\n    switch (t) {\n      case \"butt\":\n        r = \"Butt\";\n        break;\n\n      case \"square\":\n        r = \"Square\";\n        break;\n\n      default:\n        r = \"Round\";\n    }\n\n    const o = \"Butt\" === r;\n    let s;\n\n    switch (e) {\n      case \"dash\":\n      case \"esriSLSDash\":\n        s = o ? [4, 3] : [3, 4];\n        break;\n\n      case \"dash-dot\":\n      case \"esriSLSDashDot\":\n        s = o ? [4, 3, 1, 3] : [3, 4, 0, 4];\n        break;\n\n      case \"dot\":\n      case \"esriSLSDot\":\n        s = o ? [1, 3] : [0, 4];\n        break;\n\n      case \"long-dash\":\n      case \"esriSLSLongDash\":\n        s = o ? [8, 3] : [7, 4];\n        break;\n\n      case \"long-dash-dot\":\n      case \"esriSLSLongDashDot\":\n        s = o ? [8, 3, 1, 3] : [7, 4, 0, 4];\n        break;\n\n      case \"long-dash-dot-dot\":\n      case \"esriSLSDashDotDot\":\n        s = o ? [8, 3, 1, 3, 1, 3] : [7, 4, 0, 4, 0, 4];\n        break;\n\n      case \"short-dash\":\n      case \"esriSLSShortDash\":\n        s = o ? [4, 1] : [3, 2];\n        break;\n\n      case \"short-dash-dot\":\n      case \"esriSLSShortDashDot\":\n        s = o ? [4, 1, 1, 1] : [3, 2, 0, 2];\n        break;\n\n      case \"short-dash-dot-dot\":\n      case \"esriSLSShortDashDotDot\":\n        s = o ? [4, 1, 1, 1, 1, 1] : [3, 2, 0, 2, 0, 2];\n        break;\n\n      case \"short-dot\":\n      case \"esriSLSShortDot\":\n        s = o ? [1, 1] : [0, 2];\n        break;\n\n      case \"solid\":\n      case \"esriSLSSolid\":\n      case \"none\":\n        y.error(\"Unexpected: style does not require rasterization\"), s = [0, 0];\n        break;\n\n      default:\n        y.error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`), s = [0, 0];\n    }\n\n    return this.rasterizeDash(s, r);\n  }\n\n  static rasterizeDash(e, t) {\n    const r = \"Butt\" === t,\n          o = \"Square\" === t,\n          s = !r && !o;\n    e.length % 2 == 1 && (e = [...e, ...e]);\n    const a = 15.5,\n          i = 2 * a;\n    let c = 0;\n\n    for (const n of e) c += n;\n\n    const l = Math.round(c * a),\n          m = new Float32Array(l * i),\n          y = .5 * a;\n    let f = 0,\n        h = 0,\n        p = .5,\n        S = !0;\n\n    for (const n of e) {\n      for (f = h, h += n * a; p <= h;) {\n        let e = .5;\n\n        for (; e < i;) {\n          const t = (e - .5) * l + p - .5,\n                i = s ? (e - a) * (e - a) : Math.abs(e - a);\n          m[t] = S ? r ? Math.max(Math.max(f + y - p, i), Math.max(p - h + y, i)) : i : s ? Math.min((p - f) * (p - f) + i, (p - h) * (p - h) + i) : o ? Math.min(Math.max(p - f, i), Math.max(h - p, i)) : Math.min(Math.max(p - f + y, i), Math.max(h + y - p, i)), e++;\n        }\n\n        p++;\n      }\n\n      S = !S;\n    }\n\n    const d = m.length,\n          M = new Uint8Array(4 * d);\n\n    for (let b = 0; b < d; ++b) {\n      const e = (s ? Math.sqrt(m[b]) : m[b]) / a;\n      n(e, M, 4 * b);\n    }\n\n    return [M, l, i];\n  }\n\n  static _isHorizontalOrVertical(e) {\n    return \"vertical\" === e || \"horizontal\" === e || \"cross\" === e || \"esriSFSCross\" === e || \"esriSFSVertical\" === e || \"esriSFSHorizontal\" === e;\n  }\n\n}\n\nclass S {\n  static findApplicableOverrides(e, t, r) {\n    if (t) {\n      if (e.primitiveName) {\n        let o = !1;\n\n        for (const t of r) if (t.primitiveName === e.primitiveName) {\n          o = !0;\n          break;\n        }\n\n        if (!o) for (const s of t) s.primitiveName === e.primitiveName && r.push(s);\n      }\n\n      switch (e.type) {\n        case \"CIMPointSymbol\":\n        case \"CIMLineSymbol\":\n        case \"CIMPolygonSymbol\":\n          if (e.effects) for (const o of e.effects) S.findApplicableOverrides(o, t, r);\n          if (e.symbolLayers) for (const o of e.symbolLayers) S.findApplicableOverrides(o, t, r);\n          break;\n\n        case \"CIMTextSymbol\":\n          break;\n\n        case \"CIMSolidStroke\":\n        case \"CIMPictureStroke\":\n        case \"CIMGradientStroke\":\n        case \"CIMSolidFill\":\n        case \"CIMPictureFill\":\n        case \"CIMHatchFill\":\n        case \"CIMGradientFill\":\n        case \"CIMVectorMarker\":\n        case \"CIMCharacterMarker\":\n        case \"CIMPictureMarker\":\n          if (e.effects) for (const o of e.effects) S.findApplicableOverrides(o, t, r);\n\n          if (e.markerPlacement && S.findApplicableOverrides(e.markerPlacement, t, r), \"CIMVectorMarker\" === e.type) {\n            if (e.markerGraphics) for (const o of e.markerGraphics) S.findApplicableOverrides(o, t, r), S.findApplicableOverrides(o.symbol, t, r);\n          } else \"CIMCharacterMarker\" === e.type ? S.findApplicableOverrides(e.symbol, t, r) : \"CIMHatchFill\" === e.type && S.findApplicableOverrides(e.lineSymbol, t, r);\n\n      }\n    }\n  }\n\n  static applyOverrides(e, t, r, o) {\n    if (!t) return;\n\n    const s = e => e ? e.charAt(0).toLowerCase() + e.substr(1) : e;\n\n    if (e.primitiveName) for (const a of t) if (a.primitiveName === e.primitiveName) {\n      const t = s(a.propertyName);\n\n      if (o && o.push({\n        cim: e,\n        nocapPropertyName: t,\n        value: e[t]\n      }), a.expression && (a.value = S.toValue(a.propertyName, a.expression)), r) {\n        let t = !1;\n\n        for (const o of r) o.primitiveName === e.primitiveName && (t = !0);\n\n        t || r.push(a);\n      }\n\n      e[t] = a.value;\n    }\n\n    switch (e.type) {\n      case \"CIMPointSymbol\":\n      case \"CIMLineSymbol\":\n      case \"CIMPolygonSymbol\":\n        if (e.effects) for (const s of e.effects) S.applyOverrides(s, t, r, o);\n        if (e.symbolLayers) for (const s of e.symbolLayers) S.applyOverrides(s, t, r, o);\n        break;\n\n      case \"CIMTextSymbol\":\n        break;\n\n      case \"CIMSolidStroke\":\n      case \"CIMSolidFill\":\n      case \"CIMVectorMarker\":\n        if (e.effects) for (const s of e.effects) S.applyOverrides(s, t, r, o);\n        if (\"CIMVectorMarker\" === e.type && e.markerGraphics) for (const s of e.markerGraphics) S.applyOverrides(s, t, r, o), S.applyOverrides(s.symbol, t, r, o);\n    }\n  }\n\n  static restoreOverrides(e) {\n    for (const t of e) t.cim[t.nocapPropertyName] = t.value;\n  }\n\n  static buildOverrideKey(e) {\n    let t = \"\";\n\n    for (const r of e) void 0 !== r.value && (t += `${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);\n\n    return t;\n  }\n\n  static toValue(t, r) {\n    if (\"DashTemplate\" === t) return r.split(\" \").map(e => Number(e));\n\n    if (\"Color\" === t) {\n      const t = new e(r).toRgba();\n      return t[3] *= 255, t;\n    }\n\n    return r;\n  }\n\n}\n\nexport { h as CIMSymbolHelper, S as OverrideHelper, p as SymbolHelper };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/symbols/cim/CIMSymbolHelper.js"],"names":["e","t","nextPowerOfTwo","r","Placement","o","EnvDrawHelper","s","Transformation","a","CanvasDrawHelper","i","packFloatRGBA","n","c","Math","PI","l","m","y","getLogger","f","type","x","drawSymbol","symbol","drawMarker","envelope","h","getEnvelope","Array","isArray","union","getTextureAnchor","width","height","rasterize","getContext","createScale","translate","p","getImageData","S","Uint8Array","data","length","fromSimpleMarker","style","acos","ceil","push","cos","sin","rings","xmin","ymin","xmax","ymax","enable","color","outline","symbolLayers","rotation","angle","size","offsetX","xoffset","offsetY","yoffset","frame","markerGraphics","geometry","fromCIMHatchFill","separation","_getLineSymbolPeriod","lineSymbol","paths","_getEffectsRepeat","effects","_getPlacementRepeat","markerPlacement","dashTemplate","period","error","placementTemplate","fromCIMInsidePolygon","anchorPoint","shiftOddRows","stepX","stepY","map","getFillColor","getStrokeColor","getStrokeWidth","getSize","getMarkerScaleRatio","scaleSymbolsProportionally","rasterizeSimpleFill","console","_isHorizontalOrVertical","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","rasterizeSimpleLine","rasterizeDash","round","Float32Array","abs","max","min","d","M","b","sqrt","findApplicableOverrides","primitiveName","applyOverrides","charAt","toLowerCase","substr","propertyName","cim","nocapPropertyName","value","expression","toValue","restoreOverrides","buildOverrideKey","JSON","stringify","split","Number","toRgba","CIMSymbolHelper","OverrideHelper","SymbolHelper"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,gBAAb;AAA8B,OAAOC,CAAP,MAAa,sBAAb;AAAoC,SAAOC,cAAc,IAAIC,CAAzB,QAA+B,yBAA/B;AAAyD,SAAOC,SAAS,IAAIC,CAApB,QAA0B,oBAA1B;AAA+C,SAAOC,aAAa,IAAIC,CAAxB,EAA0BC,cAAc,IAAIC,CAA5C,EAA8CC,gBAAgB,IAAIC,CAAlE,QAAwE,0BAAxE;AAAmG,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,mBAA9B;AAAkD,MAAMC,CAAC,GAACC,IAAI,CAACC,EAAb;AAAA,MAAgBC,CAAC,GAACH,CAAC,GAAC,CAApB;AAAA,MAAsBI,CAAC,GAAC,CAAxB;AAAA,MAA0BC,CAAC,GAAClB,CAAC,CAACmB,SAAF,CAAY,kCAAZ,CAA5B;;AAA4E,SAASC,CAAT,CAAWrB,CAAX,EAAaC,CAAb,EAAe;AAAC,UAAOA,CAAC,CAACqB,IAAT;AAAe,SAAI,oBAAJ;AAAyB;AAAC,cAAMnB,CAAC,GAAC;AAACmB,UAAAA,IAAI,EAAC,OAAN;AAAcC,UAAAA,CAAC,EAAC,CAAhB;AAAkBJ,UAAAA,CAAC,EAAC;AAApB,SAAR;AAA+BnB,QAAAA,CAAC,CAACwB,UAAF,CAAavB,CAAC,CAACwB,MAAf,EAAsBtB,CAAtB;AAAyB;AAAM;;AAAA,SAAI,gBAAJ;AAAqB;AAAC,cAAMA,CAAC,GAAC;AAACmB,UAAAA,IAAI,EAAC,OAAN;AAAcC,UAAAA,CAAC,EAAC,CAAhB;AAAkBJ,UAAAA,CAAC,EAAC;AAApB,SAAR;AAA+BnB,QAAAA,CAAC,CAACwB,UAAF,CAAavB,CAAb,EAAeE,CAAf;AAAkB;AAAM;;AAAA,SAAI,eAAJ;AAAoB;;AAAM,SAAI,iBAAJ;AAAsB;AAAC,cAAMA,CAAC,GAAC,IAAIE,CAAJ,EAAR;AAAcL,QAAAA,CAAC,CAAC0B,UAAF,CAAazB,CAAb,EAAeE,CAAf;AAAkB;AAAM;AAA3Q;;AAA4Q,SAAOH,CAAC,CAAC2B,QAAF,EAAP;AAAoB;;AAAA,MAAMC,CAAN,CAAO;AAAmB,SAAXC,WAAW,CAAC7B,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,IAAIM,CAAJ,EAAR;;AAAc,QAAGuB,KAAK,CAACC,OAAN,CAAc/B,CAAd,CAAH,EAAoB;AAAC,UAAIG,CAAJ;;AAAM,WAAI,MAAME,CAAV,IAAeL,CAAf,EAAiBG,CAAC,GAACA,CAAC,CAAC6B,KAAF,CAAQX,CAAC,CAACpB,CAAD,EAAGI,CAAH,CAAT,CAAD,GAAiBF,CAAC,GAACkB,CAAC,CAACpB,CAAD,EAAGI,CAAH,CAArB;;AAA2B,aAAOF,CAAP;AAAS;;AAAA,WAAOkB,CAAC,CAACpB,CAAD,EAAGD,CAAH,CAAR;AAAc;;AAAuB,SAAhBiC,gBAAgB,CAACjC,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,KAAK4B,WAAL,CAAiB7B,CAAjB,CAAR;AAA4B,QAAG,CAACC,CAAD,IAAIA,CAAC,CAACiC,KAAF,IAAS,CAAb,IAAgBjC,CAAC,CAACkC,MAAF,IAAU,CAA7B,EAA+B,OAAM,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAN;AAAc,UAAMhC,CAAC,GAAC,KAAG,EAAX;AAAA,UAAcE,CAAC,GAAC,CAACJ,CAAC,CAACsB,CAAF,GAAI,KAAGtB,CAAC,CAACiC,KAAV,IAAiB/B,CAAjC;AAAA,UAAmCI,CAAC,GAAC,EAAEN,CAAC,CAACkB,CAAF,GAAI,KAAGlB,CAAC,CAACkC,MAAX,IAAmBhC,CAAxD;AAAA,UAA0DM,CAAC,GAACR,CAAC,CAACiC,KAAF,GAAQ/B,CAAR,GAAU,CAAtE;AAAA,UAAwEQ,CAAC,GAACV,CAAC,CAACkC,MAAF,GAAShC,CAAT,GAAW,CAArF;AAAuF,WAAM,CAACE,CAAC,GAACI,CAAH,EAAKF,CAAC,GAACI,CAAP,EAASA,CAAT,CAAN;AAAkB;;AAAgB,SAATyB,SAAS,CAACpC,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOI,CAAC,GAAC,CAAC,CAAV,EAAY;AAAC,UAAMM,CAAC,GAACV,CAAC,IAAE,KAAK0B,WAAL,CAAiB5B,CAAjB,CAAX;AAA+B,QAAG,CAACY,CAAD,IAAIA,CAAC,CAACqB,KAAF,IAAS,CAAb,IAAgBrB,CAAC,CAACsB,MAAF,IAAU,CAA7B,EAA+B,OAAM,CAAC,IAAD,EAAM,CAAN,EAAQ,CAAR,EAAU,CAAV,EAAY,CAAZ,CAAN;AAAqB,UAAMrB,CAAC,GAAC,KAAG,EAAX;AAAA,UAAcG,CAAC,GAAC,CAACJ,CAAC,CAACU,CAAF,GAAI,KAAGV,CAAC,CAACqB,KAAV,IAAiBpB,CAAjC;AAAA,UAAmCI,CAAC,GAAC,CAACL,CAAC,CAACM,CAAF,GAAI,KAAGN,CAAC,CAACsB,MAAV,IAAkBrB,CAAvD;AAAyDd,IAAAA,CAAC,CAACkC,KAAF,GAAQrB,CAAC,CAACqB,KAAF,GAAQpB,CAAhB,EAAkBd,CAAC,CAACmC,MAAF,GAAStB,CAAC,CAACsB,MAAF,GAASrB,CAApC,EAAsCX,CAAC,KAAGH,CAAC,CAACkC,KAAF,IAAS,CAAT,EAAWlC,CAAC,CAACmC,MAAF,IAAU,CAAxB,CAAvC;AAAkE,UAAMhB,CAAC,GAACnB,CAAC,CAACqC,UAAF,CAAa,IAAb,CAAR;AAAA,UAA2BhB,CAAC,GAACZ,CAAC,CAAC6B,WAAF,CAAcxB,CAAd,EAAgB,CAACA,CAAjB,CAA7B;AAAiDO,IAAAA,CAAC,CAACkB,SAAF,CAAY,KAAGvC,CAAC,CAACkC,KAAL,GAAWjB,CAAvB,EAAyB,KAAGjB,CAAC,CAACmC,MAAL,GAAYjB,CAArC;AAAwC,UAAMU,CAAC,GAAC,IAAIjB,CAAJ,CAAMQ,CAAN,EAAQE,CAAR,CAAR;;AAAmB,YAAOpB,CAAC,CAACqB,IAAT;AAAe,WAAI,gBAAJ;AAAqB;AAAC,gBAAMtB,CAAC,GAAC;AAACsB,YAAAA,IAAI,EAAC,OAAN;AAAcC,YAAAA,CAAC,EAAC,CAAhB;AAAkBJ,YAAAA,CAAC,EAAC;AAApB,WAAR;AAA+BS,UAAAA,CAAC,CAACJ,UAAF,CAAavB,CAAb,EAAeD,CAAf;AAAkB;AAAM;;AAAA,WAAI,iBAAJ;AAAsB;AAAC,gBAAMA,CAAC,GAAC,IAAIK,CAAJ,EAAR;AAAcuB,UAAAA,CAAC,CAACF,UAAF,CAAazB,CAAb,EAAeD,CAAf;AAAkB;AAAM;AAAzJ;;AAA0J,UAAMwC,CAAC,GAACrB,CAAC,CAACsB,YAAF,CAAe,CAAf,EAAiB,CAAjB,EAAmBzC,CAAC,CAACkC,KAArB,EAA2BlC,CAAC,CAACmC,MAA7B,CAAR;AAAA,UAA6CO,CAAC,GAAC,IAAIC,UAAJ,CAAeH,CAAC,CAACI,IAAjB,CAA/C;;AAAsE,QAAGrC,CAAH,EAAK;AAAC,UAAIP,CAAJ;;AAAM,WAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACyC,CAAC,CAACG,MAAhB,EAAuB5C,CAAC,IAAE,CAA1B,EAA4BD,CAAC,GAAC0C,CAAC,CAACzC,CAAC,GAAC,CAAH,CAAD,GAAO,GAAT,EAAayC,CAAC,CAACzC,CAAD,CAAD,GAAKyC,CAAC,CAACzC,CAAD,CAAD,GAAKD,CAAvB,EAAyB0C,CAAC,CAACzC,CAAC,GAAC,CAAH,CAAD,GAAOyC,CAAC,CAACzC,CAAC,GAAC,CAAH,CAAD,GAAOD,CAAvC,EAAyC0C,CAAC,CAACzC,CAAC,GAAC,CAAH,CAAD,GAAOyC,CAAC,CAACzC,CAAC,GAAC,CAAH,CAAD,GAAOD,CAAvD;AAAyD;;AAAA,WAAM,CAAC0C,CAAD,EAAG1C,CAAC,CAACkC,KAAL,EAAWlC,CAAC,CAACmC,MAAb,EAAoB,CAAClB,CAAD,GAAGjB,CAAC,CAACkC,KAAzB,EAA+B,CAAChB,CAAD,GAAGlB,CAAC,CAACmC,MAApC,CAAN;AAAkD;;AAAuB,SAAhBW,gBAAgB,CAAC9C,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,GAAR;AAAA,UAAYE,CAAC,GAAC,EAAd;AAAiB,QAAIE,CAAJ,EAAME,CAAN;AAAQ,UAAME,CAAC,GAACT,CAAC,CAAC+C,KAAV;;AAAgB,QAAG,aAAWtC,CAAX,IAAc,oBAAkBA,CAAnC,EAAqC;AAAC,YAAMT,CAAC,GAAC,GAAR;AAAY,UAAIC,CAAC,GAACc,IAAI,CAACiC,IAAL,CAAU,IAAEhD,CAAC,GAACG,CAAd,CAAN;AAAA,UAAuBM,CAAC,GAACM,IAAI,CAACkC,IAAL,CAAUnC,CAAC,GAACb,CAAF,GAAI,CAAd,CAAzB;AAA0C,YAAIQ,CAAJ,KAAQA,CAAC,GAAC,CAAV,GAAaR,CAAC,GAACgB,CAAC,GAACR,CAAjB,EAAmBA,CAAC,IAAE,CAAtB;AAAwB,YAAME,CAAC,GAAC,EAAR;AAAWA,MAAAA,CAAC,CAACuC,IAAF,CAAO,CAAC/C,CAAD,EAAG,CAAH,CAAP;;AAAc,WAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACI,CAAd,EAAgBJ,CAAC,EAAjB,EAAoBM,CAAC,CAACuC,IAAF,CAAO,CAAC/C,CAAC,GAACY,IAAI,CAACoC,GAAL,CAAS9C,CAAC,GAACJ,CAAX,CAAH,EAAiB,CAACE,CAAD,GAAGY,IAAI,CAACqC,GAAL,CAAS/C,CAAC,GAACJ,CAAX,CAApB,CAAP;;AAA2CU,MAAAA,CAAC,CAACuC,IAAF,CAAO,CAAC/C,CAAD,EAAG,CAAH,CAAP,GAAcE,CAAC,GAAC;AAACgD,QAAAA,KAAK,EAAC,CAAC1C,CAAD;AAAP,OAAhB,EAA4BJ,CAAC,GAAC;AAAC+C,QAAAA,IAAI,EAAC,CAACnD,CAAP;AAASoD,QAAAA,IAAI,EAAC,CAACpD,CAAf;AAAiBqD,QAAAA,IAAI,EAACrD,CAAtB;AAAwBsD,QAAAA,IAAI,EAACtD;AAA7B,OAA9B;AAA8D,KAA1Q,MAA+Q,IAAG,YAAUM,CAAV,IAAa,mBAAiBA,CAAjC,EAAmC;AAAC,YAAMT,CAAC,GAAC,CAAR;AAAUK,MAAAA,CAAC,GAAC;AAACgD,QAAAA,KAAK,EAAC,CAAC,CAAC,CAACrD,CAAD,EAAGG,CAAH,CAAD,EAAO,CAACH,CAAD,EAAGA,CAAH,CAAP,EAAa,CAACG,CAAD,EAAGH,CAAH,CAAb,EAAmB,CAACG,CAAD,EAAG,CAACH,CAAJ,CAAnB,EAA0B,CAACA,CAAD,EAAG,CAACA,CAAJ,CAA1B,EAAiC,CAACA,CAAD,EAAG,CAACG,CAAJ,CAAjC,EAAwC,CAAC,CAACH,CAAF,EAAI,CAACG,CAAL,CAAxC,EAAgD,CAAC,CAACH,CAAF,EAAI,CAACA,CAAL,CAAhD,EAAwD,CAAC,CAACG,CAAF,EAAI,CAACH,CAAL,CAAxD,EAAgE,CAAC,CAACG,CAAF,EAAIH,CAAJ,CAAhE,EAAuE,CAAC,CAACA,CAAF,EAAIA,CAAJ,CAAvE,EAA8E,CAAC,CAACA,CAAF,EAAIG,CAAJ,CAA9E,EAAqF,CAACH,CAAD,EAAGG,CAAH,CAArF,CAAD;AAAP,OAAF,EAAwGI,CAAC,GAAC;AAAC+C,QAAAA,IAAI,EAAC,CAACnD,CAAP;AAASoD,QAAAA,IAAI,EAAC,CAACpD,CAAf;AAAiBqD,QAAAA,IAAI,EAACrD,CAAtB;AAAwBsD,QAAAA,IAAI,EAACtD;AAA7B,OAA1G;AAA0I,KAAxL,MAA6L,IAAG,cAAYM,CAAZ,IAAe,qBAAmBA,CAArC,EAAuCJ,CAAC,GAAC;AAACgD,MAAAA,KAAK,EAAC,CAAC,CAAC,CAAC,CAAClD,CAAF,EAAI,CAAJ,CAAD,EAAQ,CAAC,CAAD,EAAGA,CAAH,CAAR,EAAc,CAACA,CAAD,EAAG,CAAH,CAAd,EAAoB,CAAC,CAAD,EAAG,CAACA,CAAJ,CAApB,EAA2B,CAAC,CAACA,CAAF,EAAI,CAAJ,CAA3B,CAAD;AAAP,KAAF,EAA+CI,CAAC,GAAC;AAAC+C,MAAAA,IAAI,EAAC,CAACnD,CAAP;AAASoD,MAAAA,IAAI,EAAC,CAACpD,CAAf;AAAiBqD,MAAAA,IAAI,EAACrD,CAAtB;AAAwBsD,MAAAA,IAAI,EAACtD;AAA7B,KAAjD,CAAvC,KAA6H,IAAG,aAAWM,CAAX,IAAc,oBAAkBA,CAAnC,EAAqCJ,CAAC,GAAC;AAACgD,MAAAA,KAAK,EAAC,CAAC,CAAC,CAAC,CAAClD,CAAF,EAAI,CAACA,CAAL,CAAD,EAAS,CAAC,CAACA,CAAF,EAAIA,CAAJ,CAAT,EAAgB,CAACA,CAAD,EAAGA,CAAH,CAAhB,EAAsB,CAACA,CAAD,EAAG,CAACA,CAAJ,CAAtB,EAA6B,CAAC,CAACA,CAAF,EAAI,CAACA,CAAL,CAA7B,CAAD;AAAP,KAAF,EAAkDI,CAAC,GAAC;AAAC+C,MAAAA,IAAI,EAAC,CAACnD,CAAP;AAASoD,MAAAA,IAAI,EAAC,CAACpD,CAAf;AAAiBqD,MAAAA,IAAI,EAACrD,CAAtB;AAAwBsD,MAAAA,IAAI,EAACtD;AAA7B,KAApD,CAArC,KAA8H,IAAG,QAAMM,CAAN,IAAS,eAAaA,CAAzB,EAA2B;AAAC,YAAMT,CAAC,GAAC,CAAR;AAAUK,MAAAA,CAAC,GAAC;AAACgD,QAAAA,KAAK,EAAC,CAAC,CAAC,CAAC,CAAD,EAAGrD,CAAH,CAAD,EAAO,CAACG,CAAC,GAACH,CAAH,EAAKG,CAAL,CAAP,EAAe,CAACA,CAAD,EAAGA,CAAC,GAACH,CAAL,CAAf,EAAuB,CAACA,CAAD,EAAG,CAAH,CAAvB,EAA6B,CAACG,CAAD,EAAGH,CAAC,GAACG,CAAL,CAA7B,EAAqC,CAACA,CAAC,GAACH,CAAH,EAAK,CAACG,CAAN,CAArC,EAA8C,CAAC,CAAD,EAAG,CAACH,CAAJ,CAA9C,EAAqD,CAACA,CAAC,GAACG,CAAH,EAAK,CAACA,CAAN,CAArD,EAA8D,CAAC,CAACA,CAAF,EAAIH,CAAC,GAACG,CAAN,CAA9D,EAAuE,CAAC,CAACH,CAAF,EAAI,CAAJ,CAAvE,EAA8E,CAAC,CAACG,CAAF,EAAIA,CAAC,GAACH,CAAN,CAA9E,EAAuF,CAACA,CAAC,GAACG,CAAH,EAAKA,CAAL,CAAvF,EAA+F,CAAC,CAAD,EAAGH,CAAH,CAA/F,CAAD;AAAP,OAAF,EAAkHO,CAAC,GAAC;AAAC+C,QAAAA,IAAI,EAAC,CAACnD,CAAP;AAASoD,QAAAA,IAAI,EAAC,CAACpD,CAAf;AAAiBqD,QAAAA,IAAI,EAACrD,CAAtB;AAAwBsD,QAAAA,IAAI,EAACtD;AAA7B,OAApH;AAAoJ,KAA1L,MAA+L,IAAG,eAAaM,CAAb,IAAgB,sBAAoBA,CAAvC,EAAyC;AAAC,YAAMT,CAAC,GAACC,CAAC,GAAC,iBAAV;AAAA,YAA4BE,CAAC,GAAC,CAACH,CAA/B;AAAA,YAAiCS,CAAC,GAAC,IAAE,CAAF,GAAIR,CAAvC;AAAA,YAAyCU,CAAC,GAACF,CAAC,GAACR,CAA7C;AAA+CI,MAAAA,CAAC,GAAC;AAACgD,QAAAA,KAAK,EAAC,CAAC,CAAC,CAAClD,CAAD,EAAGQ,CAAH,CAAD,EAAO,CAAC,CAAD,EAAGF,CAAH,CAAP,EAAa,CAACT,CAAD,EAAGW,CAAH,CAAb,EAAmB,CAACR,CAAD,EAAGQ,CAAH,CAAnB,CAAD;AAAP,OAAF,EAAsCJ,CAAC,GAAC;AAAC+C,QAAAA,IAAI,EAACnD,CAAN;AAAQoD,QAAAA,IAAI,EAAC5C,CAAb;AAAe6C,QAAAA,IAAI,EAACxD,CAApB;AAAsByD,QAAAA,IAAI,EAAChD;AAA3B,OAAxC;AAAsE,KAA/J,MAAmK,YAAUA,CAAV,IAAa,mBAAiBA,CAA9B,KAAkCJ,CAAC,GAAC;AAACgD,MAAAA,KAAK,EAAC,CAAC,CAAC,CAAC,CAAC,EAAF,EAAK,EAAL,CAAD,EAAU,CAAC,EAAD,EAAI,CAAJ,CAAV,EAAiB,CAAC,CAAC,EAAF,EAAK,CAAC,EAAN,CAAjB,EAA2B,CAAC,CAAC,EAAF,EAAK,CAAC,EAAN,CAA3B,EAAqC,CAAC,CAAC,EAAF,EAAK,EAAL,CAArC,EAA8C,CAAC,CAAC,EAAF,EAAK,EAAL,CAA9C,CAAD;AAAP,KAAF,EAAoE9C,CAAC,GAAC;AAAC+C,MAAAA,IAAI,EAAC,CAACnD,CAAP;AAASoD,MAAAA,IAAI,EAAC,CAACpD,CAAf;AAAiBqD,MAAAA,IAAI,EAACrD,CAAtB;AAAwBsD,MAAAA,IAAI,EAACtD;AAA7B,KAAxG;;AAAyI,QAAIQ,CAAJ;;AAAM,QAAGN,CAAC,IAAEE,CAAN,EAAQ;AAAC,YAAMN,CAAC,GAAC,CAAC;AAACqB,QAAAA,IAAI,EAAC,cAAN;AAAqBoC,QAAAA,MAAM,EAAC,CAAC,CAA7B;AAA+BC,QAAAA,KAAK,EAAC3D,CAAC,CAAC2D;AAAvC,OAAD,CAAR;AAAwD3D,MAAAA,CAAC,CAAC4D,OAAF,IAAW3D,CAAC,CAACiD,IAAF,CAAO;AAAC5B,QAAAA,IAAI,EAAC,gBAAN;AAAuBoC,QAAAA,MAAM,EAAC,CAAC,CAA/B;AAAiCxB,QAAAA,KAAK,EAAClC,CAAC,CAAC4D,OAAF,CAAU1B,KAAjD;AAAuDyB,QAAAA,KAAK,EAAC3D,CAAC,CAAC4D,OAAF,CAAUD;AAAvE,OAAP,CAAX;AAAiG,YAAMxD,CAAC,GAAC;AAACmB,QAAAA,IAAI,EAAC,kBAAN;AAAyBuC,QAAAA,YAAY,EAAC5D;AAAtC,OAAR;AAAiDU,MAAAA,CAAC,GAAC;AAACW,QAAAA,IAAI,EAAC,gBAAN;AAAuBuC,QAAAA,YAAY,EAAC,CAAC;AAACvC,UAAAA,IAAI,EAAC,iBAAN;AAAwBoC,UAAAA,MAAM,EAAC,CAAC,CAAhC;AAAkCI,UAAAA,QAAQ,EAAC9D,CAAC,CAAC+D,KAA7C;AAAmDC,UAAAA,IAAI,EAAChE,CAAC,CAACgE,IAA1D;AAA+DC,UAAAA,OAAO,EAACjE,CAAC,CAACkE,OAAzE;AAAiFC,UAAAA,OAAO,EAACnE,CAAC,CAACoE,OAA3F;AAAmGC,UAAAA,KAAK,EAAC9D,CAAzG;AAA2G+D,UAAAA,cAAc,EAAC,CAAC;AAAChD,YAAAA,IAAI,EAAC,kBAAN;AAAyBiD,YAAAA,QAAQ,EAAClE,CAAlC;AAAoCoB,YAAAA,MAAM,EAACtB;AAA3C,WAAD;AAA1H,SAAD;AAApC,OAAF;AAAoN;;AAAA,WAAOQ,CAAP;AAAS;;AAAuB,SAAhB6D,gBAAgB,CAACxE,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,KAAK,CAAL,KAASD,CAAC,CAACyE,UAAX,GAAsBzE,CAAC,CAACyE,UAAxB,GAAmCvD,CAA3C;AAAA,UAA6Cf,CAAC,GAACF,CAAC,GAAC,CAAjD;AAAmD,QAAII,CAAC,GAAC,KAAKqE,oBAAL,CAA0B1E,CAAC,CAAC2E,UAA5B,KAAyCzD,CAA/C;;AAAiD,WAAKb,CAAC,GAAC,CAAP,GAAUA,CAAC,IAAE,CAAH;;AAAK,UAAME,CAAC,GAACF,CAAC,GAAC,CAAV;AAAY,WAAM;AAACiB,MAAAA,IAAI,EAAC,iBAAN;AAAwB+C,MAAAA,KAAK,EAAC;AAACf,QAAAA,IAAI,EAAC,CAAC/C,CAAP;AAASiD,QAAAA,IAAI,EAACjD,CAAd;AAAgBgD,QAAAA,IAAI,EAAC,CAACpD,CAAtB;AAAwBsD,QAAAA,IAAI,EAACtD;AAA7B,OAA9B;AAA8DmE,MAAAA,cAAc,EAAC,CAAC;AAAChD,QAAAA,IAAI,EAAC,kBAAN;AAAyBiD,QAAAA,QAAQ,EAAC;AAACK,UAAAA,KAAK,EAAC,CAAC,CAAC,CAAC,CAACrE,CAAF,EAAI,CAAJ,CAAD,EAAQ,CAACA,CAAD,EAAG,CAAH,CAAR,CAAD;AAAP,SAAlC;AAA2DkB,QAAAA,MAAM,EAACzB,CAAC,CAAC2E;AAApE,OAAD,CAA7E;AAA+JX,MAAAA,IAAI,EAAC/D;AAApK,KAAN;AAA6K;;AAA2B,SAApByE,oBAAoB,CAAC1E,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK;AAAC,YAAMC,CAAC,GAAC,KAAK4E,iBAAL,CAAuB7E,CAAC,CAAC8E,OAAzB,CAAR;;AAA0C,UAAG7E,CAAH,EAAK,OAAOA,CAAP;AAAS,UAAGD,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAM1D,CAAV,IAAeH,CAAC,CAAC6D,YAAjB,EAA8B;AAAC,cAAM7D,CAAC,GAAC,KAAK6E,iBAAL,CAAuB1E,CAAC,CAAC2E,OAAzB,CAAR;;AAA0C,YAAG9E,CAAH,EAAK,OAAOA,CAAP;;AAAS,YAAGG,CAAH,EAAK;AAAC,gBAAMH,CAAC,GAAC,KAAK+E,mBAAL,CAAyB5E,CAAC,CAAC6E,eAA3B,CAAR;;AAAoD,cAAGhF,CAAH,EAAK,OAAOA,CAAP;AAAS;AAAC;AAAC;;AAAA,WAAO,CAAP;AAAS;;AAAwB,SAAjB6E,iBAAiB,CAAC7E,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK,KAAI,MAAMC,CAAV,IAAeD,CAAf,EAAiB,IAAGC,CAAH,EAAK,QAAOA,CAAC,CAACqB,IAAT;AAAe,WAAI,0BAAJ;AAA+B;AAAC,gBAAMtB,CAAC,GAACC,CAAC,CAACgF,YAAV;;AAAuB,cAAGjF,CAAC,IAAEA,CAAC,CAAC6C,MAAR,EAAe;AAAC,gBAAI5C,CAAC,GAAC,CAAN;;AAAQ,iBAAI,MAAME,CAAV,IAAeH,CAAf,EAAiBC,CAAC,IAAEE,CAAH;;AAAK,mBAAO,IAAEH,CAAC,CAAC6C,MAAJ,KAAa5C,CAAC,IAAE,CAAhB,GAAmBA,CAA1B;AAA4B;;AAAA;AAAM;;AAAA,WAAI,wBAAJ;AAA6B,eAAOA,CAAC,CAACiF,MAAT;;AAAgB;AAAQ/D,QAAAA,CAAC,CAACgE,KAAF,CAAS,qCAAoClF,CAAC,CAACqB,IAAK,EAApD;AAA3M;AAAkQ,WAAO,CAAP;AAAS;;AAA0B,SAAnByD,mBAAmB,CAAC/E,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK,QAAOA,CAAC,CAACsB,IAAT;AAAe,WAAI,qCAAJ;AAA0C,WAAI,uCAAJ;AAA4C,WAAI,yCAAJ;AAA8C;AAAC,gBAAMrB,CAAC,GAACD,CAAC,CAACoF,iBAAV;;AAA4B,cAAGnF,CAAC,IAAEA,CAAC,CAAC4C,MAAR,EAAe;AAAC,gBAAI7C,CAAC,GAAC,CAAN;;AAAQ,iBAAI,MAAMG,CAAV,IAAeF,CAAf,EAAiBD,CAAC,IAAEG,CAAH;;AAAK,mBAAO,IAAEF,CAAC,CAAC4C,MAAJ,KAAa7C,CAAC,IAAE,CAAhB,GAAmBA,CAA1B;AAA4B;;AAAA;AAAM;AAAhQ;AAAiQ,WAAO,CAAP;AAAS;;AAA2B,SAApBqF,oBAAoB,CAACrF,CAAD,EAAG;AAAC,UAAMC,CAAC,GAACD,CAAC,CAACgF,eAAV;AAAA,UAA0B7E,CAAC,GAAC;AAACmB,MAAAA,IAAI,EAACtB,CAAC,CAACsB,IAAR;AAAa,SAAGtB;AAAhB,KAA5B;AAA+C,QAAIK,CAAJ,EAAME,CAAN,EAAQE,CAAR,EAAUE,CAAV;;AAAY,QAAGR,CAAC,CAAC6E,eAAF,GAAkB,IAAlB,EAAuB7E,CAAC,CAACmF,WAAF,GAAc,IAArC,EAA0C,CAAC,CAAD,KAAKrF,CAAC,CAACsF,YAApD,EAAiE;AAAChF,MAAAA,CAAC,GAACN,CAAC,CAACuF,KAAF,GAAQ,CAAV,EAAY/E,CAAC,GAACR,CAAC,CAACwF,KAAhB,EAAsB9E,CAAC,GAAC,IAAEV,CAAC,CAACwF,KAA5B;AAAkCpF,MAAAA,CAAC,GAAC,CAAC;AAACkB,QAAAA,CAAC,EAAC,CAAChB,CAAJ;AAAMY,QAAAA,CAAC,EAAC;AAAR,OAAD,EAAY;AAACI,QAAAA,CAAC,EAAChB,CAAH;AAAKY,QAAAA,CAAC,EAAC;AAAP,OAAZ,EAAsB;AAACI,QAAAA,CAAC,EAAC,CAAH;AAAKJ,QAAAA,CAAC,EAACV;AAAP,OAAtB,EAAgC;AAACc,QAAAA,CAAC,EAAC,CAAH;AAAKJ,QAAAA,CAAC,EAAC,CAACV;AAAR,OAAhC,EAA4CiF,GAA5C,CAAiD1F,CAAC,KAAG;AAACsB,QAAAA,IAAI,EAAC,kBAAN;AAAyBiD,QAAAA,QAAQ,EAACvE,CAAlC;AAAoCyB,QAAAA,MAAM,EAAC;AAACH,UAAAA,IAAI,EAAC,gBAAN;AAAuBuC,UAAAA,YAAY,EAAC,CAAC1D,CAAD;AAApC;AAA3C,OAAH,CAAlD,CAAF;AAA+I,KAAnP,MAAwPI,CAAC,GAACN,CAAC,CAACuF,KAAF,GAAQ,CAAV,EAAY/E,CAAC,GAACR,CAAC,CAACwF,KAAF,GAAQ,CAAtB,EAAwB9E,CAAC,GAACV,CAAC,CAACwF,KAA5B,EAAkCpF,CAAC,GAAC,CAAC;AAACiB,MAAAA,IAAI,EAAC,kBAAN;AAAyBiD,MAAAA,QAAQ,EAAC;AAAChD,QAAAA,CAAC,EAAC,CAAH;AAAKJ,QAAAA,CAAC,EAAC;AAAP,OAAlC;AAA4CM,MAAAA,MAAM,EAAC;AAACH,QAAAA,IAAI,EAAC,gBAAN;AAAuBuC,QAAAA,YAAY,EAAC,CAAC1D,CAAD;AAApC;AAAnD,KAAD,CAApC;;AAAmI,WAAM;AAACmB,MAAAA,IAAI,EAAC,iBAAN;AAAwB+C,MAAAA,KAAK,EAAC;AAACf,QAAAA,IAAI,EAAC,CAAC/C,CAAP;AAASiD,QAAAA,IAAI,EAACjD,CAAd;AAAgBgD,QAAAA,IAAI,EAAC,CAAC9C,CAAtB;AAAwBgD,QAAAA,IAAI,EAAChD;AAA7B,OAA9B;AAA8D6D,MAAAA,cAAc,EAACjE,CAA7E;AAA+E2D,MAAAA,IAAI,EAACrD;AAApF,KAAN;AAA6F;;AAAmB,SAAZgF,YAAY,CAAC3F,CAAD,EAAG;AAAC,QAAG,CAACA,CAAJ,EAAM,OAAO,IAAP;;AAAY,YAAOA,CAAC,CAACsB,IAAT;AAAe,WAAI,kBAAJ;AAAuB,YAAGtB,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAM5D,CAAV,IAAeD,CAAC,CAAC6D,YAAjB,EAA8B;AAAC,gBAAM7D,CAAC,GAAC4B,CAAC,CAAC+D,YAAF,CAAe1F,CAAf,CAAR;AAA0B,cAAG,QAAMD,CAAT,EAAW,OAAOA,CAAP;AAAS;AAAA;;AAAM,WAAI,eAAJ;AAAoB,eAAO4B,CAAC,CAAC+D,YAAF,CAAe3F,CAAC,CAACyB,MAAjB,CAAP;;AAAgC,WAAI,cAAJ;AAAmB,eAAOzB,CAAC,CAAC2D,KAAT;AAAlN;AAAkO;;AAAqB,SAAdiC,cAAc,CAAC5F,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK,QAAOA,CAAC,CAACsB,IAAT;AAAe,WAAI,kBAAJ;AAAuB,WAAI,eAAJ;AAAoB,YAAGtB,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAM5D,CAAV,IAAeD,CAAC,CAAC6D,YAAjB,EAA8B;AAAC,gBAAM7D,CAAC,GAAC4B,CAAC,CAACgE,cAAF,CAAiB3F,CAAjB,CAAR;AAA4B,cAAG,KAAK,CAAL,KAASD,CAAZ,EAAc,OAAOA,CAAP;AAAS;AAAA;;AAAM,WAAI,eAAJ;AAAoB,eAAO4B,CAAC,CAACgE,cAAF,CAAiB5F,CAAC,CAACyB,MAAnB,CAAP;;AAAkC,WAAI,gBAAJ;AAAqB,eAAOzB,CAAC,CAAC2D,KAAT;AAA/O;AAA+P;;AAAqB,SAAdkC,cAAc,CAAC7F,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK,QAAOA,CAAC,CAACsB,IAAT;AAAe,WAAI,kBAAJ;AAAuB,WAAI,eAAJ;AAAoB,YAAGtB,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAM5D,CAAV,IAAeD,CAAC,CAAC6D,YAAjB,EAA8B;AAAC,gBAAM7D,CAAC,GAAC4B,CAAC,CAACiE,cAAF,CAAiB5F,CAAjB,CAAR;AAA4B,cAAG,KAAK,CAAL,KAASD,CAAZ,EAAc,OAAOA,CAAP;AAAS;AAAA;;AAAM,WAAI,eAAJ;AAAoB,eAAO4B,CAAC,CAACiE,cAAF,CAAiB7F,CAAC,CAACyB,MAAnB,CAAP;;AAAkC,WAAI,gBAAJ;AAAqB,WAAI,mBAAJ;AAAwB,WAAI,kBAAJ;AAAuB,eAAOzB,CAAC,CAACkC,KAAT;AAA9R;AAA8S;;AAAc,SAAP4D,OAAO,CAAC9F,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK,QAAOA,CAAC,CAACsB,IAAT;AAAe,WAAI,gBAAJ;AAAqB,WAAI,eAAJ;AAAoB,WAAI,kBAAJ;AAAuB;AAAC,cAAIrB,CAAC,GAAC,CAAN;AAAQ,cAAGD,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAM1D,CAAV,IAAeH,CAAC,CAAC6D,YAAjB,EAA8B;AAAC,kBAAM7D,CAAC,GAAC4B,CAAC,CAACkE,OAAF,CAAU3F,CAAV,CAAR;AAAqBH,YAAAA,CAAC,GAACC,CAAF,KAAMA,CAAC,GAACD,CAAR;AAAW;AAAA,iBAAOC,CAAP;AAAS;;AAAA,WAAI,gBAAJ;AAAqB,WAAI,kBAAJ;AAAuB,WAAI,mBAAJ;AAAwB,eAAOD,CAAC,CAACkC,KAAT;;AAAe,WAAI,oBAAJ;AAAyB,WAAI,kBAAJ;AAAuB,WAAI,iBAAJ;AAAsB,eAAOlC,CAAC,CAACgE,IAAT;AAA3U;AAA0V;;AAA0B,SAAnB+B,mBAAmB,CAAC/F,CAAD,EAAG;AAAC,QAAGA,CAAH,EAAK,QAAOA,CAAC,CAACsB,IAAT;AAAe,WAAI,iBAAJ;AAAsB,YAAG,CAAC,CAAD,KAAKtB,CAAC,CAACgG,0BAAP,IAAmChG,CAAC,CAACqE,KAAxC,EAA8C;AAAC,gBAAMpE,CAAC,GAACD,CAAC,CAACqE,KAAF,CAAQZ,IAAR,GAAazD,CAAC,CAACqE,KAAF,CAAQd,IAA7B;AAAkC,iBAAOvD,CAAC,CAACgE,IAAF,GAAO/D,CAAd;AAAgB;;AAAtI;AAAuI,WAAO,CAAP;AAAS;;AAA/1L;;AAAg2L,MAAMuC,CAAN,CAAO;AAA2B,SAAnByD,mBAAmB,CAACjG,CAAD,EAAGC,CAAH,EAAKI,CAAL,EAAO;AAAC,gBAAUJ,CAAV,IAAa,WAASA,CAAtB,IAAyB,mBAAiBA,CAA1C,IAA6C,kBAAgBA,CAA7D,IAAgEiG,OAAO,CAACf,KAAR,CAAc,kDAAd,CAAhE;AAAkI,UAAM5E,CAAC,GAACJ,CAAC,CAACY,IAAI,CAACkC,IAAL,CAAU5C,CAAV,CAAD,CAAT;AAAA,UAAwBI,CAAC,GAAC,KAAK0F,uBAAL,CAA6BlG,CAA7B,IAAgC,IAAEM,CAAlC,GAAoC,KAAGA,CAAjE;AAAA,UAAmEI,CAAC,GAAC,IAAEJ,CAAvE;AAAyEP,IAAAA,CAAC,CAACkC,KAAF,GAAQzB,CAAR,EAAUT,CAAC,CAACmC,MAAF,GAAS1B,CAAnB;AAAqB,UAAMI,CAAC,GAACb,CAAC,CAACqC,UAAF,CAAa,IAAb,CAAR;AAA2BxB,IAAAA,CAAC,CAACuF,WAAF,GAAc,SAAd,EAAwBvF,CAAC,CAACwF,SAAF,GAAY9F,CAApC,EAAsCM,CAAC,CAACyF,SAAF,EAAtC,EAAoD,eAAarG,CAAb,IAAgB,YAAUA,CAA1B,IAA6B,mBAAiBA,CAA9C,IAAiD,sBAAoBA,CAArE,KAAyEY,CAAC,CAAC0F,MAAF,CAAS9F,CAAC,GAAC,CAAX,EAAa,CAACE,CAAd,GAAiBE,CAAC,CAAC2F,MAAF,CAAS/F,CAAC,GAAC,CAAX,EAAaA,CAAC,GAACE,CAAf,CAA1F,CAApD,EAAiK,iBAAeV,CAAf,IAAkB,YAAUA,CAA5B,IAA+B,mBAAiBA,CAAhD,IAAmD,wBAAsBA,CAAzE,KAA6EY,CAAC,CAAC0F,MAAF,CAAS,CAAC5F,CAAV,EAAYF,CAAC,GAAC,CAAd,GAAiBI,CAAC,CAAC2F,MAAF,CAAS/F,CAAC,GAACE,CAAX,EAAaF,CAAC,GAAC,CAAf,CAA9F,CAAjK,EAAkR,uBAAqBR,CAArB,IAAwB,qBAAmBA,CAA3C,IAA8C,2BAAyBA,CAAvE,IAA0E,6BAA2BA,CAArG,KAAyGY,CAAC,CAAC0F,MAAF,CAAS,CAAC5F,CAAV,EAAY,CAACA,CAAb,GAAgBE,CAAC,CAAC2F,MAAF,CAAS/F,CAAC,GAACE,CAAX,EAAaF,CAAC,GAACE,CAAf,CAAhB,EAAkCE,CAAC,CAAC0F,MAAF,CAAS9F,CAAC,GAACE,CAAX,EAAa,CAACA,CAAd,CAAlC,EAAmDE,CAAC,CAAC2F,MAAF,CAAS/F,CAAC,GAACE,CAAX,EAAaA,CAAb,CAAnD,EAAmEE,CAAC,CAAC0F,MAAF,CAAS,CAAC5F,CAAV,EAAYF,CAAC,GAACE,CAAd,CAAnE,EAAoFE,CAAC,CAAC2F,MAAF,CAAS7F,CAAT,EAAWF,CAAC,GAACE,CAAb,CAA7L,CAAlR,EAAge,wBAAsBV,CAAtB,IAAyB,qBAAmBA,CAA5C,IAA+C,8BAA4BA,CAA3E,IAA8E,2BAAyBA,CAAvG,KAA2GY,CAAC,CAAC0F,MAAF,CAAS9F,CAAC,GAACE,CAAX,EAAa,CAACA,CAAd,GAAiBE,CAAC,CAAC2F,MAAF,CAAS,CAAC7F,CAAV,EAAYF,CAAC,GAACE,CAAd,CAAjB,EAAkCE,CAAC,CAAC0F,MAAF,CAAS5F,CAAT,EAAW,CAACA,CAAZ,CAAlC,EAAiDE,CAAC,CAAC2F,MAAF,CAAS,CAAC7F,CAAV,EAAYA,CAAZ,CAAjD,EAAgEE,CAAC,CAAC0F,MAAF,CAAS9F,CAAC,GAACE,CAAX,EAAaF,CAAC,GAACE,CAAf,CAAhE,EAAkFE,CAAC,CAAC2F,MAAF,CAAS/F,CAAC,GAACE,CAAX,EAAaF,CAAC,GAACE,CAAf,CAA7L,CAAhe,EAAgrBE,CAAC,CAAC4F,MAAF,EAAhrB;AAA2rB,UAAM3F,CAAC,GAACD,CAAC,CAAC4B,YAAF,CAAe,CAAf,EAAiB,CAAjB,EAAmBzC,CAAC,CAACkC,KAArB,EAA2BlC,CAAC,CAACmC,MAA7B,CAAR;AAAA,UAA6ClB,CAAC,GAAC,IAAI0B,UAAJ,CAAe7B,CAAC,CAAC8B,IAAjB,CAA/C;AAAsE,QAAI1B,CAAJ;;AAAM,SAAI,IAAIf,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACc,CAAC,CAAC4B,MAAhB,EAAuB1C,CAAC,IAAE,CAA1B,EAA4Be,CAAC,GAACD,CAAC,CAACd,CAAC,GAAC,CAAH,CAAD,GAAO,GAAT,EAAac,CAAC,CAACd,CAAD,CAAD,GAAKc,CAAC,CAACd,CAAD,CAAD,GAAKe,CAAvB,EAAyBD,CAAC,CAACd,CAAC,GAAC,CAAH,CAAD,GAAOc,CAAC,CAACd,CAAC,GAAC,CAAH,CAAD,GAAOe,CAAvC,EAAyCD,CAAC,CAACd,CAAC,GAAC,CAAH,CAAD,GAAOc,CAAC,CAACd,CAAC,GAAC,CAAH,CAAD,GAAOe,CAAvD;;AAAyD,WAAM,CAACD,CAAD,EAAGjB,CAAC,CAACkC,KAAL,EAAWlC,CAAC,CAACmC,MAAb,CAAN;AAA2B;;AAA0B,SAAnBuE,mBAAmB,CAAC1G,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAJ;;AAAM,YAAOF,CAAP;AAAU,WAAI,MAAJ;AAAWE,QAAAA,CAAC,GAAC,MAAF;AAAS;;AAAM,WAAI,QAAJ;AAAaA,QAAAA,CAAC,GAAC,QAAF;AAAW;;AAAM;AAAQA,QAAAA,CAAC,GAAC,OAAF;AAA1E;;AAAoF,UAAME,CAAC,GAAC,WAASF,CAAjB;AAAmB,QAAII,CAAJ;;AAAM,YAAOP,CAAP;AAAU,WAAI,MAAJ;AAAW,WAAI,aAAJ;AAAkBO,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAAD,GAAO,CAAC,CAAD,EAAG,CAAH,CAAV;AAAgB;;AAAM,WAAI,UAAJ;AAAe,WAAI,gBAAJ;AAAqBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAD,GAAW,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAd;AAAwB;;AAAM,WAAI,KAAJ;AAAU,WAAI,YAAJ;AAAiBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAAD,GAAO,CAAC,CAAD,EAAG,CAAH,CAAV;AAAgB;;AAAM,WAAI,WAAJ;AAAgB,WAAI,iBAAJ;AAAsBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAAD,GAAO,CAAC,CAAD,EAAG,CAAH,CAAV;AAAgB;;AAAM,WAAI,eAAJ;AAAoB,WAAI,oBAAJ;AAAyBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAD,GAAW,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAd;AAAwB;;AAAM,WAAI,mBAAJ;AAAwB,WAAI,mBAAJ;AAAwBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAD,GAAe,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAlB;AAAgC;;AAAM,WAAI,YAAJ;AAAiB,WAAI,kBAAJ;AAAuBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAAD,GAAO,CAAC,CAAD,EAAG,CAAH,CAAV;AAAgB;;AAAM,WAAI,gBAAJ;AAAqB,WAAI,qBAAJ;AAA0BE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAD,GAAW,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAd;AAAwB;;AAAM,WAAI,oBAAJ;AAAyB,WAAI,wBAAJ;AAA6BE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAD,GAAe,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAlB;AAAgC;;AAAM,WAAI,WAAJ;AAAgB,WAAI,iBAAJ;AAAsBE,QAAAA,CAAC,GAACF,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAAD,GAAO,CAAC,CAAD,EAAG,CAAH,CAAV;AAAgB;;AAAM,WAAI,OAAJ;AAAY,WAAI,cAAJ;AAAmB,WAAI,MAAJ;AAAWc,QAAAA,CAAC,CAACgE,KAAF,CAAQ,kDAAR,GAA4D5E,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAA9D;AAAoE;;AAAM;AAAQY,QAAAA,CAAC,CAACgE,KAAF,CAAS,0DAAyDnF,CAAE,GAApE,GAAwEO,CAAC,GAAC,CAAC,CAAD,EAAG,CAAH,CAA1E;AAA5yB;;AAA43B,WAAO,KAAKoG,aAAL,CAAmBpG,CAAnB,EAAqBJ,CAArB,CAAP;AAA+B;;AAAoB,SAAbwG,aAAa,CAAC3G,CAAD,EAAGC,CAAH,EAAK;AAAC,UAAME,CAAC,GAAC,WAASF,CAAjB;AAAA,UAAmBI,CAAC,GAAC,aAAWJ,CAAhC;AAAA,UAAkCM,CAAC,GAAC,CAACJ,CAAD,IAAI,CAACE,CAAzC;AAA2CL,IAAAA,CAAC,CAAC6C,MAAF,GAAS,CAAT,IAAY,CAAZ,KAAgB7C,CAAC,GAAC,CAAC,GAAGA,CAAJ,EAAM,GAAGA,CAAT,CAAlB;AAA+B,UAAMS,CAAC,GAAC,IAAR;AAAA,UAAaE,CAAC,GAAC,IAAEF,CAAjB;AAAmB,QAAIK,CAAC,GAAC,CAAN;;AAAQ,SAAI,MAAMD,CAAV,IAAeb,CAAf,EAAiBc,CAAC,IAAED,CAAH;;AAAK,UAAMI,CAAC,GAACF,IAAI,CAAC6F,KAAL,CAAW9F,CAAC,GAACL,CAAb,CAAR;AAAA,UAAwBS,CAAC,GAAC,IAAI2F,YAAJ,CAAiB5F,CAAC,GAACN,CAAnB,CAA1B;AAAA,UAAgDQ,CAAC,GAAC,KAAGV,CAArD;AAAuD,QAAIY,CAAC,GAAC,CAAN;AAAA,QAAQO,CAAC,GAAC,CAAV;AAAA,QAAYY,CAAC,GAAC,EAAd;AAAA,QAAiBE,CAAC,GAAC,CAAC,CAApB;;AAAsB,SAAI,MAAM7B,CAAV,IAAeb,CAAf,EAAiB;AAAC,WAAIqB,CAAC,GAACO,CAAF,EAAIA,CAAC,IAAEf,CAAC,GAACJ,CAAb,EAAe+B,CAAC,IAAEZ,CAAlB,GAAqB;AAAC,YAAI5B,CAAC,GAAC,EAAN;;AAAS,eAAKA,CAAC,GAACW,CAAP,GAAU;AAAC,gBAAMV,CAAC,GAAC,CAACD,CAAC,GAAC,EAAH,IAAOiB,CAAP,GAASuB,CAAT,GAAW,EAAnB;AAAA,gBAAsB7B,CAAC,GAACJ,CAAC,GAAC,CAACP,CAAC,GAACS,CAAH,KAAOT,CAAC,GAACS,CAAT,CAAD,GAAaM,IAAI,CAAC+F,GAAL,CAAS9G,CAAC,GAACS,CAAX,CAAtC;AAAoDS,UAAAA,CAAC,CAACjB,CAAD,CAAD,GAAKyC,CAAC,GAACvC,CAAC,GAACY,IAAI,CAACgG,GAAL,CAAShG,IAAI,CAACgG,GAAL,CAAS1F,CAAC,GAACF,CAAF,GAAIqB,CAAb,EAAe7B,CAAf,CAAT,EAA2BI,IAAI,CAACgG,GAAL,CAASvE,CAAC,GAACZ,CAAF,GAAIT,CAAb,EAAeR,CAAf,CAA3B,CAAD,GAA+CA,CAAjD,GAAmDJ,CAAC,GAACQ,IAAI,CAACiG,GAAL,CAAS,CAACxE,CAAC,GAACnB,CAAH,KAAOmB,CAAC,GAACnB,CAAT,IAAYV,CAArB,EAAuB,CAAC6B,CAAC,GAACZ,CAAH,KAAOY,CAAC,GAACZ,CAAT,IAAYjB,CAAnC,CAAD,GAAuCN,CAAC,GAACU,IAAI,CAACiG,GAAL,CAASjG,IAAI,CAACgG,GAAL,CAASvE,CAAC,GAACnB,CAAX,EAAaV,CAAb,CAAT,EAAyBI,IAAI,CAACgG,GAAL,CAASnF,CAAC,GAACY,CAAX,EAAa7B,CAAb,CAAzB,CAAD,GAA2CI,IAAI,CAACiG,GAAL,CAASjG,IAAI,CAACgG,GAAL,CAASvE,CAAC,GAACnB,CAAF,GAAIF,CAAb,EAAeR,CAAf,CAAT,EAA2BI,IAAI,CAACgG,GAAL,CAASnF,CAAC,GAACT,CAAF,GAAIqB,CAAb,EAAe7B,CAAf,CAA3B,CAA7I,EAA2LX,CAAC,EAA5L;AAA+L;;AAAAwC,QAAAA,CAAC;AAAG;;AAAAE,MAAAA,CAAC,GAAC,CAACA,CAAH;AAAK;;AAAA,UAAMuE,CAAC,GAAC/F,CAAC,CAAC2B,MAAV;AAAA,UAAiBqE,CAAC,GAAC,IAAIvE,UAAJ,CAAe,IAAEsE,CAAjB,CAAnB;;AAAuC,SAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACF,CAAd,EAAgB,EAAEE,CAAlB,EAAoB;AAAC,YAAMnH,CAAC,GAAC,CAACO,CAAC,GAACQ,IAAI,CAACqG,IAAL,CAAUlG,CAAC,CAACiG,CAAD,CAAX,CAAD,GAAiBjG,CAAC,CAACiG,CAAD,CAApB,IAAyB1G,CAAjC;AAAmCI,MAAAA,CAAC,CAACb,CAAD,EAAGkH,CAAH,EAAK,IAAEC,CAAP,CAAD;AAAW;;AAAA,WAAM,CAACD,CAAD,EAAGjG,CAAH,EAAKN,CAAL,CAAN;AAAc;;AAA8B,SAAvBwF,uBAAuB,CAACnG,CAAD,EAAG;AAAC,WAAM,eAAaA,CAAb,IAAgB,iBAAeA,CAA/B,IAAkC,YAAUA,CAA5C,IAA+C,mBAAiBA,CAAhE,IAAmE,sBAAoBA,CAAvF,IAA0F,wBAAsBA,CAAtH;AAAwH;;AAA/+F;;AAAg/F,MAAM0C,CAAN,CAAO;AAA+B,SAAvB2E,uBAAuB,CAACrH,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,QAAGF,CAAH,EAAK;AAAC,UAAGD,CAAC,CAACsH,aAAL,EAAmB;AAAC,YAAIjH,CAAC,GAAC,CAAC,CAAP;;AAAS,aAAI,MAAMJ,CAAV,IAAeE,CAAf,EAAiB,IAAGF,CAAC,CAACqH,aAAF,KAAkBtH,CAAC,CAACsH,aAAvB,EAAqC;AAACjH,UAAAA,CAAC,GAAC,CAAC,CAAH;AAAK;AAAM;;AAAA,YAAG,CAACA,CAAJ,EAAM,KAAI,MAAME,CAAV,IAAeN,CAAf,EAAiBM,CAAC,CAAC+G,aAAF,KAAkBtH,CAAC,CAACsH,aAApB,IAAmCnH,CAAC,CAAC+C,IAAF,CAAO3C,CAAP,CAAnC;AAA6C;;AAAA,cAAOP,CAAC,CAACsB,IAAT;AAAe,aAAI,gBAAJ;AAAqB,aAAI,eAAJ;AAAoB,aAAI,kBAAJ;AAAuB,cAAGtB,CAAC,CAAC8E,OAAL,EAAa,KAAI,MAAMzE,CAAV,IAAeL,CAAC,CAAC8E,OAAjB,EAAyBpC,CAAC,CAAC2E,uBAAF,CAA0BhH,CAA1B,EAA4BJ,CAA5B,EAA8BE,CAA9B;AAAiC,cAAGH,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAMxD,CAAV,IAAeL,CAAC,CAAC6D,YAAjB,EAA8BnB,CAAC,CAAC2E,uBAAF,CAA0BhH,CAA1B,EAA4BJ,CAA5B,EAA8BE,CAA9B;AAAiC;;AAAM,aAAI,eAAJ;AAAoB;;AAAM,aAAI,gBAAJ;AAAqB,aAAI,kBAAJ;AAAuB,aAAI,mBAAJ;AAAwB,aAAI,cAAJ;AAAmB,aAAI,gBAAJ;AAAqB,aAAI,cAAJ;AAAmB,aAAI,iBAAJ;AAAsB,aAAI,iBAAJ;AAAsB,aAAI,oBAAJ;AAAyB,aAAI,kBAAJ;AAAuB,cAAGH,CAAC,CAAC8E,OAAL,EAAa,KAAI,MAAMzE,CAAV,IAAeL,CAAC,CAAC8E,OAAjB,EAAyBpC,CAAC,CAAC2E,uBAAF,CAA0BhH,CAA1B,EAA4BJ,CAA5B,EAA8BE,CAA9B;;AAAiC,cAAGH,CAAC,CAACgF,eAAF,IAAmBtC,CAAC,CAAC2E,uBAAF,CAA0BrH,CAAC,CAACgF,eAA5B,EAA4C/E,CAA5C,EAA8CE,CAA9C,CAAnB,EAAoE,sBAAoBH,CAAC,CAACsB,IAA7F,EAAkG;AAAC,gBAAGtB,CAAC,CAACsE,cAAL,EAAoB,KAAI,MAAMjE,CAAV,IAAeL,CAAC,CAACsE,cAAjB,EAAgC5B,CAAC,CAAC2E,uBAAF,CAA0BhH,CAA1B,EAA4BJ,CAA5B,EAA8BE,CAA9B,GAAiCuC,CAAC,CAAC2E,uBAAF,CAA0BhH,CAAC,CAACoB,MAA5B,EAAmCxB,CAAnC,EAAqCE,CAArC,CAAjC;AAAyE,WAAhO,MAAoO,yBAAuBH,CAAC,CAACsB,IAAzB,GAA8BoB,CAAC,CAAC2E,uBAAF,CAA0BrH,CAAC,CAACyB,MAA5B,EAAmCxB,CAAnC,EAAqCE,CAArC,CAA9B,GAAsE,mBAAiBH,CAAC,CAACsB,IAAnB,IAAyBoB,CAAC,CAAC2E,uBAAF,CAA0BrH,CAAC,CAAC2E,UAA5B,EAAuC1E,CAAvC,EAAyCE,CAAzC,CAA/F;;AAA7wB;AAAy5B;AAAC;;AAAqB,SAAdoH,cAAc,CAACvH,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;AAAC,QAAG,CAACJ,CAAJ,EAAM;;AAAO,UAAMM,CAAC,GAACP,CAAC,IAAEA,CAAC,GAACA,CAAC,CAACwH,MAAF,CAAS,CAAT,EAAYC,WAAZ,KAA0BzH,CAAC,CAAC0H,MAAF,CAAS,CAAT,CAA3B,GAAuC1H,CAAnD;;AAAqD,QAAGA,CAAC,CAACsH,aAAL,EAAmB,KAAI,MAAM7G,CAAV,IAAeR,CAAf,EAAiB,IAAGQ,CAAC,CAAC6G,aAAF,KAAkBtH,CAAC,CAACsH,aAAvB,EAAqC;AAAC,YAAMrH,CAAC,GAACM,CAAC,CAACE,CAAC,CAACkH,YAAH,CAAT;;AAA0B,UAAGtH,CAAC,IAAEA,CAAC,CAAC6C,IAAF,CAAO;AAAC0E,QAAAA,GAAG,EAAC5H,CAAL;AAAO6H,QAAAA,iBAAiB,EAAC5H,CAAzB;AAA2B6H,QAAAA,KAAK,EAAC9H,CAAC,CAACC,CAAD;AAAlC,OAAP,CAAH,EAAkDQ,CAAC,CAACsH,UAAF,KAAetH,CAAC,CAACqH,KAAF,GAAQpF,CAAC,CAACsF,OAAF,CAAUvH,CAAC,CAACkH,YAAZ,EAAyBlH,CAAC,CAACsH,UAA3B,CAAvB,CAAlD,EAAiH5H,CAApH,EAAsH;AAAC,YAAIF,CAAC,GAAC,CAAC,CAAP;;AAAS,aAAI,MAAMI,CAAV,IAAeF,CAAf,EAAiBE,CAAC,CAACiH,aAAF,KAAkBtH,CAAC,CAACsH,aAApB,KAAoCrH,CAAC,GAAC,CAAC,CAAvC;;AAA0CA,QAAAA,CAAC,IAAEE,CAAC,CAAC+C,IAAF,CAAOzC,CAAP,CAAH;AAAa;;AAAAT,MAAAA,CAAC,CAACC,CAAD,CAAD,GAAKQ,CAAC,CAACqH,KAAP;AAAa;;AAAA,YAAO9H,CAAC,CAACsB,IAAT;AAAe,WAAI,gBAAJ;AAAqB,WAAI,eAAJ;AAAoB,WAAI,kBAAJ;AAAuB,YAAGtB,CAAC,CAAC8E,OAAL,EAAa,KAAI,MAAMvE,CAAV,IAAeP,CAAC,CAAC8E,OAAjB,EAAyBpC,CAAC,CAAC6E,cAAF,CAAiBhH,CAAjB,EAAmBN,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB;AAA0B,YAAGL,CAAC,CAAC6D,YAAL,EAAkB,KAAI,MAAMtD,CAAV,IAAeP,CAAC,CAAC6D,YAAjB,EAA8BnB,CAAC,CAAC6E,cAAF,CAAiBhH,CAAjB,EAAmBN,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB;AAA0B;;AAAM,WAAI,eAAJ;AAAoB;;AAAM,WAAI,gBAAJ;AAAqB,WAAI,cAAJ;AAAmB,WAAI,iBAAJ;AAAsB,YAAGL,CAAC,CAAC8E,OAAL,EAAa,KAAI,MAAMvE,CAAV,IAAeP,CAAC,CAAC8E,OAAjB,EAAyBpC,CAAC,CAAC6E,cAAF,CAAiBhH,CAAjB,EAAmBN,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB;AAA0B,YAAG,sBAAoBL,CAAC,CAACsB,IAAtB,IAA4BtB,CAAC,CAACsE,cAAjC,EAAgD,KAAI,MAAM/D,CAAV,IAAeP,CAAC,CAACsE,cAAjB,EAAgC5B,CAAC,CAAC6E,cAAF,CAAiBhH,CAAjB,EAAmBN,CAAnB,EAAqBE,CAArB,EAAuBE,CAAvB,GAA0BqC,CAAC,CAAC6E,cAAF,CAAiBhH,CAAC,CAACkB,MAAnB,EAA0BxB,CAA1B,EAA4BE,CAA5B,EAA8BE,CAA9B,CAA1B;AAAvc;AAAmgB;;AAAuB,SAAhB4H,gBAAgB,CAACjI,CAAD,EAAG;AAAC,SAAI,MAAMC,CAAV,IAAeD,CAAf,EAAiBC,CAAC,CAAC2H,GAAF,CAAM3H,CAAC,CAAC4H,iBAAR,IAA2B5H,CAAC,CAAC6H,KAA7B;AAAmC;;AAAuB,SAAhBI,gBAAgB,CAAClI,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,EAAN;;AAAS,SAAI,MAAME,CAAV,IAAeH,CAAf,EAAiB,KAAK,CAAL,KAASG,CAAC,CAAC2H,KAAX,KAAmB7H,CAAC,IAAG,GAAEE,CAAC,CAACmH,aAAc,GAAEnH,CAAC,CAACwH,YAAa,GAAEQ,IAAI,CAACC,SAAL,CAAejI,CAAC,CAAC2H,KAAjB,CAAwB,EAApF;;AAAuF,WAAO7H,CAAP;AAAS;;AAAc,SAAP+H,OAAO,CAAC/H,CAAD,EAAGE,CAAH,EAAK;AAAC,QAAG,mBAAiBF,CAApB,EAAsB,OAAOE,CAAC,CAACkI,KAAF,CAAQ,GAAR,EAAa3C,GAAb,CAAkB1F,CAAC,IAAEsI,MAAM,CAACtI,CAAD,CAA3B,CAAP;;AAAwC,QAAG,YAAUC,CAAb,EAAe;AAAC,YAAMA,CAAC,GAAC,IAAID,CAAJ,CAAMG,CAAN,EAASoI,MAAT,EAAR;AAA0B,aAAOtI,CAAC,CAAC,CAAD,CAAD,IAAM,GAAN,EAAUA,CAAjB;AAAmB;;AAAA,WAAOE,CAAP;AAAS;;AAAn4E;;AAAo4E,SAAOyB,CAAC,IAAI4G,eAAZ,EAA4B9F,CAAC,IAAI+F,cAAjC,EAAgDjG,CAAC,IAAIkG,YAArD","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../Color.js\";import t from\"../../core/Logger.js\";import{nextPowerOfTwo as r}from\"../../core/mathUtils.js\";import{Placement as o}from\"./CIMPlacements.js\";import{EnvDrawHelper as s,Transformation as a,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{packFloatRGBA as n}from\"./packingUtils.js\";const c=Math.PI,l=c/2,m=4,y=t.getLogger(\"esri.symbols.cim.CIMSymbolHelper\");function f(e,t){switch(t.type){case\"CIMSymbolReference\":{const r={type:\"point\",x:0,y:0};e.drawSymbol(t.symbol,r);break}case\"CIMPointSymbol\":{const r={type:\"point\",x:0,y:0};e.drawSymbol(t,r);break}case\"CIMTextSymbol\":break;case\"CIMVectorMarker\":{const r=new o;e.drawMarker(t,r);break}}return e.envelope()}class h{static getEnvelope(e){const t=new s;if(Array.isArray(e)){let r;for(const o of e)r?r.union(f(t,o)):r=f(t,o);return r}return f(t,e)}static getTextureAnchor(e){const t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return[0,0,0];const r=96/72,o=(t.x+.5*t.width)*r,s=-(t.y+.5*t.height)*r,a=t.width*r+2,i=t.height*r+2;return[o/a,s/i,i]}static rasterize(e,t,r,s=!0){const n=r||this.getEnvelope(t);if(!n||n.width<=0||n.height<=0)return[null,0,0,0,0];const c=96/72,l=(n.x+.5*n.width)*c,m=(n.y+.5*n.height)*c;e.width=n.width*c,e.height=n.height*c,r||(e.width+=2,e.height+=2);const y=e.getContext(\"2d\"),f=a.createScale(c,-c);f.translate(.5*e.width-l,.5*e.height+m);const h=new i(y,f);switch(t.type){case\"CIMPointSymbol\":{const e={type:\"point\",x:0,y:0};h.drawSymbol(t,e);break}case\"CIMVectorMarker\":{const e=new o;h.drawMarker(t,e);break}}const p=y.getImageData(0,0,e.width,e.height),S=new Uint8Array(p.data);if(s){let e;for(let t=0;t<S.length;t+=4)e=S[t+3]/255,S[t]=S[t]*e,S[t+1]=S[t+1]*e,S[t+2]=S[t+2]*e}return[S,e.width,e.height,-l/e.width,-m/e.height]}static fromSimpleMarker(e){const t=100,r=50;let o,s;const a=e.style;if(\"circle\"===a||\"esriSMSCircle\"===a){const e=.25;let t=Math.acos(1-e/r),a=Math.ceil(c/t/4);0===a&&(a=1),t=l/a,a*=4;const i=[];i.push([r,0]);for(let o=1;o<a;o++)i.push([r*Math.cos(o*t),-r*Math.sin(o*t)]);i.push([r,0]),o={rings:[i]},s={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if(\"cross\"===a||\"esriSMSCross\"===a){const e=0;o={rings:[[[e,r],[e,e],[r,e],[r,-e],[e,-e],[e,-r],[-e,-r],[-e,-e],[-r,-e],[-r,e],[-e,e],[-e,r],[e,r]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if(\"diamond\"===a||\"esriSMSDiamond\"===a)o={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(\"square\"===a||\"esriSMSSquare\"===a)o={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(\"x\"===a||\"esriSMSX\"===a){const e=0;o={rings:[[[0,e],[r-e,r],[r,r-e],[e,0],[r,e-r],[r-e,-r],[0,-e],[e-r,-r],[-r,e-r],[-e,0],[-r,r-e],[e-r,r],[0,e]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if(\"triangle\"===a||\"esriSMSTriangle\"===a){const e=t*.5773502691896257,r=-e,a=2/3*t,i=a-t;o={rings:[[[r,i],[0,a],[e,i],[r,i]]]},s={xmin:r,ymin:i,xmax:e,ymax:a}}else\"arrow\"!==a&&\"esriSMSArrow\"!==a||(o={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r});let i;if(o&&s){const t=[{type:\"CIMSolidFill\",enable:!0,color:e.color}];e.outline&&t.push({type:\"CIMSolidStroke\",enable:!0,width:e.outline.width,color:e.outline.color});const r={type:\"CIMPolygonSymbol\",symbolLayers:t};i={type:\"CIMPointSymbol\",symbolLayers:[{type:\"CIMVectorMarker\",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:s,markerGraphics:[{type:\"CIMMarkerGraphic\",geometry:o,symbol:r}]}]}}return i}static fromCIMHatchFill(e){const t=void 0!==e.separation?e.separation:m,r=t/2;let o=this._getLineSymbolPeriod(e.lineSymbol)||m;for(;o<4;)o*=2;const s=o/2;return{type:\"CIMVectorMarker\",frame:{xmin:-s,xmax:s,ymin:-r,ymax:r},markerGraphics:[{type:\"CIMMarkerGraphic\",geometry:{paths:[[[-s,0],[s,0]]]},symbol:e.lineSymbol}],size:t}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const r of e.symbolLayers){const e=this._getEffectsRepeat(r.effects);if(e)return e;if(r){const e=this._getPlacementRepeat(r.markerPlacement);if(e)return e}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case\"CIMGeometricEffectDashes\":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const r of e)t+=r;return 1&e.length&&(t*=2),t}break}case\"CIMGeometricEffectWave\":return t.period;default:y.error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case\"CIMMarkerPlacementAlongLineSameSize\":case\"CIMMarkerPlacementAlongLineRandomSize\":case\"CIMMarkerPlacementAlongLineVariableSize\":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const r of t)e+=r;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,r={type:e.type,...e};let o,s,a,i;if(r.markerPlacement=null,r.anchorPoint=null,!0===t.shiftOddRows){s=t.stepX/2,a=t.stepY,i=2*t.stepY;o=[{x:-s,y:0},{x:s,y:0},{x:0,y:a},{x:0,y:-a}].map((e=>({type:\"CIMMarkerGraphic\",geometry:e,symbol:{type:\"CIMPointSymbol\",symbolLayers:[r]}})))}else s=t.stepX/2,a=t.stepY/2,i=t.stepY,o=[{type:\"CIMMarkerGraphic\",geometry:{x:0,y:0},symbol:{type:\"CIMPointSymbol\",symbolLayers:[r]}}];return{type:\"CIMVectorMarker\",frame:{xmin:-s,xmax:s,ymin:-a,ymax:a},markerGraphics:o,size:i}}static getFillColor(e){if(!e)return null;switch(e.type){case\"CIMPolygonSymbol\":if(e.symbolLayers)for(const t of e.symbolLayers){const e=h.getFillColor(t);if(null!=e)return e}break;case\"CIMTextSymbol\":return h.getFillColor(e.symbol);case\"CIMSolidFill\":return e.color}}static getStrokeColor(e){if(e)switch(e.type){case\"CIMPolygonSymbol\":case\"CIMLineSymbol\":if(e.symbolLayers)for(const t of e.symbolLayers){const e=h.getStrokeColor(t);if(void 0!==e)return e}break;case\"CIMTextSymbol\":return h.getStrokeColor(e.symbol);case\"CIMSolidStroke\":return e.color}}static getStrokeWidth(e){if(e)switch(e.type){case\"CIMPolygonSymbol\":case\"CIMLineSymbol\":if(e.symbolLayers)for(const t of e.symbolLayers){const e=h.getStrokeWidth(t);if(void 0!==e)return e}break;case\"CIMTextSymbol\":return h.getStrokeWidth(e.symbol);case\"CIMSolidStroke\":case\"CIMGradientStroke\":case\"CIMPictureStroke\":return e.width}}static getSize(e){if(e)switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers){const e=h.getSize(r);e>t&&(t=e)}return t}case\"CIMSolidStroke\":case\"CIMPictureStroke\":case\"CIMGradientStroke\":return e.width;case\"CIMCharacterMarker\":case\"CIMPictureMarker\":case\"CIMVectorMarker\":return e.size}}static getMarkerScaleRatio(e){if(e)switch(e.type){case\"CIMVectorMarker\":if(!1!==e.scaleSymbolsProportionally&&e.frame){const t=e.frame.ymax-e.frame.ymin;return e.size/t}}return 1}}class p{static rasterizeSimpleFill(e,t,o){\"solid\"!==t&&\"none\"!==t&&\"esriSFSSolid\"!==t&&\"esriSFSNull\"!==t||console.error(\"Unexpected: style does not require rasterization\");const s=r(Math.ceil(o)),a=this._isHorizontalOrVertical(t)?8*s:16*s,i=2*s;e.width=a,e.height=a;const n=e.getContext(\"2d\");n.strokeStyle=\"#FFFFFF\",n.lineWidth=s,n.beginPath(),\"vertical\"!==t&&\"cross\"!==t&&\"esriSFSCross\"!==t&&\"esriSFSVertical\"!==t||(n.moveTo(a/2,-i),n.lineTo(a/2,a+i)),\"horizontal\"!==t&&\"cross\"!==t&&\"esriSFSCross\"!==t&&\"esriSFSHorizontal\"!==t||(n.moveTo(-i,a/2),n.lineTo(a+i,a/2)),\"forward-diagonal\"!==t&&\"diagonal-cross\"!==t&&\"esriSFSDiagonalCross\"!==t&&\"esriSFSForwardDiagonal\"!==t||(n.moveTo(-i,-i),n.lineTo(a+i,a+i),n.moveTo(a-i,-i),n.lineTo(a+i,i),n.moveTo(-i,a-i),n.lineTo(i,a+i)),\"backward-diagonal\"!==t&&\"diagonal-cross\"!==t&&\"esriSFSBackwardDiagonal\"!==t&&\"esriSFSDiagonalCross\"!==t||(n.moveTo(a+i,-i),n.lineTo(-i,a+i),n.moveTo(i,-i),n.lineTo(-i,i),n.moveTo(a+i,a-i),n.lineTo(a-i,a+i)),n.stroke();const c=n.getImageData(0,0,e.width,e.height),l=new Uint8Array(c.data);let m;for(let r=0;r<l.length;r+=4)m=l[r+3]/255,l[r]=l[r]*m,l[r+1]=l[r+1]*m,l[r+2]=l[r+2]*m;return[l,e.width,e.height]}static rasterizeSimpleLine(e,t){let r;switch(t){case\"butt\":r=\"Butt\";break;case\"square\":r=\"Square\";break;default:r=\"Round\"}const o=\"Butt\"===r;let s;switch(e){case\"dash\":case\"esriSLSDash\":s=o?[4,3]:[3,4];break;case\"dash-dot\":case\"esriSLSDashDot\":s=o?[4,3,1,3]:[3,4,0,4];break;case\"dot\":case\"esriSLSDot\":s=o?[1,3]:[0,4];break;case\"long-dash\":case\"esriSLSLongDash\":s=o?[8,3]:[7,4];break;case\"long-dash-dot\":case\"esriSLSLongDashDot\":s=o?[8,3,1,3]:[7,4,0,4];break;case\"long-dash-dot-dot\":case\"esriSLSDashDotDot\":s=o?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case\"short-dash\":case\"esriSLSShortDash\":s=o?[4,1]:[3,2];break;case\"short-dash-dot\":case\"esriSLSShortDashDot\":s=o?[4,1,1,1]:[3,2,0,2];break;case\"short-dash-dot-dot\":case\"esriSLSShortDashDotDot\":s=o?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case\"short-dot\":case\"esriSLSShortDot\":s=o?[1,1]:[0,2];break;case\"solid\":case\"esriSLSSolid\":case\"none\":y.error(\"Unexpected: style does not require rasterization\"),s=[0,0];break;default:y.error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),s=[0,0]}return this.rasterizeDash(s,r)}static rasterizeDash(e,t){const r=\"Butt\"===t,o=\"Square\"===t,s=!r&&!o;e.length%2==1&&(e=[...e,...e]);const a=15.5,i=2*a;let c=0;for(const n of e)c+=n;const l=Math.round(c*a),m=new Float32Array(l*i),y=.5*a;let f=0,h=0,p=.5,S=!0;for(const n of e){for(f=h,h+=n*a;p<=h;){let e=.5;for(;e<i;){const t=(e-.5)*l+p-.5,i=s?(e-a)*(e-a):Math.abs(e-a);m[t]=S?r?Math.max(Math.max(f+y-p,i),Math.max(p-h+y,i)):i:s?Math.min((p-f)*(p-f)+i,(p-h)*(p-h)+i):o?Math.min(Math.max(p-f,i),Math.max(h-p,i)):Math.min(Math.max(p-f+y,i),Math.max(h+y-p,i)),e++}p++}S=!S}const d=m.length,M=new Uint8Array(4*d);for(let b=0;b<d;++b){const e=(s?Math.sqrt(m[b]):m[b])/a;n(e,M,4*b)}return[M,l,i]}static _isHorizontalOrVertical(e){return\"vertical\"===e||\"horizontal\"===e||\"cross\"===e||\"esriSFSCross\"===e||\"esriSFSVertical\"===e||\"esriSFSHorizontal\"===e}}class S{static findApplicableOverrides(e,t,r){if(t){if(e.primitiveName){let o=!1;for(const t of r)if(t.primitiveName===e.primitiveName){o=!0;break}if(!o)for(const s of t)s.primitiveName===e.primitiveName&&r.push(s)}switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":if(e.effects)for(const o of e.effects)S.findApplicableOverrides(o,t,r);if(e.symbolLayers)for(const o of e.symbolLayers)S.findApplicableOverrides(o,t,r);break;case\"CIMTextSymbol\":break;case\"CIMSolidStroke\":case\"CIMPictureStroke\":case\"CIMGradientStroke\":case\"CIMSolidFill\":case\"CIMPictureFill\":case\"CIMHatchFill\":case\"CIMGradientFill\":case\"CIMVectorMarker\":case\"CIMCharacterMarker\":case\"CIMPictureMarker\":if(e.effects)for(const o of e.effects)S.findApplicableOverrides(o,t,r);if(e.markerPlacement&&S.findApplicableOverrides(e.markerPlacement,t,r),\"CIMVectorMarker\"===e.type){if(e.markerGraphics)for(const o of e.markerGraphics)S.findApplicableOverrides(o,t,r),S.findApplicableOverrides(o.symbol,t,r)}else\"CIMCharacterMarker\"===e.type?S.findApplicableOverrides(e.symbol,t,r):\"CIMHatchFill\"===e.type&&S.findApplicableOverrides(e.lineSymbol,t,r)}}}static applyOverrides(e,t,r,o){if(!t)return;const s=e=>e?e.charAt(0).toLowerCase()+e.substr(1):e;if(e.primitiveName)for(const a of t)if(a.primitiveName===e.primitiveName){const t=s(a.propertyName);if(o&&o.push({cim:e,nocapPropertyName:t,value:e[t]}),a.expression&&(a.value=S.toValue(a.propertyName,a.expression)),r){let t=!1;for(const o of r)o.primitiveName===e.primitiveName&&(t=!0);t||r.push(a)}e[t]=a.value}switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":if(e.effects)for(const s of e.effects)S.applyOverrides(s,t,r,o);if(e.symbolLayers)for(const s of e.symbolLayers)S.applyOverrides(s,t,r,o);break;case\"CIMTextSymbol\":break;case\"CIMSolidStroke\":case\"CIMSolidFill\":case\"CIMVectorMarker\":if(e.effects)for(const s of e.effects)S.applyOverrides(s,t,r,o);if(\"CIMVectorMarker\"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)S.applyOverrides(s,t,r,o),S.applyOverrides(s.symbol,t,r,o)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t=\"\";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(t,r){if(\"DashTemplate\"===t)return r.split(\" \").map((e=>Number(e)));if(\"Color\"===t){const t=new e(r).toRgba();return t[3]*=255,t}return r}}export{h as CIMSymbolHelper,S as OverrideHelper,p as SymbolHelper};\n"]},"metadata":{},"sourceType":"module"}