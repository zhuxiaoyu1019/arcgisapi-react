{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport { neverReached as e } from \"../../../../core/compilerUtils.js\";\nimport { acosClamped as i, clamp as a, deg2rad as r } from \"../../../../core/mathUtils.js\";\nimport { isSome as o } from \"../../../../core/maybe.js\";\nimport { property as s } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { t as c, c as m, i as l } from \"../../../../chunks/mat4.js\";\nimport { c as p } from \"../../../../chunks/mat4f64.js\";\nimport { f as h, m as d, b as u, a as f, g as v, o as C, l as g, s as y, n as w, c as b, d as S, i as O, r as x } from \"../../../../chunks/vec3.js\";\nimport { c as j } from \"../../../../chunks/vec3f64.js\";\nimport { getReferenceEllipsoid as M } from \"../../../../geometry/projectionEllipsoid.js\";\nimport { wrap as z } from \"../../../../geometry/support/ray.js\";\nimport { b as T, e as k } from \"../../../../chunks/sphere.js\";\nimport { sv3d as A } from \"../../../../geometry/support/vectorStacks.js\";\nimport { applyAll as D } from \"../../camera/constraintUtils.js\";\nimport { TiltDefault as H } from \"../Constraints.js\";\nimport { InteractiveController as R } from \"./InteractiveController.js\";\nimport { panMotionToRotationMatrix as E, onSurfaceTiltToEyeTiltGlobal as F, offSurfaceTiltToEyeTiltGlobal as G } from \"../utils/navigationUtils.js\";\nimport { viewAngle as U } from \"../utils/viewUtils.js\";\nimport { headingTiltToDirectionUp as P } from \"../../support/cameraUtils.js\";\nimport { createDirectionUp as V } from \"../../support/cameraUtilsInternal.js\";\nimport I from \"../../webgl-engine/lib/Camera.js\";\nimport { extractTransformation as B, isZeroTransformation as L, extractTransformationKeyboard as q } from \"../../../navigation/gamepadAndKeyboardUtils.js\";\nlet K = class extends R {\n  constructor(t) {\n    super(t), this.transformation = {\n      translation: [0, 0, 0],\n      heading: 0,\n      tilt: 0,\n      zoom: 0\n    }, this.keysButtonState = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], this.tmpCamera = new I(), this.constraintOptions = {\n      selection: 15,\n      interactionType: 0,\n      interactionStartCamera: new I(),\n      interactionFactor: 0,\n      interactionDirection: null,\n      tiltMode: 1\n    };\n  }\n\n  handleEventGamepad(t) {\n    const e = B(t, this.view.navigation.gamepad, this.transformation);\n    (\"end\" === t.action || L(e)) && this.finishController();\n  }\n\n  activateDirection(t) {\n    this.keysButtonState[t] = 1, q(this.keysButtonState, this.transformation);\n  }\n\n  deactivateDirection(t) {\n    this.keysButtonState[t] = 0;\n    const e = q(this.keysButtonState, this.transformation);\n    L(e) && this.finishController();\n  }\n\n  onControllerStart(t) {\n    this.filteredSurfaceElevation = this.view.pointsOfInterest.cameraOnSurface.location.z, this.headingStart = this.view.camera.heading, super.onControllerStart(t);\n  }\n\n  updateFilteredSurfaceElevation(t) {\n    const e = this.view.pointsOfInterest.cameraOnSurface.location.z,\n          i = 1;\n    this.filteredSurfaceElevation += i * (e - this.filteredSurfaceElevation) * t;\n  }\n\n  stepController(t, e) {\n    this.updateStartHeading(), this.updateFilteredSurfaceElevation(t), this.currentCamera.copyViewFrom(e), this.updateCameraCenter(), this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera), this.calculateControlTransformation(t, this.currentCamera, Y), this.applyDisabledMovementTypes(Y), this.applyPan(Y.pan), this.applyRotate(Y.rotate), this.applyZoom(Y.zoom), this.applyAscend(Y.ascend), this.constraintOptions.interactionType = 0, this.constraintOptions.selection = 8, D(this.view, this.currentCamera, this.constraintOptions), super.stepController(t, e);\n  }\n\n  updateStartHeading() {\n    0 !== this.transformation.heading && (this.headingStart = this.view.camera.heading);\n  }\n\n  applyRotate(t) {\n    if (!t.enabled) return;\n    const e = this.currentCamera;\n    h($, e.center, e.eye), d($, $, t.matrix), e.center = u($, $, e.eye), e.up = d($, e.up, t.matrix), this.constraintOptions.interactionType = 3, this.constraintOptions.selection = 7, D(this.view, e, this.constraintOptions);\n  }\n\n  applyPan(t, e = this.currentCamera) {\n    if (!t.enabled) return;\n    e.eye = d($, e.eye, t.matrix), e.center = d($, e.center, t.matrix);\n    this.view.state.isGlobal && (e.up = d($, e.up, t.matrix)), this.constraintOptions.interactionType = 4, this.constraintOptions.selection = 15, D(this.view, e, this.constraintOptions);\n  }\n\n  applyZoom(t) {\n    if (!t) return;\n    const e = this.currentCamera.viewForward;\n    this.currentCamera.eye = u($, this.currentCamera.eye, f(A.get(), e, t)), v(tt, e), C(tt, tt), this.constraintOptions.interactionDirection = tt, this.constraintOptions.interactionType = 1, this.constraintOptions.selection = 7, D(this.view, this.currentCamera, this.constraintOptions), this.constraintOptions.interactionDirection = null;\n  }\n\n  applyAscend(t) {\n    if (!t) return;\n    const e = this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye, A.get());\n    this.constraintOptions.interactionDirection = v(tt, e);\n\n    if (this.view.state.isGlobal) {\n      const e = g(this.currentCamera.eye),\n            i = (e + t) / e;\n      this.currentCamera.eye = f($, this.currentCamera.eye, i), this.currentCamera.center = f($, this.currentCamera.center, i);\n    } else {\n      const i = f(A.get(), e, t);\n      this.currentCamera.eye = u($, this.currentCamera.eye, i), this.currentCamera.center = u($, this.currentCamera.center, i);\n    }\n\n    this.updateCameraCenter(), this.constraintOptions.interactionType = 5, this.constraintOptions.selection = 8, D(this.view, this.currentCamera, this.constraintOptions) && this.updateCameraCenter(), this.constraintOptions.selection = 7, D(this.view, this.currentCamera, this.constraintOptions), this.constraintOptions.interactionDirection = null;\n  }\n\n  calculateControlTransformation(t, e, i) {\n    it(i);\n    const a = this.computeVelocities(t);\n    this.view.state.isLocal ? this.calculateControlTransformationLocal(a, e, i) : this.calculateControlTransformationGlobal(a, e, i);\n  }\n\n  updateCameraCenter() {\n    const t = this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,\n          e = this.view.renderCoordsHelper,\n          i = this.currentCamera.ray;\n    this.currentCamera.center = e.intersectManifoldClosestSilhouette(i, t, $);\n  }\n\n  calculateControlTransformationLocal(t, i, r) {\n    const {\n      viewRight: o,\n      viewForward: s\n    } = i,\n          n = this.transformation,\n          l = this.view.navigation.gamepad,\n          p = y(A.get(), s[0], s[1], 0);\n    w(p, p);\n    const h = n.translation[0] * t.pan;\n\n    if (0 !== h) {\n      const t = f(A.get(), o, h);\n      c(r.pan.matrix, r.pan.matrix, t), r.pan.enabled = !0;\n    }\n\n    switch (l.mode) {\n      case \"pan\":\n        {\n          const e = -n.translation[1] * t.pan;\n\n          if (0 !== e) {\n            const t = f(A.get(), p, e);\n            c(r.pan.matrix, r.pan.matrix, t), r.pan.enabled = !0;\n          }\n\n          r.zoom = n.zoom * t.zoom;\n          break;\n        }\n\n      case \"zoom\":\n        r.zoom = (-n.translation[1] + n.zoom) * t.zoom;\n        break;\n\n      default:\n        e(l.mode);\n    }\n\n    const d = n.translation[2] * t.ascend;\n    r.ascend = d;\n    const u = -n.heading * t.rotate;\n    0 !== u && (m(r.rotate.matrix, r.rotate.matrix, u, this.view.renderCoordsHelper.worldUpAtPosition(i.eye, A.get())), r.rotate.enabled = !0);\n    const v = n.tilt * t.rotate,\n          C = U(this.view.renderCoordsHelper, i.center, i.eye),\n          g = a(C + v, H.min, H.max) - C;\n    g && (m(r.rotate.matrix, r.rotate.matrix, g, o), r.rotate.enabled = !0);\n  }\n\n  calculateControlTransformationGlobal(t, e, i) {\n    const {\n      eye: a,\n      viewRight: r\n    } = e,\n          o = this.transformation,\n          s = this.view.navigation.gamepad,\n          n = b(A.get(), r, a);\n    w(n, n), C(n, n), E(this.startCamera, e, o, t, this.view.camera.heading, this.headingStart, this.view.camera.tilt, i, s), this.tmpCamera.copyFrom(this.currentCamera), this.applyPan(Y.pan, this.tmpCamera);\n    const c = this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,\n          l = o.translation[2] * t.ascend;\n    i.ascend = l;\n    const p = -o.heading * t.rotate;\n    0 !== p && (m(i.rotate.matrix, i.rotate.matrix, p, this.tmpCamera.eye), i.rotate.enabled = !0);\n    const h = o.tilt * t.rotate,\n          d = this.clampTiltDeltaGlobalToValidRange(h, e.ray, c);\n    0 !== d && (m(i.rotate.matrix, i.rotate.matrix, d, this.tmpCamera.viewRight), i.rotate.enabled = !0), i.zoom += o.zoom * t.zoom;\n  }\n\n  clampTiltDeltaGlobalToValidRange(t, e, r) {\n    const o = M(this.view.spatialReference),\n          s = F(H.min, e.origin, r, o);\n    let n = 0,\n        c = 0;\n    const m = A.get();\n\n    if (this.view.renderCoordsHelper.intersectManifold(e, r, m)) {\n      const t = U(this.view.renderCoordsHelper, m, e.origin);\n      n = F(t, e.origin, r, o), c = F(H.max, e.origin, r, o);\n    } else {\n      T(k(r + o.radius), e, m);\n      const t = i(-S(e.direction, w(m, m)));\n      n = G(t, e.origin, r, o), c = G(H.max, e.origin, r, o);\n    }\n\n    return a(n + t, s, c) - n;\n  }\n\n  getPointAbsoluteSurfaceElevation(t, e, i) {\n    const {\n      renderCoordsHelper: a\n    } = this.view,\n          r = a.getAltitude(t),\n          o = e + Math.abs(r - e);\n    return a.setAltitude(i, o, t), o;\n  }\n\n  clampedDistanceToSurface(t, e) {\n    const {\n      renderCoordsHelper: i\n    } = this.view,\n          {\n      camera: a\n    } = this.view.state,\n          {\n      direction: r\n    } = P(this.view, e, 0, X, et),\n          o = i.intersectManifoldClosestSilhouette(z(e, r), t, A.get()),\n          s = O(e, o),\n          n = i.intersectManifoldClosestSilhouette(z(e, x(A.get(), e, a.center)), t, A.get()),\n          c = O(e, n);\n    return Math.min(s, c);\n  }\n\n  computeHeadingRotateRadius(t) {\n    const {\n      renderCoordsHelper: e,\n      state: a\n    } = this.view,\n          {\n      camera: r,\n      isGlobal: o\n    } = a,\n          s = e.intersectManifoldClosestSilhouette(r.ray, this.filteredSurfaceElevation, A.get());\n\n    if (o) {\n      const e = h(A.get(), t, s),\n            a = g(e);\n      f(e, e, 1 / a);\n      const r = w(A.get(), t),\n            o = i(S(r, e));\n      return a * Math.sin(Math.min(_, o));\n    }\n\n    {\n      const i = v(A.get(), t);\n      return e.setAltitude(i, this.filteredSurfaceElevation), O(s, i);\n    }\n  }\n\n  minimumAscendVelocity() {\n    return this.view.state.constraints.collision.enabled ? 0 : N;\n  }\n\n  computeVelocities(t) {\n    const e = this.filteredSurfaceElevation,\n          i = e + M(this.view.spatialReference).radius,\n          {\n      camera: r,\n      isGlobal: o\n    } = this.view.state,\n          s = A.get(),\n          n = this.getPointAbsoluteSurfaceElevation(r.eye, e, s),\n          c = this.clampedDistanceToSurface(e, s),\n          m = r.width / 2,\n          l = J * r.width,\n          p = J * r.width,\n          h = c * Math.tan(.5 * r.fovX) / m,\n          d = h / i,\n          u = h / this.computeHeadingRotateRadius(s),\n          f = n - e;\n    return {\n      pan: (o ? d : h) * l * t,\n      ascend: Math.max(this.minimumAscendVelocity() * t, 2 ** (l * t / m) * f - f),\n      zoom: 2 ** (l * t / m) * c - c,\n      rotate: a(u * p, Q, W) * t\n    };\n  }\n\n  applyDisabledMovementTypes(t) {\n    !o(this.disableMovements) || void 0 !== this.disableMovements.mode && this.view.state.viewingMode !== this.disableMovements.mode || (t.zoom = this.disableMovements.zoom ? 0 : t.zoom, t.ascend = this.disableMovements.ascend ? 0 : t.ascend, t.pan.enabled = !this.disableMovements.pan, this.disableMovements.pan && l(t.pan.matrix), t.rotate.enabled = !this.disableMovements.rotate, this.disableMovements.rotate && l(t.rotate.matrix));\n  }\n\n  static activatesFor(t, e) {\n    const i = B(e, t.navigation.gamepad, Z);\n    return !(\"end\" === e.action || L(i));\n  }\n\n};\nt([s({\n  constructOnly: !0\n})], K.prototype, \"view\", void 0), t([s({\n  constructOnly: !0\n})], K.prototype, \"gamepadDevice\", void 0), t([s({\n  constructOnly: !0\n})], K.prototype, \"disableMovements\", void 0), K = t([n(\"esri.views.3d.state.controllers.GamepadKeyboardController\")], K);\n\nconst Z = {\n  translation: [0, 0, 0],\n  heading: 0,\n  tilt: 0,\n  zoom: 0\n},\n      X = 80,\n      _ = r(X),\n      J = .75,\n      N = 5,\n      Q = r(30),\n      W = r(80),\n      Y = {\n  zoom: 0,\n  ascend: 0,\n  pan: {\n    enabled: !1,\n    matrix: p()\n  },\n  rotate: {\n    enabled: !1,\n    matrix: p()\n  }\n},\n      $ = j(),\n      tt = j(),\n      et = V();\n\nfunction it(t) {\n  t.zoom = 0, t.ascend = 0, t.pan.enabled = !1, l(t.pan.matrix), t.rotate.enabled = !1, l(t.rotate.matrix);\n}\n\nexport { K as GamepadKeyboardController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/state/controllers/GamepadKeyboardController.js"],"names":["_","t","neverReached","e","acosClamped","i","clamp","a","deg2rad","r","isSome","o","property","s","subclass","n","c","m","l","p","f","h","d","b","u","g","v","C","y","w","S","O","x","j","getReferenceEllipsoid","M","wrap","z","T","k","sv3d","A","applyAll","D","TiltDefault","H","InteractiveController","R","panMotionToRotationMatrix","E","onSurfaceTiltToEyeTiltGlobal","F","offSurfaceTiltToEyeTiltGlobal","G","viewAngle","U","headingTiltToDirectionUp","P","createDirectionUp","V","I","extractTransformation","B","isZeroTransformation","L","extractTransformationKeyboard","q","K","constructor","transformation","translation","heading","tilt","zoom","keysButtonState","tmpCamera","constraintOptions","selection","interactionType","interactionStartCamera","interactionFactor","interactionDirection","tiltMode","handleEventGamepad","view","navigation","gamepad","action","finishController","activateDirection","deactivateDirection","onControllerStart","filteredSurfaceElevation","pointsOfInterest","cameraOnSurface","location","headingStart","camera","updateFilteredSurfaceElevation","stepController","updateStartHeading","currentCamera","copyViewFrom","updateCameraCenter","copyFrom","calculateControlTransformation","Y","applyDisabledMovementTypes","applyPan","pan","applyRotate","rotate","applyZoom","applyAscend","ascend","enabled","$","center","eye","matrix","up","state","isGlobal","viewForward","get","tt","renderCoordsHelper","worldUpAtPosition","it","computeVelocities","isLocal","calculateControlTransformationLocal","calculateControlTransformationGlobal","centerOnSurfaceFrequent","estimatedSurfaceAltitude","ray","intersectManifoldClosestSilhouette","viewRight","mode","min","max","startCamera","clampTiltDeltaGlobalToValidRange","spatialReference","origin","intersectManifold","radius","direction","getPointAbsoluteSurfaceElevation","getAltitude","Math","abs","setAltitude","clampedDistanceToSurface","X","et","computeHeadingRotateRadius","sin","minimumAscendVelocity","constraints","collision","N","width","J","tan","fovX","Q","W","disableMovements","viewingMode","activatesFor","Z","constructOnly","prototype","GamepadKeyboardController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import{neverReached as e}from\"../../../../core/compilerUtils.js\";import{acosClamped as i,clamp as a,deg2rad as r}from\"../../../../core/mathUtils.js\";import{isSome as o}from\"../../../../core/maybe.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{t as c,c as m,i as l}from\"../../../../chunks/mat4.js\";import{c as p}from\"../../../../chunks/mat4f64.js\";import{f as h,m as d,b as u,a as f,g as v,o as C,l as g,s as y,n as w,c as b,d as S,i as O,r as x}from\"../../../../chunks/vec3.js\";import{c as j}from\"../../../../chunks/vec3f64.js\";import{getReferenceEllipsoid as M}from\"../../../../geometry/projectionEllipsoid.js\";import{wrap as z}from\"../../../../geometry/support/ray.js\";import{b as T,e as k}from\"../../../../chunks/sphere.js\";import{sv3d as A}from\"../../../../geometry/support/vectorStacks.js\";import{applyAll as D}from\"../../camera/constraintUtils.js\";import{TiltDefault as H}from\"../Constraints.js\";import{InteractiveController as R}from\"./InteractiveController.js\";import{panMotionToRotationMatrix as E,onSurfaceTiltToEyeTiltGlobal as F,offSurfaceTiltToEyeTiltGlobal as G}from\"../utils/navigationUtils.js\";import{viewAngle as U}from\"../utils/viewUtils.js\";import{headingTiltToDirectionUp as P}from\"../../support/cameraUtils.js\";import{createDirectionUp as V}from\"../../support/cameraUtilsInternal.js\";import I from\"../../webgl-engine/lib/Camera.js\";import{extractTransformation as B,isZeroTransformation as L,extractTransformationKeyboard as q}from\"../../../navigation/gamepadAndKeyboardUtils.js\";let K=class extends R{constructor(t){super(t),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new I,this.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new I,interactionFactor:0,interactionDirection:null,tiltMode:1}}handleEventGamepad(t){const e=B(t,this.view.navigation.gamepad,this.transformation);(\"end\"===t.action||L(e))&&this.finishController()}activateDirection(t){this.keysButtonState[t]=1,q(this.keysButtonState,this.transformation)}deactivateDirection(t){this.keysButtonState[t]=0;const e=q(this.keysButtonState,this.transformation);L(e)&&this.finishController()}onControllerStart(t){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(t)}updateFilteredSurfaceElevation(t){const e=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(e-this.filteredSurfaceElevation)*t}stepController(t,e){this.updateStartHeading(),this.updateFilteredSurfaceElevation(t),this.currentCamera.copyViewFrom(e),this.updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this.calculateControlTransformation(t,this.currentCamera,Y),this.applyDisabledMovementTypes(Y),this.applyPan(Y.pan),this.applyRotate(Y.rotate),this.applyZoom(Y.zoom),this.applyAscend(Y.ascend),this.constraintOptions.interactionType=0,this.constraintOptions.selection=8,D(this.view,this.currentCamera,this.constraintOptions),super.stepController(t,e)}updateStartHeading(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)}applyRotate(t){if(!t.enabled)return;const e=this.currentCamera;h($,e.center,e.eye),d($,$,t.matrix),e.center=u($,$,e.eye),e.up=d($,e.up,t.matrix),this.constraintOptions.interactionType=3,this.constraintOptions.selection=7,D(this.view,e,this.constraintOptions)}applyPan(t,e=this.currentCamera){if(!t.enabled)return;e.eye=d($,e.eye,t.matrix),e.center=d($,e.center,t.matrix);this.view.state.isGlobal&&(e.up=d($,e.up,t.matrix)),this.constraintOptions.interactionType=4,this.constraintOptions.selection=15,D(this.view,e,this.constraintOptions)}applyZoom(t){if(!t)return;const e=this.currentCamera.viewForward;this.currentCamera.eye=u($,this.currentCamera.eye,f(A.get(),e,t)),v(tt,e),C(tt,tt),this.constraintOptions.interactionDirection=tt,this.constraintOptions.interactionType=1,this.constraintOptions.selection=7,D(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}applyAscend(t){if(!t)return;const e=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,A.get());this.constraintOptions.interactionDirection=v(tt,e);if(this.view.state.isGlobal){const e=g(this.currentCamera.eye),i=(e+t)/e;this.currentCamera.eye=f($,this.currentCamera.eye,i),this.currentCamera.center=f($,this.currentCamera.center,i)}else{const i=f(A.get(),e,t);this.currentCamera.eye=u($,this.currentCamera.eye,i),this.currentCamera.center=u($,this.currentCamera.center,i)}this.updateCameraCenter(),this.constraintOptions.interactionType=5,this.constraintOptions.selection=8,D(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter(),this.constraintOptions.selection=7,D(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}calculateControlTransformation(t,e,i){it(i);const a=this.computeVelocities(t);this.view.state.isLocal?this.calculateControlTransformationLocal(a,e,i):this.calculateControlTransformationGlobal(a,e,i)}updateCameraCenter(){const t=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,e=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=e.intersectManifoldClosestSilhouette(i,t,$)}calculateControlTransformationLocal(t,i,r){const{viewRight:o,viewForward:s}=i,n=this.transformation,l=this.view.navigation.gamepad,p=y(A.get(),s[0],s[1],0);w(p,p);const h=n.translation[0]*t.pan;if(0!==h){const t=f(A.get(),o,h);c(r.pan.matrix,r.pan.matrix,t),r.pan.enabled=!0}switch(l.mode){case\"pan\":{const e=-n.translation[1]*t.pan;if(0!==e){const t=f(A.get(),p,e);c(r.pan.matrix,r.pan.matrix,t),r.pan.enabled=!0}r.zoom=n.zoom*t.zoom;break}case\"zoom\":r.zoom=(-n.translation[1]+n.zoom)*t.zoom;break;default:e(l.mode)}const d=n.translation[2]*t.ascend;r.ascend=d;const u=-n.heading*t.rotate;0!==u&&(m(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,A.get())),r.rotate.enabled=!0);const v=n.tilt*t.rotate,C=U(this.view.renderCoordsHelper,i.center,i.eye),g=a(C+v,H.min,H.max)-C;g&&(m(r.rotate.matrix,r.rotate.matrix,g,o),r.rotate.enabled=!0)}calculateControlTransformationGlobal(t,e,i){const{eye:a,viewRight:r}=e,o=this.transformation,s=this.view.navigation.gamepad,n=b(A.get(),r,a);w(n,n),C(n,n),E(this.startCamera,e,o,t,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,s),this.tmpCamera.copyFrom(this.currentCamera),this.applyPan(Y.pan,this.tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=o.translation[2]*t.ascend;i.ascend=l;const p=-o.heading*t.rotate;0!==p&&(m(i.rotate.matrix,i.rotate.matrix,p,this.tmpCamera.eye),i.rotate.enabled=!0);const h=o.tilt*t.rotate,d=this.clampTiltDeltaGlobalToValidRange(h,e.ray,c);0!==d&&(m(i.rotate.matrix,i.rotate.matrix,d,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*t.zoom}clampTiltDeltaGlobalToValidRange(t,e,r){const o=M(this.view.spatialReference),s=F(H.min,e.origin,r,o);let n=0,c=0;const m=A.get();if(this.view.renderCoordsHelper.intersectManifold(e,r,m)){const t=U(this.view.renderCoordsHelper,m,e.origin);n=F(t,e.origin,r,o),c=F(H.max,e.origin,r,o)}else{T(k(r+o.radius),e,m);const t=i(-S(e.direction,w(m,m)));n=G(t,e.origin,r,o),c=G(H.max,e.origin,r,o)}return a(n+t,s,c)-n}getPointAbsoluteSurfaceElevation(t,e,i){const{renderCoordsHelper:a}=this.view,r=a.getAltitude(t),o=e+Math.abs(r-e);return a.setAltitude(i,o,t),o}clampedDistanceToSurface(t,e){const{renderCoordsHelper:i}=this.view,{camera:a}=this.view.state,{direction:r}=P(this.view,e,0,X,et),o=i.intersectManifoldClosestSilhouette(z(e,r),t,A.get()),s=O(e,o),n=i.intersectManifoldClosestSilhouette(z(e,x(A.get(),e,a.center)),t,A.get()),c=O(e,n);return Math.min(s,c)}computeHeadingRotateRadius(t){const{renderCoordsHelper:e,state:a}=this.view,{camera:r,isGlobal:o}=a,s=e.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,A.get());if(o){const e=h(A.get(),t,s),a=g(e);f(e,e,1/a);const r=w(A.get(),t),o=i(S(r,e));return a*Math.sin(Math.min(_,o))}{const i=v(A.get(),t);return e.setAltitude(i,this.filteredSurfaceElevation),O(s,i)}}minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:N}computeVelocities(t){const e=this.filteredSurfaceElevation,i=e+M(this.view.spatialReference).radius,{camera:r,isGlobal:o}=this.view.state,s=A.get(),n=this.getPointAbsoluteSurfaceElevation(r.eye,e,s),c=this.clampedDistanceToSurface(e,s),m=r.width/2,l=J*r.width,p=J*r.width,h=c*Math.tan(.5*r.fovX)/m,d=h/i,u=h/this.computeHeadingRotateRadius(s),f=n-e;return{pan:(o?d:h)*l*t,ascend:Math.max(this.minimumAscendVelocity()*t,2**(l*t/m)*f-f),zoom:2**(l*t/m)*c-c,rotate:a(u*p,Q,W)*t}}applyDisabledMovementTypes(t){!o(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(t.zoom=this.disableMovements.zoom?0:t.zoom,t.ascend=this.disableMovements.ascend?0:t.ascend,t.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&l(t.pan.matrix),t.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&l(t.rotate.matrix))}static activatesFor(t,e){const i=B(e,t.navigation.gamepad,Z);return!(\"end\"===e.action||L(i))}};t([s({constructOnly:!0})],K.prototype,\"view\",void 0),t([s({constructOnly:!0})],K.prototype,\"gamepadDevice\",void 0),t([s({constructOnly:!0})],K.prototype,\"disableMovements\",void 0),K=t([n(\"esri.views.3d.state.controllers.GamepadKeyboardController\")],K);const Z={translation:[0,0,0],heading:0,tilt:0,zoom:0},X=80,_=r(X),J=.75,N=5,Q=r(30),W=r(80),Y={zoom:0,ascend:0,pan:{enabled:!1,matrix:p()},rotate:{enabled:!1,matrix:p()}},$=j(),tt=j(),et=V();function it(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,l(t.pan.matrix),t.rotate.enabled=!1,l(t.rotate.matrix)}export{K as GamepadKeyboardController};\n"]},"metadata":{},"sourceType":"module"}