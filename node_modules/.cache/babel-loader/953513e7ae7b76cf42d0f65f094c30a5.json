{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport e from \"../../../core/Error.js\";\nimport { unwrap as r } from \"../../../core/maybe.js\";\nimport { eachAlways as s, createAbortError as a } from \"../../../core/promiseUtils.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport n from \"./BaseRaster.js\";\nimport l from \"./InMemoryRaster.js\";\nimport { parsePAMInfo as m } from \"./pamParser.js\";\nimport { getFormat as p } from \"../rasterFormats/RasterCodec.js\";\nimport { estimateStatisticsFromHistograms as c } from \"../rasterFunctions/pixelUtils.js\";\nimport f from \"../rasterTransforms/PolynomialTransform.js\";\nimport u from \"../../../geometry/SpatialReference.js\";\nimport h from \"../../../geometry/Extent.js\";\nlet d = class extends n {\n  async open(t) {\n    await this.init();\n    const e = await this._fetchData(t);\n    let {\n      spatialReference: r,\n      statistics: s,\n      histograms: a,\n      transform: o\n    } = await this._fetchAuxiliaryData(t);\n    const i = !r;\n    i && (r = new u({\n      wkid: 3857\n    })), null != a && a.length && null == s && (s = c(a));\n    const {\n      width: n,\n      height: m\n    } = e;\n    let p = new h({\n      xmin: -.5,\n      ymin: .5 - m,\n      xmax: n - .5,\n      ymax: .5,\n      spatialReference: r\n    });\n    const f = o ? o.forwardTransform(p) : p;\n    let d = !0;\n\n    if (o) {\n      const t = o.forwardCoefficients;\n      d = t && 0 === t[1] && 0 === t[2], d && (o = null, p = f);\n    }\n\n    const w = new l({\n      data: {\n        extent: f,\n        nativeExtent: p,\n        transform: o,\n        pixelBlock: e,\n        statistics: s,\n        histograms: a,\n        keyProperties: {\n          DateType: \"Processed\"\n        },\n        isPseudoSpatialReference: i\n      }\n    });\n    await w.open(), this._set(\"rasterInfo\", w.rasterInfo), this._inMemoryRaster = w;\n  }\n\n  fetchRawTile(t, e, r, s = {}) {\n    return this._inMemoryRaster.fetchRawTile(t, e, r, s);\n  }\n\n  async _fetchData(t) {\n    const {\n      data: r\n    } = await this.request(this.url, {\n      responseType: \"array-buffer\",\n      signal: null == t ? void 0 : t.signal\n    }),\n          s = p(r).toUpperCase();\n    if (\"JPG\" !== s && \"PNG\" !== s && \"GIF\" !== s && \"BMP\" !== s) throw new e(\"image-aux-raster:open\", \"the data is not a supported format\");\n\n    this._set(\"datasetFormat\", s);\n\n    return await this.decodePixelBlock(r, {\n      format: \"jpg\",\n      width: 1,\n      height: 1,\n      useCanvas: !0\n    });\n  }\n\n  async _fetchAuxiliaryData(t) {\n    var e, o;\n    const i = r(null == t ? void 0 : t.signal),\n          n = null != (e = this.ioConfig.skipExtensions) ? e : [],\n          l = n.indexOf(\"aux.xml\") > -1 ? null : this.request(this.url + \".aux.xml\", {\n      responseType: \"xml\",\n      signal: i\n    }),\n          p = this.datasetFormat,\n          c = \"JPG\" === p ? \"jgw\" : \"PNG\" === p ? \"pgw\" : \"BMP\" === p ? \"bpw\" : null,\n          u = n.indexOf(c) > -1 ? null : this.request(this.url.slice(0, this.url.lastIndexOf(\".\")) + \".\" + c, {\n      responseType: \"text\",\n      signal: i\n    }),\n          h = await s([l, u]);\n    if (null != i && i.aborted) throw a();\n    const d = m(null == (o = h[0].value) ? void 0 : o.data);\n\n    if (!d.transform) {\n      const t = h[1].value ? h[1].value.data.split(\"\\n\").slice(0, 6).map(t => Number(t)) : null;\n      d.transform = 6 === (null == t ? void 0 : t.length) ? new f({\n        forwardCoefficients: [t[4], t[5], t[0], -t[1], t[2], -t[3]]\n      }) : null;\n    }\n\n    return d;\n  }\n\n};\nt([o({\n  type: String,\n  json: {\n    write: !0\n  }\n})], d.prototype, \"datasetFormat\", void 0), d = t([i(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")], d);\nvar w = d;\nexport default w;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/support/rasterDatasets/ImageAuxRaster.js"],"names":["_","t","e","unwrap","r","eachAlways","s","createAbortError","a","property","o","subclass","i","n","l","parsePAMInfo","m","getFormat","p","estimateStatisticsFromHistograms","c","f","u","h","d","open","init","_fetchData","spatialReference","statistics","histograms","transform","_fetchAuxiliaryData","wkid","length","width","height","xmin","ymin","xmax","ymax","forwardTransform","forwardCoefficients","w","data","extent","nativeExtent","pixelBlock","keyProperties","DateType","isPseudoSpatialReference","_set","rasterInfo","_inMemoryRaster","fetchRawTile","request","url","responseType","signal","toUpperCase","decodePixelBlock","format","useCanvas","ioConfig","skipExtensions","indexOf","datasetFormat","slice","lastIndexOf","aborted","value","split","map","Number","type","String","json","write","prototype"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import e from\"../../../core/Error.js\";import{unwrap as r}from\"../../../core/maybe.js\";import{eachAlways as s,createAbortError as a}from\"../../../core/promiseUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"./BaseRaster.js\";import l from\"./InMemoryRaster.js\";import{parsePAMInfo as m}from\"./pamParser.js\";import{getFormat as p}from\"../rasterFormats/RasterCodec.js\";import{estimateStatisticsFromHistograms as c}from\"../rasterFunctions/pixelUtils.js\";import f from\"../rasterTransforms/PolynomialTransform.js\";import u from\"../../../geometry/SpatialReference.js\";import h from\"../../../geometry/Extent.js\";let d=class extends n{async open(t){await this.init();const e=await this._fetchData(t);let{spatialReference:r,statistics:s,histograms:a,transform:o}=await this._fetchAuxiliaryData(t);const i=!r;i&&(r=new u({wkid:3857})),null!=a&&a.length&&null==s&&(s=c(a));const{width:n,height:m}=e;let p=new h({xmin:-.5,ymin:.5-m,xmax:n-.5,ymax:.5,spatialReference:r});const f=o?o.forwardTransform(p):p;let d=!0;if(o){const t=o.forwardCoefficients;d=t&&0===t[1]&&0===t[2],d&&(o=null,p=f)}const w=new l({data:{extent:f,nativeExtent:p,transform:o,pixelBlock:e,statistics:s,histograms:a,keyProperties:{DateType:\"Processed\"},isPseudoSpatialReference:i}});await w.open(),this._set(\"rasterInfo\",w.rasterInfo),this._inMemoryRaster=w}fetchRawTile(t,e,r,s={}){return this._inMemoryRaster.fetchRawTile(t,e,r,s)}async _fetchData(t){const{data:r}=await this.request(this.url,{responseType:\"array-buffer\",signal:null==t?void 0:t.signal}),s=p(r).toUpperCase();if(\"JPG\"!==s&&\"PNG\"!==s&&\"GIF\"!==s&&\"BMP\"!==s)throw new e(\"image-aux-raster:open\",\"the data is not a supported format\");this._set(\"datasetFormat\",s);return await this.decodePixelBlock(r,{format:\"jpg\",width:1,height:1,useCanvas:!0})}async _fetchAuxiliaryData(t){var e,o;const i=r(null==t?void 0:t.signal),n=null!=(e=this.ioConfig.skipExtensions)?e:[],l=n.indexOf(\"aux.xml\")>-1?null:this.request(this.url+\".aux.xml\",{responseType:\"xml\",signal:i}),p=this.datasetFormat,c=\"JPG\"===p?\"jgw\":\"PNG\"===p?\"pgw\":\"BMP\"===p?\"bpw\":null,u=n.indexOf(c)>-1?null:this.request(this.url.slice(0,this.url.lastIndexOf(\".\"))+\".\"+c,{responseType:\"text\",signal:i}),h=await s([l,u]);if(null!=i&&i.aborted)throw a();const d=m(null==(o=h[0].value)?void 0:o.data);if(!d.transform){const t=h[1].value?h[1].value.data.split(\"\\n\").slice(0,6).map((t=>Number(t))):null;d.transform=6===(null==t?void 0:t.length)?new f({forwardCoefficients:[t[4],t[5],t[0],-t[1],t[2],-t[3]]}):null}return d}};t([o({type:String,json:{write:!0}})],d.prototype,\"datasetFormat\",void 0),d=t([i(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")],d);var w=d;export default w;\n"]},"metadata":{},"sourceType":"module"}