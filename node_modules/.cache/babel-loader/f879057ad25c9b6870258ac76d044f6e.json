{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { id as e } from \"../kernel.js\";\nimport t from \"../request.js\";\nimport r from \"./featureSetCollection.js\";\nimport n from \"./featureset/actions/AttributeFilter.js\";\nimport a from \"./featureset/actions/GroupBy.js\";\nimport s from \"./featureset/actions/OrderBy.js\";\nimport i from \"./featureset/actions/SpatialFilter.js\";\nimport l from \"./featureset/actions/Top.js\";\nimport o from \"./featureset/sources/FeatureLayerDynamic.js\";\nimport u from \"./featureset/sources/FeatureLayerMemory.js\";\nimport c from \"./featureset/sources/FeatureLayerRelated.js\";\nimport d from \"./featureset/support/cache.js\";\nimport { extractServiceUrl as m } from \"./featureset/support/shared.js\";\nimport { resolve as h, reject as f, create as p } from \"../core/promiseUtils.js\";\nimport { WhereClause as y } from \"../core/sql/WhereClause.js\";\nimport L from \"../layers/FeatureLayer.js\";\nimport I from \"../portal/Portal.js\";\nimport _ from \"../portal/PortalItem.js\";\n\nfunction S() {\n  null === d.applicationCache && (d.applicationCache = new d());\n}\n\nfunction N(e, t) {\n  if (d.applicationCache) {\n    const r = d.applicationCache.getLayerInfo(e);\n    if (r) return r.then(r => h(new L({\n      url: e,\n      outFields: t,\n      sourceJSON: r\n    })));\n    const n = new L({\n      url: e,\n      outFields: t\n    });\n    let a = p((e, t) => {\n      n.load().then(() => {\n        e(n.sourceJSON);\n      }, e => {\n        t(e);\n      });\n    });\n    return d.applicationCache && (d.applicationCache.setLayerInfo(e, a), a = a.catch(t => {\n      throw d.applicationCache.clearLayerInfo(e), t;\n    })), a.then(() => h(n));\n  }\n\n  return h(new L({\n    url: e,\n    outFields: t\n  }));\n}\n\nfunction T(e, t, r, n, a, s = null) {\n  return N(e, [\"*\"]).then(e => h(A(e, t, r, n, a, s)));\n}\n\nfunction A(e, t = null, r = null, n = !0, a = null, s = null) {\n  return !0 === e._hasMemorySource() ? new u({\n    layer: e,\n    spatialReference: t,\n    outFields: r,\n    includeGeometry: n,\n    lrucache: a,\n    interceptor: s\n  }) : new o({\n    layer: e,\n    spatialReference: t,\n    outFields: r,\n    includeGeometry: n,\n    lrucache: a,\n    interceptor: s\n  });\n}\n\nfunction C(e) {\n  if (null !== d.applicationCache) {\n    const t = d.applicationCache.getLayerInfo(e);\n    if (null !== t) return t;\n  }\n\n  let r = t(e, {\n    responseType: \"json\",\n    query: {\n      f: \"json\"\n    }\n  }).then(e => {\n    if (e.data) {\n      const t = e.data;\n      return h(t);\n    }\n\n    return h(null);\n  });\n  return null !== d.applicationCache && (d.applicationCache.setLayerInfo(e, r), r = r.catch(t => {\n    throw d.applicationCache.clearLayerInfo(e), t;\n  })), r;\n}\n\nfunction F(e, r) {\n  const n = \"QUERYDATAELEMTS:\" + r.toString() + \":\" + e;\n\n  if (null !== d.applicationCache) {\n    const e = d.applicationCache.getLayerInfo(n);\n    if (null !== e) return e;\n  }\n\n  let a = t(e + \"/queryDataElements\", {\n    method: \"post\",\n    responseType: \"json\",\n    query: {\n      layers: JSON.stringify([r.toString()]),\n      f: \"json\"\n    }\n  }).then(e => {\n    if (e.data) {\n      const t = e.data;\n      if (t.layerDataElements && t.layerDataElements[0]) return t.layerDataElements[0];\n    }\n\n    throw new Error(\"Not Found\");\n  });\n  return null !== d.applicationCache && (d.applicationCache.setLayerInfo(n, a), a = a.catch(e => {\n    throw d.applicationCache.clearLayerInfo(n), e;\n  })), a;\n}\n\nfunction g(e) {\n  if (null !== d.applicationCache) {\n    const t = d.applicationCache.getLayerInfo(e);\n    if (null !== t) return t;\n  }\n\n  let r = t(e, {\n    responseType: \"json\",\n    query: {\n      f: \"json\"\n    }\n  }).then(e => {\n    if (e.data) {\n      const t = e.data;\n      return t.layers || (t.layers = []), t.tables || (t.tables = []), h(t);\n    }\n\n    return h({\n      layers: [],\n      tables: []\n    });\n  });\n  return null !== d.applicationCache && (d.applicationCache.setLayerInfo(e, r), r = r.catch(t => {\n    throw d.applicationCache.clearLayerInfo(e), t;\n  })), r;\n}\n\nfunction k(e, t) {\n  const r = {\n    metadata: null,\n    networkId: -1,\n    unVersion: 3,\n    terminals: [],\n    queryelem: null,\n    layerNameLkp: {},\n    lkp: null\n  };\n  return g(e).then(n => {\n    if (r.metadata = n, n.controllerDatasetLayers && void 0 !== n.controllerDatasetLayers.utilityNetworkLayerId && null !== n.controllerDatasetLayers.utilityNetworkLayerId) {\n      if (n.layers) for (const e of n.layers) r.layerNameLkp[e.id] = e.name;\n      if (n.tables) for (const e of n.tables) r.layerNameLkp[e.id] = e.name;\n      const a = n.controllerDatasetLayers.utilityNetworkLayerId;\n      return r.networkId = a, F(e, a).then(n => {\n        if (n) {\n          r.queryelem = n, r.queryelem && r.queryelem.dataElement && void 0 !== r.queryelem.dataElement.schemaGeneration && (r.unVersion = r.queryelem.dataElement.schemaGeneration), r.lkp = {}, r.queryelem.dataElement.domainNetworks || (r.queryelem.dataElement.domainNetworks = []);\n\n          for (const e of r.queryelem.dataElement.domainNetworks) {\n            for (const t of e.edgeSources ? e.edgeSources : []) {\n              const e = {\n                layerId: t.layerId,\n                sourceId: t.sourceId,\n                className: r.layerNameLkp[t.layerId] ? r.layerNameLkp[t.layerId] : null\n              };\n              e.className && (r.lkp[e.className] = e);\n            }\n\n            for (const t of e.junctionSources ? e.junctionSources : []) {\n              const e = {\n                layerId: t.layerId,\n                sourceId: t.sourceId,\n                className: r.layerNameLkp[t.layerId] ? r.layerNameLkp[t.layerId] : null\n              };\n              e.className && (r.lkp[e.className] = e);\n            }\n          }\n\n          if (r.queryelem.dataElement.terminalConfigurations) for (const e of r.queryelem.dataElement.terminalConfigurations) for (const t of e.terminals) r.terminals.push({\n            terminalId: t.terminalId,\n            terminalName: t.terminalName\n          });\n          return C(e + \"/\" + a).then(n => {\n            if (n.systemLayers && void 0 !== n.systemLayers.associationsTableId && null !== n.systemLayers.associationsTableId) {\n              const a = [];\n              return r.unVersion >= 4 && (a.push(\"STATUS\"), a.push(\"PERCENTALONG\")), T(e + \"/\" + n.systemLayers.associationsTableId.toString(), t, [\"OBJECTID\", \"FROMNETWORKSOURCEID\", \"TONETWORKSOURCEID\", \"FROMGLOBALID\", \"TOGLOBALID\", \"TOTERMINALID\", \"FROMTERMINALID\", \"ASSOCIATIONTYPE\", \"ISCONTENTVISIBLE\", \"GLOBALID\", ...a], !1, null, null).then(e => e.load()).then(e => r.unVersion >= 4 ? (e = e.filter(y.create(\"STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)\", e.getFieldsIndex()))).load() : e).then(e => ({\n                lkp: r.lkp,\n                associations: e,\n                unVersion: r.unVersion,\n                terminals: r.terminals\n              }));\n            }\n\n            return {\n              associations: null,\n              unVersion: r.unVersion,\n              lkp: null,\n              terminals: []\n            };\n          });\n        }\n\n        return {\n          associations: null,\n          unVersion: r.unVersion,\n          lkp: null,\n          terminals: []\n        };\n      });\n    }\n\n    return {\n      associations: null,\n      unVersion: r.unVersion,\n      lkp: null,\n      terminals: []\n    };\n  });\n}\n\nfunction j(e, t, r, n = null, a = null, s = !0, i = null, l = null) {\n  let o = e.serviceUrl();\n  return o ? (o = \"/\" === o.charAt(o.length - 1) ? o + t.relatedTableId.toString() : o + \"/\" + t.relatedTableId.toString(), T(o, n, a, s, i, l).then(o => new c({\n    layer: e,\n    relatedLayer: o,\n    relationship: t,\n    objectId: r,\n    spatialReference: n,\n    outFields: a,\n    includeGeometry: s,\n    lrucache: i,\n    interceptor: l\n  }))) : null;\n}\n\nn.registerAction(), a.registerAction(), s.registerAction(), i.registerAction(), l.registerAction();\n\nclass O extends r {\n  constructor(e, t = null, r = null, n = null) {\n    super(), this._map = e, this._overridespref = t, this.lrucache = r, this.interceptor = n, this._instantLayers = [];\n  }\n\n  makeAndAddFeatureSet(e, t = !0, r = null) {\n    const n = A(e, this._overridespref, null === r ? [\"*\"] : r, t, this.lrucache, this.interceptor);\n    return this._instantLayers.push({\n      featureset: n,\n      opitem: e,\n      includeGeometry: t,\n      outFields: JSON.stringify(r)\n    }), n;\n  }\n\n  featureSetByName(e, t = !0, r = null) {\n    if (void 0 !== this._map.loaded && void 0 !== this._map.load && !1 === this._map.loaded) return this._map.load().then(() => {\n      try {\n        return this.featureSetByName(e, t, r);\n      } catch (n) {\n        return f(n);\n      }\n    });\n    null === r && (r = [\"*\"]), r = (r = r.slice(0)).sort();\n    const n = JSON.stringify(r);\n\n    for (let s = 0; s < this._instantLayers.length; s++) {\n      const r = this._instantLayers[s];\n      if (r.opitem.title === e && r.includeGeometry === t && r.outFields === n) return this.resolvePromise(this._instantLayers[s].featureset);\n    }\n\n    const a = this._map.layers.find(t => t instanceof L && t.title === e);\n\n    if (a) return this.resolvePromise(this.makeAndAddFeatureSet(a, t, r));\n\n    if (this._map.tables) {\n      const n = this._map.tables.find(t => !!(t.title && t.title === e || t.title && t.title === e));\n\n      if (n) {\n        if (n instanceof L) return this.resolvePromise(this.makeAndAddFeatureSet(n, t, r));\n        if (n._materializedTable) ;else {\n          const e = n.outFields ? n : { ...n,\n            outFields: [\"*\"]\n          };\n          n._materializedTable = new L(e);\n        }\n        return n._materializedTable.load().then(() => this.resolvePromise(this.makeAndAddFeatureSet(n._materializedTable, t, r)));\n      }\n    }\n\n    return this.resolvePromise(null);\n  }\n\n  featureSetById(e, t = !0, r = [\"*\"]) {\n    if (void 0 !== this._map.loaded && void 0 !== this._map.load && !1 === this._map.loaded) return this._map.load().then(() => {\n      try {\n        return this.featureSetById(e, t, r);\n      } catch (n) {\n        return f(n);\n      }\n    });\n    null === r && (r = [\"*\"]), r = (r = r.slice(0)).sort();\n    const n = JSON.stringify(r);\n\n    for (let s = 0; s < this._instantLayers.length; s++) {\n      const r = this._instantLayers[s];\n      if (r.opitem.id === e && r.includeGeometry === t && r.outFields === n) return this.resolvePromise(this._instantLayers[s].featureset);\n    }\n\n    const a = this._map.layers.find(t => t instanceof L && t.id === e);\n\n    if (a) return this.resolvePromise(this.makeAndAddFeatureSet(a, t, r));\n\n    if (this._map.tables) {\n      const n = this._map.tables.find(t => t.id === e);\n\n      if (n) {\n        if (n instanceof L) return this.resolvePromise(this.makeAndAddFeatureSet(n, t, r));\n        if (n._materializedTable) ;else {\n          const e = { ...n,\n            outFields: [\"*\"]\n          };\n          n._materializedTable = new L(e);\n        }\n        return n._materializedTable.load().then(() => this.resolvePromise(this.makeAndAddFeatureSet(n._materializedTable, t, r)));\n      }\n    }\n\n    return this.resolvePromise(null);\n  }\n\n}\n\nclass w extends r {\n  constructor(e, t = null, r = null, n = null) {\n    super(), this._url = e, this._overridespref = t, this.lrucache = r, this.interceptor = n, this.metadata = null, this._instantLayers = [];\n  }\n\n  get url() {\n    return this._url;\n  }\n\n  makeAndAddFeatureSet(e, t = !0, r = null) {\n    const n = A(e, this._overridespref, null === r ? [\"*\"] : r, t, this.lrucache);\n    return this._instantLayers.push({\n      featureset: n,\n      opitem: e,\n      includeGeometry: t,\n      outFields: JSON.stringify(r)\n    }), n;\n  }\n\n  _loadMetaData() {\n    return g(this._url).then(e => (this.metadata = e, e));\n  }\n\n  load() {\n    return this._loadMetaData();\n  }\n\n  clone() {\n    return new w(this._url, this._overridespref, this.lrucache, this.interceptor);\n  }\n\n  featureSetByName(e, t = !0, r = null) {\n    null === r && (r = [\"*\"]), r = (r = r.slice(0)).sort();\n    const n = JSON.stringify(r);\n\n    for (let a = 0; a < this._instantLayers.length; a++) {\n      const r = this._instantLayers[a];\n      if (r.opitem.title === e && r.includeGeometry === t && r.outFields === n) return this.resolvePromise(this._instantLayers[a].featureset);\n    }\n\n    return this._loadMetaData().then(n => {\n      let a = null;\n\n      for (const t of n.layers ? n.layers : []) t.name === e && (a = t);\n\n      if (!a) for (const t of n.tables ? n.tables : []) t.name === e && (a = t);\n      return a ? N(this._url + \"/\" + a.id, [\"*\"]).then(e => this.makeAndAddFeatureSet(e, t, r)) : this.resolvePromise(null);\n    });\n  }\n\n  featureSetById(e, t = !0, r = [\"*\"]) {\n    null === r && (r = [\"*\"]), r = (r = r.slice(0)).sort();\n    const n = JSON.stringify(r);\n    e = null != e ? e.toString() : \"\";\n\n    for (let a = 0; a < this._instantLayers.length; a++) {\n      const r = this._instantLayers[a];\n      if (r.opitem.id === e && r.includeGeometry === t && r.outFields === n) return this.resolvePromise(this._instantLayers[a].featureset);\n    }\n\n    return this._loadMetaData().then(n => {\n      let a = null;\n\n      for (const t of n.layers ? n.layers : []) null !== t.id && void 0 !== t.id && t.id.toString() === e && (a = t);\n\n      if (!a) for (const t of n.tables ? n.tables : []) null !== t.id && void 0 !== t.id && t.id.toString() === e && (a = t);\n      return a ? N(this._url + \"/\" + a.id, [\"*\"]).then(e => this.makeAndAddFeatureSet(e, t, r)) : this.resolvePromise(null);\n    });\n  }\n\n}\n\nfunction v(e, t, r = null, n = null) {\n  return new O(e, t, r, n);\n}\n\nfunction E(e, t, r = null, n = null) {\n  return new w(e, t, r, n);\n}\n\nfunction b(e, t) {\n  if (null === e) return t;\n  return new I({\n    url: e.field(\"url\")\n  });\n}\n\nfunction D(r, n, a) {\n  return e.findCredential(r.restUrl) ? \"loaded\" === r.loadStatus && \"\" === n && r.user && r.user.sourceJSON && !1 === a ? h(r.user.sourceJSON) : \"\" === n ? t(r.restUrl + \"/community/self\", {\n    responseType: \"json\",\n    query: {\n      f: \"json\",\n      ...(!1 === a ? {} : {\n        returnUserLicenseTypeExtensions: !0\n      })\n    }\n  }).then(e => {\n    if (e.data) {\n      const t = e.data;\n      if (t && t.username) return h(t);\n    }\n\n    return h(null);\n  }) : t(r.restUrl + \"/community/users/\" + n, {\n    responseType: \"json\",\n    query: {\n      f: \"json\"\n    }\n  }).then(e => {\n    if (e.data) {\n      const t = e.data;\n      return t.error ? null : h(t);\n    }\n\n    return h(null);\n  }) : h(null);\n}\n\nfunction q(e, t, r, n, a, s, i, l = null) {\n  if (d.applicationCache) {\n    const o = d.applicationCache.getLayerInfo(e + \":\" + s.url);\n    if (o) return o.then(e => {\n      try {\n        const s = new L({\n          url: m(e.url) + \"/\" + t,\n          outFields: [\"*\"]\n        });\n        return h(A(s, r, n, a, i, l));\n      } catch (s) {\n        return f(s);\n      }\n    }, e => f(e));\n  }\n\n  return p((o, u) => {\n    const c = new _({\n      id: e,\n      portal: s\n    }).load();\n    d.applicationCache && d.applicationCache.setLayerInfo(e + \":\" + s.url, c), c.then(e => {\n      try {\n        const s = new L({\n          url: m(e.url) + \"/\" + t,\n          outFields: [\"*\"]\n        });\n        o(A(s, r, n, a, i, l));\n      } catch (s) {\n        u(s);\n      }\n    }, t => {\n      d.applicationCache && d.applicationCache.clearLayerInfo(e + \":\" + s.url), u(t);\n    });\n  });\n}\n\nexport { k as constructAssociationMetaDataFeatureSetFromUrl, A as constructFeatureSet, q as constructFeatureSetFromPortalItem, j as constructFeatureSetFromRelationship, T as constructFeatureSetFromUrl, v as createFeatureSetCollectionFromMap, E as createFeatureSetCollectionFromService, b as getPortal, S as initialiseMetaDataCache, D as lookupUser };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/arcade/featureSetUtils.js"],"names":["id","e","t","r","n","a","s","i","l","o","u","c","d","extractServiceUrl","m","resolve","h","reject","f","create","p","WhereClause","y","L","I","_","S","applicationCache","N","getLayerInfo","then","url","outFields","sourceJSON","load","setLayerInfo","catch","clearLayerInfo","T","A","_hasMemorySource","layer","spatialReference","includeGeometry","lrucache","interceptor","C","responseType","query","data","F","toString","method","layers","JSON","stringify","layerDataElements","Error","g","tables","k","metadata","networkId","unVersion","terminals","queryelem","layerNameLkp","lkp","controllerDatasetLayers","utilityNetworkLayerId","name","dataElement","schemaGeneration","domainNetworks","edgeSources","layerId","sourceId","className","junctionSources","terminalConfigurations","push","terminalId","terminalName","systemLayers","associationsTableId","filter","getFieldsIndex","associations","j","serviceUrl","charAt","length","relatedTableId","relatedLayer","relationship","objectId","registerAction","O","constructor","_map","_overridespref","_instantLayers","makeAndAddFeatureSet","featureset","opitem","featureSetByName","loaded","slice","sort","title","resolvePromise","find","_materializedTable","featureSetById","w","_url","_loadMetaData","clone","v","E","b","field","D","findCredential","restUrl","loadStatus","user","returnUserLicenseTypeExtensions","username","error","q","portal","constructAssociationMetaDataFeatureSetFromUrl","constructFeatureSet","constructFeatureSetFromPortalItem","constructFeatureSetFromRelationship","constructFeatureSetFromUrl","createFeatureSetCollectionFromMap","createFeatureSetCollectionFromService","getPortal","initialiseMetaDataCache","lookupUser"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{id as e}from\"../kernel.js\";import t from\"../request.js\";import r from\"./featureSetCollection.js\";import n from\"./featureset/actions/AttributeFilter.js\";import a from\"./featureset/actions/GroupBy.js\";import s from\"./featureset/actions/OrderBy.js\";import i from\"./featureset/actions/SpatialFilter.js\";import l from\"./featureset/actions/Top.js\";import o from\"./featureset/sources/FeatureLayerDynamic.js\";import u from\"./featureset/sources/FeatureLayerMemory.js\";import c from\"./featureset/sources/FeatureLayerRelated.js\";import d from\"./featureset/support/cache.js\";import{extractServiceUrl as m}from\"./featureset/support/shared.js\";import{resolve as h,reject as f,create as p}from\"../core/promiseUtils.js\";import{WhereClause as y}from\"../core/sql/WhereClause.js\";import L from\"../layers/FeatureLayer.js\";import I from\"../portal/Portal.js\";import _ from\"../portal/PortalItem.js\";function S(){null===d.applicationCache&&(d.applicationCache=new d)}function N(e,t){if(d.applicationCache){const r=d.applicationCache.getLayerInfo(e);if(r)return r.then((r=>h(new L({url:e,outFields:t,sourceJSON:r}))));const n=new L({url:e,outFields:t});let a=p(((e,t)=>{n.load().then((()=>{e(n.sourceJSON)}),(e=>{t(e)}))}));return d.applicationCache&&(d.applicationCache.setLayerInfo(e,a),a=a.catch((t=>{throw d.applicationCache.clearLayerInfo(e),t}))),a.then((()=>h(n)))}return h(new L({url:e,outFields:t}))}function T(e,t,r,n,a,s=null){return N(e,[\"*\"]).then((e=>h(A(e,t,r,n,a,s))))}function A(e,t=null,r=null,n=!0,a=null,s=null){return!0===e._hasMemorySource()?new u({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:s}):new o({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:s})}function C(e){if(null!==d.applicationCache){const t=d.applicationCache.getLayerInfo(e);if(null!==t)return t}let r=t(e,{responseType:\"json\",query:{f:\"json\"}}).then((e=>{if(e.data){const t=e.data;return h(t)}return h(null)}));return null!==d.applicationCache&&(d.applicationCache.setLayerInfo(e,r),r=r.catch((t=>{throw d.applicationCache.clearLayerInfo(e),t}))),r}function F(e,r){const n=\"QUERYDATAELEMTS:\"+r.toString()+\":\"+e;if(null!==d.applicationCache){const e=d.applicationCache.getLayerInfo(n);if(null!==e)return e}let a=t(e+\"/queryDataElements\",{method:\"post\",responseType:\"json\",query:{layers:JSON.stringify([r.toString()]),f:\"json\"}}).then((e=>{if(e.data){const t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error(\"Not Found\")}));return null!==d.applicationCache&&(d.applicationCache.setLayerInfo(n,a),a=a.catch((e=>{throw d.applicationCache.clearLayerInfo(n),e}))),a}function g(e){if(null!==d.applicationCache){const t=d.applicationCache.getLayerInfo(e);if(null!==t)return t}let r=t(e,{responseType:\"json\",query:{f:\"json\"}}).then((e=>{if(e.data){const t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),h(t)}return h({layers:[],tables:[]})}));return null!==d.applicationCache&&(d.applicationCache.setLayerInfo(e,r),r=r.catch((t=>{throw d.applicationCache.clearLayerInfo(e),t}))),r}function k(e,t){const r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return g(e).then((n=>{if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(const e of n.layers)r.layerNameLkp[e.id]=e.name;if(n.tables)for(const e of n.tables)r.layerNameLkp[e.id]=e.name;const a=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=a,F(e,a).then((n=>{if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(const e of r.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources?e.edgeSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}for(const t of e.junctionSources?e.junctionSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}}if(r.queryelem.dataElement.terminalConfigurations)for(const e of r.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)r.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});return C(e+\"/\"+a).then((n=>{if(n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId){const a=[];return r.unVersion>=4&&(a.push(\"STATUS\"),a.push(\"PERCENTALONG\")),T(e+\"/\"+n.systemLayers.associationsTableId.toString(),t,[\"OBJECTID\",\"FROMNETWORKSOURCEID\",\"TONETWORKSOURCEID\",\"FROMGLOBALID\",\"TOGLOBALID\",\"TOTERMINALID\",\"FROMTERMINALID\",\"ASSOCIATIONTYPE\",\"ISCONTENTVISIBLE\",\"GLOBALID\",...a],!1,null,null).then((e=>e.load())).then((e=>r.unVersion>=4?(e=e.filter(y.create(\"STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)\",e.getFieldsIndex()))).load():e)).then((e=>({lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals})))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}function j(e,t,r,n=null,a=null,s=!0,i=null,l=null){let o=e.serviceUrl();return o?(o=\"/\"===o.charAt(o.length-1)?o+t.relatedTableId.toString():o+\"/\"+t.relatedTableId.toString(),T(o,n,a,s,i,l).then((o=>new c({layer:e,relatedLayer:o,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:s,lrucache:i,interceptor:l})))):null}n.registerAction(),a.registerAction(),s.registerAction(),i.registerAction(),l.registerAction();class O extends r{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overridespref=t,this.lrucache=r,this.interceptor=n,this._instantLayers=[]}makeAndAddFeatureSet(e,t=!0,r=null){const n=A(e,this._overridespref,null===r?[\"*\"]:r,t,this.lrucache,this.interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetByName(e,t,r)}catch(n){return f(n)}}));null===r&&(r=[\"*\"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let s=0;s<this._instantLayers.length;s++){const r=this._instantLayers[s];if(r.opitem.title===e&&r.includeGeometry===t&&r.outFields===n)return this.resolvePromise(this._instantLayers[s].featureset)}const a=this._map.layers.find((t=>t instanceof L&&t.title===e));if(a)return this.resolvePromise(this.makeAndAddFeatureSet(a,t,r));if(this._map.tables){const n=this._map.tables.find((t=>!!(t.title&&t.title===e||t.title&&t.title===e)));if(n){if(n instanceof L)return this.resolvePromise(this.makeAndAddFeatureSet(n,t,r));if(n._materializedTable);else{const e=n.outFields?n:{...n,outFields:[\"*\"]};n._materializedTable=new L(e)}return n._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(n._materializedTable,t,r))))}}return this.resolvePromise(null)}featureSetById(e,t=!0,r=[\"*\"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetById(e,t,r)}catch(n){return f(n)}}));null===r&&(r=[\"*\"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let s=0;s<this._instantLayers.length;s++){const r=this._instantLayers[s];if(r.opitem.id===e&&r.includeGeometry===t&&r.outFields===n)return this.resolvePromise(this._instantLayers[s].featureset)}const a=this._map.layers.find((t=>t instanceof L&&t.id===e));if(a)return this.resolvePromise(this.makeAndAddFeatureSet(a,t,r));if(this._map.tables){const n=this._map.tables.find((t=>t.id===e));if(n){if(n instanceof L)return this.resolvePromise(this.makeAndAddFeatureSet(n,t,r));if(n._materializedTable);else{const e={...n,outFields:[\"*\"]};n._materializedTable=new L(e)}return n._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(n._materializedTable,t,r))))}}return this.resolvePromise(null)}}class w extends r{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overridespref=t,this.lrucache=r,this.interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}makeAndAddFeatureSet(e,t=!0,r=null){const n=A(e,this._overridespref,null===r?[\"*\"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){return g(this._url).then((e=>(this.metadata=e,e)))}load(){return this._loadMetaData()}clone(){return new w(this._url,this._overridespref,this.lrucache,this.interceptor)}featureSetByName(e,t=!0,r=null){null===r&&(r=[\"*\"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let a=0;a<this._instantLayers.length;a++){const r=this._instantLayers[a];if(r.opitem.title===e&&r.includeGeometry===t&&r.outFields===n)return this.resolvePromise(this._instantLayers[a].featureset)}return this._loadMetaData().then((n=>{let a=null;for(const t of n.layers?n.layers:[])t.name===e&&(a=t);if(!a)for(const t of n.tables?n.tables:[])t.name===e&&(a=t);return a?N(this._url+\"/\"+a.id,[\"*\"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))}featureSetById(e,t=!0,r=[\"*\"]){null===r&&(r=[\"*\"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);e=null!=e?e.toString():\"\";for(let a=0;a<this._instantLayers.length;a++){const r=this._instantLayers[a];if(r.opitem.id===e&&r.includeGeometry===t&&r.outFields===n)return this.resolvePromise(this._instantLayers[a].featureset)}return this._loadMetaData().then((n=>{let a=null;for(const t of n.layers?n.layers:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(a=t);if(!a)for(const t of n.tables?n.tables:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(a=t);return a?N(this._url+\"/\"+a.id,[\"*\"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))}}function v(e,t,r=null,n=null){return new O(e,t,r,n)}function E(e,t,r=null,n=null){return new w(e,t,r,n)}function b(e,t){if(null===e)return t;return new I({url:e.field(\"url\")})}function D(r,n,a){return e.findCredential(r.restUrl)?\"loaded\"===r.loadStatus&&\"\"===n&&r.user&&r.user.sourceJSON&&!1===a?h(r.user.sourceJSON):\"\"===n?t(r.restUrl+\"/community/self\",{responseType:\"json\",query:{f:\"json\",...!1===a?{}:{returnUserLicenseTypeExtensions:!0}}}).then((e=>{if(e.data){const t=e.data;if(t&&t.username)return h(t)}return h(null)})):t(r.restUrl+\"/community/users/\"+n,{responseType:\"json\",query:{f:\"json\"}}).then((e=>{if(e.data){const t=e.data;return t.error?null:h(t)}return h(null)})):h(null)}function q(e,t,r,n,a,s,i,l=null){if(d.applicationCache){const o=d.applicationCache.getLayerInfo(e+\":\"+s.url);if(o)return o.then((e=>{try{const s=new L({url:m(e.url)+\"/\"+t,outFields:[\"*\"]});return h(A(s,r,n,a,i,l))}catch(s){return f(s)}}),(e=>f(e)))}return p(((o,u)=>{const c=new _({id:e,portal:s}).load();d.applicationCache&&d.applicationCache.setLayerInfo(e+\":\"+s.url,c),c.then((e=>{try{const s=new L({url:m(e.url)+\"/\"+t,outFields:[\"*\"]});o(A(s,r,n,a,i,l))}catch(s){u(s)}}),(t=>{d.applicationCache&&d.applicationCache.clearLayerInfo(e+\":\"+s.url),u(t)}))}))}export{k as constructAssociationMetaDataFeatureSetFromUrl,A as constructFeatureSet,q as constructFeatureSetFromPortalItem,j as constructFeatureSetFromRelationship,T as constructFeatureSetFromUrl,v as createFeatureSetCollectionFromMap,E as createFeatureSetCollectionFromService,b as getPortal,S as initialiseMetaDataCache,D as lookupUser};\n"]},"metadata":{},"sourceType":"module"}