{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as n, isSome as r } from \"../../../core/maybe.js\";\nimport { getMetersPerUnit as t, getMetersPerVerticalUnitForSR as o, convertUnit as e } from \"../../../core/unitUtils.js\";\nimport { c as a } from \"../../../chunks/mat3f64.js\";\nimport { a as i, s as l } from \"../../../chunks/mat4.js\";\nimport { c as s } from \"../../../chunks/mat4f64.js\";\nimport { a as f } from \"../../../chunks/mat3.js\";\nimport { computeLinearTransformation as c } from \"../../projection.js\";\nimport { getSphericalPCPF as u } from \"../../projectionEllipsoid.js\";\nimport p from \"../MeshTransform.js\";\nimport { BufferViewVec3f64 as m, BufferViewVec3f as g } from \"../buffer/BufferView.js\";\nimport { t as y, a as h } from \"../../../chunks/vec32.js\";\nimport { isGeographicMesh as A } from \"./geographicUtils.js\";\nimport { transformPosition as T, transformNormal as j, transformTangent as E, projectFromPCPF as F, projectNormalFromPCPF as R, projectTangentFromPCPF as w, projectToPCPF as d, projectNormalToPCPF as v, projectTangentToPCPF as z } from \"./projection.js\";\n\nfunction x(n, r, t) {\n  return A(r.spatialReference, t) ? B(n, r, t) : b(n, r, t);\n}\n\nfunction _(t, o, e) {\n  const {\n    position: a,\n    normal: i,\n    tangent: l\n  } = t;\n  if (n(o)) return {\n    position: a,\n    normal: i,\n    tangent: l\n  };\n  const s = o.localMatrix;\n  return x({\n    position: T(a, new Float64Array(a.length), s),\n    normal: r(i) ? j(i, new Float32Array(i.length), s) : null,\n    tangent: r(l) ? E(l, new Float32Array(l.length), s) : null\n  }, o.getOriginPoint(e), {\n    geographic: o.geographic\n  });\n}\n\nfunction k(n, r, t) {\n  if (null != t && t.useTransform) {\n    var o;\n    const {\n      position: e,\n      normal: a,\n      tangent: i\n    } = n;\n    return {\n      vertexAttributes: {\n        position: e,\n        normal: a,\n        tangent: i\n      },\n      transform: new p({\n        origin: [r.x, r.y, null != (o = r.z) ? o : 0],\n        geographic: A(r.spatialReference, t)\n      })\n    };\n  }\n\n  return {\n    vertexAttributes: x(n, r, t),\n    transform: null\n  };\n}\n\nfunction M(n, r, t) {\n  return A(r.spatialReference, t) ? G(n, r, t) : Y(n, r, t);\n}\n\nfunction P(r, t, o, e) {\n  if (n(t)) return M(r, o, e);\n\n  const a = _(r, t, o.spatialReference);\n\n  return o.equals(t.getOriginPoint(o.spatialReference)) ? Y(a, o, e) : A(o.spatialReference, e) ? G(a, o, e) : Y(a, o, e);\n}\n\nfunction b(n, r, t) {\n  const o = new Float64Array(n.position.length),\n        e = n.position,\n        a = r.x,\n        i = r.y,\n        l = r.z || 0,\n        {\n    horizontal: s,\n    vertical: f\n  } = C(t ? t.unit : null, r.spatialReference);\n\n  for (let c = 0; c < e.length; c += 3) o[c + 0] = e[c + 0] * s + a, o[c + 1] = e[c + 1] * s + i, o[c + 2] = e[c + 2] * f + l;\n\n  return {\n    position: o,\n    normal: n.normal,\n    tangent: n.tangent\n  };\n}\n\nfunction B(n, r, t) {\n  const o = r.spatialReference,\n        e = O(r, t, D),\n        a = new Float64Array(n.position.length),\n        i = L(n.position, e, o, a),\n        l = f(I, e);\n  return {\n    position: i,\n    normal: N(i, a, n.normal, l, o),\n    tangent: S(i, a, n.tangent, l, o)\n  };\n}\n\nfunction L(n, r, t, o) {\n  y(m.fromTypedArray(o), m.fromTypedArray(n), r);\n  const e = new Float64Array(n.length);\n  return F(o, e, t);\n}\n\nfunction N(r, t, o, e, a) {\n  if (n(o)) return null;\n  const i = new Float32Array(o.length);\n  return h(g.fromTypedArray(i), g.fromTypedArray(o), e), R(i, r, t, a, i), i;\n}\n\nfunction S(r, t, o, e, a) {\n  if (n(o)) return null;\n  const i = new Float32Array(o.length);\n  h(g.fromTypedArray(i, 4 * Float32Array.BYTES_PER_ELEMENT), g.fromTypedArray(o, 4 * Float32Array.BYTES_PER_ELEMENT), e);\n\n  for (let n = 3; n < i.length; n += 4) i[n] = o[n];\n\n  return w(i, r, t, a, i), i;\n}\n\nfunction Y(n, r, t) {\n  const o = new Float64Array(n.position.length),\n        e = n.position,\n        a = r.x,\n        i = r.y,\n        l = r.z || 0,\n        {\n    horizontal: s,\n    vertical: f\n  } = C(t ? t.unit : null, r.spatialReference);\n\n  for (let c = 0; c < e.length; c += 3) o[c + 0] = (e[c + 0] - a) / s, o[c + 1] = (e[c + 1] - i) / s, o[c + 2] = (e[c + 2] - l) / f;\n\n  return {\n    position: o,\n    normal: n.normal,\n    tangent: n.tangent\n  };\n}\n\nfunction G(n, r, t) {\n  const o = r.spatialReference;\n  O(r, t, D);\n  const e = i(H, D),\n        a = new Float64Array(n.position.length),\n        l = U(n.position, o, e, a),\n        s = f(I, e);\n  return {\n    position: l,\n    normal: q(n.normal, n.position, a, o, s),\n    tangent: V(n.tangent, n.position, a, o, s)\n  };\n}\n\nfunction O(n, r, t) {\n  c(n.spatialReference, [n.x, n.y, n.z || 0], t, u(n.spatialReference));\n  const {\n    horizontal: o,\n    vertical: e\n  } = C(r ? r.unit : null, n.spatialReference);\n  return l(t, t, [o, o, e]), t;\n}\n\nfunction U(n, r, t, o) {\n  const e = d(n, r, o),\n        a = m.fromTypedArray(e),\n        i = new Float64Array(e.length),\n        l = m.fromTypedArray(i);\n  return y(l, a, t), i;\n}\n\nfunction q(r, t, o, e, a) {\n  if (n(r)) return null;\n  const i = v(r, t, o, e, new Float32Array(r.length)),\n        l = g.fromTypedArray(i);\n  return h(l, l, a), i;\n}\n\nfunction V(r, t, o, e, a) {\n  if (n(r)) return null;\n  const i = z(r, t, o, e, new Float32Array(r.length)),\n        l = g.fromTypedArray(i, 4 * Float32Array.BYTES_PER_ELEMENT);\n  return h(l, l, a), i;\n}\n\nfunction C(r, a) {\n  if (n(r)) return J;\n  const i = a.isGeographic ? 1 : t(a),\n        l = a.isGeographic ? 1 : o(a),\n        s = e(1, r, \"meters\");\n  return {\n    horizontal: s * i,\n    vertical: s * l\n  };\n}\n\nconst D = s(),\n      H = s(),\n      I = a(),\n      J = {\n  horizontal: 1,\n  vertical: 1\n};\nexport { x as georeference, _ as georeferenceApplyTransform, k as georeferenceByTransform, M as ungeoreference, P as ungeoreferenceByTransform };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/geometry/support/meshUtils/georeference.js"],"names":["isNone","n","isSome","r","getMetersPerUnit","t","getMetersPerVerticalUnitForSR","o","convertUnit","e","c","a","i","s","l","f","computeLinearTransformation","getSphericalPCPF","u","p","BufferViewVec3f64","m","BufferViewVec3f","g","y","h","isGeographicMesh","A","transformPosition","T","transformNormal","j","transformTangent","E","projectFromPCPF","F","projectNormalFromPCPF","R","projectTangentFromPCPF","w","projectToPCPF","d","projectNormalToPCPF","v","projectTangentToPCPF","z","x","spatialReference","B","b","_","position","normal","tangent","localMatrix","Float64Array","length","Float32Array","getOriginPoint","geographic","k","useTransform","vertexAttributes","transform","origin","M","G","Y","P","equals","horizontal","vertical","C","unit","O","D","L","I","N","S","fromTypedArray","BYTES_PER_ELEMENT","H","U","q","V","J","isGeographic","georeference","georeferenceApplyTransform","georeferenceByTransform","ungeoreference","ungeoreferenceByTransform"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as n,isSome as r}from\"../../../core/maybe.js\";import{getMetersPerUnit as t,getMetersPerVerticalUnitForSR as o,convertUnit as e}from\"../../../core/unitUtils.js\";import{c as a}from\"../../../chunks/mat3f64.js\";import{a as i,s as l}from\"../../../chunks/mat4.js\";import{c as s}from\"../../../chunks/mat4f64.js\";import{a as f}from\"../../../chunks/mat3.js\";import{computeLinearTransformation as c}from\"../../projection.js\";import{getSphericalPCPF as u}from\"../../projectionEllipsoid.js\";import p from\"../MeshTransform.js\";import{BufferViewVec3f64 as m,BufferViewVec3f as g}from\"../buffer/BufferView.js\";import{t as y,a as h}from\"../../../chunks/vec32.js\";import{isGeographicMesh as A}from\"./geographicUtils.js\";import{transformPosition as T,transformNormal as j,transformTangent as E,projectFromPCPF as F,projectNormalFromPCPF as R,projectTangentFromPCPF as w,projectToPCPF as d,projectNormalToPCPF as v,projectTangentToPCPF as z}from\"./projection.js\";function x(n,r,t){return A(r.spatialReference,t)?B(n,r,t):b(n,r,t)}function _(t,o,e){const{position:a,normal:i,tangent:l}=t;if(n(o))return{position:a,normal:i,tangent:l};const s=o.localMatrix;return x({position:T(a,new Float64Array(a.length),s),normal:r(i)?j(i,new Float32Array(i.length),s):null,tangent:r(l)?E(l,new Float32Array(l.length),s):null},o.getOriginPoint(e),{geographic:o.geographic})}function k(n,r,t){if(null!=t&&t.useTransform){var o;const{position:e,normal:a,tangent:i}=n;return{vertexAttributes:{position:e,normal:a,tangent:i},transform:new p({origin:[r.x,r.y,null!=(o=r.z)?o:0],geographic:A(r.spatialReference,t)})}}return{vertexAttributes:x(n,r,t),transform:null}}function M(n,r,t){return A(r.spatialReference,t)?G(n,r,t):Y(n,r,t)}function P(r,t,o,e){if(n(t))return M(r,o,e);const a=_(r,t,o.spatialReference);return o.equals(t.getOriginPoint(o.spatialReference))?Y(a,o,e):A(o.spatialReference,e)?G(a,o,e):Y(a,o,e)}function b(n,r,t){const o=new Float64Array(n.position.length),e=n.position,a=r.x,i=r.y,l=r.z||0,{horizontal:s,vertical:f}=C(t?t.unit:null,r.spatialReference);for(let c=0;c<e.length;c+=3)o[c+0]=e[c+0]*s+a,o[c+1]=e[c+1]*s+i,o[c+2]=e[c+2]*f+l;return{position:o,normal:n.normal,tangent:n.tangent}}function B(n,r,t){const o=r.spatialReference,e=O(r,t,D),a=new Float64Array(n.position.length),i=L(n.position,e,o,a),l=f(I,e);return{position:i,normal:N(i,a,n.normal,l,o),tangent:S(i,a,n.tangent,l,o)}}function L(n,r,t,o){y(m.fromTypedArray(o),m.fromTypedArray(n),r);const e=new Float64Array(n.length);return F(o,e,t)}function N(r,t,o,e,a){if(n(o))return null;const i=new Float32Array(o.length);return h(g.fromTypedArray(i),g.fromTypedArray(o),e),R(i,r,t,a,i),i}function S(r,t,o,e,a){if(n(o))return null;const i=new Float32Array(o.length);h(g.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT),g.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),e);for(let n=3;n<i.length;n+=4)i[n]=o[n];return w(i,r,t,a,i),i}function Y(n,r,t){const o=new Float64Array(n.position.length),e=n.position,a=r.x,i=r.y,l=r.z||0,{horizontal:s,vertical:f}=C(t?t.unit:null,r.spatialReference);for(let c=0;c<e.length;c+=3)o[c+0]=(e[c+0]-a)/s,o[c+1]=(e[c+1]-i)/s,o[c+2]=(e[c+2]-l)/f;return{position:o,normal:n.normal,tangent:n.tangent}}function G(n,r,t){const o=r.spatialReference;O(r,t,D);const e=i(H,D),a=new Float64Array(n.position.length),l=U(n.position,o,e,a),s=f(I,e);return{position:l,normal:q(n.normal,n.position,a,o,s),tangent:V(n.tangent,n.position,a,o,s)}}function O(n,r,t){c(n.spatialReference,[n.x,n.y,n.z||0],t,u(n.spatialReference));const{horizontal:o,vertical:e}=C(r?r.unit:null,n.spatialReference);return l(t,t,[o,o,e]),t}function U(n,r,t,o){const e=d(n,r,o),a=m.fromTypedArray(e),i=new Float64Array(e.length),l=m.fromTypedArray(i);return y(l,a,t),i}function q(r,t,o,e,a){if(n(r))return null;const i=v(r,t,o,e,new Float32Array(r.length)),l=g.fromTypedArray(i);return h(l,l,a),i}function V(r,t,o,e,a){if(n(r))return null;const i=z(r,t,o,e,new Float32Array(r.length)),l=g.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT);return h(l,l,a),i}function C(r,a){if(n(r))return J;const i=a.isGeographic?1:t(a),l=a.isGeographic?1:o(a),s=e(1,r,\"meters\");return{horizontal:s*i,vertical:s*l}}const D=s(),H=s(),I=a(),J={horizontal:1,vertical:1};export{x as georeference,_ as georeferenceApplyTransform,k as georeferenceByTransform,M as ungeoreference,P as ungeoreferenceByTransform};\n"]},"metadata":{},"sourceType":"module"}