{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { removeUnordered as e } from \"../../../core/arrayUtils.js\";\nimport t from \"../../../core/Handles.js\";\nimport { getReferenceEllipsoid as s } from \"../../../geometry/projectionEllipsoid.js\";\nimport { TextureCollection as i } from \"./TextureCollection.js\";\nimport { getSettings as r, getLabelSettings as n } from \"../webgl-engine/lib/screenSizePerspectiveUtils.js\";\n\nclass c {\n  constructor(e) {\n    this.textures = null, this.streamDataRequester = null, this.graphicsOwners = [], this.screenSizePerspectiveHandles = null, this.cimSymbolRasterizer = null, this.viewState = e.viewState, this.view = e.view, this.pointsOfInterest = e.pointsOfInterest, this.objectResourceCache = e.objectResourceCache, this.streamDataRequester = e.resourceController.createStreamDataRequester(4), this.textures = new i(this.streamDataRequester, e.view._stage, {\n      preMultiplyAlpha: !0,\n      wrap: {\n        s: 33071,\n        t: 33071\n      }\n    }, e.resourceController.scheduler);\n    const t = s(this.view.spatialReference).radius;\n    this.screenSizePerspectiveSettings = r(e.viewingMode, t), this.screenSizePerspectiveSettingsLabels = n(e.viewingMode, t);\n  }\n\n  destroy() {\n    this.textures.destroy(), this.textures = null, this.streamDataRequester = null;\n  }\n\n  addGraphicsOwner(t) {\n    if (!t) return {\n      remove() {}\n\n    };\n    this.graphicsOwners.push(t);\n    const s = \"layer\" in t ? t.watch(\"layer.screenSizePerspectiveEnabled\", () => this.updateScreenSizePerspectiveEnabled()) : null;\n    return this.updateScreenSizePerspectiveEnabled(), {\n      remove: () => {\n        s && (s.remove(), e(this.graphicsOwners, t), this.updateScreenSizePerspectiveEnabled());\n      }\n    };\n  }\n\n  updateScreenSizePerspectiveEnabled() {\n    const e = this.graphicsOwners.some(e => !0 === e.get(\"layer.screenSizePerspectiveEnabled\"));\n\n    if (e && !this.screenSizePerspectiveHandles) {\n      this.screenSizePerspectiveHandles = new t();\n\n      const e = () => this.updateScreenSizePerspectiveSettings();\n\n      this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch(\"distance\", e, !0), this.viewState.events.on(\"camera-projection-changed\", e)]), this.updateScreenSizePerspectiveSettings();\n    } else !e && this.screenSizePerspectiveHandles && (this.screenSizePerspectiveHandles.destroy(), this.screenSizePerspectiveHandles = null);\n  }\n\n  updateScreenSizePerspectiveSettings() {\n    const e = this.pointsOfInterest;\n    a.distance = e.centerOnSurfaceInfrequent.distance, a.fovY = this.viewState.camera.fovY, this.screenSizePerspectiveSettings.update(a), this.screenSizePerspectiveSettingsLabels.update(a), this.view._stage.renderView.setNeedsRender();\n  }\n\n}\n\nconst a = {\n  distance: 0,\n  fovY: 0\n};\nexport default c;\nexport { c as SharedSymbolResources };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/support/SharedSymbolResources.js"],"names":["removeUnordered","e","t","getReferenceEllipsoid","s","TextureCollection","i","getSettings","r","getLabelSettings","n","c","constructor","textures","streamDataRequester","graphicsOwners","screenSizePerspectiveHandles","cimSymbolRasterizer","viewState","view","pointsOfInterest","objectResourceCache","resourceController","createStreamDataRequester","_stage","preMultiplyAlpha","wrap","scheduler","spatialReference","radius","screenSizePerspectiveSettings","viewingMode","screenSizePerspectiveSettingsLabels","destroy","addGraphicsOwner","remove","push","watch","updateScreenSizePerspectiveEnabled","some","get","updateScreenSizePerspectiveSettings","add","centerOnSurfaceInfrequent","events","on","a","distance","fovY","camera","update","renderView","setNeedsRender","SharedSymbolResources"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{removeUnordered as e}from\"../../../core/arrayUtils.js\";import t from\"../../../core/Handles.js\";import{getReferenceEllipsoid as s}from\"../../../geometry/projectionEllipsoid.js\";import{TextureCollection as i}from\"./TextureCollection.js\";import{getSettings as r,getLabelSettings as n}from\"../webgl-engine/lib/screenSizePerspectiveUtils.js\";class c{constructor(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.view=e.view,this.pointsOfInterest=e.pointsOfInterest,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=e.resourceController.createStreamDataRequester(4),this.textures=new i(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},e.resourceController.scheduler);const t=s(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=r(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=n(e.viewingMode,t)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return{remove(){}};this.graphicsOwners.push(t);const s=\"layer\"in t?t.watch(\"layer.screenSizePerspectiveEnabled\",(()=>this.updateScreenSizePerspectiveEnabled())):null;return this.updateScreenSizePerspectiveEnabled(),{remove:()=>{s&&(s.remove(),e(this.graphicsOwners,t),this.updateScreenSizePerspectiveEnabled())}}}updateScreenSizePerspectiveEnabled(){const e=this.graphicsOwners.some((e=>!0===e.get(\"layer.screenSizePerspectiveEnabled\")));if(e&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new t;const e=()=>this.updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch(\"distance\",e,!0),this.viewState.events.on(\"camera-projection-changed\",e)]),this.updateScreenSizePerspectiveSettings()}else!e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}updateScreenSizePerspectiveSettings(){const e=this.pointsOfInterest;a.distance=e.centerOnSurfaceInfrequent.distance,a.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(a),this.screenSizePerspectiveSettingsLabels.update(a),this.view._stage.renderView.setNeedsRender()}}const a={distance:0,fovY:0};export default c;export{c as SharedSymbolResources};\n"]},"metadata":{},"sourceType":"module"}