{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../../geometry.js\";\nimport { remove as e } from \"../../../../core/arrayUtils.js\";\nimport { isSome as t } from \"../../../../core/maybe.js\";\nimport { onAbort as r, createAbortError as s, createAbortController as i } from \"../../../../core/promiseUtils.js\";\nimport { TaskPriority as o } from \"../../../support/Scheduler.js\";\nimport n from \"../../../../geometry/Multipoint.js\";\n\nclass a {\n  constructor(e, t) {\n    this.spatialReference = e, this.view = t;\n  }\n\n  getElevation(e, t, r) {\n    return this.view.elevationProvider.getElevation(e, t, 0, this.spatialReference, r);\n  }\n\n  async queryElevation(e, t, r, s, i) {\n    return this.view.elevationProvider.queryElevation(e, t, 0, this.spatialReference, i, r, s);\n  }\n\n}\n\nclass l {\n  constructor(e, t, r, s) {\n    this.spatialReference = t, this._getElevationQueryProvider = r, this._queries = new Array(), this._queryOptions = { ...s,\n      ignoreInvisibleLayers: !0\n    }, this._frameTask = e.registerTask(o.ELEVATION_QUERY, this);\n  }\n\n  destroy() {\n    this._frameTask.remove();\n  }\n\n  queryElevation(t, i, o, n = 0) {\n    return new Promise((a, l) => {\n      const u = {\n        x: t,\n        y: i,\n        minDemResolution: n,\n        result: {\n          resolve: a,\n          reject: l\n        },\n        signal: o\n      };\n      this._queries.push(u), r(o, () => {\n        e(this._queries, u), l(s());\n      });\n    });\n  }\n\n  get running() {\n    return this._queries.length > 0;\n  }\n\n  runTask() {\n    const e = this._queries;\n    this._queries = [];\n\n    const o = this._getElevationQueryProvider();\n\n    if (!o) return void e.forEach(e => e.result.reject());\n    const a = e.map(e => [e.x, e.y]),\n          l = e.reduce((e, t) => Math.min(e, t.minDemResolution), 1 / 0),\n          u = new n({\n      points: a,\n      spatialReference: this.spatialReference\n    }),\n          c = e.length > 1 && e.some(e => !!e.signal) ? i() : null,\n          h = t(c) ? c.signal : e[0].signal;\n\n    if (t(c)) {\n      let t = 0;\n      e.forEach(i => r(i.signal, () => {\n        t++, i.result.reject(s()), t === e.length && c.abort();\n      }));\n    }\n\n    const m = { ...this._queryOptions,\n      minDemResolution: l,\n      signal: h\n    };\n    o.queryElevation(u, m).then(r => {\n      e.forEach((e, i) => {\n        t(e.signal) && e.signal.aborted ? e.result.reject(s()) : e.result.resolve(r.geometry.points[i][2]);\n      });\n    }).catch(t => {\n      e.forEach(e => e.result.reject(t));\n    });\n  }\n\n  get test() {\n    const e = this;\n    return {\n      update: () => e._queries.length > 0 && e.runTask()\n    };\n  }\n\n}\n\nexport { l as ElevationQuery, a as ViewElevationProvider };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/ElevationQuery.js"],"names":["remove","e","isSome","t","onAbort","r","createAbortError","s","createAbortController","i","TaskPriority","o","n","a","constructor","spatialReference","view","getElevation","elevationProvider","queryElevation","l","_getElevationQueryProvider","_queries","Array","_queryOptions","ignoreInvisibleLayers","_frameTask","registerTask","ELEVATION_QUERY","destroy","Promise","u","x","y","minDemResolution","result","resolve","reject","signal","push","running","length","runTask","forEach","map","reduce","Math","min","points","c","some","h","abort","m","then","aborted","geometry","catch","test","update","ElevationQuery","ViewElevationProvider"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../../geometry.js\";import{remove as e}from\"../../../../core/arrayUtils.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{onAbort as r,createAbortError as s,createAbortController as i}from\"../../../../core/promiseUtils.js\";import{TaskPriority as o}from\"../../../support/Scheduler.js\";import n from\"../../../../geometry/Multipoint.js\";class a{constructor(e,t){this.spatialReference=e,this.view=t}getElevation(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,s,i){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,i,r,s)}}class l{constructor(e,t,r,s){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(o.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,o,n=0){return new Promise(((a,l)=>{const u={x:t,y:i,minDemResolution:n,result:{resolve:a,reject:l},signal:o};this._queries.push(u),r(o,(()=>{e(this._queries,u),l(s())}))}))}get running(){return this._queries.length>0}runTask(){const e=this._queries;this._queries=[];const o=this._getElevationQueryProvider();if(!o)return void e.forEach((e=>e.result.reject()));const a=e.map((e=>[e.x,e.y])),l=e.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),u=new n({points:a,spatialReference:this.spatialReference}),c=e.length>1&&e.some((e=>!!e.signal))?i():null,h=t(c)?c.signal:e[0].signal;if(t(c)){let t=0;e.forEach((i=>r(i.signal,(()=>{t++,i.result.reject(s()),t===e.length&&c.abort()}))))}const m={...this._queryOptions,minDemResolution:l,signal:h};o.queryElevation(u,m).then((r=>{e.forEach(((e,i)=>{t(e.signal)&&e.signal.aborted?e.result.reject(s()):e.result.resolve(r.geometry.points[i][2])}))})).catch((t=>{e.forEach((e=>e.result.reject(t)))}))}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask()}}}export{l as ElevationQuery,a as ViewElevationProvider};\n"]},"metadata":{},"sourceType":"module"}