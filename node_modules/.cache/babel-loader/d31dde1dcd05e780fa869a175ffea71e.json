{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport \"../../../../geometry.js\";\nimport t from \"../../../../core/Error.js\";\nimport { get as i, isNone as r, isSome as a } from \"../../../../core/maybe.js\";\nimport { px2pt as s, pt2px as n } from \"../../../../core/screenUtils.js\";\nimport { I as o } from \"../../../../chunks/mat4f64.js\";\nimport { s as l } from \"../../../../chunks/vec4.js\";\nimport { f as p } from \"../../../../chunks/vec4f64.js\";\nimport { create as h, empty as c, expandWithBuffer as m, intersectsClippingArea as d, expandWithAABB as y } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { getDriverAxisSizeValueAny as u } from \"../../../../renderers/support/renderingInfoUtils.js\";\nimport { perVertexElevationAligner as g } from \"./ElevationAligners.js\";\nimport { elevationModeChangeUpdateType as f, SymbolUpdateType as _, needsElevationUpdates2D as b } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as v } from \"./ElevationContext.js\";\nimport M from \"./Graphics3DDrapedGraphicLayer.js\";\nimport { Graphics3DObject3DGraphicLayer as P } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as x, getAttributeValue as U } from \"./Graphics3DSymbolLayer.js\";\nimport { geometryToRenderInfo as C, createGeometry as E, geometryToRenderInfoDraped as D } from \"./lineUtils.js\";\nimport { initFastSymbolUpdatesState as j, updateFastSymbolUpdatesState as z } from \"../support/FastSymbolUpdates.js\";\nimport { Object3D as L } from \"../../webgl-engine/lib/Object3D.js\";\nimport { RenderGeometry as A } from \"../../webgl-engine/lib/RenderGeometry.js\";\nimport { createStipplePattern as O } from \"../../webgl-engine/materials/lineStippleUtils.js\";\nimport { RibbonLineMaterial as S } from \"../../webgl-engine/materials/RibbonLineMaterial.js\";\nimport w from \"../../../../geometry/Extent.js\";\nimport G from \"../../../../geometry/Polygon.js\";\nconst V = [\"polyline\", \"polygon\", \"extent\"];\n\nclass R extends x {\n  constructor(e, t, i, r) {\n    super(e, t, i, r), this._uniformSize = 1;\n  }\n\n  async doLoad() {\n    if (this._vvConvertOptions = {\n      modelSize: [1, 1, 1],\n      symbolSize: [1, 1, 1],\n      unitInMeters: 1,\n      transformation: {\n        anchor: [0, 0, 0],\n        scale: [1, 1, 1],\n        rotation: [0, 0, 0]\n      },\n      supportedTypes: {\n        size: !0,\n        color: !0,\n        opacity: !0,\n        rotation: !1\n      }\n    }, this._context.renderer && this._context.renderer.visualVariables && this._context.renderer.visualVariables.length > 0 ? this._fastUpdates = j(this._context.renderer, this._vvConvertOptions) : this._fastUpdates = {\n      enabled: !1\n    }, !this._drivenProperties.size) {\n      const e = null != this.symbolLayer.size ? this.symbolLayer.size : s(1);\n      if (e < 0) throw new t(\"graphics3dlinesymbollayer:invalid-size\", \"Symbol sizes may not be negative values\");\n      this._uniformSize = e;\n    }\n  }\n\n  getMaterialParameters(t) {\n    const r = i(this.symbolLayer, \"material\", \"color\"),\n          a = this._getCombinedOpacityAndColor(r),\n          o = a[3],\n          l = {\n      width: 1,\n      color: a,\n      polygonOffset: !0,\n      join: this.symbolLayer.join || \"miter\",\n      cap: this.symbolLayer.cap || \"butt\",\n      transparent: o < 1 || this.needsDrivenTransparentPass,\n      slicePlaneEnabled: this._context.slicePlaneEnabled,\n      isClosed: t,\n      stipplePattern: this.symbolLayer.stipplePattern ? O(this.symbolLayer.stipplePattern.map(n)) : null,\n      stippleOffColor: this.symbolLayer.stippleOffColor ? e.toUnitRGBA(this.symbolLayer.stippleOffColor) : null,\n      stippleIntegerRepeats: !0\n    };\n\n    if (this._drivenProperties.size) this._fastUpdates.enabled && this._fastUpdates.visualVariables.size && (l.width = n(1));else {\n      const e = null != this.symbolLayer.size ? this.symbolLayer.size : s(1);\n      l.width = n(e);\n    }\n    return this._fastUpdates && this._fastUpdates.visualVariables ? { ...l,\n      ...this._fastUpdates.materialParameters\n    } : l;\n  }\n\n  get lineMaterial() {\n    return r(this._lineMaterial) && (this._lineMaterial = new S(this.getMaterialParameters(!1)), this._context.stage.add(this._lineMaterial)), this._lineMaterial;\n  }\n\n  get ringMaterial() {\n    return r(this._ringMaterial) && (this._ringMaterial = new S(this.getMaterialParameters(!0)), this._context.stage.add(this._ringMaterial)), this._ringMaterial;\n  }\n\n  destroy() {\n    super.destroy(), this._context.stage.remove(this._lineMaterial), this._lineMaterial = null, this._context.stage.remove(this._ringMaterial), this._ringMaterial = null;\n  }\n\n  getDrivenSize(e) {\n    return this._drivenProperties.size && e.size ? n(u(e.size)) : 1;\n  }\n\n  getSizeFeatureAttributeData(e) {\n    return this._fastUpdates.enabled && this._fastUpdates.visualVariables.size ? U(this._fastUpdates.visualVariables.size.field, e) : null;\n  }\n\n  getDrivenColor(e) {\n    const t = p(1, 1, 1, 1);\n    return this._drivenProperties.color && e.color && (t[0] = e.color[0], t[1] = e.color[1], t[2] = e.color[2], e.color.length > 0 && (t[3] = e.color[3])), this._drivenProperties.opacity && e.opacity && (t[3] = e.opacity), t;\n  }\n\n  getColorFeatureAttributeData(e) {\n    return this._fastUpdates.enabled && this._fastUpdates.visualVariables.color ? U(this._fastUpdates.visualVariables.color.field, e) : null;\n  }\n\n  getOpacityFeatureAttributeData(e) {\n    return this._fastUpdates.enabled && this._fastUpdates.visualVariables.opacity ? U(this._fastUpdates.visualVariables.opacity.field, e) : null;\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry, V, this.symbolLayer.type)) return null;\n    const i = this.setGraphicElevationContext(t, new v());\n    return this.ensureDrapedStatus(\"on-the-ground\" === i.mode), this.draped ? this._createAsOverlay(e, this._context.layer.uid) : this._createAs3DShape(e, i, t.uid);\n  }\n\n  applyRendererDiff(e, t) {\n    for (const i in e.diff) switch (i) {\n      case \"visualVariables\":\n        if (!z(this._fastUpdates, t, this._vvConvertOptions)) return !1;\n        a(this._lineMaterial) && this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters), a(this._ringMaterial) && this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);\n        break;\n\n      default:\n        return !1;\n    }\n\n    return !0;\n  }\n\n  layerOpacityChanged() {\n    return a(this._lineMaterial) && this.updateMaterialLayerOpacity(this._lineMaterial), a(this._ringMaterial) && this.updateMaterialLayerOpacity(this._ringMaterial), !0;\n  }\n\n  updateMaterialLayerOpacity(e) {\n    const t = e.params.color,\n          r = i(this.symbolLayer, \"material\", \"color\"),\n          a = this._getCombinedOpacity(r),\n          s = a < 1 || this.needsDrivenTransparentPass,\n          n = [t[0], t[1], t[2], a];\n\n    e.setParameterValues({\n      color: n,\n      transparent: s\n    });\n  }\n\n  layerElevationInfoChanged(e, t, i) {\n    const r = this._elevationContext.mode,\n          a = f(R.elevationModeChangeTypes, i, r);\n    if (a !== _.UPDATE) return a;\n    const s = b(r);\n    return this.updateGraphics3DGraphicElevationInfo(e, t, () => s);\n  }\n\n  slicePlaneEnabledChanged() {\n    return a(this._lineMaterial) && this._lineMaterial.setParameterValues({\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    }), a(this._ringMaterial) && this._ringMaterial.setParameterValues({\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    }), !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    return !0;\n  }\n\n  pixelRatioChanged() {\n    return !0;\n  }\n\n  _getGeometryAsPolygonOrPolyline(e) {\n    switch (e.type) {\n      case \"extent\":\n        if (e instanceof w) return G.fromExtent(e);\n        break;\n\n      case \"polygon\":\n      case \"polyline\":\n        return e;\n    }\n\n    return null;\n  }\n\n  _createAs3DShape(e, t, i) {\n    const r = e.graphic,\n          s = this._getGeometryAsPolygonOrPolyline(r.geometry),\n          n = \"polygon\" === s.type ? s.rings : s.paths,\n          l = new Array(),\n          p = new Array(),\n          y = new Array(),\n          u = h(),\n          f = C(s, this._context.elevationProvider, this._context.renderCoordsHelper, t),\n          _ = \"polygon\" === s.type ? \"rings\" : \"paths\";\n\n    this._logGeometryCreationWarnings(f, n, _, \"LineSymbol3DLayer\");\n\n    for (let h = 0; h < f.lines.length; h++) {\n      const {\n        position: t,\n        mapPosition: i\n      } = f.lines[h];\n      if (a(this._context.clippingExtent) && (c(u), m(u, i), !d(u, this._context.clippingExtent))) continue;\n\n      const r = this._createGeometry(e, t, i, s.type);\n\n      l.push(r), p.push(\"polygon\" === s.type ? this.ringMaterial : this.lineMaterial), y.push(o);\n    }\n\n    if (0 === l.length) return null;\n    const v = new L({\n      geometries: l,\n      materials: p,\n      transformations: y,\n      castShadow: !1,\n      metadata: {\n        layerUid: this._context.layer.uid,\n        graphicUid: i\n      }\n    }),\n          M = new P(this, v, l, null, null, g, t);\n    return M.alignedSampledElevation = f.sampledElevation, M.needsElevationUpdates = b(t.mode), M;\n  }\n\n  _createGeometry(e, t, i, r) {\n    const a = \"polygon\" === r ? 1 : 0,\n          s = this._fastUpdates.enabled && this._fastUpdates.visualVariables.color,\n          n = this._fastUpdates.enabled && this._fastUpdates.visualVariables.size;\n    return E({\n      removeDuplicateStartEnd: a,\n      uniformSize: this._uniformSize,\n      attributeData: {\n        position: t,\n        mapPosition: i,\n        size: n ? null : this.getDrivenSize(e.renderingInfo),\n        color: s ? null : this.getDrivenColor(e.renderingInfo),\n        sizeFeature: this.getSizeFeatureAttributeData(e.graphic),\n        colorFeature: this.getColorFeatureAttributeData(e.graphic),\n        opacityFeature: this.getOpacityFeatureAttributeData(e.graphic)\n      }\n    });\n  }\n\n  _createAsOverlay(e, t) {\n    const i = e.graphic,\n          r = this._getGeometryAsPolygonOrPolyline(i.geometry),\n          a = \"polygon\" === r.type ? r.rings : r.paths,\n          s = \"polygon\" === r.type ? this.ringMaterial : this.lineMaterial;\n\n    s.renderPriority = this._renderPriority;\n    const n = new Array(),\n          o = h(),\n          p = c(),\n          u = D(r, this._context.overlaySR),\n          g = \"polygon\" === r.type ? \"rings\" : \"paths\";\n\n    this._logGeometryCreationWarnings(u, a, g, \"LineSymbol3DLayer\");\n\n    for (const h of u.lines) {\n      if (c(o), m(o, h.position), !d(o, this._context.clippingExtent)) continue;\n      y(p, o);\n\n      const a = this._createGeometry(e, h.position, null, r.type),\n            u = new A(a, s, t, i.uid);\n\n      l(u.boundingSphere, .5 * (o[0] + o[3]), .5 * (o[1] + o[4]), 0, .5 * Math.sqrt((o[3] - o[0]) * (o[3] - o[0]) + (o[4] - o[1]) * (o[4] - o[1]))), n.push(u);\n    }\n\n    return new M(this, n, p);\n  }\n\n}\n\nR.elevationModeChangeTypes = {\n  definedChanged: _.RECREATE,\n  staysOnTheGround: _.NONE,\n  onTheGroundChanged: _.RECREATE\n};\nexport default R;\nexport { R as Graphics3DLineSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DLineSymbolLayer.js"],"names":["e","t","get","i","isNone","r","isSome","a","px2pt","s","pt2px","n","I","o","l","f","p","create","h","empty","c","expandWithBuffer","m","intersectsClippingArea","d","expandWithAABB","y","getDriverAxisSizeValueAny","u","perVertexElevationAligner","g","elevationModeChangeUpdateType","SymbolUpdateType","_","needsElevationUpdates2D","b","ElevationContext","v","M","Graphics3DObject3DGraphicLayer","P","Graphics3DSymbolLayer","x","getAttributeValue","U","geometryToRenderInfo","C","createGeometry","E","geometryToRenderInfoDraped","D","initFastSymbolUpdatesState","j","updateFastSymbolUpdatesState","z","Object3D","L","RenderGeometry","A","createStipplePattern","O","RibbonLineMaterial","S","w","G","V","R","constructor","_uniformSize","doLoad","_vvConvertOptions","modelSize","symbolSize","unitInMeters","transformation","anchor","scale","rotation","supportedTypes","size","color","opacity","_context","renderer","visualVariables","length","_fastUpdates","enabled","_drivenProperties","symbolLayer","getMaterialParameters","_getCombinedOpacityAndColor","width","polygonOffset","join","cap","transparent","needsDrivenTransparentPass","slicePlaneEnabled","isClosed","stipplePattern","map","stippleOffColor","toUnitRGBA","stippleIntegerRepeats","materialParameters","lineMaterial","_lineMaterial","stage","add","ringMaterial","_ringMaterial","destroy","remove","getDrivenSize","getSizeFeatureAttributeData","field","getDrivenColor","getColorFeatureAttributeData","getOpacityFeatureAttributeData","createGraphics3DGraphic","graphic","_validateGeometry","geometry","type","setGraphicElevationContext","ensureDrapedStatus","mode","draped","_createAsOverlay","layer","uid","_createAs3DShape","applyRendererDiff","diff","setParameterValues","layerOpacityChanged","updateMaterialLayerOpacity","params","_getCombinedOpacity","layerElevationInfoChanged","_elevationContext","elevationModeChangeTypes","UPDATE","updateGraphics3DGraphicElevationInfo","slicePlaneEnabledChanged","physicalBasedRenderingChanged","pixelRatioChanged","_getGeometryAsPolygonOrPolyline","fromExtent","rings","paths","Array","elevationProvider","renderCoordsHelper","_logGeometryCreationWarnings","lines","position","mapPosition","clippingExtent","_createGeometry","push","geometries","materials","transformations","castShadow","metadata","layerUid","graphicUid","alignedSampledElevation","sampledElevation","needsElevationUpdates","removeDuplicateStartEnd","uniformSize","attributeData","renderingInfo","sizeFeature","colorFeature","opacityFeature","renderPriority","_renderPriority","overlaySR","boundingSphere","Math","sqrt","definedChanged","RECREATE","staysOnTheGround","NONE","onTheGroundChanged","Graphics3DLineSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import\"../../../../geometry.js\";import t from\"../../../../core/Error.js\";import{get as i,isNone as r,isSome as a}from\"../../../../core/maybe.js\";import{px2pt as s,pt2px as n}from\"../../../../core/screenUtils.js\";import{I as o}from\"../../../../chunks/mat4f64.js\";import{s as l}from\"../../../../chunks/vec4.js\";import{f as p}from\"../../../../chunks/vec4f64.js\";import{create as h,empty as c,expandWithBuffer as m,intersectsClippingArea as d,expandWithAABB as y}from\"../../../../geometry/support/aaBoundingBox.js\";import{getDriverAxisSizeValueAny as u}from\"../../../../renderers/support/renderingInfoUtils.js\";import{perVertexElevationAligner as g}from\"./ElevationAligners.js\";import{elevationModeChangeUpdateType as f,SymbolUpdateType as _,needsElevationUpdates2D as b}from\"./elevationAlignmentUtils.js\";import{ElevationContext as v}from\"./ElevationContext.js\";import M from\"./Graphics3DDrapedGraphicLayer.js\";import{Graphics3DObject3DGraphicLayer as P}from\"./Graphics3DObject3DGraphicLayer.js\";import{Graphics3DSymbolLayer as x,getAttributeValue as U}from\"./Graphics3DSymbolLayer.js\";import{geometryToRenderInfo as C,createGeometry as E,geometryToRenderInfoDraped as D}from\"./lineUtils.js\";import{initFastSymbolUpdatesState as j,updateFastSymbolUpdatesState as z}from\"../support/FastSymbolUpdates.js\";import{Object3D as L}from\"../../webgl-engine/lib/Object3D.js\";import{RenderGeometry as A}from\"../../webgl-engine/lib/RenderGeometry.js\";import{createStipplePattern as O}from\"../../webgl-engine/materials/lineStippleUtils.js\";import{RibbonLineMaterial as S}from\"../../webgl-engine/materials/RibbonLineMaterial.js\";import w from\"../../../../geometry/Extent.js\";import G from\"../../../../geometry/Polygon.js\";const V=[\"polyline\",\"polygon\",\"extent\"];class R extends x{constructor(e,t,i,r){super(e,t,i,r),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=j(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const e=null!=this.symbolLayer.size?this.symbolLayer.size:s(1);if(e<0)throw new t(\"graphics3dlinesymbollayer:invalid-size\",\"Symbol sizes may not be negative values\");this._uniformSize=e}}getMaterialParameters(t){const r=i(this.symbolLayer,\"material\",\"color\"),a=this._getCombinedOpacityAndColor(r),o=a[3],l={width:1,color:a,polygonOffset:!0,join:this.symbolLayer.join||\"miter\",cap:this.symbolLayer.cap||\"butt\",transparent:o<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:this.symbolLayer.stipplePattern?O(this.symbolLayer.stipplePattern.map(n)):null,stippleOffColor:this.symbolLayer.stippleOffColor?e.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};if(this._drivenProperties.size)this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(l.width=n(1));else{const e=null!=this.symbolLayer.size?this.symbolLayer.size:s(1);l.width=n(e)}return this._fastUpdates&&this._fastUpdates.visualVariables?{...l,...this._fastUpdates.materialParameters}:l}get lineMaterial(){return r(this._lineMaterial)&&(this._lineMaterial=new S(this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return r(this._ringMaterial)&&(this._ringMaterial=new S(this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}destroy(){super.destroy(),this._context.stage.remove(this._lineMaterial),this._lineMaterial=null,this._context.stage.remove(this._ringMaterial),this._ringMaterial=null}getDrivenSize(e){return this._drivenProperties.size&&e.size?n(u(e.size)):1}getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?U(this._fastUpdates.visualVariables.size.field,e):null}getDrivenColor(e){const t=p(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?U(this._fastUpdates.visualVariables.color.field,e):null}getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?U(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,V,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new v);return this.ensureDrapedStatus(\"on-the-ground\"===i.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,t.uid)}applyRendererDiff(e,t){for(const i in e.diff)switch(i){case\"visualVariables\":if(!z(this._fastUpdates,t,this._vvConvertOptions))return!1;a(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),a(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0}layerOpacityChanged(){return a(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial),a(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial),!0}updateMaterialLayerOpacity(e){const t=e.params.color,r=i(this.symbolLayer,\"material\",\"color\"),a=this._getCombinedOpacity(r),s=a<1||this.needsDrivenTransparentPass,n=[t[0],t[1],t[2],a];e.setParameterValues({color:n,transparent:s})}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,a=f(R.elevationModeChangeTypes,i,r);if(a!==_.UPDATE)return a;const s=b(r);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return a(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),a(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case\"extent\":if(e instanceof w)return G.fromExtent(e);break;case\"polygon\":case\"polyline\":return e}return null}_createAs3DShape(e,t,i){const r=e.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=\"polygon\"===s.type?s.rings:s.paths,l=new Array,p=new Array,y=new Array,u=h(),f=C(s,this._context.elevationProvider,this._context.renderCoordsHelper,t),_=\"polygon\"===s.type?\"rings\":\"paths\";this._logGeometryCreationWarnings(f,n,_,\"LineSymbol3DLayer\");for(let h=0;h<f.lines.length;h++){const{position:t,mapPosition:i}=f.lines[h];if(a(this._context.clippingExtent)&&(c(u),m(u,i),!d(u,this._context.clippingExtent)))continue;const r=this._createGeometry(e,t,i,s.type);l.push(r),p.push(\"polygon\"===s.type?this.ringMaterial:this.lineMaterial),y.push(o)}if(0===l.length)return null;const v=new L({geometries:l,materials:p,transformations:y,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),M=new P(this,v,l,null,null,g,t);return M.alignedSampledElevation=f.sampledElevation,M.needsElevationUpdates=b(t.mode),M}_createGeometry(e,t,i,r){const a=\"polygon\"===r?1:0,s=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,n=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return E({removeDuplicateStartEnd:a,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:i,size:n?null:this.getDrivenSize(e.renderingInfo),color:s?null:this.getDrivenColor(e.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(e.graphic),colorFeature:this.getColorFeatureAttributeData(e.graphic),opacityFeature:this.getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const i=e.graphic,r=this._getGeometryAsPolygonOrPolyline(i.geometry),a=\"polygon\"===r.type?r.rings:r.paths,s=\"polygon\"===r.type?this.ringMaterial:this.lineMaterial;s.renderPriority=this._renderPriority;const n=new Array,o=h(),p=c(),u=D(r,this._context.overlaySR),g=\"polygon\"===r.type?\"rings\":\"paths\";this._logGeometryCreationWarnings(u,a,g,\"LineSymbol3DLayer\");for(const h of u.lines){if(c(o),m(o,h.position),!d(o,this._context.clippingExtent))continue;y(p,o);const a=this._createGeometry(e,h.position,null,r.type),u=new A(a,s,t,i.uid);l(u.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),n.push(u)}return new M(this,n,p)}}R.elevationModeChangeTypes={definedChanged:_.RECREATE,staysOnTheGround:_.NONE,onTheGroundChanged:_.RECREATE};export default R;export{R as Graphics3DLineSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}