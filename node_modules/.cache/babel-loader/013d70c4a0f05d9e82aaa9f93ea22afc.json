{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../core/clock.js\";\nimport { InputHandler as e } from \"../InputHandler.js\";\nimport { DefaultParameters as i } from \"./SingleAndDoubleClick.js\";\nimport { manhattanDistance as o } from \"./support.js\";\n\nclass n extends e {\n  constructor(e = i.maximumDoubleClickDelay, o = i.maximumDoubleClickDistance, n = i.maximumDoubleTouchDelay, a = i.maximumDoubleTouchDistance, s = t) {\n    super(!1), this.maximumDoubleClickDelay = e, this.maximumDoubleClickDistance = o, this.maximumDoubleTouchDelay = n, this.maximumDoubleTouchDistance = a, this._clock = s, this._pointerState = new Map(), this._immediateDoubleClick = this.registerOutgoing(\"immediate-double-click\"), this.registerIncoming(\"pointer-down\", this._handlePointerDown.bind(this)), this.registerIncoming(\"pointer-up\", t => {\n      this._handlePointerLoss(t, \"pointer-up\");\n    }), this.registerIncoming(\"pointer-capture-lost\", t => {\n      this._handlePointerLoss(t, \"pointer-capture-lost\");\n    }), this.registerIncoming(\"pointer-cancel\", t => {\n      this._handlePointerLoss(t, \"pointer-cancel\");\n    });\n  }\n\n  onUninstall() {\n    this._pointerState.forEach(t => {\n      t.immediateDoubleClick && t.immediateDoubleClick.timeoutHandle.remove();\n    }), super.onUninstall();\n  }\n\n  _handlePointerDown(t) {\n    const e = t.data,\n          i = this._pointerId(e);\n\n    if (!this._pointerState.has(i)) {\n      const t = {\n        downButton: e.native.button,\n        immediateDoubleClick: null\n      };\n      this._pointerState.set(i, t), this.startCapturingPointer(e.native);\n    }\n  }\n\n  _handlePointerLoss(t, e) {\n    const i = t.data,\n          n = this._pointerId(i),\n          a = this._pointerState.get(n);\n\n    if (a && \"pointer-up\" === e && a.downButton === i.native.button) {\n      const e = a.immediateDoubleClick;\n\n      if (e) {\n        e.timeoutHandle.remove();\n        const n = \"touch\" === t.data.native.pointerType ? this.maximumDoubleTouchDistance : this.maximumDoubleClickDistance;\n        o(e, t.data) > n ? this._startImmediateDoubleClick(t, a) : (this._immediateDoubleClick.emit(t.data, void 0, e.modifiers), this._removeState(i));\n      } else this._startImmediateDoubleClick(t, a);\n    }\n  }\n\n  _startImmediateDoubleClick(t, e) {\n    const i = \"touch\" === t.data.native.pointerType ? this.maximumDoubleTouchDelay : this.maximumDoubleClickDelay;\n    e.immediateDoubleClick = {\n      x: t.data.x,\n      y: t.data.y,\n      modifiers: t.modifiers,\n      timeoutHandle: this._clock.setTimeout(() => this._removeState(t.data), i)\n    };\n  }\n\n  _pointerId(t) {\n    const e = t.native;\n    return \"mouse\" === e.pointerType ? `${e.pointerId}:${e.button}` : `${e.pointerType}`;\n  }\n\n  _removeState(t) {\n    const e = this._pointerId(t);\n\n    this._pointerState.delete(e), this.stopCapturingPointer(t.native), this.refreshHasPendingInputs();\n  }\n\n}\n\nexport { n as ImmediateDoubleClick };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/input/recognizers/ImmediateDoubleClick.js"],"names":["t","InputHandler","e","DefaultParameters","i","manhattanDistance","o","n","constructor","maximumDoubleClickDelay","maximumDoubleClickDistance","maximumDoubleTouchDelay","a","maximumDoubleTouchDistance","s","_clock","_pointerState","Map","_immediateDoubleClick","registerOutgoing","registerIncoming","_handlePointerDown","bind","_handlePointerLoss","onUninstall","forEach","immediateDoubleClick","timeoutHandle","remove","data","_pointerId","has","downButton","native","button","set","startCapturingPointer","get","pointerType","_startImmediateDoubleClick","emit","modifiers","_removeState","x","y","setTimeout","pointerId","delete","stopCapturingPointer","refreshHasPendingInputs","ImmediateDoubleClick"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../core/clock.js\";import{InputHandler as e}from\"../InputHandler.js\";import{DefaultParameters as i}from\"./SingleAndDoubleClick.js\";import{manhattanDistance as o}from\"./support.js\";class n extends e{constructor(e=i.maximumDoubleClickDelay,o=i.maximumDoubleClickDistance,n=i.maximumDoubleTouchDelay,a=i.maximumDoubleTouchDistance,s=t){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=o,this.maximumDoubleTouchDelay=n,this.maximumDoubleTouchDistance=a,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing(\"immediate-double-click\"),this.registerIncoming(\"pointer-down\",this._handlePointerDown.bind(this)),this.registerIncoming(\"pointer-up\",(t=>{this._handlePointerLoss(t,\"pointer-up\")})),this.registerIncoming(\"pointer-capture-lost\",(t=>{this._handlePointerLoss(t,\"pointer-capture-lost\")})),this.registerIncoming(\"pointer-cancel\",(t=>{this._handlePointerLoss(t,\"pointer-cancel\")}))}onUninstall(){this._pointerState.forEach((t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=this._pointerId(e);if(!this._pointerState.has(i)){const t={downButton:e.native.button,immediateDoubleClick:null};this._pointerState.set(i,t),this.startCapturingPointer(e.native)}}_handlePointerLoss(t,e){const i=t.data,n=this._pointerId(i),a=this._pointerState.get(n);if(a&&\"pointer-up\"===e&&a.downButton===i.native.button){const e=a.immediateDoubleClick;if(e){e.timeoutHandle.remove();const n=\"touch\"===t.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;o(e,t.data)>n?this._startImmediateDoubleClick(t,a):(this._immediateDoubleClick.emit(t.data,void 0,e.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(t,a)}}_startImmediateDoubleClick(t,e){const i=\"touch\"===t.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;e.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(t.data)),i)}}_pointerId(t){const e=t.native;return\"mouse\"===e.pointerType?`${e.pointerId}:${e.button}`:`${e.pointerType}`}_removeState(t){const e=this._pointerId(t);this._pointerState.delete(e),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}export{n as ImmediateDoubleClick};\n"]},"metadata":{},"sourceType":"module"}