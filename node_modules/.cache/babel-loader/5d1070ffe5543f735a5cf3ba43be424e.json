{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Evented.js\";\nimport t from \"../../../../core/Handles.js\";\nimport { isSome as s, isNone as i, destroyMaybe as r } from \"../../../../core/maybe.js\";\nimport o from \"../../../../core/PooledArray.js\";\nimport { ContentObject as a } from \"./ContentObject.js\";\nimport { DirtyEventNames as h } from \"./DirtyEvents.js\";\nimport c from \"./Octree.js\";\n\nclass n extends a {\n  constructor(s, i = \"\") {\n    var r, a, h;\n    super(), this.apiLayerUid = i, this.type = 0, this.events = new e(), this.isSliceable = !1, this._objects = new o(), this._stageHandles = new t(), this.apiLayerUid = i, this.isVisible = null == (r = null == s ? void 0 : s.isVisible) || r, this.isPickable = null == (a = null == s ? void 0 : s.isPickable) || a, this.updatePolicy = null != (h = null == s ? void 0 : s.updatePolicy) ? h : 0;\n  }\n\n  get objects() {\n    return this._objects;\n  }\n\n  destroy() {\n    this.detachStage(), this._stage = null;\n  }\n\n  attachStage(e) {\n    this.detachStage(), this._stage = e;\n\n    for (const t of h) this._stageHandles.add(this.events.on(t, s => e.handleEvent(t, s)));\n  }\n\n  detachStage() {\n    this._stageHandles.removeAll(), this.invalidateSpatialQueryAccelerator();\n  }\n\n  add(e) {\n    this._objects.push(e), e.parentLayer = this, this.events.emit(\"layerObjectAdded\", {\n      layer: this,\n      object: e\n    }), s(this._octree) && this._octree.add([e]);\n  }\n\n  remove(e) {\n    this._objects.removeUnordered(e) && (e.parentLayer = null, this.events.emit(\"layerObjectRemoved\", {\n      layer: this,\n      object: e\n    }), s(this._octree) && this._octree.remove([e]));\n  }\n\n  addMany(e) {\n    this._objects.pushArray(e);\n\n    for (const t of e) t.parentLayer = this;\n\n    this.events.emit(\"layerObjectsAdded\", {\n      layer: this,\n      objects: e\n    }), s(this._octree) && this._octree.add(e);\n  }\n\n  removeMany(e) {\n    const t = new Array();\n\n    if (this._objects.removeUnorderedMany(e, e.length, t), 0 !== t.length) {\n      for (const e of t) e.parentLayer = null;\n\n      this.events.emit(\"layerObjectsRemoved\", {\n        layer: this,\n        objects: t\n      }), s(this._octree) && this._octree.remove(t);\n    }\n  }\n\n  sync() {\n    s(this._stage) && 1 !== this.updatePolicy && this._stage.syncLayer(this.id);\n  }\n\n  notifyObjectBBChanged(e, t) {\n    s(this._octree) && this._octree.update(e, t);\n  }\n\n  getSpatialQueryAccelerator() {\n    return i(this._octree) && this._objects.length > 50 && this._createOctree(), this._octree;\n  }\n\n  shaderTransformationChanged() {\n    this.invalidateSpatialQueryAccelerator(), this.events.emit(\"shaderTransformationChanged\", this);\n  }\n\n  invalidateSpatialQueryAccelerator() {\n    this._octree = r(this._octree);\n  }\n\n  _createOctree() {\n    this._octree = new c(e => e.boundingVolumeWorldSpace.bounds), this._octree.add(this._objects.data, this._objects.length);\n  }\n\n}\n\nfunction l(e) {\n  return s(e) && 0 === e.type;\n}\n\nexport { n as WebGLLayer, l as isWebGLLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/WebGLLayer.js"],"names":["e","t","isSome","s","isNone","i","destroyMaybe","r","o","ContentObject","a","DirtyEventNames","h","c","n","constructor","apiLayerUid","type","events","isSliceable","_objects","_stageHandles","isVisible","isPickable","updatePolicy","objects","destroy","detachStage","_stage","attachStage","add","on","handleEvent","removeAll","invalidateSpatialQueryAccelerator","push","parentLayer","emit","layer","object","_octree","remove","removeUnordered","addMany","pushArray","removeMany","Array","removeUnorderedMany","length","sync","syncLayer","id","notifyObjectBBChanged","update","getSpatialQueryAccelerator","_createOctree","shaderTransformationChanged","boundingVolumeWorldSpace","bounds","data","l","WebGLLayer","isWebGLLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Evented.js\";import t from\"../../../../core/Handles.js\";import{isSome as s,isNone as i,destroyMaybe as r}from\"../../../../core/maybe.js\";import o from\"../../../../core/PooledArray.js\";import{ContentObject as a}from\"./ContentObject.js\";import{DirtyEventNames as h}from\"./DirtyEvents.js\";import c from\"./Octree.js\";class n extends a{constructor(s,i=\"\"){var r,a,h;super(),this.apiLayerUid=i,this.type=0,this.events=new e,this.isSliceable=!1,this._objects=new o,this._stageHandles=new t,this.apiLayerUid=i,this.isVisible=null==(r=null==s?void 0:s.isVisible)||r,this.isPickable=null==(a=null==s?void 0:s.isPickable)||a,this.updatePolicy=null!=(h=null==s?void 0:s.updatePolicy)?h:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of h)this._stageHandles.add(this.events.on(t,(s=>e.handleEvent(t,s))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit(\"layerObjectAdded\",{layer:this,object:e}),s(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit(\"layerObjectRemoved\",{layer:this,object:e}),s(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit(\"layerObjectsAdded\",{layer:this,objects:e}),s(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit(\"layerObjectsRemoved\",{layer:this,objects:t}),s(this._octree)&&this._octree.remove(t)}}sync(){s(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){s(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return i(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit(\"shaderTransformationChanged\",this)}invalidateSpatialQueryAccelerator(){this._octree=r(this._octree)}_createOctree(){this._octree=new c((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}function l(e){return s(e)&&0===e.type}export{n as WebGLLayer,l as isWebGLLayer};\n"]},"metadata":{},"sourceType":"module"}