{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { acosClamped as t } from \"../../../../core/mathUtils.js\";\nimport { isNone as o, isSome as e, unwrapOr as n } from \"../../../../core/maybe.js\";\nimport { slice as r } from \"../../../../core/typedArrayUtil.js\";\nimport { s as i, n as s, d as a, a as u } from \"../../../../chunks/vec3.js\";\nimport { c } from \"../../../../chunks/vec3f64.js\";\nimport { projectBuffer as p } from \"../../../../geometry/projection.js\";\nimport { pathsToTriangulationInfo as l } from \"../../../../geometry/support/triangulationUtils.js\";\nimport { WHITE_UNIT as f } from \"./constants.js\";\nimport { applyPerVertexElevationAlignment as h } from \"./elevationAlignmentUtils.js\";\nimport { DRAPED_Z as m } from \"../../terrain/OverlayRenderer.js\";\nimport { Geometry as y } from \"../../webgl-engine/lib/Geometry.js\";\n\nfunction b(t) {\n  const o = [],\n        e = [];\n  j(t, e, o);\n  const n = e[0][1].data,\n        r = o[0][1].length,\n        i = new Uint16Array(r);\n  return A(t, e, o), F(t, e, o, i), w(t, e, o, i), v(t, e, o, i), D(t, e, o, i), P(t, e, o, i), U(t, e, o, n), new y(e, o, 2);\n}\n\nfunction g(t, o, e, n) {\n  const r = \"polygon\" === t.type ? 1 : 0,\n        i = \"polygon\" === t.type ? t.rings : t.paths,\n        {\n    position: s,\n    outlines: a\n  } = l(i, t.hasZ, r),\n        u = new Float64Array(s.length),\n        c = h(s, t.spatialReference, 0, u, 0, s, 0, s.length / 3, o, e, n),\n        p = null != c;\n  return {\n    lines: p ? d(a, s, u) : [],\n    projectionSuccess: p,\n    sampledElevation: c\n  };\n}\n\nfunction d(t, o, e) {\n  const n = new Array();\n\n  for (const {\n    index: r,\n    count: i\n  } of t) {\n    if (i <= 1) continue;\n    const t = 3 * r,\n          s = t + 3 * i;\n    n.push({\n      position: o.subarray(t, s),\n      mapPosition: e ? e.subarray(t, s) : void 0\n    });\n  }\n\n  return n;\n}\n\nfunction z(t, o) {\n  const e = \"polygon\" === t.type ? 1 : 0,\n        n = \"polygon\" === t.type ? t.rings : t.paths,\n        {\n    position: r,\n    outlines: i\n  } = l(n, !1, e),\n        s = p(r, t.spatialReference, 0, r, o, 0, r.length / 3);\n\n  for (let a = 2; a < r.length; a += 3) r[a] = m;\n\n  return {\n    lines: s ? d(i, r) : [],\n    projectionSuccess: s\n  };\n}\n\nfunction j(t, o, e) {\n  const {\n    attributeData: {\n      position: n\n    },\n    removeDuplicateStartEnd: i\n  } = t,\n        s = M(n) && 1 === i,\n        a = n.length / 3 - (s ? 1 : 0),\n        u = new Uint32Array(2 * (a - 1)),\n        c = s ? r(n, 0, n.length - 3) : n;\n  let p = 0;\n\n  for (let r = 0; r < a - 1; r++) u[p++] = r, u[p++] = r + 1;\n\n  o.push([\"position\", {\n    size: 3,\n    data: c,\n    exclusive: s\n  }]), e.push([\"position\", u]);\n}\n\nfunction A(t, e, n) {\n  const r = t.attributeData.mapPosition;\n  o(r) || (n.push([\"mapPos\", n[0][1]]), e.push([\"mapPos\", {\n    size: 3,\n    data: r\n  }]));\n}\n\nfunction F(t, o, r, i) {\n  if (e(t.attributeData.colorFeature)) return;\n  const s = t.attributeData.color;\n  o.push([\"color\", {\n    size: 4,\n    data: n(s, f)\n  }]), r.push([\"color\", i]);\n}\n\nfunction v(t, e, n, r) {\n  const i = t.attributeData.colorFeature;\n  o(i) || (e.push([\"colorFeatureAttribute\", {\n    size: 1,\n    data: new Float32Array([i])\n  }]), n.push([\"color\", r]));\n}\n\nfunction w(t, o, r, i) {\n  if (e(t.attributeData.sizeFeature)) return;\n  const s = t.attributeData.size;\n  o.push([\"size\", {\n    size: 1,\n    data: [n(s, 1)]\n  }]), r.push([\"size\", i]);\n}\n\nfunction D(t, e, n, r) {\n  const i = t.attributeData.sizeFeature;\n  o(i) || (e.push([\"sizeFeatureAttribute\", {\n    size: 1,\n    data: new Float32Array([i])\n  }]), n.push([\"sizeFeatureAttribute\", r]));\n}\n\nfunction P(t, e, n, r) {\n  const i = t.attributeData.opacityFeature;\n  o(i) || (e.push([\"opacityFeatureAttribute\", {\n    size: 1,\n    data: new Float32Array([i])\n  }]), n.push([\"opacityFeatureAttribute\", r]));\n}\n\nfunction U(o, e, r, c) {\n  if (\"round\" !== o.join) return;\n  const p = c.length / 3,\n        l = new Float32Array(p),\n        f = S,\n        h = R;\n  i(f, 0, 0, 0);\n  const m = n(o.uniformSize, 1);\n\n  for (let n = -1; n < p; ++n) {\n    const o = n < 0 ? p + n : n,\n          e = (n + 1) % p;\n\n    if (i(h, c[3 * e + 0] - c[3 * o + 0], c[3 * e + 1] - c[3 * o + 1], c[3 * e + 2] - c[3 * o + 2]), s(h, h), n >= 0) {\n      const o = 1 * ((Math.PI - t(a(f, h))) * k) * x(m);\n      l[n] = Math.max(Math.floor(o), 0);\n    }\n\n    u(f, h, -1);\n  }\n\n  e.push([\"subdivisions\", {\n    size: 1,\n    data: l\n  }]), r.push([\"subdivisions\", r[0][1]]);\n}\n\nfunction x(t) {\n  return 1.863798 + -2.0062872 / (1 + t / 18.2313) ** .8856294;\n}\n\nfunction M(t) {\n  const o = t.length;\n  return t[0] === t[o - 3] && t[1] === t[o - 2] && t[2] === t[o - 1];\n}\n\nconst S = c(),\n      R = c(),\n      k = 4 / Math.PI;\nexport { b as createGeometry, g as geometryToRenderInfo, z as geometryToRenderInfoDraped };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/lineUtils.js"],"names":["acosClamped","t","isNone","o","isSome","e","unwrapOr","n","slice","r","s","i","d","a","u","c","projectBuffer","p","pathsToTriangulationInfo","l","WHITE_UNIT","f","applyPerVertexElevationAlignment","h","DRAPED_Z","m","Geometry","y","b","j","data","length","Uint16Array","A","F","w","v","D","P","U","g","type","rings","paths","position","outlines","hasZ","Float64Array","spatialReference","lines","projectionSuccess","sampledElevation","Array","index","count","push","subarray","mapPosition","z","attributeData","removeDuplicateStartEnd","M","Uint32Array","size","exclusive","colorFeature","color","Float32Array","sizeFeature","opacityFeature","join","S","R","uniformSize","Math","PI","k","x","max","floor","createGeometry","geometryToRenderInfo","geometryToRenderInfoDraped"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{acosClamped as t}from\"../../../../core/mathUtils.js\";import{isNone as o,isSome as e,unwrapOr as n}from\"../../../../core/maybe.js\";import{slice as r}from\"../../../../core/typedArrayUtil.js\";import{s as i,n as s,d as a,a as u}from\"../../../../chunks/vec3.js\";import{c}from\"../../../../chunks/vec3f64.js\";import{projectBuffer as p}from\"../../../../geometry/projection.js\";import{pathsToTriangulationInfo as l}from\"../../../../geometry/support/triangulationUtils.js\";import{WHITE_UNIT as f}from\"./constants.js\";import{applyPerVertexElevationAlignment as h}from\"./elevationAlignmentUtils.js\";import{DRAPED_Z as m}from\"../../terrain/OverlayRenderer.js\";import{Geometry as y}from\"../../webgl-engine/lib/Geometry.js\";function b(t){const o=[],e=[];j(t,e,o);const n=e[0][1].data,r=o[0][1].length,i=new Uint16Array(r);return A(t,e,o),F(t,e,o,i),w(t,e,o,i),v(t,e,o,i),D(t,e,o,i),P(t,e,o,i),U(t,e,o,n),new y(e,o,2)}function g(t,o,e,n){const r=\"polygon\"===t.type?1:0,i=\"polygon\"===t.type?t.rings:t.paths,{position:s,outlines:a}=l(i,t.hasZ,r),u=new Float64Array(s.length),c=h(s,t.spatialReference,0,u,0,s,0,s.length/3,o,e,n),p=null!=c;return{lines:p?d(a,s,u):[],projectionSuccess:p,sampledElevation:c}}function d(t,o,e){const n=new Array;for(const{index:r,count:i}of t){if(i<=1)continue;const t=3*r,s=t+3*i;n.push({position:o.subarray(t,s),mapPosition:e?e.subarray(t,s):void 0})}return n}function z(t,o){const e=\"polygon\"===t.type?1:0,n=\"polygon\"===t.type?t.rings:t.paths,{position:r,outlines:i}=l(n,!1,e),s=p(r,t.spatialReference,0,r,o,0,r.length/3);for(let a=2;a<r.length;a+=3)r[a]=m;return{lines:s?d(i,r):[],projectionSuccess:s}}function j(t,o,e){const{attributeData:{position:n},removeDuplicateStartEnd:i}=t,s=M(n)&&1===i,a=n.length/3-(s?1:0),u=new Uint32Array(2*(a-1)),c=s?r(n,0,n.length-3):n;let p=0;for(let r=0;r<a-1;r++)u[p++]=r,u[p++]=r+1;o.push([\"position\",{size:3,data:c,exclusive:s}]),e.push([\"position\",u])}function A(t,e,n){const r=t.attributeData.mapPosition;o(r)||(n.push([\"mapPos\",n[0][1]]),e.push([\"mapPos\",{size:3,data:r}]))}function F(t,o,r,i){if(e(t.attributeData.colorFeature))return;const s=t.attributeData.color;o.push([\"color\",{size:4,data:n(s,f)}]),r.push([\"color\",i])}function v(t,e,n,r){const i=t.attributeData.colorFeature;o(i)||(e.push([\"colorFeatureAttribute\",{size:1,data:new Float32Array([i])}]),n.push([\"color\",r]))}function w(t,o,r,i){if(e(t.attributeData.sizeFeature))return;const s=t.attributeData.size;o.push([\"size\",{size:1,data:[n(s,1)]}]),r.push([\"size\",i])}function D(t,e,n,r){const i=t.attributeData.sizeFeature;o(i)||(e.push([\"sizeFeatureAttribute\",{size:1,data:new Float32Array([i])}]),n.push([\"sizeFeatureAttribute\",r]))}function P(t,e,n,r){const i=t.attributeData.opacityFeature;o(i)||(e.push([\"opacityFeatureAttribute\",{size:1,data:new Float32Array([i])}]),n.push([\"opacityFeatureAttribute\",r]))}function U(o,e,r,c){if(\"round\"!==o.join)return;const p=c.length/3,l=new Float32Array(p),f=S,h=R;i(f,0,0,0);const m=n(o.uniformSize,1);for(let n=-1;n<p;++n){const o=n<0?p+n:n,e=(n+1)%p;if(i(h,c[3*e+0]-c[3*o+0],c[3*e+1]-c[3*o+1],c[3*e+2]-c[3*o+2]),s(h,h),n>=0){const o=1*((Math.PI-t(a(f,h)))*k)*x(m);l[n]=Math.max(Math.floor(o),0)}u(f,h,-1)}e.push([\"subdivisions\",{size:1,data:l}]),r.push([\"subdivisions\",r[0][1]])}function x(t){return 1.863798+-2.0062872/(1+t/18.2313)**.8856294}function M(t){const o=t.length;return t[0]===t[o-3]&&t[1]===t[o-2]&&t[2]===t[o-1]}const S=c(),R=c(),k=4/Math.PI;export{b as createGeometry,g as geometryToRenderInfo,z as geometryToRenderInfoDraped};\n"]},"metadata":{},"sourceType":"module"}