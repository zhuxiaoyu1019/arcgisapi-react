{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/PooledArray.js\";\nimport { h as n, d as e } from \"../../../../../chunks/mat3.js\";\nimport { c as o } from \"../../../../../chunks/mat3f64.js\";\nimport { c as r } from \"../../../../../chunks/quat.js\";\nimport { a } from \"../../../../../chunks/quatf64.js\";\nimport { d as s, w as c, q as f, b as l, s as u, e as i, g as h, t as m } from \"../../../../../chunks/vec3.js\";\nimport { c as p } from \"../../../../../chunks/vec3f64.js\";\nimport { signedDistance as d } from \"../../../../../geometry/support/plane.js\";\nimport { projectedRadius as g, intersectPlane as j } from \"../../../support/orientedBoundingBox.js\";\nimport { empty as b, within as k, union as w } from \"../../lib/depthRange.js\";\n\nfunction z(t, n) {\n  const e = b(),\n        {\n    eye: o,\n    frustum: r,\n    viewForward: a\n  } = t;\n\n  for (let f = 0; f < n.length; f++) {\n    const t = n[f].obb,\n          l = s(c(E, t.center, o), a),\n          u = g(t, a);\n    if (k(e, l - u) && k(e, l + u)) continue;\n    const i = R(t, r);\n    if (-1 === i) continue;\n\n    if (0 === i) {\n      q.far = l + u, q.near = l - u, w(e, q);\n      continue;\n    }\n\n    const h = S.pushNew();\n    h.near = l - u, h.far = l + u, h.mask = i, h.object = n[f];\n  }\n\n  for (let f = 0; f < S.length; f++) {\n    const t = S.data[f];\n    if (k(e, t.near) && k(e, t.far)) continue;\n    q.far = t.far, q.near = 1 / 0;\n    0 === M(t.object.obb, o, x, n => {\n      let e = A;\n\n      for (let o = 0; o < P && n.length > 0; o++) {\n        if (0 == (t.mask & 1 << o)) continue;\n        B(r[o], n, e);\n        const a = n;\n        n = e, e = a;\n      }\n\n      for (let t = 0; t < n.length; t += 3) {\n        u(y, n.data[t + 0], n.data[t + 1], n.data[t + 2]);\n        const e = s(c(y, y, o), a);\n        q.near = Math.min(q.near, e);\n      }\n    }) && (q.near = 0), w(e, q);\n  }\n\n  return S.length = 0, e;\n}\n\nconst S = new t({\n  allocator: t => t || {\n    near: 1 / 0,\n    far: -1 / 0,\n    mask: 0,\n    object: null\n  },\n  deallocator: t => (t.object = null, t)\n}),\n      q = b(),\n      y = p(),\n      v = p(),\n      x = new t({\n  deallocator: null\n}),\n      A = new t({\n  deallocator: null\n});\n\nfunction B(t, n, e) {\n  e.length = 0;\n  const o = n.length - 3;\n  F(y, n, o);\n  const r = d(t, y);\n  r <= 0 && (e.push(y[0]), e.push(y[1]), e.push(y[2]));\n  let a = 0,\n      s = r;\n\n  for (; a < o; a += 3) {\n    F(v, n, a);\n    const o = d(t, v);\n\n    if (s * o < 0) {\n      i(y, v, y, o / (o - s)), I(e, y);\n    }\n\n    o <= 0 && I(e, v), s = o, h(y, v);\n  }\n\n  if (s * r < 0) {\n    F(v, n, o);\n    i(y, v, y, r / (r - s)), I(e, y);\n  }\n}\n\nfunction F(t, n, e) {\n  return u(t, n.data[e + 0], n.data[e + 1], n.data[e + 2]);\n}\n\nfunction I(t, n) {\n  t.push(n[0]), t.push(n[1]), t.push(n[2]);\n}\n\nfunction M(t, o, a, s) {\n  r(D, t.quaternion), c(E, o, t.center), f(E, E, D);\n  const i = 8 * ((E[0] < -t.halfSize[0] ? -1 : E[0] > t.halfSize[0] ? 1 : 0) + 3 * (E[1] < -t.halfSize[1] ? -1 : E[1] > t.halfSize[1] ? 1 : 0) + 9 * (E[2] < -t.halfSize[2] ? -1 : E[2] > t.halfSize[2] ? 1 : 0) + 13),\n        h = N[i];\n  if (0 === h) return h;\n  n(C, t.quaternion), e(C, C, t.halfSize);\n\n  const p = (n, e) => {\n    const o = N[i + e + 1];\n    return u(n, ((1 & o) << 1) - 1, (2 & o) - 1, ((4 & o) >> 1) - 1), m(n, n, C), l(n, t.center, n);\n  };\n\n  return a.length = 0, I(a, p(G, 0)), I(a, p(H, 1)), I(a, p(E, 2)), I(a, p(J, 3)), s(a), 1 === h ? h : (a.length = 0, I(a, G), I(a, J), I(a, p(E, 4)), I(a, p(K, 5)), s(a), 2 === h || (a.length = 0, I(a, G), I(a, K), I(a, p(E, 6)), I(a, H), s(a)), h);\n}\n\nconst N = (() => {\n  const t = new Int8Array(216);\n  let n = 0;\n\n  const e = e => {\n    for (let o = 0; o < e.length; o++) t[n + o] = e[o];\n\n    n += 8;\n  };\n\n  return e([3, 0, 6, 2, 3, 1, 5, 4]), e([2, 0, 2, 3, 1, 5, 4, 0]), e([3, 1, 0, 2, 3, 7, 5, 4]), e([2, 0, 1, 3, 2, 6, 4, 0]), e([1, 0, 1, 3, 2, 0, 0, 0]), e([2, 1, 5, 7, 3, 2, 0, 0]), e([3, 2, 0, 1, 3, 7, 6, 4]), e([2, 2, 0, 1, 3, 7, 6, 0]), e([3, 3, 0, 1, 5, 7, 6, 2]), e([2, 0, 1, 5, 4, 6, 2, 0]), e([1, 0, 1, 5, 4, 0, 0, 0]), e([2, 1, 3, 7, 5, 4, 0, 0]), e([1, 0, 2, 6, 4, 0, 0, 0]), e([0, 0, 0, 0, 0, 0, 0, 0]), e([1, 1, 3, 7, 5, 0, 0, 0]), e([2, 2, 3, 7, 6, 4, 0, 0]), e([1, 2, 3, 7, 6, 0, 0, 0]), e([2, 3, 1, 5, 7, 6, 2, 0]), e([3, 4, 0, 1, 5, 7, 6, 2]), e([2, 5, 7, 6, 4, 0, 1, 0]), e([3, 5, 0, 1, 3, 7, 6, 4]), e([2, 4, 5, 7, 6, 2, 0, 0]), e([1, 4, 5, 7, 6, 0, 0, 0]), e([2, 5, 1, 3, 7, 6, 4, 0]), e([3, 6, 0, 2, 3, 7, 5, 4]), e([2, 6, 2, 3, 7, 5, 4, 0]), e([3, 7, 6, 2, 3, 1, 5, 4]), t;\n})(),\n      P = 4;\n\nfunction R(t, n) {\n  let e = 0;\n\n  for (let o = 0; o < P; o++) {\n    const r = j(t, n[o]);\n    if (r > 0) return -1;\n    0 === r && (e |= 1 << o);\n  }\n\n  return e;\n}\n\nconst C = o(),\n      D = a(),\n      E = p(),\n      G = p(),\n      H = p(),\n      J = p(),\n      K = p();\nexport { z as computeDepthRange };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/DepthRange.js"],"names":["t","h","n","d","e","c","o","r","a","s","w","q","f","b","l","u","i","g","m","p","signedDistance","projectedRadius","intersectPlane","j","empty","within","k","union","z","eye","frustum","viewForward","length","obb","E","center","R","far","near","S","pushNew","mask","object","data","M","x","A","P","B","y","Math","min","allocator","deallocator","v","F","push","I","D","quaternion","halfSize","N","C","G","H","J","K","Int8Array","computeDepthRange"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/PooledArray.js\";import{h as n,d as e}from\"../../../../../chunks/mat3.js\";import{c as o}from\"../../../../../chunks/mat3f64.js\";import{c as r}from\"../../../../../chunks/quat.js\";import{a}from\"../../../../../chunks/quatf64.js\";import{d as s,w as c,q as f,b as l,s as u,e as i,g as h,t as m}from\"../../../../../chunks/vec3.js\";import{c as p}from\"../../../../../chunks/vec3f64.js\";import{signedDistance as d}from\"../../../../../geometry/support/plane.js\";import{projectedRadius as g,intersectPlane as j}from\"../../../support/orientedBoundingBox.js\";import{empty as b,within as k,union as w}from\"../../lib/depthRange.js\";function z(t,n){const e=b(),{eye:o,frustum:r,viewForward:a}=t;for(let f=0;f<n.length;f++){const t=n[f].obb,l=s(c(E,t.center,o),a),u=g(t,a);if(k(e,l-u)&&k(e,l+u))continue;const i=R(t,r);if(-1===i)continue;if(0===i){q.far=l+u,q.near=l-u,w(e,q);continue}const h=S.pushNew();h.near=l-u,h.far=l+u,h.mask=i,h.object=n[f]}for(let f=0;f<S.length;f++){const t=S.data[f];if(k(e,t.near)&&k(e,t.far))continue;q.far=t.far,q.near=1/0;0===M(t.object.obb,o,x,(n=>{let e=A;for(let o=0;o<P&&n.length>0;o++){if(0==(t.mask&1<<o))continue;B(r[o],n,e);const a=n;n=e,e=a}for(let t=0;t<n.length;t+=3){u(y,n.data[t+0],n.data[t+1],n.data[t+2]);const e=s(c(y,y,o),a);q.near=Math.min(q.near,e)}}))&&(q.near=0),w(e,q)}return S.length=0,e}const S=new t({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),q=b(),y=p(),v=p(),x=new t({deallocator:null}),A=new t({deallocator:null});function B(t,n,e){e.length=0;const o=n.length-3;F(y,n,o);const r=d(t,y);r<=0&&(e.push(y[0]),e.push(y[1]),e.push(y[2]));let a=0,s=r;for(;a<o;a+=3){F(v,n,a);const o=d(t,v);if(s*o<0){i(y,v,y,o/(o-s)),I(e,y)}o<=0&&I(e,v),s=o,h(y,v)}if(s*r<0){F(v,n,o);i(y,v,y,r/(r-s)),I(e,y)}}function F(t,n,e){return u(t,n.data[e+0],n.data[e+1],n.data[e+2])}function I(t,n){t.push(n[0]),t.push(n[1]),t.push(n[2])}function M(t,o,a,s){r(D,t.quaternion),c(E,o,t.center),f(E,E,D);const i=8*((E[0]<-t.halfSize[0]?-1:E[0]>t.halfSize[0]?1:0)+3*(E[1]<-t.halfSize[1]?-1:E[1]>t.halfSize[1]?1:0)+9*(E[2]<-t.halfSize[2]?-1:E[2]>t.halfSize[2]?1:0)+13),h=N[i];if(0===h)return h;n(C,t.quaternion),e(C,C,t.halfSize);const p=(n,e)=>{const o=N[i+e+1];return u(n,((1&o)<<1)-1,(2&o)-1,((4&o)>>1)-1),m(n,n,C),l(n,t.center,n)};return a.length=0,I(a,p(G,0)),I(a,p(H,1)),I(a,p(E,2)),I(a,p(J,3)),s(a),1===h?h:(a.length=0,I(a,G),I(a,J),I(a,p(E,4)),I(a,p(K,5)),s(a),2===h||(a.length=0,I(a,G),I(a,K),I(a,p(E,6)),I(a,H),s(a)),h)}const N=(()=>{const t=new Int8Array(216);let n=0;const e=e=>{for(let o=0;o<e.length;o++)t[n+o]=e[o];n+=8};return e([3,0,6,2,3,1,5,4]),e([2,0,2,3,1,5,4,0]),e([3,1,0,2,3,7,5,4]),e([2,0,1,3,2,6,4,0]),e([1,0,1,3,2,0,0,0]),e([2,1,5,7,3,2,0,0]),e([3,2,0,1,3,7,6,4]),e([2,2,0,1,3,7,6,0]),e([3,3,0,1,5,7,6,2]),e([2,0,1,5,4,6,2,0]),e([1,0,1,5,4,0,0,0]),e([2,1,3,7,5,4,0,0]),e([1,0,2,6,4,0,0,0]),e([0,0,0,0,0,0,0,0]),e([1,1,3,7,5,0,0,0]),e([2,2,3,7,6,4,0,0]),e([1,2,3,7,6,0,0,0]),e([2,3,1,5,7,6,2,0]),e([3,4,0,1,5,7,6,2]),e([2,5,7,6,4,0,1,0]),e([3,5,0,1,3,7,6,4]),e([2,4,5,7,6,2,0,0]),e([1,4,5,7,6,0,0,0]),e([2,5,1,3,7,6,4,0]),e([3,6,0,2,3,7,5,4]),e([2,6,2,3,7,5,4,0]),e([3,7,6,2,3,1,5,4]),t})(),P=4;function R(t,n){let e=0;for(let o=0;o<P;o++){const r=j(t,n[o]);if(r>0)return-1;0===r&&(e|=1<<o)}return e}const C=o(),D=a(),E=p(),G=p(),H=p(),J=p(),K=p();export{z as computeDepthRange};\n"]},"metadata":{},"sourceType":"module"}