{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { neverReached as t } from \"../../../core/compilerUtils.js\";\nimport { lerp as e } from \"../../../core/mathUtils.js\";\nimport { a as i } from \"../../../chunks/mat4.js\";\nimport { c as r } from \"../../../chunks/mat4f64.js\";\nimport { b as n, a as o, r as s, m as a, s as c, d as p } from \"../../../chunks/vec3.js\";\nimport { c as h } from \"../../../chunks/vec3f64.js\";\nimport { computeLinearTransformation as l, projectVectorToVector as d } from \"../../../geometry/projection.js\";\nimport { getReferenceEllipsoid as m } from \"../../../geometry/projectionEllipsoid.js\";\nimport { empty as g, expandWithVec3 as x, create as u } from \"../../../geometry/support/aaBoundingBox.js\";\nimport { center as f } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { fromPoints as y, create as j } from \"../../../geometry/support/lineSegment.js\";\nimport { create as b, fromVectorsAndPoint as R, copy as S, negate as B } from \"../../../geometry/support/plane.js\";\nimport { wrap as C } from \"../../../geometry/support/ray.js\";\nimport { frustumLineSegment as H } from \"./intersectionUtils.js\";\nconst w = .5 * Math.PI,\n      M = w / Math.PI * 180;\n\nclass E {\n  constructor(t) {\n    this.renderCoordsHelper = t.renderCoordsHelper, this.extent = new Array(4), this.planes = new Array(6), this.maxSpan = 0, this.center = {\n      origin: h(),\n      direction: h()\n    };\n\n    for (let e = 0; e < 4; e++) this.extent[e] = {\n      origin: h(),\n      direction: h(),\n      cap: {\n        next: null,\n        direction: h()\n      }\n    }, this.planes[e] = b();\n\n    this.planes[4] = b(), this.planes[5] = b(), this.planesWithoutFar = this.planes.slice(0, 5);\n  }\n\n  update(t, e, i, r = !0) {\n    const a = this.extent;\n    this.toRenderBoundingExtent(t, e, i), n(this.center.origin, a[0].origin, a[2].origin), o(this.center.origin, this.center.origin, .5), this.renderCoordsHelper.worldUpAtPosition(this.center.origin, this.center.direction), r || o(this.center.direction, this.center.direction, -1);\n\n    for (let n = 0; n < 4; n++) {\n      const t = a[n];\n      this.renderCoordsHelper.worldUpAtPosition(t.origin, t.direction);\n      const e = a[3 === n ? 0 : n + 1];\n      t.cap.next = e.origin, s(t.cap.direction, t.origin, e.origin), R(t.direction, t.cap.direction, t.origin, this.planes[n]), r || o(t.direction, t.direction, -1);\n    }\n\n    R(a[0].cap.direction, a[1].cap.direction, a[0].origin, this.planes[4]), r ? B(this.planes[4], this.planes[5]) : (S(this.planes[4], this.planes[5]), B(this.planes[4], this.planes[4])), this.maxSpan = Math.max(Math.abs(t[0] - t[2]), Math.abs(t[1] - t[3])), this.maxSpanSpatialReference = e, this.minGlobalAltitude = .9 * m(this.maxSpanSpatialReference).radius;\n  }\n\n  isVisibleInFrustum(t, e, i = !1) {\n    if (null == t) return !1;\n\n    if (1 === this.renderCoordsHelper.viewingMode) {\n      const i = this.maxSpanSpatialReference.isGeographic ? M : w * e;\n      if (this.maxSpan > i) return !0;\n      if (t.altitude >= this.minGlobalAltitude) return this.isVisibleInFrustumGlobal(t);\n    }\n\n    if (0 === this.maxSpan) {\n      const e = this.extent[0];\n      return !(i || !t.intersectsRay(C(e.origin, e.direction)));\n    }\n\n    for (let n = 0; n < this.extent.length; n++) {\n      const e = this.extent[n];\n      if (!i && t.intersectsRay(C(e.origin, e.direction))) return !0;\n      if (t.intersectsLineSegment(y(e.origin, e.cap.next, I), e.cap.direction)) return !0;\n    }\n\n    const r = i ? this.planes : this.planesWithoutFar;\n\n    for (let n = 0; n < t.lines.length; n++) {\n      const e = t.lines[n];\n      if (H(r, e.origin, e.endpoint, e.direction)) return !0;\n    }\n\n    return !1;\n  }\n\n  toRenderBoundingExtentGlobal(t, r, n) {\n    const o = 5;\n    f(t, k), k[2] = n, l(r, k, A, this.renderCoordsHelper.spatialReference), i(v, A), g(F);\n\n    for (const {\n      x0: i,\n      x1: s,\n      y0: c,\n      y1: p\n    } of G) for (let h = 0; h < o; h++) {\n      const l = h / (o - 1);\n      k[0] = e(t[i], t[s], l), k[1] = e(t[c], t[p], l), k[2] = n, d(k, r, k, this.renderCoordsHelper.spatialReference), a(k, k, v), x(F, k);\n    }\n\n    c(this.extent[0].origin, F[0], F[1], F[2]), c(this.extent[1].origin, F[3], F[1], F[2]), c(this.extent[2].origin, F[3], F[4], F[2]), c(this.extent[3].origin, F[0], F[4], F[2]);\n\n    for (let e = 0; e < 4; ++e) a(this.extent[e].origin, this.extent[e].origin, A);\n  }\n\n  toRenderBoundingExtentLocal(t, e) {\n    c(this.extent[0].origin, t[0], t[1], e), c(this.extent[1].origin, t[2], t[1], e), c(this.extent[2].origin, t[2], t[3], e), c(this.extent[3].origin, t[0], t[3], e);\n  }\n\n  toRenderBoundingExtent(e, i, r) {\n    switch (this.renderCoordsHelper.viewingMode) {\n      case 1:\n        this.toRenderBoundingExtentGlobal(e, i, r);\n        break;\n\n      case 2:\n        this.toRenderBoundingExtentLocal(e, r);\n        break;\n\n      default:\n        t(this.renderCoordsHelper.viewingMode);\n    }\n  }\n\n  isVisibleInFrustumGlobal(t) {\n    if (p(this.center.direction, t.direction) < 0) return !0;\n\n    for (let e = 0; e < 4; e++) {\n      const i = this.extent[e];\n      if (p(i.direction, t.direction) < 0) return !0;\n    }\n\n    return !1;\n  }\n\n}\n\nconst G = [{\n  x0: 0,\n  y0: 1,\n  x1: 2,\n  y1: 1\n}, {\n  x0: 0,\n  y0: 3,\n  x1: 2,\n  y1: 3\n}, {\n  x0: 0,\n  y0: 1,\n  x1: 0,\n  y1: 3\n}, {\n  x0: 2,\n  y0: 1,\n  x1: 2,\n  y1: 3\n}],\n      k = h(),\n      A = r(),\n      v = r(),\n      F = u(),\n      I = j();\nexport default E;\nexport { E as FrustumExtentIntersection };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/support/FrustumExtentIntersection.js"],"names":["neverReached","t","lerp","e","a","i","c","r","b","n","o","s","m","d","p","h","computeLinearTransformation","l","projectVectorToVector","getReferenceEllipsoid","empty","g","expandWithVec3","x","create","u","center","f","fromPoints","y","j","fromVectorsAndPoint","R","copy","S","negate","B","wrap","C","frustumLineSegment","H","w","Math","PI","M","E","constructor","renderCoordsHelper","extent","Array","planes","maxSpan","origin","direction","cap","next","planesWithoutFar","slice","update","toRenderBoundingExtent","worldUpAtPosition","max","abs","maxSpanSpatialReference","minGlobalAltitude","radius","isVisibleInFrustum","viewingMode","isGeographic","altitude","isVisibleInFrustumGlobal","intersectsRay","length","intersectsLineSegment","I","lines","endpoint","toRenderBoundingExtentGlobal","k","A","spatialReference","v","F","x0","x1","y0","y1","G","toRenderBoundingExtentLocal","FrustumExtentIntersection"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{neverReached as t}from\"../../../core/compilerUtils.js\";import{lerp as e}from\"../../../core/mathUtils.js\";import{a as i}from\"../../../chunks/mat4.js\";import{c as r}from\"../../../chunks/mat4f64.js\";import{b as n,a as o,r as s,m as a,s as c,d as p}from\"../../../chunks/vec3.js\";import{c as h}from\"../../../chunks/vec3f64.js\";import{computeLinearTransformation as l,projectVectorToVector as d}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as m}from\"../../../geometry/projectionEllipsoid.js\";import{empty as g,expandWithVec3 as x,create as u}from\"../../../geometry/support/aaBoundingBox.js\";import{center as f}from\"../../../geometry/support/aaBoundingRect.js\";import{fromPoints as y,create as j}from\"../../../geometry/support/lineSegment.js\";import{create as b,fromVectorsAndPoint as R,copy as S,negate as B}from\"../../../geometry/support/plane.js\";import{wrap as C}from\"../../../geometry/support/ray.js\";import{frustumLineSegment as H}from\"./intersectionUtils.js\";const w=.5*Math.PI,M=w/Math.PI*180;class E{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:h(),direction:h()};for(let e=0;e<4;e++)this.extent[e]={origin:h(),direction:h(),cap:{next:null,direction:h()}},this.planes[e]=b();this.planes[4]=b(),this.planes[5]=b(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,e,i,r=!0){const a=this.extent;this.toRenderBoundingExtent(t,e,i),n(this.center.origin,a[0].origin,a[2].origin),o(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||o(this.center.direction,this.center.direction,-1);for(let n=0;n<4;n++){const t=a[n];this.renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const e=a[3===n?0:n+1];t.cap.next=e.origin,s(t.cap.direction,t.origin,e.origin),R(t.direction,t.cap.direction,t.origin,this.planes[n]),r||o(t.direction,t.direction,-1)}R(a[0].cap.direction,a[1].cap.direction,a[0].origin,this.planes[4]),r?B(this.planes[4],this.planes[5]):(S(this.planes[4],this.planes[5]),B(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=e,this.minGlobalAltitude=.9*m(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,e,i=!1){if(null==t)return!1;if(1===this.renderCoordsHelper.viewingMode){const i=this.maxSpanSpatialReference.isGeographic?M:w*e;if(this.maxSpan>i)return!0;if(t.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(t)}if(0===this.maxSpan){const e=this.extent[0];return!(i||!t.intersectsRay(C(e.origin,e.direction)))}for(let n=0;n<this.extent.length;n++){const e=this.extent[n];if(!i&&t.intersectsRay(C(e.origin,e.direction)))return!0;if(t.intersectsLineSegment(y(e.origin,e.cap.next,I),e.cap.direction))return!0}const r=i?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const e=t.lines[n];if(H(r,e.origin,e.endpoint,e.direction))return!0}return!1}toRenderBoundingExtentGlobal(t,r,n){const o=5;f(t,k),k[2]=n,l(r,k,A,this.renderCoordsHelper.spatialReference),i(v,A),g(F);for(const{x0:i,x1:s,y0:c,y1:p}of G)for(let h=0;h<o;h++){const l=h/(o-1);k[0]=e(t[i],t[s],l),k[1]=e(t[c],t[p],l),k[2]=n,d(k,r,k,this.renderCoordsHelper.spatialReference),a(k,k,v),x(F,k)}c(this.extent[0].origin,F[0],F[1],F[2]),c(this.extent[1].origin,F[3],F[1],F[2]),c(this.extent[2].origin,F[3],F[4],F[2]),c(this.extent[3].origin,F[0],F[4],F[2]);for(let e=0;e<4;++e)a(this.extent[e].origin,this.extent[e].origin,A)}toRenderBoundingExtentLocal(t,e){c(this.extent[0].origin,t[0],t[1],e),c(this.extent[1].origin,t[2],t[1],e),c(this.extent[2].origin,t[2],t[3],e),c(this.extent[3].origin,t[0],t[3],e)}toRenderBoundingExtent(e,i,r){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(e,i,r);break;case 2:this.toRenderBoundingExtentLocal(e,r);break;default:t(this.renderCoordsHelper.viewingMode)}}isVisibleInFrustumGlobal(t){if(p(this.center.direction,t.direction)<0)return!0;for(let e=0;e<4;e++){const i=this.extent[e];if(p(i.direction,t.direction)<0)return!0}return!1}}const G=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],k=h(),A=r(),v=r(),F=u(),I=j();export default E;export{E as FrustumExtentIntersection};\n"]},"metadata":{},"sourceType":"module"}