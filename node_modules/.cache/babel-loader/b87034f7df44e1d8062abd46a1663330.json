{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isAbortError as e } from \"../../../../core/promiseUtils.js\";\nimport { TilemapCache as t } from \"../../../../layers/support/TilemapCache.js\";\nimport l from \"../../tiling/TileKey.js\";\n\nclass r {\n  constructor(e) {\n    if (e instanceof t) this._tilemapCache = e;else {\n      if (!e || !(\"index\" in e)) throw new Error(\"Invalid tilemap!\");\n      this._tilemap = e.index;\n    }\n  }\n\n  dataKey(t, r) {\n    if (this._tilemapCache) {\n      const {\n        level: i,\n        row: o,\n        col: a\n      } = t,\n            s = new l(t);\n      return this._tilemapCache.fetchAvailabilityUpsample(i, o, a, s, r).then(() => (s.world = t.world, s)).catch(t => {\n        if (e(t)) throw t;\n        return null;\n      });\n    }\n\n    return this._getIndexedDataKey(t);\n  }\n\n  forEach(e, t, l, r, i) {\n    this._callback = i, this._maxLevel = t + e, this._forEach(this._tilemap, t, l, r);\n  }\n\n  _forEach(e, t, l, r) {\n    0 !== e && (this._callback(t, l, r), t !== this._maxLevel && \"object\" == typeof e && (this._forEach(e[0], t + 1, 2 * l, 2 * r), this._forEach(e[1], t + 1, 2 * l, 2 * r + 1), this._forEach(e[2], t + 1, 2 * l + 1, 2 * r), this._forEach(e[3], t + 1, 2 * l + 1, 2 * r + 1)));\n  }\n\n  _getIndexedDataKey(e) {\n    const t = [e];\n    if (e.level < 0 || e.row < 0 || e.col < 0 || e.row >> e.level > 0 || e.col >> e.level > 0) return Promise.resolve(null);\n    let r = e;\n\n    for (; 0 !== r.level;) r = new l(r.level - 1, r.row >> 1, r.col >> 1, r.world), t.push(r);\n\n    let i,\n        o,\n        a = this._tilemap,\n        s = t.pop();\n    if (1 === a) return Promise.resolve(s);\n\n    for (; t.length;) if (i = t.pop(), o = (1 & i.col) + ((1 & i.row) << 1), a) {\n      if (0 === a[o]) {\n        s = null;\n        break;\n      }\n\n      if (1 === a[o]) {\n        s = i;\n        break;\n      }\n\n      s = i, a = a[o];\n    }\n\n    return Promise.resolve(s);\n  }\n\n}\n\nexport default r;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/TileIndex.js"],"names":["isAbortError","e","TilemapCache","t","l","r","constructor","_tilemapCache","Error","_tilemap","index","dataKey","level","i","row","o","col","a","s","fetchAvailabilityUpsample","then","world","catch","_getIndexedDataKey","forEach","_callback","_maxLevel","_forEach","Promise","resolve","push","pop","length"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isAbortError as e}from\"../../../../core/promiseUtils.js\";import{TilemapCache as t}from\"../../../../layers/support/TilemapCache.js\";import l from\"../../tiling/TileKey.js\";class r{constructor(e){if(e instanceof t)this._tilemapCache=e;else{if(!e||!(\"index\"in e))throw new Error(\"Invalid tilemap!\");this._tilemap=e.index}}dataKey(t,r){if(this._tilemapCache){const{level:i,row:o,col:a}=t,s=new l(t);return this._tilemapCache.fetchAvailabilityUpsample(i,o,a,s,r).then((()=>(s.world=t.world,s))).catch((t=>{if(e(t))throw t;return null}))}return this._getIndexedDataKey(t)}forEach(e,t,l,r,i){this._callback=i,this._maxLevel=t+e,this._forEach(this._tilemap,t,l,r)}_forEach(e,t,l,r){0!==e&&(this._callback(t,l,r),t!==this._maxLevel&&\"object\"==typeof e&&(this._forEach(e[0],t+1,2*l,2*r),this._forEach(e[1],t+1,2*l,2*r+1),this._forEach(e[2],t+1,2*l+1,2*r),this._forEach(e[3],t+1,2*l+1,2*r+1)))}_getIndexedDataKey(e){const t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Promise.resolve(null);let r=e;for(;0!==r.level;)r=new l(r.level-1,r.row>>1,r.col>>1,r.world),t.push(r);let i,o,a=this._tilemap,s=t.pop();if(1===a)return Promise.resolve(s);for(;t.length;)if(i=t.pop(),o=(1&i.col)+((1&i.row)<<1),a){if(0===a[o]){s=null;break}if(1===a[o]){s=i;break}s=i,a=a[o]}return Promise.resolve(s)}}export default r;\n"]},"metadata":{},"sourceType":"module"}