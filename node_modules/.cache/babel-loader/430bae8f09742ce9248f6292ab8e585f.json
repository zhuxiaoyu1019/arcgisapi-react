{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Logger.js\";\nimport { isPowerOfTwo as t } from \"../../../../core/mathUtils.js\";\nimport r from \"../../../webgl/Texture.js\";\nconst n = e.getLogger(\"esri.views.3d.webgl-engine.lib.DDSUtil\"),\n      o = 542327876,\n      a = 131072,\n      i = 4;\n\nfunction s(e) {\n  return e.charCodeAt(0) + (e.charCodeAt(1) << 8) + (e.charCodeAt(2) << 16) + (e.charCodeAt(3) << 24);\n}\n\nfunction l(e) {\n  return String.fromCharCode(255 & e, e >> 8 & 255, e >> 16 & 255, e >> 24 & 255);\n}\n\nconst u = s(\"DXT1\"),\n      c = s(\"DXT3\"),\n      m = s(\"DXT5\"),\n      h = 31,\n      p = 0,\n      d = 1,\n      g = 2,\n      f = 3,\n      w = 4,\n      C = 7,\n      x = 20,\n      D = 21;\n\nfunction b(e, t, n) {\n  const {\n    textureData: o,\n    internalFormat: a,\n    width: i,\n    height: s\n  } = A(n, t.hasMipmap);\n  return t.samplingMode = o.levels.length > 1 ? 9987 : 9729, t.hasMipmap = o.levels.length > 1, t.internalFormat = a, t.width = i, t.height = s, new r(e, t, o);\n}\n\nfunction A(e, r) {\n  const s = new Int32Array(e, 0, h);\n  if (s[p] !== o) return n.error(\"Invalid magic number in DDS header\"), null;\n  if (!(s[x] & i)) return n.error(\"Unsupported format, must contain a FourCC code\"), null;\n  const b = s[D];\n  let A, M;\n\n  switch (b) {\n    case u:\n      A = 8, M = 33776;\n      break;\n\n    case c:\n      A = 16, M = 33778;\n      break;\n\n    case m:\n      A = 16, M = 33779;\n      break;\n\n    default:\n      return n.error(\"Unsupported FourCC code:\", l(b)), null;\n  }\n\n  let v = 1,\n      F = s[w],\n      U = s[f];\n  0 == (3 & F) && 0 == (3 & U) || (n.warn(\"Rounding up compressed texture size to nearest multiple of 4.\"), F = F + 3 & -4, U = U + 3 & -4);\n  const T = F,\n        j = U;\n  let k, y;\n  s[g] & a && !1 !== r && (v = Math.max(1, s[C])), 1 === v || t(F) && t(U) || (n.warn(\"Ignoring mipmaps of non power of two sized compressed texture.\"), v = 1);\n  let I = s[d] + 4;\n  const S = [];\n\n  for (let t = 0; t < v; ++t) y = (F + 3 >> 2) * (U + 3 >> 2) * A, k = new Uint8Array(e, I, y), S.push(k), I += y, F = Math.max(1, F >> 1), U = Math.max(1, U >> 1);\n\n  return {\n    textureData: {\n      type: \"compressed\",\n      levels: S\n    },\n    internalFormat: M,\n    width: T,\n    height: j\n  };\n}\n\nexport { b as createDDSTexture, A as createDDSTextureData };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/DDSUtil.js"],"names":["e","isPowerOfTwo","t","r","n","getLogger","o","a","i","s","charCodeAt","l","String","fromCharCode","u","c","m","h","p","d","g","f","w","C","x","D","b","textureData","internalFormat","width","height","A","hasMipmap","samplingMode","levels","length","Int32Array","error","M","v","F","U","warn","T","j","k","y","Math","max","I","S","Uint8Array","push","type","createDDSTexture","createDDSTextureData"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,4BAAb;AAA0C,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,+BAA7B;AAA6D,OAAOC,CAAP,MAAa,2BAAb;AAAyC,MAAMC,CAAC,GAACJ,CAAC,CAACK,SAAF,CAAY,wCAAZ,CAAR;AAAA,MAA8DC,CAAC,GAAC,SAAhE;AAAA,MAA0EC,CAAC,GAAC,MAA5E;AAAA,MAAmFC,CAAC,GAAC,CAArF;;AAAuF,SAASC,CAAT,CAAWT,CAAX,EAAa;AAAC,SAAOA,CAAC,CAACU,UAAF,CAAa,CAAb,KAAiBV,CAAC,CAACU,UAAF,CAAa,CAAb,KAAiB,CAAlC,KAAsCV,CAAC,CAACU,UAAF,CAAa,CAAb,KAAiB,EAAvD,KAA4DV,CAAC,CAACU,UAAF,CAAa,CAAb,KAAiB,EAA7E,CAAP;AAAwF;;AAAA,SAASC,CAAT,CAAWX,CAAX,EAAa;AAAC,SAAOY,MAAM,CAACC,YAAP,CAAoB,MAAIb,CAAxB,EAA0BA,CAAC,IAAE,CAAH,GAAK,GAA/B,EAAmCA,CAAC,IAAE,EAAH,GAAM,GAAzC,EAA6CA,CAAC,IAAE,EAAH,GAAM,GAAnD,CAAP;AAA+D;;AAAA,MAAMc,CAAC,GAACL,CAAC,CAAC,MAAD,CAAT;AAAA,MAAkBM,CAAC,GAACN,CAAC,CAAC,MAAD,CAArB;AAAA,MAA8BO,CAAC,GAACP,CAAC,CAAC,MAAD,CAAjC;AAAA,MAA0CQ,CAAC,GAAC,EAA5C;AAAA,MAA+CC,CAAC,GAAC,CAAjD;AAAA,MAAmDC,CAAC,GAAC,CAArD;AAAA,MAAuDC,CAAC,GAAC,CAAzD;AAAA,MAA2DC,CAAC,GAAC,CAA7D;AAAA,MAA+DC,CAAC,GAAC,CAAjE;AAAA,MAAmEC,CAAC,GAAC,CAArE;AAAA,MAAuEC,CAAC,GAAC,EAAzE;AAAA,MAA4EC,CAAC,GAAC,EAA9E;;AAAiF,SAASC,CAAT,CAAW1B,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,QAAK;AAACuB,IAAAA,WAAW,EAACrB,CAAb;AAAesB,IAAAA,cAAc,EAACrB,CAA9B;AAAgCsB,IAAAA,KAAK,EAACrB,CAAtC;AAAwCsB,IAAAA,MAAM,EAACrB;AAA/C,MAAkDsB,CAAC,CAAC3B,CAAD,EAAGF,CAAC,CAAC8B,SAAL,CAAxD;AAAwE,SAAO9B,CAAC,CAAC+B,YAAF,GAAe3B,CAAC,CAAC4B,MAAF,CAASC,MAAT,GAAgB,CAAhB,GAAkB,IAAlB,GAAuB,IAAtC,EAA2CjC,CAAC,CAAC8B,SAAF,GAAY1B,CAAC,CAAC4B,MAAF,CAASC,MAAT,GAAgB,CAAvE,EAAyEjC,CAAC,CAAC0B,cAAF,GAAiBrB,CAA1F,EAA4FL,CAAC,CAAC2B,KAAF,GAAQrB,CAApG,EAAsGN,CAAC,CAAC4B,MAAF,GAASrB,CAA/G,EAAiH,IAAIN,CAAJ,CAAMH,CAAN,EAAQE,CAAR,EAAUI,CAAV,CAAxH;AAAqI;;AAAA,SAASyB,CAAT,CAAW/B,CAAX,EAAaG,CAAb,EAAe;AAAC,QAAMM,CAAC,GAAC,IAAI2B,UAAJ,CAAepC,CAAf,EAAiB,CAAjB,EAAmBiB,CAAnB,CAAR;AAA8B,MAAGR,CAAC,CAACS,CAAD,CAAD,KAAOZ,CAAV,EAAY,OAAOF,CAAC,CAACiC,KAAF,CAAQ,oCAAR,GAA8C,IAArD;AAA0D,MAAG,EAAE5B,CAAC,CAACe,CAAD,CAAD,GAAKhB,CAAP,CAAH,EAAa,OAAOJ,CAAC,CAACiC,KAAF,CAAQ,gDAAR,GAA0D,IAAjE;AAAsE,QAAMX,CAAC,GAACjB,CAAC,CAACgB,CAAD,CAAT;AAAa,MAAIM,CAAJ,EAAMO,CAAN;;AAAQ,UAAOZ,CAAP;AAAU,SAAKZ,CAAL;AAAOiB,MAAAA,CAAC,GAAC,CAAF,EAAIO,CAAC,GAAC,KAAN;AAAY;;AAAM,SAAKvB,CAAL;AAAOgB,MAAAA,CAAC,GAAC,EAAF,EAAKO,CAAC,GAAC,KAAP;AAAa;;AAAM,SAAKtB,CAAL;AAAOe,MAAAA,CAAC,GAAC,EAAF,EAAKO,CAAC,GAAC,KAAP;AAAa;;AAAM;AAAQ,aAAOlC,CAAC,CAACiC,KAAF,CAAQ,0BAAR,EAAmC1B,CAAC,CAACe,CAAD,CAApC,GAAyC,IAAhD;AAA/F;;AAAoJ,MAAIa,CAAC,GAAC,CAAN;AAAA,MAAQC,CAAC,GAAC/B,CAAC,CAACa,CAAD,CAAX;AAAA,MAAemB,CAAC,GAAChC,CAAC,CAACY,CAAD,CAAlB;AAAsB,QAAI,IAAEmB,CAAN,KAAU,MAAI,IAAEC,CAAN,CAAV,KAAqBrC,CAAC,CAACsC,IAAF,CAAO,+DAAP,GAAwEF,CAAC,GAACA,CAAC,GAAC,CAAF,GAAI,CAAC,CAA/E,EAAiFC,CAAC,GAACA,CAAC,GAAC,CAAF,GAAI,CAAC,CAA7G;AAAgH,QAAME,CAAC,GAACH,CAAR;AAAA,QAAUI,CAAC,GAACH,CAAZ;AAAc,MAAII,CAAJ,EAAMC,CAAN;AAAQrC,EAAAA,CAAC,CAACW,CAAD,CAAD,GAAKb,CAAL,IAAQ,CAAC,CAAD,KAAKJ,CAAb,KAAiBoC,CAAC,GAACQ,IAAI,CAACC,GAAL,CAAS,CAAT,EAAWvC,CAAC,CAACc,CAAD,CAAZ,CAAnB,GAAqC,MAAIgB,CAAJ,IAAOrC,CAAC,CAACsC,CAAD,CAAD,IAAMtC,CAAC,CAACuC,CAAD,CAAd,KAAoBrC,CAAC,CAACsC,IAAF,CAAO,gEAAP,GAAyEH,CAAC,GAAC,CAA/F,CAArC;AAAuI,MAAIU,CAAC,GAACxC,CAAC,CAACU,CAAD,CAAD,GAAK,CAAX;AAAa,QAAM+B,CAAC,GAAC,EAAR;;AAAW,OAAI,IAAIhD,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACqC,CAAd,EAAgB,EAAErC,CAAlB,EAAoB4C,CAAC,GAAC,CAACN,CAAC,GAAC,CAAF,IAAK,CAAN,KAAUC,CAAC,GAAC,CAAF,IAAK,CAAf,IAAkBV,CAApB,EAAsBc,CAAC,GAAC,IAAIM,UAAJ,CAAenD,CAAf,EAAiBiD,CAAjB,EAAmBH,CAAnB,CAAxB,EAA8CI,CAAC,CAACE,IAAF,CAAOP,CAAP,CAA9C,EAAwDI,CAAC,IAAEH,CAA3D,EAA6DN,CAAC,GAACO,IAAI,CAACC,GAAL,CAAS,CAAT,EAAWR,CAAC,IAAE,CAAd,CAA/D,EAAgFC,CAAC,GAACM,IAAI,CAACC,GAAL,CAAS,CAAT,EAAWP,CAAC,IAAE,CAAd,CAAlF;;AAAmG,SAAM;AAACd,IAAAA,WAAW,EAAC;AAAC0B,MAAAA,IAAI,EAAC,YAAN;AAAmBnB,MAAAA,MAAM,EAACgB;AAA1B,KAAb;AAA0CtB,IAAAA,cAAc,EAACU,CAAzD;AAA2DT,IAAAA,KAAK,EAACc,CAAjE;AAAmEb,IAAAA,MAAM,EAACc;AAA1E,GAAN;AAAmF;;AAAA,SAAOlB,CAAC,IAAI4B,gBAAZ,EAA6BvB,CAAC,IAAIwB,oBAAlC","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Logger.js\";import{isPowerOfTwo as t}from\"../../../../core/mathUtils.js\";import r from\"../../../webgl/Texture.js\";const n=e.getLogger(\"esri.views.3d.webgl-engine.lib.DDSUtil\"),o=542327876,a=131072,i=4;function s(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function l(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const u=s(\"DXT1\"),c=s(\"DXT3\"),m=s(\"DXT5\"),h=31,p=0,d=1,g=2,f=3,w=4,C=7,x=20,D=21;function b(e,t,n){const{textureData:o,internalFormat:a,width:i,height:s}=A(n,t.hasMipmap);return t.samplingMode=o.levels.length>1?9987:9729,t.hasMipmap=o.levels.length>1,t.internalFormat=a,t.width=i,t.height=s,new r(e,t,o)}function A(e,r){const s=new Int32Array(e,0,h);if(s[p]!==o)return n.error(\"Invalid magic number in DDS header\"),null;if(!(s[x]&i))return n.error(\"Unsupported format, must contain a FourCC code\"),null;const b=s[D];let A,M;switch(b){case u:A=8,M=33776;break;case c:A=16,M=33778;break;case m:A=16,M=33779;break;default:return n.error(\"Unsupported FourCC code:\",l(b)),null}let v=1,F=s[w],U=s[f];0==(3&F)&&0==(3&U)||(n.warn(\"Rounding up compressed texture size to nearest multiple of 4.\"),F=F+3&-4,U=U+3&-4);const T=F,j=U;let k,y;s[g]&a&&!1!==r&&(v=Math.max(1,s[C])),1===v||t(F)&&t(U)||(n.warn(\"Ignoring mipmaps of non power of two sized compressed texture.\"),v=1);let I=s[d]+4;const S=[];for(let t=0;t<v;++t)y=(F+3>>2)*(U+3>>2)*A,k=new Uint8Array(e,I,y),S.push(k),I+=y,F=Math.max(1,F>>1),U=Math.max(1,U>>1);return{textureData:{type:\"compressed\",levels:S},internalFormat:M,width:T,height:j}}export{b as createDDSTexture,A as createDDSTextureData};\n"]},"metadata":{},"sourceType":"module"}