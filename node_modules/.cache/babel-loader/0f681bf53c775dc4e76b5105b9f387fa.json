{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { TILE_SIZE as i } from \"./definitions.js\";\nimport { Point as t } from \"./Geometry.js\";\nimport { between as s } from \"./GeometryUtils.js\";\n\nclass h {\n  constructor(i, t, s) {\n    this.ratio = i, this.x = t, this.y = s;\n  }\n\n}\n\nclass n {\n  constructor(t, s, h, n = 8, e = 8) {\n    this.lines = [], this.starts = [], this.validateTessellation = !0, this.pixelRatio = n, this.pixelMargin = e, this.tileSize = i * n, this.dz = t, this.yPos = s, this.xPos = h;\n  }\n\n  setPixelMargin(i) {\n    i !== this.pixelMargin && (this.pixelMargin = i, this.setExtent(this._extent));\n  }\n\n  setExtent(i) {\n    this._extent = i, this.finalRatio = this.tileSize / i * (1 << this.dz);\n    let t = this.pixelRatio * this.pixelMargin;\n    t /= this.finalRatio;\n    const s = i >> this.dz;\n    t > s && (t = s), this.margin = t, this.xmin = s * this.xPos - t, this.ymin = s * this.yPos - t, this.xmax = this.xmin + s + 2 * t, this.ymax = this.ymin + s + 2 * t;\n  }\n\n  reset(i) {\n    this.type = i, this.lines = [], this.starts = [], this.line = null, this.start = 0;\n  }\n\n  moveTo(i, s) {\n    this._pushLine(), this._prevIsIn = this._isIn(i, s), this._moveTo(i, s, this._prevIsIn), this._prevPt = new t(i, s), this._firstPt = new t(i, s), this._dist = 0;\n  }\n\n  lineTo(i, s) {\n    const n = this._isIn(i, s),\n          e = new t(i, s),\n          l = t.distance(this._prevPt, e);\n\n    let x, a, y, r, o, m, p, u;\n    if (n) this._prevIsIn ? this._lineTo(i, s, !0) : (x = this._prevPt, a = e, y = this._intersect(a, x), this.start = this._dist + l * (1 - this._r), this._lineTo(y.x, y.y, !0), this._lineTo(a.x, a.y, !0));else if (this._prevIsIn) a = this._prevPt, x = e, y = this._intersect(a, x), this._lineTo(y.x, y.y, !0), this._lineTo(x.x, x.y, !1);else {\n      const i = this._prevPt,\n            t = e;\n      if (i.x <= this.xmin && t.x <= this.xmin || i.x >= this.xmax && t.x >= this.xmax || i.y <= this.ymin && t.y <= this.ymin || i.y >= this.ymax && t.y >= this.ymax) this._lineTo(t.x, t.y, !1);else {\n        const s = [];\n        if ((i.x < this.xmin && t.x > this.xmin || i.x > this.xmin && t.x < this.xmin) && (r = (this.xmin - i.x) / (t.x - i.x), u = i.y + r * (t.y - i.y), u <= this.ymin ? m = !1 : u >= this.ymax ? m = !0 : s.push(new h(r, this.xmin, u))), (i.x < this.xmax && t.x > this.xmax || i.x > this.xmax && t.x < this.xmax) && (r = (this.xmax - i.x) / (t.x - i.x), u = i.y + r * (t.y - i.y), u <= this.ymin ? m = !1 : u >= this.ymax ? m = !0 : s.push(new h(r, this.xmax, u))), (i.y < this.ymin && t.y > this.ymin || i.y > this.ymin && t.y < this.ymin) && (r = (this.ymin - i.y) / (t.y - i.y), p = i.x + r * (t.x - i.x), p <= this.xmin ? o = !1 : p >= this.xmax ? o = !0 : s.push(new h(r, p, this.ymin))), (i.y < this.ymax && t.y > this.ymax || i.y > this.ymax && t.y < this.ymax) && (r = (this.ymax - i.y) / (t.y - i.y), p = i.x + r * (t.x - i.x), p <= this.xmin ? o = !1 : p >= this.xmax ? o = !0 : s.push(new h(r, p, this.ymax))), 0 === s.length) o ? m ? this._lineTo(this.xmax, this.ymax, !0) : this._lineTo(this.xmax, this.ymin, !0) : m ? this._lineTo(this.xmin, this.ymax, !0) : this._lineTo(this.xmin, this.ymin, !0);else if (s.length > 1 && s[0].ratio > s[1].ratio) this.start = this._dist + l * s[1].ratio, this._lineTo(s[1].x, s[1].y, !0), this._lineTo(s[0].x, s[0].y, !0);else {\n          this.start = this._dist + l * s[0].ratio;\n\n          for (let i = 0; i < s.length; i++) this._lineTo(s[i].x, s[i].y, !0);\n        }\n\n        this._lineTo(t.x, t.y, !1);\n      }\n    }\n    this._dist += l, this._prevIsIn = n, this._prevPt = e;\n  }\n\n  close() {\n    if (this.line.length > 2) {\n      const i = this._firstPt,\n            t = this._prevPt;\n      i.x === t.x && i.y === t.y || this.lineTo(i.x, i.y);\n      const s = this.line;\n      let h = s.length;\n\n      for (; h >= 4 && (s[0].x === s[1].x && s[0].x === s[h - 2].x || s[0].y === s[1].y && s[0].y === s[h - 2].y);) s.pop(), s[0].x = s[h - 2].x, s[0].y = s[h - 2].y, --h;\n    }\n  }\n\n  result(i = !0) {\n    return this._pushLine(), 0 === this.lines.length ? null : (3 === this.type && i && l.simplify(this.tileSize, this.margin * this.finalRatio, this.lines), this.lines);\n  }\n\n  resultWithStarts() {\n    if (2 !== this.type) throw new Error(\"Only valid for lines\");\n\n    this._pushLine();\n\n    const i = this.lines,\n          t = i.length;\n    if (0 === t) return null;\n    const s = [];\n\n    for (let h = 0; h < t; h++) s.push({\n      line: i[h],\n      start: this.starts[h] || 0\n    });\n\n    return s;\n  }\n\n  _isIn(i, t) {\n    return i >= this.xmin && i <= this.xmax && t >= this.ymin && t <= this.ymax;\n  }\n\n  _intersect(i, s) {\n    let h, n, e;\n    if (s.x >= this.xmin && s.x <= this.xmax) n = s.y <= this.ymin ? this.ymin : this.ymax, e = (n - i.y) / (s.y - i.y), h = i.x + e * (s.x - i.x);else if (s.y >= this.ymin && s.y <= this.ymax) h = s.x <= this.xmin ? this.xmin : this.xmax, e = (h - i.x) / (s.x - i.x), n = i.y + e * (s.y - i.y);else {\n      n = s.y <= this.ymin ? this.ymin : this.ymax, h = s.x <= this.xmin ? this.xmin : this.xmax;\n      const t = (h - i.x) / (s.x - i.x),\n            l = (n - i.y) / (s.y - i.y);\n      t < l ? (e = t, n = i.y + t * (s.y - i.y)) : (e = l, h = i.x + l * (s.x - i.x));\n    }\n    return this._r = e, new t(h, n);\n  }\n\n  _pushLine() {\n    this.line && (1 === this.type ? this.line.length > 0 && (this.lines.push(this.line), this.starts.push(this.start)) : 2 === this.type ? this.line.length > 1 && (this.lines.push(this.line), this.starts.push(this.start)) : 3 === this.type && this.line.length > 3 && (this.lines.push(this.line), this.starts.push(this.start))), this.line = [], this.start = 0;\n  }\n\n  _moveTo(i, s, h) {\n    3 !== this.type ? h && (i = Math.round((i - (this.xmin + this.margin)) * this.finalRatio), s = Math.round((s - (this.ymin + this.margin)) * this.finalRatio), this.line.push(new t(i, s))) : (h || (i < this.xmin && (i = this.xmin), i > this.xmax && (i = this.xmax), s < this.ymin && (s = this.ymin), s > this.ymax && (s = this.ymax)), i = Math.round((i - (this.xmin + this.margin)) * this.finalRatio), s = Math.round((s - (this.ymin + this.margin)) * this.finalRatio), this.line.push(new t(i, s)), this._is_h = !1, this._is_v = !1);\n  }\n\n  _lineTo(i, s, h) {\n    let n, e;\n    if (3 !== this.type) {\n      if (h) {\n        if (i = Math.round((i - (this.xmin + this.margin)) * this.finalRatio), s = Math.round((s - (this.ymin + this.margin)) * this.finalRatio), this.line.length > 0 && (n = this.line[this.line.length - 1], n.equals(i, s))) return;\n        this.line.push(new t(i, s));\n      } else this.line && this.line.length > 0 && this._pushLine();\n    } else if (h || (i < this.xmin && (i = this.xmin), i > this.xmax && (i = this.xmax), s < this.ymin && (s = this.ymin), s > this.ymax && (s = this.ymax)), i = Math.round((i - (this.xmin + this.margin)) * this.finalRatio), s = Math.round((s - (this.ymin + this.margin)) * this.finalRatio), this.line && this.line.length > 0) {\n      n = this.line[this.line.length - 1];\n      const h = n.x === i,\n            l = n.y === s;\n      if (h && l) return;\n      this._is_h && h || this._is_v && l ? (n.x = i, n.y = s, e = this.line[this.line.length - 2], e.x === i && e.y === s ? (this.line.pop(), this.line.length <= 1 ? (this._is_h = !1, this._is_v = !1) : (e = this.line[this.line.length - 2], this._is_h = e.x === i, this._is_v = e.y === s)) : (this._is_h = e.x === i, this._is_v = e.y === s)) : (this.line.push(new t(i, s)), this._is_h = h, this._is_v = l);\n    } else this.line.push(new t(i, s));\n  }\n\n}\n\nclass e {\n  setExtent(i) {\n    this._ratio = 4096 === i ? 1 : 4096 / i;\n  }\n\n  get validateTessellation() {\n    return this._ratio < 1;\n  }\n\n  reset(i) {\n    this.lines = [], this.line = null;\n  }\n\n  moveTo(i, s) {\n    this.line && this.lines.push(this.line), this.line = [];\n    const h = this._ratio;\n    this.line.push(new t(i * h, s * h));\n  }\n\n  lineTo(i, s) {\n    const h = this._ratio;\n    this.line.push(new t(i * h, s * h));\n  }\n\n  close() {\n    const i = this.line;\n    i && !i[0].isEqual(i[i.length - 1]) && i.push(i[0]);\n  }\n\n  result() {\n    return this.line && this.lines.push(this.line), 0 === this.lines.length ? null : this.lines;\n  }\n\n}\n\nclass l {\n  static simplify(i, t, s) {\n    if (!s) return;\n    const h = -t,\n          n = i + t,\n          e = -t,\n          x = i + t,\n          a = [],\n          y = [],\n          r = s.length;\n\n    for (let l = 0; l < r; ++l) {\n      const i = s[l];\n      if (!i || i.length < 2) continue;\n      let t,\n          r = i[0];\n      const o = i.length;\n\n      for (let s = 1; s < o; ++s) t = i[s], r.x === t.x && (r.x <= h && (r.y > t.y ? (a.push(l), a.push(s), a.push(0), a.push(-1)) : (y.push(l), y.push(s), y.push(0), y.push(-1))), r.x >= n && (r.y < t.y ? (a.push(l), a.push(s), a.push(1), a.push(-1)) : (y.push(l), y.push(s), y.push(1), y.push(-1)))), r.y === t.y && (r.y <= e && (r.x < t.x ? (a.push(l), a.push(s), a.push(2), a.push(-1)) : (y.push(l), y.push(s), y.push(2), y.push(-1))), r.y >= x && (r.x > t.x ? (a.push(l), a.push(s), a.push(3), a.push(-1)) : (y.push(l), y.push(s), y.push(3), y.push(-1)))), r = t;\n    }\n\n    if (0 === a.length || 0 === y.length) return;\n    l.fillParent(s, y, a), l.fillParent(s, a, y);\n    const o = [];\n    l.calcDeltas(o, y, a), l.calcDeltas(o, a, y), l.addDeltas(o, s);\n  }\n\n  static fillParent(i, t, h) {\n    const n = h.length,\n          e = t.length;\n\n    for (let l = 0; l < e; l += 4) {\n      const e = t[l],\n            x = t[l + 1],\n            a = t[l + 2],\n            y = i[e][x - 1],\n            r = i[e][x];\n      let o = 8092,\n          m = -1;\n\n      for (let t = 0; t < n; t += 4) {\n        if (h[t + 2] !== a) continue;\n        const n = h[t],\n              e = h[t + 1],\n              l = i[n][e - 1],\n              x = i[n][e];\n\n        switch (a) {\n          case 0:\n          case 1:\n            if (s(y.y, l.y, x.y) && s(r.y, l.y, x.y)) {\n              const i = Math.abs(x.y - l.y);\n              i < o && (o = i, m = t);\n            }\n\n            break;\n\n          case 2:\n          case 3:\n            if (s(y.x, l.x, x.x) && s(r.x, l.x, x.x)) {\n              const i = Math.abs(x.x - l.x);\n              i < o && (o = i, m = t);\n            }\n\n        }\n      }\n\n      t[l + 3] = m;\n    }\n  }\n\n  static calcDeltas(i, t, s) {\n    const h = t.length;\n\n    for (let n = 0; n < h; n += 4) {\n      const h = [],\n            e = l.calcDelta(n, t, s, h);\n      i.push(t[n]), i.push(t[n + 1]), i.push(t[n + 2]), i.push(e);\n    }\n  }\n\n  static calcDelta(i, t, s, h) {\n    const n = t[i + 3];\n    if (-1 === n) return 0;\n    const e = h.length;\n    return e > 1 && h[e - 2] === n ? 0 : (h.push(n), l.calcDelta(n, s, t, h) + 1);\n  }\n\n  static addDeltas(i, t) {\n    const s = i.length;\n    let h = 0;\n\n    for (let n = 0; n < s; n += 4) {\n      const t = i[n + 3];\n      t > h && (h = t);\n    }\n\n    for (let n = 0; n < s; n += 4) {\n      const s = t[i[n]],\n            e = i[n + 1],\n            l = h - i[n + 3];\n\n      switch (i[n + 2]) {\n        case 0:\n          s[e - 1].x -= l, s[e].x -= l, 1 === e && (s[s.length - 1].x -= l), e === s.length - 1 && (s[0].x -= l);\n          break;\n\n        case 1:\n          s[e - 1].x += l, s[e].x += l, 1 === e && (s[s.length - 1].x += l), e === s.length - 1 && (s[0].x += l);\n          break;\n\n        case 2:\n          s[e - 1].y -= l, s[e].y -= l, 1 === e && (s[s.length - 1].y -= l), e === s.length - 1 && (s[0].y -= l);\n          break;\n\n        case 3:\n          s[e - 1].y += l, s[e].y += l, 1 === e && (s[s.length - 1].y += l), e === s.length - 1 && (s[0].y += l);\n      }\n    }\n  }\n\n}\n\nexport { e as SimpleBuilder, n as TileClipper };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/TileClipper.js"],"names":["TILE_SIZE","i","Point","t","between","s","h","constructor","ratio","x","y","n","e","lines","starts","validateTessellation","pixelRatio","pixelMargin","tileSize","dz","yPos","xPos","setPixelMargin","setExtent","_extent","finalRatio","margin","xmin","ymin","xmax","ymax","reset","type","line","start","moveTo","_pushLine","_prevIsIn","_isIn","_moveTo","_prevPt","_firstPt","_dist","lineTo","l","distance","a","r","o","m","p","u","_lineTo","_intersect","_r","push","length","close","pop","result","simplify","resultWithStarts","Error","Math","round","_is_h","_is_v","equals","_ratio","isEqual","fillParent","calcDeltas","addDeltas","abs","calcDelta","SimpleBuilder","TileClipper"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{TILE_SIZE as i}from\"./definitions.js\";import{Point as t}from\"./Geometry.js\";import{between as s}from\"./GeometryUtils.js\";class h{constructor(i,t,s){this.ratio=i,this.x=t,this.y=s}}class n{constructor(t,s,h,n=8,e=8){this.lines=[],this.starts=[],this.validateTessellation=!0,this.pixelRatio=n,this.pixelMargin=e,this.tileSize=i*n,this.dz=t,this.yPos=s,this.xPos=h}setPixelMargin(i){i!==this.pixelMargin&&(this.pixelMargin=i,this.setExtent(this._extent))}setExtent(i){this._extent=i,this.finalRatio=this.tileSize/i*(1<<this.dz);let t=this.pixelRatio*this.pixelMargin;t/=this.finalRatio;const s=i>>this.dz;t>s&&(t=s),this.margin=t,this.xmin=s*this.xPos-t,this.ymin=s*this.yPos-t,this.xmax=this.xmin+s+2*t,this.ymax=this.ymin+s+2*t}reset(i){this.type=i,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(i,s){this._pushLine(),this._prevIsIn=this._isIn(i,s),this._moveTo(i,s,this._prevIsIn),this._prevPt=new t(i,s),this._firstPt=new t(i,s),this._dist=0}lineTo(i,s){const n=this._isIn(i,s),e=new t(i,s),l=t.distance(this._prevPt,e);let x,a,y,r,o,m,p,u;if(n)this._prevIsIn?this._lineTo(i,s,!0):(x=this._prevPt,a=e,y=this._intersect(a,x),this.start=this._dist+l*(1-this._r),this._lineTo(y.x,y.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,x=e,y=this._intersect(a,x),this._lineTo(y.x,y.y,!0),this._lineTo(x.x,x.y,!1);else{const i=this._prevPt,t=e;if(i.x<=this.xmin&&t.x<=this.xmin||i.x>=this.xmax&&t.x>=this.xmax||i.y<=this.ymin&&t.y<=this.ymin||i.y>=this.ymax&&t.y>=this.ymax)this._lineTo(t.x,t.y,!1);else{const s=[];if((i.x<this.xmin&&t.x>this.xmin||i.x>this.xmin&&t.x<this.xmin)&&(r=(this.xmin-i.x)/(t.x-i.x),u=i.y+r*(t.y-i.y),u<=this.ymin?m=!1:u>=this.ymax?m=!0:s.push(new h(r,this.xmin,u))),(i.x<this.xmax&&t.x>this.xmax||i.x>this.xmax&&t.x<this.xmax)&&(r=(this.xmax-i.x)/(t.x-i.x),u=i.y+r*(t.y-i.y),u<=this.ymin?m=!1:u>=this.ymax?m=!0:s.push(new h(r,this.xmax,u))),(i.y<this.ymin&&t.y>this.ymin||i.y>this.ymin&&t.y<this.ymin)&&(r=(this.ymin-i.y)/(t.y-i.y),p=i.x+r*(t.x-i.x),p<=this.xmin?o=!1:p>=this.xmax?o=!0:s.push(new h(r,p,this.ymin))),(i.y<this.ymax&&t.y>this.ymax||i.y>this.ymax&&t.y<this.ymax)&&(r=(this.ymax-i.y)/(t.y-i.y),p=i.x+r*(t.x-i.x),p<=this.xmin?o=!1:p>=this.xmax?o=!0:s.push(new h(r,p,this.ymax))),0===s.length)o?m?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):m?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(s.length>1&&s[0].ratio>s[1].ratio)this.start=this._dist+l*s[1].ratio,this._lineTo(s[1].x,s[1].y,!0),this._lineTo(s[0].x,s[0].y,!0);else{this.start=this._dist+l*s[0].ratio;for(let i=0;i<s.length;i++)this._lineTo(s[i].x,s[i].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=l,this._prevIsIn=n,this._prevPt=e}close(){if(this.line.length>2){const i=this._firstPt,t=this._prevPt;i.x===t.x&&i.y===t.y||this.lineTo(i.x,i.y);const s=this.line;let h=s.length;for(;h>=4&&(s[0].x===s[1].x&&s[0].x===s[h-2].x||s[0].y===s[1].y&&s[0].y===s[h-2].y);)s.pop(),s[0].x=s[h-2].x,s[0].y=s[h-2].y,--h}}result(i=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&i&&l.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error(\"Only valid for lines\");this._pushLine();const i=this.lines,t=i.length;if(0===t)return null;const s=[];for(let h=0;h<t;h++)s.push({line:i[h],start:this.starts[h]||0});return s}_isIn(i,t){return i>=this.xmin&&i<=this.xmax&&t>=this.ymin&&t<=this.ymax}_intersect(i,s){let h,n,e;if(s.x>=this.xmin&&s.x<=this.xmax)n=s.y<=this.ymin?this.ymin:this.ymax,e=(n-i.y)/(s.y-i.y),h=i.x+e*(s.x-i.x);else if(s.y>=this.ymin&&s.y<=this.ymax)h=s.x<=this.xmin?this.xmin:this.xmax,e=(h-i.x)/(s.x-i.x),n=i.y+e*(s.y-i.y);else{n=s.y<=this.ymin?this.ymin:this.ymax,h=s.x<=this.xmin?this.xmin:this.xmax;const t=(h-i.x)/(s.x-i.x),l=(n-i.y)/(s.y-i.y);t<l?(e=t,n=i.y+t*(s.y-i.y)):(e=l,h=i.x+l*(s.x-i.x))}return this._r=e,new t(h,n)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(i,s,h){3!==this.type?h&&(i=Math.round((i-(this.xmin+this.margin))*this.finalRatio),s=Math.round((s-(this.ymin+this.margin))*this.finalRatio),this.line.push(new t(i,s))):(h||(i<this.xmin&&(i=this.xmin),i>this.xmax&&(i=this.xmax),s<this.ymin&&(s=this.ymin),s>this.ymax&&(s=this.ymax)),i=Math.round((i-(this.xmin+this.margin))*this.finalRatio),s=Math.round((s-(this.ymin+this.margin))*this.finalRatio),this.line.push(new t(i,s)),this._is_h=!1,this._is_v=!1)}_lineTo(i,s,h){let n,e;if(3!==this.type)if(h){if(i=Math.round((i-(this.xmin+this.margin))*this.finalRatio),s=Math.round((s-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(n=this.line[this.line.length-1],n.equals(i,s)))return;this.line.push(new t(i,s))}else this.line&&this.line.length>0&&this._pushLine();else if(h||(i<this.xmin&&(i=this.xmin),i>this.xmax&&(i=this.xmax),s<this.ymin&&(s=this.ymin),s>this.ymax&&(s=this.ymax)),i=Math.round((i-(this.xmin+this.margin))*this.finalRatio),s=Math.round((s-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){n=this.line[this.line.length-1];const h=n.x===i,l=n.y===s;if(h&&l)return;this._is_h&&h||this._is_v&&l?(n.x=i,n.y=s,e=this.line[this.line.length-2],e.x===i&&e.y===s?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(e=this.line[this.line.length-2],this._is_h=e.x===i,this._is_v=e.y===s)):(this._is_h=e.x===i,this._is_v=e.y===s)):(this.line.push(new t(i,s)),this._is_h=h,this._is_v=l)}else this.line.push(new t(i,s))}}class e{setExtent(i){this._ratio=4096===i?1:4096/i}get validateTessellation(){return this._ratio<1}reset(i){this.lines=[],this.line=null}moveTo(i,s){this.line&&this.lines.push(this.line),this.line=[];const h=this._ratio;this.line.push(new t(i*h,s*h))}lineTo(i,s){const h=this._ratio;this.line.push(new t(i*h,s*h))}close(){const i=this.line;i&&!i[0].isEqual(i[i.length-1])&&i.push(i[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:this.lines}}class l{static simplify(i,t,s){if(!s)return;const h=-t,n=i+t,e=-t,x=i+t,a=[],y=[],r=s.length;for(let l=0;l<r;++l){const i=s[l];if(!i||i.length<2)continue;let t,r=i[0];const o=i.length;for(let s=1;s<o;++s)t=i[s],r.x===t.x&&(r.x<=h&&(r.y>t.y?(a.push(l),a.push(s),a.push(0),a.push(-1)):(y.push(l),y.push(s),y.push(0),y.push(-1))),r.x>=n&&(r.y<t.y?(a.push(l),a.push(s),a.push(1),a.push(-1)):(y.push(l),y.push(s),y.push(1),y.push(-1)))),r.y===t.y&&(r.y<=e&&(r.x<t.x?(a.push(l),a.push(s),a.push(2),a.push(-1)):(y.push(l),y.push(s),y.push(2),y.push(-1))),r.y>=x&&(r.x>t.x?(a.push(l),a.push(s),a.push(3),a.push(-1)):(y.push(l),y.push(s),y.push(3),y.push(-1)))),r=t}if(0===a.length||0===y.length)return;l.fillParent(s,y,a),l.fillParent(s,a,y);const o=[];l.calcDeltas(o,y,a),l.calcDeltas(o,a,y),l.addDeltas(o,s)}static fillParent(i,t,h){const n=h.length,e=t.length;for(let l=0;l<e;l+=4){const e=t[l],x=t[l+1],a=t[l+2],y=i[e][x-1],r=i[e][x];let o=8092,m=-1;for(let t=0;t<n;t+=4){if(h[t+2]!==a)continue;const n=h[t],e=h[t+1],l=i[n][e-1],x=i[n][e];switch(a){case 0:case 1:if(s(y.y,l.y,x.y)&&s(r.y,l.y,x.y)){const i=Math.abs(x.y-l.y);i<o&&(o=i,m=t)}break;case 2:case 3:if(s(y.x,l.x,x.x)&&s(r.x,l.x,x.x)){const i=Math.abs(x.x-l.x);i<o&&(o=i,m=t)}}}t[l+3]=m}}static calcDeltas(i,t,s){const h=t.length;for(let n=0;n<h;n+=4){const h=[],e=l.calcDelta(n,t,s,h);i.push(t[n]),i.push(t[n+1]),i.push(t[n+2]),i.push(e)}}static calcDelta(i,t,s,h){const n=t[i+3];if(-1===n)return 0;const e=h.length;return e>1&&h[e-2]===n?0:(h.push(n),l.calcDelta(n,s,t,h)+1)}static addDeltas(i,t){const s=i.length;let h=0;for(let n=0;n<s;n+=4){const t=i[n+3];t>h&&(h=t)}for(let n=0;n<s;n+=4){const s=t[i[n]],e=i[n+1],l=h-i[n+3];switch(i[n+2]){case 0:s[e-1].x-=l,s[e].x-=l,1===e&&(s[s.length-1].x-=l),e===s.length-1&&(s[0].x-=l);break;case 1:s[e-1].x+=l,s[e].x+=l,1===e&&(s[s.length-1].x+=l),e===s.length-1&&(s[0].x+=l);break;case 2:s[e-1].y-=l,s[e].y-=l,1===e&&(s[s.length-1].y-=l),e===s.length-1&&(s[0].y-=l);break;case 3:s[e-1].y+=l,s[e].y+=l,1===e&&(s[s.length-1].y+=l),e===s.length-1&&(s[0].y+=l)}}}}export{e as SimpleBuilder,n as TileClipper};\n"]},"metadata":{},"sourceType":"module"}