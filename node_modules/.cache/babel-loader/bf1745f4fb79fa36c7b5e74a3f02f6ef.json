{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../global.js\";\nimport t from \"./RemoteClient.js\";\nimport { MessageType as r, receiveMessage as s } from \"./utils.js\";\n\nclass n {\n  constructor() {\n    const e = document.createDocumentFragment();\n    [\"addEventListener\", \"dispatchEvent\", \"removeEventListener\"].forEach(t => {\n      this[t] = (...r) => e[t](...r);\n    });\n  }\n\n}\n\nconst o = e.MutationObserver || e.WebKitMutationObserver,\n      a = function () {\n  let t;\n  if (e.process && e.process.nextTick) t = t => {\n    e.process.nextTick(t);\n  };else if (e.Promise) t = t => {\n    e.Promise.resolve().then(t);\n  };else if (o) {\n    const e = [],\n          r = document.createElement(\"div\");\n    new o(() => {\n      for (; e.length > 0;) e.shift()();\n    }).observe(r, {\n      attributes: !0\n    }), t = t => {\n      e.push(t), r.setAttribute(\"queueStatus\", \"1\");\n    };\n  }\n  return t;\n}(),\n      i = (() => {\n  const t = e.MessageEvent;\n\n  try {\n    new t(\"message\", {\n      data: null\n    });\n  } catch {\n    return (e, t = {}) => {\n      const {\n        data: r,\n        bubbles: s = !1,\n        cancelable: n = !1\n      } = t,\n            o = document.createEvent(\"Event\");\n      return o.initEvent(e, s, n), o.data = r, o;\n    };\n  }\n\n  return (e, r) => new t(e, r);\n})();\n\nclass d {\n  constructor() {\n    this._dispatcher = new n(), this._workerPostMessage({\n      type: r.HANDSHAKE\n    });\n  }\n\n  terminate() {}\n\n  get onmessage() {\n    return this._onmessageHandler;\n  }\n\n  set onmessage(e) {\n    this._onmessageHandler && this.removeEventListener(\"message\", this._onmessageHandler), this._onmessageHandler = e, e && this.addEventListener(\"message\", e);\n  }\n\n  get onmessageerror() {\n    return this._onmessageerrorHandler;\n  }\n\n  set onmessageerror(e) {\n    this._onmessageerrorHandler && this.removeEventListener(\"messageerror\", this._onmessageerrorHandler), this._onmessageerrorHandler = e, e && this.addEventListener(\"messageerror\", e);\n  }\n\n  get onerror() {\n    return this._onerrorHandler;\n  }\n\n  set onerror(e) {\n    this._onerrorHandler && this.removeEventListener(\"error\", this._onerrorHandler), this._onerrorHandler = e, e && this.addEventListener(\"error\", e);\n  }\n\n  postMessage(e) {\n    a(() => {\n      this._workerMessageHandler(i(\"message\", {\n        data: e\n      }));\n    });\n  }\n\n  dispatchEvent(e) {\n    return this._dispatcher.dispatchEvent(e);\n  }\n\n  addEventListener(e, t, r) {\n    this._dispatcher.addEventListener(e, t, r);\n  }\n\n  removeEventListener(e, t, r) {\n    this._dispatcher.removeEventListener(e, t, r);\n  }\n\n  _workerPostMessage(e) {\n    a(() => {\n      this.dispatchEvent(i(\"message\", {\n        data: e\n      }));\n    });\n  }\n\n  async _workerMessageHandler(e) {\n    const n = s(e);\n\n    if (n && n.type === r.OPEN) {\n      const {\n        modulePath: e,\n        jobId: s\n      } = n;\n      let o = await t.loadWorker(e);\n      o || (o = await import(\n      /* @vite-ignore */\n\n      /* webpackIgnore: true */\n      e));\n      const a = t.connect(o);\n\n      this._workerPostMessage({\n        type: r.OPENED,\n        jobId: s,\n        data: a\n      });\n    }\n  }\n\n}\n\nexport default d;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/core/workers/WorkerFallback.js"],"names":["e","t","MessageType","r","receiveMessage","s","n","constructor","document","createDocumentFragment","forEach","o","MutationObserver","WebKitMutationObserver","a","process","nextTick","Promise","resolve","then","createElement","length","shift","observe","attributes","push","setAttribute","i","MessageEvent","data","bubbles","cancelable","createEvent","initEvent","d","_dispatcher","_workerPostMessage","type","HANDSHAKE","terminate","onmessage","_onmessageHandler","removeEventListener","addEventListener","onmessageerror","_onmessageerrorHandler","onerror","_onerrorHandler","postMessage","_workerMessageHandler","dispatchEvent","OPEN","modulePath","jobId","loadWorker","connect","OPENED"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../global.js\";import t from\"./RemoteClient.js\";import{MessageType as r,receiveMessage as s}from\"./utils.js\";class n{constructor(){const e=document.createDocumentFragment();[\"addEventListener\",\"dispatchEvent\",\"removeEventListener\"].forEach((t=>{this[t]=(...r)=>e[t](...r)}))}}const o=e.MutationObserver||e.WebKitMutationObserver,a=function(){let t;if(e.process&&e.process.nextTick)t=t=>{e.process.nextTick(t)};else if(e.Promise)t=t=>{e.Promise.resolve().then(t)};else if(o){const e=[],r=document.createElement(\"div\");new o((()=>{for(;e.length>0;)e.shift()()})).observe(r,{attributes:!0}),t=t=>{e.push(t),r.setAttribute(\"queueStatus\",\"1\")}}return t}(),i=(()=>{const t=e.MessageEvent;try{new t(\"message\",{data:null})}catch{return(e,t={})=>{const{data:r,bubbles:s=!1,cancelable:n=!1}=t,o=document.createEvent(\"Event\");return o.initEvent(e,s,n),o.data=r,o}}return(e,r)=>new t(e,r)})();class d{constructor(){this._dispatcher=new n,this._workerPostMessage({type:r.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener(\"message\",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener(\"message\",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener(\"messageerror\",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener(\"messageerror\",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener(\"error\",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener(\"error\",e)}postMessage(e){a((()=>{this._workerMessageHandler(i(\"message\",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){a((()=>{this.dispatchEvent(i(\"message\",{data:e}))}))}async _workerMessageHandler(e){const n=s(e);if(n&&n.type===r.OPEN){const{modulePath:e,jobId:s}=n;let o=await t.loadWorker(e);o||(o=await import(\n/* @vite-ignore */\n/* webpackIgnore: true */\ne));const a=t.connect(o);this._workerPostMessage({type:r.OPENED,jobId:s,data:a})}}}export default d;\n"]},"metadata":{},"sourceType":"module"}