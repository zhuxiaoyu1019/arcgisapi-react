{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../core/Error.js\";\nimport { isAborted as e, createAbortError as a } from \"../../../core/promiseUtils.js\";\nimport { Z as n } from \"../../../chunks/Zlib.js\";\n\nclass i {\n  constructor(t) {\n    t && (this.canvas = t.canvas, this.ctx = t.ctx || t.canvas && t.canvas.getContext(\"2d\"));\n  }\n\n  decode(n, r, s) {\n    if (!n || n.byteLength < 10) throw new t(\"imagecanvasdecoder: decode\", \"required a valid encoded data as input.\");\n    let {\n      width: c,\n      height: h,\n      format: o\n    } = r;\n    const {\n      applyJpegMask: d\n    } = r;\n    if (d && (!c || !h)) throw new t(\"imagecanvasdecoder: decode\", \"image width and height are needed to apply jpeg mask directly to canvas\");\n    return new Promise((t, l) => {\n      let g = null;\n      \"jpg\" === o && d && (g = i.getMask(n, {\n        width: c,\n        height: h\n      }));\n      const w = new Blob([new Uint8Array(n)], {\n        type: \"image/\" + o == \"jpg\" ? \"jpeg\" : o\n      }),\n            v = URL.createObjectURL(w),\n            m = new Image();\n      let p;\n      m.src = v, m.onload = () => {\n        if (URL.revokeObjectURL(v), e(s)) return void l(a());\n        c = m.width, h = m.height, this.canvas ? (this.canvas.width === c && this.canvas.height === h || (this.canvas.width = c, this.canvas.height = h), this.ctx.clearRect(0, 0, c, h)) : (this.canvas = document.createElement(\"canvas\"), this.canvas.width = c, this.canvas.height = h, this.ctx = this.canvas.getContext(\"2d\")), this.ctx.drawImage(m, 0, 0);\n        const n = this.ctx.getImageData(0, 0, c, h);\n        let i;\n\n        if (p = n.data, r.renderOnCanvas) {\n          if (g) for (i = 0; i < g.length; i++) g[i] ? p[4 * i + 3] = 255 : p[4 * i + 3] = 0;\n          return this.ctx.putImageData(n, 0, 0), void t(null);\n        }\n\n        const o = c * h,\n              d = new Uint8Array(o),\n              w = new Uint8Array(o),\n              f = new Uint8Array(o);\n        if (g) for (i = 0; i < o; i++) d[i] = p[4 * i], w[i] = p[4 * i + 1], f[i] = p[4 * i + 2];else for (g = new Uint8Array(o), i = 0; i < o; i++) d[i] = p[4 * i], w[i] = p[4 * i + 1], f[i] = p[4 * i + 2], g[i] = p[4 * i + 3];\n        t({\n          width: c,\n          height: h,\n          pixels: [d, w, f],\n          mask: g,\n          pixelType: \"u8\"\n        });\n      }, m.onerror = () => {\n        URL.revokeObjectURL(v), l(\"cannot load image\");\n      };\n    });\n  }\n\n  static getMask(t, e) {\n    let a = null;\n\n    try {\n      const i = new Uint8Array(t),\n            r = Math.ceil(i.length / 2);\n      let s = 0;\n      const c = i.length - 2;\n\n      for (s = r; s < c && (255 !== i[s] || 217 !== i[s + 1]); s++);\n\n      if (s += 2, s < i.length - 1) {\n        const t = new n(i.subarray(s)).getBytes();\n        a = new Uint8Array(e.width * e.height);\n        let r = 0;\n\n        for (let e = 0; e < t.length; e++) for (let n = 7; n >= 0; n--) a[r++] = t[e] >> n & 1;\n      }\n    } catch (i) {}\n\n    return a;\n  }\n\n}\n\nexport default i;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/support/rasterFormats/ImageCanvasDecoder.js"],"names":["t","isAborted","e","createAbortError","a","Z","n","i","constructor","canvas","ctx","getContext","decode","r","s","byteLength","width","c","height","h","format","o","applyJpegMask","d","Promise","l","g","getMask","w","Blob","Uint8Array","type","v","URL","createObjectURL","m","Image","p","src","onload","revokeObjectURL","clearRect","document","createElement","drawImage","getImageData","data","renderOnCanvas","length","putImageData","f","pixels","mask","pixelType","onerror","Math","ceil","subarray","getBytes"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../core/Error.js\";import{isAborted as e,createAbortError as a}from\"../../../core/promiseUtils.js\";import{Z as n}from\"../../../chunks/Zlib.js\";class i{constructor(t){t&&(this.canvas=t.canvas,this.ctx=t.ctx||t.canvas&&t.canvas.getContext(\"2d\"))}decode(n,r,s){if(!n||n.byteLength<10)throw new t(\"imagecanvasdecoder: decode\",\"required a valid encoded data as input.\");let{width:c,height:h,format:o}=r;const{applyJpegMask:d}=r;if(d&&(!c||!h))throw new t(\"imagecanvasdecoder: decode\",\"image width and height are needed to apply jpeg mask directly to canvas\");return new Promise(((t,l)=>{let g=null;\"jpg\"===o&&d&&(g=i.getMask(n,{width:c,height:h}));const w=new Blob([new Uint8Array(n)],{type:\"image/\"+o==\"jpg\"?\"jpeg\":o}),v=URL.createObjectURL(w),m=new Image;let p;m.src=v,m.onload=()=>{if(URL.revokeObjectURL(v),e(s))return void l(a());c=m.width,h=m.height,this.canvas?(this.canvas.width===c&&this.canvas.height===h||(this.canvas.width=c,this.canvas.height=h),this.ctx.clearRect(0,0,c,h)):(this.canvas=document.createElement(\"canvas\"),this.canvas.width=c,this.canvas.height=h,this.ctx=this.canvas.getContext(\"2d\")),this.ctx.drawImage(m,0,0);const n=this.ctx.getImageData(0,0,c,h);let i;if(p=n.data,r.renderOnCanvas){if(g)for(i=0;i<g.length;i++)g[i]?p[4*i+3]=255:p[4*i+3]=0;return this.ctx.putImageData(n,0,0),void t(null)}const o=c*h,d=new Uint8Array(o),w=new Uint8Array(o),f=new Uint8Array(o);if(g)for(i=0;i<o;i++)d[i]=p[4*i],w[i]=p[4*i+1],f[i]=p[4*i+2];else for(g=new Uint8Array(o),i=0;i<o;i++)d[i]=p[4*i],w[i]=p[4*i+1],f[i]=p[4*i+2],g[i]=p[4*i+3];t({width:c,height:h,pixels:[d,w,f],mask:g,pixelType:\"u8\"})},m.onerror=()=>{URL.revokeObjectURL(v),l(\"cannot load image\")}}))}static getMask(t,e){let a=null;try{const i=new Uint8Array(t),r=Math.ceil(i.length/2);let s=0;const c=i.length-2;for(s=r;s<c&&(255!==i[s]||217!==i[s+1]);s++);if(s+=2,s<i.length-1){const t=new n(i.subarray(s)).getBytes();a=new Uint8Array(e.width*e.height);let r=0;for(let e=0;e<t.length;e++)for(let n=7;n>=0;n--)a[r++]=t[e]>>n&1}}catch(i){}return a}}export default i;\n"]},"metadata":{},"sourceType":"module"}