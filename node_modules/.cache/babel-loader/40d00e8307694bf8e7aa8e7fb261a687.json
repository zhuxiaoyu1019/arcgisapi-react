{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../../chunks/tslib.es6.js\";\nimport { asinClamped as i } from \"../../../../../core/mathUtils.js\";\nimport { createScreenPointArray as e, screenPointObjectToArray as n } from \"../../../../../core/screenUtils.js\";\nimport { property as o } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as s } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { o as r, g as a, d as m, a as h, f as c, n as l, b as p } from \"../../../../../chunks/vec3.js\";\nimport { c as u, f as d } from \"../../../../../chunks/vec3f64.js\";\nimport { wrapAxisAngle as g } from \"../../../../../geometry/support/axisAngle.js\";\nimport { create as C, fromNormalAndOffset as v, setOffsetFromPoint as M, negate as f, normal as b } from \"../../../../../geometry/support/plane.js\";\nimport { disableContextNavigation as w } from \"../../../../../support/featureFlags.js\";\nimport { pixelDistanceToInteractionFactor as S, applyAll as V } from \"../../../camera/constraintUtils.js\";\nimport { ExponentialFalloff as P } from \"../../../input/util.js\";\nimport { InteractiveController as j } from \"../InteractiveController.js\";\nimport { PanPlanarMomentumController as E } from \"../momentum/PanPlanarMomentumController.js\";\nimport { RotationMomentumController as z } from \"../momentum/RotationMomentumController.js\";\nimport { ZoomPlanarMomentumController as H } from \"../momentum/ZoomPlanarMomentumController.js\";\nimport { NavigationMode as O, centroid as y, applyZoomToPoint as F, applyPanPlanar as T, normalizeRotationDelta as x, applyRotation as A, intersectPlaneFromScreenPoint as R } from \"../../utils/navigationUtils.js\";\nimport L from \"../../../webgl-engine/lib/Camera.js\";\nimport { PanPlanarMomentumEstimator as D } from \"../../../../navigation/PanPlanarMomentumEstimator.js\";\nimport { RotationMomentumEstimator as _ } from \"../../../../navigation/RotationMomentumEstimator.js\";\nimport { ZoomMomentumEstimator as k } from \"../../../../navigation/ZoomMomentumEstimator.js\";\nconst I = d(0, 0, 1),\n      U = {\n  ELEVATION_THRESHOLD: 3e4,\n  ANGLE_THRESHOLD: 16 / 180 * Math.PI\n},\n      G = 80;\nlet N = class extends j {\n  constructor(t) {\n    super(t), this.view = null, this.rotationValueSmooth = new P(.05), this.scalingValueSmooth = new P(.05), this.planeHorizontal = C(), this.planeVertical = C(), this.rotationMomentumEstimator = new _(), this.panMomentumEstimator = new D(300, 12, .9), this.zoomMomentumEstimator = new k(), this.beginCenter = u(), this.tmpPoints = [], this.beginCenterScreen = e(), this.tmpCentroid3d = u(), this.tmpCentroid2d = e(), this.tmp2d = e(), this.constraintOptions = {\n      selection: 15,\n      interactionType: 0,\n      interactionFactor: 0,\n      interactionStartCamera: new L(),\n      interactionDirection: null,\n      tiltMode: 0\n    };\n  }\n\n  get intersectionHelper() {\n    return this.view.sceneIntersectionHelper;\n  }\n\n  begin(t) {\n    if (!this.active) return;\n    const e = this.view.navigation.momentumEnabled;\n    this.zoomMomentumEstimator.enabled = e, this.rotationMomentumEstimator.enabled = e, this.panMomentumEstimator.enabled = e, this.beginRadius = t.radius, this.pointerCount = t.pointers.size, this.beginAngle = t.angle, this.rotationValueSmooth.reset(), this.scalingValueSmooth.reset(), n(t.center, this.beginCenterScreen), v(I, 0, this.planeHorizontal);\n    const o = u();\n    this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen, o);\n    const s = u();\n    r(s, this.startCamera.viewForward);\n    const d = u();\n    a(d, I);\n    const g = m(s, d),\n          C = i(g < 0 ? -g : g);\n\n    if (this.panMode = C >= U.ANGLE_THRESHOLD ? O.Horizontal : O.Vertical, M(this.planeHorizontal, o, this.planeHorizontal), this.startCamera.aboveGround || f(this.planeHorizontal, this.planeHorizontal), this.panMode === O.Vertical) {\n      if (h(d, d, g), c(this.planeVertical, s, d), l(this.planeVertical, this.planeVertical), M(this.planeVertical, o, this.planeVertical), !w()) {\n        const t = u(),\n              i = u(),\n              e = u();\n        c(t, o, this.currentCamera.eye), l(t, t);\n\n        const n = 5 * Math.max(Math.abs(this.view.camera.position.z), 50),\n              s = this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0], this.beginCenterScreen[1], this.view.state.camera, G),\n              r = s ? Math.min(s, n) : n;\n\n        a(e, p(i, this.currentCamera.eye, h(i, t, r))), this.planeVertical[3] = -m(this.planeVertical, e);\n      }\n\n      this.computePlanePoints(t.pointers, this.planeVertical, this.startCamera, this.tmpPoints), y(this.tmpPoints, this.beginCenter);\n    } else this.computePlanePoints(t.pointers, this.planeHorizontal, this.startCamera, this.tmpPoints), y(this.tmpPoints, this.beginCenter);\n\n    this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera);\n  }\n\n  update(t) {\n    if (!this.active) return;\n    this.currentCamera.copyFrom(this.startCamera);\n    const i = t.pointers.size > 1,\n          e = this.panMode === O.Horizontal ? this.planeHorizontal : this.planeVertical,\n          o = this.beginCenter;\n\n    if (i) {\n      const i = this.beginRadius / t.radius,\n            e = .001875 * Math.min(Math.max(t.radius, 40), 120);\n      this.scalingValueSmooth.gain = e, this.scalingValueSmooth.update(i), F(this.currentCamera, o, this.scalingValueSmooth.value, this.view.state.constraints.minimumPoiDistance), this.zoomMomentumEstimator.add(this.scalingValueSmooth.value, .001 * t.timestamp), this.constraintOptions.interactionType = 1, this.constraintOptions.interactionFactor = S(Math.abs(t.radius - this.beginRadius)), V(this.view, this.currentCamera, this.constraintOptions);\n    }\n\n    if (this.computePlanePoints(t.pointers, e, this.currentCamera, this.tmpPoints), y(this.tmpPoints, this.tmpCentroid3d), n(t.center, this.tmpCentroid2d), T(this.currentCamera, o, this.tmpCentroid3d), this.panMomentumEstimator.add(this.tmpCentroid2d, this.tmpCentroid3d, .001 * t.timestamp), this.constraintOptions.interactionType = 4, this.constraintOptions.interactionFactor = S(this.beginCenterScreen, this.tmpCentroid2d), V(this.view, this.currentCamera, this.constraintOptions), i) {\n      const i = this.planeHorizontal,\n            e = o,\n            n = this.rotationValueSmooth.value,\n            s = n + x(t.angle - n),\n            r = .00125 * Math.min(Math.max(t.radius, 40), 120);\n      this.rotationValueSmooth.gain = r, this.rotationValueSmooth.update(s);\n      const a = this.rotationValueSmooth.value - this.beginAngle;\n      this.rotationMomentumEstimator.add(a, .001 * t.timestamp), A(this.currentCamera, e, g(i, a)), this.constraintOptions.interactionType = 2, this.constraintOptions.interactionFactor = S(Math.abs(t.radius * a)), V(this.view, this.currentCamera, this.constraintOptions);\n    }\n  }\n\n  end(t) {\n    t.pointers.size === this.pointerCount && this.update(t), this.finishController();\n    const i = this.zoomMomentumEstimator.evaluateMomentum();\n    if (i) return new H({\n      view: this.view,\n      momentum: i,\n      zoomCenter: this.beginCenter\n    });\n    const e = this.rotationMomentumEstimator.evaluateMomentum();\n    if (e) return new z({\n      view: this.view,\n      momentum: e,\n      center: this.beginCenter,\n      axis: b(this.planeHorizontal)\n    });\n    const n = this.panMomentumEstimator.evaluateMomentum();\n    return n ? new E({\n      view: this.view,\n      momentum: n\n    }) : null;\n  }\n\n  computePlanePoints(t, i, e, n) {\n    n.length = t.size;\n    const o = this.tmp2d;\n    let s = 0;\n    return t.forEach(t => {\n      o[0] = t.x, o[1] = t.y, void 0 === n[s] && (n[s] = u()), R(i, e, o, n[s]), s += 1;\n    }), n;\n  }\n\n};\nt([o({\n  constructOnly: !0\n})], N.prototype, \"view\", void 0), N = t([s(\"esri.views.3d.state.controllers.local.PinchAndPanController\")], N);\nexport { N as PinchAndPanController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/state/controllers/local/PinchAndPanController.js"],"names":["_","t","asinClamped","i","createScreenPointArray","e","screenPointObjectToArray","n","property","o","subclass","s","r","g","a","d","m","h","f","c","l","b","p","u","wrapAxisAngle","create","C","fromNormalAndOffset","v","setOffsetFromPoint","M","negate","normal","disableContextNavigation","w","pixelDistanceToInteractionFactor","S","applyAll","V","ExponentialFalloff","P","InteractiveController","j","PanPlanarMomentumController","E","RotationMomentumController","z","ZoomPlanarMomentumController","H","NavigationMode","O","centroid","y","applyZoomToPoint","F","applyPanPlanar","T","normalizeRotationDelta","x","applyRotation","A","intersectPlaneFromScreenPoint","R","L","PanPlanarMomentumEstimator","D","RotationMomentumEstimator","ZoomMomentumEstimator","k","I","U","ELEVATION_THRESHOLD","ANGLE_THRESHOLD","Math","PI","G","N","constructor","view","rotationValueSmooth","scalingValueSmooth","planeHorizontal","planeVertical","rotationMomentumEstimator","panMomentumEstimator","zoomMomentumEstimator","beginCenter","tmpPoints","beginCenterScreen","tmpCentroid3d","tmpCentroid2d","tmp2d","constraintOptions","selection","interactionType","interactionFactor","interactionStartCamera","interactionDirection","tiltMode","intersectionHelper","sceneIntersectionHelper","begin","active","navigation","momentumEnabled","enabled","beginRadius","radius","pointerCount","pointers","size","beginAngle","angle","reset","center","intersectScreenFreePointFallback","startCamera","viewForward","panMode","Horizontal","Vertical","aboveGround","currentCamera","eye","max","abs","camera","position","_stage","renderView","getMinimalDepthForArea","state","min","computePlanePoints","copyFrom","update","gain","value","constraints","minimumPoiDistance","add","timestamp","end","finishController","evaluateMomentum","momentum","zoomCenter","axis","length","forEach","constructOnly","prototype","PinchAndPanController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../../chunks/tslib.es6.js\";import{asinClamped as i}from\"../../../../../core/mathUtils.js\";import{createScreenPointArray as e,screenPointObjectToArray as n}from\"../../../../../core/screenUtils.js\";import{property as o}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as s}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{o as r,g as a,d as m,a as h,f as c,n as l,b as p}from\"../../../../../chunks/vec3.js\";import{c as u,f as d}from\"../../../../../chunks/vec3f64.js\";import{wrapAxisAngle as g}from\"../../../../../geometry/support/axisAngle.js\";import{create as C,fromNormalAndOffset as v,setOffsetFromPoint as M,negate as f,normal as b}from\"../../../../../geometry/support/plane.js\";import{disableContextNavigation as w}from\"../../../../../support/featureFlags.js\";import{pixelDistanceToInteractionFactor as S,applyAll as V}from\"../../../camera/constraintUtils.js\";import{ExponentialFalloff as P}from\"../../../input/util.js\";import{InteractiveController as j}from\"../InteractiveController.js\";import{PanPlanarMomentumController as E}from\"../momentum/PanPlanarMomentumController.js\";import{RotationMomentumController as z}from\"../momentum/RotationMomentumController.js\";import{ZoomPlanarMomentumController as H}from\"../momentum/ZoomPlanarMomentumController.js\";import{NavigationMode as O,centroid as y,applyZoomToPoint as F,applyPanPlanar as T,normalizeRotationDelta as x,applyRotation as A,intersectPlaneFromScreenPoint as R}from\"../../utils/navigationUtils.js\";import L from\"../../../webgl-engine/lib/Camera.js\";import{PanPlanarMomentumEstimator as D}from\"../../../../navigation/PanPlanarMomentumEstimator.js\";import{RotationMomentumEstimator as _}from\"../../../../navigation/RotationMomentumEstimator.js\";import{ZoomMomentumEstimator as k}from\"../../../../navigation/ZoomMomentumEstimator.js\";const I=d(0,0,1),U={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},G=80;let N=class extends j{constructor(t){super(t),this.view=null,this.rotationValueSmooth=new P(.05),this.scalingValueSmooth=new P(.05),this.planeHorizontal=C(),this.planeVertical=C(),this.rotationMomentumEstimator=new _,this.panMomentumEstimator=new D(300,12,.9),this.zoomMomentumEstimator=new k,this.beginCenter=u(),this.tmpPoints=[],this.beginCenterScreen=e(),this.tmpCentroid3d=u(),this.tmpCentroid2d=e(),this.tmp2d=e(),this.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new L,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;const e=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=e,this.rotationMomentumEstimator.enabled=e,this.panMomentumEstimator.enabled=e,this.beginRadius=t.radius,this.pointerCount=t.pointers.size,this.beginAngle=t.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),n(t.center,this.beginCenterScreen),v(I,0,this.planeHorizontal);const o=u();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,o);const s=u();r(s,this.startCamera.viewForward);const d=u();a(d,I);const g=m(s,d),C=i(g<0?-g:g);if(this.panMode=C>=U.ANGLE_THRESHOLD?O.Horizontal:O.Vertical,M(this.planeHorizontal,o,this.planeHorizontal),this.startCamera.aboveGround||f(this.planeHorizontal,this.planeHorizontal),this.panMode===O.Vertical){if(h(d,d,g),c(this.planeVertical,s,d),l(this.planeVertical,this.planeVertical),M(this.planeVertical,o,this.planeVertical),!w()){const t=u(),i=u(),e=u();c(t,o,this.currentCamera.eye),l(t,t);const n=5*Math.max(Math.abs(this.view.camera.position.z),50),s=this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,G),r=s?Math.min(s,n):n;a(e,p(i,this.currentCamera.eye,h(i,t,r))),this.planeVertical[3]=-m(this.planeVertical,e)}this.computePlanePoints(t.pointers,this.planeVertical,this.startCamera,this.tmpPoints),y(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(t.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),y(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(t){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=t.pointers.size>1,e=this.panMode===O.Horizontal?this.planeHorizontal:this.planeVertical,o=this.beginCenter;if(i){const i=this.beginRadius/t.radius,e=.001875*Math.min(Math.max(t.radius,40),120);this.scalingValueSmooth.gain=e,this.scalingValueSmooth.update(i),F(this.currentCamera,o,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*t.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=S(Math.abs(t.radius-this.beginRadius)),V(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(t.pointers,e,this.currentCamera,this.tmpPoints),y(this.tmpPoints,this.tmpCentroid3d),n(t.center,this.tmpCentroid2d),T(this.currentCamera,o,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*t.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=S(this.beginCenterScreen,this.tmpCentroid2d),V(this.view,this.currentCamera,this.constraintOptions),i){const i=this.planeHorizontal,e=o,n=this.rotationValueSmooth.value,s=n+x(t.angle-n),r=.00125*Math.min(Math.max(t.radius,40),120);this.rotationValueSmooth.gain=r,this.rotationValueSmooth.update(s);const a=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(a,.001*t.timestamp),A(this.currentCamera,e,g(i,a)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=S(Math.abs(t.radius*a)),V(this.view,this.currentCamera,this.constraintOptions)}}end(t){t.pointers.size===this.pointerCount&&this.update(t),this.finishController();const i=this.zoomMomentumEstimator.evaluateMomentum();if(i)return new H({view:this.view,momentum:i,zoomCenter:this.beginCenter});const e=this.rotationMomentumEstimator.evaluateMomentum();if(e)return new z({view:this.view,momentum:e,center:this.beginCenter,axis:b(this.planeHorizontal)});const n=this.panMomentumEstimator.evaluateMomentum();return n?new E({view:this.view,momentum:n}):null}computePlanePoints(t,i,e,n){n.length=t.size;const o=this.tmp2d;let s=0;return t.forEach((t=>{o[0]=t.x,o[1]=t.y,void 0===n[s]&&(n[s]=u()),R(i,e,o,n[s]),s+=1})),n}};t([o({constructOnly:!0})],N.prototype,\"view\",void 0),N=t([s(\"esri.views.3d.state.controllers.local.PinchAndPanController\")],N);export{N as PinchAndPanController};\n"]},"metadata":{},"sourceType":"module"}