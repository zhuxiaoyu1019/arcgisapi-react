{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Handles.js\";\nimport { someMap as r } from \"../../../../core/MapUtils.js\";\nimport { destroyMaybe as t, disposeMaybe as s, isSome as n, isNone as i, unwrap as a } from \"../../../../core/maybe.js\";\nimport h from \"../../../../core/TimeProfiler.js\";\nimport { init as d } from \"../../../../core/watchUtils.js\";\nimport { f as o, t as l, a as c, m as p } from \"../../../../chunks/mat4.js\";\nimport { c as _ } from \"../../../../chunks/mat4f64.js\";\nimport { a as g } from \"../../../../chunks/vec2f64.js\";\nimport u from \"../../support/debugFlags.js\";\nimport { RenderPassManager as m } from \"../core/renderPasses/RenderPassManager.js\";\nimport { BoundingInfo as f } from \"./BoundingInfo.js\";\nimport { ZERO as T, union as x } from \"./depthRange.js\";\nimport { depthRangeFromScene as R } from \"./depthRangeUtils.js\";\nimport { createEmptyDepthTexture as b } from \"./glUtil3D.js\";\nimport w from \"./HighlightHelper.js\";\nimport { materialPredicate as C } from \"./Material.js\";\nimport { OffscreenRendering as P } from \"./OffscreenRendering.js\";\nimport { RenderContext as H } from \"./RenderContext.js\";\nimport { splitRenderGeometryChangeSetByMaterial as y } from \"./rendererUtils.js\";\nimport { RenderPluginManager as S } from \"./RenderPluginManager.js\";\nimport { ShadowAccumulator as M } from \"./ShadowAccumulator.js\";\nimport { ShadowHighlightHelper as D } from \"./ShadowHighlightHelper.js\";\nimport E from \"./ShadowMap.js\";\nimport v from \"./SliceHelper.js\";\nimport { SmaaRenderPass as O } from \"./SmaaRenderPass.js\";\nimport I from \"./SSAOHelper.js\";\nimport { EdgeView as A } from \"./edgeRendering/EdgeView.js\";\nimport { SceneLighting as q } from \"../lighting/SceneLighting.js\";\nimport G from \"../materials/renderers/MergedRenderer.js\";\nimport { RendererPerformanceInfo as L } from \"../statistics/RendererPerformanceInfo.js\";\nimport { startMeasurement as j } from \"../../../webgl/Measurement.js\";\n\nclass F {\n  constructor(r, t, s, n, i, a, h, o, l) {\n    this._materialRep = r, this._shaderTechniqueRepository = s, this._rctx = n, this._compositingHelper = i, this._magnifierHelper = a, this.requestRender = h, this._stage = l, this._materialRenderers = new Map(), this._hasHighlights = !1, this._hasOccludees = !1, this._hasWater = !1, this._hasOverlayWater = !1, this._content = new Map(), this._isRendering = !1, this._fallbackDepthStencilTexture = null, this.performanceInfo = new L(), this._antialiasing = 1, this._oitEnabled = !1, this._multipassTerrain = !0, this._opaqueTerrain = !0, this._lighting = new q(), this._handles = new e(), this.renderHiddenTransparentEdges = () => {}, this._smaaPass = new O(this._rctx, s), this._oitEnabled = this._hasOITSupport, this.requestRender(), this._offscreenRendering = new P(this._rctx, this._compositingHelper), this._sliceHelper = new v(), this._shadowMap = new E(this._rctx, l.viewingMode, 2), this._ssaoHelper = new I(s, this._rctx, () => this.requestRender()), this._highlightHelper = new w(s, this._rctx), this._shadowHighlightHelper = new D(this._rctx, l.viewingMode), this._shadowAccumulator = new M(this._rctx, s, l, (e, r) => {\n      this.renderPassManager.shadowCastingEnabled = !0, this._renderPlugins.prepareRender(e, r), this.renderPassManager.shadowCastingEnabled = this._shadowMap.enabled;\n    }, (e, r, t, s) => {\n      e.start(t, r, s), this.renderShadowCascades(4, e), t.setGLViewport(this._rctx), this.ensureCameraBindParameters(t);\n    }, () => this.requestRender()), this._bindParameters = {\n      slot: null,\n      camera: null,\n      inverseViewport: g(),\n      shadowMap: this._shadowMap,\n      shadowMappingEnabled: this._shadowMap.enabled,\n      ssaoHelper: this._ssaoHelper,\n      ssaoEnabled: this._ssaoHelper.enabled,\n      origin: null,\n      screenToWorldRatio: null,\n      screenToWorldRatioGlobalWM: null,\n      slicePlane: this._sliceHelper.plane,\n      highlightDepthTexture: null,\n      hasOccludees: !1,\n      linearDepthTexture: null,\n      terrainLinearDepthTexture: null,\n      geometryLinearDepthTexture: null,\n      multipassTerrainEnabled: !1,\n      multipassGeometryEnabled: !1,\n      cullAboveGround: !1,\n      lastFrameColorTexture: null,\n      reprojectionMat: null,\n      ssrEnabled: !1,\n      lighting: this._lighting,\n      highlightColorTexture: null\n    }, this._renderContext = new H(this._rctx, this._offscreenRendering, this._lighting, this._shadowMap, this._ssaoHelper, this._sliceHelper), this._renderContext.multipassTerrainParams = {\n      camera: null,\n      multipassTerrainEnabled: !1,\n      cullAboveGround: !1,\n      terrainLinearDepthTexture: null\n    }, this._renderContext.multipassGeometryParams = {\n      multipassGeometryEnabled: !1,\n      geometryLinearDepthTexture: null\n    }, this._renderContext.ssrParams = {\n      camera: null,\n      linearDepthTexture: null,\n      lastFrameColorTexture: null,\n      reprojectionMat: null,\n      ssrEnabled: !1\n    }, this._renderPlugins = new S({\n      renderContext: this._renderContext,\n      shaderTechniqueRep: s,\n      textureRep: t,\n      materialRep: this._materialRep,\n      requestRender: this.requestRender,\n      schedule: o\n    }), this.renderPassManager = new m(this._rctx, this._shaderTechniqueRepository), this._renderPlugins.add(this.renderPassManager.slots(), this.renderPassManager), this._handles.add([d(u, \"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES\", e => {\n      this.renderHiddenTransparentEdges = e ? () => this.renderEdges(1) : () => {}, this.requestRender();\n    }), d(this._stage, \"camera\", () => this.requestRender(), !0)]);\n  }\n\n  get hasWater() {\n    return this._hasWater || this._hasOverlayWater;\n  }\n\n  get hasWaterReflection() {\n    return this.hasWater && this._waterReflectionEnabled;\n  }\n\n  dispose() {\n    this._handles.destroy(), this._smaaPass.disable(), this._materialRenderers.forEach(e => e.dispose()), this._materialRenderers.clear(), this._edgeView = t(this._edgeView), this._offscreenRendering.dispose(), this._fallbackDepthStencilTexture = s(this._fallbackDepthStencilTexture), this._shadowMap.enabled = !1, this._shadowMap.dispose(), this._ssaoHelper.enabled = !1, this._ssaoHelper.dispose(), this._highlightHelper.dispose(), this._shadowHighlightHelper.dispose(), this._shadowAccumulator.dispose(), f.prune(), this._content.clear();\n  }\n\n  get updating() {\n    return 1 === this._antialiasing && this._smaaPass.isLoadingResources || n(this._edgeView) && this._edgeView.updating || this._shadowAccumulator.running || !this.isCameraFinal;\n  }\n\n  ensureEdgeView() {\n    return i(this._edgeView) && (this._edgeView = new A({\n      rctx: this._rctx,\n      renderSR: this._stage.renderSR,\n      techniqueRepository: this._shaderTechniqueRepository,\n      setNeedsRender: () => this.requestRender(),\n      schedule: e => this._stage.resourceController.schedule(e)\n    }), this._handles.add(this._edgeView.watch(\"updating\", () => this.requestRender(), !0)), this.requestRender()), this._edgeView;\n  }\n\n  get edgeView() {\n    return this._edgeView;\n  }\n\n  get isCameraFinal() {\n    return null === this._bindParameters.reprojectionMat || o(this._bindParameters.reprojectionMat, Q);\n  }\n\n  get hasShadowsEnabled() {\n    var e;\n    return !(null == (e = this._shadowMap) || !e.enabled);\n  }\n\n  setRenderParameters(e) {\n    const {\n      renderPassManager: r,\n      _shadowMap: t,\n      _ssaoHelper: s\n    } = this;\n    void 0 !== e.screenSpaceReflectionsEnabled && r.screenSpaceReflectionsEnabled !== e.screenSpaceReflectionsEnabled && (r.screenSpaceReflectionsEnabled = e.screenSpaceReflectionsEnabled, this.requestRender()), void 0 === e.shadowMap || t.enabled === e.shadowMap && r.shadowCastingEnabled === e.shadowMap || (t.enabled = e.shadowMap, r.shadowCastingEnabled = e.shadowMap, this.requestRender()), void 0 !== e.shadowMapMaxCascades && t.maxCascades !== e.shadowMapMaxCascades && (t.maxCascades = e.shadowMapMaxCascades, this.requestRender()), void 0 !== e.ssao && s.enabled !== e.ssao && (s.enabled = e.ssao, this.requestRender()), void 0 !== e.ssaoAttenuation && s.attenuation !== e.ssaoAttenuation && (s.attenuation = e.ssaoAttenuation, this.requestRender()), void 0 !== e.ssaoRadius && s.radius !== e.ssaoRadius && (s.radius = e.ssaoRadius, this.requestRender()), void 0 !== e.ssaoSamples && s.samples !== e.ssaoSamples && (s.samples = e.ssaoSamples, this.requestRender()), e.background && this._offscreenRendering.background !== e.background && (this._offscreenRendering.background = e.background, this.requestRender());\n    const n = e.antialiasingEnabled ? 1 : 0;\n    void 0 !== e.antialiasingEnabled && this._antialiasing !== n && (this._antialiasing = n, this.requestRender()), void 0 !== e.highQualityTransparency && this._multipassTerrain !== e.highQualityTransparency && (this._multipassTerrain = e.highQualityTransparency, this._oitEnabled = e.highQualityTransparency && this._hasOITSupport, this.requestRender()), void 0 !== e.defaultHighlightOptions && (this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions), this._shadowHighlightHelper.setDefaultOptions(e.defaultHighlightOptions), this.requestRender()), void 0 !== e.slicePlane && this._sliceHelper.plane !== e.slicePlane && (this._sliceHelper.plane = a(e.slicePlane), this.requestRender());\n    const i = this._rctx.parameters.maxTextureImageUnits >= 10 && e.waterReflectionEnabled;\n    void 0 !== e.waterReflectionEnabled && this._waterReflectionEnabled !== i && (this._waterReflectionEnabled = i, this.requestRender()), void 0 !== e.opaqueTerrain && this._opaqueTerrain !== e.opaqueTerrain && (this._opaqueTerrain = e.opaqueTerrain, this.requestRender()), void 0 !== e.hasOverlayWater && this._hasOverlayWater !== e.hasOverlayWater && (this._hasOverlayWater = e.hasOverlayWater, this.requestRender()), void 0 !== e.shadowAccumulationOptions && this._shadowAccumulator.setOptions(e.shadowAccumulationOptions);\n  }\n\n  get hasSlicePlane() {\n    return !!this._sliceHelper.plane;\n  }\n\n  get renderPlugins() {\n    return this._renderPlugins;\n  }\n\n  get _hasOITSupport() {\n    return this._rctx.capabilities.textureFloat && this._rctx.capabilities.textureFloat.textureFloat && this._rctx.capabilities.colorBufferFloat && this._rctx.capabilities.colorBufferFloat.textureFloat;\n  }\n\n  modify(e) {\n    this._isRendering && console.warn(\"Renderer.modify called while rendering\");\n    const {\n      adds: t,\n      removes: s,\n      updates: n\n    } = e;\n    if (0 === t.length && 0 === s.length && 0 === n.length) return;\n    s.forAll(({\n      id: e\n    }) => this._content.delete(e)), t.forAll(e => this._content.set(e.id, e));\n    const i = y(e);\n    let a = !1;\n    i.forEach((e, r) => {\n      let t = this._materialRenderers.get(r);\n\n      if (!t) {\n        if (!(e.adds.length > 0)) return;\n        t = new G(this._rctx, this._materialRep, r), this._materialRenderers.set(r, t);\n      }\n\n      t.modify(e), t.isEmpty && (a = !0);\n    }), a && this._materialRenderers.forEach((e, r) => {\n      e.isEmpty && (this._materialRenderers.delete(r), e.dispose());\n    }), this._hasHighlights = r(this._materialRenderers, e => e.hasHighlights), this._hasOccludees = r(this._materialRenderers, e => e.hasOccludees), this._hasWater = r(this._materialRenderers, e => e.hasWater), this.requestRender();\n  }\n\n  updateLogic(e) {\n    let r = !1;\n    return this._materialRenderers.forEach(t => {\n      t.updateLogic && (r = t.updateLogic(e) || r);\n    }), r;\n  }\n\n  updateLightSources(e, r, t) {\n    this._lighting.groundLightingFactor = r, this._lighting.globalFactor = t, this._lighting.set(e);\n  }\n\n  render(e, r, t, s) {\n    this._isRendering = !0, this.performanceInfo.prerender(this._rctx), this._bindParameters.lighting = this._lighting, this._renderContext.hasOccludees = this._hasOccludees, this._renderContext.transparencyPassType = 3, this._bindParameters.transparencyPassType = 3;\n    const n = this._offscreenRendering;\n    n.needLastFrameColorTexture = this.hasWaterReflection, n.advanceCurrentRenderTarget();\n    const a = this._sliceHelper.plane;\n    s && (this._sliceHelper.plane = null), this._rctx.bindFramebuffer(e), r.setGLViewport(this._rctx), this.needsShadowAccumulation && (this.renderPassManager.shadowCastingEnabled = !0), this._renderPlugins.prepareRender(r, t), this.performanceInfo.advance(0);\n    const h = this.computeDepthRange(r);\n    this.renderShadowMap(e, r, this._lighting.lightingMainDirection, h), this.performanceInfo.advance(1), n.initializeFrame(r), this.ensureBindParameters(r), this.renderLinearDepth(), this.performanceInfo.advance(2), this.accumulateShadows(h, r, t), this.renderNormal(), this.performanceInfo.advance(3), this.ensureBindParametersSSR(), this._ssaoHelper.computeSSAO(r, n.linearDepthTexture, n.normalTexture), this.performanceInfo.advance(4), this.performanceInfo.stats.reset(), this._renderContext.pass = 0, n.bindFramebuffer(), this.renderSlot(0), this.renderOpaqueGeometry(), this.performanceInfo.advance(5);\n    const d = this._multipassTerrain && !this._opaqueTerrain;\n    this.renderTerrainLinearDepth(d), this.setMultipassFlags(d), this.setTerrainCulling(d), this.renderEdges(2), this.performanceInfo.advance(6), this.renderHiddenTransparentEdges(), this._oitEnabled ? this.renderOrderIndependentTransparency(() => this.renderTransparentGeometry(), !1) : this.renderTransparentGeometry(), this.performanceInfo.advance(7), this.renderGeometryLinearDepth(d);\n    const o = {\n      hudVisibility: !1,\n      transparentTerrain: !1\n    };\n    o.hudVisibility = this.renderHUDVisibility(), d || this.renderInternalSlot(20), this.performanceInfo.advance(9), this.renderEdges(1, d), this.performanceInfo.advance(8), o.transparentTerrain = this.renderTransparentTerrain(), o.transparentTerrain && o.hudVisibility && (d ? this.renderLineCallouts(0) : n.compositeTransparentTerrainOntoHUDVisibility(), this.renderHUD(0, n.framebuffer), this.performanceInfo.advance(16)), this.performanceInfo.advance(10), this.setTerrainCulling(!1), o.transparentTerrain && (n.compositeTransparentTerrainOntoMain(), d && (this.renderEdges(2), this.performanceInfo.advance(6), this._oitEnabled ? this.renderOrderIndependentTransparency(() => this.renderTransparentGeometry(), !1) : this.renderTransparentGeometry(), this.performanceInfo.advance(7), this.renderEdges(1), this.performanceInfo.advance(8))), d && this.renderLineCallouts(1), this.setMultipassFlags(!1), this._shadowAccumulator.render(), n.renderToTargets(() => {\n      this.renderInternalSlot(8), this.renderSlot(15), this.renderSlot(16);\n    }, n.currentColorTarget, n.mainDepth), this.performanceInfo.advance(11), this._renderPlugins.needsLaserlineWithContrastControl && n.renderTmpAndCompositeToMain(() => {\n      this.renderSlot(17);\n    }, 2), this.performanceInfo.advance(12), this.renderOccluded(), this.performanceInfo.advance(13);\n    const l = !s && this._magnifierHelper.enabled,\n          c = l && i(e) ? this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor, this._offscreenRendering.tmpDepth) : e;\n    this._rctx.bindFramebuffer(c), this.renderAntiAliasing(this._antialiasing, this._offscreenRendering.colorTexture) || this._compositingHelper.composite(this._offscreenRendering.colorTexture, 0), this.performanceInfo.advance(14), this.renderHUD(1, c), this.performanceInfo.advance(17), this.renderHighlights(c, this._bindParameters), this.performanceInfo.advance(15), l && this._magnifierHelper.render(this._rctx, this._bindParameters), c !== e && (this._rctx.bindFramebuffer(e), this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture, 0)), this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera), this._sliceHelper.plane = a, this._isRendering = !1, this.onPostRender && this.onPostRender(), this.performanceInfo.postrender();\n  }\n\n  readDepthPixels(e, r, t, s, n, i) {\n    const a = this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth, this._offscreenRendering.tmpDepth);\n\n    if (!this._needsLinearDepth) {\n      this.ensureBindParameters(e), this._renderContext.camera.setGLViewport(this._rctx), this._rctx.setClearColor(0, 0, 0, 0);\n      const r = 17664;\n      this._rctx.clearSafe(r), this.renderGeometryAndTransparentTerrainPass(2);\n    }\n\n    a.readPixels(r, t, s, n, 6408, 5121, i);\n  }\n\n  readAccumulatedShadow(e, r) {\n    return this._shadowAccumulator.readAccumulatedShadow(e, r);\n  }\n\n  setMultipassFlags(e) {\n    this._renderContext.multipassTerrainParams.multipassTerrainEnabled = this._bindParameters.multipassTerrainEnabled = e, this._renderContext.multipassGeometryParams.multipassGeometryEnabled = this._bindParameters.multipassGeometryEnabled = e;\n  }\n\n  setTerrainCulling(e) {\n    this._renderContext.multipassTerrainParams.cullAboveGround = this._bindParameters.cullAboveGround = e;\n  }\n\n  renderSlot(e) {\n    return this._renderContext.slot = e, this._renderPlugins.render();\n  }\n\n  renderEdges(e, r = !1) {\n    const t = this._edgeView;\n    n(t) && t.shouldRender() && this._offscreenRendering.renderTmpAndCompositeToMain(() => t.render(this._bindParameters, e), 1, r);\n  }\n\n  renderShadowMap(e, r, t, s) {\n    const n = this._shadowMap;\n\n    if (n.enabled) {\n      if (u.ENABLE_PROFILE_DEPTH_RANGE && h.begin(\"depthRange\"), u.ENABLE_PROFILE_DEPTH_RANGE && h.end(\"depthRange\"), n.start(r, t, s), this.needsShadowHighlight) {\n        const e = this._shadowHighlightHelper;\n        this.renderShadowCascades(7, this._shadowMap, r => n.takeCascadeSnapshotTo(r, e.highlightShadowMapSlot)), n.clear(), this.renderShadowCascades(6, this._shadowMap, r => {\n          n.takeCascadeSnapshotTo(r, e.defaultSnapshotSlot), this.renderGeometryAndTransparentTerrainPass(7);\n        });\n      } else this.renderShadowCascades(4);\n\n      n.finish(e), r.setGLViewport(this._rctx);\n    }\n  }\n\n  renderShadowCascades(e, r = this._shadowMap, t = e => {}) {\n    for (const s of r.getCascades()) s.camera.setGLViewport(this._rctx), this.ensureCameraBindParameters(s.camera), this.renderGeometryAndTransparentTerrainPass(e), t(s);\n  }\n\n  get _needsLinearDepth() {\n    return this._ssaoHelper.enabled || this._renderPlugins.needsLinearDepth || this._hasWater && this._waterReflectionEnabled || this.needsShadowHighlight || this.needsShadowAccumulation;\n  }\n\n  renderLinearDepth() {\n    this._needsLinearDepth ? this._offscreenRendering.renderToTargets(() => this.renderGeometryAndTransparentTerrainPass(2), this._offscreenRendering.linearDepth, this._offscreenRendering.tmpDepth, [0, 0, 0, 0], !0, !0) : this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth), this._renderContext.ssrParams.linearDepthTexture = this._bindParameters.linearDepthTexture = this._offscreenRendering.linearDepthTexture;\n  }\n\n  renderTerrainLinearDepth(e) {\n    if (e) {\n      const e = this._renderContext.pass;\n      this._renderContext.pass = 2, this._offscreenRendering.renderToTargets(() => this.renderTransparentTerrain(), this._offscreenRendering.terrainLinearDepth, this._offscreenRendering.tmpDepth, [-1e10, -1e10, -1e10, 1], !0, !0), this._renderContext.pass = e;\n    } else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);\n\n    this._renderContext.multipassTerrainParams.terrainLinearDepthTexture = this._bindParameters.terrainLinearDepthTexture = this._offscreenRendering.terrainLinearDepthTexture;\n  }\n\n  renderGeometryLinearDepth(e) {\n    if (e) {\n      const e = this._renderContext.pass;\n      this._offscreenRendering.renderToTargets(() => this.renderGeometryPass(2), this._offscreenRendering.geometryLinearDepth, this._offscreenRendering.tmpDepth, [1, 1, 1, 1], !0, !0), this._renderContext.pass = e;\n    } else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);\n\n    this._renderContext.multipassGeometryParams.geometryLinearDepthTexture = this._bindParameters.geometryLinearDepthTexture = this._offscreenRendering.geometryLinearDepthTexture;\n  }\n\n  get needsNormal() {\n    return this._ssaoHelper.enabled;\n  }\n\n  renderNormal() {\n    this.needsNormal ? this._offscreenRendering.renderToTargets(() => {\n      this.renderGeometryAndTransparentTerrainPass(3);\n    }, this._offscreenRendering.normal, this._offscreenRendering.tmpDepth, [0, 0, 0, 0], !0, !0) : this._offscreenRendering.disposeTarget(this._offscreenRendering.normal);\n  }\n\n  get needsDepthRange() {\n    return this._shadowMap.enabled || this.needsShadowAccumulation;\n  }\n\n  computeDepthRange(e) {\n    if (!this.needsDepthRange) return T;\n    const r = R(e, this._content, this._stage.layers);\n    return x(r, this.renderPlugins.queryDepthRange(e)), r.near = Math.max(e.near, r.near), r.far = Math.min(e.far, r.far), r;\n  }\n\n  renderGeometryAndTransparentTerrainPass(e) {\n    this._renderContext.pass = e, this.renderGeometryPass(e), this.renderTransparentTerrain();\n  }\n\n  renderGeometryPass(e) {\n    this._renderContext.pass = e, this.renderOpaqueGeometry(), this.renderTransparentGeometry();\n  }\n\n  renderOpaqueGeometry() {\n    this.renderSlot(1), this.renderSlot(2), this.renderInternalSlot(3), this.renderSlot(4), this.renderSlot(14);\n  }\n\n  renderTransparentGeometry() {\n    this.renderInternalSlot(5), this.renderSlot(6);\n  }\n\n  renderTransparentTerrain() {\n    return this.renderSlot(7);\n  }\n\n  renderHUDVisibility() {\n    let e = !1;\n    return this._renderContext.offscreenRenderingHelper && this._renderContext.offscreenRenderingHelper.renderHUDVisibility(() => {\n      this._bindParameters.hudVisibilityTexture = this._renderContext.offscreenRenderingHelper ? this._renderContext.offscreenRenderingHelper.hudVisibilityTexture : null, e = this.renderInternalSlot(12);\n    }, this._multipassTerrain && !this._opaqueTerrain), e;\n  }\n\n  renderLineCallouts(e) {\n    this._bindParameters.renderTransparentlyOccludedHUD = e, 0 === e ? this._offscreenRendering.renderToTargets(() => this.renderInternalSlot(20), this._offscreenRendering.currentColorTarget, this._offscreenRendering.tmpDepth, void 0, !0, !0) : this.renderInternalSlot(20);\n  }\n\n  renderHUD(e, r) {\n    this._oitEnabled ? (this.renderOrderIndependentTransparency(() => this.renderHUDElements(e), !0), this._rctx.bindFramebuffer(r), this._compositingHelper.composite(this._offscreenRendering.hudColorTexture, 2)) : 0 === e ? this._offscreenRendering.renderToTargets(() => this.renderHUDElements(0), this._offscreenRendering.currentColorTarget, this._offscreenRendering.tmpDepth, void 0, !0, !0) : this.renderHUDElements(e);\n  }\n\n  renderHUDElements(e) {\n    this._bindParameters.renderTransparentlyOccludedHUD = e, this.renderInternalSlot(21), this.renderInternalSlot(18), this.renderInternalSlot(19);\n  }\n\n  get needsHighlight() {\n    return this._hasHighlights || this._renderPlugins.needsHighlight;\n  }\n\n  get needsShadowHighlight() {\n    return this._shadowMap.enabled && this._shadowHighlightHelper.isVisible && this.needsHighlight;\n  }\n\n  renderHighlights(e, r) {\n    if (!this.needsHighlight) return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);\n    const t = this._highlightHelper,\n          s = t.profilingCallback && j(this._renderContext.rctx);\n    this._renderContext.highlightDepthTexture = r.highlightDepthTexture;\n\n    const i = this._offscreenRendering.renderToTargets(() => {\n      this.renderGeometryAndTransparentTerrainPass(5), this._rctx.clearSafe(256), this.renderHUDElements(2);\n    }, this._offscreenRendering.highlight, this._offscreenRendering.tmpDepth, [0, 0, 0, 0], !0, !0);\n\n    this._bindParameters.highlightColorTexture = i.colorTexture, this.needsShadowHighlight && this._shadowHighlightHelper.render(r, e), t.render(this._renderContext.camera, i, e), n(s) && t.profilingCallback && s.stop(e => {\n      t.profilingCallback && t.profilingCallback(e);\n    });\n  }\n\n  get needsShadowAccumulation() {\n    return this._shadowAccumulator.isAccumulating;\n  }\n\n  accumulateShadows(e, r, t) {\n    this.needsShadowAccumulation && (this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture, e, r, t), this._shadowAccumulator.accumulateFixedSamples(), this.renderPassManager.shadowCastingEnabled = this._shadowMap.enabled);\n  }\n\n  renderOrderIndependentTransparency(e, r) {\n    const t = t => {\n      this._renderContext.transparencyPassType = t, this._bindParameters.transparencyPassType = this._renderContext.transparencyPassType, this._offscreenRendering.renderOITPass(() => e(), t, r);\n    },\n          s = this._renderContext.pass;\n\n    this._renderContext.pass = 1, t(1), this._renderContext.pass = 0, t(0), t(2), this._offscreenRendering.compositeTransparentOntoOpaque(r), this._renderContext.transparencyPassType = 3, this._bindParameters.transparencyPassType = this._renderContext.transparencyPassType, this._renderContext.pass = s;\n  }\n\n  renderOccluded() {\n    let e = 0;\n\n    this._materialRenderers.forEach((r, t) => {\n      t && t.isVisible() && 8 === t.renderOccluded && (e |= t.renderOccluded, U.push(t));\n    });\n\n    const r = this._offscreenRendering,\n          t = (t, s, n, i, a) => {\n      0 != (e & s) && (r.renderToTargets(n, r.tmpColor, r.mainDepth, [0, 0, 0, 0], i, a), r.compositeOccludedOntoMain(t));\n    };\n\n    0 !== U.length && (this.renderInternalSlot(10, U), t(.5, 8, () => this.renderInternalSlot(11, U), !1, !1), U.length = 0), this._materialRenderers.forEach((r, t) => {\n      t && t.isVisible() && (4 === t.renderOccluded || 2 === t.renderOccluded || 16 === t.renderOccluded) && (e |= t.renderOccluded, V.push(t));\n    });\n    const s = this._renderPlugins.renderOccludedFlags;\n    if (e |= s, !e) return;\n\n    const n = e => {\n      this._renderContext.renderOccludedMask = e, s > 1 && this.renderSlot(9), this.renderInternalSlot(3, V), this.renderInternalSlot(5, V), this.renderInternalSlot(8, V), this._renderContext.resetRenderOccludedMask();\n    };\n\n    this._renderContext.pass = 0, t(.5, 4, () => n(4), !0, 2), t(.5, 2, () => n(2), !0, 2), t(1, 16, () => n(16), !0, 2), V.length = 0;\n  }\n\n  renderAntiAliasing(e, r) {\n    if (1 === e) {\n      if (this._smaaPass.loadResources(() => this.requestRender()), this._smaaPass.enable()) return this._smaaPass.render({\n        colorTexture: r\n      }), !0;\n    } else this._smaaPass.disable();\n\n    return !1;\n  }\n\n  ensureCameraBindParameters(e) {\n    this._renderContext.camera = e, this._bindParameters.camera = this._renderContext.camera, this._bindParameters.inverseViewport[0] = 1 / this._renderContext.camera.fullViewport[2], this._bindParameters.inverseViewport[1] = 1 / this._renderContext.camera.fullViewport[3];\n  }\n\n  ensureBindParameters(e) {\n    var r;\n    this.ensureCameraBindParameters(e);\n    const t = this._renderContext.offscreenRenderingHelper;\n    this._bindParameters.shadowMap = this._renderContext.shadowMap, this._bindParameters.shadowMappingEnabled = this._renderContext.shadowMap.enabled, this._bindParameters.ssaoHelper = this._renderContext.ssaoHelper, this._bindParameters.ssaoEnabled = this._renderContext.ssaoHelper.enabled, this._bindParameters.slicePlane = this._renderContext.sliceHelper.plane, this._bindParameters.hasOccludees = this._renderContext.hasOccludees, this._renderContext.multipassTerrainParams.camera = this._renderContext.camera, this._bindParameters.hudVisibilityTexture = t.hudVisibilityTexture, this._bindParameters.highlightDepthTexture = null != (r = t.depthTexture) ? r : this.getFallbackDepthTexture();\n  }\n\n  ensureBindParametersSSR() {\n    this.hasWaterReflection ? (this._renderContext.lastFrameCamera.equals(this._renderContext.camera) ? this._renderContext.ssrParams.reprojectionMat = this._bindParameters.reprojectionMat = Q : (l(k, this._renderContext.lastFrameCamera.viewMatrix, this._bindParameters.origin ? this._bindParameters.origin : [0, 0, 0]), l(B, this._renderContext.camera.viewMatrix, this._bindParameters.origin ? this._bindParameters.origin : [0, 0, 0]), c(B, B), c(W, this._renderContext.camera.projectionMatrix), p(N, B, W), p(N, k, N), p(N, this._renderContext.lastFrameCamera.projectionMatrix, N), this._renderContext.ssrParams.reprojectionMat = this._bindParameters.reprojectionMat = N), this._renderContext.ssrParams.camera = this._renderContext.camera, this._renderContext.ssrParams.lastFrameColorTexture = this._bindParameters.lastFrameColorTexture = this._offscreenRendering.lastFrameColorTexture) : this._renderContext.ssrParams.lastFrameColorTexture = this._bindParameters.lastFrameColorTexture = null, this._renderContext.ssrParams.ssrEnabled = this._bindParameters.ssrEnabled = this.hasWaterReflection;\n  }\n\n  renderInternalSlot(e, r) {\n    const t = 0 === this._renderContext.pass ? this.performanceInfo.stats : null;\n    let s = !1;\n    return this._bindParameters.slot = e, n(r) ? r.forEach(r => {\n      if (!C(r, this._renderContext)) return;\n\n      const t = this._materialRenderers.get(r);\n\n      n(t) && (s = t.render(e, this._renderContext.pass, this._bindParameters) || s);\n    }) : this._materialRenderers.forEach((r, n) => {\n      C(n, this._renderContext) && (s = r.render(e, this._renderContext.pass, this._bindParameters, t) || s);\n    }), s;\n  }\n\n  getFallbackDepthTexture() {\n    return this._fallbackDepthStencilTexture || (this._fallbackDepthStencilTexture = b(this._rctx)), this._fallbackDepthStencilTexture;\n  }\n\n  getGpuMemoryUsage() {\n    return {\n      offscreen: this._offscreenRendering ? this._offscreenRendering.getGpuMemoryUsage() : 0,\n      highlights: (this._highlightHelper ? this._highlightHelper.getGpuMemoryUsage() : 0) + (this._shadowHighlightHelper ? this._shadowHighlightHelper.getGpuMemoryUsage() : 0),\n      shadows: this._shadowMap ? this._shadowMap.getGpuMemoryUsage() : 0,\n      ssao: this._ssaoHelper ? this._ssaoHelper.gpuMemoryUsage : 0\n    };\n  }\n\n  get test() {\n    const e = this;\n    return {\n      antialiasing: this._antialiasing,\n      offscreen: this._offscreenRendering,\n      shadowMap: this._shadowMap,\n      ssao: this._ssaoHelper,\n      highlight: this._highlightHelper,\n      lighting: this._lighting,\n      materialRenderers: this._materialRenderers,\n      oitEnabled: this._oitEnabled,\n      shadowHighlights: this._shadowHighlightHelper,\n      getFramebufferTexture: r => {\n        var t;\n\n        switch (r) {\n          case 0:\n            return e._offscreenRendering.colorTexture;\n\n          case 1:\n            return e._offscreenRendering.linearDepthTexture;\n\n          case 2:\n            return e._offscreenRendering.normalTexture;\n\n          case 3:\n            return null == (t = e._shadowMap) ? void 0 : t.test.depthTexture;\n\n          case 4:\n            return e._offscreenRendering.hudVisibilityTexture;\n\n          case 5:\n            return e._offscreenRendering.highlightTexture;\n        }\n      }\n    };\n  }\n\n}\n\nconst V = [],\n      U = [],\n      k = _(),\n      W = _(),\n      B = _(),\n      N = _(),\n      Q = _();\n\nexport default F;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/Renderer.js"],"names":["e","someMap","r","destroyMaybe","t","disposeMaybe","s","isSome","n","isNone","i","unwrap","a","h","init","d","f","o","l","c","m","p","_","g","u","RenderPassManager","BoundingInfo","ZERO","T","union","x","depthRangeFromScene","R","createEmptyDepthTexture","b","w","materialPredicate","C","OffscreenRendering","P","RenderContext","H","splitRenderGeometryChangeSetByMaterial","y","RenderPluginManager","S","ShadowAccumulator","M","ShadowHighlightHelper","D","E","v","SmaaRenderPass","O","I","EdgeView","A","SceneLighting","q","G","RendererPerformanceInfo","L","startMeasurement","j","F","constructor","_materialRep","_shaderTechniqueRepository","_rctx","_compositingHelper","_magnifierHelper","requestRender","_stage","_materialRenderers","Map","_hasHighlights","_hasOccludees","_hasWater","_hasOverlayWater","_content","_isRendering","_fallbackDepthStencilTexture","performanceInfo","_antialiasing","_oitEnabled","_multipassTerrain","_opaqueTerrain","_lighting","_handles","renderHiddenTransparentEdges","_smaaPass","_hasOITSupport","_offscreenRendering","_sliceHelper","_shadowMap","viewingMode","_ssaoHelper","_highlightHelper","_shadowHighlightHelper","_shadowAccumulator","renderPassManager","shadowCastingEnabled","_renderPlugins","prepareRender","enabled","start","renderShadowCascades","setGLViewport","ensureCameraBindParameters","_bindParameters","slot","camera","inverseViewport","shadowMap","shadowMappingEnabled","ssaoHelper","ssaoEnabled","origin","screenToWorldRatio","screenToWorldRatioGlobalWM","slicePlane","plane","highlightDepthTexture","hasOccludees","linearDepthTexture","terrainLinearDepthTexture","geometryLinearDepthTexture","multipassTerrainEnabled","multipassGeometryEnabled","cullAboveGround","lastFrameColorTexture","reprojectionMat","ssrEnabled","lighting","highlightColorTexture","_renderContext","multipassTerrainParams","multipassGeometryParams","ssrParams","renderContext","shaderTechniqueRep","textureRep","materialRep","schedule","add","slots","renderEdges","hasWater","hasWaterReflection","_waterReflectionEnabled","dispose","destroy","disable","forEach","clear","_edgeView","prune","updating","isLoadingResources","running","isCameraFinal","ensureEdgeView","rctx","renderSR","techniqueRepository","setNeedsRender","resourceController","watch","edgeView","Q","hasShadowsEnabled","setRenderParameters","screenSpaceReflectionsEnabled","shadowMapMaxCascades","maxCascades","ssao","ssaoAttenuation","attenuation","ssaoRadius","radius","ssaoSamples","samples","background","antialiasingEnabled","highQualityTransparency","defaultHighlightOptions","setDefaultOptions","parameters","maxTextureImageUnits","waterReflectionEnabled","opaqueTerrain","hasOverlayWater","shadowAccumulationOptions","setOptions","hasSlicePlane","renderPlugins","capabilities","textureFloat","colorBufferFloat","modify","console","warn","adds","removes","updates","length","forAll","id","delete","set","get","isEmpty","hasHighlights","updateLogic","updateLightSources","groundLightingFactor","globalFactor","render","prerender","transparencyPassType","needLastFrameColorTexture","advanceCurrentRenderTarget","bindFramebuffer","needsShadowAccumulation","advance","computeDepthRange","renderShadowMap","lightingMainDirection","initializeFrame","ensureBindParameters","renderLinearDepth","accumulateShadows","renderNormal","ensureBindParametersSSR","computeSSAO","normalTexture","stats","reset","pass","renderSlot","renderOpaqueGeometry","renderTerrainLinearDepth","setMultipassFlags","setTerrainCulling","renderOrderIndependentTransparency","renderTransparentGeometry","renderGeometryLinearDepth","hudVisibility","transparentTerrain","renderHUDVisibility","renderInternalSlot","renderTransparentTerrain","renderLineCallouts","compositeTransparentTerrainOntoHUDVisibility","renderHUD","framebuffer","compositeTransparentTerrainOntoMain","renderToTargets","currentColorTarget","mainDepth","needsLaserlineWithContrastControl","renderTmpAndCompositeToMain","renderOccluded","getFramebuffer","tmpColor","tmpDepth","renderAntiAliasing","colorTexture","composite","renderHighlights","tmpColorTexture","lastFrameCamera","copyFrom","onPostRender","postrender","readDepthPixels","bindTarget","linearDepth","_needsLinearDepth","setClearColor","clearSafe","renderGeometryAndTransparentTerrainPass","readPixels","readAccumulatedShadow","shouldRender","ENABLE_PROFILE_DEPTH_RANGE","begin","end","needsShadowHighlight","takeCascadeSnapshotTo","highlightShadowMapSlot","defaultSnapshotSlot","finish","getCascades","needsLinearDepth","disposeTarget","terrainLinearDepth","renderGeometryPass","geometryLinearDepth","needsNormal","normal","needsDepthRange","layers","queryDepthRange","near","Math","max","far","min","offscreenRenderingHelper","hudVisibilityTexture","renderTransparentlyOccludedHUD","renderHUDElements","hudColorTexture","needsHighlight","isVisible","highlight","profilingCallback","stop","isAccumulating","setAccumulationDependencies","accumulateFixedSamples","renderOITPass","compositeTransparentOntoOpaque","U","push","compositeOccludedOntoMain","V","renderOccludedFlags","renderOccludedMask","resetRenderOccludedMask","loadResources","enable","fullViewport","sliceHelper","depthTexture","getFallbackDepthTexture","equals","k","viewMatrix","B","W","projectionMatrix","N","getGpuMemoryUsage","offscreen","highlights","shadows","gpuMemoryUsage","test","antialiasing","materialRenderers","oitEnabled","shadowHighlights","getFramebufferTexture","highlightTexture"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Handles.js\";import{someMap as r}from\"../../../../core/MapUtils.js\";import{destroyMaybe as t,disposeMaybe as s,isSome as n,isNone as i,unwrap as a}from\"../../../../core/maybe.js\";import h from\"../../../../core/TimeProfiler.js\";import{init as d}from\"../../../../core/watchUtils.js\";import{f as o,t as l,a as c,m as p}from\"../../../../chunks/mat4.js\";import{c as _}from\"../../../../chunks/mat4f64.js\";import{a as g}from\"../../../../chunks/vec2f64.js\";import u from\"../../support/debugFlags.js\";import{RenderPassManager as m}from\"../core/renderPasses/RenderPassManager.js\";import{BoundingInfo as f}from\"./BoundingInfo.js\";import{ZERO as T,union as x}from\"./depthRange.js\";import{depthRangeFromScene as R}from\"./depthRangeUtils.js\";import{createEmptyDepthTexture as b}from\"./glUtil3D.js\";import w from\"./HighlightHelper.js\";import{materialPredicate as C}from\"./Material.js\";import{OffscreenRendering as P}from\"./OffscreenRendering.js\";import{RenderContext as H}from\"./RenderContext.js\";import{splitRenderGeometryChangeSetByMaterial as y}from\"./rendererUtils.js\";import{RenderPluginManager as S}from\"./RenderPluginManager.js\";import{ShadowAccumulator as M}from\"./ShadowAccumulator.js\";import{ShadowHighlightHelper as D}from\"./ShadowHighlightHelper.js\";import E from\"./ShadowMap.js\";import v from\"./SliceHelper.js\";import{SmaaRenderPass as O}from\"./SmaaRenderPass.js\";import I from\"./SSAOHelper.js\";import{EdgeView as A}from\"./edgeRendering/EdgeView.js\";import{SceneLighting as q}from\"../lighting/SceneLighting.js\";import G from\"../materials/renderers/MergedRenderer.js\";import{RendererPerformanceInfo as L}from\"../statistics/RendererPerformanceInfo.js\";import{startMeasurement as j}from\"../../../webgl/Measurement.js\";class F{constructor(r,t,s,n,i,a,h,o,l){this._materialRep=r,this._shaderTechniqueRepository=s,this._rctx=n,this._compositingHelper=i,this._magnifierHelper=a,this.requestRender=h,this._stage=l,this._materialRenderers=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new L,this._antialiasing=1,this._oitEnabled=!1,this._multipassTerrain=!0,this._opaqueTerrain=!0,this._lighting=new q,this._handles=new e,this.renderHiddenTransparentEdges=()=>{},this._smaaPass=new O(this._rctx,s),this._oitEnabled=this._hasOITSupport,this.requestRender(),this._offscreenRendering=new P(this._rctx,this._compositingHelper),this._sliceHelper=new v,this._shadowMap=new E(this._rctx,l.viewingMode,2),this._ssaoHelper=new I(s,this._rctx,(()=>this.requestRender())),this._highlightHelper=new w(s,this._rctx),this._shadowHighlightHelper=new D(this._rctx,l.viewingMode),this._shadowAccumulator=new M(this._rctx,s,l,((e,r)=>{this.renderPassManager.shadowCastingEnabled=!0,this._renderPlugins.prepareRender(e,r),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled}),((e,r,t,s)=>{e.start(t,r,s),this.renderShadowCascades(4,e),t.setGLViewport(this._rctx),this.ensureCameraBindParameters(t)}),(()=>this.requestRender())),this._bindParameters={slot:null,camera:null,inverseViewport:g(),shadowMap:this._shadowMap,shadowMappingEnabled:this._shadowMap.enabled,ssaoHelper:this._ssaoHelper,ssaoEnabled:this._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:this._sliceHelper.plane,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,highlightColorTexture:null},this._renderContext=new H(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null},this._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null},this._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1},this._renderPlugins=new S({renderContext:this._renderContext,shaderTechniqueRep:s,textureRep:t,materialRep:this._materialRep,requestRender:this.requestRender,schedule:o}),this.renderPassManager=new m(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([d(u,\"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES\",(e=>{this.renderHiddenTransparentEdges=e?()=>this.renderEdges(1):()=>{},this.requestRender()})),d(this._stage,\"camera\",(()=>this.requestRender()),!0)])}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}dispose(){this._handles.destroy(),this._smaaPass.disable(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._edgeView=t(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=s(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlightHelper.dispose(),this._shadowHighlightHelper.dispose(),this._shadowAccumulator.dispose(),f.prune(),this._content.clear()}get updating(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources||n(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return i(this._edgeView)&&(this._edgeView=new A({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this.requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(this._edgeView.watch(\"updating\",(()=>this.requestRender()),!0)),this.requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return null===this._bindParameters.reprojectionMat||o(this._bindParameters.reprojectionMat,Q)}get hasShadowsEnabled(){var e;return!(null==(e=this._shadowMap)||!e.enabled)}setRenderParameters(e){const{renderPassManager:r,_shadowMap:t,_ssaoHelper:s}=this;void 0!==e.screenSpaceReflectionsEnabled&&r.screenSpaceReflectionsEnabled!==e.screenSpaceReflectionsEnabled&&(r.screenSpaceReflectionsEnabled=e.screenSpaceReflectionsEnabled,this.requestRender()),void 0===e.shadowMap||t.enabled===e.shadowMap&&r.shadowCastingEnabled===e.shadowMap||(t.enabled=e.shadowMap,r.shadowCastingEnabled=e.shadowMap,this.requestRender()),void 0!==e.shadowMapMaxCascades&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this.requestRender()),void 0!==e.ssao&&s.enabled!==e.ssao&&(s.enabled=e.ssao,this.requestRender()),void 0!==e.ssaoAttenuation&&s.attenuation!==e.ssaoAttenuation&&(s.attenuation=e.ssaoAttenuation,this.requestRender()),void 0!==e.ssaoRadius&&s.radius!==e.ssaoRadius&&(s.radius=e.ssaoRadius,this.requestRender()),void 0!==e.ssaoSamples&&s.samples!==e.ssaoSamples&&(s.samples=e.ssaoSamples,this.requestRender()),e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this.requestRender());const n=e.antialiasingEnabled?1:0;void 0!==e.antialiasingEnabled&&this._antialiasing!==n&&(this._antialiasing=n,this.requestRender()),void 0!==e.highQualityTransparency&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this.requestRender()),void 0!==e.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(e.defaultHighlightOptions),this.requestRender()),void 0!==e.slicePlane&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=a(e.slicePlane),this.requestRender());const i=this._rctx.parameters.maxTextureImageUnits>=10&&e.waterReflectionEnabled;void 0!==e.waterReflectionEnabled&&this._waterReflectionEnabled!==i&&(this._waterReflectionEnabled=i,this.requestRender()),void 0!==e.opaqueTerrain&&this._opaqueTerrain!==e.opaqueTerrain&&(this._opaqueTerrain=e.opaqueTerrain,this.requestRender()),void 0!==e.hasOverlayWater&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this.requestRender()),void 0!==e.shadowAccumulationOptions&&this._shadowAccumulator.setOptions(e.shadowAccumulationOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat&&this._rctx.capabilities.colorBufferFloat&&this._rctx.capabilities.colorBufferFloat.textureFloat}modify(e){this._isRendering&&console.warn(\"Renderer.modify called while rendering\");const{adds:t,removes:s,updates:n}=e;if(0===t.length&&0===s.length&&0===n.length)return;s.forAll((({id:e})=>this._content.delete(e))),t.forAll((e=>this._content.set(e.id,e)));const i=y(e);let a=!1;i.forEach(((e,r)=>{let t=this._materialRenderers.get(r);if(!t){if(!(e.adds.length>0))return;t=new G(this._rctx,this._materialRep,r),this._materialRenderers.set(r,t)}t.modify(e),t.isEmpty&&(a=!0)})),a&&this._materialRenderers.forEach(((e,r)=>{e.isEmpty&&(this._materialRenderers.delete(r),e.dispose())})),this._hasHighlights=r(this._materialRenderers,(e=>e.hasHighlights)),this._hasOccludees=r(this._materialRenderers,(e=>e.hasOccludees)),this._hasWater=r(this._materialRenderers,(e=>e.hasWater)),this.requestRender()}updateLogic(e){let r=!1;return this._materialRenderers.forEach((t=>{t.updateLogic&&(r=t.updateLogic(e)||r)})),r}updateLightSources(e,r,t){this._lighting.groundLightingFactor=r,this._lighting.globalFactor=t,this._lighting.set(e)}render(e,r,t,s){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.lighting=this._lighting,this._renderContext.hasOccludees=this._hasOccludees,this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=3;const n=this._offscreenRendering;n.needLastFrameColorTexture=this.hasWaterReflection,n.advanceCurrentRenderTarget();const a=this._sliceHelper.plane;s&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),r.setGLViewport(this._rctx),this.needsShadowAccumulation&&(this.renderPassManager.shadowCastingEnabled=!0),this._renderPlugins.prepareRender(r,t),this.performanceInfo.advance(0);const h=this.computeDepthRange(r);this.renderShadowMap(e,r,this._lighting.lightingMainDirection,h),this.performanceInfo.advance(1),n.initializeFrame(r),this.ensureBindParameters(r),this.renderLinearDepth(),this.performanceInfo.advance(2),this.accumulateShadows(h,r,t),this.renderNormal(),this.performanceInfo.advance(3),this.ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(r,n.linearDepthTexture,n.normalTexture),this.performanceInfo.advance(4),this.performanceInfo.stats.reset(),this._renderContext.pass=0,n.bindFramebuffer(),this.renderSlot(0),this.renderOpaqueGeometry(),this.performanceInfo.advance(5);const d=this._multipassTerrain&&!this._opaqueTerrain;this.renderTerrainLinearDepth(d),this.setMultipassFlags(d),this.setTerrainCulling(d),this.renderEdges(2),this.performanceInfo.advance(6),this.renderHiddenTransparentEdges(),this._oitEnabled?this.renderOrderIndependentTransparency((()=>this.renderTransparentGeometry()),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderGeometryLinearDepth(d);const o={hudVisibility:!1,transparentTerrain:!1};o.hudVisibility=this.renderHUDVisibility(),d||this.renderInternalSlot(20),this.performanceInfo.advance(9),this.renderEdges(1,d),this.performanceInfo.advance(8),o.transparentTerrain=this.renderTransparentTerrain(),o.transparentTerrain&&o.hudVisibility&&(d?this.renderLineCallouts(0):n.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,n.framebuffer),this.performanceInfo.advance(16)),this.performanceInfo.advance(10),this.setTerrainCulling(!1),o.transparentTerrain&&(n.compositeTransparentTerrainOntoMain(),d&&(this.renderEdges(2),this.performanceInfo.advance(6),this._oitEnabled?this.renderOrderIndependentTransparency((()=>this.renderTransparentGeometry()),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8))),d&&this.renderLineCallouts(1),this.setMultipassFlags(!1),this._shadowAccumulator.render(),n.renderToTargets((()=>{this.renderInternalSlot(8),this.renderSlot(15),this.renderSlot(16)}),n.currentColorTarget,n.mainDepth),this.performanceInfo.advance(11),this._renderPlugins.needsLaserlineWithContrastControl&&n.renderTmpAndCompositeToMain((()=>{this.renderSlot(17)}),2),this.performanceInfo.advance(12),this.renderOccluded(),this.performanceInfo.advance(13);const l=!s&&this._magnifierHelper.enabled,c=l&&i(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(c),this.renderAntiAliasing(this._antialiasing,this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0),this.performanceInfo.advance(14),this.renderHUD(1,c),this.performanceInfo.advance(17),this.renderHighlights(c,this._bindParameters),this.performanceInfo.advance(15),l&&this._magnifierHelper.render(this._rctx,this._bindParameters),c!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0)),this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera),this._sliceHelper.plane=a,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}readDepthPixels(e,r,t,s,n,i){const a=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this.ensureBindParameters(e),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const r=17664;this._rctx.clearSafe(r),this.renderGeometryAndTransparentTerrainPass(2)}a.readPixels(r,t,s,n,6408,5121,i)}readAccumulatedShadow(e,r){return this._shadowAccumulator.readAccumulatedShadow(e,r)}setMultipassFlags(e){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=e,this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=e}setTerrainCulling(e){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=e}renderSlot(e){return this._renderContext.slot=e,this._renderPlugins.render()}renderEdges(e,r=!1){const t=this._edgeView;n(t)&&t.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain((()=>t.render(this._bindParameters,e)),1,r)}renderShadowMap(e,r,t,s){const n=this._shadowMap;if(n.enabled){if(u.ENABLE_PROFILE_DEPTH_RANGE&&h.begin(\"depthRange\"),u.ENABLE_PROFILE_DEPTH_RANGE&&h.end(\"depthRange\"),n.start(r,t,s),this.needsShadowHighlight){const e=this._shadowHighlightHelper;this.renderShadowCascades(7,this._shadowMap,(r=>n.takeCascadeSnapshotTo(r,e.highlightShadowMapSlot))),n.clear(),this.renderShadowCascades(6,this._shadowMap,(r=>{n.takeCascadeSnapshotTo(r,e.defaultSnapshotSlot),this.renderGeometryAndTransparentTerrainPass(7)}))}else this.renderShadowCascades(4);n.finish(e),r.setGLViewport(this._rctx)}}renderShadowCascades(e,r=this._shadowMap,t=(e=>{})){for(const s of r.getCascades())s.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(s.camera),this.renderGeometryAndTransparentTerrainPass(e),t(s)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowAccumulation}renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets((()=>this.renderGeometryAndTransparentTerrainPass(2)),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}renderTerrainLinearDepth(e){if(e){const e=this._renderContext.pass;this._renderContext.pass=2,this._offscreenRendering.renderToTargets((()=>this.renderTransparentTerrain()),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}renderGeometryLinearDepth(e){if(e){const e=this._renderContext.pass;this._offscreenRendering.renderToTargets((()=>this.renderGeometryPass(2)),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets((()=>{this.renderGeometryAndTransparentTerrainPass(3)}),this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowAccumulation}computeDepthRange(e){if(!this.needsDepthRange)return T;const r=R(e,this._content,this._stage.layers);return x(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this.renderGeometryPass(e),this.renderTransparentTerrain()}renderGeometryPass(e){this._renderContext.pass=e,this.renderOpaqueGeometry(),this.renderTransparentGeometry()}renderOpaqueGeometry(){this.renderSlot(1),this.renderSlot(2),this.renderInternalSlot(3),this.renderSlot(4),this.renderSlot(14)}renderTransparentGeometry(){this.renderInternalSlot(5),this.renderSlot(6)}renderTransparentTerrain(){return this.renderSlot(7)}renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility((()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null,e=this.renderInternalSlot(12)}),this._multipassTerrain&&!this._opaqueTerrain),e}renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,0===e?this._offscreenRendering.renderToTargets((()=>this.renderInternalSlot(20)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderInternalSlot(20)}renderHUD(e,r){this._oitEnabled?(this.renderOrderIndependentTransparency((()=>this.renderHUDElements(e)),!0),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===e?this._offscreenRendering.renderToTargets((()=>this.renderHUDElements(0)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(e)}renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(21),this.renderInternalSlot(18),this.renderInternalSlot(19)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlightHelper.isVisible&&this.needsHighlight}renderHighlights(e,r){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const t=this._highlightHelper,s=t.profilingCallback&&j(this._renderContext.rctx);this._renderContext.highlightDepthTexture=r.highlightDepthTexture;const i=this._offscreenRendering.renderToTargets((()=>{this.renderGeometryAndTransparentTerrainPass(5),this._rctx.clearSafe(256),this.renderHUDElements(2)}),this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this.needsShadowHighlight&&this._shadowHighlightHelper.render(r,e),t.render(this._renderContext.camera,i,e),n(s)&&t.profilingCallback&&s.stop((e=>{t.profilingCallback&&t.profilingCallback(e)}))}get needsShadowAccumulation(){return this._shadowAccumulator.isAccumulating}accumulateShadows(e,r,t){this.needsShadowAccumulation&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,e,r,t),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)}renderOrderIndependentTransparency(e,r){const t=t=>{this._renderContext.transparencyPassType=t,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._offscreenRendering.renderOITPass((()=>e()),t,r)},s=this._renderContext.pass;this._renderContext.pass=1,t(1),this._renderContext.pass=0,t(0),t(2),this._offscreenRendering.compositeTransparentOntoOpaque(r),this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._renderContext.pass=s}renderOccluded(){let e=0;this._materialRenderers.forEach(((r,t)=>{t&&t.isVisible()&&8===t.renderOccluded&&(e|=t.renderOccluded,U.push(t))}));const r=this._offscreenRendering,t=(t,s,n,i,a)=>{0!=(e&s)&&(r.renderToTargets(n,r.tmpColor,r.mainDepth,[0,0,0,0],i,a),r.compositeOccludedOntoMain(t))};0!==U.length&&(this.renderInternalSlot(10,U),t(.5,8,(()=>this.renderInternalSlot(11,U)),!1,!1),U.length=0),this._materialRenderers.forEach(((r,t)=>{t&&t.isVisible()&&(4===t.renderOccluded||2===t.renderOccluded||16===t.renderOccluded)&&(e|=t.renderOccluded,V.push(t))}));const s=this._renderPlugins.renderOccludedFlags;if(e|=s,!e)return;const n=e=>{this._renderContext.renderOccludedMask=e,s>1&&this.renderSlot(9),this.renderInternalSlot(3,V),this.renderInternalSlot(5,V),this.renderInternalSlot(8,V),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=0,t(.5,4,(()=>n(4)),!0,2),t(.5,2,(()=>n(2)),!0,2),t(1,16,(()=>n(16)),!0,2),V.length=0}renderAntiAliasing(e,r){if(1===e){if(this._smaaPass.loadResources((()=>this.requestRender())),this._smaaPass.enable())return this._smaaPass.render({colorTexture:r}),!0}else this._smaaPass.disable();return!1}ensureCameraBindParameters(e){this._renderContext.camera=e,this._bindParameters.camera=this._renderContext.camera,this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]}ensureBindParameters(e){var r;this.ensureCameraBindParameters(e);const t=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap,this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled,this._bindParameters.ssaoHelper=this._renderContext.ssaoHelper,this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled,this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane,this._bindParameters.hasOccludees=this._renderContext.hasOccludees,this._renderContext.multipassTerrainParams.camera=this._renderContext.camera,this._bindParameters.hudVisibilityTexture=t.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=null!=(r=t.depthTexture)?r:this.getFallbackDepthTexture()}ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=Q:(l(k,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),l(B,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),c(B,B),c(W,this._renderContext.camera.projectionMatrix),p(N,B,W),p(N,k,N),p(N,this._renderContext.lastFrameCamera.projectionMatrix,N),this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=N),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this.hasWaterReflection}renderInternalSlot(e,r){const t=0===this._renderContext.pass?this.performanceInfo.stats:null;let s=!1;return this._bindParameters.slot=e,n(r)?r.forEach((r=>{if(!C(r,this._renderContext))return;const t=this._materialRenderers.get(r);n(t)&&(s=t.render(e,this._renderContext.pass,this._bindParameters)||s)})):this._materialRenderers.forEach(((r,n)=>{C(n,this._renderContext)&&(s=r.render(e,this._renderContext.pass,this._bindParameters,t)||s)})),s}getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=b(this._rctx)),this._fallbackDepthStencilTexture}getGpuMemoryUsage(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:(this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0)+(this._shadowHighlightHelper?this._shadowHighlightHelper.getGpuMemoryUsage():0),shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.gpuMemoryUsage:0}}get test(){const e=this;return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,oitEnabled:this._oitEnabled,shadowHighlights:this._shadowHighlightHelper,getFramebufferTexture:r=>{var t;switch(r){case 0:return e._offscreenRendering.colorTexture;case 1:return e._offscreenRendering.linearDepthTexture;case 2:return e._offscreenRendering.normalTexture;case 3:return null==(t=e._shadowMap)?void 0:t.test.depthTexture;case 4:return e._offscreenRendering.hudVisibilityTexture;case 5:return e._offscreenRendering.highlightTexture}}}}}const V=[],U=[],k=_(),W=_(),B=_(),N=_(),Q=_();export default F;\n"]},"metadata":{},"sourceType":"module"}