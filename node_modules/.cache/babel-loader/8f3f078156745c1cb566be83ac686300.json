{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { WGLGeometryType as e } from \"../enums.js\";\nimport { createProgramDescriptor as t } from \"../Utils.js\";\nimport a from \"./WGLGeometryBrush.js\";\nimport { LabelMaterialKey as o } from \"../materialKey/MaterialKey.js\";\n\nconst i = e => t(e.data, {\n  geometry: [{\n    location: 0,\n    name: \"a_pos\",\n    count: 2,\n    type: 5122\n  }, {\n    location: 1,\n    name: \"a_id\",\n    count: 4,\n    type: 5121\n  }, {\n    location: 2,\n    name: \"a_color\",\n    count: 4,\n    type: 5121,\n    normalized: !0\n  }, {\n    location: 3,\n    name: \"a_haloColor\",\n    count: 4,\n    type: 5121,\n    normalized: !0\n  }, {\n    location: 4,\n    name: \"a_texAndSize\",\n    count: 4,\n    type: 5121\n  }, {\n    location: 5,\n    name: \"a_refSymbolAndPlacementOffset\",\n    count: 4,\n    type: 5121\n  }, {\n    location: 6,\n    name: \"a_glyphData\",\n    count: 4,\n    type: 5121\n  }, {\n    location: 7,\n    name: \"a_vertexOffset\",\n    count: 2,\n    type: 5122\n  }, {\n    location: 8,\n    name: \"a_texCoords\",\n    count: 2,\n    type: 5123\n  }]\n});\n\nclass n extends a {\n  dispose() {}\n\n  getGeometryType() {\n    return e.LABEL;\n  }\n\n  drawGeometry(e, t, a, n) {\n    const {\n      context: s,\n      painter: l,\n      state: r,\n      rendererInfo: m\n    } = e,\n          u = o.load(a.materialKey),\n          f = u.mapAligned ? 1 : 0;\n    if (!f && Math.abs(t.key.level - Math.round(100 * e.displayLevel) / 100) >= 1) return;\n    const {\n      bufferLayouts: c,\n      attributes: p\n    } = i(u),\n          v = l.materialManager.getMaterialProgram(e, u, \"materials/label\", p, n);\n    e.context.setStencilFunction(514, 0, 255), s.useProgram(v), this._setSharedUniforms(v, e, t), l.textureManager.bindTextures(s, v, u);\n    const d = 1 === f ? r.displayViewMat3 : r.displayMat3;\n\n    if (u.vvSizeMinMaxValue && v.setUniform4fv(\"u_vvSizeMinMaxValue\", m.vvSizeMinMaxValue), u.vvSizeScaleStops && v.setUniform1f(\"u_vvSizeScaleStopsValue\", m.vvSizeScaleStopsValue), u.vvSizeFieldStops) {\n      const e = m.getSizeVVFieldStops(t.key.level);\n      v.setUniform1fv(\"u_vvSizeFieldStopsValues\", e.values), v.setUniform1fv(\"u_vvSizeFieldStopsSizes\", e.sizes);\n    }\n\n    u.vvSizeUnitValue && v.setUniform1f(\"u_vvSizeUnitValueWorldToPixelsRatio\", m.vvSizeUnitValueToPixelsRatio), v.setUniform1f(\"u_mapRotation\", Math.floor(r.rotation / 360 * 254)), v.setUniform1f(\"u_mapAligned\", f), v.setUniformMatrix3fv(\"u_displayMat3\", d), v.setUniform1f(\"u_opacity\", 1), v.setUniform2fv(\"u_screenSize\", e.state.size), v.setUniform1f(\"u_isHalo\", 1), a.draw(s, c, p), v.setUniform1f(\"u_isHalo\", 0), a.draw(s, c, p), s.setStencilTestEnabled(!0), s.setBlendingEnabled(!0);\n  }\n\n}\n\nexport default n;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel.js"],"names":["WGLGeometryType","e","createProgramDescriptor","t","a","LabelMaterialKey","o","i","data","geometry","location","name","count","type","normalized","n","dispose","getGeometryType","LABEL","drawGeometry","context","s","painter","l","state","r","rendererInfo","m","u","load","materialKey","f","mapAligned","Math","abs","key","level","round","displayLevel","bufferLayouts","c","attributes","p","v","materialManager","getMaterialProgram","setStencilFunction","useProgram","_setSharedUniforms","textureManager","bindTextures","d","displayViewMat3","displayMat3","vvSizeMinMaxValue","setUniform4fv","vvSizeScaleStops","setUniform1f","vvSizeScaleStopsValue","vvSizeFieldStops","getSizeVVFieldStops","setUniform1fv","values","sizes","vvSizeUnitValue","vvSizeUnitValueToPixelsRatio","floor","rotation","setUniformMatrix3fv","setUniform2fv","size","draw","setStencilTestEnabled","setBlendingEnabled"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{WGLGeometryType as e}from\"../enums.js\";import{createProgramDescriptor as t}from\"../Utils.js\";import a from\"./WGLGeometryBrush.js\";import{LabelMaterialKey as o}from\"../materialKey/MaterialKey.js\";const i=e=>t(e.data,{geometry:[{location:0,name:\"a_pos\",count:2,type:5122},{location:1,name:\"a_id\",count:4,type:5121},{location:2,name:\"a_color\",count:4,type:5121,normalized:!0},{location:3,name:\"a_haloColor\",count:4,type:5121,normalized:!0},{location:4,name:\"a_texAndSize\",count:4,type:5121},{location:5,name:\"a_refSymbolAndPlacementOffset\",count:4,type:5121},{location:6,name:\"a_glyphData\",count:4,type:5121},{location:7,name:\"a_vertexOffset\",count:2,type:5122},{location:8,name:\"a_texCoords\",count:2,type:5123}]});class n extends a{dispose(){}getGeometryType(){return e.LABEL}drawGeometry(e,t,a,n){const{context:s,painter:l,state:r,rendererInfo:m}=e,u=o.load(a.materialKey),f=u.mapAligned?1:0;if(!f&&Math.abs(t.key.level-Math.round(100*e.displayLevel)/100)>=1)return;const{bufferLayouts:c,attributes:p}=i(u),v=l.materialManager.getMaterialProgram(e,u,\"materials/label\",p,n);e.context.setStencilFunction(514,0,255),s.useProgram(v),this._setSharedUniforms(v,e,t),l.textureManager.bindTextures(s,v,u);const d=1===f?r.displayViewMat3:r.displayMat3;if(u.vvSizeMinMaxValue&&v.setUniform4fv(\"u_vvSizeMinMaxValue\",m.vvSizeMinMaxValue),u.vvSizeScaleStops&&v.setUniform1f(\"u_vvSizeScaleStopsValue\",m.vvSizeScaleStopsValue),u.vvSizeFieldStops){const e=m.getSizeVVFieldStops(t.key.level);v.setUniform1fv(\"u_vvSizeFieldStopsValues\",e.values),v.setUniform1fv(\"u_vvSizeFieldStopsSizes\",e.sizes)}u.vvSizeUnitValue&&v.setUniform1f(\"u_vvSizeUnitValueWorldToPixelsRatio\",m.vvSizeUnitValueToPixelsRatio),v.setUniform1f(\"u_mapRotation\",Math.floor(r.rotation/360*254)),v.setUniform1f(\"u_mapAligned\",f),v.setUniformMatrix3fv(\"u_displayMat3\",d),v.setUniform1f(\"u_opacity\",1),v.setUniform2fv(\"u_screenSize\",e.state.size),v.setUniform1f(\"u_isHalo\",1),a.draw(s,c,p),v.setUniform1f(\"u_isHalo\",0),a.draw(s,c,p),s.setStencilTestEnabled(!0),s.setBlendingEnabled(!0)}}export default n;\n"]},"metadata":{},"sourceType":"module"}