{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../request.js\";\nimport e from \"../../core/Error.js\";\nimport i from \"../../core/Logger.js\";\nimport { urlToObject as s, objectToQuery as a } from \"../../core/urlUtils.js\";\nconst r = i.getLogger(\"esri.layers.support.SpriteSource\"),\n      h = 1.15;\n\nclass o {\n  constructor(t, e, i, s) {\n    this.baseURL = t, this.devicePixelRatio = e, this.maxTextureSize = i, this._spriteImageFormat = s, this._isRetina = !1, this._spritesData = {}, this.image = null, this.width = null, this.height = null, this.loadStatus = \"not-loaded\";\n  }\n\n  get spriteNames() {\n    const t = [];\n\n    for (const e in this._spritesData) t.push(e);\n\n    return t.sort(), t;\n  }\n\n  getSpriteInfo(t) {\n    return this._spritesData[t];\n  }\n\n  async load(t) {\n    if (this.baseURL) {\n      this.loadStatus = \"loading\";\n\n      try {\n        await this._loadSprites(t), this.loadStatus = \"loaded\";\n      } catch {\n        this.loadStatus = \"failed\";\n      }\n    } else this.loadStatus = \"failed\";\n  }\n\n  _loadSprites(i) {\n    this._isRetina = this.devicePixelRatio > h;\n    const o = s(this.baseURL),\n          l = o.query ? \"?\" + a(o.query) : \"\",\n          n = this._isRetina ? \"@2x\" : \"\",\n          d = `${o.path}${n}.${this._spriteImageFormat}${l}`,\n          g = `${o.path}${n}.json${l}`;\n    return Promise.all([t(g, i), t(d, {\n      responseType: \"image\",\n      ...i\n    })]).then(([t, i]) => {\n      const s = Object.keys(t.data);\n      if (!s || 0 === s.length || 1 === s.length && \"_ssl\" === s[0] || !i || !i.data) return this._spritesData = this.image = null, this.width = this.height = 0, Promise.resolve(null);\n      this._spritesData = t.data;\n      const a = i.data,\n            h = Math.max(this.maxTextureSize, 4096);\n\n      if (a.width > h || a.height > h) {\n        const t = `Sprite resource for style ${o.path} is bigger than the maximum allowed of ${h} pixels}`;\n        throw r.error(t), new e(\"SpriteSource\", t);\n      }\n\n      this.width = a.width, this.height = a.height;\n      const l = document.createElement(\"canvas\"),\n            n = l.getContext(\"2d\");\n      l.width = a.width, l.height = a.height, n.drawImage(a, 0, 0, a.width, a.height);\n      const d = n.getImageData(0, 0, a.width, a.height),\n            g = new Uint8Array(d.data);\n      let m;\n\n      for (let e = 0; e < g.length; e += 4) m = g[e + 3] / 255, g[e] = g[e] * m, g[e + 1] = g[e + 1] * m, g[e + 2] = g[e + 2] * m;\n\n      this.image = g;\n    });\n  }\n\n}\n\nexport default o;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/support/SpriteSource.js"],"names":["t","e","i","urlToObject","s","objectToQuery","a","r","getLogger","h","o","constructor","baseURL","devicePixelRatio","maxTextureSize","_spriteImageFormat","_isRetina","_spritesData","image","width","height","loadStatus","spriteNames","push","sort","getSpriteInfo","load","_loadSprites","l","query","n","d","path","g","Promise","all","responseType","then","Object","keys","data","length","resolve","Math","max","error","document","createElement","getContext","drawImage","getImageData","Uint8Array","m"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../request.js\";import e from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{urlToObject as s,objectToQuery as a}from\"../../core/urlUtils.js\";const r=i.getLogger(\"esri.layers.support.SpriteSource\"),h=1.15;class o{constructor(t,e,i,s){this.baseURL=t,this.devicePixelRatio=e,this.maxTextureSize=i,this._spriteImageFormat=s,this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus=\"not-loaded\"}get spriteNames(){const t=[];for(const e in this._spritesData)t.push(e);return t.sort(),t}getSpriteInfo(t){return this._spritesData[t]}async load(t){if(this.baseURL){this.loadStatus=\"loading\";try{await this._loadSprites(t),this.loadStatus=\"loaded\"}catch{this.loadStatus=\"failed\"}}else this.loadStatus=\"failed\"}_loadSprites(i){this._isRetina=this.devicePixelRatio>h;const o=s(this.baseURL),l=o.query?\"?\"+a(o.query):\"\",n=this._isRetina?\"@2x\":\"\",d=`${o.path}${n}.${this._spriteImageFormat}${l}`,g=`${o.path}${n}.json${l}`;return Promise.all([t(g,i),t(d,{responseType:\"image\",...i})]).then((([t,i])=>{const s=Object.keys(t.data);if(!s||0===s.length||1===s.length&&\"_ssl\"===s[0]||!i||!i.data)return this._spritesData=this.image=null,this.width=this.height=0,Promise.resolve(null);this._spritesData=t.data;const a=i.data,h=Math.max(this.maxTextureSize,4096);if(a.width>h||a.height>h){const t=`Sprite resource for style ${o.path} is bigger than the maximum allowed of ${h} pixels}`;throw r.error(t),new e(\"SpriteSource\",t)}this.width=a.width,this.height=a.height;const l=document.createElement(\"canvas\"),n=l.getContext(\"2d\");l.width=a.width,l.height=a.height,n.drawImage(a,0,0,a.width,a.height);const d=n.getImageData(0,0,a.width,a.height),g=new Uint8Array(d.data);let m;for(let e=0;e<g.length;e+=4)m=g[e+3]/255,g[e]=g[e]*m,g[e+1]=g[e+1]*m,g[e+2]=g[e+2]*m;this.image=g}))}}export default o;\n"]},"metadata":{},"sourceType":"module"}