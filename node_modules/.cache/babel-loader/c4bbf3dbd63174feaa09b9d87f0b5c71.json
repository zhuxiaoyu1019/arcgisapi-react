{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Logger.js\";\nimport { isUint16Array as t, isUint32Array as i } from \"../../core/typedArrayUtil.js\";\nimport { checkWebGLError as s } from \"./checkWebGLError.js\";\nimport { ResourceType as r } from \"./enums.js\";\nconst n = e.getLogger(\"esri.views.webgl.BufferObject\");\n\nclass h {\n  constructor(e, t, i, n, h) {\n    this._context = e, this.bufferType = t, this.usage = i, this._glName = null, this._size = -1, this._indexType = void 0, e.instanceCounter.increment(r.Buffer, this), this._glName = this._context.gl.createBuffer(), s(this._context.gl), n && this.setData(n, h);\n  }\n\n  static createIndex(e, t, i, s) {\n    return new h(e, 34963, t, i, s);\n  }\n\n  static createVertex(e, t, i) {\n    return new h(e, 34962, t, i);\n  }\n\n  get glName() {\n    return this._glName;\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  get indexType() {\n    return this._indexType;\n  }\n\n  get byteSize() {\n    return 34962 === this.bufferType ? this._size : 5125 === this._indexType ? 4 * this._size : 2 * this._size;\n  }\n\n  dispose() {\n    var e;\n\n    if (null != (e = this._context) && e.gl) {\n      if (this._glName) {\n        this._context.gl.deleteBuffer(this._glName), this._glName = null;\n      }\n\n      this._context.instanceCounter.decrement(r.Buffer, this), this._context = null;\n    } else this._glName && n.warn(\"Leaked WebGL buffer object\");\n  }\n\n  setData(e, r) {\n    if (!e) return;\n\n    if (\"number\" == typeof e) {\n      if (e < 0 && n.error(\"Buffer size cannot be negative!\"), 34963 === this.bufferType && r) switch (this._indexType = r, this._size = e, r) {\n        case 5123:\n          e *= 2;\n          break;\n\n        case 5125:\n          e *= 4;\n      }\n    } else {\n      let s = e.byteLength;\n      t(e) && (s /= 2, this._indexType = 5123), i(e) && (s /= 4, this._indexType = 5125), this._size = s;\n    }\n\n    const h = this._context.getBoundVAO();\n\n    this._context.bindVAO(null), this._context.bindBuffer(this);\n    const o = this._context.gl;\n    o.bufferData(this.bufferType, e, this.usage), s(o), this._context.bindVAO(h);\n  }\n\n  setSubData(e, r = 0, h = 0, o = e.byteLength) {\n    if (!e) return;\n    (r < 0 || r >= this._size) && n.error(\"offset is out of range!\");\n    let f = r,\n        u = h,\n        c = o,\n        a = e.byteLength;\n    t(e) && (a /= 2, f *= 2, u *= 2, c *= 2), i(e) && (a /= 4, f *= 4, u *= 4, c *= 4), void 0 === o && (o = a - 1), h >= o && n.error(\"end must be bigger than start!\"), r + h - o > this._size && n.error(\"An attempt to write beyond the end of the buffer!\");\n\n    const _ = this._context.getBoundVAO();\n\n    this._context.bindVAO(null), this._context.bindBuffer(this);\n    const g = this._context.gl,\n          l = ArrayBuffer.isView(e) ? e.buffer : e,\n          b = 0 === u && c === e.byteLength ? l : l.slice(u, c);\n    g.bufferSubData(this.bufferType, f, b), s(g), this._context.bindVAO(_);\n  }\n\n}\n\nexport default h;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/webgl/BufferObject.js"],"names":["e","isUint16Array","t","isUint32Array","i","checkWebGLError","s","ResourceType","r","n","getLogger","h","constructor","_context","bufferType","usage","_glName","_size","_indexType","instanceCounter","increment","Buffer","gl","createBuffer","setData","createIndex","createVertex","glName","size","indexType","byteSize","dispose","deleteBuffer","decrement","warn","error","byteLength","getBoundVAO","bindVAO","bindBuffer","o","bufferData","setSubData","f","u","c","a","_","g","l","ArrayBuffer","isView","buffer","b","slice","bufferSubData"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Logger.js\";import{isUint16Array as t,isUint32Array as i}from\"../../core/typedArrayUtil.js\";import{checkWebGLError as s}from\"./checkWebGLError.js\";import{ResourceType as r}from\"./enums.js\";const n=e.getLogger(\"esri.views.webgl.BufferObject\");class h{constructor(e,t,i,n,h){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(r.Buffer,this),this._glName=this._context.gl.createBuffer(),s(this._context.gl),n&&this.setData(n,h)}static createIndex(e,t,i,s){return new h(e,34963,t,i,s)}static createVertex(e,t,i){return new h(e,34962,t,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}dispose(){var e;if(null!=(e=this._context)&&e.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(r.Buffer,this),this._context=null}else this._glName&&n.warn(\"Leaked WebGL buffer object\")}setData(e,r){if(!e)return;if(\"number\"==typeof e){if(e<0&&n.error(\"Buffer size cannot be negative!\"),34963===this.bufferType&&r)switch(this._indexType=r,this._size=e,r){case 5123:e*=2;break;case 5125:e*=4}}else{let s=e.byteLength;t(e)&&(s/=2,this._indexType=5123),i(e)&&(s/=4,this._indexType=5125),this._size=s}const h=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;o.bufferData(this.bufferType,e,this.usage),s(o),this._context.bindVAO(h)}setSubData(e,r=0,h=0,o=e.byteLength){if(!e)return;(r<0||r>=this._size)&&n.error(\"offset is out of range!\");let f=r,u=h,c=o,a=e.byteLength;t(e)&&(a/=2,f*=2,u*=2,c*=2),i(e)&&(a/=4,f*=4,u*=4,c*=4),void 0===o&&(o=a-1),h>=o&&n.error(\"end must be bigger than start!\"),r+h-o>this._size&&n.error(\"An attempt to write beyond the end of the buffer!\");const _=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const g=this._context.gl,l=ArrayBuffer.isView(e)?e.buffer:e,b=0===u&&c===e.byteLength?l:l.slice(u,c);g.bufferSubData(this.bufferType,f,b),s(g),this._context.bindVAO(_)}}export default h;\n"]},"metadata":{},"sourceType":"module"}