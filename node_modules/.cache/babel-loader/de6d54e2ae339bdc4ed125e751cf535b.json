{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Logger.js\";\nimport { clamp as t } from \"../../../../core/mathUtils.js\";\nimport { isSome as i } from \"../../../../core/maybe.js\";\nimport { createRenderScreenPointArray3 as s } from \"../../../../core/screenUtils.js\";\nimport { c as r } from \"../../../../chunks/vec2.js\";\nimport { s as a, f as n, d as o, a as u, b as l, g as c, l as p, i as h, m } from \"../../../../chunks/vec3.js\";\nimport { c as f } from \"../../../../chunks/vec3f64.js\";\nimport { distance2 as d, fromPoints as v, closestLineSegmentPoint as b, create as g } from \"../../../../geometry/support/lineSegment.js\";\nimport { fromPoints as C, signedDistance as S, normal as q, create as A } from \"../../../../geometry/support/plane.js\";\nimport { newLayout as y } from \"../../support/buffer/InterleavedLayout.js\";\nimport { computeAttachmentOriginLines as x } from \"../lib/geometryDataUtils.js\";\nimport z from \"../lib/GLMaterial.js\";\nimport { Material as E, materialParametersDefaults as j } from \"../lib/Material.js\";\nimport { isTranslationMatrix as P } from \"../lib/Util.js\";\nimport O from \"./VisualVariableMaterialParameters.js\";\nimport { isInstanceHidden as L } from \"./renderers/utils.js\";\nimport { ribbonVertexAttributeLocations as _, RibbonLineTechniqueConfiguration as R, RibbonLineTechnique as w } from \"../shaders/RibbonLineTechnique.js\";\nconst T = e.getLogger(\"esri.views.3d.webgl-engine.materials.RibbonLineMaterial\");\n\nclass M extends E {\n  constructor(e) {\n    super(e, D), this._vertexAttributeLocations = _, this.techniqueConfig = new R(), this.layout = this.createLayout();\n  }\n\n  isClosed(e, t) {\n    return B(this.params, e, t);\n  }\n\n  dispose() {}\n\n  getPassParameters() {\n    return this.params;\n  }\n\n  getTechniqueConfig(e, t) {\n    this.techniqueConfig.output = e;\n    const s = i(this.params.stipplePattern);\n    return this.techniqueConfig.stippleEnabled = s, this.techniqueConfig.stippleIntegerRepeatsEnabled = s && this.params.stippleIntegerRepeats, this.techniqueConfig.stippleOffColorEnabled = s && i(this.params.stippleOffColor), this.techniqueConfig.slicePlaneEnabled = this.params.slicePlaneEnabled, this.techniqueConfig.sceneHasOcludees = this.params.sceneHasOcludees, this.techniqueConfig.roundJoins = \"round\" === this.params.join, this.techniqueConfig.roundCaps = \"round\" === this.params.cap, this.techniqueConfig.transparent = this.params.transparent, this.techniqueConfig.polygonOffset = this.params.polygonOffset, this.techniqueConfig.writeDepth = this.params.writeDepth, this.techniqueConfig.vvColor = this.params.vvColorEnabled, this.techniqueConfig.vvOpacity = this.params.vvOpacityEnabled, this.techniqueConfig.vvSize = this.params.vvSizeEnabled, this.techniqueConfig.innerColorEnabled = this.params.innerWidth > 0 && i(this.params.innerColor), this.techniqueConfig.falloffEnabled = this.params.falloff > 0, this.techniqueConfig.occluder = 8 === this.params.renderOccluded, this.techniqueConfig.transparencyPassType = t ? t.transparencyPassType : 3, this.techniqueConfig.multipassTerrainEnabled = !!t && t.multipassTerrainEnabled, this.techniqueConfig.cullAboveGround = !!t && t.cullAboveGround, this.techniqueConfig;\n  }\n\n  intersect(e, t, i, s, r, a, n, o, u) {\n    u ? this.intersectDrapedLineGeometry(e, s, a, n) : this.intersectLineGeometry(e, t, i, s, this.params.width, n);\n  }\n\n  intersectDrapedLineGeometry(e, i, s, r) {\n    if (!i.options.selectionMode) return;\n    const a = e.vertexAttributes.get(\"position\").data,\n          n = e.vertexAttributes.get(\"size\");\n    let o = this.params.width;\n\n    if (this.params.vvSizeEnabled) {\n      const i = e.vertexAttributes.get(\"sizeFeatureAttribute\").data[0];\n      o *= t(this.params.vvSizeOffset[0] + i * this.params.vvSizeFactor[0], this.params.vvSizeMinSize[0], this.params.vvSizeMaxSize[0]);\n    } else n && (o *= n.data[0]);\n\n    const u = s[0],\n          l = s[1],\n          c = (o / 2 + 4) * e.screenToWorldRatio;\n    let p = Number.MAX_VALUE;\n\n    for (let h = 0; h < a.length - 5; h += 3) {\n      const e = a[h],\n            i = a[h + 1],\n            s = u - e,\n            r = l - i,\n            n = a[h + 3] - e,\n            o = a[h + 4] - i,\n            c = t((n * s + o * r) / (n * n + o * o), 0, 1),\n            m = n * c - s,\n            f = o * c - r,\n            d = m * m + f * f;\n      d < p && (p = d);\n    }\n\n    p < c * c && r();\n  }\n\n  intersectLineGeometry(e, i, s, m, f, g) {\n    if (!m.options.selectionMode || L(i)) return;\n    if (!P(s)) return void T.error(\"intersection assumes a translation-only matrix\");\n    const A = e.vertexAttributes,\n          y = A.get(\"position\").data;\n    let x = f;\n\n    if (this.params.vvSizeEnabled) {\n      const e = A.get(\"sizeFeatureAttribute\").data[0];\n      x *= t(this.params.vvSizeOffset[0] + e * this.params.vvSizeFactor[0], this.params.vvSizeMinSize[0], this.params.vvSizeMaxSize[0]);\n    } else A.has(\"size\") && (x *= A.get(\"size\").data[0]);\n\n    const z = m.camera,\n          E = X;\n    r(E, m.point);\n    const j = x * z.pixelRatio / 2 + 4 * z.pixelRatio;\n    a(re[0], E[0] - j, E[1] + j, 0), a(re[1], E[0] + j, E[1] + j, 0), a(re[2], E[0] + j, E[1] - j, 0), a(re[3], E[0] - j, E[1] - j, 0);\n\n    for (let t = 0; t < 4; t++) if (!z.unprojectFromRenderScreen(re[t], ae[t])) return;\n\n    C(z.eye, ae[0], ae[1], ne), C(z.eye, ae[1], ae[2], oe), C(z.eye, ae[2], ae[3], ue), C(z.eye, ae[3], ae[0], le);\n    let O = Number.MAX_VALUE;\n\n    const _ = V(this.params, A, e.indices) ? y.length - 2 : y.length - 5;\n\n    for (let t = 0; t < _; t += 3) {\n      W[0] = y[t] + s[12], W[1] = y[t + 1] + s[13], W[2] = y[t + 2] + s[14];\n      const e = (t + 3) % y.length;\n      if (k[0] = y[e] + s[12], k[1] = y[e + 1] + s[13], k[2] = y[e + 2] + s[14], S(ne, W) < 0 && S(ne, k) < 0 || S(oe, W) < 0 && S(oe, k) < 0 || S(ue, W) < 0 && S(ue, k) < 0 || S(le, W) < 0 && S(le, k) < 0) continue;\n\n      if (z.projectToRenderScreen(W, K), z.projectToRenderScreen(k, Q), K[2] < 0 && Q[2] > 0) {\n        n(I, W, k);\n        const e = z.frustum,\n              t = -S(e[4], W) / o(I, q(e[4]));\n        u(I, I, t), l(W, W, I), z.projectToRenderScreen(W, K);\n      } else if (K[2] > 0 && Q[2] < 0) {\n        n(I, k, W);\n        const e = z.frustum,\n              t = -S(e[4], k) / o(I, q(e[4]));\n        u(I, I, t), l(k, k, I), z.projectToRenderScreen(k, Q);\n      } else if (K[2] < 0 && Q[2] < 0) continue;\n\n      K[2] = 0, Q[2] = 0;\n      const i = d(v(K, Q, $), E);\n      i < O && (O = i, c(Y, W), c(Z, k));\n    }\n\n    const R = m.rayBeginPoint,\n          w = m.rayEndPoint;\n\n    if (O < j * j) {\n      let e = Number.MAX_VALUE;\n\n      if (b(v(Y, Z, $), v(R, w, ee), N)) {\n        n(N, N, R);\n        const t = p(N);\n        u(N, N, 1 / t), e = t / h(R, w);\n      }\n\n      g(e, N);\n    }\n  }\n\n  computeAttachmentOrigin(e, t) {\n    const i = e.vertexAttributes;\n    if (!i) return null;\n    const s = e.indices,\n          r = i.get(\"position\");\n    return x(r, s ? s.get(\"position\") : null, s && V(this.params, i, s), t);\n  }\n\n  createLayout() {\n    const e = y().vec3f(\"position\").f32(\"subdivisionFactor\").vec2f(\"uv0\").vec3f(\"auxpos1\").vec3f(\"auxpos2\");\n    return this.params.vvSizeEnabled ? e.f32(\"sizeFeatureAttribute\") : e.f32(\"size\"), this.params.vvColorEnabled ? e.f32(\"colorFeatureAttribute\") : e.vec4f(\"color\"), this.params.vvOpacityEnabled && e.f32(\"opacityFeatureAttribute\"), e;\n  }\n\n  createBufferWriter() {\n    return new G(this.layout, this.params);\n  }\n\n  getGLMaterial(e) {\n    return 0 === e.output || 7 === e.output || 4 === e.output || 1 === e.output ? new F(e) : void 0;\n  }\n\n  validateParameterValues(e) {\n    \"miter\" !== e.join && (e.miterLimit = 0), this.requiresTransparent(e) && (e.transparent = !0);\n  }\n\n  requiresTransparent(e) {\n    return !!((e.color && e.color[3]) < 1 || e.innerWidth > 0 && this.colorRequiresTransparent(e.innerColor) || e.stipplePattern && this.colorRequiresTransparent(e.stippleOffColor) || e.falloff > 0);\n  }\n\n  colorRequiresTransparent(e) {\n    return i(e) && e[3] < 1 && e[3] > 0;\n  }\n\n}\n\nclass F extends z {\n  constructor(e) {\n    super(e), this.updateParameters();\n  }\n\n  updateParameters(e) {\n    this._technique = this._techniqueRep.releaseAndAcquire(w, this._material.getTechniqueConfig(this._output, e), this._technique);\n  }\n\n  beginSlot(e) {\n    return this._technique.configuration.occluder ? 3 === e || 10 === e || 11 === e : 0 === this._output || 7 === this._output ? (this.targetSlot = this._technique.configuration.writeDepth ? 5 : 8, e === this.targetSlot) : 3 === e;\n  }\n\n  _updateOccludeeState(e) {\n    e.hasOccludees !== this._material.params.sceneHasOcludees && this._material.setParameterValues({\n      sceneHasOcludees: e.hasOccludees\n    });\n  }\n\n  ensureParameters(e) {\n    0 !== this._output && 7 !== this._output || this._updateOccludeeState(e), this.updateParameters(e);\n  }\n\n  bind(e) {\n    this._technique.bindPass(this._material.getPassParameters(), e);\n  }\n\n  getPipelineState(e, t) {\n    return this._technique.getPipelineState(e, t);\n  }\n\n}\n\nconst D = {\n  width: 0,\n  color: [1, 1, 1, 1],\n  join: \"miter\",\n  cap: \"butt\",\n  miterLimit: 5,\n  writeDepth: !0,\n  polygonOffset: !1,\n  stipplePattern: null,\n  stippleIntegerRepeats: !1,\n  stippleOffColor: null,\n  slicePlaneEnabled: !1,\n  vvFastUpdate: !1,\n  transparent: !1,\n  isClosed: !1,\n  falloff: 0,\n  innerWidth: 0,\n  innerColor: null,\n  sceneHasOcludees: !1,\n  ...j,\n  ...O.Default\n};\n\nclass G {\n  constructor(e, t) {\n    switch (this.params = t, this.numJoinSubdivisions = 0, this.vertexBufferLayout = e, this.params.join) {\n      case \"miter\":\n      case \"bevel\":\n        this.numJoinSubdivisions = t.stipplePattern ? 1 : 0;\n        break;\n\n      case \"round\":\n        this.numJoinSubdivisions = H;\n    }\n  }\n\n  isClosed(e) {\n    return V(this.params, e.vertexAttributes, e.indices);\n  }\n\n  numCapSubdivisions(e) {\n    if (this.isClosed(e)) return 0;\n\n    switch (this.params.cap) {\n      case \"butt\":\n        return 0;\n\n      case \"square\":\n        return 1;\n\n      case \"round\":\n        return J;\n    }\n  }\n\n  allocate(e) {\n    return this.vertexBufferLayout.createBuffer(e);\n  }\n\n  elementCount(e) {\n    const t = 2 * this.numCapSubdivisions(e) + 2,\n          i = e.indices.get(\"position\").length / 2 + 1,\n          s = this.isClosed(e);\n    let r = s ? 2 : 2 * t;\n    const a = s ? 0 : 1,\n          n = s ? i : i - 1;\n\n    if (e.vertexAttributes.has(\"subdivisions\")) {\n      const t = e.vertexAttributes.get(\"subdivisions\").data;\n\n      for (let e = a; e < n; ++e) {\n        r += 4 + 2 * t[e];\n      }\n    } else {\n      r += (n - a) * (2 * this.numJoinSubdivisions + 4);\n    }\n\n    return r += 2, r;\n  }\n\n  write(e, t, i, s) {\n    const r = te,\n          n = ie,\n          o = se,\n          u = t.vertexAttributes.get(\"position\").data,\n          l = t.indices && t.indices.get(\"position\"),\n          p = this.numCapSubdivisions(t);\n    l && l.length !== 2 * (u.length / 3 - 1) && console.warn(\"RibbonLineMaterial does not support indices\");\n    let h = null;\n    t.vertexAttributes.has(\"subdivisions\") && (h = t.vertexAttributes.get(\"subdivisions\").data);\n    let f = 1,\n        d = 0;\n    this.params.vvSizeEnabled ? d = t.vertexAttributes.get(\"sizeFeatureAttribute\").data[0] : t.vertexAttributes.has(\"size\") && (f = t.vertexAttributes.get(\"size\").data[0]);\n    let v = [1, 1, 1, 1],\n        b = 0;\n    this.params.vvColorEnabled ? b = t.vertexAttributes.get(\"colorFeatureAttribute\").data[0] : t.vertexAttributes.has(\"color\") && (v = t.vertexAttributes.get(\"color\").data);\n    let g = 0;\n    this.params.vvOpacityEnabled && (g = t.vertexAttributes.get(\"opacityFeatureAttribute\").data[0]);\n    const C = u.length / 3,\n          S = e.transformation,\n          q = new Float32Array(i.buffer),\n          A = this.vertexBufferLayout.stride / 4;\n    let y = s * A;\n\n    const x = y,\n          z = (e, t, i, s, r, a, n) => {\n      if (q[y++] = t[0], q[y++] = t[1], q[y++] = t[2], q[y++] = s, q[y++] = r, q[y++] = a, q[y++] = e[0], q[y++] = e[1], q[y++] = e[2], q[y++] = i[0], q[y++] = i[1], q[y++] = i[2], this.params.vvSizeEnabled ? q[y++] = d : q[y++] = f, this.params.vvColorEnabled) q[y++] = b;else {\n        const e = Math.min(4 * n, v.length - 4);\n        q[y++] = v[e + 0], q[y++] = v[e + 1], q[y++] = v[e + 2], q[y++] = v[e + 3];\n      }\n      this.params.vvOpacityEnabled && (q[y++] = g);\n    };\n\n    y += A, a(n, u[0], u[1], u[2]), S && m(n, n, S);\n    const E = this.isClosed(t);\n\n    if (E) {\n      const e = u.length - 3;\n      a(r, u[e], u[e + 1], u[e + 2]), S && m(r, r, S);\n    } else {\n      c(r, n), a(o, u[3], u[4], u[5]), S && m(o, o, S);\n\n      for (let e = 0; e < p; ++e) {\n        const t = 1 - e / p;\n        z(r, n, o, t, 1, -4, 0), z(r, n, o, t, 1, 4, 0);\n      }\n\n      z(r, n, o, 0, 0, -4, 0), z(r, n, o, 0, 0, 4, 0), c(r, n), c(n, o);\n    }\n\n    const j = E ? C : C - 1;\n\n    for (let P = E ? 0 : 1; P < j; P++) {\n      const e = (P + 1) % C * 3;\n      a(o, u[e + 0], u[e + 1], u[e + 2]), S && m(o, o, S), z(r, n, o, 0, 1, -1, P), z(r, n, o, 0, 1, 1, P);\n      const t = h ? h[P] : this.numJoinSubdivisions;\n\n      for (let i = 0; i < t; ++i) {\n        const e = (i + 1) / (t + 1);\n        z(r, n, o, e, 1, -2, P), z(r, n, o, e, 1, 2, P);\n      }\n\n      z(r, n, o, 1, 0, -2, P), z(r, n, o, 1, 0, 2, P), c(r, n), c(n, o);\n    }\n\n    if (E) {\n      y = U(q, x + A, q, y, 2 * A);\n    } else {\n      z(r, n, o, 0, 1, -5, j), z(r, n, o, 0, 1, 5, j);\n\n      for (let e = 0; e < p; ++e) {\n        const t = (e + 1) / p;\n        z(r, n, o, t, 1, -5, j), z(r, n, o, t, 1, 5, j);\n      }\n    }\n\n    U(q, x + A, q, x, A);\n    y = U(q, y - A, q, y, A);\n  }\n\n}\n\nfunction U(e, t, i, s, r) {\n  for (let a = 0; a < r; a++) i[s++] = e[t++];\n\n  return s;\n}\n\nfunction V(e, t, i) {\n  return B(e, t.get(\"position\").data, i ? i.get(\"position\") : null);\n}\n\nfunction B(e, t, i) {\n  return !!e.isClosed && (i ? i.length > 2 : t.length > 6);\n}\n\nconst J = 3,\n      H = 1,\n      W = f(),\n      k = f(),\n      I = f(),\n      N = f(),\n      X = f(),\n      K = s(),\n      Q = s(),\n      Y = f(),\n      Z = f(),\n      $ = g(),\n      ee = g(),\n      te = f(),\n      ie = f(),\n      se = f(),\n      re = [s(), s(), s(), s()],\n      ae = [f(), f(), f(), f()],\n      ne = A(),\n      oe = A(),\n      ue = A(),\n      le = A();\nexport { M as RibbonLineMaterial };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/materials/RibbonLineMaterial.js"],"names":["e","clamp","t","isSome","i","createRenderScreenPointArray3","s","c","r","a","f","n","d","o","u","b","l","g","p","h","m","distance2","fromPoints","v","closestLineSegmentPoint","create","C","signedDistance","S","normal","q","A","newLayout","y","computeAttachmentOriginLines","x","z","Material","E","materialParametersDefaults","j","isTranslationMatrix","P","O","isInstanceHidden","L","ribbonVertexAttributeLocations","_","RibbonLineTechniqueConfiguration","R","RibbonLineTechnique","w","T","getLogger","M","constructor","D","_vertexAttributeLocations","techniqueConfig","layout","createLayout","isClosed","B","params","dispose","getPassParameters","getTechniqueConfig","output","stipplePattern","stippleEnabled","stippleIntegerRepeatsEnabled","stippleIntegerRepeats","stippleOffColorEnabled","stippleOffColor","slicePlaneEnabled","sceneHasOcludees","roundJoins","join","roundCaps","cap","transparent","polygonOffset","writeDepth","vvColor","vvColorEnabled","vvOpacity","vvOpacityEnabled","vvSize","vvSizeEnabled","innerColorEnabled","innerWidth","innerColor","falloffEnabled","falloff","occluder","renderOccluded","transparencyPassType","multipassTerrainEnabled","cullAboveGround","intersect","intersectDrapedLineGeometry","intersectLineGeometry","width","options","selectionMode","vertexAttributes","get","data","vvSizeOffset","vvSizeFactor","vvSizeMinSize","vvSizeMaxSize","screenToWorldRatio","Number","MAX_VALUE","length","error","has","camera","X","point","pixelRatio","re","unprojectFromRenderScreen","ae","eye","ne","oe","ue","le","V","indices","W","k","projectToRenderScreen","K","Q","I","frustum","$","Y","Z","rayBeginPoint","rayEndPoint","ee","N","computeAttachmentOrigin","vec3f","f32","vec2f","vec4f","createBufferWriter","G","getGLMaterial","F","validateParameterValues","miterLimit","requiresTransparent","color","colorRequiresTransparent","updateParameters","_technique","_techniqueRep","releaseAndAcquire","_material","_output","beginSlot","configuration","targetSlot","_updateOccludeeState","hasOccludees","setParameterValues","ensureParameters","bind","bindPass","getPipelineState","vvFastUpdate","Default","numJoinSubdivisions","vertexBufferLayout","H","numCapSubdivisions","J","allocate","createBuffer","elementCount","write","te","ie","se","console","warn","transformation","Float32Array","buffer","stride","Math","min","U","RibbonLineMaterial"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Logger.js\";import{clamp as t}from\"../../../../core/mathUtils.js\";import{isSome as i}from\"../../../../core/maybe.js\";import{createRenderScreenPointArray3 as s}from\"../../../../core/screenUtils.js\";import{c as r}from\"../../../../chunks/vec2.js\";import{s as a,f as n,d as o,a as u,b as l,g as c,l as p,i as h,m}from\"../../../../chunks/vec3.js\";import{c as f}from\"../../../../chunks/vec3f64.js\";import{distance2 as d,fromPoints as v,closestLineSegmentPoint as b,create as g}from\"../../../../geometry/support/lineSegment.js\";import{fromPoints as C,signedDistance as S,normal as q,create as A}from\"../../../../geometry/support/plane.js\";import{newLayout as y}from\"../../support/buffer/InterleavedLayout.js\";import{computeAttachmentOriginLines as x}from\"../lib/geometryDataUtils.js\";import z from\"../lib/GLMaterial.js\";import{Material as E,materialParametersDefaults as j}from\"../lib/Material.js\";import{isTranslationMatrix as P}from\"../lib/Util.js\";import O from\"./VisualVariableMaterialParameters.js\";import{isInstanceHidden as L}from\"./renderers/utils.js\";import{ribbonVertexAttributeLocations as _,RibbonLineTechniqueConfiguration as R,RibbonLineTechnique as w}from\"../shaders/RibbonLineTechnique.js\";const T=e.getLogger(\"esri.views.3d.webgl-engine.materials.RibbonLineMaterial\");class M extends E{constructor(e){super(e,D),this._vertexAttributeLocations=_,this.techniqueConfig=new R,this.layout=this.createLayout()}isClosed(e,t){return B(this.params,e,t)}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e,t){this.techniqueConfig.output=e;const s=i(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=s,this.techniqueConfig.stippleIntegerRepeatsEnabled=s&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=s&&i(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins=\"round\"===this.params.join,this.techniqueConfig.roundCaps=\"round\"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&i(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,s,r,a,n,o,u){u?this.intersectDrapedLineGeometry(e,s,a,n):this.intersectLineGeometry(e,t,i,s,this.params.width,n)}intersectDrapedLineGeometry(e,i,s,r){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(\"position\").data,n=e.vertexAttributes.get(\"size\");let o=this.params.width;if(this.params.vvSizeEnabled){const i=e.vertexAttributes.get(\"sizeFeatureAttribute\").data[0];o*=t(this.params.vvSizeOffset[0]+i*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else n&&(o*=n.data[0]);const u=s[0],l=s[1],c=(o/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE;for(let h=0;h<a.length-5;h+=3){const e=a[h],i=a[h+1],s=u-e,r=l-i,n=a[h+3]-e,o=a[h+4]-i,c=t((n*s+o*r)/(n*n+o*o),0,1),m=n*c-s,f=o*c-r,d=m*m+f*f;d<p&&(p=d)}p<c*c&&r()}intersectLineGeometry(e,i,s,m,f,g){if(!m.options.selectionMode||L(i))return;if(!P(s))return void T.error(\"intersection assumes a translation-only matrix\");const A=e.vertexAttributes,y=A.get(\"position\").data;let x=f;if(this.params.vvSizeEnabled){const e=A.get(\"sizeFeatureAttribute\").data[0];x*=t(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else A.has(\"size\")&&(x*=A.get(\"size\").data[0]);const z=m.camera,E=X;r(E,m.point);const j=x*z.pixelRatio/2+4*z.pixelRatio;a(re[0],E[0]-j,E[1]+j,0),a(re[1],E[0]+j,E[1]+j,0),a(re[2],E[0]+j,E[1]-j,0),a(re[3],E[0]-j,E[1]-j,0);for(let t=0;t<4;t++)if(!z.unprojectFromRenderScreen(re[t],ae[t]))return;C(z.eye,ae[0],ae[1],ne),C(z.eye,ae[1],ae[2],oe),C(z.eye,ae[2],ae[3],ue),C(z.eye,ae[3],ae[0],le);let O=Number.MAX_VALUE;const _=V(this.params,A,e.indices)?y.length-2:y.length-5;for(let t=0;t<_;t+=3){W[0]=y[t]+s[12],W[1]=y[t+1]+s[13],W[2]=y[t+2]+s[14];const e=(t+3)%y.length;if(k[0]=y[e]+s[12],k[1]=y[e+1]+s[13],k[2]=y[e+2]+s[14],S(ne,W)<0&&S(ne,k)<0||S(oe,W)<0&&S(oe,k)<0||S(ue,W)<0&&S(ue,k)<0||S(le,W)<0&&S(le,k)<0)continue;if(z.projectToRenderScreen(W,K),z.projectToRenderScreen(k,Q),K[2]<0&&Q[2]>0){n(I,W,k);const e=z.frustum,t=-S(e[4],W)/o(I,q(e[4]));u(I,I,t),l(W,W,I),z.projectToRenderScreen(W,K)}else if(K[2]>0&&Q[2]<0){n(I,k,W);const e=z.frustum,t=-S(e[4],k)/o(I,q(e[4]));u(I,I,t),l(k,k,I),z.projectToRenderScreen(k,Q)}else if(K[2]<0&&Q[2]<0)continue;K[2]=0,Q[2]=0;const i=d(v(K,Q,$),E);i<O&&(O=i,c(Y,W),c(Z,k))}const R=m.rayBeginPoint,w=m.rayEndPoint;if(O<j*j){let e=Number.MAX_VALUE;if(b(v(Y,Z,$),v(R,w,ee),N)){n(N,N,R);const t=p(N);u(N,N,1/t),e=t/h(R,w)}g(e,N)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const s=e.indices,r=i.get(\"position\");return x(r,s?s.get(\"position\"):null,s&&V(this.params,i,s),t)}createLayout(){const e=y().vec3f(\"position\").f32(\"subdivisionFactor\").vec2f(\"uv0\").vec3f(\"auxpos1\").vec3f(\"auxpos2\");return this.params.vvSizeEnabled?e.f32(\"sizeFeatureAttribute\"):e.f32(\"size\"),this.params.vvColorEnabled?e.f32(\"colorFeatureAttribute\"):e.vec4f(\"color\"),this.params.vvOpacityEnabled&&e.f32(\"opacityFeatureAttribute\"),e}createBufferWriter(){return new G(this.layout,this.params)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new F(e):void 0}validateParameterValues(e){\"miter\"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return i(e)&&e[3]<1&&e[3]>0}}class F extends z{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(w,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return this._technique.configuration.occluder?3===e||10===e||11===e:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(e,t)}}const D={width:0,color:[1,1,1,1],join:\"miter\",cap:\"butt\",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...j,...O.Default};class G{constructor(e,t){switch(this.params=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,this.params.join){case\"miter\":case\"bevel\":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case\"round\":this.numJoinSubdivisions=H}}isClosed(e){return V(this.params,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.params.cap){case\"butt\":return 0;case\"square\":return 1;case\"round\":return J}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,i=e.indices.get(\"position\").length/2+1,s=this.isClosed(e);let r=s?2:2*t;const a=s?0:1,n=s?i:i-1;if(e.vertexAttributes.has(\"subdivisions\")){const t=e.vertexAttributes.get(\"subdivisions\").data;for(let e=a;e<n;++e){r+=4+2*t[e]}}else{r+=(n-a)*(2*this.numJoinSubdivisions+4)}return r+=2,r}write(e,t,i,s){const r=te,n=ie,o=se,u=t.vertexAttributes.get(\"position\").data,l=t.indices&&t.indices.get(\"position\"),p=this.numCapSubdivisions(t);l&&l.length!==2*(u.length/3-1)&&console.warn(\"RibbonLineMaterial does not support indices\");let h=null;t.vertexAttributes.has(\"subdivisions\")&&(h=t.vertexAttributes.get(\"subdivisions\").data);let f=1,d=0;this.params.vvSizeEnabled?d=t.vertexAttributes.get(\"sizeFeatureAttribute\").data[0]:t.vertexAttributes.has(\"size\")&&(f=t.vertexAttributes.get(\"size\").data[0]);let v=[1,1,1,1],b=0;this.params.vvColorEnabled?b=t.vertexAttributes.get(\"colorFeatureAttribute\").data[0]:t.vertexAttributes.has(\"color\")&&(v=t.vertexAttributes.get(\"color\").data);let g=0;this.params.vvOpacityEnabled&&(g=t.vertexAttributes.get(\"opacityFeatureAttribute\").data[0]);const C=u.length/3,S=e.transformation,q=new Float32Array(i.buffer),A=this.vertexBufferLayout.stride/4;let y=s*A;const x=y,z=(e,t,i,s,r,a,n)=>{if(q[y++]=t[0],q[y++]=t[1],q[y++]=t[2],q[y++]=s,q[y++]=r,q[y++]=a,q[y++]=e[0],q[y++]=e[1],q[y++]=e[2],q[y++]=i[0],q[y++]=i[1],q[y++]=i[2],this.params.vvSizeEnabled?q[y++]=d:q[y++]=f,this.params.vvColorEnabled)q[y++]=b;else{const e=Math.min(4*n,v.length-4);q[y++]=v[e+0],q[y++]=v[e+1],q[y++]=v[e+2],q[y++]=v[e+3]}this.params.vvOpacityEnabled&&(q[y++]=g)};y+=A,a(n,u[0],u[1],u[2]),S&&m(n,n,S);const E=this.isClosed(t);if(E){const e=u.length-3;a(r,u[e],u[e+1],u[e+2]),S&&m(r,r,S)}else{c(r,n),a(o,u[3],u[4],u[5]),S&&m(o,o,S);for(let e=0;e<p;++e){const t=1-e/p;z(r,n,o,t,1,-4,0),z(r,n,o,t,1,4,0)}z(r,n,o,0,0,-4,0),z(r,n,o,0,0,4,0),c(r,n),c(n,o)}const j=E?C:C-1;for(let P=E?0:1;P<j;P++){const e=(P+1)%C*3;a(o,u[e+0],u[e+1],u[e+2]),S&&m(o,o,S),z(r,n,o,0,1,-1,P),z(r,n,o,0,1,1,P);const t=h?h[P]:this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);z(r,n,o,e,1,-2,P),z(r,n,o,e,1,2,P)}z(r,n,o,1,0,-2,P),z(r,n,o,1,0,2,P),c(r,n),c(n,o)}if(E){y=U(q,x+A,q,y,2*A)}else{z(r,n,o,0,1,-5,j),z(r,n,o,0,1,5,j);for(let e=0;e<p;++e){const t=(e+1)/p;z(r,n,o,t,1,-5,j),z(r,n,o,t,1,5,j)}}U(q,x+A,q,x,A);y=U(q,y-A,q,y,A)}}function U(e,t,i,s,r){for(let a=0;a<r;a++)i[s++]=e[t++];return s}function V(e,t,i){return B(e,t.get(\"position\").data,i?i.get(\"position\"):null)}function B(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const J=3,H=1,W=f(),k=f(),I=f(),N=f(),X=f(),K=s(),Q=s(),Y=f(),Z=f(),$=g(),ee=g(),te=f(),ie=f(),se=f(),re=[s(),s(),s(),s()],ae=[f(),f(),f(),f()],ne=A(),oe=A(),ue=A(),le=A();export{M as RibbonLineMaterial};\n"]},"metadata":{},"sourceType":"module"}