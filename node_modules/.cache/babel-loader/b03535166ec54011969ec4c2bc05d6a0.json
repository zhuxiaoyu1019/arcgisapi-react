{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport \"../../../../symbols.js\";\nimport { result as t } from \"../../../../core/asyncUtils.js\";\nimport r from \"../../../../core/has.js\";\nimport i from \"../../../../core/Error.js\";\nimport { isSome as s, get as a, isNone as o, unwrap as n } from \"../../../../core/maybe.js\";\nimport { throwIfAbortError as l, throwIfAborted as c } from \"../../../../core/promiseUtils.js\";\nimport { pt2px as h, px2pt as m } from \"../../../../core/screenUtils.js\";\nimport { dataComponents as u, isSVG as d } from \"../../../../core/urlUtils.js\";\nimport { c as _ } from \"../../../../chunks/mat4f64.js\";\nimport { f as p, a as f } from \"../../../../chunks/vec2f64.js\";\nimport { Z as y, O as g, f as x } from \"../../../../chunks/vec3f64.js\";\nimport { c as b } from \"../../../../chunks/vec4.js\";\nimport { f as S, c as v } from \"../../../../chunks/vec4f64.js\";\nimport { projectPointToVector as z } from \"../../../../geometry/projection.js\";\nimport { containsPoint as P } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { createRendererExpression as R } from \"../../../../support/arcadeOnDemand.js\";\nimport { defaultPrimitive as M } from \"../../../../symbols/support/IconSymbol3DLayerResource.js\";\nimport { getIconHref as w } from \"../../../../symbols/support/utils.js\";\nimport C from \"../../../2d/arcade/callExpressionWithFeature.js\";\nimport { TRANSPARENT_UNIT as I } from \"./constants.js\";\nimport { perObjectElevationAligner as j } from \"./ElevationAligners.js\";\nimport { elevationModeChangeUpdateType as T, SymbolUpdateType as E, needsElevationUpdates2D as O } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as L } from \"./ElevationContext.js\";\nimport F from \"./Graphics3DDrapedGraphicLayer.js\";\nimport { Graphics3DObject3DGraphicLayer as D } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as U } from \"./Graphics3DSymbolLayer.js\";\nimport { validateSymbolLayerSize as G, namedAnchorToHUDMaterialAnchorPos as A } from \"./graphicUtils.js\";\nimport { placePointOnGeometry as V, createStageObjectForHUD as k, extendPointGraphicElevationContext as B } from \"./pointUtils.js\";\nimport { createTriangle as N, createX as q, createCross as H, createKite as W, createSquare as Z, createCircle as $ } from \"./sdfPrimitives.js\";\nimport { initFastSymbolUpdatesState as J, updateFastSymbolUpdatesState as K, evaluateModelTransform as Q } from \"../support/FastSymbolUpdates.js\";\nimport { DRAPED_Z as X } from \"../../terrain/OverlayRenderer.js\";\nimport Y from \"../../webgl-engine/lib/GeometryUtil.js\";\nimport { RenderGeometry as ee } from \"../../webgl-engine/lib/RenderGeometry.js\";\nimport { Texture as te } from \"../../webgl-engine/lib/Texture.js\";\nimport { HUDMaterial as re } from \"../../webgl-engine/materials/HUDMaterial.js\";\nimport ie from \"../../../../symbols/CIMSymbol.js\";\n\nconst se = _(),\n      ae = x(0, 0, 1),\n      oe = 16,\n      ne = 1.5,\n      le = 128,\n      ce = .5,\n      he = [ce / 2, ce / 2, 1 - ce / 2, 1 - ce / 2],\n      me = [le * ce, le * ce];\n\nclass ue extends U {\n  constructor(e, t, r, i) {\n    super(e, t, r, i), this._cimLayers = null, this._cimSymbolMaterials = new Map(), this._cimSymbolTextures = new Map(), this._cimMaterialParametersInfo = null, this._cimRequiredFields = null, this._cimScaleFactorOrFunction = null, this._size = null, this._symbolTextureRatio = 1, this._outlineSize = 0, this._texture = null, this._releaseTexture = null, this._elevationOptions = {\n      supportsOffsetAdjustment: !0,\n      supportsOnTheGround: !0\n    };\n  }\n\n  getCachedSize() {\n    return {\n      size: this._getIconSize()\n    };\n  }\n\n  async doLoad(e) {\n    this._validateOrThrow();\n\n    const t = this._prepareMaterialParameters(),\n          r = this._getPrimitive();\n\n    if (s(r)) this._prepareResourcesPrimitive(t, r);else {\n      const r = w(this.symbol, this.symbolLayer),\n            i = u(r);\n      i && \"application/json\" === i.mediaType ? await this._prepareResourcesCIM(t, JSON.parse(i.data), e) : await this._prepareResourcesHref(t, r, e);\n    }\n  }\n\n  _validateOrThrow() {\n    if (this._drivenProperties.size) return;\n    const e = G(this._getIconSize());\n    if (e) throw new i(\"graphics3diconsymbollayer:invalid-size\", e);\n  }\n\n  _getIconSize() {\n    const e = this.symbolLayer,\n          t = Math.round(null != e.size ? h(e.size) : oe);\n    return this._drivenProperties.size ? Math.max(t, 64) : t;\n  }\n\n  _generateTextureCIM(e) {\n    const t = this._getGraphicHash(e);\n\n    let r = \"\" === t ? null : this._cimSymbolTextures.get(t);\n\n    if (!r) {\n      const i = {\n        scaleFactor: this._cimScaleFactorOrFunction\n      },\n            s = this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers, e, \"esriGeometryPoint\", i, null, null);\n\n      this._cimMaterialParametersInfo.anchorPos = this._getAnchorPos(\"relative\", s.anchorPosition);\n      const a = {\n        width: s.imageData.width,\n        height: s.imageData.height,\n        powerOfTwoResizeMode: 2\n      };\n      r = new te(s.imageData, a), this._cimSymbolTextures.set(t, r), this._context.stage.add(r);\n    }\n\n    return r;\n  }\n\n  _computeSize(e, t) {\n    const r = e.width / e.height;\n    return r > 1 ? [t, Math.round(t / r)] : [Math.round(t * r), t];\n  }\n\n  _prepareMaterialParameters() {\n    const e = {\n      anchorPos: this._getAnchorPos(this.symbolLayer.anchor, this.symbolLayer.anchorPosition)\n    },\n          t = this.symbol;\n\n    if (de(t)) {\n      const {\n        screenLength: r,\n        minWorldLength: i,\n        maxWorldLength: s\n      } = t.verticalOffset;\n      e.verticalOffset = {\n        screenLength: h(r),\n        minWorldLength: i || 0,\n        maxWorldLength: null != s ? s : 1 / 0\n      };\n    }\n\n    return this._context.screenSizePerspectiveEnabled && (e.screenSizePerspective = this._context.sharedResources.screenSizePerspectiveSettings), e.occlusionTest = !0, e.slicePlaneEnabled = this._context.slicePlaneEnabled, e;\n  }\n\n  _prepareResourcesPrimitive(e, t) {\n    const r = this._getOutlineSize();\n\n    if (_e(t) && 0 === r) throw new Error(\"Nothing to render\");\n    this._outlineSize = r, e.color = this._getFillColor(), e.outlineColor = this._getOutlineColor(), e.outlineSize = this._outlineSize;\n\n    const i = this._context.sharedResources.textures.fromData(t, () => pe(t));\n\n    this._texture = i.texture, this._releaseTexture = () => this._context.sharedResources.textures.release(i.uid), e.textureIsSignedDistanceField = !0, e.distanceFieldBoundingBox = he, e.textureId = this._texture.id;\n\n    const s = this._getIconSize();\n\n    this._size = [s, s], this._symbolTextureRatio = 1 / ce, this._createMaterialAndAddToStage(e, this._context.stage);\n  }\n\n  async _prepareResourcesHref(e, s, a) {\n    if (!r(\"esri-canvas-svg-support\") && d(s)) {\n      throw new i(\"graphics3diconsymbollayer:unsupported-image-format\", \"IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)\");\n    }\n\n    this._outlineSize = this._getOutlineSize(), e.color = this._getFillColor(), e.outlineColor = this._getOutlineColor(), e.outlineSize = this._outlineSize, e.textureIsSignedDistanceField = !1;\n\n    const o = this._getIconSize(),\n          n = o * this._context.layerView.view.pixelRatio,\n          c = await t(this._context.sharedResources.textures.fromUrl(s, n, {\n      signal: a\n    }));\n\n    if (!1 === c.ok) {\n      l(c.error);\n      throw new i(\"graphics3diconsymbollayer:request-failed\", `Failed to load (Request for icon resource failed: ${s})`);\n    }\n\n    const {\n      uid: h,\n      texture: m\n    } = c.value;\n\n    this._releaseTexture = () => this._context.sharedResources.textures.release(h);\n\n    const u = m.params;\n    this._size = this._computeSize(u, o), e.textureId = m.id, this._createMaterialAndAddToStage(e, this._context.stage);\n  }\n\n  async _prepareResourcesCIM(e, t, r) {\n    const i = new ie({\n      data: t\n    });\n\n    if (!this._context.sharedResources.cimSymbolRasterizer) {\n      const e = (await import(\"../../../../symbols/cim/CIMSymbolRasterizer.js\")).CIMSymbolRasterizer;\n      c(r), this._context.sharedResources.cimSymbolRasterizer || (this._context.sharedResources.cimSymbolRasterizer = new e(this._context.renderCoordsHelper.spatialReference, !0));\n    }\n\n    const s = this._context.layer.fields ? this._context.layer.fields.map(e => e.toJSON()) : null;\n    let a, o;\n\n    if (this._cimLayers = await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(i, s, this._context.renderer && \"dictionary\" === this._context.renderer.type ? this._context.renderer.fieldMap : null, \"esriGeometryPoint\", {\n      signal: r\n    }), this._context.renderer && \"dictionary\" === this._context.renderer.type && this._context.renderer.scaleExpression) {\n      const e = this._context.renderer;\n\n      if (isNaN(e.scaleExpression)) {\n        const t = e.scaleExpression,\n              r = await R(t, this._context.layer.spatialReference, s);\n\n        o = (e, t, i) => {\n          const s = C(r, e, {\n            $view: i\n          }, \"esriGeometryPoint\", t);\n          return null !== s ? s : 1;\n        };\n      } else a = Number(e.scaleExpression);\n    }\n\n    this._cimScaleFactorOrFunction = a || o || 1;\n    const n = this._context.renderer ? await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex) : [];\n    c(r);\n    const l = this._context.layer.fieldsIndex;\n    this._cimRequiredFields = n.map(e => l.get(e).name), this._cimMaterialParametersInfo = e, this._cimMaterialParametersInfo.color = this._getFillColor(), this._cimMaterialParametersInfo.outlineColor = [0, 0, 0, 0], this._cimMaterialParametersInfo.outlineSize = 0, this._cimMaterialParametersInfo.textureIsSignedDistanceField = !1;\n  }\n\n  _getPrimitive() {\n    return this.symbolLayer.resource && this.symbolLayer.resource.href ? null : this.symbolLayer.resource && this.symbolLayer.resource.primitive || M;\n  }\n\n  _getOutlineSize() {\n    let e = 0;\n    const t = this.symbolLayer;\n    if (s(t.outline) && null != t.outline.size) return Math.max(h(t.outline.size), 0);\n    return e = _e(this._getPrimitive()) ? ne : 0, Math.max(e, 0);\n  }\n\n  _getOutlineColor() {\n    const t = this._getLayerOpacity(),\n          r = this.symbolLayer,\n          i = a(r, \"outline\", \"color\");\n\n    if (s(i)) {\n      const r = e.toUnitRGB(i),\n            s = i.a * t;\n      return [r[0], r[1], r[2], s];\n    }\n\n    return [0, 0, 0, 0];\n  }\n\n  _getFillColor() {\n    if (_e(this._getPrimitive())) return I;\n    const e = o(this._getPrimitive()),\n          t = a(this.symbolLayer, \"material\", \"color\");\n    return this._getCombinedOpacityAndColor(t, {\n      hasIntrinsicColor: e\n    });\n  }\n\n  _getAnchorPos(e, t) {\n    return \"relative\" === e ? p((t.x || 0) + .5, .5 - (t.y || 0)) : e in A ? A[e] : A.center;\n  }\n\n  _createMaterialAndAddToStage(e, t) {\n    if (this._cimLayers ? this._fastUpdates = {\n      enabled: !1\n    } : this._fastUpdates = J(this._context.renderer, this._fastVisualVariableConvertOptions()), this._fastUpdates.enabled && Object.assign(e, this._fastUpdates.materialParameters), this._cimLayers) {\n      let r = this._cimSymbolMaterials.get(e.textureId);\n\n      return r || (r = new re(e), this._cimSymbolMaterials.set(e.textureId, r), t.add(r)), r;\n    }\n\n    return this._material = new re(e), t.add(this._material), this._material;\n  }\n\n  _setDrapingDependentMaterialParameters() {\n    this.draped && (this._forEachMaterial(e => {\n      e.setParameterValues({\n        verticalOffset: null,\n        screenSizePerspective: null,\n        occlusionTest: !1,\n        slicePlaneEnabled: !1,\n        shaderPolygonOffset: 0,\n        isDraped: this.draped\n      });\n    }), this.layerOpacityChanged());\n  }\n\n  destroy() {\n    super.destroy(), this._forEachMaterial(e => this._context.stage.remove(e)), this._material = null, this._cimSymbolMaterials.clear(), this._cimSymbolTextures.forEach(e => this._context.stage.remove(e)), this._cimSymbolTextures.clear(), this._releaseTexture && (this._releaseTexture(), this._releaseTexture = null);\n  }\n\n  _getScaleFactor(e, t) {\n    if (this._drivenProperties.size && e.size) {\n      for (let t = 0; t < 3; t++) {\n        const r = e.size[t];\n        r && \"symbol-value\" !== r && \"proportional\" !== r && (e.size[t] = h(r));\n      }\n\n      if (\"symbol-value\" === e.size[0]) return 1;\n      if (isFinite(+e.size[0])) return +e.size[0] / t;\n      if (isFinite(+e.size[2])) return +e.size[2] / t;\n    }\n\n    return 1;\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry)) return null;\n    let r, i;\n\n    if (this._cimLayers) {\n      if (!this._cimLayers.length) return null;\n\n      const e = this._generateTextureCIM(t),\n            s = {\n        textureId: e.id,\n        ...this._cimMaterialParametersInfo\n      };\n\n      i = this._createMaterialAndAddToStage(s, this._context.stage), r = [e.params.width, e.params.height];\n    } else r = this._size, i = n(this._material);\n\n    const s = V(t.geometry);\n    if (o(s)) return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`), null;\n\n    const a = e.renderingInfo,\n          l = this._getVertexOpacityAndColor(a);\n\n    let c = 1;\n\n    if (!this._fastUpdates.enabled || !this._fastUpdates.visualVariables.size) {\n      const e = r[0] > r[1] ? r[0] : r[1];\n      c = this._getScaleFactor(a, e);\n    }\n\n    c *= this._symbolTextureRatio;\n    const h = [r[0] * c, r[1] * c],\n          m = this.setGraphicElevationContext(t, new L());\n    return this.ensureDrapedStatus(\"on-the-ground\" === m.mode) && this._setDrapingDependentMaterialParameters(), this.draped ? this._createAsOverlay(t, s, i, l, h, e.layer.uid) : this._createAs3DShape(t, s, i, l, h, m, t.uid);\n  }\n\n  layerOpacityChanged() {\n    const e = this._getFillColor(),\n          t = this._getOutlineColor();\n\n    return this._forEachMaterial(r => {\n      r.setParameterValues({\n        color: e\n      }), r.setParameterValues({\n        outlineColor: t\n      });\n    }), !0;\n  }\n\n  layerElevationInfoChanged(e, t, r) {\n    const i = this._elevationContext.mode,\n          s = T(ue.elevationModeChangeTypes, r, i);\n    if (s !== E.UPDATE) return s;\n    const a = O(i) || \"absolute-height\" === i;\n    return this.updateGraphics3DGraphicElevationInfo(e, t, () => a);\n  }\n\n  slicePlaneEnabledChanged() {\n    return this.draped || this._forEachMaterial(e => {\n      e.setParameterValues({\n        slicePlaneEnabled: this._context.slicePlaneEnabled\n      });\n    }), !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    return !0;\n  }\n\n  pixelRatioChanged() {\n    return !!this._getPrimitive();\n  }\n\n  applyRendererDiff(e, t) {\n    for (const r in e.diff) switch (r) {\n      case \"visualVariables\":\n        if (!K(this._fastUpdates, t, this._fastVisualVariableConvertOptions())) return !1;\n        s(this._material) && this._material.setParameterValues(this._fastUpdates.materialParameters);\n        break;\n\n      default:\n        return !1;\n    }\n\n    return !0;\n  }\n\n  _defaultElevationInfoNoZ() {\n    return fe;\n  }\n\n  _createAs3DShape(e, t, r, i, s, a, o) {\n    const n = this.getFastUpdateAttrValues(e),\n          l = n ? e => Q(this._fastUpdates.materialParameters, n, e) : null,\n          c = [Y.createPointGeometry(ae, null, i, s, ye, null, n)],\n          h = k(this._context, t, c, [r], null, null, a, this._context.layer.uid, o, l);\n    if (null === h) return null;\n    const m = j,\n          u = new D(this, h.object, c, null, null, m, a);\n    return u.alignedSampledElevation = h.sampledElevation, u.needsElevationUpdates = O(a.mode) || \"absolute-height\" === a.mode, u.getScreenSize = this._createScreenSizeGetter(s, l), u.calculateRelativeScreenBounds = e => r.calculateRelativeScreenBounds(u.getScreenSize(), 1, e), B(u, t, this._context.elevationProvider), u;\n  }\n\n  _createAsOverlay(e, t, r, i, a, o) {\n    r.renderPriority = this._renderPriority;\n    const n = v();\n    z(t, n, this._context.overlaySR), n[2] = X;\n    const l = this._context.clippingExtent;\n    if (s(l) && !P(l, n)) return null;\n    const c = this.getFastUpdateAttrValues(e),\n          h = c ? e => Q(this._fastUpdates.materialParameters, c, e) : null,\n          m = Y.createPointGeometry(ae, n, i, a, null, null, c),\n          u = new ee(m, r, o, e.uid);\n    n[3] = 0, b(u.boundingSphere, n), u.calculateShaderTransformation = h;\n    const d = new F(this, [u], null);\n    return d.getScreenSize = this._createScreenSizeGetter(a, h), d.calculateRelativeScreenBounds = e => r.calculateRelativeScreenBounds(d.getScreenSize(), 1, e), d;\n  }\n\n  _createScreenSizeGetter(e, t) {\n    const r = this._outlineSize + 2;\n\n    if (this._fastUpdates.enabled) {\n      const i = e[0] / this._symbolTextureRatio,\n            s = e[1] / this._symbolTextureRatio;\n      return (e = f()) => {\n        const a = t(se);\n        return e[0] = a[0] * i + r, e[1] = a[5] * s + r, e;\n      };\n    }\n\n    {\n      const t = e[0] / this._symbolTextureRatio + r,\n            i = e[1] / this._symbolTextureRatio + r;\n      return (e = f()) => (e[0] = t, e[1] = i, e);\n    }\n  }\n\n  _fastVisualVariableConvertOptions() {\n    const e = this._size[0] > this._size[1] ? this._size[0] : this._size[1],\n          t = x(e, e, e),\n          r = m(1),\n          i = e * r;\n    return {\n      modelSize: t,\n      symbolSize: x(i, i, i),\n      unitInMeters: r,\n      transformation: {\n        anchor: y,\n        scale: g,\n        rotation: y\n      }\n    };\n  }\n\n  _getGraphicHash(e) {\n    let t = \"\";\n\n    for (const r of this._cimRequiredFields) t += r + e.attributes[r];\n\n    return t;\n  }\n\n  _forEachMaterial(e) {\n    s(this._material) && e(this._material), this._cimSymbolMaterials.forEach(e);\n  }\n\n}\n\nfunction de(e) {\n  return e && \"point-3d\" === e.type && e.hasVisibleVerticalOffset();\n}\n\nfunction _e(e) {\n  return !!s(e) && (\"cross\" === e || \"x\" === e);\n}\n\nfunction pe(e) {\n  let t;\n  const r = le,\n        i = r * ce;\n\n  switch (e) {\n    case \"circle\":\n      t = $(r, i);\n      break;\n\n    case \"square\":\n      t = Z(r, i);\n      break;\n\n    case \"kite\":\n      t = W(r, i);\n      break;\n\n    case \"cross\":\n      t = H(r, i);\n      break;\n\n    case \"x\":\n      t = q(r, i);\n      break;\n\n    case \"triangle\":\n      t = N(r, i);\n  }\n\n  return new te(t, {\n    mipmap: !1,\n    wrap: {\n      s: 33071,\n      t: 33071\n    },\n    width: le,\n    height: le,\n    components: 4,\n    noUnpackFlip: !0\n  });\n}\n\nue.PRIMITIVE_SIZE = me, ue.elevationModeChangeTypes = {\n  definedChanged: E.UPDATE,\n  staysOnTheGround: E.NONE,\n  onTheGroundChanged: E.RECREATE\n};\nconst fe = {\n  mode: \"relative-to-ground\",\n  offset: 0\n},\n      ye = S(0, 0, 0, 1);\nexport default ue;\nexport { ue as Graphics3DIconSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DIconSymbolLayer.js"],"names":["e","result","t","r","i","isSome","s","get","a","isNone","o","unwrap","n","throwIfAbortError","l","throwIfAborted","c","pt2px","h","px2pt","m","dataComponents","u","isSVG","d","_","f","p","Z","y","O","g","x","b","S","v","projectPointToVector","z","containsPoint","P","createRendererExpression","R","defaultPrimitive","M","getIconHref","w","C","TRANSPARENT_UNIT","I","perObjectElevationAligner","j","elevationModeChangeUpdateType","T","SymbolUpdateType","E","needsElevationUpdates2D","ElevationContext","L","F","Graphics3DObject3DGraphicLayer","D","Graphics3DSymbolLayer","U","validateSymbolLayerSize","G","namedAnchorToHUDMaterialAnchorPos","A","placePointOnGeometry","V","createStageObjectForHUD","k","extendPointGraphicElevationContext","B","createTriangle","N","createX","q","createCross","H","createKite","W","createSquare","createCircle","$","initFastSymbolUpdatesState","J","updateFastSymbolUpdatesState","K","evaluateModelTransform","Q","DRAPED_Z","X","Y","RenderGeometry","ee","Texture","te","HUDMaterial","re","ie","se","ae","oe","ne","le","ce","he","me","ue","constructor","_cimLayers","_cimSymbolMaterials","Map","_cimSymbolTextures","_cimMaterialParametersInfo","_cimRequiredFields","_cimScaleFactorOrFunction","_size","_symbolTextureRatio","_outlineSize","_texture","_releaseTexture","_elevationOptions","supportsOffsetAdjustment","supportsOnTheGround","getCachedSize","size","_getIconSize","doLoad","_validateOrThrow","_prepareMaterialParameters","_getPrimitive","_prepareResourcesPrimitive","symbol","symbolLayer","mediaType","_prepareResourcesCIM","JSON","parse","data","_prepareResourcesHref","_drivenProperties","Math","round","max","_generateTextureCIM","_getGraphicHash","scaleFactor","_context","sharedResources","cimSymbolRasterizer","rasterizeCIMSymbol","anchorPos","_getAnchorPos","anchorPosition","width","imageData","height","powerOfTwoResizeMode","set","stage","add","_computeSize","anchor","de","screenLength","minWorldLength","maxWorldLength","verticalOffset","screenSizePerspectiveEnabled","screenSizePerspective","screenSizePerspectiveSettings","occlusionTest","slicePlaneEnabled","_getOutlineSize","_e","Error","color","_getFillColor","outlineColor","_getOutlineColor","outlineSize","textures","fromData","pe","texture","release","uid","textureIsSignedDistanceField","distanceFieldBoundingBox","textureId","id","_createMaterialAndAddToStage","layerView","view","pixelRatio","fromUrl","signal","ok","error","value","params","CIMSymbolRasterizer","renderCoordsHelper","spatialReference","layer","fields","map","toJSON","analyzeCIMSymbol","renderer","type","fieldMap","scaleExpression","isNaN","$view","Number","getRequiredFields","fieldsIndex","name","resource","href","primitive","outline","_getLayerOpacity","toUnitRGB","_getCombinedOpacityAndColor","hasIntrinsicColor","center","_fastUpdates","enabled","_fastVisualVariableConvertOptions","Object","assign","materialParameters","_material","_setDrapingDependentMaterialParameters","draped","_forEachMaterial","setParameterValues","shaderPolygonOffset","isDraped","layerOpacityChanged","destroy","remove","clear","forEach","_getScaleFactor","isFinite","createGraphics3DGraphic","graphic","_validateGeometry","geometry","length","logger","warn","renderingInfo","_getVertexOpacityAndColor","visualVariables","setGraphicElevationContext","ensureDrapedStatus","mode","_createAsOverlay","_createAs3DShape","layerElevationInfoChanged","_elevationContext","elevationModeChangeTypes","UPDATE","updateGraphics3DGraphicElevationInfo","slicePlaneEnabledChanged","physicalBasedRenderingChanged","pixelRatioChanged","applyRendererDiff","diff","_defaultElevationInfoNoZ","fe","getFastUpdateAttrValues","createPointGeometry","ye","object","alignedSampledElevation","sampledElevation","needsElevationUpdates","getScreenSize","_createScreenSizeGetter","calculateRelativeScreenBounds","elevationProvider","renderPriority","_renderPriority","overlaySR","clippingExtent","boundingSphere","calculateShaderTransformation","modelSize","symbolSize","unitInMeters","transformation","scale","rotation","attributes","hasVisibleVerticalOffset","mipmap","wrap","components","noUnpackFlip","PRIMITIVE_SIZE","definedChanged","staysOnTheGround","NONE","onTheGroundChanged","RECREATE","offset","Graphics3DIconSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import\"../../../../symbols.js\";import{result as t}from\"../../../../core/asyncUtils.js\";import r from\"../../../../core/has.js\";import i from\"../../../../core/Error.js\";import{isSome as s,get as a,isNone as o,unwrap as n}from\"../../../../core/maybe.js\";import{throwIfAbortError as l,throwIfAborted as c}from\"../../../../core/promiseUtils.js\";import{pt2px as h,px2pt as m}from\"../../../../core/screenUtils.js\";import{dataComponents as u,isSVG as d}from\"../../../../core/urlUtils.js\";import{c as _}from\"../../../../chunks/mat4f64.js\";import{f as p,a as f}from\"../../../../chunks/vec2f64.js\";import{Z as y,O as g,f as x}from\"../../../../chunks/vec3f64.js\";import{c as b}from\"../../../../chunks/vec4.js\";import{f as S,c as v}from\"../../../../chunks/vec4f64.js\";import{projectPointToVector as z}from\"../../../../geometry/projection.js\";import{containsPoint as P}from\"../../../../geometry/support/aaBoundingBox.js\";import{createRendererExpression as R}from\"../../../../support/arcadeOnDemand.js\";import{defaultPrimitive as M}from\"../../../../symbols/support/IconSymbol3DLayerResource.js\";import{getIconHref as w}from\"../../../../symbols/support/utils.js\";import C from\"../../../2d/arcade/callExpressionWithFeature.js\";import{TRANSPARENT_UNIT as I}from\"./constants.js\";import{perObjectElevationAligner as j}from\"./ElevationAligners.js\";import{elevationModeChangeUpdateType as T,SymbolUpdateType as E,needsElevationUpdates2D as O}from\"./elevationAlignmentUtils.js\";import{ElevationContext as L}from\"./ElevationContext.js\";import F from\"./Graphics3DDrapedGraphicLayer.js\";import{Graphics3DObject3DGraphicLayer as D}from\"./Graphics3DObject3DGraphicLayer.js\";import{Graphics3DSymbolLayer as U}from\"./Graphics3DSymbolLayer.js\";import{validateSymbolLayerSize as G,namedAnchorToHUDMaterialAnchorPos as A}from\"./graphicUtils.js\";import{placePointOnGeometry as V,createStageObjectForHUD as k,extendPointGraphicElevationContext as B}from\"./pointUtils.js\";import{createTriangle as N,createX as q,createCross as H,createKite as W,createSquare as Z,createCircle as $}from\"./sdfPrimitives.js\";import{initFastSymbolUpdatesState as J,updateFastSymbolUpdatesState as K,evaluateModelTransform as Q}from\"../support/FastSymbolUpdates.js\";import{DRAPED_Z as X}from\"../../terrain/OverlayRenderer.js\";import Y from\"../../webgl-engine/lib/GeometryUtil.js\";import{RenderGeometry as ee}from\"../../webgl-engine/lib/RenderGeometry.js\";import{Texture as te}from\"../../webgl-engine/lib/Texture.js\";import{HUDMaterial as re}from\"../../webgl-engine/materials/HUDMaterial.js\";import ie from\"../../../../symbols/CIMSymbol.js\";const se=_(),ae=x(0,0,1),oe=16,ne=1.5,le=128,ce=.5,he=[ce/2,ce/2,1-ce/2,1-ce/2],me=[le*ce,le*ce];class ue extends U{constructor(e,t,r,i){super(e,t,r,i),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._texture=null,this._releaseTexture=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(s(r))this._prepareResourcesPrimitive(t,r);else{const r=w(this.symbol,this.symbolLayer),i=u(r);i&&\"application/json\"===i.mediaType?await this._prepareResourcesCIM(t,JSON.parse(i.data),e):await this._prepareResourcesHref(t,r,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=G(this._getIconSize());if(e)throw new i(\"graphics3diconsymbollayer:invalid-size\",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?h(e.size):oe);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let r=\"\"===t?null:this._cimSymbolTextures.get(t);if(!r){const i={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,\"esriGeometryPoint\",i,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos(\"relative\",s.anchorPosition);const a={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:2};r=new te(s.imageData,a),this._cimSymbolTextures.set(t,r),this._context.stage.add(r)}return r}_computeSize(e,t){const r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}_prepareMaterialParameters(){const e={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(de(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:s}=t.verticalOffset;e.verticalOffset={screenLength:h(r),minWorldLength:i||0,maxWorldLength:null!=s?s:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(_e(t)&&0===r)throw new Error(\"Nothing to render\");this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const i=this._context.sharedResources.textures.fromData(t,(()=>pe(t)));this._texture=i.texture,this._releaseTexture=()=>this._context.sharedResources.textures.release(i.uid),e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=he,e.textureId=this._texture.id;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/ce,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,s,a){if(!r(\"esri-canvas-svg-support\")&&d(s)){throw new i(\"graphics3diconsymbollayer:unsupported-image-format\",\"IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)\")}this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const o=this._getIconSize(),n=o*this._context.layerView.view.pixelRatio,c=await t(this._context.sharedResources.textures.fromUrl(s,n,{signal:a}));if(!1===c.ok){l(c.error);throw new i(\"graphics3diconsymbollayer:request-failed\",`Failed to load (Request for icon resource failed: ${s})`)}const{uid:h,texture:m}=c.value;this._releaseTexture=()=>this._context.sharedResources.textures.release(h);const u=m.params;this._size=this._computeSize(u,o),e.textureId=m.id,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,r){const i=new ie({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await import(\"../../../../symbols/cim/CIMSymbolRasterizer.js\")).CIMSymbolRasterizer;c(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):null;let a,o;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(i,s,this._context.renderer&&\"dictionary\"===this._context.renderer.type?this._context.renderer.fieldMap:null,\"esriGeometryPoint\",{signal:r}),this._context.renderer&&\"dictionary\"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,r=await R(t,this._context.layer.spatialReference,s);o=(e,t,i)=>{const s=C(r,e,{$view:i},\"esriGeometryPoint\",t);return null!==s?s:1}}else a=Number(e.scaleExpression)}this._cimScaleFactorOrFunction=a||o||1;const n=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];c(r);const l=this._context.layer.fieldsIndex;this._cimRequiredFields=n.map((e=>l.get(e).name)),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||M}_getOutlineSize(){let e=0;const t=this.symbolLayer;if(s(t.outline)&&null!=t.outline.size)return Math.max(h(t.outline.size),0);return e=_e(this._getPrimitive())?ne:0,Math.max(e,0)}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=a(r,\"outline\",\"color\");if(s(i)){const r=e.toUnitRGB(i),s=i.a*t;return[r[0],r[1],r[2],s]}return[0,0,0,0]}_getFillColor(){if(_e(this._getPrimitive()))return I;const e=o(this._getPrimitive()),t=a(this.symbolLayer,\"material\",\"color\");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return\"relative\"===e?p((t.x||0)+.5,.5-(t.y||0)):e in A?A[e]:A.center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=J(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=this._cimSymbolMaterials.get(e.textureId);return r||(r=new re(e),this._cimSymbolMaterials.set(e.textureId,r),t.add(r)),r}return this._material=new re(e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const r=e.size[t];r&&\"symbol-value\"!==r&&\"proportional\"!==r&&(e.size[t]=h(r))}if(\"symbol-value\"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),s={textureId:e.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(s,this._context.stage),r=[e.params.width,e.params.height]}else r=this._size,i=n(this._material);const s=V(t.geometry);if(o(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const a=e.renderingInfo,l=this._getVertexOpacityAndColor(a);let c=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=r[0]>r[1]?r[0]:r[1];c=this._getScaleFactor(a,e)}c*=this._symbolTextureRatio;const h=[r[0]*c,r[1]*c],m=this.setGraphicElevationContext(t,new L);return this.ensureDrapedStatus(\"on-the-ground\"===m.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,s,i,l,h,e.layer.uid):this._createAs3DShape(t,s,i,l,h,m,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial((r=>{r.setParameterValues({color:e}),r.setParameterValues({outlineColor:t})})),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,s=T(ue.elevationModeChangeTypes,r,i);if(s!==E.UPDATE)return s;const a=O(i)||\"absolute-height\"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>a))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff)switch(r){case\"visualVariables\":if(!K(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;s(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0}_defaultElevationInfoNoZ(){return fe}_createAs3DShape(e,t,r,i,s,a,o){const n=this.getFastUpdateAttrValues(e),l=n?e=>Q(this._fastUpdates.materialParameters,n,e):null,c=[Y.createPointGeometry(ae,null,i,s,ye,null,n)],h=k(this._context,t,c,[r],null,null,a,this._context.layer.uid,o,l);if(null===h)return null;const m=j,u=new D(this,h.object,c,null,null,m,a);return u.alignedSampledElevation=h.sampledElevation,u.needsElevationUpdates=O(a.mode)||\"absolute-height\"===a.mode,u.getScreenSize=this._createScreenSizeGetter(s,l),u.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(u.getScreenSize(),1,e),B(u,t,this._context.elevationProvider),u}_createAsOverlay(e,t,r,i,a,o){r.renderPriority=this._renderPriority;const n=v();z(t,n,this._context.overlaySR),n[2]=X;const l=this._context.clippingExtent;if(s(l)&&!P(l,n))return null;const c=this.getFastUpdateAttrValues(e),h=c?e=>Q(this._fastUpdates.materialParameters,c,e):null,m=Y.createPointGeometry(ae,n,i,a,null,null,c),u=new ee(m,r,o,e.uid);n[3]=0,b(u.boundingSphere,n),u.calculateShaderTransformation=h;const d=new F(this,[u],null);return d.getScreenSize=this._createScreenSizeGetter(a,h),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),d}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const i=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(e=f())=>{const a=t(se);return e[0]=a[0]*i+r,e[1]=a[5]*s+r,e}}{const t=e[0]/this._symbolTextureRatio+r,i=e[1]/this._symbolTextureRatio+r;return(e=f())=>(e[0]=t,e[1]=i,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=x(e,e,e),r=m(1),i=e*r;return{modelSize:t,symbolSize:x(i,i,i),unitInMeters:r,transformation:{anchor:y,scale:g,rotation:y}}}_getGraphicHash(e){let t=\"\";for(const r of this._cimRequiredFields)t+=r+e.attributes[r];return t}_forEachMaterial(e){s(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}}function de(e){return e&&\"point-3d\"===e.type&&e.hasVisibleVerticalOffset()}function _e(e){return!!s(e)&&(\"cross\"===e||\"x\"===e)}function pe(e){let t;const r=le,i=r*ce;switch(e){case\"circle\":t=$(r,i);break;case\"square\":t=Z(r,i);break;case\"kite\":t=W(r,i);break;case\"cross\":t=H(r,i);break;case\"x\":t=q(r,i);break;case\"triangle\":t=N(r,i)}return new te(t,{mipmap:!1,wrap:{s:33071,t:33071},width:le,height:le,components:4,noUnpackFlip:!0})}ue.PRIMITIVE_SIZE=me,ue.elevationModeChangeTypes={definedChanged:E.UPDATE,staysOnTheGround:E.NONE,onTheGroundChanged:E.RECREATE};const fe={mode:\"relative-to-ground\",offset:0},ye=S(0,0,0,1);export default ue;export{ue as Graphics3DIconSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}