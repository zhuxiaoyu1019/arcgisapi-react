{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Logger.js\";\nimport t from \"../../../core/PooledArray.js\";\nimport { WorkerHandle as o } from \"../../../core/workers/WorkerHandle.js\";\nimport { canProjectWithoutEngine as r, projectVectorToVector as s } from \"../../../geometry/projection.js\";\nconst n = e.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\");\n\nclass i extends o {\n  constructor(e) {\n    super(\"SceneLayerWorker\", \"process\", e, {\n      hasInitialize: !0\n    });\n  }\n\n  getTransferList(e) {\n    return [e.geometryBuffer];\n  }\n\n  setModifications(e, t, o) {\n    const r = {\n      context: e,\n      modifications: f(t, o),\n      isGeodetic: o.isGeographic\n    };\n    this.broadcast(r, \"setModifications\");\n  }\n\n  setLegacySchema(e, t) {\n    const o = JSON.stringify(t);\n    this.broadcast({\n      context: e,\n      jsonSchema: o\n    }, \"setLegacySchema\");\n  }\n\n  destroyContext(e) {\n    return this.broadcast(e, \"destroyContext\");\n  }\n\n}\n\nconst c = new t({\n  deallocator: null\n}),\n      a = [0, 0, 0];\n\nfunction f(e, t) {\n  c.clear();\n\n  for (const i of e) {\n    const e = \"clip\" === i.type ? 2 : \"mask\" === i.type ? 1 : 0,\n          o = i.geometry;\n\n    let f = e => e;\n\n    if (o.spatialReference) {\n      if (!r(o.spatialReference, t)) {\n        n.warn(\"Can't project modification polygon into layer spatial reference, ignoring modification\");\n        continue;\n      }\n\n      f = e => (s(e, o.spatialReference, a, t), a);\n    } else o.hasZ || (a[2] = 0, f = e => (a[0] = e[0], a[1] = e[1], a));\n\n    c.push(e), c.push(o.rings.length);\n\n    for (const t of o.rings) {\n      c.push(t.length);\n\n      for (const e of t) {\n        const t = f(e);\n        c.push(t[0]), c.push(t[1]), c.push(t[2]);\n      }\n    }\n  }\n\n  c.push(3);\n  const o = new Float64Array(c.length);\n\n  for (let r = 0; r < c.length; ++r) o[r] = c.getItemAt(r);\n\n  return o;\n}\n\nexport { i as I3SMeshWorkerHandle, f as toWasmModification };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/I3SMeshWorkerHandle.js"],"names":["e","t","WorkerHandle","o","canProjectWithoutEngine","r","projectVectorToVector","s","n","getLogger","i","constructor","hasInitialize","getTransferList","geometryBuffer","setModifications","context","modifications","f","isGeodetic","isGeographic","broadcast","setLegacySchema","JSON","stringify","jsonSchema","destroyContext","c","deallocator","a","clear","type","geometry","spatialReference","warn","hasZ","push","rings","length","Float64Array","getItemAt","I3SMeshWorkerHandle","toWasmModification"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Logger.js\";import t from\"../../../core/PooledArray.js\";import{WorkerHandle as o}from\"../../../core/workers/WorkerHandle.js\";import{canProjectWithoutEngine as r,projectVectorToVector as s}from\"../../../geometry/projection.js\";const n=e.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\");class i extends o{constructor(e){super(\"SceneLayerWorker\",\"process\",e,{hasInitialize:!0})}getTransferList(e){return[e.geometryBuffer]}setModifications(e,t,o){const r={context:e,modifications:f(t,o),isGeodetic:o.isGeographic};this.broadcast(r,\"setModifications\")}setLegacySchema(e,t){const o=JSON.stringify(t);this.broadcast({context:e,jsonSchema:o},\"setLegacySchema\")}destroyContext(e){return this.broadcast(e,\"destroyContext\")}}const c=new t({deallocator:null}),a=[0,0,0];function f(e,t){c.clear();for(const i of e){const e=\"clip\"===i.type?2:\"mask\"===i.type?1:0,o=i.geometry;let f=e=>e;if(o.spatialReference){if(!r(o.spatialReference,t)){n.warn(\"Can't project modification polygon into layer spatial reference, ignoring modification\");continue}f=e=>(s(e,o.spatialReference,a,t),a)}else o.hasZ||(a[2]=0,f=e=>(a[0]=e[0],a[1]=e[1],a));c.push(e),c.push(o.rings.length);for(const t of o.rings){c.push(t.length);for(const e of t){const t=f(e);c.push(t[0]),c.push(t[1]),c.push(t[2])}}}c.push(3);const o=new Float64Array(c.length);for(let r=0;r<c.length;++r)o[r]=c.getItemAt(r);return o}export{i as I3SMeshWorkerHandle,f as toWasmModification};\n"]},"metadata":{},"sourceType":"module"}