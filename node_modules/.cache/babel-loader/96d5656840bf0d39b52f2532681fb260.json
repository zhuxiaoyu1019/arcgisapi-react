{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"./chunks/tslib.es6.js\";\nimport e from \"./core/Collection.js\";\nimport { JSONSupport as o } from \"./core/JSONSupport.js\";\nimport { clone as s } from \"./core/lang.js\";\nimport i from \"./core/Logger.js\";\nimport { isPromiseLike as r } from \"./core/promiseUtils.js\";\nimport { property as n } from \"./core/accessorSupport/decorators/property.js\";\nimport { cast as p } from \"./core/accessorSupport/decorators/cast.js\";\nimport \"./core/has.js\";\nimport { reader as l } from \"./core/accessorSupport/decorators/reader.js\";\nimport { subclass as a } from \"./core/accessorSupport/decorators/subclass.js\";\nimport { writer as d } from \"./core/accessorSupport/decorators/writer.js\";\nimport { ensureOneOfType as f } from \"./core/accessorSupport/ensureType.js\";\nimport { collectFields as c, collectArcadeFieldNames as m } from \"./layers/support/fieldUtils.js\";\nimport { persistableTypes as u } from \"./popup/content.js\";\nimport y from \"./popup/ExpressionInfo.js\";\nimport h from \"./popup/FieldInfo.js\";\nimport I from \"./popup/LayerOptions.js\";\nimport A from \"./popup/RelatedRecordsInfo.js\";\nimport F from \"./popup/content/AttachmentsContent.js\";\nimport g from \"./popup/content/Content.js\";\nimport x from \"./popup/content/CustomContent.js\";\nimport w from \"./popup/content/FieldsContent.js\";\nimport _ from \"./popup/content/MediaContent.js\";\nimport j from \"./popup/content/TextContent.js\";\nimport { types as v } from \"./popup/content/support/mediaInfoTypes.js\";\nimport C from \"./support/actions/ActionBase.js\";\nimport E from \"./support/actions/ActionButton.js\";\nimport N from \"./support/actions/ActionToggle.js\";\nvar O;\nconst S = e.ofType({\n  key: \"type\",\n  defaultKeyValue: \"button\",\n  base: C,\n  typeMap: {\n    button: E,\n    toggle: N\n  }\n}),\n      T = {\n  base: g,\n  key: \"type\",\n  typeMap: {\n    media: _,\n    custom: x,\n    text: j,\n    attachments: F,\n    fields: w\n  }\n},\n      b = \"esri.PopupTemplate\",\n      R = i.getLogger(b),\n      L = [\"attachments\", \"fields\", \"media\", \"text\"];\nlet J = O = class extends o {\n  constructor() {\n    super(...arguments), this.actions = null, this.content = \"\", this.expressionInfos = null, this.fieldInfos = null, this.layerOptions = null, this.lastEditInfoEnabled = !0, this.outFields = null, this.overwriteActions = !1, this.returnGeometry = !1, this.title = \"\", this.relatedRecordsInfo = null;\n  }\n\n  castContent(t) {\n    return Array.isArray(t) ? t.map(t => f(T, t)) : \"string\" == typeof t || \"function\" == typeof t || t instanceof HTMLElement || r(t) ? t : (R.error(\"content error\", \"unsupported content value\", {\n      value: t\n    }), null);\n  }\n\n  readContent(t, e) {\n    const {\n      popupElements: o\n    } = e;\n    return Array.isArray(o) && o.length > 0 ? this._readPopupInfoElements(e) : this._readPopupInfo(e);\n  }\n\n  writeContent(t, e, o, s) {\n    \"string\" != typeof t ? Array.isArray(t) && (e.popupElements = t.filter(t => -1 !== L.indexOf(t.type)).map(t => t && t.toJSON(s)), e.popupElements.forEach(t => {\n      \"attachments\" === t.type ? this._writeAttachmentContent(e) : \"media\" === t.type ? this._writeMediaContent(t, e) : \"text\" === t.type && this._writeTextContent(t, e);\n    })) : e.description = t;\n  }\n\n  writeFieldInfos(t, e, o, s) {\n    const {\n      content: i\n    } = this,\n          r = Array.isArray(i) ? i : null;\n\n    if (t) {\n      const o = r ? r.filter(t => \"fields\" === t.type) : [],\n            i = o.length && o.every(t => {\n        var e;\n        return null == (e = t.fieldInfos) ? void 0 : e.length;\n      });\n      e.fieldInfos = t.filter(Boolean).map(t => {\n        const e = t.toJSON(s);\n        return i && (e.visible = !1), e;\n      });\n    }\n\n    if (r) for (const n of r) \"fields\" === n.type && this._writeFieldsContent(n, e);\n  }\n\n  writeLayerOptions(t, e, o, s) {\n    e[o] = !t || null === t.showNoDataRecords && null === t.returnTopmostRaster ? null : t.toJSON(s);\n  }\n\n  writeTitle(t, e) {\n    e.title = t || \"\";\n  }\n\n  clone() {\n    const {\n      actions: t\n    } = this,\n          e = t ? s(t.toArray()) : [];\n    return new O({\n      actions: e,\n      content: Array.isArray(this.content) ? s(this.content) : this.content,\n      expressionInfos: Array.isArray(this.expressionInfos) ? s(this.expressionInfos) : null,\n      fieldInfos: Array.isArray(this.fieldInfos) ? s(this.fieldInfos) : null,\n      layerOptions: this.layerOptions ? s(this.layerOptions) : null,\n      lastEditInfoEnabled: this.lastEditInfoEnabled,\n      outFields: Array.isArray(this.outFields) ? s(this.outFields) : null,\n      overwriteActions: this.overwriteActions,\n      returnGeometry: this.returnGeometry,\n      title: this.title,\n      relatedRecordsInfo: this.relatedRecordsInfo ? s(this.relatedRecordsInfo) : null\n    });\n  }\n\n  async collectRequiredFields(t, e) {\n    await this._collectExpressionInfoFields(t, e, this.expressionInfos), c(t, e, [...(this.outFields || []), ...this._getActionsFields(this.actions), ...this._getTitleFields(this.title), ...this._getContentFields(this.content)]);\n  }\n\n  async getRequiredFields(t) {\n    const e = new Set();\n    return await this.collectRequiredFields(e, t), [...e].sort();\n  }\n\n  _writeFieldsContent(t, e) {\n    if (!Array.isArray(t.fieldInfos) || !t.fieldInfos.length) return;\n    const o = s(t.fieldInfos);\n    Array.isArray(e.fieldInfos) ? o.forEach(t => {\n      const o = e.fieldInfos.find(e => e.fieldName.toLowerCase() === t.fieldName.toLowerCase());\n      o ? o.visible = !0 : e.fieldInfos.push(t);\n    }) : e.fieldInfos = o;\n  }\n\n  _writeAttachmentContent(t) {\n    t.showAttachments || (t.showAttachments = !0);\n  }\n\n  _writeTextContent(t, e) {\n    !e.description && t.text && (e.description = t.text);\n  }\n\n  _writeMediaContent(t, e) {\n    if (!Array.isArray(t.mediaInfos) || !t.mediaInfos.length) return;\n    const o = s(t.mediaInfos);\n    Array.isArray(e.mediaInfos) ? e.mediaInfos = [...e.mediaInfos, ...o] : e.mediaInfos = o;\n  }\n\n  _readPopupInfoElements({\n    description: t,\n    mediaInfos: e,\n    popupElements: o\n  }) {\n    const s = {\n      description: !1,\n      mediaInfos: !1\n    };\n    return o.map(o => \"media\" === o.type ? (o.mediaInfos || !e || s.mediaInfos || (o.mediaInfos = e, s.mediaInfos = !0), _.fromJSON(o)) : \"text\" === o.type ? (o.text || !t || s.description || (o.text = t, s.description = !0), j.fromJSON(o)) : \"attachments\" === o.type ? F.fromJSON(o) : \"fields\" === o.type ? w.fromJSON(o) : void 0).filter(Boolean);\n  }\n\n  _readPopupInfo({\n    description: t,\n    mediaInfos: e,\n    showAttachments: o\n  }) {\n    const s = [];\n    return t ? s.push(new j({\n      text: t\n    })) : s.push(new w()), Array.isArray(e) && e.length && s.push(_.fromJSON({\n      mediaInfos: e\n    })), o && s.push(F.fromJSON({\n      displayType: \"list\"\n    })), s.length ? s : t;\n  }\n\n  _getContentElementFields(t) {\n    if (!t || \"attachments\" === t.type) return [];\n    if (\"custom\" === t.type) return t.outFields || [];\n    if (\"fields\" === t.type) return this._getFieldInfoFields(t.fieldInfos || this.fieldInfos);\n\n    if (\"media\" === t.type) {\n      return (t.mediaInfos || []).reduce((t, e) => [...t, ...this._getMediaInfoFields(e)], []);\n    }\n\n    return \"text\" === t.type ? this._extractFieldNames(t.text) : void 0;\n  }\n\n  _getMediaInfoFields(t) {\n    const {\n      caption: e,\n      title: o,\n      value: s\n    } = t,\n          i = s || {},\n          {\n      fields: r = [],\n      normalizeField: n,\n      tooltipField: p,\n      sourceURL: l,\n      linkURL: a\n    } = i,\n          d = [...this._extractFieldNames(o), ...this._extractFieldNames(e), ...this._extractFieldNames(l), ...this._extractFieldNames(a), ...r];\n    return n && d.push(n), p && d.push(p), d;\n  }\n\n  _getContentFields(t) {\n    return \"string\" == typeof t ? this._extractFieldNames(t) : Array.isArray(t) ? t.reduce((t, e) => [...t, ...this._getContentElementFields(e)], []) : [];\n  }\n\n  async _collectExpressionInfoFields(t, e, o) {\n    o && (await Promise.all(o.map(o => m(t, e, o.expression))));\n  }\n\n  _getFieldInfoFields(t) {\n    return t ? t.filter(t => void 0 === t.visible || !!t.visible).map(t => t.fieldName).filter(t => -1 === t.indexOf(\"relationships/\") && -1 === t.indexOf(\"expression/\")) : [];\n  }\n\n  _getActionsFields(t) {\n    return t ? t.toArray().reduce((t, e) => [...t, ...this._getActionFields(e)], []) : [];\n  }\n\n  _getActionFields(t) {\n    const {\n      className: e,\n      title: o,\n      type: s\n    } = t,\n          i = \"button\" === s || \"toggle\" === s ? t.image : \"\";\n    return [...this._extractFieldNames(o), ...this._extractFieldNames(e), ...this._extractFieldNames(i)];\n  }\n\n  _getTitleFields(t) {\n    return \"string\" == typeof t ? this._extractFieldNames(t) : [];\n  }\n\n  _extractFieldNames(t) {\n    if (!t || \"string\" != typeof t) return [];\n    const e = /{[^}]*}/g,\n          o = t.match(e);\n    if (!o) return [];\n    const s = /\\{(\\w+):.+\\}/,\n          i = o.filter(t => !(0 === t.indexOf(\"{relationships/\") || 0 === t.indexOf(\"{expression/\"))).map(t => t.replace(s, \"{$1}\"));\n    return i ? i.map(t => t.slice(1, -1)) : [];\n  }\n\n};\nt([n({\n  type: S\n})], J.prototype, \"actions\", void 0), t([n()], J.prototype, \"content\", void 0), t([p(\"content\")], J.prototype, \"castContent\", null), t([l(\"content\", [\"description\", \"fieldInfos\", \"popupElements\", \"mediaInfos\", \"showAttachments\"])], J.prototype, \"readContent\", null), t([d(\"content\", {\n  popupElements: {\n    type: e.ofType(u)\n  },\n  showAttachments: {\n    type: Boolean\n  },\n  mediaInfos: {\n    type: e.ofType(v)\n  },\n  description: {\n    type: String\n  }\n})], J.prototype, \"writeContent\", null), t([n({\n  type: [y],\n  json: {\n    write: !0\n  }\n})], J.prototype, \"expressionInfos\", void 0), t([n({\n  type: [h]\n})], J.prototype, \"fieldInfos\", void 0), t([d(\"fieldInfos\")], J.prototype, \"writeFieldInfos\", null), t([n({\n  type: I\n})], J.prototype, \"layerOptions\", void 0), t([d(\"layerOptions\")], J.prototype, \"writeLayerOptions\", null), t([n({\n  type: Boolean,\n  json: {\n    read: {\n      source: \"showLastEditInfo\"\n    },\n    write: {\n      target: \"showLastEditInfo\"\n    },\n    default: !0\n  }\n})], J.prototype, \"lastEditInfoEnabled\", void 0), t([n()], J.prototype, \"outFields\", void 0), t([n()], J.prototype, \"overwriteActions\", void 0), t([n()], J.prototype, \"returnGeometry\", void 0), t([n({\n  json: {\n    type: String\n  }\n})], J.prototype, \"title\", void 0), t([d(\"title\")], J.prototype, \"writeTitle\", null), t([n({\n  type: A,\n  json: {\n    write: !0\n  }\n})], J.prototype, \"relatedRecordsInfo\", void 0), J = O = t([a(b)], J);\nvar M = J;\nexport default M;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/PopupTemplate.js"],"names":["_","t","e","JSONSupport","o","clone","s","i","isPromiseLike","r","property","n","cast","p","reader","l","subclass","a","writer","d","ensureOneOfType","f","collectFields","c","collectArcadeFieldNames","m","persistableTypes","u","y","h","I","A","F","g","x","w","j","types","v","C","E","N","O","S","ofType","key","defaultKeyValue","base","typeMap","button","toggle","T","media","custom","text","attachments","fields","b","R","getLogger","L","J","constructor","arguments","actions","content","expressionInfos","fieldInfos","layerOptions","lastEditInfoEnabled","outFields","overwriteActions","returnGeometry","title","relatedRecordsInfo","castContent","Array","isArray","map","HTMLElement","error","value","readContent","popupElements","length","_readPopupInfoElements","_readPopupInfo","writeContent","filter","indexOf","type","toJSON","forEach","_writeAttachmentContent","_writeMediaContent","_writeTextContent","description","writeFieldInfos","every","Boolean","visible","_writeFieldsContent","writeLayerOptions","showNoDataRecords","returnTopmostRaster","writeTitle","toArray","collectRequiredFields","_collectExpressionInfoFields","_getActionsFields","_getTitleFields","_getContentFields","getRequiredFields","Set","sort","find","fieldName","toLowerCase","push","showAttachments","mediaInfos","fromJSON","displayType","_getContentElementFields","_getFieldInfoFields","reduce","_getMediaInfoFields","_extractFieldNames","caption","normalizeField","tooltipField","sourceURL","linkURL","Promise","all","expression","_getActionFields","className","image","match","replace","slice","prototype","String","json","write","read","source","target","default","M"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"./chunks/tslib.es6.js\";import e from\"./core/Collection.js\";import{JSONSupport as o}from\"./core/JSONSupport.js\";import{clone as s}from\"./core/lang.js\";import i from\"./core/Logger.js\";import{isPromiseLike as r}from\"./core/promiseUtils.js\";import{property as n}from\"./core/accessorSupport/decorators/property.js\";import{cast as p}from\"./core/accessorSupport/decorators/cast.js\";import\"./core/has.js\";import{reader as l}from\"./core/accessorSupport/decorators/reader.js\";import{subclass as a}from\"./core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"./core/accessorSupport/decorators/writer.js\";import{ensureOneOfType as f}from\"./core/accessorSupport/ensureType.js\";import{collectFields as c,collectArcadeFieldNames as m}from\"./layers/support/fieldUtils.js\";import{persistableTypes as u}from\"./popup/content.js\";import y from\"./popup/ExpressionInfo.js\";import h from\"./popup/FieldInfo.js\";import I from\"./popup/LayerOptions.js\";import A from\"./popup/RelatedRecordsInfo.js\";import F from\"./popup/content/AttachmentsContent.js\";import g from\"./popup/content/Content.js\";import x from\"./popup/content/CustomContent.js\";import w from\"./popup/content/FieldsContent.js\";import _ from\"./popup/content/MediaContent.js\";import j from\"./popup/content/TextContent.js\";import{types as v}from\"./popup/content/support/mediaInfoTypes.js\";import C from\"./support/actions/ActionBase.js\";import E from\"./support/actions/ActionButton.js\";import N from\"./support/actions/ActionToggle.js\";var O;const S=e.ofType({key:\"type\",defaultKeyValue:\"button\",base:C,typeMap:{button:E,toggle:N}}),T={base:g,key:\"type\",typeMap:{media:_,custom:x,text:j,attachments:F,fields:w}},b=\"esri.PopupTemplate\",R=i.getLogger(b),L=[\"attachments\",\"fields\",\"media\",\"text\"];let J=O=class extends o{constructor(){super(...arguments),this.actions=null,this.content=\"\",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=\"\",this.relatedRecordsInfo=null}castContent(t){return Array.isArray(t)?t.map((t=>f(T,t))):\"string\"==typeof t||\"function\"==typeof t||t instanceof HTMLElement||r(t)?t:(R.error(\"content error\",\"unsupported content value\",{value:t}),null)}readContent(t,e){const{popupElements:o}=e;return Array.isArray(o)&&o.length>0?this._readPopupInfoElements(e):this._readPopupInfo(e)}writeContent(t,e,o,s){\"string\"!=typeof t?Array.isArray(t)&&(e.popupElements=t.filter((t=>-1!==L.indexOf(t.type))).map((t=>t&&t.toJSON(s))),e.popupElements.forEach((t=>{\"attachments\"===t.type?this._writeAttachmentContent(e):\"media\"===t.type?this._writeMediaContent(t,e):\"text\"===t.type&&this._writeTextContent(t,e)}))):e.description=t}writeFieldInfos(t,e,o,s){const{content:i}=this,r=Array.isArray(i)?i:null;if(t){const o=r?r.filter((t=>\"fields\"===t.type)):[],i=o.length&&o.every((t=>{var e;return null==(e=t.fieldInfos)?void 0:e.length}));e.fieldInfos=t.filter(Boolean).map((t=>{const e=t.toJSON(s);return i&&(e.visible=!1),e}))}if(r)for(const n of r)\"fields\"===n.type&&this._writeFieldsContent(n,e)}writeLayerOptions(t,e,o,s){e[o]=!t||null===t.showNoDataRecords&&null===t.returnTopmostRaster?null:t.toJSON(s)}writeTitle(t,e){e.title=t||\"\"}clone(){const{actions:t}=this,e=t?s(t.toArray()):[];return new O({actions:e,content:Array.isArray(this.content)?s(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?s(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?s(this.fieldInfos):null,layerOptions:this.layerOptions?s(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?s(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?s(this.relatedRecordsInfo):null})}async collectRequiredFields(t,e){await this._collectExpressionInfoFields(t,e,this.expressionInfos),c(t,e,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const e=new Set;return await this.collectRequiredFields(e,t),[...e].sort()}_writeFieldsContent(t,e){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const o=s(t.fieldInfos);Array.isArray(e.fieldInfos)?o.forEach((t=>{const o=e.fieldInfos.find((e=>e.fieldName.toLowerCase()===t.fieldName.toLowerCase()));o?o.visible=!0:e.fieldInfos.push(t)})):e.fieldInfos=o}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeTextContent(t,e){!e.description&&t.text&&(e.description=t.text)}_writeMediaContent(t,e){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const o=s(t.mediaInfos);Array.isArray(e.mediaInfos)?e.mediaInfos=[...e.mediaInfos,...o]:e.mediaInfos=o}_readPopupInfoElements({description:t,mediaInfos:e,popupElements:o}){const s={description:!1,mediaInfos:!1};return o.map((o=>\"media\"===o.type?(o.mediaInfos||!e||s.mediaInfos||(o.mediaInfos=e,s.mediaInfos=!0),_.fromJSON(o)):\"text\"===o.type?(o.text||!t||s.description||(o.text=t,s.description=!0),j.fromJSON(o)):\"attachments\"===o.type?F.fromJSON(o):\"fields\"===o.type?w.fromJSON(o):void 0)).filter(Boolean)}_readPopupInfo({description:t,mediaInfos:e,showAttachments:o}){const s=[];return t?s.push(new j({text:t})):s.push(new w),Array.isArray(e)&&e.length&&s.push(_.fromJSON({mediaInfos:e})),o&&s.push(F.fromJSON({displayType:\"list\"})),s.length?s:t}_getContentElementFields(t){if(!t||\"attachments\"===t.type)return[];if(\"custom\"===t.type)return t.outFields||[];if(\"fields\"===t.type)return this._getFieldInfoFields(t.fieldInfos||this.fieldInfos);if(\"media\"===t.type){return(t.mediaInfos||[]).reduce(((t,e)=>[...t,...this._getMediaInfoFields(e)]),[])}return\"text\"===t.type?this._extractFieldNames(t.text):void 0}_getMediaInfoFields(t){const{caption:e,title:o,value:s}=t,i=s||{},{fields:r=[],normalizeField:n,tooltipField:p,sourceURL:l,linkURL:a}=i,d=[...this._extractFieldNames(o),...this._extractFieldNames(e),...this._extractFieldNames(l),...this._extractFieldNames(a),...r];return n&&d.push(n),p&&d.push(p),d}_getContentFields(t){return\"string\"==typeof t?this._extractFieldNames(t):Array.isArray(t)?t.reduce(((t,e)=>[...t,...this._getContentElementFields(e)]),[]):[]}async _collectExpressionInfoFields(t,e,o){o&&await Promise.all(o.map((o=>m(t,e,o.expression))))}_getFieldInfoFields(t){return t?t.filter((t=>void 0===t.visible||!!t.visible)).map((t=>t.fieldName)).filter((t=>-1===t.indexOf(\"relationships/\")&&-1===t.indexOf(\"expression/\"))):[]}_getActionsFields(t){return t?t.toArray().reduce(((t,e)=>[...t,...this._getActionFields(e)]),[]):[]}_getActionFields(t){const{className:e,title:o,type:s}=t,i=\"button\"===s||\"toggle\"===s?t.image:\"\";return[...this._extractFieldNames(o),...this._extractFieldNames(e),...this._extractFieldNames(i)]}_getTitleFields(t){return\"string\"==typeof t?this._extractFieldNames(t):[]}_extractFieldNames(t){if(!t||\"string\"!=typeof t)return[];const e=/{[^}]*}/g,o=t.match(e);if(!o)return[];const s=/\\{(\\w+):.+\\}/,i=o.filter((t=>!(0===t.indexOf(\"{relationships/\")||0===t.indexOf(\"{expression/\")))).map((t=>t.replace(s,\"{$1}\")));return i?i.map((t=>t.slice(1,-1))):[]}};t([n({type:S})],J.prototype,\"actions\",void 0),t([n()],J.prototype,\"content\",void 0),t([p(\"content\")],J.prototype,\"castContent\",null),t([l(\"content\",[\"description\",\"fieldInfos\",\"popupElements\",\"mediaInfos\",\"showAttachments\"])],J.prototype,\"readContent\",null),t([d(\"content\",{popupElements:{type:e.ofType(u)},showAttachments:{type:Boolean},mediaInfos:{type:e.ofType(v)},description:{type:String}})],J.prototype,\"writeContent\",null),t([n({type:[y],json:{write:!0}})],J.prototype,\"expressionInfos\",void 0),t([n({type:[h]})],J.prototype,\"fieldInfos\",void 0),t([d(\"fieldInfos\")],J.prototype,\"writeFieldInfos\",null),t([n({type:I})],J.prototype,\"layerOptions\",void 0),t([d(\"layerOptions\")],J.prototype,\"writeLayerOptions\",null),t([n({type:Boolean,json:{read:{source:\"showLastEditInfo\"},write:{target:\"showLastEditInfo\"},default:!0}})],J.prototype,\"lastEditInfoEnabled\",void 0),t([n()],J.prototype,\"outFields\",void 0),t([n()],J.prototype,\"overwriteActions\",void 0),t([n()],J.prototype,\"returnGeometry\",void 0),t([n({json:{type:String}})],J.prototype,\"title\",void 0),t([d(\"title\")],J.prototype,\"writeTitle\",null),t([n({type:A,json:{write:!0}})],J.prototype,\"relatedRecordsInfo\",void 0),J=O=t([a(b)],J);var M=J;export default M;\n"]},"metadata":{},"sourceType":"module"}