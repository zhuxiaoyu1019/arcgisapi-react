{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport \"../../../../geometry.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport { isNone as t } from \"../../../../core/maybe.js\";\nimport { property as s } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as a } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport n from \"../../../../geometry/Extent.js\";\nimport o from \"../../../../layers/graphics/data/QueryEngine.js\";\nimport i from \"../../../../rest/support/FeatureSet.js\";\nimport u from \"../../../../rest/support/Query.js\";\nimport { featureGeometryTypeKebabDictionary as y } from \"../../../../geometry/support/typeUtils.js\";\nconst c = o;\nlet l = class extends r {\n  constructor(e) {\n    super(e), this._dataQueryEngineInstance = null;\n  }\n\n  get queryGeometryType() {\n    switch (this.layer.geometryType) {\n      case \"multipoint\":\n      case \"point\":\n      case \"polygon\":\n      case \"polyline\":\n        return this.layer.geometryType;\n\n      case \"mesh\":\n        return \"polygon\";\n\n      default:\n        return;\n    }\n  }\n\n  get defaultQueryJSON() {\n    return new u({\n      outSpatialReference: this.spatialReference\n    }).toJSON();\n  }\n\n  get dataQueryEngine() {\n    return this.ensureDataQueryEngine();\n  }\n\n  destroy() {\n    this.clear();\n  }\n\n  clear() {\n    return !!this._dataQueryEngineInstance && (this._dataQueryEngineInstance.destroy(), this._dataQueryEngineInstance = null, !0);\n  }\n\n  async executeQueryForIdSet(e, r) {\n    return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e), r);\n  }\n\n  async executeQueryForCount(e, r) {\n    return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e), r);\n  }\n\n  async executeQueryForExtent(e, r) {\n    const {\n      count: t,\n      extent: s\n    } = await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e), r);\n    return {\n      count: t,\n      extent: n.fromJSON(s)\n    };\n  }\n\n  async executeQueryForIds(e, r) {\n    return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e), r);\n  }\n\n  async executeQueryForLatestObservations(e, r) {\n    const t = await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e), r),\n          s = i.fromJSON(t);\n    return s.features.forEach(e => {\n      e.layer = this.layer, e.sourceLayer = this.layer;\n    }), s;\n  }\n\n  async executeQuery(e, r) {\n    const t = await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e), r),\n          s = i.fromJSON(t);\n    return s.features.forEach(e => {\n      e.layer = this.layer, e.sourceLayer = this.layer;\n    }), s;\n  }\n\n  _ensureQueryJSON(e) {\n    return t(e) ? this.defaultQueryJSON : (\"outSpatialReference\" in e && !e.outSpatialReference && (e.outSpatialReference = this.spatialReference), e.toJSON());\n  }\n\n  ensureDataQueryEngine() {\n    if (this._dataQueryEngineInstance) return this._dataQueryEngineInstance;\n    const e = \"timeInfo\" in this.layer && this.layer.timeInfo && this.layer.timeInfo.toJSON() || null,\n          r = this.layer.objectIdField,\n          t = y.toJSON(this.queryGeometryType),\n          s = this.layer.fields.map(e => e.toJSON()),\n          a = this.layerView.view.resourceController.scheduler,\n          n = this.priority,\n          o = this.spatialReference.toJSON(),\n          i = this.layerView.graphics3d.graphicsCore.featureStore,\n          {\n      hasZ: u,\n      hasM: l\n    } = this.layerView;\n    return this._dataQueryEngineInstance = new c({\n      hasZ: u,\n      hasM: l,\n      geometryType: t,\n      fields: s,\n      timeInfo: e,\n      spatialReference: o,\n      objectIdField: r,\n      featureStore: i,\n      scheduler: a,\n      priority: n\n    }), this._dataQueryEngineInstance;\n  }\n\n};\ne([s({\n  constructOnly: !0\n})], l.prototype, \"layerView\", void 0), e([s({\n  constructOnly: !0\n})], l.prototype, \"priority\", void 0), e([s({\n  readOnly: !0,\n  aliasOf: \"layerView.view.spatialReference\"\n})], l.prototype, \"spatialReference\", void 0), e([s({\n  readOnly: !0,\n  aliasOf: \"layerView.layer\"\n})], l.prototype, \"layer\", void 0), e([s({\n  readOnly: !0\n})], l.prototype, \"queryGeometryType\", null), e([s({\n  readOnly: !0\n})], l.prototype, \"defaultQueryJSON\", null), l = e([a(\"esri.views.3d.layers.graphics.QueryEngine\")], l);\nvar p = l;\nexport default p;\nexport { l as QueryEngine };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js"],"names":["_","e","r","isNone","t","property","s","subclass","a","n","o","i","u","featureGeometryTypeKebabDictionary","y","c","l","constructor","_dataQueryEngineInstance","queryGeometryType","layer","geometryType","defaultQueryJSON","outSpatialReference","spatialReference","toJSON","dataQueryEngine","ensureDataQueryEngine","destroy","clear","executeQueryForIdSet","_ensureQueryJSON","executeQueryForCount","executeQueryForExtent","count","extent","fromJSON","executeQueryForIds","executeQueryForLatestObservations","features","forEach","sourceLayer","executeQuery","timeInfo","objectIdField","fields","map","layerView","view","resourceController","scheduler","priority","graphics3d","graphicsCore","featureStore","hasZ","hasM","constructOnly","prototype","readOnly","aliasOf","p","QueryEngine"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import r from\"../../../../core/Accessor.js\";import{isNone as t}from\"../../../../core/maybe.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../../geometry/Extent.js\";import o from\"../../../../layers/graphics/data/QueryEngine.js\";import i from\"../../../../rest/support/FeatureSet.js\";import u from\"../../../../rest/support/Query.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../../geometry/support/typeUtils.js\";const c=o;let l=class extends r{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case\"multipoint\":case\"point\":case\"polygon\":case\"polyline\":return this.layer.geometryType;case\"mesh\":return\"polygon\";default:return}}get defaultQueryJSON(){return new u({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:n.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return t(e)?this.defaultQueryJSON:(\"outSpatialReference\"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=\"timeInfo\"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=y.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,n=this.priority,o=this.spatialReference.toJSON(),i=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:u,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:u,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:o,objectIdField:r,featureStore:i,scheduler:a,priority:n}),this._dataQueryEngineInstance}};e([s({constructOnly:!0})],l.prototype,\"layerView\",void 0),e([s({constructOnly:!0})],l.prototype,\"priority\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.view.spatialReference\"})],l.prototype,\"spatialReference\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.layer\"})],l.prototype,\"layer\",void 0),e([s({readOnly:!0})],l.prototype,\"queryGeometryType\",null),e([s({readOnly:!0})],l.prototype,\"defaultQueryJSON\",null),l=e([a(\"esri.views.3d.layers.graphics.QueryEngine\")],l);var p=l;export default p;export{l as QueryEngine};\n"]},"metadata":{},"sourceType":"module"}