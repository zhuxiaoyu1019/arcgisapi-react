{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport r from \"../core/CollectionFlattener.js\";\nimport i from \"../core/Error.js\";\nimport { HandleOwner as t } from \"../core/HandleOwner.js\";\nimport a from \"../core/Logger.js\";\nimport { someMap as s } from \"../core/MapUtils.js\";\nimport { isNone as o, isSome as l, removeMaybe as n } from \"../core/maybe.js\";\nimport { createDeferred as h, isAbortError as y, createAbortController as p, onAbort as w, throwIfAborted as c } from \"../core/promiseUtils.js\";\nimport { schedule as d } from \"../core/scheduling.js\";\nimport { on as m, init as u } from \"../core/watchUtils.js\";\nimport { property as f } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/has.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport { subclass as v } from \"../core/accessorSupport/decorators/subclass.js\";\nimport { WatchUpdatingTracking as _ } from \"./support/WatchUpdatingTracking.js\";\nconst g = a.getLogger(\"esri.views.LayerViewManager\");\n\nclass V {\n  constructor(e, r, t) {\n    this.layer = e, this.view = r, this.layerViewImporter = t, this._controller = p(), this._deferred = h(), this._started = !1, this.done = !1, w(this._controller.signal, () => {\n      const r = new i(\"cancelled:layerview-create\", \"layerview creation cancelled\", {\n        layer: e\n      });\n\n      this._deferred.reject(r);\n    });\n  }\n\n  get promise() {\n    return this._deferred.promise;\n  }\n\n  destroy() {\n    this._controller.abort();\n\n    const {\n      layerView: e\n    } = this;\n    if (!e) return;\n    const {\n      layer: r,\n      view: i\n    } = this;\n    r.emit(\"layerview-destroy\", {\n      view: i,\n      layerView: e\n    }), i.emit(\"layerview-destroy\", {\n      layer: r,\n      layerView: e\n    }), this.done = !0, this.layer = null, this.layerView = null, this.view = null, this.layerViewImporter = null;\n  }\n\n  async start() {\n    if (this._started) return;\n    this._started = !0;\n    const {\n      _controller: {\n        signal: e\n      },\n      layer: r,\n      view: t\n    } = this;\n    this._map = t.map;\n\n    try {\n      var a, s;\n      let l, h;\n      if (await r.load({\n        signal: e\n      }), \"prefetchResources\" in r && (await r.prefetchResources({\n        signal: e\n      })), r.createLayerView) l = await r.createLayerView(t, {\n        signal: e\n      });else {\n        if (!this.layerViewImporter.hasLayerViewModule(r)) throw new i(\"layer:view-not-supported\", \"No layerview implementation was found\");\n        const a = await this.layerViewImporter.importLayerView(r);\n        c(e), l = \"default\" in a ? new a.default({\n          layer: r,\n          view: t\n        }) : new a({\n          layer: r,\n          view: t\n        });\n      }\n\n      const y = () => {\n        h = n(h), l.destroyed || l.destroy(), l.layer = null, l.parent = null, l.view = null, this.done = !0;\n      };\n\n      h = w(e, y), c(e);\n\n      try {\n        await l.when();\n      } catch (o) {\n        throw y(), o;\n      }\n\n      if (!(null == (a = this._map) || null == (s = a.allLayers) ? void 0 : s.includes(r))) return y(), void this._deferred.reject(new i(\"view:no-layerview-for-layer\", \"The layer has been removed from the map\", {\n        layer: r\n      }));\n      this.layerView = l, r.emit(\"layerview-create\", {\n        view: t,\n        layerView: l\n      }), t.emit(\"layerview-create\", {\n        layer: r,\n        layerView: l\n      }), this.done = !0, this._deferred.resolve(l);\n    } catch (o) {\n      r.emit(\"layerview-create-error\", {\n        view: t,\n        error: o\n      }), t.emit(\"layerview-create-error\", {\n        layer: r,\n        error: o\n      }), this.done = !0, this._deferred.reject(new i(\"layerview:create-error\", \"layerview creation failed\", {\n        layer: r,\n        error: o\n      }));\n    }\n  }\n\n}\n\nlet L = class extends t {\n  constructor(e) {\n    super(e), this._layerLayerViewInfoMap = new Map(), this._watchUpdatingTracking = new _(), this.supportsGround = !0, this._preloadLayerViewModules = () => {\n      var e;\n      const r = null == (e = this.view.map) ? void 0 : e.allLayers;\n      if (r) for (const i of r) this.layerViewImporter.hasLayerViewModule(i) && this.layerViewImporter.importLayerView(i);\n    }, this._reschedule = () => (o(this._workPromise) && (this._workPromise = h()), this.handles.remove(\"reschedule\"), this.handles.add(d(this._doWork), \"reschedule\"), this._workPromise.promise), this._doWork = () => {\n      var e, i, t;\n      const a = this.view.map;\n      if (this._map !== a && (this.clear(), this._map = a), o(this._workPromise)) return void this.notifyChange(\"updating\");\n      this.handles.remove(\"reschedule\"), this.handles.remove(\"collection-change\");\n      const s = new r({\n        getCollections: () => this._rootCollectionNames.map(e => this.get(e)),\n        getChildrenFunction: e => e && \"layers\" in e ? e.layers : null\n      });\n      if (!s) return this._workPromise.resolve(), void (this._workPromise = null);\n\n      for (const r of s) this._createLayerView(r);\n\n      this._refreshCollections();\n\n      for (const [r, o] of this._layerLayerViewInfoMap) s.includes(r) || (this._layerLayerViewInfoMap.delete(o.layer), o.destroy());\n\n      const l = s.filter(e => \"group\" === e.type).map(e => e.layers),\n            n = [null == a || null == (e = a.ground) ? void 0 : e.layers, null == a || null == (i = a.basemap) ? void 0 : i.baseLayers, null == a || null == (t = a.basemap) ? void 0 : t.referenceLayers, null == a ? void 0 : a.layers, ...l].filter(e => !!e);\n      this.handles.add(n.map(e => this._watchUpdatingTracking.addOnCollectionChange(e, this._reschedule)), \"collection-change\"), this._workPromise.resolve(), this._workPromise = null;\n    };\n  }\n\n  initialize() {\n    this.handles.add([m(this, \"view.map.allLayers\", \"change\", this._preloadLayerViewModules, this._preloadLayerViewModules), u(this.view, [\"map.basemap\", \"map.ground\", \"map.layers\", \"ready\"], this._reschedule, !0)]), this._preloadLayerViewModules(), this._reschedule();\n  }\n\n  destroy() {\n    this.clear(), this._watchUpdatingTracking.destroy(), this._map = null;\n  }\n\n  get _layersToLayerViews() {\n    const e = [[\"view.map.basemap.baseLayers\", \"view.basemapView.baseLayerViews\"], [\"view.map.layers\", \"view.layerViews\"], [\"view.map.basemap.referenceLayers\", \"view.basemapView.referenceLayerViews\"]];\n    return this.supportsGround && e.push([\"view.map.ground.layers\", \"view.groundView.layerViews\"]), new Map(e);\n  }\n\n  get _rootCollectionNames() {\n    return Array.from(this._layersToLayerViews.keys());\n  }\n\n  get updating() {\n    return l(this._workPromise) || this._watchUpdatingTracking.updating || s(this._layerLayerViewInfoMap, e => !e.done);\n  }\n\n  get updatingRemaining() {\n    let e = 0;\n\n    for (const r of this._layerLayerViewInfoMap.values()) r.done || ++e;\n\n    return e;\n  }\n\n  clear() {\n    if (!this.destroyed) {\n      for (const e of this._layerLayerViewInfoMap.values()) e.destroy();\n\n      this._layerLayerViewInfoMap.clear(), this._refreshCollections();\n    }\n  }\n\n  async whenLayerView(e) {\n    if (await this._reschedule(), !this._layerLayerViewInfoMap.has(e)) throw new i(\"view:no-layerview-for-layer\", \"No layerview has been found for the layer\", {\n      layer: e\n    });\n    return this._layerLayerViewInfoMap.get(e).promise;\n  }\n\n  _refreshCollections() {\n    for (const [e, r] of this._layersToLayerViews) this._populateLayerViewsOwners(this.get(e), this.get(r), this.view);\n\n    this.notifyChange(\"updating\"), this.notifyChange(\"updatingRemaining\");\n  }\n\n  _populateLayerViewsOwners(e, r, i) {\n    if (!e || !r) return void (r && r.removeAll());\n    let t = 0;\n\n    for (const a of e) {\n      const e = this._layerLayerViewInfoMap.get(a);\n\n      if (!e || !e.layerView) continue;\n      const s = e.layerView;\n      s.layer = a, s.parent = i, r.getItemAt(t) !== s && r.splice(t, 0, s), a.layers && this._populateLayerViewsOwners(a.layers, s.layerViews, s), t += 1;\n    }\n\n    t < r.length && r.splice(t, r.length);\n  }\n\n  _createLayerView(e) {\n    if (this._layerLayerViewInfoMap.has(e)) return this.view.ready && this._layerLayerViewInfoMap.get(e).start(), this.notifyChange(\"updating\"), void this.notifyChange(\"updatingRemaining\");\n    e.load().catch(() => {}), this.layerViewImporter.hasLayerViewModule(e) && this.layerViewImporter.importLayerView(e);\n    const r = new V(e, this.view, this.layerViewImporter);\n    r.promise.then(() => this._refreshCollections(), r => {\n      var i, t;\n      r && (y(r) || \"cancelled:layerview-create\" === r.name) || g.error(`Failed to create layerview for layer title:'${null != (i = e.title) ? i : \"no title\"}', id:'${null != (t = e.id) ? t : \"no id\"}' of type '${e.type}'.`, {\n        layer: e,\n        error: r\n      });\n\n      this._refreshCollections();\n    }), this._layerLayerViewInfoMap.set(e, r), this.view.ready && r.start(), this.notifyChange(\"updating\"), this.notifyChange(\"updatingRemaining\");\n  }\n\n};\ne([f()], L.prototype, \"_workPromise\", void 0), e([f({\n  readOnly: !0\n})], L.prototype, \"_watchUpdatingTracking\", void 0), e([f({\n  readOnly: !0\n})], L.prototype, \"_layersToLayerViews\", null), e([f({\n  readOnly: !0\n})], L.prototype, \"_rootCollectionNames\", null), e([f()], L.prototype, \"layerViewImporter\", void 0), e([f()], L.prototype, \"supportsGround\", void 0), e([f({\n  readOnly: !0\n})], L.prototype, \"updating\", null), e([f({\n  readOnly: !0\n})], L.prototype, \"updatingRemaining\", null), e([f({\n  constructOnly: !0\n})], L.prototype, \"view\", void 0), L = e([v(\"esri.views.LayerViewManager\")], L);\nvar M = L;\nexport default M;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/LayerViewManager.js"],"names":["_","e","r","i","HandleOwner","t","a","someMap","s","isNone","o","isSome","l","removeMaybe","n","createDeferred","h","isAbortError","y","createAbortController","p","onAbort","w","throwIfAborted","c","schedule","d","on","m","init","u","property","f","subclass","v","WatchUpdatingTracking","g","getLogger","V","constructor","layer","view","layerViewImporter","_controller","_deferred","_started","done","signal","reject","promise","destroy","abort","layerView","emit","start","_map","map","load","prefetchResources","createLayerView","hasLayerViewModule","importLayerView","default","destroyed","parent","when","allLayers","includes","resolve","error","L","_layerLayerViewInfoMap","Map","_watchUpdatingTracking","supportsGround","_preloadLayerViewModules","_reschedule","_workPromise","handles","remove","add","_doWork","clear","notifyChange","getCollections","_rootCollectionNames","get","getChildrenFunction","layers","_createLayerView","_refreshCollections","delete","filter","type","ground","basemap","baseLayers","referenceLayers","addOnCollectionChange","initialize","_layersToLayerViews","push","Array","from","keys","updating","updatingRemaining","values","whenLayerView","has","_populateLayerViewsOwners","removeAll","getItemAt","splice","layerViews","length","ready","catch","then","name","title","id","set","prototype","readOnly","constructOnly","M"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../core/CollectionFlattener.js\";import i from\"../core/Error.js\";import{HandleOwner as t}from\"../core/HandleOwner.js\";import a from\"../core/Logger.js\";import{someMap as s}from\"../core/MapUtils.js\";import{isNone as o,isSome as l,removeMaybe as n}from\"../core/maybe.js\";import{createDeferred as h,isAbortError as y,createAbortController as p,onAbort as w,throwIfAborted as c}from\"../core/promiseUtils.js\";import{schedule as d}from\"../core/scheduling.js\";import{on as m,init as u}from\"../core/watchUtils.js\";import{property as f}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/accessorSupport/ensureType.js\";import{subclass as v}from\"../core/accessorSupport/decorators/subclass.js\";import{WatchUpdatingTracking as _}from\"./support/WatchUpdatingTracking.js\";const g=a.getLogger(\"esri.views.LayerViewManager\");class V{constructor(e,r,t){this.layer=e,this.view=r,this.layerViewImporter=t,this._controller=p(),this._deferred=h(),this._started=!1,this.done=!1,w(this._controller.signal,(()=>{const r=new i(\"cancelled:layerview-create\",\"layerview creation cancelled\",{layer:e});this._deferred.reject(r)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:r,view:i}=this;r.emit(\"layerview-destroy\",{view:i,layerView:e}),i.emit(\"layerview-destroy\",{layer:r,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:t}=this;this._map=t.map;try{var a,s;let l,h;if(await r.load({signal:e}),\"prefetchResources\"in r&&await r.prefetchResources({signal:e}),r.createLayerView)l=await r.createLayerView(t,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new i(\"layer:view-not-supported\",\"No layerview implementation was found\");const a=await this.layerViewImporter.importLayerView(r);c(e),l=\"default\"in a?new a.default({layer:r,view:t}):new a({layer:r,view:t})}const y=()=>{h=n(h),l.destroyed||l.destroy(),l.layer=null,l.parent=null,l.view=null,this.done=!0};h=w(e,y),c(e);try{await l.when()}catch(o){throw y(),o}if(!(null==(a=this._map)||null==(s=a.allLayers)?void 0:s.includes(r)))return y(),void this._deferred.reject(new i(\"view:no-layerview-for-layer\",\"The layer has been removed from the map\",{layer:r}));this.layerView=l,r.emit(\"layerview-create\",{view:t,layerView:l}),t.emit(\"layerview-create\",{layer:r,layerView:l}),this.done=!0,this._deferred.resolve(l)}catch(o){r.emit(\"layerview-create-error\",{view:t,error:o}),t.emit(\"layerview-create-error\",{layer:r,error:o}),this.done=!0,this._deferred.reject(new i(\"layerview:create-error\",\"layerview creation failed\",{layer:r,error:o}))}}}let L=class extends t{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new _,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var e;const r=null==(e=this.view.map)?void 0:e.allLayers;if(r)for(const i of r)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>(o(this._workPromise)&&(this._workPromise=h()),this.handles.remove(\"reschedule\"),this.handles.add(d(this._doWork),\"reschedule\"),this._workPromise.promise),this._doWork=()=>{var e,i,t;const a=this.view.map;if(this._map!==a&&(this.clear(),this._map=a),o(this._workPromise))return void this.notifyChange(\"updating\");this.handles.remove(\"reschedule\"),this.handles.remove(\"collection-change\");const s=new r({getCollections:()=>this._rootCollectionNames.map((e=>this.get(e))),getChildrenFunction:e=>e&&\"layers\"in e?e.layers:null});if(!s)return this._workPromise.resolve(),void(this._workPromise=null);for(const r of s)this._createLayerView(r);this._refreshCollections();for(const[r,o]of this._layerLayerViewInfoMap)s.includes(r)||(this._layerLayerViewInfoMap.delete(o.layer),o.destroy());const l=s.filter((e=>\"group\"===e.type)).map((e=>e.layers)),n=[null==a||null==(e=a.ground)?void 0:e.layers,null==a||null==(i=a.basemap)?void 0:i.baseLayers,null==a||null==(t=a.basemap)?void 0:t.referenceLayers,null==a?void 0:a.layers,...l].filter((e=>!!e));this.handles.add(n.map((e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule))),\"collection-change\"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([m(this,\"view.map.allLayers\",\"change\",this._preloadLayerViewModules,this._preloadLayerViewModules),u(this.view,[\"map.basemap\",\"map.ground\",\"map.layers\",\"ready\"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[[\"view.map.basemap.baseLayers\",\"view.basemapView.baseLayerViews\"],[\"view.map.layers\",\"view.layerViews\"],[\"view.map.basemap.referenceLayers\",\"view.basemapView.referenceLayerViews\"]];return this.supportsGround&&e.push([\"view.map.ground.layers\",\"view.groundView.layerViews\"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return l(this._workPromise)||this._watchUpdatingTracking.updating||s(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new i(\"view:no-layerview-for-layer\",\"No layerview has been found for the layer\",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange(\"updating\"),this.notifyChange(\"updatingRemaining\")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let t=0;for(const a of e){const e=this._layerLayerViewInfoMap.get(a);if(!e||!e.layerView)continue;const s=e.layerView;s.layer=a,s.parent=i,r.getItemAt(t)!==s&&r.splice(t,0,s),a.layers&&this._populateLayerViewsOwners(a.layers,s.layerViews,s),t+=1}t<r.length&&r.splice(t,r.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange(\"updating\"),void this.notifyChange(\"updatingRemaining\");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new V(e,this.view,this.layerViewImporter);r.promise.then((()=>this._refreshCollections()),(r=>{var i,t;r&&(y(r)||\"cancelled:layerview-create\"===r.name)||g.error(`Failed to create layerview for layer title:'${null!=(i=e.title)?i:\"no title\"}', id:'${null!=(t=e.id)?t:\"no id\"}' of type '${e.type}'.`,{layer:e,error:r});this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange(\"updating\"),this.notifyChange(\"updatingRemaining\")}};e([f()],L.prototype,\"_workPromise\",void 0),e([f({readOnly:!0})],L.prototype,\"_watchUpdatingTracking\",void 0),e([f({readOnly:!0})],L.prototype,\"_layersToLayerViews\",null),e([f({readOnly:!0})],L.prototype,\"_rootCollectionNames\",null),e([f()],L.prototype,\"layerViewImporter\",void 0),e([f()],L.prototype,\"supportsGround\",void 0),e([f({readOnly:!0})],L.prototype,\"updating\",null),e([f({readOnly:!0})],L.prototype,\"updatingRemaining\",null),e([f({constructOnly:!0})],L.prototype,\"view\",void 0),L=e([v(\"esri.views.LayerViewManager\")],L);var M=L;export default M;\n"]},"metadata":{},"sourceType":"module"}