{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t } from \"../../../../core/maybe.js\";\nimport r from \"../../../../core/PooledArray.js\";\nimport { m as i, d as n } from \"../../../../chunks/mat4.js\";\nimport { c as s } from \"../../../../chunks/mat4f64.js\";\nimport { m as a } from \"../../../../chunks/vec3.js\";\nimport { l as o } from \"../../../../chunks/vec4.js\";\nimport { c as h } from \"../../../../chunks/vec4f64.js\";\nimport { intersectsSphere as f, create as c, copy as l } from \"../../../../geometry/support/frustum.js\";\nimport { c as u } from \"../../../../chunks/sphere.js\";\nimport { maxScale as d } from \"../../support/mathUtils.js\";\nimport { empty as g, union as m, set as p } from \"./depthRange.js\";\nimport { unpackFloatRGBA as b, assert as w } from \"./Util.js\";\nconst v = 1e4,\n      j = 100,\n      R = 500,\n      B = 500,\n      C = .1;\n\nfunction M(e, t, r) {\n  return b(t, e) * (r[1] - r[0]) + r[0];\n}\n\nfunction A(e, t, r) {\n  if (t.size < v) return U.compute(e, t);\n  const i = g();\n  return r.forAll(t => {\n    t.isVisible && m(i, S(e, t));\n  }), i;\n}\n\nfunction S(t, r) {\n  if (!r.isVisible) return;\n  const i = g(),\n        n = r.getSpatialQueryAccelerator();\n  return e(n) ? y(i, t, n) : I(i, t, r.objects), i;\n}\n\nfunction y(e, t, r) {\n  const i = t.eye,\n        n = t.viewForward,\n        s = t.frustum,\n        a = e => e.isVisible,\n        o = r.objectCount;\n\n  if (o < R) p(N, t.near, Math.min(e.near, t.far)), r.forEachInDepthRange(i, n, 1, N, (r, i) => {\n    P(e, t, r), N.far = e.near, i.setRange(N);\n  }, s, a), p(N, Math.max(e.far, t.near), t.far), r.forEachInDepthRange(i, n, -1, N, (r, i) => {\n    P(e, t, r), N.near = e.far, i.setRange(N);\n  }, s, a);else {\n    const i = Math.max(Math.min(o, B), Math.ceil(o * C)),\n          h = r.findClosest(n, 1, s, a, i),\n          f = r.findClosest(n, -1, s, a, i);\n    h && f && (V(e, t, h.boundingVolumeWorldSpace.bounds), V(e, t, f.boundingVolumeWorldSpace.bounds));\n  }\n}\n\nfunction I(e, t, r) {\n  T.clear(), r.forAll(e => {\n    e.isVisible && 0 !== e.getNumGeometryRecords() && T.add(e);\n  }), T.empty || (T.sort(t), p(N, t.near, Math.min(e.near, t.far)), T.forEachInDepthRange(N, 1, (r, i) => {\n    i < e.near && P(e, t, r);\n  }), p(N, Math.max(e.far, t.near), t.far), T.forEachInDepthRange(N, -1, (t, r, i) => {\n    e.far = Math.max(e.far, i);\n  }));\n}\n\nfunction P(e, t, r) {\n  if (!r.isVisible) return;\n  if (!f(t.frustum, r.boundingVolumeWorldSpace.bounds)) return;\n  const n = r.transformation,\n        s = F;\n  r.geometryRecords.forEach(r => {\n    i(s, n, r.getShaderTransformation());\n    const a = d(s);\n    x(e, t, r.geometry.boundingInfo, s, a);\n  });\n}\n\nfunction x(e, r, i, n, s) {\n  if (t(i)) return;\n  const o = r.eye,\n        h = r.viewForward;\n  a(k, i.center, n);\n  const c = h[0] * (k[0] - o[0]) + h[1] * (k[1] - o[1]) + h[2] * (k[2] - o[2]);\n  if (k[3] = i.radius * s, !(c - k[3] > e.near && c + k[3] < e.far) && f(r.frustum, k)) if (i.radius > j && i.getChildren()) {\n    const t = i.getChildren();\n\n    for (let i = 0; i < 8; ++i) t[i] && x(e, r, t[i], n, s);\n  } else L.unionDepthRangeWithAABB(e, r.viewProjectionMatrix, n, i.bbMin, i.bbMax);\n}\n\nfunction V(e, t, r) {\n  const i = t.eye,\n        n = t.viewForward,\n        s = (r[0] - i[0]) * n[0] + (r[1] - i[1]) * n[1] + (r[2] - i[2]) * n[2];\n  e.near = Math.min(e.near, s - r[3]), e.far = Math.max(e.far, s + r[3]);\n}\n\nclass _ {\n  constructor() {\n    this._items = new r({\n      allocator: e => e || {\n        obj: null,\n        distance: 0,\n        near: 0,\n        far: 0\n      },\n      deallocator: e => (e.obj = null, e.distance = 0, e.near = 0, e.far = 0, e)\n    });\n  }\n\n  get length() {\n    return this._items.length;\n  }\n\n  get empty() {\n    return 0 === this._items.length;\n  }\n\n  clear() {\n    this._items.clear();\n  }\n\n  add(e) {\n    this._items.pushNew().obj = e;\n  }\n\n  sort(e) {\n    const t = e.eye,\n          r = e.viewForward;\n    this._items.forAll(e => {\n      const i = e.obj.boundingVolumeWorldSpace.bounds,\n            n = (i[0] - t[0]) * r[0] + (i[1] - t[1]) * r[1] + (i[2] - t[2]) * r[2];\n      e.distance = n, e.near = n - i[3], e.far = n + i[3];\n    }), this._items.sort((e, t) => e.distance - t.distance);\n  }\n\n  forEachInDepthRange(e, t, r) {\n    if (1 === t) for (let i = 0; i < this._items.length; ++i) {\n      const t = this._items.data[i];\n      t.far < e.near || t.near > e.far || r(t.obj, t.near, t.far);\n    } else for (let i = this._items.length - 1; i >= 0; --i) {\n      const t = this._items.data[i];\n      t.far < e.near || t.near > e.far || r(t.obj, t.near, t.far);\n    }\n  }\n\n}\n\nclass D {\n  constructor() {\n    this.view = s(), this.viewProj = s(), this.frustum = c(), this.geometries = [], this.near = [], this.far = [], this.nearCandidates = [], this.farCandidates = [], this.range = {\n      near: 0,\n      far: 0\n    }, this.looseRange = {\n      near: 0,\n      far: 0\n    };\n  }\n\n  compute(e, t) {\n    this.reset(), n(this.view, e.viewMatrix), i(this.viewProj, e.projectionMatrix, this.view), l(e.frustum, this.frustum);\n    const r = this.view,\n          s = r[2],\n          a = r[6],\n          o = r[10],\n          h = r[14],\n          f = this.range;\n    let c = 0;\n    if (t.forEach(e => {\n      if (!e.instanceParameters.visible) return;\n      if (!e.castShadow) return;\n      let t;\n      e.hasShaderTransformation ? (e.computeBoundingSphere(e.getShaderTransformation(), k, 1), t = k) : t = e.boundingSphere;\n      const r = s * t[0] + a * t[1] + o * t[2] + h,\n            i = r - t[3],\n            n = r + t[3];\n      this.geometries[c] = e, this.near[c] = -n, this.far[c] = -i, ++c;\n    }), 0 === this.geometries.length) return f;\n\n    for (let i = 0; i < this.geometries.length; ++i) this.near[i] > f.far && (f.far = this.near[i]), this.near[i] > 2 && this.far[i] < f.near && (f.near = this.far[i]);\n\n    const u = this.looseRange;\n    u.near = Math.max(.5 * f.near, 2), u.far = 2 * f.far;\n    let d = 0,\n        g = 0;\n\n    for (let i = 0; i < this.geometries.length; ++i) this.near[i] < f.near && (this.near[i] >= u.near ? f.near = this.near[i] : this.nearCandidates[d++] = i), this.far[i] > f.far && (this.far[i] <= u.far ? f.far = this.far[i] : this.farCandidates[g++] = i);\n\n    if (0 === this.nearCandidates.length && 0 === this.farCandidates.length) return f;\n    this.nearCandidates.sort((e, t) => this.near[e] < this.near[t] ? -1 : this.near[e] > this.near[t] ? 1 : 0), this.farCandidates.sort((e, t) => this.far[e] < this.far[t] ? 1 : this.far[e] > this.far[t] ? -1 : 0);\n\n    for (let i = 0; i < this.nearCandidates.length; ++i) {\n      const e = this.nearCandidates[i];\n\n      if (this.near[e] < f.near) {\n        const t = this.geometries[e],\n              r = t.boundingInfo;\n        this.includeNearBoundingInfoRec(r, t.getShaderTransformation());\n      }\n    }\n\n    for (let i = 0; i < this.farCandidates.length; ++i) {\n      const e = this.farCandidates[i];\n\n      if (this.far[e] > f.far) {\n        const t = this.geometries[e],\n              r = t.boundingInfo;\n        this.includeFarBoundingInfoRec(r, t.getShaderTransformation());\n      }\n    }\n\n    return f;\n  }\n\n  reset() {\n    this.geometries.length = 0, this.near.length = 0, this.far.length = 0, this.nearCandidates.length = 0, this.farCandidates.length = 0, this.range.near = Number.MAX_VALUE, this.range.far = -Number.MAX_VALUE;\n  }\n\n  includeNearBoundingInfoRec(e, r) {\n    if (t(e)) return;\n    const i = e.getCenter();\n    a(k, i, r);\n    const n = d(r),\n          s = k[0],\n          o = k[1],\n          h = k[2],\n          f = e.getBSRadius() * n,\n          c = this.frustum;\n    if (c[0][0] * s + c[0][1] * o + c[0][2] * h + c[0][3] > f || c[1][0] * s + c[1][1] * o + c[1][2] * h + c[1][3] > f || c[2][0] * s + c[2][1] * o + c[2][2] * h + c[2][3] > f || c[3][0] * s + c[3][1] * o + c[3][2] * h + c[3][3] > f) return;\n    const l = this.view[2] * s + this.view[6] * o + this.view[10] * h + this.view[14],\n          u = l + f;\n    if (!(-(l - f) < 2 || -u >= this.range.near)) if (-u > this.looseRange.near) this.range.near = -u;else {\n      if (f > j) {\n        const t = e.getChildren();\n\n        if (void 0 !== t) {\n          for (let e = 0; e < 8; ++e) void 0 !== t[e] && this.includeNearBoundingInfoRec(t[e], r);\n\n          return;\n        }\n      }\n\n      L.unionDepthRangeWithAABB(this.range, this.viewProj, r, e.getBBMin(), e.getBBMax());\n    }\n  }\n\n  includeFarBoundingInfoRec(e, r) {\n    if (t(e)) return;\n    let i = e.getBSRadius();\n    const n = e.getCenter();\n    a(k, n, r);\n    const s = d(r),\n          o = k[0],\n          h = k[1],\n          f = k[2];\n    i *= s;\n    const c = this.frustum;\n    if (c[0][0] * o + c[0][1] * h + c[0][2] * f + c[0][3] > i || c[1][0] * o + c[1][1] * h + c[1][2] * f + c[1][3] > i || c[2][0] * o + c[2][1] * h + c[2][2] * f + c[2][3] > i || c[3][0] * o + c[3][1] * h + c[3][2] * f + c[3][3] > i) return;\n    const l = this.view[2] * o + this.view[6] * h + this.view[10] * f + this.view[14] - i;\n    if (!(-l <= this.range.far)) if (-l < this.looseRange.far) this.range.far = -l;else {\n      if (i > j) {\n        const t = e.getChildren();\n\n        if (void 0 !== t) {\n          for (let e = 0; e < 8; ++e) void 0 !== t[e] && this.includeFarBoundingInfoRec(t[e], r);\n\n          return;\n        }\n      }\n\n      L.unionDepthRangeWithAABB(this.range, this.viewProj, r, e.getBBMin(), e.getBBMax());\n    }\n  }\n\n}\n\nclass E {\n  constructor() {\n    this.modelViewProj = s(), this.clipPosition = [h(), h(), h(), h(), h(), h(), h(), h()];\n  }\n\n  unionDepthRangeWithAABB(e, t, r, n, s) {\n    const a = this.modelViewProj;\n    i(a, t, r);\n    let o = !1;\n\n    for (let i = 0; i < 8; ++i) {\n      const e = this.clipPosition[i],\n            t = 0 === i || 3 === i || 4 === i || 7 === i ? n[0] : s[0],\n            r = 0 === i || 1 === i || 4 === i || 5 === i ? n[1] : s[1],\n            o = i < 4 ? n[2] : s[2];\n      e[0] = a[0] * t + a[4] * r + a[8] * o + a[12], e[1] = a[1] * t + a[5] * r + a[9] * o + a[13], e[2] = a[2] * t + a[6] * r + a[10] * o + a[14], e[3] = a[3] * t + a[7] * r + a[11] * o + a[15];\n    }\n\n    for (let i = 0; i < 12; ++i) {\n      const t = this.clipPosition[W[i][0]],\n            r = this.clipPosition[W[i][1]],\n            n = this.clipPosition[W[i][2]],\n            s = this.clipTriangle(t, r, n);\n      let a = !0;\n\n      for (let e = 0; e < s.length; ++e) {\n        if (s[e][3] >= 2) {\n          a = !1;\n          break;\n        }\n      }\n\n      if (!a) {\n        o = !0;\n\n        for (let t = 0; t < s.length; ++t) {\n          const r = s[t][3];\n          r < e.near && (e.near = r), r > e.far && (e.far = r);\n        }\n      }\n    }\n\n    return o;\n  }\n\n  inside(e, t) {\n    return 0 === t ? e[0] >= -e[3] : 1 === t ? e[1] >= -e[3] : 2 === t ? e[0] <= e[3] : 3 === t ? e[1] <= e[3] : void w(!1);\n  }\n\n  intersect(e, t, r) {\n    let i = 0;\n    return 0 === r ? i = (-e[3] - e[0]) / (t[0] - e[0] + t[3] - e[3]) : 1 === r ? i = (-e[3] - e[1]) / (t[1] - e[1] + t[3] - e[3]) : 2 === r ? i = (e[3] - e[0]) / (t[0] - e[0] - t[3] + e[3]) : 3 === r && (i = (e[3] - e[1]) / (t[1] - e[1] - t[3] + e[3])), o(h(), e, t, i);\n  }\n\n  clipTriangle(e, t, r) {\n    let i = [e, t, r];\n\n    for (let n = 0; n < 4; ++n) {\n      const e = i;\n      i = [];\n\n      for (let t = 0; t < e.length; ++t) {\n        const r = e[t],\n              s = e[(t + 1) % e.length];\n        this.inside(s, n) ? (this.inside(r, n) || i.push(this.intersect(r, s, n)), i.push(s)) : this.inside(r, n) && i.push(this.intersect(r, s, n));\n      }\n    }\n\n    return i;\n  }\n\n}\n\nconst W = [[0, 1, 3], [2, 3, 1], [1, 5, 2], [6, 2, 5], [5, 4, 6], [7, 6, 4], [4, 0, 7], [3, 7, 0], [3, 2, 7], [6, 7, 2], [4, 5, 0], [1, 0, 5]],\n      k = u(),\n      F = s(),\n      N = g(),\n      T = new _(),\n      U = new D(),\n      L = new E();\nexport { D as DepthRangeFromRenderGeometries, S as depthRangeFromLayer, A as depthRangeFromScene, M as textureToDepth };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/depthRangeUtils.js"],"names":["isSome","e","isNone","t","r","m","i","d","n","c","s","a","l","o","h","intersectsSphere","f","create","copy","u","maxScale","empty","g","union","set","p","unpackFloatRGBA","b","assert","w","v","j","R","B","C","M","A","size","U","compute","forAll","isVisible","S","getSpatialQueryAccelerator","y","I","objects","eye","viewForward","frustum","objectCount","N","near","Math","min","far","forEachInDepthRange","P","setRange","max","ceil","findClosest","V","boundingVolumeWorldSpace","bounds","T","clear","getNumGeometryRecords","add","sort","transformation","F","geometryRecords","forEach","getShaderTransformation","x","geometry","boundingInfo","k","center","radius","getChildren","L","unionDepthRangeWithAABB","viewProjectionMatrix","bbMin","bbMax","_","constructor","_items","allocator","obj","distance","deallocator","length","pushNew","data","D","view","viewProj","geometries","nearCandidates","farCandidates","range","looseRange","reset","viewMatrix","projectionMatrix","instanceParameters","visible","castShadow","hasShaderTransformation","computeBoundingSphere","boundingSphere","includeNearBoundingInfoRec","includeFarBoundingInfoRec","Number","MAX_VALUE","getCenter","getBSRadius","getBBMin","getBBMax","E","modelViewProj","clipPosition","W","clipTriangle","inside","intersect","push","DepthRangeFromRenderGeometries","depthRangeFromLayer","depthRangeFromScene","textureToDepth"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../../core/maybe.js\";import r from\"../../../../core/PooledArray.js\";import{m as i,d as n}from\"../../../../chunks/mat4.js\";import{c as s}from\"../../../../chunks/mat4f64.js\";import{m as a}from\"../../../../chunks/vec3.js\";import{l as o}from\"../../../../chunks/vec4.js\";import{c as h}from\"../../../../chunks/vec4f64.js\";import{intersectsSphere as f,create as c,copy as l}from\"../../../../geometry/support/frustum.js\";import{c as u}from\"../../../../chunks/sphere.js\";import{maxScale as d}from\"../../support/mathUtils.js\";import{empty as g,union as m,set as p}from\"./depthRange.js\";import{unpackFloatRGBA as b,assert as w}from\"./Util.js\";const v=1e4,j=100,R=500,B=500,C=.1;function M(e,t,r){return b(t,e)*(r[1]-r[0])+r[0]}function A(e,t,r){if(t.size<v)return U.compute(e,t);const i=g();return r.forAll((t=>{t.isVisible&&m(i,S(e,t))})),i}function S(t,r){if(!r.isVisible)return;const i=g(),n=r.getSpatialQueryAccelerator();return e(n)?y(i,t,n):I(i,t,r.objects),i}function y(e,t,r){const i=t.eye,n=t.viewForward,s=t.frustum,a=e=>e.isVisible,o=r.objectCount;if(o<R)p(N,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,1,N,((r,i)=>{P(e,t,r),N.far=e.near,i.setRange(N)}),s,a),p(N,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,-1,N,((r,i)=>{P(e,t,r),N.near=e.far,i.setRange(N)}),s,a);else{const i=Math.max(Math.min(o,B),Math.ceil(o*C)),h=r.findClosest(n,1,s,a,i),f=r.findClosest(n,-1,s,a,i);h&&f&&(V(e,t,h.boundingVolumeWorldSpace.bounds),V(e,t,f.boundingVolumeWorldSpace.bounds))}}function I(e,t,r){T.clear(),r.forAll((e=>{e.isVisible&&0!==e.getNumGeometryRecords()&&T.add(e)})),T.empty||(T.sort(t),p(N,t.near,Math.min(e.near,t.far)),T.forEachInDepthRange(N,1,((r,i)=>{i<e.near&&P(e,t,r)})),p(N,Math.max(e.far,t.near),t.far),T.forEachInDepthRange(N,-1,((t,r,i)=>{e.far=Math.max(e.far,i)})))}function P(e,t,r){if(!r.isVisible)return;if(!f(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const n=r.transformation,s=F;r.geometryRecords.forEach((r=>{i(s,n,r.getShaderTransformation());const a=d(s);x(e,t,r.geometry.boundingInfo,s,a)}))}function x(e,r,i,n,s){if(t(i))return;const o=r.eye,h=r.viewForward;a(k,i.center,n);const c=h[0]*(k[0]-o[0])+h[1]*(k[1]-o[1])+h[2]*(k[2]-o[2]);if(k[3]=i.radius*s,!(c-k[3]>e.near&&c+k[3]<e.far)&&f(r.frustum,k))if(i.radius>j&&i.getChildren()){const t=i.getChildren();for(let i=0;i<8;++i)t[i]&&x(e,r,t[i],n,s)}else L.unionDepthRangeWithAABB(e,r.viewProjectionMatrix,n,i.bbMin,i.bbMax)}function V(e,t,r){const i=t.eye,n=t.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];e.near=Math.min(e.near,s-r[3]),e.far=Math.max(e.far,s+r[3])}class _{constructor(){this._items=new r({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const t=e.eye,r=e.viewForward;this._items.forAll((e=>{const i=e.obj.boundingVolumeWorldSpace.bounds,n=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=n,e.near=n-i[3],e.far=n+i[3]})),this._items.sort(((e,t)=>e.distance-t.distance))}forEachInDepthRange(e,t,r){if(1===t)for(let i=0;i<this._items.length;++i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.obj,t.near,t.far)}else for(let i=this._items.length-1;i>=0;--i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.obj,t.near,t.far)}}}class D{constructor(){this.view=s(),this.viewProj=s(),this.frustum=c(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(e,t){this.reset(),n(this.view,e.viewMatrix),i(this.viewProj,e.projectionMatrix,this.view),l(e.frustum,this.frustum);const r=this.view,s=r[2],a=r[6],o=r[10],h=r[14],f=this.range;let c=0;if(t.forEach((e=>{if(!e.instanceParameters.visible)return;if(!e.castShadow)return;let t;e.hasShaderTransformation?(e.computeBoundingSphere(e.getShaderTransformation(),k,1),t=k):t=e.boundingSphere;const r=s*t[0]+a*t[1]+o*t[2]+h,i=r-t[3],n=r+t[3];this.geometries[c]=e,this.near[c]=-n,this.far[c]=-i,++c})),0===this.geometries.length)return f;for(let i=0;i<this.geometries.length;++i)this.near[i]>f.far&&(f.far=this.near[i]),this.near[i]>2&&this.far[i]<f.near&&(f.near=this.far[i]);const u=this.looseRange;u.near=Math.max(.5*f.near,2),u.far=2*f.far;let d=0,g=0;for(let i=0;i<this.geometries.length;++i)this.near[i]<f.near&&(this.near[i]>=u.near?f.near=this.near[i]:this.nearCandidates[d++]=i),this.far[i]>f.far&&(this.far[i]<=u.far?f.far=this.far[i]:this.farCandidates[g++]=i);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return f;this.nearCandidates.sort(((e,t)=>this.near[e]<this.near[t]?-1:this.near[e]>this.near[t]?1:0)),this.farCandidates.sort(((e,t)=>this.far[e]<this.far[t]?1:this.far[e]>this.far[t]?-1:0));for(let i=0;i<this.nearCandidates.length;++i){const e=this.nearCandidates[i];if(this.near[e]<f.near){const t=this.geometries[e],r=t.boundingInfo;this.includeNearBoundingInfoRec(r,t.getShaderTransformation())}}for(let i=0;i<this.farCandidates.length;++i){const e=this.farCandidates[i];if(this.far[e]>f.far){const t=this.geometries[e],r=t.boundingInfo;this.includeFarBoundingInfoRec(r,t.getShaderTransformation())}}return f}reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}includeNearBoundingInfoRec(e,r){if(t(e))return;const i=e.getCenter();a(k,i,r);const n=d(r),s=k[0],o=k[1],h=k[2],f=e.getBSRadius()*n,c=this.frustum;if(c[0][0]*s+c[0][1]*o+c[0][2]*h+c[0][3]>f||c[1][0]*s+c[1][1]*o+c[1][2]*h+c[1][3]>f||c[2][0]*s+c[2][1]*o+c[2][2]*h+c[2][3]>f||c[3][0]*s+c[3][1]*o+c[3][2]*h+c[3][3]>f)return;const l=this.view[2]*s+this.view[6]*o+this.view[10]*h+this.view[14],u=l+f;if(!(-(l-f)<2||-u>=this.range.near))if(-u>this.looseRange.near)this.range.near=-u;else{if(f>j){const t=e.getChildren();if(void 0!==t){for(let e=0;e<8;++e)void 0!==t[e]&&this.includeNearBoundingInfoRec(t[e],r);return}}L.unionDepthRangeWithAABB(this.range,this.viewProj,r,e.getBBMin(),e.getBBMax())}}includeFarBoundingInfoRec(e,r){if(t(e))return;let i=e.getBSRadius();const n=e.getCenter();a(k,n,r);const s=d(r),o=k[0],h=k[1],f=k[2];i*=s;const c=this.frustum;if(c[0][0]*o+c[0][1]*h+c[0][2]*f+c[0][3]>i||c[1][0]*o+c[1][1]*h+c[1][2]*f+c[1][3]>i||c[2][0]*o+c[2][1]*h+c[2][2]*f+c[2][3]>i||c[3][0]*o+c[3][1]*h+c[3][2]*f+c[3][3]>i)return;const l=this.view[2]*o+this.view[6]*h+this.view[10]*f+this.view[14]-i;if(!(-l<=this.range.far))if(-l<this.looseRange.far)this.range.far=-l;else{if(i>j){const t=e.getChildren();if(void 0!==t){for(let e=0;e<8;++e)void 0!==t[e]&&this.includeFarBoundingInfoRec(t[e],r);return}}L.unionDepthRangeWithAABB(this.range,this.viewProj,r,e.getBBMin(),e.getBBMax())}}}class E{constructor(){this.modelViewProj=s(),this.clipPosition=[h(),h(),h(),h(),h(),h(),h(),h()]}unionDepthRangeWithAABB(e,t,r,n,s){const a=this.modelViewProj;i(a,t,r);let o=!1;for(let i=0;i<8;++i){const e=this.clipPosition[i],t=0===i||3===i||4===i||7===i?n[0]:s[0],r=0===i||1===i||4===i||5===i?n[1]:s[1],o=i<4?n[2]:s[2];e[0]=a[0]*t+a[4]*r+a[8]*o+a[12],e[1]=a[1]*t+a[5]*r+a[9]*o+a[13],e[2]=a[2]*t+a[6]*r+a[10]*o+a[14],e[3]=a[3]*t+a[7]*r+a[11]*o+a[15]}for(let i=0;i<12;++i){const t=this.clipPosition[W[i][0]],r=this.clipPosition[W[i][1]],n=this.clipPosition[W[i][2]],s=this.clipTriangle(t,r,n);let a=!0;for(let e=0;e<s.length;++e){if(s[e][3]>=2){a=!1;break}}if(!a){o=!0;for(let t=0;t<s.length;++t){const r=s[t][3];r<e.near&&(e.near=r),r>e.far&&(e.far=r)}}}return o}inside(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void w(!1)}intersect(e,t,r){let i=0;return 0===r?i=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?i=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?i=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(i=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),o(h(),e,t,i)}clipTriangle(e,t,r){let i=[e,t,r];for(let n=0;n<4;++n){const e=i;i=[];for(let t=0;t<e.length;++t){const r=e[t],s=e[(t+1)%e.length];this.inside(s,n)?(this.inside(r,n)||i.push(this.intersect(r,s,n)),i.push(s)):this.inside(r,n)&&i.push(this.intersect(r,s,n))}}return i}}const W=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],k=u(),F=s(),N=g(),T=new _,U=new D,L=new E;export{D as DepthRangeFromRenderGeometries,S as depthRangeFromLayer,A as depthRangeFromScene,M as textureToDepth};\n"]},"metadata":{},"sourceType":"module"}