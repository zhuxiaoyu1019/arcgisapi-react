{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../chunks/tslib.es6.js\";\nimport \"../../core/has.js\";\nimport e from \"../../core/Error.js\";\nimport { JSONSupport as s } from \"../../core/JSONSupport.js\";\nimport { clone as i } from \"../../core/lang.js\";\nimport r from \"../../core/Logger.js\";\nimport { isNone as l } from \"../../core/maybe.js\";\nimport { property as a } from \"../../core/accessorSupport/decorators/property.js\";\nimport { cast as o } from \"../../core/accessorSupport/decorators/cast.js\";\nimport { subclass as h } from \"../../core/accessorSupport/decorators/subclass.js\";\nvar n;\nconst p = r.getLogger(\"esri.layers.support.PixelBlock\");\nlet c = n = class extends s {\n  constructor(t) {\n    super(t), this.width = null, this.height = null, this.pixelType = \"f32\", this.validPixelCount = null, this.mask = null, this.maskIsAlpha = !1, this.pixels = null, this.statistics = null;\n  }\n\n  static createEmptyBand(t, e) {\n    return new (n.getPixelArrayConstructor(t))(e);\n  }\n\n  static getPixelArrayConstructor(t) {\n    let e;\n\n    switch (t) {\n      case \"u1\":\n      case \"u2\":\n      case \"u4\":\n      case \"u8\":\n        e = Uint8Array;\n        break;\n\n      case \"u16\":\n        e = Uint16Array;\n        break;\n\n      case \"u32\":\n        e = Uint32Array;\n        break;\n\n      case \"s8\":\n        e = Int8Array;\n        break;\n\n      case \"s16\":\n        e = Int16Array;\n        break;\n\n      case \"s32\":\n        e = Int32Array;\n        break;\n\n      case \"u32\":\n        e = Uint32Array;\n        break;\n\n      case \"f32\":\n        e = Float32Array;\n        break;\n\n      case \"f64\":\n        e = Float64Array;\n        break;\n\n      case \"c64\":\n      case \"c128\":\n      case \"unknown\":\n        e = Float32Array;\n    }\n\n    return e;\n  }\n\n  castPixelType(t) {\n    if (!t) return \"f32\";\n    let e = t.toLowerCase();\n    return [\"u1\", \"u2\", \"u4\"].indexOf(e) > -1 ? e = \"u8\" : -1 === [\"unknown\", \"u8\", \"s8\", \"u16\", \"s16\", \"u32\", \"s32\", \"f32\", \"f64\"].indexOf(e) && (e = \"f32\"), e;\n  }\n\n  getPlaneCount() {\n    return this.pixels && this.pixels.length;\n  }\n\n  addData(t) {\n    if (!t.pixels || t.pixels.length !== this.width * this.height) throw new e(\"pixelblock:invalid-or-missing-pixels\", \"add data requires valid pixels array that has same length defined by pixel block width * height\");\n    this.pixels || (this.pixels = []), this.statistics || (this.statistics = []), this.pixels.push(t.pixels), this.statistics.push(t.statistics || {\n      minValue: null,\n      maxValue: null\n    });\n  }\n\n  getAsRGBA() {\n    const t = new ArrayBuffer(this.width * this.height * 4);\n\n    switch (this.pixelType) {\n      case \"s8\":\n      case \"s16\":\n      case \"u16\":\n      case \"s32\":\n      case \"u32\":\n      case \"f32\":\n      case \"f64\":\n        this._fillFromNon8Bit(t);\n\n        break;\n\n      default:\n        this._fillFrom8Bit(t);\n\n    }\n\n    return new Uint8ClampedArray(t);\n  }\n\n  getAsRGBAFloat() {\n    const t = new Float32Array(this.width * this.height * 4);\n    return this._fillFrom32Bit(t), t;\n  }\n\n  updateStatistics() {\n    this.statistics = this.pixels.map(t => this._calculateBandStatistics(t, this.mask));\n    const t = this.mask;\n    let e = 0;\n    if (t) for (let s = 0; s < t.length; s++) t[s] && e++;else e = this.width * this.height;\n    this.validPixelCount = e;\n  }\n\n  clamp(t) {\n    if (!t || \"f64\" === t || \"f32\" === t) return;\n    let e;\n\n    switch (t) {\n      case \"u8\":\n        e = [0, 255];\n        break;\n\n      case \"u16\":\n        e = [0, 65535];\n        break;\n\n      case \"u32\":\n        e = [0, 4294967295];\n        break;\n\n      case \"s8\":\n        e = [-128, 127];\n        break;\n\n      case \"s16\":\n        e = [-32768, 32767];\n        break;\n\n      case \"s32\":\n        e = [-2147483648, 2147483647];\n        break;\n\n      default:\n        e = [-34e38, 34e38];\n    }\n\n    const [s, i] = e,\n          r = this.pixels,\n          l = this.width * this.height,\n          a = r.length;\n    let o, h, p;\n    const c = [];\n\n    for (let u = 0; u < a; u++) {\n      p = n.createEmptyBand(t, l), o = r[u];\n\n      for (let t = 0; t < l; t++) h = o[t], p[t] = h > i ? i : h < s ? s : h;\n\n      c.push(p);\n    }\n\n    this.pixels = c, this.pixelType = t;\n  }\n\n  extractBands(t) {\n    if (l(t) || 0 === t.length || null == this.pixels || 0 === this.pixels.length) return this;\n    const e = this.pixels.length,\n          s = t.some(t => t >= this.pixels.length),\n          i = e === t.length && !t.some((t, e) => t !== e);\n    return s || i ? this : new n({\n      pixelType: this.pixelType,\n      width: this.width,\n      height: this.height,\n      mask: this.mask,\n      validPixelCount: this.validPixelCount,\n      maskIsAlpha: this.maskIsAlpha,\n      pixels: t.map(t => this.pixels[t]),\n      statistics: this.statistics && t.map(t => this.statistics[t])\n    });\n  }\n\n  clone() {\n    const t = new n({\n      width: this.width,\n      height: this.height,\n      pixelType: this.pixelType,\n      maskIsAlpha: this.maskIsAlpha,\n      validPixelCount: this.validPixelCount\n    });\n    let e;\n    this.mask && (this.mask instanceof Uint8Array ? t.mask = new Uint8Array(this.mask) : t.mask = this.mask.slice(0));\n    const s = n.getPixelArrayConstructor(this.pixelType);\n\n    if (this.pixels && this.pixels.length > 0) {\n      t.pixels = [];\n      const i = this.pixels[0].slice;\n\n      for (e = 0; e < this.pixels.length; e++) t.pixels[e] = i ? this.pixels[e].slice(0, this.pixels[e].length) : new s(this.pixels[e]);\n    }\n\n    if (this.statistics) for (t.statistics = [], e = 0; e < this.statistics.length; e++) t.statistics[e] = i(this.statistics[e]);\n    return t;\n  }\n\n  _fillFrom8Bit(t) {\n    const {\n      mask: e,\n      maskIsAlpha: s,\n      pixels: i\n    } = this;\n    if (!t || !i || !i.length) return void p.error(\"getAsRGBA()\", \"Unable to convert to RGBA. The input pixel block is empty.\");\n    let r, l, a, o;\n    r = l = a = i[0], i.length >= 3 ? (l = i[1], a = i[2]) : 2 === i.length && (l = i[1]);\n    const h = new Uint32Array(t),\n          n = this.width * this.height;\n    if (r.length === n) {\n      if (e && e.length === n) {\n        if (s) for (o = 0; o < n; o++) e[o] && (h[o] = e[o] << 24 | a[o] << 16 | l[o] << 8 | r[o]);else for (o = 0; o < n; o++) e[o] && (h[o] = 255 << 24 | a[o] << 16 | l[o] << 8 | r[o]);\n      } else for (o = 0; o < n; o++) h[o] = 255 << 24 | a[o] << 16 | l[o] << 8 | r[o];\n    } else p.error(\"getAsRGBA()\", \"Unable to convert to RGBA. The pixelblock is invalid.\");\n  }\n\n  _fillFromNon8Bit(t) {\n    const {\n      pixels: e,\n      mask: s,\n      statistics: i\n    } = this;\n    if (!t || !e || !e.length) return void p.error(\"getAsRGBA()\", \"Unable to convert to RGBA. The input pixel block is empty.\");\n    const r = this.pixelType;\n    let l = 1,\n        a = 0,\n        o = 1;\n    if (i && i.length > 0) a = i.map(t => t.minValue).reduce((t, e) => Math.min(t, e)), o = i.map(t => t.maxValue - t.minValue).reduce((t, e) => Math.max(t, e)), l = 255 / o;else {\n      let t = 255;\n      \"s8\" === r ? (a = -128, t = 127) : \"u16\" === r ? t = 65535 : \"s16\" === r ? (a = -32768, t = 32767) : \"u32\" === r ? t = 4294967295 : \"s32\" === r ? (a = -2147483648, t = 2147483647) : \"f32\" === r ? (a = -34e38, t = 34e38) : \"f64\" === r && (a = -Number.MAX_VALUE, t = Number.MAX_VALUE), l = 255 / (t - a);\n    }\n    const h = new Uint32Array(t),\n          n = this.width * this.height;\n    let c, u, m, x, f;\n    if (c = u = m = e[0], c.length !== n) return p.error(\"getAsRGBA()\", \"Unable to convert to RGBA. The pixelblock is invalid.\");\n    if (e.length >= 2) {\n      if (u = e[1], e.length >= 3 && (m = e[2]), s && s.length === n) for (x = 0; x < n; x++) s[x] && (h[x] = 255 << 24 | (m[x] - a) * l << 16 | (u[x] - a) * l << 8 | (c[x] - a) * l);else for (x = 0; x < n; x++) h[x] = 255 << 24 | (m[x] - a) * l << 16 | (u[x] - a) * l << 8 | (c[x] - a) * l;\n    } else if (s && s.length === n) for (x = 0; x < n; x++) f = (c[x] - a) * l, s[x] && (h[x] = 255 << 24 | f << 16 | f << 8 | f);else for (x = 0; x < n; x++) f = (c[x] - a) * l, h[x] = 255 << 24 | f << 16 | f << 8 | f;\n  }\n\n  _fillFrom32Bit(t) {\n    const {\n      pixels: e,\n      mask: s\n    } = this;\n    if (!t || !e || !e.length) return p.error(\"getAsRGBAFloat()\", \"Unable to convert to RGBA. The input pixel block is empty.\");\n    let i, r, l, a;\n    i = r = l = e[0], e.length >= 3 ? (r = e[1], l = e[2]) : 2 === e.length && (r = e[1]);\n    const o = this.width * this.height;\n    if (i.length !== o) return p.error(\"getAsRGBAFloat()\", \"Unable to convert to RGBA. The pixelblock is invalid.\");\n    let h = 0;\n    if (s && s.length === o) for (a = 0; a < o; a++) t[h++] = i[a], t[h++] = r[a], t[h++] = l[a], t[h++] = 1 & s[a];else for (a = 0; a < o; a++) t[h++] = i[a], t[h++] = r[a], t[h++] = l[a], t[h++] = 1;\n  }\n\n  _calculateBandStatistics(t, e) {\n    let s = 1 / 0,\n        i = -1 / 0;\n    const r = t.length;\n    let l,\n        a = 0;\n    if (e) for (l = 0; l < r; l++) e[l] && (a = t[l], s = a < s ? a : s, i = a > i ? a : i);else for (l = 0; l < r; l++) a = t[l], s = a < s ? a : s, i = a > i ? a : i;\n    return {\n      minValue: s,\n      maxValue: i\n    };\n  }\n\n};\nt([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"width\", void 0), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"height\", void 0), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"pixelType\", void 0), t([o(\"pixelType\")], c.prototype, \"castPixelType\", null), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"validPixelCount\", void 0), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"mask\", void 0), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"maskIsAlpha\", void 0), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"pixels\", void 0), t([a({\n  json: {\n    write: !0\n  }\n})], c.prototype, \"statistics\", void 0), c = n = t([h(\"esri.layers.support.PixelBlock\")], c);\nvar u = c;\nexport default u;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/PixelBlock.js"],"names":["_","t","e","JSONSupport","s","clone","i","r","isNone","l","property","a","cast","o","subclass","h","n","p","getLogger","c","constructor","width","height","pixelType","validPixelCount","mask","maskIsAlpha","pixels","statistics","createEmptyBand","getPixelArrayConstructor","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","Float32Array","Float64Array","castPixelType","toLowerCase","indexOf","getPlaneCount","length","addData","push","minValue","maxValue","getAsRGBA","ArrayBuffer","_fillFromNon8Bit","_fillFrom8Bit","Uint8ClampedArray","getAsRGBAFloat","_fillFrom32Bit","updateStatistics","map","_calculateBandStatistics","clamp","u","extractBands","some","slice","error","reduce","Math","min","max","Number","MAX_VALUE","m","x","f","json","write","prototype"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import e from\"../../core/Error.js\";import{JSONSupport as s}from\"../../core/JSONSupport.js\";import{clone as i}from\"../../core/lang.js\";import r from\"../../core/Logger.js\";import{isNone as l}from\"../../core/maybe.js\";import{property as a}from\"../../core/accessorSupport/decorators/property.js\";import{cast as o}from\"../../core/accessorSupport/decorators/cast.js\";import{subclass as h}from\"../../core/accessorSupport/decorators/subclass.js\";var n;const p=r.getLogger(\"esri.layers.support.PixelBlock\");let c=n=class extends s{constructor(t){super(t),this.width=null,this.height=null,this.pixelType=\"f32\",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.pixels=null,this.statistics=null}static createEmptyBand(t,e){return new(n.getPixelArrayConstructor(t))(e)}static getPixelArrayConstructor(t){let e;switch(t){case\"u1\":case\"u2\":case\"u4\":case\"u8\":e=Uint8Array;break;case\"u16\":e=Uint16Array;break;case\"u32\":e=Uint32Array;break;case\"s8\":e=Int8Array;break;case\"s16\":e=Int16Array;break;case\"s32\":e=Int32Array;break;case\"u32\":e=Uint32Array;break;case\"f32\":e=Float32Array;break;case\"f64\":e=Float64Array;break;case\"c64\":case\"c128\":case\"unknown\":e=Float32Array}return e}castPixelType(t){if(!t)return\"f32\";let e=t.toLowerCase();return[\"u1\",\"u2\",\"u4\"].indexOf(e)>-1?e=\"u8\":-1===[\"unknown\",\"u8\",\"s8\",\"u16\",\"s16\",\"u32\",\"s32\",\"f32\",\"f64\"].indexOf(e)&&(e=\"f32\"),e}getPlaneCount(){return this.pixels&&this.pixels.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new e(\"pixelblock:invalid-or-missing-pixels\",\"add data requires valid pixels array that has same length defined by pixel block width * height\");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics||{minValue:null,maxValue:null})}getAsRGBA(){const t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case\"s8\":case\"s16\":case\"u16\":case\"s32\":case\"u32\":case\"f32\":case\"f64\":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){const t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){this.statistics=this.pixels.map((t=>this._calculateBandStatistics(t,this.mask)));const t=this.mask;let e=0;if(t)for(let s=0;s<t.length;s++)t[s]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||\"f64\"===t||\"f32\"===t)return;let e;switch(t){case\"u8\":e=[0,255];break;case\"u16\":e=[0,65535];break;case\"u32\":e=[0,4294967295];break;case\"s8\":e=[-128,127];break;case\"s16\":e=[-32768,32767];break;case\"s32\":e=[-2147483648,2147483647];break;default:e=[-34e38,34e38]}const[s,i]=e,r=this.pixels,l=this.width*this.height,a=r.length;let o,h,p;const c=[];for(let u=0;u<a;u++){p=n.createEmptyBand(t,l),o=r[u];for(let t=0;t<l;t++)h=o[t],p[t]=h>i?i:h<s?s:h;c.push(p)}this.pixels=c,this.pixelType=t}extractBands(t){if(l(t)||0===t.length||null==this.pixels||0===this.pixels.length)return this;const e=this.pixels.length,s=t.some((t=>t>=this.pixels.length)),i=e===t.length&&!t.some(((t,e)=>t!==e));return s||i?this:new n({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:t.map((t=>this.pixels[t])),statistics:this.statistics&&t.map((t=>this.statistics[t]))})}clone(){const t=new n({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let e;this.mask&&(this.mask instanceof Uint8Array?t.mask=new Uint8Array(this.mask):t.mask=this.mask.slice(0));const s=n.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];const i=this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=i?this.pixels[e].slice(0,this.pixels[e].length):new s(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=i(this.statistics[e]);return t}_fillFrom8Bit(t){const{mask:e,maskIsAlpha:s,pixels:i}=this;if(!t||!i||!i.length)return void p.error(\"getAsRGBA()\",\"Unable to convert to RGBA. The input pixel block is empty.\");let r,l,a,o;r=l=a=i[0],i.length>=3?(l=i[1],a=i[2]):2===i.length&&(l=i[1]);const h=new Uint32Array(t),n=this.width*this.height;if(r.length===n)if(e&&e.length===n)if(s)for(o=0;o<n;o++)e[o]&&(h[o]=e[o]<<24|a[o]<<16|l[o]<<8|r[o]);else for(o=0;o<n;o++)e[o]&&(h[o]=255<<24|a[o]<<16|l[o]<<8|r[o]);else for(o=0;o<n;o++)h[o]=255<<24|a[o]<<16|l[o]<<8|r[o];else p.error(\"getAsRGBA()\",\"Unable to convert to RGBA. The pixelblock is invalid.\")}_fillFromNon8Bit(t){const{pixels:e,mask:s,statistics:i}=this;if(!t||!e||!e.length)return void p.error(\"getAsRGBA()\",\"Unable to convert to RGBA. The input pixel block is empty.\");const r=this.pixelType;let l=1,a=0,o=1;if(i&&i.length>0)a=i.map((t=>t.minValue)).reduce(((t,e)=>Math.min(t,e))),o=i.map((t=>t.maxValue-t.minValue)).reduce(((t,e)=>Math.max(t,e))),l=255/o;else{let t=255;\"s8\"===r?(a=-128,t=127):\"u16\"===r?t=65535:\"s16\"===r?(a=-32768,t=32767):\"u32\"===r?t=4294967295:\"s32\"===r?(a=-2147483648,t=2147483647):\"f32\"===r?(a=-34e38,t=34e38):\"f64\"===r&&(a=-Number.MAX_VALUE,t=Number.MAX_VALUE),l=255/(t-a)}const h=new Uint32Array(t),n=this.width*this.height;let c,u,m,x,f;if(c=u=m=e[0],c.length!==n)return p.error(\"getAsRGBA()\",\"Unable to convert to RGBA. The pixelblock is invalid.\");if(e.length>=2)if(u=e[1],e.length>=3&&(m=e[2]),s&&s.length===n)for(x=0;x<n;x++)s[x]&&(h[x]=255<<24|(m[x]-a)*l<<16|(u[x]-a)*l<<8|(c[x]-a)*l);else for(x=0;x<n;x++)h[x]=255<<24|(m[x]-a)*l<<16|(u[x]-a)*l<<8|(c[x]-a)*l;else if(s&&s.length===n)for(x=0;x<n;x++)f=(c[x]-a)*l,s[x]&&(h[x]=255<<24|f<<16|f<<8|f);else for(x=0;x<n;x++)f=(c[x]-a)*l,h[x]=255<<24|f<<16|f<<8|f}_fillFrom32Bit(t){const{pixels:e,mask:s}=this;if(!t||!e||!e.length)return p.error(\"getAsRGBAFloat()\",\"Unable to convert to RGBA. The input pixel block is empty.\");let i,r,l,a;i=r=l=e[0],e.length>=3?(r=e[1],l=e[2]):2===e.length&&(r=e[1]);const o=this.width*this.height;if(i.length!==o)return p.error(\"getAsRGBAFloat()\",\"Unable to convert to RGBA. The pixelblock is invalid.\");let h=0;if(s&&s.length===o)for(a=0;a<o;a++)t[h++]=i[a],t[h++]=r[a],t[h++]=l[a],t[h++]=1&s[a];else for(a=0;a<o;a++)t[h++]=i[a],t[h++]=r[a],t[h++]=l[a],t[h++]=1}_calculateBandStatistics(t,e){let s=1/0,i=-1/0;const r=t.length;let l,a=0;if(e)for(l=0;l<r;l++)e[l]&&(a=t[l],s=a<s?a:s,i=a>i?a:i);else for(l=0;l<r;l++)a=t[l],s=a<s?a:s,i=a>i?a:i;return{minValue:s,maxValue:i}}};t([a({json:{write:!0}})],c.prototype,\"width\",void 0),t([a({json:{write:!0}})],c.prototype,\"height\",void 0),t([a({json:{write:!0}})],c.prototype,\"pixelType\",void 0),t([o(\"pixelType\")],c.prototype,\"castPixelType\",null),t([a({json:{write:!0}})],c.prototype,\"validPixelCount\",void 0),t([a({json:{write:!0}})],c.prototype,\"mask\",void 0),t([a({json:{write:!0}})],c.prototype,\"maskIsAlpha\",void 0),t([a({json:{write:!0}})],c.prototype,\"pixels\",void 0),t([a({json:{write:!0}})],c.prototype,\"statistics\",void 0),c=n=t([h(\"esri.layers.support.PixelBlock\")],c);var u=c;export default u;\n"]},"metadata":{},"sourceType":"module"}