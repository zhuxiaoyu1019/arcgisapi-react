{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { Q as e } from \"../../../chunks/languageUtils.js\";\nimport t from \"../support/FeatureSet.js\";\nimport r from \"../support/IdSet.js\";\nimport n from \"../support/OrderbyClause.js\";\nimport { resolve as s, reject as i } from \"../../../core/promiseUtils.js\";\n\nclass a extends t {\n  constructor(e) {\n    super(e), this._orderbyclause = null, this.declaredClass = \"esri.arcade.featureset.actions.OrderBy\", this._maxProcessing = 100, this._orderbyclause = e.orderbyclause, this._parent = e.parentfeatureset;\n  }\n\n  _getSet(e) {\n    return null === this._wset ? this._ensureLoaded().then(() => this._getFilteredSet(\"\", null, null, this._orderbyclause, e)).then(t => (this._checkCancelled(e), this._wset = t, this._wset)) : s(this._wset);\n  }\n\n  manualOrderSet(e, t) {\n    return this.getIdColumnDictionary(e, [], -1, t).then(e => {\n      this._orderbyclause.order(e);\n\n      const t = new r([], [], !0, null);\n\n      for (let r = 0; r < e.length; r++) t._known.push(e[r].id);\n\n      return t;\n    });\n  }\n\n  getIdColumnDictionary(t, r, n, i) {\n    if (n < t._known.length - 1) {\n      const s = this._maxQueryRate();\n\n      if (\"GETPAGES\" === t._known[n + 1]) return e(this._parent._expandPagedSet(t, s, 0, 0, i)).then(() => this.getIdColumnDictionary(t, r, n, i));\n      let a = n + 1;\n      const o = [];\n\n      for (; a < t._known.length && \"GETPAGES\" !== t._known[a];) o.push(t._known[a]), a++;\n\n      return n += o.length, e(this._parent._getFeatureBatch(o, i)).then(e => {\n        this._checkCancelled(i);\n\n        for (const t of e) r.push({\n          id: t.attributes[this.objectIdField],\n          feature: t\n        });\n\n        return this.getIdColumnDictionary(t, r, n, i);\n      });\n    }\n\n    return t._candidates.length > 0 ? e(this._refineSetBlock(t, this._maxProcessingRate(), i)).then(() => (this._checkCancelled(i), this.getIdColumnDictionary(t, r, n, i))) : s(r);\n  }\n\n  _isInFeatureSet(e) {\n    return this._parent._isInFeatureSet(e);\n  }\n\n  _getFeatures(e, t, r, n) {\n    return this._parent._getFeatures(e, t, r, n);\n  }\n\n  _featureFromCache(e) {\n    if (void 0 === this._featureCache[e]) {\n      const t = this._parent._featureFromCache(e);\n\n      if (void 0 === t) return;\n      return null === t ? null : (this._featureCache[e] = t, t);\n    }\n\n    return this._featureCache[e];\n  }\n\n  _fetchAndRefineFeatures() {\n    return i(new Error(\"Fetch and Refine should not be called in this featureset\"));\n  }\n\n  _getFilteredSet(e, t, n, s, i) {\n    return this._ensureLoaded().then(() => this._parent._getFilteredSet(e, t, n, null === s ? this._orderbyclause : s, i)).then(e => {\n      this._checkCancelled(i);\n\n      const s = new r(e._candidates.slice(0), e._known.slice(0), e._ordered, this._clonePageDefinition(e.pagesDefinition));\n      let a = !0;\n      return e._candidates.length > 0 && (a = !1), !1 === s._ordered ? this.manualOrderSet(s, i).then(e => (!1 === a && (null === t && null === n || (e = new r(e._candidates.slice(0).concat(e._known.slice(0)), [], e._ordered, this._clonePageDefinition(e.pagesDefinition)))), e)) : s;\n    });\n  }\n\n  static registerAction() {\n    t._featuresetFunctions.orderBy = function (e) {\n      return \"\" === e ? this : new a({\n        parentfeatureset: this,\n        orderbyclause: new n(e)\n      });\n    };\n  }\n\n}\n\nexport default a;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/arcade/featureset/actions/OrderBy.js"],"names":["Q","e","t","r","n","resolve","s","reject","i","a","constructor","_orderbyclause","declaredClass","_maxProcessing","orderbyclause","_parent","parentfeatureset","_getSet","_wset","_ensureLoaded","then","_getFilteredSet","_checkCancelled","manualOrderSet","getIdColumnDictionary","order","length","_known","push","id","_maxQueryRate","_expandPagedSet","o","_getFeatureBatch","attributes","objectIdField","feature","_candidates","_refineSetBlock","_maxProcessingRate","_isInFeatureSet","_getFeatures","_featureFromCache","_featureCache","_fetchAndRefineFeatures","Error","slice","_ordered","_clonePageDefinition","pagesDefinition","concat","registerAction","_featuresetFunctions","orderBy"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{Q as e}from\"../../../chunks/languageUtils.js\";import t from\"../support/FeatureSet.js\";import r from\"../support/IdSet.js\";import n from\"../support/OrderbyClause.js\";import{resolve as s,reject as i}from\"../../../core/promiseUtils.js\";class a extends t{constructor(e){super(e),this._orderbyclause=null,this.declaredClass=\"esri.arcade.featureset.actions.OrderBy\",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet(\"\",null,null,this._orderbyclause,e))).then((t=>(this._checkCancelled(e),this._wset=t,this._wset))):s(this._wset)}manualOrderSet(e,t){return this.getIdColumnDictionary(e,[],-1,t).then((e=>{this._orderbyclause.order(e);const t=new r([],[],!0,null);for(let r=0;r<e.length;r++)t._known.push(e[r].id);return t}))}getIdColumnDictionary(t,r,n,i){if(n<t._known.length-1){const s=this._maxQueryRate();if(\"GETPAGES\"===t._known[n+1])return e(this._parent._expandPagedSet(t,s,0,0,i)).then((()=>this.getIdColumnDictionary(t,r,n,i)));let a=n+1;const o=[];for(;a<t._known.length&&\"GETPAGES\"!==t._known[a];)o.push(t._known[a]),a++;return n+=o.length,e(this._parent._getFeatureBatch(o,i)).then((e=>{this._checkCancelled(i);for(const t of e)r.push({id:t.attributes[this.objectIdField],feature:t});return this.getIdColumnDictionary(t,r,n,i)}))}return t._candidates.length>0?e(this._refineSetBlock(t,this._maxProcessingRate(),i)).then((()=>(this._checkCancelled(i),this.getIdColumnDictionary(t,r,n,i)))):s(r)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}_fetchAndRefineFeatures(){return i(new Error(\"Fetch and Refine should not be called in this featureset\"))}_getFilteredSet(e,t,n,s,i){return this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,n,null===s?this._orderbyclause:s,i))).then((e=>{this._checkCancelled(i);const s=new r(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition));let a=!0;return e._candidates.length>0&&(a=!1),!1===s._ordered?this.manualOrderSet(s,i).then((e=>(!1===a&&(null===t&&null===n||(e=new r(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e))):s}))}static registerAction(){t._featuresetFunctions.orderBy=function(e){return\"\"===e?this:new a({parentfeatureset:this,orderbyclause:new n(e)})}}}export default a;\n"]},"metadata":{},"sourceType":"module"}