{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"./PooledArray.js\";\nconst e = -3;\n\nclass s {\n  constructor(t, e, s) {\n    this._namespace = t, this._storage = e, this._removeFunc = !1, this._hit = 0, this._miss = 0, this._storage.register(this), this._namespace += \":\", s && (this._storage.registerRemoveFunc(this._namespace, s), this._removeFunc = !0);\n  }\n\n  destroy() {\n    this._storage.clear(this._namespace), this._removeFunc && this._storage.deregisterRemoveFunc(this._namespace), this._storage.deregister(this), this._storage = null;\n  }\n\n  get namespace() {\n    return this._namespace.slice(0, -1);\n  }\n\n  get hitRate() {\n    return this._hit / (this._hit + this._miss);\n  }\n\n  get size() {\n    return this._storage.size;\n  }\n\n  get maxSize() {\n    return this._storage.maxSize;\n  }\n\n  resetHitRate() {\n    this._hit = this._miss = 0;\n  }\n\n  put(t, e, s, i = 0) {\n    this._storage.put(this._namespace + t, e, s, i);\n  }\n\n  get(t) {\n    const e = this._storage.get(this._namespace + t);\n\n    return void 0 === e ? ++this._miss : ++this._hit, e;\n  }\n\n  pop(t) {\n    const e = this._storage.pop(this._namespace + t);\n\n    return void 0 === e ? ++this._miss : ++this._hit, e;\n  }\n\n  updateSize(t, e, s) {\n    this._storage.updateSize(this._namespace + t, e, s);\n  }\n\n  clear() {\n    this._storage.clear(this._namespace);\n  }\n\n  clearAll() {\n    this._storage.clearAll();\n  }\n\n  getStats() {\n    return this._storage.getStats();\n  }\n\n  resetStats() {\n    this._storage.resetStats();\n  }\n\n}\n\nclass i {\n  constructor(e = 10485760) {\n    this._maxSize = e, this._db = new Map(), this._size = 0, this._hit = 0, this._miss = 0, this._removeFuncs = new t(), this._users = new t();\n  }\n\n  destroy() {\n    this.clearAll(), this._removeFuncs.clear(), this._users.clear(), this._db = null;\n  }\n\n  register(t) {\n    this._users.push(t);\n  }\n\n  deregister(t) {\n    this._users.removeUnordered(t);\n  }\n\n  registerRemoveFunc(t, e) {\n    this._removeFuncs.push([t, e]);\n  }\n\n  deregisterRemoveFunc(t) {\n    this._removeFuncs.filterInPlace(e => e[0] !== t);\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  get maxSize() {\n    return this._maxSize;\n  }\n\n  set maxSize(t) {\n    this._maxSize = Math.max(t, 0), this._checkSizeLimit();\n  }\n\n  put(t, s, i, h) {\n    const r = this._db.get(t);\n\n    if (r && (this._size -= r.size, this._db.delete(t), r.entry !== s && this._notifyRemoved(t, r.entry)), i > this._maxSize) return void this._notifyRemoved(t, s);\n    if (void 0 === s) return void console.warn(\"Refusing to cache undefined entry \");\n    if (!i || i < 0) return void console.warn(\"Refusing to cache entry with invalid size \" + i);\n\n    const _ = 1 + Math.max(h, e) - e;\n\n    this._db.set(t, {\n      entry: s,\n      size: i,\n      lifetime: _,\n      lives: _\n    }), this._size += i, this._checkSizeLimit();\n  }\n\n  updateSize(t, e, s) {\n    const i = this._db.get(t);\n\n    if (i && i.entry === e) {\n      if (this._size -= i.size, s > this._maxSize) return this._db.delete(t), void this._notifyRemoved(t, e);\n      i.size = s, this._size += s, this._checkSizeLimit();\n    }\n  }\n\n  pop(t) {\n    const e = this._db.get(t);\n\n    if (e) return this._size -= e.size, this._db.delete(t), ++this._hit, e.entry;\n    ++this._miss;\n  }\n\n  get(t) {\n    const e = this._db.get(t);\n\n    if (void 0 !== e) return this._db.delete(t), e.lives = e.lifetime, this._db.set(t, e), ++this._hit, e.entry;\n    ++this._miss;\n  }\n\n  getStats() {\n    const t = {\n      Size: Math.round(this._size / 1048576) + \"/\" + Math.round(this._maxSize / 1048576) + \"MB\",\n      \"Hit rate\": Math.round(100 * this._getHitRate()) + \"%\",\n      Entries: this._db.size.toString()\n    },\n          s = {},\n          i = new Array();\n\n    this._db.forEach((t, e) => {\n      const h = t.lifetime;\n      i[h] = (i[h] || 0) + t.size, this._users.forAll(i => {\n        const h = i.namespace;\n\n        if (e.startsWith(h)) {\n          const e = s[h] || 0;\n          s[h] = e + t.size;\n        }\n      });\n    });\n\n    const h = {};\n\n    this._users.forAll(t => {\n      const e = t.namespace;\n\n      if (!isNaN(t.hitRate) && t.hitRate > 0) {\n        const i = s[e] || 0;\n        s[e] = i, h[e] = Math.round(100 * t.hitRate) + \"%\";\n      } else h[e] = \"0%\";\n    });\n\n    const r = Object.keys(s);\n    r.forEach(t => s[t] = s[t] / this._size * 100), r.sort((t, e) => s[e] - s[t]), r.forEach(e => t[e] = Math.round(s[e]) + \"% / \" + h[e]);\n\n    for (let _ = i.length - 1; _ >= 0; --_) {\n      const s = i[_];\n      s && (t[\"Priority \" + (_ + e - 1)] = Math.round(s / this.size * 100) + \"%\");\n    }\n\n    return t;\n  }\n\n  resetStats() {\n    this._hit = this._miss = 0, this._users.forAll(t => t.resetHitRate());\n  }\n\n  clear(t) {\n    this._db.forEach((e, s) => {\n      s.startsWith(t) && (this._size -= e.size, this._db.delete(s), this._notifyRemoved(s, e.entry));\n    });\n  }\n\n  clearAll() {\n    this._db.forEach((t, e) => this._notifyRemoved(e, t.entry)), this._size = 0, this._db.clear();\n  }\n\n  _getHitRate() {\n    return this._hit / (this._hit + this._miss);\n  }\n\n  _notifyRemoved(t, e) {\n    this._removeFuncs.forAll(s => {\n      t.startsWith(s[0]) && s[1](e);\n    });\n  }\n\n  _checkSizeLimit() {\n    if (!(this._size <= this._maxSize)) for (const [t, e] of this._db) if (this._db.delete(t), e.lives <= 1 ? (this._size -= e.size, this._notifyRemoved(t, e.entry)) : (--e.lives, this._db.set(t, e)), this._size <= .9 * this.maxSize) return;\n  }\n\n}\n\nexport { e as MIN_PRIORITY, s as MemCache, i as MemCacheStorage };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/core/MemCache.js"],"names":["t","e","s","constructor","_namespace","_storage","_removeFunc","_hit","_miss","register","registerRemoveFunc","destroy","clear","deregisterRemoveFunc","deregister","namespace","slice","hitRate","size","maxSize","resetHitRate","put","i","get","pop","updateSize","clearAll","getStats","resetStats","_maxSize","_db","Map","_size","_removeFuncs","_users","push","removeUnordered","filterInPlace","Math","max","_checkSizeLimit","h","r","delete","entry","_notifyRemoved","console","warn","_","set","lifetime","lives","Size","round","_getHitRate","Entries","toString","Array","forEach","forAll","startsWith","isNaN","Object","keys","sort","length","MIN_PRIORITY","MemCache","MemCacheStorage"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"./PooledArray.js\";const e=-3;class s{constructor(t,e,s){this._namespace=t,this._storage=e,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=\":\",s&&(this._storage.registerRemoveFunc(this._namespace,s),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,e,s,i=0){this._storage.put(this._namespace+t,e,s,i)}get(t){const e=this._storage.get(this._namespace+t);return void 0===e?++this._miss:++this._hit,e}pop(t){const e=this._storage.pop(this._namespace+t);return void 0===e?++this._miss:++this._hit,e}updateSize(t,e,s){this._storage.updateSize(this._namespace+t,e,s)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class i{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new t,this._users=new t}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,e){this._removeFuncs.push([t,e])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace((e=>e[0]!==t))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,s,i,h){const r=this._db.get(t);if(r&&(this._size-=r.size,this._db.delete(t),r.entry!==s&&this._notifyRemoved(t,r.entry)),i>this._maxSize)return void this._notifyRemoved(t,s);if(void 0===s)return void console.warn(\"Refusing to cache undefined entry \");if(!i||i<0)return void console.warn(\"Refusing to cache entry with invalid size \"+i);const _=1+Math.max(h,e)-e;this._db.set(t,{entry:s,size:i,lifetime:_,lives:_}),this._size+=i,this._checkSizeLimit()}updateSize(t,e,s){const i=this._db.get(t);if(i&&i.entry===e){if(this._size-=i.size,s>this._maxSize)return this._db.delete(t),void this._notifyRemoved(t,e);i.size=s,this._size+=s,this._checkSizeLimit()}}pop(t){const e=this._db.get(t);if(e)return this._size-=e.size,this._db.delete(t),++this._hit,e.entry;++this._miss}get(t){const e=this._db.get(t);if(void 0!==e)return this._db.delete(t),e.lives=e.lifetime,this._db.set(t,e),++this._hit,e.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},s={},i=new Array;this._db.forEach(((t,e)=>{const h=t.lifetime;i[h]=(i[h]||0)+t.size,this._users.forAll((i=>{const h=i.namespace;if(e.startsWith(h)){const e=s[h]||0;s[h]=e+t.size}}))}));const h={};this._users.forAll((t=>{const e=t.namespace;if(!isNaN(t.hitRate)&&t.hitRate>0){const i=s[e]||0;s[e]=i,h[e]=Math.round(100*t.hitRate)+\"%\"}else h[e]=\"0%\"}));const r=Object.keys(s);r.forEach((t=>s[t]=s[t]/this._size*100)),r.sort(((t,e)=>s[e]-s[t])),r.forEach((e=>t[e]=Math.round(s[e])+\"% / \"+h[e]));for(let _=i.length-1;_>=0;--_){const s=i[_];s&&(t[\"Priority \"+(_+e-1)]=Math.round(s/this.size*100)+\"%\")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll((t=>t.resetHitRate()))}clear(t){this._db.forEach(((e,s)=>{s.startsWith(t)&&(this._size-=e.size,this._db.delete(s),this._notifyRemoved(s,e.entry))}))}clearAll(){this._db.forEach(((t,e)=>this._notifyRemoved(e,t.entry))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemoved(t,e){this._removeFuncs.forAll((s=>{t.startsWith(s[0])&&s[1](e)}))}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,e]of this._db)if(this._db.delete(t),e.lives<=1?(this._size-=e.size,this._notifyRemoved(t,e.entry)):(--e.lives,this._db.set(t,e)),this._size<=.9*this.maxSize)return}}export{e as MIN_PRIORITY,s as MemCache,i as MemCacheStorage};\n"]},"metadata":{},"sourceType":"module"}