{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { lerp as e, deg2rad as t, clamp as a } from \"../../../../core/mathUtils.js\";\n\nfunction i(e, t) {\n  return new p(e, h, t);\n}\n\nfunction r(e, t) {\n  const {\n    curvatureDependent: a,\n    scaleStart: i,\n    scaleFallOffRange: r\n  } = h;\n  return new p(e, {\n    curvatureDependent: {\n      min: {\n        curvature: a.min.curvature,\n        tiltAngle: a.min.tiltAngle,\n        scaleFallOffFactor: v.curvatureDependent.min.scaleFallOffFactor\n      },\n      max: {\n        curvature: a.max.curvature,\n        tiltAngle: a.max.tiltAngle,\n        scaleFallOffFactor: v.curvatureDependent.max.scaleFallOffFactor\n      }\n    },\n    scaleStart: i,\n    scaleFallOffRange: r,\n    minPixelSize: v.minPixelSize\n  }, t);\n}\n\nfunction n(e) {\n  return Math.abs(e * e * e);\n}\n\nfunction l(e, t, a) {\n  const i = a.parameters,\n        r = a.paddingPixelsOverride;\n  return x.scale = Math.min(i.divisor / (t - i.offset), 1), x.factor = n(e), x.minPixelSize = i.minPixelSize, x.paddingPixels = r, x;\n}\n\nfunction s(e, t) {\n  return 0 === e ? t.minPixelSize : t.minPixelSize * (1 + 2 * t.paddingPixels / e);\n}\n\nfunction c(t, a) {\n  return Math.max(e(t * a.scale, t, a.factor), s(t, a));\n}\n\nfunction o(t, a, i = [0, 0]) {\n  const r = Math.min(Math.max(a.scale, s(t[1], a) / t[1]), 1);\n  return i[0] = e(t[0] * r, t[0], a.factor), i[1] = e(t[1] * r, t[1], a.factor), i;\n}\n\nfunction u(e, t, a) {\n  const i = l(e, t, a);\n  return i.minPixelSize = 0, i.paddingPixels = 0, c(1, i);\n}\n\nfunction d(e, t, a, i) {\n  i.scale = u(e, t, a), i.factor = 0, i.minPixelSize = a.parameters.minPixelSize, i.paddingPixels = a.paddingPixelsOverride;\n}\n\nfunction f(e, t, a = [0, 0]) {\n  const i = Math.min(Math.max(t.scale, s(e[1], t) / e[1]), 1);\n  return a[0] = e[0] * i, a[1] = e[1] * i, a;\n}\n\nfunction m(e, t, a, i) {\n  return c(e, l(t, a, i));\n}\n\nclass p {\n  constructor(e, t, a, i = g(), r) {\n    this.viewingMode = e, this.description = t, this.ellipsoidRadius = a, this.parameters = i, this._paddingPixelsOverride = r, 2 === this.viewingMode ? (this.coverageCompensation = this.surfaceCoverageCompensationLocal, this.calculateCurvatureDependentParameters = this.calculateCurvatureDependentParametersLocal) : (this.coverageCompensation = this.surfaceCoverageCompensationGlobal, this.calculateCurvatureDependentParameters = this.calculateCurvatureDependentParametersGlobal);\n  }\n\n  get paddingPixelsOverride() {\n    return this._paddingPixelsOverride || this.parameters.paddingPixels;\n  }\n\n  update(e) {\n    return (!this.parameters || this.parameters.camera.fovY !== e.fovY || this.parameters.camera.distance !== e.distance) && (this.calculateParameters(e, this.ellipsoidRadius, this.parameters), !0);\n  }\n\n  overridePadding(e) {\n    return e !== this.paddingPixelsOverride ? new p(this.viewingMode, this.description, this.ellipsoidRadius, this.parameters, e) : this;\n  }\n\n  calculateParameters(e, t, a) {\n    const {\n      scaleStart: i,\n      scaleFallOffRange: r,\n      minPixelSize: n\n    } = this.description,\n          {\n      fovY: l,\n      distance: s\n    } = e,\n          c = this.calculateCurvatureDependentParameters(e, t),\n          o = this.coverageCompensation(e, t, c),\n          {\n      tiltAngle: u,\n      scaleFallOffFactor: d\n    } = c,\n          f = Math.sin(u) * s,\n          m = .5 * Math.PI - u - l * (.5 - i * o),\n          p = f / Math.cos(m),\n          h = m + l * r * o,\n          v = (p - d * (f / Math.cos(h))) / (1 - d);\n    return a.camera.fovY = e.fovY, a.camera.distance = e.distance, a.offset = v, a.divisor = p - v, a.minPixelSize = n, a;\n  }\n\n  calculateCurvatureDependentParametersLocal(e, t, a = P) {\n    return a.tiltAngle = this.description.curvatureDependent.min.tiltAngle, a.scaleFallOffFactor = this.description.curvatureDependent.min.scaleFallOffFactor, a;\n  }\n\n  calculateCurvatureDependentParametersGlobal(t, i, r = P) {\n    const n = this.description.curvatureDependent,\n          l = 1 + t.distance / i,\n          s = Math.sqrt(l * l - 1),\n          [c, o] = [n.min.curvature, n.max.curvature],\n          u = a((s - c) / (o - c), 0, 1),\n          [d, f] = [n.min, n.max];\n    return r.tiltAngle = e(d.tiltAngle, f.tiltAngle, u), r.scaleFallOffFactor = e(d.scaleFallOffFactor, f.scaleFallOffFactor, u), r;\n  }\n\n  surfaceCoverageCompensationLocal(e, t, a) {\n    return (e.fovY - a.tiltAngle) / e.fovY;\n  }\n\n  surfaceCoverageCompensationGlobal(e, t, a) {\n    const i = t * t,\n          r = a.tiltAngle + .5 * Math.PI,\n          {\n      fovY: n,\n      distance: l\n    } = e,\n          s = l * l + i - 2 * Math.cos(r) * l * t,\n          c = Math.sqrt(s),\n          o = Math.sqrt(s - i);\n    return (Math.acos(o / c) - Math.asin(t / (c / Math.sin(r))) + .5 * n) / n;\n  }\n\n}\n\nconst h = {\n  curvatureDependent: {\n    min: {\n      curvature: t(10),\n      tiltAngle: t(12),\n      scaleFallOffFactor: .5\n    },\n    max: {\n      curvature: t(70),\n      tiltAngle: t(40),\n      scaleFallOffFactor: .8\n    }\n  },\n  scaleStart: .3,\n  scaleFallOffRange: .65,\n  minPixelSize: 0\n},\n      v = {\n  curvatureDependent: {\n    min: {\n      scaleFallOffFactor: .7\n    },\n    max: {\n      scaleFallOffFactor: .95\n    }\n  },\n  minPixelSize: 14\n};\n\nfunction g() {\n  return {\n    camera: {\n      distance: 0,\n      fovY: 0\n    },\n    divisor: 0,\n    offset: 0,\n    minPixelSize: 0,\n    paddingPixels: 0\n  };\n}\n\nconst x = {\n  scale: 0,\n  factor: 0,\n  minPixelSize: 0,\n  paddingPixels: 0\n},\n      P = {\n  tiltAngle: 0,\n  scaleFallOffFactor: 0\n};\nexport { f as applyPrecomputedScaleFactor, c as applyScaleFactor, o as applyScaleFactorVec2, r as getLabelSettings, i as getSettings, d as precomputeScaleFactor, m as scale };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/screenSizePerspectiveUtils.js"],"names":["lerp","e","deg2rad","t","clamp","a","i","p","h","r","curvatureDependent","scaleStart","scaleFallOffRange","min","curvature","tiltAngle","scaleFallOffFactor","v","max","minPixelSize","n","Math","abs","l","parameters","paddingPixelsOverride","x","scale","divisor","offset","factor","paddingPixels","s","c","o","u","d","f","m","constructor","g","viewingMode","description","ellipsoidRadius","_paddingPixelsOverride","coverageCompensation","surfaceCoverageCompensationLocal","calculateCurvatureDependentParameters","calculateCurvatureDependentParametersLocal","surfaceCoverageCompensationGlobal","calculateCurvatureDependentParametersGlobal","update","camera","fovY","distance","calculateParameters","overridePadding","sin","PI","cos","P","sqrt","acos","asin","applyPrecomputedScaleFactor","applyScaleFactor","applyScaleFactorVec2","getLabelSettings","getSettings","precomputeScaleFactor"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{lerp as e,deg2rad as t,clamp as a}from\"../../../../core/mathUtils.js\";function i(e,t){return new p(e,h,t)}function r(e,t){const{curvatureDependent:a,scaleStart:i,scaleFallOffRange:r}=h;return new p(e,{curvatureDependent:{min:{curvature:a.min.curvature,tiltAngle:a.min.tiltAngle,scaleFallOffFactor:v.curvatureDependent.min.scaleFallOffFactor},max:{curvature:a.max.curvature,tiltAngle:a.max.tiltAngle,scaleFallOffFactor:v.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:r,minPixelSize:v.minPixelSize},t)}function n(e){return Math.abs(e*e*e)}function l(e,t,a){const i=a.parameters,r=a.paddingPixelsOverride;return x.scale=Math.min(i.divisor/(t-i.offset),1),x.factor=n(e),x.minPixelSize=i.minPixelSize,x.paddingPixels=r,x}function s(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function c(t,a){return Math.max(e(t*a.scale,t,a.factor),s(t,a))}function o(t,a,i=[0,0]){const r=Math.min(Math.max(a.scale,s(t[1],a)/t[1]),1);return i[0]=e(t[0]*r,t[0],a.factor),i[1]=e(t[1]*r,t[1],a.factor),i}function u(e,t,a){const i=l(e,t,a);return i.minPixelSize=0,i.paddingPixels=0,c(1,i)}function d(e,t,a,i){i.scale=u(e,t,a),i.factor=0,i.minPixelSize=a.parameters.minPixelSize,i.paddingPixels=a.paddingPixelsOverride}function f(e,t,a=[0,0]){const i=Math.min(Math.max(t.scale,s(e[1],t)/e[1]),1);return a[0]=e[0]*i,a[1]=e[1]*i,a}function m(e,t,a,i){return c(e,l(t,a,i))}class p{constructor(e,t,a,i=g(),r){this.viewingMode=e,this.description=t,this.ellipsoidRadius=a,this.parameters=i,this._paddingPixelsOverride=r,2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this.calculateParameters(e,this.ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new p(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,e):this}calculateParameters(e,t,a){const{scaleStart:i,scaleFallOffRange:r,minPixelSize:n}=this.description,{fovY:l,distance:s}=e,c=this.calculateCurvatureDependentParameters(e,t),o=this.coverageCompensation(e,t,c),{tiltAngle:u,scaleFallOffFactor:d}=c,f=Math.sin(u)*s,m=.5*Math.PI-u-l*(.5-i*o),p=f/Math.cos(m),h=m+l*r*o,v=(p-d*(f/Math.cos(h)))/(1-d);return a.camera.fovY=e.fovY,a.camera.distance=e.distance,a.offset=v,a.divisor=p-v,a.minPixelSize=n,a}calculateCurvatureDependentParametersLocal(e,t,a=P){return a.tiltAngle=this.description.curvatureDependent.min.tiltAngle,a.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,a}calculateCurvatureDependentParametersGlobal(t,i,r=P){const n=this.description.curvatureDependent,l=1+t.distance/i,s=Math.sqrt(l*l-1),[c,o]=[n.min.curvature,n.max.curvature],u=a((s-c)/(o-c),0,1),[d,f]=[n.min,n.max];return r.tiltAngle=e(d.tiltAngle,f.tiltAngle,u),r.scaleFallOffFactor=e(d.scaleFallOffFactor,f.scaleFallOffFactor,u),r}surfaceCoverageCompensationLocal(e,t,a){return(e.fovY-a.tiltAngle)/e.fovY}surfaceCoverageCompensationGlobal(e,t,a){const i=t*t,r=a.tiltAngle+.5*Math.PI,{fovY:n,distance:l}=e,s=l*l+i-2*Math.cos(r)*l*t,c=Math.sqrt(s),o=Math.sqrt(s-i);return(Math.acos(o/c)-Math.asin(t/(c/Math.sin(r)))+.5*n)/n}}const h={curvatureDependent:{min:{curvature:t(10),tiltAngle:t(12),scaleFallOffFactor:.5},max:{curvature:t(70),tiltAngle:t(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},v={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function g(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const x={scale:0,factor:0,minPixelSize:0,paddingPixels:0},P={tiltAngle:0,scaleFallOffFactor:0};export{f as applyPrecomputedScaleFactor,c as applyScaleFactor,o as applyScaleFactorVec2,r as getLabelSettings,i as getSettings,d as precomputeScaleFactor,m as scale};\n"]},"metadata":{},"sourceType":"module"}