{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../Camera.js\";\nimport t from \"../../../core/Logger.js\";\nimport { deg2rad as n, rad2deg as r } from \"../../../core/mathUtils.js\";\nimport { isNone as i, unwrapOr as o, isSome as a } from \"../../../core/maybe.js\";\nimport { createResolver as s } from \"../../../core/promiseUtils.js\";\nimport { a as c, b as l, j as f, i as u, g as m } from \"../../../chunks/vec3.js\";\nimport { a as p, c as d } from \"../../../chunks/vec3f64.js\";\nimport v from \"../../../geometry/Point.js\";\nimport { projectPointToVector as h, projectVectorToVector as g, projectVectorToPoint as y } from \"../../../geometry/projection.js\";\nimport { getReferenceEllipsoid as R } from \"../../../geometry/projectionEllipsoid.js\";\nimport M from \"../../../geometry/SpatialReference.js\";\nimport { getResolutionForScale as j } from \"../../../geometry/support/scaleUtils.js\";\nimport { cameraOnContentAlongViewDirection as x } from \"../camera/intersectionUtils.js\";\nimport { t as w, c as S } from \"../../../chunks/cameraUtilsPlanar.js\";\nimport { t as T, c as z } from \"../../../chunks/cameraUtilsSpherical.js\";\nimport { getGreatCircleSpanAt as C } from \"./earthUtils.js\";\nimport { getElevationAtPoint as b } from \"./ElevationProvider.js\";\nimport { Cyclical as U } from \"./mathUtils.js\";\nimport { isSpatialReferenceSupported as H } from \"../../support/spatialReferenceSupport.js\";\nconst P = t.getLogger(\"esri.views.3d.support.cameraUtils\"),\n      k = 39.37,\n      A = 96,\n      I = 1,\n      L = 8,\n      E = 5,\n      q = 1,\n      F = d(),\n      G = d(),\n      O = {\n  heading: 0,\n  tilt: 0\n},\n      W = new v(),\n      X = new U(-20037508.342788905, 20037508.342788905),\n      D = new U(-180, 180);\n\nfunction Y(e) {\n  return e.spatialReference || M.WGS84;\n}\n\nfunction N(e) {\n  return \"global\" === e.viewingMode ? z : S;\n}\n\nfunction Z(e, t, n, r, i) {\n  return N(e).headingTiltToDirectionUp(t, n, r, i);\n}\n\nfunction B(e, t) {\n  if (i(t)) return null;\n  const r = e.renderSpatialReference,\n        o = N(e).headingTiltToDirectionUp,\n        a = d();\n  if (!h(t.position, a, r)) return null;\n  const s = o(a, t.heading, t.tilt);\n  c(s.direction, s.direction, e.state.camera.distance), l(s.direction, s.direction, a);\n  const f = x(e, a, s.direction, s.up);\n  return f.fov = n(t.fov), f;\n}\n\nconst J = d();\n\nfunction K(t, n, o) {\n  const a = t.renderSpatialReference,\n        s = ee(t, n.eye, n.viewForward, n.up, O);\n  let c = Y(t);\n  return g(n.eye, a, J, c) || (c = M.WGS84, g(n.eye, a, J, c)), i(o) ? new e(new v(J, c), s.heading, s.tilt, r(n.fov)) : (o.position.x = J[0], o.position.y = J[1], o.position.z = J[2], o.position.spatialReference = c, o.heading = s.heading, o.tilt = s.tilt, o.fov = r(n.fov), o);\n}\n\nfunction Q(e, t, r) {\n  const i = e.state.camera,\n        o = i.width / 2 / i.pixelRatio;\n  1 === e.renderCoordsHelper.viewingMode && null != r && (t *= Math.cos(n(r))), t /= e.renderCoordsHelper.unitInMeters;\n  return o / (A * k / t) / Math.tan(i.fovX / 2);\n}\n\nfunction V(e, t, r) {\n  const i = e.state.camera,\n        o = t * Math.tan(i.fovX / 2),\n        a = i.width / 2 / i.pixelRatio;\n  let s = A * k / (a / o);\n  return 1 === e.renderCoordsHelper.viewingMode && (s /= Math.cos(n(r))), s *= e.renderCoordsHelper.unitInMeters, s;\n}\n\nfunction $(e, t, n, r, i, o) {\n  return _(e, t, Q(e, n, t.latitude), r, i, o);\n}\n\nfunction _(e, t, n, r, o, a) {\n  if (xe(a)) {\n    const s = new je(a.signal);\n    return oe(e, r.heading, r.tilt, t, n, o, s), void s.resolver.promise.then(t => {\n      const n = he(e, t, r.fov);\n      if (!i(n)) return a.resolver.resolve(n);\n      a.resolver.reject();\n    }, e => a.resolver.reject(e));\n  }\n\n  const s = oe(e, r.heading, r.tilt, t, n, o);\n  return he(e, s, r.fov, a);\n}\n\nfunction ee(e, t, n, r, i) {\n  return N(e).directionToHeadingTilt(t, n, r, i);\n}\n\nfunction te(e, t) {\n  return !!(e.basemapTerrain && e.renderCoordsHelper.fromRenderCoords(t, W, e.spatialReference) && o(b(e.elevationProvider, W), 0) > W.z - q);\n}\n\nasync function ne(e, t, n) {\n  if (!e.renderCoordsHelper.fromRenderCoords(t, W, e.spatialReference)) return !1;\n  const r = await e.elevationProvider.queryElevation(W.x, W.y, W.z, W.spatialReference, \"ground\", n);\n  return o(r, 0) > W.z - q;\n}\n\nasync function re(e, t, n) {\n  const r = d();\n  if (t) {\n    if (t instanceof v) {\n      if (h(t, r, e.renderSpatialReference), null == t.z && null != e.basemapTerrain) {\n        const i = await e.elevationProvider.queryElevation(t.x, t.y, t.z, t.spatialReference, \"ground\", n);\n        return a(i) && e.renderCoordsHelper.setAltitude(r, i), r;\n      }\n    } else m(r, t);\n  } else m(r, e.state.camera.center);\n  return r;\n}\n\nfunction ie(e, t) {\n  const n = d();\n\n  if (t && t instanceof v) {\n    if (h(t, n, e.renderSpatialReference), null == t.z && null != e.basemapTerrain) {\n      const r = b(e.elevationProvider, t);\n      a(r) && e.renderCoordsHelper.setAltitude(n, r);\n    }\n  } else m(n, t || e.state.camera.center);\n\n  return n;\n}\n\nfunction oe(e, t, n, r, i, o, a) {\n  const s = r && r instanceof v ? r : null;\n  if (xe(a)) return re(e, r, a.signal).then(r => {\n    ae(e, t, n, s, r, i, o, a);\n  }, e => a.resolver.reject(e)), null;\n  const c = ie(e, r);\n  return ae(e, t, n, s, c, i, o, a);\n}\n\nfunction ae(e, t, n, r, o, a, s, c) {\n  if (i(r)) {\n    const t = e.renderSpatialReference;\n    if (r = y(o, t, Y(e)), i(r)) return null;\n  }\n\n  a = Math.max(a, e.state.constraints.minimumPoiDistance);\n  const l = fe(e, t, n, o, a, s),\n        f = (0, N(e).eyeForCenterWithHeadingTilt)(o, a, l.heading, l.tilt);\n\n  if (1 === s && \"global\" === e.viewingMode && n > 0) {\n    const i = () => {\n      const i = de(e, o, a, pe(e, a, n, o));\n      return ae(e, t, i, r, o, a, s = n - i < 1 ? 0 : 1, c);\n    },\n          l = e.map.ground.navigationConstraint;\n\n    if (!l || \"stay-above\" === l.type) {\n      if (te(e, f.eye)) return i();\n      if (xe(c)) return ne(e, f.eye, c.signal).then(e => e ? i() : (c.resolver.resolve({\n        eye: f.eye,\n        up: f.up,\n        center: p(o),\n        heading: f.heading,\n        tilt: f.tilt\n      }), null)), null;\n    }\n  }\n\n  const u = !c || xe(c) ? {\n    center: d(),\n    eye: d(),\n    up: d(),\n    tilt: 0,\n    heading: 0\n  } : c;\n  return u.eye = f.eye, u.up = f.up, u.center = p(o), u.heading = f.heading, u.tilt = f.tilt, xe(c) && c.resolver.resolve(u), u;\n}\n\nfunction se(e, t, n, r, o, a = null) {\n  let s,\n      c,\n      l,\n      f,\n      u = 0;\n  null != t.zmax && null != t.zmin && (s = (t.zmax + t.zmin) / 2, u = t.zmax - t.zmin);\n\n  if (\"global\" === e.viewingMode) {\n    if (!H(t.spatialReference, \"global\")) return xe(a) && a.resolver.reject(), null;\n    const e = new v(t.xmin, t.ymin, t.spatialReference),\n          n = new v(t.xmax, t.ymax, t.spatialReference),\n          r = t.spatialReference.isGeographic ? D : X;\n    c = new v(r.center(e.x, n.x), (n.y + e.y) / 2, t.spatialReference), null != s && (c.z = s);\n    const i = R(t.spatialReference),\n          o = C(c, e, n);\n    l = o.lon, f = o.lat, r.diff(e.x, n.x) > r.range / 2 && (l += i.halfCircumference), l = Math.min(l, i.halfCircumference), f = Math.min(f, i.halfCircumference);\n  } else {\n    const n = Y(e);\n    l = t.xmax - t.xmin, f = t.ymax - t.ymin, c = new v({\n      x: t.xmin + .5 * l,\n      y: t.ymin + .5 * f,\n      z: s,\n      spatialReference: n\n    });\n  }\n\n  const m = e.state.camera,\n        p = 1 / Math.tan(m.fovX / 2),\n        d = 1 / Math.tan(m.fovY / 2),\n        h = 1 / Math.tan(m.fov / 2),\n        g = Math.max(.5 * l * p, .5 * f * d, .5 * u * h) / I;\n\n  if (xe(a)) {\n    const t = new je(a.signal);\n    return oe(e, n, r, c, g, o, t), void t.resolver.promise.then(t => {\n      const n = he(e, t, e.camera.fov);\n      if (!i(n)) return a.resolver.resolve(n);\n      a.resolver.reject();\n    }, e => a.resolver.reject(e));\n  }\n\n  const y = oe(e, n, r, c, g, o);\n  return he(e, y, e.camera.fov, a);\n}\n\nfunction ce(e, t, n) {\n  const r = e.renderSpatialReference,\n        o = y(n, r, Y(e));\n  if (i(o)) return null;\n  const a = Math.tan(t.fovX / 2),\n        s = Math.tan(t.fovY / 2),\n        c = f(t.eye, n),\n        l = 2 * c * a * I,\n        u = 2 * c * s * I;\n  return \"global\" === e.viewingMode ? T(e, o, l, u) : w(e, o, l, u);\n}\n\nfunction le(e, t, n) {\n  const r = e.pointsOfInterest.centerOnSurfaceFrequent.distance;\n  if (Math.log(n / r) / Math.LN2 > L) return !0;\n  const o = e.renderSpatialReference,\n        a = Y(e),\n        s = y(t, o, a),\n        c = y(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation, o, a);\n  if (i(s) || i(c)) return !1;\n  const l = Math.tan(.5 * e.state.camera.fov) * r;\n  return c.distance(s) / l > E;\n}\n\nfunction fe(e, t, n, r, i, o) {\n  let a = 0;\n  return 1 === o && le(e, r, i) ? (t = 0, a = me(e, i, n, r)) : a = ve(e, r, i, n), a = e.state.constraints.clampTilt(i, a), {\n    heading: t,\n    tilt: n = de(e, r, i, a)\n  };\n}\n\nconst ue = .7;\n\nfunction me(e, t, n, r) {\n  const i = e.state.constraints.tilt(t);\n  i.max = Math.min(i.max, .5 * Math.PI);\n  const o = i.min * (1 - ue) + i.max * ue,\n        a = ve(e, r, t, n);\n  return Math.min(a, o);\n}\n\nfunction pe(e, t, n, r) {\n  const i = e.state.constraints.tilt(t);\n  let o = ve(e, r, t, n);\n  return o = Math.min(o, .5 * Math.PI), i.min * (1 - ue) + o * ue;\n}\n\nfunction de(e, t, n, r) {\n  return N(e).lookAtTiltToEyeTilt(r, t, n);\n}\n\nfunction ve(e, t, n, r) {\n  return N(e).eyeTiltToLookAtTilt(r, t, n);\n}\n\nfunction he(t, n, r, o) {\n  if (i(n)) return null;\n  const s = t.renderSpatialReference,\n        c = y(n.eye, s, Y(t));\n  return i(c) ? null : a(o) ? (o.position = c, o.heading = n.heading, o.tilt = n.tilt, o.fov = r, o) : new e(c, n.heading, n.tilt, r);\n}\n\nfunction ge(e, t) {\n  var n;\n  const r = null == (n = e.basemapTerrain) ? void 0 : n.tilingScheme;\n  if (r) return r.levelAtScale(t);\n  P.error(\"#scaleToZoom()\", \"Cannot compute zoom from scale without a tiling scheme\");\n}\n\nfunction ye(e, t) {\n  var n;\n  const r = null == (n = e.basemapTerrain) ? void 0 : n.tilingScheme;\n  if (r) return r.scaleAtLevel(t);\n  P.error(\"#zoomToScale()\", \"Cannot compute scale from zoom without a tiling scheme\");\n}\n\nfunction Re(e, t) {\n  return e.spatialReference ? j(t, e.spatialReference) : void 0;\n}\n\nfunction Me(t, n, r) {\n  const i = t.renderSpatialReference;\n  let o, a;\n  n || (n = t.state.camera);\n  const s = M.WGS84;\n  return n instanceof e ? (o = n.position.latitude, h(n.position, F, i), h(r, G, i), a = u(F, G)) : (g(n.center, i, G, s), o = G[1], a = n.distance), V(t, a, o);\n}\n\nclass je {\n  constructor(e) {\n    this.signal = e, this.resolver = s();\n  }\n\n}\n\nfunction xe(e) {\n  return e && \"resolver\" in e;\n}\n\nexport { je as AsyncContext, Me as computeScale, ee as directionToHeadingTilt, V as distanceToScale, B as externalToInternal, _ as fromCenterDistance, $ as fromCenterScale, se as fromExtent, oe as getObserverForPointAtDistance, Z as headingTiltToDirectionUp, K as internalToExternal, he as observerToCamera, Q as scaleToDistance, Re as scaleToResolution, ge as scaleToZoom, ce as toExtent, ye as zoomToScale };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/support/cameraUtils.js"],"names":["e","t","deg2rad","n","rad2deg","r","isNone","i","unwrapOr","o","isSome","a","createResolver","s","c","b","l","j","f","u","g","m","p","d","v","projectPointToVector","h","projectVectorToVector","projectVectorToPoint","y","getReferenceEllipsoid","R","M","getResolutionForScale","cameraOnContentAlongViewDirection","x","w","S","T","z","getGreatCircleSpanAt","C","getElevationAtPoint","Cyclical","U","isSpatialReferenceSupported","H","P","getLogger","k","A","I","L","E","q","F","G","O","heading","tilt","W","X","D","Y","spatialReference","WGS84","N","viewingMode","Z","headingTiltToDirectionUp","B","renderSpatialReference","position","direction","state","camera","distance","up","fov","J","K","ee","eye","viewForward","Q","width","pixelRatio","renderCoordsHelper","Math","cos","unitInMeters","tan","fovX","V","$","_","latitude","xe","je","signal","oe","resolver","promise","then","he","resolve","reject","directionToHeadingTilt","te","basemapTerrain","fromRenderCoords","elevationProvider","ne","queryElevation","re","setAltitude","center","ie","ae","max","constraints","minimumPoiDistance","fe","eyeForCenterWithHeadingTilt","de","pe","map","ground","navigationConstraint","type","se","zmax","zmin","xmin","ymin","xmax","ymax","isGeographic","lon","lat","diff","range","halfCircumference","min","fovY","ce","le","pointsOfInterest","centerOnSurfaceFrequent","log","LN2","renderLocation","me","ve","clampTilt","ue","PI","lookAtTiltToEyeTilt","eyeTiltToLookAtTilt","ge","tilingScheme","levelAtScale","error","ye","scaleAtLevel","Re","Me","constructor","AsyncContext","computeScale","distanceToScale","externalToInternal","fromCenterDistance","fromCenterScale","fromExtent","getObserverForPointAtDistance","internalToExternal","observerToCamera","scaleToDistance","scaleToResolution","scaleToZoom","toExtent","zoomToScale"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../Camera.js\";import t from\"../../../core/Logger.js\";import{deg2rad as n,rad2deg as r}from\"../../../core/mathUtils.js\";import{isNone as i,unwrapOr as o,isSome as a}from\"../../../core/maybe.js\";import{createResolver as s}from\"../../../core/promiseUtils.js\";import{a as c,b as l,j as f,i as u,g as m}from\"../../../chunks/vec3.js\";import{a as p,c as d}from\"../../../chunks/vec3f64.js\";import v from\"../../../geometry/Point.js\";import{projectPointToVector as h,projectVectorToVector as g,projectVectorToPoint as y}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as R}from\"../../../geometry/projectionEllipsoid.js\";import M from\"../../../geometry/SpatialReference.js\";import{getResolutionForScale as j}from\"../../../geometry/support/scaleUtils.js\";import{cameraOnContentAlongViewDirection as x}from\"../camera/intersectionUtils.js\";import{t as w,c as S}from\"../../../chunks/cameraUtilsPlanar.js\";import{t as T,c as z}from\"../../../chunks/cameraUtilsSpherical.js\";import{getGreatCircleSpanAt as C}from\"./earthUtils.js\";import{getElevationAtPoint as b}from\"./ElevationProvider.js\";import{Cyclical as U}from\"./mathUtils.js\";import{isSpatialReferenceSupported as H}from\"../../support/spatialReferenceSupport.js\";const P=t.getLogger(\"esri.views.3d.support.cameraUtils\"),k=39.37,A=96,I=1,L=8,E=5,q=1,F=d(),G=d(),O={heading:0,tilt:0},W=new v,X=new U(-20037508.342788905,20037508.342788905),D=new U(-180,180);function Y(e){return e.spatialReference||M.WGS84}function N(e){return\"global\"===e.viewingMode?z:S}function Z(e,t,n,r,i){return N(e).headingTiltToDirectionUp(t,n,r,i)}function B(e,t){if(i(t))return null;const r=e.renderSpatialReference,o=N(e).headingTiltToDirectionUp,a=d();if(!h(t.position,a,r))return null;const s=o(a,t.heading,t.tilt);c(s.direction,s.direction,e.state.camera.distance),l(s.direction,s.direction,a);const f=x(e,a,s.direction,s.up);return f.fov=n(t.fov),f}const J=d();function K(t,n,o){const a=t.renderSpatialReference,s=ee(t,n.eye,n.viewForward,n.up,O);let c=Y(t);return g(n.eye,a,J,c)||(c=M.WGS84,g(n.eye,a,J,c)),i(o)?new e(new v(J,c),s.heading,s.tilt,r(n.fov)):(o.position.x=J[0],o.position.y=J[1],o.position.z=J[2],o.position.spatialReference=c,o.heading=s.heading,o.tilt=s.tilt,o.fov=r(n.fov),o)}function Q(e,t,r){const i=e.state.camera,o=i.width/2/i.pixelRatio;1===e.renderCoordsHelper.viewingMode&&null!=r&&(t*=Math.cos(n(r))),t/=e.renderCoordsHelper.unitInMeters;return o/(A*k/t)/Math.tan(i.fovX/2)}function V(e,t,r){const i=e.state.camera,o=t*Math.tan(i.fovX/2),a=i.width/2/i.pixelRatio;let s=A*k/(a/o);return 1===e.renderCoordsHelper.viewingMode&&(s/=Math.cos(n(r))),s*=e.renderCoordsHelper.unitInMeters,s}function $(e,t,n,r,i,o){return _(e,t,Q(e,n,t.latitude),r,i,o)}function _(e,t,n,r,o,a){if(xe(a)){const s=new je(a.signal);return oe(e,r.heading,r.tilt,t,n,o,s),void s.resolver.promise.then((t=>{const n=he(e,t,r.fov);if(!i(n))return a.resolver.resolve(n);a.resolver.reject()}),(e=>a.resolver.reject(e)))}const s=oe(e,r.heading,r.tilt,t,n,o);return he(e,s,r.fov,a)}function ee(e,t,n,r,i){return N(e).directionToHeadingTilt(t,n,r,i)}function te(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,W,e.spatialReference)&&o(b(e.elevationProvider,W),0)>W.z-q)}async function ne(e,t,n){if(!e.renderCoordsHelper.fromRenderCoords(t,W,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(W.x,W.y,W.z,W.spatialReference,\"ground\",n);return o(r,0)>W.z-q}async function re(e,t,n){const r=d();if(t)if(t instanceof v){if(h(t,r,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const i=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,\"ground\",n);return a(i)&&e.renderCoordsHelper.setAltitude(r,i),r}}else m(r,t);else m(r,e.state.camera.center);return r}function ie(e,t){const n=d();if(t&&t instanceof v){if(h(t,n,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const r=b(e.elevationProvider,t);a(r)&&e.renderCoordsHelper.setAltitude(n,r)}}else m(n,t||e.state.camera.center);return n}function oe(e,t,n,r,i,o,a){const s=r&&r instanceof v?r:null;if(xe(a))return re(e,r,a.signal).then((r=>{ae(e,t,n,s,r,i,o,a)}),(e=>a.resolver.reject(e))),null;const c=ie(e,r);return ae(e,t,n,s,c,i,o,a)}function ae(e,t,n,r,o,a,s,c){if(i(r)){const t=e.renderSpatialReference;if(r=y(o,t,Y(e)),i(r))return null}a=Math.max(a,e.state.constraints.minimumPoiDistance);const l=fe(e,t,n,o,a,s),f=(0,N(e).eyeForCenterWithHeadingTilt)(o,a,l.heading,l.tilt);if(1===s&&\"global\"===e.viewingMode&&n>0){const i=()=>{const i=de(e,o,a,pe(e,a,n,o));return ae(e,t,i,r,o,a,s=n-i<1?0:1,c)},l=e.map.ground.navigationConstraint;if(!l||\"stay-above\"===l.type){if(te(e,f.eye))return i();if(xe(c))return ne(e,f.eye,c.signal).then((e=>e?i():(c.resolver.resolve({eye:f.eye,up:f.up,center:p(o),heading:f.heading,tilt:f.tilt}),null))),null}}const u=!c||xe(c)?{center:d(),eye:d(),up:d(),tilt:0,heading:0}:c;return u.eye=f.eye,u.up=f.up,u.center=p(o),u.heading=f.heading,u.tilt=f.tilt,xe(c)&&c.resolver.resolve(u),u}function se(e,t,n,r,o,a=null){let s,c,l,f,u=0;null!=t.zmax&&null!=t.zmin&&(s=(t.zmax+t.zmin)/2,u=t.zmax-t.zmin);if(\"global\"===e.viewingMode){if(!H(t.spatialReference,\"global\"))return xe(a)&&a.resolver.reject(),null;const e=new v(t.xmin,t.ymin,t.spatialReference),n=new v(t.xmax,t.ymax,t.spatialReference),r=t.spatialReference.isGeographic?D:X;c=new v(r.center(e.x,n.x),(n.y+e.y)/2,t.spatialReference),null!=s&&(c.z=s);const i=R(t.spatialReference),o=C(c,e,n);l=o.lon,f=o.lat,r.diff(e.x,n.x)>r.range/2&&(l+=i.halfCircumference),l=Math.min(l,i.halfCircumference),f=Math.min(f,i.halfCircumference)}else{const n=Y(e);l=t.xmax-t.xmin,f=t.ymax-t.ymin,c=new v({x:t.xmin+.5*l,y:t.ymin+.5*f,z:s,spatialReference:n})}const m=e.state.camera,p=1/Math.tan(m.fovX/2),d=1/Math.tan(m.fovY/2),h=1/Math.tan(m.fov/2),g=Math.max(.5*l*p,.5*f*d,.5*u*h)/I;if(xe(a)){const t=new je(a.signal);return oe(e,n,r,c,g,o,t),void t.resolver.promise.then((t=>{const n=he(e,t,e.camera.fov);if(!i(n))return a.resolver.resolve(n);a.resolver.reject()}),(e=>a.resolver.reject(e)))}const y=oe(e,n,r,c,g,o);return he(e,y,e.camera.fov,a)}function ce(e,t,n){const r=e.renderSpatialReference,o=y(n,r,Y(e));if(i(o))return null;const a=Math.tan(t.fovX/2),s=Math.tan(t.fovY/2),c=f(t.eye,n),l=2*c*a*I,u=2*c*s*I;return\"global\"===e.viewingMode?T(e,o,l,u):w(e,o,l,u)}function le(e,t,n){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(n/r)/Math.LN2>L)return!0;const o=e.renderSpatialReference,a=Y(e),s=y(t,o,a),c=y(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,o,a);if(i(s)||i(c))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return c.distance(s)/l>E}function fe(e,t,n,r,i,o){let a=0;return 1===o&&le(e,r,i)?(t=0,a=me(e,i,n,r)):a=ve(e,r,i,n),a=e.state.constraints.clampTilt(i,a),{heading:t,tilt:n=de(e,r,i,a)}}const ue=.7;function me(e,t,n,r){const i=e.state.constraints.tilt(t);i.max=Math.min(i.max,.5*Math.PI);const o=i.min*(1-ue)+i.max*ue,a=ve(e,r,t,n);return Math.min(a,o)}function pe(e,t,n,r){const i=e.state.constraints.tilt(t);let o=ve(e,r,t,n);return o=Math.min(o,.5*Math.PI),i.min*(1-ue)+o*ue}function de(e,t,n,r){return N(e).lookAtTiltToEyeTilt(r,t,n)}function ve(e,t,n,r){return N(e).eyeTiltToLookAtTilt(r,t,n)}function he(t,n,r,o){if(i(n))return null;const s=t.renderSpatialReference,c=y(n.eye,s,Y(t));return i(c)?null:a(o)?(o.position=c,o.heading=n.heading,o.tilt=n.tilt,o.fov=r,o):new e(c,n.heading,n.tilt,r)}function ge(e,t){var n;const r=null==(n=e.basemapTerrain)?void 0:n.tilingScheme;if(r)return r.levelAtScale(t);P.error(\"#scaleToZoom()\",\"Cannot compute zoom from scale without a tiling scheme\")}function ye(e,t){var n;const r=null==(n=e.basemapTerrain)?void 0:n.tilingScheme;if(r)return r.scaleAtLevel(t);P.error(\"#zoomToScale()\",\"Cannot compute scale from zoom without a tiling scheme\")}function Re(e,t){return e.spatialReference?j(t,e.spatialReference):void 0}function Me(t,n,r){const i=t.renderSpatialReference;let o,a;n||(n=t.state.camera);const s=M.WGS84;return n instanceof e?(o=n.position.latitude,h(n.position,F,i),h(r,G,i),a=u(F,G)):(g(n.center,i,G,s),o=G[1],a=n.distance),V(t,a,o)}class je{constructor(e){this.signal=e,this.resolver=s()}}function xe(e){return e&&\"resolver\"in e}export{je as AsyncContext,Me as computeScale,ee as directionToHeadingTilt,V as distanceToScale,B as externalToInternal,_ as fromCenterDistance,$ as fromCenterScale,se as fromExtent,oe as getObserverForPointAtDistance,Z as headingTiltToDirectionUp,K as internalToExternal,he as observerToCamera,Q as scaleToDistance,Re as scaleToResolution,ge as scaleToZoom,ce as toExtent,ye as zoomToScale};\n"]},"metadata":{},"sourceType":"module"}