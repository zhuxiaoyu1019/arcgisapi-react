{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nconst t = \"esriJSAPIOAuth\";\n\nclass s {\n  constructor(t, s) {\n    this.oAuthInfo = null, this.storage = null, this.appId = null, this.expires = null, this.ssl = null, this.token = null, this.userId = null, this.oAuthInfo = t, this.storage = s, this._init();\n  }\n\n  isValid() {\n    let t = !1;\n\n    if (this.oAuthInfo && this.token && this.userId) {\n      const s = Date.now();\n\n      if (this.expires > s) {\n        (this.expires - s) / 1e3 > 60 * this.oAuthInfo.minTimeUntilExpiration && (t = !0);\n      }\n    }\n\n    return t;\n  }\n\n  save() {\n    if (!this.storage) return;\n\n    const s = this._load(),\n          e = this.oAuthInfo;\n\n    if (e && e.authNamespace && e.portalUrl) {\n      let o = s[e.authNamespace];\n      o || (o = s[e.authNamespace] = {}), o[e.portalUrl] = {\n        appId: this.appId = e.appId,\n        expires: this.expires,\n        ssl: this.ssl,\n        token: this.token,\n        userId: this.userId\n      };\n\n      try {\n        this.storage.setItem(t, JSON.stringify(s));\n      } catch (i) {\n        console.log(i);\n      }\n    }\n  }\n\n  destroy() {\n    const s = this._load(),\n          e = this.oAuthInfo;\n\n    if (e && e.appId && e.portalUrl && this.token && this.expires > Date.now()) {\n      const t = e.portalUrl.replace(/^http:/i, \"https:\") + \"/sharing/rest/oauth2/revokeToken\",\n            s = new FormData();\n      if (s.append(\"f\", \"json\"), s.append(\"auth_token\", this.token), s.append(\"client_id\", e.appId), s.append(\"token_type_hint\", \"access_token\"), \"function\" == typeof navigator.sendBeacon) navigator.sendBeacon(t, s);else {\n        const e = new XMLHttpRequest();\n        e.open(\"POST\", t), e.send(s);\n      }\n    }\n\n    if (e && e.authNamespace && e.portalUrl && this.storage) {\n      const o = s[e.authNamespace];\n\n      if (o) {\n        delete o[e.portalUrl];\n\n        try {\n          this.storage.setItem(t, JSON.stringify(s));\n        } catch (i) {\n          console.log(i);\n        }\n      }\n    }\n\n    e && (e._oAuthCred = null, this.oAuthInfo = null);\n  }\n\n  _init() {\n    const t = this._load(),\n          s = this.oAuthInfo;\n\n    if (s && s.authNamespace && s.portalUrl) {\n      let e = t[s.authNamespace];\n      e && (e = e[s.portalUrl], e && (this.appId = e.appId, this.expires = e.expires, this.ssl = e.ssl, this.token = e.token, this.userId = e.userId));\n    }\n  }\n\n  _load() {\n    let s = {};\n\n    if (this.storage) {\n      const i = this.storage.getItem(t);\n      if (i) try {\n        s = JSON.parse(i);\n      } catch (e) {\n        console.log(e);\n      }\n    }\n\n    return s;\n  }\n\n}\n\ns.prototype.declaredClass = \"esri.identity.OAuthCredential\";\nexport default s;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/identity/OAuthCredential.js"],"names":["t","s","constructor","oAuthInfo","storage","appId","expires","ssl","token","userId","_init","isValid","Date","now","minTimeUntilExpiration","save","_load","e","authNamespace","portalUrl","o","setItem","JSON","stringify","i","console","log","destroy","replace","FormData","append","navigator","sendBeacon","XMLHttpRequest","open","send","_oAuthCred","getItem","parse","prototype","declaredClass"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nconst t=\"esriJSAPIOAuth\";class s{constructor(t,s){this.oAuthInfo=null,this.storage=null,this.appId=null,this.expires=null,this.ssl=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=s,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.token&&this.userId){const s=Date.now();if(this.expires>s){(this.expires-s)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}}return t}save(){if(!this.storage)return;const s=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let o=s[e.authNamespace];o||(o=s[e.authNamespace]={}),o[e.portalUrl]={appId:this.appId=e.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem(t,JSON.stringify(s))}catch(i){console.log(i)}}}destroy(){const s=this._load(),e=this.oAuthInfo;if(e&&e.appId&&e.portalUrl&&this.token&&this.expires>Date.now()){const t=e.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/rest/oauth2/revokeToken\",s=new FormData;if(s.append(\"f\",\"json\"),s.append(\"auth_token\",this.token),s.append(\"client_id\",e.appId),s.append(\"token_type_hint\",\"access_token\"),\"function\"==typeof navigator.sendBeacon)navigator.sendBeacon(t,s);else{const e=new XMLHttpRequest;e.open(\"POST\",t),e.send(s)}}if(e&&e.authNamespace&&e.portalUrl&&this.storage){const o=s[e.authNamespace];if(o){delete o[e.portalUrl];try{this.storage.setItem(t,JSON.stringify(s))}catch(i){console.log(i)}}}e&&(e._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),s=this.oAuthInfo;if(s&&s.authNamespace&&s.portalUrl){let e=t[s.authNamespace];e&&(e=e[s.portalUrl],e&&(this.appId=e.appId,this.expires=e.expires,this.ssl=e.ssl,this.token=e.token,this.userId=e.userId))}}_load(){let s={};if(this.storage){const i=this.storage.getItem(t);if(i)try{s=JSON.parse(i)}catch(e){console.log(e)}}return s}}s.prototype.declaredClass=\"esri.identity.OAuthCredential\";export default s;\n"]},"metadata":{},"sourceType":"module"}