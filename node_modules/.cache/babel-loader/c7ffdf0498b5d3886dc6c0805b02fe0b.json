{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport { isSome as t, get as s, none as r, isNone as i, unwrapOr as a } from \"../../../../core/maybe.js\";\nimport { pt2px as o } from \"../../../../core/screenUtils.js\";\nimport { d as n, i as l, s as c, t as h } from \"../../../../chunks/mat4.js\";\nimport { c as d } from \"../../../../chunks/mat4f64.js\";\nimport { l as p, o as m, g as u, D as y, b as f, s as _ } from \"../../../../chunks/vec3.js\";\nimport { d as g, O as b, Z as P, f as v, c as x } from \"../../../../chunks/vec3f64.js\";\nimport { O as R, c as L } from \"../../../../chunks/vec4f64.js\";\nimport { projectPointToVector as S, computeLinearTransformation as C } from \"../../../../geometry/projection.js\";\nimport { create as E, size as U, containsPoint as w, center as j } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { defaultPrimitive as T } from \"../../../../symbols/support/ObjectSymbol3DLayerResource.js\";\nimport { objectSymbolLayerPrimitiveBoundingBox as B, objectSymbolLayerSizeWithResourceSize as G } from \"../../../../symbols/support/symbolLayerUtils3D.js\";\nimport { perLodInstanceElevationAligner as O } from \"./ElevationAligners.js\";\nimport { needsElevationUpdates3D as V, evaluateElevationAlignmentAtPoint as z } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as I } from \"./ElevationContext.js\";\nimport M from \"./Graphics3DLodInstanceGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as D } from \"./Graphics3DSymbolLayer.js\";\nimport { validateSymbolLayerSize as A, mixinColorAndOpacity as F, computeObjectScale as k, computeObjectRotation as W } from \"./graphicUtils.js\";\nimport { makeLodResources as q, fillEstimatedMinScreenSpaceRadius as H } from \"./lodResourceUtils.js\";\nimport { fetch as $ } from \"./objectResourceUtils.js\";\nimport { placePointOnGeometry as Z, extendPointGraphicElevationContext as J } from \"./pointUtils.js\";\nimport { isValidPrimitive as K, primitiveLodResources as N } from \"./primitiveObjectSymbolUtils.js\";\nimport { defaultSymbolLayerMemoryComplexity as Q } from \"./symbolComplexity.js\";\nimport { initFastSymbolUpdatesState as X, updateFastSymbolUpdatesState as Y, evaluateModelTransform as ee, evaluateModelTransformScale as te } from \"../support/FastSymbolUpdates.js\";\nimport { LodRenderer as se } from \"../../webgl-engine/lib/lodRendering/LodRenderer.js\";\nimport { materialsFromLodResources as re, texturesFromLodResources as ie, geometriesFromLodResources as ae, geometriesFromLodLevelResources as oe } from \"../../webgl-engine/lib/lodRendering/LodResources.js\";\nimport { DefaultMaterial as ne } from \"../../webgl-engine/materials/DefaultMaterial.js\";\n\nclass le extends D {\n  constructor(e, t, s, r) {\n    super(e, t, s, r), this._resources = null, this._optionalFields = new Array(), this._instanceIndexToGraphicUid = new Map(), this.hasLoadedPBRTextures = !1, this.ensureDrapedStatus(!1), this.hasLoadedPBRTextures = s.physicalBasedRenderingEnabled;\n  }\n\n  getCachedSize() {\n    const [e, s, r] = t(this._resources) ? this._resources.symbolSize : [1, 1, 1];\n    return {\n      width: e,\n      depth: s,\n      height: r\n    };\n  }\n\n  async doLoad(e) {\n    if (!this._drivenProperties.size) {\n      if (A(this.symbolLayer)) throw new Error();\n    }\n\n    const t = this.symbolLayer;\n\n    if (this.isPrimitive) {\n      const s = t.resource ? t.resource.primitive : T;\n      this._resources = await this._createResourcesForPrimitive(s, e);\n    } else this._resources = await this._createResourcesForUrl(t.resource.href, e);\n\n    this.layerOpacityChanged(), this.slicePlaneEnabledChanged(), this.physicalBasedRenderingChanged(), this.complexity = this.computeComplexity();\n  }\n\n  get extentPadding() {\n    return t(this._resources) ? this._resources.extentPadding : 0;\n  }\n\n  get isPrimitive() {\n    return !(this.symbolLayer.resource && this.symbolLayer.resource.href);\n  }\n\n  get lodRenderer() {\n    return s(this._resources, \"lodRenderer\");\n  }\n\n  setMaterialTransparencyParams(e, t = s(this.symbolLayer, \"material\", \"color\")) {\n    const r = this._getCombinedOpacity(t),\n          i = r < 1 || this.needsDrivenTransparentPass;\n\n    return e.transparent = i, e.opacity = r, e.cullFace = i ? 0 : 2, e;\n  }\n\n  async _createResourcesForPrimitive(s, i) {\n    if (!K(s)) throw new Error(`Unknown object symbol primitive: ${s}`);\n    const a = this.symbolLayer,\n          n = E(B(s)),\n          l = g(U(n)),\n          c = g(G(l, a)),\n          h = p(c),\n          d = !1,\n          m = !1,\n          u = {\n      usePBR: this._context.physicalBasedRenderingEnabled,\n      isSchematic: !0,\n      instanced: [\"transformation\"],\n      ambient: b,\n      diffuse: b,\n      slicePlaneEnabled: this._context.slicePlaneEnabled,\n      sliceHighlightDisabled: !0,\n      castShadows: this.symbolLayer.castShadows,\n      offsetTransparentBackfaces: !this.symbolLayer.isPrimitive\n    },\n          y = u.usePBR;\n    this.setMaterialTransparencyParams(u);\n    const f = this.symbol;\n\n    if (\"point-3d\" === f.type && f.verticalOffset) {\n      const {\n        screenLength: e,\n        minWorldLength: t,\n        maxWorldLength: s\n      } = f.verticalOffset;\n      u.verticalOffset = {\n        screenLength: o(e),\n        minWorldLength: t || 0,\n        maxWorldLength: null != s ? s : 1 / 0\n      }, u.castShadows = !1;\n    }\n\n    if (this._context.screenSizePerspectiveEnabled && (u.screenSizePerspective = this._context.sharedResources.screenSizePerspectiveSettings), this._drivenProperties.color) u.externalColor = R;else {\n      const s = t(a.material) && a.material.color,\n            r = t(s) ? e.toUnitRGBA(s) : R;\n      u.externalColor = r;\n    }\n    this._fastUpdates = X(this._context.renderer, this._fastVisualVariableConvertOptions(n, c, l, r)), this._fastUpdates.enabled ? (Object.assign(u, this._fastUpdates.materialParameters), u.instanced.push(\"featureAttribute\"), this._optionalFields.push(\"featureAttribute\")) : this._hasPerInstanceColor() && (u.instanced.push(\"color\"), this._optionalFields.push(\"color\"));\n\n    const _ = new ne(u),\n          P = N(s, _);\n\n    if (!P) throw new Error(`Unknown object symbol primitive: ${s}`);\n\n    const v = re(P).map(e => ({\n      opacity: 1,\n      transparent: e.params.transparent\n    })),\n          x = this._createStageResources(P, y);\n\n    return {\n      lodResources: P,\n      lodRenderer: await this._createLodRenderer(P, i),\n      stageResources: x,\n      symbolSize: c,\n      extentPadding: h,\n      isEsriSymbolResource: d,\n      isWosr: m,\n      originalMaterialParameters: v,\n      physicalBasedRenderingEnabled: y,\n      resourceBoundingBox: n,\n      resourceSize: l,\n      dispose: r,\n      pivotOffset: r\n    };\n  }\n\n  async _createResourcesForUrl(e, t) {\n    const i = [\"transformation\"],\n          a = {\n      materialParamsMixin: {\n        instanced: i,\n        slicePlaneEnabled: this._context.slicePlaneEnabled,\n        castShadows: this.symbolLayer.castShadows\n      },\n      streamDataRequester: this._context.streamDataRequester,\n      cache: this._context.sharedResources.objectResourceCache\n    };\n    this._fastUpdates = X(this._context.renderer, this._fastVisualVariableConvertOptions(r, r, r, r)), this._fastUpdates.enabled ? (Object.assign(a.materialParamsMixin, this._fastUpdates.materialParameters), i.push(\"featureAttribute\"), this._optionalFields.push(\"featureAttribute\")) : this._hasPerInstanceColor() && (i.push(\"color\"), this._optionalFields.push(\"color\"));\n    const n = this.symbol;\n\n    if (\"point-3d\" === n.type && n.verticalOffset) {\n      const {\n        screenLength: e,\n        minWorldLength: t,\n        maxWorldLength: s\n      } = n.verticalOffset;\n      a.materialParamsMixin.verticalOffset = {\n        screenLength: o(e),\n        minWorldLength: t || 0,\n        maxWorldLength: null != s ? s : 1 / 0\n      }, a.materialParamsMixin.castShadows = !1;\n    }\n\n    a.signal = t, a.usePBR = this._context.physicalBasedRenderingEnabled;\n    const l = a.usePBR,\n          c = await $(e, a),\n          h = c.isEsriSymbolResource,\n          d = c.isWosr,\n          m = c.remove,\n          u = q(c.lods);\n    H(u), u.levels.sort((e, t) => e.minScreenSpaceRadius - t.minScreenSpaceRadius), u.levels[0].minScreenSpaceRadius = Math.min(2, u.levels[0].minScreenSpaceRadius);\n\n    const y = this._context,\n          f = this.symbolLayer.material,\n          _ = this._getExternalColorParameters(f),\n          b = s(this.symbolLayer, \"material\", \"color\"),\n          P = this._getCombinedOpacity(b, {\n      hasIntrinsicColor: !0\n    }),\n          v = this.needsDrivenTransparentPass,\n          x = re(u),\n          R = re(u).map(e => ({\n      opacity: e.params.opacity || 1,\n      transparent: e.params.transparent\n    }));\n\n    x.forEach(e => {\n      const t = e.params;\n      e.setParameterValues(_);\n      const s = t.opacity * P,\n            r = s < 1 || v || t.transparent;\n      e.setParameterValues({\n        opacity: s,\n        transparent: r\n      }), y.screenSizePerspectiveEnabled && e.setParameterValues({\n        screenSizePerspective: y.sharedResources.screenSizePerspectiveSettings\n      });\n    });\n    const L = c.referenceBoundingBox,\n          S = g(U(L)),\n          C = g(u.levels[0].pivotOffset),\n          E = g(G(S, this.symbolLayer)),\n          w = p(E);\n    Y(this._fastUpdates, this._context.renderer, this._fastVisualVariableConvertOptions(L, E, S, C)) && x.forEach(e => e.setParameterValues(this._fastUpdates.materialParameters));\n\n    const j = this._createStageResources(u, l);\n\n    return {\n      lodResources: u,\n      lodRenderer: await this._createLodRenderer(u, t),\n      stageResources: j,\n      symbolSize: E,\n      extentPadding: w,\n      isEsriSymbolResource: h,\n      isWosr: d,\n      originalMaterialParameters: R,\n      physicalBasedRenderingEnabled: l,\n      resourceBoundingBox: L,\n      resourceSize: S,\n      dispose: m,\n      pivotOffset: C\n    };\n  }\n\n  _createStageResources(e, t) {\n    const s = this._context.stage,\n          r = re(e);\n    t !== this._context.physicalBasedRenderingEnabled && this.physicalBasedRenderingChanged(), s.addMany(r);\n    const i = ie(e);\n    s.addMany(i);\n    const a = ae(e);\n    return s.addMany(a), {\n      materials: r,\n      textures: i,\n      geometries: a\n    };\n  }\n\n  async _createLodRenderer(e, t) {\n    const s = this._context.stage,\n          r = {\n      layerUid: this._context.layer.uid,\n      graphicUid: e => this._instanceIndexToGraphicUid.get(e),\n      notifyGraphicGeometryChanged: e => this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),\n      notifyGraphicVisibilityChanged: e => this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))\n    },\n          i = this._fastUpdates.enabled ? {\n      applyTransform: (e, t, s) => {\n        e.getFeatureAttribute(t, pe), n(s, ee(this._fastUpdates.materialParameters, pe, s));\n      },\n      scaleFactor: (e, t, s) => (t.getFeatureAttribute(s, pe), te(e, this._fastUpdates.materialParameters, pe))\n    } : null,\n          a = new se(e, this._optionalFields, r, i);\n    return a.slicePlane = this._context.slicePlaneEnabled, await s.addRenderPlugin(a.slots, a, t), a;\n  }\n\n  _getExternalColorParameters(s) {\n    const r = {};\n    return this._drivenProperties.color ? r.externalColor = R : t(s) && t(s.color) ? r.externalColor = e.toUnitRGBA(s.color) : (r.externalColor = R, r.colorMixMode = \"ignore\"), r;\n  }\n\n  destroy() {\n    super.destroy();\n    const e = this._context.stage;\n\n    if (t(this._resources)) {\n      e.removeRenderPlugin(this._resources.lodRenderer);\n      const s = this._resources.stageResources;\n      e.removeMany(s.materials), e.removeMany(s.textures), e.removeMany(s.geometries), t(this._resources.dispose) && this._resources.dispose();\n    }\n\n    this._resources = null;\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry)) return null;\n    const s = Z(t.geometry);\n    if (i(s)) return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`), null;\n    const r = this.setGraphicElevationContext(t, new I()),\n          a = e.renderingInfo;\n    return this._createAs3DShape(t, s, a, r, t.uid);\n  }\n\n  notifyDestroyGraphicLayer(e) {\n    this._instanceIndexToGraphicUid.delete(e.instanceIndex);\n  }\n\n  graphicLayerToGraphicId() {\n    return 0;\n  }\n\n  layerOpacityChanged() {\n    if (i(this._resources)) return !0;\n    const e = this._drivenProperties.opacity,\n          t = !this.isPrimitive,\n          r = this._resources.stageResources.materials,\n          a = this._resources.originalMaterialParameters;\n\n    for (let i = 0; i < r.length; i++) {\n      const o = r[i],\n            n = s(this.symbolLayer, \"material\", \"color\"),\n            l = a[i],\n            c = this._getCombinedOpacity(n, {\n        hasIntrinsicColor: t\n      }) * l.opacity,\n            h = c < 1 || e || l.transparent;\n      o.setParameterValues({\n        opacity: c,\n        transparent: h\n      }), this.isPrimitive && o.setParameterValues({\n        cullFace: h ? 0 : 2\n      });\n    }\n\n    return !0;\n  }\n\n  layerElevationInfoChanged(e, t) {\n    return this.updateGraphics3DGraphicElevationInfo(e, t, V);\n  }\n\n  slicePlaneEnabledChanged() {\n    if (i(this._resources)) return !0;\n    this._resources.lodRenderer.slicePlane = this._context.slicePlaneEnabled;\n\n    for (const e of this._resources.stageResources.materials) e.setParameterValues({\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    });\n\n    return !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    if (i(this._resources)) return !0;\n    const {\n      stageResources: e,\n      isWosr: t\n    } = this._resources;\n\n    for (const s of e.materials) this.isPrimitive ? s.setParameterValues({\n      usePBR: this._context.physicalBasedRenderingEnabled,\n      isSchematic: !0\n    }) : t || s.setParameterValues({\n      usePBR: this._context.physicalBasedRenderingEnabled,\n      isSchematic: !1\n    });\n\n    return !1 !== this.hasLoadedPBRTextures || !0 !== this._context.physicalBasedRenderingEnabled || (this.hasLoadedPBRTextures = !0, !1);\n  }\n\n  pixelRatioChanged() {\n    return !0;\n  }\n\n  applyRendererDiff(e, t) {\n    if (i(this._resources)) return !0;\n    const {\n      stageResources: {\n        materials: s\n      },\n      lodRenderer: r,\n      resourceBoundingBox: a,\n      symbolSize: o,\n      resourceSize: n,\n      pivotOffset: l\n    } = this._resources;\n\n    for (const i in e.diff) switch (i) {\n      case \"visualVariables\":\n        if (!Y(this._fastUpdates, t, this._fastVisualVariableConvertOptions(a, o, n, l))) return !1;\n\n        for (const e of s) e.setParameterValues(this._fastUpdates.materialParameters);\n\n        r.notifyShaderTransformationChanged();\n        break;\n\n      default:\n        return !1;\n    }\n\n    return !0;\n  }\n\n  computeComplexity() {\n    if (i(this._resources)) return super.computeComplexity();\n    return {\n      primitivesPerFeature: oe(this._resources.lodResources.levels[0]).reduce((e, t) => e + t.indices.get(\"position\").length, 0) / 3,\n      primitivesPerCoordinate: 0,\n      drawCallsPerFeature: 0,\n      estimated: !1,\n      memory: Q(this.symbol, this.symbolLayer)\n    };\n  }\n\n  hasLodRenderer() {\n    return t(this._resources);\n  }\n\n  _createAs3DShape(e, s, r, a, o) {\n    if (!this.hasLodRenderer() || i(this._resources)) return null;\n    const n = this.getFastUpdateAttrValues(e),\n          l = !this._fastUpdates.enabled && this._hasPerInstanceColor() ? F(r.color, r.opacity) : null,\n          c = this._context.clippingExtent;\n    if (S(s, ce, this._context.elevationProvider.spatialReference), t(c) && !w(c, ce)) return null;\n\n    const h = this._requiresTerrainElevation(a),\n          d = this._computeGlobalTransform(s, a, de, h ? me : null),\n          p = this._computeLocalTransform(this._resources, this.symbolLayer, r, he),\n          m = this._resources.lodRenderer.instanceData,\n          u = m.addInstance();\n\n    this._instanceIndexToGraphicUid.set(u, o), m.setLocalTransform(u, p, !1), m.setGlobalTransform(u, d), n && m.setFeatureAttribute(u, n), l && m.setColor(u, l);\n    const y = new M(this, u, O, a);\n    return h && (y.alignedSampledElevation = me.sampledElevation), y.needsElevationUpdates = V(a.mode), J(y, s, this._context.elevationProvider), y;\n  }\n\n  _computeGlobalTransform(e, t, s, r) {\n    const i = z(e, this._context.elevationProvider, t, this._context.renderCoordsHelper, r);\n    return ce[0] = e.x, ce[1] = e.y, ce[2] = i, C(e.spatialReference, ce, s, this._context.renderCoordsHelper.spatialReference), s;\n  }\n\n  _computeLocalTransform(e, t, s, r) {\n    return l(r), this._applyObjectRotation(s, !1, r), this._applyObjectRotation(t, !0, r), this._applyObjectScale(e, s, r), this._applyAnchor(e, t, r), r;\n  }\n\n  _applyObjectScale(e, t, s) {\n    if (this._fastUpdates.enabled && this._fastUpdates.requiresShaderTransformation) return;\n    const r = this._drivenProperties.size && t.size ? t.size : e.symbolSize,\n          i = k(r, e.symbolSize, e.resourceSize, this._context.renderCoordsHelper.unitInMeters);\n    1 === i[0] && 1 === i[1] && 1 === i[2] || c(s, s, i);\n  }\n\n  prepareSymbolLayerPatch(e) {\n    if (\"partial\" !== e.diff.type) return;\n    const t = e.diff.diff;\n    this._preparePatchTransform(e, t), this._preparePatchColor(e, t);\n  }\n\n  updateGeometry(e, t) {\n    if (i(this._resources)) return !0;\n    const s = t && Z(t);\n    if (i(s)) return !1;\n    const r = this.getGeometryElevationMode(t);\n    if (e.elevationContext.mode !== r) return !1;\n\n    const a = this._requiresTerrainElevation(e.elevationContext);\n\n    return this._computeGlobalTransform(s, e.elevationContext, de, a ? me : null), a && (e.alignedSampledElevation = me.sampledElevation), this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex, de, !0), J(e, s, this._context.elevationProvider), !0;\n  }\n\n  _preparePatchTransform(e, t) {\n    if (!(t.heading || t.tilt || t.roll || t.width || t.height || t.depth || t.anchor || t.anchorPosition)) return;\n    if (i(this._resources)) return;\n\n    const s = (e, t, s) => a(null != e && \"complete\" === e.type ? e.newValue : t, s),\n          r = s(t.heading, this.symbolLayer.heading, 0),\n          o = s(t.tilt, this.symbolLayer.tilt, 0),\n          n = s(t.roll, this.symbolLayer.roll, 0),\n          l = s(t.width, this.symbolLayer.width, void 0),\n          c = s(t.height, this.symbolLayer.height, void 0),\n          h = s(t.depth, this.symbolLayer.depth, void 0),\n          d = s(t.anchor, this.symbolLayer.anchor, void 0),\n          p = s(t.anchorPosition, this.symbolLayer.anchorPosition, void 0);\n\n    delete t.heading, delete t.tilt, delete t.roll, delete t.width, delete t.height, delete t.depth, delete t.anchor, delete t.anchorPosition;\n    const m = {\n      heading: r,\n      tilt: o,\n      roll: n,\n      anchor: d,\n      anchorPosition: p\n    },\n          u = this._resources;\n    1 === this.loadStatus && e.symbolLayerStatePatches.push(() => {\n      u.symbolSize = g(G(u.resourceSize, {\n        width: l,\n        height: c,\n        depth: h,\n        isPrimitive: this.symbolLayer.isPrimitive\n      }));\n    }), e.graphics3DGraphicPatches.push((e, t) => {\n      const s = this._computeLocalTransform(u, m, t, he),\n            r = e.instanceIndex;\n\n      u.lodRenderer.instanceData.setLocalTransform(r, s, !0);\n    });\n  }\n\n  _preparePatchColor(s, r) {\n    if (!r.material || \"partial\" !== r.material.type) return;\n    const a = r.material.diff;\n    if (!a.color || \"complete\" !== a.color.type || null == a.color.newValue || null == a.color.oldValue) return;\n    const o = a.color.newValue,\n          n = t(o) ? e.toUnitRGBA(o) : R;\n    delete a.color;\n    const l = this._resources;\n    i(l) || s.graphics3DGraphicPatches.push(e => {\n      let t;\n      this._hasPerInstanceColor() ? (l.lodRenderer.instanceData.setColor(e.instanceIndex, n), t = this.setMaterialTransparencyParams({}, o)) : t = this.setMaterialTransparencyParams({\n        externalColor: n\n      }, o);\n\n      for (const s of l.stageResources.materials) s.setParameterValues(t);\n    });\n  }\n\n  _requiresTerrainElevation(e) {\n    return \"absolute-height\" !== e.mode;\n  }\n\n  _applyObjectRotation(e, t, s) {\n    if (!(this._fastUpdates.enabled && this._fastUpdates.requiresShaderTransformation && t)) return W(e.heading, e.tilt, e.roll, s);\n  }\n\n  _computeAnchor(e, s, r) {\n    const i = x();\n\n    switch (r.anchor) {\n      case \"center\":\n        u(i, j(e)), m(i, i);\n        break;\n\n      case \"top\":\n        {\n          const t = j(e);\n\n          _(i, -t[0], -t[1], -e[5]);\n\n          break;\n        }\n\n      case \"bottom\":\n        {\n          const t = j(e);\n\n          _(i, -t[0], -t[1], -e[2]);\n\n          break;\n        }\n\n      case \"relative\":\n        {\n          const t = j(e),\n                s = U(e),\n                a = r.anchorPosition,\n                o = a ? v(a.x, a.y, a.z) : P;\n          y(i, s, o), f(i, i, t), m(i, i);\n          break;\n        }\n\n      case \"origin\":\n      default:\n        t(s) ? m(i, s) : u(i, P);\n    }\n\n    return i;\n  }\n\n  _applyAnchor(e, t, s) {\n    if (this._fastUpdates.enabled && this._fastUpdates.requiresShaderTransformation) return;\n\n    const r = this._computeAnchor(e.resourceBoundingBox, e.pivotOffset, t);\n\n    r && h(s, s, r);\n  }\n\n  _hasPerInstanceColor() {\n    return this._drivenProperties.color || this._drivenProperties.opacity;\n  }\n\n  _fastVisualVariableConvertOptions(e, s, r, i) {\n    const a = t(e) ? g(U(e)) : b,\n          o = t(e) ? this._computeAnchor(e, i, this.symbolLayer) : P,\n          n = this._context.renderCoordsHelper.unitInMeters,\n          l = k(t(s) ? s : void 0, s, r, n),\n          c = v(this.symbolLayer.tilt || 0, this.symbolLayer.roll || 0, this.symbolLayer.heading || 0);\n    return {\n      modelSize: a,\n      symbolSize: t(s) ? s : b,\n      unitInMeters: n,\n      transformation: {\n        anchor: o,\n        scale: l,\n        rotation: c\n      }\n    };\n  }\n\n}\n\nconst ce = x(),\n      he = d(),\n      de = d(),\n      pe = L(),\n      me = {\n  verticalDistanceToGround: 0,\n  sampledElevation: 0\n};\nexport default le;\nexport { le as Graphics3DObjectSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectSymbolLayer.js"],"names":["e","isSome","t","get","s","none","r","isNone","i","unwrapOr","a","pt2px","o","d","n","l","c","h","p","m","g","u","D","y","b","f","_","O","Z","P","v","x","R","L","projectPointToVector","S","computeLinearTransformation","C","create","E","size","U","containsPoint","w","center","j","defaultPrimitive","T","objectSymbolLayerPrimitiveBoundingBox","B","objectSymbolLayerSizeWithResourceSize","G","perLodInstanceElevationAligner","needsElevationUpdates3D","V","evaluateElevationAlignmentAtPoint","z","ElevationContext","I","M","Graphics3DSymbolLayer","validateSymbolLayerSize","A","mixinColorAndOpacity","F","computeObjectScale","k","computeObjectRotation","W","makeLodResources","q","fillEstimatedMinScreenSpaceRadius","H","fetch","$","placePointOnGeometry","extendPointGraphicElevationContext","J","isValidPrimitive","K","primitiveLodResources","N","defaultSymbolLayerMemoryComplexity","Q","initFastSymbolUpdatesState","X","updateFastSymbolUpdatesState","Y","evaluateModelTransform","ee","evaluateModelTransformScale","te","LodRenderer","se","materialsFromLodResources","re","texturesFromLodResources","ie","geometriesFromLodResources","ae","geometriesFromLodLevelResources","oe","DefaultMaterial","ne","le","constructor","_resources","_optionalFields","Array","_instanceIndexToGraphicUid","Map","hasLoadedPBRTextures","ensureDrapedStatus","physicalBasedRenderingEnabled","getCachedSize","symbolSize","width","depth","height","doLoad","_drivenProperties","symbolLayer","Error","isPrimitive","resource","primitive","_createResourcesForPrimitive","_createResourcesForUrl","href","layerOpacityChanged","slicePlaneEnabledChanged","physicalBasedRenderingChanged","complexity","computeComplexity","extentPadding","lodRenderer","setMaterialTransparencyParams","_getCombinedOpacity","needsDrivenTransparentPass","transparent","opacity","cullFace","usePBR","_context","isSchematic","instanced","ambient","diffuse","slicePlaneEnabled","sliceHighlightDisabled","castShadows","offsetTransparentBackfaces","symbol","type","verticalOffset","screenLength","minWorldLength","maxWorldLength","screenSizePerspectiveEnabled","screenSizePerspective","sharedResources","screenSizePerspectiveSettings","color","externalColor","material","toUnitRGBA","_fastUpdates","renderer","_fastVisualVariableConvertOptions","enabled","Object","assign","materialParameters","push","_hasPerInstanceColor","map","params","_createStageResources","lodResources","_createLodRenderer","stageResources","isEsriSymbolResource","isWosr","originalMaterialParameters","resourceBoundingBox","resourceSize","dispose","pivotOffset","materialParamsMixin","streamDataRequester","cache","objectResourceCache","signal","remove","lods","levels","sort","minScreenSpaceRadius","Math","min","_getExternalColorParameters","hasIntrinsicColor","forEach","setParameterValues","referenceBoundingBox","stage","addMany","materials","textures","geometries","layerUid","layer","uid","graphicUid","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","applyTransform","getFeatureAttribute","pe","scaleFactor","slicePlane","addRenderPlugin","slots","colorMixMode","destroy","removeRenderPlugin","removeMany","createGraphics3DGraphic","graphic","_validateGeometry","geometry","logger","warn","setGraphicElevationContext","renderingInfo","_createAs3DShape","notifyDestroyGraphicLayer","delete","instanceIndex","graphicLayerToGraphicId","length","layerElevationInfoChanged","updateGraphics3DGraphicElevationInfo","pixelRatioChanged","applyRendererDiff","diff","notifyShaderTransformationChanged","primitivesPerFeature","reduce","indices","primitivesPerCoordinate","drawCallsPerFeature","estimated","memory","hasLodRenderer","getFastUpdateAttrValues","clippingExtent","ce","elevationProvider","spatialReference","_requiresTerrainElevation","_computeGlobalTransform","de","me","_computeLocalTransform","he","instanceData","addInstance","set","setLocalTransform","setGlobalTransform","setFeatureAttribute","setColor","alignedSampledElevation","sampledElevation","needsElevationUpdates","mode","renderCoordsHelper","_applyObjectRotation","_applyObjectScale","_applyAnchor","requiresShaderTransformation","unitInMeters","prepareSymbolLayerPatch","_preparePatchTransform","_preparePatchColor","updateGeometry","getGeometryElevationMode","elevationContext","heading","tilt","roll","anchor","anchorPosition","newValue","loadStatus","symbolLayerStatePatches","graphics3DGraphicPatches","oldValue","_computeAnchor","modelSize","transformation","scale","rotation","verticalDistanceToGround","Graphics3DObjectSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import{isSome as t,get as s,none as r,isNone as i,unwrapOr as a}from\"../../../../core/maybe.js\";import{pt2px as o}from\"../../../../core/screenUtils.js\";import{d as n,i as l,s as c,t as h}from\"../../../../chunks/mat4.js\";import{c as d}from\"../../../../chunks/mat4f64.js\";import{l as p,o as m,g as u,D as y,b as f,s as _}from\"../../../../chunks/vec3.js\";import{d as g,O as b,Z as P,f as v,c as x}from\"../../../../chunks/vec3f64.js\";import{O as R,c as L}from\"../../../../chunks/vec4f64.js\";import{projectPointToVector as S,computeLinearTransformation as C}from\"../../../../geometry/projection.js\";import{create as E,size as U,containsPoint as w,center as j}from\"../../../../geometry/support/aaBoundingBox.js\";import{defaultPrimitive as T}from\"../../../../symbols/support/ObjectSymbol3DLayerResource.js\";import{objectSymbolLayerPrimitiveBoundingBox as B,objectSymbolLayerSizeWithResourceSize as G}from\"../../../../symbols/support/symbolLayerUtils3D.js\";import{perLodInstanceElevationAligner as O}from\"./ElevationAligners.js\";import{needsElevationUpdates3D as V,evaluateElevationAlignmentAtPoint as z}from\"./elevationAlignmentUtils.js\";import{ElevationContext as I}from\"./ElevationContext.js\";import M from\"./Graphics3DLodInstanceGraphicLayer.js\";import{Graphics3DSymbolLayer as D}from\"./Graphics3DSymbolLayer.js\";import{validateSymbolLayerSize as A,mixinColorAndOpacity as F,computeObjectScale as k,computeObjectRotation as W}from\"./graphicUtils.js\";import{makeLodResources as q,fillEstimatedMinScreenSpaceRadius as H}from\"./lodResourceUtils.js\";import{fetch as $}from\"./objectResourceUtils.js\";import{placePointOnGeometry as Z,extendPointGraphicElevationContext as J}from\"./pointUtils.js\";import{isValidPrimitive as K,primitiveLodResources as N}from\"./primitiveObjectSymbolUtils.js\";import{defaultSymbolLayerMemoryComplexity as Q}from\"./symbolComplexity.js\";import{initFastSymbolUpdatesState as X,updateFastSymbolUpdatesState as Y,evaluateModelTransform as ee,evaluateModelTransformScale as te}from\"../support/FastSymbolUpdates.js\";import{LodRenderer as se}from\"../../webgl-engine/lib/lodRendering/LodRenderer.js\";import{materialsFromLodResources as re,texturesFromLodResources as ie,geometriesFromLodResources as ae,geometriesFromLodLevelResources as oe}from\"../../webgl-engine/lib/lodRendering/LodResources.js\";import{DefaultMaterial as ne}from\"../../webgl-engine/materials/DefaultMaterial.js\";class le extends D{constructor(e,t,s,r){super(e,t,s,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=s.physicalBasedRenderingEnabled}getCachedSize(){const[e,s,r]=t(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:s,height:r}}async doLoad(e){if(!this._drivenProperties.size){if(A(this.symbolLayer))throw new Error}const t=this.symbolLayer;if(this.isPrimitive){const s=t.resource?t.resource.primitive:T;this._resources=await this._createResourcesForPrimitive(s,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return t(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return s(this._resources,\"lodRenderer\")}setMaterialTransparencyParams(e,t=s(this.symbolLayer,\"material\",\"color\")){const r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?0:2,e}async _createResourcesForPrimitive(s,i){if(!K(s))throw new Error(`Unknown object symbol primitive: ${s}`);const a=this.symbolLayer,n=E(B(s)),l=g(U(n)),c=g(G(l,a)),h=p(c),d=!1,m=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:[\"transformation\"],ambient:b,diffuse:b,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},y=u.usePBR;this.setMaterialTransparencyParams(u);const f=this.symbol;if(\"point-3d\"===f.type&&f.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:s}=f.verticalOffset;u.verticalOffset={screenLength:o(e),minWorldLength:t||0,maxWorldLength:null!=s?s:1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=R;else{const s=t(a.material)&&a.material.color,r=t(s)?e.toUnitRGBA(s):R;u.externalColor=r}this._fastUpdates=X(this._context.renderer,this._fastVisualVariableConvertOptions(n,c,l,r)),this._fastUpdates.enabled?(Object.assign(u,this._fastUpdates.materialParameters),u.instanced.push(\"featureAttribute\"),this._optionalFields.push(\"featureAttribute\")):this._hasPerInstanceColor()&&(u.instanced.push(\"color\"),this._optionalFields.push(\"color\"));const _=new ne(u),P=N(s,_);if(!P)throw new Error(`Unknown object symbol primitive: ${s}`);const v=re(P).map((e=>({opacity:1,transparent:e.params.transparent}))),x=this._createStageResources(P,y);return{lodResources:P,lodRenderer:await this._createLodRenderer(P,i),stageResources:x,symbolSize:c,extentPadding:h,isEsriSymbolResource:d,isWosr:m,originalMaterialParameters:v,physicalBasedRenderingEnabled:y,resourceBoundingBox:n,resourceSize:l,dispose:r,pivotOffset:r}}async _createResourcesForUrl(e,t){const i=[\"transformation\"],a={materialParamsMixin:{instanced:i,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=X(this._context.renderer,this._fastVisualVariableConvertOptions(r,r,r,r)),this._fastUpdates.enabled?(Object.assign(a.materialParamsMixin,this._fastUpdates.materialParameters),i.push(\"featureAttribute\"),this._optionalFields.push(\"featureAttribute\")):this._hasPerInstanceColor()&&(i.push(\"color\"),this._optionalFields.push(\"color\"));const n=this.symbol;if(\"point-3d\"===n.type&&n.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:s}=n.verticalOffset;a.materialParamsMixin.verticalOffset={screenLength:o(e),minWorldLength:t||0,maxWorldLength:null!=s?s:1/0},a.materialParamsMixin.castShadows=!1}a.signal=t,a.usePBR=this._context.physicalBasedRenderingEnabled;const l=a.usePBR,c=await $(e,a),h=c.isEsriSymbolResource,d=c.isWosr,m=c.remove,u=q(c.lods);H(u),u.levels.sort(((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius)),u.levels[0].minScreenSpaceRadius=Math.min(2,u.levels[0].minScreenSpaceRadius);const y=this._context,f=this.symbolLayer.material,_=this._getExternalColorParameters(f),b=s(this.symbolLayer,\"material\",\"color\"),P=this._getCombinedOpacity(b,{hasIntrinsicColor:!0}),v=this.needsDrivenTransparentPass,x=re(u),R=re(u).map((e=>({opacity:e.params.opacity||1,transparent:e.params.transparent})));x.forEach((e=>{const t=e.params;e.setParameterValues(_);const s=t.opacity*P,r=s<1||v||t.transparent;e.setParameterValues({opacity:s,transparent:r}),y.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:y.sharedResources.screenSizePerspectiveSettings})}));const L=c.referenceBoundingBox,S=g(U(L)),C=g(u.levels[0].pivotOffset),E=g(G(S,this.symbolLayer)),w=p(E);Y(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(L,E,S,C))&&x.forEach((e=>e.setParameterValues(this._fastUpdates.materialParameters)));const j=this._createStageResources(u,l);return{lodResources:u,lodRenderer:await this._createLodRenderer(u,t),stageResources:j,symbolSize:E,extentPadding:w,isEsriSymbolResource:h,isWosr:d,originalMaterialParameters:R,physicalBasedRenderingEnabled:l,resourceBoundingBox:L,resourceSize:S,dispose:m,pivotOffset:C}}_createStageResources(e,t){const s=this._context.stage,r=re(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(r);const i=ie(e);s.addMany(i);const a=ae(e);return s.addMany(a),{materials:r,textures:i,geometries:a}}async _createLodRenderer(e,t){const s=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},i=this._fastUpdates.enabled?{applyTransform:(e,t,s)=>{e.getFeatureAttribute(t,pe),n(s,ee(this._fastUpdates.materialParameters,pe,s))},scaleFactor:(e,t,s)=>(t.getFeatureAttribute(s,pe),te(e,this._fastUpdates.materialParameters,pe))}:null,a=new se(e,this._optionalFields,r,i);return a.slicePlane=this._context.slicePlaneEnabled,await s.addRenderPlugin(a.slots,a,t),a}_getExternalColorParameters(s){const r={};return this._drivenProperties.color?r.externalColor=R:t(s)&&t(s.color)?r.externalColor=e.toUnitRGBA(s.color):(r.externalColor=R,r.colorMixMode=\"ignore\"),r}destroy(){super.destroy();const e=this._context.stage;if(t(this._resources)){e.removeRenderPlugin(this._resources.lodRenderer);const s=this._resources.stageResources;e.removeMany(s.materials),e.removeMany(s.textures),e.removeMany(s.geometries),t(this._resources.dispose)&&this._resources.dispose()}this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const s=Z(t.geometry);if(i(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const r=this.setGraphicElevationContext(t,new I),a=e.renderingInfo;return this._createAs3DShape(t,s,a,r,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(i(this._resources))return!0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,r=this._resources.stageResources.materials,a=this._resources.originalMaterialParameters;for(let i=0;i<r.length;i++){const o=r[i],n=s(this.symbolLayer,\"material\",\"color\"),l=a[i],c=this._getCombinedOpacity(n,{hasIntrinsicColor:t})*l.opacity,h=c<1||e||l.transparent;o.setParameterValues({opacity:c,transparent:h}),this.isPrimitive&&o.setParameterValues({cullFace:h?0:2})}return!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,V)}slicePlaneEnabledChanged(){if(i(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(i(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const s of e.materials)this.isPrimitive?s.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||s.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(e,t){if(i(this._resources))return!0;const{stageResources:{materials:s},lodRenderer:r,resourceBoundingBox:a,symbolSize:o,resourceSize:n,pivotOffset:l}=this._resources;for(const i in e.diff)switch(i){case\"visualVariables\":if(!Y(this._fastUpdates,t,this._fastVisualVariableConvertOptions(a,o,n,l)))return!1;for(const e of s)e.setParameterValues(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged();break;default:return!1}return!0}computeComplexity(){if(i(this._resources))return super.computeComplexity();return{primitivesPerFeature:oe(this._resources.lodResources.levels[0]).reduce(((e,t)=>e+t.indices.get(\"position\").length),0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Q(this.symbol,this.symbolLayer)}}hasLodRenderer(){return t(this._resources)}_createAs3DShape(e,s,r,a,o){if(!this.hasLodRenderer()||i(this._resources))return null;const n=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?F(r.color,r.opacity):null,c=this._context.clippingExtent;if(S(s,ce,this._context.elevationProvider.spatialReference),t(c)&&!w(c,ce))return null;const h=this._requiresTerrainElevation(a),d=this._computeGlobalTransform(s,a,de,h?me:null),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,he),m=this._resources.lodRenderer.instanceData,u=m.addInstance();this._instanceIndexToGraphicUid.set(u,o),m.setLocalTransform(u,p,!1),m.setGlobalTransform(u,d),n&&m.setFeatureAttribute(u,n),l&&m.setColor(u,l);const y=new M(this,u,O,a);return h&&(y.alignedSampledElevation=me.sampledElevation),y.needsElevationUpdates=V(a.mode),J(y,s,this._context.elevationProvider),y}_computeGlobalTransform(e,t,s,r){const i=z(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r);return ce[0]=e.x,ce[1]=e.y,ce[2]=i,C(e.spatialReference,ce,s,this._context.renderCoordsHelper.spatialReference),s}_computeLocalTransform(e,t,s,r){return l(r),this._applyObjectRotation(s,!1,r),this._applyObjectRotation(t,!0,r),this._applyObjectScale(e,s,r),this._applyAnchor(e,t,r),r}_applyObjectScale(e,t,s){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,i=k(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===i[0]&&1===i[1]&&1===i[2]||c(s,s,i)}prepareSymbolLayerPatch(e){if(\"partial\"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(i(this._resources))return!0;const s=t&&Z(t);if(i(s))return!1;const r=this.getGeometryElevationMode(t);if(e.elevationContext.mode!==r)return!1;const a=this._requiresTerrainElevation(e.elevationContext);return this._computeGlobalTransform(s,e.elevationContext,de,a?me:null),a&&(e.alignedSampledElevation=me.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,de,!0),J(e,s,this._context.elevationProvider),!0}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(i(this._resources))return;const s=(e,t,s)=>a(null!=e&&\"complete\"===e.type?e.newValue:t,s),r=s(t.heading,this.symbolLayer.heading,0),o=s(t.tilt,this.symbolLayer.tilt,0),n=s(t.roll,this.symbolLayer.roll,0),l=s(t.width,this.symbolLayer.width,void 0),c=s(t.height,this.symbolLayer.height,void 0),h=s(t.depth,this.symbolLayer.depth,void 0),d=s(t.anchor,this.symbolLayer.anchor,void 0),p=s(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const m={heading:r,tilt:o,roll:n,anchor:d,anchorPosition:p},u=this._resources;1===this.loadStatus&&e.symbolLayerStatePatches.push((()=>{u.symbolSize=g(G(u.resourceSize,{width:l,height:c,depth:h,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push(((e,t)=>{const s=this._computeLocalTransform(u,m,t,he),r=e.instanceIndex;u.lodRenderer.instanceData.setLocalTransform(r,s,!0)}))}_preparePatchColor(s,r){if(!r.material||\"partial\"!==r.material.type)return;const a=r.material.diff;if(!a.color||\"complete\"!==a.color.type||null==a.color.newValue||null==a.color.oldValue)return;const o=a.color.newValue,n=t(o)?e.toUnitRGBA(o):R;delete a.color;const l=this._resources;i(l)||s.graphics3DGraphicPatches.push((e=>{let t;this._hasPerInstanceColor()?(l.lodRenderer.instanceData.setColor(e.instanceIndex,n),t=this.setMaterialTransparencyParams({},o)):t=this.setMaterialTransparencyParams({externalColor:n},o);for(const s of l.stageResources.materials)s.setParameterValues(t)}))}_requiresTerrainElevation(e){return\"absolute-height\"!==e.mode}_applyObjectRotation(e,t,s){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return W(e.heading,e.tilt,e.roll,s)}_computeAnchor(e,s,r){const i=x();switch(r.anchor){case\"center\":u(i,j(e)),m(i,i);break;case\"top\":{const t=j(e);_(i,-t[0],-t[1],-e[5]);break}case\"bottom\":{const t=j(e);_(i,-t[0],-t[1],-e[2]);break}case\"relative\":{const t=j(e),s=U(e),a=r.anchorPosition,o=a?v(a.x,a.y,a.z):P;y(i,s,o),f(i,i,t),m(i,i);break}case\"origin\":default:t(s)?m(i,s):u(i,P)}return i}_applyAnchor(e,t,s){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);r&&h(s,s,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,s,r,i){const a=t(e)?g(U(e)):b,o=t(e)?this._computeAnchor(e,i,this.symbolLayer):P,n=this._context.renderCoordsHelper.unitInMeters,l=k(t(s)?s:void 0,s,r,n),c=v(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:t(s)?s:b,unitInMeters:n,transformation:{anchor:o,scale:l,rotation:c}}}}const ce=x(),he=d(),de=d(),pe=L(),me={verticalDistanceToGround:0,sampledElevation:0};export default le;export{le as Graphics3DObjectSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}