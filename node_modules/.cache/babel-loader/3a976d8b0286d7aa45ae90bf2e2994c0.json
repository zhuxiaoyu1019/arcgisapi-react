{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"./config.js\";\nimport { id as t } from \"./kernel.js\";\nimport r from \"./core/Error.js\";\nimport s from \"./core/global.js\";\nimport o from \"./core/has.js\";\nimport { clone as n } from \"./core/lang.js\";\nimport { unwrap as a } from \"./core/maybe.js\";\nimport { createAbortController as i, onAbort as l, isAbortError as u, createAbortError as c, isAborted as d } from \"./core/promiseUtils.js\";\nimport { isDataProtocol as p, isBlobProtocol as m, normalize as f, getInterceptor as h, isTrustedServer as y, getOrigin as w, toHTTPS as g, addQueryParameter as b, objectToQuery as q, getProxyRule as k, getProxyUrl as T, addQueryParameters as O, hasSameOrigin as S, appUrl as x, addProxyRule as v } from \"./core/urlUtils.js\";\nimport { supportsApiKey as C } from \"./support/apiKeyUtils.js\";\nimport { loadImageAsync as E } from \"./support/requestUtils.js\";\n\nasync function L(e, t) {\n  const r = p(e),\n        s = m(e);\n  s || r || (e = f(e));\n  const n = {\n    url: e,\n    requestOptions: { ...a(t)\n    }\n  };\n  let u = h(e);\n\n  if (u) {\n    const e = await G(u, n);\n    if (null != e) return {\n      data: e,\n      getHeader: I,\n      requestOptions: n.requestOptions,\n      url: n.url\n    };\n    u.after || u.error || (u = null);\n  }\n\n  if (e = n.url, \"image\" === (t = n.requestOptions).responseType) {\n    if (o(\"host-webworker\") || o(\"host-node\")) throw B(\"request:invalid-parameters\", new Error(\"responseType 'image' is not supported in Web Workers or Node environment\"), n);\n  } else if (r) throw B(\"request:invalid-parameters\", new Error(\"Data URLs are not supported for responseType = \" + t.responseType), n);\n\n  if (\"head\" === t.method) {\n    if (t.body) throw B(\"request:invalid-parameters\", new Error(\"body parameter cannot be set when method is 'head'\"), n);\n    if (r || s) throw B(\"request:invalid-parameters\", new Error(\"data and blob URLs are not supported for method 'head'\"), n);\n  }\n\n  if (await N(), j) return j.execute(e, t);\n  const c = i();\n  l(t, () => c.abort());\n  const d = {\n    controller: c,\n    credential: null,\n    credentialToken: null,\n    fetchOptions: null,\n    hasToken: !1,\n    interceptor: u,\n    params: n,\n    redoRequest: !1,\n    useIdentity: U.useIdentity,\n    useProxy: !1,\n    useSSL: !1,\n    withCredentials: !1\n  },\n        y = await X(d);\n  return u && u.after && u.after(y), y;\n}\n\nlet j;\n\nconst U = e.request,\n      P = (\"FormData\" in s),\n      D = [499, 498, 403, 401],\n      _ = [\"COM_0056\", \"COM_0057\", \"SB_0008\"],\n      F = [/\\/arcgis\\/tokens/i, /\\/sharing(\\/rest)?\\/generatetoken/i, /\\/rest\\/info/i],\n      I = () => null,\n      M = Symbol();\n\nfunction R(e) {\n  const t = w(e);\n  t && !L._corsServers.includes(t) && L._corsServers.push(t);\n}\n\nfunction H(e) {\n  const t = w(e);\n  return !t || t.endsWith(\".arcgis.com\") || L._corsServers.includes(t) || y(t);\n}\n\nfunction B(e, t, s, o) {\n  let a = \"Error\";\n  const i = {\n    url: s.url,\n    requestOptions: s.requestOptions,\n    getHeader: I,\n    ssl: !1\n  };\n  if (t instanceof r) return t.details ? (t.details = n(t.details), t.details.url = s.url, t.details.requestOptions = s.requestOptions) : t.details = i, t;\n\n  if (t) {\n    const e = o && (e => o.headers.get(e)),\n          r = o && o.status,\n          s = t.message;\n\n    s && (a = s), e && (i.getHeader = e), i.httpStatus = (null != t.httpCode ? t.httpCode : t.code) || r || 0, i.subCode = t.subcode, i.messageCode = t.messageCode, \"string\" == typeof t.details ? i.messages = [t.details] : i.messages = t.details, i.raw = M in t ? t[M] : t;\n  }\n\n  return u(t) ? c() : new r(e, a, i);\n}\n\nasync function N() {\n  o(\"host-webworker\") ? j || (j = await import(\"./core/workers/request.js\")) : L._abortableFetch || (L._abortableFetch = s.fetch.bind(s));\n}\n\nasync function A() {\n  t || (await import(\"./identity/IdentityManager.js\"));\n}\n\nasync function $(r) {\n  const o = r.params.url,\n        n = r.params.requestOptions,\n        a = r.controller.signal,\n        i = n.body;\n  let l = null,\n      u = null,\n      c = null;\n\n  if (P && \"HTMLFormElement\" in s && (i instanceof FormData ? l = i : i instanceof HTMLFormElement && (u = i, l = new FormData(u))), \"string\" == typeof i && (c = i), r.fetchOptions = {\n    cache: n.cacheBust && !L._abortableFetch.polyfill ? \"no-cache\" : \"default\",\n    credentials: \"same-origin\",\n    headers: n.headers || {},\n    method: \"head\" === n.method ? \"HEAD\" : \"GET\",\n    mode: \"cors\",\n    redirect: \"follow\",\n    signal: a\n  }, (l || c) && (r.fetchOptions.body = l || c), \"anonymous\" === n.authMode && (r.useIdentity = !1), r.hasToken = !!(/token=/i.test(o) || n.query && n.query.token || l && l.get && l.get(\"token\") || u && u.elements.token), !r.hasToken && e.apiKey && C(o) && (n.query || (n.query = {}), n.query.token = e.apiKey, r.hasToken = !0), r.useIdentity && !r.hasToken && !r.credentialToken && !K(o) && !d(a)) {\n    let e;\n    \"immediate\" === n.authMode ? (await A(), e = await t.getCredential(o, {\n      signal: a\n    }), r.credential = e) : \"no-prompt\" === n.authMode ? (await A(), e = await t.getCredential(o, {\n      prompt: !1,\n      signal: a\n    }).catch(() => {}), r.credential = e) : t && (e = t.findCredential(o)), e && (r.credentialToken = e.token, r.useSSL = !!e.ssl);\n  }\n}\n\nfunction K(e) {\n  return F.some(t => t.test(e));\n}\n\nasync function W(e) {\n  let r = e.params.url;\n  const s = e.params.requestOptions,\n        n = e.fetchOptions,\n        a = m(r) || p(r),\n        i = s.responseType || \"json\",\n        l = a ? 0 : null != s.timeout ? s.timeout : U.timeout;\n  let u = !1;\n\n  if (!a) {\n    e.useSSL && (r = g(r)), s.cacheBust && \"default\" === n.cache && (r = b(r, \"request.preventCache\", Date.now()));\n    let a = { ...s.query\n    };\n    e.credentialToken && (a.token = e.credentialToken);\n    let i = q(a);\n    o(\"esri-url-encodes-apostrophe\") && (i = i.replace(/'/g, \"%27\"));\n    const l = r.length + 1 + i.length;\n    let c;\n    u = \"delete\" === s.method || \"post\" === s.method || \"put\" === s.method || !!s.body || l > U.maxUrlLength;\n    const d = s.useProxy || !!k(r);\n\n    if (d) {\n      const e = T(r);\n      c = e.path, !u && c.length + 1 + l > U.maxUrlLength && (u = !0), e.query && (a = { ...e.query,\n        ...a\n      });\n    }\n\n    if (\"HEAD\" === n.method && (u || d)) {\n      if (u) {\n        if (l > U.maxUrlLength) throw B(\"request:invalid-parameters\", new Error(\"URL exceeds maximum length\"), e.params);\n        throw B(\"request:invalid-parameters\", new Error(\"cannot use POST request when method is 'head'\"), e.params);\n      }\n\n      if (d) throw B(\"request:invalid-parameters\", new Error(\"cannot use proxy when method is 'head'\"), e.params);\n    }\n\n    if (u ? (n.method = \"delete\" === s.method ? \"DELETE\" : \"put\" === s.method ? \"PUT\" : \"POST\", s.body ? r = O(r, a) : (n.body = q(a), n.headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\")) : r = O(r, a), d && (e.useProxy = !0, r = `${c}?${r}`), a.token && P && n.body instanceof FormData) {\n      const e = n.body;\n      e.set ? e.set(\"token\", a.token) : e.append(\"token\", a.token);\n    }\n\n    if (s.hasOwnProperty(\"withCredentials\")) e.withCredentials = s.withCredentials;else if (!S(r, x)) if (y(r)) e.withCredentials = !0;else if (t) {\n      const s = t.findServerInfo(r);\n      s && s.webTierAuth && (e.withCredentials = !0);\n    }\n    e.withCredentials && (n.credentials = \"include\");\n  }\n\n  let d,\n      f,\n      h = 0,\n      C = !1;\n  l > 0 && (h = setTimeout(() => {\n    C = !0, e.controller.abort();\n  }, l));\n\n  try {\n    if (\"native-request-init\" === s.responseType) f = n, f.url = r;else if (\"image\" !== s.responseType || \"default\" !== n.cache || \"GET\" !== n.method || u || z(s.headers) || !a && !e.useProxy && U.proxyUrl && !H(r)) {\n      if (d = await L._abortableFetch(r, n), e.useProxy || R(r), \"native\" === s.responseType) f = d;else if (\"HEAD\" !== n.method) if (d.ok) {\n        switch (i) {\n          case \"array-buffer\":\n            f = await d.arrayBuffer();\n            break;\n\n          case \"blob\":\n          case \"image\":\n            f = await d.blob();\n            break;\n\n          default:\n            f = await d.text();\n        }\n\n        if (h && (clearTimeout(h), h = 0), \"json\" === i || \"xml\" === i || \"document\" === i) if (f) switch (i) {\n          case \"json\":\n            f = JSON.parse(f);\n            break;\n\n          case \"xml\":\n            f = J(f, \"application/xml\");\n            break;\n\n          case \"document\":\n            f = J(f, \"text/html\");\n        } else f = null;\n\n        if (f) {\n          if (\"array-buffer\" === i || \"blob\" === i) {\n            const e = d.headers.get(\"Content-Type\");\n            if (/application\\/json|text\\/plain/i.test(e) && f[\"blob\" === i ? \"size\" : \"byteLength\"] <= 750) try {\n              const e = await new Response(f).json();\n              e.error && (f = e);\n            } catch {}\n          }\n\n          \"image\" === i && f instanceof Blob && (f = await V(URL.createObjectURL(f), e, !0));\n        }\n      } else f = await d.text();\n    } else f = await V(r, e);\n  } catch (E) {\n    if (\"AbortError\" === E.name) {\n      if (C) throw new Error(\"Timeout exceeded\");\n      throw c(\"Request canceled\");\n    }\n\n    if (!(!d && E instanceof TypeError && U.proxyUrl) || s.body || \"delete\" === s.method || \"head\" === s.method || \"post\" === s.method || \"put\" === s.method || e.useProxy || H(r)) throw E;\n    e.redoRequest = !0, v({\n      proxyUrl: U.proxyUrl,\n      urlPrefix: w(r)\n    });\n  } finally {\n    h && clearTimeout(h);\n  }\n\n  return [d, f];\n}\n\nasync function G(e, t) {\n  if (null != e.responseData) return e.responseData;\n\n  if (e.headers && (t.requestOptions.headers = { ...t.requestOptions.headers,\n    ...e.headers\n  }), e.query && (t.requestOptions.query = { ...t.requestOptions.query,\n    ...e.query\n  }), e.before) {\n    let o, n;\n\n    try {\n      n = await e.before(t);\n    } catch (s) {\n      o = B(\"request:interceptor\", s, t);\n    }\n\n    if ((n instanceof Error || n instanceof r) && (o = B(\"request:interceptor\", n, t)), o) throw e.error && e.error(o), o;\n    return n;\n  }\n}\n\nfunction z(e) {\n  if (e) for (const t of Object.getOwnPropertyNames(e)) if (e[t]) return !0;\n  return !1;\n}\n\nfunction J(e, t) {\n  let r;\n\n  try {\n    r = new DOMParser().parseFromString(e, t);\n  } catch {}\n\n  if (!r || r.getElementsByTagName(\"parsererror\").length) throw new SyntaxError(\"XML Parse error\");\n  return r;\n}\n\nasync function X(e) {\n  var r, s;\n  let o, n;\n  await $(e);\n\n  try {\n    do {\n      [o, n] = await W(e);\n    } while (!(await Q(e, o, n)));\n  } catch (l) {\n    const t = B(\"request:server\", l, e.params, o);\n    throw t.details.ssl = e.useSSL, e.interceptor && e.interceptor.error && e.interceptor.error(t), t;\n  }\n\n  const a = e.params.url;\n\n  if (/\\/sharing\\/rest\\/(accounts|portals)\\/self/i.test(a) && !e.hasToken && !e.credentialToken && null != (r = n) && null != (s = r.user) && s.username && !y(a)) {\n    const e = w(a, !0);\n    e && U.trustedServers.push(e);\n  }\n\n  const i = e.credential;\n\n  if (i && t) {\n    const e = t.findServerInfo(i.server);\n    let r = e && e.owningSystemUrl;\n\n    if (r) {\n      r = r.replace(/\\/?$/, \"/sharing\");\n      const e = t.findCredential(r, i.userId);\n      e && -1 === t._getIdenticalSvcIdx(r, e) && e.resources.unshift(r);\n    }\n  }\n\n  return {\n    data: n,\n    getHeader: o ? e => o.headers.get(e) : I,\n    requestOptions: e.params.requestOptions,\n    ssl: e.useSSL,\n    url: e.params.url\n  };\n}\n\nasync function Q(e, r, s) {\n  if (e.redoRequest) return e.redoRequest = !1, !1;\n  const o = e.params.requestOptions;\n  if (!r || \"native\" === o.responseType || \"native-request-init\" === o.responseType) return !0;\n  let n, a, i, l;\n  if (!r.ok) throw n = new Error(`Unable to load ${r.url} status: ${r.status}`), n[M] = s, n;\n  null != s && s.error && (n = s.error), n && (a = Number(n.code), i = n.hasOwnProperty(\"subcode\") ? Number(n.subcode) : null, l = n.messageCode, l = l && l.toUpperCase());\n  const u = o.authMode;\n\n  if (403 === a && (4 === i || n.message && n.message.toLowerCase().indexOf(\"ssl\") > -1 && -1 === n.message.toLowerCase().indexOf(\"permission\"))) {\n    if (!e.useSSL) return e.useSSL = !0, !1;\n  } else if (!e.hasToken && e.useIdentity && (\"no-prompt\" !== u || 498 === a) && -1 !== D.indexOf(a) && !K(e.params.url) && (403 !== a || -1 === _.indexOf(l) && (null == i || 2 === i && e.credentialToken))) {\n    await A();\n\n    try {\n      const r = await t.getCredential(e.params.url, {\n        error: B(\"request:server\", n, e.params),\n        prompt: \"no-prompt\" !== u,\n        signal: e.controller.signal,\n        token: e.credentialToken\n      });\n      return e.credential = r, e.credentialToken = r.token, e.useSSL = e.useSSL || r.ssl, !1;\n    } catch (c) {\n      if (\"no-prompt\" === u) return e.credential = null, e.credentialToken = null, !1;\n      n = c;\n    }\n  }\n\n  if (n) throw n;\n  return !0;\n}\n\nfunction V(e, t, r = !1) {\n  const s = t.controller.signal,\n        o = new Image();\n  return t.withCredentials ? o.crossOrigin = \"use-credentials\" : o.crossOrigin = \"anonymous\", o.alt = \"\", o.src = e, E(o, e, r, s);\n}\n\nL._abortableFetch = null, L._corsServers = [\"https://server.arcgisonline.com\", \"https://services.arcgisonline.com\"];\nexport default L;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/request.js"],"names":["e","id","t","r","s","o","clone","n","unwrap","a","createAbortController","i","onAbort","l","isAbortError","u","createAbortError","c","isAborted","d","isDataProtocol","p","isBlobProtocol","m","normalize","f","getInterceptor","h","isTrustedServer","y","getOrigin","w","toHTTPS","g","addQueryParameter","b","objectToQuery","q","getProxyRule","k","getProxyUrl","T","addQueryParameters","O","hasSameOrigin","S","appUrl","x","addProxyRule","v","supportsApiKey","C","loadImageAsync","E","L","url","requestOptions","G","data","getHeader","I","after","error","responseType","B","Error","method","body","N","j","execute","abort","controller","credential","credentialToken","fetchOptions","hasToken","interceptor","params","redoRequest","useIdentity","U","useProxy","useSSL","withCredentials","X","request","P","D","_","F","M","Symbol","R","_corsServers","includes","push","H","endsWith","ssl","details","headers","get","status","message","httpStatus","httpCode","code","subCode","subcode","messageCode","messages","raw","_abortableFetch","fetch","bind","A","$","signal","FormData","HTMLFormElement","cache","cacheBust","polyfill","credentials","mode","redirect","authMode","test","query","token","elements","apiKey","K","getCredential","prompt","catch","findCredential","some","W","timeout","Date","now","replace","length","maxUrlLength","path","set","append","hasOwnProperty","findServerInfo","webTierAuth","setTimeout","z","proxyUrl","ok","arrayBuffer","blob","text","clearTimeout","JSON","parse","J","Response","json","Blob","V","URL","createObjectURL","name","TypeError","urlPrefix","responseData","before","Object","getOwnPropertyNames","DOMParser","parseFromString","getElementsByTagName","SyntaxError","Q","user","username","trustedServers","server","owningSystemUrl","userId","_getIdenticalSvcIdx","resources","unshift","Number","toUpperCase","toLowerCase","indexOf","Image","crossOrigin","alt","src"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./config.js\";import{id as t}from\"./kernel.js\";import r from\"./core/Error.js\";import s from\"./core/global.js\";import o from\"./core/has.js\";import{clone as n}from\"./core/lang.js\";import{unwrap as a}from\"./core/maybe.js\";import{createAbortController as i,onAbort as l,isAbortError as u,createAbortError as c,isAborted as d}from\"./core/promiseUtils.js\";import{isDataProtocol as p,isBlobProtocol as m,normalize as f,getInterceptor as h,isTrustedServer as y,getOrigin as w,toHTTPS as g,addQueryParameter as b,objectToQuery as q,getProxyRule as k,getProxyUrl as T,addQueryParameters as O,hasSameOrigin as S,appUrl as x,addProxyRule as v}from\"./core/urlUtils.js\";import{supportsApiKey as C}from\"./support/apiKeyUtils.js\";import{loadImageAsync as E}from\"./support/requestUtils.js\";async function L(e,t){const r=p(e),s=m(e);s||r||(e=f(e));const n={url:e,requestOptions:{...a(t)}};let u=h(e);if(u){const e=await G(u,n);if(null!=e)return{data:e,getHeader:I,requestOptions:n.requestOptions,url:n.url};u.after||u.error||(u=null)}if(e=n.url,\"image\"===(t=n.requestOptions).responseType){if(o(\"host-webworker\")||o(\"host-node\"))throw B(\"request:invalid-parameters\",new Error(\"responseType 'image' is not supported in Web Workers or Node environment\"),n)}else if(r)throw B(\"request:invalid-parameters\",new Error(\"Data URLs are not supported for responseType = \"+t.responseType),n);if(\"head\"===t.method){if(t.body)throw B(\"request:invalid-parameters\",new Error(\"body parameter cannot be set when method is 'head'\"),n);if(r||s)throw B(\"request:invalid-parameters\",new Error(\"data and blob URLs are not supported for method 'head'\"),n)}if(await N(),j)return j.execute(e,t);const c=i();l(t,(()=>c.abort()));const d={controller:c,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:u,params:n,redoRequest:!1,useIdentity:U.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},y=await X(d);return u&&u.after&&u.after(y),y}let j;const U=e.request,P=\"FormData\"in s,D=[499,498,403,401],_=[\"COM_0056\",\"COM_0057\",\"SB_0008\"],F=[/\\/arcgis\\/tokens/i,/\\/sharing(\\/rest)?\\/generatetoken/i,/\\/rest\\/info/i],I=()=>null,M=Symbol();function R(e){const t=w(e);t&&!L._corsServers.includes(t)&&L._corsServers.push(t)}function H(e){const t=w(e);return!t||t.endsWith(\".arcgis.com\")||L._corsServers.includes(t)||y(t)}function B(e,t,s,o){let a=\"Error\";const i={url:s.url,requestOptions:s.requestOptions,getHeader:I,ssl:!1};if(t instanceof r)return t.details?(t.details=n(t.details),t.details.url=s.url,t.details.requestOptions=s.requestOptions):t.details=i,t;if(t){const e=o&&(e=>o.headers.get(e)),r=o&&o.status,s=t.message;s&&(a=s),e&&(i.getHeader=e),i.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||r||0,i.subCode=t.subcode,i.messageCode=t.messageCode,\"string\"==typeof t.details?i.messages=[t.details]:i.messages=t.details,i.raw=M in t?t[M]:t}return u(t)?c():new r(e,a,i)}async function N(){o(\"host-webworker\")?j||(j=await import(\"./core/workers/request.js\")):L._abortableFetch||(L._abortableFetch=s.fetch.bind(s))}async function A(){t||await import(\"./identity/IdentityManager.js\")}async function $(r){const o=r.params.url,n=r.params.requestOptions,a=r.controller.signal,i=n.body;let l=null,u=null,c=null;if(P&&\"HTMLFormElement\"in s&&(i instanceof FormData?l=i:i instanceof HTMLFormElement&&(u=i,l=new FormData(u))),\"string\"==typeof i&&(c=i),r.fetchOptions={cache:n.cacheBust&&!L._abortableFetch.polyfill?\"no-cache\":\"default\",credentials:\"same-origin\",headers:n.headers||{},method:\"head\"===n.method?\"HEAD\":\"GET\",mode:\"cors\",redirect:\"follow\",signal:a},(l||c)&&(r.fetchOptions.body=l||c),\"anonymous\"===n.authMode&&(r.useIdentity=!1),r.hasToken=!!(/token=/i.test(o)||n.query&&n.query.token||l&&l.get&&l.get(\"token\")||u&&u.elements.token),!r.hasToken&&e.apiKey&&C(o)&&(n.query||(n.query={}),n.query.token=e.apiKey,r.hasToken=!0),r.useIdentity&&!r.hasToken&&!r.credentialToken&&!K(o)&&!d(a)){let e;\"immediate\"===n.authMode?(await A(),e=await t.getCredential(o,{signal:a}),r.credential=e):\"no-prompt\"===n.authMode?(await A(),e=await t.getCredential(o,{prompt:!1,signal:a}).catch((()=>{})),r.credential=e):t&&(e=t.findCredential(o)),e&&(r.credentialToken=e.token,r.useSSL=!!e.ssl)}}function K(e){return F.some((t=>t.test(e)))}async function W(e){let r=e.params.url;const s=e.params.requestOptions,n=e.fetchOptions,a=m(r)||p(r),i=s.responseType||\"json\",l=a?0:null!=s.timeout?s.timeout:U.timeout;let u=!1;if(!a){e.useSSL&&(r=g(r)),s.cacheBust&&\"default\"===n.cache&&(r=b(r,\"request.preventCache\",Date.now()));let a={...s.query};e.credentialToken&&(a.token=e.credentialToken);let i=q(a);o(\"esri-url-encodes-apostrophe\")&&(i=i.replace(/'/g,\"%27\"));const l=r.length+1+i.length;let c;u=\"delete\"===s.method||\"post\"===s.method||\"put\"===s.method||!!s.body||l>U.maxUrlLength;const d=s.useProxy||!!k(r);if(d){const e=T(r);c=e.path,!u&&c.length+1+l>U.maxUrlLength&&(u=!0),e.query&&(a={...e.query,...a})}if(\"HEAD\"===n.method&&(u||d)){if(u){if(l>U.maxUrlLength)throw B(\"request:invalid-parameters\",new Error(\"URL exceeds maximum length\"),e.params);throw B(\"request:invalid-parameters\",new Error(\"cannot use POST request when method is 'head'\"),e.params)}if(d)throw B(\"request:invalid-parameters\",new Error(\"cannot use proxy when method is 'head'\"),e.params)}if(u?(n.method=\"delete\"===s.method?\"DELETE\":\"put\"===s.method?\"PUT\":\"POST\",s.body?r=O(r,a):(n.body=q(a),n.headers[\"Content-Type\"]=\"application/x-www-form-urlencoded\")):r=O(r,a),d&&(e.useProxy=!0,r=`${c}?${r}`),a.token&&P&&n.body instanceof FormData){const e=n.body;e.set?e.set(\"token\",a.token):e.append(\"token\",a.token)}if(s.hasOwnProperty(\"withCredentials\"))e.withCredentials=s.withCredentials;else if(!S(r,x))if(y(r))e.withCredentials=!0;else if(t){const s=t.findServerInfo(r);s&&s.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(n.credentials=\"include\")}let d,f,h=0,C=!1;l>0&&(h=setTimeout((()=>{C=!0,e.controller.abort()}),l));try{if(\"native-request-init\"===s.responseType)f=n,f.url=r;else if(\"image\"!==s.responseType||\"default\"!==n.cache||\"GET\"!==n.method||u||z(s.headers)||!a&&!e.useProxy&&U.proxyUrl&&!H(r)){if(d=await L._abortableFetch(r,n),e.useProxy||R(r),\"native\"===s.responseType)f=d;else if(\"HEAD\"!==n.method)if(d.ok){switch(i){case\"array-buffer\":f=await d.arrayBuffer();break;case\"blob\":case\"image\":f=await d.blob();break;default:f=await d.text()}if(h&&(clearTimeout(h),h=0),\"json\"===i||\"xml\"===i||\"document\"===i)if(f)switch(i){case\"json\":f=JSON.parse(f);break;case\"xml\":f=J(f,\"application/xml\");break;case\"document\":f=J(f,\"text/html\")}else f=null;if(f){if(\"array-buffer\"===i||\"blob\"===i){const e=d.headers.get(\"Content-Type\");if(/application\\/json|text\\/plain/i.test(e)&&f[\"blob\"===i?\"size\":\"byteLength\"]<=750)try{const e=await new Response(f).json();e.error&&(f=e)}catch{}}\"image\"===i&&f instanceof Blob&&(f=await V(URL.createObjectURL(f),e,!0))}}else f=await d.text()}else f=await V(r,e)}catch(E){if(\"AbortError\"===E.name){if(C)throw new Error(\"Timeout exceeded\");throw c(\"Request canceled\")}if(!(!d&&E instanceof TypeError&&U.proxyUrl)||s.body||\"delete\"===s.method||\"head\"===s.method||\"post\"===s.method||\"put\"===s.method||e.useProxy||H(r))throw E;e.redoRequest=!0,v({proxyUrl:U.proxyUrl,urlPrefix:w(r)})}finally{h&&clearTimeout(h)}return[d,f]}async function G(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let o,n;try{n=await e.before(t)}catch(s){o=B(\"request:interceptor\",s,t)}if((n instanceof Error||n instanceof r)&&(o=B(\"request:interceptor\",n,t)),o)throw e.error&&e.error(o),o;return n}}function z(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}function J(e,t){let r;try{r=(new DOMParser).parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName(\"parsererror\").length)throw new SyntaxError(\"XML Parse error\");return r}async function X(e){var r,s;let o,n;await $(e);try{do{[o,n]=await W(e)}while(!await Q(e,o,n))}catch(l){const t=B(\"request:server\",l,e.params,o);throw t.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(t),t}const a=e.params.url;if(/\\/sharing\\/rest\\/(accounts|portals)\\/self/i.test(a)&&!e.hasToken&&!e.credentialToken&&null!=(r=n)&&null!=(s=r.user)&&s.username&&!y(a)){const e=w(a,!0);e&&U.trustedServers.push(e)}const i=e.credential;if(i&&t){const e=t.findServerInfo(i.server);let r=e&&e.owningSystemUrl;if(r){r=r.replace(/\\/?$/,\"/sharing\");const e=t.findCredential(r,i.userId);e&&-1===t._getIdenticalSvcIdx(r,e)&&e.resources.unshift(r)}}return{data:n,getHeader:o?e=>o.headers.get(e):I,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function Q(e,r,s){if(e.redoRequest)return e.redoRequest=!1,!1;const o=e.params.requestOptions;if(!r||\"native\"===o.responseType||\"native-request-init\"===o.responseType)return!0;let n,a,i,l;if(!r.ok)throw n=new Error(`Unable to load ${r.url} status: ${r.status}`),n[M]=s,n;null!=s&&s.error&&(n=s.error),n&&(a=Number(n.code),i=n.hasOwnProperty(\"subcode\")?Number(n.subcode):null,l=n.messageCode,l=l&&l.toUpperCase());const u=o.authMode;if(403===a&&(4===i||n.message&&n.message.toLowerCase().indexOf(\"ssl\")>-1&&-1===n.message.toLowerCase().indexOf(\"permission\"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(\"no-prompt\"!==u||498===a)&&-1!==D.indexOf(a)&&!K(e.params.url)&&(403!==a||-1===_.indexOf(l)&&(null==i||2===i&&e.credentialToken))){await A();try{const r=await t.getCredential(e.params.url,{error:B(\"request:server\",n,e.params),prompt:\"no-prompt\"!==u,signal:e.controller.signal,token:e.credentialToken});return e.credential=r,e.credentialToken=r.token,e.useSSL=e.useSSL||r.ssl,!1}catch(c){if(\"no-prompt\"===u)return e.credential=null,e.credentialToken=null,!1;n=c}}if(n)throw n;return!0}function V(e,t,r=!1){const s=t.controller.signal,o=new Image;return t.withCredentials?o.crossOrigin=\"use-credentials\":o.crossOrigin=\"anonymous\",o.alt=\"\",o.src=e,E(o,e,r,s)}L._abortableFetch=null,L._corsServers=[\"https://server.arcgisonline.com\",\"https://services.arcgisonline.com\"];export default L;\n"]},"metadata":{},"sourceType":"module"}