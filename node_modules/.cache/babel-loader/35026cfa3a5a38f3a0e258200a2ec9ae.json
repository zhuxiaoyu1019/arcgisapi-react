{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { getMetersPerVerticalUnitForSR as e } from \"../../../core/unitUtils.js\";\nimport { equals as t } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport r from \"../../../layers/graphics/OptimizedFeature.js\";\nimport o from \"../../../layers/graphics/OptimizedFeatureSet.js\";\nimport s from \"../../../layers/graphics/OptimizedGeometry.js\";\nconst i = [\"esriGeometryPoint\", \"esriGeometryMultipoint\", \"esriGeometryPolyline\", \"esriGeometryPolygon\"];\n\nclass n {\n  constructor(e) {\n    this.options = e, this.geometryTypes = i, this._coordinatePtr = 0, this._vertexDimension = 0;\n  }\n\n  createFeatureResult() {\n    return new o();\n  }\n\n  prepareFeatures(e) {\n    this._vertexDimension = 2, e.hasZ && this._vertexDimension++, e.hasM && this._vertexDimension++;\n  }\n\n  finishFeatureResult(r) {\n    if (!r || !r.features || !r.hasZ || !this.options.sourceSpatialReference || !r.spatialReference || t(r.spatialReference, this.options.sourceSpatialReference) || r.spatialReference.vcsWkid) return;\n    const o = e(this.options.sourceSpatialReference) / e(r.spatialReference);\n    if (1 !== o) for (const e of r.features) {\n      if (!e.geometry || !e.geometry.coords) continue;\n      const t = e.geometry.coords;\n\n      for (let e = 2; e < t.length; e += 3) t[e] *= o;\n    }\n  }\n\n  addFeature(e, t) {\n    e.features.push(t);\n  }\n\n  createFeature() {\n    return new r();\n  }\n\n  createSpatialReference() {\n    return {\n      wkid: 0\n    };\n  }\n\n  createGeometry() {\n    return new s();\n  }\n\n  addField(e, t) {\n    e.fields.push(t);\n  }\n\n  allocateCoordinates(e) {\n    e.coords.length = e.lengths.reduce((e, t) => e + t, 0) * this._vertexDimension, this._coordinatePtr = 0;\n  }\n\n  addCoordinate(e, t) {\n    e.coords[this._coordinatePtr++] = t;\n  }\n\n  addCoordinatePoint(e, t) {\n    e.coords.push(t);\n  }\n\n  addLength(e, t) {\n    e.lengths.push(t);\n  }\n\n  addQueryGeometry(e, t) {\n    e.queryGeometry = t.queryGeometry, e.queryGeometryType = t.queryGeometryType;\n  }\n\n  createPointGeometry() {\n    return new s();\n  }\n\n}\n\nexport { i as OPTIMIZED_GEOMETRY_TYPES, n as OptimizedFeatureSetParserContext };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/rest/query/operations/pbfOptimizedFeatureSet.js"],"names":["getMetersPerVerticalUnitForSR","e","equals","t","r","o","s","i","n","constructor","options","geometryTypes","_coordinatePtr","_vertexDimension","createFeatureResult","prepareFeatures","hasZ","hasM","finishFeatureResult","features","sourceSpatialReference","spatialReference","vcsWkid","geometry","coords","length","addFeature","push","createFeature","createSpatialReference","wkid","createGeometry","addField","fields","allocateCoordinates","lengths","reduce","addCoordinate","addCoordinatePoint","addLength","addQueryGeometry","queryGeometry","queryGeometryType","createPointGeometry","OPTIMIZED_GEOMETRY_TYPES","OptimizedFeatureSetParserContext"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{getMetersPerVerticalUnitForSR as e}from\"../../../core/unitUtils.js\";import{equals as t}from\"../../../geometry/support/spatialReferenceUtils.js\";import r from\"../../../layers/graphics/OptimizedFeature.js\";import o from\"../../../layers/graphics/OptimizedFeatureSet.js\";import s from\"../../../layers/graphics/OptimizedGeometry.js\";const i=[\"esriGeometryPoint\",\"esriGeometryMultipoint\",\"esriGeometryPolyline\",\"esriGeometryPolygon\"];class n{constructor(e){this.options=e,this.geometryTypes=i,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(r){if(!r||!r.features||!r.hasZ||!this.options.sourceSpatialReference||!r.spatialReference||t(r.spatialReference,this.options.sourceSpatialReference)||r.spatialReference.vcsWkid)return;const o=e(this.options.sourceSpatialReference)/e(r.spatialReference);if(1!==o)for(const e of r.features){if(!e.geometry||!e.geometry.coords)continue;const t=e.geometry.coords;for(let e=2;e<t.length;e+=3)t[e]*=o}}addFeature(e,t){e.features.push(t)}createFeature(){return new r}createSpatialReference(){return{wkid:0}}createGeometry(){return new s}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new s}}export{i as OPTIMIZED_GEOMETRY_TYPES,n as OptimizedFeatureSetParserContext};\n"]},"metadata":{},"sourceType":"module"}