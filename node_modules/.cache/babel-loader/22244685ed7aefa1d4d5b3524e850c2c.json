{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"./Dictionary.js\";\nimport e from \"./ImmutableArray.js\";\nimport { i, k as r, g as s, s as a, x as o, o as n, y as l, z as u, A as h } from \"../chunks/languageUtils.js\";\nimport f from \"../geometry/Geometry.js\";\nimport y from \"../geometry/Point.js\";\nimport { fromJSON as d } from \"../geometry/support/jsonUtils.js\";\nimport { esriFieldToJson as _, layerGeometryEsriRestConstants as c } from \"./featureset/support/shared.js\";\nimport { convertToGeometry as m } from \"../layers/graphics/featureConversionUtils.js\";\nimport { isSome as p, unwrap as g } from \"../core/maybe.js\";\n\nclass b {\n  constructor() {\n    this.declaredClass = \"esri.arcade.Feature\", this._optimizedGeomDefinition = null, this._geometry = null, this.attributes = null, this._layer = null, this._datesfixed = !0, this.immutable = !0, this._datefields = null, this.immutable = !0;\n  }\n\n  static createFromGraphic(t) {\n    const e = new b();\n    return e._geometry = p(t.geometry) ? t.geometry : null, void 0 === t.attributes || null === t.attributes ? e.attributes = {} : e.attributes = t.attributes, t._sourceLayer ? (e._layer = t._sourceLayer, e._datesfixed = !1) : t._layer ? (e._layer = t._layer, e._datesfixed = !1) : t.layer && \"fields\" in t.layer ? (e._layer = t.layer, e._datesfixed = !1) : t.sourceLayer && \"fields\" in t.sourceLayer && (e._layer = t.sourceLayer, e._datesfixed = !1), e;\n  }\n\n  static createFromArcadeFeature(t) {\n    const e = new b();\n    return e._datesfixed = t._datesfixed, e.attributes = t.attributes, e._geometry = t._geometry, e._optimizedGeomDefinition = t._optimizedGeomDefinition, t._layer && (e._layer = t._layer), e;\n  }\n\n  static createFromOptimisedFeature(t, e, i) {\n    const r = new b();\n    return r._geometry = t.geometry ? {\n      geometry: t.geometry\n    } : null, r._optimizedGeomDefinition = i, r.attributes = t.attributes || {}, r._layer = e, r._datesfixed = !1, r;\n  }\n\n  static createFromArcadeDictionary(e) {\n    const i = new b();\n    return i.attributes = e.field(\"attributes\"), null !== i.attributes && i.attributes instanceof t ? (i.attributes = i.attributes.attributes, null === i.attributes && (i.attributes = {})) : i.attributes = {}, i._geometry = e.field(\"geometry\"), null !== i._geometry && (i._geometry instanceof t ? i._geometry = b.parseGeometryFromDictionary(i._geometry) : i._geometry instanceof f || (i._geometry = null)), i;\n  }\n\n  static createFromGraphicLikeObject(t, e, i = null) {\n    const r = new b();\n    return null === e && (e = {}), r.attributes = e, r._geometry = p(t) ? t : null, r._layer = i, r._layer && (r._datesfixed = !1), r._adapter = null, r;\n  }\n\n  repurposeFromGraphicLikeObject(t, e, i = null) {\n    null === e && (e = {}), this.attributes = e, this._geometry = t || null, this._layer = i, this._layer ? this._datesfixed = !1 : this._datesfixed = !0;\n  }\n\n  repurposeFromAdapter(t, e = null) {\n    this._adapter = t, this._layer = e;\n  }\n\n  castToText() {\n    if (this._adapter) return this._adapter.castToText();\n    let t = \"\";\n    !1 === this._datesfixed && this._fixDates();\n\n    for (const o in this.attributes) {\n      \"\" !== t && (t += \",\");\n      const n = this.attributes[o];\n      null == n ? t += JSON.stringify(o) + \":null\" : i(n) || r(n) || s(n) ? t += JSON.stringify(o) + \":\" + JSON.stringify(n) : n instanceof f || n instanceof e || n instanceof Array ? t += JSON.stringify(o) + \":\" + a(n) : n instanceof Date ? t += JSON.stringify(o) + \":\" + JSON.stringify(n) : null !== n && \"object\" == typeof n && void 0 !== n.castToText && (t += JSON.stringify(o) + \":\" + n.castToText());\n    }\n\n    return '{\"geometry\":' + (null === this.geometry() ? \"null\" : a(this.geometry())) + ',\"attributes\":{' + t + \"}}\";\n  }\n\n  _fixDates() {\n    if (null !== this._datefields) return this._datefields.length > 0 && this._fixDateFields(this._datefields), void (this._datesfixed = !0);\n    const t = [];\n\n    for (let e = 0; e < this._layer.fields.length; e++) {\n      const i = this._layer.fields[e];\n      \"date\" !== i.type && \"esriFieldTypeDate\" !== i.type || t.push(i.name);\n    }\n\n    this._datefields = t, t.length > 0 && this._fixDateFields(t), this._datesfixed = !0;\n  }\n\n  _fixDateFields(t) {\n    this.attributes = { ...this.attributes\n    };\n\n    for (let e = 0; e < t.length; e++) {\n      let i = this.attributes[t[e]];\n      if (null === i) ;else if (void 0 === i) {\n        for (const r in this.attributes) if (r.toLowerCase() === t[e].toLowerCase()) {\n          i = this.attributes[r], null !== i && (i instanceof Date || (this.attributes[r] = new Date(i)));\n          break;\n        }\n      } else i instanceof Date || (this.attributes[t[e]] = new Date(i));\n    }\n  }\n\n  geometry() {\n    return this._adapter ? this._adapter.geometry() : (null === this._geometry || this._geometry instanceof f || (this._optimizedGeomDefinition ? (this._geometry = g(d(m(this._geometry, this._optimizedGeomDefinition.geometryType, this._optimizedGeomDefinition.hasZ, this._optimizedGeomDefinition.hasM))), this._geometry.spatialReference = this._optimizedGeomDefinition.spatialReference) : this._geometry = g(d(this._geometry))), this._geometry);\n  }\n\n  field(t) {\n    if (this._adapter) return this._adapter.field(t);\n    !1 === this._datesfixed && this._fixDates();\n    const e = this.attributes[t];\n    if (void 0 !== e) return e;\n    const i = t.toLowerCase();\n\n    for (const r in this.attributes) if (r.toLowerCase() === i) return this.attributes[r];\n\n    if (this._hasFieldDefinition(i)) return null;\n    throw new Error(\"Field not Found : \" + t);\n  }\n\n  _hasFieldDefinition(t) {\n    if (null === this._layer) return !1;\n\n    for (let e = 0; e < this._layer.fields.length; e++) {\n      if (this._layer.fields[e].name.toLowerCase() === t) return !0;\n    }\n\n    return !1;\n  }\n\n  _field(t) {\n    var e;\n    if (this._adapter) return null != (e = this._adapter.field(t)) ? e : null;\n    !1 === this._datesfixed && this._fixDates();\n    const i = t.toLowerCase(),\n          r = this.attributes[t];\n    if (void 0 !== r) return r;\n\n    for (const s in this.attributes) if (s.toLowerCase() === i) return this.attributes[s];\n\n    return null;\n  }\n\n  setField(t, e) {\n    if (this.immutable) throw new Error(\"Feature is Immutable\");\n    if (!1 === o(e)) throw new Error(\"Illegal Value Assignment to Feature\");\n    if (this._adapter) return void this._adapter.setField(t, e);\n    const i = t.toLowerCase();\n\n    if (void 0 === this.attributes[t]) {\n      for (const t in this.attributes) if (t.toLowerCase() === i) return void (this.attributes[t] = e);\n\n      this.attributes[t] = e;\n    } else this.attributes[t] = e;\n  }\n\n  hasField(t) {\n    if (this._adapter) return this._adapter.hasField(t);\n    const e = t.toLowerCase();\n    if (void 0 !== this.attributes[t]) return !0;\n\n    for (const i in this.attributes) if (i.toLowerCase() === e) return !0;\n\n    return !!this._hasFieldDefinition(e);\n  }\n\n  keys() {\n    if (this._adapter) return this._adapter.keys();\n    let t = [];\n    const e = {};\n\n    for (const i in this.attributes) t.push(i), e[i.toLowerCase()] = 1;\n\n    if (null !== this._layer) for (let i = 0; i < this._layer.fields.length; i++) {\n      const r = this._layer.fields[i];\n      1 !== e[r.name.toLowerCase()] && t.push(r.name);\n    }\n    return t = t.sort(), t;\n  }\n\n  static parseGeometryFromDictionary(t) {\n    const e = b.convertDictionaryToJson(t, !0);\n    return void 0 !== e.hasm && (e.hasM = e.hasm, delete e.hasm), void 0 !== e.hasz && (e.hasZ = e.hasz, delete e.hasz), void 0 !== e.spatialreference && (e.spatialReference = e.spatialreference, delete e.spatialreference), void 0 !== e.rings && (e.rings = this.fixPathArrays(e.rings, !0 === e.hasZ, !0 === e.hasZ)), void 0 !== e.paths && (e.paths = this.fixPathArrays(e.paths, !0 === e.hasZ, !0 === e.hasM)), void 0 !== e.points && (e.points = this.fixPointArrays(e.points, !0 === e.hasZ, !0 === e.hasM)), d(e);\n  }\n\n  static fixPathArrays(t, i, r) {\n    const s = [];\n    if (t instanceof Array) for (let e = 0; e < t.length; e++) s.push(this.fixPointArrays(t[e], i, r));else if (t instanceof e) for (let e = 0; e < t.length(); e++) s.push(this.fixPointArrays(t.get(e), i, r));\n    return s;\n  }\n\n  static fixPointArrays(t, i, r) {\n    const s = [];\n    if (t instanceof Array) for (let a = 0; a < t.length; a++) {\n      const o = t[a];\n      o instanceof y ? i && r ? s.push([o.x, o.y, o.z, o.m]) : i ? s.push([o.x, o.y, o.z]) : r ? s.push([o.x, o.y, o.m]) : s.push([o.x, o.y]) : o instanceof e ? s.push(o.toArray()) : s.push(o);\n    } else if (t instanceof e) for (let a = 0; a < t.length(); a++) {\n      const o = t.get(a);\n      o instanceof y ? i && r ? s.push([o.x, o.y, o.z, o.m]) : i ? s.push([o.x, o.y, o.z]) : r ? s.push([o.x, o.y, o.m]) : s.push([o.x, o.y]) : o instanceof e ? s.push(o.toArray()) : s.push(o);\n    }\n    return s;\n  }\n\n  static convertDictionaryToJson(e, i = !1) {\n    const r = {};\n\n    for (const s in e.attributes) {\n      let a = e.attributes[s];\n      a instanceof t && (a = b.convertDictionaryToJson(a)), i ? r[s.toLowerCase()] = a : r[s] = a;\n    }\n\n    return r;\n  }\n\n  static parseAttributesFromDictionary(t) {\n    const e = {};\n\n    for (const i in t.attributes) {\n      const r = t.attributes[i];\n      if (!o(r)) throw new Error(\"Illegal Argument\");\n      e[i] = r;\n    }\n\n    return e;\n  }\n\n  static fromJson(t) {\n    let e = null;\n    null !== t.geometry && void 0 !== t.geometry && (e = d(t.geometry));\n    const a = {};\n    if (null !== t.attributes && void 0 !== t.attributes) for (const o in t.attributes) {\n      const e = t.attributes[o];\n      if (null === e) a[o] = e;else {\n        if (!(s(e) || r(e) || i(e) || n(e))) throw new Error(\"Illegal Argument\");\n        a[o] = e;\n      }\n    }\n    return b.createFromGraphicLikeObject(e, a, null);\n  }\n\n  fullDomain(t, e) {\n    if (null === this._layer) return null;\n    if (!this._layer.fields) return null;\n    return l(t, this._layer, this, e);\n  }\n\n  subtypes() {\n    return null === this._layer ? null : this._layer.fields && this._layer.typeIdField ? {\n      subtypeField: this._layer.typeIdField,\n      subtypes: this._layer.types ? this._layer.types.map(t => ({\n        name: t.name,\n        code: t.id\n      })) : []\n    } : null;\n  }\n\n  domainValueLookup(t, e, i) {\n    if (null === this._layer) return null;\n    if (!this._layer.fields) return null;\n    const r = l(t, this._layer, this, i);\n    if (void 0 === e) try {\n      e = this.field(t);\n    } catch (s) {\n      return null;\n    }\n    return u(r, e);\n  }\n\n  gdbVersion() {\n    if (null === this._layer) return \"\";\n    const t = this._layer.gdbVersion;\n    return void 0 === t ? \"\" : \"\" === t && this._layer.capabilities && this._layer.capabilities.isVersioned ? \"SDE.DEFAULT\" : t;\n  }\n\n  domainCodeLookup(t, e, i) {\n    if (null === this._layer) return null;\n    if (!this._layer.fields) return null;\n\n    if (void 0 === e) {\n      try {\n        e = this.field(t);\n      } catch (s) {\n        return null;\n      }\n\n      return e;\n    }\n\n    const r = l(t, this._layer, this, i);\n    return h(r, e);\n  }\n\n  schema() {\n    if (null === this._layer) return null;\n    if (!this._layer.fields) return null;\n    const t = [];\n\n    for (const e of this._layer.fields) t.push(_(e));\n\n    return {\n      objectIdField: this._layer.objectIdField,\n      globalIdField: this._layer.globalIdField,\n      geometryType: void 0 === c[this._layer.geometryType] ? \"\" : c[this._layer.geometryType],\n      fields: t\n    };\n  }\n\n}\n\nexport default b;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/arcade/Feature.js"],"names":["t","e","i","k","r","g","s","a","x","o","n","y","l","z","u","A","h","f","fromJSON","d","esriFieldToJson","_","layerGeometryEsriRestConstants","c","convertToGeometry","m","isSome","p","unwrap","b","constructor","declaredClass","_optimizedGeomDefinition","_geometry","attributes","_layer","_datesfixed","immutable","_datefields","createFromGraphic","geometry","_sourceLayer","layer","sourceLayer","createFromArcadeFeature","createFromOptimisedFeature","createFromArcadeDictionary","field","parseGeometryFromDictionary","createFromGraphicLikeObject","_adapter","repurposeFromGraphicLikeObject","repurposeFromAdapter","castToText","_fixDates","JSON","stringify","Array","Date","length","_fixDateFields","fields","type","push","name","toLowerCase","geometryType","hasZ","hasM","spatialReference","_hasFieldDefinition","Error","_field","setField","hasField","keys","sort","convertDictionaryToJson","hasm","hasz","spatialreference","rings","fixPathArrays","paths","points","fixPointArrays","get","toArray","parseAttributesFromDictionary","fromJson","fullDomain","subtypes","typeIdField","subtypeField","types","map","code","id","domainValueLookup","gdbVersion","capabilities","isVersioned","domainCodeLookup","schema","objectIdField","globalIdField"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"./Dictionary.js\";import e from\"./ImmutableArray.js\";import{i,k as r,g as s,s as a,x as o,o as n,y as l,z as u,A as h}from\"../chunks/languageUtils.js\";import f from\"../geometry/Geometry.js\";import y from\"../geometry/Point.js\";import{fromJSON as d}from\"../geometry/support/jsonUtils.js\";import{esriFieldToJson as _,layerGeometryEsriRestConstants as c}from\"./featureset/support/shared.js\";import{convertToGeometry as m}from\"../layers/graphics/featureConversionUtils.js\";import{isSome as p,unwrap as g}from\"../core/maybe.js\";class b{constructor(){this.declaredClass=\"esri.arcade.Feature\",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._datesfixed=!0,this.immutable=!0,this._datefields=null,this.immutable=!0}static createFromGraphic(t){const e=new b;return e._geometry=p(t.geometry)?t.geometry:null,void 0===t.attributes||null===t.attributes?e.attributes={}:e.attributes=t.attributes,t._sourceLayer?(e._layer=t._sourceLayer,e._datesfixed=!1):t._layer?(e._layer=t._layer,e._datesfixed=!1):t.layer&&\"fields\"in t.layer?(e._layer=t.layer,e._datesfixed=!1):t.sourceLayer&&\"fields\"in t.sourceLayer&&(e._layer=t.sourceLayer,e._datesfixed=!1),e}static createFromArcadeFeature(t){const e=new b;return e._datesfixed=t._datesfixed,e.attributes=t.attributes,e._geometry=t._geometry,e._optimizedGeomDefinition=t._optimizedGeomDefinition,t._layer&&(e._layer=t._layer),e}static createFromOptimisedFeature(t,e,i){const r=new b;return r._geometry=t.geometry?{geometry:t.geometry}:null,r._optimizedGeomDefinition=i,r.attributes=t.attributes||{},r._layer=e,r._datesfixed=!1,r}static createFromArcadeDictionary(e){const i=new b;return i.attributes=e.field(\"attributes\"),null!==i.attributes&&i.attributes instanceof t?(i.attributes=i.attributes.attributes,null===i.attributes&&(i.attributes={})):i.attributes={},i._geometry=e.field(\"geometry\"),null!==i._geometry&&(i._geometry instanceof t?i._geometry=b.parseGeometryFromDictionary(i._geometry):i._geometry instanceof f||(i._geometry=null)),i}static createFromGraphicLikeObject(t,e,i=null){const r=new b;return null===e&&(e={}),r.attributes=e,r._geometry=p(t)?t:null,r._layer=i,r._layer&&(r._datesfixed=!1),r._adapter=null,r}repurposeFromGraphicLikeObject(t,e,i=null){null===e&&(e={}),this.attributes=e,this._geometry=t||null,this._layer=i,this._layer?this._datesfixed=!1:this._datesfixed=!0}repurposeFromAdapter(t,e=null){this._adapter=t,this._layer=e}castToText(){if(this._adapter)return this._adapter.castToText();let t=\"\";!1===this._datesfixed&&this._fixDates();for(const o in this.attributes){\"\"!==t&&(t+=\",\");const n=this.attributes[o];null==n?t+=JSON.stringify(o)+\":null\":i(n)||r(n)||s(n)?t+=JSON.stringify(o)+\":\"+JSON.stringify(n):n instanceof f||n instanceof e||n instanceof Array?t+=JSON.stringify(o)+\":\"+a(n):n instanceof Date?t+=JSON.stringify(o)+\":\"+JSON.stringify(n):null!==n&&\"object\"==typeof n&&void 0!==n.castToText&&(t+=JSON.stringify(o)+\":\"+n.castToText())}return'{\"geometry\":'+(null===this.geometry()?\"null\":a(this.geometry()))+',\"attributes\":{'+t+\"}}\"}_fixDates(){if(null!==this._datefields)return this._datefields.length>0&&this._fixDateFields(this._datefields),void(this._datesfixed=!0);const t=[];for(let e=0;e<this._layer.fields.length;e++){const i=this._layer.fields[e];\"date\"!==i.type&&\"esriFieldTypeDate\"!==i.type||t.push(i.name)}this._datefields=t,t.length>0&&this._fixDateFields(t),this._datesfixed=!0}_fixDateFields(t){this.attributes={...this.attributes};for(let e=0;e<t.length;e++){let i=this.attributes[t[e]];if(null===i);else if(void 0===i){for(const r in this.attributes)if(r.toLowerCase()===t[e].toLowerCase()){i=this.attributes[r],null!==i&&(i instanceof Date||(this.attributes[r]=new Date(i)));break}}else i instanceof Date||(this.attributes[t[e]]=new Date(i))}}geometry(){return this._adapter?this._adapter.geometry():(null===this._geometry||this._geometry instanceof f||(this._optimizedGeomDefinition?(this._geometry=g(d(m(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM))),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=g(d(this._geometry))),this._geometry)}field(t){if(this._adapter)return this._adapter.field(t);!1===this._datesfixed&&this._fixDates();const e=this.attributes[t];if(void 0!==e)return e;const i=t.toLowerCase();for(const r in this.attributes)if(r.toLowerCase()===i)return this.attributes[r];if(this._hasFieldDefinition(i))return null;throw new Error(\"Field not Found : \"+t)}_hasFieldDefinition(t){if(null===this._layer)return!1;for(let e=0;e<this._layer.fields.length;e++){if(this._layer.fields[e].name.toLowerCase()===t)return!0}return!1}_field(t){var e;if(this._adapter)return null!=(e=this._adapter.field(t))?e:null;!1===this._datesfixed&&this._fixDates();const i=t.toLowerCase(),r=this.attributes[t];if(void 0!==r)return r;for(const s in this.attributes)if(s.toLowerCase()===i)return this.attributes[s];return null}setField(t,e){if(this.immutable)throw new Error(\"Feature is Immutable\");if(!1===o(e))throw new Error(\"Illegal Value Assignment to Feature\");if(this._adapter)return void this._adapter.setField(t,e);const i=t.toLowerCase();if(void 0===this.attributes[t]){for(const t in this.attributes)if(t.toLowerCase()===i)return void(this.attributes[t]=e);this.attributes[t]=e}else this.attributes[t]=e}hasField(t){if(this._adapter)return this._adapter.hasField(t);const e=t.toLowerCase();if(void 0!==this.attributes[t])return!0;for(const i in this.attributes)if(i.toLowerCase()===e)return!0;return!!this._hasFieldDefinition(e)}keys(){if(this._adapter)return this._adapter.keys();let t=[];const e={};for(const i in this.attributes)t.push(i),e[i.toLowerCase()]=1;if(null!==this._layer)for(let i=0;i<this._layer.fields.length;i++){const r=this._layer.fields[i];1!==e[r.name.toLowerCase()]&&t.push(r.name)}return t=t.sort(),t}static parseGeometryFromDictionary(t){const e=b.convertDictionaryToJson(t,!0);return void 0!==e.hasm&&(e.hasM=e.hasm,delete e.hasm),void 0!==e.hasz&&(e.hasZ=e.hasz,delete e.hasz),void 0!==e.spatialreference&&(e.spatialReference=e.spatialreference,delete e.spatialreference),void 0!==e.rings&&(e.rings=this.fixPathArrays(e.rings,!0===e.hasZ,!0===e.hasZ)),void 0!==e.paths&&(e.paths=this.fixPathArrays(e.paths,!0===e.hasZ,!0===e.hasM)),void 0!==e.points&&(e.points=this.fixPointArrays(e.points,!0===e.hasZ,!0===e.hasM)),d(e)}static fixPathArrays(t,i,r){const s=[];if(t instanceof Array)for(let e=0;e<t.length;e++)s.push(this.fixPointArrays(t[e],i,r));else if(t instanceof e)for(let e=0;e<t.length();e++)s.push(this.fixPointArrays(t.get(e),i,r));return s}static fixPointArrays(t,i,r){const s=[];if(t instanceof Array)for(let a=0;a<t.length;a++){const o=t[a];o instanceof y?i&&r?s.push([o.x,o.y,o.z,o.m]):i?s.push([o.x,o.y,o.z]):r?s.push([o.x,o.y,o.m]):s.push([o.x,o.y]):o instanceof e?s.push(o.toArray()):s.push(o)}else if(t instanceof e)for(let a=0;a<t.length();a++){const o=t.get(a);o instanceof y?i&&r?s.push([o.x,o.y,o.z,o.m]):i?s.push([o.x,o.y,o.z]):r?s.push([o.x,o.y,o.m]):s.push([o.x,o.y]):o instanceof e?s.push(o.toArray()):s.push(o)}return s}static convertDictionaryToJson(e,i=!1){const r={};for(const s in e.attributes){let a=e.attributes[s];a instanceof t&&(a=b.convertDictionaryToJson(a)),i?r[s.toLowerCase()]=a:r[s]=a}return r}static parseAttributesFromDictionary(t){const e={};for(const i in t.attributes){const r=t.attributes[i];if(!o(r))throw new Error(\"Illegal Argument\");e[i]=r}return e}static fromJson(t){let e=null;null!==t.geometry&&void 0!==t.geometry&&(e=d(t.geometry));const a={};if(null!==t.attributes&&void 0!==t.attributes)for(const o in t.attributes){const e=t.attributes[o];if(null===e)a[o]=e;else{if(!(s(e)||r(e)||i(e)||n(e)))throw new Error(\"Illegal Argument\");a[o]=e}}return b.createFromGraphicLikeObject(e,a,null)}fullDomain(t,e){if(null===this._layer)return null;if(!this._layer.fields)return null;return l(t,this._layer,this,e)}subtypes(){return null===this._layer?null:this._layer.fields&&this._layer.typeIdField?{subtypeField:this._layer.typeIdField,subtypes:this._layer.types?this._layer.types.map((t=>({name:t.name,code:t.id}))):[]}:null}domainValueLookup(t,e,i){if(null===this._layer)return null;if(!this._layer.fields)return null;const r=l(t,this._layer,this,i);if(void 0===e)try{e=this.field(t)}catch(s){return null}return u(r,e)}gdbVersion(){if(null===this._layer)return\"\";const t=this._layer.gdbVersion;return void 0===t?\"\":\"\"===t&&this._layer.capabilities&&this._layer.capabilities.isVersioned?\"SDE.DEFAULT\":t}domainCodeLookup(t,e,i){if(null===this._layer)return null;if(!this._layer.fields)return null;if(void 0===e){try{e=this.field(t)}catch(s){return null}return e}const r=l(t,this._layer,this,i);return h(r,e)}schema(){if(null===this._layer)return null;if(!this._layer.fields)return null;const t=[];for(const e of this._layer.fields)t.push(_(e));return{objectIdField:this._layer.objectIdField,globalIdField:this._layer.globalIdField,geometryType:void 0===c[this._layer.geometryType]?\"\":c[this._layer.geometryType],fields:t}}}export default b;\n"]},"metadata":{},"sourceType":"module"}