{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../geometry.js\";\nimport { neverReached as e } from \"../../../core/compilerUtils.js\";\nimport t from \"../../../core/Evented.js\";\nimport { deg2rad as i } from \"../../../core/mathUtils.js\";\nimport { isSome as s, isNone as o, unwrapOr as r, unwrap as n } from \"../../../core/maybe.js\";\nimport { createScreenPointArray as a, createRenderScreenPointArray3 as c, screenPointObjectToArray as l, castRenderScreenPointArray as h } from \"../../../core/screenUtils.js\";\nimport { once as d } from \"../../../core/accessorSupport/utils.js\";\nimport { f as u } from \"../../../chunks/mat3.js\";\nimport { c as _ } from \"../../../chunks/mat3f64.js\";\nimport { d as g, h as m, m as f, i as p } from \"../../../chunks/mat4.js\";\nimport { c as v } from \"../../../chunks/mat4f64.js\";\nimport { j as b } from \"../../../chunks/vec2.js\";\nimport { b as y, t as j, m as L, a as S, g as R, h as w, s as O, f as T } from \"../../../chunks/vec3.js\";\nimport { c as E, Z as A } from \"../../../chunks/vec3f64.js\";\nimport { canProjectWithoutEngine as D, projectPoint as F, sphericalPCPFtoLonLatElevation as z, computeLatLonToENURotation as k } from \"../../../geometry/projection.js\";\nimport { getReferenceEllipsoid as P } from \"../../../geometry/projectionEllipsoid.js\";\nimport { containsPointObject as I } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { distance2 as M, fromPoints as C, closestRayDistance2 as x, create as B } from \"../../../geometry/support/lineSegment.js\";\nimport { fromPositionAndNormal as W, intersectRay as V, create as H } from \"../../../geometry/support/plane.js\";\nimport { create as U } from \"../../../geometry/support/ray.js\";\nimport { sv3d as G } from \"../../../geometry/support/vectorStacks.js\";\nimport { clonePoint as Z } from \"../../../layers/graphics/hydratedFeatures.js\";\nimport { getElevationAtPoint as q } from \"../support/ElevationProvider.js\";\nimport { fromScreen as J } from \"../support/geometryUtils/ray.js\";\nimport K from \"../webgl-engine/lib/Camera.js\";\nimport { Object3D as N } from \"../webgl-engine/lib/Object3D.js\";\nimport { WebGLLayer as Q } from \"../webgl-engine/lib/WebGLLayer.js\";\nimport X from \"../../../geometry/Point.js\";\n\nclass Y {\n  constructor(e) {\n    this.idHint = 0, this.camera = new K(), this._elevation = {\n      offset: 0,\n      override: null\n    }, this.collisionType = {\n      type: \"point\"\n    }, this.collisionPriority = 0, this._renderObjects = [], this.autoScaleRenderObjects = !0, this._available = !0, this._noDisplayCount = 0, this._radius = 10, this._worldSized = !1, this.focusMultiplier = 2, this.touchMultiplier = 2.5, this.worldOriented = !1, this._modelTransform = v(), this._worldFrame = null, this._renderLocation = E(), this._renderLocationDirty = !0, this._location = new X({\n      x: 0,\n      y: 0,\n      z: 0\n    }), this._elevationAlignedLocation = new X(), this._elevationAlignedLocationDirty = !0, this.interactive = !0, this.selectable = !1, this.grabbable = !0, this.cursor = null, this._grabbing = !1, this.dragging = !1, this._hovering = !1, this._selected = !1, this._state = 0, this._focused = !1, this.events = new t.EventEmitter(), this._screenLocation = {\n      screenPointArray: a(),\n      renderScreenPointArray: c(),\n      pixelSize: 0\n    }, this._screenLocationDirty = !0, this._applyObjectTransform = null, this._engineResourcesAddedToStage = !1, this._engineResources = null, this._attached = !1, this._engineLayer = null, this._materialIdReferences = null, this._location.spatialReference = e.view.spatialReference;\n\n    for (const t in e) this[t] = e[t];\n\n    this.view.state && this.view.state.camera && this.camera.copyFrom(this.view.state.camera);\n  }\n\n  destroy() {\n    this._removeResourcesFromStage(), this._engineResources = null, this.view = null, this.camera = null;\n  }\n\n  get elevationInfo() {\n    return this._elevationInfo;\n  }\n\n  set elevationInfo(e) {\n    this._elevationInfo = e, this._elevationAlignedLocationDirty = !0, this._renderLocationDirty = !0, this._updateEngineObject();\n  }\n\n  get renderObjects() {\n    return this._renderObjects;\n  }\n\n  set renderObjects(e) {\n    this._removeResourcesFromStage(), this._engineResources = null, this._renderObjects = e.slice(), this._updateEngineObject();\n  }\n\n  set available(e) {\n    e !== this._available && (this._available = e, this._updateEngineObject());\n  }\n\n  get available() {\n    return this._available;\n  }\n\n  disableDisplay() {\n    return this._noDisplayCount++, 1 === this._noDisplayCount && this._updateEngineObject(), {\n      remove: d(() => {\n        this._noDisplayCount--, 0 === this._noDisplayCount && this._updateEngineObject();\n      })\n    };\n  }\n\n  set radius(e) {\n    e !== this._radius && (this._radius = e, this._updateEngineObject());\n  }\n\n  get radius() {\n    return this._radius;\n  }\n\n  set worldSized(e) {\n    e !== this._worldSized && (this._worldSized = e, this._updateEngineObject());\n  }\n\n  get worldSized() {\n    return this._worldSized;\n  }\n\n  get modelTransform() {\n    return this._modelTransform;\n  }\n\n  set modelTransform(e) {\n    $(e) && (this._screenLocationDirty = !0), g(this._modelTransform, e), this._updateEngineObject();\n  }\n\n  get renderLocation() {\n    return this._renderLocationDirty && (this._renderLocationDirty = !1, this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation, this._renderLocation), this.worldOriented ? (this._worldFrame || (this._worldFrame = v()), ee(this.view, this._renderLocation, this._worldFrame)) : this._worldFrame && (this._worldFrame = null)), this._renderLocation;\n  }\n\n  set renderLocation(e) {\n    this.view.renderCoordsHelper.fromRenderCoords(e, this._location), this.elevationAlignedLocation = this._location;\n  }\n\n  get location() {\n    return this._location;\n  }\n\n  set location(e) {\n    Z(e, this._location), this._renderLocationDirty = !0, this._screenLocationDirty = !0, this._elevationAlignedLocationDirty = !0, this._updateEngineObject(), this.events.emit(\"location-update\", {\n      location: this._location\n    });\n  }\n\n  get elevationAlignedLocation() {\n    return this._elevationAlignedLocationDirty ? (this._evaluateElevationAlignment(), this._updateElevationAlignedLocation(), this._elevationAlignedLocation) : this._elevationAlignedLocation;\n  }\n\n  set elevationAlignedLocation(e) {\n    Z(e, this._location), this._evaluateElevationAlignment(), this._location.z -= this._elevation.offset, this._updateElevationAlignedLocation(), this._updateEngineObject(), this.events.emit(\"location-update\", {\n      location: this._location\n    });\n  }\n\n  _updateElevationAlignedLocation() {\n    this._elevationAlignedLocation.x = this.location.x, this._elevationAlignedLocation.y = this.location.y;\n    const e = s(this._elevation.override) ? this._elevation.override : this.location.z || 0;\n    this._elevationAlignedLocation.z = e + this._elevation.offset, this._elevationAlignedLocation.spatialReference = this.location.spatialReference, this._renderLocationDirty = !0, this._screenLocationDirty = !0, this._elevationAlignedLocationDirty = !1;\n  }\n\n  grabbableForEvent() {\n    return !0;\n  }\n\n  get grabbing() {\n    return this._grabbing;\n  }\n\n  set grabbing(e) {\n    e !== this._grabbing && (this._grabbing = e, this._setFocused(this._hovering || this._grabbing), this._updateEngineObject());\n  }\n\n  get hovering() {\n    return this._hovering;\n  }\n\n  set hovering(e) {\n    e !== this._hovering && (this._hovering = e, this._setFocused(this._hovering || this._grabbing), this._updateEngineObject());\n  }\n\n  get selected() {\n    return this._selected;\n  }\n\n  set selected(e) {\n    e !== this._selected && (this._selected = e, this._updateEngineObject(), this.events.emit(\"select-changed\", {\n      action: e ? \"select\" : \"deselect\"\n    }));\n  }\n\n  get state() {\n    return this._state;\n  }\n\n  set state(e) {\n    e !== this._state && (this._state = e, this._updateEngineObject());\n  }\n\n  updateStateEnabled(e, t) {\n    t ? this.state |= e : this.state &= ~e;\n  }\n\n  _setFocused(e) {\n    e !== this._focused && (this._focused = e, this.events.emit(\"focus-changed\", {\n      action: !0 === e ? \"focus\" : \"unfocus\"\n    }));\n  }\n\n  get focused() {\n    return this._focused;\n  }\n\n  get screenLocation() {\n    return this.ensureScreenLocation(), this._screenLocation;\n  }\n\n  ensureScreenLocation() {\n    if (!this._screenLocationDirty) return;\n    this._screenLocation.pixelSize = this.camera.computeScreenPixelSizeAt(this.renderLocation), this._screenLocationDirty = !1;\n    let e;\n\n    if ($(this._modelTransform)) {\n      const t = this._calculateModelTransformOffset(_e);\n\n      e = y(t, t, this.renderLocation);\n    } else e = this.renderLocation;\n\n    this.camera.projectToRenderScreen(e, this._screenLocation.renderScreenPointArray), this.camera.renderToScreen(this._screenLocation.renderScreenPointArray, this._screenLocation.screenPointArray);\n  }\n\n  get applyObjectTransform() {\n    return this._applyObjectTransform;\n  }\n\n  set applyObjectTransform(e) {\n    this._applyObjectTransform = e, this._screenLocationDirty = !0, this._updateEngineObject();\n  }\n\n  intersectionDistance(t, i) {\n    if (!this.available) return null;\n\n    const s = l(t, te),\n          r = this._getCollisionRadius(i),\n          n = -1 * this.collisionPriority;\n\n    switch (this.collisionType.type) {\n      case \"point\":\n        if (b(this.screenLocation.screenPointArray, s) < r * r) return this.screenLocation.renderScreenPointArray[2] + n;\n        break;\n\n      case \"line\":\n        {\n          const e = this.collisionType.paths,\n                t = this._getWorldToScreenObjectScale(),\n                i = this._calculateObjectTransform(t, ne),\n                a = r * this.screenLocation.pixelSize,\n                c = J(this.camera, s, se);\n\n          if (o(c)) return null;\n\n          for (const s of e) {\n            if (0 === s.length) continue;\n            const e = L(ce, s[0], i);\n\n            for (let t = 1; t < s.length; t++) {\n              const o = L(le, s[t], i),\n                    r = x(C(e, o, ie), c);\n\n              if (null != r && r < a * a) {\n                const t = y(G.get(), e, o);\n                S(t, t, .5);\n                const i = h(G.get());\n                return this.camera.projectToRenderScreen(t, i), i[2] + n;\n              }\n\n              R(e, o);\n            }\n          }\n\n          break;\n        }\n\n      case \"disc\":\n        {\n          var a;\n\n          const e = this.collisionType.direction,\n                t = null != (a = this.collisionType.offset) ? a : A,\n                i = this._getWorldToScreenObjectScale(),\n                c = this._calculateObjectTransform(i, ne),\n                l = r * this.screenLocation.pixelSize,\n                h = J(this.camera, s, se);\n\n          if (o(h)) return null;\n\n          const d = u(oe, c),\n                _ = j(de, e, d),\n                g = L(ue, t, c);\n\n          W(g, _, ae);\n          const m = he;\n          if (V(ae, h, m) && w(m, g) < l * l) return this.screenLocation.renderScreenPointArray[2] + n;\n          break;\n        }\n\n      case \"ribbon\":\n        {\n          const {\n            paths: e,\n            direction: t\n          } = this.collisionType,\n                i = this._getWorldToScreenObjectScale(),\n                a = this._calculateObjectTransform(i, ne),\n                c = r * this.camera.computeScreenPixelSizeAt(this.renderLocation),\n                l = J(this.camera, s, se);\n\n          if (o(l)) return null;\n\n          const d = u(oe, a),\n                _ = j(de, t, d),\n                g = this._calculateModelTransformPosition(ue);\n\n          W(g, _, ae);\n          const m = he;\n          if (!V(ae, l, m)) break;\n\n          for (const s of e) {\n            if (0 === s.length) continue;\n            const e = L(ce, s[0], a);\n\n            for (let t = 1; t < s.length; t++) {\n              const i = L(le, s[t], a),\n                    o = M(C(e, i, ie), m);\n\n              if (null != o && o < c * c) {\n                const t = y(G.get(), e, i);\n                S(t, t, .5);\n                const s = h(G.get());\n                return this.camera.projectToRenderScreen(t, s), s[2] + n;\n              }\n\n              R(e, i);\n            }\n          }\n\n          break;\n        }\n\n      default:\n        e(this.collisionType);\n    }\n\n    return null;\n  }\n\n  attach(e = {\n    manipulator3D: {}\n  }) {\n    var t;\n    if (!this.view._stage) return;\n    const i = e.manipulator3D;\n\n    if (o(i.engineLayerId)) {\n      const e = new Q({\n        isPickable: !1,\n        updatePolicy: 1\n      });\n      this.view._stage.add(e), i.engineLayerId = e.id, this._engineLayer = e;\n    } else null != (t = this.view._stage) && t.getObject && (this._engineLayer = this.view._stage.getObject(i.engineLayerId));\n\n    i.engineLayerReferences = (i.engineLayerReferences || 0) + 1, this._materialIdReferences = i.materialIdReferences, o(this._materialIdReferences) && (this._materialIdReferences = new Map(), i.materialIdReferences = this._materialIdReferences), this.camera.copyFrom(this.view.state.camera), this._attached = !0, this._updateEngineObject(), D(this._location.spatialReference, this.view.spatialReference) || (this.location = new X({\n      x: 0,\n      y: 0,\n      z: 0,\n      spatialReference: this.view.spatialReference\n    }));\n  }\n\n  detach(e = {\n    manipulator3D: {}\n  }) {\n    const t = e.manipulator3D;\n    t.engineLayerReferences--;\n    const i = 0 === t.engineLayerReferences;\n    i && (t.engineLayerId = null), this._removeResourcesFromStage(i), this._engineResources = null, this._engineLayer = null, this._materialIdReferences = null, this._attached = !1;\n  }\n\n  onViewChange() {\n    this.camera.copyFrom(this.view.state.camera), this._screenLocationDirty = !0, this._updateEngineObject();\n  }\n\n  onElevationChange(e) {\n    F(this.location, ge, e.spatialReference), I(e.extent, ge) && (this.location = this._location);\n  }\n\n  _evaluateElevationAlignment(e = this.location) {\n    if (o(this.elevationInfo)) return !1;\n    let t = null,\n        i = 0;\n    const s = r(this.elevationInfo.offset, 0);\n\n    switch (this.elevationInfo.mode) {\n      case \"on-the-ground\":\n        t = r(q(this.view.elevationProvider, e, \"ground\"), 0);\n        break;\n\n      case \"relative-to-ground\":\n        i = r(q(this.view.elevationProvider, e, \"ground\"), 0) + s;\n        break;\n\n      case \"relative-to-scene\":\n        i = r(q(this.view.elevationProvider, e, \"scene\"), 0) + s;\n        break;\n\n      case \"absolute-height\":\n        i = s;\n    }\n\n    return (i !== this._elevation.offset || t !== this._elevation.override) && (this._elevation.offset = i, this._elevation.override = t, !0);\n  }\n\n  _updateEngineObject() {\n    if (!this._attached) return;\n    if (!this.available) return void this._removeResourcesFromStage();\n\n    const e = this._getWorldToScreenObjectScale(),\n          t = ne;\n\n    if (!0 === this.autoScaleRenderObjects) {\n      const i = this._getFocusedSize(this._radius, this.focused) * e;\n\n      this._calculateObjectTransform(i, t);\n    } else this._calculateObjectTransform(e, t);\n\n    const {\n      objectsByState: i\n    } = this._ensureEngineResources(),\n          s = (this.focused ? 2 : 1) | (this.selected ? 8 : 4),\n          o = this._noDisplayCount > 0;\n\n    for (const {\n      stateMask: r,\n      objects: n\n    } of i) {\n      if (o) {\n        for (const e of n) e.setVisible(!1);\n\n        continue;\n      }\n\n      const e = !(0 != (15 & r)) || (s & r) == (15 & r),\n            i = !(0 != (65520 & r)) || (this.state & r) == (65520 & r);\n      if (e && i) for (const s of n) s.setVisible(!0), s.transformation = t;else for (const t of n) t.setVisible(!1);\n    }\n  }\n\n  _ensureEngineResources() {\n    if (o(this._engineResources)) {\n      const e = n(this._engineLayer),\n            t = [],\n            i = new Set();\n      this.renderObjects.forEach(({\n        material: e\n      }) => {\n        i.has(e) || (t.push(e), i.add(e));\n      });\n\n      const s = (e, t) => {\n        const {\n          geometry: i,\n          material: s,\n          transform: o\n        } = t;\n        Array.isArray(i) ? i.forEach(t => e.addGeometry(t, s, o)) : e.addGeometry(i, s, o);\n      },\n            o = new Map();\n\n      this._renderObjects.forEach(e => {\n        const t = new N({\n          castShadow: !1\n        });\n        s(t, e);\n        const i = e.stateMask || 0,\n              r = o.get(i) || [];\n        r.push(t), o.set(i, r);\n      });\n\n      const r = [];\n      o.forEach((e, t) => r.push({\n        stateMask: t,\n        objects: e\n      })), this._engineResources = {\n        objectsByState: r,\n        layer: e,\n        materials: t\n      };\n    }\n\n    return this._addResourcesToStage(), this._engineResources;\n  }\n\n  _addResourcesToStage() {\n    if (this._engineResourcesAddedToStage || o(this._engineResources)) return;\n    const {\n      objectsByState: e,\n      layer: t,\n      materials: i\n    } = this._engineResources;\n    i.forEach(e => {\n      const t = n(this._materialIdReferences),\n            i = t.get(e.id) || 0;\n      0 === i && this.view._stage.add(e), t.set(e.id, i + 1);\n    }), e.forEach(({\n      objects: e\n    }) => {\n      t.addMany(e), this.view._stage.addMany(e);\n    }), this._engineResourcesAddedToStage = !0;\n  }\n\n  _removeResourcesFromStage(e = !1) {\n    if (!this._engineResourcesAddedToStage || o(this._engineResources)) return;\n    const {\n      objectsByState: t,\n      layer: i,\n      materials: s\n    } = this._engineResources;\n    t.forEach(({\n      objects: e\n    }) => {\n      i.removeMany(e), this.view._stage.removeMany(e);\n    }), s.forEach(e => {\n      const t = n(this._materialIdReferences),\n            i = t.get(e.id);\n      1 === i ? (this.view._stage.remove(e), t.delete(e.id)) : t.set(e.id, i - 1);\n    }), e && this.view._stage.remove(i), this._engineResourcesAddedToStage = !1;\n  }\n\n  _getCollisionRadius(e) {\n    return this._getFocusedSize(this.radius, !0) * (\"touch\" === e ? this.touchMultiplier : 1);\n  }\n\n  _getFocusedSize(e, t) {\n    return e * (t ? this.focusMultiplier : 1);\n  }\n\n  _getWorldToScreenObjectScale() {\n    return this._worldSized ? 1 : this.screenLocation.pixelSize;\n  }\n\n  _calculateModelTransformPosition(e) {\n    const t = this._getWorldToScreenObjectScale(),\n          i = this._calculateObjectTransform(t, re);\n\n    return O(e, i[12], i[13], i[14]);\n  }\n\n  _calculateModelTransformOffset(e) {\n    const t = this._calculateModelTransformPosition(e);\n\n    return T(e, t, this.renderLocation);\n  }\n\n  _calculateObjectTransform(e, t) {\n    return m(t, e, 0, 0, 0, 0, e, 0, 0, 0, 0, e, 0, 0, 0, 0, 1), this._worldFrame && f(t, t, this._worldFrame), f(t, t, this._modelTransform), t[12] += this.renderLocation[0], t[13] += this.renderLocation[1], t[14] += this.renderLocation[2], t[15] = 1, s(this._applyObjectTransform) && this._applyObjectTransform(t), t;\n  }\n\n  get test() {\n    let e = !1;\n    if (s(this._engineResources)) for (const t in this._engineResources.objectsByState) {\n      const i = this._engineResources.objectsByState[t];\n\n      for (const t of i.objects) if (t.isVisible) {\n        e = !0;\n        break;\n      }\n\n      if (e) break;\n    }\n    return {\n      areAnyResourcesVisible: e\n    };\n  }\n\n}\n\nfunction $(e) {\n  return 0 !== e[12] || 0 !== e[13] || 0 !== e[14];\n}\n\nfunction ee(e, t, s) {\n  switch (e.viewingMode) {\n    case \"local\":\n      return p(s), !0;\n\n    case \"global\":\n      {\n        const o = P(e.renderCoordsHelper.spatialReference);\n        return z(t, 0, ce, 0, o.radius), k(i(ce[1]), i(ce[0]), s), !0;\n      }\n  }\n}\n\nconst te = a(),\n      ie = B(),\n      se = U(),\n      oe = _(),\n      re = v(),\n      ne = v(),\n      ae = H(),\n      ce = E(),\n      le = E(),\n      he = E(),\n      de = E(),\n      ue = E(),\n      _e = E(),\n      ge = new X({\n  x: 0,\n  y: 0,\n  z: 0,\n  spatialReference: null\n});\n\nexport { Y as Manipulator3D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/interactive/Manipulator3D.js"],"names":["neverReached","e","t","deg2rad","i","isSome","s","isNone","o","unwrapOr","r","unwrap","n","createScreenPointArray","a","createRenderScreenPointArray3","c","screenPointObjectToArray","l","castRenderScreenPointArray","h","once","d","f","u","_","g","m","p","v","j","b","y","L","S","R","w","O","T","E","Z","A","canProjectWithoutEngine","D","projectPoint","F","sphericalPCPFtoLonLatElevation","z","computeLatLonToENURotation","k","getReferenceEllipsoid","P","containsPointObject","I","distance2","M","fromPoints","C","closestRayDistance2","x","create","B","fromPositionAndNormal","W","intersectRay","V","H","U","sv3d","G","clonePoint","getElevationAtPoint","q","fromScreen","J","K","Object3D","N","WebGLLayer","Q","X","Y","constructor","idHint","camera","_elevation","offset","override","collisionType","type","collisionPriority","_renderObjects","autoScaleRenderObjects","_available","_noDisplayCount","_radius","_worldSized","focusMultiplier","touchMultiplier","worldOriented","_modelTransform","_worldFrame","_renderLocation","_renderLocationDirty","_location","_elevationAlignedLocation","_elevationAlignedLocationDirty","interactive","selectable","grabbable","cursor","_grabbing","dragging","_hovering","_selected","_state","_focused","events","EventEmitter","_screenLocation","screenPointArray","renderScreenPointArray","pixelSize","_screenLocationDirty","_applyObjectTransform","_engineResourcesAddedToStage","_engineResources","_attached","_engineLayer","_materialIdReferences","spatialReference","view","state","copyFrom","destroy","_removeResourcesFromStage","elevationInfo","_elevationInfo","_updateEngineObject","renderObjects","slice","available","disableDisplay","remove","radius","worldSized","modelTransform","$","renderLocation","renderCoordsHelper","toRenderCoords","elevationAlignedLocation","ee","fromRenderCoords","location","emit","_evaluateElevationAlignment","_updateElevationAlignedLocation","grabbableForEvent","grabbing","_setFocused","hovering","selected","action","updateStateEnabled","focused","screenLocation","ensureScreenLocation","computeScreenPixelSizeAt","_calculateModelTransformOffset","_e","projectToRenderScreen","renderToScreen","applyObjectTransform","intersectionDistance","te","_getCollisionRadius","paths","_getWorldToScreenObjectScale","_calculateObjectTransform","ne","se","length","ce","le","ie","get","direction","oe","de","ue","ae","he","_calculateModelTransformPosition","attach","manipulator3D","_stage","engineLayerId","isPickable","updatePolicy","add","id","getObject","engineLayerReferences","materialIdReferences","Map","detach","onViewChange","onElevationChange","ge","extent","mode","elevationProvider","_getFocusedSize","objectsByState","_ensureEngineResources","stateMask","objects","setVisible","transformation","Set","forEach","material","has","push","geometry","transform","Array","isArray","addGeometry","castShadow","set","layer","materials","_addResourcesToStage","addMany","removeMany","delete","re","test","isVisible","areAnyResourcesVisible","viewingMode","Manipulator3D"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../geometry.js\";import{neverReached as e}from\"../../../core/compilerUtils.js\";import t from\"../../../core/Evented.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{isSome as s,isNone as o,unwrapOr as r,unwrap as n}from\"../../../core/maybe.js\";import{createScreenPointArray as a,createRenderScreenPointArray3 as c,screenPointObjectToArray as l,castRenderScreenPointArray as h}from\"../../../core/screenUtils.js\";import{once as d}from\"../../../core/accessorSupport/utils.js\";import{f as u}from\"../../../chunks/mat3.js\";import{c as _}from\"../../../chunks/mat3f64.js\";import{d as g,h as m,m as f,i as p}from\"../../../chunks/mat4.js\";import{c as v}from\"../../../chunks/mat4f64.js\";import{j as b}from\"../../../chunks/vec2.js\";import{b as y,t as j,m as L,a as S,g as R,h as w,s as O,f as T}from\"../../../chunks/vec3.js\";import{c as E,Z as A}from\"../../../chunks/vec3f64.js\";import{canProjectWithoutEngine as D,projectPoint as F,sphericalPCPFtoLonLatElevation as z,computeLatLonToENURotation as k}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as P}from\"../../../geometry/projectionEllipsoid.js\";import{containsPointObject as I}from\"../../../geometry/support/aaBoundingRect.js\";import{distance2 as M,fromPoints as C,closestRayDistance2 as x,create as B}from\"../../../geometry/support/lineSegment.js\";import{fromPositionAndNormal as W,intersectRay as V,create as H}from\"../../../geometry/support/plane.js\";import{create as U}from\"../../../geometry/support/ray.js\";import{sv3d as G}from\"../../../geometry/support/vectorStacks.js\";import{clonePoint as Z}from\"../../../layers/graphics/hydratedFeatures.js\";import{getElevationAtPoint as q}from\"../support/ElevationProvider.js\";import{fromScreen as J}from\"../support/geometryUtils/ray.js\";import K from\"../webgl-engine/lib/Camera.js\";import{Object3D as N}from\"../webgl-engine/lib/Object3D.js\";import{WebGLLayer as Q}from\"../webgl-engine/lib/WebGLLayer.js\";import X from\"../../../geometry/Point.js\";class Y{constructor(e){this.idHint=0,this.camera=new K,this._elevation={offset:0,override:null},this.collisionType={type:\"point\"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=v(),this._worldFrame=null,this._renderLocation=E(),this._renderLocationDirty=!0,this._location=new X({x:0,y:0,z:0}),this._elevationAlignedLocation=new X,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new t.EventEmitter,this._screenLocation={screenPointArray:a(),renderScreenPointArray:c(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:d((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){$(e)&&(this._screenLocationDirty=!0),g(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=v()),ee(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Z(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit(\"location-update\",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Z(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit(\"location-update\",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=s(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit(\"select-changed\",{action:e?\"select\":\"deselect\"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit(\"focus-changed\",{action:!0===e?\"focus\":\"unfocus\"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if($(this._modelTransform)){const t=this._calculateModelTransformOffset(_e);e=y(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(t,i){if(!this.available)return null;const s=l(t,te),r=this._getCollisionRadius(i),n=-1*this.collisionPriority;switch(this.collisionType.type){case\"point\":if(b(this.screenLocation.screenPointArray,s)<r*r)return this.screenLocation.renderScreenPointArray[2]+n;break;case\"line\":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,ne),a=r*this.screenLocation.pixelSize,c=J(this.camera,s,se);if(o(c))return null;for(const s of e){if(0===s.length)continue;const e=L(ce,s[0],i);for(let t=1;t<s.length;t++){const o=L(le,s[t],i),r=x(C(e,o,ie),c);if(null!=r&&r<a*a){const t=y(G.get(),e,o);S(t,t,.5);const i=h(G.get());return this.camera.projectToRenderScreen(t,i),i[2]+n}R(e,o)}}break}case\"disc\":{var a;const e=this.collisionType.direction,t=null!=(a=this.collisionType.offset)?a:A,i=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(i,ne),l=r*this.screenLocation.pixelSize,h=J(this.camera,s,se);if(o(h))return null;const d=u(oe,c),_=j(de,e,d),g=L(ue,t,c);W(g,_,ae);const m=he;if(V(ae,h,m)&&w(m,g)<l*l)return this.screenLocation.renderScreenPointArray[2]+n;break}case\"ribbon\":{const{paths:e,direction:t}=this.collisionType,i=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(i,ne),c=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=J(this.camera,s,se);if(o(l))return null;const d=u(oe,a),_=j(de,t,d),g=this._calculateModelTransformPosition(ue);W(g,_,ae);const m=he;if(!V(ae,l,m))break;for(const s of e){if(0===s.length)continue;const e=L(ce,s[0],a);for(let t=1;t<s.length;t++){const i=L(le,s[t],a),o=M(C(e,i,ie),m);if(null!=o&&o<c*c){const t=y(G.get(),e,i);S(t,t,.5);const s=h(G.get());return this.camera.projectToRenderScreen(t,s),s[2]+n}R(e,i)}}break}default:e(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(o(i.engineLayerId)){const e=new Q({isPickable:!1,updatePolicy:1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,o(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),D(this._location.spatialReference,this.view.spatialReference)||(this.location=new X({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){F(this.location,ge,e.spatialReference),I(e.extent,ge)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(o(this.elevationInfo))return!1;let t=null,i=0;const s=r(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case\"on-the-ground\":t=r(q(this.view.elevationProvider,e,\"ground\"),0);break;case\"relative-to-ground\":i=r(q(this.view.elevationProvider,e,\"ground\"),0)+s;break;case\"relative-to-scene\":i=r(q(this.view.elevationProvider,e,\"scene\"),0)+s;break;case\"absolute-height\":i=s}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=ne;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),s=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0;for(const{stateMask:r,objects:n}of i){if(o){for(const e of n)e.setVisible(!1);continue}const e=!(0!=(15&r))||(s&r)==(15&r),i=!(0!=(65520&r))||(this.state&r)==(65520&r);if(e&&i)for(const s of n)s.setVisible(!0),s.transformation=t;else for(const t of n)t.setVisible(!1)}}_ensureEngineResources(){if(o(this._engineResources)){const e=n(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));const s=(e,t)=>{const{geometry:i,material:s,transform:o}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,s,o))):e.addGeometry(i,s,o)},o=new Map;this._renderObjects.forEach((e=>{const t=new N({castShadow:!1});s(t,e);const i=e.stateMask||0,r=o.get(i)||[];r.push(t),o.set(i,r)}));const r=[];o.forEach(((e,t)=>r.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||o(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=n(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||o(this._engineResources))return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),s.forEach((e=>{const t=n(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(\"touch\"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,re);return O(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return T(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return m(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&f(t,t,this._worldFrame),f(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,s(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(s(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function $(e){return 0!==e[12]||0!==e[13]||0!==e[14]}function ee(e,t,s){switch(e.viewingMode){case\"local\":return p(s),!0;case\"global\":{const o=P(e.renderCoordsHelper.spatialReference);return z(t,0,ce,0,o.radius),k(i(ce[1]),i(ce[0]),s),!0}}}const te=a(),ie=B(),se=U(),oe=_(),re=v(),ne=v(),ae=H(),ce=E(),le=E(),he=E(),de=E(),ue=E(),_e=E(),ge=new X({x:0,y:0,z:0,spatialReference:null});export{Y as Manipulator3D};\n"]},"metadata":{},"sourceType":"module"}