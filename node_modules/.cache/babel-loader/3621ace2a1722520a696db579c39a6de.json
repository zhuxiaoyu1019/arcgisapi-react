{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { clamp as t, sign as e } from \"../../../../core/mathUtils.js\";\nimport { isSome as r } from \"../../../../core/maybe.js\";\nimport { g as n, a as o } from \"../../../../chunks/vec3.js\";\nimport { c as i } from \"../../../../chunks/vec3f64.js\";\nimport { wrap as s } from \"../../../../geometry/support/ray.js\";\nimport { defaultApplyOptions as c, interactionDirectionTowardsConstraintMinimization as a, hasConstraintType as m, adjustRangeForInteraction as u } from \"./common.js\";\nimport { closestPointOnRay as f } from \"../../support/intersectionUtils.js\";\n\nfunction p(t, o, i = c) {\n  const m = d(t, o, i);\n  if (0 === m) return !1;\n  const u = t.renderCoordsHelper,\n        p = u.getAltitude(o.eye) + m,\n        l = a(o, i.interactionDirection, j(t, o, e(m), C), A),\n        y = n(h, o.viewForward),\n        x = u.intersectInfiniteManifold(s(o.eye, l), p, H);\n  return o.eye = r(x) ? x : u.setAltitude(H, p, o.eye), o.center = f(H, o.eye, y, o.center), !0;\n}\n\nfunction d(e, r, n = c) {\n  if (!l(e, n)) return 0;\n  const o = x(e.state.constraints.altitude, g);\n  y(e, n, o);\n  const i = e.renderCoordsHelper.getAltitude(r.eye),\n        s = t(i, o.min, o.max) - i;\n  return Math.abs(s) <= 1e-6 ? 0 : s;\n}\n\nfunction l(t, e) {\n  const r = t.state.constraints.altitude;\n  return !(!t.state.isGlobal || !r) && (2 !== e.interactionType || !m(e.selection, 1));\n}\n\nfunction y(t, e, r) {\n  const n = e.interactionType;\n  if (0 === n) return;\n  const {\n    min: o,\n    max: i\n  } = r,\n        {\n    interactionStartCamera: s,\n    interactionFactor: c\n  } = e,\n        a = 2 === n || 1 === n,\n        m = d(t, s),\n        f = 0 === m ? 0 : t.renderCoordsHelper.getAltitude(s.eye);\n  r.min = o, r.max = i;\n  u(m, f, a, c, .05 * f, r);\n}\n\nfunction j(t, e, r, n) {\n  return t.renderCoordsHelper.worldUpAtPosition(e.eye, n), o(n, n, r), n;\n}\n\nfunction x(t, e) {\n  return e.min = t.min, e.max = t.max, e;\n}\n\nconst g = {\n  min: 0,\n  max: 0\n},\n      A = i(),\n      C = i(),\n      h = i(),\n      H = i();\nexport { p as applyAltitudeConstraint, d as getAltitudeConstraintError };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/camera/constraintUtils/altitude.js"],"names":["clamp","t","sign","e","isSome","r","g","n","a","o","c","i","wrap","s","defaultApplyOptions","interactionDirectionTowardsConstraintMinimization","hasConstraintType","m","adjustRangeForInteraction","u","closestPointOnRay","f","p","d","renderCoordsHelper","getAltitude","eye","l","interactionDirection","j","C","A","y","h","viewForward","x","intersectInfiniteManifold","H","setAltitude","center","state","constraints","altitude","min","max","Math","abs","isGlobal","interactionType","selection","interactionStartCamera","interactionFactor","worldUpAtPosition","applyAltitudeConstraint","getAltitudeConstraintError"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{clamp as t,sign as e}from\"../../../../core/mathUtils.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{g as n,a as o}from\"../../../../chunks/vec3.js\";import{c as i}from\"../../../../chunks/vec3f64.js\";import{wrap as s}from\"../../../../geometry/support/ray.js\";import{defaultApplyOptions as c,interactionDirectionTowardsConstraintMinimization as a,hasConstraintType as m,adjustRangeForInteraction as u}from\"./common.js\";import{closestPointOnRay as f}from\"../../support/intersectionUtils.js\";function p(t,o,i=c){const m=d(t,o,i);if(0===m)return!1;const u=t.renderCoordsHelper,p=u.getAltitude(o.eye)+m,l=a(o,i.interactionDirection,j(t,o,e(m),C),A),y=n(h,o.viewForward),x=u.intersectInfiniteManifold(s(o.eye,l),p,H);return o.eye=r(x)?x:u.setAltitude(H,p,o.eye),o.center=f(H,o.eye,y,o.center),!0}function d(e,r,n=c){if(!l(e,n))return 0;const o=x(e.state.constraints.altitude,g);y(e,n,o);const i=e.renderCoordsHelper.getAltitude(r.eye),s=t(i,o.min,o.max)-i;return Math.abs(s)<=1e-6?0:s}function l(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(2!==e.interactionType||!m(e.selection,1))}function y(t,e,r){const n=e.interactionType;if(0===n)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=e,a=2===n||1===n,m=d(t,s),f=0===m?0:t.renderCoordsHelper.getAltitude(s.eye);r.min=o,r.max=i;u(m,f,a,c,.05*f,r)}function j(t,e,r,n){return t.renderCoordsHelper.worldUpAtPosition(e.eye,n),o(n,n,r),n}function x(t,e){return e.min=t.min,e.max=t.max,e}const g={min:0,max:0},A=i(),C=i(),h=i(),H=i();export{p as applyAltitudeConstraint,d as getAltitudeConstraintError};\n"]},"metadata":{},"sourceType":"module"}