{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport { unwrap as r } from \"../../../core/maybe.js\";\nimport { whenTrueOnce as t } from \"../../../core/watchUtils.js\";\nimport { property as i } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as s } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { LayerView3D as a } from \"./LayerView3D.js\";\nimport { TiledLayerView3D as l } from \"./TiledLayerView3D.js\";\nimport o from \"../terrain/RasterTile.js\";\nimport { ImageryTileLayerView as n } from \"../../layers/ImageryTileLayerView.js\";\nimport m from \"../../layers/LayerView.js\";\nimport { RefreshableLayerView as d } from \"../../layers/RefreshableLayerView.js\";\nimport { createQueryGeometry as h } from \"../../support/drapedUtils.js\";\nimport p from \"../../webgl/capabilities.js\";\nlet y = class extends n(d(l(a(m)))) {\n  constructor() {\n    super(...arguments), this.type = \"imagery-tile-3d\", this.isAlignedMapTile = !0;\n  }\n\n  initialize() {\n    this.layer.increaseRasterJobHandlerUsage();\n    const e = this.updateFullExtent();\n    this.addResolvingPromise(e);\n    const r = t(this.view, \"basemapTerrain.tilingSchemeLocked\").then(() => {\n      const e = this.view.basemapTerrain.tilingScheme,\n            {\n        tileInfo: r\n      } = this.layer,\n            t = [\"png\", \"png24\", \"png32\", \"jpg\", \"mixed\"].indexOf(r.format) > -1 && e.compatibleWith(r);\n      this.isAlignedMapTile = t;\n      const i = t ? r : e.toTileInfo();\n      this._set(\"tileInfo\", i), this.updatingHandles.add(this, \"layer.renderer\", () => this.refresh()), this.updatingHandles.add(this, \"layer.interpolation\", () => this.refresh()), this.updatingHandles.add(this, \"layer.bandIds\", () => this.refresh()), this.updatingHandles.add(this, \"layer.multidimensionalDefinition\", () => this.refresh());\n    });\n    this.addResolvingPromise(r);\n  }\n\n  destroy() {\n    this.layer.decreaseRasterJobHandlerUsage(), this.view = null;\n  }\n\n  get _blankTile() {\n    const e = document.createElement(\"canvas\"),\n          r = e.getContext(\"2d\"),\n          [t, i] = this.tileInfo.size;\n    return e.width = t, e.height = i, r.clearRect(0, 0, t, i), r.getImageData(0, 0, t, i);\n  }\n\n  get imageFormatIsOpaque() {\n    return \"jpg\" === this.layer.tileInfo.format;\n  }\n\n  get hasMixedImageFormats() {\n    return \"mixed\" === this.layer.tileInfo.format;\n  }\n\n  get dataLevelRange() {\n    const e = this.tileInfo.lods,\n          r = this.layer.tileInfo.lods,\n          t = e[0].scale,\n          i = r[r.length - 1].scale;\n    return this.levelRangeFromScaleRange(t, i);\n  }\n\n  async fetchTile(e, t, i, s) {\n    const a = this.tileInfo,\n          l = this._canSymbolizeInWebGL(),\n          n = {\n      tileInfo: a,\n      requestRawData: l,\n      signal: r(s.signal),\n      requestAsImageElement: this.isAlignedMapTile\n    },\n          m = await this.layer.fetchTile(e, t, i, n);\n\n    if (m instanceof HTMLImageElement) return m;\n    let d = m && m.pixelBlock;\n    if (!d) return this._blankTile;\n    if (!l && (d = await this.layer.applyRenderer(m), null == d)) return this._blankTile;\n    const h = new o([e, t, i], d, a.size[0], a.size[1]);\n    return l ? (h.symbolizerRenderer = this.layer.symbolizer.rendererJSON, h.symbolizerParameters = this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)), h.transformGrid = m.transformGrid) : h.isRendereredSource = !0, h.interpolation = this.layer.interpolation, h.bandIds = this.layer.bandIds, h;\n  }\n\n  _getSymbolizerOptions(e) {\n    const r = this.tileInfo.lodAt(e).resolution;\n    return {\n      pixelBlock: null,\n      isGCS: this.view.spatialReference.isGeographic,\n      resolution: {\n        x: r,\n        y: r\n      },\n      bandIds: this.layer.bandIds\n    };\n  }\n\n  ensureSymbolizerParameters(e) {\n    this._canSymbolizeInWebGL() && JSON.stringify(e.symbolizerRenderer) !== JSON.stringify(this.layer.symbolizer.rendererJSON) && (e.symbolizerParameters = this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])));\n  }\n\n  createFetchPopupFeaturesQueryGeometry(e, r) {\n    return h(e, r, this.view);\n  }\n\n  refresh() {\n    this.emit(\"data-changed\");\n  }\n\n  async doRefresh(e) {\n    this.suspended || this.emit(\"data-changed\");\n  }\n\n  _canSymbolizeInWebGL() {\n    return p().supportsTextureFloat && this.layer.symbolizer.canRenderInWebGL;\n  }\n\n};\ne([i({\n  readOnly: !0\n})], y.prototype, \"_blankTile\", null), e([i({\n  readOnly: !0\n})], y.prototype, \"imageFormatIsOpaque\", null), e([i({\n  readOnly: !0\n})], y.prototype, \"hasMixedImageFormats\", null), e([i({\n  readOnly: !0\n})], y.prototype, \"dataLevelRange\", null), y = e([s(\"esri.views.3d.layers.ImageryTileLayerView3D\")], y);\nvar c = y;\nexport default c;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/ImageryTileLayerView3D.js"],"names":["_","e","unwrap","r","whenTrueOnce","t","property","i","subclass","s","LayerView3D","a","TiledLayerView3D","l","o","ImageryTileLayerView","n","m","RefreshableLayerView","d","createQueryGeometry","h","p","y","constructor","arguments","type","isAlignedMapTile","initialize","layer","increaseRasterJobHandlerUsage","updateFullExtent","addResolvingPromise","view","then","basemapTerrain","tilingScheme","tileInfo","indexOf","format","compatibleWith","toTileInfo","_set","updatingHandles","add","refresh","destroy","decreaseRasterJobHandlerUsage","_blankTile","document","createElement","getContext","size","width","height","clearRect","getImageData","imageFormatIsOpaque","hasMixedImageFormats","dataLevelRange","lods","scale","length","levelRangeFromScaleRange","fetchTile","_canSymbolizeInWebGL","requestRawData","signal","requestAsImageElement","HTMLImageElement","pixelBlock","applyRenderer","symbolizerRenderer","symbolizer","rendererJSON","symbolizerParameters","generateWebGLParameters","_getSymbolizerOptions","transformGrid","isRendereredSource","interpolation","bandIds","lodAt","resolution","isGCS","spatialReference","isGeographic","x","ensureSymbolizerParameters","JSON","stringify","lij","createFetchPopupFeaturesQueryGeometry","emit","doRefresh","suspended","supportsTextureFloat","canRenderInWebGL","readOnly","prototype","c"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{unwrap as r}from\"../../../core/maybe.js\";import{whenTrueOnce as t}from\"../../../core/watchUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as a}from\"./LayerView3D.js\";import{TiledLayerView3D as l}from\"./TiledLayerView3D.js\";import o from\"../terrain/RasterTile.js\";import{ImageryTileLayerView as n}from\"../../layers/ImageryTileLayerView.js\";import m from\"../../layers/LayerView.js\";import{RefreshableLayerView as d}from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as h}from\"../../support/drapedUtils.js\";import p from\"../../webgl/capabilities.js\";let y=class extends(n(d(l(a(m))))){constructor(){super(...arguments),this.type=\"imagery-tile-3d\",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage();const e=this.updateFullExtent();this.addResolvingPromise(e);const r=t(this.view,\"basemapTerrain.tilingSchemeLocked\").then((()=>{const e=this.view.basemapTerrain.tilingScheme,{tileInfo:r}=this.layer,t=[\"png\",\"png24\",\"png32\",\"jpg\",\"mixed\"].indexOf(r.format)>-1&&e.compatibleWith(r);this.isAlignedMapTile=t;const i=t?r:e.toTileInfo();this._set(\"tileInfo\",i),this.updatingHandles.add(this,\"layer.renderer\",(()=>this.refresh())),this.updatingHandles.add(this,\"layer.interpolation\",(()=>this.refresh())),this.updatingHandles.add(this,\"layer.bandIds\",(()=>this.refresh())),this.updatingHandles.add(this,\"layer.multidimensionalDefinition\",(()=>this.refresh()))}));this.addResolvingPromise(r)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement(\"canvas\"),r=e.getContext(\"2d\"),[t,i]=this.tileInfo.size;return e.width=t,e.height=i,r.clearRect(0,0,t,i),r.getImageData(0,0,t,i)}get imageFormatIsOpaque(){return\"jpg\"===this.layer.tileInfo.format}get hasMixedImageFormats(){return\"mixed\"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,r=this.layer.tileInfo.lods,t=e[0].scale,i=r[r.length-1].scale;return this.levelRangeFromScaleRange(t,i)}async fetchTile(e,t,i,s){const a=this.tileInfo,l=this._canSymbolizeInWebGL(),n={tileInfo:a,requestRawData:l,signal:r(s.signal),requestAsImageElement:this.isAlignedMapTile},m=await this.layer.fetchTile(e,t,i,n);if(m instanceof HTMLImageElement)return m;let d=m&&m.pixelBlock;if(!d)return this._blankTile;if(!l&&(d=await this.layer.applyRenderer(m),null==d))return this._blankTile;const h=new o([e,t,i],d,a.size[0],a.size[1]);return l?(h.symbolizerRenderer=this.layer.symbolizer.rendererJSON,h.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),h.transformGrid=m.transformGrid):h.isRendereredSource=!0,h.interpolation=this.layer.interpolation,h.bandIds=this.layer.bandIds,h}_getSymbolizerOptions(e){const r=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:r,y:r},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,r){return h(e,r,this.view)}refresh(){this.emit(\"data-changed\")}async doRefresh(e){this.suspended||this.emit(\"data-changed\")}_canSymbolizeInWebGL(){return p().supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};e([i({readOnly:!0})],y.prototype,\"_blankTile\",null),e([i({readOnly:!0})],y.prototype,\"imageFormatIsOpaque\",null),e([i({readOnly:!0})],y.prototype,\"hasMixedImageFormats\",null),e([i({readOnly:!0})],y.prototype,\"dataLevelRange\",null),y=e([s(\"esri.views.3d.layers.ImageryTileLayerView3D\")],y);var c=y;export default c;\n"]},"metadata":{},"sourceType":"module"}