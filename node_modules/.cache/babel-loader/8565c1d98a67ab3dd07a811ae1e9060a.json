{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { ForwardLinearDepth as e } from \"../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl.js\";\nimport { Slice as r } from \"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";\nimport { Transform as a } from \"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";\nimport { OutputHighlight as o } from \"../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";\nimport { ReadLinearDepth as i } from \"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";\nimport { multipassTerrainTest as t } from \"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";\nimport { NormalUtils as n } from \"../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl.js\";\nimport { ReadShadowMap as d } from \"../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js\";\nimport { Water as l } from \"../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl.js\";\nimport { WaterDistortion as s } from \"../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl.js\";\nimport { symbolAlphaCutoff as v } from \"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";\nimport { ColorConversion as g } from \"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";\nimport { glsl as c } from \"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";\nimport { ShaderBuilder as m } from \"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";\n\nfunction p(p) {\n  const u = new m();\n  return u.include(a, {\n    linearDepth: !1\n  }), u.attributes.add(\"position\", \"vec3\"), u.attributes.add(\"uv0\", \"vec2\"), u.vertex.uniforms.add(\"proj\", \"mat4\").add(\"view\", \"mat4\").add(\"localOrigin\", \"vec3\"), u.vertex.uniforms.add(\"waterColor\", \"vec4\"), 0 !== p.output && 7 !== p.output || (u.include(n, p), u.include(e, p), u.varyings.add(\"vuv\", \"vec2\"), u.varyings.add(\"vpos\", \"vec3\"), u.varyings.add(\"vnormal\", \"vec3\"), u.varyings.add(\"vtbnMatrix\", \"mat3\"), p.multipassTerrainEnabled && u.varyings.add(\"depth\", \"float\"), u.vertex.code.add(c`\n      void main(void) {\n        if (waterColor.a < ${c.float(v)}) {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ${p.multipassTerrainEnabled ? \"depth = (view * vec4(vpos, 1.0)).z;\" : \"\"}\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ${0 === p.output ? \"forwardLinearDepth();\" : \"\"}\n      }\n    `)), p.multipassTerrainEnabled && (u.fragment.include(i), u.include(t, p)), 7 === p.output && (u.include(r, p), u.fragment.uniforms.add(\"waterColor\", \"vec4\"), u.fragment.code.add(c`\n        void main() {\n          discardBySlice(vpos);\n          ${p.multipassTerrainEnabled ? \"terrainDepthTest(gl_FragCoord, depth);\" : \"\"}\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      `)), 0 === p.output && (u.include(s, p), u.include(r, p), p.receiveShadows && u.include(d, p), u.include(l, p), u.fragment.uniforms.add(\"waterColor\", \"vec4\").add(\"lightingMainDirection\", \"vec3\").add(\"lightingMainIntensity\", \"vec3\").add(\"camPos\", \"vec3\").add(\"timeElapsed\", \"float\").add(\"view\", \"mat4\"), u.fragment.include(g), u.fragment.code.add(c`\n      void main() {\n        discardBySlice(vpos);\n        ${p.multipassTerrainEnabled ? \"terrainDepthTest(gl_FragCoord, depth);\" : \"\"}\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        float shadow = ${p.receiveShadows ? c`1.0 - readShadowMap(vpos, linearDepth)` : \"1.0\"};\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ${p.OITEnabled ? \"gl_FragColor = premultiplyAlpha(gl_FragColor);\" : \"\"}\n      }\n    `)), 2 === p.output && (u.include(n, p), u.include(s, p), u.include(r, p), u.varyings.add(\"vpos\", \"vec3\"), u.varyings.add(\"vuv\", \"vec2\"), u.vertex.code.add(c`\n        void main(void) {\n          if (waterColor.a < ${c.float(v)}) {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    `), u.fragment.uniforms.add(\"timeElapsed\", \"float\"), u.fragment.code.add(c`void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}`)), 5 === p.output && (u.varyings.add(\"vpos\", \"vec3\"), u.vertex.code.add(c`\n        void main(void) {\n          if (waterColor.a < ${c.float(v)}) {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    `), u.fragment.uniforms.add(\"waterColor\", \"vec4\"), u.fragment.code.add(c`void main() {\ngl_FragColor = waterColor;\n}`)), 4 === p.output && (u.include(o), u.varyings.add(\"vpos\", \"vec3\"), u.vertex.code.add(c`\n      void main(void) {\n        if (waterColor.a < ${c.float(v)}) {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    `), u.include(r, p), u.fragment.code.add(c`void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}`)), u;\n}\n\nvar u = Object.freeze({\n  __proto__: null,\n  build: p\n});\nexport { u as W, p as b };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/chunks/WaterSurface.glsl.js"],"names":["ForwardLinearDepth","e","Slice","r","Transform","a","OutputHighlight","o","ReadLinearDepth","i","multipassTerrainTest","t","NormalUtils","n","ReadShadowMap","d","Water","l","WaterDistortion","s","symbolAlphaCutoff","v","ColorConversion","g","glsl","c","ShaderBuilder","m","p","u","include","linearDepth","attributes","add","vertex","uniforms","output","varyings","multipassTerrainEnabled","code","float","fragment","receiveShadows","OITEnabled","Object","freeze","__proto__","build","W","b"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,kBAAkB,IAAIC,CAA7B,QAAmC,wEAAnC;AAA4G,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,2DAAtB;AAAkF,SAAOC,SAAS,IAAIC,CAApB,QAA0B,+DAA1B;AAA0F,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,4EAAhC;AAA6G,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,4EAAhC;AAA6G,SAAOC,oBAAoB,IAAIC,CAA/B,QAAqC,kFAArC;AAAwH,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,yEAA5B;AAAsG,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,2EAA9B;AAA0G,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,mEAAtB;AAA0F,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,6EAAhC;AAA8G,SAAOC,iBAAiB,IAAIC,CAA5B,QAAkC,uEAAlC;AAA0G,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,0EAAhC;AAA2G,SAAOC,IAAI,IAAIC,CAAf,QAAqB,2DAArB;AAAiF,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,8DAA9B;;AAA6F,SAASC,CAAT,CAAWA,CAAX,EAAa;AAAC,QAAMC,CAAC,GAAC,IAAIF,CAAJ,EAAR;AAAc,SAAOE,CAAC,CAACC,OAAF,CAAUzB,CAAV,EAAY;AAAC0B,IAAAA,WAAW,EAAC,CAAC;AAAd,GAAZ,GAA8BF,CAAC,CAACG,UAAF,CAAaC,GAAb,CAAiB,UAAjB,EAA4B,MAA5B,CAA9B,EAAkEJ,CAAC,CAACG,UAAF,CAAaC,GAAb,CAAiB,KAAjB,EAAuB,MAAvB,CAAlE,EAAiGJ,CAAC,CAACK,MAAF,CAASC,QAAT,CAAkBF,GAAlB,CAAsB,MAAtB,EAA6B,MAA7B,EAAqCA,GAArC,CAAyC,MAAzC,EAAgD,MAAhD,EAAwDA,GAAxD,CAA4D,aAA5D,EAA0E,MAA1E,CAAjG,EAAmLJ,CAAC,CAACK,MAAF,CAASC,QAAT,CAAkBF,GAAlB,CAAsB,YAAtB,EAAmC,MAAnC,CAAnL,EAA8N,MAAIL,CAAC,CAACQ,MAAN,IAAc,MAAIR,CAAC,CAACQ,MAApB,KAA6BP,CAAC,CAACC,OAAF,CAAUjB,CAAV,EAAYe,CAAZ,GAAeC,CAAC,CAACC,OAAF,CAAU7B,CAAV,EAAY2B,CAAZ,CAAf,EAA8BC,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,KAAf,EAAqB,MAArB,CAA9B,EAA2DJ,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,MAAf,EAAsB,MAAtB,CAA3D,EAAyFJ,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,SAAf,EAAyB,MAAzB,CAAzF,EAA0HJ,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,YAAf,EAA4B,MAA5B,CAA1H,EAA8JL,CAAC,CAACU,uBAAF,IAA2BT,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,OAAf,EAAuB,OAAvB,CAAzL,EAAyNJ,CAAC,CAACK,MAAF,CAASK,IAAT,CAAcN,GAAd,CAAkBR,CAAE;AACh5D;AACA,6BAA6BA,CAAC,CAACe,KAAF,CAAQnB,CAAR,CAAW;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAUO,CAAC,CAACU,uBAAF,GAA0B,qCAA1B,GAAgE,EAAG;AAC7E;AACA;AACA,UAAU,MAAIV,CAAC,CAACQ,MAAN,GAAa,uBAAb,GAAqC,EAAG;AAClD;AACA,KAnB43D,CAAtP,CAA9N,EAmBh6CR,CAAC,CAACU,uBAAF,KAA4BT,CAAC,CAACY,QAAF,CAAWX,OAAX,CAAmBrB,CAAnB,GAAsBoB,CAAC,CAACC,OAAF,CAAUnB,CAAV,EAAYiB,CAAZ,CAAlD,CAnBg6C,EAmB91C,MAAIA,CAAC,CAACQ,MAAN,KAAeP,CAAC,CAACC,OAAF,CAAU3B,CAAV,EAAYyB,CAAZ,GAAeC,CAAC,CAACY,QAAF,CAAWN,QAAX,CAAoBF,GAApB,CAAwB,YAAxB,EAAqC,MAArC,CAAf,EAA4DJ,CAAC,CAACY,QAAF,CAAWF,IAAX,CAAgBN,GAAhB,CAAoBR,CAAE;AAC3K;AACA;AACA,YAAYG,CAAC,CAACU,uBAAF,GAA0B,wCAA1B,GAAmE,EAAG;AAClF;AACA;AACA;AACA,OAPqJ,CAA3E,CAnB81C,EA0B95C,MAAIV,CAAC,CAACQ,MAAN,KAAeP,CAAC,CAACC,OAAF,CAAUX,CAAV,EAAYS,CAAZ,GAAeC,CAAC,CAACC,OAAF,CAAU3B,CAAV,EAAYyB,CAAZ,CAAf,EAA8BA,CAAC,CAACc,cAAF,IAAkBb,CAAC,CAACC,OAAF,CAAUf,CAAV,EAAYa,CAAZ,CAAhD,EAA+DC,CAAC,CAACC,OAAF,CAAUb,CAAV,EAAYW,CAAZ,CAA/D,EAA8EC,CAAC,CAACY,QAAF,CAAWN,QAAX,CAAoBF,GAApB,CAAwB,YAAxB,EAAqC,MAArC,EAA6CA,GAA7C,CAAiD,uBAAjD,EAAyE,MAAzE,EAAiFA,GAAjF,CAAqF,uBAArF,EAA6G,MAA7G,EAAqHA,GAArH,CAAyH,QAAzH,EAAkI,MAAlI,EAA0IA,GAA1I,CAA8I,aAA9I,EAA4J,OAA5J,EAAqKA,GAArK,CAAyK,MAAzK,EAAgL,MAAhL,CAA9E,EAAsQJ,CAAC,CAACY,QAAF,CAAWX,OAAX,CAAmBP,CAAnB,CAAtQ,EAA4RM,CAAC,CAACY,QAAF,CAAWF,IAAX,CAAgBN,GAAhB,CAAoBR,CAAE;AAC3U;AACA;AACA,UAAUG,CAAC,CAACU,uBAAF,GAA0B,wCAA1B,GAAmE,EAAG;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyBV,CAAC,CAACc,cAAF,GAAiBjB,CAAE,wCAAnB,GAA2D,KAAM;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA,UAAUG,CAAC,CAACe,UAAF,GAAa,gDAAb,GAA8D,EAAG;AAC3E;AACA,KApBqT,CAA3S,CA1B85C,EA8Ch6C,MAAIf,CAAC,CAACQ,MAAN,KAAeP,CAAC,CAACC,OAAF,CAAUjB,CAAV,EAAYe,CAAZ,GAAeC,CAAC,CAACC,OAAF,CAAUX,CAAV,EAAYS,CAAZ,CAAf,EAA8BC,CAAC,CAACC,OAAF,CAAU3B,CAAV,EAAYyB,CAAZ,CAA9B,EAA6CC,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,MAAf,EAAsB,MAAtB,CAA7C,EAA2EJ,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,KAAf,EAAqB,MAArB,CAA3E,EAAwGJ,CAAC,CAACK,MAAF,CAASK,IAAT,CAAcN,GAAd,CAAkBR,CAAE;AACnJ;AACA,+BAA+BA,CAAC,CAACe,KAAF,CAAQnB,CAAR,CAAW;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAb+H,CAAxG,EAahBQ,CAAC,CAACY,QAAF,CAAWN,QAAX,CAAoBF,GAApB,CAAwB,aAAxB,EAAsC,OAAtC,CAbgB,EAa+BJ,CAAC,CAACY,QAAF,CAAWF,IAAX,CAAgBN,GAAhB,CAAoBR,CAAE;AAC5E;AACA;AACA;AACA;AACA,EALsD,CAb9C,CA9Cg6C,EAgEn6C,MAAIG,CAAC,CAACQ,MAAN,KAAeP,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,MAAf,EAAsB,MAAtB,GAA8BJ,CAAC,CAACK,MAAF,CAASK,IAAT,CAAcN,GAAd,CAAkBR,CAAE;AACtE;AACA,+BAA+BA,CAAC,CAACe,KAAF,CAAQnB,CAAR,CAAW;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAXkD,CAA9B,EAWbQ,CAAC,CAACY,QAAF,CAAWN,QAAX,CAAoBF,GAApB,CAAwB,YAAxB,EAAqC,MAArC,CAXa,EAWgCJ,CAAC,CAACY,QAAF,CAAWF,IAAX,CAAgBN,GAAhB,CAAoBR,CAAE;AAC1E;AACA,EAFoD,CAX/C,CAhEm6C,EA6En6C,MAAIG,CAAC,CAACQ,MAAN,KAAeP,CAAC,CAACC,OAAF,CAAUvB,CAAV,GAAasB,CAAC,CAACQ,QAAF,CAAWJ,GAAX,CAAe,MAAf,EAAsB,MAAtB,CAAb,EAA2CJ,CAAC,CAACK,MAAF,CAASK,IAAT,CAAcN,GAAd,CAAkBR,CAAE;AACnF;AACA,6BAA6BA,CAAC,CAACe,KAAF,CAAQnB,CAAR,CAAW;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAX+D,CAA3C,EAWbQ,CAAC,CAACC,OAAF,CAAU3B,CAAV,EAAYyB,CAAZ,CAXa,EAWEC,CAAC,CAACY,QAAF,CAAWF,IAAX,CAAgBN,GAAhB,CAAoBR,CAAE;AAC5C;AACA;AACA,EAHsB,CAXjB,CA7Em6C,EA2Fn6CI,CA3F45C;AA2F15C;;AAAA,IAAIA,CAAC,GAACe,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,SAAS,EAAC,IAAX;AAAgBC,EAAAA,KAAK,EAACnB;AAAtB,CAAd,CAAN;AAA8C,SAAOC,CAAC,IAAImB,CAAZ,EAAcpB,CAAC,IAAIqB,CAAnB","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{ForwardLinearDepth as e}from\"../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl.js\";import{Slice as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as a}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{OutputHighlight as o}from\"../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";import{ReadLinearDepth as i}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as t}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{NormalUtils as n}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl.js\";import{ReadShadowMap as d}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js\";import{Water as l}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl.js\";import{WaterDistortion as s}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl.js\";import{symbolAlphaCutoff as v}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as g}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as c}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as m}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function p(p){const u=new m;return u.include(a,{linearDepth:!1}),u.attributes.add(\"position\",\"vec3\"),u.attributes.add(\"uv0\",\"vec2\"),u.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\").add(\"localOrigin\",\"vec3\"),u.vertex.uniforms.add(\"waterColor\",\"vec4\"),0!==p.output&&7!==p.output||(u.include(n,p),u.include(e,p),u.varyings.add(\"vuv\",\"vec2\"),u.varyings.add(\"vpos\",\"vec3\"),u.varyings.add(\"vnormal\",\"vec3\"),u.varyings.add(\"vtbnMatrix\",\"mat3\"),p.multipassTerrainEnabled&&u.varyings.add(\"depth\",\"float\"),u.vertex.code.add(c`\n      void main(void) {\n        if (waterColor.a < ${c.float(v)}) {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ${p.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ${0===p.output?\"forwardLinearDepth();\":\"\"}\n      }\n    `)),p.multipassTerrainEnabled&&(u.fragment.include(i),u.include(t,p)),7===p.output&&(u.include(r,p),u.fragment.uniforms.add(\"waterColor\",\"vec4\"),u.fragment.code.add(c`\n        void main() {\n          discardBySlice(vpos);\n          ${p.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      `)),0===p.output&&(u.include(s,p),u.include(r,p),p.receiveShadows&&u.include(d,p),u.include(l,p),u.fragment.uniforms.add(\"waterColor\",\"vec4\").add(\"lightingMainDirection\",\"vec3\").add(\"lightingMainIntensity\",\"vec3\").add(\"camPos\",\"vec3\").add(\"timeElapsed\",\"float\").add(\"view\",\"mat4\"),u.fragment.include(g),u.fragment.code.add(c`\n      void main() {\n        discardBySlice(vpos);\n        ${p.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        float shadow = ${p.receiveShadows?c`1.0 - readShadowMap(vpos, linearDepth)`:\"1.0\"};\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ${p.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n      }\n    `)),2===p.output&&(u.include(n,p),u.include(s,p),u.include(r,p),u.varyings.add(\"vpos\",\"vec3\"),u.varyings.add(\"vuv\",\"vec2\"),u.vertex.code.add(c`\n        void main(void) {\n          if (waterColor.a < ${c.float(v)}) {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    `),u.fragment.uniforms.add(\"timeElapsed\",\"float\"),u.fragment.code.add(c`void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}`)),5===p.output&&(u.varyings.add(\"vpos\",\"vec3\"),u.vertex.code.add(c`\n        void main(void) {\n          if (waterColor.a < ${c.float(v)}) {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    `),u.fragment.uniforms.add(\"waterColor\",\"vec4\"),u.fragment.code.add(c`void main() {\ngl_FragColor = waterColor;\n}`)),4===p.output&&(u.include(o),u.varyings.add(\"vpos\",\"vec3\"),u.vertex.code.add(c`\n      void main(void) {\n        if (waterColor.a < ${c.float(v)}) {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    `),u.include(r,p),u.fragment.code.add(c`void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}`)),u}var u=Object.freeze({__proto__:null,build:p});export{u as W,p as b};\n"]},"metadata":{},"sourceType":"module"}