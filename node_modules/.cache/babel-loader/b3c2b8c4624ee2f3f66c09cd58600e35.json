{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../../core/has.js\";\nimport { isSome as t } from \"../../../../core/maybe.js\";\nimport { I as r } from \"../../../../chunks/mat4f64.js\";\nimport { b as s, m as e } from \"../../../../chunks/vec3.js\";\nimport { c as i } from \"../../../../chunks/vec3f64.js\";\nimport { fromPoints as a, copy as n } from \"../../../../geometry/support/ray.js\";\nimport { IntersectorOptions as o } from \"./IntersectorInterfaces.js\";\nimport { IntersectorResults as h, IntersectorResult as d } from \"./intersectorUtils.js\";\nimport { IntersectorTransform as c, getVerticalOffsetObject3D as l } from \"./verticalOffsetUtils.js\";\nimport { isInstanceHidden as f } from \"../materials/renderers/utils.js\";\nconst m = 1e-5;\n\nclass u {\n  constructor(t) {\n    this.options = new o(), this.results = new h(), this.transform = new c(), this.performanceInfo = {\n      queryDuration: 0,\n      numObjectsTested: 0\n    }, this.tolerance = m, this.verticalOffset = null, this._ray = {\n      origin: i(),\n      direction: i()\n    }, this._rayEndPoint = i(), this._rayStartPointTransformed = i(), this._rayEndPointTransformed = i(), this.viewingMode = null == t ? 1 : t;\n  }\n\n  get ray() {\n    return this._ray;\n  }\n\n  get rayBeginPoint() {\n    return this._ray.origin;\n  }\n\n  get rayEndPoint() {\n    return this._rayEndPoint;\n  }\n\n  reset(t, r) {\n    this.resetWithRay(a(t, r, this._ray));\n  }\n\n  resetWithRay(t) {\n    t !== this._ray && n(t, this._ray), 0 !== this.options.verticalOffset ? 2 === this.viewingMode ? this._ray.origin[2] -= this.options.verticalOffset : this.verticalOffset = this.options.verticalOffset : this.verticalOffset = null, s(this._rayEndPoint, this._ray.origin, this._ray.direction), this._numObjectsTested = 0, this.results.init(this._ray);\n  }\n\n  intersect(r = null, s, e, i, a, n) {\n    this.point = s, this.camera = e, this.filterPredicate = a, this.tolerance = null == i ? m : i;\n    const o = l(this.verticalOffset);\n\n    if (t(r) && r.length > 0) {\n      const s = n ? t => {\n        n(t) && this.intersectObject(t);\n      } : t => {\n        this.intersectObject(t);\n      };\n\n      for (const e of r) {\n        const r = e.getSpatialQueryAccelerator && e.getSpatialQueryAccelerator();\n        t(r) ? (t(o) ? r.forEachAlongRayWithVerticalOffset(this._ray.origin, this._ray.direction, s, o) : r.forEachAlongRay(this._ray.origin, this._ray.direction, s), this.options.selectionMode && this.options.hud && r.forEachDegenerateObject(s)) : e.objects.forAll(t => s(t));\n      }\n    }\n\n    this.sortResults();\n  }\n\n  intersectObject(s) {\n    this._numObjectsTested++;\n    const i = s.geometryRecords;\n    if (!i) return;\n    const a = s.id,\n          n = s.transformation;\n    let o;\n    const h = l(this.verticalOffset);\n\n    for (const c of i) {\n      const {\n        geometry: i,\n        material: l,\n        instanceParameters: m\n      } = c;\n      if (f(m)) continue;\n      o = i.id, this.transform.setAndInvalidateLazyTransforms(n, c.getShaderTransformation()), e(this._rayStartPointTransformed, this._ray.origin, this.transform.inverse), e(this._rayEndPointTransformed, this._rayEndPoint, this.transform.inverse);\n      const u = this.transform.transform;\n      t(h) && (h.objectTransform = this.transform), l.intersect(i, m, this.transform.transform, this, this._rayStartPointTransformed, this._rayEndPointTransformed, (e, i, n, h, c, l) => {\n        if (e >= 0) {\n          if (t(this.filterPredicate) && !this.filterPredicate(this._ray.origin, this._rayEndPoint, e)) return;\n          const f = `Object3D ${a}`;\n          if (c) return void ((null == this.results.hud.dist || e < this.results.hud.dist) && this.results.hud.set(s, f, e, i, r, h, l, o, n));\n\n          const m = t => t.set(s, f, e, i, u, h, null, o, n);\n\n          if ((null == this.results.min.drapedLayerOrder || h >= this.results.min.drapedLayerOrder) && (null == this.results.min.dist || e < this.results.min.dist) && m(this.results.min), 0 !== this.options.store && (null == this.results.max.drapedLayerOrder || h < this.results.max.drapedLayerOrder) && (null == this.results.max.dist || e > this.results.max.dist) && m(this.results.max), 2 === this.options.store) {\n            const t = new d(this._ray);\n            m(t), this.results.all.push(t);\n          }\n        }\n      }, c.shaderTransformation);\n    }\n  }\n\n  sortResults() {\n    this.results.all.sort((t, r) => t.dist !== r.dist ? t.dist - r.dist : t.drapedLayerOrder !== r.drapedLayerOrder ? (void 0 !== t.drapedLayerOrder ? t.drapedLayerOrder : Number.MAX_VALUE) - (void 0 !== r.drapedLayerOrder ? r.drapedLayerOrder : Number.MAX_VALUE) : (void 0 !== r.drapedLayerGraphicOrder ? r.drapedLayerGraphicOrder : Number.MIN_VALUE) - (void 0 !== t.drapedLayerGraphicOrder ? t.drapedLayerGraphicOrder : Number.MIN_VALUE));\n  }\n\n}\n\nu.DEFAULT_TOLERANCE = m;\nexport { u as Intersector };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/Intersector.js"],"names":["isSome","t","I","r","b","s","m","e","c","i","fromPoints","a","copy","n","IntersectorOptions","o","IntersectorResults","h","IntersectorResult","d","IntersectorTransform","getVerticalOffsetObject3D","l","isInstanceHidden","f","u","constructor","options","results","transform","performanceInfo","queryDuration","numObjectsTested","tolerance","verticalOffset","_ray","origin","direction","_rayEndPoint","_rayStartPointTransformed","_rayEndPointTransformed","viewingMode","ray","rayBeginPoint","rayEndPoint","reset","resetWithRay","_numObjectsTested","init","intersect","point","camera","filterPredicate","length","intersectObject","getSpatialQueryAccelerator","forEachAlongRayWithVerticalOffset","forEachAlongRay","selectionMode","hud","forEachDegenerateObject","objects","forAll","sortResults","geometryRecords","id","transformation","geometry","material","instanceParameters","setAndInvalidateLazyTransforms","getShaderTransformation","inverse","objectTransform","dist","set","min","drapedLayerOrder","store","max","all","push","shaderTransformation","sort","Number","MAX_VALUE","drapedLayerGraphicOrder","MIN_VALUE","DEFAULT_TOLERANCE","Intersector"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{I as r}from\"../../../../chunks/mat4f64.js\";import{b as s,m as e}from\"../../../../chunks/vec3.js\";import{c as i}from\"../../../../chunks/vec3f64.js\";import{fromPoints as a,copy as n}from\"../../../../geometry/support/ray.js\";import{IntersectorOptions as o}from\"./IntersectorInterfaces.js\";import{IntersectorResults as h,IntersectorResult as d}from\"./intersectorUtils.js\";import{IntersectorTransform as c,getVerticalOffsetObject3D as l}from\"./verticalOffsetUtils.js\";import{isInstanceHidden as f}from\"../materials/renderers/utils.js\";const m=1e-5;class u{constructor(t){this.options=new o,this.results=new h,this.transform=new c,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=m,this.verticalOffset=null,this._ray={origin:i(),direction:i()},this._rayEndPoint=i(),this._rayStartPointTransformed=i(),this._rayEndPointTransformed=i(),this.viewingMode=null==t?1:t}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(t,r){this.resetWithRay(a(t,r,this._ray))}resetWithRay(t){t!==this._ray&&n(t,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,s(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(r=null,s,e,i,a,n){this.point=s,this.camera=e,this.filterPredicate=a,this.tolerance=null==i?m:i;const o=l(this.verticalOffset);if(t(r)&&r.length>0){const s=n?t=>{n(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};for(const e of r){const r=e.getSpatialQueryAccelerator&&e.getSpatialQueryAccelerator();t(r)?(t(o)?r.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,s,o):r.forEachAlongRay(this._ray.origin,this._ray.direction,s),this.options.selectionMode&&this.options.hud&&r.forEachDegenerateObject(s)):e.objects.forAll((t=>s(t)))}}this.sortResults()}intersectObject(s){this._numObjectsTested++;const i=s.geometryRecords;if(!i)return;const a=s.id,n=s.transformation;let o;const h=l(this.verticalOffset);for(const c of i){const{geometry:i,material:l,instanceParameters:m}=c;if(f(m))continue;o=i.id,this.transform.setAndInvalidateLazyTransforms(n,c.getShaderTransformation()),e(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),e(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const u=this.transform.transform;t(h)&&(h.objectTransform=this.transform),l.intersect(i,m,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,((e,i,n,h,c,l)=>{if(e>=0){if(t(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,e))return;const f=`Object3D ${a}`;if(c)return void((null==this.results.hud.dist||e<this.results.hud.dist)&&this.results.hud.set(s,f,e,i,r,h,l,o,n));const m=t=>t.set(s,f,e,i,u,h,null,o,n);if((null==this.results.min.drapedLayerOrder||h>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||e<this.results.min.dist)&&m(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||h<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||e>this.results.max.dist)&&m(this.results.max),2===this.options.store){const t=new d(this._ray);m(t),this.results.all.push(t)}}}),c.shaderTransformation)}}sortResults(){this.results.all.sort(((t,r)=>t.dist!==r.dist?t.dist-r.dist:t.drapedLayerOrder!==r.drapedLayerOrder?(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==r.drapedLayerOrder?r.drapedLayerOrder:Number.MAX_VALUE):(void 0!==r.drapedLayerGraphicOrder?r.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)))}}u.DEFAULT_TOLERANCE=m;export{u as Intersector};\n"]},"metadata":{},"sourceType":"module"}