{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { resultOrAbort as t } from \"../../../../../core/asyncUtils.js\";\nimport { isNone as e } from \"../../../../../core/maybe.js\";\nimport { createTask as s } from \"../../../../../core/promiseUtils.js\";\nimport { fromExtent as a, intersects as r, create as o } from \"../../../../../geometry/support/aaBoundingRect.js\";\n\nclass u {\n  constructor(t, e) {\n    this.data = t, this.resolution = e, this.state = {\n      type: 0\n    }, this.alive = !0;\n  }\n\n  process(t) {\n    switch (this.state.type) {\n      case 0:\n        return this.state = this.gotoFetchCount(this.state, t), this.state.task.promise.then(t.resume, t.resume);\n\n      case 1:\n        break;\n\n      case 2:\n        return this.state = this.gotoFetchFeatures(this.state, t), this.state.task.promise.then(t.resume, t.resume);\n\n      case 3:\n        break;\n\n      case 4:\n        this.state = this.goToDone(this.state, t);\n    }\n\n    return null;\n  }\n\n  get debugInfo() {\n    return {\n      data: this.data,\n      featureCount: this.featureCount,\n      state: this.stateToString\n    };\n  }\n\n  get featureCount() {\n    switch (this.state.type) {\n      case 0:\n      case 1:\n        return 0;\n\n      case 2:\n        return this.state.featureCount;\n\n      case 3:\n        return this.state.previous.featureCount;\n\n      case 4:\n        return this.state.features.length;\n\n      case 5:\n        return this.state.previous.features.length;\n    }\n  }\n\n  get stateToString() {\n    switch (this.state.type) {\n      case 0:\n        return \"created\";\n\n      case 1:\n        return \"fetch-count\";\n\n      case 2:\n        return \"fetched-count\";\n\n      case 3:\n        return \"fetch-features\";\n\n      case 4:\n        return \"fetched-features\";\n\n      case 5:\n        return \"done\";\n    }\n  }\n\n  gotoFetchCount(e, a) {\n    return {\n      type: 1,\n      previous: e,\n      task: s(async e => {\n        const s = await t(a.fetchCount(this, e));\n        1 === this.state.type && (this.state = this.gotoFetchedCount(this.state, s.ok ? s.value : 1 / 0));\n      })\n    };\n  }\n\n  gotoFetchedCount(t, e) {\n    return {\n      type: 2,\n      featureCount: e,\n      previous: t\n    };\n  }\n\n  gotoFetchFeatures(e, a) {\n    return {\n      type: 3,\n      previous: e,\n      task: s(async s => {\n        const r = await t(a.fetchFeatures(this, e.featureCount, s));\n        3 === this.state.type && (this.state = this.gotoFetchedFeatures(this.state, r.ok ? r.value : []));\n      })\n    };\n  }\n\n  gotoFetchedFeatures(t, e) {\n    return {\n      type: 4,\n      previous: t,\n      features: e\n    };\n  }\n\n  goToDone(t, e) {\n    return e.finish(this, t.features), {\n      type: 5,\n      previous: t\n    };\n  }\n\n  reset() {\n    const t = this.state;\n\n    switch (this.state = {\n      type: 0\n    }, t.type) {\n      case 0:\n      case 2:\n      case 4:\n      case 5:\n        break;\n\n      case 1:\n      case 3:\n        t.task.abort();\n    }\n  }\n\n  intersects(t) {\n    return !(!e(t) && this.data.extent) || (a(t, i), r(this.data.extent, i));\n  }\n\n}\n\nconst i = o();\nexport { u as PendingFeatureTile };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/interactive/snapping/featureSources/featureServiceSource/PendingFeatureTile.js"],"names":["resultOrAbort","t","isNone","e","createTask","s","fromExtent","a","intersects","r","create","o","u","constructor","data","resolution","state","type","alive","process","gotoFetchCount","task","promise","then","resume","gotoFetchFeatures","goToDone","debugInfo","featureCount","stateToString","previous","features","length","fetchCount","gotoFetchedCount","ok","value","fetchFeatures","gotoFetchedFeatures","finish","reset","abort","extent","i","PendingFeatureTile"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{resultOrAbort as t}from\"../../../../../core/asyncUtils.js\";import{isNone as e}from\"../../../../../core/maybe.js\";import{createTask as s}from\"../../../../../core/promiseUtils.js\";import{fromExtent as a,intersects as r,create as o}from\"../../../../../geometry/support/aaBoundingRect.js\";class u{constructor(t,e){this.data=t,this.resolution=e,this.state={type:0},this.alive=!0}process(t){switch(this.state.type){case 0:return this.state=this.gotoFetchCount(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 1:break;case 2:return this.state=this.gotoFetchFeatures(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 3:break;case 4:this.state=this.goToDone(this.state,t)}return null}get debugInfo(){return{data:this.data,featureCount:this.featureCount,state:this.stateToString}}get featureCount(){switch(this.state.type){case 0:case 1:return 0;case 2:return this.state.featureCount;case 3:return this.state.previous.featureCount;case 4:return this.state.features.length;case 5:return this.state.previous.features.length}}get stateToString(){switch(this.state.type){case 0:return\"created\";case 1:return\"fetch-count\";case 2:return\"fetched-count\";case 3:return\"fetch-features\";case 4:return\"fetched-features\";case 5:return\"done\"}}gotoFetchCount(e,a){return{type:1,previous:e,task:s((async e=>{const s=await t(a.fetchCount(this,e));1===this.state.type&&(this.state=this.gotoFetchedCount(this.state,s.ok?s.value:1/0))}))}}gotoFetchedCount(t,e){return{type:2,featureCount:e,previous:t}}gotoFetchFeatures(e,a){return{type:3,previous:e,task:s((async s=>{const r=await t(a.fetchFeatures(this,e.featureCount,s));3===this.state.type&&(this.state=this.gotoFetchedFeatures(this.state,r.ok?r.value:[]))}))}}gotoFetchedFeatures(t,e){return{type:4,previous:t,features:e}}goToDone(t,e){return e.finish(this,t.features),{type:5,previous:t}}reset(){const t=this.state;switch(this.state={type:0},t.type){case 0:case 2:case 4:case 5:break;case 1:case 3:t.task.abort()}}intersects(t){return!(!e(t)&&this.data.extent)||(a(t,i),r(this.data.extent,i))}}const i=o();export{u as PendingFeatureTile};\n"]},"metadata":{},"sourceType":"module"}