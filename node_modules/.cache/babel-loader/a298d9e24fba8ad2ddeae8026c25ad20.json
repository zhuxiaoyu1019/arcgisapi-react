{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../request.js\";\nimport r from \"../core/Error.js\";\nimport { isSome as t } from \"../core/maybe.js\";\nimport { getDeepValue as o } from \"../core/object.js\";\nimport { removeTrailingSlash as s } from \"../core/urlUtils.js\";\nimport { asValidOptions as a, parseUrl as l } from \"./utils.js\";\nimport n from \"./support/NetworkServiceDescription.js\";\nimport i from \"./support/RouteResultsContainer.js\";\n\nfunction u(e, r, t, o) {\n  o[t] = [r.length, r.length + e.length], e.forEach(e => {\n    r.push(e.geometry);\n  });\n}\n\nfunction p(e, r) {\n  for (let t = 0; t < r.length; t++) {\n    const o = e[r[t]];\n    if (o && o.length) for (const e of o) e.z = void 0;\n  }\n\n  console.log(\"The remote Network Analysis service is powered by a network dataset which is not Z-aware.\\nZ-coordinates of the input geometry are ignored.\");\n}\n\nfunction f(e) {\n  const r = [],\n        t = [],\n        {\n    directions: o = [],\n    routes: {\n      features: s = [],\n      spatialReference: a = null\n    } = {},\n    stops: {\n      features: l = [],\n      spatialReference: n = null\n    } = {},\n    barriers: u,\n    polygonBarriers: p,\n    polylineBarriers: f,\n    messages: d\n  } = e.data,\n        c = \"esri.tasks.RouteTask.NULL_ROUTE_NAME\";\n  let v,\n      m,\n      h = !0;\n  const T = s && a || l && n || u && u.spatialReference || p && p.spatialReference || f && f.spatialReference;\n  o.forEach(e => {\n    r.push(v = e.routeName), t[v] = {\n      directions: e\n    };\n  }), s.forEach(e => {\n    -1 === r.indexOf(v = e.attributes.Name) && (r.push(v), t[v] = {}), e.geometry && (e.geometry.spatialReference = T), t[v].route = e;\n  }), l.forEach(e => {\n    m = e.attributes, -1 === r.indexOf(v = m.RouteName || c) && (r.push(v), t[v] = {}), v !== c && (h = !1), e.geometry && (e.geometry.spatialReference = T), null == t[v].stops && (t[v].stops = []), t[v].stops.push(e);\n  }), l.length > 0 && !0 === h && (t[r[0]].stops = t[c].stops, delete t[c], r.splice(r.indexOf(c), 1));\n  const g = r.map(e => (t[e].routeName = e === c ? null : e, t[e]));\n  return i.fromJSON({\n    routeResults: g,\n    pointBarriers: u,\n    polygonBarriers: p,\n    polylineBarriers: f,\n    messages: d\n  });\n}\n\nfunction d(e, r) {\n  for (let o = 0; o < r.length; o++) {\n    const s = e[r[o]];\n    if (s && s.length) for (const e of s) if (t(e) && e.hasZ) return !0;\n  }\n\n  return !1;\n}\n\nasync function c(t, o, s) {\n  if (!t) throw new r(\"network-service:missing-url\", \"Url to Network service is missing\");\n  const l = a({\n    f: \"json\",\n    token: o\n  }, s),\n        {\n    data: i\n  } = await e(t, l);\n  i.supportedTravelModes || (i.supportedTravelModes = []);\n\n  for (let e = 0; e < i.supportedTravelModes.length; e++) i.supportedTravelModes[e].id || (i.supportedTravelModes[e].id = i.supportedTravelModes[e].itemId);\n\n  const u = i.currentVersion >= 10.4 ? m(t, o, s) : v(t, s),\n        {\n    defaultTravelMode: p,\n    supportedTravelModes: f\n  } = await u;\n  return i.defaultTravelMode = p, i.supportedTravelModes = f, n.fromJSON(i);\n}\n\nasync function v(r, t) {\n  var n, i;\n  const u = a({\n    f: \"json\"\n  }, t),\n        {\n    data: p\n  } = await e(r.replace(/\\/rest\\/.*$/i, \"/info\"), u);\n  if (!p || !p.owningSystemUrl) return {\n    supportedTravelModes: [],\n    defaultTravelMode: null\n  };\n  const {\n    owningSystemUrl: f\n  } = p,\n        d = s(f) + \"/sharing/rest/portals/self\",\n        {\n    data: c\n  } = await e(d, u),\n        v = o(\"helperServices.routingUtilities.url\", c);\n  if (!v) return {\n    supportedTravelModes: [],\n    defaultTravelMode: null\n  };\n  const m = l(f),\n        h = /\\/solve$/i.test(m.path) ? \"Route\" : /\\/solveclosestfacility$/i.test(m.path) ? \"ClosestFacility\" : \"ServiceAreas\",\n        T = a({\n    f: \"json\",\n    serviceName: h\n  }, t),\n        g = s(v) + \"/GetTravelModes/execute\",\n        M = await e(g, T),\n        w = [];\n  let y = null;\n\n  if (null != M && null != (n = M.data) && null != (i = n.results) && i.length) {\n    const e = M.data.results;\n\n    for (const r of e) {\n      var N;\n\n      if (\"supportedTravelModes\" === r.paramName) {\n        if (null != (N = r.value) && N.features) for (const {\n          attributes: e\n        } of r.value.features) if (e) {\n          const r = JSON.parse(e.TravelMode);\n          w.push(r);\n        }\n      } else \"defaultTravelMode\" === r.paramName && (y = r.value);\n    }\n  }\n\n  return {\n    supportedTravelModes: w,\n    defaultTravelMode: y\n  };\n}\n\nasync function m(t, o, l) {\n  try {\n    const r = a({\n      f: \"json\",\n      token: o\n    }, l),\n          n = s(t) + \"/retrieveTravelModes\",\n          {\n      data: {\n        supportedTravelModes: i,\n        defaultTravelMode: u\n      }\n    } = await e(n, r);\n    return {\n      supportedTravelModes: i,\n      defaultTravelMode: u\n    };\n  } catch (n) {\n    throw new r(\"network-service:retrieveTravelModes\", \"Could not get to the NAServer's retrieveTravelModes.\", {\n      error: n\n    });\n  }\n}\n\nexport { u as collectGeometries, p as dropZValuesOffInputGeometry, c as fetchServiceDescription, f as handleSolveResponse, d as isInputGeometryZAware };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/rest/networkService.js"],"names":["e","r","isSome","t","getDeepValue","o","removeTrailingSlash","s","asValidOptions","a","parseUrl","l","n","i","u","length","forEach","push","geometry","p","z","console","log","f","directions","routes","features","spatialReference","stops","barriers","polygonBarriers","polylineBarriers","messages","d","data","c","v","m","h","T","routeName","indexOf","attributes","Name","route","RouteName","splice","g","map","fromJSON","routeResults","pointBarriers","hasZ","token","supportedTravelModes","id","itemId","currentVersion","defaultTravelMode","replace","owningSystemUrl","test","path","serviceName","M","w","y","results","N","paramName","value","JSON","parse","TravelMode","error","collectGeometries","dropZValuesOffInputGeometry","fetchServiceDescription","handleSolveResponse","isInputGeometryZAware"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../request.js\";import r from\"../core/Error.js\";import{isSome as t}from\"../core/maybe.js\";import{getDeepValue as o}from\"../core/object.js\";import{removeTrailingSlash as s}from\"../core/urlUtils.js\";import{asValidOptions as a,parseUrl as l}from\"./utils.js\";import n from\"./support/NetworkServiceDescription.js\";import i from\"./support/RouteResultsContainer.js\";function u(e,r,t,o){o[t]=[r.length,r.length+e.length],e.forEach((e=>{r.push(e.geometry)}))}function p(e,r){for(let t=0;t<r.length;t++){const o=e[r[t]];if(o&&o.length)for(const e of o)e.z=void 0}console.log(\"The remote Network Analysis service is powered by a network dataset which is not Z-aware.\\nZ-coordinates of the input geometry are ignored.\")}function f(e){const r=[],t=[],{directions:o=[],routes:{features:s=[],spatialReference:a=null}={},stops:{features:l=[],spatialReference:n=null}={},barriers:u,polygonBarriers:p,polylineBarriers:f,messages:d}=e.data,c=\"esri.tasks.RouteTask.NULL_ROUTE_NAME\";let v,m,h=!0;const T=s&&a||l&&n||u&&u.spatialReference||p&&p.spatialReference||f&&f.spatialReference;o.forEach((e=>{r.push(v=e.routeName),t[v]={directions:e}})),s.forEach((e=>{-1===r.indexOf(v=e.attributes.Name)&&(r.push(v),t[v]={}),e.geometry&&(e.geometry.spatialReference=T),t[v].route=e})),l.forEach((e=>{m=e.attributes,-1===r.indexOf(v=m.RouteName||c)&&(r.push(v),t[v]={}),v!==c&&(h=!1),e.geometry&&(e.geometry.spatialReference=T),null==t[v].stops&&(t[v].stops=[]),t[v].stops.push(e)})),l.length>0&&!0===h&&(t[r[0]].stops=t[c].stops,delete t[c],r.splice(r.indexOf(c),1));const g=r.map((e=>(t[e].routeName=e===c?null:e,t[e])));return i.fromJSON({routeResults:g,pointBarriers:u,polygonBarriers:p,polylineBarriers:f,messages:d})}function d(e,r){for(let o=0;o<r.length;o++){const s=e[r[o]];if(s&&s.length)for(const e of s)if(t(e)&&e.hasZ)return!0}return!1}async function c(t,o,s){if(!t)throw new r(\"network-service:missing-url\",\"Url to Network service is missing\");const l=a({f:\"json\",token:o},s),{data:i}=await e(t,l);i.supportedTravelModes||(i.supportedTravelModes=[]);for(let e=0;e<i.supportedTravelModes.length;e++)i.supportedTravelModes[e].id||(i.supportedTravelModes[e].id=i.supportedTravelModes[e].itemId);const u=i.currentVersion>=10.4?m(t,o,s):v(t,s),{defaultTravelMode:p,supportedTravelModes:f}=await u;return i.defaultTravelMode=p,i.supportedTravelModes=f,n.fromJSON(i)}async function v(r,t){var n,i;const u=a({f:\"json\"},t),{data:p}=await e(r.replace(/\\/rest\\/.*$/i,\"/info\"),u);if(!p||!p.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};const{owningSystemUrl:f}=p,d=s(f)+\"/sharing/rest/portals/self\",{data:c}=await e(d,u),v=o(\"helperServices.routingUtilities.url\",c);if(!v)return{supportedTravelModes:[],defaultTravelMode:null};const m=l(f),h=/\\/solve$/i.test(m.path)?\"Route\":/\\/solveclosestfacility$/i.test(m.path)?\"ClosestFacility\":\"ServiceAreas\",T=a({f:\"json\",serviceName:h},t),g=s(v)+\"/GetTravelModes/execute\",M=await e(g,T),w=[];let y=null;if(null!=M&&null!=(n=M.data)&&null!=(i=n.results)&&i.length){const e=M.data.results;for(const r of e){var N;if(\"supportedTravelModes\"===r.paramName){if(null!=(N=r.value)&&N.features)for(const{attributes:e}of r.value.features)if(e){const r=JSON.parse(e.TravelMode);w.push(r)}}else\"defaultTravelMode\"===r.paramName&&(y=r.value)}}return{supportedTravelModes:w,defaultTravelMode:y}}async function m(t,o,l){try{const r=a({f:\"json\",token:o},l),n=s(t)+\"/retrieveTravelModes\",{data:{supportedTravelModes:i,defaultTravelMode:u}}=await e(n,r);return{supportedTravelModes:i,defaultTravelMode:u}}catch(n){throw new r(\"network-service:retrieveTravelModes\",\"Could not get to the NAServer's retrieveTravelModes.\",{error:n})}}export{u as collectGeometries,p as dropZValuesOffInputGeometry,c as fetchServiceDescription,f as handleSolveResponse,d as isInputGeometryZAware};\n"]},"metadata":{},"sourceType":"module"}