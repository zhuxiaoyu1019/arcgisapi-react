{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../../core/Accessor.js\";\nimport s from \"../../../../../core/Handles.js\";\nimport { rad2deg as i, acosClamped as r, deg2rad as o } from \"../../../../../core/mathUtils.js\";\nimport { destroyMaybe as a, isNone as n } from \"../../../../../core/maybe.js\";\nimport c from \"../../../../../core/Quantity.js\";\nimport { whenOnce as l } from \"../../../../../core/watchUtils.js\";\nimport { property as m } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as p } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { reactionInit as d } from \"../../../../../core/accessorSupport/trackingUtils.js\";\nimport { i as h } from \"../../../../../chunks/vec3.js\";\nimport { c as u } from \"../../../../../chunks/vec3f64.js\";\nimport { geodesicLength as f } from \"../../../../../geometry/geometryEngine.js\";\nimport _ from \"../../../../../geometry/Polyline.js\";\nimport { canProjectWithoutEngine as g, projectPointToVector as j, projectPointToWGS84ComparableLonLat as y } from \"../../../../../geometry/projection.js\";\nimport { getSphericalPCPF as v, getReferenceEllipsoid as w, SphericalECEFSpatialReference as D, WGS84ECEFSpatialReference as z } from \"../../../../../geometry/projectionEllipsoid.js\";\nimport { isSupported as P, geodesicLengths as b, inverseGeodeticSolver as M } from \"../../../../../geometry/support/geodesicUtils.js\";\nimport { UnitNormalizer as k } from \"../support/UnitNormalizer.js\";\nlet A = class extends t {\n  constructor(e) {\n    super(e), this._unitNormalizer = new k(), this._handles = new s(), this._tempStartPosition = u(), this._tempEndPosition = u(), this._tempCornerPosition = u();\n  }\n\n  initialize() {\n    this._handles.add(l(this.view, \"ready\", () => this._initialize(), !0));\n  }\n\n  destroy() {\n    this._handles = a(this._handles);\n  }\n\n  _initialize() {\n    const e = this.view.spatialReference,\n          t = v(e),\n          s = t === D ? z : t;\n    this._sphericalPCPF = s;\n    const i = g(e, s);\n    this._unitNormalizer.spatialReference = i ? s : e, this._handles.add(d(() => ({\n      result: this._computedResult,\n      viewData: this.viewData\n    }), ({\n      result: e,\n      viewData: t\n    }) => {\n      t.result = e;\n    }));\n  }\n\n  get _computedResult() {\n    const {\n      startPoint: e,\n      endPoint: t\n    } = this.layer;\n    if (n(e) || n(t)) return null;\n\n    const s = this._euclideanDistances(e, t),\n          i = this._exactGeodesicDistanceAndAngle(e, t, s.horizontal.value);\n\n    return {\n      directDistance: s.direct,\n      horizontalDistance: s.horizontal,\n      verticalDistance: s.vertical,\n      geodesicDistance: i.distance,\n      geodesicAngle: i.angle\n    };\n  }\n\n  _euclideanDistances(e, t) {\n    const s = e.clone();\n    s.z = t.z;\n    const i = this._tempStartPosition,\n          r = this._tempEndPosition,\n          o = this._tempCornerPosition,\n          a = this.view.spatialReference,\n          n = this._sphericalPCPF,\n          l = g(a, n) ? n : a;\n    j(e, i, l), j(t, r, l), j(s, o, l);\n\n    const m = h(i, r),\n          p = h(o, r),\n          d = Math.abs(t.z - e.z),\n          u = e => this._unitNormalizer.normalizeDistance(e),\n          f = u(m),\n          _ = u(p),\n          y = u(d);\n\n    return {\n      direct: new c(f, \"meters\"),\n      horizontal: new c(_, \"meters\"),\n      vertical: new c(y, \"meters\")\n    };\n  }\n\n  _exactGeodesicDistanceAndAngle(e, t, s) {\n    const i = e.spatialReference,\n          r = new _({\n      spatialReference: i\n    });\n    r.addPath([e, t]);\n    const o = i.isGeographic && P(i) ? b([r], \"meters\")[0] : i.isWebMercator ? f(r, \"meters\") : void 0,\n          {\n      distance: a,\n      angle: n\n    } = o ? {\n      distance: o,\n      angle: this._fallbackGeodesicAngle(o, i)\n    } : this._fallbackGeodesicDistance(e, t, s);\n    return {\n      distance: new c(a, \"meters\"),\n      angle: new c(n, \"degrees\")\n    };\n  }\n\n  _fallbackGeodesicAngle(e, t) {\n    return e / w(t).metersPerDegree;\n  }\n\n  _fallbackGeodesicDistance(e, t, s) {\n    if (y(e, R)) {\n      y(t, G);\n      const e = o(R[0]),\n            s = o(R[1]),\n            a = o(G[0]),\n            n = o(G[1]),\n            c = Math.abs(a - e),\n            l = r(Math.sin(s) * Math.sin(n) + Math.cos(s) * Math.cos(n) * Math.cos(c)),\n            m = i(l),\n            p = {\n        distance: 0\n      };\n      return M(p, [R[0], R[1]], [G[0], G[1]]), {\n        distance: p.distance,\n        angle: m\n      };\n    }\n\n    const a = e.spatialReference,\n          n = s;\n    return {\n      distance: n,\n      angle: this._fallbackGeodesicAngle(n, a)\n    };\n  }\n\n};\ne([m()], A.prototype, \"view\", void 0), e([m()], A.prototype, \"layer\", void 0), e([m()], A.prototype, \"viewData\", void 0), e([m()], A.prototype, \"_computedResult\", null), A = e([p(\"esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController\")], A);\nconst R = u(),\n      G = u();\nexport { A as DirectLineMeasurementController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/analysis/DirectLineMeasurement/DirectLineMeasurementController.js"],"names":["_","e","t","s","rad2deg","i","acosClamped","r","deg2rad","o","destroyMaybe","a","isNone","n","c","whenOnce","l","property","m","subclass","p","reactionInit","d","h","u","geodesicLength","f","canProjectWithoutEngine","g","projectPointToVector","j","projectPointToWGS84ComparableLonLat","y","getSphericalPCPF","v","getReferenceEllipsoid","w","SphericalECEFSpatialReference","D","WGS84ECEFSpatialReference","z","isSupported","P","geodesicLengths","b","inverseGeodeticSolver","M","UnitNormalizer","k","A","constructor","_unitNormalizer","_handles","_tempStartPosition","_tempEndPosition","_tempCornerPosition","initialize","add","view","_initialize","destroy","spatialReference","_sphericalPCPF","result","_computedResult","viewData","startPoint","endPoint","layer","_euclideanDistances","_exactGeodesicDistanceAndAngle","horizontal","value","directDistance","direct","horizontalDistance","verticalDistance","vertical","geodesicDistance","distance","geodesicAngle","angle","clone","Math","abs","normalizeDistance","addPath","isGeographic","isWebMercator","_fallbackGeodesicAngle","_fallbackGeodesicDistance","metersPerDegree","R","G","sin","cos","prototype","DirectLineMeasurementController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/Accessor.js\";import s from\"../../../../../core/Handles.js\";import{rad2deg as i,acosClamped as r,deg2rad as o}from\"../../../../../core/mathUtils.js\";import{destroyMaybe as a,isNone as n}from\"../../../../../core/maybe.js\";import c from\"../../../../../core/Quantity.js\";import{whenOnce as l}from\"../../../../../core/watchUtils.js\";import{property as m}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{reactionInit as d}from\"../../../../../core/accessorSupport/trackingUtils.js\";import{i as h}from\"../../../../../chunks/vec3.js\";import{c as u}from\"../../../../../chunks/vec3f64.js\";import{geodesicLength as f}from\"../../../../../geometry/geometryEngine.js\";import _ from\"../../../../../geometry/Polyline.js\";import{canProjectWithoutEngine as g,projectPointToVector as j,projectPointToWGS84ComparableLonLat as y}from\"../../../../../geometry/projection.js\";import{getSphericalPCPF as v,getReferenceEllipsoid as w,SphericalECEFSpatialReference as D,WGS84ECEFSpatialReference as z}from\"../../../../../geometry/projectionEllipsoid.js\";import{isSupported as P,geodesicLengths as b,inverseGeodeticSolver as M}from\"../../../../../geometry/support/geodesicUtils.js\";import{UnitNormalizer as k}from\"../support/UnitNormalizer.js\";let A=class extends t{constructor(e){super(e),this._unitNormalizer=new k,this._handles=new s,this._tempStartPosition=u(),this._tempEndPosition=u(),this._tempCornerPosition=u()}initialize(){this._handles.add(l(this.view,\"ready\",(()=>this._initialize()),!0))}destroy(){this._handles=a(this._handles)}_initialize(){const e=this.view.spatialReference,t=v(e),s=t===D?z:t;this._sphericalPCPF=s;const i=g(e,s);this._unitNormalizer.spatialReference=i?s:e,this._handles.add(d((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e})))}get _computedResult(){const{startPoint:e,endPoint:t}=this.layer;if(n(e)||n(t))return null;const s=this._euclideanDistances(e,t),i=this._exactGeodesicDistanceAndAngle(e,t,s.horizontal.value);return{directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:i.distance,geodesicAngle:i.angle}}_euclideanDistances(e,t){const s=e.clone();s.z=t.z;const i=this._tempStartPosition,r=this._tempEndPosition,o=this._tempCornerPosition,a=this.view.spatialReference,n=this._sphericalPCPF,l=g(a,n)?n:a;j(e,i,l),j(t,r,l),j(s,o,l);const m=h(i,r),p=h(o,r),d=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),f=u(m),_=u(p),y=u(d);return{direct:new c(f,\"meters\"),horizontal:new c(_,\"meters\"),vertical:new c(y,\"meters\")}}_exactGeodesicDistanceAndAngle(e,t,s){const i=e.spatialReference,r=new _({spatialReference:i});r.addPath([e,t]);const o=i.isGeographic&&P(i)?b([r],\"meters\")[0]:i.isWebMercator?f(r,\"meters\"):void 0,{distance:a,angle:n}=o?{distance:o,angle:this._fallbackGeodesicAngle(o,i)}:this._fallbackGeodesicDistance(e,t,s);return{distance:new c(a,\"meters\"),angle:new c(n,\"degrees\")}}_fallbackGeodesicAngle(e,t){return e/w(t).metersPerDegree}_fallbackGeodesicDistance(e,t,s){if(y(e,R)){y(t,G);const e=o(R[0]),s=o(R[1]),a=o(G[0]),n=o(G[1]),c=Math.abs(a-e),l=r(Math.sin(s)*Math.sin(n)+Math.cos(s)*Math.cos(n)*Math.cos(c)),m=i(l),p={distance:0};return M(p,[R[0],R[1]],[G[0],G[1]]),{distance:p.distance,angle:m}}const a=e.spatialReference,n=s;return{distance:n,angle:this._fallbackGeodesicAngle(n,a)}}};e([m()],A.prototype,\"view\",void 0),e([m()],A.prototype,\"layer\",void 0),e([m()],A.prototype,\"viewData\",void 0),e([m()],A.prototype,\"_computedResult\",null),A=e([p(\"esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController\")],A);const R=u(),G=u();export{A as DirectLineMeasurementController};\n"]},"metadata":{},"sourceType":"module"}