{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../../renderers/ClassBreaksRenderer.js\";\nimport \"../../../../renderers/DictionaryRenderer.js\";\nimport \"../../../../renderers/DotDensityRenderer.js\";\nimport \"../../../../renderers/HeatmapRenderer.js\";\nimport \"../../../../renderers/Renderer.js\";\nimport e from \"../../../../renderers/SimpleRenderer.js\";\nimport \"../../../../renderers/UniqueValueRenderer.js\";\nimport \"../../../../renderers/support/jsonUtils.js\";\nimport t from \"../../../../core/Error.js\";\nimport r from \"../../../../core/has.js\";\nimport { clone as i } from \"../../../../core/lang.js\";\nimport n from \"../../../../core/Logger.js\";\nimport { isSome as l, unwrapOr as s } from \"../../../../core/maybe.js\";\nimport { pt2px as a } from \"../../../../core/screenUtils.js\";\nimport { fromJSON as o } from \"../../../../symbols/support/jsonUtils.js\";\nimport { WGLGeometryType as u } from \"../../engine/webgl/enums.js\";\nimport { getVVType as d } from \"../../engine/webgl/Utils.js\";\nimport { createMaterialKey as f, hydrateMaterialKey as c } from \"../../engine/webgl/materialKey/MaterialKey.js\";\nimport { getVVFlags as p } from \"../../engine/webgl/util/vvFlagUtils.js\";\nimport { getPtMaxVVSize as m } from \"./support/pixelBuffering.js\";\nimport { simplifyVisualVariables as y } from \"./support/rendererUtils.js\";\nimport { createClusterRenderer as g } from \"../support/clusterUtils.js\";\nimport { toJSONGeometryType as b } from \"../support/util.js\";\nconst h = n.getLogger(\"esri.views.2d.layers.features.schemaUtils\"),\n      x = \"ValidationError\",\n      v = {\n  esriGeometryPoint: [\"above-right\", \"above-center\", \"above-left\", \"center-center\", \"center-left\", \"center-right\", \"below-center\", \"below-left\", \"below-right\"],\n  esriGeometryPolygon: [\"always-horizontal\"],\n  esriGeometryPolyline: [\"center-along\"],\n  esriGeometryMultipoint: null\n};\n\nfunction w(e) {\n  return c(e);\n}\n\nfunction I(e) {\n  return e;\n}\n\nfunction E(e) {\n  switch (e.type) {\n    case \"line-marker\":\n      var t;\n      return {\n        type: \"line-marker\",\n        color: null == (t = e.color) ? void 0 : t.toJSON(),\n        placement: e.placement,\n        style: e.style\n      };\n\n    default:\n      return o(e.toJSON()).toJSON();\n  }\n}\n\nfunction S(e, t, r) {\n  if (!e) return null;\n  let i = 0,\n      n = !1,\n      s = 0;\n\n  switch (l(t) && (s = m(t), \"visualVariables\" in t && (i = p(t.visualVariables || []), n = \"dot-density\" === t.type)), e.type) {\n    case \"simple-fill\":\n    case \"picture-fill\":\n      return F(e, i, n, r);\n\n    case \"simple-marker\":\n    case \"picture-marker\":\n      return z(e, i, s, r);\n\n    case \"simple-line\":\n      return V(e, i, r);\n\n    case \"text\":\n      return j(e, i, s, r);\n\n    case \"label\":\n      return T(e, i, r);\n\n    case \"cim\":\n      return {\n        type: \"cim\",\n        rendererKey: i,\n        data: e.data,\n        maxVVSize: s\n      };\n\n    case \"web-style\":\n      return { ...E(e),\n        type: \"web-style\",\n        hash: e.hash(),\n        rendererKey: i,\n        maxVVSize: s\n      };\n\n    default:\n      throw new Error(`symbol not supported ${e.type}`);\n  }\n}\n\nfunction F(e, t, r, i) {\n  const n = f(u.FILL, t, !1, r),\n        l = i ? w(n) : n,\n        s = e.clone(),\n        a = s.outline;\n  s.outline = null;\n  const o = [],\n        d = {\n    materialKey: l,\n    hash: s.hash(),\n    ...E(s)\n  };\n\n  if (o.push(d), a) {\n    const e = f(u.LINE, t, !0, !1),\n          r = {\n      materialKey: i ? w(e) : e,\n      hash: a.hash(),\n      ...E(a)\n    };\n    o.push(r);\n  }\n\n  return {\n    type: \"composite-symbol\",\n    layers: o,\n    hash: o.reduce((e, t) => t.hash + e, \"\")\n  };\n}\n\nfunction V(e, t, r) {\n  const i = f(u.LINE, t, !1, !1),\n        n = r ? w(i) : i,\n        l = e.clone(),\n        s = l.marker;\n  l.marker = null;\n  const a = [];\n\n  if (a.push({\n    materialKey: n,\n    hash: l.hash(),\n    ...E(l)\n  }), s) {\n    var o;\n    const e = f(u.MARKER, t, !1, !1),\n          i = r ? w(e) : e;\n    s.color = null != (o = s.color) ? o : l.color, a.push({\n      materialKey: i,\n      hash: s.hash(),\n      lineWidth: l.width,\n      ...E(s)\n    });\n  }\n\n  return {\n    type: \"composite-symbol\",\n    layers: a,\n    hash: a.reduce((e, t) => t.hash + e, \"\")\n  };\n}\n\nfunction z(e, t, r, i) {\n  const n = f(u.MARKER, t, !1, !1),\n        l = i ? w(n) : n,\n        s = E(e);\n  return {\n    materialKey: l,\n    hash: e.hash(),\n    ...s,\n    angle: e.angle,\n    maxVVSize: r\n  };\n}\n\nfunction j(e, t, r, i) {\n  const n = f(u.TEXT, t, !1, !1),\n        l = i ? w(n) : n,\n        s = E(e);\n  return {\n    materialKey: l,\n    hash: e.hash(),\n    ...s,\n    angle: e.angle,\n    maxVVSize: r\n  };\n}\n\nfunction N(e, r) {\n  const i = e.labelPlacement,\n        n = v[r];\n  if (!e.symbol) return h.warn(\"No ILabelClass symbol specified.\"), !0;\n  if (!n) return h.error(new t(\"mapview-labeling:unsupported-geometry-type\", `Unable to create labels for Feature Layer, ${r} is not supported`)), !0;\n\n  if (!n.some(e => e === i)) {\n    const t = n[0];\n    i && h.warn(`Found invalid label placement type ${i} for ${r}. Defaulting to ${t}`), e.labelPlacement = t;\n  }\n\n  return !1;\n}\n\nfunction R(e, t) {\n  const r = i(e);\n  return r.some(e => N(e, t)) ? [] : r;\n}\n\nfunction T(e, t, r) {\n  const i = e.toJSON(),\n        n = f(u.LABEL, t, !1, !1, i.labelPlacement);\n  return {\n    materialKey: r ? w(n) : n,\n    hash: e.hash(),\n    ...i,\n    labelPlacement: i.labelPlacement\n  };\n}\n\nfunction M(e) {\n  return r(\"esri-2d-update-debug\") && console.debug(\"Created new schema\", k(e, !0)), k(e);\n}\n\nfunction k(e, t = !1) {\n  try {\n    var r, i;\n    const n = U(e, t),\n          l = {};\n    n.map(t => K(l, e, t));\n    return {\n      source: {\n        definitionExpression: e.definitionExpression,\n        fields: e.fields.map(e => e.toJSON()),\n        gdbVersion: e.gdbVersion,\n        historicMoment: null == (r = e.historicMoment) ? void 0 : r.getTime(),\n        outFields: e.availableFields,\n        pixelBuffer: e.pixelBuffer,\n        spatialReference: e.spatialReference.toJSON(),\n        timeExtent: null == (i = e.timeExtent) ? void 0 : i.toJSON()\n      },\n      attributes: {\n        fields: {},\n        indexCount: 0\n      },\n      processors: n,\n      targets: l\n    };\n  } catch (n) {\n    if (n.fieldName === x) return h.error(n), null;\n    throw n;\n  }\n}\n\nfunction K(e, r, i) {\n  switch (i.target) {\n    case \"feature\":\n      return void L(e, J(r), i);\n\n    case \"aggregate\":\n      {\n        if (!(\"featureReduction\" in r)) return;\n        const n = r.featureReduction;\n        if (\"selection\" === n.type) throw new t(x, \"Mapview does not support `selection` reduction type\", n);\n        return L(e, J(r), i), void B(e, n, i);\n      }\n  }\n}\n\nfunction O(e, t) {\n  for (const r in t) {\n    const i = t[r];\n    if (i.target !== e.name) continue;\n    const n = e.attributes[r];\n    n ? (n.context.mesh = n.context.mesh || i.context.mesh, n.context.storage = n.context.storage || i.context.storage) : e.attributes[r] = i;\n  }\n\n  return e;\n}\n\nfunction J(e) {\n  var t, r, i, n, l;\n  return [null != (t = null == (r = e.filter) ? void 0 : r.toJSON()) ? t : null, null != (i = null == (n = e.effect) || null == (l = n.filter) ? void 0 : l.toJSON()) ? i : null];\n}\n\nfunction L(e, t, r) {\n  return e.feature || (e.feature = {\n    name: \"feature\",\n    input: \"source\",\n    filters: t,\n    attributes: {}\n  }), O(e.feature, r.attributes.fields), e;\n}\n\nfunction B(e, t, r) {\n  return e.aggregate || (e.aggregate = {\n    name: \"aggregate\",\n    input: \"feature\",\n    filters: null,\n    attributes: {},\n    params: {\n      clusterRadius: a(t.clusterRadius / 2),\n      clusterPixelBuffer: 64 * Math.ceil(a(t.clusterMaxSize) / 64),\n      fields: r.aggregateFields\n    }\n  }), O(e.aggregate, r.attributes.fields), e;\n}\n\nfunction D(e, t) {\n  return t.field ? P(e, { ...t,\n    type: \"field\",\n    field: t.field\n  }) : t.valueExpression ? P(e, { ...t,\n    type: \"expression\",\n    valueExpression: t.valueExpression\n  }) : {\n    field: null,\n    fieldIndex: null\n  };\n}\n\nfunction P(e, t) {\n  switch (t.type) {\n    case \"expression\":\n      {\n        const r = I(t.valueExpression);\n\n        if (!e.fields[r]) {\n          const i = e.indexCount++;\n          e.fields[r] = { ...t,\n            name: r,\n            fieldIndex: i\n          };\n        }\n\n        return {\n          fieldIndex: e.fields[r].fieldIndex\n        };\n      }\n\n    case \"label-expression\":\n      {\n        const r = I(JSON.stringify(t.label));\n\n        if (!e.fields[r]) {\n          const i = e.indexCount++;\n          e.fields[r] = { ...t,\n            name: r,\n            fieldIndex: i\n          };\n        }\n\n        return {\n          fieldIndex: e.fields[r].fieldIndex\n        };\n      }\n\n    case \"field\":\n      {\n        const r = t.field;\n        return \"aggregate\" === t.target && e.fields[r] || (e.fields[r] = { ...t,\n          name: r\n        }), {\n          field: r\n        };\n      }\n\n    case \"statistic\":\n      return e.fields[t.name] = { ...t\n      }, {\n        field: t.name\n      };\n  }\n}\n\nfunction U(e, t = !1) {\n  const r = new Array();\n  let i = 0;\n  return r.push($(e, i++, t)), r;\n}\n\nfunction C(e, t, r, i, n, l = !1) {\n  const s = P(t, {\n    type: \"label-expression\",\n    target: i,\n    context: {\n      mesh: !0\n    },\n    resultType: \"string\",\n    label: {\n      labelExpression: r.labelExpression,\n      labelExpressionInfo: r.labelExpressionInfo ? {\n        expression: r.labelExpressionInfo.expression\n      } : null,\n      symbol: !!r.symbol,\n      where: r.where\n    }\n  }),\n        {\n    fieldIndex: a\n  } = s;\n  return { ...S(r, e, l),\n    fieldIndex: a,\n    target: i,\n    index: n\n  };\n}\n\nfunction $(r, i, n = !1) {\n  const s = {\n    indexCount: 0,\n    fields: {}\n  },\n        a = \"featureReduction\" in r && r.featureReduction,\n        o = a ? \"aggregate\" : \"feature\";\n\n  if (\"sublayers\" in r) {\n    const e = {\n      type: \"subtype\",\n      subtypeField: r.subtypeField,\n      renderers: {}\n    },\n          i = {\n      type: \"subtype\",\n      mapping: {},\n      target: \"feature\"\n    },\n          a = {\n      type: \"subtype\",\n      classes: {}\n    },\n          u = {\n      type: \"symbol\",\n      target: \"feature\",\n      aggregateFields: [],\n      attributes: s,\n      storage: i,\n      mesh: {\n        matcher: e,\n        aggregateMatcher: null,\n        labels: a\n      }\n    },\n          d = new Set();\n    let f = 0;\n\n    for (const {\n      renderer: c,\n      subtypeCode: p,\n      labelingInfo: m,\n      labelsVisible: y\n    } of r.sublayers) {\n      const r = W(s, o, c, n),\n            u = A(s, o, c),\n            g = y && m;\n      if (\"visualVariables\" in c && c.visualVariables && c.visualVariables.length) throw new t(x, \"Visual variables are currently not supported for subtype layers\");\n      if (\"dictionary\" === r.type) throw new t(x, \"Dictionary renderer is not supported in subtype layers\");\n      if (\"subtype\" === r.type) throw new t(x, \"Nested subtype renderers is not supported\");\n      if (l(u) && \"subtype\" === u.type) throw new t(x, \"Nested subtype storage is not supported\");\n      if (l(u) && \"dot-density\" === u.type) throw new t(x, \"Dot density attributes are not supported in subtype layers\");\n      if (d.has(p)) throw new t(x, \"Subtype codes for sublayers must be unique\");\n      d.add(p), e.renderers[p] = r, i.mapping[p] = u, g && (a.classes[p] = g.map(e => C(c, s, e, \"feature\", f++, n)));\n    }\n\n    return u;\n  }\n\n  switch (r.renderer.type) {\n    case \"heatmap\":\n      {\n        const {\n          blurRadius: e,\n          fieldOffset: t,\n          field: i\n        } = r.renderer;\n        return {\n          type: \"heatmap\",\n          aggregateFields: [],\n          attributes: s,\n          target: o,\n          storage: null,\n          mesh: {\n            blurRadius: e,\n            fieldOffset: t,\n            field: D(s, {\n              target: o,\n              field: i,\n              resultType: \"numeric\"\n            }).field\n          }\n        };\n      }\n\n    default:\n      {\n        const i = [],\n              l = \"aggregate\" === o ? g(i, r.renderer, a, null) : r.renderer;\n        q(s, i);\n        const u = W(s, o, l, n);\n        let d = null;\n        const f = A(s, o, l),\n              c = b(r.geometryType);\n        let p = r.labelsVisible && r.labelingInfo || [],\n            m = [];\n\n        if (a) {\n          if (\"selection\" === a.type) throw new t(x, \"Mapview does not support `selection` reduction type\", a);\n\n          if (a.symbol) {\n            const t = new e({\n              symbol: a.symbol,\n              visualVariables: \"visualVariables\" in l ? l.visualVariables : null\n            });\n            d = W(s, o, t, n);\n          }\n\n          m = a && a.labelsVisible && a.labelingInfo || [];\n        }\n\n        p = R(p, c), m = R(m, c);\n        let y = 0;\n        const h = [...p.map(e => C(l, s, e, \"feature\", y++, n)), ...m.map(e => C(l, s, e, \"aggregate\", y++, n))];\n        return {\n          type: \"symbol\",\n          target: o,\n          attributes: s,\n          aggregateFields: i,\n          storage: f,\n          mesh: {\n            matcher: u,\n            labels: {\n              type: \"simple\",\n              classes: h\n            },\n            aggregateMatcher: d\n          }\n        };\n      }\n  }\n}\n\nfunction q(e, t) {\n  const r = {\n    mesh: !0,\n    storage: !0\n  };\n\n  for (const i of t) {\n    const {\n      name: t,\n      outStatistic: n\n    } = i,\n          {\n      statisticType: l,\n      onStatisticField: s\n    } = n;\n    let a = null,\n        o = null,\n        u = null;\n    const d = \"numeric\",\n          f = \"feature\";\n\n    if (\"onStatisticValueExpression\" in n) {\n      o = P(e, {\n        type: \"expression\",\n        target: f,\n        valueExpression: n.onStatisticValueExpression,\n        resultType: d\n      }).fieldIndex;\n    } else if (\"onStatisticNormalizationField\" in n) {\n      a = P(e, {\n        type: \"field\",\n        target: f,\n        field: s,\n        resultType: d\n      }).field, u = n.onStatisticNormalizationField;\n    } else {\n      a = P(e, {\n        type: \"field\",\n        target: f,\n        field: s,\n        resultType: d\n      }).field;\n    }\n\n    P(e, {\n      type: \"statistic\",\n      target: \"aggregate\",\n      name: t,\n      context: r,\n      inField: a,\n      inNormalizationField: u,\n      inFieldIndex: o,\n      statisticType: l\n    });\n  }\n}\n\nfunction A(e, t, r) {\n  switch (r.type) {\n    case \"dot-density\":\n      return G(e, t, r.attributes);\n\n    case \"simple\":\n    case \"class-breaks\":\n    case \"unique-value\":\n    case \"dictionary\":\n      return H(e, t, r.visualVariables);\n\n    case \"heatmap\":\n      return null;\n  }\n}\n\nfunction G(e, t, r) {\n  if (!r || !r.length) return {\n    type: \"dot-density\",\n    mapping: [],\n    target: t\n  };\n  return {\n    type: \"dot-density\",\n    mapping: r.map((r, i) => {\n      const {\n        field: n,\n        fieldIndex: l\n      } = D(e, {\n        valueExpression: r.valueExpression,\n        field: r.field,\n        resultType: \"numeric\",\n        target: t\n      });\n      return {\n        binding: i,\n        field: n,\n        fieldIndex: l\n      };\n    }),\n    target: t\n  };\n}\n\nfunction H(e, t, r) {\n  if (!r || !r.length) return {\n    type: \"visual-variable\",\n    mapping: [],\n    target: t\n  };\n  const i = {\n    storage: !0\n  },\n        n = \"numeric\";\n  return {\n    type: \"visual-variable\",\n    mapping: y(r).map(r => {\n      var l;\n      const s = d(r.type),\n            {\n        field: a,\n        fieldIndex: o\n      } = D(e, {\n        target: t,\n        valueExpression: r.valueExpression,\n        field: r.field,\n        context: i,\n        resultType: n\n      });\n\n      switch (r.type) {\n        case \"size\":\n          return \"$view.scale\" === r.valueExpression ? null : {\n            type: \"size\",\n            binding: s,\n            field: a,\n            fieldIndex: o,\n            normalizationField: D(e, {\n              target: t,\n              field: r.normalizationField,\n              context: i,\n              resultType: n\n            }).field,\n            valueRepresentation: null != (l = r.valueRepresentation) ? l : null\n          };\n\n        case \"color\":\n          return {\n            type: \"color\",\n            binding: s,\n            field: a,\n            fieldIndex: o,\n            normalizationField: D(e, {\n              target: t,\n              field: r.normalizationField,\n              context: i,\n              resultType: n\n            }).field\n          };\n\n        case \"opacity\":\n          return {\n            type: \"opacity\",\n            binding: s,\n            field: a,\n            fieldIndex: o,\n            normalizationField: D(e, {\n              target: t,\n              field: r.normalizationField,\n              context: i,\n              resultType: n\n            }).field\n          };\n\n        case \"rotation\":\n          return {\n            type: \"rotation\",\n            binding: s,\n            field: a,\n            fieldIndex: o\n          };\n      }\n    }).filter(e => e),\n    target: t\n  };\n}\n\nfunction W(e, t, r, i = !1) {\n  const n = s(e, {\n    indexCount: 0,\n    fields: {}\n  });\n\n  switch (r.type) {\n    case \"simple\":\n    case \"dot-density\":\n      return X(n, r, \"dot-density\" === r.type, i);\n\n    case \"class-breaks\":\n      return Q(n, t, r, i);\n\n    case \"unique-value\":\n      return Y(n, t, r, i);\n\n    case \"dictionary\":\n      return Z(n, r, i);\n  }\n}\n\nfunction X(e, t, r, i = !1) {\n  const n = t.getSymbols();\n  return {\n    type: \"simple\",\n    symbol: S(n.length ? n[0] : null, t, i),\n    isDotDensity: r\n  };\n}\n\nfunction Q(e, t, r, i = !1) {\n  const n = {\n    mesh: !0,\n    use: \"renderer.field\"\n  },\n        l = r.backgroundFillSymbol,\n        {\n    field: s,\n    fieldIndex: a\n  } = D(e, {\n    target: t,\n    field: r.field,\n    valueExpression: r.valueExpression,\n    resultType: \"numeric\",\n    context: n\n  }),\n        o = r.normalizationType,\n        u = \"log\" === o ? \"esriNormalizeByLog\" : \"percent-of-total\" === o ? \"esriNormalizeByPercentOfTotal\" : \"field\" === o ? \"esriNormalizeByField\" : null,\n        d = r.classBreakInfos.map(e => ({\n    symbol: S(e.symbol, r, i),\n    min: e.minValue,\n    max: e.maxValue\n  })).sort((e, t) => e.min - t.min);\n  return {\n    type: \"interval\",\n    attributes: e.fields,\n    field: s,\n    fieldIndex: a,\n    backgroundFillSymbol: S(l, r, i),\n    defaultSymbol: S(r.defaultSymbol, r, i),\n    intervals: d,\n    normalizationField: r.normalizationField,\n    normalizationTotal: r.normalizationTotal,\n    normalizationType: u,\n    isMaxInclusive: r.isMaxInclusive\n  };\n}\n\nfunction Y(e, r, i, n = !1) {\n  const l = [],\n        s = i.backgroundFillSymbol,\n        a = {\n    target: r,\n    context: {\n      mesh: !0\n    },\n    resultType: \"string\"\n  };\n  if (i.field && \"string\" != typeof i.field) throw new t(x, \"Expected renderer.field to be a string\", i);\n  const {\n    field: o,\n    fieldIndex: u\n  } = D(e, { ...a,\n    field: i.field,\n    valueExpression: i.valueExpression\n  });\n\n  for (const t of i.uniqueValueInfos) l.push({\n    value: \"\" + t.value,\n    symbol: S(t.symbol, i, n)\n  });\n\n  return {\n    type: \"map\",\n    attributes: e.fields,\n    field: o,\n    fieldIndex: u,\n    field2: D(e, { ...a,\n      field: i.field2\n    }).field,\n    field3: D(e, { ...a,\n      field: i.field3\n    }).field,\n    fieldDelimiter: i.fieldDelimiter,\n    backgroundFillSymbol: S(s, i),\n    defaultSymbol: S(i.defaultSymbol, i),\n    map: l\n  };\n}\n\nfunction Z(e, t, r = !1) {\n  return {\n    type: \"dictionary\",\n    renderer: t.toJSON()\n  };\n}\n\nexport { q as addAggregateFields, W as createMatcherSchema, M as createSchema, S as createSymbolSchema };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/layers/features/schemaUtils.js"],"names":["e","t","r","clone","i","n","isSome","l","unwrapOr","s","pt2px","a","fromJSON","o","WGLGeometryType","u","getVVType","d","createMaterialKey","f","hydrateMaterialKey","c","getVVFlags","p","getPtMaxVVSize","m","simplifyVisualVariables","y","createClusterRenderer","g","toJSONGeometryType","b","h","getLogger","x","v","esriGeometryPoint","esriGeometryPolygon","esriGeometryPolyline","esriGeometryMultipoint","w","I","E","type","color","toJSON","placement","style","S","visualVariables","F","z","V","j","T","rendererKey","data","maxVVSize","hash","Error","FILL","outline","materialKey","push","LINE","layers","reduce","marker","MARKER","lineWidth","width","angle","TEXT","N","labelPlacement","symbol","warn","error","some","R","LABEL","M","console","debug","k","U","map","K","source","definitionExpression","fields","gdbVersion","historicMoment","getTime","outFields","availableFields","pixelBuffer","spatialReference","timeExtent","attributes","indexCount","processors","targets","fieldName","target","L","J","featureReduction","B","O","name","context","mesh","storage","filter","effect","feature","input","filters","aggregate","params","clusterRadius","clusterPixelBuffer","Math","ceil","clusterMaxSize","aggregateFields","D","field","P","valueExpression","fieldIndex","JSON","stringify","label","Array","$","C","resultType","labelExpression","labelExpressionInfo","expression","where","index","subtypeField","renderers","mapping","classes","matcher","aggregateMatcher","labels","Set","renderer","subtypeCode","labelingInfo","labelsVisible","sublayers","W","A","length","has","add","blurRadius","fieldOffset","q","geometryType","outStatistic","statisticType","onStatisticField","onStatisticValueExpression","onStatisticNormalizationField","inField","inNormalizationField","inFieldIndex","G","H","binding","normalizationField","valueRepresentation","X","Q","Y","Z","getSymbols","isDotDensity","use","backgroundFillSymbol","normalizationType","classBreakInfos","min","minValue","max","maxValue","sort","defaultSymbol","intervals","normalizationTotal","isMaxInclusive","uniqueValueInfos","value","field2","field3","fieldDelimiter","addAggregateFields","createMatcherSchema","createSchema","createSymbolSchema"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../../renderers/ClassBreaksRenderer.js\";import\"../../../../renderers/DictionaryRenderer.js\";import\"../../../../renderers/DotDensityRenderer.js\";import\"../../../../renderers/HeatmapRenderer.js\";import\"../../../../renderers/Renderer.js\";import e from\"../../../../renderers/SimpleRenderer.js\";import\"../../../../renderers/UniqueValueRenderer.js\";import\"../../../../renderers/support/jsonUtils.js\";import t from\"../../../../core/Error.js\";import r from\"../../../../core/has.js\";import{clone as i}from\"../../../../core/lang.js\";import n from\"../../../../core/Logger.js\";import{isSome as l,unwrapOr as s}from\"../../../../core/maybe.js\";import{pt2px as a}from\"../../../../core/screenUtils.js\";import{fromJSON as o}from\"../../../../symbols/support/jsonUtils.js\";import{WGLGeometryType as u}from\"../../engine/webgl/enums.js\";import{getVVType as d}from\"../../engine/webgl/Utils.js\";import{createMaterialKey as f,hydrateMaterialKey as c}from\"../../engine/webgl/materialKey/MaterialKey.js\";import{getVVFlags as p}from\"../../engine/webgl/util/vvFlagUtils.js\";import{getPtMaxVVSize as m}from\"./support/pixelBuffering.js\";import{simplifyVisualVariables as y}from\"./support/rendererUtils.js\";import{createClusterRenderer as g}from\"../support/clusterUtils.js\";import{toJSONGeometryType as b}from\"../support/util.js\";const h=n.getLogger(\"esri.views.2d.layers.features.schemaUtils\"),x=\"ValidationError\",v={esriGeometryPoint:[\"above-right\",\"above-center\",\"above-left\",\"center-center\",\"center-left\",\"center-right\",\"below-center\",\"below-left\",\"below-right\"],esriGeometryPolygon:[\"always-horizontal\"],esriGeometryPolyline:[\"center-along\"],esriGeometryMultipoint:null};function w(e){return c(e)}function I(e){return e}function E(e){switch(e.type){case\"line-marker\":var t;return{type:\"line-marker\",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style};default:return o(e.toJSON()).toJSON()}}function S(e,t,r){if(!e)return null;let i=0,n=!1,s=0;switch(l(t)&&(s=m(t),\"visualVariables\"in t&&(i=p(t.visualVariables||[]),n=\"dot-density\"===t.type)),e.type){case\"simple-fill\":case\"picture-fill\":return F(e,i,n,r);case\"simple-marker\":case\"picture-marker\":return z(e,i,s,r);case\"simple-line\":return V(e,i,r);case\"text\":return j(e,i,s,r);case\"label\":return T(e,i,r);case\"cim\":return{type:\"cim\",rendererKey:i,data:e.data,maxVVSize:s};case\"web-style\":return{...E(e),type:\"web-style\",hash:e.hash(),rendererKey:i,maxVVSize:s};default:throw new Error(`symbol not supported ${e.type}`)}}function F(e,t,r,i){const n=f(u.FILL,t,!1,r),l=i?w(n):n,s=e.clone(),a=s.outline;s.outline=null;const o=[],d={materialKey:l,hash:s.hash(),...E(s)};if(o.push(d),a){const e=f(u.LINE,t,!0,!1),r={materialKey:i?w(e):e,hash:a.hash(),...E(a)};o.push(r)}return{type:\"composite-symbol\",layers:o,hash:o.reduce(((e,t)=>t.hash+e),\"\")}}function V(e,t,r){const i=f(u.LINE,t,!1,!1),n=r?w(i):i,l=e.clone(),s=l.marker;l.marker=null;const a=[];if(a.push({materialKey:n,hash:l.hash(),...E(l)}),s){var o;const e=f(u.MARKER,t,!1,!1),i=r?w(e):e;s.color=null!=(o=s.color)?o:l.color,a.push({materialKey:i,hash:s.hash(),lineWidth:l.width,...E(s)})}return{type:\"composite-symbol\",layers:a,hash:a.reduce(((e,t)=>t.hash+e),\"\")}}function z(e,t,r,i){const n=f(u.MARKER,t,!1,!1),l=i?w(n):n,s=E(e);return{materialKey:l,hash:e.hash(),...s,angle:e.angle,maxVVSize:r}}function j(e,t,r,i){const n=f(u.TEXT,t,!1,!1),l=i?w(n):n,s=E(e);return{materialKey:l,hash:e.hash(),...s,angle:e.angle,maxVVSize:r}}function N(e,r){const i=e.labelPlacement,n=v[r];if(!e.symbol)return h.warn(\"No ILabelClass symbol specified.\"),!0;if(!n)return h.error(new t(\"mapview-labeling:unsupported-geometry-type\",`Unable to create labels for Feature Layer, ${r} is not supported`)),!0;if(!n.some((e=>e===i))){const t=n[0];i&&h.warn(`Found invalid label placement type ${i} for ${r}. Defaulting to ${t}`),e.labelPlacement=t}return!1}function R(e,t){const r=i(e);return r.some((e=>N(e,t)))?[]:r}function T(e,t,r){const i=e.toJSON(),n=f(u.LABEL,t,!1,!1,i.labelPlacement);return{materialKey:r?w(n):n,hash:e.hash(),...i,labelPlacement:i.labelPlacement}}function M(e){return r(\"esri-2d-update-debug\")&&console.debug(\"Created new schema\",k(e,!0)),k(e)}function k(e,t=!1){try{var r,i;const n=U(e,t),l={};n.map((t=>K(l,e,t)));return{source:{definitionExpression:e.definitionExpression,fields:e.fields.map((e=>e.toJSON())),gdbVersion:e.gdbVersion,historicMoment:null==(r=e.historicMoment)?void 0:r.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null==(i=e.timeExtent)?void 0:i.toJSON()},attributes:{fields:{},indexCount:0},processors:n,targets:l}}catch(n){if(n.fieldName===x)return h.error(n),null;throw n}}function K(e,r,i){switch(i.target){case\"feature\":return void L(e,J(r),i);case\"aggregate\":{if(!(\"featureReduction\"in r))return;const n=r.featureReduction;if(\"selection\"===n.type)throw new t(x,\"Mapview does not support `selection` reduction type\",n);return L(e,J(r),i),void B(e,n,i)}}}function O(e,t){for(const r in t){const i=t[r];if(i.target!==e.name)continue;const n=e.attributes[r];n?(n.context.mesh=n.context.mesh||i.context.mesh,n.context.storage=n.context.storage||i.context.storage):e.attributes[r]=i}return e}function J(e){var t,r,i,n,l;return[null!=(t=null==(r=e.filter)?void 0:r.toJSON())?t:null,null!=(i=null==(n=e.effect)||null==(l=n.filter)?void 0:l.toJSON())?i:null]}function L(e,t,r){return e.feature||(e.feature={name:\"feature\",input:\"source\",filters:t,attributes:{}}),O(e.feature,r.attributes.fields),e}function B(e,t,r){return e.aggregate||(e.aggregate={name:\"aggregate\",input:\"feature\",filters:null,attributes:{},params:{clusterRadius:a(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(a(t.clusterMaxSize)/64),fields:r.aggregateFields}}),O(e.aggregate,r.attributes.fields),e}function D(e,t){return t.field?P(e,{...t,type:\"field\",field:t.field}):t.valueExpression?P(e,{...t,type:\"expression\",valueExpression:t.valueExpression}):{field:null,fieldIndex:null}}function P(e,t){switch(t.type){case\"expression\":{const r=I(t.valueExpression);if(!e.fields[r]){const i=e.indexCount++;e.fields[r]={...t,name:r,fieldIndex:i}}return{fieldIndex:e.fields[r].fieldIndex}}case\"label-expression\":{const r=I(JSON.stringify(t.label));if(!e.fields[r]){const i=e.indexCount++;e.fields[r]={...t,name:r,fieldIndex:i}}return{fieldIndex:e.fields[r].fieldIndex}}case\"field\":{const r=t.field;return\"aggregate\"===t.target&&e.fields[r]||(e.fields[r]={...t,name:r}),{field:r}}case\"statistic\":return e.fields[t.name]={...t},{field:t.name}}}function U(e,t=!1){const r=new Array;let i=0;return r.push($(e,i++,t)),r}function C(e,t,r,i,n,l=!1){const s=P(t,{type:\"label-expression\",target:i,context:{mesh:!0},resultType:\"string\",label:{labelExpression:r.labelExpression,labelExpressionInfo:r.labelExpressionInfo?{expression:r.labelExpressionInfo.expression}:null,symbol:!!r.symbol,where:r.where}}),{fieldIndex:a}=s;return{...S(r,e,l),fieldIndex:a,target:i,index:n}}function $(r,i,n=!1){const s={indexCount:0,fields:{}},a=\"featureReduction\"in r&&r.featureReduction,o=a?\"aggregate\":\"feature\";if(\"sublayers\"in r){const e={type:\"subtype\",subtypeField:r.subtypeField,renderers:{}},i={type:\"subtype\",mapping:{},target:\"feature\"},a={type:\"subtype\",classes:{}},u={type:\"symbol\",target:\"feature\",aggregateFields:[],attributes:s,storage:i,mesh:{matcher:e,aggregateMatcher:null,labels:a}},d=new Set;let f=0;for(const{renderer:c,subtypeCode:p,labelingInfo:m,labelsVisible:y}of r.sublayers){const r=W(s,o,c,n),u=A(s,o,c),g=y&&m;if(\"visualVariables\"in c&&c.visualVariables&&c.visualVariables.length)throw new t(x,\"Visual variables are currently not supported for subtype layers\");if(\"dictionary\"===r.type)throw new t(x,\"Dictionary renderer is not supported in subtype layers\");if(\"subtype\"===r.type)throw new t(x,\"Nested subtype renderers is not supported\");if(l(u)&&\"subtype\"===u.type)throw new t(x,\"Nested subtype storage is not supported\");if(l(u)&&\"dot-density\"===u.type)throw new t(x,\"Dot density attributes are not supported in subtype layers\");if(d.has(p))throw new t(x,\"Subtype codes for sublayers must be unique\");d.add(p),e.renderers[p]=r,i.mapping[p]=u,g&&(a.classes[p]=g.map((e=>C(c,s,e,\"feature\",f++,n))))}return u}switch(r.renderer.type){case\"heatmap\":{const{blurRadius:e,fieldOffset:t,field:i}=r.renderer;return{type:\"heatmap\",aggregateFields:[],attributes:s,target:o,storage:null,mesh:{blurRadius:e,fieldOffset:t,field:D(s,{target:o,field:i,resultType:\"numeric\"}).field}}}default:{const i=[],l=\"aggregate\"===o?g(i,r.renderer,a,null):r.renderer;q(s,i);const u=W(s,o,l,n);let d=null;const f=A(s,o,l),c=b(r.geometryType);let p=r.labelsVisible&&r.labelingInfo||[],m=[];if(a){if(\"selection\"===a.type)throw new t(x,\"Mapview does not support `selection` reduction type\",a);if(a.symbol){const t=new e({symbol:a.symbol,visualVariables:\"visualVariables\"in l?l.visualVariables:null});d=W(s,o,t,n)}m=a&&a.labelsVisible&&a.labelingInfo||[]}p=R(p,c),m=R(m,c);let y=0;const h=[...p.map((e=>C(l,s,e,\"feature\",y++,n))),...m.map((e=>C(l,s,e,\"aggregate\",y++,n)))];return{type:\"symbol\",target:o,attributes:s,aggregateFields:i,storage:f,mesh:{matcher:u,labels:{type:\"simple\",classes:h},aggregateMatcher:d}}}}}function q(e,t){const r={mesh:!0,storage:!0};for(const i of t){const{name:t,outStatistic:n}=i,{statisticType:l,onStatisticField:s}=n;let a=null,o=null,u=null;const d=\"numeric\",f=\"feature\";if(\"onStatisticValueExpression\"in n){o=P(e,{type:\"expression\",target:f,valueExpression:n.onStatisticValueExpression,resultType:d}).fieldIndex}else if(\"onStatisticNormalizationField\"in n){a=P(e,{type:\"field\",target:f,field:s,resultType:d}).field,u=n.onStatisticNormalizationField}else{a=P(e,{type:\"field\",target:f,field:s,resultType:d}).field}P(e,{type:\"statistic\",target:\"aggregate\",name:t,context:r,inField:a,inNormalizationField:u,inFieldIndex:o,statisticType:l})}}function A(e,t,r){switch(r.type){case\"dot-density\":return G(e,t,r.attributes);case\"simple\":case\"class-breaks\":case\"unique-value\":case\"dictionary\":return H(e,t,r.visualVariables);case\"heatmap\":return null}}function G(e,t,r){if(!r||!r.length)return{type:\"dot-density\",mapping:[],target:t};return{type:\"dot-density\",mapping:r.map(((r,i)=>{const{field:n,fieldIndex:l}=D(e,{valueExpression:r.valueExpression,field:r.field,resultType:\"numeric\",target:t});return{binding:i,field:n,fieldIndex:l}})),target:t}}function H(e,t,r){if(!r||!r.length)return{type:\"visual-variable\",mapping:[],target:t};const i={storage:!0},n=\"numeric\";return{type:\"visual-variable\",mapping:y(r).map((r=>{var l;const s=d(r.type),{field:a,fieldIndex:o}=D(e,{target:t,valueExpression:r.valueExpression,field:r.field,context:i,resultType:n});switch(r.type){case\"size\":return\"$view.scale\"===r.valueExpression?null:{type:\"size\",binding:s,field:a,fieldIndex:o,normalizationField:D(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field,valueRepresentation:null!=(l=r.valueRepresentation)?l:null};case\"color\":return{type:\"color\",binding:s,field:a,fieldIndex:o,normalizationField:D(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field};case\"opacity\":return{type:\"opacity\",binding:s,field:a,fieldIndex:o,normalizationField:D(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field};case\"rotation\":return{type:\"rotation\",binding:s,field:a,fieldIndex:o}}})).filter((e=>e)),target:t}}function W(e,t,r,i=!1){const n=s(e,{indexCount:0,fields:{}});switch(r.type){case\"simple\":case\"dot-density\":return X(n,r,\"dot-density\"===r.type,i);case\"class-breaks\":return Q(n,t,r,i);case\"unique-value\":return Y(n,t,r,i);case\"dictionary\":return Z(n,r,i)}}function X(e,t,r,i=!1){const n=t.getSymbols();return{type:\"simple\",symbol:S(n.length?n[0]:null,t,i),isDotDensity:r}}function Q(e,t,r,i=!1){const n={mesh:!0,use:\"renderer.field\"},l=r.backgroundFillSymbol,{field:s,fieldIndex:a}=D(e,{target:t,field:r.field,valueExpression:r.valueExpression,resultType:\"numeric\",context:n}),o=r.normalizationType,u=\"log\"===o?\"esriNormalizeByLog\":\"percent-of-total\"===o?\"esriNormalizeByPercentOfTotal\":\"field\"===o?\"esriNormalizeByField\":null,d=r.classBreakInfos.map((e=>({symbol:S(e.symbol,r,i),min:e.minValue,max:e.maxValue}))).sort(((e,t)=>e.min-t.min));return{type:\"interval\",attributes:e.fields,field:s,fieldIndex:a,backgroundFillSymbol:S(l,r,i),defaultSymbol:S(r.defaultSymbol,r,i),intervals:d,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:u,isMaxInclusive:r.isMaxInclusive}}function Y(e,r,i,n=!1){const l=[],s=i.backgroundFillSymbol,a={target:r,context:{mesh:!0},resultType:\"string\"};if(i.field&&\"string\"!=typeof i.field)throw new t(x,\"Expected renderer.field to be a string\",i);const{field:o,fieldIndex:u}=D(e,{...a,field:i.field,valueExpression:i.valueExpression});for(const t of i.uniqueValueInfos)l.push({value:\"\"+t.value,symbol:S(t.symbol,i,n)});return{type:\"map\",attributes:e.fields,field:o,fieldIndex:u,field2:D(e,{...a,field:i.field2}).field,field3:D(e,{...a,field:i.field3}).field,fieldDelimiter:i.fieldDelimiter,backgroundFillSymbol:S(s,i),defaultSymbol:S(i.defaultSymbol,i),map:l}}function Z(e,t,r=!1){return{type:\"dictionary\",renderer:t.toJSON()}}export{q as addAggregateFields,W as createMatcherSchema,M as createSchema,S as createSymbolSchema};\n"]},"metadata":{},"sourceType":"module"}