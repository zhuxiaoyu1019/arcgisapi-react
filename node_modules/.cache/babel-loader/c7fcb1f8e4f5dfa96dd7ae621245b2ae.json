{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { shuffle as t } from \"../../../../core/arrayUtils.js\";\nimport { unwrapOr as e, isSome as s, isNone as i } from \"../../../../core/maybe.js\";\nimport { fromExtent as r, intersects as u, set as a, POSITIVE_INFINITY as h, intersection as n, create as f } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { numVertices as d, estimateSize as m, getObjectId as l } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nconst _ = 16438,\n      c = new Set();\n\nclass g {\n  constructor(t) {\n    this.descriptor = t, this.fetchStatus = 0, this._features = null, this._numVertices = 0, this._featureLimit = 0, this.featuresMissing = !0, this._shuffled = !1, this._numFeatures = o, this._emptyFeatureRatio = 0, this._estimatedSize = -1, this._estimatedUnusedSize = 0, this._estimatedUnusedSizeDirty = !1, this._availableFields = c, this._displayingFeatures = null, this.alive = !0, this.filtered = !1;\n  }\n\n  get displayingFeatures() {\n    return this._displayingFeatures;\n  }\n\n  set displayingFeatures(t) {\n    this._displayingFeatures = t, this.extentIncludingBorrowedFeatures = null;\n  }\n\n  get perTileMaximumNumberOfFeaturesExceeded() {\n    return !this.filtered && (this.featuresMissing || this.features && this.featureLimit !== this.features.length);\n  }\n\n  get features() {\n    return this._features;\n  }\n\n  get featureLimit() {\n    return this._featureLimit;\n  }\n\n  set featureLimit(t) {\n    this._featureLimit !== t && (this._featureLimit = t, this._estimatedUnusedSizeDirty = !0);\n  }\n\n  get availableFields() {\n    return this._availableFields;\n  }\n\n  setFeatures(t, s, i) {\n    this._availableFields = e(i, c), this._features = t, this._shuffled = !1, this._estimatedSize = -1, this._estimatedUnusedSizeDirty = !0, t && t.length > 0 ? (this._emptyFeatureRatio = s / (t.length + s), this._numVertices = t.reduce((t, e) => t + d(e.geometry), 0)) : (this._emptyFeatureRatio = 0, this._numVertices = 0);\n  }\n\n  get emptyFeatureRatio() {\n    return this._emptyFeatureRatio;\n  }\n\n  get numFeatures() {\n    return this.hasPreciseFeatureCount ? this._numFeatures : this._features ? this._features.length : 0;\n  }\n\n  set numFeatures(t) {\n    this._numFeatures = t;\n  }\n\n  get hasPreciseFeatureCount() {\n    return this._numFeatures > o;\n  }\n\n  get needsFeatureCount() {\n    return this._numFeatures === o;\n  }\n\n  get numVertices() {\n    return this._numVertices;\n  }\n\n  get id() {\n    return this.descriptor.id;\n  }\n\n  get estimatedSize() {\n    return this.updateMemoryEstimates(), this._estimatedSize;\n  }\n\n  get estimatedUnusedSize() {\n    return this._estimatedUnusedSize;\n  }\n\n  updateMemoryEstimates() {\n    if (this._estimatedSize < 0) {\n      if (this._estimatedSize = 0, this._estimatedUnusedSize = 0, this._features) for (let t = 0; t < this._features.length; ++t) {\n        const e = m(this._features[t]);\n        this._estimatedSize += e, t >= this.featureLimit && (this._estimatedUnusedSize += e);\n      }\n      return !0;\n    }\n\n    if (this._estimatedUnusedSizeDirty) {\n      if (this._estimatedUnusedSize = 0, this._estimatedUnusedSizeDirty = !1, this._features) for (let t = this.featureLimit; t < this._features.length; ++t) this._estimatedUnusedSize += m(this._features[t]);\n      return !0;\n    }\n\n    return !1;\n  }\n\n  get isFetching() {\n    return 2 === this.fetchStatus || 3 === this.fetchStatus;\n  }\n\n  get isRefetching() {\n    return 3 === this.fetchStatus;\n  }\n\n  get needsFetching() {\n    return 0 === this.fetchStatus || 1 === this.fetchStatus;\n  }\n\n  get needsRefetching() {\n    return 1 === this.fetchStatus;\n  }\n\n  get isFetched() {\n    return 4 === this.fetchStatus || 5 === this.fetchStatus;\n  }\n\n  resetFetching() {\n    this.fetchStatus = 3 === this.fetchStatus ? 1 : 0;\n  }\n\n  get needsDisplayUpdate() {\n    return !!this._features && !S(this._features, this.displayingFeatures, this.featureLimit);\n  }\n\n  intersects(t) {\n    return !t || !this.descriptor.extent || (r(t, p), u(this.descriptor.extent, p));\n  }\n\n  intersectionIncludingBorrowed(t, e) {\n    const i = s(this.extentIncludingBorrowedFeatures) ? this.extentIncludingBorrowedFeatures : this.descriptor.extent;\n    return t || i ? (t ? (r(t, e), n(e, i, e)) : a(e, i), e) : (a(e, h), e);\n  }\n\n  _shuffle(e) {\n    this._features.sort((t, s) => l(t, e) - l(s, e)), t(this._features, _), this._shuffled = !0, this._estimatedUnusedSizeDirty = !0;\n  }\n\n  reduceFeatures(t, e, s) {\n    if (t <= 0) return !1;\n    if (!this._features) return this.featureLimit = 0, !1;\n    let i = !1;\n    this.featureLimit = Math.ceil(this.numFeatures * t), this.featureLimit > this._features.length && (this.featureLimit = this._features.length, 4 === this.fetchStatus && this._features.length > 0 && (this.fetchStatus = 1, i = !0)), !this._shuffled && t < 1 && this._shuffle(s);\n    const r = Math.max(this.featureLimit, Math.ceil(e * this.numFeatures));\n    return this._features.length > r && (this._features.length = r, this.featuresMissing = !0, 5 === this.fetchStatus && (this.fetchStatus = 4)), i;\n  }\n\n  get cache() {\n    return {\n      availableFields: this._availableFields,\n      features: this.features,\n      numFeatures: this._numFeatures,\n      emptyFeatureRatio: this._emptyFeatureRatio,\n      fetchStatus: this.fetchStatus,\n      featuresMissing: this.featuresMissing\n    };\n  }\n\n  set cache(t) {\n    this.requestController = null, this._availableFields = t.availableFields, this._features = t.features, this._numFeatures = t.numFeatures, this._emptyFeatureRatio = t.emptyFeatureRatio, this.fetchStatus = t.fetchStatus, this.featuresMissing = t.featuresMissing, this._estimatedSize = -1, this._estimatedUnusedSizeDirty = !0;\n  }\n\n}\n\nconst o = -1,\n      F = -2;\n\nfunction S(t, e, s) {\n  if (i(e) || i(t) || s !== e.length || s > t.length) return !1;\n\n  for (let i = 0; i < s; ++i) if (t[i] !== e[i]) return !1;\n\n  return !0;\n}\n\nconst p = f();\nexport { F as FAILED_FEATURE_COUNT, g as FeatureTile };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/support/FeatureTile.js"],"names":["shuffle","t","unwrapOr","e","isSome","s","isNone","i","fromExtent","r","intersects","u","set","a","POSITIVE_INFINITY","h","intersection","n","create","f","numVertices","d","estimateSize","m","getObjectId","l","_","c","Set","g","constructor","descriptor","fetchStatus","_features","_numVertices","_featureLimit","featuresMissing","_shuffled","_numFeatures","o","_emptyFeatureRatio","_estimatedSize","_estimatedUnusedSize","_estimatedUnusedSizeDirty","_availableFields","_displayingFeatures","alive","filtered","displayingFeatures","extentIncludingBorrowedFeatures","perTileMaximumNumberOfFeaturesExceeded","features","featureLimit","length","availableFields","setFeatures","reduce","geometry","emptyFeatureRatio","numFeatures","hasPreciseFeatureCount","needsFeatureCount","id","estimatedSize","updateMemoryEstimates","estimatedUnusedSize","isFetching","isRefetching","needsFetching","needsRefetching","isFetched","resetFetching","needsDisplayUpdate","S","extent","p","intersectionIncludingBorrowed","_shuffle","sort","reduceFeatures","Math","ceil","max","cache","requestController","F","FAILED_FEATURE_COUNT","FeatureTile"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{shuffle as t}from\"../../../../core/arrayUtils.js\";import{unwrapOr as e,isSome as s,isNone as i}from\"../../../../core/maybe.js\";import{fromExtent as r,intersects as u,set as a,POSITIVE_INFINITY as h,intersection as n,create as f}from\"../../../../geometry/support/aaBoundingRect.js\";import{numVertices as d,estimateSize as m,getObjectId as l}from\"../../../../layers/graphics/dehydratedFeatures.js\";const _=16438,c=new Set;class g{constructor(t){this.descriptor=t,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=o,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=c,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(t){this._displayingFeatures=t,this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}get features(){return this._features}get featureLimit(){return this._featureLimit}set featureLimit(t){this._featureLimit!==t&&(this._featureLimit=t,this._estimatedUnusedSizeDirty=!0)}get availableFields(){return this._availableFields}setFeatures(t,s,i){this._availableFields=e(i,c),this._features=t,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,t&&t.length>0?(this._emptyFeatureRatio=s/(t.length+s),this._numVertices=t.reduce(((t,e)=>t+d(e.geometry)),0)):(this._emptyFeatureRatio=0,this._numVertices=0)}get emptyFeatureRatio(){return this._emptyFeatureRatio}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(t){this._numFeatures=t}get hasPreciseFeatureCount(){return this._numFeatures>o}get needsFeatureCount(){return this._numFeatures===o}get numVertices(){return this._numVertices}get id(){return this.descriptor.id}get estimatedSize(){return this.updateMemoryEstimates(),this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(let t=0;t<this._features.length;++t){const e=m(this._features[t]);this._estimatedSize+=e,t>=this.featureLimit&&(this._estimatedUnusedSize+=e)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(let t=this.featureLimit;t<this._features.length;++t)this._estimatedUnusedSize+=m(this._features[t]);return!0}return!1}get isFetching(){return 2===this.fetchStatus||3===this.fetchStatus}get isRefetching(){return 3===this.fetchStatus}get needsFetching(){return 0===this.fetchStatus||1===this.fetchStatus}get needsRefetching(){return 1===this.fetchStatus}get isFetched(){return 4===this.fetchStatus||5===this.fetchStatus}resetFetching(){this.fetchStatus=3===this.fetchStatus?1:0}get needsDisplayUpdate(){return!!this._features&&!S(this._features,this.displayingFeatures,this.featureLimit)}intersects(t){return!t||!this.descriptor.extent||(r(t,p),u(this.descriptor.extent,p))}intersectionIncludingBorrowed(t,e){const i=s(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return t||i?(t?(r(t,e),n(e,i,e)):a(e,i),e):(a(e,h),e)}_shuffle(e){this._features.sort(((t,s)=>l(t,e)-l(s,e))),t(this._features,_),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0}reduceFeatures(t,e,s){if(t<=0)return!1;if(!this._features)return this.featureLimit=0,!1;let i=!1;this.featureLimit=Math.ceil(this.numFeatures*t),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,i=!0)),!this._shuffled&&t<1&&this._shuffle(s);const r=Math.max(this.featureLimit,Math.ceil(e*this.numFeatures));return this._features.length>r&&(this._features.length=r,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4)),i}get cache(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(t){this.requestController=null,this._availableFields=t.availableFields,this._features=t.features,this._numFeatures=t.numFeatures,this._emptyFeatureRatio=t.emptyFeatureRatio,this.fetchStatus=t.fetchStatus,this.featuresMissing=t.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}const o=-1,F=-2;function S(t,e,s){if(i(e)||i(t)||s!==e.length||s>t.length)return!1;for(let i=0;i<s;++i)if(t[i]!==e[i])return!1;return!0}const p=f();export{F as FAILED_FEATURE_COUNT,g as FeatureTile};\n"]},"metadata":{},"sourceType":"module"}