{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as r } from \"../../chunks/tslib.es6.js\";\nimport s from \"../../core/Accessor.js\";\nimport { JSONMap as e } from \"../../core/jsonMap.js\";\nimport a from \"../../core/Logger.js\";\nimport o from \"../../core/Warning.js\";\nimport { property as t } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as i } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport l from \"./ColorVariable.js\";\nimport n from \"./OpacityVariable.js\";\nimport c from \"./RotationVariable.js\";\nimport p from \"./SizeVariable.js\";\nconst u = a.getLogger(\"esri.renderers.visualVariables.VisualVariableFactory\"),\n      b = {\n  color: l,\n  size: p,\n  opacity: n,\n  rotation: c\n},\n      V = new e({\n  colorInfo: \"color\",\n  transparencyInfo: \"opacity\",\n  rotationInfo: \"rotation\",\n  sizeInfo: \"size\"\n}),\n      h = /^\\[([^\\]]+)\\]$/i;\nlet f = class extends s {\n  constructor() {\n    super(...arguments), this.colorVariables = null, this.opacityVariables = null, this.rotationVariables = null, this.sizeVariables = null;\n  }\n\n  set visualVariables(r) {\n    if (this._resetVariables(), (r = r && r.filter(r => !!r)) && r.length) {\n      for (const s of r) switch (s.type) {\n        case \"color\":\n          this.colorVariables.push(s);\n          break;\n\n        case \"opacity\":\n          this.opacityVariables.push(s);\n          break;\n\n        case \"rotation\":\n          this.rotationVariables.push(s);\n          break;\n\n        case \"size\":\n          this.sizeVariables.push(s);\n      }\n\n      if (this.sizeVariables.length) {\n        this.sizeVariables.some(r => !!r.target) && r.sort((r, s) => {\n          let e = null;\n          return e = r.target === s.target ? 0 : r.target ? 1 : -1, e;\n        });\n      }\n\n      for (let s = 0; s < r.length; s++) {\n        r[s].index = s;\n      }\n\n      this._set(\"visualVariables\", r);\n    } else this._set(\"visualVariables\", r);\n  }\n\n  readVariables(r, s, e) {\n    const {\n      rotationExpression: a,\n      rotationType: t\n    } = s,\n          i = a && a.match(h),\n          l = i && i[1];\n    if (l && (r || (r = []), r.push({\n      type: \"rotationInfo\",\n      rotationType: t,\n      field: l\n    })), r) return r.map(r => {\n      const s = V.read(r.type),\n            a = b[s];\n      a || (u.warn(`Unknown variable type: ${s}`), e && e.messages && e.messages.push(new o(\"visual-variable:unsupported\", `visualVariable of type '${s}' is not supported`, {\n        definition: r,\n        context: e\n      })));\n      const t = new a();\n      return t.read(r, e), t;\n    });\n  }\n\n  writeVariables(r, s) {\n    const e = [];\n\n    for (const a of r) {\n      const r = a.toJSON(s);\n      r && e.push(r);\n    }\n\n    return e;\n  }\n\n  _resetVariables() {\n    this.colorVariables = [], this.opacityVariables = [], this.rotationVariables = [], this.sizeVariables = [];\n  }\n\n};\nr([t()], f.prototype, \"visualVariables\", null), f = r([i(\"esri.renderers.visualVariables.VisualVariableFactory\")], f);\nvar m = f;\nexport default m;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/renderers/visualVariables/VisualVariableFactory.js"],"names":["_","r","s","JSONMap","e","a","o","property","t","subclass","i","l","n","c","p","u","getLogger","b","color","size","opacity","rotation","V","colorInfo","transparencyInfo","rotationInfo","sizeInfo","h","f","constructor","arguments","colorVariables","opacityVariables","rotationVariables","sizeVariables","visualVariables","_resetVariables","filter","length","type","push","some","target","sort","index","_set","readVariables","rotationExpression","rotationType","match","field","map","read","warn","messages","definition","context","writeVariables","toJSON","prototype","m"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import s from\"../../core/Accessor.js\";import{JSONMap as e}from\"../../core/jsonMap.js\";import a from\"../../core/Logger.js\";import o from\"../../core/Warning.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import l from\"./ColorVariable.js\";import n from\"./OpacityVariable.js\";import c from\"./RotationVariable.js\";import p from\"./SizeVariable.js\";const u=a.getLogger(\"esri.renderers.visualVariables.VisualVariableFactory\"),b={color:l,size:p,opacity:n,rotation:c},V=new e({colorInfo:\"color\",transparencyInfo:\"opacity\",rotationInfo:\"rotation\",sizeInfo:\"size\"}),h=/^\\[([^\\]]+)\\]$/i;let f=class extends s{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(r){if(this._resetVariables(),(r=r&&r.filter((r=>!!r)))&&r.length){for(const s of r)switch(s.type){case\"color\":this.colorVariables.push(s);break;case\"opacity\":this.opacityVariables.push(s);break;case\"rotation\":this.rotationVariables.push(s);break;case\"size\":this.sizeVariables.push(s)}if(this.sizeVariables.length){this.sizeVariables.some((r=>!!r.target))&&r.sort(((r,s)=>{let e=null;return e=r.target===s.target?0:r.target?1:-1,e}))}for(let s=0;s<r.length;s++){r[s].index=s}this._set(\"visualVariables\",r)}else this._set(\"visualVariables\",r)}readVariables(r,s,e){const{rotationExpression:a,rotationType:t}=s,i=a&&a.match(h),l=i&&i[1];if(l&&(r||(r=[]),r.push({type:\"rotationInfo\",rotationType:t,field:l})),r)return r.map((r=>{const s=V.read(r.type),a=b[s];a||(u.warn(`Unknown variable type: ${s}`),e&&e.messages&&e.messages.push(new o(\"visual-variable:unsupported\",`visualVariable of type '${s}' is not supported`,{definition:r,context:e})));const t=new a;return t.read(r,e),t}))}writeVariables(r,s){const e=[];for(const a of r){const r=a.toJSON(s);r&&e.push(r)}return e}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};r([t()],f.prototype,\"visualVariables\",null),f=r([i(\"esri.renderers.visualVariables.VisualVariableFactory\")],f);var m=f;export default m;\n"]},"metadata":{},"sourceType":"module"}