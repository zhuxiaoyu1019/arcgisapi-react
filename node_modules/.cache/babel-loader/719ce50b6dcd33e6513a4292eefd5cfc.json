{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport i from \"../../../../../Color.js\";\nimport t from \"../../../../../core/Accessor.js\";\nimport o from \"../../../../../core/Handles.js\";\nimport { makeHandle as n, handlesGroup as s } from \"../../../../../core/handleUtils.js\";\nimport { removeMaybe as r, destroyMaybe as l } from \"../../../../../core/maybe.js\";\nimport { property as a } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as c } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { reactionInit as u } from \"../../../../../core/accessorSupport/trackingUtils.js\";\nimport { c as d } from \"../../../../../chunks/mat4f64.js\";\nimport { f as m } from \"../../../../../chunks/vec3.js\";\nimport { d as h, c as p } from \"../../../../../chunks/vec3f64.js\";\nimport { LineVisualElement as f } from \"../../../interactive/visualElements/LineVisualElement.js\";\nlet y = class extends t {\n  constructor(e) {\n    super(e), this._handle = null, this._analysisHandles = new o();\n  }\n\n  initialize() {\n    this._handle = this._connectAnalyses();\n  }\n\n  destroy() {\n    this._handle = r(this._handle), this._analysisHandles = l(this._analysisHandles);\n  }\n\n  get _analyses() {\n    return this.layerViewData.analyses;\n  }\n\n  get _configuration() {\n    return this.layerViewData.configuration;\n  }\n\n  createLineOfSightVisualization() {\n    const e = this._configuration,\n          t = {\n      view: this.view,\n      attached: !0,\n      width: e.outerWidth,\n      innerWidth: e.innerWidth\n    };\n    return {\n      visibleLineVisualElement: new f({ ...t,\n        color: i.toUnitRGBA(e.visibleOuterColor),\n        innerColor: i.toUnitRGBA(e.visibleInnerColor)\n      }),\n      occludedLineVisualElement: new f({ ...t,\n        color: i.toUnitRGBA(e.occludedOuterColor),\n        innerColor: i.toUnitRGBA(e.occludedInnerColor)\n      }),\n      undefinedLineVisualElement: new f({ ...t,\n        color: i.toUnitRGBA(e.undefinedOuterColor),\n        innerColor: i.toUnitRGBA(e.undefinedInnerColor)\n      })\n    };\n  }\n\n  destroyLineOfSightVisualization(e) {\n    e.visibleLineVisualElement = l(e.visibleLineVisualElement), e.occludedLineVisualElement = l(e.occludedLineVisualElement), e.undefinedLineVisualElement = l(e.undefinedLineVisualElement);\n  }\n\n  updateLineOfSightVisualization(e, t) {\n    const o = this._configuration,\n          {\n      computationResult: n,\n      inputPoints: s\n    } = e,\n          {\n      start: r,\n      end: l,\n      intersection: a,\n      isValid: c,\n      isTargetVisible: u\n    } = n,\n          {\n      observer: d\n    } = s,\n          p = v;\n    p[12] = d[0], p[13] = d[1], p[14] = d[2];\n    const f = m(g, r, d),\n          y = m(V, l, d),\n          L = m(_, a, d),\n          {\n      visibleLineVisualElement: C,\n      occludedLineVisualElement: O,\n      undefinedLineVisualElement: A\n    } = t;\n    C.geometry = null, O.geometry = null, A.geometry = null, c ? u ? (C.geometry = [[h(f), h(y)]], C.transform = p, C.color = i.toUnitRGBA(o.visibleOuterColor)) : (C.geometry = [[h(f), h(L)]], C.transform = p, C.color = i.toUnitRGBA(o.occludedOuterColor), O.geometry = [[h(L), h(y)]], O.transform = p) : (A.geometry = [[h(f), h(y)]], A.transform = p);\n  }\n\n  getLineOfSightVisualizationDependencies(e) {\n    const {\n      computationResult: i\n    } = e,\n          {\n      occludedOuterColor: t,\n      visibleOuterColor: o\n    } = this._configuration;\n    return {\n      computationResult: i,\n      occludedOuterColor: t,\n      visibleOuterColor: o\n    };\n  }\n\n  _connectAnalysis(e) {\n    const i = this._analysisHandles;\n    if (i.has(e)) return;\n    const t = this.createLineOfSightVisualization();\n    i.add([u(() => this.getLineOfSightVisualizationDependencies(e), () => this.updateLineOfSightVisualization(e, t)), n(() => this.destroyLineOfSightVisualization(t))]);\n  }\n\n  _disconnectAnalysis(e) {\n    this._analysisHandles.remove(e);\n  }\n\n  _connectAnalyses() {\n    let e = null;\n    return s([u(() => this._analyses, i => {\n      e = r(e), e = i.on(\"change\", e => this._onAnalysesCollectionChange(e)), this._onAnalysesCollectionChange({\n        target: i,\n        added: i.items,\n        removed: [],\n        moved: []\n      });\n    }), n(() => e = r(e))]);\n  }\n\n  _onAnalysesCollectionChange(e) {\n    e.added.forEach(e => this._connectAnalysis(e)), e.removed.forEach(e => this._disconnectAnalysis(e));\n  }\n\n};\ne([a({\n  constructOnly: !0\n})], y.prototype, \"layer\", void 0), e([a({\n  constructOnly: !0\n})], y.prototype, \"view\", void 0), e([a({\n  constructOnly: !0\n})], y.prototype, \"layerViewData\", void 0), e([a()], y.prototype, \"_analyses\", null), e([a()], y.prototype, \"_configuration\", null), y = e([c(\"esri.views.3d.layers.analysis.LineOfSight.LineOfSightView\")], y);\n\nconst g = p(),\n      V = p(),\n      _ = p(),\n      v = d();\n\nexport { y as LineOfSightView };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/analysis/LineOfSight/LineOfSightView.js"],"names":["_","e","i","t","o","makeHandle","n","handlesGroup","s","removeMaybe","r","destroyMaybe","l","property","a","subclass","c","reactionInit","u","d","f","m","h","p","LineVisualElement","y","constructor","_handle","_analysisHandles","initialize","_connectAnalyses","destroy","_analyses","layerViewData","analyses","_configuration","configuration","createLineOfSightVisualization","view","attached","width","outerWidth","innerWidth","visibleLineVisualElement","color","toUnitRGBA","visibleOuterColor","innerColor","visibleInnerColor","occludedLineVisualElement","occludedOuterColor","occludedInnerColor","undefinedLineVisualElement","undefinedOuterColor","undefinedInnerColor","destroyLineOfSightVisualization","updateLineOfSightVisualization","computationResult","inputPoints","start","end","intersection","isValid","isTargetVisible","observer","v","g","V","L","C","O","A","geometry","transform","getLineOfSightVisualizationDependencies","_connectAnalysis","has","add","_disconnectAnalysis","remove","on","_onAnalysesCollectionChange","target","added","items","removed","moved","forEach","constructOnly","prototype","LineOfSightView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import i from\"../../../../../Color.js\";import t from\"../../../../../core/Accessor.js\";import o from\"../../../../../core/Handles.js\";import{makeHandle as n,handlesGroup as s}from\"../../../../../core/handleUtils.js\";import{removeMaybe as r,destroyMaybe as l}from\"../../../../../core/maybe.js\";import{property as a}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as c}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{reactionInit as u}from\"../../../../../core/accessorSupport/trackingUtils.js\";import{c as d}from\"../../../../../chunks/mat4f64.js\";import{f as m}from\"../../../../../chunks/vec3.js\";import{d as h,c as p}from\"../../../../../chunks/vec3f64.js\";import{LineVisualElement as f}from\"../../../interactive/visualElements/LineVisualElement.js\";let y=class extends t{constructor(e){super(e),this._handle=null,this._analysisHandles=new o}initialize(){this._handle=this._connectAnalyses()}destroy(){this._handle=r(this._handle),this._analysisHandles=l(this._analysisHandles)}get _analyses(){return this.layerViewData.analyses}get _configuration(){return this.layerViewData.configuration}createLineOfSightVisualization(){const e=this._configuration,t={view:this.view,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth};return{visibleLineVisualElement:new f({...t,color:i.toUnitRGBA(e.visibleOuterColor),innerColor:i.toUnitRGBA(e.visibleInnerColor)}),occludedLineVisualElement:new f({...t,color:i.toUnitRGBA(e.occludedOuterColor),innerColor:i.toUnitRGBA(e.occludedInnerColor)}),undefinedLineVisualElement:new f({...t,color:i.toUnitRGBA(e.undefinedOuterColor),innerColor:i.toUnitRGBA(e.undefinedInnerColor)})}}destroyLineOfSightVisualization(e){e.visibleLineVisualElement=l(e.visibleLineVisualElement),e.occludedLineVisualElement=l(e.occludedLineVisualElement),e.undefinedLineVisualElement=l(e.undefinedLineVisualElement)}updateLineOfSightVisualization(e,t){const o=this._configuration,{computationResult:n,inputPoints:s}=e,{start:r,end:l,intersection:a,isValid:c,isTargetVisible:u}=n,{observer:d}=s,p=v;p[12]=d[0],p[13]=d[1],p[14]=d[2];const f=m(g,r,d),y=m(V,l,d),L=m(_,a,d),{visibleLineVisualElement:C,occludedLineVisualElement:O,undefinedLineVisualElement:A}=t;C.geometry=null,O.geometry=null,A.geometry=null,c?u?(C.geometry=[[h(f),h(y)]],C.transform=p,C.color=i.toUnitRGBA(o.visibleOuterColor)):(C.geometry=[[h(f),h(L)]],C.transform=p,C.color=i.toUnitRGBA(o.occludedOuterColor),O.geometry=[[h(L),h(y)]],O.transform=p):(A.geometry=[[h(f),h(y)]],A.transform=p)}getLineOfSightVisualizationDependencies(e){const{computationResult:i}=e,{occludedOuterColor:t,visibleOuterColor:o}=this._configuration;return{computationResult:i,occludedOuterColor:t,visibleOuterColor:o}}_connectAnalysis(e){const i=this._analysisHandles;if(i.has(e))return;const t=this.createLineOfSightVisualization();i.add([u((()=>this.getLineOfSightVisualizationDependencies(e)),(()=>this.updateLineOfSightVisualization(e,t))),n((()=>this.destroyLineOfSightVisualization(t)))])}_disconnectAnalysis(e){this._analysisHandles.remove(e)}_connectAnalyses(){let e=null;return s([u((()=>this._analyses),(i=>{e=r(e),e=i.on(\"change\",(e=>this._onAnalysesCollectionChange(e))),this._onAnalysesCollectionChange({target:i,added:i.items,removed:[],moved:[]})})),n((()=>e=r(e)))])}_onAnalysesCollectionChange(e){e.added.forEach((e=>this._connectAnalysis(e))),e.removed.forEach((e=>this._disconnectAnalysis(e)))}};e([a({constructOnly:!0})],y.prototype,\"layer\",void 0),e([a({constructOnly:!0})],y.prototype,\"view\",void 0),e([a({constructOnly:!0})],y.prototype,\"layerViewData\",void 0),e([a()],y.prototype,\"_analyses\",null),e([a()],y.prototype,\"_configuration\",null),y=e([c(\"esri.views.3d.layers.analysis.LineOfSight.LineOfSightView\")],y);const g=p(),V=p(),_=p(),v=d();export{y as LineOfSightView};\n"]},"metadata":{},"sourceType":"module"}