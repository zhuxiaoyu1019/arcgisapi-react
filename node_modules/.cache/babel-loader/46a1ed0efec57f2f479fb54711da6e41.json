{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { C_DEG_TO_RAD as e, C_PI as t, C_INFINITY as i, radToByte as n, positiveMod as s, C_2PI as a } from \"./GeometryUtils.js\";\nimport { SDF_GLYPH_SIZE as o, TextShaping as l, SDF_GLYPH_BASELINE as h } from \"./TextShaping.js\";\nimport { DECLUTTER_TILES as r } from \"./decluttering/config.js\";\nimport { Point as c } from \"../webgl/Geometry.js\";\nconst g = 4096,\n      m = 512,\n      x = 8,\n      d = .5,\n      w = 2;\n\nclass p {\n  constructor(e, t, i = 0, n = -1, s = d) {\n    this.x = e, this.y = t, this.angle = i, this.segment = n, this.minzoom = s;\n  }\n\n}\n\nclass y {\n  constructor(e, t, n, s, a, o = d, l = i) {\n    this.anchor = e, this.labelAngle = t, this.glyphAngle = n, this.page = s, this.alternateVerticalGlyph = a, this.minzoom = o, this.maxzoom = l;\n  }\n\n}\n\nclass f {\n  constructor(e, t, i, n, s, a, o, l, h, r, c, g) {\n    this.tl = e, this.tr = t, this.bl = i, this.br = n, this.mosaicRect = s, this.labelAngle = a, this.minAngle = o, this.maxAngle = l, this.anchor = h, this.minzoom = r, this.maxzoom = c, this.page = g;\n  }\n\n}\n\nclass b {\n  constructor(e) {\n    this.shapes = e;\n  }\n\n}\n\nclass u {\n  getIconPlacement(i, n, s) {\n    const a = new c(i.x, i.y),\n          o = 0 === s.rotationAlignment,\n          l = s.keepUpright;\n    let h = s.rotate * e;\n    o && (h += i.angle);\n    const g = new b([]);\n    return s.allowOverlap && s.ignorePlacement || !r || (g.iconColliders = []), this._addIconPlacement(g, a, n, s, h), o && l && this._addIconPlacement(g, a, n, s, h + t), g;\n  }\n\n  _addIconPlacement(e, t, n, s, a) {\n    const o = n.pixelRatio,\n          l = n.width / o,\n          h = n.height / o,\n          g = s.offset;\n    let m = g[0],\n        x = g[1];\n\n    switch (s.anchor) {\n      case 0:\n        m -= l / 2, x -= h / 2;\n        break;\n\n      case 1:\n        x -= h / 2;\n        break;\n\n      case 2:\n        m -= l, x -= h / 2;\n        break;\n\n      case 3:\n        m -= l / 2;\n        break;\n\n      case 4:\n        m -= l / 2, x -= h;\n        break;\n\n      case 5:\n        break;\n\n      case 7:\n        x -= h;\n        break;\n\n      case 6:\n        m -= l;\n        break;\n\n      case 8:\n        m -= l, x -= h;\n    }\n\n    const w = n.rect,\n          p = 2 / o,\n          y = m - p,\n          b = x - p,\n          u = y + w.width / o,\n          I = b + w.height / o,\n          k = new c(y, b),\n          T = new c(u, I),\n          P = new c(y, I),\n          N = new c(u, b);\n\n    if (0 !== a) {\n      const e = Math.cos(a),\n            t = Math.sin(a);\n      k.rotate(e, t), T.rotate(e, t), P.rotate(e, t), N.rotate(e, t);\n    }\n\n    const z = new f(k, N, P, T, w, a, 0, 256, t, d, i, 0);\n\n    if (e.shapes.push(z), (!s.allowOverlap || !s.ignorePlacement) && r) {\n      const n = s.size,\n            o = s.padding,\n            r = {\n        xTile: t.x,\n        yTile: t.y,\n        dxPixels: m * n - o,\n        dyPixels: x * n - o,\n        hard: !s.optional,\n        partIndex: 0,\n        width: l * n + 2 * o,\n        height: h * n + 2 * o,\n        angle: a,\n        minLod: d,\n        maxLod: i\n      };\n      e.iconColliders.push(r);\n    }\n  }\n\n  getTextPlacement(n, s, a, r) {\n    const g = new c(n.x, n.y),\n          m = r.rotate * e,\n          p = 0 === r.rotationAlignment,\n          u = r.keepUpright,\n          I = r.padding;\n    let k = d;\n\n    const T = !p ? 0 : n.angle,\n          P = n.segment >= 0 && p,\n          N = r.allowOverlap && r.ignorePlacement ? null : [],\n          z = [],\n          A = 4,\n          _ = !P;\n\n    let G = Number.POSITIVE_INFINITY,\n        v = Number.NEGATIVE_INFINITY,\n        M = G,\n        E = v;\n    const L = (P || p) && u,\n          V = r.size / o;\n    let O = !1;\n\n    for (const e of s) if (e.vertical) {\n      O = !0;\n      break;\n    }\n\n    let j,\n        F = 0,\n        Y = 0;\n\n    if (!P && O) {\n      const e = l.getTextBox(s, r.lineHeight * o);\n\n      switch (r.anchor) {\n        case 1:\n          F = e.height / 2, Y = -e.width / 2;\n          break;\n\n        case 2:\n          F = -e.height / 2, Y = e.width / 2;\n          break;\n\n        case 3:\n          F = e.height / 2, Y = e.width / 2;\n          break;\n\n        case 4:\n          F = -e.height / 2, Y = -e.width / 2;\n          break;\n\n        case 5:\n          F = e.height;\n          break;\n\n        case 7:\n          Y = -e.width;\n          break;\n\n        case 6:\n          Y = e.width;\n          break;\n\n        case 8:\n          F = -e.height;\n      }\n    }\n\n    F += r.offset[0] * o, Y += r.offset[1] * o;\n\n    for (const e of s) {\n      const s = e.glyphMosaicItem;\n      if (!s || s.rect.isEmpty) continue;\n      const o = s.rect,\n            l = s.metrics,\n            b = s.page;\n\n      if (N && _) {\n        if (void 0 !== j && j !== e.y) {\n          let e, t, s, a;\n          O ? (e = -E + F, t = G + Y, s = E - M, a = v - G) : (e = G + F, t = M + Y, s = v - G, a = E - M);\n          const o = {\n            xTile: n.x,\n            yTile: n.y,\n            dxPixels: e * V - I,\n            dyPixels: t * V - I,\n            hard: !r.optional,\n            partIndex: 1,\n            width: s * V + 2 * I,\n            height: a * V + 2 * I,\n            angle: m,\n            minLod: d,\n            maxLod: i\n          };\n          N.push(o), G = Number.POSITIVE_INFINITY, v = Number.NEGATIVE_INFINITY, M = G, E = v;\n        }\n\n        j = e.y;\n      }\n\n      const q = [];\n\n      if (P) {\n        const t = .5 * s.metrics.width,\n              i = (e.x + l.left - A + t) * V * x;\n        if (k = this._placeGlyph(n, k, i, a, n.segment, 1, e.vertical, b, q), u && (k = this._placeGlyph(n, k, i, a, n.segment, -1, e.vertical, b, q)), k >= w) break;\n      } else q.push(new y(g, T, T, b, !1)), p && u && q.push(new y(g, T + t, T + t, b, !1));\n\n      const C = e.x + l.left,\n            S = e.y - h - l.top,\n            U = C + l.width,\n            R = S + l.height;\n      let B, H, D, J, K, Q, W, X;\n      if (!P && O) {\n        if (e.vertical) {\n          const e = (C + U) / 2 - l.height / 2,\n                t = (S + R) / 2 + l.width / 2;\n          B = new c(-t - A + F, e - A + Y), H = new c(B.x + o.width, B.y + o.height), D = new c(B.x, H.y), J = new c(H.x, B.y);\n        } else B = new c(-S + A + F, C - A + Y), H = new c(B.x - o.height, B.y + o.width), D = new c(H.x, B.y), J = new c(B.x, H.y);\n      } else B = new c(C - A + F, S - A + Y), H = new c(B.x + o.width, B.y + o.height), D = new c(B.x, H.y), J = new c(H.x, B.y);\n\n      for (const t of q) {\n        let i, s, a, h;\n\n        if (t.alternateVerticalGlyph) {\n          if (!K) {\n            const e = (S + R) / 2 + Y;\n            K = new c((C + U) / 2 + F - l.height / 2 - A, e + l.width / 2 + A), Q = new c(K.x + o.height, K.y - o.width), W = new c(Q.x, K.y), X = new c(K.x, Q.y);\n          }\n\n          i = K, s = W, a = X, h = Q;\n        } else i = B, s = D, a = J, h = H;\n\n        const g = S,\n              x = R,\n              d = t.glyphAngle + m;\n\n        if (0 !== d) {\n          const e = Math.cos(d),\n                t = Math.sin(d);\n          i = i.clone(), s = s.clone(), a = a.clone(), h = h.clone(), i.rotate(e, t), h.rotate(e, t), s.rotate(e, t), a.rotate(e, t);\n        }\n\n        let p = 0,\n            y = 256;\n        if (P && O ? e.vertical ? t.alternateVerticalGlyph ? (p = 32, y = 96) : (p = 224, y = 32) : (p = 224, y = 96) : (p = 192, y = 64), z.push(new f(i, a, s, h, o, t.labelAngle, p, y, t.anchor, t.minzoom, t.maxzoom, t.page)), N && (!L || this._legible(t.labelAngle))) if (_) C < G && (G = C), g < M && (M = g), U > v && (v = U), x > E && (E = x);else if (t.minzoom < w) {\n          const e = {\n            xTile: n.x,\n            yTile: n.y,\n            dxPixels: (C + F) * V - I,\n            dyPixels: (g + F) * V - I,\n            hard: !r.optional,\n            partIndex: 1,\n            width: (U - C) * V + 2 * I,\n            height: (x - g) * V + 2 * I,\n            angle: d,\n            minLod: t.minzoom,\n            maxLod: t.maxzoom\n          };\n          N.push(e);\n        }\n      }\n    }\n\n    if (k >= w) return null;\n\n    if (N && _) {\n      let e, t, s, a;\n      O ? (e = -E + F, t = G + Y, s = E - M, a = v - G) : (e = G + F, t = M + Y, s = v - G, a = E - M);\n      const o = {\n        xTile: n.x,\n        yTile: n.y,\n        dxPixels: e * V - I,\n        dyPixels: t * V - I,\n        hard: !r.optional,\n        partIndex: 1,\n        width: s * V + 2 * I,\n        height: a * V + 2 * I,\n        angle: m,\n        minLod: d,\n        maxLod: i\n      };\n      N.push(o);\n    }\n\n    const q = new b(z);\n    return N && N.length > 0 && (q.textColliders = N), q;\n  }\n\n  _legible(e) {\n    const t = n(e);\n    return t < 65 || t >= 193;\n  }\n\n  _placeGlyph(e, n, o, l, h, r, g, m, x) {\n    let d = r;\n    const w = d < 0 ? s(e.angle + t, a) : e.angle;\n    let p = 0;\n    o < 0 && (d *= -1, o *= -1, p = t), d > 0 && ++h;\n    let f = new c(e.x, e.y),\n        b = l[h],\n        u = i;\n    if (l.length <= h) return u;\n\n    for (;;) {\n      const e = b.x - f.x,\n            t = b.y - f.y,\n            i = Math.sqrt(e * e + t * t),\n            r = Math.max(o / i, n),\n            c = e / i,\n            I = t / i,\n            k = s(Math.atan2(I, c) + p, a);\n      if (x.push(new y(f, w, k, m, !1, r, u)), g && x.push(new y(f, w, k, m, !0, r, u)), r <= n) return r;\n      f = b.clone();\n\n      do {\n        if (h += d, l.length <= h || h < 0) return r;\n        b = l[h];\n      } while (f.isEqual(b));\n\n      let T = b.x - f.x,\n          P = b.y - f.y;\n      const N = Math.sqrt(T * T + P * P);\n      T *= i / N, P *= i / N, f.x -= T, f.y -= P, u = r;\n    }\n  }\n\n}\n\nexport { p as Anchor, f as PlacedSymbol, b as Placement, u as PlacementEngine, g as TILE_COORD_SIZE, x as TILE_PIXEL_RATIO, m as TILE_PIXEL_SIZE };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/Placement.js"],"names":["C_DEG_TO_RAD","e","C_PI","t","C_INFINITY","i","radToByte","n","positiveMod","s","C_2PI","a","SDF_GLYPH_SIZE","o","TextShaping","l","SDF_GLYPH_BASELINE","h","DECLUTTER_TILES","r","Point","c","g","m","x","d","w","p","constructor","y","angle","segment","minzoom","anchor","labelAngle","glyphAngle","page","alternateVerticalGlyph","maxzoom","f","tl","tr","bl","br","mosaicRect","minAngle","maxAngle","b","shapes","u","getIconPlacement","rotationAlignment","keepUpright","rotate","allowOverlap","ignorePlacement","iconColliders","_addIconPlacement","pixelRatio","width","height","offset","rect","I","k","T","P","N","Math","cos","sin","z","push","size","padding","xTile","yTile","dxPixels","dyPixels","hard","optional","partIndex","minLod","maxLod","getTextPlacement","A","_","G","Number","POSITIVE_INFINITY","v","NEGATIVE_INFINITY","M","E","L","V","O","vertical","j","F","Y","getTextBox","lineHeight","glyphMosaicItem","isEmpty","metrics","q","left","_placeGlyph","C","S","top","U","R","B","H","D","J","K","Q","W","X","clone","_legible","length","textColliders","sqrt","max","atan2","isEqual","Anchor","PlacedSymbol","Placement","PlacementEngine","TILE_COORD_SIZE","TILE_PIXEL_RATIO","TILE_PIXEL_SIZE"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{C_DEG_TO_RAD as e,C_PI as t,C_INFINITY as i,radToByte as n,positiveMod as s,C_2PI as a}from\"./GeometryUtils.js\";import{SDF_GLYPH_SIZE as o,TextShaping as l,SDF_GLYPH_BASELINE as h}from\"./TextShaping.js\";import{DECLUTTER_TILES as r}from\"./decluttering/config.js\";import{Point as c}from\"../webgl/Geometry.js\";const g=4096,m=512,x=8,d=.5,w=2;class p{constructor(e,t,i=0,n=-1,s=d){this.x=e,this.y=t,this.angle=i,this.segment=n,this.minzoom=s}}class y{constructor(e,t,n,s,a,o=d,l=i){this.anchor=e,this.labelAngle=t,this.glyphAngle=n,this.page=s,this.alternateVerticalGlyph=a,this.minzoom=o,this.maxzoom=l}}class f{constructor(e,t,i,n,s,a,o,l,h,r,c,g){this.tl=e,this.tr=t,this.bl=i,this.br=n,this.mosaicRect=s,this.labelAngle=a,this.minAngle=o,this.maxAngle=l,this.anchor=h,this.minzoom=r,this.maxzoom=c,this.page=g}}class b{constructor(e){this.shapes=e}}class u{getIconPlacement(i,n,s){const a=new c(i.x,i.y),o=0===s.rotationAlignment,l=s.keepUpright;let h=s.rotate*e;o&&(h+=i.angle);const g=new b([]);return s.allowOverlap&&s.ignorePlacement||!r||(g.iconColliders=[]),this._addIconPlacement(g,a,n,s,h),o&&l&&this._addIconPlacement(g,a,n,s,h+t),g}_addIconPlacement(e,t,n,s,a){const o=n.pixelRatio,l=n.width/o,h=n.height/o,g=s.offset;let m=g[0],x=g[1];switch(s.anchor){case 0:m-=l/2,x-=h/2;break;case 1:x-=h/2;break;case 2:m-=l,x-=h/2;break;case 3:m-=l/2;break;case 4:m-=l/2,x-=h;break;case 5:break;case 7:x-=h;break;case 6:m-=l;break;case 8:m-=l,x-=h}const w=n.rect,p=2/o,y=m-p,b=x-p,u=y+w.width/o,I=b+w.height/o,k=new c(y,b),T=new c(u,I),P=new c(y,I),N=new c(u,b);if(0!==a){const e=Math.cos(a),t=Math.sin(a);k.rotate(e,t),T.rotate(e,t),P.rotate(e,t),N.rotate(e,t)}const z=new f(k,N,P,T,w,a,0,256,t,d,i,0);if(e.shapes.push(z),(!s.allowOverlap||!s.ignorePlacement)&&r){const n=s.size,o=s.padding,r={xTile:t.x,yTile:t.y,dxPixels:m*n-o,dyPixels:x*n-o,hard:!s.optional,partIndex:0,width:l*n+2*o,height:h*n+2*o,angle:a,minLod:d,maxLod:i};e.iconColliders.push(r)}}getTextPlacement(n,s,a,r){const g=new c(n.x,n.y),m=r.rotate*e,p=0===r.rotationAlignment,u=r.keepUpright,I=r.padding;let k=d;const T=!p?0:n.angle,P=n.segment>=0&&p,N=r.allowOverlap&&r.ignorePlacement?null:[],z=[],A=4,_=!P;let G=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,M=G,E=v;const L=(P||p)&&u,V=r.size/o;let O=!1;for(const e of s)if(e.vertical){O=!0;break}let j,F=0,Y=0;if(!P&&O){const e=l.getTextBox(s,r.lineHeight*o);switch(r.anchor){case 1:F=e.height/2,Y=-e.width/2;break;case 2:F=-e.height/2,Y=e.width/2;break;case 3:F=e.height/2,Y=e.width/2;break;case 4:F=-e.height/2,Y=-e.width/2;break;case 5:F=e.height;break;case 7:Y=-e.width;break;case 6:Y=e.width;break;case 8:F=-e.height}}F+=r.offset[0]*o,Y+=r.offset[1]*o;for(const e of s){const s=e.glyphMosaicItem;if(!s||s.rect.isEmpty)continue;const o=s.rect,l=s.metrics,b=s.page;if(N&&_){if(void 0!==j&&j!==e.y){let e,t,s,a;O?(e=-E+F,t=G+Y,s=E-M,a=v-G):(e=G+F,t=M+Y,s=v-G,a=E-M);const o={xTile:n.x,yTile:n.y,dxPixels:e*V-I,dyPixels:t*V-I,hard:!r.optional,partIndex:1,width:s*V+2*I,height:a*V+2*I,angle:m,minLod:d,maxLod:i};N.push(o),G=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,M=G,E=v}j=e.y}const q=[];if(P){const t=.5*s.metrics.width,i=(e.x+l.left-A+t)*V*x;if(k=this._placeGlyph(n,k,i,a,n.segment,1,e.vertical,b,q),u&&(k=this._placeGlyph(n,k,i,a,n.segment,-1,e.vertical,b,q)),k>=w)break}else q.push(new y(g,T,T,b,!1)),p&&u&&q.push(new y(g,T+t,T+t,b,!1));const C=e.x+l.left,S=e.y-h-l.top,U=C+l.width,R=S+l.height;let B,H,D,J,K,Q,W,X;if(!P&&O)if(e.vertical){const e=(C+U)/2-l.height/2,t=(S+R)/2+l.width/2;B=new c(-t-A+F,e-A+Y),H=new c(B.x+o.width,B.y+o.height),D=new c(B.x,H.y),J=new c(H.x,B.y)}else B=new c(-S+A+F,C-A+Y),H=new c(B.x-o.height,B.y+o.width),D=new c(H.x,B.y),J=new c(B.x,H.y);else B=new c(C-A+F,S-A+Y),H=new c(B.x+o.width,B.y+o.height),D=new c(B.x,H.y),J=new c(H.x,B.y);for(const t of q){let i,s,a,h;if(t.alternateVerticalGlyph){if(!K){const e=(S+R)/2+Y;K=new c((C+U)/2+F-l.height/2-A,e+l.width/2+A),Q=new c(K.x+o.height,K.y-o.width),W=new c(Q.x,K.y),X=new c(K.x,Q.y)}i=K,s=W,a=X,h=Q}else i=B,s=D,a=J,h=H;const g=S,x=R,d=t.glyphAngle+m;if(0!==d){const e=Math.cos(d),t=Math.sin(d);i=i.clone(),s=s.clone(),a=a.clone(),h=h.clone(),i.rotate(e,t),h.rotate(e,t),s.rotate(e,t),a.rotate(e,t)}let p=0,y=256;if(P&&O?e.vertical?t.alternateVerticalGlyph?(p=32,y=96):(p=224,y=32):(p=224,y=96):(p=192,y=64),z.push(new f(i,a,s,h,o,t.labelAngle,p,y,t.anchor,t.minzoom,t.maxzoom,t.page)),N&&(!L||this._legible(t.labelAngle)))if(_)C<G&&(G=C),g<M&&(M=g),U>v&&(v=U),x>E&&(E=x);else if(t.minzoom<w){const e={xTile:n.x,yTile:n.y,dxPixels:(C+F)*V-I,dyPixels:(g+F)*V-I,hard:!r.optional,partIndex:1,width:(U-C)*V+2*I,height:(x-g)*V+2*I,angle:d,minLod:t.minzoom,maxLod:t.maxzoom};N.push(e)}}}if(k>=w)return null;if(N&&_){let e,t,s,a;O?(e=-E+F,t=G+Y,s=E-M,a=v-G):(e=G+F,t=M+Y,s=v-G,a=E-M);const o={xTile:n.x,yTile:n.y,dxPixels:e*V-I,dyPixels:t*V-I,hard:!r.optional,partIndex:1,width:s*V+2*I,height:a*V+2*I,angle:m,minLod:d,maxLod:i};N.push(o)}const q=new b(z);return N&&N.length>0&&(q.textColliders=N),q}_legible(e){const t=n(e);return t<65||t>=193}_placeGlyph(e,n,o,l,h,r,g,m,x){let d=r;const w=d<0?s(e.angle+t,a):e.angle;let p=0;o<0&&(d*=-1,o*=-1,p=t),d>0&&++h;let f=new c(e.x,e.y),b=l[h],u=i;if(l.length<=h)return u;for(;;){const e=b.x-f.x,t=b.y-f.y,i=Math.sqrt(e*e+t*t),r=Math.max(o/i,n),c=e/i,I=t/i,k=s(Math.atan2(I,c)+p,a);if(x.push(new y(f,w,k,m,!1,r,u)),g&&x.push(new y(f,w,k,m,!0,r,u)),r<=n)return r;f=b.clone();do{if(h+=d,l.length<=h||h<0)return r;b=l[h]}while(f.isEqual(b));let T=b.x-f.x,P=b.y-f.y;const N=Math.sqrt(T*T+P*P);T*=i/N,P*=i/N,f.x-=T,f.y-=P,u=r}}}export{p as Anchor,f as PlacedSymbol,b as Placement,u as PlacementEngine,g as TILE_COORD_SIZE,x as TILE_PIXEL_RATIO,m as TILE_PIXEL_SIZE};\n"]},"metadata":{},"sourceType":"module"}