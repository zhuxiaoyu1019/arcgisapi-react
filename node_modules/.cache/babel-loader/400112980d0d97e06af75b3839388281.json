{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Error.js\";\nimport { clone as t } from \"../../../../core/lang.js\";\nimport n from \"../../../../core/Logger.js\";\nimport { decodeRGB as r, decodeIntensity as o } from \"./LEPCC.js\";\nconst i = n.getLogger(\"esri.views.3d.layers.i3s.I3SBinaryReader\");\n\nfunction u(t, n, r) {\n  let o = \"\",\n      i = 0;\n\n  for (; i < r;) {\n    const u = t[n + i];\n    if (u < 128) o += String.fromCharCode(u), i++;else if (u >= 192 && u < 224) {\n      if (i + 1 >= r) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Two byte character was truncated.\");\n      const a = (31 & u) << 6 | 63 & t[n + i + 1];\n      o += String.fromCharCode(a), i += 2;\n    } else if (u >= 224 && u < 240) {\n      if (i + 2 >= r) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Multi byte character was truncated.\");\n      const a = (15 & u) << 12 | (63 & t[n + i + 1]) << 6 | 63 & t[n + i + 2];\n      o += String.fromCharCode(a), i += 3;\n    } else {\n      if (!(u >= 240 && u < 248)) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Invalid multi byte sequence.\");\n      {\n        if (i + 3 >= r) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Multi byte character was truncated.\");\n        const a = (7 & u) << 18 | (63 & t[n + i + 1]) << 12 | (63 & t[n + i + 2]) << 6 | 63 & t[n + i + 3];\n\n        if (a >= 65536) {\n          const e = 55296 + (a - 65536 >> 10),\n                t = 56320 + (1023 & a);\n          o += String.fromCharCode(e, t);\n        } else o += String.fromCharCode(a);\n\n        i += 4;\n      }\n    }\n  }\n\n  return o;\n}\n\nfunction a(e, t) {\n  const n = {\n    byteOffset: 0,\n    byteCount: 0,\n    fields: Object.create(null)\n  };\n  let r = 0;\n\n  for (let o = 0; o < t.length; o++) {\n    const i = t[o],\n          u = i.valueType || i.type,\n          a = I[u];\n    n.fields[i.property] = a(e, r), r += m[u].BYTES_PER_ELEMENT;\n  }\n\n  return n.byteCount = r, n;\n}\n\nfunction s(t, n, r) {\n  const o = [];\n  let i,\n      a,\n      s = 0;\n\n  for (a = 0; a < t; a += 1) {\n    if (i = n[a], i > 0) {\n      if (o.push(u(r, s, i - 1)), 0 !== r[s + i - 1]) throw new e(\"string-array-error\", \"Invalid string array: missing null termination.\");\n    } else o.push(null);\n\n    s += i;\n  }\n\n  return o;\n}\n\nfunction c(e, t) {\n  return new (0, m[t.valueType])(e, t.byteOffset, t.count * t.valuesPerElement);\n}\n\nfunction f(e, t) {\n  return new Uint8Array(e, t.byteOffset, t.byteCount);\n}\n\nfunction l(n, r, o) {\n  const i = null != r.header ? a(n, r.header) : {\n    byteOffset: 0,\n    byteCount: 0,\n    fields: {\n      count: o\n    }\n  },\n        u = {\n    header: i,\n    byteOffset: i.byteCount,\n    byteCount: 0,\n    entries: Object.create(null)\n  };\n  let s = i.byteCount;\n\n  for (let a = 0; a < r.ordering.length; a++) {\n    const n = r.ordering[a],\n          o = t(r[n]);\n\n    if (o.count = i.fields.count, \"String\" === o.valueType) {\n      if (o.byteOffset = s, o.byteCount = i.fields[n + \"ByteCount\"], \"UTF-8\" !== o.encoding) throw new e(\"unsupported-encoding\", \"Unsupported String encoding.\", {\n        encoding: o.encoding\n      });\n    } else {\n      if (!h(o.valueType)) throw new e(\"unsupported-value-type\", \"Unsupported binary valueType\", {\n        valueType: o.valueType\n      });\n      {\n        const e = A(o.valueType);\n        s += s % e != 0 ? e - s % e : 0, o.byteOffset = s, o.byteCount = e * o.valuesPerElement * o.count;\n      }\n    }\n\n    s += o.byteCount, u.entries[n] = o;\n  }\n\n  return u.byteCount = s - u.byteOffset, u;\n}\n\nfunction b(t, n, r) {\n  if (n !== t && i.error(`Invalid ${r} buffer size\\n expected: ${t}, actual: ${n})`), n < t) throw new e(\"buffer-too-small\", \"Binary buffer is too small\", {\n    expectedSize: t,\n    actualSize: n\n  });\n}\n\nfunction d(e) {\n  return {\n    isDraco: !1,\n    isLegacy: !1,\n    color: null != e.color,\n    normal: null != e.normal,\n    uv0: null != e.uv0,\n    uvRegion: null != e.uvRegion,\n    featureIndex: null != e.faceRange && null != e.featureId\n  };\n}\n\nfunction y(e, t) {\n  const n = a(e, t && t.header);\n  let r = n.byteCount;\n  const o = {\n    isDraco: !1,\n    header: n,\n    byteOffset: n.byteCount,\n    byteCount: 0,\n    vertexAttributes: {}\n  },\n        i = n.fields,\n        u = null != i.vertexCount ? i.vertexCount : i.count;\n\n  for (const a of t.ordering) {\n    if (!t.vertexAttributes[a]) continue;\n    const e = { ...t.vertexAttributes[a],\n      byteOffset: r,\n      count: u\n    },\n          n = p[a] ? p[a] : \"_\" + a;\n    o.vertexAttributes[n] = e, r += A(e.valueType) * e.valuesPerElement * u;\n  }\n\n  const s = i.faceCount;\n\n  if (t.faces && s) {\n    o.faces = {};\n\n    for (const e of t.ordering) {\n      if (!t.faces[e]) continue;\n      const n = { ...t.faces[e],\n        byteOffset: r,\n        count: s\n      };\n      o.faces[e] = n, r += A(n.valueType) * n.valuesPerElement * s;\n    }\n  }\n\n  const c = i.featureCount;\n\n  if (t.featureAttributes && t.featureAttributeOrder && c) {\n    o.featureAttributes = {};\n\n    for (const e of t.featureAttributeOrder) {\n      if (!t.featureAttributes[e]) continue;\n      const n = { ...t.featureAttributes[e],\n        byteOffset: r,\n        count: c\n      };\n      o.featureAttributes[e] = n;\n      r += (\"UInt64\" === n.valueType ? 8 : A(n.valueType)) * n.valuesPerElement * c;\n    }\n  }\n\n  return b(r, e.byteLength, \"geometry\"), o.byteCount = r - o.byteOffset, o;\n}\n\nfunction g(e, t) {\n  return !(!e || !e.compressedAttributes || \"draco\" !== e.compressedAttributes.encoding) ? v(e.compressedAttributes.attributes) : e ? d(e) : w(t);\n}\n\nfunction w(e) {\n  const t = {\n    isDraco: !1,\n    isLegacy: !0,\n    color: !1,\n    normal: !1,\n    uv0: !1,\n    uvRegion: !1,\n    featureIndex: !1\n  };\n\n  for (const n of e.ordering) if (e.vertexAttributes[n]) switch (n) {\n    case \"position\":\n      break;\n\n    case \"normal\":\n      t.normal = !0;\n      break;\n\n    case \"color\":\n      t.color = !0;\n      break;\n\n    case \"uv0\":\n      t.uv0 = !0;\n      break;\n\n    case \"region\":\n      t.uvRegion = !0;\n  }\n\n  return e.featureAttributes && e.featureAttributeOrder && (t.featureIndex = !0), t;\n}\n\nfunction v(e) {\n  const t = {\n    isDraco: !0,\n    isLegacy: !1,\n    color: !1,\n    normal: !1,\n    uv0: !1,\n    uvRegion: !1,\n    featureIndex: !1\n  };\n\n  for (const n of e) switch (n) {\n    case \"position\":\n      break;\n\n    case \"normal\":\n      t.normal = !0;\n      break;\n\n    case \"uv0\":\n      t.uv0 = !0;\n      break;\n\n    case \"color\":\n      t.color = !0;\n      break;\n\n    case \"uv-region\":\n      t.uvRegion = !0;\n      break;\n\n    case \"feature-index\":\n      t.featureIndex = !0;\n  }\n\n  return t;\n}\n\nconst p = {\n  position: \"position\",\n  normal: \"normal\",\n  color: \"color\",\n  uv0: \"uv0\",\n  region: \"uvRegion\"\n};\n\nfunction C(t, n, u) {\n  if (\"lepcc-rgb\" === t.encoding) return r(n);\n  if (\"lepcc-intensity\" === t.encoding) return o(n);\n  if (null != t.encoding && \"\" !== t.encoding) throw new e(\"unknown-attribute-storage-info-encoding\", \"Unknown Attribute Storage Info Encoding\");\n  t[\"attributeByteCounts \"] && !t.attributeByteCounts && (i.warn(\"Warning: Trailing space in 'attributeByteCounts '.\"), t.attributeByteCounts = t[\"attributeByteCounts \"]), \"ObjectIds\" === t.ordering[0] && t.hasOwnProperty(\"objectIds\") && (i.warn(\"Warning: Case error in objectIds\"), t.ordering[0] = \"objectIds\");\n  const a = l(n, t, u);\n  b(a.byteOffset + a.byteCount, n.byteLength, \"attribute\");\n  const d = a.entries.attributeValues || a.entries.objectIds;\n\n  if (d) {\n    if (\"String\" === d.valueType) {\n      const e = a.entries.attributeByteCounts,\n            t = c(n, e),\n            r = f(n, d);\n      return s(e.count, t, r);\n    }\n\n    return c(n, d);\n  }\n\n  throw new e(\"bad-attribute-storage-info\", \"Bad attributeStorageInfo specification.\");\n}\n\nconst m = {\n  Float32: Float32Array,\n  Float64: Float64Array,\n  UInt8: Uint8Array,\n  Int8: Int8Array,\n  UInt16: Uint16Array,\n  Int16: Int16Array,\n  UInt32: Uint32Array,\n  Int32: Int32Array\n},\n      I = {\n  Float32: (e, t) => new DataView(e, 0).getFloat32(t, !0),\n  Float64: (e, t) => new DataView(e, 0).getFloat64(t, !0),\n  UInt8: (e, t) => new DataView(e, 0).getUint8(t),\n  Int8: (e, t) => new DataView(e, 0).getInt8(t),\n  UInt16: (e, t) => new DataView(e, 0).getUint16(t, !0),\n  Int16: (e, t) => new DataView(e, 0).getInt16(t, !0),\n  UInt32: (e, t) => new DataView(e, 0).getUint32(t, !0),\n  Int32: (e, t) => new DataView(e, 0).getInt32(t, !0)\n};\n\nfunction h(e) {\n  return m.hasOwnProperty(e);\n}\n\nfunction A(e) {\n  return h(e) ? m[e].BYTES_PER_ELEMENT : 0;\n}\n\nexport { l as createAttributeDataIndex, g as createGeometryDescriptor, v as createGeometryDescriptorForDraco, d as createGeometryDescriptorFromDefinition, w as createGeometryDescriptorFromSchema, y as createGeometryIndexFromSchema, f as createRawView, c as createTypedView, A as getBytesPerValue, h as isValueType, C as readBinaryAttribute, a as readHeader, s as readStringArray, I as valueType2ArrayBufferReader, m as valueType2TypedArrayClassMap };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js"],"names":["e","clone","t","n","decodeRGB","r","decodeIntensity","o","i","getLogger","u","String","fromCharCode","a","byteOffset","byteCount","fields","Object","create","length","valueType","type","I","property","m","BYTES_PER_ELEMENT","s","push","c","count","valuesPerElement","f","Uint8Array","l","header","entries","ordering","encoding","h","A","b","error","expectedSize","actualSize","d","isDraco","isLegacy","color","normal","uv0","uvRegion","featureIndex","faceRange","featureId","y","vertexAttributes","vertexCount","p","faceCount","faces","featureCount","featureAttributes","featureAttributeOrder","byteLength","g","compressedAttributes","v","attributes","w","position","region","C","attributeByteCounts","warn","hasOwnProperty","attributeValues","objectIds","Float32","Float32Array","Float64","Float64Array","UInt8","Int8","Int8Array","UInt16","Uint16Array","Int16","Int16Array","UInt32","Uint32Array","Int32","Int32Array","DataView","getFloat32","getFloat64","getUint8","getInt8","getUint16","getInt16","getUint32","getInt32","createAttributeDataIndex","createGeometryDescriptor","createGeometryDescriptorForDraco","createGeometryDescriptorFromDefinition","createGeometryDescriptorFromSchema","createGeometryIndexFromSchema","createRawView","createTypedView","getBytesPerValue","isValueType","readBinaryAttribute","readHeader","readStringArray","valueType2ArrayBufferReader","valueType2TypedArrayClassMap"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import{clone as t}from\"../../../../core/lang.js\";import n from\"../../../../core/Logger.js\";import{decodeRGB as r,decodeIntensity as o}from\"./LEPCC.js\";const i=n.getLogger(\"esri.views.3d.layers.i3s.I3SBinaryReader\");function u(t,n,r){let o=\"\",i=0;for(;i<r;){const u=t[n+i];if(u<128)o+=String.fromCharCode(u),i++;else if(u>=192&&u<224){if(i+1>=r)throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Two byte character was truncated.\");const a=(31&u)<<6|63&t[n+i+1];o+=String.fromCharCode(a),i+=2}else if(u>=224&&u<240){if(i+2>=r)throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Multi byte character was truncated.\");const a=(15&u)<<12|(63&t[n+i+1])<<6|63&t[n+i+2];o+=String.fromCharCode(a),i+=3}else{if(!(u>=240&&u<248))throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Invalid multi byte sequence.\");{if(i+3>=r)throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Multi byte character was truncated.\");const a=(7&u)<<18|(63&t[n+i+1])<<12|(63&t[n+i+2])<<6|63&t[n+i+3];if(a>=65536){const e=55296+(a-65536>>10),t=56320+(1023&a);o+=String.fromCharCode(e,t)}else o+=String.fromCharCode(a);i+=4}}}return o}function a(e,t){const n={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let o=0;o<t.length;o++){const i=t[o],u=i.valueType||i.type,a=I[u];n.fields[i.property]=a(e,r),r+=m[u].BYTES_PER_ELEMENT}return n.byteCount=r,n}function s(t,n,r){const o=[];let i,a,s=0;for(a=0;a<t;a+=1){if(i=n[a],i>0){if(o.push(u(r,s,i-1)),0!==r[s+i-1])throw new e(\"string-array-error\",\"Invalid string array: missing null termination.\")}else o.push(null);s+=i}return o}function c(e,t){return new(0,m[t.valueType])(e,t.byteOffset,t.count*t.valuesPerElement)}function f(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function l(n,r,o){const i=null!=r.header?a(n,r.header):{byteOffset:0,byteCount:0,fields:{count:o}},u={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let a=0;a<r.ordering.length;a++){const n=r.ordering[a],o=t(r[n]);if(o.count=i.fields.count,\"String\"===o.valueType){if(o.byteOffset=s,o.byteCount=i.fields[n+\"ByteCount\"],\"UTF-8\"!==o.encoding)throw new e(\"unsupported-encoding\",\"Unsupported String encoding.\",{encoding:o.encoding})}else{if(!h(o.valueType))throw new e(\"unsupported-value-type\",\"Unsupported binary valueType\",{valueType:o.valueType});{const e=A(o.valueType);s+=s%e!=0?e-s%e:0,o.byteOffset=s,o.byteCount=e*o.valuesPerElement*o.count}}s+=o.byteCount,u.entries[n]=o}return u.byteCount=s-u.byteOffset,u}function b(t,n,r){if(n!==t&&i.error(`Invalid ${r} buffer size\\n expected: ${t}, actual: ${n})`),n<t)throw new e(\"buffer-too-small\",\"Binary buffer is too small\",{expectedSize:t,actualSize:n})}function d(e){return{isDraco:!1,isLegacy:!1,color:null!=e.color,normal:null!=e.normal,uv0:null!=e.uv0,uvRegion:null!=e.uvRegion,featureIndex:null!=e.faceRange&&null!=e.featureId}}function y(e,t){const n=a(e,t&&t.header);let r=n.byteCount;const o={isDraco:!1,header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:{}},i=n.fields,u=null!=i.vertexCount?i.vertexCount:i.count;for(const a of t.ordering){if(!t.vertexAttributes[a])continue;const e={...t.vertexAttributes[a],byteOffset:r,count:u},n=p[a]?p[a]:\"_\"+a;o.vertexAttributes[n]=e,r+=A(e.valueType)*e.valuesPerElement*u}const s=i.faceCount;if(t.faces&&s){o.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const n={...t.faces[e],byteOffset:r,count:s};o.faces[e]=n,r+=A(n.valueType)*n.valuesPerElement*s}}const c=i.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&c){o.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const n={...t.featureAttributes[e],byteOffset:r,count:c};o.featureAttributes[e]=n;r+=(\"UInt64\"===n.valueType?8:A(n.valueType))*n.valuesPerElement*c}}return b(r,e.byteLength,\"geometry\"),o.byteCount=r-o.byteOffset,o}function g(e,t){return!(!e||!e.compressedAttributes||\"draco\"!==e.compressedAttributes.encoding)?v(e.compressedAttributes.attributes):e?d(e):w(t)}function w(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of e.ordering)if(e.vertexAttributes[n])switch(n){case\"position\":break;case\"normal\":t.normal=!0;break;case\"color\":t.color=!0;break;case\"uv0\":t.uv0=!0;break;case\"region\":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function v(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of e)switch(n){case\"position\":break;case\"normal\":t.normal=!0;break;case\"uv0\":t.uv0=!0;break;case\"color\":t.color=!0;break;case\"uv-region\":t.uvRegion=!0;break;case\"feature-index\":t.featureIndex=!0}return t}const p={position:\"position\",normal:\"normal\",color:\"color\",uv0:\"uv0\",region:\"uvRegion\"};function C(t,n,u){if(\"lepcc-rgb\"===t.encoding)return r(n);if(\"lepcc-intensity\"===t.encoding)return o(n);if(null!=t.encoding&&\"\"!==t.encoding)throw new e(\"unknown-attribute-storage-info-encoding\",\"Unknown Attribute Storage Info Encoding\");t[\"attributeByteCounts \"]&&!t.attributeByteCounts&&(i.warn(\"Warning: Trailing space in 'attributeByteCounts '.\"),t.attributeByteCounts=t[\"attributeByteCounts \"]),\"ObjectIds\"===t.ordering[0]&&t.hasOwnProperty(\"objectIds\")&&(i.warn(\"Warning: Case error in objectIds\"),t.ordering[0]=\"objectIds\");const a=l(n,t,u);b(a.byteOffset+a.byteCount,n.byteLength,\"attribute\");const d=a.entries.attributeValues||a.entries.objectIds;if(d){if(\"String\"===d.valueType){const e=a.entries.attributeByteCounts,t=c(n,e),r=f(n,d);return s(e.count,t,r)}return c(n,d)}throw new e(\"bad-attribute-storage-info\",\"Bad attributeStorageInfo specification.\")}const m={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},I={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function h(e){return m.hasOwnProperty(e)}function A(e){return h(e)?m[e].BYTES_PER_ELEMENT:0}export{l as createAttributeDataIndex,g as createGeometryDescriptor,v as createGeometryDescriptorForDraco,d as createGeometryDescriptorFromDefinition,w as createGeometryDescriptorFromSchema,y as createGeometryIndexFromSchema,f as createRawView,c as createTypedView,A as getBytesPerValue,h as isValueType,C as readBinaryAttribute,a as readHeader,s as readStringArray,I as valueType2ArrayBufferReader,m as valueType2TypedArrayClassMap};\n"]},"metadata":{},"sourceType":"module"}