{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport r from \"../../../../core/Handles.js\";\nimport { createAbortController as o, isAbortError as s } from \"../../../../core/promiseUtils.js\";\nimport { on as i } from \"../../../../core/watchUtils.js\";\nimport { property as a } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { c as l } from \"../../../../chunks/vec3f64.js\";\nimport c from \"../../../../geometry/Point.js\";\nimport { center as p } from \"../../../../geometry/support/aaBoundingRect.js\";\nlet u = class extends t {\n  constructor(e) {\n    super(e), this.location = null, this._updateController = null, this._handles = new r();\n  }\n\n  get renderLocation() {\n    if (!this.location) return null;\n    const e = l();\n    return this.view.renderCoordsHelper.toRenderCoords(this.location, e), e;\n  }\n\n  initialize() {\n    this.view.state.isLocal && (this._handles.add([this.watch([\"surfaceView.spatialReference\", \"surfaceView.extent\"], () => this._update()), i(this, \"surface.layers\", \"change\", () => this._update())]), this._update());\n  }\n\n  destroy() {\n    this._handles.destroy();\n  }\n\n  _update() {\n    if (this._updateController && (this._updateController.abort(), this._updateController = null), !this.surfaceView || !this.surfaceView.extent || !this.surfaceView.spatialReference) return void this._set(\"location\", null);\n    const e = p(this.surfaceView.extent),\n          t = new c({\n      x: e[0],\n      y: e[1],\n      z: 0,\n      spatialReference: this.surfaceView.spatialReference\n    });\n    this.surface && this.surface.layers.length > 0 ? (this._set(\"location\", null), this._updateController = o(), this.surface.queryElevation(t, {\n      noDataValue: 0,\n      signal: this._updateController.signal,\n      cache: this.cache\n    }).then(e => {\n      this._updateController = null, this._set(\"location\", e.geometry);\n    }).catch(e => {\n      s(e) || e && \"elevation-query:invalid-layer\" === e.name || console.error(\"StableSurfaceCenter failed to update: \", e);\n    })) : this._set(\"location\", t);\n  }\n\n};\ne([a({\n  constructOnly: !0\n})], u.prototype, \"view\", void 0), e([a({\n  constructOnly: !0\n})], u.prototype, \"cache\", void 0), e([a({\n  readOnly: !0,\n  aliasOf: \"view.map.ground\"\n})], u.prototype, \"surface\", void 0), e([a({\n  readOnly: !0,\n  aliasOf: \"view.basemapTerrain\"\n})], u.prototype, \"surfaceView\", void 0), e([a({\n  readOnly: !0\n})], u.prototype, \"location\", void 0), e([a({\n  readOnly: !0\n})], u.prototype, \"renderLocation\", null), u = e([n(\"esri.views.3d.terrain.StableSurfaceCenter\")], u);\nexport { u as StableSurfaceCenter };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/support/pointsOfInterest/StableSurfaceCenter.js"],"names":["_","e","t","r","createAbortController","o","isAbortError","s","on","i","property","a","subclass","n","c","l","center","p","u","constructor","location","_updateController","_handles","renderLocation","view","renderCoordsHelper","toRenderCoords","initialize","state","isLocal","add","watch","_update","destroy","abort","surfaceView","extent","spatialReference","_set","x","y","z","surface","layers","length","queryElevation","noDataValue","signal","cache","then","geometry","catch","name","console","error","constructOnly","prototype","readOnly","aliasOf","StableSurfaceCenter"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Handles.js\";import{createAbortController as o,isAbortError as s}from\"../../../../core/promiseUtils.js\";import{on as i}from\"../../../../core/watchUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{c as l}from\"../../../../chunks/vec3f64.js\";import c from\"../../../../geometry/Point.js\";import{center as p}from\"../../../../geometry/support/aaBoundingRect.js\";let u=class extends t{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new r}get renderLocation(){if(!this.location)return null;const e=l();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([this.watch([\"surfaceView.spatialReference\",\"surfaceView.extent\"],(()=>this._update())),i(this,\"surface.layers\",\"change\",(()=>this._update()))]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||!this.surfaceView.extent||!this.surfaceView.spatialReference)return void this._set(\"location\",null);const e=p(this.surfaceView.extent),t=new c({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set(\"location\",null),this._updateController=o(),this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set(\"location\",e.geometry)})).catch((e=>{s(e)||e&&\"elevation-query:invalid-layer\"===e.name||console.error(\"StableSurfaceCenter failed to update: \",e)}))):this._set(\"location\",t)}};e([a({constructOnly:!0})],u.prototype,\"view\",void 0),e([a({constructOnly:!0})],u.prototype,\"cache\",void 0),e([a({readOnly:!0,aliasOf:\"view.map.ground\"})],u.prototype,\"surface\",void 0),e([a({readOnly:!0,aliasOf:\"view.basemapTerrain\"})],u.prototype,\"surfaceView\",void 0),e([a({readOnly:!0})],u.prototype,\"location\",void 0),e([a({readOnly:!0})],u.prototype,\"renderLocation\",null),u=e([n(\"esri.views.3d.terrain.StableSurfaceCenter\")],u);export{u as StableSurfaceCenter};\n"]},"metadata":{},"sourceType":"module"}