{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport { slice as t } from \"../../../core/typedArrayUtil.js\";\nimport { get as r } from \"../../../libs/i3s/I3SModule.js\";\n\nasync function n(e) {\n  await h();\n  const t = [e.geometryBuffer];\n  return {\n    result: y(e, t),\n    transferList: t\n  };\n}\n\nasync function o(e) {\n  var r;\n  await h();\n\n  const n = [e.geometryBuffer],\n        {\n    geometryBuffer: o\n  } = e,\n        s = o.byteLength,\n        f = c._malloc(s),\n        i = new Uint8Array(c.HEAPU8.buffer, f, s);\n\n  i.set(new Uint8Array(o));\n  const a = c.dracoDecompressPointCloudData(f, i.byteLength);\n  if (c._free(f), a.error.length > 0) throw `i3s.wasm: ${a.error}`;\n  const u = (null == (r = a.featureIds) ? void 0 : r.length) > 0 ? t(a.featureIds) : null,\n        l = t(a.positions);\n  u && n.push(u.buffer), n.push(l.buffer);\n  return {\n    result: {\n      positions: l,\n      featureIds: u\n    },\n    transferList: n\n  };\n}\n\nasync function s(e) {\n  await h(), m(e);\n  const t = {\n    buffer: e.buffer\n  };\n  return {\n    result: t,\n    transferList: [t.buffer]\n  };\n}\n\nasync function f(e) {\n  await h(), l(e);\n}\n\nasync function i(e) {\n  await h(), c.setLegacySchema(e.context, e.jsonSchema);\n}\n\nfunction a(e) {\n  d(e);\n}\n\nlet u, c;\n\nfunction l(e) {\n  const t = e.modifications,\n        r = c._malloc(8 * t.length),\n        n = new Float64Array(c.HEAPU8.buffer, r, t.length);\n\n  for (let o = 0; o < t.length; ++o) n[o] = t[o];\n\n  c.setModifications(e.context, r, t.length, e.isGeodetic), c._free(r);\n}\n\nfunction y(r, n) {\n  if (!c) return null;\n\n  const {\n    context: o,\n    localOrigin: s,\n    globalTrafo: f,\n    mbs: i,\n    obb: a,\n    elevationOffset: u,\n    geometryBuffer: l,\n    geometryDescriptor: y,\n    indexToVertexProjector: b,\n    vertexToRenderProjector: m\n  } = r,\n        d = c._malloc(l.byteLength),\n        h = 33,\n        p = c._malloc(h * Float64Array.BYTES_PER_ELEMENT),\n        g = new Uint8Array(c.HEAPU8.buffer, d, l.byteLength);\n\n  g.set(new Uint8Array(l));\n  const w = new Float64Array(c.HEAPU8.buffer, p, h);\n  E(w, s);\n\n  let A = w.byteOffset + 3 * w.BYTES_PER_ELEMENT,\n      _ = new Float64Array(w.buffer, A);\n\n  E(_, f), A += 16 * w.BYTES_PER_ELEMENT, _ = new Float64Array(w.buffer, A), E(_, i), A += 4 * w.BYTES_PER_ELEMENT, e(a) && (_ = new Float64Array(w.buffer, A), E(_, a.center), A += 3 * w.BYTES_PER_ELEMENT, _ = new Float64Array(w.buffer, A), E(_, a.halfSize), A += 3 * w.BYTES_PER_ELEMENT, _ = new Float64Array(w.buffer, A), E(_, a.quaternion));\n  const L = y,\n        T = {\n    isDraco: !1,\n    isLegacy: !1,\n    color: r.layouts.some(e => e.some(e => \"color\" === e.name)),\n    normal: r.needNormals && r.layouts.some(e => e.some(e => \"normalCompressed\" === e.name)),\n    uv0: r.layouts.some(e => e.some(e => \"uv0\" === e.name)),\n    uvRegion: r.layouts.some(e => e.some(e => \"uvRegion\" === e.name)),\n    featureIndex: L.featureIndex\n  },\n        I = c.process(o, !!r.obb, d, g.byteLength, L, T, p, u, b, m, r.normalReferenceFrame);\n  if (c._free(p), c._free(d), I.error.length > 0) throw `i3s.wasm: ${I.error}`;\n  if (I.discarded) return null;\n  const P = I.componentOffsets.length > 0 ? t(I.componentOffsets) : null,\n        U = I.featureIds.length > 0 ? t(I.featureIds) : null,\n        B = t(I.interleavedVertedData).buffer,\n        F = 1 === I.indicesType ? t(new Uint16Array(I.indices.buffer, I.indices.byteOffset, I.indices.byteLength / 2)) : t(new Uint32Array(I.indices.buffer, I.indices.byteOffset, I.indices.byteLength / 4)),\n        v = t(I.positions),\n        x = 1 === I.positionIndicesType ? t(new Uint16Array(I.positionIndices.buffer, I.positionIndices.byteOffset, I.positionIndices.byteLength / 2)) : t(new Uint32Array(I.positionIndices.buffer, I.positionIndices.byteOffset, I.positionIndices.byteLength / 4)),\n        M = {\n    layout: r.layouts[0],\n    interleavedVertexData: B,\n    indices: F,\n    hasColors: I.hasColors,\n    hasModifications: I.hasModifications,\n    positionData: {\n      data: v,\n      indices: x\n    }\n  };\n  return U && n.push(U.buffer), P && n.push(P.buffer), n.push(B), n.push(F.buffer), n.push(v.buffer), n.push(x.buffer), {\n    componentOffsets: P,\n    featureIds: U,\n    transformedGeometry: M,\n    obb: I.obb\n  };\n}\n\nfunction b(e) {\n  return 0 === e ? 0 : 1 === e ? 1 : 2 === e ? 2 : 3;\n}\n\nfunction m(e) {\n  const {\n    context: t,\n    buffer: r\n  } = e,\n        n = c._malloc(r.byteLength),\n        o = r.byteLength / Float64Array.BYTES_PER_ELEMENT,\n        s = new Float64Array(c.HEAPU8.buffer, n, o),\n        f = new Float64Array(r);\n\n  s.set(f), c.filterOBBs(t, n, o), f.set(s), c._free(n);\n}\n\nfunction d(e) {\n  c && c.destroy(e);\n}\n\nfunction E(e, t) {\n  for (let r = 0; r < t.length; ++r) e[r] = t[r];\n}\n\nfunction h() {\n  return c ? Promise.resolve() : (u || (u = r().then(e => {\n    c = e, u = null;\n  })), u);\n}\n\nconst p = {\n  transform: y,\n  destroy: d\n};\nexport { a as destroyContext, o as dracoDecompressPointCloudData, s as filterObbsForModifications, m as filterObbsForModificationsSync, h as initialize, b as interpretObbModificationResults, n as process, i as setLegacySchema, f as setModifications, l as setModificationsSync, p as test };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js"],"names":["isSome","e","slice","t","get","r","n","h","geometryBuffer","result","y","transferList","o","s","byteLength","f","c","_malloc","i","Uint8Array","HEAPU8","buffer","set","a","dracoDecompressPointCloudData","_free","error","length","u","featureIds","l","positions","push","m","setLegacySchema","context","jsonSchema","d","modifications","Float64Array","setModifications","isGeodetic","localOrigin","globalTrafo","mbs","obb","elevationOffset","geometryDescriptor","indexToVertexProjector","b","vertexToRenderProjector","p","BYTES_PER_ELEMENT","g","w","E","A","byteOffset","_","center","halfSize","quaternion","L","T","isDraco","isLegacy","color","layouts","some","name","normal","needNormals","uv0","uvRegion","featureIndex","I","process","normalReferenceFrame","discarded","P","componentOffsets","U","B","interleavedVertedData","F","indicesType","Uint16Array","indices","Uint32Array","v","x","positionIndicesType","positionIndices","M","layout","interleavedVertexData","hasColors","hasModifications","positionData","data","transformedGeometry","filterOBBs","destroy","Promise","resolve","then","transform","destroyContext","filterObbsForModifications","filterObbsForModificationsSync","initialize","interpretObbModificationResults","setModificationsSync","test"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,wBAAvB;AAAgD,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,iCAAtB;AAAwD,SAAOC,GAAG,IAAIC,CAAd,QAAoB,gCAApB;;AAAqD,eAAeC,CAAf,CAAiBL,CAAjB,EAAmB;AAAC,QAAMM,CAAC,EAAP;AAAU,QAAMJ,CAAC,GAAC,CAACF,CAAC,CAACO,cAAH,CAAR;AAA2B,SAAM;AAACC,IAAAA,MAAM,EAACC,CAAC,CAACT,CAAD,EAAGE,CAAH,CAAT;AAAeQ,IAAAA,YAAY,EAACR;AAA5B,GAAN;AAAqC;;AAAA,eAAeS,CAAf,CAAiBX,CAAjB,EAAmB;AAAC,MAAII,CAAJ;AAAM,QAAME,CAAC,EAAP;;AAAU,QAAMD,CAAC,GAAC,CAACL,CAAC,CAACO,cAAH,CAAR;AAAA,QAA2B;AAACA,IAAAA,cAAc,EAACI;AAAhB,MAAmBX,CAA9C;AAAA,QAAgDY,CAAC,GAACD,CAAC,CAACE,UAApD;AAAA,QAA+DC,CAAC,GAACC,CAAC,CAACC,OAAF,CAAUJ,CAAV,CAAjE;AAAA,QAA8EK,CAAC,GAAC,IAAIC,UAAJ,CAAeH,CAAC,CAACI,MAAF,CAASC,MAAxB,EAA+BN,CAA/B,EAAiCF,CAAjC,CAAhF;;AAAoHK,EAAAA,CAAC,CAACI,GAAF,CAAM,IAAIH,UAAJ,CAAeP,CAAf,CAAN;AAAyB,QAAMW,CAAC,GAACP,CAAC,CAACQ,6BAAF,CAAgCT,CAAhC,EAAkCG,CAAC,CAACJ,UAApC,CAAR;AAAwD,MAAGE,CAAC,CAACS,KAAF,CAAQV,CAAR,GAAWQ,CAAC,CAACG,KAAF,CAAQC,MAAR,GAAe,CAA7B,EAA+B,MAAM,aAAYJ,CAAC,CAACG,KAAM,EAA1B;AAA4B,QAAME,CAAC,GAAC,CAAC,SAAOvB,CAAC,GAACkB,CAAC,CAACM,UAAX,IAAuB,KAAK,CAA5B,GAA8BxB,CAAC,CAACsB,MAAjC,IAAyC,CAAzC,GAA2CxB,CAAC,CAACoB,CAAC,CAACM,UAAH,CAA5C,GAA2D,IAAnE;AAAA,QAAwEC,CAAC,GAAC3B,CAAC,CAACoB,CAAC,CAACQ,SAAH,CAA3E;AAAyFH,EAAAA,CAAC,IAAEtB,CAAC,CAAC0B,IAAF,CAAOJ,CAAC,CAACP,MAAT,CAAH,EAAoBf,CAAC,CAAC0B,IAAF,CAAOF,CAAC,CAACT,MAAT,CAApB;AAAqC,SAAM;AAACZ,IAAAA,MAAM,EAAC;AAACsB,MAAAA,SAAS,EAACD,CAAX;AAAaD,MAAAA,UAAU,EAACD;AAAxB,KAAR;AAAmCjB,IAAAA,YAAY,EAACL;AAAhD,GAAN;AAAyD;;AAAA,eAAeO,CAAf,CAAiBZ,CAAjB,EAAmB;AAAC,QAAMM,CAAC,EAAP,EAAU0B,CAAC,CAAChC,CAAD,CAAX;AAAe,QAAME,CAAC,GAAC;AAACkB,IAAAA,MAAM,EAACpB,CAAC,CAACoB;AAAV,GAAR;AAA0B,SAAM;AAACZ,IAAAA,MAAM,EAACN,CAAR;AAAUQ,IAAAA,YAAY,EAAC,CAACR,CAAC,CAACkB,MAAH;AAAvB,GAAN;AAAyC;;AAAA,eAAeN,CAAf,CAAiBd,CAAjB,EAAmB;AAAC,QAAMM,CAAC,EAAP,EAAUuB,CAAC,CAAC7B,CAAD,CAAX;AAAe;;AAAA,eAAeiB,CAAf,CAAiBjB,CAAjB,EAAmB;AAAC,QAAMM,CAAC,EAAP,EAAUS,CAAC,CAACkB,eAAF,CAAkBjC,CAAC,CAACkC,OAApB,EAA4BlC,CAAC,CAACmC,UAA9B,CAAV;AAAoD;;AAAA,SAASb,CAAT,CAAWtB,CAAX,EAAa;AAACoC,EAAAA,CAAC,CAACpC,CAAD,CAAD;AAAK;;AAAA,IAAI2B,CAAJ,EAAMZ,CAAN;;AAAQ,SAASc,CAAT,CAAW7B,CAAX,EAAa;AAAC,QAAME,CAAC,GAACF,CAAC,CAACqC,aAAV;AAAA,QAAwBjC,CAAC,GAACW,CAAC,CAACC,OAAF,CAAU,IAAEd,CAAC,CAACwB,MAAd,CAA1B;AAAA,QAAgDrB,CAAC,GAAC,IAAIiC,YAAJ,CAAiBvB,CAAC,CAACI,MAAF,CAASC,MAA1B,EAAiChB,CAAjC,EAAmCF,CAAC,CAACwB,MAArC,CAAlD;;AAA+F,OAAI,IAAIf,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACT,CAAC,CAACwB,MAAhB,EAAuB,EAAEf,CAAzB,EAA2BN,CAAC,CAACM,CAAD,CAAD,GAAKT,CAAC,CAACS,CAAD,CAAN;;AAAUI,EAAAA,CAAC,CAACwB,gBAAF,CAAmBvC,CAAC,CAACkC,OAArB,EAA6B9B,CAA7B,EAA+BF,CAAC,CAACwB,MAAjC,EAAwC1B,CAAC,CAACwC,UAA1C,GAAsDzB,CAAC,CAACS,KAAF,CAAQpB,CAAR,CAAtD;AAAiE;;AAAA,SAASK,CAAT,CAAWL,CAAX,EAAaC,CAAb,EAAe;AAAC,MAAG,CAACU,CAAJ,EAAM,OAAO,IAAP;;AAAY,QAAK;AAACmB,IAAAA,OAAO,EAACvB,CAAT;AAAW8B,IAAAA,WAAW,EAAC7B,CAAvB;AAAyB8B,IAAAA,WAAW,EAAC5B,CAArC;AAAuC6B,IAAAA,GAAG,EAAC1B,CAA3C;AAA6C2B,IAAAA,GAAG,EAACtB,CAAjD;AAAmDuB,IAAAA,eAAe,EAAClB,CAAnE;AAAqEpB,IAAAA,cAAc,EAACsB,CAApF;AAAsFiB,IAAAA,kBAAkB,EAACrC,CAAzG;AAA2GsC,IAAAA,sBAAsB,EAACC,CAAlI;AAAoIC,IAAAA,uBAAuB,EAACjB;AAA5J,MAA+J5B,CAApK;AAAA,QAAsKgC,CAAC,GAACrB,CAAC,CAACC,OAAF,CAAUa,CAAC,CAAChB,UAAZ,CAAxK;AAAA,QAAgMP,CAAC,GAAC,EAAlM;AAAA,QAAqM4C,CAAC,GAACnC,CAAC,CAACC,OAAF,CAAUV,CAAC,GAACgC,YAAY,CAACa,iBAAzB,CAAvM;AAAA,QAAmPC,CAAC,GAAC,IAAIlC,UAAJ,CAAeH,CAAC,CAACI,MAAF,CAASC,MAAxB,EAA+BgB,CAA/B,EAAiCP,CAAC,CAAChB,UAAnC,CAArP;;AAAoSuC,EAAAA,CAAC,CAAC/B,GAAF,CAAM,IAAIH,UAAJ,CAAeW,CAAf,CAAN;AAAyB,QAAMwB,CAAC,GAAC,IAAIf,YAAJ,CAAiBvB,CAAC,CAACI,MAAF,CAASC,MAA1B,EAAiC8B,CAAjC,EAAmC5C,CAAnC,CAAR;AAA8CgD,EAAAA,CAAC,CAACD,CAAD,EAAGzC,CAAH,CAAD;;AAAO,MAAI2C,CAAC,GAACF,CAAC,CAACG,UAAF,GAAa,IAAEH,CAAC,CAACF,iBAAvB;AAAA,MAAyCM,CAAC,GAAC,IAAInB,YAAJ,CAAiBe,CAAC,CAACjC,MAAnB,EAA0BmC,CAA1B,CAA3C;;AAAwED,EAAAA,CAAC,CAACG,CAAD,EAAG3C,CAAH,CAAD,EAAOyC,CAAC,IAAE,KAAGF,CAAC,CAACF,iBAAf,EAAiCM,CAAC,GAAC,IAAInB,YAAJ,CAAiBe,CAAC,CAACjC,MAAnB,EAA0BmC,CAA1B,CAAnC,EAAgED,CAAC,CAACG,CAAD,EAAGxC,CAAH,CAAjE,EAAuEsC,CAAC,IAAE,IAAEF,CAAC,CAACF,iBAA9E,EAAgGnD,CAAC,CAACsB,CAAD,CAAD,KAAOmC,CAAC,GAAC,IAAInB,YAAJ,CAAiBe,CAAC,CAACjC,MAAnB,EAA0BmC,CAA1B,CAAF,EAA+BD,CAAC,CAACG,CAAD,EAAGnC,CAAC,CAACoC,MAAL,CAAhC,EAA6CH,CAAC,IAAE,IAAEF,CAAC,CAACF,iBAApD,EAAsEM,CAAC,GAAC,IAAInB,YAAJ,CAAiBe,CAAC,CAACjC,MAAnB,EAA0BmC,CAA1B,CAAxE,EAAqGD,CAAC,CAACG,CAAD,EAAGnC,CAAC,CAACqC,QAAL,CAAtG,EAAqHJ,CAAC,IAAE,IAAEF,CAAC,CAACF,iBAA5H,EAA8IM,CAAC,GAAC,IAAInB,YAAJ,CAAiBe,CAAC,CAACjC,MAAnB,EAA0BmC,CAA1B,CAAhJ,EAA6KD,CAAC,CAACG,CAAD,EAAGnC,CAAC,CAACsC,UAAL,CAArL,CAAhG;AAAuS,QAAMC,CAAC,GAACpD,CAAR;AAAA,QAAUqD,CAAC,GAAC;AAACC,IAAAA,OAAO,EAAC,CAAC,CAAV;AAAYC,IAAAA,QAAQ,EAAC,CAAC,CAAtB;AAAwBC,IAAAA,KAAK,EAAC7D,CAAC,CAAC8D,OAAF,CAAUC,IAAV,CAAgBnE,CAAC,IAAEA,CAAC,CAACmE,IAAF,CAAQnE,CAAC,IAAE,YAAUA,CAAC,CAACoE,IAAvB,CAAnB,CAA9B;AAAiFC,IAAAA,MAAM,EAACjE,CAAC,CAACkE,WAAF,IAAelE,CAAC,CAAC8D,OAAF,CAAUC,IAAV,CAAgBnE,CAAC,IAAEA,CAAC,CAACmE,IAAF,CAAQnE,CAAC,IAAE,uBAAqBA,CAAC,CAACoE,IAAlC,CAAnB,CAAvG;AAAqKG,IAAAA,GAAG,EAACnE,CAAC,CAAC8D,OAAF,CAAUC,IAAV,CAAgBnE,CAAC,IAAEA,CAAC,CAACmE,IAAF,CAAQnE,CAAC,IAAE,UAAQA,CAAC,CAACoE,IAArB,CAAnB,CAAzK;AAA0NI,IAAAA,QAAQ,EAACpE,CAAC,CAAC8D,OAAF,CAAUC,IAAV,CAAgBnE,CAAC,IAAEA,CAAC,CAACmE,IAAF,CAAQnE,CAAC,IAAE,eAAaA,CAAC,CAACoE,IAA1B,CAAnB,CAAnO;AAAyRK,IAAAA,YAAY,EAACZ,CAAC,CAACY;AAAxS,GAAZ;AAAA,QAAkUC,CAAC,GAAC3D,CAAC,CAAC4D,OAAF,CAAUhE,CAAV,EAAY,CAAC,CAACP,CAAC,CAACwC,GAAhB,EAAoBR,CAApB,EAAsBgB,CAAC,CAACvC,UAAxB,EAAmCgD,CAAnC,EAAqCC,CAArC,EAAuCZ,CAAvC,EAAyCvB,CAAzC,EAA2CqB,CAA3C,EAA6ChB,CAA7C,EAA+C5B,CAAC,CAACwE,oBAAjD,CAApU;AAA2Y,MAAG7D,CAAC,CAACS,KAAF,CAAQ0B,CAAR,GAAWnC,CAAC,CAACS,KAAF,CAAQY,CAAR,CAAX,EAAsBsC,CAAC,CAACjD,KAAF,CAAQC,MAAR,GAAe,CAAxC,EAA0C,MAAM,aAAYgD,CAAC,CAACjD,KAAM,EAA1B;AAA4B,MAAGiD,CAAC,CAACG,SAAL,EAAe,OAAO,IAAP;AAAY,QAAMC,CAAC,GAACJ,CAAC,CAACK,gBAAF,CAAmBrD,MAAnB,GAA0B,CAA1B,GAA4BxB,CAAC,CAACwE,CAAC,CAACK,gBAAH,CAA7B,GAAkD,IAA1D;AAAA,QAA+DC,CAAC,GAACN,CAAC,CAAC9C,UAAF,CAAaF,MAAb,GAAoB,CAApB,GAAsBxB,CAAC,CAACwE,CAAC,CAAC9C,UAAH,CAAvB,GAAsC,IAAvG;AAAA,QAA4GqD,CAAC,GAAC/E,CAAC,CAACwE,CAAC,CAACQ,qBAAH,CAAD,CAA2B9D,MAAzI;AAAA,QAAgJ+D,CAAC,GAAC,MAAIT,CAAC,CAACU,WAAN,GAAkBlF,CAAC,CAAC,IAAImF,WAAJ,CAAgBX,CAAC,CAACY,OAAF,CAAUlE,MAA1B,EAAiCsD,CAAC,CAACY,OAAF,CAAU9B,UAA3C,EAAsDkB,CAAC,CAACY,OAAF,CAAUzE,UAAV,GAAqB,CAA3E,CAAD,CAAnB,GAAmGX,CAAC,CAAC,IAAIqF,WAAJ,CAAgBb,CAAC,CAACY,OAAF,CAAUlE,MAA1B,EAAiCsD,CAAC,CAACY,OAAF,CAAU9B,UAA3C,EAAsDkB,CAAC,CAACY,OAAF,CAAUzE,UAAV,GAAqB,CAA3E,CAAD,CAAtP;AAAA,QAAsU2E,CAAC,GAACtF,CAAC,CAACwE,CAAC,CAAC5C,SAAH,CAAzU;AAAA,QAAuV2D,CAAC,GAAC,MAAIf,CAAC,CAACgB,mBAAN,GAA0BxF,CAAC,CAAC,IAAImF,WAAJ,CAAgBX,CAAC,CAACiB,eAAF,CAAkBvE,MAAlC,EAAyCsD,CAAC,CAACiB,eAAF,CAAkBnC,UAA3D,EAAsEkB,CAAC,CAACiB,eAAF,CAAkB9E,UAAlB,GAA6B,CAAnG,CAAD,CAA3B,GAAmIX,CAAC,CAAC,IAAIqF,WAAJ,CAAgBb,CAAC,CAACiB,eAAF,CAAkBvE,MAAlC,EAAyCsD,CAAC,CAACiB,eAAF,CAAkBnC,UAA3D,EAAsEkB,CAAC,CAACiB,eAAF,CAAkB9E,UAAlB,GAA6B,CAAnG,CAAD,CAA7d;AAAA,QAAqkB+E,CAAC,GAAC;AAACC,IAAAA,MAAM,EAACzF,CAAC,CAAC8D,OAAF,CAAU,CAAV,CAAR;AAAqB4B,IAAAA,qBAAqB,EAACb,CAA3C;AAA6CK,IAAAA,OAAO,EAACH,CAArD;AAAuDY,IAAAA,SAAS,EAACrB,CAAC,CAACqB,SAAnE;AAA6EC,IAAAA,gBAAgB,EAACtB,CAAC,CAACsB,gBAAhG;AAAiHC,IAAAA,YAAY,EAAC;AAACC,MAAAA,IAAI,EAACV,CAAN;AAAQF,MAAAA,OAAO,EAACG;AAAhB;AAA9H,GAAvkB;AAAytB,SAAOT,CAAC,IAAE3E,CAAC,CAAC0B,IAAF,CAAOiD,CAAC,CAAC5D,MAAT,CAAH,EAAoB0D,CAAC,IAAEzE,CAAC,CAAC0B,IAAF,CAAO+C,CAAC,CAAC1D,MAAT,CAAvB,EAAwCf,CAAC,CAAC0B,IAAF,CAAOkD,CAAP,CAAxC,EAAkD5E,CAAC,CAAC0B,IAAF,CAAOoD,CAAC,CAAC/D,MAAT,CAAlD,EAAmEf,CAAC,CAAC0B,IAAF,CAAOyD,CAAC,CAACpE,MAAT,CAAnE,EAAoFf,CAAC,CAAC0B,IAAF,CAAO0D,CAAC,CAACrE,MAAT,CAApF,EAAqG;AAAC2D,IAAAA,gBAAgB,EAACD,CAAlB;AAAoBlD,IAAAA,UAAU,EAACoD,CAA/B;AAAiCmB,IAAAA,mBAAmB,EAACP,CAArD;AAAuDhD,IAAAA,GAAG,EAAC8B,CAAC,CAAC9B;AAA7D,GAA5G;AAA8K;;AAAA,SAASI,CAAT,CAAWhD,CAAX,EAAa;AAAC,SAAO,MAAIA,CAAJ,GAAM,CAAN,GAAQ,MAAIA,CAAJ,GAAM,CAAN,GAAQ,MAAIA,CAAJ,GAAM,CAAN,GAAQ,CAA/B;AAAiC;;AAAA,SAASgC,CAAT,CAAWhC,CAAX,EAAa;AAAC,QAAK;AAACkC,IAAAA,OAAO,EAAChC,CAAT;AAAWkB,IAAAA,MAAM,EAAChB;AAAlB,MAAqBJ,CAA1B;AAAA,QAA4BK,CAAC,GAACU,CAAC,CAACC,OAAF,CAAUZ,CAAC,CAACS,UAAZ,CAA9B;AAAA,QAAsDF,CAAC,GAACP,CAAC,CAACS,UAAF,GAAayB,YAAY,CAACa,iBAAlF;AAAA,QAAoGvC,CAAC,GAAC,IAAI0B,YAAJ,CAAiBvB,CAAC,CAACI,MAAF,CAASC,MAA1B,EAAiCf,CAAjC,EAAmCM,CAAnC,CAAtG;AAAA,QAA4IG,CAAC,GAAC,IAAIwB,YAAJ,CAAiBlC,CAAjB,CAA9I;;AAAkKQ,EAAAA,CAAC,CAACS,GAAF,CAAMP,CAAN,GAASC,CAAC,CAACqF,UAAF,CAAalG,CAAb,EAAeG,CAAf,EAAiBM,CAAjB,CAAT,EAA6BG,CAAC,CAACO,GAAF,CAAMT,CAAN,CAA7B,EAAsCG,CAAC,CAACS,KAAF,CAAQnB,CAAR,CAAtC;AAAiD;;AAAA,SAAS+B,CAAT,CAAWpC,CAAX,EAAa;AAACe,EAAAA,CAAC,IAAEA,CAAC,CAACsF,OAAF,CAAUrG,CAAV,CAAH;AAAgB;;AAAA,SAASsD,CAAT,CAAWtD,CAAX,EAAaE,CAAb,EAAe;AAAC,OAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACF,CAAC,CAACwB,MAAhB,EAAuB,EAAEtB,CAAzB,EAA2BJ,CAAC,CAACI,CAAD,CAAD,GAAKF,CAAC,CAACE,CAAD,CAAN;AAAU;;AAAA,SAASE,CAAT,GAAY;AAAC,SAAOS,CAAC,GAACuF,OAAO,CAACC,OAAR,EAAD,IAAoB5E,CAAC,KAAGA,CAAC,GAACvB,CAAC,GAAGoG,IAAJ,CAAUxG,CAAC,IAAE;AAACe,IAAAA,CAAC,GAACf,CAAF,EAAI2B,CAAC,GAAC,IAAN;AAAW,GAAzB,CAAL,CAAD,EAAmCA,CAAvD,CAAR;AAAkE;;AAAA,MAAMuB,CAAC,GAAC;AAACuD,EAAAA,SAAS,EAAChG,CAAX;AAAa4F,EAAAA,OAAO,EAACjE;AAArB,CAAR;AAAgC,SAAOd,CAAC,IAAIoF,cAAZ,EAA2B/F,CAAC,IAAIY,6BAAhC,EAA8DX,CAAC,IAAI+F,0BAAnE,EAA8F3E,CAAC,IAAI4E,8BAAnG,EAAkItG,CAAC,IAAIuG,UAAvI,EAAkJ7D,CAAC,IAAI8D,+BAAvJ,EAAuLzG,CAAC,IAAIsE,OAA5L,EAAoM1D,CAAC,IAAIgB,eAAzM,EAAyNnB,CAAC,IAAIyB,gBAA9N,EAA+OV,CAAC,IAAIkF,oBAApP,EAAyQ7D,CAAC,IAAI8D,IAA9Q","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{slice as t}from\"../../../core/typedArrayUtil.js\";import{get as r}from\"../../../libs/i3s/I3SModule.js\";async function n(e){await h();const t=[e.geometryBuffer];return{result:y(e,t),transferList:t}}async function o(e){var r;await h();const n=[e.geometryBuffer],{geometryBuffer:o}=e,s=o.byteLength,f=c._malloc(s),i=new Uint8Array(c.HEAPU8.buffer,f,s);i.set(new Uint8Array(o));const a=c.dracoDecompressPointCloudData(f,i.byteLength);if(c._free(f),a.error.length>0)throw`i3s.wasm: ${a.error}`;const u=(null==(r=a.featureIds)?void 0:r.length)>0?t(a.featureIds):null,l=t(a.positions);u&&n.push(u.buffer),n.push(l.buffer);return{result:{positions:l,featureIds:u},transferList:n}}async function s(e){await h(),m(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function f(e){await h(),l(e)}async function i(e){await h(),c.setLegacySchema(e.context,e.jsonSchema)}function a(e){d(e)}let u,c;function l(e){const t=e.modifications,r=c._malloc(8*t.length),n=new Float64Array(c.HEAPU8.buffer,r,t.length);for(let o=0;o<t.length;++o)n[o]=t[o];c.setModifications(e.context,r,t.length,e.isGeodetic),c._free(r)}function y(r,n){if(!c)return null;const{context:o,localOrigin:s,globalTrafo:f,mbs:i,obb:a,elevationOffset:u,geometryBuffer:l,geometryDescriptor:y,indexToVertexProjector:b,vertexToRenderProjector:m}=r,d=c._malloc(l.byteLength),h=33,p=c._malloc(h*Float64Array.BYTES_PER_ELEMENT),g=new Uint8Array(c.HEAPU8.buffer,d,l.byteLength);g.set(new Uint8Array(l));const w=new Float64Array(c.HEAPU8.buffer,p,h);E(w,s);let A=w.byteOffset+3*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A);E(_,f),A+=16*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A),E(_,i),A+=4*w.BYTES_PER_ELEMENT,e(a)&&(_=new Float64Array(w.buffer,A),E(_,a.center),A+=3*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A),E(_,a.halfSize),A+=3*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A),E(_,a.quaternion));const L=y,T={isDraco:!1,isLegacy:!1,color:r.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:r.needNormals&&r.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:r.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:r.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:L.featureIndex},I=c.process(o,!!r.obb,d,g.byteLength,L,T,p,u,b,m,r.normalReferenceFrame);if(c._free(p),c._free(d),I.error.length>0)throw`i3s.wasm: ${I.error}`;if(I.discarded)return null;const P=I.componentOffsets.length>0?t(I.componentOffsets):null,U=I.featureIds.length>0?t(I.featureIds):null,B=t(I.interleavedVertedData).buffer,F=1===I.indicesType?t(new Uint16Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/2)):t(new Uint32Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/4)),v=t(I.positions),x=1===I.positionIndicesType?t(new Uint16Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/2)):t(new Uint32Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/4)),M={layout:r.layouts[0],interleavedVertexData:B,indices:F,hasColors:I.hasColors,hasModifications:I.hasModifications,positionData:{data:v,indices:x}};return U&&n.push(U.buffer),P&&n.push(P.buffer),n.push(B),n.push(F.buffer),n.push(v.buffer),n.push(x.buffer),{componentOffsets:P,featureIds:U,transformedGeometry:M,obb:I.obb}}function b(e){return 0===e?0:1===e?1:2===e?2:3}function m(e){const{context:t,buffer:r}=e,n=c._malloc(r.byteLength),o=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(c.HEAPU8.buffer,n,o),f=new Float64Array(r);s.set(f),c.filterOBBs(t,n,o),f.set(s),c._free(n)}function d(e){c&&c.destroy(e)}function E(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}function h(){return c?Promise.resolve():(u||(u=r().then((e=>{c=e,u=null}))),u)}const p={transform:y,destroy:d};export{a as destroyContext,o as dracoDecompressPointCloudData,s as filterObbsForModifications,m as filterObbsForModificationsSync,h as initialize,b as interpretObbModificationResults,n as process,i as setLegacySchema,f as setModifications,l as setModificationsSync,p as test};\n"]},"metadata":{},"sourceType":"module"}