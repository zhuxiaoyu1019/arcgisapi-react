{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../geometry.js\";\nimport { isSome as e } from \"../core/maybe.js\";\nimport r from \"../geometry/SpatialReference.js\";\nlet t;\n\nasync function a() {\n  return t || (t = (async () => {\n    const e = await import(\"./arcadeUtils.js\");\n    return await e.arcade.load(), {\n      arcade: e.arcade,\n      arcadeUtils: e,\n      Dictionary: e.Dictionary,\n      Feature: e.arcadeFeature\n    };\n  })()), t;\n}\n\nconst s = (e, r, t) => o.create(e, r, t, null, [\"$feature\"]),\n      i = (e, r, t) => o.create(e, r, t, null, [\"$feature\", \"$view\"]),\n      c = i,\n      n = (e, r, t, a) => o.create(e, r, t, a, [\"$feature\", \"$view\"]);\n\nclass o {\n  constructor(e, r, t, a, s, i, c, n) {\n    this.script = e, this.evaluate = s;\n    const o = Array.isArray(c) ? c : c.fields;\n    this.fields = o, this._syntaxTree = a, this._arcade = r, this._arcadeDictionary = t, this._arcadeFeature = i, this._spatialReference = n, this._referencesGeometry = r.scriptTouchesGeometry(this._syntaxTree), this._referencesScale = this._arcade.referencesMember(this._syntaxTree, \"scale\");\n  }\n\n  static async create(t, s, i, c, n, l) {\n    const {\n      arcade: u,\n      Feature: p,\n      Dictionary: d\n    } = await a(),\n          f = r.fromJSON(s),\n          y = u.parseScript(t, l),\n          h = n.reduce((e, r) => ({ ...e,\n      [r]: null\n    }), {});\n    let m = null;\n    e(c) && (m = new d(c), m.immutable = !0, h.$config = null);\n\n    const _ = u.scriptUsesGeometryEngine(y) && u.enableGeometrySupport(),\n          F = u.scriptUsesFeatureSet(y) && u.enableFeatureSetSupport(),\n          w = u.scriptIsAsync(y) && u.enableAsyncSupport(),\n          S = {\n      vars: h,\n      spatialReference: f,\n      useAsync: !!w\n    },\n          b = new d();\n\n    b.immutable = !1, b.setField(\"scale\", 0);\n\n    const $ = u.compileScript(y, S),\n          x = e => (\"$view\" in e && e.$view && (b.setField(\"scale\", e.$view.scale), e.$view = b), m && (e.$config = m), $({\n      vars: e,\n      spatialReference: f\n    }));\n\n    return await Promise.all([_, F, w]), new o(t, u, d, y, x, new p(), i, f);\n  }\n\n  repurposeFeature(e) {\n    return e.geometry && !e.geometry.spatialReference && (e.geometry.spatialReference = this._spatialReference), this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry, e.attributes, {\n      fields: this.fields\n    }), this._arcadeFeature;\n  }\n\n  repurposeAdapter(e) {\n    return this._arcadeFeature.repurposeFromAdapter(e, {\n      fields: this.fields\n    }), this._arcadeFeature;\n  }\n\n  createDictionary() {\n    return new this._arcadeDictionary();\n  }\n\n  referencesMember(e) {\n    return this._arcade.referencesMember(this._syntaxTree, e);\n  }\n\n  referencesFunction(e) {\n    return this._arcade.referencesFunction(this._syntaxTree, e);\n  }\n\n  referencesGeometry() {\n    return this._referencesGeometry;\n  }\n\n  referencesScale() {\n    return this._referencesScale;\n  }\n\n  extractFieldLiterals(e) {\n    return this._arcade.extractFieldLiterals(this._syntaxTree, e);\n  }\n\n}\n\nexport default o;\nexport { o as ArcadeExpression, n as createDictionaryExpression, s as createLabelExpression, i as createRendererExpression, c as createVVExpression, a as loadArcade };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/support/arcadeOnDemand.js"],"names":["isSome","e","r","t","a","arcade","load","arcadeUtils","Dictionary","Feature","arcadeFeature","s","o","create","i","c","n","constructor","script","evaluate","Array","isArray","fields","_syntaxTree","_arcade","_arcadeDictionary","_arcadeFeature","_spatialReference","_referencesGeometry","scriptTouchesGeometry","_referencesScale","referencesMember","l","u","p","d","f","fromJSON","y","parseScript","h","reduce","m","immutable","$config","_","scriptUsesGeometryEngine","enableGeometrySupport","F","scriptUsesFeatureSet","enableFeatureSetSupport","w","scriptIsAsync","enableAsyncSupport","S","vars","spatialReference","useAsync","b","setField","$","compileScript","x","$view","scale","Promise","all","repurposeFeature","geometry","repurposeFromGraphicLikeObject","attributes","repurposeAdapter","repurposeFromAdapter","createDictionary","referencesFunction","referencesGeometry","referencesScale","extractFieldLiterals","ArcadeExpression","createDictionaryExpression","createLabelExpression","createRendererExpression","createVVExpression","loadArcade"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAM,gBAAN;AAAuB,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,kBAAvB;AAA0C,OAAOC,CAAP,MAAa,iCAAb;AAA+C,IAAIC,CAAJ;;AAAM,eAAeC,CAAf,GAAkB;AAAC,SAAOD,CAAC,KAAGA,CAAC,GAAC,CAAC,YAAS;AAAC,UAAMF,CAAC,GAAC,MAAM,OAAO,kBAAP,CAAd;AAAyC,WAAO,MAAMA,CAAC,CAACI,MAAF,CAASC,IAAT,EAAN,EAAsB;AAACD,MAAAA,MAAM,EAACJ,CAAC,CAACI,MAAV;AAAiBE,MAAAA,WAAW,EAACN,CAA7B;AAA+BO,MAAAA,UAAU,EAACP,CAAC,CAACO,UAA5C;AAAuDC,MAAAA,OAAO,EAACR,CAAC,CAACS;AAAjE,KAA7B;AAA6G,GAAjK,GAAL,CAAD,EAA4KP,CAAnL;AAAqL;;AAAA,MAAMQ,CAAC,GAAC,CAACV,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASS,CAAC,CAACC,MAAF,CAASZ,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAe,IAAf,EAAoB,CAAC,UAAD,CAApB,CAAjB;AAAA,MAAmDW,CAAC,GAAC,CAACb,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASS,CAAC,CAACC,MAAF,CAASZ,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAe,IAAf,EAAoB,CAAC,UAAD,EAAY,OAAZ,CAApB,CAA9D;AAAA,MAAwGY,CAAC,GAACD,CAA1G;AAAA,MAA4GE,CAAC,GAAC,CAACf,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,KAAWQ,CAAC,CAACC,MAAF,CAASZ,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiB,CAAC,UAAD,EAAY,OAAZ,CAAjB,CAAzH;;AAAgK,MAAMQ,CAAN,CAAO;AAACK,EAAAA,WAAW,CAAChB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAASO,CAAT,EAAWG,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiB;AAAC,SAAKE,MAAL,GAAYjB,CAAZ,EAAc,KAAKkB,QAAL,GAAcR,CAA5B;AAA8B,UAAMC,CAAC,GAACQ,KAAK,CAACC,OAAN,CAAcN,CAAd,IAAiBA,CAAjB,GAAmBA,CAAC,CAACO,MAA7B;AAAoC,SAAKA,MAAL,GAAYV,CAAZ,EAAc,KAAKW,WAAL,GAAiBnB,CAA/B,EAAiC,KAAKoB,OAAL,GAAatB,CAA9C,EAAgD,KAAKuB,iBAAL,GAAuBtB,CAAvE,EAAyE,KAAKuB,cAAL,GAAoBZ,CAA7F,EAA+F,KAAKa,iBAAL,GAAuBX,CAAtH,EAAwH,KAAKY,mBAAL,GAAyB1B,CAAC,CAAC2B,qBAAF,CAAwB,KAAKN,WAA7B,CAAjJ,EAA2L,KAAKO,gBAAL,GAAsB,KAAKN,OAAL,CAAaO,gBAAb,CAA8B,KAAKR,WAAnC,EAA+C,OAA/C,CAAjN;AAAyQ;;AAAmB,eAANV,MAAM,CAACV,CAAD,EAAGQ,CAAH,EAAKG,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAWgB,CAAX,EAAa;AAAC,UAAK;AAAC3B,MAAAA,MAAM,EAAC4B,CAAR;AAAUxB,MAAAA,OAAO,EAACyB,CAAlB;AAAoB1B,MAAAA,UAAU,EAAC2B;AAA/B,QAAkC,MAAM/B,CAAC,EAA9C;AAAA,UAAiDgC,CAAC,GAAClC,CAAC,CAACmC,QAAF,CAAW1B,CAAX,CAAnD;AAAA,UAAiE2B,CAAC,GAACL,CAAC,CAACM,WAAF,CAAcpC,CAAd,EAAgB6B,CAAhB,CAAnE;AAAA,UAAsFQ,CAAC,GAACxB,CAAC,CAACyB,MAAF,CAAU,CAACxC,CAAD,EAAGC,CAAH,MAAQ,EAAC,GAAGD,CAAJ;AAAM,OAACC,CAAD,GAAI;AAAV,KAAR,CAAV,EAAoC,EAApC,CAAxF;AAAgI,QAAIwC,CAAC,GAAC,IAAN;AAAWzC,IAAAA,CAAC,CAACc,CAAD,CAAD,KAAO2B,CAAC,GAAC,IAAIP,CAAJ,CAAMpB,CAAN,CAAF,EAAW2B,CAAC,CAACC,SAAF,GAAY,CAAC,CAAxB,EAA0BH,CAAC,CAACI,OAAF,GAAU,IAA3C;;AAAiD,UAAMC,CAAC,GAACZ,CAAC,CAACa,wBAAF,CAA2BR,CAA3B,KAA+BL,CAAC,CAACc,qBAAF,EAAvC;AAAA,UAAiEC,CAAC,GAACf,CAAC,CAACgB,oBAAF,CAAuBX,CAAvB,KAA2BL,CAAC,CAACiB,uBAAF,EAA9F;AAAA,UAA0HC,CAAC,GAAClB,CAAC,CAACmB,aAAF,CAAgBd,CAAhB,KAAoBL,CAAC,CAACoB,kBAAF,EAAhJ;AAAA,UAAuKC,CAAC,GAAC;AAACC,MAAAA,IAAI,EAACf,CAAN;AAAQgB,MAAAA,gBAAgB,EAACpB,CAAzB;AAA2BqB,MAAAA,QAAQ,EAAC,CAAC,CAACN;AAAtC,KAAzK;AAAA,UAAkNO,CAAC,GAAC,IAAIvB,CAAJ,EAApN;;AAA0NuB,IAAAA,CAAC,CAACf,SAAF,GAAY,CAAC,CAAb,EAAee,CAAC,CAACC,QAAF,CAAW,OAAX,EAAmB,CAAnB,CAAf;;AAAqC,UAAMC,CAAC,GAAC3B,CAAC,CAAC4B,aAAF,CAAgBvB,CAAhB,EAAkBgB,CAAlB,CAAR;AAAA,UAA6BQ,CAAC,GAAC7D,CAAC,KAAG,WAAUA,CAAV,IAAaA,CAAC,CAAC8D,KAAf,KAAuBL,CAAC,CAACC,QAAF,CAAW,OAAX,EAAmB1D,CAAC,CAAC8D,KAAF,CAAQC,KAA3B,GAAkC/D,CAAC,CAAC8D,KAAF,GAAQL,CAAjE,GAAoEhB,CAAC,KAAGzC,CAAC,CAAC2C,OAAF,GAAUF,CAAb,CAArE,EAAqFkB,CAAC,CAAC;AAACL,MAAAA,IAAI,EAACtD,CAAN;AAAQuD,MAAAA,gBAAgB,EAACpB;AAAzB,KAAD,CAAzF,CAAhC;;AAAwJ,WAAO,MAAM6B,OAAO,CAACC,GAAR,CAAY,CAACrB,CAAD,EAAGG,CAAH,EAAKG,CAAL,CAAZ,CAAN,EAA2B,IAAIvC,CAAJ,CAAMT,CAAN,EAAQ8B,CAAR,EAAUE,CAAV,EAAYG,CAAZ,EAAcwB,CAAd,EAAgB,IAAI5B,CAAJ,EAAhB,EAAsBpB,CAAtB,EAAwBsB,CAAxB,CAAlC;AAA6D;;AAAA+B,EAAAA,gBAAgB,CAAClE,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACmE,QAAF,IAAY,CAACnE,CAAC,CAACmE,QAAF,CAAWZ,gBAAxB,KAA2CvD,CAAC,CAACmE,QAAF,CAAWZ,gBAAX,GAA4B,KAAK7B,iBAA5E,GAA+F,KAAKD,cAAL,CAAoB2C,8BAApB,CAAmDpE,CAAC,CAACmE,QAArD,EAA8DnE,CAAC,CAACqE,UAAhE,EAA2E;AAAChD,MAAAA,MAAM,EAAC,KAAKA;AAAb,KAA3E,CAA/F,EAAgM,KAAKI,cAA5M;AAA2N;;AAAA6C,EAAAA,gBAAgB,CAACtE,CAAD,EAAG;AAAC,WAAO,KAAKyB,cAAL,CAAoB8C,oBAApB,CAAyCvE,CAAzC,EAA2C;AAACqB,MAAAA,MAAM,EAAC,KAAKA;AAAb,KAA3C,GAAiE,KAAKI,cAA7E;AAA4F;;AAAA+C,EAAAA,gBAAgB,GAAE;AAAC,WAAO,IAAI,KAAKhD,iBAAT,EAAP;AAAkC;;AAAAM,EAAAA,gBAAgB,CAAC9B,CAAD,EAAG;AAAC,WAAO,KAAKuB,OAAL,CAAaO,gBAAb,CAA8B,KAAKR,WAAnC,EAA+CtB,CAA/C,CAAP;AAAyD;;AAAAyE,EAAAA,kBAAkB,CAACzE,CAAD,EAAG;AAAC,WAAO,KAAKuB,OAAL,CAAakD,kBAAb,CAAgC,KAAKnD,WAArC,EAAiDtB,CAAjD,CAAP;AAA2D;;AAAA0E,EAAAA,kBAAkB,GAAE;AAAC,WAAO,KAAK/C,mBAAZ;AAAgC;;AAAAgD,EAAAA,eAAe,GAAE;AAAC,WAAO,KAAK9C,gBAAZ;AAA6B;;AAAA+C,EAAAA,oBAAoB,CAAC5E,CAAD,EAAG;AAAC,WAAO,KAAKuB,OAAL,CAAaqD,oBAAb,CAAkC,KAAKtD,WAAvC,EAAmDtB,CAAnD,CAAP;AAA6D;;AAArwD;;AAAswD,eAAeW,CAAf;AAAiB,SAAOA,CAAC,IAAIkE,gBAAZ,EAA6B9D,CAAC,IAAI+D,0BAAlC,EAA6DpE,CAAC,IAAIqE,qBAAlE,EAAwFlE,CAAC,IAAImE,wBAA7F,EAAsHlE,CAAC,IAAImE,kBAA3H,EAA8I9E,CAAC,IAAI+E,UAAnJ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../geometry.js\";import{isSome as e}from\"../core/maybe.js\";import r from\"../geometry/SpatialReference.js\";let t;async function a(){return t||(t=(async()=>{const e=await import(\"./arcadeUtils.js\");return await e.arcade.load(),{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),t}const s=(e,r,t)=>o.create(e,r,t,null,[\"$feature\"]),i=(e,r,t)=>o.create(e,r,t,null,[\"$feature\",\"$view\"]),c=i,n=(e,r,t,a)=>o.create(e,r,t,a,[\"$feature\",\"$view\"]);class o{constructor(e,r,t,a,s,i,c,n){this.script=e,this.evaluate=s;const o=Array.isArray(c)?c:c.fields;this.fields=o,this._syntaxTree=a,this._arcade=r,this._arcadeDictionary=t,this._arcadeFeature=i,this._spatialReference=n,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,\"scale\")}static async create(t,s,i,c,n,l){const{arcade:u,Feature:p,Dictionary:d}=await a(),f=r.fromJSON(s),y=u.parseScript(t,l),h=n.reduce(((e,r)=>({...e,[r]:null})),{});let m=null;e(c)&&(m=new d(c),m.immutable=!0,h.$config=null);const _=u.scriptUsesGeometryEngine(y)&&u.enableGeometrySupport(),F=u.scriptUsesFeatureSet(y)&&u.enableFeatureSetSupport(),w=u.scriptIsAsync(y)&&u.enableAsyncSupport(),S={vars:h,spatialReference:f,useAsync:!!w},b=new d;b.immutable=!1,b.setField(\"scale\",0);const $=u.compileScript(y,S),x=e=>(\"$view\"in e&&e.$view&&(b.setField(\"scale\",e.$view.scale),e.$view=b),m&&(e.$config=m),$({vars:e,spatialReference:f}));return await Promise.all([_,F,w]),new o(t,u,d,y,x,new p,i,f)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}repurposeAdapter(e){return this._arcadeFeature.repurposeFromAdapter(e,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(e){return this._arcade.extractFieldLiterals(this._syntaxTree,e)}}export default o;export{o as ArcadeExpression,n as createDictionaryExpression,s as createLabelExpression,i as createRendererExpression,c as createVVExpression,a as loadArcade};\n"]},"metadata":{},"sourceType":"module"}