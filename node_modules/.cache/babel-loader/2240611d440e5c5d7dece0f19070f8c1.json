{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport r from \"../core/Collection.js\";\nimport t from \"../core/CollectionFlattener.js\";\nimport s from \"../core/Error.js\";\nimport { clone as i } from \"../core/lang.js\";\nimport { loadAll as o } from \"../core/loadAll.js\";\nimport a from \"../core/Logger.js\";\nimport { isSome as l } from \"../core/maybe.js\";\nimport { MultiOriginJSONMixin as n } from \"../core/MultiOriginJSONSupport.js\";\nimport { throwIfAbortError as p } from \"../core/promiseUtils.js\";\nimport { join as y } from \"../core/urlUtils.js\";\nimport { property as u } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport \"../core/has.js\";\nimport { reader as d } from \"../core/accessorSupport/decorators/reader.js\";\nimport { subclass as c } from \"../core/accessorSupport/decorators/subclass.js\";\nimport m from \"../geometry/SpatialReference.js\";\nimport h from \"./Layer.js\";\nimport b from \"./buildingSublayers/BuildingComponentSublayer.js\";\nimport f from \"./buildingSublayers/BuildingGroupSublayer.js\";\nimport { APIKeyMixin as v } from \"./mixins/APIKeyMixin.js\";\nimport { ArcGISService as S } from \"./mixins/ArcGISService.js\";\nimport { OperationalLayer as g } from \"./mixins/OperationalLayer.js\";\nimport { PortalLayer as j } from \"./mixins/PortalLayer.js\";\nimport { ScaleRangeLayer as w } from \"./mixins/ScaleRangeLayer.js\";\nimport { SceneService as O } from \"./mixins/SceneService.js\";\nimport I from \"./support/BuildingFilter.js\";\nimport L from \"./support/BuildingSummaryStatistics.js\";\nimport { sceneLayerFullExtent as x, readOnlyService as T, elevationInfo as F } from \"./support/commonProperties.js\";\nimport { FetchAssociatedFeatureLayer as B } from \"./support/FetchAssociatedFeatureLayer.js\";\n\nconst A = a.getLogger(\"esri.layers.BuildingSceneLayer\"),\n      E = r.ofType(I),\n      _ = i(f.sublayersProperty);\n\n_.json.origins[\"web-scene\"] = {\n  type: [b],\n  write: {\n    enabled: !0,\n    overridePolicy: () => ({\n      enabled: !1\n    })\n  }\n}, _.json.origins[\"portal-item\"] = {\n  type: [b],\n  write: {\n    enabled: !0,\n    overridePolicy: () => ({\n      enabled: !1\n    })\n  }\n};\nlet P = class extends O(S(g(j(w(n(v(h))))))) {\n  constructor(e) {\n    super(e), this.operationalLayerType = \"BuildingSceneLayer\", this.allSublayers = new t({\n      getCollections: () => [this.sublayers],\n      getChildrenFunction: e => \"building-group\" === e.type ? e.sublayers : null\n    }), this.sublayers = null, this.sublayerOverrides = null, this.filters = new E(), this.activeFilterId = null, this.summaryStatistics = null, this.outFields = null, this.type = \"building-scene\";\n  }\n\n  normalizeCtorArgs(e) {\n    return \"string\" == typeof e ? {\n      url: e\n    } : e;\n  }\n\n  destroy() {\n    this.allSublayers.destroy();\n  }\n\n  readSublayers(e, r, t) {\n    const s = f.readSublayers(e, r, t);\n    return f.forEachSublayer(s, e => e.layer = this), this.sublayerOverrides && (this.applySublayerOverrides(s, this.sublayerOverrides), this.sublayerOverrides = null), s;\n  }\n\n  applySublayerOverrides(e, {\n    overrides: r,\n    context: t\n  }) {\n    f.forEachSublayer(e, e => e.read(r.get(e.id), t));\n  }\n\n  readSublayerOverrides(e, r) {\n    const t = new Map();\n\n    for (const i of e) null != i && \"object\" == typeof i && \"number\" == typeof i.id ? t.set(i.id, i) : r.messages.push(new s(\"building-scene-layer:invalid-sublayer-override\", \"Invalid value for sublayer override. Not an object or no id specified.\", {\n      value: i\n    }));\n\n    return {\n      overrides: t,\n      context: r\n    };\n  }\n\n  writeSublayerOverrides(e, r, t) {\n    const s = [];\n    f.forEachSublayer(this.sublayers, e => {\n      const r = e.write({}, t);\n      Object.keys(r).length > 1 && s.push(r);\n    }), s.length > 0 && (r.sublayers = s);\n  }\n\n  writeUnappliedOverrides(e, r) {\n    r.sublayers = [], e.overrides.forEach(e => {\n      r.sublayers.push(i(e));\n    });\n  }\n\n  write(e, r) {\n    return e = super.write(e, r), !r || \"web-scene\" !== r.origin && \"portal-item\" !== r.origin || (this.sublayers ? this.writeSublayerOverrides(this.sublayers, e, r) : this.sublayerOverrides && this.writeUnappliedOverrides(this.sublayerOverrides, e)), e;\n  }\n\n  read(e, r) {\n    if (super.read(e, r), r && (\"web-scene\" === r.origin || \"portal-item\" === r.origin) && null != e && Array.isArray(e.sublayers)) {\n      const t = this.readSublayerOverrides(e.sublayers, r);\n      this.sublayers ? this.applySublayerOverrides(this.sublayers, t) : this.sublayerOverrides = t;\n    }\n  }\n\n  readSummaryStatistics(e, r) {\n    if (\"string\" == typeof r.statisticsHRef) {\n      const e = y(this.parsedUrl.path, r.statisticsHRef);\n      return new L({\n        url: e\n      });\n    }\n\n    return null;\n  }\n\n  set elevationInfo(e) {\n    this._set(\"elevationInfo\", e), this._validateElevationInfo();\n  }\n\n  load(e) {\n    const r = l(e) ? e.signal : null,\n          t = this.loadFromPortal({\n      supportedTypes: [\"Scene Service\"]\n    }, e).catch(p).then(() => this._fetchService(r)).then(() => this._fetchAssociatedFeatureService(r));\n    return this.addResolvingPromise(t), Promise.resolve(this);\n  }\n\n  loadAll() {\n    return o(this, e => {\n      f.forEachSublayer(this.sublayers, r => {\n        \"building-group\" !== r.type && e(r);\n      }), this.summaryStatistics && e(this.summaryStatistics);\n    });\n  }\n\n  async saveAs(e, r) {\n    return this._debouncedSaveOperations(1, { ...r,\n      getTypeKeywords: () => this._getTypeKeywords(),\n      portalItemLayerType: \"building-scene\"\n    }, e);\n  }\n\n  async save() {\n    const e = {\n      getTypeKeywords: () => this._getTypeKeywords(),\n      portalItemLayerType: \"building-scene\"\n    };\n    return this._debouncedSaveOperations(0, e);\n  }\n\n  validateLayer(e) {\n    if (!e.layerType || \"Building\" !== e.layerType) throw new s(\"buildingscenelayer:layer-type-not-supported\", \"BuildingSceneLayer does not support this layer type\", {\n      layerType: e.layerType\n    });\n  }\n\n  _getTypeKeywords() {\n    return [\"Building\"];\n  }\n\n  _validateElevationInfo() {\n    const e = this.elevationInfo;\n    e && (\"absolute-height\" !== e.mode && A.warn(\".elevationInfo=\", \"Building scene layers only support absolute-height elevation mode\"), e.featureExpressionInfo && \"0\" !== e.featureExpressionInfo.expression && A.warn(\".elevationInfo=\", \"Building scene layers do not support featureExpressionInfo\"));\n  }\n\n  async _fetchAssociatedFeatureService(e) {\n    const r = new B(this.parsedUrl, this.portalItem, this.apiKey, e);\n\n    try {\n      this.associatedFeatureServiceItem = await r.fetchPortalItem();\n    } catch (t) {\n      A.warn(\"Associated feature service item could not be loaded\", t);\n    }\n  }\n\n};\ne([u({\n  type: [\"BuildingSceneLayer\"]\n})], P.prototype, \"operationalLayerType\", void 0), e([u({\n  readOnly: !0\n})], P.prototype, \"allSublayers\", void 0), e([u(_)], P.prototype, \"sublayers\", void 0), e([d(\"service\", \"sublayers\")], P.prototype, \"readSublayers\", null), e([u({\n  type: E,\n  nonNullable: !0,\n  json: {\n    write: !0\n  }\n})], P.prototype, \"filters\", void 0), e([u({\n  type: String,\n  json: {\n    write: !0\n  }\n})], P.prototype, \"activeFilterId\", void 0), e([u({\n  readOnly: !0,\n  type: L\n})], P.prototype, \"summaryStatistics\", void 0), e([d(\"summaryStatistics\", [\"statisticsHRef\"])], P.prototype, \"readSummaryStatistics\", null), e([u({\n  type: [String],\n  json: {\n    read: !1\n  }\n})], P.prototype, \"outFields\", void 0), e([u(x)], P.prototype, \"fullExtent\", void 0), e([u({\n  type: [\"show\", \"hide\", \"hide-children\"]\n})], P.prototype, \"listMode\", void 0), e([u(T(m))], P.prototype, \"spatialReference\", void 0), e([u(F)], P.prototype, \"elevationInfo\", null), e([u({\n  json: {\n    read: !1\n  },\n  readOnly: !0\n})], P.prototype, \"type\", void 0), e([u()], P.prototype, \"associatedFeatureServiceItem\", void 0), P = e([c(\"esri.layers.BuildingSceneLayer\")], P);\nvar K = P;\nexport default K;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/BuildingSceneLayer.js"],"names":["_","e","r","t","s","clone","i","loadAll","o","a","isSome","l","MultiOriginJSONMixin","n","throwIfAbortError","p","join","y","property","u","reader","d","subclass","c","m","h","b","f","APIKeyMixin","v","ArcGISService","S","OperationalLayer","g","PortalLayer","j","ScaleRangeLayer","w","SceneService","O","I","L","sceneLayerFullExtent","x","readOnlyService","T","elevationInfo","F","FetchAssociatedFeatureLayer","B","A","getLogger","E","ofType","sublayersProperty","json","origins","type","write","enabled","overridePolicy","P","constructor","operationalLayerType","allSublayers","getCollections","sublayers","getChildrenFunction","sublayerOverrides","filters","activeFilterId","summaryStatistics","outFields","normalizeCtorArgs","url","destroy","readSublayers","forEachSublayer","layer","applySublayerOverrides","overrides","context","read","get","id","readSublayerOverrides","Map","set","messages","push","value","writeSublayerOverrides","Object","keys","length","writeUnappliedOverrides","forEach","origin","Array","isArray","readSummaryStatistics","statisticsHRef","parsedUrl","path","_set","_validateElevationInfo","load","signal","loadFromPortal","supportedTypes","catch","then","_fetchService","_fetchAssociatedFeatureService","addResolvingPromise","Promise","resolve","saveAs","_debouncedSaveOperations","getTypeKeywords","_getTypeKeywords","portalItemLayerType","save","validateLayer","layerType","mode","warn","featureExpressionInfo","expression","portalItem","apiKey","associatedFeatureServiceItem","fetchPortalItem","prototype","readOnly","nonNullable","String","K"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../core/Collection.js\";import t from\"../core/CollectionFlattener.js\";import s from\"../core/Error.js\";import{clone as i}from\"../core/lang.js\";import{loadAll as o}from\"../core/loadAll.js\";import a from\"../core/Logger.js\";import{isSome as l}from\"../core/maybe.js\";import{MultiOriginJSONMixin as n}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as p}from\"../core/promiseUtils.js\";import{join as y}from\"../core/urlUtils.js\";import{property as u}from\"../core/accessorSupport/decorators/property.js\";import\"../core/accessorSupport/ensureType.js\";import\"../core/has.js\";import{reader as d}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as c}from\"../core/accessorSupport/decorators/subclass.js\";import m from\"../geometry/SpatialReference.js\";import h from\"./Layer.js\";import b from\"./buildingSublayers/BuildingComponentSublayer.js\";import f from\"./buildingSublayers/BuildingGroupSublayer.js\";import{APIKeyMixin as v}from\"./mixins/APIKeyMixin.js\";import{ArcGISService as S}from\"./mixins/ArcGISService.js\";import{OperationalLayer as g}from\"./mixins/OperationalLayer.js\";import{PortalLayer as j}from\"./mixins/PortalLayer.js\";import{ScaleRangeLayer as w}from\"./mixins/ScaleRangeLayer.js\";import{SceneService as O}from\"./mixins/SceneService.js\";import I from\"./support/BuildingFilter.js\";import L from\"./support/BuildingSummaryStatistics.js\";import{sceneLayerFullExtent as x,readOnlyService as T,elevationInfo as F}from\"./support/commonProperties.js\";import{FetchAssociatedFeatureLayer as B}from\"./support/FetchAssociatedFeatureLayer.js\";const A=a.getLogger(\"esri.layers.BuildingSceneLayer\"),E=r.ofType(I),_=i(f.sublayersProperty);_.json.origins[\"web-scene\"]={type:[b],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},_.json.origins[\"portal-item\"]={type:[b],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}};let P=class extends(O(S(g(j(w(n(v(h)))))))){constructor(e){super(e),this.operationalLayerType=\"BuildingSceneLayer\",this.allSublayers=new t({getCollections:()=>[this.sublayers],getChildrenFunction:e=>\"building-group\"===e.type?e.sublayers:null}),this.sublayers=null,this.sublayerOverrides=null,this.filters=new E,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.type=\"building-scene\"}normalizeCtorArgs(e){return\"string\"==typeof e?{url:e}:e}destroy(){this.allSublayers.destroy()}readSublayers(e,r,t){const s=f.readSublayers(e,r,t);return f.forEachSublayer(s,(e=>e.layer=this)),this.sublayerOverrides&&(this.applySublayerOverrides(s,this.sublayerOverrides),this.sublayerOverrides=null),s}applySublayerOverrides(e,{overrides:r,context:t}){f.forEachSublayer(e,(e=>e.read(r.get(e.id),t)))}readSublayerOverrides(e,r){const t=new Map;for(const i of e)null!=i&&\"object\"==typeof i&&\"number\"==typeof i.id?t.set(i.id,i):r.messages.push(new s(\"building-scene-layer:invalid-sublayer-override\",\"Invalid value for sublayer override. Not an object or no id specified.\",{value:i}));return{overrides:t,context:r}}writeSublayerOverrides(e,r,t){const s=[];f.forEachSublayer(this.sublayers,(e=>{const r=e.write({},t);Object.keys(r).length>1&&s.push(r)})),s.length>0&&(r.sublayers=s)}writeUnappliedOverrides(e,r){r.sublayers=[],e.overrides.forEach((e=>{r.sublayers.push(i(e))}))}write(e,r){return e=super.write(e,r),!r||\"web-scene\"!==r.origin&&\"portal-item\"!==r.origin||(this.sublayers?this.writeSublayerOverrides(this.sublayers,e,r):this.sublayerOverrides&&this.writeUnappliedOverrides(this.sublayerOverrides,e)),e}read(e,r){if(super.read(e,r),r&&(\"web-scene\"===r.origin||\"portal-item\"===r.origin)&&null!=e&&Array.isArray(e.sublayers)){const t=this.readSublayerOverrides(e.sublayers,r);this.sublayers?this.applySublayerOverrides(this.sublayers,t):this.sublayerOverrides=t}}readSummaryStatistics(e,r){if(\"string\"==typeof r.statisticsHRef){const e=y(this.parsedUrl.path,r.statisticsHRef);return new L({url:e})}return null}set elevationInfo(e){this._set(\"elevationInfo\",e),this._validateElevationInfo()}load(e){const r=l(e)?e.signal:null,t=this.loadFromPortal({supportedTypes:[\"Scene Service\"]},e).catch(p).then((()=>this._fetchService(r))).then((()=>this._fetchAssociatedFeatureService(r)));return this.addResolvingPromise(t),Promise.resolve(this)}loadAll(){return o(this,(e=>{f.forEachSublayer(this.sublayers,(r=>{\"building-group\"!==r.type&&e(r)})),this.summaryStatistics&&e(this.summaryStatistics)}))}async saveAs(e,r){return this._debouncedSaveOperations(1,{...r,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:\"building-scene\"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:\"building-scene\"};return this._debouncedSaveOperations(0,e)}validateLayer(e){if(!e.layerType||\"Building\"!==e.layerType)throw new s(\"buildingscenelayer:layer-type-not-supported\",\"BuildingSceneLayer does not support this layer type\",{layerType:e.layerType})}_getTypeKeywords(){return[\"Building\"]}_validateElevationInfo(){const e=this.elevationInfo;e&&(\"absolute-height\"!==e.mode&&A.warn(\".elevationInfo=\",\"Building scene layers only support absolute-height elevation mode\"),e.featureExpressionInfo&&\"0\"!==e.featureExpressionInfo.expression&&A.warn(\".elevationInfo=\",\"Building scene layers do not support featureExpressionInfo\"))}async _fetchAssociatedFeatureService(e){const r=new B(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedFeatureServiceItem=await r.fetchPortalItem()}catch(t){A.warn(\"Associated feature service item could not be loaded\",t)}}};e([u({type:[\"BuildingSceneLayer\"]})],P.prototype,\"operationalLayerType\",void 0),e([u({readOnly:!0})],P.prototype,\"allSublayers\",void 0),e([u(_)],P.prototype,\"sublayers\",void 0),e([d(\"service\",\"sublayers\")],P.prototype,\"readSublayers\",null),e([u({type:E,nonNullable:!0,json:{write:!0}})],P.prototype,\"filters\",void 0),e([u({type:String,json:{write:!0}})],P.prototype,\"activeFilterId\",void 0),e([u({readOnly:!0,type:L})],P.prototype,\"summaryStatistics\",void 0),e([d(\"summaryStatistics\",[\"statisticsHRef\"])],P.prototype,\"readSummaryStatistics\",null),e([u({type:[String],json:{read:!1}})],P.prototype,\"outFields\",void 0),e([u(x)],P.prototype,\"fullExtent\",void 0),e([u({type:[\"show\",\"hide\",\"hide-children\"]})],P.prototype,\"listMode\",void 0),e([u(T(m))],P.prototype,\"spatialReference\",void 0),e([u(F)],P.prototype,\"elevationInfo\",null),e([u({json:{read:!1},readOnly:!0})],P.prototype,\"type\",void 0),e([u()],P.prototype,\"associatedFeatureServiceItem\",void 0),P=e([c(\"esri.layers.BuildingSceneLayer\")],P);var K=P;export default K;\n"]},"metadata":{},"sourceType":"module"}