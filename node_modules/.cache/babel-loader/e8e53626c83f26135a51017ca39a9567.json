{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport { isSome as t, isNone as r } from \"../../../../core/maybe.js\";\nimport { pt2px as a } from \"../../../../core/screenUtils.js\";\nimport { perObjectElevationAligner as i } from \"./ElevationAligners.js\";\nimport { elevationModeChangeUpdateType as n, SymbolUpdateType as s, needsElevationUpdates2D as o } from \"./elevationAlignmentUtils.js\";\nimport { ElevationContext as l } from \"./ElevationContext.js\";\nimport { Graphics3DObject3DGraphicLayer as c } from \"./Graphics3DObject3DGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as m } from \"./Graphics3DSymbolLayer.js\";\nimport { computeCentroid as d } from \"./graphicUtils.js\";\nimport { createStageObjectForHUD as u, extendPointGraphicElevationContext as h } from \"./pointUtils.js\";\nimport { emptySymbolComplexity as p } from \"./symbolComplexity.js\";\nimport { Geometry as f } from \"../../webgl-engine/lib/Geometry.js\";\nimport { materialParametersDefaults as v } from \"../../webgl-engine/lib/Material.js\";\nimport { LineCalloutMaterial as g } from \"../../webgl-engine/materials/LineCalloutMaterial.js\";\n\nclass y extends m {\n  constructor(e, t) {\n    super(e, null, t, b), this._elevationOptions = {\n      supportsOffsetAdjustment: !0,\n      supportsOnTheGround: !1\n    }, this.ensureDrapedStatus(!1);\n  }\n\n  async doLoad() {\n    this._material = new g(this.materialParameters), this._context.stage.add(this._material);\n  }\n\n  destroy() {\n    super.destroy(), this._context.stage.remove(this._material), this._material = null;\n  }\n\n  perInstanceMaterialParameters(e) {\n    const t = this.materialParameters;\n    return t.screenOffset = e.screenOffset || [0, 0], t.centerOffsetUnits = e.centerOffsetUnits || \"world\", t;\n  }\n\n  get materialParameters() {\n    const r = this.symbol,\n          i = r.callout,\n          n = t(i.color) ? e.toUnitRGBA(i.color) : [0, 0, 0, 0];\n    n[3] *= this._getLayerOpacity();\n    const s = a(i.size || 0);\n    let o = null;\n\n    if (r.verticalOffset) {\n      const {\n        screenLength: e,\n        minWorldLength: t,\n        maxWorldLength: i\n      } = r.verticalOffset;\n      o = {\n        screenLength: a(e),\n        minWorldLength: t || 0,\n        maxWorldLength: null != i ? i : 1 / 0\n      };\n    }\n\n    const l = t(i.border) && t(i.border.color) ? e.toUnitRGBA(i.border.color) : null,\n          c = \"object\" === r.symbolLayers.getItemAt(0).type,\n          m = !c,\n          d = c ? 0 : void 0,\n          u = \"label-3d\" === r.type;\n    return {\n      color: n,\n      size: s,\n      verticalOffset: o,\n      screenSizePerspective: this._context.screenSizePerspectiveEnabled ? this._context.sharedResources.screenSizePerspectiveSettings : null,\n      screenOffset: [0, 0],\n      centerOffsetUnits: \"world\",\n      borderColor: l,\n      occlusionTest: m,\n      shaderPolygonOffset: d,\n      depthHUDAlignStart: u,\n      slicePlaneEnabled: this._context.slicePlaneEnabled,\n      renderOccluded: v.renderOccluded\n    };\n  }\n\n  _defaultElevationInfoNoZ() {\n    return _;\n  }\n\n  createGraphics3DGraphic(e) {\n    const t = e.renderingInfo,\n          a = e.graphic,\n          i = this.setGraphicElevationContext(a, new l(), t.elevationOffset || 0),\n          n = t.symbol,\n          s = \"on-the-ground\" === this._elevationContext.mode && (\"cim\" === n.type || !n.symbolLayers.some(e => \"object\" === e.type || \"text\" === e.type));\n    if (\"label-3d\" !== n.type && s) return null;\n    const o = d(a.geometry);\n    return r(o) ? null : this._createAs3DShape(o, i, t, a.uid);\n  }\n\n  layerOpacityChanged() {\n    return r(this._material) || this._material.setParameterValues(this.materialParameters), !0;\n  }\n\n  layerElevationInfoChanged(e, r, a) {\n    const i = this._elevationContext.mode,\n          o = n(y.elevationModeChangeTypes, a, i);\n    return o !== s.UPDATE || e.forEach(e => {\n      const a = r(e);\n      t(a) && this.updateGraphicElevationContext(e.graphic, a);\n    }), o;\n  }\n\n  slicePlaneEnabledChanged() {\n    return r(this._material) || this._material.setParameterValues({\n      slicePlaneEnabled: this._context.slicePlaneEnabled\n    }), !0;\n  }\n\n  physicalBasedRenderingChanged() {\n    return !0;\n  }\n\n  pixelRatioChanged() {\n    return !0;\n  }\n\n  setGraphicElevationContext(e, t, r = 0) {\n    const a = super.setGraphicElevationContext(e, t);\n    return a.addOffsetRenderUnits(r), a;\n  }\n\n  updateGraphicElevationContext(e, t) {\n    this.setGraphicElevationContext(e, t.elevationContext, t.metadata.elevationOffset), t.needsElevationUpdates = o(t.elevationContext.mode);\n  }\n\n  updateGeometry(e, t) {\n    return !1;\n  }\n\n  computeComplexity() {\n    return {\n      primitivesPerFeature: 2,\n      primitivesPerCoordinate: 0,\n      drawCallsPerFeature: 0,\n      estimated: !1,\n      memory: p.memory\n    };\n  }\n\n  createVertexData(e) {\n    const {\n      translation: t,\n      centerOffset: r\n    } = e;\n    return [[\"position\", t ? {\n      size: 3,\n      data: [t[0], t[1], t[2]],\n      exclusive: !0\n    } : {\n      size: 3,\n      data: [0, 0, 0],\n      exclusive: !0\n    }], [\"normal\", {\n      size: 3,\n      data: [0, 0, 1],\n      exclusive: !0\n    }], [\"auxpos1\", r ? {\n      size: 4,\n      data: [r[0], r[1], r[2], r[3]],\n      exclusive: !0\n    } : {\n      size: 4,\n      data: [0, 0, 0, 1],\n      exclusive: !0\n    }]];\n  }\n\n  _getOrCreateMaterial(e) {\n    const a = this.perInstanceMaterialParameters(e),\n          i = g.uniqueMaterialIdentifier(a);\n    if (t(this._material) && i === this._material.uniqueMaterialIdentifier) return {\n      material: this._material,\n      isUnique: !1\n    };\n\n    if (e.materialCollection) {\n      let t = e.materialCollection.get(i);\n      return r(t) && (t = new g(a), e.materialCollection.add(i, t)), {\n        material: t,\n        isUnique: !1\n      };\n    }\n\n    return {\n      material: new g(a),\n      isUnique: !0\n    };\n  }\n\n  _createAs3DShape(e, t, r, a) {\n    const n = [new f(this.createVertexData(r), C, 1)],\n          s = this._getOrCreateMaterial(r),\n          l = u(this._context, e, n, [s.material], null, null, t, this._context.layer.uid, a);\n\n    if (null === l) return null;\n    const m = i,\n          d = new c(this, l.object, n, s.isUnique ? [s.material] : null, null, m, t);\n    return d.metadata = {\n      elevationOffset: r.elevationOffset || 0\n    }, d.alignedSampledElevation = l.sampledElevation, d.needsElevationUpdates = o(t.mode), h(d, e, this._context.elevationProvider), d;\n  }\n\n}\n\ny.elevationModeChangeTypes = {\n  definedChanged: s.UPDATE,\n  staysOnTheGround: s.UPDATE,\n  onTheGroundChanged: s.RECREATE\n};\nconst x = new Uint16Array([0]),\n      C = [[\"position\", x], [\"normal\", x], [\"auxpos1\", x]],\n      _ = {\n  mode: \"relative-to-ground\",\n  offset: 0\n},\n      b = {\n  ignoreDrivers: !0,\n  renderPriority: 0,\n  renderPriorityStep: 1\n};\nexport default y;\nexport { y as Graphics3DLineCalloutSymbolLayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer.js"],"names":["e","isSome","t","isNone","r","pt2px","a","perObjectElevationAligner","i","elevationModeChangeUpdateType","n","SymbolUpdateType","s","needsElevationUpdates2D","o","ElevationContext","l","Graphics3DObject3DGraphicLayer","c","Graphics3DSymbolLayer","m","computeCentroid","d","createStageObjectForHUD","u","extendPointGraphicElevationContext","h","emptySymbolComplexity","p","Geometry","f","materialParametersDefaults","v","LineCalloutMaterial","g","y","constructor","b","_elevationOptions","supportsOffsetAdjustment","supportsOnTheGround","ensureDrapedStatus","doLoad","_material","materialParameters","_context","stage","add","destroy","remove","perInstanceMaterialParameters","screenOffset","centerOffsetUnits","symbol","callout","color","toUnitRGBA","_getLayerOpacity","size","verticalOffset","screenLength","minWorldLength","maxWorldLength","border","symbolLayers","getItemAt","type","screenSizePerspective","screenSizePerspectiveEnabled","sharedResources","screenSizePerspectiveSettings","borderColor","occlusionTest","shaderPolygonOffset","depthHUDAlignStart","slicePlaneEnabled","renderOccluded","_defaultElevationInfoNoZ","_","createGraphics3DGraphic","renderingInfo","graphic","setGraphicElevationContext","elevationOffset","_elevationContext","mode","some","geometry","_createAs3DShape","uid","layerOpacityChanged","setParameterValues","layerElevationInfoChanged","elevationModeChangeTypes","UPDATE","forEach","updateGraphicElevationContext","slicePlaneEnabledChanged","physicalBasedRenderingChanged","pixelRatioChanged","addOffsetRenderUnits","elevationContext","metadata","needsElevationUpdates","updateGeometry","computeComplexity","primitivesPerFeature","primitivesPerCoordinate","drawCallsPerFeature","estimated","memory","createVertexData","translation","centerOffset","data","exclusive","_getOrCreateMaterial","uniqueMaterialIdentifier","material","isUnique","materialCollection","get","C","layer","object","alignedSampledElevation","sampledElevation","elevationProvider","definedChanged","staysOnTheGround","onTheGroundChanged","RECREATE","x","Uint16Array","offset","ignoreDrivers","renderPriority","renderPriorityStep","Graphics3DLineCalloutSymbolLayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import{isSome as t,isNone as r}from\"../../../../core/maybe.js\";import{pt2px as a}from\"../../../../core/screenUtils.js\";import{perObjectElevationAligner as i}from\"./ElevationAligners.js\";import{elevationModeChangeUpdateType as n,SymbolUpdateType as s,needsElevationUpdates2D as o}from\"./elevationAlignmentUtils.js\";import{ElevationContext as l}from\"./ElevationContext.js\";import{Graphics3DObject3DGraphicLayer as c}from\"./Graphics3DObject3DGraphicLayer.js\";import{Graphics3DSymbolLayer as m}from\"./Graphics3DSymbolLayer.js\";import{computeCentroid as d}from\"./graphicUtils.js\";import{createStageObjectForHUD as u,extendPointGraphicElevationContext as h}from\"./pointUtils.js\";import{emptySymbolComplexity as p}from\"./symbolComplexity.js\";import{Geometry as f}from\"../../webgl-engine/lib/Geometry.js\";import{materialParametersDefaults as v}from\"../../webgl-engine/lib/Material.js\";import{LineCalloutMaterial as g}from\"../../webgl-engine/materials/LineCalloutMaterial.js\";class y extends m{constructor(e,t){super(e,null,t,b),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new g(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||\"world\",t}get materialParameters(){const r=this.symbol,i=r.callout,n=t(i.color)?e.toUnitRGBA(i.color):[0,0,0,0];n[3]*=this._getLayerOpacity();const s=a(i.size||0);let o=null;if(r.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=r.verticalOffset;o={screenLength:a(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0}}const l=t(i.border)&&t(i.border.color)?e.toUnitRGBA(i.border.color):null,c=\"object\"===r.symbolLayers.getItemAt(0).type,m=!c,d=c?0:void 0,u=\"label-3d\"===r.type;return{color:n,size:s,verticalOffset:o,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:\"world\",borderColor:l,occlusionTest:m,shaderPolygonOffset:d,depthHUDAlignStart:u,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:v.renderOccluded}}_defaultElevationInfoNoZ(){return _}createGraphics3DGraphic(e){const t=e.renderingInfo,a=e.graphic,i=this.setGraphicElevationContext(a,new l,t.elevationOffset||0),n=t.symbol,s=\"on-the-ground\"===this._elevationContext.mode&&(\"cim\"===n.type||!n.symbolLayers.some((e=>\"object\"===e.type||\"text\"===e.type)));if(\"label-3d\"!==n.type&&s)return null;const o=d(a.geometry);return r(o)?null:this._createAs3DShape(o,i,t,a.uid)}layerOpacityChanged(){return r(this._material)||this._material.setParameterValues(this.materialParameters),!0}layerElevationInfoChanged(e,r,a){const i=this._elevationContext.mode,o=n(y.elevationModeChangeTypes,a,i);return o!==s.UPDATE||e.forEach((e=>{const a=r(e);t(a)&&this.updateGraphicElevationContext(e.graphic,a)})),o}slicePlaneEnabledChanged(){return r(this._material)||this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(e,t,r=0){const a=super.setGraphicElevationContext(e,t);return a.addOffsetRenderUnits(r),a}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=o(t.elevationContext.mode)}updateGeometry(e,t){return!1}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:p.memory}}createVertexData(e){const{translation:t,centerOffset:r}=e;return[[\"position\",t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[\"normal\",{size:3,data:[0,0,1],exclusive:!0}],[\"auxpos1\",r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}_getOrCreateMaterial(e){const a=this.perInstanceMaterialParameters(e),i=g.uniqueMaterialIdentifier(a);if(t(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){let t=e.materialCollection.get(i);return r(t)&&(t=new g(a),e.materialCollection.add(i,t)),{material:t,isUnique:!1}}return{material:new g(a),isUnique:!0}}_createAs3DShape(e,t,r,a){const n=[new f(this.createVertexData(r),C,1)],s=this._getOrCreateMaterial(r),l=u(this._context,e,n,[s.material],null,null,t,this._context.layer.uid,a);if(null===l)return null;const m=i,d=new c(this,l.object,n,s.isUnique?[s.material]:null,null,m,t);return d.metadata={elevationOffset:r.elevationOffset||0},d.alignedSampledElevation=l.sampledElevation,d.needsElevationUpdates=o(t.mode),h(d,e,this._context.elevationProvider),d}}y.elevationModeChangeTypes={definedChanged:s.UPDATE,staysOnTheGround:s.UPDATE,onTheGroundChanged:s.RECREATE};const x=new Uint16Array([0]),C=[[\"position\",x],[\"normal\",x],[\"auxpos1\",x]],_={mode:\"relative-to-ground\",offset:0},b={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};export default y;export{y as Graphics3DLineCalloutSymbolLayer};\n"]},"metadata":{},"sourceType":"module"}