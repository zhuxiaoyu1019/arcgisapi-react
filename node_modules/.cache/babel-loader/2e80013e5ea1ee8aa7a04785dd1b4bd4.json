{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Error.js\";\nimport t from \"../../../core/Evented.js\";\nimport r from \"../../../core/Logger.js\";\nimport { isSome as s } from \"../../../core/maybe.js\";\nimport { fromRect as o } from \"../../../geometry/support/aaBoundingBox.js\";\nimport { create as i, NEGATIVE_INFINITY as a } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { getBoundsOptimizedGeometry as d } from \"../featureConversionUtils.js\";\nimport { BoundsStore as n } from \"./BoundsStore.js\";\nimport { optimizedFeatureQueryEngineAdapter as h } from \"./optimizedFeatureQueryEngineAdapter.js\";\n\nclass u {\n  constructor(e) {\n    this.geometryInfo = e, this._boundsStore = new n(), this._featuresById = new Map(), this._markedIds = new Set(), this.events = new t(), this.featureAdapter = h;\n  }\n\n  get geometryType() {\n    return this.geometryInfo.geometryType;\n  }\n\n  get hasM() {\n    return this.geometryInfo.hasM;\n  }\n\n  get hasZ() {\n    return this.geometryInfo.hasZ;\n  }\n\n  get numFeatures() {\n    return this._featuresById.size;\n  }\n\n  get fullBounds() {\n    if (!this.numFeatures) return null;\n    const e = i(a);\n    return this._featuresById.forEach(t => {\n      const r = this._boundsStore.get(t.objectId);\n\n      r && (e[0] = Math.min(r[0], e[0]), e[1] = Math.min(r[1], e[1]), e[2] = Math.max(r[2], e[2]), e[3] = Math.max(r[3], e[3]));\n    }), e;\n  }\n\n  get storeStatistics() {\n    let e = 0;\n    return this._featuresById.forEach(t => {\n      t.geometry && t.geometry.coords && (e += t.geometry.coords.length);\n    }), {\n      featureCount: this._featuresById.size,\n      vertexCount: e / (this.hasZ ? this.hasM ? 4 : 3 : this.hasM ? 3 : 2)\n    };\n  }\n\n  add(e) {\n    this._add(e), this._emitChanged();\n  }\n\n  addMany(e) {\n    for (const t of e) this._add(t);\n\n    this._emitChanged();\n  }\n\n  clear() {\n    this._featuresById.clear(), this._boundsStore.clear(), this._emitChanged();\n  }\n\n  removeById(e) {\n    const t = this._featuresById.get(e);\n\n    return t ? (this._remove(t), this._emitChanged(), t) : null;\n  }\n\n  removeManyById(e) {\n    this._boundsStore.invalidateIndex();\n\n    for (const t of e) {\n      const e = this._featuresById.get(t);\n\n      e && this._remove(e);\n    }\n\n    this._emitChanged();\n  }\n\n  forEachBounds(e, t, r) {\n    for (const s of e) {\n      const e = this._boundsStore.get(s.objectId);\n\n      e && t(o(r, e));\n    }\n  }\n\n  getFeature(e) {\n    return this._featuresById.get(e);\n  }\n\n  has(e) {\n    return this._featuresById.has(e);\n  }\n\n  forEach(e) {\n    this._featuresById.forEach(t => e(t));\n  }\n\n  forEachInBounds(e, t) {\n    this._boundsStore.forEachInBounds(e, e => {\n      t(this._featuresById.get(e));\n    });\n  }\n\n  startMarkingUsedFeatures() {\n    this._boundsStore.invalidateIndex(), this._markedIds.clear();\n  }\n\n  sweep() {\n    let e = !1;\n    this._featuresById.forEach((t, r) => {\n      this._markedIds.has(r) || (e = !0, this._remove(t));\n    }), this._markedIds.clear(), e && this._emitChanged();\n  }\n\n  _emitChanged() {\n    this.events.emit(\"changed\", void 0);\n  }\n\n  _add(t) {\n    if (!t) return;\n    const o = t.objectId;\n    if (null == o) return void r.getLogger(\"esri.layers.graphics.data.FeatureStore\").error(new e(\"featurestore:invalid-feature\", \"feature id is missing\", {\n      feature: t\n    }));\n\n    const a = this._featuresById.get(o);\n\n    let n;\n    if (this._markedIds.add(o), a ? (t.displayId = a.displayId, n = this._boundsStore.get(o), this._boundsStore.delete(o)) : s(this.onFeatureAdd) && this.onFeatureAdd(t), !t.geometry || !t.geometry.coords || !t.geometry.coords.length) return this._boundsStore.set(o, null), void this._featuresById.set(o, t);\n    n = d(n || i(), t.geometry, this.geometryInfo.hasZ, this.geometryInfo.hasM), this._boundsStore.set(o, n), this._featuresById.set(o, t);\n  }\n\n  _remove(e) {\n    return s(this.onFeatureRemove) && this.onFeatureRemove(e), this._markedIds.delete(e.objectId), this._boundsStore.delete(e.objectId), this._featuresById.delete(e.objectId), e;\n  }\n\n}\n\nexport default u;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/graphics/data/FeatureStore.js"],"names":["e","t","r","isSome","s","fromRect","o","create","i","NEGATIVE_INFINITY","a","getBoundsOptimizedGeometry","d","BoundsStore","n","optimizedFeatureQueryEngineAdapter","h","u","constructor","geometryInfo","_boundsStore","_featuresById","Map","_markedIds","Set","events","featureAdapter","geometryType","hasM","hasZ","numFeatures","size","fullBounds","forEach","get","objectId","Math","min","max","storeStatistics","geometry","coords","length","featureCount","vertexCount","add","_add","_emitChanged","addMany","clear","removeById","_remove","removeManyById","invalidateIndex","forEachBounds","getFeature","has","forEachInBounds","startMarkingUsedFeatures","sweep","emit","getLogger","error","feature","displayId","delete","onFeatureAdd","set","onFeatureRemove"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import t from\"../../../core/Evented.js\";import r from\"../../../core/Logger.js\";import{isSome as s}from\"../../../core/maybe.js\";import{fromRect as o}from\"../../../geometry/support/aaBoundingBox.js\";import{create as i,NEGATIVE_INFINITY as a}from\"../../../geometry/support/aaBoundingRect.js\";import{getBoundsOptimizedGeometry as d}from\"../featureConversionUtils.js\";import{BoundsStore as n}from\"./BoundsStore.js\";import{optimizedFeatureQueryEngineAdapter as h}from\"./optimizedFeatureQueryEngineAdapter.js\";class u{constructor(e){this.geometryInfo=e,this._boundsStore=new n,this._featuresById=new Map,this._markedIds=new Set,this.events=new t,this.featureAdapter=h}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){if(!this.numFeatures)return null;const e=i(a);return this._featuresById.forEach((t=>{const r=this._boundsStore.get(t.objectId);r&&(e[0]=Math.min(r[0],e[0]),e[1]=Math.min(r[1],e[1]),e[2]=Math.max(r[2],e[2]),e[3]=Math.max(r[3],e[3]))})),e}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t,r){for(const s of e){const e=this._boundsStore.get(s.objectId);e&&t(o(r,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit(\"changed\",void 0)}_add(t){if(!t)return;const o=t.objectId;if(null==o)return void r.getLogger(\"esri.layers.graphics.data.FeatureStore\").error(new e(\"featurestore:invalid-feature\",\"feature id is missing\",{feature:t}));const a=this._featuresById.get(o);let n;if(this._markedIds.add(o),a?(t.displayId=a.displayId,n=this._boundsStore.get(o),this._boundsStore.delete(o)):s(this.onFeatureAdd)&&this.onFeatureAdd(t),!t.geometry||!t.geometry.coords||!t.geometry.coords.length)return this._boundsStore.set(o,null),void this._featuresById.set(o,t);n=d(n||i(),t.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(o,n),this._featuresById.set(o,t)}_remove(e){return s(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}export default u;\n"]},"metadata":{},"sourceType":"module"}