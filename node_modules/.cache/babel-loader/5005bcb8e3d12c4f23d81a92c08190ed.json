{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../chunks/tslib.es6.js\";\nimport e from \"../../core/Accessor.js\";\nimport r from \"../../core/Collection.js\";\nimport { property as o } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport \"../../core/Logger.js\";\nimport { subclass as s } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport \"../../libs/maquette/projection.js\";\nimport { createProjector as i } from \"../../libs/maquette/projector.js\";\nimport { WatchUpdatingTracking as a } from \"../support/WatchUpdatingTracking.js\";\nlet c = class extends e {\n  constructor() {\n    super(...arguments), this.items = new r(), this._watchUpdatingTracking = new a(), this._callbacks = new Map(), this._projector = i(), this._hiddenProjector = i();\n  }\n\n  get needsRender() {\n    return this.items.length > 0;\n  }\n\n  initialize() {\n    const t = document.createElement(\"div\");\n    t.className = \"esri-overlay-surface\", this._set(\"surface\", t), this._hiddenSurface = document.createElement(\"div\"), this._hiddenSurface.setAttribute(\"style\", \"visibility: hidden;\"), t.appendChild(this._hiddenSurface), this._watchUpdatingTracking.addOnCollectionChange(this.items, t => {\n      t.added.map(t => {\n        const e = () => t.render();\n\n        this._callbacks.set(t, e), this._projector.append(this.surface, e);\n      }), t.removed.map(t => {\n        const e = this._projector.detach(this._callbacks.get(t));\n\n        this.surface.removeChild(e.domNode), this._callbacks.delete(t);\n      });\n    });\n  }\n\n  addItem(t) {\n    this.items.add(t);\n  }\n\n  removeItem(t) {\n    this.items.remove(t);\n  }\n\n  destroy() {\n    this.items.removeAll(), this._callbacks.forEach(t => this._projector.detach(t)), this._callbacks = null, this._projector = null, this._watchUpdatingTracking.destroy();\n  }\n\n  render() {\n    this._projector.renderNow();\n  }\n\n  computeBoundingRect(t) {\n    const e = this._hiddenSurface,\n          r = this._hiddenProjector;\n    let o = null;\n\n    const s = () => (o = t.render(), o);\n\n    r.append(e, s), r.renderNow();\n    const i = {\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0\n    };\n\n    if (o && o.domNode) {\n      const t = o.domNode.getBoundingClientRect();\n      i.left = t.left, i.top = t.top, i.right = t.right, i.bottom = t.bottom;\n    }\n\n    for (r.detach(s); e.firstChild;) e.removeChild(e.firstChild);\n\n    return i;\n  }\n\n  overlaps(t, e) {\n    const r = this.computeBoundingRect(t),\n          o = this.computeBoundingRect(e);\n    return Math.max(r.left, o.left) <= Math.min(r.right, o.right) && Math.max(r.top, o.top) <= Math.min(r.bottom, o.bottom);\n  }\n\n  get hasVisibleItems() {\n    return this.items.some(t => t.visible);\n  }\n\n  renderCanvas(t) {\n    if (!this.items.some(t => t.visible)) return;\n    const e = t.getContext(\"2d\");\n    e.save(), e.font = `10px ${getComputedStyle(this.surface).fontFamily}`, this.items.forEach(t => {\n      e.save(), t.renderCanvas(e), e.restore();\n    }), e.restore();\n  }\n\n};\nt([o({\n  readOnly: !0\n})], c.prototype, \"surface\", void 0), t([o({\n  readOnly: !0\n})], c.prototype, \"items\", void 0), t([o({\n  readOnly: !0\n})], c.prototype, \"needsRender\", null), t([o({\n  readOnly: !0\n})], c.prototype, \"_watchUpdatingTracking\", void 0), t([o({\n  readOnly: !0,\n  aliasOf: \"_watchUpdatingTracking.updating\"\n})], c.prototype, \"updating\", void 0), c = t([s(\"esri.views.overlay.ViewOverlay\")], c);\nvar n = c;\nexport default n;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/overlay/ViewOverlay.js"],"names":["_","t","e","r","property","o","subclass","s","createProjector","i","WatchUpdatingTracking","a","c","constructor","arguments","items","_watchUpdatingTracking","_callbacks","Map","_projector","_hiddenProjector","needsRender","length","initialize","document","createElement","className","_set","_hiddenSurface","setAttribute","appendChild","addOnCollectionChange","added","map","render","set","append","surface","removed","detach","get","removeChild","domNode","delete","addItem","add","removeItem","remove","destroy","removeAll","forEach","renderNow","computeBoundingRect","left","top","right","bottom","getBoundingClientRect","firstChild","overlaps","Math","max","min","hasVisibleItems","some","visible","renderCanvas","getContext","save","font","getComputedStyle","fontFamily","restore","readOnly","prototype","aliasOf","n"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Accessor.js\";import r from\"../../core/Collection.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../libs/maquette/projection.js\";import{createProjector as i}from\"../../libs/maquette/projector.js\";import{WatchUpdatingTracking as a}from\"../support/WatchUpdatingTracking.js\";let c=class extends e{constructor(){super(...arguments),this.items=new r,this._watchUpdatingTracking=new a,this._callbacks=new Map,this._projector=i(),this._hiddenProjector=i()}get needsRender(){return this.items.length>0}initialize(){const t=document.createElement(\"div\");t.className=\"esri-overlay-surface\",this._set(\"surface\",t),this._hiddenSurface=document.createElement(\"div\"),this._hiddenSurface.setAttribute(\"style\",\"visibility: hidden;\"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(t=>{t.added.map((t=>{const e=()=>t.render();this._callbacks.set(t,e),this._projector.append(this.surface,e)})),t.removed.map((t=>{const e=this._projector.detach(this._callbacks.get(t));this.surface.removeChild(e.domNode),this._callbacks.delete(t)}))}))}addItem(t){this.items.add(t)}removeItem(t){this.items.remove(t)}destroy(){this.items.removeAll(),this._callbacks.forEach((t=>this._projector.detach(t))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(t){const e=this._hiddenSurface,r=this._hiddenProjector;let o=null;const s=()=>(o=t.render(),o);r.append(e,s),r.renderNow();const i={left:0,top:0,right:0,bottom:0};if(o&&o.domNode){const t=o.domNode.getBoundingClientRect();i.left=t.left,i.top=t.top,i.right=t.right,i.bottom=t.bottom}for(r.detach(s);e.firstChild;)e.removeChild(e.firstChild);return i}overlaps(t,e){const r=this.computeBoundingRect(t),o=this.computeBoundingRect(e);return Math.max(r.left,o.left)<=Math.min(r.right,o.right)&&Math.max(r.top,o.top)<=Math.min(r.bottom,o.bottom)}get hasVisibleItems(){return this.items.some((t=>t.visible))}renderCanvas(t){if(!this.items.some((t=>t.visible)))return;const e=t.getContext(\"2d\");e.save(),e.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((t=>{e.save(),t.renderCanvas(e),e.restore()})),e.restore()}};t([o({readOnly:!0})],c.prototype,\"surface\",void 0),t([o({readOnly:!0})],c.prototype,\"items\",void 0),t([o({readOnly:!0})],c.prototype,\"needsRender\",null),t([o({readOnly:!0})],c.prototype,\"_watchUpdatingTracking\",void 0),t([o({readOnly:!0,aliasOf:\"_watchUpdatingTracking.updating\"})],c.prototype,\"updating\",void 0),c=t([s(\"esri.views.overlay.ViewOverlay\")],c);var n=c;export default n;\n"]},"metadata":{},"sourceType":"module"}