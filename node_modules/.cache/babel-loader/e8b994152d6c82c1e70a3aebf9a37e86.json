{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/ArrayPool.js\";\nimport { e } from \"../../../../../chunks/earcut.js\";\nimport i from \"./BaseBucket.js\";\nimport { Point as l } from \"../../webgl/Geometry.js\";\nimport n from \"../../webgl/mesh/Tesselator.js\";\nconst r = new n();\n\nclass s extends i {\n  constructor(t, e, i, l, n, r, s) {\n    super(t, e, i), this.type = 1, this._patternMap = new Map(), this._fillVertexBuffer = l, this._fillIndexBuffer = n, this._outlineVertexBuffer = r, this._outlineIndexBuffer = s;\n  }\n\n  get fillIndexStart() {\n    return this._fillIndexStart;\n  }\n\n  get fillIndexCount() {\n    return this._fillIndexCount;\n  }\n\n  get outlineIndexStart() {\n    return this._outlineIndexStart;\n  }\n\n  get outlineIndexCount() {\n    return this._outlineIndexCount;\n  }\n\n  getResources(t, e, i) {\n    const l = this.layer,\n          n = this.zoom,\n          r = l.getPaintProperty(\"fill-pattern\");\n    if (r) if (r.isDataDriven) for (const s of this._features) e.add({\n      name: r.getValue(n, s),\n      repeat: !0\n    });else e.add({\n      name: r.getValue(n),\n      repeat: !0\n    });\n  }\n\n  processFeatures(t) {\n    this._fillIndexStart = 3 * this._fillIndexBuffer.index, this._fillIndexCount = 0, this._outlineIndexStart = 3 * this._outlineIndexBuffer.index, this._outlineIndexCount = 0;\n    const e = this.layer,\n          i = this.zoom,\n          {\n      fillMaterial: l,\n      outlineMaterial: n,\n      hasDataDrivenFill: r,\n      hasDataDrivenOutline: s\n    } = e;\n    t && t.setExtent(this.layerExtent);\n    const o = e.getPaintProperty(\"fill-pattern\"),\n          a = null == o ? void 0 : o.isDataDriven;\n    let f = !o && e.getPaintValue(\"fill-antialias\", i);\n\n    if (e.outlineUsesFillColor) {\n      if (f && !e.hasDataDrivenOpacity) {\n        const t = e.getPaintValue(\"fill-opacity\", i),\n              l = e.getPaintValue(\"fill-opacity\", i + 1);\n        t < 1 && l < 1 && (f = !1);\n      }\n\n      if (f && !e.hasDataDrivenColor) {\n        const t = e.getPaintValue(\"fill-color\", i),\n              l = e.getPaintValue(\"fill-color\", i + 1);\n        t[3] < 1 && l[3] < 1 && (f = !1);\n      }\n    }\n\n    const u = this._features,\n          d = null == t ? void 0 : t.validateTessellation;\n\n    if (a) {\n      const r = [];\n\n      for (const a of u) {\n        const u = o.getValue(i, a),\n              h = this._spriteInfo[u];\n        if (!h || !h.rect) continue;\n        const x = l.encodeAttributes(a, i, e, h),\n              c = f && s ? n.encodeAttributes(a, i, e) : [],\n              g = a.getGeometry(t);\n        r.push({\n          ddFillAttributes: x,\n          ddOutlineAttributes: c,\n          page: h.page,\n          geometry: g\n        }), r.sort((t, e) => t.page - e.page);\n\n        for (const {\n          ddFillAttributes: t,\n          ddOutlineAttributes: i,\n          page: l,\n          geometry: n\n        } of r) this._processFeature(n, f, e.outlineUsesFillColor, t, i, d, l);\n      }\n    } else for (const h of u) {\n      const o = r ? l.encodeAttributes(h, i, e) : null,\n            a = f && s ? n.encodeAttributes(h, i, e) : null,\n            u = h.getGeometry(t);\n\n      this._processFeature(u, f, e.outlineUsesFillColor, o, a, d);\n    }\n  }\n\n  serialize() {\n    let t = 10;\n    t += this.layerUIDs.length, t += this._fillVertexBuffer.array.length, t += this._fillIndexBuffer.array.length, t += this._outlineVertexBuffer.array.length, t += this._outlineIndexBuffer.array.length, t += 3 * this._patternMap.size + 1;\n    const e = new Uint32Array(t),\n          i = new Int32Array(e.buffer);\n    let l = 0;\n    e[l++] = this.type, e[l++] = this.layerUIDs.length;\n\n    for (let s = 0; s < this.layerUIDs.length; s++) e[l++] = this.layerUIDs[s];\n\n    e[l++] = this._fillIndexStart, e[l++] = this._fillIndexCount, e[l++] = this._outlineIndexStart, e[l++] = this._outlineIndexCount;\n    const n = this._patternMap,\n          r = n.size;\n    if (e[l++] = r, r > 0) for (const [s, [o, a]] of n) e[l++] = s, e[l++] = o, e[l++] = a;\n    e[l++] = this._fillVertexBuffer.array.length;\n\n    for (let s = 0; s < this._fillVertexBuffer.array.length; s++) i[l++] = this._fillVertexBuffer.array[s];\n\n    e[l++] = this._fillIndexBuffer.array.length;\n\n    for (let s = 0; s < this._fillIndexBuffer.array.length; s++) e[l++] = this._fillIndexBuffer.array[s];\n\n    e[l++] = this._outlineVertexBuffer.array.length;\n\n    for (let s = 0; s < this._outlineVertexBuffer.array.length; s++) i[l++] = this._outlineVertexBuffer.array[s];\n\n    e[l++] = this._outlineIndexBuffer.array.length;\n\n    for (let s = 0; s < this._outlineIndexBuffer.array.length; s++) e[l++] = this._outlineIndexBuffer.array[s];\n\n    return e.buffer;\n  }\n\n  _processFeature(t, e, i, l, n, r, o) {\n    if (!t) return;\n    const a = t.length,\n          f = !n || 0 === n.length;\n    if (e && (!i || f)) for (let s = 0; s < a; s++) this._processOutline(t[s], n);\n    const u = 32;\n    let d;\n\n    for (let h = 0; h < a; h++) {\n      const e = s._area(t[h]);\n\n      e > u ? (void 0 !== d && this._processFill(t, d, l, r, o), d = [h]) : e < -u && void 0 !== d && d.push(h);\n    }\n\n    void 0 !== d && this._processFill(t, d, l, r, o);\n  }\n\n  _processOutline(t, e) {\n    const i = this._outlineVertexBuffer,\n          n = this._outlineIndexBuffer,\n          r = n.index;\n    let s, o, a;\n    const f = new l(0, 0),\n          u = new l(0, 0),\n          d = new l(0, 0);\n\n    let h = -1,\n        x = -1,\n        c = -1,\n        g = -1,\n        y = -1,\n        _ = !1;\n\n    const p = 0;\n    let I = t.length;\n    if (I < 2) return;\n    const B = t[p];\n    let V = t[I - 1];\n\n    for (; I && V.isEqual(B);) --I, V = t[I - 1];\n\n    if (!(I - p < 2)) {\n      for (let l = p; l < I; ++l) {\n        l === p ? (s = t[I - 1], o = t[p], a = t[p + 1], f.assignSub(o, s), f.normalize(), f.rightPerpendicular()) : (s = o, o = a, a = l !== I - 1 ? t[l + 1] : t[p], f.assign(u));\n\n        const r = this._isClipEdge(s, o);\n\n        -1 === g && (_ = r), u.assignSub(a, o), u.normalize(), u.rightPerpendicular();\n        const B = f.x * u.y - f.y * u.x;\n        d.assignAdd(f, u), d.normalize();\n        const V = -d.x * -f.x + -d.y * -f.y;\n        let m = Math.abs(0 !== V ? 1 / V : 1);\n        m > 8 && (m = 8), B >= 0 ? (c = i.add(o.x, o.y, f.x, f.y, 0, 1, e), -1 === g && (g = c), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c), x = i.add(o.x, o.y, m * -d.x, m * -d.y, 0, -1, e), -1 === y && (y = x), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c), h = x, x = c, c = i.add(o.x, o.y, d.x, d.y, 0, 1, e), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c), x = i.add(o.x, o.y, u.x, u.y, 0, 1, e), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c)) : (c = i.add(o.x, o.y, m * d.x, m * d.y, 0, 1, e), -1 === g && (g = c), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c), x = i.add(o.x, o.y, -f.x, -f.y, 0, -1, e), -1 === y && (y = x), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c), h = x, x = c, c = i.add(o.x, o.y, -d.x, -d.y, 0, -1, e), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c), h = i.add(o.x, o.y, -u.x, -u.y, 0, -1, e), h >= 0 && x >= 0 && c >= 0 && !r && n.add(h, x, c));\n      }\n\n      h >= 0 && x >= 0 && g >= 0 && !_ && n.add(h, x, g), h >= 0 && g >= 0 && y >= 0 && !_ && n.add(h, y, g), this._outlineIndexCount += 3 * (n.index - r);\n    }\n  }\n\n  _processFill(i, l, n, r, s) {\n    r = !0;\n    let a;\n    l.length > 1 && (a = []);\n    let f = 0;\n\n    for (const t of l) 0 !== f && a.push(f), f += i[t].length;\n\n    const u = 2 * f,\n          d = t.acquire();\n\n    for (const t of l) {\n      const e = i[t],\n            l = e.length;\n\n      for (let t = 0; t < l; ++t) d.push(e[t].x, e[t].y);\n    }\n\n    const h = e(d, a, 2);\n\n    if (r && e.deviation(d, a, 2, h) > 0) {\n      const t = [],\n            e = [];\n\n      if (o(t, e, i, l), e.length > 0) {\n        const i = this._fillVertexBuffer.index;\n        let l = 0;\n\n        for (; l < t.length;) this._fillVertexBuffer.add(t[l++], t[l++], n);\n\n        let r = 0;\n\n        for (; r < e.length;) this._fillIndexBuffer.add(i + e[r + 0], i + e[r + 1], i + e[r + 2]), r += 3;\n\n        if (void 0 !== s) {\n          const t = this._patternMap,\n                i = t.get(s);\n          i ? i[1] += e.length : t.set(s, [this._fillIndexStart + this._fillIndexCount, e.length]);\n        }\n\n        this._fillIndexCount += e.length;\n      }\n    } else {\n      const t = h.length;\n\n      if (t > 0) {\n        const e = this._fillVertexBuffer.index;\n        let i = 0;\n\n        for (; i < u;) this._fillVertexBuffer.add(d[i++], d[i++], n);\n\n        let l = 0;\n\n        for (; l < t;) this._fillIndexBuffer.add(e + h[l++], e + h[l++], e + h[l++]);\n\n        if (void 0 !== s) {\n          const e = this._patternMap,\n                i = e.get(s);\n          i ? i[1] += t : e.set(s, [this._fillIndexStart + this._fillIndexCount, t]);\n        }\n\n        this._fillIndexCount += t;\n      }\n    }\n\n    t.release(d);\n  }\n\n  _isClipEdge(t, e) {\n    return t.x === e.x ? t.x <= -64 || t.x >= 4160 : t.y === e.y && (t.y <= -64 || t.y >= 4160);\n  }\n\n  static _area(t) {\n    let e = 0;\n    const i = t.length - 1;\n\n    for (let l = 0; l < i; l++) e += (t[l].x - t[l + 1].x) * (t[l].y + t[l + 1].y);\n\n    return e += (t[i].x - t[0].x) * (t[i].y + t[0].y), .5 * e;\n  }\n\n}\n\nfunction o(t, e, i, l) {\n  let n, s;\n  r.beginPolygon(t, e);\n\n  for (const o of l) {\n    const t = i[o];\n\n    if (!(t.length < 3)) {\n      r.beginContour();\n\n      for (let e = 0; e < t.length; ++e) {\n        n = t[e].x, s = t[e].y;\n        const i = [n, s, 0];\n        r.addVertex(i, i);\n      }\n\n      r.endContour();\n    }\n  }\n\n  r.endPolygon();\n}\n\nexport default s;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/buckets/FillBucket.js"],"names":["t","e","i","Point","l","n","r","s","constructor","type","_patternMap","Map","_fillVertexBuffer","_fillIndexBuffer","_outlineVertexBuffer","_outlineIndexBuffer","fillIndexStart","_fillIndexStart","fillIndexCount","_fillIndexCount","outlineIndexStart","_outlineIndexStart","outlineIndexCount","_outlineIndexCount","getResources","layer","zoom","getPaintProperty","isDataDriven","_features","add","name","getValue","repeat","processFeatures","index","fillMaterial","outlineMaterial","hasDataDrivenFill","hasDataDrivenOutline","setExtent","layerExtent","o","a","f","getPaintValue","outlineUsesFillColor","hasDataDrivenOpacity","hasDataDrivenColor","u","d","validateTessellation","h","_spriteInfo","rect","x","encodeAttributes","c","g","getGeometry","push","ddFillAttributes","ddOutlineAttributes","page","geometry","sort","_processFeature","serialize","layerUIDs","length","array","size","Uint32Array","Int32Array","buffer","_processOutline","_area","_processFill","y","_","p","I","B","V","isEqual","assignSub","normalize","rightPerpendicular","assign","_isClipEdge","assignAdd","m","Math","abs","acquire","deviation","get","set","release","beginPolygon","beginContour","addVertex","endContour","endPolygon"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/ArrayPool.js\";import{e}from\"../../../../../chunks/earcut.js\";import i from\"./BaseBucket.js\";import{Point as l}from\"../../webgl/Geometry.js\";import n from\"../../webgl/mesh/Tesselator.js\";const r=new n;class s extends i{constructor(t,e,i,l,n,r,s){super(t,e,i),this.type=1,this._patternMap=new Map,this._fillVertexBuffer=l,this._fillIndexBuffer=n,this._outlineVertexBuffer=r,this._outlineIndexBuffer=s}get fillIndexStart(){return this._fillIndexStart}get fillIndexCount(){return this._fillIndexCount}get outlineIndexStart(){return this._outlineIndexStart}get outlineIndexCount(){return this._outlineIndexCount}getResources(t,e,i){const l=this.layer,n=this.zoom,r=l.getPaintProperty(\"fill-pattern\");if(r)if(r.isDataDriven)for(const s of this._features)e.add({name:r.getValue(n,s),repeat:!0});else e.add({name:r.getValue(n),repeat:!0})}processFeatures(t){this._fillIndexStart=3*this._fillIndexBuffer.index,this._fillIndexCount=0,this._outlineIndexStart=3*this._outlineIndexBuffer.index,this._outlineIndexCount=0;const e=this.layer,i=this.zoom,{fillMaterial:l,outlineMaterial:n,hasDataDrivenFill:r,hasDataDrivenOutline:s}=e;t&&t.setExtent(this.layerExtent);const o=e.getPaintProperty(\"fill-pattern\"),a=null==o?void 0:o.isDataDriven;let f=!o&&e.getPaintValue(\"fill-antialias\",i);if(e.outlineUsesFillColor){if(f&&!e.hasDataDrivenOpacity){const t=e.getPaintValue(\"fill-opacity\",i),l=e.getPaintValue(\"fill-opacity\",i+1);t<1&&l<1&&(f=!1)}if(f&&!e.hasDataDrivenColor){const t=e.getPaintValue(\"fill-color\",i),l=e.getPaintValue(\"fill-color\",i+1);t[3]<1&&l[3]<1&&(f=!1)}}const u=this._features,d=null==t?void 0:t.validateTessellation;if(a){const r=[];for(const a of u){const u=o.getValue(i,a),h=this._spriteInfo[u];if(!h||!h.rect)continue;const x=l.encodeAttributes(a,i,e,h),c=f&&s?n.encodeAttributes(a,i,e):[],g=a.getGeometry(t);r.push({ddFillAttributes:x,ddOutlineAttributes:c,page:h.page,geometry:g}),r.sort(((t,e)=>t.page-e.page));for(const{ddFillAttributes:t,ddOutlineAttributes:i,page:l,geometry:n}of r)this._processFeature(n,f,e.outlineUsesFillColor,t,i,d,l)}}else for(const h of u){const o=r?l.encodeAttributes(h,i,e):null,a=f&&s?n.encodeAttributes(h,i,e):null,u=h.getGeometry(t);this._processFeature(u,f,e.outlineUsesFillColor,o,a,d)}}serialize(){let t=10;t+=this.layerUIDs.length,t+=this._fillVertexBuffer.array.length,t+=this._fillIndexBuffer.array.length,t+=this._outlineVertexBuffer.array.length,t+=this._outlineIndexBuffer.array.length,t+=3*this._patternMap.size+1;const e=new Uint32Array(t),i=new Int32Array(e.buffer);let l=0;e[l++]=this.type,e[l++]=this.layerUIDs.length;for(let s=0;s<this.layerUIDs.length;s++)e[l++]=this.layerUIDs[s];e[l++]=this._fillIndexStart,e[l++]=this._fillIndexCount,e[l++]=this._outlineIndexStart,e[l++]=this._outlineIndexCount;const n=this._patternMap,r=n.size;if(e[l++]=r,r>0)for(const[s,[o,a]]of n)e[l++]=s,e[l++]=o,e[l++]=a;e[l++]=this._fillVertexBuffer.array.length;for(let s=0;s<this._fillVertexBuffer.array.length;s++)i[l++]=this._fillVertexBuffer.array[s];e[l++]=this._fillIndexBuffer.array.length;for(let s=0;s<this._fillIndexBuffer.array.length;s++)e[l++]=this._fillIndexBuffer.array[s];e[l++]=this._outlineVertexBuffer.array.length;for(let s=0;s<this._outlineVertexBuffer.array.length;s++)i[l++]=this._outlineVertexBuffer.array[s];e[l++]=this._outlineIndexBuffer.array.length;for(let s=0;s<this._outlineIndexBuffer.array.length;s++)e[l++]=this._outlineIndexBuffer.array[s];return e.buffer}_processFeature(t,e,i,l,n,r,o){if(!t)return;const a=t.length,f=!n||0===n.length;if(e&&(!i||f))for(let s=0;s<a;s++)this._processOutline(t[s],n);const u=32;let d;for(let h=0;h<a;h++){const e=s._area(t[h]);e>u?(void 0!==d&&this._processFill(t,d,l,r,o),d=[h]):e<-u&&void 0!==d&&d.push(h)}void 0!==d&&this._processFill(t,d,l,r,o)}_processOutline(t,e){const i=this._outlineVertexBuffer,n=this._outlineIndexBuffer,r=n.index;let s,o,a;const f=new l(0,0),u=new l(0,0),d=new l(0,0);let h=-1,x=-1,c=-1,g=-1,y=-1,_=!1;const p=0;let I=t.length;if(I<2)return;const B=t[p];let V=t[I-1];for(;I&&V.isEqual(B);)--I,V=t[I-1];if(!(I-p<2)){for(let l=p;l<I;++l){l===p?(s=t[I-1],o=t[p],a=t[p+1],f.assignSub(o,s),f.normalize(),f.rightPerpendicular()):(s=o,o=a,a=l!==I-1?t[l+1]:t[p],f.assign(u));const r=this._isClipEdge(s,o);-1===g&&(_=r),u.assignSub(a,o),u.normalize(),u.rightPerpendicular();const B=f.x*u.y-f.y*u.x;d.assignAdd(f,u),d.normalize();const V=-d.x*-f.x+-d.y*-f.y;let m=Math.abs(0!==V?1/V:1);m>8&&(m=8),B>=0?(c=i.add(o.x,o.y,f.x,f.y,0,1,e),-1===g&&(g=c),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c),x=i.add(o.x,o.y,m*-d.x,m*-d.y,0,-1,e),-1===y&&(y=x),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c),h=x,x=c,c=i.add(o.x,o.y,d.x,d.y,0,1,e),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c),x=i.add(o.x,o.y,u.x,u.y,0,1,e),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c)):(c=i.add(o.x,o.y,m*d.x,m*d.y,0,1,e),-1===g&&(g=c),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c),x=i.add(o.x,o.y,-f.x,-f.y,0,-1,e),-1===y&&(y=x),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c),h=x,x=c,c=i.add(o.x,o.y,-d.x,-d.y,0,-1,e),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c),h=i.add(o.x,o.y,-u.x,-u.y,0,-1,e),h>=0&&x>=0&&c>=0&&!r&&n.add(h,x,c))}h>=0&&x>=0&&g>=0&&!_&&n.add(h,x,g),h>=0&&g>=0&&y>=0&&!_&&n.add(h,y,g),this._outlineIndexCount+=3*(n.index-r)}}_processFill(i,l,n,r,s){r=!0;let a;l.length>1&&(a=[]);let f=0;for(const t of l)0!==f&&a.push(f),f+=i[t].length;const u=2*f,d=t.acquire();for(const t of l){const e=i[t],l=e.length;for(let t=0;t<l;++t)d.push(e[t].x,e[t].y)}const h=e(d,a,2);if(r&&e.deviation(d,a,2,h)>0){const t=[],e=[];if(o(t,e,i,l),e.length>0){const i=this._fillVertexBuffer.index;let l=0;for(;l<t.length;)this._fillVertexBuffer.add(t[l++],t[l++],n);let r=0;for(;r<e.length;)this._fillIndexBuffer.add(i+e[r+0],i+e[r+1],i+e[r+2]),r+=3;if(void 0!==s){const t=this._patternMap,i=t.get(s);i?i[1]+=e.length:t.set(s,[this._fillIndexStart+this._fillIndexCount,e.length])}this._fillIndexCount+=e.length}}else{const t=h.length;if(t>0){const e=this._fillVertexBuffer.index;let i=0;for(;i<u;)this._fillVertexBuffer.add(d[i++],d[i++],n);let l=0;for(;l<t;)this._fillIndexBuffer.add(e+h[l++],e+h[l++],e+h[l++]);if(void 0!==s){const e=this._patternMap,i=e.get(s);i?i[1]+=t:e.set(s,[this._fillIndexStart+this._fillIndexCount,t])}this._fillIndexCount+=t}}t.release(d)}_isClipEdge(t,e){return t.x===e.x?t.x<=-64||t.x>=4160:t.y===e.y&&(t.y<=-64||t.y>=4160)}static _area(t){let e=0;const i=t.length-1;for(let l=0;l<i;l++)e+=(t[l].x-t[l+1].x)*(t[l].y+t[l+1].y);return e+=(t[i].x-t[0].x)*(t[i].y+t[0].y),.5*e}}function o(t,e,i,l){let n,s;r.beginPolygon(t,e);for(const o of l){const t=i[o];if(!(t.length<3)){r.beginContour();for(let e=0;e<t.length;++e){n=t[e].x,s=t[e].y;const i=[n,s,0];r.addVertex(i,i)}r.endContour()}}r.endPolygon()}export default s;\n"]},"metadata":{},"sourceType":"module"}