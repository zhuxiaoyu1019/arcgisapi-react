{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Logger.js\";\nconst t = e.getLogger(\"esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder\");\n\nclass r {\n  constructor() {\n    this.includedModules = new Map();\n  }\n\n  include(e, r) {\n    this.includedModules.has(e) ? this.includedModules.get(e) !== r && t.error(\"Trying to include shader module multiple times with different sets of options.\") : (this.includedModules.set(e, r), e(this.builder, r));\n  }\n\n}\n\nclass n extends r {\n  constructor() {\n    super(...arguments), this.vertex = new o(), this.fragment = new o(), this.attributes = new a(), this.varyings = new c(), this.extensions = new u(), this.constants = new h();\n  }\n\n  get fragmentUniforms() {\n    return this.fragment.uniforms;\n  }\n\n  get builder() {\n    return this;\n  }\n\n  generateSource(e) {\n    const t = this.extensions.generateSource(e),\n          r = this.attributes.generateSource(e),\n          n = this.varyings.generateSource(),\n          s = \"vertex\" === e ? this.vertex : this.fragment,\n          i = s.uniforms.generateSource(),\n          o = s.code.generateSource(),\n          a = \"vertex\" === e ? l : m,\n          c = this.constants.generateSource().concat(s.constants.generateSource());\n    return `\\n${t.join(\"\\n\")}\\n\\n${a}\\n\\n${c.join(\"\\n\")}\\n\\n${i.join(\"\\n\")}\\n\\n${r.join(\"\\n\")}\\n\\n${n.join(\"\\n\")}\\n\\n${o.join(\"\\n\")}`;\n  }\n\n}\n\nclass s {\n  constructor() {\n    this._entries = new Map();\n  }\n\n  add(e, t, r) {\n    const n = `${e}_${t}_${r}`;\n    return this._entries.set(n, {\n      name: e,\n      type: t,\n      arraySize: r\n    }), this;\n  }\n\n  generateSource() {\n    const e = e => e ? `[${e}]` : \"\";\n\n    return Array.from(this._entries.values()).map(t => `uniform ${t.type} ${t.name}${e(t.arraySize)};`);\n  }\n\n  get entries() {\n    return Array.from(this._entries.values());\n  }\n\n}\n\nclass i {\n  constructor() {\n    this._entries = new Array();\n  }\n\n  add(e) {\n    this._entries.push(e);\n  }\n\n  generateSource() {\n    return this._entries;\n  }\n\n}\n\nclass o extends r {\n  constructor() {\n    super(...arguments), this.uniforms = new s(), this.code = new i(), this.constants = new h();\n  }\n\n  get builder() {\n    return this;\n  }\n\n}\n\nclass a {\n  constructor() {\n    this._entries = new Array();\n  }\n\n  add(e, t) {\n    this._entries.push([e, t]);\n  }\n\n  generateSource(e) {\n    return \"fragment\" === e ? [] : this._entries.map(e => `attribute ${e[1]} ${e[0]};`);\n  }\n\n}\n\nclass c {\n  constructor() {\n    this._entries = new Array();\n  }\n\n  add(e, t) {\n    this._entries.push([e, t]);\n  }\n\n  generateSource() {\n    return this._entries.map(e => `varying ${e[1]} ${e[0]};`);\n  }\n\n}\n\nclass u {\n  constructor() {\n    this._entries = new Set();\n  }\n\n  add(e) {\n    this._entries.add(e);\n  }\n\n  generateSource(e) {\n    const t = \"vertex\" === e ? u.ALLOWLIST_VERTEX : u.ALLOWLIST_FRAGMENT;\n    return Array.from(this._entries).filter(e => t.includes(e)).map(e => `#extension ${e} : enable`);\n  }\n\n}\n\nu.ALLOWLIST_FRAGMENT = [\"GL_EXT_shader_texture_lod\", \"GL_OES_standard_derivatives\"], u.ALLOWLIST_VERTEX = [];\n\nclass h {\n  constructor() {\n    this._entries = [];\n  }\n\n  add(e, t, r) {\n    let n = \"ERROR_CONSTRUCTOR_STRING\";\n\n    switch (t) {\n      case \"float\":\n        n = h.numberToFloatStr(r);\n        break;\n\n      case \"int\":\n        n = h.numberToIntStr(r);\n        break;\n\n      case \"bool\":\n        n = r.toString();\n        break;\n\n      case \"vec2\":\n        n = `vec2(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])})`;\n        break;\n\n      case \"vec3\":\n        n = `vec3(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])},                            ${h.numberToFloatStr(r[2])})`;\n        break;\n\n      case \"vec4\":\n        n = `vec4(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])},                            ${h.numberToFloatStr(r[2])},                            ${h.numberToFloatStr(r[3])})`;\n        break;\n\n      case \"ivec2\":\n        n = `ivec2(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])})`;\n        break;\n\n      case \"ivec3\":\n        n = `ivec3(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])},                             ${h.numberToIntStr(r[2])})`;\n        break;\n\n      case \"ivec4\":\n        n = `ivec4(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])},                             ${h.numberToIntStr(r[2])},                             ${h.numberToIntStr(r[3])})`;\n        break;\n\n      case \"mat2\":\n      case \"mat3\":\n      case \"mat4\":\n        n = `${t}(${Array.prototype.map.call(r, e => h.numberToFloatStr(e)).join(\", \")})`;\n    }\n\n    return this._entries.push(`const ${t} ${e} = ${n};`), this;\n  }\n\n  static numberToIntStr(e) {\n    return e.toFixed(0);\n  }\n\n  static numberToFloatStr(e) {\n    return Number.isInteger(e) ? e.toFixed(1) : e.toString();\n  }\n\n  generateSource() {\n    return Array.from(this._entries);\n  }\n\n}\n\nconst m = \"#ifdef GL_FRAGMENT_PRECISION_HIGH\\n  precision highp float;\\n  precision highp sampler2D;\\n#else\\n  precision mediump float;\\n  precision mediump sampler2D;\\n#endif\",\n      l = \"precision highp float;\\nprecision highp sampler2D;\";\nexport { i as Code, r as Includes, n as ShaderBuilder, o as Stage };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js"],"names":["e","t","getLogger","r","constructor","includedModules","Map","include","has","get","error","set","builder","n","arguments","vertex","o","fragment","attributes","a","varyings","c","extensions","u","constants","h","fragmentUniforms","uniforms","generateSource","s","i","code","l","m","concat","join","_entries","add","name","type","arraySize","Array","from","values","map","entries","push","Set","ALLOWLIST_VERTEX","ALLOWLIST_FRAGMENT","filter","includes","numberToFloatStr","numberToIntStr","toString","prototype","call","toFixed","Number","isInteger","Code","Includes","ShaderBuilder","Stage"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,+BAAb;AAA6C,MAAMC,CAAC,GAACD,CAAC,CAACE,SAAF,CAAY,6DAAZ,CAAR;;AAAmF,MAAMC,CAAN,CAAO;AAACC,EAAAA,WAAW,GAAE;AAAC,SAAKC,eAAL,GAAqB,IAAIC,GAAJ,EAArB;AAA6B;;AAAAC,EAAAA,OAAO,CAACP,CAAD,EAAGG,CAAH,EAAK;AAAC,SAAKE,eAAL,CAAqBG,GAArB,CAAyBR,CAAzB,IAA4B,KAAKK,eAAL,CAAqBI,GAArB,CAAyBT,CAAzB,MAA8BG,CAA9B,IAAiCF,CAAC,CAACS,KAAF,CAAQ,gFAAR,CAA7D,IAAwJ,KAAKL,eAAL,CAAqBM,GAArB,CAAyBX,CAAzB,EAA2BG,CAA3B,GAA8BH,CAAC,CAAC,KAAKY,OAAN,EAAcT,CAAd,CAAvL;AAAyM;;AAAlQ;;AAAmQ,MAAMU,CAAN,SAAgBV,CAAhB,CAAiB;AAACC,EAAAA,WAAW,GAAE;AAAC,UAAM,GAAGU,SAAT,GAAoB,KAAKC,MAAL,GAAY,IAAIC,CAAJ,EAAhC,EAAsC,KAAKC,QAAL,GAAc,IAAID,CAAJ,EAApD,EAA0D,KAAKE,UAAL,GAAgB,IAAIC,CAAJ,EAA1E,EAAgF,KAAKC,QAAL,GAAc,IAAIC,CAAJ,EAA9F,EAAoG,KAAKC,UAAL,GAAgB,IAAIC,CAAJ,EAApH,EAA0H,KAAKC,SAAL,GAAe,IAAIC,CAAJ,EAAzI;AAA+I;;AAAoB,MAAhBC,gBAAgB,GAAE;AAAC,WAAO,KAAKT,QAAL,CAAcU,QAArB;AAA8B;;AAAW,MAAPf,OAAO,GAAE;AAAC,WAAO,IAAP;AAAY;;AAAAgB,EAAAA,cAAc,CAAC5B,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,KAAKqB,UAAL,CAAgBM,cAAhB,CAA+B5B,CAA/B,CAAR;AAAA,UAA0CG,CAAC,GAAC,KAAKe,UAAL,CAAgBU,cAAhB,CAA+B5B,CAA/B,CAA5C;AAAA,UAA8Ea,CAAC,GAAC,KAAKO,QAAL,CAAcQ,cAAd,EAAhF;AAAA,UAA+GC,CAAC,GAAC,aAAW7B,CAAX,GAAa,KAAKe,MAAlB,GAAyB,KAAKE,QAA/I;AAAA,UAAwJa,CAAC,GAACD,CAAC,CAACF,QAAF,CAAWC,cAAX,EAA1J;AAAA,UAAsLZ,CAAC,GAACa,CAAC,CAACE,IAAF,CAAOH,cAAP,EAAxL;AAAA,UAAgNT,CAAC,GAAC,aAAWnB,CAAX,GAAagC,CAAb,GAAeC,CAAjO;AAAA,UAAmOZ,CAAC,GAAC,KAAKG,SAAL,CAAeI,cAAf,GAAgCM,MAAhC,CAAuCL,CAAC,CAACL,SAAF,CAAYI,cAAZ,EAAvC,CAArO;AAA0S,WAAO,KAAI3B,CAAC,CAACkC,IAAF,CAAO,IAAP,CAAa,OAAMhB,CAAE,OAAME,CAAC,CAACc,IAAF,CAAO,IAAP,CAAa,OAAML,CAAC,CAACK,IAAF,CAAO,IAAP,CAAa,OAAMhC,CAAC,CAACgC,IAAF,CAAO,IAAP,CAAa,OAAMtB,CAAC,CAACsB,IAAF,CAAO,IAAP,CAAa,OAAMnB,CAAC,CAACmB,IAAF,CAAO,IAAP,CAAa,EAA/H;AAAiI;;AAA1qB;;AAA2qB,MAAMN,CAAN,CAAO;AAACzB,EAAAA,WAAW,GAAE;AAAC,SAAKgC,QAAL,GAAc,IAAI9B,GAAJ,EAAd;AAAsB;;AAAA+B,EAAAA,GAAG,CAACrC,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,UAAMU,CAAC,GAAE,GAAEb,CAAE,IAAGC,CAAE,IAAGE,CAAE,EAAvB;AAAyB,WAAO,KAAKiC,QAAL,CAAczB,GAAd,CAAkBE,CAAlB,EAAoB;AAACyB,MAAAA,IAAI,EAACtC,CAAN;AAAQuC,MAAAA,IAAI,EAACtC,CAAb;AAAeuC,MAAAA,SAAS,EAACrC;AAAzB,KAApB,GAAiD,IAAxD;AAA6D;;AAAAyB,EAAAA,cAAc,GAAE;AAAC,UAAM5B,CAAC,GAACA,CAAC,IAAEA,CAAC,GAAE,IAAGA,CAAE,GAAP,GAAU,EAAtB;;AAAyB,WAAOyC,KAAK,CAACC,IAAN,CAAW,KAAKN,QAAL,CAAcO,MAAd,EAAX,EAAmCC,GAAnC,CAAwC3C,CAAC,IAAG,WAAUA,CAAC,CAACsC,IAAK,IAAGtC,CAAC,CAACqC,IAAK,GAAEtC,CAAC,CAACC,CAAC,CAACuC,SAAH,CAAc,GAAxF,CAAP;AAAoG;;AAAW,MAAPK,OAAO,GAAE;AAAC,WAAOJ,KAAK,CAACC,IAAN,CAAW,KAAKN,QAAL,CAAcO,MAAd,EAAX,CAAP;AAA0C;;AAA5U;;AAA6U,MAAMb,CAAN,CAAO;AAAC1B,EAAAA,WAAW,GAAE;AAAC,SAAKgC,QAAL,GAAc,IAAIK,KAAJ,EAAd;AAAwB;;AAAAJ,EAAAA,GAAG,CAACrC,CAAD,EAAG;AAAC,SAAKoC,QAAL,CAAcU,IAAd,CAAmB9C,CAAnB;AAAsB;;AAAA4B,EAAAA,cAAc,GAAE;AAAC,WAAO,KAAKQ,QAAZ;AAAqB;;AAA1G;;AAA2G,MAAMpB,CAAN,SAAgBb,CAAhB,CAAiB;AAACC,EAAAA,WAAW,GAAE;AAAC,UAAM,GAAGU,SAAT,GAAoB,KAAKa,QAAL,GAAc,IAAIE,CAAJ,EAAlC,EAAwC,KAAKE,IAAL,GAAU,IAAID,CAAJ,EAAlD,EAAwD,KAAKN,SAAL,GAAe,IAAIC,CAAJ,EAAvE;AAA6E;;AAAW,MAAPb,OAAO,GAAE;AAAC,WAAO,IAAP;AAAY;;AAAtH;;AAAuH,MAAMO,CAAN,CAAO;AAACf,EAAAA,WAAW,GAAE;AAAC,SAAKgC,QAAL,GAAc,IAAIK,KAAJ,EAAd;AAAwB;;AAAAJ,EAAAA,GAAG,CAACrC,CAAD,EAAGC,CAAH,EAAK;AAAC,SAAKmC,QAAL,CAAcU,IAAd,CAAmB,CAAC9C,CAAD,EAAGC,CAAH,CAAnB;AAA0B;;AAAA2B,EAAAA,cAAc,CAAC5B,CAAD,EAAG;AAAC,WAAM,eAAaA,CAAb,GAAe,EAAf,GAAkB,KAAKoC,QAAL,CAAcQ,GAAd,CAAmB5C,CAAC,IAAG,aAAYA,CAAC,CAAC,CAAD,CAAI,IAAGA,CAAC,CAAC,CAAD,CAAI,GAAhD,CAAxB;AAA6E;;AAAzK;;AAA0K,MAAMqB,CAAN,CAAO;AAACjB,EAAAA,WAAW,GAAE;AAAC,SAAKgC,QAAL,GAAc,IAAIK,KAAJ,EAAd;AAAwB;;AAAAJ,EAAAA,GAAG,CAACrC,CAAD,EAAGC,CAAH,EAAK;AAAC,SAAKmC,QAAL,CAAcU,IAAd,CAAmB,CAAC9C,CAAD,EAAGC,CAAH,CAAnB;AAA0B;;AAAA2B,EAAAA,cAAc,GAAE;AAAC,WAAO,KAAKQ,QAAL,CAAcQ,GAAd,CAAmB5C,CAAC,IAAG,WAAUA,CAAC,CAAC,CAAD,CAAI,IAAGA,CAAC,CAAC,CAAD,CAAI,GAA9C,CAAP;AAA0D;;AAArJ;;AAAsJ,MAAMuB,CAAN,CAAO;AAACnB,EAAAA,WAAW,GAAE;AAAC,SAAKgC,QAAL,GAAc,IAAIW,GAAJ,EAAd;AAAsB;;AAAAV,EAAAA,GAAG,CAACrC,CAAD,EAAG;AAAC,SAAKoC,QAAL,CAAcC,GAAd,CAAkBrC,CAAlB;AAAqB;;AAAA4B,EAAAA,cAAc,CAAC5B,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,aAAWD,CAAX,GAAauB,CAAC,CAACyB,gBAAf,GAAgCzB,CAAC,CAAC0B,kBAA1C;AAA6D,WAAOR,KAAK,CAACC,IAAN,CAAW,KAAKN,QAAhB,EAA0Bc,MAA1B,CAAkClD,CAAC,IAAEC,CAAC,CAACkD,QAAF,CAAWnD,CAAX,CAArC,EAAqD4C,GAArD,CAA0D5C,CAAC,IAAG,cAAaA,CAAE,WAA7E,CAAP;AAAiG;;AAAjP;;AAAkPuB,CAAC,CAAC0B,kBAAF,GAAqB,CAAC,2BAAD,EAA6B,6BAA7B,CAArB,EAAiF1B,CAAC,CAACyB,gBAAF,GAAmB,EAApG;;AAAuG,MAAMvB,CAAN,CAAO;AAACrB,EAAAA,WAAW,GAAE;AAAC,SAAKgC,QAAL,GAAc,EAAd;AAAiB;;AAAAC,EAAAA,GAAG,CAACrC,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,QAAIU,CAAC,GAAC,0BAAN;;AAAiC,YAAOZ,CAAP;AAAU,WAAI,OAAJ;AAAYY,QAAAA,CAAC,GAACY,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAnB,CAAF;AAAwB;;AAAM,WAAI,KAAJ;AAAUU,QAAAA,CAAC,GAACY,CAAC,CAAC4B,cAAF,CAAiBlD,CAAjB,CAAF;AAAsB;;AAAM,WAAI,MAAJ;AAAWU,QAAAA,CAAC,GAACV,CAAC,CAACmD,QAAF,EAAF;AAAe;;AAAM,WAAI,MAAJ;AAAWzC,QAAAA,CAAC,GAAE,QAAOY,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,gCAA+BsB,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,GAA3F;AAA8F;;AAAM,WAAI,MAAJ;AAAWU,QAAAA,CAAC,GAAE,QAAOY,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,gCAA+BsB,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,gCAA+BsB,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,GAAnJ;AAAsJ;;AAAM,WAAI,MAAJ;AAAWU,QAAAA,CAAC,GAAE,QAAOY,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,gCAA+BsB,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,gCAA+BsB,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,gCAA+BsB,CAAC,CAAC2B,gBAAF,CAAmBjD,CAAC,CAAC,CAAD,CAApB,CAAyB,GAA3M;AAA8M;;AAAM,WAAI,OAAJ;AAAYU,QAAAA,CAAC,GAAE,SAAQY,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,iCAAgCsB,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,GAAzF;AAA4F;;AAAM,WAAI,OAAJ;AAAYU,QAAAA,CAAC,GAAE,SAAQY,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,iCAAgCsB,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,iCAAgCsB,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,GAAhJ;AAAmJ;;AAAM,WAAI,OAAJ;AAAYU,QAAAA,CAAC,GAAE,SAAQY,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,iCAAgCsB,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,iCAAgCsB,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,iCAAgCsB,CAAC,CAAC4B,cAAF,CAAiBlD,CAAC,CAAC,CAAD,CAAlB,CAAuB,GAAvM;AAA0M;;AAAM,WAAI,MAAJ;AAAW,WAAI,MAAJ;AAAW,WAAI,MAAJ;AAAWU,QAAAA,CAAC,GAAE,GAAEZ,CAAE,IAAGwC,KAAK,CAACc,SAAN,CAAgBX,GAAhB,CAAoBY,IAApB,CAAyBrD,CAAzB,EAA4BH,CAAC,IAAEyB,CAAC,CAAC2B,gBAAF,CAAmBpD,CAAnB,CAA/B,EAAuDmC,IAAvD,CAA4D,IAA5D,CAAkE,GAA5E;AAA/nC;;AAA8sC,WAAO,KAAKC,QAAL,CAAcU,IAAd,CAAoB,SAAQ7C,CAAE,IAAGD,CAAE,MAAKa,CAAE,GAA1C,GAA8C,IAArD;AAA0D;;AAAqB,SAAdwC,cAAc,CAACrD,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACyD,OAAF,CAAU,CAAV,CAAP;AAAoB;;AAAuB,SAAhBL,gBAAgB,CAACpD,CAAD,EAAG;AAAC,WAAO0D,MAAM,CAACC,SAAP,CAAiB3D,CAAjB,IAAoBA,CAAC,CAACyD,OAAF,CAAU,CAAV,CAApB,GAAiCzD,CAAC,CAACsD,QAAF,EAAxC;AAAqD;;AAAA1B,EAAAA,cAAc,GAAE;AAAC,WAAOa,KAAK,CAACC,IAAN,CAAW,KAAKN,QAAhB,CAAP;AAAiC;;AAAngD;;AAAogD,MAAMH,CAAC,GAAC,sKAAR;AAAA,MAA+KD,CAAC,GAAC,oDAAjL;AAAsO,SAAOF,CAAC,IAAI8B,IAAZ,EAAiBzD,CAAC,IAAI0D,QAAtB,EAA+BhD,CAAC,IAAIiD,aAApC,EAAkD9C,CAAC,IAAI+C,KAAvD","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Logger.js\";const t=e.getLogger(\"esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder\");class r{constructor(){this.includedModules=new Map}include(e,r){this.includedModules.has(e)?this.includedModules.get(e)!==r&&t.error(\"Trying to include shader module multiple times with different sets of options.\"):(this.includedModules.set(e,r),e(this.builder,r))}}class n extends r{constructor(){super(...arguments),this.vertex=new o,this.fragment=new o,this.attributes=new a,this.varyings=new c,this.extensions=new u,this.constants=new h}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(),s=\"vertex\"===e?this.vertex:this.fragment,i=s.uniforms.generateSource(),o=s.code.generateSource(),a=\"vertex\"===e?l:m,c=this.constants.generateSource().concat(s.constants.generateSource());return`\\n${t.join(\"\\n\")}\\n\\n${a}\\n\\n${c.join(\"\\n\")}\\n\\n${i.join(\"\\n\")}\\n\\n${r.join(\"\\n\")}\\n\\n${n.join(\"\\n\")}\\n\\n${o.join(\"\\n\")}`}}class s{constructor(){this._entries=new Map}add(e,t,r){const n=`${e}_${t}_${r}`;return this._entries.set(n,{name:e,type:t,arraySize:r}),this}generateSource(){const e=e=>e?`[${e}]`:\"\";return Array.from(this._entries.values()).map((t=>`uniform ${t.type} ${t.name}${e(t.arraySize)};`))}get entries(){return Array.from(this._entries.values())}}class i{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class o extends r{constructor(){super(...arguments),this.uniforms=new s,this.code=new i,this.constants=new h}get builder(){return this}}class a{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return\"fragment\"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class c{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class u{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t=\"vertex\"===e?u.ALLOWLIST_VERTEX:u.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}u.ALLOWLIST_FRAGMENT=[\"GL_EXT_shader_texture_lod\",\"GL_OES_standard_derivatives\"],u.ALLOWLIST_VERTEX=[];class h{constructor(){this._entries=[]}add(e,t,r){let n=\"ERROR_CONSTRUCTOR_STRING\";switch(t){case\"float\":n=h.numberToFloatStr(r);break;case\"int\":n=h.numberToIntStr(r);break;case\"bool\":n=r.toString();break;case\"vec2\":n=`vec2(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])})`;break;case\"vec3\":n=`vec3(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])},                            ${h.numberToFloatStr(r[2])})`;break;case\"vec4\":n=`vec4(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])},                            ${h.numberToFloatStr(r[2])},                            ${h.numberToFloatStr(r[3])})`;break;case\"ivec2\":n=`ivec2(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])})`;break;case\"ivec3\":n=`ivec3(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])},                             ${h.numberToIntStr(r[2])})`;break;case\"ivec4\":n=`ivec4(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])},                             ${h.numberToIntStr(r[2])},                             ${h.numberToIntStr(r[3])})`;break;case\"mat2\":case\"mat3\":case\"mat4\":n=`${t}(${Array.prototype.map.call(r,(e=>h.numberToFloatStr(e))).join(\", \")})`}return this._entries.push(`const ${t} ${e} = ${n};`),this}static numberToIntStr(e){return e.toFixed(0)}static numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const m=\"#ifdef GL_FRAGMENT_PRECISION_HIGH\\n  precision highp float;\\n  precision highp sampler2D;\\n#else\\n  precision mediump float;\\n  precision mediump sampler2D;\\n#endif\",l=\"precision highp float;\\nprecision highp sampler2D;\";export{i as Code,r as Includes,n as ShaderBuilder,o as Stage};\n"]},"metadata":{},"sourceType":"module"}