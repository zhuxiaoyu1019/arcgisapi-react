{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { neverReached as e } from \"../../../../core/compilerUtils.js\";\nimport { isDataProtocol as t, dataComponents as r, dataToArrayBuffer as n, makeAbsolute as o } from \"../../../../core/urlUtils.js\";\nimport { Version as s } from \"../../../../core/Version.js\";\nimport { m as a, t as i, c as u, s as c, n as p } from \"../../../../chunks/mat4.js\";\nimport { c as d, b as f } from \"../../../../chunks/mat4f64.js\";\nimport { g as l } from \"../../../../chunks/quat.js\";\nimport { a as m } from \"../../../../chunks/quatf64.js\";\nimport { BufferViewUint32 as h, BufferViewUint16 as y, BufferViewUint8 as b, BufferViewVec3f as T, BufferViewVec4f as x, BufferViewVec2f as w, BufferViewVec4u8 as O, BufferViewVec4u16 as C, BufferViewVec3u8 as g, BufferViewVec3u16 as U, BufferViewVec2u32 as N, BufferViewVec2u16 as S, BufferViewVec2i16 as A, BufferViewVec2u8 as I, BufferViewVec2i8 as R } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { m as L } from \"../../../../chunks/scalar.js\";\nimport { BinaryStreamReader as E } from \"./BinaryStreamReader.js\";\nimport { material as v, textureSampler as B } from \"./fillDefaults.js\";\nimport { splitURI as M } from \"./pathUtils.js\";\nconst D = {\n  MAGIC: 1179937895,\n  CHUNK_TYPE_JSON: 1313821514,\n  CHUNK_TYPE_BIN: 5130562,\n  MIN_HEADER_LENGTH: 20\n};\n\nclass j {\n  constructor(e, t, r, n, o) {\n    this.context = e, this.errorContext = t, this.uri = r, this.json = n, this.glbBuffer = o, this.bufferCache = new Map(), this.textureCache = new Map(), this.materialCache = new Map(), this.nodeParentMap = new Map(), this.nodeTransformCache = new Map(), this.baseUri = M(this.uri).dirPart, this.checkVersionSupported(), this.checkRequiredExtensionsSupported(), t.errorUnsupportedIf(null == n.scenes, \"Scenes must be defined.\"), t.errorUnsupportedIf(null == n.meshes, \"Meshes must be defined\"), t.errorUnsupportedIf(null == n.nodes, \"Nodes must be defined.\"), this.computeNodeParents();\n  }\n\n  static async load(e, o, s, a) {\n    if (t(s)) {\n      const t = r(s);\n      if (\"model/gltf-binary\" !== t.mediaType) try {\n        const r = JSON.parse(t.isBase64 ? atob(t.data) : t.data);\n        return new j(e, o, s, r);\n      } catch {}\n      const a = n(s);\n      if (j.isGLBData(a)) return this.fromGLBData(e, o, s, a);\n    }\n\n    if (s.endsWith(\".gltf\")) {\n      const t = await e.loadJSON(s, a);\n      return new j(e, o, s, t);\n    }\n\n    const i = await e.loadBinary(s, a);\n    if (j.isGLBData(i)) return this.fromGLBData(e, o, s, i);\n    const u = await e.loadJSON(s, a);\n    return new j(e, o, s, u);\n  }\n\n  static isGLBData(e) {\n    const t = new E(e);\n    return t.remainingBytes() >= 4 && t.readUint32() === D.MAGIC;\n  }\n\n  static async fromGLBData(e, t, r, n) {\n    const o = await j.parseGLBData(t, n);\n    return new j(e, t, r, o.json, o.binaryData);\n  }\n\n  static async parseGLBData(e, t) {\n    const r = new E(t);\n    e.assert(r.remainingBytes() >= 12, \"GLB binary data is insufficiently large.\");\n    const n = r.readUint32(),\n          o = r.readUint32(),\n          s = r.readUint32();\n    e.assert(n === D.MAGIC, \"Magic first 4 bytes do not fit to expected GLB value.\"), e.assert(t.byteLength >= s, \"GLB binary data is smaller than header specifies.\"), e.errorUnsupportedIf(2 !== o, \"An unsupported GLB container version was detected. Only version 2 is supported.\");\n    let a,\n        i,\n        u = 0;\n\n    for (; r.remainingBytes() >= 8;) {\n      const t = r.readUint32(),\n            n = r.readUint32();\n      0 === u ? (e.assert(n === D.CHUNK_TYPE_JSON, \"First GLB chunk must be JSON.\"), e.assert(t >= 0, \"No JSON data found.\"), a = await X(r.readUint8Array(t))) : 1 === u ? (e.errorUnsupportedIf(n !== D.CHUNK_TYPE_BIN, \"Second GLB chunk expected to be BIN.\"), i = r.readUint8Array(t)) : e.warnUnsupported(\"More than 2 GLB chunks detected. Skipping.\"), u += 1;\n    }\n\n    return a || e.error(\"No GLB JSON chunk detected.\"), {\n      json: a,\n      binaryData: i\n    };\n  }\n\n  async getBuffer(e, t) {\n    const r = this.json.buffers[e],\n          n = this.errorContext;\n    if (null == r.uri) return n.assert(null != this.glbBuffer, \"GLB buffer not present\"), this.glbBuffer;\n    let o = this.bufferCache.get(e);\n\n    if (!o) {\n      const s = await this.context.loadBinary(this.resolveUri(r.uri), t);\n      o = new Uint8Array(s), this.bufferCache.set(e, o), n.assert(o.byteLength === r.byteLength, \"Buffer byte lengths should match.\");\n    }\n\n    return o;\n  }\n\n  async getAccessor(e, t) {\n    const r = this.json.accessors[e],\n          n = this.errorContext;\n    n.errorUnsupportedIf(null == r.bufferView, \"Some accessor does not specify a bufferView.\"), n.errorUnsupportedIf(r.type in [\"MAT2\", \"MAT3\", \"MAT4\"], `AttributeType ${r.type} is not supported`);\n    const o = this.json.bufferViews[r.bufferView],\n          s = await this.getBuffer(o.buffer, t),\n          a = F[r.type],\n          i = k[r.componentType],\n          u = a * i,\n          c = o.byteStride || u;\n    return {\n      raw: s.buffer,\n      byteStride: c,\n      byteOffset: s.byteOffset + (o.byteOffset || 0) + (r.byteOffset || 0),\n      entryCount: r.count,\n      isDenselyPacked: c === u,\n      componentCount: a,\n      componentByteSize: i,\n      componentType: r.componentType,\n      min: r.min,\n      max: r.max,\n      normalized: !!r.normalized\n    };\n  }\n\n  async getIndexData(e, t) {\n    if (null == e.indices) return null;\n    const r = await this.getAccessor(e.indices, t);\n    if (r.isDenselyPacked) switch (r.componentType) {\n      case 5121:\n        return new Uint8Array(r.raw, r.byteOffset, r.entryCount);\n\n      case 5123:\n        return new Uint16Array(r.raw, r.byteOffset, r.entryCount);\n\n      case 5125:\n        return new Uint32Array(r.raw, r.byteOffset, r.entryCount);\n    } else switch (r.componentType) {\n      case 5121:\n        return L(this.wrapAccessor(b, r));\n\n      case 5123:\n        return L(this.wrapAccessor(y, r));\n\n      case 5125:\n        return L(this.wrapAccessor(h, r));\n    }\n  }\n\n  async getPositionData(e, t) {\n    const r = this.errorContext;\n    r.errorUnsupportedIf(null == e.attributes.POSITION, \"No POSITION vertex data found.\");\n    const n = await this.getAccessor(e.attributes.POSITION, t);\n    return r.errorUnsupportedIf(5126 !== n.componentType, \"Expected type FLOAT for POSITION vertex attribute, but found \" + q[n.componentType]), r.errorUnsupportedIf(3 !== n.componentCount, \"POSITION vertex attribute must have 3 components, but found \" + n.componentCount.toFixed()), this.wrapAccessor(T, n);\n  }\n\n  async getNormalData(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.NORMAL, \"No NORMAL vertex data found.\");\n    const n = await this.getAccessor(e.attributes.NORMAL, t);\n    return r.errorUnsupportedIf(5126 !== n.componentType, \"Expected type FLOAT for NORMAL vertex attribute, but found \" + q[n.componentType]), r.errorUnsupportedIf(3 !== n.componentCount, \"NORMAL vertex attribute must have 3 components, but found \" + n.componentCount.toFixed()), this.wrapAccessor(T, n);\n  }\n\n  async getTangentData(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.TANGENT, \"No TANGENT vertex data found.\");\n    const n = await this.getAccessor(e.attributes.TANGENT, t);\n    return r.errorUnsupportedIf(5126 !== n.componentType, \"Expected type FLOAT for TANGENT vertex attribute, but found \" + q[n.componentType]), r.errorUnsupportedIf(4 !== n.componentCount, \"TANGENT vertex attribute must have 4 components, but found \" + n.componentCount.toFixed()), new x(n.raw, n.byteOffset, n.byteStride, n.byteOffset + n.byteStride * n.entryCount);\n  }\n\n  async getTextureCoordinates(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.TEXCOORD_0, \"No TEXCOORD_0 vertex data found.\");\n    const n = await this.getAccessor(e.attributes.TEXCOORD_0, t);\n    return r.errorUnsupportedIf(2 !== n.componentCount, \"TEXCOORD_0 vertex attribute must have 2 components, but found \" + n.componentCount.toFixed()), 5126 === n.componentType ? this.wrapAccessor(w, n) : (r.errorUnsupportedIf(!n.normalized, \"Integer component types are only supported for a normalized accessor for TEXCOORD_0.\"), V(n));\n  }\n\n  async getVertexColors(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.COLOR_0, \"No COLOR_0 vertex data found.\");\n    const n = await this.getAccessor(e.attributes.COLOR_0, t);\n\n    if (r.errorUnsupportedIf(4 !== n.componentCount && 3 !== n.componentCount, \"COLOR_0 attribute must have 3 or 4 components, but found \" + n.componentCount.toFixed()), 4 === n.componentCount) {\n      if (5126 === n.componentType) return this.wrapAccessor(x, n);\n      if (5121 === n.componentType) return this.wrapAccessor(O, n);\n      if (5123 === n.componentType) return this.wrapAccessor(C, n);\n    } else if (3 === n.componentCount) {\n      if (5126 === n.componentType) return this.wrapAccessor(T, n);\n      if (5121 === n.componentType) return this.wrapAccessor(g, n);\n      if (5123 === n.componentType) return this.wrapAccessor(U, n);\n    }\n\n    r.errorUnsupported(\"Unsupported component type for COLOR_0 attribute: \" + q[n.componentType]);\n  }\n\n  hasPositions(e) {\n    return void 0 !== e.attributes.POSITION;\n  }\n\n  hasNormals(e) {\n    return void 0 !== e.attributes.NORMAL;\n  }\n\n  hasVertexColors(e) {\n    return void 0 !== e.attributes.COLOR_0;\n  }\n\n  hasTextureCoordinates(e) {\n    return void 0 !== e.attributes.TEXCOORD_0;\n  }\n\n  hasTangents(e) {\n    return void 0 !== e.attributes.TANGENT;\n  }\n\n  async getMaterial(e, t, r) {\n    const n = this.errorContext;\n    let o = this.materialCache.get(e.material);\n\n    if (!o) {\n      const s = null != e.material ? v(this.json.materials[e.material]) : v(),\n            a = s.pbrMetallicRoughness,\n            i = this.hasVertexColors(e);\n      let u, c, p, d, f;\n      a.baseColorTexture && (n.errorUnsupportedIf(0 !== (a.baseColorTexture.texCoord || 0), \"Only TEXCOORD with index 0 is supported.\"), u = await this.getTexture(a.baseColorTexture.index, t)), s.normalTexture && (0 !== (s.normalTexture.texCoord || 0) ? n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the normal map texture.\") : c = await this.getTexture(s.normalTexture.index, t)), s.occlusionTexture && r && (0 !== (s.occlusionTexture.texCoord || 0) ? n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the occlusion texture.\") : p = await this.getTexture(s.occlusionTexture.index, t)), s.emissiveTexture && r && (0 !== (s.emissiveTexture.texCoord || 0) ? n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the emissive texture.\") : d = await this.getTexture(s.emissiveTexture.index, t)), a.metallicRoughnessTexture && r && (0 !== (a.metallicRoughnessTexture.texCoord || 0) ? n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the metallicRoughness texture.\") : f = await this.getTexture(a.metallicRoughnessTexture.index, t));\n      const l = null != e.material ? e.material : -1;\n      o = {\n        alphaMode: s.alphaMode,\n        alphaCutoff: s.alphaCutoff,\n        color: a.baseColorFactor,\n        doubleSided: !!s.doubleSided,\n        colorTexture: u,\n        normalTexture: c,\n        name: s.name,\n        id: l,\n        occlusionTexture: p,\n        emissiveTexture: d,\n        emissiveFactor: s.emissiveFactor,\n        metallicFactor: a.metallicFactor,\n        roughnessFactor: a.roughnessFactor,\n        metallicRoughnessTexture: f,\n        vertexColors: i,\n        ESRI_externalColorMixMode: s.extras.ESRI_externalColorMixMode\n      };\n    }\n\n    return o;\n  }\n\n  async getTexture(e, t) {\n    const r = this.errorContext,\n          n = this.json.textures[e],\n          o = B(null != n.sampler ? this.json.samplers[n.sampler] : {});\n    r.errorUnsupportedIf(null == n.source, \"Source is expected to be defined for a texture.\");\n    const s = this.json.images[n.source];\n    let a = this.textureCache.get(e);\n\n    if (!a) {\n      let n;\n      if (s.uri) n = await this.context.loadImage(this.resolveUri(s.uri), t);else {\n        r.errorUnsupportedIf(null == s.bufferView, \"Image bufferView must be defined.\"), r.errorUnsupportedIf(null == s.mimeType, \"Image mimeType must be defined.\");\n        const e = this.json.bufferViews[s.bufferView],\n              o = await this.getBuffer(e.buffer, t);\n        r.errorUnsupportedIf(null != e.byteStride, \"byteStride not supported for image buffer\"), n = await J(new Uint8Array(o.buffer, o.byteOffset + (e.byteOffset || 0), e.byteLength), s.mimeType);\n      }\n\n      const i = e => 33071 === e || 33648 === e || 10497 === e,\n            u = e => (r.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`), 10497);\n\n      a = {\n        data: n,\n        wrapS: i(o.wrapS) ? o.wrapS : u(o.wrapS),\n        wrapT: i(o.wrapT) ? o.wrapT : u(o.wrapT),\n        minFilter: o.minFilter,\n        name: s.name,\n        id: e\n      }, this.textureCache.set(e, a);\n    }\n\n    return a;\n  }\n\n  getNodeTransform(e) {\n    if (void 0 === e) return _;\n    let t = this.nodeTransformCache.get(e);\n\n    if (!t) {\n      const r = this.getNodeTransform(this.getNodeParent(e)),\n            n = this.json.nodes[e];\n      n.matrix ? t = a(d(), r, n.matrix) : n.translation || n.rotation || n.scale ? (t = f(r), n.translation && i(t, t, n.translation), n.rotation && (P[3] = l(P, n.rotation), u(t, t, P[3], P)), n.scale && c(t, t, n.scale)) : t = r, this.nodeTransformCache.set(e, t);\n    }\n\n    return t;\n  }\n\n  wrapAccessor(e, t) {\n    return new e(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * (t.entryCount - 1) + t.componentByteSize * t.componentCount);\n  }\n\n  resolveUri(e) {\n    return o(e, this.baseUri);\n  }\n\n  getNodeParent(e) {\n    return this.nodeParentMap.get(e);\n  }\n\n  checkVersionSupported() {\n    const e = s.parse(this.json.asset.version, \"glTF\");\n    G.validate(e);\n  }\n\n  checkRequiredExtensionsSupported() {\n    const e = this.json,\n          t = this.errorContext;\n    e.extensionsRequired && 0 !== e.extensionsRequired.length && t.errorUnsupported(\"gltf loader was not able to load unsupported feature. Required extensions: \" + e.extensionsRequired.join(\", \"));\n  }\n\n  computeNodeParents() {\n    this.json.nodes.forEach((e, t) => {\n      e.children && e.children.forEach(e => {\n        this.nodeParentMap.set(e, t);\n      });\n    });\n  }\n\n}\n\nconst G = new s(2, 0, \"glTF\"),\n      _ = p(d(), Math.PI / 2),\n      P = m(),\n      F = {\n  SCALAR: 1,\n  VEC2: 2,\n  VEC3: 3,\n  VEC4: 4\n},\n      k = {\n  5120: 1,\n  5121: 1,\n  5122: 2,\n  5123: 2,\n  5126: 4,\n  5125: 4\n};\n\nfunction V(t) {\n  switch (t.componentType) {\n    case 5120:\n      return new R(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case 5121:\n      return new I(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case 5122:\n      return new A(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case 5123:\n      return new S(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case 5125:\n      return new N(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case 5126:\n      return new w(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    default:\n      return void e(t.componentType);\n  }\n}\n\nasync function X(e) {\n  return new Promise((t, r) => {\n    const n = new Blob([e]),\n          o = new FileReader();\n    o.onload = () => {\n      const e = o.result;\n      t(JSON.parse(e));\n    }, o.onerror = e => {\n      r(e);\n    }, o.readAsText(n);\n  });\n}\n\nasync function J(e, t) {\n  return new Promise((r, n) => {\n    const o = new Blob([e], {\n      type: t\n    }),\n          s = URL.createObjectURL(o),\n          a = new Image();\n    a.addEventListener(\"load\", () => {\n      URL.revokeObjectURL(s), \"decode\" in a ? a.decode().then(() => r(a), () => r(a)) : r(a);\n    }), a.addEventListener(\"error\", e => {\n      URL.revokeObjectURL(s), n(e);\n    }), a.src = s;\n  });\n}\n\nconst q = {\n  5120: \"BYTE\",\n  5121: \"UNSIGNED_BYTE\",\n  5122: \"SHORT\",\n  5123: \"UNSIGNED_SHORT\",\n  5125: \"UNSIGNED_INT\",\n  5126: \"FLOAT\"\n};\nexport { j as Resource };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/glTF/internal/Resource.js"],"names":["neverReached","e","isDataProtocol","t","dataComponents","r","dataToArrayBuffer","n","makeAbsolute","o","Version","s","m","a","i","c","u","p","d","b","f","g","l","BufferViewUint32","h","BufferViewUint16","y","BufferViewUint8","BufferViewVec3f","T","BufferViewVec4f","x","BufferViewVec2f","w","BufferViewVec4u8","O","BufferViewVec4u16","C","BufferViewVec3u8","BufferViewVec3u16","U","BufferViewVec2u32","N","BufferViewVec2u16","S","BufferViewVec2i16","A","BufferViewVec2u8","I","BufferViewVec2i8","R","L","BinaryStreamReader","E","material","v","textureSampler","B","splitURI","M","D","MAGIC","CHUNK_TYPE_JSON","CHUNK_TYPE_BIN","MIN_HEADER_LENGTH","j","constructor","context","errorContext","uri","json","glbBuffer","bufferCache","Map","textureCache","materialCache","nodeParentMap","nodeTransformCache","baseUri","dirPart","checkVersionSupported","checkRequiredExtensionsSupported","errorUnsupportedIf","scenes","meshes","nodes","computeNodeParents","load","mediaType","JSON","parse","isBase64","atob","data","isGLBData","fromGLBData","endsWith","loadJSON","loadBinary","remainingBytes","readUint32","parseGLBData","binaryData","assert","byteLength","X","readUint8Array","warnUnsupported","error","getBuffer","buffers","get","resolveUri","Uint8Array","set","getAccessor","accessors","bufferView","type","bufferViews","buffer","F","k","componentType","byteStride","raw","byteOffset","entryCount","count","isDenselyPacked","componentCount","componentByteSize","min","max","normalized","getIndexData","indices","Uint16Array","Uint32Array","wrapAccessor","getPositionData","attributes","POSITION","q","toFixed","getNormalData","NORMAL","getTangentData","TANGENT","getTextureCoordinates","TEXCOORD_0","V","getVertexColors","COLOR_0","errorUnsupported","hasPositions","hasNormals","hasVertexColors","hasTextureCoordinates","hasTangents","getMaterial","materials","pbrMetallicRoughness","baseColorTexture","texCoord","getTexture","index","normalTexture","occlusionTexture","emissiveTexture","metallicRoughnessTexture","alphaMode","alphaCutoff","color","baseColorFactor","doubleSided","colorTexture","name","id","emissiveFactor","metallicFactor","roughnessFactor","vertexColors","ESRI_externalColorMixMode","extras","textures","sampler","samplers","source","images","loadImage","mimeType","J","wrapS","wrapT","minFilter","getNodeTransform","_","getNodeParent","matrix","translation","rotation","scale","P","asset","version","G","validate","extensionsRequired","length","join","forEach","children","Math","PI","SCALAR","VEC2","VEC3","VEC4","Promise","Blob","FileReader","onload","result","onerror","readAsText","URL","createObjectURL","Image","addEventListener","revokeObjectURL","decode","then","src","Resource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{neverReached as e}from\"../../../../core/compilerUtils.js\";import{isDataProtocol as t,dataComponents as r,dataToArrayBuffer as n,makeAbsolute as o}from\"../../../../core/urlUtils.js\";import{Version as s}from\"../../../../core/Version.js\";import{m as a,t as i,c as u,s as c,n as p}from\"../../../../chunks/mat4.js\";import{c as d,b as f}from\"../../../../chunks/mat4f64.js\";import{g as l}from\"../../../../chunks/quat.js\";import{a as m}from\"../../../../chunks/quatf64.js\";import{BufferViewUint32 as h,BufferViewUint16 as y,BufferViewUint8 as b,BufferViewVec3f as T,BufferViewVec4f as x,BufferViewVec2f as w,BufferViewVec4u8 as O,BufferViewVec4u16 as C,BufferViewVec3u8 as g,BufferViewVec3u16 as U,BufferViewVec2u32 as N,BufferViewVec2u16 as S,BufferViewVec2i16 as A,BufferViewVec2u8 as I,BufferViewVec2i8 as R}from\"../../../../geometry/support/buffer/BufferView.js\";import{m as L}from\"../../../../chunks/scalar.js\";import{BinaryStreamReader as E}from\"./BinaryStreamReader.js\";import{material as v,textureSampler as B}from\"./fillDefaults.js\";import{splitURI as M}from\"./pathUtils.js\";const D={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class j{constructor(e,t,r,n,o){this.context=e,this.errorContext=t,this.uri=r,this.json=n,this.glbBuffer=o,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=M(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==n.scenes,\"Scenes must be defined.\"),t.errorUnsupportedIf(null==n.meshes,\"Meshes must be defined\"),t.errorUnsupportedIf(null==n.nodes,\"Nodes must be defined.\"),this.computeNodeParents()}static async load(e,o,s,a){if(t(s)){const t=r(s);if(\"model/gltf-binary\"!==t.mediaType)try{const r=JSON.parse(t.isBase64?atob(t.data):t.data);return new j(e,o,s,r)}catch{}const a=n(s);if(j.isGLBData(a))return this.fromGLBData(e,o,s,a)}if(s.endsWith(\".gltf\")){const t=await e.loadJSON(s,a);return new j(e,o,s,t)}const i=await e.loadBinary(s,a);if(j.isGLBData(i))return this.fromGLBData(e,o,s,i);const u=await e.loadJSON(s,a);return new j(e,o,s,u)}static isGLBData(e){const t=new E(e);return t.remainingBytes()>=4&&t.readUint32()===D.MAGIC}static async fromGLBData(e,t,r,n){const o=await j.parseGLBData(t,n);return new j(e,t,r,o.json,o.binaryData)}static async parseGLBData(e,t){const r=new E(t);e.assert(r.remainingBytes()>=12,\"GLB binary data is insufficiently large.\");const n=r.readUint32(),o=r.readUint32(),s=r.readUint32();e.assert(n===D.MAGIC,\"Magic first 4 bytes do not fit to expected GLB value.\"),e.assert(t.byteLength>=s,\"GLB binary data is smaller than header specifies.\"),e.errorUnsupportedIf(2!==o,\"An unsupported GLB container version was detected. Only version 2 is supported.\");let a,i,u=0;for(;r.remainingBytes()>=8;){const t=r.readUint32(),n=r.readUint32();0===u?(e.assert(n===D.CHUNK_TYPE_JSON,\"First GLB chunk must be JSON.\"),e.assert(t>=0,\"No JSON data found.\"),a=await X(r.readUint8Array(t))):1===u?(e.errorUnsupportedIf(n!==D.CHUNK_TYPE_BIN,\"Second GLB chunk expected to be BIN.\"),i=r.readUint8Array(t)):e.warnUnsupported(\"More than 2 GLB chunks detected. Skipping.\"),u+=1}return a||e.error(\"No GLB JSON chunk detected.\"),{json:a,binaryData:i}}async getBuffer(e,t){const r=this.json.buffers[e],n=this.errorContext;if(null==r.uri)return n.assert(null!=this.glbBuffer,\"GLB buffer not present\"),this.glbBuffer;let o=this.bufferCache.get(e);if(!o){const s=await this.context.loadBinary(this.resolveUri(r.uri),t);o=new Uint8Array(s),this.bufferCache.set(e,o),n.assert(o.byteLength===r.byteLength,\"Buffer byte lengths should match.\")}return o}async getAccessor(e,t){const r=this.json.accessors[e],n=this.errorContext;n.errorUnsupportedIf(null==r.bufferView,\"Some accessor does not specify a bufferView.\"),n.errorUnsupportedIf(r.type in[\"MAT2\",\"MAT3\",\"MAT4\"],`AttributeType ${r.type} is not supported`);const o=this.json.bufferViews[r.bufferView],s=await this.getBuffer(o.buffer,t),a=F[r.type],i=k[r.componentType],u=a*i,c=o.byteStride||u;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(o.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===u,componentCount:a,componentByteSize:i,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t){if(null==e.indices)return null;const r=await this.getAccessor(e.indices,t);if(r.isDenselyPacked)switch(r.componentType){case 5121:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case 5123:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case 5125:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case 5121:return L(this.wrapAccessor(b,r));case 5123:return L(this.wrapAccessor(y,r));case 5125:return L(this.wrapAccessor(h,r))}}async getPositionData(e,t){const r=this.errorContext;r.errorUnsupportedIf(null==e.attributes.POSITION,\"No POSITION vertex data found.\");const n=await this.getAccessor(e.attributes.POSITION,t);return r.errorUnsupportedIf(5126!==n.componentType,\"Expected type FLOAT for POSITION vertex attribute, but found \"+q[n.componentType]),r.errorUnsupportedIf(3!==n.componentCount,\"POSITION vertex attribute must have 3 components, but found \"+n.componentCount.toFixed()),this.wrapAccessor(T,n)}async getNormalData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.NORMAL,\"No NORMAL vertex data found.\");const n=await this.getAccessor(e.attributes.NORMAL,t);return r.errorUnsupportedIf(5126!==n.componentType,\"Expected type FLOAT for NORMAL vertex attribute, but found \"+q[n.componentType]),r.errorUnsupportedIf(3!==n.componentCount,\"NORMAL vertex attribute must have 3 components, but found \"+n.componentCount.toFixed()),this.wrapAccessor(T,n)}async getTangentData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TANGENT,\"No TANGENT vertex data found.\");const n=await this.getAccessor(e.attributes.TANGENT,t);return r.errorUnsupportedIf(5126!==n.componentType,\"Expected type FLOAT for TANGENT vertex attribute, but found \"+q[n.componentType]),r.errorUnsupportedIf(4!==n.componentCount,\"TANGENT vertex attribute must have 4 components, but found \"+n.componentCount.toFixed()),new x(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount)}async getTextureCoordinates(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TEXCOORD_0,\"No TEXCOORD_0 vertex data found.\");const n=await this.getAccessor(e.attributes.TEXCOORD_0,t);return r.errorUnsupportedIf(2!==n.componentCount,\"TEXCOORD_0 vertex attribute must have 2 components, but found \"+n.componentCount.toFixed()),5126===n.componentType?this.wrapAccessor(w,n):(r.errorUnsupportedIf(!n.normalized,\"Integer component types are only supported for a normalized accessor for TEXCOORD_0.\"),V(n))}async getVertexColors(e,t){const r=this.errorContext;r.assert(null!=e.attributes.COLOR_0,\"No COLOR_0 vertex data found.\");const n=await this.getAccessor(e.attributes.COLOR_0,t);if(r.errorUnsupportedIf(4!==n.componentCount&&3!==n.componentCount,\"COLOR_0 attribute must have 3 or 4 components, but found \"+n.componentCount.toFixed()),4===n.componentCount){if(5126===n.componentType)return this.wrapAccessor(x,n);if(5121===n.componentType)return this.wrapAccessor(O,n);if(5123===n.componentType)return this.wrapAccessor(C,n)}else if(3===n.componentCount){if(5126===n.componentType)return this.wrapAccessor(T,n);if(5121===n.componentType)return this.wrapAccessor(g,n);if(5123===n.componentType)return this.wrapAccessor(U,n)}r.errorUnsupported(\"Unsupported component type for COLOR_0 attribute: \"+q[n.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,r){const n=this.errorContext;let o=this.materialCache.get(e.material);if(!o){const s=null!=e.material?v(this.json.materials[e.material]):v(),a=s.pbrMetallicRoughness,i=this.hasVertexColors(e);let u,c,p,d,f;a.baseColorTexture&&(n.errorUnsupportedIf(0!==(a.baseColorTexture.texCoord||0),\"Only TEXCOORD with index 0 is supported.\"),u=await this.getTexture(a.baseColorTexture.index,t)),s.normalTexture&&(0!==(s.normalTexture.texCoord||0)?n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the normal map texture.\"):c=await this.getTexture(s.normalTexture.index,t)),s.occlusionTexture&&r&&(0!==(s.occlusionTexture.texCoord||0)?n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the occlusion texture.\"):p=await this.getTexture(s.occlusionTexture.index,t)),s.emissiveTexture&&r&&(0!==(s.emissiveTexture.texCoord||0)?n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the emissive texture.\"):d=await this.getTexture(s.emissiveTexture.index,t)),a.metallicRoughnessTexture&&r&&(0!==(a.metallicRoughnessTexture.texCoord||0)?n.warnUnsupported(\"Only TEXCOORD with index 0 is supported for the metallicRoughness texture.\"):f=await this.getTexture(a.metallicRoughnessTexture.index,t));const l=null!=e.material?e.material:-1;o={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:a.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:u,normalTexture:c,name:s.name,id:l,occlusionTexture:p,emissiveTexture:d,emissiveFactor:s.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:f,vertexColors:i,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode}}return o}async getTexture(e,t){const r=this.errorContext,n=this.json.textures[e],o=B(null!=n.sampler?this.json.samplers[n.sampler]:{});r.errorUnsupportedIf(null==n.source,\"Source is expected to be defined for a texture.\");const s=this.json.images[n.source];let a=this.textureCache.get(e);if(!a){let n;if(s.uri)n=await this.context.loadImage(this.resolveUri(s.uri),t);else{r.errorUnsupportedIf(null==s.bufferView,\"Image bufferView must be defined.\"),r.errorUnsupportedIf(null==s.mimeType,\"Image mimeType must be defined.\");const e=this.json.bufferViews[s.bufferView],o=await this.getBuffer(e.buffer,t);r.errorUnsupportedIf(null!=e.byteStride,\"byteStride not supported for image buffer\"),n=await J(new Uint8Array(o.buffer,o.byteOffset+(e.byteOffset||0),e.byteLength),s.mimeType)}const i=e=>33071===e||33648===e||10497===e,u=e=>(r.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`),10497);a={data:n,wrapS:i(o.wrapS)?o.wrapS:u(o.wrapS),wrapT:i(o.wrapT)?o.wrapT:u(o.wrapT),minFilter:o.minFilter,name:s.name,id:e},this.textureCache.set(e,a)}return a}getNodeTransform(e){if(void 0===e)return _;let t=this.nodeTransformCache.get(e);if(!t){const r=this.getNodeTransform(this.getNodeParent(e)),n=this.json.nodes[e];n.matrix?t=a(d(),r,n.matrix):n.translation||n.rotation||n.scale?(t=f(r),n.translation&&i(t,t,n.translation),n.rotation&&(P[3]=l(P,n.rotation),u(t,t,P[3],P)),n.scale&&c(t,t,n.scale)):t=r,this.nodeTransformCache.set(e,t)}return t}wrapAccessor(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}resolveUri(e){return o(e,this.baseUri)}getNodeParent(e){return this.nodeParentMap.get(e)}checkVersionSupported(){const e=s.parse(this.json.asset.version,\"glTF\");G.validate(e)}checkRequiredExtensionsSupported(){const e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported(\"gltf loader was not able to load unsupported feature. Required extensions: \"+e.extensionsRequired.join(\", \"))}computeNodeParents(){this.json.nodes.forEach(((e,t)=>{e.children&&e.children.forEach((e=>{this.nodeParentMap.set(e,t)}))}))}}const G=new s(2,0,\"glTF\"),_=p(d(),Math.PI/2),P=m(),F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},k={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};function V(t){switch(t.componentType){case 5120:return new R(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5121:return new I(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5122:return new A(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5123:return new S(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5125:return new N(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5126:return new w(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);default:return void e(t.componentType)}}async function X(e){return new Promise(((t,r)=>{const n=new Blob([e]),o=new FileReader;o.onload=()=>{const e=o.result;t(JSON.parse(e))},o.onerror=e=>{r(e)},o.readAsText(n)}))}async function J(e,t){return new Promise(((r,n)=>{const o=new Blob([e],{type:t}),s=URL.createObjectURL(o),a=new Image;a.addEventListener(\"load\",(()=>{URL.revokeObjectURL(s),\"decode\"in a?a.decode().then((()=>r(a)),(()=>r(a))):r(a)})),a.addEventListener(\"error\",(e=>{URL.revokeObjectURL(s),n(e)})),a.src=s}))}const q={5120:\"BYTE\",5121:\"UNSIGNED_BYTE\",5122:\"SHORT\",5123:\"UNSIGNED_SHORT\",5125:\"UNSIGNED_INT\",5126:\"FLOAT\"};export{j as Resource};\n"]},"metadata":{},"sourceType":"module"}