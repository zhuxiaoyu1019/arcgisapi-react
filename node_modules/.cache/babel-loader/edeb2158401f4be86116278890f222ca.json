{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport { debounce as t } from \"../../../core/promiseUtils.js\";\nimport { whenOnce as a } from \"../../../core/watchUtils.js\";\nimport \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport r from \"./DynamicLayerView3D.js\";\nimport { ImageryLayerView as s } from \"../../layers/ImageryLayerView.js\";\nlet o = class extends s(r) {\n  constructor() {\n    super(...arguments), this.type = \"imagery-3d\", this.redrawDebounced = t(async e => {\n      this.redraw((e, t) => this._redrawImage(e, t), e);\n    }, 2e3);\n  }\n\n  initialize() {\n    this.handles.add([a(this.view.basemapTerrain, \"ready\", () => this.initializeMaximumDataResolution()), this.layer.on(\"redraw\", () => this.redrawDebounced())]), this.updatingHandles.add(this.layer, \"exportImageServiceParameters.version\", () => {\n      this.updatingHandles.addPromise(this.refreshDebounced());\n    }), this.updatingHandles.add(this, \"timeExtent\", () => this.updatingHandles.addPromise(this.refreshDebounced()));\n  }\n\n  initializeMaximumDataResolution() {\n    const e = this.view.basemapTerrain.spatialReference,\n          t = this.layer.fullExtent;\n    t && e.equals(t.spatialReference) && (this.maximumDataResolution = {\n      x: this.layer.pixelSizeX,\n      y: this.layer.pixelSizeY\n    });\n  }\n\n  getFetchOptions() {\n    return {\n      timeExtent: this.timeExtent\n    };\n  }\n\n  async processResult(e, t, a) {\n    t.imageElement ? e.image = t.imageElement : (e.image = document.createElement(\"canvas\"), e.pixelData = t.pixelData, await this._redrawImage(e, a));\n  }\n\n  async _redrawImage(e, t) {\n    if (!(e.image instanceof HTMLCanvasElement && e.pixelData)) return Promise.reject();\n    const a = e.image,\n          i = a.getContext(\"2d\"),\n          r = await this.layer.applyRenderer(e.pixelData, {\n      signal: t\n    }),\n          s = this.layer.applyFilter(r),\n          o = s.pixelBlock;\n    a.width = o.width, a.height = o.height;\n    const n = i.createImageData(o.width, o.height);\n    n.data.set(s.pixelBlock.getAsRGBA()), i.putImageData(n, 0, 0);\n  }\n\n};\no = e([i(\"esri.views.3d.layers.ImageryLayerView3D\")], o);\nvar n = o;\nexport default n;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js"],"names":["_","e","debounce","t","whenOnce","a","subclass","i","r","ImageryLayerView","s","o","constructor","arguments","type","redrawDebounced","redraw","_redrawImage","initialize","handles","add","view","basemapTerrain","initializeMaximumDataResolution","layer","on","updatingHandles","addPromise","refreshDebounced","spatialReference","fullExtent","equals","maximumDataResolution","x","pixelSizeX","y","pixelSizeY","getFetchOptions","timeExtent","processResult","imageElement","image","document","createElement","pixelData","HTMLCanvasElement","Promise","reject","getContext","applyRenderer","signal","applyFilter","pixelBlock","width","height","n","createImageData","data","set","getAsRGBA","putImageData"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{debounce as t}from\"../../../core/promiseUtils.js\";import{whenOnce as a}from\"../../../core/watchUtils.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./DynamicLayerView3D.js\";import{ImageryLayerView as s}from\"../../layers/ImageryLayerView.js\";let o=class extends(s(r)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=t((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([a(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement&&e.pixelData))return Promise.reject();const a=e.image,i=a.getContext(\"2d\"),r=await this.layer.applyRenderer(e.pixelData,{signal:t}),s=this.layer.applyFilter(r),o=s.pixelBlock;a.width=o.width,a.height=o.height;const n=i.createImageData(o.width,o.height);n.data.set(s.pixelBlock.getAsRGBA()),i.putImageData(n,0,0)}};o=e([i(\"esri.views.3d.layers.ImageryLayerView3D\")],o);var n=o;export default n;\n"]},"metadata":{},"sourceType":"module"}