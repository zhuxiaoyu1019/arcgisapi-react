{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Color.js\";\nimport i from \"../../../core/Accessor.js\";\nimport { difference as r } from \"../../../core/arrayUtils.js\";\nimport s from \"../../../core/CollectionFlattener.js\";\nimport a from \"../../../core/Evented.js\";\nimport n from \"../../../core/Handles.js\";\nimport l from \"../../../core/Logger.js\";\nimport { clamp as o } from \"../../../core/mathUtils.js\";\nimport { releaseMaybe as h, destroyMaybe as d, unwrapOr as u, isNone as p, isSome as c } from \"../../../core/maybe.js\";\nimport _ from \"../../../core/ObjectPool.js\";\nimport g from \"../../../core/PooledArray.js\";\nimport { isAbortError as m, isAborted as y, createAbortError as v } from \"../../../core/promiseUtils.js\";\nimport { init as f } from \"../../../core/watchUtils.js\";\nimport { aliasOf as T } from \"../../../core/accessorSupport/decorators/aliasOf.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { property as w } from \"../../../core/accessorSupport/decorators/property.js\";\nimport { subclass as S } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { m as x } from \"../../../chunks/mat4.js\";\nimport { c as L } from \"../../../chunks/mat4f64.js\";\nimport { g as C } from \"../../../chunks/vec3.js\";\nimport { c as D } from \"../../../chunks/vec3f64.js\";\nimport { c as P } from \"../../../chunks/vec4f64.js\";\nimport { projectVectorToVector as j, projectPointToVector as U } from \"../../../geometry/projection.js\";\nimport { getReferenceEllipsoid as R } from \"../../../geometry/projectionEllipsoid.js\";\nimport { create as b, equals as M, set as E, containsPoint as O, empty as V, expand as k } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { create as I, copy as q } from \"../../../geometry/support/frustum.js\";\nimport { ElevationQueryTileCache as A } from \"../../../layers/support/ElevationQueryTileCache.js\";\nimport { isBaseLayer as B } from \"../../../layers/support/layerUtils.js\";\nimport { acquireDecoder as F } from \"../../../layers/support/LercDecoder.js\";\nimport { printAllocations as H } from \"../../2d/engine/vectorTiles/VectorTile.js\";\nimport W from \"../layers/ElevationLayerView3D.js\";\nimport { directionToHeadingTilt as N, scaleToZoom as Q } from \"../support/cameraUtils.js\";\nimport G from \"../support/debugFlags.js\";\nimport { toBoundingRect as z } from \"../support/extentUtils.js\";\nimport { updatingProgress as X } from \"../support/updatingProperties.js\";\nimport { ElevationBounds as Y } from \"./ElevationBounds.js\";\nimport { ElevationData as $ } from \"./ElevationData.js\";\nimport { OverlayManager as J } from \"./OverlayManager.js\";\nimport { PlanarPatch as K } from \"./PlanarPatch.js\";\nimport { SphericalPatch as Z } from \"./SphericalPatch.js\";\nimport { create as ee } from \"./SurfaceExtentHelper.js\";\nimport { SurfaceTilingSchemeLogic as te } from \"./SurfaceTilingSchemeLogic.js\";\nimport { DEFAULT_TILE_BACKGROUND as ie, MAX_ROOT_TILES as re, TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR as se, TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR as ae, MAX_MEMORY_LOD_BIAS as ne, LayerClasses as le, ELEVATION_NODATA_VALUE as oe } from \"./TerrainConst.js\";\nimport he from \"./TerrainRenderer.js\";\nimport de from \"./TerrainSurfacePerformanceInfo.js\";\nimport { weakAssert as ue, computeSkirtScale as pe, isSurfaceLayerView as ce, isElevationLayerView as _e, isVectorTileLayerView as ge, useFetchTileForLayer as me, isImageryTileLayerView as ye, isTileLayerView as ve, releaseTileData as fe } from \"./terrainUtils.js\";\nimport Te, { SplitLimits as we } from \"./Tile.js\";\nimport { printAllocations as Se } from \"./TilePerLayerInfo.js\";\nimport { IteratorPreorder as xe, IteratorPostorder as Le, hasLoadableSiblings as Ce, sortTilesByPOI as De, sortTiles as Pe } from \"./tileUtils.js\";\nimport { UpsampleInfo as je } from \"./UpsampleInfo.js\";\nimport { TaskPriority as Ue, noBudget as Re } from \"../../support/Scheduler.js\";\nimport { WatchUpdatingTracking as be } from \"../../support/WatchUpdatingTracking.js\";\nconst Me = l.getLogger(\"esri.views.3d.terrain.TerrainSurface\"),\n      Ee = .25;\nlet Oe = class extends a.EventedMixin(i) {\n  constructor(e) {\n    super(e), this._elevationBounds = new Y(), this._rootExtent = b(), this._iteratorPool = new _(xe, e => e.remove = () => this._iteratorPool.release(e)), this._postorderIterator = new Le(), this._hasPendingUpdates = !1, this._pendingUpdates = 0, this._asyncWorkItems = 0, this._allTilesDirty = !0, this._allTilesSorted = !0, this._visible = !1, this._usedMemory = Be, this._performanceInfo = new de(), this._viewChanged = !1, this._inFrameTask = !1, this._viewChangeUpdateDirty = !1, this._overlayOpacity = 1, this._eyePosRenderSR = D(), this._eyePosSurfaceSR = D(), this._splitLimits = new we(), this._snapLevel = 1 / 0, this._frustum = I(), this._viewProjectionMatrix = L(), this._layerViews = [new Array(), new Array()], this._layerIndexByUid = [new Map(), new Map()], this._basemapLayerViewHandles = new Map(), this._handles = new n(), this._watchUpdatingTracking = new be(), this._allTiles = new g(), this._upsampleInfoPool = new _(je), this._getElevationData = {\n      spatialReference: null,\n      rootTiles: null\n    }, this._maxNumUpdating = 1, this.maxTextureScale = 1.2, this.rootTiles = null, this.backgroundImage = ie, this.backgroundColor = null, this._layerViewsDirty = !1;\n  }\n\n  initialize() {\n    this._lercDecoder = F(this.view.resourceController), this._tilePool = this.view.state.isLocal ? new _(K) : new _(Z);\n    const e = this.view.resourceController.memoryController;\n    this._upsampleMapCache = e.getMemCache(\"esri.views.3d.terrain.upsample\", e => e.unloadMapData()), this._elevationQueryCache = new A(e.getMemCache(\"elevation-query\")), this._set(\"overlayManager\", new J({\n      surface: this\n    })), this._handles.add([this.watch(\"overlayManager.hasHighlights\", e => this._renderer.setNeedsHighlight(e)), this.watch(\"overlayManager.rendersOccluded\", e => this._renderer.setRenderOccludedOverlay(e))], \"overlayManager\"), this._renderer = new he({\n      overlayRenderer: this.overlayManager.renderer,\n      ellipsoidRadius: R(this.view.spatialReference).radius,\n      stage: this.view._stage,\n      updateOverlayOpacity: () => this.updateOverlayOpacity(),\n      allTiles: this._allTiles\n    }), this._handles.add([f(this, \"baseOpacity\", e => {\n      this._handleLayerViewChanges(), this._updateBaseOpacity(e);\n    }, !0), f(this, \"_background\", () => {\n      this._handleLayerViewChanges(), this._renderer.setTileBackground(this._background);\n    }, !0), this.view.watch(\"pointsOfInterest\", e => {\n      this._renderer.pointsOfInterest = e, this._watchUpdatingTracking.removeAll(), e && this._watchUpdatingTracking.add(e.focus, \"renderLocation\", () => () => this._allTilesSorted = !1);\n    }), f(G, \"TERRAIN_TILE_TREE_SHOW_TILES\", e => {\n      e && !this._treeDebugger ? import(\"../layers/support/TerrainTileTree3DDebugger.js\").then(({\n        TerrainTileTree3DDebugger: e\n      }) => {\n        !this._treeDebugger && G.TERRAIN_TILE_TREE_SHOW_TILES && (this._treeDebugger = new e({\n          view: this.view\n        }));\n      }) : e || !this._treeDebugger || G.TERRAIN_TILE_TREE_SHOW_TILES || (this._treeDebugger.destroy(), this._treeDebugger = null);\n    })]);\n    const t = {\n      layers: this.view.map.allLayers,\n      layerViews: this.view.allLayerViews,\n      spatialReference: this.view.spatialReference\n    };\n    this.extentHelper = ee(this.viewingMode, t), this._handles.add(f(this.extentHelper, \"stencilEnabledExtents\", e => this._renderer.setStencilEnabledLayerExtents(e)), \"extentHelper\");\n    const i = this.view.defaultsFromMap ? new s({\n      getCollections: () => {\n        var e, t, i;\n        return null == (e = this.view) || null == (t = e.defaultsFromMap) || null == (i = t.mapCollectionPaths) ? void 0 : i.map(e => this.view.map.get(e));\n      },\n      getChildrenFunction: e => e && \"layers\" in e ? e.layers : null\n    }) : this.view.map.allLayers,\n          r = new te({\n      layers: i,\n      extentHelper: this.extentHelper,\n      viewingMode: this.viewingMode,\n      viewSpatialReference: this.view.spatialReference\n    });\n    this._set(\"tilingSchemeLogic\", r), this._handles.add([this.tilingSchemeLogic.watch(\"tilingScheme\", () => this._updateTilingSchemeAndExtent(), !0), this.tilingSchemeLogic.watch(\"extent\", () => this._updateTilingSchemeAndExtent(), !0)], \"tilingSchemeLogic\"), this._updateTilingSchemeAndExtent(), this._elevationDataRequester = this.view.resourceController.createStreamDataRequester(0), this._mapDataRequester = this.view.resourceController.createStreamDataRequester(1);\n    const a = this.view.resourceController.scheduler;\n    this._frameTask = a.registerTask(Ue.TERRAIN_SURFACE, this), this.view.resourceController.memoryController.events.on(\"quality-changed\", () => this._viewChangeUpdate()), this._handles.add([this.view.on(\"resize\", () => this._viewChangeUpdate()), this.view.watch(\"state.camera\", () => this._viewChangeUpdate(), !0), this.view.watch(\"state.contentCamera\", () => this.view.state.fixedContentCamera && this._viewChangeUpdate(), !0), this.view.watch(\"qualitySettings.tiledSurface.lodBias\", () => this._viewChangeUpdate()), f(this.view, \"qualitySettings.tiledSurface.textureFadeDuration\", e => this._renderer.textureFadingEnabled = e > 0), this.view.watch(\"lodSnapping\", () => this._viewChangeUpdate()), this.view.watch(\"clippingArea\", () => this._clippingChanged())]), this._handles.add(this.view.allLayerViews.on(\"after-changes\", () => this._layerViewsDirty = !0)), this._layerViewsDirty = !0, this._handleLayerViewChanges(), this._updateClippingExtent(), this.notifyChange(\"extent\");\n  }\n\n  destroy() {\n    this._frameTask.remove(), this._handles.destroy(), this._watchUpdatingTracking.destroy(), this._lercDecoder = h(this._lercDecoder), this._removeAllTiles(), this._upsampleMapCache = d(this._upsampleMapCache), this._elevationQueryCache = d(this._elevationQueryCache), this._set(\"tilingSchemeLogic\", d(this.tilingSchemeLogic)), this.extentHelper = d(this.extentHelper), this._basemapLayerViewHandles.forEach((e, t) => this._unregisterTiledLayerView(t)), this._elevationDataRequester = null, this._mapDataRequester = null, this._set(\"overlayManager\", d(this.overlayManager)), this._tilePool = d(this._tilePool), Te.prune(), this._treeDebugger && (this._treeDebugger.destroy(), this._treeDebugger = null), this._renderer = d(this._renderer), this._iteratorPool = d(this._iteratorPool), this._set(\"view\", null), this._upsampleInfoPool = d(this._upsampleInfoPool), H(), Se();\n  }\n\n  get renderer() {\n    return this._renderer;\n  }\n\n  get frustum() {\n    return this._frustum;\n  }\n\n  get snapLevel() {\n    var e, t;\n    const i = null == (e = this.view.pointsOfInterest) || null == (t = e.contentCameraOnSurface) ? void 0 : t.scale;\n\n    if (i) {\n      const e = this.view.state.contentCamera;\n      let t = N(this.view, e.eye, e.viewForward, e.up).tilt;\n      t > 90 && (t = 180 - t);\n      const r = 2 * (t / 90) ** 2,\n            s = Q(this.view, i) - r;\n      Math.abs(this._snapLevel - s) > Ee && (Math.round(s) !== Math.round(this._snapLevel) && (this._viewChanged = !0), this._snapLevel = s);\n    }\n\n    return Math.round(this._snapLevel);\n  }\n\n  get lodSnapping() {\n    return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences ? 1 : 0;\n  }\n\n  get upsampleInfoPool() {\n    return this._upsampleInfoPool;\n  }\n\n  get upsampleMapCache() {\n    return this._upsampleMapCache;\n  }\n\n  get elevationQueryCache() {\n    return this._elevationQueryCache;\n  }\n\n  get mapTileRequester() {\n    return this._mapDataRequester;\n  }\n\n  get extent() {\n    return u(this._clippingExtent, this._rootExtent);\n  }\n\n  get updating() {\n    return this._hasPendingUpdates || (this._maxNumUpdating = 1), !!((this._watchUpdatingTracking.updating || this._hasPendingUpdates || this._viewChanged || this._allTilesDirty || this._asyncWorkItems > 0 || !this._allTilesSorted || this._renderer.updating || this._layerViewsDirty) && this.ready && !this.suspended || this.overlayManager.updating || this._frameTask.updating);\n  }\n\n  get updatingProgressValue() {\n    return this._maxNumUpdating = Math.max(this._pendingUpdates, this._maxNumUpdating), 1 - this._pendingUpdates / this._maxNumUpdating;\n  }\n\n  get viewingMode() {\n    return this.view.state.viewingMode;\n  }\n\n  get ready() {\n    return !!this.rootTiles;\n  }\n\n  set renderOrder(e) {\n    this._renderer.renderOrder = e, this._set(\"renderOrder\", e);\n  }\n\n  set skirtScale(e) {\n    this._renderer.skirtScale = e;\n  }\n\n  get skirtScale() {\n    return this._renderer.skirtScale;\n  }\n\n  get spatialReference() {\n    var e, t;\n    return null != (e = null == (t = this.tilingScheme) ? void 0 : t.spatialReference) ? e : null;\n  }\n\n  get _background() {\n    return null != this.backgroundColor ? this.backgroundColor : this.backgroundImage;\n  }\n\n  set slicePlaneEnabled(e) {\n    var t, i;\n    this._renderer.slicePlane = e, this._set(\"slicePlaneEnabled\", e), null == (t = this.view) || null == (i = t._stage) || i.renderView.setRenderParameters({\n      opaqueTerrain: this.opaque\n    });\n  }\n\n  set velvetOverground(e) {\n    e !== this.velvetOverground && (this._renderer.velvetOverground = e), this._set(\"velvetOverground\", e);\n  }\n\n  set visible(e) {\n    e !== this._visible && (this._visible = e, this._renderer.setVisibility(e), this.suspended = !e);\n  }\n\n  get opaque() {\n    return this._renderer.opaque;\n  }\n\n  set suspended(e) {\n    this._set(\"suspended\", e), this._viewChangeUpdate();\n  }\n\n  intersect(e, t, i, r) {\n    this._renderer.intersect(e, t, i, r);\n  }\n\n  getElevation(e, t, i, r) {\n    const s = Fe,\n          a = this.getTileWithElevation(e, t, i, r, s);\n    return p(a) ? null : $.sample(s[0], s[1], a.renderData.geometryState.samplerData);\n  }\n\n  getTileWithElevation(e, t, i, r, s = Fe) {\n    const a = this._getElevationData.rootTiles;\n    if (!a || !a.length) return null;\n    if (0 === a[0].layerInfo[0].length) return null;\n    if (s[0] = e, s[1] = t, s[2] = i, !j(s, r, s, this._getElevationData.spatialReference)) return Me.error(\"TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system\"), null;\n\n    for (let n of a) {\n      if (!n.containsPoint(s)) continue;\n\n      for (; n && !n.rendered && !n.isLeaf;) {\n        let e = 0;\n        s[0] > .5 * (n.extent[0] + n.extent[2]) && (e += 1), s[1] < .5 * (n.extent[1] + n.extent[3]) && (e += 2), n = n.children[e];\n      }\n\n      const e = n.renderData;\n      return (e && e.geometryState ? e.geometryState.samplerData : null) ? n : null;\n    }\n\n    return null;\n  }\n\n  get elevationBounds() {\n    return this._elevationBounds;\n  }\n\n  getScale(e) {\n    if (this.tilingScheme) {\n      if (!U(e, Fe, this.spatialReference)) return Me.error(\"TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system\"), null;\n      const t = this.rootTiles;\n      if (t) for (let e of t) if (e.containsPoint(Fe)) {\n        for (; null != e.children[0];) {\n          let t = 0;\n          Fe[0] > e.children[0].extent[2] && (t += 1), Fe[1] < e.children[0].extent[1] && (t += 2), e = e.children[t];\n        }\n\n        return this._getLodBiasCorrectedScale(e.level);\n      }\n    }\n\n    return 1e100;\n  }\n\n  queryVisibleScaleRange(e, t, i, r) {\n    const s = t ? this.tilingScheme.levelAtScale(t) : 0,\n          a = i ? this.tilingScheme.levelAtScale(i) : 1 / 0,\n          n = this.lodBias;\n\n    this._renderer.queryVisibleLevelRange(e, s + n, a + n, r);\n  }\n\n  _updateBaseOpacity(e) {\n    const t = this._renderer.opaque;\n    this._renderer.opaque = e >= 1, this._renderer.isTransparent = this._allTransparentSurfaceLayers();\n    const i = t !== this._renderer.opaque;\n    var r, s;\n    i && (null == (r = this.view) || null == (s = r._stage) || s.renderView.setRenderParameters({\n      opaqueTerrain: this.opaque\n    }));\n\n    this._updateTileTextures(i);\n  }\n\n  _updateTilingSchemeAndExtent() {\n    const e = this.tilingSchemeLogic.extent,\n          t = e && !M(e, this._dataExtent);\n    t && (c(this._dataExtent) ? E(this._dataExtent, e) : this._dataExtent = b(e));\n    const i = this.tilingSchemeLogic.tilingScheme,\n          r = i !== this.tilingScheme;\n    var s;\n    r && (ue(!!i, \"tiling scheme cannot be reset to undefined\"), this.tilingScheme && this._removeAllTiles(), this._set(\"tilingScheme\", i), this._updateClippingExtent(), i && (this._updateTiledLayers(), this._renderer.setTileSize(i.pixelSize), this.overlayManager.setSpatialReference(i.spatialReference)), this._getElevationData.spatialReference = null != (s = null == i ? void 0 : i.spatialReference) ? s : null);\n    (t || r) && this._updateRootTiles();\n  }\n\n  _acquireTile(e, t, i, r) {\n    const s = this._tilePool.acquire();\n\n    return We[0] = e, We[1] = t, We[2] = i, s.init(We, r, this), s;\n  }\n\n  _updateRootTiles() {\n    const e = this._clippingExtent || this._dataExtent,\n          t = this.tilingScheme;\n    if (p(e) || !t) return;\n    const i = He;\n    let s = t.rootTilesInExtent(e, i, 5 * re);\n\n    const a = e => {\n      const t = this._acquireTile(0, e[1], e[2], null);\n\n      return 2 === t.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.lodSnapping) && t.setPendingUpdate(2), this._loadTile(t), t;\n    };\n\n    if (this.rootTiles) {\n      if (s.length > re) return void Me.warn(se);\n      const e = this.rootTiles.map(e => e.lij),\n            t = r(e, s, ke);\n\n      if (t.removed.length > 0 || t.added.length > 0) {\n        const e = this.rootTiles.filter(e => !(t.removed.findIndex(ke.bind(null, e.lij)) > -1) || (this._purgeTile(e), !1));\n        t.added.forEach(t => e.push(a(t))), this._setRootTiles(e);\n      }\n    } else s.length > re && (Me.warn(ae), s = t.rootTilesInExtent(e, i, re)), this._setRootTiles(s.map(e => a(e)));\n\n    M(i, this._rootExtent) || (this._rootExtent = b(i), this._hasFixedExtent() || this.notifyChange(\"extent\")), this.visible = !0, this._viewChangeUpdate(), this.overlayManager.setOverlayPlacementDirty(), this.notifyChange(\"ready\");\n  }\n\n  _setRootTiles(e) {\n    if (this._set(\"rootTiles\", e), this._allTiles.clear(), e) {\n      const t = this._iteratorPool.acquire();\n\n      for (t.reset(e); !t.done;) this._allTiles.push(t.next());\n\n      t.remove();\n    }\n\n    this._getElevationData.rootTiles = e, this._renderer.setRootTiles(this.rootTiles), this._updateTileVisibility(e);\n  }\n\n  _runViewChangeUpdateIfDirty() {\n    this._viewChangeUpdateDirty && (this._viewChangeUpdateDirty = !1, this._viewChangeUpdate());\n  }\n\n  _viewChangeUpdate() {\n    this.view && !this.suspended && this.tilingScheme && this._visible && (this._inFrameTask ? this._viewChangeUpdateDirty = !0 : (this._viewChangeUpdateDirty = !1, this._updateViewDependentParameters(), this._updateSkirts(), this.updateOverlayOpacity(), this._updateTileVisibility(this.rootTiles)));\n  }\n\n  _updateClippingStatus(e) {\n    e.updateClippingStatus(this._clippingExtent) && e.resetPendingUpdate(32) && this._updateTileGeometry(e);\n  }\n\n  _updateTileVisibility(e) {\n    if (!e) return;\n\n    const t = this._iteratorPool.acquire();\n\n    t.reset(e);\n    const i = Ce(e);\n    let r = i ? this._elevationBounds.min : 1 / 0,\n        s = i ? this._elevationBounds.max : -1 / 0;\n\n    for (; !t.done;) {\n      const e = t.next();\n      this._updateClippingStatus(e), e.updateVisibility(), e.setPendingUpdate(16), e.loadable ? (e.updateScreenDepth(this._viewProjectionMatrix), e.renderData && (r = Math.min(e.elevationBounds[0], r), s = Math.max(e.elevationBounds[1], s))) : t.skipSubtree();\n    }\n\n    t.remove(), this._viewChanged = !0, this._allTilesDirty = !0, isFinite(r) && isFinite(s) && (this._elevationBounds.min === r && this._elevationBounds.max === s || (this._elevationBounds.min = r, this._elevationBounds.max = s, this.emit(\"elevation-bounds-change\", null)));\n  }\n\n  _updateViewDependentParameters() {\n    const e = this.view.state.camera,\n          t = this.view.state.contentCamera,\n          i = Math.tan(.5 * t.fovX),\n          r = Math.tan(.5 * t.fovY),\n          s = this.tilingScheme.pixelSize,\n          a = 2 ** -this.lodBias * e.pixelRatio;\n    this._splitLimits.aboveGround = e.aboveGround, this._splitLimits.fovX = i, this._splitLimits.fovY = r, this._splitLimits.relativeWidthLimit = s / e.width * this.maxTextureScale * a, this._splitLimits.relativeHeightLimit = s / e.height * this.maxTextureScale * a, this._splitLimits.maxLod = this.tilingScheme.getMaxLod(), this._splitLimits.angledSplitBias = this.view.qualitySettings.tiledSurface.angledSplitBias, this.view.state.fixedContentCamera ? (p(this._splitLimits.frustum) && (this._splitLimits.frustum = I()), q(t.frustum, this._splitLimits.frustum)) : this._splitLimits.frustum = null, q(e.frustum, this._frustum), x(this._viewProjectionMatrix, t.projectionMatrix, t.viewMatrix), C(this._eyePosRenderSR, t.eye), j(e.eye, this.view.renderSpatialReference, this._eyePosSurfaceSR, this.spatialReference);\n  }\n\n  _updateSkirts() {\n    const e = this.view.state.camera,\n          t = this.view.state.constraints.collision.enabled ? 0 : 1.11 * e.near;\n    this.skirtScale = pe(this, this._eyePosSurfaceSR, t);\n  }\n\n  _updateRenderData(e) {\n    e.rendered && !e.shouldLoad && (qe(e) ? this._loadChildren(e) : Ae(e) && this._loadParent(e));\n  }\n\n  _updateTileGeometry(e) {\n    e.updateVisibility(), this._renderer.updateTileGeometry(e), this._elevationUpdate(e), this._usedMemory = Be;\n  }\n\n  _elevationUpdate(e) {\n    Qe.spatialReference = this.spatialReference, Qe.tile = e, Qe.extent = e.extent, this.emit(\"elevation-change\", Qe), O(e.extent, this._eyePosSurfaceSR) && this._updateSkirts();\n  }\n\n  get running() {\n    return this.updating && this.ready && !this.suspended;\n  }\n\n  runTask(e) {\n    this._handleLayerViewChanges(e), this._frameTask.processQueue(e), this._inFrameTask = !0, this._pendingUpdates = 0, this._hasPendingUpdates = !1, this._updateTileStatus(e), this._sortTiles(e);\n    const t = !this.view.state.fixedContentCamera;\n    this._mergeAndSplit(e, t), e.run(() => this._updateElevation(e)), e.run(() => this._updateTextures(e)), t || this._mergeAndSplit(e, !0), this._inFrameTask = !1, this._runViewChangeUpdateIfDirty(), e.done && this.requestUpdate(), this.notifyChange(\"updatingProgressValue\");\n  }\n\n  _updateTileStatus(e) {\n    if (!this._viewChanged || !this.rootTiles || e.done) return;\n    this._viewChanged = !1;\n\n    const t = this._iteratorPool.acquire();\n\n    for (t.reset(this.rootTiles); !t.done;) {\n      const e = t.next();\n\n      if (e.loadable) {\n        const i = e.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.lodSnapping);\n\n        if (2 === i) {\n          e.resetPendingUpdate(8), e.isLeaf && (e.setPendingUpdate(2), t.skipSubtree());\n          continue;\n        }\n\n        e.resetPendingUpdate(2) && e.updateAgentSuspension(), 4 === i && e.updateAgents(0);\n      }\n\n      if (t.skipSubtree(), !e.isLeaf) {\n        e.setPendingUpdate(8), e.resetPendingUpdate(2);\n\n        const t = this._iteratorPool.acquire();\n\n        t.resetOne(e);\n\n        for (let e = t.next(); !t.done; e = t.next()) this._updateClippingStatus(e), e.updateVisibility(), e.loadable && e.updateScreenDepth(this._viewProjectionMatrix);\n\n        t.remove();\n      }\n    }\n\n    t.remove(), this.requestUpdate(), e.madeProgress();\n  }\n\n  _sortTiles(e) {\n    e.done || this._allTilesSorted || (De(this._allTiles, this.view.pointsOfInterest.focus.renderLocation), this._allTilesSorted = !0, this._treeDebugger && this._treeDebugger.update(), e.madeProgress());\n  }\n\n  _mergeAndSplit(e, t) {\n    if (this.suspended || !this._allTilesDirty || e.done) return;\n    this._allTilesDirty = !1, this.requestUpdate();\n    let i = 0;\n\n    for (; !e.done;) {\n      let r = !1;\n      i = 0;\n      const s = !this._allTiles.some(s => {\n        if (i += s.usedMemory, s.resetPendingUpdate(8)) {\n          if (!t) return s.setPendingUpdate(8), e.done;\n          this._mergeTile(s), r = !0, e.madeProgress();\n        } else s.resetPendingUpdate(2) && (this._splitTile(s), r = !0, e.madeProgress());\n\n        return s.resetPendingUpdate(16) && (this._updateRenderData(s), e.madeProgress()), e.done;\n      });\n\n      if (r && (this._allTilesSorted = !1, this._allTilesDirty = !0), s) {\n        if (this._usedMemory = i, !r) break;\n      } else this._allTilesDirty = !0;\n    }\n\n    0 === i && (this._allTilesDirty = !0), this._sortTiles(e);\n  }\n\n  _updateElevation(e) {\n    return this._allTiles.some(t => (t.resetPendingUpdate(32) && (this._updateTileGeometry(t), t.resetPendingUpdate(64) && (this._renderer.updateTileTexture(t), this._usedMemory = Be), e.madeProgress()), e.done)), e.hasProgressed;\n  }\n\n  _updateTextures(e) {\n    return this._allTiles.some(t => (t.resetPendingUpdate(64) && (this._renderer.updateTileTexture(t), this._usedMemory = Be, e.madeProgress()), e.done)), e.hasProgressed;\n  }\n\n  _updateClippingExtent() {\n    if (!this.spatialReference) return !1;\n    const e = b();\n    let t = null;\n    return z(this.view.clippingArea, e, this.spatialReference) && (t = e), !M(t, this._clippingExtent) && (this._clippingExtent = t, this._renderer.clippingExtent = t, this.notifyChange(\"extent\"), this.updateTileOverlayParams(), this.overlayManager.setOverlayPlacementDirty(), !0);\n  }\n\n  _clippingChanged() {\n    this._updateClippingExtent() && this._updateRootTiles();\n  }\n\n  get lodBias() {\n    const e = this.view.resourceController.memoryController.memoryFactor;\n    return this.view.qualitySettings.tiledSurface.lodBias - (1 - e) * ne;\n  }\n\n  _getLodBiasCorrectedScale(e) {\n    const t = this.tilingScheme.levels,\n          i = o(e - this.lodBias, 0, t.length - 1),\n          r = i - Math.floor(i);\n    return t[Math.floor(i)].scale * (1 - r) + t[Math.ceil(i)].scale * r;\n  }\n\n  _removeAllTiles() {\n    this.rootTiles && (this.rootTiles.forEach(e => this._purgeTile(e)), this._setRootTiles(null), this.notifyChange(\"ready\")), this._allTiles.clear(), this.visible = !1;\n  }\n\n  _purgeChildTiles(e) {\n    if (e.isLeaf) return !1;\n\n    let t = this._purgeTile(e.children[0]);\n\n    return t = this._purgeTile(e.children[1]) || t, t = this._purgeTile(e.children[2]) || t, t = this._purgeTile(e.children[3]) || t, e.unsetChildren(), t;\n  }\n\n  _purgeTile(e) {\n    const t = this._purgeChildTiles(e) || e.rendered;\n    return this._allTiles.removeUnordered(e), e.unload(this._renderer), this._tilePool.release(e), t;\n  }\n\n  _splitTile(e) {\n    ue(e.isLeaf, \"tile that is already split should not be split again!\");\n    const t = e.level + 1,\n          i = 2 * e.lij[1],\n          r = 2 * e.lij[2];\n    e.setChildren(this._createTile(t, i, r, e), this._createTile(t, i, r + 1, e), this._createTile(t, i + 1, r, e), this._createTile(t, i + 1, r + 1, e)), e.setPendingUpdate(16), e.updateAgentSuspension(), this._allTiles.pushArray(e.children), this._allTilesDirty = !0, this._emitTileScaleChange(e, t), ++this._performanceInfo.numSplit;\n  }\n\n  _emitTileScaleChange(e, t = e.level) {\n    Ge.spatialReference = this.spatialReference, Ge.extent = e.extent, Ge.scale = this._getLodBiasCorrectedScale(t), this.emit(\"scale-change\", Ge);\n  }\n\n  _createTile(e, t, i, r) {\n    ue(!!r, \"_createTile sanity check\");\n\n    const s = this._acquireTile(e, t, i, r);\n\n    return s.updateClippingStatus(this._clippingExtent), s.loadable && (s.updateScreenDepth(this._viewProjectionMatrix), 2 === s.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.lodSnapping) && s.setPendingUpdate(2)), s;\n  }\n\n  _mergeTile(e) {\n    ue(!e.hasPendingUpdate(2), \"_mergeTile sanity check\"), this._purgeChildTiles(e) && (ue(!e.renderData, \"_mergeTile sanity check\"), this._loadTile(e)), this._allTilesDirty = !0, ++this._performanceInfo.numMerged, this._emitTileScaleChange(e);\n  }\n\n  _loadChildren(e) {\n    ue(e.rendered, \"parent should be rendered\"), e.unload(this._renderer), this._loadTile(e.children[0]), this._loadTile(e.children[1]), this._loadTile(e.children[2]), this._loadTile(e.children[3]);\n  }\n\n  _loadParent(e) {\n    const t = e.parent;\n    this._unloadChildren(t), this._loadTile(t);\n  }\n\n  _unloadChildren(e) {\n    e.isLeaf || (this._unloadChildren(e.children[0]), e.children[0].unload(this._renderer), this._unloadChildren(e.children[1]), e.children[1].unload(this._renderer), this._unloadChildren(e.children[2]), e.children[2].unload(this._renderer), this._unloadChildren(e.children[3]), e.children[3].unload(this._renderer));\n  }\n\n  _loadTile(e) {\n    e.load(this._renderer), e.setPendingUpdate(16), this.requestUpdate(), this.overlayManager && this.overlayManager.hasOverlays && this.overlayManager.setTileParameters(e), this._elevationUpdate(e);\n  }\n\n  _elevationDataArrived(e, t, i) {\n    const r = new $(e.lij, e.extent, i);\n    e.dataArrived(t, 0, r);\n\n    const s = [e],\n          a = e.level,\n          n = this._iteratorPool.acquire();\n\n    for (n.reset(s); !n.done;) {\n      const e = n.next();\n      e.findElevationBoundsForLayer(t, a), e.computeElevationBounds();\n    }\n\n    n.remove(), this._updateTileVisibility(s);\n  }\n\n  _handleLayerViewChanges(e = Re) {\n    if (!this._layerViewsDirty) return;\n    this._layerViewsDirty = !1;\n    let t = !1;\n    const i = new Set();\n    let r = -1;\n\n    for (const s of this.view.allLayerViews.items) if (i.add(s.uid), ce(s)) if (this._basemapLayerViewHandles.has(s.uid)) {\n      const e = this.layerClassFromLayerView(s),\n            i = this._layerIndexByUid[e].get(s.uid);\n\n      i < r && (t = !0), r = i;\n    } else this._registerTiledLayerView(s), s.layer.loaded && (t = !0);\n\n    this._basemapLayerViewHandles.forEach((e, r) => {\n      i.has(r) || (this._unregisterTiledLayerView(r), t = !0);\n    }), t && this._updateTiledLayers(), this._renderer.isTransparent = this._allTransparentSurfaceLayers(), e.madeProgress();\n  }\n\n  _allTransparentSurfaceLayers() {\n    let e = 0 === this.view.map.ground.opacity;\n\n    for (const t of this.view.allLayerViews.items) if (ce(t) && !_e(t) && !B(t.layer) && 0 !== t.fullOpacity) return e = !1, e;\n\n    return e;\n  }\n\n  layerClassFromLayerView(e) {\n    return _e(e) ? 0 : 1;\n  }\n\n  _registerTiledLayerView(e) {\n    const t = [],\n          i = this.layerClassFromLayerView(e);\n    t.push(e.watch(\"suspended\", () => this._updateTiledLayers())), t.push(e.watch(\"fullOpacity\", () => this._updateTileTextures(!1))), t.push(e.layer.watch(\"scaleRangeId\", () => this._restartAllAgents(i))), e.on(\"data-changed\", () => {\n      const t = this._layerIndexByUid[i].get(e.uid);\n\n      null != t && this._invalidateLayerData(t, i);\n    }), this._basemapLayerViewHandles.set(e.uid, t);\n  }\n\n  _unregisterTiledLayerView(e) {\n    const t = this._basemapLayerViewHandles.get(e);\n\n    if (t) {\n      for (let e = 0; e < t.length; e++) t[e].remove();\n\n      this._basemapLayerViewHandles.delete(e);\n    }\n  }\n\n  _updateTiledLayers() {\n    if (!this.tilingScheme || this.view.suspended) return;\n    const e = this.view.allLayerViews,\n          t = [[], []];\n    let i = null;\n    const r = V();\n    e.forEach(e => {\n      const s = e.layer;\n      if (!s || e.suspended || !ce(e)) return;\n      const a = e.fullExtent;\n      if (!a) return void Me.warn(\"Terrain: Map or elevation layer does not have fullExtent: \" + s.id);\n      if (!this.tilingScheme.compatibleWith(e.tileInfo)) return void Me.warn(\"Terrain: tiling scheme of layer \" + s.id + \" is incompatible with other tiled layers, will not be drawn\");\n      k(r, a);\n      const n = this.layerClassFromLayerView(e);\n\n      if (1 === n) {\n        const t = e.displayLevelRange;\n        t.maxLevel !== 1 / 0 && (null === i || t.maxLevel > i) && (i = t.maxLevel);\n      }\n\n      t[n].push(e);\n    });\n\n    for (const s of le) {\n      const e = this._layerViews[s],\n            i = t[s];\n      i.reverse();\n      const r = i.length;\n      let a = e.length !== r;\n      const n = new Array(r),\n            l = new Array(e.length);\n\n      this._layerIndexByUid[s].clear();\n\n      for (let t = 0; t < r; t++) {\n        const r = i[t].uid;\n\n        this._layerIndexByUid[s].set(r, t);\n\n        const o = e.indexOf(i[t]);\n        n[t] = o, t !== o && (a = !0), o > -1 && (l[o] = t);\n      }\n\n      if (a) {\n        const e = this._postorderIterator;\n\n        for (e.reset(this.rootTiles); !e.done;) e.next().modifyLayers(l, n, s);\n\n        this._layerViews[s] = i, this._restartAllAgents(s), this._updateTileVisibility(this.rootTiles);\n      }\n    }\n\n    this.tilingScheme.ensureMaxLod(i) && this._viewChangeUpdate();\n  }\n\n  _restartAllAgents(e) {\n    const t = this._postorderIterator;\n\n    for (t.reset(this.rootTiles); !t.done;) {\n      const i = t.next();\n      i.restartAgents(e), 0 === e && i.computeElevationBounds();\n    }\n  }\n\n  _hasFixedExtent() {\n    return !!this._clippingExtent;\n  }\n\n  layerViewByIndex(e, t) {\n    return this._layerViews[t][e];\n  }\n\n  numLayers(e) {\n    return this._layerViews[e].length;\n  }\n\n  _updateTileTextures(e) {\n    this._allTiles.forAll(t => {\n      t.updateAgents(1), e ? this.renderer.updateTileTexture(t) : t.updateRenderData(1);\n    }), this._renderer.isTransparent = this._allTransparentSurfaceLayers();\n  }\n\n  _invalidateLayerData(e, t) {\n    this._allTiles.forAll(i => i.removeLayerAgent(e, t)), this._allTiles.forAll(i => i.invalidateLayerData(e, t));\n  }\n\n  setTileTreeDirty() {\n    this._allTilesDirty = !0;\n  }\n\n  requestRender(e = 1) {\n    this.renderer.setNeedsRender(e);\n  }\n\n  requestUpdate() {\n    1 == ++this._pendingUpdates && (this._hasPendingUpdates = !0);\n  }\n\n  requestTileData(e, t, i, r) {\n    const s = this.layerViewByIndex(t, i),\n          a = s.layer;\n    return !a.tilemapCache || ge(s) ? this._requestTileData(e, i, s, r) : (++this._asyncWorkItems, a.tilemapCache.fetchAvailability(e.lij[0], e.lij[1], e.lij[2], { ...r,\n      timeout: 6e3\n    }).then(() => --this._asyncWorkItems).catch(t => {\n      throw --this._asyncWorkItems, m(t) || this._dataMissing(e, i, s, {\n        notInTilemap: !0\n      }), t;\n    }).then(() => this._frameTask.schedule(() => this._requestTileData(e, i, s, r), r.signal)));\n  }\n\n  _requestTileData(e, t, i, r) {\n    return 0 === t ? this._requestElevationTileData(e, i, r) : this._requestMapTileData(e, i, r);\n  }\n\n  _requestElevationTileData(e, t, i) {\n    if (!_e(t)) return void ue(!1, \"_requestElevationTileData can only be called for elevation layer views\");\n\n    const r = r => {\n      if (--this._asyncWorkItems, y(i)) return;\n\n      const s = this._layerIndexByUid[0].get(t.uid);\n\n      null != s ? (this._usedMemory = Be, this.requestUpdate(), this._elevationDataArrived(e, s, r)) : Me.warn(\"TerrainSurface: received data from unknown layer %d %s\", 0, e.lij.toString());\n    },\n          s = i => {\n      --this._asyncWorkItems, m(i) || (this._dataMissing(e, 0, t, i), this.requestUpdate());\n    };\n\n    if (++this._asyncWorkItems, me(t.layer)) return t.layer.fetchTile(e.lij[0], e.lij[1], e.lij[2], {\n      noDataValue: oe,\n      signal: i.signal\n    }).then(e => {\n      if (y(i)) return Me.warnOnce(\"A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.\"), void s(v());\n\n      this._frameTask.schedule(() => r(e), i.signal);\n    }, s);\n    const a = t.getTileUrl(e.lij[0], e.lij[1], e.lij[2]);\n    return this._elevationDataRequester.request(a, \"binary\", i).then(e => this._lercDecoder.decode(e, {\n      noDataValue: oe\n    }, i.signal)).then(e => {\n      r({\n        values: e.pixelData,\n        width: e.width,\n        height: e.height,\n        noDataValue: e.noDataValue,\n        minValue: e.minValue,\n        maxValue: e.maxValue\n      });\n    }, s);\n  }\n\n  _requestMapTileData(e, t, i) {\n    if (t instanceof W) return Promise.reject();\n    ++this._asyncWorkItems;\n\n    const r = (r, s) => {\n      --this._asyncWorkItems, fe(s), y(i) || (this._dataMissing(e, 1, t, r), this.requestUpdate());\n    },\n          s = e => t => r(t, e),\n          a = r => this._frameTask.schedule(() => {\n      --this._asyncWorkItems, this.requestUpdate(), y(i) ? fe(r) : this._mapTileDataArrived(e, t, r);\n    }, i.signal, s(r)).catch(s(r)),\n          n = (e, t = null) => this._frameTask.schedule(() => r(e, t)).catch(s(t));\n\n    if (ge(t)) {\n      const r = t.schemaHelper.getLevelRowColumn(e.lij);\n      return t.fetchTile(r[0], r[1], r[2], i).then(a, n);\n    }\n\n    if (ye(t)) return t.fetchTile(e.lij[0], e.lij[1], e.lij[2], i).then(a, n);\n    if (ve(t) && me(t.layer)) return t.layer.fetchTile(e.lij[0], e.lij[1], e.lij[2], i).then(e => {\n      if (y(i)) return Me.warnOnce(\"A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.\"), void n(v());\n      a(e);\n    }, n);\n    let l = t.getTileUrl(e.lij[0], e.lij[1], e.lij[2]);\n    Ie(t) && t.refreshTimestamp && (l += `${l.indexOf(\"?\") > -1 ? \"&\" : \"?\"}_ts=${t.refreshTimestamp}`);\n    const o = t.hasMixedImageFormats ? \"image+type\" : \"image\";\n    return this._mapDataRequester.request(l, o, i).then(a, n);\n  }\n\n  _mapTileDataArrived(e, t, i) {\n    const r = this._layerIndexByUid[1].get(t.uid);\n\n    null != r ? e.dataArrived(r, 1, i) : (fe(i), Me.warn(\"TerrainSurface: received data from unknown layer\"));\n  }\n\n  _dataMissing(e, t, i, r) {\n    const s = this._layerIndexByUid[t].get(i.uid);\n\n    null != s ? e.dataMissing(s, t, r) : Me.warn(\"TerrainSurface: received data from unknown layer\");\n  }\n\n  updateTileOverlayParams() {\n    this.rootTiles && this.overlayManager && (this._allTiles.forAll(e => {\n      e.renderData && this.overlayManager.setTileParameters(e);\n    }), this._renderer.setNeedsRender());\n  }\n\n  updateOverlayOpacity() {\n    if (!this.overlayManager) return;\n    const e = this._eyePosSurfaceSR[2],\n          t = this.overlayManager.computeOpacity(e);\n    this._overlayOpacity !== t && (this._overlayOpacity = t, this._renderer.overlayOpacity = t, this._renderer.setNeedsRender());\n  }\n\n  get performanceInfo() {\n    const e = this._performanceInfo;\n    return e.numNodes = this._allTiles.length, e.numLeaves = e.numVisible = e.numRendered = e.numLoadedPerLevel.length = e.numRenderedPerLevel.length = 0, this._allTiles.forAll(t => {\n      t.isLeaf && e.numLeaves++;\n      const i = t.level;\n      t.renderData && (e.numLoadedPerLevel[i] = (e.numLoadedPerLevel[i] || 0) + 1), t.visible && (e.numVisible++, t.rendered && (e.numRenderedPerLevel[i] = (e.numRenderedPerLevel[i] || 0) + 1, e.numRendered++));\n    }), e;\n  }\n\n  getUsedMemory() {\n    return this.tilingScheme ? (this._usedMemory === Be && (this._usedMemory = 0, this._allTiles.forAll(e => this._usedMemory += e.usedMemory)), this._usedMemory) : 0;\n  }\n\n  getUsedMemoryForLayerView(e) {\n    let t = 0;\n\n    const i = this.layerClassFromLayerView(e),\n          r = this._layerIndexByUid[i].get(e.uid);\n\n    return this._allTiles.forAll(e => t += e.getUsedMemoryForLayer(i, r)), t;\n  }\n\n  getTile(e) {\n    if (p(e)) return null;\n    const t = e.split(\"/\").map(e => +e);\n    if (0 === t[0]) return this.rootTiles.find(e => e.lij[1] === t[1] && e.lij[2] === t[2]);\n    const i = 2 ** t[0],\n          r = Math.floor(t[1] / i),\n          s = Math.floor(t[2] / i);\n    let a;\n\n    if (this.rootTiles.some(e => e.lij[1] === r && e.lij[2] === s && (a = e, !0)), a) {\n      let e = 1 << t[0] - 1;\n\n      for (; a.lij[0] < t[0];) {\n        let i = t[1] & e ? 2 : 0;\n        if ((t[2] & e) > 0 && i++, !a.children[i]) return null;\n        a = a.children[i], e >>= 1;\n      }\n\n      return ue(a.lij[0] === t[0] && a.lij[1] === t[1] && a.lij[2] === t[2], \"not the right tile?\"), a;\n    }\n\n    return null;\n  }\n\n  get test() {\n    const e = this;\n    return {\n      renderer: e._renderer,\n      lercDecoder: e._lercDecoder,\n      forceReload: () => {\n        e._mergeTile(e.rootTiles[0]), e._viewChangeUpdate();\n      },\n      getTiles: () => e._allTiles.toArray(),\n      getRenderedTiles: () => (Ne.clear(), e._allTiles.forAll(e => {\n        e.visible && e.rendered && Ne.push(e);\n      }), Pe(e.renderOrder, Ne), Ne.toArray())\n    };\n  }\n\n};\ne([w()], Oe.prototype, \"_renderer\", void 0), e([w()], Oe.prototype, \"_hasPendingUpdates\", void 0), e([w()], Oe.prototype, \"_asyncWorkItems\", void 0), e([w()], Oe.prototype, \"_allTilesDirty\", void 0), e([w()], Oe.prototype, \"_allTilesSorted\", void 0), e([w()], Oe.prototype, \"_viewChanged\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"_watchUpdatingTracking\", void 0), e([w()], Oe.prototype, \"_frameTask\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"snapLevel\", null), e([w({\n  readOnly: !0\n})], Oe.prototype, \"lodSnapping\", null), e([w({\n  constructOnly: !0\n})], Oe.prototype, \"view\", void 0), e([T(\"_renderer.cullBackFaces\")], Oe.prototype, \"cullBackFaces\", void 0), e([w({\n  readOnly: !0,\n  dependsOn: []\n})], Oe.prototype, \"extent\", null), e([w({\n  readOnly: !0\n})], Oe.prototype, \"updating\", null), e([w(X)], Oe.prototype, \"updatingProgress\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"updatingProgressValue\", null), e([w()], Oe.prototype, \"_maxNumUpdating\", void 0), e([w({\n  aliasOf: \"view.map.ground.opacity\"\n})], Oe.prototype, \"baseOpacity\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"overlayManager\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"viewingMode\", null), e([w()], Oe.prototype, \"maxTextureScale\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"ready\", null), e([w({\n  value: 1\n})], Oe.prototype, \"renderOrder\", null), e([w({\n  readOnly: !0\n})], Oe.prototype, \"rootTiles\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"spatialReference\", null), e([w()], Oe.prototype, \"backgroundImage\", void 0), e([w({\n  type: t,\n  aliasOf: \"view.map.ground.surfaceColor\"\n})], Oe.prototype, \"backgroundColor\", void 0), e([w()], Oe.prototype, \"_background\", null), e([w({\n  value: !1\n})], Oe.prototype, \"slicePlaneEnabled\", null), e([w({\n  readOnly: !0\n})], Oe.prototype, \"tilingScheme\", void 0), e([w({\n  readOnly: !0,\n  aliasOf: \"tilingSchemeLogic.tilingSchemeLocked\"\n})], Oe.prototype, \"tilingSchemeLocked\", void 0), e([w({\n  readOnly: !0,\n  aliasOf: \"tilingSchemeLogic.tilingSchemeDone\"\n})], Oe.prototype, \"tilingSchemeDone\", void 0), e([w({\n  readOnly: !0\n})], Oe.prototype, \"tilingSchemeLogic\", void 0), e([w({\n  value: !0\n})], Oe.prototype, \"velvetOverground\", null), e([T(\"_renderer.wireframe\")], Oe.prototype, \"wireframe\", void 0), e([w({\n  value: !1\n})], Oe.prototype, \"suspended\", null), e([w({\n  readOnly: !0,\n  aliasOf: \"view.qualitySettings.tiledSurface.textureFadeDuration\"\n})], Oe.prototype, \"textureFadeDuration\", void 0), e([w()], Oe.prototype, \"_layerViewsDirty\", void 0), e([T(\"_renderer.renderPatchBorders\")], Oe.prototype, \"renderPatchBorders\", void 0), e([T(\"_renderer.renderingDisabled\")], Oe.prototype, \"renderingDisabled\", void 0), Oe = e([S(\"esri.views.3d.terrain.TerrainSurface\")], Oe);\nvar Ve = Oe;\n\nfunction ke(e, t) {\n  return e[0] === t[0] && e[1] === t[1] && e[2] === t[2];\n}\n\nfunction Ie(e) {\n  return null != e.refreshInterval;\n}\n\nfunction qe(e) {\n  return !e.isLeaf && (e.children[0].shouldLoad || e.children[1].shouldLoad || e.children[2].shouldLoad || e.children[3].shouldLoad || qe(e.children[0]) || qe(e.children[1]) || qe(e.children[2]) || qe(e.children[3]));\n}\n\nfunction Ae(e) {\n  return e.isLeaf && e.parent && e.parent.shouldLoad;\n}\n\nconst Be = -1,\n      Fe = P(),\n      He = b(),\n      We = [0, 0, 0],\n      Ne = new g(),\n      Qe = {\n  spatialReference: null,\n  tile: null,\n  extent: null,\n  context: \"ground\"\n},\n      Ge = {\n  spatialReference: null,\n  extent: null,\n  scale: 0\n};\nexport default Ve;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/terrain/TerrainSurface.js"],"names":["_","e","t","i","difference","r","s","a","n","l","clamp","o","releaseMaybe","h","destroyMaybe","d","unwrapOr","u","isNone","p","isSome","c","g","isAbortError","m","isAborted","y","createAbortError","v","init","f","aliasOf","T","property","w","subclass","S","x","L","C","D","P","projectVectorToVector","j","projectPointToVector","U","getReferenceEllipsoid","R","create","b","equals","M","set","E","containsPoint","O","empty","V","expand","k","I","copy","q","ElevationQueryTileCache","A","isBaseLayer","B","acquireDecoder","F","printAllocations","H","W","directionToHeadingTilt","N","scaleToZoom","Q","G","toBoundingRect","z","updatingProgress","X","ElevationBounds","Y","ElevationData","$","OverlayManager","J","PlanarPatch","K","SphericalPatch","Z","ee","SurfaceTilingSchemeLogic","te","DEFAULT_TILE_BACKGROUND","ie","MAX_ROOT_TILES","re","TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR","se","TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR","ae","MAX_MEMORY_LOD_BIAS","ne","LayerClasses","le","ELEVATION_NODATA_VALUE","oe","he","de","weakAssert","ue","computeSkirtScale","pe","isSurfaceLayerView","ce","isElevationLayerView","_e","isVectorTileLayerView","ge","useFetchTileForLayer","me","isImageryTileLayerView","ye","isTileLayerView","ve","releaseTileData","fe","Te","SplitLimits","we","Se","IteratorPreorder","xe","IteratorPostorder","Le","hasLoadableSiblings","Ce","sortTilesByPOI","De","sortTiles","Pe","UpsampleInfo","je","TaskPriority","Ue","noBudget","Re","WatchUpdatingTracking","be","Me","getLogger","Ee","Oe","EventedMixin","constructor","_elevationBounds","_rootExtent","_iteratorPool","remove","release","_postorderIterator","_hasPendingUpdates","_pendingUpdates","_asyncWorkItems","_allTilesDirty","_allTilesSorted","_visible","_usedMemory","Be","_performanceInfo","_viewChanged","_inFrameTask","_viewChangeUpdateDirty","_overlayOpacity","_eyePosRenderSR","_eyePosSurfaceSR","_splitLimits","_snapLevel","_frustum","_viewProjectionMatrix","_layerViews","Array","_layerIndexByUid","Map","_basemapLayerViewHandles","_handles","_watchUpdatingTracking","_allTiles","_upsampleInfoPool","_getElevationData","spatialReference","rootTiles","_maxNumUpdating","maxTextureScale","backgroundImage","backgroundColor","_layerViewsDirty","initialize","_lercDecoder","view","resourceController","_tilePool","state","isLocal","memoryController","_upsampleMapCache","getMemCache","unloadMapData","_elevationQueryCache","_set","surface","add","watch","_renderer","setNeedsHighlight","setRenderOccludedOverlay","overlayRenderer","overlayManager","renderer","ellipsoidRadius","radius","stage","_stage","updateOverlayOpacity","allTiles","_handleLayerViewChanges","_updateBaseOpacity","setTileBackground","_background","pointsOfInterest","removeAll","focus","_treeDebugger","then","TerrainTileTree3DDebugger","TERRAIN_TILE_TREE_SHOW_TILES","destroy","layers","map","allLayers","layerViews","allLayerViews","extentHelper","viewingMode","setStencilEnabledLayerExtents","defaultsFromMap","getCollections","mapCollectionPaths","get","getChildrenFunction","viewSpatialReference","tilingSchemeLogic","_updateTilingSchemeAndExtent","_elevationDataRequester","createStreamDataRequester","_mapDataRequester","scheduler","_frameTask","registerTask","TERRAIN_SURFACE","events","on","_viewChangeUpdate","fixedContentCamera","textureFadingEnabled","_clippingChanged","_updateClippingExtent","notifyChange","_removeAllTiles","forEach","_unregisterTiledLayerView","prune","frustum","snapLevel","contentCameraOnSurface","scale","contentCamera","eye","viewForward","up","tilt","Math","abs","round","lodSnapping","qualitySettings","tiledSurface","reduceTileLevelDifferences","upsampleInfoPool","upsampleMapCache","elevationQueryCache","mapTileRequester","extent","_clippingExtent","updating","ready","suspended","updatingProgressValue","max","renderOrder","skirtScale","tilingScheme","slicePlaneEnabled","slicePlane","renderView","setRenderParameters","opaqueTerrain","opaque","velvetOverground","visible","setVisibility","intersect","getElevation","Fe","getTileWithElevation","sample","renderData","geometryState","samplerData","length","layerInfo","error","rendered","isLeaf","children","elevationBounds","getScale","_getLodBiasCorrectedScale","level","queryVisibleScaleRange","levelAtScale","lodBias","queryVisibleLevelRange","isTransparent","_allTransparentSurfaceLayers","_updateTileTextures","_dataExtent","_updateTiledLayers","setTileSize","pixelSize","setSpatialReference","_updateRootTiles","_acquireTile","acquire","We","He","rootTilesInExtent","shouldSplit","setPendingUpdate","_loadTile","warn","lij","ke","removed","added","filter","findIndex","bind","_purgeTile","push","_setRootTiles","_hasFixedExtent","setOverlayPlacementDirty","clear","reset","done","next","setRootTiles","_updateTileVisibility","_runViewChangeUpdateIfDirty","_updateViewDependentParameters","_updateSkirts","_updateClippingStatus","updateClippingStatus","resetPendingUpdate","_updateTileGeometry","min","updateVisibility","loadable","updateScreenDepth","skipSubtree","isFinite","emit","camera","tan","fovX","fovY","pixelRatio","aboveGround","relativeWidthLimit","width","relativeHeightLimit","height","maxLod","getMaxLod","angledSplitBias","projectionMatrix","viewMatrix","renderSpatialReference","constraints","collision","enabled","near","_updateRenderData","shouldLoad","qe","_loadChildren","Ae","_loadParent","updateTileGeometry","_elevationUpdate","Qe","tile","running","runTask","processQueue","_updateTileStatus","_sortTiles","_mergeAndSplit","run","_updateElevation","_updateTextures","requestUpdate","updateAgentSuspension","updateAgents","resetOne","madeProgress","renderLocation","update","some","usedMemory","_mergeTile","_splitTile","updateTileTexture","hasProgressed","clippingArea","clippingExtent","updateTileOverlayParams","memoryFactor","levels","floor","ceil","_purgeChildTiles","unsetChildren","removeUnordered","unload","setChildren","_createTile","pushArray","_emitTileScaleChange","numSplit","Ge","hasPendingUpdate","numMerged","parent","_unloadChildren","load","hasOverlays","setTileParameters","_elevationDataArrived","dataArrived","findElevationBoundsForLayer","computeElevationBounds","Set","items","uid","has","layerClassFromLayerView","_registerTiledLayerView","layer","loaded","ground","opacity","fullOpacity","_restartAllAgents","_invalidateLayerData","delete","fullExtent","id","compatibleWith","tileInfo","displayLevelRange","maxLevel","reverse","indexOf","modifyLayers","ensureMaxLod","restartAgents","layerViewByIndex","numLayers","forAll","updateRenderData","removeLayerAgent","invalidateLayerData","setTileTreeDirty","requestRender","setNeedsRender","requestTileData","tilemapCache","_requestTileData","fetchAvailability","timeout","catch","_dataMissing","notInTilemap","schedule","signal","_requestElevationTileData","_requestMapTileData","toString","fetchTile","noDataValue","warnOnce","getTileUrl","request","decode","values","pixelData","minValue","maxValue","Promise","reject","_mapTileDataArrived","schemaHelper","getLevelRowColumn","Ie","refreshTimestamp","hasMixedImageFormats","dataMissing","computeOpacity","overlayOpacity","performanceInfo","numNodes","numLeaves","numVisible","numRendered","numLoadedPerLevel","numRenderedPerLevel","getUsedMemory","getUsedMemoryForLayerView","getUsedMemoryForLayer","getTile","split","find","test","lercDecoder","forceReload","getTiles","toArray","getRenderedTiles","Ne","prototype","readOnly","constructOnly","dependsOn","value","type","Ve","refreshInterval","context"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Color.js\";import i from\"../../../core/Accessor.js\";import{difference as r}from\"../../../core/arrayUtils.js\";import s from\"../../../core/CollectionFlattener.js\";import a from\"../../../core/Evented.js\";import n from\"../../../core/Handles.js\";import l from\"../../../core/Logger.js\";import{clamp as o}from\"../../../core/mathUtils.js\";import{releaseMaybe as h,destroyMaybe as d,unwrapOr as u,isNone as p,isSome as c}from\"../../../core/maybe.js\";import _ from\"../../../core/ObjectPool.js\";import g from\"../../../core/PooledArray.js\";import{isAbortError as m,isAborted as y,createAbortError as v}from\"../../../core/promiseUtils.js\";import{init as f}from\"../../../core/watchUtils.js\";import{aliasOf as T}from\"../../../core/accessorSupport/decorators/aliasOf.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as w}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as S}from\"../../../core/accessorSupport/decorators/subclass.js\";import{m as x}from\"../../../chunks/mat4.js\";import{c as L}from\"../../../chunks/mat4f64.js\";import{g as C}from\"../../../chunks/vec3.js\";import{c as D}from\"../../../chunks/vec3f64.js\";import{c as P}from\"../../../chunks/vec4f64.js\";import{projectVectorToVector as j,projectPointToVector as U}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as R}from\"../../../geometry/projectionEllipsoid.js\";import{create as b,equals as M,set as E,containsPoint as O,empty as V,expand as k}from\"../../../geometry/support/aaBoundingRect.js\";import{create as I,copy as q}from\"../../../geometry/support/frustum.js\";import{ElevationQueryTileCache as A}from\"../../../layers/support/ElevationQueryTileCache.js\";import{isBaseLayer as B}from\"../../../layers/support/layerUtils.js\";import{acquireDecoder as F}from\"../../../layers/support/LercDecoder.js\";import{printAllocations as H}from\"../../2d/engine/vectorTiles/VectorTile.js\";import W from\"../layers/ElevationLayerView3D.js\";import{directionToHeadingTilt as N,scaleToZoom as Q}from\"../support/cameraUtils.js\";import G from\"../support/debugFlags.js\";import{toBoundingRect as z}from\"../support/extentUtils.js\";import{updatingProgress as X}from\"../support/updatingProperties.js\";import{ElevationBounds as Y}from\"./ElevationBounds.js\";import{ElevationData as $}from\"./ElevationData.js\";import{OverlayManager as J}from\"./OverlayManager.js\";import{PlanarPatch as K}from\"./PlanarPatch.js\";import{SphericalPatch as Z}from\"./SphericalPatch.js\";import{create as ee}from\"./SurfaceExtentHelper.js\";import{SurfaceTilingSchemeLogic as te}from\"./SurfaceTilingSchemeLogic.js\";import{DEFAULT_TILE_BACKGROUND as ie,MAX_ROOT_TILES as re,TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR as se,TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR as ae,MAX_MEMORY_LOD_BIAS as ne,LayerClasses as le,ELEVATION_NODATA_VALUE as oe}from\"./TerrainConst.js\";import he from\"./TerrainRenderer.js\";import de from\"./TerrainSurfacePerformanceInfo.js\";import{weakAssert as ue,computeSkirtScale as pe,isSurfaceLayerView as ce,isElevationLayerView as _e,isVectorTileLayerView as ge,useFetchTileForLayer as me,isImageryTileLayerView as ye,isTileLayerView as ve,releaseTileData as fe}from\"./terrainUtils.js\";import Te,{SplitLimits as we}from\"./Tile.js\";import{printAllocations as Se}from\"./TilePerLayerInfo.js\";import{IteratorPreorder as xe,IteratorPostorder as Le,hasLoadableSiblings as Ce,sortTilesByPOI as De,sortTiles as Pe}from\"./tileUtils.js\";import{UpsampleInfo as je}from\"./UpsampleInfo.js\";import{TaskPriority as Ue,noBudget as Re}from\"../../support/Scheduler.js\";import{WatchUpdatingTracking as be}from\"../../support/WatchUpdatingTracking.js\";const Me=l.getLogger(\"esri.views.3d.terrain.TerrainSurface\"),Ee=.25;let Oe=class extends(a.EventedMixin(i)){constructor(e){super(e),this._elevationBounds=new Y,this._rootExtent=b(),this._iteratorPool=new _(xe,(e=>e.remove=()=>this._iteratorPool.release(e))),this._postorderIterator=new Le,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=Be,this._performanceInfo=new de,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._overlayOpacity=1,this._eyePosRenderSR=D(),this._eyePosSurfaceSR=D(),this._splitLimits=new we,this._snapLevel=1/0,this._frustum=I(),this._viewProjectionMatrix=L(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new n,this._watchUpdatingTracking=new be,this._allTiles=new g,this._upsampleInfoPool=new _(je),this._getElevationData={spatialReference:null,rootTiles:null},this._maxNumUpdating=1,this.maxTextureScale=1.2,this.rootTiles=null,this.backgroundImage=ie,this.backgroundColor=null,this._layerViewsDirty=!1}initialize(){this._lercDecoder=F(this.view.resourceController),this._tilePool=this.view.state.isLocal?new _(K):new _(Z);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.getMemCache(\"esri.views.3d.terrain.upsample\",(e=>e.unloadMapData())),this._elevationQueryCache=new A(e.getMemCache(\"elevation-query\")),this._set(\"overlayManager\",new J({surface:this})),this._handles.add([this.watch(\"overlayManager.hasHighlights\",(e=>this._renderer.setNeedsHighlight(e))),this.watch(\"overlayManager.rendersOccluded\",(e=>this._renderer.setRenderOccludedOverlay(e)))],\"overlayManager\"),this._renderer=new he({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:R(this.view.spatialReference).radius,stage:this.view._stage,updateOverlayOpacity:()=>this.updateOverlayOpacity(),allTiles:this._allTiles}),this._handles.add([f(this,\"baseOpacity\",(e=>{this._handleLayerViewChanges(),this._updateBaseOpacity(e)}),!0),f(this,\"_background\",(()=>{this._handleLayerViewChanges(),this._renderer.setTileBackground(this._background)}),!0),this.view.watch(\"pointsOfInterest\",(e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add(e.focus,\"renderLocation\",(()=>()=>this._allTilesSorted=!1))})),f(G,\"TERRAIN_TILE_TREE_SHOW_TILES\",(e=>{e&&!this._treeDebugger?import(\"../layers/support/TerrainTileTree3DDebugger.js\").then((({TerrainTileTree3DDebugger:e})=>{!this._treeDebugger&&G.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new e({view:this.view}))})):e||!this._treeDebugger||G.TERRAIN_TILE_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)}))]);const t={layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper=ee(this.viewingMode,t),this._handles.add(f(this.extentHelper,\"stencilEnabledExtents\",(e=>this._renderer.setStencilEnabledLayerExtents(e))),\"extentHelper\");const i=this.view.defaultsFromMap?new s({getCollections:()=>{var e,t,i;return null==(e=this.view)||null==(t=e.defaultsFromMap)||null==(i=t.mapCollectionPaths)?void 0:i.map((e=>this.view.map.get(e)))},getChildrenFunction:e=>e&&\"layers\"in e?e.layers:null}):this.view.map.allLayers,r=new te({layers:i,extentHelper:this.extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set(\"tilingSchemeLogic\",r),this._handles.add([this.tilingSchemeLogic.watch(\"tilingScheme\",(()=>this._updateTilingSchemeAndExtent()),!0),this.tilingSchemeLogic.watch(\"extent\",(()=>this._updateTilingSchemeAndExtent()),!0)],\"tilingSchemeLogic\"),this._updateTilingSchemeAndExtent(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);const a=this.view.resourceController.scheduler;this._frameTask=a.registerTask(Ue.TERRAIN_SURFACE,this),this.view.resourceController.memoryController.events.on(\"quality-changed\",(()=>this._viewChangeUpdate())),this._handles.add([this.view.on(\"resize\",(()=>this._viewChangeUpdate())),this.view.watch(\"state.camera\",(()=>this._viewChangeUpdate()),!0),this.view.watch(\"state.contentCamera\",(()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate()),!0),this.view.watch(\"qualitySettings.tiledSurface.lodBias\",(()=>this._viewChangeUpdate())),f(this.view,\"qualitySettings.tiledSurface.textureFadeDuration\",(e=>this._renderer.textureFadingEnabled=e>0)),this.view.watch(\"lodSnapping\",(()=>this._viewChangeUpdate())),this.view.watch(\"clippingArea\",(()=>this._clippingChanged()))]),this._handles.add(this.view.allLayerViews.on(\"after-changes\",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._updateClippingExtent(),this.notifyChange(\"extent\")}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=h(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=d(this._upsampleMapCache),this._elevationQueryCache=d(this._elevationQueryCache),this._set(\"tilingSchemeLogic\",d(this.tilingSchemeLogic)),this.extentHelper=d(this.extentHelper),this._basemapLayerViewHandles.forEach(((e,t)=>this._unregisterTiledLayerView(t))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set(\"overlayManager\",d(this.overlayManager)),this._tilePool=d(this._tilePool),Te.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=d(this._renderer),this._iteratorPool=d(this._iteratorPool),this._set(\"view\",null),this._upsampleInfoPool=d(this._upsampleInfoPool),H(),Se()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;const i=null==(e=this.view.pointsOfInterest)||null==(t=e.contentCameraOnSurface)?void 0:t.scale;if(i){const e=this.view.state.contentCamera;let t=N(this.view,e.eye,e.viewForward,e.up).tilt;t>90&&(t=180-t);const r=2*(t/90)**2,s=Q(this.view,i)-r;Math.abs(this._snapLevel-s)>Ee&&(Math.round(s)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=s)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get extent(){return u(this._clippingExtent,this._rootExtent)}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return!!this.rootTiles}set renderOrder(e){this._renderer.renderOrder=e,this._set(\"renderOrder\",e)}set skirtScale(e){this._renderer.skirtScale=e}get skirtScale(){return this._renderer.skirtScale}get spatialReference(){var e,t;return null!=(e=null==(t=this.tilingScheme)?void 0:t.spatialReference)?e:null}get _background(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}set slicePlaneEnabled(e){var t,i;this._renderer.slicePlane=e,this._set(\"slicePlaneEnabled\",e),null==(t=this.view)||null==(i=t._stage)||i.renderView.setRenderParameters({opaqueTerrain:this.opaque})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set(\"velvetOverground\",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set(\"suspended\",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=Fe,a=this.getTileWithElevation(e,t,i,r,s);return p(a)?null:$.sample(s[0],s[1],a.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Fe){const a=this._getElevationData.rootTiles;if(!a||!a.length)return null;if(0===a[0].layerInfo[0].length)return null;if(s[0]=e,s[1]=t,s[2]=i,!j(s,r,s,this._getElevationData.spatialReference))return Me.error(\"TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system\"),null;for(let n of a){if(!n.containsPoint(s))continue;for(;n&&!n.rendered&&!n.isLeaf;){let e=0;s[0]>.5*(n.extent[0]+n.extent[2])&&(e+=1),s[1]<.5*(n.extent[1]+n.extent[3])&&(e+=2),n=n.children[e]}const e=n.renderData;return(e&&e.geometryState?e.geometryState.samplerData:null)?n:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!U(e,Fe,this.spatialReference))return Me.error(\"TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system\"),null;const t=this.rootTiles;if(t)for(let e of t)if(e.containsPoint(Fe)){for(;null!=e.children[0];){let t=0;Fe[0]>e.children[0].extent[2]&&(t+=1),Fe[1]<e.children[0].extent[1]&&(t+=2),e=e.children[t]}return this._getLodBiasCorrectedScale(e.level)}}return 1e100}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,a=i?this.tilingScheme.levelAtScale(i):1/0,n=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+n,a+n,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1,this._renderer.isTransparent=this._allTransparentSurfaceLayers();const i=t!==this._renderer.opaque;var r,s;i&&(null==(r=this.view)||null==(s=r._stage)||s.renderView.setRenderParameters({opaqueTerrain:this.opaque}));this._updateTileTextures(i)}_updateTilingSchemeAndExtent(){const e=this.tilingSchemeLogic.extent,t=e&&!M(e,this._dataExtent);t&&(c(this._dataExtent)?E(this._dataExtent,e):this._dataExtent=b(e));const i=this.tilingSchemeLogic.tilingScheme,r=i!==this.tilingScheme;var s;r&&(ue(!!i,\"tiling scheme cannot be reset to undefined\"),this.tilingScheme&&this._removeAllTiles(),this._set(\"tilingScheme\",i),this._updateClippingExtent(),i&&(this._updateTiledLayers(),this._renderer.setTileSize(i.pixelSize),this.overlayManager.setSpatialReference(i.spatialReference)),this._getElevationData.spatialReference=null!=(s=null==i?void 0:i.spatialReference)?s:null);(t||r)&&this._updateRootTiles()}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return We[0]=e,We[1]=t,We[2]=i,s.init(We,r,this),s}_updateRootTiles(){const e=this._clippingExtent||this._dataExtent,t=this.tilingScheme;if(p(e)||!t)return;const i=He;let s=t.rootTilesInExtent(e,i,5*re);const a=e=>{const t=this._acquireTile(0,e[1],e[2],null);return 2===t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&t.setPendingUpdate(2),this._loadTile(t),t};if(this.rootTiles){if(s.length>re)return void Me.warn(se);const e=this.rootTiles.map((e=>e.lij)),t=r(e,s,ke);if(t.removed.length>0||t.added.length>0){const e=this.rootTiles.filter((e=>!(t.removed.findIndex(ke.bind(null,e.lij))>-1)||(this._purgeTile(e),!1)));t.added.forEach((t=>e.push(a(t)))),this._setRootTiles(e)}}else s.length>re&&(Me.warn(ae),s=t.rootTilesInExtent(e,i,re)),this._setRootTiles(s.map((e=>a(e))));M(i,this._rootExtent)||(this._rootExtent=b(i),this._hasFixedExtent()||this.notifyChange(\"extent\")),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setOverlayPlacementDirty(),this.notifyChange(\"ready\")}_setRootTiles(e){if(this._set(\"rootTiles\",e),this._allTiles.clear(),e){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._getElevationData.rootTiles=e,this._renderer.setRootTiles(this.rootTiles),this._updateTileVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTileVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this._clippingExtent)&&e.resetPendingUpdate(32)&&this._updateTileGeometry(e)}_updateTileVisibility(e){if(!e)return;const t=this._iteratorPool.acquire();t.reset(e);const i=Ce(e);let r=i?this._elevationBounds.min:1/0,s=i?this._elevationBounds.max:-1/0;for(;!t.done;){const e=t.next();this._updateClippingStatus(e),e.updateVisibility(),e.setPendingUpdate(16),e.loadable?(e.updateScreenDepth(this._viewProjectionMatrix),e.renderData&&(r=Math.min(e.elevationBounds[0],r),s=Math.max(e.elevationBounds[1],s))):t.skipSubtree()}t.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(r)&&isFinite(s)&&(this._elevationBounds.min===r&&this._elevationBounds.max===s||(this._elevationBounds.min=r,this._elevationBounds.max=s,this.emit(\"elevation-bounds-change\",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,a=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*a,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*a,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(p(this._splitLimits.frustum)&&(this._splitLimits.frustum=I()),q(t.frustum,this._splitLimits.frustum)):this._splitLimits.frustum=null,q(e.frustum,this._frustum),x(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),C(this._eyePosRenderSR,t.eye),j(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateSkirts(){const e=this.view.state.camera,t=this.view.state.constraints.collision.enabled?0:1.11*e.near;this.skirtScale=pe(this,this._eyePosSurfaceSR,t)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(qe(e)?this._loadChildren(e):Ae(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._elevationUpdate(e),this._usedMemory=Be}_elevationUpdate(e){Qe.spatialReference=this.spatialReference,Qe.tile=e,Qe.extent=e.extent,this.emit(\"elevation-change\",Qe),O(e.extent,this._eyePosSurfaceSR)&&this._updateSkirts()}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run((()=>this._updateElevation(e))),e.run((()=>this._updateTextures(e))),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done&&this.requestUpdate(),this.notifyChange(\"updatingProgressValue\")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const e=t.next();if(e.loadable){const i=e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===i){e.resetPendingUpdate(8),e.isLeaf&&(e.setPendingUpdate(2),t.skipSubtree());continue}e.resetPendingUpdate(2)&&e.updateAgentSuspension(),4===i&&e.updateAgents(0)}if(t.skipSubtree(),!e.isLeaf){e.setPendingUpdate(8),e.resetPendingUpdate(2);const t=this._iteratorPool.acquire();t.resetOne(e);for(let e=t.next();!t.done;e=t.next())this._updateClippingStatus(e),e.updateVisibility(),e.loadable&&e.updateScreenDepth(this._viewProjectionMatrix);t.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(De(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_mergeAndSplit(e,t){if(this.suspended||!this._allTilesDirty||e.done)return;this._allTilesDirty=!1,this.requestUpdate();let i=0;for(;!e.done;){let r=!1;i=0;const s=!this._allTiles.some((s=>{if(i+=s.usedMemory,s.resetPendingUpdate(8)){if(!t)return s.setPendingUpdate(8),e.done;this._mergeTile(s),r=!0,e.madeProgress()}else s.resetPendingUpdate(2)&&(this._splitTile(s),r=!0,e.madeProgress());return s.resetPendingUpdate(16)&&(this._updateRenderData(s),e.madeProgress()),e.done}));if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(this._usedMemory=i,!r)break}else this._allTilesDirty=!0}0===i&&(this._allTilesDirty=!0),this._sortTiles(e)}_updateElevation(e){return this._allTiles.some((t=>(t.resetPendingUpdate(32)&&(this._updateTileGeometry(t),t.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(t),this._usedMemory=Be),e.madeProgress()),e.done))),e.hasProgressed}_updateTextures(e){return this._allTiles.some((t=>(t.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(t),this._usedMemory=Be,e.madeProgress()),e.done))),e.hasProgressed}_updateClippingExtent(){if(!this.spatialReference)return!1;const e=b();let t=null;return z(this.view.clippingArea,e,this.spatialReference)&&(t=e),!M(t,this._clippingExtent)&&(this._clippingExtent=t,this._renderer.clippingExtent=t,this.notifyChange(\"extent\"),this.updateTileOverlayParams(),this.overlayManager.setOverlayPlacementDirty(),!0)}_clippingChanged(){this._updateClippingExtent()&&this._updateRootTiles()}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*ne}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=o(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){this.rootTiles&&(this.rootTiles.forEach((e=>this._purgeTile(e))),this._setRootTiles(null),this.notifyChange(\"ready\")),this._allTiles.clear(),this.visible=!1}_purgeChildTiles(e){if(e.isLeaf)return!1;let t=this._purgeTile(e.children[0]);return t=this._purgeTile(e.children[1])||t,t=this._purgeTile(e.children[2])||t,t=this._purgeTile(e.children[3])||t,e.unsetChildren(),t}_purgeTile(e){const t=this._purgeChildTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),e.unload(this._renderer),this._tilePool.release(e),t}_splitTile(e){ue(e.isLeaf,\"tile that is already split should not be split again!\");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(16),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){Ge.spatialReference=this.spatialReference,Ge.extent=e.extent,Ge.scale=this._getLodBiasCorrectedScale(t),this.emit(\"scale-change\",Ge)}_createTile(e,t,i,r){ue(!!r,\"_createTile sanity check\");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this._clippingExtent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),2===s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&s.setPendingUpdate(2)),s}_mergeTile(e){ue(!e.hasPendingUpdate(2),\"_mergeTile sanity check\"),this._purgeChildTiles(e)&&(ue(!e.renderData,\"_mergeTile sanity check\"),this._loadTile(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_loadChildren(e){ue(e.rendered,\"parent should be rendered\"),e.unload(this._renderer),this._loadTile(e.children[0]),this._loadTile(e.children[1]),this._loadTile(e.children[2]),this._loadTile(e.children[3])}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t)}_unloadChildren(e){e.isLeaf||(this._unloadChildren(e.children[0]),e.children[0].unload(this._renderer),this._unloadChildren(e.children[1]),e.children[1].unload(this._renderer),this._unloadChildren(e.children[2]),e.children[2].unload(this._renderer),this._unloadChildren(e.children[3]),e.children[3].unload(this._renderer))}_loadTile(e){e.load(this._renderer),e.setPendingUpdate(16),this.requestUpdate(),this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_elevationDataArrived(e,t,i){const r=new $(e.lij,e.extent,i);e.dataArrived(t,0,r);const s=[e],a=e.level,n=this._iteratorPool.acquire();for(n.reset(s);!n.done;){const e=n.next();e.findElevationBoundsForLayer(t,a),e.computeElevationBounds()}n.remove(),this._updateTileVisibility(s)}_handleLayerViewChanges(e=Re){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),ce(s))if(this._basemapLayerViewHandles.has(s.uid)){const e=this.layerClassFromLayerView(s),i=this._layerIndexByUid[e].get(s.uid);i<r&&(t=!0),r=i}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach(((e,r)=>{i.has(r)||(this._unregisterTiledLayerView(r),t=!0)})),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allTransparentSurfaceLayers(),e.madeProgress()}_allTransparentSurfaceLayers(){let e=0===this.view.map.ground.opacity;for(const t of this.view.allLayerViews.items)if(ce(t)&&!_e(t)&&!B(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}layerClassFromLayerView(e){return _e(e)?0:1}_registerTiledLayerView(e){const t=[],i=this.layerClassFromLayerView(e);t.push(e.watch(\"suspended\",(()=>this._updateTiledLayers()))),t.push(e.watch(\"fullOpacity\",(()=>this._updateTileTextures(!1)))),t.push(e.layer.watch(\"scaleRangeId\",(()=>this._restartAllAgents(i)))),e.on(\"data-changed\",(()=>{const t=this._layerIndexByUid[i].get(e.uid);null!=t&&this._invalidateLayerData(t,i)})),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let e=0;e<t.length;e++)t[e].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;const r=V();e.forEach((e=>{const s=e.layer;if(!s||e.suspended||!ce(e))return;const a=e.fullExtent;if(!a)return void Me.warn(\"Terrain: Map or elevation layer does not have fullExtent: \"+s.id);if(!this.tilingScheme.compatibleWith(e.tileInfo))return void Me.warn(\"Terrain: tiling scheme of layer \"+s.id+\" is incompatible with other tiled layers, will not be drawn\");k(r,a);const n=this.layerClassFromLayerView(e);if(1===n){const t=e.displayLevelRange;t.maxLevel!==1/0&&(null===i||t.maxLevel>i)&&(i=t.maxLevel)}t[n].push(e)}));for(const s of le){const e=this._layerViews[s],i=t[s];i.reverse();const r=i.length;let a=e.length!==r;const n=new Array(r),l=new Array(e.length);this._layerIndexByUid[s].clear();for(let t=0;t<r;t++){const r=i[t].uid;this._layerIndexByUid[s].set(r,t);const o=e.indexOf(i[t]);n[t]=o,t!==o&&(a=!0),o>-1&&(l[o]=t)}if(a){const e=this._postorderIterator;for(e.reset(this.rootTiles);!e.done;)e.next().modifyLayers(l,n,s);this._layerViews[s]=i,this._restartAllAgents(s),this._updateTileVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),0===e&&i.computeElevationBounds()}}_hasFixedExtent(){return!!this._clippingExtent}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll((t=>{t.updateAgents(1),e?this.renderer.updateTileTexture(t):t.updateRenderData(1)})),this._renderer.isTransparent=this._allTransparentSurfaceLayers()}_invalidateLayerData(e,t){this._allTiles.forAll((i=>i.removeLayerAgent(e,t))),this._allTiles.forAll((i=>i.invalidateLayerData(e,t)))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=1){this.renderer.setNeedsRender(e)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),a=s.layer;return!a.tilemapCache||ge(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,a.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...r,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((t=>{throw--this._asyncWorkItems,m(t)||this._dataMissing(e,i,s,{notInTilemap:!0}),t})).then((()=>this._frameTask.schedule((()=>this._requestTileData(e,i,s,r)),r.signal))))}_requestTileData(e,t,i,r){return 0===t?this._requestElevationTileData(e,i,r):this._requestMapTileData(e,i,r)}_requestElevationTileData(e,t,i){if(!_e(t))return void ue(!1,\"_requestElevationTileData can only be called for elevation layer views\");const r=r=>{if(--this._asyncWorkItems,y(i))return;const s=this._layerIndexByUid[0].get(t.uid);null!=s?(this._usedMemory=Be,this.requestUpdate(),this._elevationDataArrived(e,s,r)):Me.warn(\"TerrainSurface: received data from unknown layer %d %s\",0,e.lij.toString())},s=i=>{--this._asyncWorkItems,m(i)||(this._dataMissing(e,0,t,i),this.requestUpdate())};if(++this._asyncWorkItems,me(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:oe,signal:i.signal}).then((e=>{if(y(i))return Me.warnOnce(\"A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.\"),void s(v());this._frameTask.schedule((()=>r(e)),i.signal)}),s);const a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(a,\"binary\",i).then((e=>this._lercDecoder.decode(e,{noDataValue:oe},i.signal))).then((e=>{r({values:e.pixelData,width:e.width,height:e.height,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})}),s)}_requestMapTileData(e,t,i){if(t instanceof W)return Promise.reject();++this._asyncWorkItems;const r=(r,s)=>{--this._asyncWorkItems,fe(s),y(i)||(this._dataMissing(e,1,t,r),this.requestUpdate())},s=e=>t=>r(t,e),a=r=>this._frameTask.schedule((()=>{--this._asyncWorkItems,this.requestUpdate(),y(i)?fe(r):this._mapTileDataArrived(e,t,r)}),i.signal,s(r)).catch(s(r)),n=(e,t=null)=>this._frameTask.schedule((()=>r(e,t))).catch(s(t));if(ge(t)){const r=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(r[0],r[1],r[2],i).then(a,n)}if(ye(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(a,n);if(ve(t)&&me(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then((e=>{if(y(i))return Me.warnOnce(\"A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.\"),void n(v());a(e)}),n);let l=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Ie(t)&&t.refreshTimestamp&&(l+=`${l.indexOf(\"?\")>-1?\"&\":\"?\"}_ts=${t.refreshTimestamp}`);const o=t.hasMixedImageFormats?\"image+type\":\"image\";return this._mapDataRequester.request(l,o,i).then(a,n)}_mapTileDataArrived(e,t,i){const r=this._layerIndexByUid[1].get(t.uid);null!=r?e.dataArrived(r,1,i):(fe(i),Me.warn(\"TerrainSurface: received data from unknown layer\"))}_dataMissing(e,t,i,r){const s=this._layerIndexByUid[t].get(i.uid);null!=s?e.dataMissing(s,t,r):Me.warn(\"TerrainSurface: received data from unknown layer\")}updateTileOverlayParams(){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll((e=>{e.renderData&&this.overlayManager.setTileParameters(e)})),this._renderer.setNeedsRender())}updateOverlayOpacity(){if(!this.overlayManager)return;const e=this._eyePosSurfaceSR[2],t=this.overlayManager.computeOpacity(e);this._overlayOpacity!==t&&(this._overlayOpacity=t,this._renderer.overlayOpacity=t,this._renderer.setNeedsRender())}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll((t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))})),e}getUsedMemory(){return this.tilingScheme?(this._usedMemory===Be&&(this._usedMemory=0,this._allTiles.forAll((e=>this._usedMemory+=e.usedMemory))),this._usedMemory):0}getUsedMemoryForLayerView(e){let t=0;const i=this.layerClassFromLayerView(e),r=this._layerIndexByUid[i].get(e.uid);return this._allTiles.forAll((e=>t+=e.getUsedMemoryForLayer(i,r))),t}getTile(e){if(p(e))return null;const t=e.split(\"/\").map((e=>+e));if(0===t[0])return this.rootTiles.find((e=>e.lij[1]===t[1]&&e.lij[2]===t[2]));const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let a;if(this.rootTiles.some((e=>e.lij[1]===r&&e.lij[2]===s&&(a=e,!0))),a){let e=1<<t[0]-1;for(;a.lij[0]<t[0];){let i=t[1]&e?2:0;if((t[2]&e)>0&&i++,!a.children[i])return null;a=a.children[i],e>>=1}return ue(a.lij[0]===t[0]&&a.lij[1]===t[1]&&a.lij[2]===t[2],\"not the right tile?\"),a}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate()},getTiles:()=>e._allTiles.toArray(),getRenderedTiles:()=>(Ne.clear(),e._allTiles.forAll((e=>{e.visible&&e.rendered&&Ne.push(e)})),Pe(e.renderOrder,Ne),Ne.toArray())}}};e([w()],Oe.prototype,\"_renderer\",void 0),e([w()],Oe.prototype,\"_hasPendingUpdates\",void 0),e([w()],Oe.prototype,\"_asyncWorkItems\",void 0),e([w()],Oe.prototype,\"_allTilesDirty\",void 0),e([w()],Oe.prototype,\"_allTilesSorted\",void 0),e([w()],Oe.prototype,\"_viewChanged\",void 0),e([w({readOnly:!0})],Oe.prototype,\"_watchUpdatingTracking\",void 0),e([w()],Oe.prototype,\"_frameTask\",void 0),e([w({readOnly:!0})],Oe.prototype,\"snapLevel\",null),e([w({readOnly:!0})],Oe.prototype,\"lodSnapping\",null),e([w({constructOnly:!0})],Oe.prototype,\"view\",void 0),e([T(\"_renderer.cullBackFaces\")],Oe.prototype,\"cullBackFaces\",void 0),e([w({readOnly:!0,dependsOn:[]})],Oe.prototype,\"extent\",null),e([w({readOnly:!0})],Oe.prototype,\"updating\",null),e([w(X)],Oe.prototype,\"updatingProgress\",void 0),e([w({readOnly:!0})],Oe.prototype,\"updatingProgressValue\",null),e([w()],Oe.prototype,\"_maxNumUpdating\",void 0),e([w({aliasOf:\"view.map.ground.opacity\"})],Oe.prototype,\"baseOpacity\",void 0),e([w({readOnly:!0})],Oe.prototype,\"overlayManager\",void 0),e([w({readOnly:!0})],Oe.prototype,\"viewingMode\",null),e([w()],Oe.prototype,\"maxTextureScale\",void 0),e([w({readOnly:!0})],Oe.prototype,\"ready\",null),e([w({value:1})],Oe.prototype,\"renderOrder\",null),e([w({readOnly:!0})],Oe.prototype,\"rootTiles\",void 0),e([w({readOnly:!0})],Oe.prototype,\"spatialReference\",null),e([w()],Oe.prototype,\"backgroundImage\",void 0),e([w({type:t,aliasOf:\"view.map.ground.surfaceColor\"})],Oe.prototype,\"backgroundColor\",void 0),e([w()],Oe.prototype,\"_background\",null),e([w({value:!1})],Oe.prototype,\"slicePlaneEnabled\",null),e([w({readOnly:!0})],Oe.prototype,\"tilingScheme\",void 0),e([w({readOnly:!0,aliasOf:\"tilingSchemeLogic.tilingSchemeLocked\"})],Oe.prototype,\"tilingSchemeLocked\",void 0),e([w({readOnly:!0,aliasOf:\"tilingSchemeLogic.tilingSchemeDone\"})],Oe.prototype,\"tilingSchemeDone\",void 0),e([w({readOnly:!0})],Oe.prototype,\"tilingSchemeLogic\",void 0),e([w({value:!0})],Oe.prototype,\"velvetOverground\",null),e([T(\"_renderer.wireframe\")],Oe.prototype,\"wireframe\",void 0),e([w({value:!1})],Oe.prototype,\"suspended\",null),e([w({readOnly:!0,aliasOf:\"view.qualitySettings.tiledSurface.textureFadeDuration\"})],Oe.prototype,\"textureFadeDuration\",void 0),e([w()],Oe.prototype,\"_layerViewsDirty\",void 0),e([T(\"_renderer.renderPatchBorders\")],Oe.prototype,\"renderPatchBorders\",void 0),e([T(\"_renderer.renderingDisabled\")],Oe.prototype,\"renderingDisabled\",void 0),Oe=e([S(\"esri.views.3d.terrain.TerrainSurface\")],Oe);var Ve=Oe;function ke(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Ie(e){return null!=e.refreshInterval}function qe(e){return!e.isLeaf&&(e.children[0].shouldLoad||e.children[1].shouldLoad||e.children[2].shouldLoad||e.children[3].shouldLoad||qe(e.children[0])||qe(e.children[1])||qe(e.children[2])||qe(e.children[3]))}function Ae(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Be=-1,Fe=P(),He=b(),We=[0,0,0],Ne=new g,Qe={spatialReference:null,tile:null,extent:null,context:\"ground\"},Ge={spatialReference:null,extent:null,scale:0};export default Ve;\n"]},"metadata":{},"sourceType":"module"}