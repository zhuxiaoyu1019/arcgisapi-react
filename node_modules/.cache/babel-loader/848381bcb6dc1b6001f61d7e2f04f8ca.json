{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport { clone as t } from \"../../core/lang.js\";\nimport { isSome as n } from \"../../core/maybe.js\";\nimport { getDeepValue as r } from \"../../core/object.js\";\nimport { numberToJSON as i } from \"../../core/accessorSupport/extensions/serializableProperty/writer.js\";\nconst o = new Set([\"bing-maps\", \"imagery\", \"imagery-tile\", \"map-image\", \"open-street-map\", \"tile\", \"unknown\", \"unsupported\", \"vector-tile\", \"web-tile\"]),\n      l = new Set([\"csv\", \"feature\", \"geo-rss\", \"group\", \"imagery\", \"imagery-tile\", \"kml\", \"map-image\", \"map-notes\", \"ogc-feature\", \"tile\", \"unknown\", \"unsupported\", \"vector-tile\", \"web-tile\", \"wfs\"]);\n\nfunction a(e) {\n  o.delete(e), l.delete(e);\n}\n\nfunction s(e) {\n  o.add(e), l.add(e);\n}\n\nfunction c(e) {\n  return \"basemap\" === e.layerContainerType ? o : \"operational-layers\" === e.layerContainerType ? l : null;\n}\n\nfunction p(e) {\n  return !(\"feature\" !== e.type || e.url || !e.source || \"memory\" !== e.source.type);\n}\n\nfunction u(e, t) {\n  if (t.restrictedWebMapWriting) {\n    const r = c(t);\n    return !n(r) || r.has(e.type) && !p(e);\n  }\n\n  return !0;\n}\n\nfunction m(e, t) {\n  if (p(e)) {\n    const n = r(\"featureCollection.layers\", t),\n          i = n && n[0] && n[0].layerDefinition;\n    i && d(e, i);\n  } else if (\"stream\" === e.type) {\n    d(e, t.layerDefinition = t.layerDefinition || {});\n  } else \"group\" !== e.type && d(e, t);\n}\n\nfunction d(e, t) {\n  \"maxScale\" in e && (t.maxScale = i(e.maxScale)), \"minScale\" in e && (t.minScale = i(e.minScale));\n}\n\nfunction f(e, t) {\n  if (m(e, t), \"blendMode\" in e && (t.blendMode = e.blendMode, \"normal\" === t.blendMode && delete t.blendMode), t.opacity = i(e.opacity), t.title = e.title || \"Layer\", t.visibility = e.visible, \"legendEnabled\" in e && \"wmts\" !== e.type) if (p(e)) {\n    const n = t.featureCollection;\n    n && (n.showLegend = e.legendEnabled);\n  } else t.showLegend = e.legendEnabled;\n}\n\nfunction y(r, i, o) {\n  if (!(\"write\" in r) || !r.write) return o && o.messages && o.messages.push(new e(\"layer:unsupported\", `Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted`, {\n    layer: r\n  })), null;\n\n  if (u(r, o)) {\n    const e = {};\n    return r.write(e, o) ? e : null;\n  }\n\n  return n(i) && f(r, i = t(i)), i;\n}\n\nexport { s as disableRestrictedWriting, a as enableRestrictedWriting, y as getLayerJSON };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/webdoc/support/writeUtils.js"],"names":["e","clone","t","isSome","n","getDeepValue","r","numberToJSON","i","o","Set","l","a","delete","s","add","c","layerContainerType","p","type","url","source","u","restrictedWebMapWriting","has","m","layerDefinition","d","maxScale","minScale","f","blendMode","opacity","title","visibility","visible","featureCollection","showLegend","legendEnabled","y","write","messages","push","id","declaredClass","layer","disableRestrictedWriting","enableRestrictedWriting","getLayerJSON"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{clone as t}from\"../../core/lang.js\";import{isSome as n}from\"../../core/maybe.js\";import{getDeepValue as r}from\"../../core/object.js\";import{numberToJSON as i}from\"../../core/accessorSupport/extensions/serializableProperty/writer.js\";const o=new Set([\"bing-maps\",\"imagery\",\"imagery-tile\",\"map-image\",\"open-street-map\",\"tile\",\"unknown\",\"unsupported\",\"vector-tile\",\"web-tile\"]),l=new Set([\"csv\",\"feature\",\"geo-rss\",\"group\",\"imagery\",\"imagery-tile\",\"kml\",\"map-image\",\"map-notes\",\"ogc-feature\",\"tile\",\"unknown\",\"unsupported\",\"vector-tile\",\"web-tile\",\"wfs\"]);function a(e){o.delete(e),l.delete(e)}function s(e){o.add(e),l.add(e)}function c(e){return\"basemap\"===e.layerContainerType?o:\"operational-layers\"===e.layerContainerType?l:null}function p(e){return!(\"feature\"!==e.type||e.url||!e.source||\"memory\"!==e.source.type)}function u(e,t){if(t.restrictedWebMapWriting){const r=c(t);return!n(r)||r.has(e.type)&&!p(e)}return!0}function m(e,t){if(p(e)){const n=r(\"featureCollection.layers\",t),i=n&&n[0]&&n[0].layerDefinition;i&&d(e,i)}else if(\"stream\"===e.type){d(e,t.layerDefinition=t.layerDefinition||{})}else\"group\"!==e.type&&d(e,t)}function d(e,t){\"maxScale\"in e&&(t.maxScale=i(e.maxScale)),\"minScale\"in e&&(t.minScale=i(e.minScale))}function f(e,t){if(m(e,t),\"blendMode\"in e&&(t.blendMode=e.blendMode,\"normal\"===t.blendMode&&delete t.blendMode),t.opacity=i(e.opacity),t.title=e.title||\"Layer\",t.visibility=e.visible,\"legendEnabled\"in e&&\"wmts\"!==e.type)if(p(e)){const n=t.featureCollection;n&&(n.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function y(r,i,o){if(!(\"write\"in r)||!r.write)return o&&o.messages&&o.messages.push(new e(\"layer:unsupported\",`Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted`,{layer:r})),null;if(u(r,o)){const e={};return r.write(e,o)?e:null}return n(i)&&f(r,i=t(i)),i}export{s as disableRestrictedWriting,a as enableRestrictedWriting,y as getLayerJSON};\n"]},"metadata":{},"sourceType":"module"}