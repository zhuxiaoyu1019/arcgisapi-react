{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport r from \"../../../../core/Error.js\";\nimport { isSome as s } from \"../../../../core/maybe.js\";\nimport \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as t } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { unpackFieldNames as o, populateMissingFields as p } from \"../../../../layers/support/fieldUtils.js\";\nimport { getFetchPopupTemplate as a, getRequiredFields as i } from \"../../../layers/support/popupUtils.js\";\n\nconst c = c => {\n  let u = class extends c {\n    _validateFetchPopupFeatures(e) {\n      const {\n        layer: s\n      } = this,\n            {\n        popupEnabled: t\n      } = s;\n      if (!t) return new r(\"scenelayerview3d:fetchPopupFeatures\", \"Popups are disabled\", {\n        layer: s\n      });\n      return a(s, e) ? void 0 : new r(\"scenelayerview3d:fetchPopupFeatures\", \"Layer does not define a popup template\", {\n        layer: s\n      });\n    }\n\n    async prepareFetchPopupFeatures(e) {}\n\n    async fetchPopupFeatures(e, r) {\n      const t = this._validateFetchPopupFeatures(r);\n\n      if (t) return Promise.reject(t);\n      const c = s(r) ? r.clientGraphics : null;\n      if (!c || 0 === c.length) return Promise.resolve([]);\n      const u = [],\n            n = [],\n            l = \"scene\" === this.layer.type && s(this.layer.associatedLayer) ? this.layer.associatedLayer : this.layer,\n            h = o(this.layer.fieldsIndex, await i(l, a(this.layer, r)));\n      await this.prepareFetchPopupFeatures(h);\n      const y = new Set();\n\n      for (const s of c) p(h, s, y) ? n.push(s) : u.push(s);\n\n      return 0 === n.length ? Promise.resolve(u) : this.whenGraphicAttributes(n, [...y]).catch(() => n).then(e => u.concat(e));\n    }\n\n  };\n  return u = e([t(\"esri.views.3d.layers.support.PopupSceneLayerView\")], u), u;\n};\n\nexport { c as PopupSceneLayerView };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js"],"names":["_","e","r","isSome","s","subclass","t","unpackFieldNames","o","populateMissingFields","p","getFetchPopupTemplate","a","getRequiredFields","i","c","u","_validateFetchPopupFeatures","layer","popupEnabled","prepareFetchPopupFeatures","fetchPopupFeatures","Promise","reject","clientGraphics","length","resolve","n","l","type","associatedLayer","h","fieldsIndex","y","Set","push","whenGraphicAttributes","catch","then","concat","PopupSceneLayerView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Error.js\";import{isSome as s}from\"../../../../core/maybe.js\";import\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as t}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{unpackFieldNames as o,populateMissingFields as p}from\"../../../../layers/support/fieldUtils.js\";import{getFetchPopupTemplate as a,getRequiredFields as i}from\"../../../layers/support/popupUtils.js\";const c=c=>{let u=class extends c{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:t}=s;if(!t)return new r(\"scenelayerview3d:fetchPopupFeatures\",\"Popups are disabled\",{layer:s});return a(s,e)?void 0:new r(\"scenelayerview3d:fetchPopupFeatures\",\"Layer does not define a popup template\",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,r){const t=this._validateFetchPopupFeatures(r);if(t)return Promise.reject(t);const c=s(r)?r.clientGraphics:null;if(!c||0===c.length)return Promise.resolve([]);const u=[],n=[],l=\"scene\"===this.layer.type&&s(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,h=o(this.layer.fieldsIndex,await i(l,a(this.layer,r)));await this.prepareFetchPopupFeatures(h);const y=new Set;for(const s of c)p(h,s,y)?n.push(s):u.push(s);return 0===n.length?Promise.resolve(u):this.whenGraphicAttributes(n,[...y]).catch((()=>n)).then((e=>u.concat(e)))}};return u=e([t(\"esri.views.3d.layers.support.PopupSceneLayerView\")],u),u};export{c as PopupSceneLayerView};\n"]},"metadata":{},"sourceType":"module"}