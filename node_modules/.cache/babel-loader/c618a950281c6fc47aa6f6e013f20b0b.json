{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../../chunks/tslib.es6.js\";\nimport { deg2rad as i } from \"../../../../../core/mathUtils.js\";\nimport { createScreenPointArray as e, screenPointObjectToArray as n, createRenderScreenPointArray3 as s } from \"../../../../../core/screenUtils.js\";\nimport { property as o } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as r } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { c as a } from \"../../../../../chunks/vec2.js\";\nimport { g as h, o as m, l as c, f as p, n as u, b as l, a as P, d } from \"../../../../../chunks/vec3.js\";\nimport { c as g } from \"../../../../../chunks/vec3f64.js\";\nimport { getReferenceEllipsoid as v } from \"../../../../../geometry/projectionEllipsoid.js\";\nimport { wrapAxisAngle as C } from \"../../../../../geometry/support/axisAngle.js\";\nimport { create as M, fromPositionAndNormal as S, normal as w } from \"../../../../../geometry/support/plane.js\";\nimport { c as b } from \"../../../../../chunks/sphere.js\";\nimport { disableContextNavigation as f } from \"../../../../../support/featureFlags.js\";\nimport { pixelDistanceToInteractionFactor as j, applyAll as y } from \"../../../camera/constraintUtils.js\";\nimport { ExponentialFalloff as k } from \"../../../input/util.js\";\nimport { InteractiveController as E } from \"../InteractiveController.js\";\nimport { PanPlanarMomentumController as O } from \"../momentum/PanPlanarMomentumController.js\";\nimport { PanSphericalMomentumController as z } from \"../momentum/PanSphericalMomentumController.js\";\nimport { RotationMomentumController as A } from \"../momentum/RotationMomentumController.js\";\nimport { ZoomPlanarMomentumController as R } from \"../momentum/ZoomPlanarMomentumController.js\";\nimport { ZoomSphericalMomentumController as x } from \"../momentum/ZoomSphericalMomentumController.js\";\nimport { NavigationMode as H, pickPointAndInitSphere as F, decideNavigationMode as T, sphereOrPlanePointFromScreenPoint as D, intersectPlaneFromScreenPoint as U, applyZoomOnSphere as I, preserveHeadingThreshold as G, applyPanSphericalPreserveHeading as Z, applyPanSphericalDirectRotation as V, normalizeRotationDelta as _, applyRotation as L, applyPanPlanar as q, applyZoomToPoint as B } from \"../../utils/navigationUtils.js\";\nimport { cyclicalPI as J } from \"../../../support/mathUtils.js\";\nimport K from \"../../../webgl-engine/lib/Camera.js\";\nimport { PanPlanarMomentumEstimator as N } from \"../../../../navigation/PanPlanarMomentumEstimator.js\";\nimport { PanSphericalMomentumEstimator as Q } from \"../../../../navigation/PanSphericalMomentumEstimator.js\";\nimport { RotationMomentumEstimator as W } from \"../../../../navigation/RotationMomentumEstimator.js\";\nimport { ZoomMomentumEstimator as X } from \"../../../../navigation/ZoomMomentumEstimator.js\";\nlet Y = class extends E {\n  constructor(t) {\n    super(t), this.view = null, this.smoothRotation = new k(.05), this.rotationAxis = g(), this.panningPlane = M(), this.smoothScaling = new k(.05), this.zoomCenterScreen = e(), this.zoomMomentumEstimator = new X(), this.rotationMomentumEstimator = new W(), this.panSphericalMomentumEstimator = new Q(), this.panPlanarMomentumEstimator = new N(), this.adjustedSphere = b(), this.tmp3d = g(), this.tmpScreenPointArray = e(), this.beginScreenPoint = e(), this.beginScenePoint = g(), this.screenPickPoint = e(), this.navMode = H.Horizontal, this.tmpInteractionDirection = g(), this.constraintOptions = {\n      selection: 15,\n      interactionType: 0,\n      interactionFactor: 0,\n      interactionStartCamera: new K(),\n      interactionDirection: null,\n      tiltMode: 0\n    };\n  }\n\n  get intersectionHelper() {\n    return this.view.sceneIntersectionHelper;\n  }\n\n  begin(t) {\n    if (!this.active) return;\n    const e = this.view.navigation.momentumEnabled;\n    this.zoomMomentumEstimator.enabled = e, this.rotationMomentumEstimator.enabled = e, this.panPlanarMomentumEstimator.enabled = e, this.panSphericalMomentumEstimator.enabled = e, this.beginHeading = -J.normalize(i(this.view.camera.heading)), this.beginRadius = t.radius, this.pointerCount = t.pointers.size, this.beginAngle = t.angle, this.smoothRotation.reset(), n(t.center, this.screenPickPoint), a(this.beginScreenPoint, this.screenPickPoint);\n    const s = v(this.view.spatialReference),\n          o = F(this.intersectionHelper, this.startCamera, this.screenPickPoint, !0, s);\n    this.scenePickPoint = o.scenePickPoint, this.sphere = o.sphere, h(this.beginScenePoint, this.scenePickPoint), this.navMode = T(this.startCamera, this.screenPickPoint, o.hasGeometryIntersection, s), this.navMode === H.Vertical && this.preparePlanarPanMode(t), this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera);\n  }\n\n  preparePlanarPanMode(t) {\n    const i = m(this.tmp3d, this.startCamera.viewForward);\n    S(this.scenePickPoint, i, this.panningPlane);\n    const o = e(this.screenPickPoint[0], 0),\n          r = g(),\n          a = c(this.startCamera.eye);\n    this.adjustedSphere[3] = a < this.sphere[3] ? a - 100 : this.sphere[3], D(this.adjustedSphere, this.startCamera, o, r);\n    const v = s();\n    this.startCamera.projectToRenderScreen(r, v);\n    const C = .9 * v[1];\n\n    if (this.screenPickPoint[1] = Math.min(this.screenPickPoint[1], C), this.intersectionHelper.intersectScreen(this.screenPickPoint, this.scenePickPoint) && S(this.scenePickPoint, w(this.panningPlane), this.panningPlane), !f()) {\n      const t = g(),\n            i = g(),\n            e = g(),\n            n = 80,\n            s = 5,\n            o = 50;\n      p(t, this.scenePickPoint, this.currentCamera.eye), u(t, t);\n\n      const r = s * Math.max(Math.abs(this.view.camera.position.z), o),\n            a = this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0], this.screenPickPoint[1], this.view.state.camera, n),\n            m = a ? Math.min(a, r) : r;\n\n      h(e, l(i, this.currentCamera.eye, P(i, t, m))), this.panningPlane[3] = -d(this.panningPlane, e), this.startCamera.center = l(i, this.startCamera.eye, P(i, this.startCamera.viewForward, m));\n    }\n\n    const M = n(t.center, this.tmpScreenPointArray);\n    U(this.panningPlane, this.startCamera, M, this.beginScenePoint);\n  }\n\n  update(t) {\n    if (!this.active) return;\n    this.currentCamera.copyFrom(this.startCamera);\n    const i = t.pointers.size > 1;\n    this.navMode === H.Horizontal ? (i && this.zoomSpherical(t), this.panningSpherical(t), i && this.rotateSpherical(t)) : (i && this.zoomPlanar(t), this.panningPlanar(t), i && this.rotatePlanar(t));\n  }\n\n  end(t) {\n    t.pointers.size === this.pointerCount && this.update(t), this.finishController();\n    const i = this.zoomMomentumEstimator.evaluateMomentum();\n    if (i) return this.navMode === H.Horizontal ? new x({\n      view: this.view,\n      momentum: i,\n      screenCenter: this.zoomCenterScreen,\n      sceneCenter: this.beginScenePoint,\n      radius: this.sphere[3]\n    }) : new R({\n      view: this.view,\n      momentum: i,\n      zoomCenter: this.beginScenePoint\n    });\n    const e = this.rotationMomentumEstimator.evaluateMomentum();\n    if (e) return new A({\n      view: this.view,\n      momentum: e,\n      center: this.sphere,\n      axis: this.rotationAxis\n    });\n\n    if (this.navMode === H.Horizontal) {\n      const t = this.panSphericalMomentumEstimator.evaluateMomentum();\n      if (t) return new z({\n        view: this.view,\n        momentum: t\n      });\n    } else {\n      const t = this.panPlanarMomentumEstimator.evaluateMomentum();\n      if (t) return new O({\n        view: this.view,\n        momentum: t\n      });\n    }\n\n    return null;\n  }\n\n  zoomSpherical(t) {\n    const i = this.beginRadius / t.radius,\n          e = .001875 * Math.min(Math.max(t.radius, 40), 120);\n    this.smoothScaling.gain = e, this.smoothScaling.update(i), I(this.sphere, this.currentCamera, this.smoothScaling.value), n(t.center, this.zoomCenterScreen), this.zoomMomentumEstimator.add(this.smoothScaling.value, .001 * t.timestamp), this.constraintOptions.interactionType = 1, this.constraintOptions.interactionFactor = j(t.radius - this.beginRadius), y(this.view, this.currentCamera, this.constraintOptions);\n  }\n\n  panningSpherical(t) {\n    const i = n(t.center, this.tmpScreenPointArray);\n    D(this.sphere, this.currentCamera, i, this.tmp3d), G(this.beginScenePoint, d(this.currentCamera.up, this.beginScenePoint), this.sphere[3], this.beginHeading, this.view.camera.tilt, this.startCamera) ? (Z(this.sphere, this.currentCamera, this.beginScenePoint, this.tmp3d, this.beginHeading, this.view.camera.tilt, !1), this.panSphericalMomentumEstimator.addMomentumPreserveHeading(i, this.tmp3d, .001 * t.timestamp, this.startCamera, this.sphere, this.beginHeading, this.view.camera.tilt)) : (V(this.sphere, this.currentCamera, this.beginScenePoint, this.tmp3d, this.view.camera.tilt, !1), this.panSphericalMomentumEstimator.addMomentumDirectRotation(i, this.tmp3d, .001 * t.timestamp, this.startCamera, this.sphere[3], this.view.camera.tilt)), this.constraintOptions.interactionType = 4, this.constraintOptions.interactionFactor = j(this.screenPickPoint, i), y(this.view, this.currentCamera, this.constraintOptions);\n  }\n\n  rotateSpherical(t) {\n    u(this.rotationAxis, this.scenePickPoint), this.currentCamera.aboveGround || m(this.rotationAxis, this.rotationAxis);\n\n    const i = this.smoothRotation.value,\n          e = i + _(t.angle - i),\n          n = .00125 * Math.min(Math.max(t.radius, 40), 120);\n\n    this.smoothRotation.gain = n, this.smoothRotation.update(e);\n    const s = this.smoothRotation.value - this.beginAngle;\n    this.rotationMomentumEstimator.add(s, .001 * t.timestamp), L(this.currentCamera, this.sphere, C(this.rotationAxis, s)), this.constraintOptions.interactionType = 2, this.constraintOptions.interactionFactor = j(t.radius * e), y(this.view, this.currentCamera, this.constraintOptions);\n  }\n\n  panningPlanar(t) {\n    const i = n(t.center, this.tmpScreenPointArray);\n    U(this.panningPlane, this.currentCamera, i, this.tmp3d) && (q(this.currentCamera, this.beginScenePoint, this.tmp3d), this.panPlanarMomentumEstimator.add(i, this.tmp3d, .001 * t.timestamp), this.constraintOptions.interactionType = 4, this.constraintOptions.interactionFactor = j(this.beginScreenPoint, i), this.constraintOptions.interactionDirection = this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye, this.tmpInteractionDirection), y(this.view, this.currentCamera, this.constraintOptions), this.constraintOptions.interactionDirection = null);\n  }\n\n  zoomPlanar(t) {\n    const i = this.beginRadius / t.radius,\n          e = .001875 * Math.min(Math.max(t.radius, 40), 120);\n    this.smoothScaling.gain = e, this.smoothScaling.update(i), this.zoomMomentumEstimator.add(this.smoothScaling.value, .001 * t.timestamp), B(this.currentCamera, this.beginScenePoint, this.smoothScaling.value, this.view.state.constraints.minimumPoiDistance), this.constraintOptions.interactionType = 1, this.constraintOptions.interactionFactor = j(t.radius - this.beginRadius), y(this.view, this.currentCamera, this.constraintOptions);\n  }\n\n  rotatePlanar(t) {\n    h(this.rotationAxis, this.beginScenePoint), this.currentCamera.aboveGround || m(this.rotationAxis, this.rotationAxis);\n    const i = this.smoothRotation.value;\n    let e = t.angle - i;\n    e = _(e);\n    const n = i + e,\n          s = .00125 * Math.min(Math.max(t.radius, 40), 120);\n    this.smoothRotation.gain = s, this.smoothRotation.update(n);\n    const o = this.smoothRotation.value - this.beginAngle;\n    this.rotationMomentumEstimator.add(o, .001 * t.timestamp), L(this.currentCamera, this.sphere, C(this.rotationAxis, o)), this.constraintOptions.interactionType = 2, this.constraintOptions.interactionFactor = j(t.radius * o), y(this.view, this.currentCamera, this.constraintOptions);\n  }\n\n};\nt([o({\n  constructOnly: !0\n})], Y.prototype, \"view\", void 0), Y = t([r(\"esri.views.3d.state.controllers.global.PinchAndPanController\")], Y);\nexport { Y as PinchAndPanController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/state/controllers/global/PinchAndPanController.js"],"names":["_","t","deg2rad","i","createScreenPointArray","e","screenPointObjectToArray","n","createRenderScreenPointArray3","s","property","o","subclass","r","c","a","g","h","m","l","f","p","u","b","P","d","getReferenceEllipsoid","v","wrapAxisAngle","C","create","M","fromPositionAndNormal","S","normal","w","disableContextNavigation","pixelDistanceToInteractionFactor","j","applyAll","y","ExponentialFalloff","k","InteractiveController","E","PanPlanarMomentumController","O","PanSphericalMomentumController","z","RotationMomentumController","A","ZoomPlanarMomentumController","R","ZoomSphericalMomentumController","x","NavigationMode","H","pickPointAndInitSphere","F","decideNavigationMode","T","sphereOrPlanePointFromScreenPoint","D","intersectPlaneFromScreenPoint","U","applyZoomOnSphere","I","preserveHeadingThreshold","G","applyPanSphericalPreserveHeading","Z","applyPanSphericalDirectRotation","V","normalizeRotationDelta","applyRotation","L","applyPanPlanar","q","applyZoomToPoint","B","cyclicalPI","J","K","PanPlanarMomentumEstimator","N","PanSphericalMomentumEstimator","Q","RotationMomentumEstimator","W","ZoomMomentumEstimator","X","Y","constructor","view","smoothRotation","rotationAxis","panningPlane","smoothScaling","zoomCenterScreen","zoomMomentumEstimator","rotationMomentumEstimator","panSphericalMomentumEstimator","panPlanarMomentumEstimator","adjustedSphere","tmp3d","tmpScreenPointArray","beginScreenPoint","beginScenePoint","screenPickPoint","navMode","Horizontal","tmpInteractionDirection","constraintOptions","selection","interactionType","interactionFactor","interactionStartCamera","interactionDirection","tiltMode","intersectionHelper","sceneIntersectionHelper","begin","active","navigation","momentumEnabled","enabled","beginHeading","normalize","camera","heading","beginRadius","radius","pointerCount","pointers","size","beginAngle","angle","reset","center","spatialReference","startCamera","scenePickPoint","sphere","hasGeometryIntersection","Vertical","preparePlanarPanMode","copyFrom","viewForward","eye","projectToRenderScreen","Math","min","intersectScreen","currentCamera","max","abs","position","_stage","renderView","getMinimalDepthForArea","state","update","zoomSpherical","panningSpherical","rotateSpherical","zoomPlanar","panningPlanar","rotatePlanar","end","finishController","evaluateMomentum","momentum","screenCenter","sceneCenter","zoomCenter","axis","gain","value","add","timestamp","up","tilt","addMomentumPreserveHeading","addMomentumDirectRotation","aboveGround","renderCoordsHelper","worldUpAtPosition","constraints","minimumPoiDistance","constructOnly","prototype","PinchAndPanController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../../chunks/tslib.es6.js\";import{deg2rad as i}from\"../../../../../core/mathUtils.js\";import{createScreenPointArray as e,screenPointObjectToArray as n,createRenderScreenPointArray3 as s}from\"../../../../../core/screenUtils.js\";import{property as o}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as r}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{c as a}from\"../../../../../chunks/vec2.js\";import{g as h,o as m,l as c,f as p,n as u,b as l,a as P,d}from\"../../../../../chunks/vec3.js\";import{c as g}from\"../../../../../chunks/vec3f64.js\";import{getReferenceEllipsoid as v}from\"../../../../../geometry/projectionEllipsoid.js\";import{wrapAxisAngle as C}from\"../../../../../geometry/support/axisAngle.js\";import{create as M,fromPositionAndNormal as S,normal as w}from\"../../../../../geometry/support/plane.js\";import{c as b}from\"../../../../../chunks/sphere.js\";import{disableContextNavigation as f}from\"../../../../../support/featureFlags.js\";import{pixelDistanceToInteractionFactor as j,applyAll as y}from\"../../../camera/constraintUtils.js\";import{ExponentialFalloff as k}from\"../../../input/util.js\";import{InteractiveController as E}from\"../InteractiveController.js\";import{PanPlanarMomentumController as O}from\"../momentum/PanPlanarMomentumController.js\";import{PanSphericalMomentumController as z}from\"../momentum/PanSphericalMomentumController.js\";import{RotationMomentumController as A}from\"../momentum/RotationMomentumController.js\";import{ZoomPlanarMomentumController as R}from\"../momentum/ZoomPlanarMomentumController.js\";import{ZoomSphericalMomentumController as x}from\"../momentum/ZoomSphericalMomentumController.js\";import{NavigationMode as H,pickPointAndInitSphere as F,decideNavigationMode as T,sphereOrPlanePointFromScreenPoint as D,intersectPlaneFromScreenPoint as U,applyZoomOnSphere as I,preserveHeadingThreshold as G,applyPanSphericalPreserveHeading as Z,applyPanSphericalDirectRotation as V,normalizeRotationDelta as _,applyRotation as L,applyPanPlanar as q,applyZoomToPoint as B}from\"../../utils/navigationUtils.js\";import{cyclicalPI as J}from\"../../../support/mathUtils.js\";import K from\"../../../webgl-engine/lib/Camera.js\";import{PanPlanarMomentumEstimator as N}from\"../../../../navigation/PanPlanarMomentumEstimator.js\";import{PanSphericalMomentumEstimator as Q}from\"../../../../navigation/PanSphericalMomentumEstimator.js\";import{RotationMomentumEstimator as W}from\"../../../../navigation/RotationMomentumEstimator.js\";import{ZoomMomentumEstimator as X}from\"../../../../navigation/ZoomMomentumEstimator.js\";let Y=class extends E{constructor(t){super(t),this.view=null,this.smoothRotation=new k(.05),this.rotationAxis=g(),this.panningPlane=M(),this.smoothScaling=new k(.05),this.zoomCenterScreen=e(),this.zoomMomentumEstimator=new X,this.rotationMomentumEstimator=new W,this.panSphericalMomentumEstimator=new Q,this.panPlanarMomentumEstimator=new N,this.adjustedSphere=b(),this.tmp3d=g(),this.tmpScreenPointArray=e(),this.beginScreenPoint=e(),this.beginScenePoint=g(),this.screenPickPoint=e(),this.navMode=H.Horizontal,this.tmpInteractionDirection=g(),this.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new K,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;const e=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=e,this.rotationMomentumEstimator.enabled=e,this.panPlanarMomentumEstimator.enabled=e,this.panSphericalMomentumEstimator.enabled=e,this.beginHeading=-J.normalize(i(this.view.camera.heading)),this.beginRadius=t.radius,this.pointerCount=t.pointers.size,this.beginAngle=t.angle,this.smoothRotation.reset(),n(t.center,this.screenPickPoint),a(this.beginScreenPoint,this.screenPickPoint);const s=v(this.view.spatialReference),o=F(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,s);this.scenePickPoint=o.scenePickPoint,this.sphere=o.sphere,h(this.beginScenePoint,this.scenePickPoint),this.navMode=T(this.startCamera,this.screenPickPoint,o.hasGeometryIntersection,s),this.navMode===H.Vertical&&this.preparePlanarPanMode(t),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}preparePlanarPanMode(t){const i=m(this.tmp3d,this.startCamera.viewForward);S(this.scenePickPoint,i,this.panningPlane);const o=e(this.screenPickPoint[0],0),r=g(),a=c(this.startCamera.eye);this.adjustedSphere[3]=a<this.sphere[3]?a-100:this.sphere[3],D(this.adjustedSphere,this.startCamera,o,r);const v=s();this.startCamera.projectToRenderScreen(r,v);const C=.9*v[1];if(this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],C),this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&S(this.scenePickPoint,w(this.panningPlane),this.panningPlane),!f()){const t=g(),i=g(),e=g(),n=80,s=5,o=50;p(t,this.scenePickPoint,this.currentCamera.eye),u(t,t);const r=s*Math.max(Math.abs(this.view.camera.position.z),o),a=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,n),m=a?Math.min(a,r):r;h(e,l(i,this.currentCamera.eye,P(i,t,m))),this.panningPlane[3]=-d(this.panningPlane,e),this.startCamera.center=l(i,this.startCamera.eye,P(i,this.startCamera.viewForward,m))}const M=n(t.center,this.tmpScreenPointArray);U(this.panningPlane,this.startCamera,M,this.beginScenePoint)}update(t){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=t.pointers.size>1;this.navMode===H.Horizontal?(i&&this.zoomSpherical(t),this.panningSpherical(t),i&&this.rotateSpherical(t)):(i&&this.zoomPlanar(t),this.panningPlanar(t),i&&this.rotatePlanar(t))}end(t){t.pointers.size===this.pointerCount&&this.update(t),this.finishController();const i=this.zoomMomentumEstimator.evaluateMomentum();if(i)return this.navMode===H.Horizontal?new x({view:this.view,momentum:i,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new R({view:this.view,momentum:i,zoomCenter:this.beginScenePoint});const e=this.rotationMomentumEstimator.evaluateMomentum();if(e)return new A({view:this.view,momentum:e,center:this.sphere,axis:this.rotationAxis});if(this.navMode===H.Horizontal){const t=this.panSphericalMomentumEstimator.evaluateMomentum();if(t)return new z({view:this.view,momentum:t})}else{const t=this.panPlanarMomentumEstimator.evaluateMomentum();if(t)return new O({view:this.view,momentum:t})}return null}zoomSpherical(t){const i=this.beginRadius/t.radius,e=.001875*Math.min(Math.max(t.radius,40),120);this.smoothScaling.gain=e,this.smoothScaling.update(i),I(this.sphere,this.currentCamera,this.smoothScaling.value),n(t.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*t.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=j(t.radius-this.beginRadius),y(this.view,this.currentCamera,this.constraintOptions)}panningSpherical(t){const i=n(t.center,this.tmpScreenPointArray);D(this.sphere,this.currentCamera,i,this.tmp3d),G(this.beginScenePoint,d(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Z(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this.tmp3d,.001*t.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(V(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(i,this.tmp3d,.001*t.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=j(this.screenPickPoint,i),y(this.view,this.currentCamera,this.constraintOptions)}rotateSpherical(t){u(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||m(this.rotationAxis,this.rotationAxis);const i=this.smoothRotation.value,e=i+_(t.angle-i),n=.00125*Math.min(Math.max(t.radius,40),120);this.smoothRotation.gain=n,this.smoothRotation.update(e);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*t.timestamp),L(this.currentCamera,this.sphere,C(this.rotationAxis,s)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=j(t.radius*e),y(this.view,this.currentCamera,this.constraintOptions)}panningPlanar(t){const i=n(t.center,this.tmpScreenPointArray);U(this.panningPlane,this.currentCamera,i,this.tmp3d)&&(q(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(i,this.tmp3d,.001*t.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=j(this.beginScreenPoint,i),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),y(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}zoomPlanar(t){const i=this.beginRadius/t.radius,e=.001875*Math.min(Math.max(t.radius,40),120);this.smoothScaling.gain=e,this.smoothScaling.update(i),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*t.timestamp),B(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=j(t.radius-this.beginRadius),y(this.view,this.currentCamera,this.constraintOptions)}rotatePlanar(t){h(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||m(this.rotationAxis,this.rotationAxis);const i=this.smoothRotation.value;let e=t.angle-i;e=_(e);const n=i+e,s=.00125*Math.min(Math.max(t.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(n);const o=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(o,.001*t.timestamp),L(this.currentCamera,this.sphere,C(this.rotationAxis,o)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=j(t.radius*o),y(this.view,this.currentCamera,this.constraintOptions)}};t([o({constructOnly:!0})],Y.prototype,\"view\",void 0),Y=t([r(\"esri.views.3d.state.controllers.global.PinchAndPanController\")],Y);export{Y as PinchAndPanController};\n"]},"metadata":{},"sourceType":"module"}