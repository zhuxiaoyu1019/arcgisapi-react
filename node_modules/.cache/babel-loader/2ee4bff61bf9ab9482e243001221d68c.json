{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../config.js\";\nimport r from \"../../request.js\";\nimport { throwIfAborted as s } from \"../../core/promiseUtils.js\";\nimport { urlToObject as t, removeTrailingSlash as o, getOrigin as l, isProtocolRelative as n, isAbsolute as i, join as u, normalize as c, removeFile as a, appBaseUrl as f } from \"../../core/urlUtils.js\";\nimport p from \"../../views/2d/engine/vectorTiles/style/VectorTileSource.js\";\nconst m = e.defaults && e.defaults.io.corsEnabledServers;\n\nasync function y(e, r) {\n  const s = {\n    source: null,\n    sourceBase: null,\n    sourceUrl: null,\n    validatedSource: null,\n    style: null,\n    styleBase: null,\n    styleUrl: null,\n    sourceNameToSource: {},\n    primarySourceName: \"\",\n    spriteFormat: \"png\"\n  },\n        [o, l] = \"string\" == typeof e ? [e, null] : [null, e.jsonUrl],\n        n = o ? t(o) : null;\n  await h(s, \"esri\", e, l, r);\n  const i = {\n    layerDefinition: s.validatedSource,\n    url: o,\n    parsedUrl: n,\n    serviceUrl: s.sourceUrl,\n    style: s.style,\n    styleUrl: s.styleUrl,\n    spriteUrl: s.style.sprite && S(s.styleBase, s.style.sprite),\n    spriteFormat: s.spriteFormat,\n    glyphsUrl: s.style.glyphs && S(s.styleBase, s.style.glyphs),\n    sourceNameToSource: s.sourceNameToSource,\n    primarySourceName: s.primarySourceName\n  };\n  return d(i.spriteUrl), d(i.glyphsUrl), i;\n}\n\nfunction d(e) {\n  if (!e) return;\n  const r = l(e);\n  m && -1 === m.indexOf(r) && m.push(r);\n}\n\nfunction S(...e) {\n  let r;\n\n  for (let s = 0; s < e.length; ++s) if (n(e[s])) {\n    if (r) {\n      const t = r.split(\"://\")[0];\n      r = t + \":\" + e[s].trim();\n    }\n  } else r = i(e[s]) ? e[s] : u(r, e[s]);\n\n  return o(r);\n}\n\nasync function h(e, o, l, n, i) {\n  let u, a, f;\n\n  if (s(i), \"string\" == typeof l) {\n    const e = c(l);\n    d(e);\n    const s = t(e);\n    f = await r(s.path, {\n      query: {\n        f: \"json\"\n      },\n      responseType: \"json\",\n      ...i\n    }), u = e, a = e;\n  } else f = {\n    data: l\n  }, u = l.jsonUrl || null, a = n;\n\n  const p = f.data;\n  return f.ssl && (u && (u = u.replace(/^http:/i, \"https:\")), a && (a = a.replace(/^http:/i, \"https:\"))), U(p) ? (e.styleUrl = u || null, w(e, p, a, i)) : x(p) ? e.sourceUrl ? g(e, p, a, !1, o, i) : (e.sourceUrl = u || null, g(e, p, a, !0, o, i)) : Promise.reject(\"You must specify the URL or the JSON for a service or for a style.\");\n}\n\nfunction U(e) {\n  return !!e.sources;\n}\n\nfunction x(e) {\n  return !U(e);\n}\n\nasync function w(e, r, s, t) {\n  const o = s ? a(s) : f;\n  e.styleBase = o, e.style = r, e.styleUrl && d(e.styleUrl), r[\"sprite-format\"] && \"webp\" === r[\"sprite-format\"].toLowerCase() && (e.spriteFormat = \"webp\");\n  const l = [];\n\n  if (r.sources && r.sources.esri) {\n    const s = r.sources.esri;\n    s.url ? await h(e, \"esri\", S(o, s.url), void 0, t) : l.push(h(e, \"esri\", s, o, t));\n  }\n\n  for (const n of Object.keys(r.sources)) \"esri\" !== n && \"vector\" === r.sources[n].type && (r.sources[n].url ? l.push(h(e, n, S(o, r.sources[n].url), void 0, t)) : r.sources[n].tiles && l.push(h(e, n, r.sources[n], o, t)));\n\n  await Promise.all(l);\n}\n\nasync function g(e, r, s, t, l, n) {\n  const i = s ? o(s) + \"/\" : f,\n        u = j(r, i),\n        c = new p(l, i, u);\n\n  if (!t && e.primarySourceName in e.sourceNameToSource) {\n    const r = e.sourceNameToSource[e.primarySourceName];\n    if (!r.isCompatibleWith(c)) return Promise.resolve();\n    null != c.fullExtent && (null != r.fullExtent ? r.fullExtent.union(c.fullExtent) : r.fullExtent = c.fullExtent.clone()), r.tileInfo.lods.length < c.tileInfo.lods.length && (r.tileInfo = c.tileInfo);\n  }\n\n  if (t ? (e.sourceBase = i, e.source = r, e.validatedSource = u, e.primarySourceName = l, e.sourceUrl && d(e.sourceUrl)) : d(i), e.sourceNameToSource[l] = c, !e.style) return null == r.defaultStyles ? Promise.reject() : \"string\" == typeof r.defaultStyles ? h(e, \"\", S(i, r.defaultStyles, \"root.json\"), void 0, n) : h(e, \"\", r.defaultStyles, S(i, \"root.json\"), n);\n}\n\nfunction j(e, r) {\n  if (e.hasOwnProperty(\"tileInfo\")) return e;\n  const s = {\n    xmin: -20037507.067161843,\n    ymin: -20037507.067161843,\n    xmax: 20037507.067161843,\n    ymax: 20037507.067161843,\n    spatialReference: {\n      wkid: 102100\n    }\n  },\n        t = 512;\n  let o = 78271.51696400007,\n      l = 295828763.7957775;\n  const n = [],\n        i = e.hasOwnProperty(\"minzoom\") ? parseFloat(e.minzoom) : 0,\n        u = e.hasOwnProperty(\"maxzoom\") ? parseFloat(e.maxzoom) : 22;\n\n  for (let c = 0; c <= u; c++) c >= i && n.push({\n    level: c,\n    scale: l,\n    resolution: o\n  }), o /= 2, l /= 2;\n\n  for (const c of e.tiles) d(S(r, c));\n\n  return {\n    capabilities: \"TilesOnly\",\n    initialExtent: s,\n    fullExtent: s,\n    minScale: 0,\n    maxScale: 0,\n    tiles: e.tiles,\n    tileInfo: {\n      rows: t,\n      cols: t,\n      dpi: 96,\n      format: \"pbf\",\n      origin: {\n        x: -20037508.342787,\n        y: 20037508.342787\n      },\n      lods: n,\n      spatialReference: {\n        wkid: 102100\n      }\n    }\n  };\n}\n\nexport { y as loadMetadata };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/support/vectorTileLayerLoader.js"],"names":["e","r","throwIfAborted","s","urlToObject","t","removeTrailingSlash","o","getOrigin","l","isProtocolRelative","n","isAbsolute","i","join","u","normalize","c","removeFile","a","appBaseUrl","f","p","m","defaults","io","corsEnabledServers","y","source","sourceBase","sourceUrl","validatedSource","style","styleBase","styleUrl","sourceNameToSource","primarySourceName","spriteFormat","jsonUrl","h","layerDefinition","url","parsedUrl","serviceUrl","spriteUrl","sprite","S","glyphsUrl","glyphs","d","indexOf","push","length","split","trim","path","query","responseType","data","ssl","replace","U","w","x","g","Promise","reject","sources","toLowerCase","esri","Object","keys","type","tiles","all","j","isCompatibleWith","resolve","fullExtent","union","clone","tileInfo","lods","defaultStyles","hasOwnProperty","xmin","ymin","xmax","ymax","spatialReference","wkid","parseFloat","minzoom","maxzoom","level","scale","resolution","capabilities","initialExtent","minScale","maxScale","rows","cols","dpi","format","origin","loadMetadata"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../config.js\";import r from\"../../request.js\";import{throwIfAborted as s}from\"../../core/promiseUtils.js\";import{urlToObject as t,removeTrailingSlash as o,getOrigin as l,isProtocolRelative as n,isAbsolute as i,join as u,normalize as c,removeFile as a,appBaseUrl as f}from\"../../core/urlUtils.js\";import p from\"../../views/2d/engine/vectorTiles/style/VectorTileSource.js\";const m=e.defaults&&e.defaults.io.corsEnabledServers;async function y(e,r){const s={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:\"\",spriteFormat:\"png\"},[o,l]=\"string\"==typeof e?[e,null]:[null,e.jsonUrl],n=o?t(o):null;await h(s,\"esri\",e,l,r);const i={layerDefinition:s.validatedSource,url:o,parsedUrl:n,serviceUrl:s.sourceUrl,style:s.style,styleUrl:s.styleUrl,spriteUrl:s.style.sprite&&S(s.styleBase,s.style.sprite),spriteFormat:s.spriteFormat,glyphsUrl:s.style.glyphs&&S(s.styleBase,s.style.glyphs),sourceNameToSource:s.sourceNameToSource,primarySourceName:s.primarySourceName};return d(i.spriteUrl),d(i.glyphsUrl),i}function d(e){if(!e)return;const r=l(e);m&&-1===m.indexOf(r)&&m.push(r)}function S(...e){let r;for(let s=0;s<e.length;++s)if(n(e[s])){if(r){const t=r.split(\"://\")[0];r=t+\":\"+e[s].trim()}}else r=i(e[s])?e[s]:u(r,e[s]);return o(r)}async function h(e,o,l,n,i){let u,a,f;if(s(i),\"string\"==typeof l){const e=c(l);d(e);const s=t(e);f=await r(s.path,{query:{f:\"json\"},responseType:\"json\",...i}),u=e,a=e}else f={data:l},u=l.jsonUrl||null,a=n;const p=f.data;return f.ssl&&(u&&(u=u.replace(/^http:/i,\"https:\")),a&&(a=a.replace(/^http:/i,\"https:\"))),U(p)?(e.styleUrl=u||null,w(e,p,a,i)):x(p)?e.sourceUrl?g(e,p,a,!1,o,i):(e.sourceUrl=u||null,g(e,p,a,!0,o,i)):Promise.reject(\"You must specify the URL or the JSON for a service or for a style.\")}function U(e){return!!e.sources}function x(e){return!U(e)}async function w(e,r,s,t){const o=s?a(s):f;e.styleBase=o,e.style=r,e.styleUrl&&d(e.styleUrl),r[\"sprite-format\"]&&\"webp\"===r[\"sprite-format\"].toLowerCase()&&(e.spriteFormat=\"webp\");const l=[];if(r.sources&&r.sources.esri){const s=r.sources.esri;s.url?await h(e,\"esri\",S(o,s.url),void 0,t):l.push(h(e,\"esri\",s,o,t))}for(const n of Object.keys(r.sources))\"esri\"!==n&&\"vector\"===r.sources[n].type&&(r.sources[n].url?l.push(h(e,n,S(o,r.sources[n].url),void 0,t)):r.sources[n].tiles&&l.push(h(e,n,r.sources[n],o,t)));await Promise.all(l)}async function g(e,r,s,t,l,n){const i=s?o(s)+\"/\":f,u=j(r,i),c=new p(l,i,u);if(!t&&e.primarySourceName in e.sourceNameToSource){const r=e.sourceNameToSource[e.primarySourceName];if(!r.isCompatibleWith(c))return Promise.resolve();null!=c.fullExtent&&(null!=r.fullExtent?r.fullExtent.union(c.fullExtent):r.fullExtent=c.fullExtent.clone()),r.tileInfo.lods.length<c.tileInfo.lods.length&&(r.tileInfo=c.tileInfo)}if(t?(e.sourceBase=i,e.source=r,e.validatedSource=u,e.primarySourceName=l,e.sourceUrl&&d(e.sourceUrl)):d(i),e.sourceNameToSource[l]=c,!e.style)return null==r.defaultStyles?Promise.reject():\"string\"==typeof r.defaultStyles?h(e,\"\",S(i,r.defaultStyles,\"root.json\"),void 0,n):h(e,\"\",r.defaultStyles,S(i,\"root.json\"),n)}function j(e,r){if(e.hasOwnProperty(\"tileInfo\"))return e;const s={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100}},t=512;let o=78271.51696400007,l=295828763.7957775;const n=[],i=e.hasOwnProperty(\"minzoom\")?parseFloat(e.minzoom):0,u=e.hasOwnProperty(\"maxzoom\")?parseFloat(e.maxzoom):22;for(let c=0;c<=u;c++)c>=i&&n.push({level:c,scale:l,resolution:o}),o/=2,l/=2;for(const c of e.tiles)d(S(r,c));return{capabilities:\"TilesOnly\",initialExtent:s,fullExtent:s,minScale:0,maxScale:0,tiles:e.tiles,tileInfo:{rows:t,cols:t,dpi:96,format:\"pbf\",origin:{x:-20037508.342787,y:20037508.342787},lods:n,spatialReference:{wkid:102100}}}}export{y as loadMetadata};\n"]},"metadata":{},"sourceType":"module"}