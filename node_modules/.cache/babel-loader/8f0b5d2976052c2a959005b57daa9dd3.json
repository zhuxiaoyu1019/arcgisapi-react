{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../Color.js\";\nimport a from \"../../../Graphic.js\";\nimport { neverReached as r } from \"../../../core/compilerUtils.js\";\nimport i from \"../../../core/Logger.js\";\nimport { isSome as n, isNone as t } from \"../../../core/maybe.js\";\nimport { meterIn as s } from \"../../support/lengthUtils.js\";\nimport { isSizeVariable as o, isValidNumber as l } from \"./sizeVariableUtils.js\";\nconst c = i.getLogger(\"esri.renderers.visualVariables.support.visualVariableUtils\"),\n      u = new a(),\n      f = Math.PI,\n      p = /^\\s*(return\\s+)?\\$view\\.scale\\s*(;)?\\s*$/i;\n\nfunction d(a, r, i) {\n  const t = \"visualVariables\" in a && a.visualVariables ? a.visualVariables.filter(e => \"color\" === e.type)[0] : a;\n  if (!t) return;\n  if (\"esri.renderers.visualVariables.ColorVariable\" !== t.declaredClass) return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable\");\n  const s = \"number\" == typeof r,\n        o = s ? null : r,\n        l = o && o.attributes;\n  let u = s ? r : null;\n  const f = t.field,\n        {\n    ipData: p,\n    hasExpression: d\n  } = t.cache;\n  let v = t.cache.compiledFunc;\n\n  if (!f && !d) {\n    const e = t.stops;\n    return e && e[0] && e[0].color;\n  }\n\n  if (\"number\" != typeof u) if (d) {\n    if (!n(i) || !n(i.arcade)) return void c.error(\"Use of arcade expressions requires an arcade context\");\n    const e = {\n      viewingMode: i.viewingMode,\n      scale: i.scale,\n      spatialReference: i.spatialReference\n    },\n          a = i.arcade.arcadeUtils,\n          r = a.getViewInfo(e),\n          s = a.createExecContext(o, r);\n\n    if (!v) {\n      const e = a.createSyntaxTree(t.valueExpression);\n      v = a.createFunction(e), t.cache.compiledFunc = v;\n    }\n\n    u = a.executeFunction(v, s);\n  } else l && (u = l[f]);\n  const b = t.normalizationField,\n        h = l ? parseFloat(l[b]) : void 0;\n\n  if (null != u && (!b || s || !isNaN(h) && 0 !== h)) {\n    isNaN(h) || s || (u /= h);\n    const a = C(u, p);\n\n    if (a) {\n      const r = a[0],\n            s = a[1],\n            o = r === s ? t.stops[r].color : e.blendColors(t.stops[r].color, t.stops[s].color, a[2], n(i) ? i.color : void 0);\n      return new e(o);\n    }\n  }\n}\n\nfunction v(e, a, r) {\n  const i = \"visualVariables\" in e && e.visualVariables ? e.visualVariables.filter(e => \"opacity\" === e.type)[0] : e;\n  if (!i) return;\n  if (\"esri.renderers.visualVariables.OpacityVariable\" !== i.declaredClass) return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable\");\n  const n = \"number\" == typeof a,\n        s = n ? null : a,\n        o = s && s.attributes;\n  let l = n ? a : null;\n  const u = i.field,\n        {\n    ipData: f,\n    hasExpression: p\n  } = i.cache;\n  let d = i.cache.compiledFunc;\n\n  if (!u && !p) {\n    const e = i.stops;\n    return e && e[0] && e[0].opacity;\n  }\n\n  if (\"number\" != typeof l) if (p) {\n    if (t(r) || t(r.arcade)) return void c.error(\"Use of arcade expressions requires an arcade context\");\n    const e = {\n      viewingMode: r.viewingMode,\n      scale: r.scale,\n      spatialReference: r.spatialReference\n    },\n          a = r.arcade.arcadeUtils,\n          n = a.getViewInfo(e),\n          o = a.createExecContext(s, n);\n\n    if (!d) {\n      const e = a.createSyntaxTree(i.valueExpression);\n      d = a.createFunction(e), i.cache.compiledFunc = d;\n    }\n\n    l = a.executeFunction(d, o);\n  } else o && (l = o[u]);\n  const v = i.normalizationField,\n        b = o ? parseFloat(o[v]) : void 0;\n\n  if (null != l && (!v || n || !isNaN(b) && 0 !== b)) {\n    isNaN(b) || n || (l /= b);\n    const e = C(l, f);\n\n    if (e) {\n      const a = e[0],\n            r = e[1];\n      if (a === r) return i.stops[a].opacity;\n      {\n        const n = i.stops[a].opacity;\n        return n + (i.stops[r].opacity - n) * e[2];\n      }\n    }\n  }\n}\n\nfunction b(e, a, r) {\n  const i = \"visualVariables\" in e && e.visualVariables ? e.visualVariables.filter(e => \"rotation\" === e.type)[0] : e;\n  if (!i) return;\n  if (\"esri.renderers.visualVariables.RotationVariable\" !== i.declaredClass) return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable\");\n  const n = i.axis || \"heading\",\n        s = \"heading\" === n && \"arithmetic\" === i.rotationType ? 90 : 0,\n        o = \"heading\" === n && \"arithmetic\" === i.rotationType ? -1 : 1,\n        l = \"number\" == typeof a ? null : a,\n        u = l && l.attributes,\n        f = i.field,\n        {\n    hasExpression: p\n  } = i.cache;\n  let d = i.cache.compiledFunc,\n      v = 0;\n  if (!f && !p) return v;\n\n  if (p) {\n    if (t(r) || t(r.arcade)) return void c.error(\"Use of arcade expressions requires an arcade context\");\n    const e = {\n      viewingMode: r.viewingMode,\n      scale: r.scale,\n      spatialReference: r.spatialReference\n    },\n          a = r.arcade.arcadeUtils,\n          n = a.getViewInfo(e),\n          s = a.createExecContext(l, n);\n\n    if (!d) {\n      const e = a.createSyntaxTree(i.valueExpression);\n      d = a.createFunction(e), i.cache.compiledFunc = d;\n    }\n\n    v = a.executeFunction(d, s);\n  } else u && (v = u[f] || 0);\n\n  return v = \"number\" != typeof v || isNaN(v) ? null : s + o * v, v;\n}\n\nfunction h(e, a, r) {\n  const i = \"number\" == typeof a,\n        s = i ? null : a,\n        o = s && s.attributes;\n  let u = i ? a : null;\n  const {\n    isScaleDriven: f\n  } = e.cache;\n  let p = e.cache.compiledFunc;\n\n  if (f) {\n    const a = n(r) ? r.scale : void 0,\n          i = n(r) ? r.view : void 0;\n    u = null == a || \"3d\" === i ? m(e) : a;\n  } else if (!i) switch (e.inputValueType) {\n    case \"expression\":\n      {\n        if (t(r) || t(r.arcade)) return void c.error(\"Use of arcade expressions requires an arcade context\");\n        const a = {\n          viewingMode: r.viewingMode,\n          scale: r.scale,\n          spatialReference: r.spatialReference\n        },\n              i = r.arcade.arcadeUtils,\n              n = i.getViewInfo(a),\n              o = i.createExecContext(s, n);\n\n        if (!p) {\n          const a = i.createSyntaxTree(e.valueExpression);\n          p = i.createFunction(a), e.cache.compiledFunc = p;\n        }\n\n        u = i.executeFunction(p, o);\n        break;\n      }\n\n    case \"field\":\n      o && (u = o[e.field]);\n      break;\n\n    case \"unknown\":\n      u = null;\n  }\n\n  if (!l(u)) return null;\n  if (i || !e.normalizationField) return u;\n  const d = o ? parseFloat(o[e.normalizationField]) : null;\n  return l(d) && 0 !== d ? u / d : null;\n}\n\nfunction m(e) {\n  let a = null,\n      r = null;\n  const i = e.stops;\n  return i ? (a = i[0].value, r = i[i.length - 1].value) : (a = e.minDataValue || 0, r = e.maxDataValue || 0), (a + r) / 2;\n}\n\nfunction V(e, a, r) {\n  const i = \"visualVariables\" in e && e.visualVariables ? e.visualVariables.filter(e => \"size\" === e.type)[0] : e;\n  if (!i) return;\n  if (\"esri.renderers.visualVariables.SizeVariable\" !== i.declaredClass) return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable\");\n  const n = M(h(i, a, r), i, a, r, i.cache.ipData);\n  return null == n || isNaN(n) ? 0 : n;\n}\n\nfunction x(e, a, r) {\n  return null == e ? null : o(e) ? V(e, a, r) : l(e) ? e : null;\n}\n\nfunction y(e, a, r) {\n  return l(r) && e > r ? r : l(a) && e < a ? a : e;\n}\n\nfunction w(e, a, r, i) {\n  return e + (x(a.minSize, r, i) || a.minDataValue);\n}\n\nfunction g(e, a, r) {\n  const i = e.stops;\n  let n = i && i.length && i[0].size;\n  return null == n && (n = e.minSize), x(n, a, r);\n}\n\nfunction z(e, a, r, i) {\n  const t = (e - a.minDataValue) / (a.maxDataValue - a.minDataValue),\n        s = x(a.minSize, r, i),\n        o = x(a.maxSize, r, i),\n        l = n(i) ? i.shape : void 0;\n  if (e <= a.minDataValue) return s;\n  if (e >= a.maxDataValue) return o;\n\n  if (\"area\" === a.scaleBy && l) {\n    const e = \"circle\" === l,\n          a = e ? f * (s / 2) ** 2 : s * s,\n          r = a + t * ((e ? f * (o / 2) ** 2 : o * o) - a);\n    return e ? 2 * Math.sqrt(r / f) : Math.sqrt(r);\n  }\n\n  return s + t * (o - s);\n}\n\nfunction F(e, a, r, i) {\n  const t = n(i) ? i.shape : void 0,\n        s = e / a.minDataValue,\n        o = x(a.minSize, r, i),\n        l = x(a.maxSize, r, i);\n  let c = null;\n  return c = \"circle\" === t ? 2 * Math.sqrt(s * (o / 2) ** 2) : \"square\" === t || \"diamond\" === t || \"image\" === t ? Math.sqrt(s * o ** 2) : s * o, y(c, o, l);\n}\n\nfunction S(e, a, r, i, n) {\n  const [t, s, o] = C(e, n);\n  if (t === s) return x(a.stops[t].size, r, i);\n  {\n    const e = x(a.stops[t].size, r, i);\n    return e + (x(a.stops[s].size, r, i) - e) * o;\n  }\n}\n\nfunction E(e, a, r, i) {\n  const t = (n(i) && i.resolution ? i.resolution : 1) * s[a.valueUnit],\n        o = x(a.minSize, r, i),\n        l = x(a.maxSize, r, i),\n        {\n    valueRepresentation: c\n  } = a;\n  let u = null;\n  return u = \"area\" === c ? 2 * Math.sqrt(e / f) / t : \"radius\" === c || \"distance\" === c ? 2 * e / t : e / t, y(u, o, l);\n}\n\nfunction D(e) {\n  return e;\n}\n\nfunction M(e, a, r, i, n) {\n  switch (a.transformationType) {\n    case \"additive\":\n      return w(e, a, r, i);\n\n    case \"constant\":\n      return g(a, r, i);\n\n    case \"clamped-linear\":\n      return z(e, a, r, i);\n\n    case \"proportional\":\n      return F(e, a, r, i);\n\n    case \"stops\":\n      return S(e, a, r, i, n);\n\n    case \"real-world-size\":\n      return E(e, a, r, i);\n\n    case \"identity\":\n      return D(e);\n\n    case \"unknown\":\n      return null;\n  }\n}\n\nfunction U(e, a, r) {\n  const {\n    isScaleDriven: i\n  } = e.cache;\n  if (!(i && \"3d\" === r || a)) return null;\n  const n = {\n    scale: a,\n    view: r\n  };\n  let t = x(e.minSize, u, n),\n      s = x(e.maxSize, u, n);\n\n  if (null != t || null != s) {\n    if (t > s) {\n      const e = s;\n      s = t, t = e;\n    }\n\n    return {\n      minSize: t,\n      maxSize: s\n    };\n  }\n}\n\nfunction k(e, a, r) {\n  if (!e.visualVariables) return;\n  const i = [],\n        n = [],\n        t = [],\n        s = [],\n        o = [];\n\n  for (const l of e.visualVariables) switch (l.type) {\n    case \"color\":\n      n.push(l);\n      break;\n\n    case \"opacity\":\n      t.push(l);\n      break;\n\n    case \"rotation\":\n      o.push(l);\n      break;\n\n    case \"size\":\n      s.push(l);\n  }\n\n  return n.forEach(e => {\n    const n = d(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), t.forEach(e => {\n    const n = v(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), o.forEach(e => {\n    const n = b(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), s.forEach(e => {\n    const n = V(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), i.filter(e => null != e.value);\n}\n\nfunction C(e, a) {\n  if (!a) return;\n  let r = 0,\n      i = a.length - 1;\n  return a.some((a, n) => e < a ? (i = n, !0) : (r = n, !1)), [r, i, (e - a[r]) / (a[i] - a[r])];\n}\n\nfunction N(e, a, i) {\n  const n = [\"proportional\", \"proportional\", \"proportional\"];\n\n  for (const t of e) {\n    const e = t.useSymbolValue ? \"symbol-value\" : V(t, a, i);\n\n    switch (t.axis) {\n      case \"width\":\n        n[0] = e;\n        break;\n\n      case \"depth\":\n        n[1] = e;\n        break;\n\n      case \"height\":\n        n[2] = e;\n        break;\n\n      case \"width-and-depth\":\n        n[0] = e, n[1] = e;\n        break;\n\n      case \"all\":\n      case void 0:\n      case null:\n        n[0] = e, n[1] = e, n[2] = e;\n        break;\n\n      default:\n        r(t.axis);\n    }\n  }\n\n  return n;\n}\n\nexport { N as getAllSizes, d as getColor, v as getOpacity, b as getRotationAngle, V as getSize, M as getSizeForValue, x as getSizeFromNumberOrVariable, U as getSizeRangeAtScale, k as getVisualVariableValues, p as viewScaleRE };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"],"names":["e","a","neverReached","r","i","isSome","n","isNone","t","meterIn","s","isSizeVariable","o","isValidNumber","l","c","getLogger","u","f","Math","PI","p","d","visualVariables","filter","type","declaredClass","warn","attributes","field","ipData","hasExpression","cache","v","compiledFunc","stops","color","arcade","error","viewingMode","scale","spatialReference","arcadeUtils","getViewInfo","createExecContext","createSyntaxTree","valueExpression","createFunction","executeFunction","b","normalizationField","h","parseFloat","isNaN","C","blendColors","opacity","axis","rotationType","isScaleDriven","view","m","inputValueType","value","length","minDataValue","maxDataValue","V","M","x","y","w","minSize","g","size","z","maxSize","shape","scaleBy","sqrt","F","S","E","resolution","valueUnit","valueRepresentation","D","transformationType","U","k","push","forEach","variable","some","N","useSymbolValue","getAllSizes","getColor","getOpacity","getRotationAngle","getSize","getSizeForValue","getSizeFromNumberOrVariable","getSizeRangeAtScale","getVisualVariableValues","viewScaleRE"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../Color.js\";import a from\"../../../Graphic.js\";import{neverReached as r}from\"../../../core/compilerUtils.js\";import i from\"../../../core/Logger.js\";import{isSome as n,isNone as t}from\"../../../core/maybe.js\";import{meterIn as s}from\"../../support/lengthUtils.js\";import{isSizeVariable as o,isValidNumber as l}from\"./sizeVariableUtils.js\";const c=i.getLogger(\"esri.renderers.visualVariables.support.visualVariableUtils\"),u=new a,f=Math.PI,p=/^\\s*(return\\s+)?\\$view\\.scale\\s*(;)?\\s*$/i;function d(a,r,i){const t=\"visualVariables\"in a&&a.visualVariables?a.visualVariables.filter((e=>\"color\"===e.type))[0]:a;if(!t)return;if(\"esri.renderers.visualVariables.ColorVariable\"!==t.declaredClass)return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable\");const s=\"number\"==typeof r,o=s?null:r,l=o&&o.attributes;let u=s?r:null;const f=t.field,{ipData:p,hasExpression:d}=t.cache;let v=t.cache.compiledFunc;if(!f&&!d){const e=t.stops;return e&&e[0]&&e[0].color}if(\"number\"!=typeof u)if(d){if(!n(i)||!n(i.arcade))return void c.error(\"Use of arcade expressions requires an arcade context\");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},a=i.arcade.arcadeUtils,r=a.getViewInfo(e),s=a.createExecContext(o,r);if(!v){const e=a.createSyntaxTree(t.valueExpression);v=a.createFunction(e),t.cache.compiledFunc=v}u=a.executeFunction(v,s)}else l&&(u=l[f]);const b=t.normalizationField,h=l?parseFloat(l[b]):void 0;if(null!=u&&(!b||s||!isNaN(h)&&0!==h)){isNaN(h)||s||(u/=h);const a=C(u,p);if(a){const r=a[0],s=a[1],o=r===s?t.stops[r].color:e.blendColors(t.stops[r].color,t.stops[s].color,a[2],n(i)?i.color:void 0);return new e(o)}}}function v(e,a,r){const i=\"visualVariables\"in e&&e.visualVariables?e.visualVariables.filter((e=>\"opacity\"===e.type))[0]:e;if(!i)return;if(\"esri.renderers.visualVariables.OpacityVariable\"!==i.declaredClass)return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable\");const n=\"number\"==typeof a,s=n?null:a,o=s&&s.attributes;let l=n?a:null;const u=i.field,{ipData:f,hasExpression:p}=i.cache;let d=i.cache.compiledFunc;if(!u&&!p){const e=i.stops;return e&&e[0]&&e[0].opacity}if(\"number\"!=typeof l)if(p){if(t(r)||t(r.arcade))return void c.error(\"Use of arcade expressions requires an arcade context\");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},a=r.arcade.arcadeUtils,n=a.getViewInfo(e),o=a.createExecContext(s,n);if(!d){const e=a.createSyntaxTree(i.valueExpression);d=a.createFunction(e),i.cache.compiledFunc=d}l=a.executeFunction(d,o)}else o&&(l=o[u]);const v=i.normalizationField,b=o?parseFloat(o[v]):void 0;if(null!=l&&(!v||n||!isNaN(b)&&0!==b)){isNaN(b)||n||(l/=b);const e=C(l,f);if(e){const a=e[0],r=e[1];if(a===r)return i.stops[a].opacity;{const n=i.stops[a].opacity;return n+(i.stops[r].opacity-n)*e[2]}}}}function b(e,a,r){const i=\"visualVariables\"in e&&e.visualVariables?e.visualVariables.filter((e=>\"rotation\"===e.type))[0]:e;if(!i)return;if(\"esri.renderers.visualVariables.RotationVariable\"!==i.declaredClass)return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable\");const n=i.axis||\"heading\",s=\"heading\"===n&&\"arithmetic\"===i.rotationType?90:0,o=\"heading\"===n&&\"arithmetic\"===i.rotationType?-1:1,l=\"number\"==typeof a?null:a,u=l&&l.attributes,f=i.field,{hasExpression:p}=i.cache;let d=i.cache.compiledFunc,v=0;if(!f&&!p)return v;if(p){if(t(r)||t(r.arcade))return void c.error(\"Use of arcade expressions requires an arcade context\");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},a=r.arcade.arcadeUtils,n=a.getViewInfo(e),s=a.createExecContext(l,n);if(!d){const e=a.createSyntaxTree(i.valueExpression);d=a.createFunction(e),i.cache.compiledFunc=d}v=a.executeFunction(d,s)}else u&&(v=u[f]||0);return v=\"number\"!=typeof v||isNaN(v)?null:s+o*v,v}function h(e,a,r){const i=\"number\"==typeof a,s=i?null:a,o=s&&s.attributes;let u=i?a:null;const{isScaleDriven:f}=e.cache;let p=e.cache.compiledFunc;if(f){const a=n(r)?r.scale:void 0,i=n(r)?r.view:void 0;u=null==a||\"3d\"===i?m(e):a}else if(!i)switch(e.inputValueType){case\"expression\":{if(t(r)||t(r.arcade))return void c.error(\"Use of arcade expressions requires an arcade context\");const a={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,n=i.getViewInfo(a),o=i.createExecContext(s,n);if(!p){const a=i.createSyntaxTree(e.valueExpression);p=i.createFunction(a),e.cache.compiledFunc=p}u=i.executeFunction(p,o);break}case\"field\":o&&(u=o[e.field]);break;case\"unknown\":u=null}if(!l(u))return null;if(i||!e.normalizationField)return u;const d=o?parseFloat(o[e.normalizationField]):null;return l(d)&&0!==d?u/d:null}function m(e){let a=null,r=null;const i=e.stops;return i?(a=i[0].value,r=i[i.length-1].value):(a=e.minDataValue||0,r=e.maxDataValue||0),(a+r)/2}function V(e,a,r){const i=\"visualVariables\"in e&&e.visualVariables?e.visualVariables.filter((e=>\"size\"===e.type))[0]:e;if(!i)return;if(\"esri.renderers.visualVariables.SizeVariable\"!==i.declaredClass)return void c.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable\");const n=M(h(i,a,r),i,a,r,i.cache.ipData);return null==n||isNaN(n)?0:n}function x(e,a,r){return null==e?null:o(e)?V(e,a,r):l(e)?e:null}function y(e,a,r){return l(r)&&e>r?r:l(a)&&e<a?a:e}function w(e,a,r,i){return e+(x(a.minSize,r,i)||a.minDataValue)}function g(e,a,r){const i=e.stops;let n=i&&i.length&&i[0].size;return null==n&&(n=e.minSize),x(n,a,r)}function z(e,a,r,i){const t=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),s=x(a.minSize,r,i),o=x(a.maxSize,r,i),l=n(i)?i.shape:void 0;if(e<=a.minDataValue)return s;if(e>=a.maxDataValue)return o;if(\"area\"===a.scaleBy&&l){const e=\"circle\"===l,a=e?f*(s/2)**2:s*s,r=a+t*((e?f*(o/2)**2:o*o)-a);return e?2*Math.sqrt(r/f):Math.sqrt(r)}return s+t*(o-s)}function F(e,a,r,i){const t=n(i)?i.shape:void 0,s=e/a.minDataValue,o=x(a.minSize,r,i),l=x(a.maxSize,r,i);let c=null;return c=\"circle\"===t?2*Math.sqrt(s*(o/2)**2):\"square\"===t||\"diamond\"===t||\"image\"===t?Math.sqrt(s*o**2):s*o,y(c,o,l)}function S(e,a,r,i,n){const[t,s,o]=C(e,n);if(t===s)return x(a.stops[t].size,r,i);{const e=x(a.stops[t].size,r,i);return e+(x(a.stops[s].size,r,i)-e)*o}}function E(e,a,r,i){const t=(n(i)&&i.resolution?i.resolution:1)*s[a.valueUnit],o=x(a.minSize,r,i),l=x(a.maxSize,r,i),{valueRepresentation:c}=a;let u=null;return u=\"area\"===c?2*Math.sqrt(e/f)/t:\"radius\"===c||\"distance\"===c?2*e/t:e/t,y(u,o,l)}function D(e){return e}function M(e,a,r,i,n){switch(a.transformationType){case\"additive\":return w(e,a,r,i);case\"constant\":return g(a,r,i);case\"clamped-linear\":return z(e,a,r,i);case\"proportional\":return F(e,a,r,i);case\"stops\":return S(e,a,r,i,n);case\"real-world-size\":return E(e,a,r,i);case\"identity\":return D(e);case\"unknown\":return null}}function U(e,a,r){const{isScaleDriven:i}=e.cache;if(!(i&&\"3d\"===r||a))return null;const n={scale:a,view:r};let t=x(e.minSize,u,n),s=x(e.maxSize,u,n);if(null!=t||null!=s){if(t>s){const e=s;s=t,t=e}return{minSize:t,maxSize:s}}}function k(e,a,r){if(!e.visualVariables)return;const i=[],n=[],t=[],s=[],o=[];for(const l of e.visualVariables)switch(l.type){case\"color\":n.push(l);break;case\"opacity\":t.push(l);break;case\"rotation\":o.push(l);break;case\"size\":s.push(l)}return n.forEach((e=>{const n=d(e,a,r);i.push({variable:e,value:n})})),t.forEach((e=>{const n=v(e,a,r);i.push({variable:e,value:n})})),o.forEach((e=>{const n=b(e,a,r);i.push({variable:e,value:n})})),s.forEach((e=>{const n=V(e,a,r);i.push({variable:e,value:n})})),i.filter((e=>null!=e.value))}function C(e,a){if(!a)return;let r=0,i=a.length-1;return a.some(((a,n)=>e<a?(i=n,!0):(r=n,!1))),[r,i,(e-a[r])/(a[i]-a[r])]}function N(e,a,i){const n=[\"proportional\",\"proportional\",\"proportional\"];for(const t of e){const e=t.useSymbolValue?\"symbol-value\":V(t,a,i);switch(t.axis){case\"width\":n[0]=e;break;case\"depth\":n[1]=e;break;case\"height\":n[2]=e;break;case\"width-and-depth\":n[0]=e,n[1]=e;break;case\"all\":case void 0:case null:n[0]=e,n[1]=e,n[2]=e;break;default:r(t.axis)}}return n}export{N as getAllSizes,d as getColor,v as getOpacity,b as getRotationAngle,V as getSize,M as getSizeForValue,x as getSizeFromNumberOrVariable,U as getSizeRangeAtScale,k as getVisualVariableValues,p as viewScaleRE};\n"]},"metadata":{},"sourceType":"module"}