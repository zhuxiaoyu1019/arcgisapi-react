{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport r from \"../../core/Collection.js\";\nimport s from \"../../core/CollectionFlattener.js\";\nimport t from \"../../core/Error.js\";\nimport o from \"../../core/Logger.js\";\nimport { property as a } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport { getProperties as l } from \"../../core/accessorSupport/utils.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as i } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { nameToId as n, idToName as u } from \"../../core/accessorSupport/PropertyOrigin.js\";\nimport y from \"../support/Sublayer.js\";\nimport { isSublayerOverhaul as c } from \"../support/sublayerUtils.js\";\nconst b = o.getLogger(\"esri.layers.TileLayer\");\n\nfunction p(e, r) {\n  const s = [],\n        t = {};\n  return e ? (e.forEach(e => {\n    const o = new y();\n\n    if (o.read(e, r), t[o.id] = o, null != e.parentLayerId && -1 !== e.parentLayerId) {\n      const r = t[e.parentLayerId];\n      r.sublayers || (r.sublayers = []), r.sublayers.unshift(o);\n    } else s.unshift(o);\n  }), s) : s;\n}\n\nconst d = r.ofType(y);\n\nfunction h(e, r) {\n  e && e.forEach(e => {\n    r(e), e.sublayers && e.sublayers.length && h(e.sublayers, r);\n  });\n}\n\nconst f = o => {\n  let f = class extends o {\n    constructor(...e) {\n      super(...e), this.allSublayers = new s({\n        getCollections: () => [this.sublayers],\n        getChildrenFunction: e => e.sublayers\n      }), this.sublayersSourceJSON = {\n        2: {},\n        3: {},\n        4: {},\n        5: {}\n      }, this.handles.add(this.watch(\"sublayers\", (e, r) => this._handleSublayersChange(e, r), !0));\n    }\n\n    readSublayers(e, r) {\n      if (!r || !e) return;\n      const {\n        sublayersSourceJSON: s\n      } = this,\n            t = n(r.origin);\n      if (t < 2) return;\n      if (s[t] = {\n        context: r,\n        visibleLayers: e.visibleLayers || s[t].visibleLayers,\n        layers: e.layers || s[t].layers\n      }, t > 2) return;\n\n      this._set(\"serviceSublayers\", this.createSublayersForOrigin(\"service\").sublayers);\n\n      const {\n        sublayers: o,\n        origin: a\n      } = this.createSublayersForOrigin(\"web-document\"),\n            i = l(this);\n      i.setDefaultOrigin(a), this._set(\"sublayers\", new d(o)), i.setDefaultOrigin(\"user\");\n    }\n\n    findSublayerById(e) {\n      return this.allSublayers.find(r => r.id === e);\n    }\n\n    createServiceSublayers() {\n      return this.createSublayersForOrigin(\"service\").sublayers;\n    }\n\n    createSublayersForOrigin(e) {\n      const r = n(\"web-document\" === e ? \"web-map\" : e);\n      let s = 2,\n          t = this.sublayersSourceJSON[2].layers,\n          o = this.sublayersSourceJSON[2].context,\n          a = null;\n      const l = [3, 4, 5].filter(e => e <= r);\n\n      for (const n of l) {\n        const e = this.sublayersSourceJSON[n];\n        c(e.layers) && (s = n, t = e.layers, o = e.context, e.visibleLayers && (a = {\n          visibleLayers: e.visibleLayers,\n          context: e.context\n        }));\n      }\n\n      const i = [3, 4, 5].filter(e => e > s && e <= r);\n      let y = null;\n\n      for (const n of i) {\n        const {\n          layers: e,\n          visibleLayers: r,\n          context: s\n        } = this.sublayersSourceJSON[n];\n        e && (y = {\n          layers: e,\n          context: s\n        }), r && (a = {\n          visibleLayers: r,\n          context: s\n        });\n      }\n\n      const b = p(t, o),\n            f = new Map(),\n            S = new Set();\n      if (y) for (const n of y.layers) f.set(n.id, n);\n      if (a) for (const n of a.visibleLayers) S.add(n);\n      return h(b, e => {\n        y && e.read(f.get(e.id), y.context), a && e.read({\n          defaultVisibility: S.has(e.id)\n        }, a.context);\n      }), {\n        origin: u(s),\n        sublayers: new d({\n          items: b\n        })\n      };\n    }\n\n    read(e, r) {\n      super.read(e, r), this.readSublayers(e, r);\n    }\n\n    _handleSublayersChange(e, r) {\n      r && (r.forEach(e => {\n        e.parent = null, e.layer = null;\n      }), this.handles.remove(\"sublayers-owner\")), e && (e.forEach(e => {\n        e.parent = this, e.layer = this;\n      }), this.handles.add([e.on(\"after-add\", ({\n        item: e\n      }) => {\n        e.parent = this, e.layer = this;\n      }), e.on(\"after-remove\", ({\n        item: e\n      }) => {\n        e.parent = null, e.layer = null;\n      })], \"sublayers-owner\"), \"tile\" === this.type && this.handles.add(e.on(\"before-changes\", e => {\n        b.error(new t(\"tilelayer:sublayers-non-modifiable\", \"ISublayer can't be added, moved, or removed from the layer's sublayers\", {\n          layer: this\n        })), e.preventDefault();\n      }), \"sublayers-owner\"));\n    }\n\n  };\n  return e([a({\n    readOnly: !0\n  })], f.prototype, \"allSublayers\", void 0), e([a({\n    readOnly: !0,\n    type: r.ofType(y)\n  })], f.prototype, \"serviceSublayers\", void 0), e([a({\n    value: null,\n    type: d,\n    json: {\n      read: !1,\n      write: {\n        allowNull: !0,\n        ignoreOrigin: !0\n      }\n    }\n  })], f.prototype, \"sublayers\", void 0), e([a({\n    readOnly: !0\n  })], f.prototype, \"sublayersSourceJSON\", void 0), f = e([i(\"esri.layers.mixins.SublayersOwner\")], f), f;\n};\n\nexport { f as SublayersOwner, h as forEachSublayer };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/mixins/SublayersOwner.js"],"names":["_","e","r","s","t","o","property","a","getProperties","l","subclass","i","nameToId","n","idToName","u","y","isSublayerOverhaul","c","b","getLogger","p","forEach","read","id","parentLayerId","sublayers","unshift","d","ofType","h","length","f","constructor","allSublayers","getCollections","getChildrenFunction","sublayersSourceJSON","handles","add","watch","_handleSublayersChange","readSublayers","origin","context","visibleLayers","layers","_set","createSublayersForOrigin","setDefaultOrigin","findSublayerById","find","createServiceSublayers","filter","Map","S","Set","set","get","defaultVisibility","has","items","parent","layer","remove","on","item","type","error","preventDefault","readOnly","prototype","value","json","write","allowNull","ignoreOrigin","SublayersOwner","forEachSublayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Collection.js\";import s from\"../../core/CollectionFlattener.js\";import t from\"../../core/Error.js\";import o from\"../../core/Logger.js\";import{property as a}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import{getProperties as l}from\"../../core/accessorSupport/utils.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{nameToId as n,idToName as u}from\"../../core/accessorSupport/PropertyOrigin.js\";import y from\"../support/Sublayer.js\";import{isSublayerOverhaul as c}from\"../support/sublayerUtils.js\";const b=o.getLogger(\"esri.layers.TileLayer\");function p(e,r){const s=[],t={};return e?(e.forEach((e=>{const o=new y;if(o.read(e,r),t[o.id]=o,null!=e.parentLayerId&&-1!==e.parentLayerId){const r=t[e.parentLayerId];r.sublayers||(r.sublayers=[]),r.sublayers.unshift(o)}else s.unshift(o)})),s):s}const d=r.ofType(y);function h(e,r){e&&e.forEach((e=>{r(e),e.sublayers&&e.sublayers.length&&h(e.sublayers,r)}))}const f=o=>{let f=class extends o{constructor(...e){super(...e),this.allSublayers=new s({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{}},this.handles.add(this.watch(\"sublayers\",((e,r)=>this._handleSublayersChange(e,r)),!0))}readSublayers(e,r){if(!r||!e)return;const{sublayersSourceJSON:s}=this,t=n(r.origin);if(t<2)return;if(s[t]={context:r,visibleLayers:e.visibleLayers||s[t].visibleLayers,layers:e.layers||s[t].layers},t>2)return;this._set(\"serviceSublayers\",this.createSublayersForOrigin(\"service\").sublayers);const{sublayers:o,origin:a}=this.createSublayersForOrigin(\"web-document\"),i=l(this);i.setDefaultOrigin(a),this._set(\"sublayers\",new d(o)),i.setDefaultOrigin(\"user\")}findSublayerById(e){return this.allSublayers.find((r=>r.id===e))}createServiceSublayers(){return this.createSublayersForOrigin(\"service\").sublayers}createSublayersForOrigin(e){const r=n(\"web-document\"===e?\"web-map\":e);let s=2,t=this.sublayersSourceJSON[2].layers,o=this.sublayersSourceJSON[2].context,a=null;const l=[3,4,5].filter((e=>e<=r));for(const n of l){const e=this.sublayersSourceJSON[n];c(e.layers)&&(s=n,t=e.layers,o=e.context,e.visibleLayers&&(a={visibleLayers:e.visibleLayers,context:e.context}))}const i=[3,4,5].filter((e=>e>s&&e<=r));let y=null;for(const n of i){const{layers:e,visibleLayers:r,context:s}=this.sublayersSourceJSON[n];e&&(y={layers:e,context:s}),r&&(a={visibleLayers:r,context:s})}const b=p(t,o),f=new Map,S=new Set;if(y)for(const n of y.layers)f.set(n.id,n);if(a)for(const n of a.visibleLayers)S.add(n);return h(b,(e=>{y&&e.read(f.get(e.id),y.context),a&&e.read({defaultVisibility:S.has(e.id)},a.context)})),{origin:u(s),sublayers:new d({items:b})}}read(e,r){super.read(e,r),this.readSublayers(e,r)}_handleSublayersChange(e,r){r&&(r.forEach((e=>{e.parent=null,e.layer=null})),this.handles.remove(\"sublayers-owner\")),e&&(e.forEach((e=>{e.parent=this,e.layer=this})),this.handles.add([e.on(\"after-add\",(({item:e})=>{e.parent=this,e.layer=this})),e.on(\"after-remove\",(({item:e})=>{e.parent=null,e.layer=null}))],\"sublayers-owner\"),\"tile\"===this.type&&this.handles.add(e.on(\"before-changes\",(e=>{b.error(new t(\"tilelayer:sublayers-non-modifiable\",\"ISublayer can't be added, moved, or removed from the layer's sublayers\",{layer:this})),e.preventDefault()})),\"sublayers-owner\"))}};return e([a({readOnly:!0})],f.prototype,\"allSublayers\",void 0),e([a({readOnly:!0,type:r.ofType(y)})],f.prototype,\"serviceSublayers\",void 0),e([a({value:null,type:d,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,\"sublayers\",void 0),e([a({readOnly:!0})],f.prototype,\"sublayersSourceJSON\",void 0),f=e([i(\"esri.layers.mixins.SublayersOwner\")],f),f};export{f as SublayersOwner,h as forEachSublayer};\n"]},"metadata":{},"sourceType":"module"}