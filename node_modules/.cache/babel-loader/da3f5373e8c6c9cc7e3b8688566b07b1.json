{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport r from \"../../../../core/Handles.js\";\nimport { unwrap as s, isNone as n } from \"../../../../core/maybe.js\";\nimport { whenFalse as i, init as o } from \"../../../../core/watchUtils.js\";\nimport { property as a } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as c } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { b as u, k as h, g as d } from \"../../../../chunks/vec3.js\";\nimport { c as f } from \"../../../../chunks/vec3f64.js\";\nimport { create as p } from \"../../../../geometry/support/ray.js\";\nimport m from \"../debugFlags.js\";\nimport { GraphicsHandle as _ } from \"../debugUtils.js\";\nimport { PropertiesPool as l } from \"../PropertiesPool.js\";\nimport { fromRenderAtEye as y } from \"../geometryUtils/ray.js\";\nimport C from \"./CameraOnSurface.js\";\nimport O from \"./CenterOnSurface.js\";\nimport { ContentGeometryUpdates as A } from \"./ContentGeometryUpdates.js\";\nimport w from \"./Focus.js\";\nimport { StableSurfaceCenter as g } from \"./StableSurfaceCenter.js\";\nimport S from \"./SurfaceGeometryUpdates.js\";\nimport { Intersector as v } from \"../../webgl-engine/lib/Intersector.js\";\nimport { TERRAIN_ID as I } from \"../../webgl-engine/lib/verticalOffsetUtils.js\";\nimport { TaskPriority as b } from \"../../../support/Scheduler.js\";\nlet T = class extends t {\n  constructor(e) {\n    super(e), this._handles = new r(), this._tmpRay = p(), this._centerRayDirty = !0, this._surfaceAltitudeAtCenter = 0, this._surfaceAltitudeAtCenterDirty = !0, this._contentAltitudeAtCenter = 0, this._contentAltitudeAtCenterDirty = !0, this._propertiesPool = new l({\n      renderPointOfView: R\n    }, this), this.renderPointOfView = f(), this._pois = new Array(), this._debugCenters = new Map();\n  }\n\n  initialize() {\n    var e;\n    const {\n      state: t,\n      basemapTerrain: r,\n      renderCoordsHelper: n,\n      map: a\n    } = this.view;\n    this._surfaceIntersector = new v(t.viewingMode), t.isGlobal ? this._surfaceIntersector.options.backfacesTerrain = !1 : this._surfaceIntersector.options.backfacesTerrain = !0, this._surfaceIntersector.options.invisibleTerrain = !1, this._surfaceIntersector.options.store = 0, this._contentIntersector = new v(t.viewingMode);\n\n    const c = () => this._estimateSurfaceAltitudeAtCenter(),\n          u = this.view.resourceController.scheduler,\n          h = s(null == (e = this.view.basemapTerrain) ? void 0 : e.elevationQueryCache),\n          d = {\n      state: t,\n      scheduler: u,\n      surface: r,\n      renderCoordsHelper: n\n    };\n\n    this._set(\"centerOnSurfaceInfrequent\", new O({ ...d,\n      task: b.POINT_OF_INTEREST_INFREQUENT,\n      estimateSurfaceAltitudeAtCenter: c\n    })), this._set(\"centerOnSurfaceFrequent\", new O({ ...d,\n      task: b.POINT_OF_INTEREST_FREQUENT,\n      estimateSurfaceAltitudeAtCenter: c\n    })), this._set(\"centerOnContent\", new O({ ...d,\n      task: b.POINT_OF_INTEREST_FREQUENT,\n      estimateSurfaceAltitudeAtCenter: () => this._estimateContentAltitudeAtCenter()\n    })), this._set(\"cameraOnSurface\", new C({ ...d,\n      cache: h,\n      task: b.POINT_OF_INTEREST_INFREQUENT,\n      map: a\n    })), this._set(\"contentCameraOnSurface\", new C({ ...d,\n      cache: h,\n      task: b.POINT_OF_INTEREST_INFREQUENT,\n      map: a,\n      cameraName: \"contentCamera\"\n    })), this._set(\"surfaceGeometryUpdates\", new S({ ...d,\n      centerOnSurfaces: [this.centerOnSurfaceFrequent, this.centerOnContent, this.centerOnSurfaceInfrequent]\n    })), this._set(\"contentGeometryUpdates\", new A({\n      contentLayerViews: this.view.allLayerViews,\n      renderCoordsHelper: n\n    })), this._set(\"surfaceOrigin\", new g({\n      cache: h,\n      view: this.view\n    })), this._set(\"focus\", new w({\n      state: t,\n      scheduler: u,\n      surface: r,\n      renderCoordsHelper: n,\n      centerOnSurface: this.centerOnSurfaceFrequent,\n      estimateSurfaceIntersectionAtRenderPoint: (e, t) => this._estimateSurfaceIntersectionAtRenderPoint(e, t)\n    })), this._pois.push(this.centerOnContent, this.centerOnSurfaceFrequent, this.centerOnSurfaceInfrequent, this.cameraOnSurface, this.contentCameraOnSurface, this.focus);\n    const f = this.view.graphics;\n    this._debugCenters.set(this.centerOnContent, new _(f, \"red\", \"CenterOnContent\")), this._debugCenters.set(this.centerOnSurfaceFrequent, new _(f, \"red\", \"CenterOnSurface\")), this._debugCenters.set(this.cameraOnSurface, new _(f, \"blue\", \"CameraOnSurface\")), this._debugCenters.set(this.contentCameraOnSurface, new _(f, \"blue\", \"CameraOfInterestOnSurface\")), this._debugCenters.set(this.focus, new _(f, \"green\", \"Focus\")), this._handles.add([t.watch(\"camera\", e => this._cameraChanged(e), !0), r.watch(\"extent\", () => this._updateCenterPointsOfInterest()), i(r, \"updating\", () => this._updateCenterPointsOfInterest(), !0), this.surfaceGeometryUpdates.events.on(\"request-update\", () => this._updateCenterPointsOfInterest()), this.contentGeometryUpdates.events.on(\"request-update\", () => this._updateCenterOnContent()), o(m, \"SHOW_POI\", e => this._setDebug(e))]), this._cameraChanged(this.view.state.camera);\n\n    for (const s of this._pois) s.runTask();\n  }\n\n  destroy() {\n    this._setDebug(!1), this._handles.destroy(), this._propertiesPool.destroy();\n\n    for (const e of this._pois) e.destroy();\n\n    this.surfaceOrigin.destroy();\n  }\n\n  get updating() {\n    var e;\n    return !!(null != (e = this.surfaceGeometryUpdates) && e.updating || this._pois.some(e => e.updating));\n  }\n\n  get centerRay() {\n    return this._centerRayDirty && (this._centerRay = this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera, this._tmpRay), this._centerRayDirty = !1), this._centerRay;\n  }\n\n  _estimateContentAltitudeAtCenter() {\n    if (!this._contentAltitudeAtCenterDirty) return this._contentAltitudeAtCenter;\n    this._contentAltitudeAtCenterDirty = !1;\n    const e = this.centerRay;\n    return n(e) || (this.view.sceneIntersectionHelper.intersectRay(e, this._contentIntersector, P, E) ? this._contentAltitudeAtCenter = this.view.renderCoordsHelper.getAltitude(P) : this._contentAltitudeAtCenter = this._estimateSurfaceAltitudeAtCenter()), this._contentAltitudeAtCenter;\n  }\n\n  _estimateSurfaceAltitudeAtCenter() {\n    if (!this.view.basemapTerrain) return 0;\n    if (!this._surfaceAltitudeAtCenterDirty) return this._surfaceAltitudeAtCenter;\n    this._surfaceAltitudeAtCenterDirty = !1;\n    const e = this.centerRay;\n    if (n(e)) return this._surfaceAltitudeAtCenter;\n    const t = e.origin,\n          r = u(P, e.origin, e.direction);\n    return this._surfaceIntersector.resetWithRay(e), this._surfaceIntersector.camera = this.view.state.camera, this.view.basemapTerrain.intersect(this._surfaceIntersector, null, t, r), this._surfaceIntersector.results.min.getIntersectionPoint(P) && (this._surfaceAltitudeAtCenter = this.view.renderCoordsHelper.getAltitude(P)), this._surfaceAltitudeAtCenter;\n  }\n\n  _estimateSurfaceIntersectionAtRenderPoint(e, t) {\n    const r = y(this.view.state.camera, e, j);\n    if (n(r)) return null;\n    const s = r.origin,\n          i = u(P, r.origin, r.direction);\n    return this._surfaceIntersector.resetWithRay(r), this._surfaceIntersector.camera = this.view.state.camera, this.view.basemapTerrain.intersect(this._surfaceIntersector, null, s, i), this._surfaceIntersector.results.min.getIntersectionPoint(t) ? t : null;\n  }\n\n  _cameraChanged(e) {\n    this._updateCenterPointsOfInterest();\n\n    const t = e.eye;\n    h(this.renderPointOfView, t) || this._set(\"renderPointOfView\", d(this._propertiesPool.get(\"renderPointOfView\"), t));\n  }\n\n  _updateCenterPointsOfInterest() {\n    this._centerRayDirty = !0, this._surfaceAltitudeAtCenterDirty = !0, this._contentAltitudeAtCenterDirty = !0;\n\n    for (const e of this._pois) e.updateRenderLocation();\n  }\n\n  _updateCenterOnContent() {\n    this._contentAltitudeAtCenterDirty = !0, this.centerOnContent.updateRenderLocation();\n  }\n\n  _setDebug(e) {\n    if (!e) return this._debugCenters.forEach(e => e.remove()), void this._handles.remove(\"debug\");\n\n    for (const t of this._pois) this._handles.add(o(t, \"renderLocation\", e => this._debugCenters.get(t).showPoint(e, t.renderCoordsHelper.spatialReference)), \"debug\");\n  }\n\n  get test() {\n    return {\n      update: () => {\n        this.surfaceGeometryUpdates.runTask();\n\n        for (const e of this._pois) e.runTask();\n      },\n      surfaceGeometryUpdates: this.surfaceGeometryUpdates\n    };\n  }\n\n};\ne([a({\n  readOnly: !0\n})], T.prototype, \"centerOnContent\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"centerOnSurfaceFrequent\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"centerOnSurfaceInfrequent\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"cameraOnSurface\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"contentCameraOnSurface\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"focus\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"renderPointOfView\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"surfaceOrigin\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"contentGeometryUpdates\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"surfaceGeometryUpdates\", void 0), e([a({\n  constructOnly: !0\n})], T.prototype, \"view\", void 0), e([a({\n  readOnly: !0\n})], T.prototype, \"updating\", null), T = e([c(\"esri.views.3d.support.PointsOfInterest\")], T);\nconst R = Array,\n      P = f(),\n      j = p(),\n      E = {\n  exclude: new Set([I])\n};\nvar U = T;\nexport default U;\nexport { T as PointsOfInterest };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/support/pointsOfInterest/PointsOfInterest.js"],"names":["_","e","t","r","unwrap","s","isNone","n","whenFalse","i","init","o","property","a","subclass","c","b","u","k","h","g","d","f","create","p","m","GraphicsHandle","PropertiesPool","l","fromRenderAtEye","y","C","O","ContentGeometryUpdates","A","w","StableSurfaceCenter","S","Intersector","v","TERRAIN_ID","I","TaskPriority","T","constructor","_handles","_tmpRay","_centerRayDirty","_surfaceAltitudeAtCenter","_surfaceAltitudeAtCenterDirty","_contentAltitudeAtCenter","_contentAltitudeAtCenterDirty","_propertiesPool","renderPointOfView","R","_pois","Array","_debugCenters","Map","initialize","state","basemapTerrain","renderCoordsHelper","map","view","_surfaceIntersector","viewingMode","isGlobal","options","backfacesTerrain","invisibleTerrain","store","_contentIntersector","_estimateSurfaceAltitudeAtCenter","resourceController","scheduler","elevationQueryCache","surface","_set","task","POINT_OF_INTEREST_INFREQUENT","estimateSurfaceAltitudeAtCenter","POINT_OF_INTEREST_FREQUENT","_estimateContentAltitudeAtCenter","cache","cameraName","centerOnSurfaces","centerOnSurfaceFrequent","centerOnContent","centerOnSurfaceInfrequent","contentLayerViews","allLayerViews","centerOnSurface","estimateSurfaceIntersectionAtRenderPoint","_estimateSurfaceIntersectionAtRenderPoint","push","cameraOnSurface","contentCameraOnSurface","focus","graphics","set","add","watch","_cameraChanged","_updateCenterPointsOfInterest","surfaceGeometryUpdates","events","on","contentGeometryUpdates","_updateCenterOnContent","_setDebug","camera","runTask","destroy","surfaceOrigin","updating","some","centerRay","_centerRay","sceneIntersectionHelper","getCenterRayWithSubpixelOffset","intersectRay","P","E","getAltitude","origin","direction","resetWithRay","intersect","results","min","getIntersectionPoint","j","eye","get","updateRenderLocation","forEach","remove","showPoint","spatialReference","test","update","readOnly","prototype","constructOnly","exclude","Set","U","PointsOfInterest"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Handles.js\";import{unwrap as s,isNone as n}from\"../../../../core/maybe.js\";import{whenFalse as i,init as o}from\"../../../../core/watchUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{b as u,k as h,g as d}from\"../../../../chunks/vec3.js\";import{c as f}from\"../../../../chunks/vec3f64.js\";import{create as p}from\"../../../../geometry/support/ray.js\";import m from\"../debugFlags.js\";import{GraphicsHandle as _}from\"../debugUtils.js\";import{PropertiesPool as l}from\"../PropertiesPool.js\";import{fromRenderAtEye as y}from\"../geometryUtils/ray.js\";import C from\"./CameraOnSurface.js\";import O from\"./CenterOnSurface.js\";import{ContentGeometryUpdates as A}from\"./ContentGeometryUpdates.js\";import w from\"./Focus.js\";import{StableSurfaceCenter as g}from\"./StableSurfaceCenter.js\";import S from\"./SurfaceGeometryUpdates.js\";import{Intersector as v}from\"../../webgl-engine/lib/Intersector.js\";import{TERRAIN_ID as I}from\"../../webgl-engine/lib/verticalOffsetUtils.js\";import{TaskPriority as b}from\"../../../support/Scheduler.js\";let T=class extends t{constructor(e){super(e),this._handles=new r,this._tmpRay=p(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new l({renderPointOfView:R},this),this.renderPointOfView=f(),this._pois=new Array,this._debugCenters=new Map}initialize(){var e;const{state:t,basemapTerrain:r,renderCoordsHelper:n,map:a}=this.view;this._surfaceIntersector=new v(t.viewingMode),t.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=0,this._contentIntersector=new v(t.viewingMode);const c=()=>this._estimateSurfaceAltitudeAtCenter(),u=this.view.resourceController.scheduler,h=s(null==(e=this.view.basemapTerrain)?void 0:e.elevationQueryCache),d={state:t,scheduler:u,surface:r,renderCoordsHelper:n};this._set(\"centerOnSurfaceInfrequent\",new O({...d,task:b.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:c})),this._set(\"centerOnSurfaceFrequent\",new O({...d,task:b.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:c})),this._set(\"centerOnContent\",new O({...d,task:b.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set(\"cameraOnSurface\",new C({...d,cache:h,task:b.POINT_OF_INTEREST_INFREQUENT,map:a})),this._set(\"contentCameraOnSurface\",new C({...d,cache:h,task:b.POINT_OF_INTEREST_INFREQUENT,map:a,cameraName:\"contentCamera\"})),this._set(\"surfaceGeometryUpdates\",new S({...d,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set(\"contentGeometryUpdates\",new A({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:n})),this._set(\"surfaceOrigin\",new g({cache:h,view:this.view})),this._set(\"focus\",new w({state:t,scheduler:u,surface:r,renderCoordsHelper:n,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const f=this.view.graphics;this._debugCenters.set(this.centerOnContent,new _(f,\"red\",\"CenterOnContent\")),this._debugCenters.set(this.centerOnSurfaceFrequent,new _(f,\"red\",\"CenterOnSurface\")),this._debugCenters.set(this.cameraOnSurface,new _(f,\"blue\",\"CameraOnSurface\")),this._debugCenters.set(this.contentCameraOnSurface,new _(f,\"blue\",\"CameraOfInterestOnSurface\")),this._debugCenters.set(this.focus,new _(f,\"green\",\"Focus\")),this._handles.add([t.watch(\"camera\",(e=>this._cameraChanged(e)),!0),r.watch(\"extent\",(()=>this._updateCenterPointsOfInterest())),i(r,\"updating\",(()=>this._updateCenterPointsOfInterest()),!0),this.surfaceGeometryUpdates.events.on(\"request-update\",(()=>this._updateCenterPointsOfInterest())),this.contentGeometryUpdates.events.on(\"request-update\",(()=>this._updateCenterOnContent())),o(m,\"SHOW_POI\",(e=>this._setDebug(e)))]),this._cameraChanged(this.view.state.camera);for(const s of this._pois)s.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!!(null!=(e=this.surfaceGeometryUpdates)&&e.updating||this._pois.some((e=>e.updating)))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return n(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,P,E)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(P):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(n(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=u(P,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e),this._surfaceIntersector.camera=this.view.state.camera,this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(P)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(P)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t){const r=y(this.view.state.camera,e,j);if(n(r))return null;const s=r.origin,i=u(P,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r),this._surfaceIntersector.camera=this.view.state.camera,this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,i),this._surfaceIntersector.results.min.getIntersectionPoint(t)?t:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;h(this.renderPointOfView,t)||this._set(\"renderPointOfView\",d(this._propertiesPool.get(\"renderPointOfView\"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach((e=>e.remove())),void this._handles.remove(\"debug\");for(const t of this._pois)this._handles.add(o(t,\"renderLocation\",(e=>this._debugCenters.get(t).showPoint(e,t.renderCoordsHelper.spatialReference))),\"debug\")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};e([a({readOnly:!0})],T.prototype,\"centerOnContent\",void 0),e([a({readOnly:!0})],T.prototype,\"centerOnSurfaceFrequent\",void 0),e([a({readOnly:!0})],T.prototype,\"centerOnSurfaceInfrequent\",void 0),e([a({readOnly:!0})],T.prototype,\"cameraOnSurface\",void 0),e([a({readOnly:!0})],T.prototype,\"contentCameraOnSurface\",void 0),e([a({readOnly:!0})],T.prototype,\"focus\",void 0),e([a({readOnly:!0})],T.prototype,\"renderPointOfView\",void 0),e([a({readOnly:!0})],T.prototype,\"surfaceOrigin\",void 0),e([a({readOnly:!0})],T.prototype,\"contentGeometryUpdates\",void 0),e([a({readOnly:!0})],T.prototype,\"surfaceGeometryUpdates\",void 0),e([a({constructOnly:!0})],T.prototype,\"view\",void 0),e([a({readOnly:!0})],T.prototype,\"updating\",null),T=e([c(\"esri.views.3d.support.PointsOfInterest\")],T);const R=Array,P=f(),j=p(),E={exclude:new Set([I])};var U=T;export default U;export{T as PointsOfInterest};\n"]},"metadata":{},"sourceType":"module"}