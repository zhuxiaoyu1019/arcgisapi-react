{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Accessor.js\";\nimport r from \"../../../core/Handles.js\";\nimport s from \"../../../core/has.js\";\nimport { clamp as i, deg2rad as a } from \"../../../core/mathUtils.js\";\nimport { isSome as n, isNone as o } from \"../../../core/maybe.js\";\nimport { addFrameTask as h } from \"../../../core/scheduling.js\";\nimport { Milliseconds as l } from \"../../../core/time.js\";\nimport { getMetersPerUnitForSR as c } from \"../../../core/unitUtils.js\";\nimport { property as d } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as p } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { a as u } from \"../../../chunks/vec2.js\";\nimport { b as y, f as _, y as g, g as m, i as f } from \"../../../chunks/vec3.js\";\nimport { c as v } from \"../../../chunks/vec3f64.js\";\nimport { t as O, b as w, a as T } from \"../../../chunks/vec4.js\";\nimport { c as D, f as R } from \"../../../chunks/vec4f64.js\";\nimport { projectVectorToVector as S } from \"../../../geometry/projection.js\";\nimport { getReferenceEllipsoid as x } from \"../../../geometry/projectionEllipsoid.js\";\nimport { width as M, set as C, center as j, intersection as I, contains as b, intersects as E, offset as A, create as U } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { wrap as P, create as V } from \"../../../geometry/support/ray.js\";\nimport { b as L, e as H } from \"../../../chunks/sphere.js\";\nimport { angleAroundAxis as k } from \"../../../geometry/support/vector.js\";\nimport { y2lat as q } from \"../../../geometry/support/webMercatorUtils.js\";\nimport { viewAngle as F } from \"../state/utils/viewUtils.js\";\nimport { DESIRED_DRAPED_ANIMATION_MS as G } from \"../support/animationUtils.js\";\nimport B from \"../support/debugFlags.js\";\nimport { GraphicsHandle as W } from \"../support/debugUtils.js\";\nimport { Cyclical as z, cyclicalPI as Y } from \"../support/mathUtils.js\";\nimport { computeOverlayResolution as N } from \"./Overlay.js\";\nimport { OverlayRenderer as X } from \"./OverlayRenderer.js\";\nimport { Intersector as J } from \"../webgl-engine/lib/Intersector.js\";\nimport { fromValues as K } from \"../webgl-engine/lib/localOrigin.js\";\nimport { removeLoadedShaderModules as Q } from \"../webgl-engine/parts/requireUtils.js\";\nimport { TaskPriority as Z } from \"../../support/Scheduler.js\";\nconst $ = 3.5,\n      ee = 10,\n      te = [[-.1, -2, 3.9, 2], [-.1, -3.9, 3.9, .1], [-2, -3.9, 2, .1], [-3.9, -3.9, .1, .1], [-3.9, -2, .1, 2], [-3.9, -.1, .1, 3.9], [-2, -.1, 2, 3.9], [-.1, -.1, 3.9, 3.9]];\nlet re,\n    se = class extends t {\n  constructor(e) {\n    super(e), this._handles = new r(), this._spatialReference = null, this._renderSR = null, this._overlaySREqualsRenderSR = !0, this._drapeSources = new Map(), this._drapeTargets = new Set(), this._renderedAltitude = 0, this._displayOpacity = 0, this._displayOpacityTime = -1, this._placementDirty = !1, this._drawTexturesDirty = !1, this._drawTexturesAnimateDirty = !1, this._layerViewsDirty = !0, this._hasUnusedRenderTargets = !1, this._longitudeCyclical = null, this._latestOriginId = 0, this._maxResolution = s(\"esri-mobile\") ? 2048 : 4096, this._animationTimeLast = 0;\n  }\n\n  get running() {\n    return (this._placementDirty || this._layerViewsDirty) && (this._drapeSources.size > 0 || this.view.graphics.length > 0 || B.OVERLAY_DRAW_DEBUG_TEXTURE) && !!this._spatialReference && !this.suspended && this.surface.ready;\n  }\n\n  get _isSpherical() {\n    return this.view.state.isGlobal;\n  }\n\n  get view() {\n    return this.surface.view;\n  }\n\n  get updating() {\n    return this.running || this.renderer.updating;\n  }\n\n  get hasHighlights() {\n    return this.renderer.hasHighlights;\n  }\n\n  get rendersOccluded() {\n    return this.renderer.rendersOccluded;\n  }\n\n  initialize() {\n    const e = this.view,\n          t = e.state.isGlobal && n(this._spatialReference) ? c(this._spatialReference) : 1;\n    this.renderer = new X({\n      view: e,\n      globalUnitScale: t,\n      spatialReference: this._spatialReference\n    }), this.renderer.onHasHighlightsChanged = () => {\n      this._setDrawTexturesDirty(), this.notifyChange(\"hasHighlights\");\n    }, this.renderer.onRendersOccludedChanged = () => {\n      this._setDrawTexturesDirty(), this.notifyChange(\"rendersOccluded\");\n    }, this.renderer.onContentChanged = () => this._setDrawTexturesDirty(), this.renderer.onHasWaterChanged = t => {\n      var r;\n      return null == (r = e._stage) ? void 0 : r.renderView.setRenderParameters({\n        hasOverlayWater: t\n      });\n    }, this.groundIntersector = new J(this.view.state.viewingMode), this.groundIntersector.options.backfacesTerrain = !0, this.groundIntersector.options.invisibleTerrain = !0, this.groundIntersector.options.hud = !1, this._handles.add([e.watch([\"pointsOfInterest.renderPointOfView\", \"pointsOfInterest.centerOnSurfaceFrequent.location\", \"pixelRatio\"], () => this.setOverlayPlacementDirty()), this.surface.on(\"elevation-change\", () => this.setOverlayPlacementDirty()), e.allLayerViews.on(\"after-changes\", () => this._layerViewsDirty = !0), e.on(\"resize\", () => this.setOverlayPlacementDirty()), h({\n      preRender: e => {\n        this.renderer.processSyncLayers(), this._updateLayerViews(), this.renderer.hasOverlays && (this._dispatchRendererUpdate(e), this._drawOverlayTextures(this.renderer.overlays)), this._hasUnusedRenderTargets && this._collectUnusedRenderTargetMemory();\n      }\n    }), e.resourceController.scheduler.registerTask(Z.OVERLAY_MANAGER, this), e._stage.renderView.events.on(\"force-camera-for-screenshot\", e => {\n      this._updateOverlays(e), this.renderer.hasOverlays && this._drawOverlayTextures(this.renderer.overlays);\n    })]), this._updateLayerViews();\n  }\n\n  destroy() {\n    this._drapeSources.forEach((e, t) => this.unregisterDrapeSource(t)), this._drapeTargets.forEach(e => this._unregisterDrapeTarget(e)), this.renderer.dispose(), this._handles && (this._handles.destroy(), this._handles = null), n(re) && (re.remove(), re = null);\n  }\n\n  get hasOverlays() {\n    return this.renderer.hasOverlays;\n  }\n\n  setSpatialReference(e) {\n    this._spatialReference = e, this.renderer.spatialReference = e, this._longitudeCyclical = null;\n    const t = this.view.renderSpatialReference;\n    n(e) && n(t) ? (this._renderSR = t, this._overlaySREqualsRenderSR = e.equals(this._renderSR), this._isSpherical && (this._longitudeCyclical = e.isWebMercator ? new z(-20037508.342787, 20037508.342787) : new z(-180, 180), this.renderer.longitudeCyclical = this._longitudeCyclical), this.renderer && (this.renderer.globalUnitScale = this._isSpherical && n(this._spatialReference) ? c(this._spatialReference) : 1)) : this.renderer.disposeOverlays();\n  }\n\n  getGpuMemoryUsage() {\n    return this.renderer.gpuMemoryUsage;\n  }\n\n  _updateLayerViews() {\n    if (!this._layerViewsDirty) return;\n    const e = new Set();\n\n    for (const t of this.view.allLayerViews.items) e.add(t.uid), \"drapeSourceType\" in t && !this._drapeSources.has(t) && this._registerDrapeSource(t, 0), \"drapeTargetType\" in t && !this._drapeTargets.has(t) && this._registerDrapeTarget(t);\n\n    this._drapeSources.forEach((t, r) => {\n      0 !== t || e.has(r.uid) || this.unregisterDrapeSource(r);\n    }), this._drapeTargets.forEach(t => {\n      e.has(t.uid) || this._unregisterDrapeTarget(t);\n    }), this.renderer.updateLayerOrder(), this._setDrawTexturesDirty(), this._layerViewsDirty = !1;\n  }\n\n  registerDrapeSource(e) {\n    this._registerDrapeSource(e, 1);\n  }\n\n  _registerDrapeSource(e, t) {\n    this._drapeSources.set(e, t), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources), this.renderer.overlays.forEach(t => {\n      this._updateDrapeSource(e, t);\n    }), this._setOverlayContentDirty(), this.notifyChange(\"running\");\n  }\n\n  _updateDrapeSource(e, t) {\n    n(e.setDrapingExtent) && n(this._spatialReference) && e.setDrapingExtent(t, this._spatialReference);\n  }\n\n  unregisterDrapeSource(e) {\n    this._drapeSources.has(e) && (this._drapeSources.delete(e), this.renderer.ensureDrapeSources(this._drapeSources), this._setOverlayContentDirty(), this.notifyChange(\"running\"));\n  }\n\n  _registerDrapeTarget(e) {\n    this._drapeTargets.add(e), this._updateDrapeTarget(e), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);\n  }\n\n  _updateDrapeTarget(e) {\n    this.renderer.overlays.forEach(t => e.setDrapingTextures(t));\n  }\n\n  _unregisterDrapeTarget(e) {\n    this._drapeTargets.delete(e), this.renderer.ensureDrapeTargets(this._drapeTargets);\n  }\n\n  _setOverlayContentDirty() {\n    this.setOverlayPlacementDirty(), this._setDrawTexturesDirty();\n  }\n\n  setOverlayPlacementDirty() {\n    this._placementDirty = !0;\n  }\n\n  runTask() {\n    this._updateOverlays(this.view.state.camera);\n  }\n\n  _updateOverlays(e) {\n    if (!this._spatialReference) return;\n\n    this._updateLayerViews();\n\n    const t = N(e.fullWidth, e.fullHeight, this._maxResolution);\n\n    this._computeOverlayExtents(e, t, oe);\n\n    const r = M(oe.inner) / M(oe.outer);\n    this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);\n\n    const s = this._updateOverlay(0, oe.inner, t, 1),\n          i = this._updateOverlay(1, oe.outer, t, r);\n\n    (s || i) && (this.surface.updateTileOverlayParams(), this._setDrawTexturesDirty()), this._placementDirty = !1, this.surface.updateOverlayOpacity();\n  }\n\n  _updateOverlay(e, t, r, s) {\n    if (0 === this.renderer.overlays.length) return !1;\n    const i = this.renderer.overlays[e];\n    if (!ie(t, i.extent) && r === i.resolution && i.pixelRatio === s) return !1;\n    C(i.extent, t), i.resolution = r, i.pixelRatio = s;\n    const a = j(i.extent);\n    return i.renderLocalOrigin = K(a[0], a[1], 0, \"OV_\" + this._latestOriginId++), this._drapeSources.forEach((e, t) => this._updateDrapeSource(t, i)), !0;\n  }\n\n  computeOpacity(e) {\n    if (!this.renderer.hasOverlays) return this._displayOpacity = 0, this._displayOpacityTime = -1, 1;\n\n    if (e * $ < this._renderedAltitude) {\n      const t = (e - this._renderedAltitude / ee) / (this._renderedAltitude / $ - this._renderedAltitude / ee);\n      this._displayOpacity = Math.sqrt(i(t, 0, 1)), this._displayOpacityTime = performance.now();\n    } else if (1 !== this._displayOpacity) {\n      const e = performance.now();\n      this._displayOpacityTime = this._displayOpacityTime > 0 ? this._displayOpacityTime : e;\n      const t = e - this._displayOpacityTime,\n            r = this.surface.textureFadeDuration;\n      if (t < r) return this._displayOpacity + (1 - this._displayOpacity) * (t / r);\n      this._displayOpacity = 1, this._displayOpacityTime = -1;\n    }\n\n    return this._displayOpacity;\n  }\n\n  setTileParameters(e) {\n    const t = e.renderData.overlay;\n\n    if (this.renderer.overlays.length > 0) {\n      const r = this.renderer.overlays[0],\n            s = this.renderer.overlays[1],\n            i = I(e.extent, e.surface.extent, he);\n      this._rectInsideRect(i, r.extent) || this._rectanglesOverlap(i, r.extent) || this._rectanglesOverlap(i, s.extent) ? (this._setTileOverlayData(i, 0, t), this._setTileOverlayData(i, 1, t)) : (this._clearTileOverlayData(0, t), this._clearTileOverlayData(1, t));\n    } else this._clearTileOverlayData(0, t), this._clearTileOverlayData(1, t);\n  }\n\n  overlayPixelSizeInMapUnits(e) {\n    if (0 === this.renderer.overlays.length) return 0;\n    const t = this.renderer.overlays[0],\n          r = this.renderer.overlays[1],\n          s = this._pointIsInExtent(e, t.extent) ? t : r;\n    return (s.extent[2] - s.extent[0]) / s.resolution;\n  }\n\n  _setTileOverlayData(e, t, r) {\n    if (0 === this.renderer.overlays.length) return;\n    const s = this.renderer.overlays[t].extent;\n    r.setScale(t, (e[2] - e[0]) / (s[2] - s[0]), (e[3] - e[1]) / (s[3] - s[1]));\n    let i = e[0];\n\n    if (this._longitudeCyclical) {\n      i = this._longitudeCyclical.minimalMonotonic(s[0], i);\n\n      const t = this._longitudeCyclical.minimalMonotonic(s[0], e[2]);\n\n      i > t && (i = t - (e[2] - e[0]));\n    }\n\n    r.setOffset(t, (i - s[0]) / (s[2] - s[0]), (e[1] - s[1]) / (s[3] - s[1]));\n  }\n\n  _clearTileOverlayData(e, t) {\n    t.setScale(e, -1, -1), t.setOffset(e, -1, -1);\n  }\n\n  async reloadShaders() {\n    Q(), await this.renderer.reloadShaders(), this.runTask();\n  }\n\n  stopAnimationsAtTime(e) {\n    this.renderer.stopAnimationsAtTime(e), this._drawTexturesAnimateDirty = !0;\n  }\n\n  _dispatchRendererUpdate(e) {\n    const t = l(e.time - this._animationTimeLast);\n    if (t < G) return;\n    this._animationTimeLast = e.time;\n    this.renderer.updateLogic({\n      dt: t,\n      camera: this.view.state.camera\n    }) && (this._drawTexturesAnimateDirty = !0);\n  }\n\n  _setDrawTexturesDirty() {\n    this.renderer.hasOverlays ? this._drawTexturesDirty = !0 : this.setOverlayPlacementDirty();\n  }\n\n  _intersectGroundFromView(e, t, r, s) {\n    const i = this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e, ce, t, r);\n    if (o(i)) return !1;\n    const a = i.origin,\n          n = y(ne, i.origin, i.direction);\n    return this.groundIntersector.reset(a, n), this.groundIntersector.intersect([], null, e), this.view.basemapTerrain.intersect(this.groundIntersector, null, a, n), this.groundIntersector.results.min.getIntersectionPoint(s);\n  }\n\n  _findHorizonBasedPointOfInterest(e, t) {\n    let r = .5;\n    const s = .55,\n          a = this.view.renderCoordsHelper.getAltitude(e.eye),\n          n = this.view.pointsOfInterest.centerOnSurfaceFrequent,\n          o = 1e-5,\n          h = i(n.estimatedSurfaceAltitude, e.aboveGround ? -1 / 0 : a + o, e.aboveGround ? a - o : 1 / 0),\n          l = e.aboveGround;\n\n    if (\"global\" === this.view.viewingMode) {\n      const t = ne;\n      L(H(x(this.view.spatialReference).radius + h), P(e.eye, e.viewForward), t), _(t, t, e.eye);\n      const i = Y.normalize(k(e.viewForward, t, e.viewRight)) / e.fovY + .5,\n            a = i <= 0 || i >= 1 ? .5 : s;\n      r = l ? a * i : i + a * (1 - i);\n    } else {\n      const t = .5 * Math.PI - Math.acos(-e.viewForward[2]),\n            a = Math.tan(t),\n            n = R(0, a, 1, 0),\n            o = O(n, n, e.projectionMatrix)[1],\n            h = i(.5 + .5 * o, 0, 1);\n      r = 1 === h || 0 === h ? .5 : l ? h * s : 1 - (1 - h) * s;\n    }\n\n    return !!this._intersectGroundFromView(e, .5, r, t) && g(t, e.eye) < n.distance * n.distance;\n  }\n\n  _computeOverlayExtents(e, t, r) {\n    const s = this.surface.extent,\n          i = this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,\n          h = v();\n    this._findHorizonBasedPointOfInterest(e, h) || m(h, i), this._renderedAltitude = this.view.renderCoordsHelper.getAltitude(e.eye);\n    const l = f(e.eye, h),\n          c = F(this.view.renderCoordsHelper, i, e.eye),\n          d = Math.PI / 2 - Math.abs(c - Math.PI / 2);\n    B.OVERLAY_SHOW_CENTER ? (o(re) && (re = new W(this.view.graphics, \"red\")), re.showPoint(h, this._renderSR)) : n(re) && re.remove(), this._overlaySREqualsRenderSR || S(h, this._renderSR, h, this._spatialReference);\n\n    let p = t * e.perRenderPixelRatio * l / 2,\n        y = !1,\n        _ = 1 / 0;\n\n    this._isSpherical && n(this._spatialReference) && (this._spatialReference.isWebMercator ? (p /= Math.cos(q(h[1])), _ = this.surface.extent[3]) : (y = !0, p /= x(this._spatialReference).metersPerDegree, _ = 90), p >= _ && (p = _, h[1] = 0, this._spatialReference.isWebMercator && (h[0] = 0)));\n    let g = 1;\n    y && (g = 1 / Math.max(.2, Math.cos(Math.abs(a(h[1])))), p * g > 180 && (g = 180 / p));\n    const O = Math.log(2) / 12;\n    p = Math.exp(Math.round(Math.log(p) / O) * O);\n    const D = p * g,\n          R = 32,\n          M = .5 * t / (R * D),\n          j = .5 * t / (R * p);\n    h[0] = Math.round(h[0] * M) / M, h[1] = Math.round(h[1] * j) / j;\n    const E = r.inner;\n    E[0] = h[0] - D, E[1] = h[1] - p, E[2] = h[0] + D, E[3] = h[1] + p, this._isSpherical && this._shiftExtentToFitBounds(E, 1 / 0, _);\n    const A = r.outer;\n    if (C(A, E), 6 * D > s[2] - s[0]) C(A, s);else if (d <= .25 * Math.PI) A[0] -= D, A[1] -= p, A[2] += D, A[3] += p;else {\n      S(e.eye, this._renderSR, ne, this._spatialReference), u(ae, h, ne);\n      let t = -Math.atan2(ae[1], ae[0]) + .125 * Math.PI;\n      t < 0 && (t += 2 * Math.PI);\n      const r = Math.floor(t / (.25 * Math.PI));\n      w(ae, te[r], 2 * p), ae[0] *= g, ae[2] *= g, T(A, A, ae);\n    }\n\n    if (this._isSpherical && (A[0] = this._longitudeCyclical.clamp(A[0]), A[2] = this._longitudeCyclical.clamp(A[2]), A[1] = Math.max(A[1], -_), A[3] = Math.min(A[3], _)), !this._isSpherical && s) {\n      const e = I(E, s, he),\n            t = I(A, s, le);\n      b(e, t) && (A[2] = A[0], A[3] = A[1]);\n    }\n  }\n\n  _drawOverlayTextures(e) {\n    if (0 === e.length || !this._drawTexturesDirty && !this._drawTexturesAnimateDirty) return;\n\n    const t = this._drawOverlay(e[0]),\n          r = this._drawOverlay(e[1]);\n\n    0 !== t && 0 !== r || this.surface.updateTileOverlayParams(), this._collectUnusedRenderTargetMemory(), this._drapeTargets.forEach(e => this._updateDrapeTarget(e)), this._drawTexturesAnimateDirty = !1, this._drawTexturesDirty ? (this._drawTexturesDirty = !1, this.surface.requestRender(), this.surface.requestUpdate()) : this.surface.requestRender(0);\n  }\n\n  _drawOverlay(e) {\n    return this._longitudeCyclical ? e.setupGeometryViewsCyclical(this._longitudeCyclical) : e.setupGeometryViewsDirect(), e.draw(this.renderer, this.view.state.camera.pixelRatio);\n  }\n\n  _collectUnusedRenderTargetMemory() {\n    if (this._hasUnusedRenderTargets = !1, this.renderer.hasOverlays) {\n      const e = performance.now();\n      this._hasUnusedRenderTargets = this.renderer.collectUnusedRenderTargetMemory(e);\n    }\n  }\n\n  _rectanglesOverlap(e, t) {\n    return this._longitudeCyclical ? (this._longitudeCyclical.contains(t[0], t[2], e[0]) || this._longitudeCyclical.contains(t[0], t[2], e[2]) || this._longitudeCyclical.contains(e[0], e[2], t[0])) && !(e[1] > t[3] || e[3] < t[1]) : E(e, t);\n  }\n\n  _rectInsideRect(e, t) {\n    return this._longitudeCyclical ? this._longitudeCyclical.contains(t[0], t[2], e[0]) && this._longitudeCyclical.contains(t[0], t[2], e[2]) && e[1] > t[1] && e[3] < t[3] : b(t, e);\n  }\n\n  _pointIsInExtent(e, t) {\n    if (this._longitudeCyclical) return this._longitudeCyclical.contains(t[0], t[2], e.x) && e.y >= t[1] && e.y <= t[3];\n    const r = e.x,\n          s = e.y;\n    return r > t[0] && r < t[2] && s > t[1] && s < t[3];\n  }\n\n  _shiftExtentToFitBounds(e, t, r) {\n    let s = 0,\n        i = 0;\n    e[0] < -t ? s = e[0] + t : e[2] > t && (s = t - e[2]), e[1] < -r ? i = e[1] + r : e[3] > r && (i = r - e[3]), A(e, s, i);\n  }\n\n  get test() {\n    return {\n      renderer: this.renderer,\n      update: () => this.runTask()\n    };\n  }\n\n};\n\nfunction ie(e, t) {\n  const r = 1e-5,\n        s = B.TESTS_DISABLE_UPDATE_THRESHOLDS ? 0 : r * Math.max(e[2] - e[0], e[3] - e[1], t[2] - t[0], t[3] - t[1]);\n\n  for (let i = 0; i < 4; i++) if (Math.abs(t[i] - e[i]) > s) return !0;\n\n  return !1;\n}\n\ne([d()], se.prototype, \"_spatialReference\", void 0), e([d({\n  readOnly: !0\n})], se.prototype, \"running\", null), e([d()], se.prototype, \"_placementDirty\", void 0), e([d()], se.prototype, \"_layerViewsDirty\", void 0), e([d()], se.prototype, \"renderer\", void 0), e([d({\n  constructOnly: !0\n})], se.prototype, \"surface\", void 0), e([d({\n  readOnly: !0,\n  aliasOf: \"surface.suspended\"\n})], se.prototype, \"suspended\", void 0), e([d({\n  readOnly: !0\n})], se.prototype, \"updating\", null), e([d({\n  type: Boolean\n})], se.prototype, \"hasHighlights\", null), e([d({\n  type: Boolean\n})], se.prototype, \"rendersOccluded\", null), se = e([p(\"esri.views.3d.terrain.OverlayManager\")], se);\nconst ae = D(),\n      ne = v(),\n      oe = {\n  inner: U(),\n  outer: U()\n},\n      he = U(),\n      le = U(),\n      ce = V();\nexport { se as OverlayManager };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/terrain/OverlayManager.js"],"names":["_","e","t","r","s","clamp","i","deg2rad","a","isSome","n","isNone","o","addFrameTask","h","Milliseconds","l","getMetersPerUnitForSR","c","property","d","subclass","p","u","b","y","f","g","m","v","O","w","T","D","R","projectVectorToVector","S","getReferenceEllipsoid","x","width","M","set","C","center","j","intersection","I","contains","intersects","E","offset","A","create","U","wrap","P","V","L","H","angleAroundAxis","k","y2lat","q","viewAngle","F","DESIRED_DRAPED_ANIMATION_MS","G","B","GraphicsHandle","W","Cyclical","z","cyclicalPI","Y","computeOverlayResolution","N","OverlayRenderer","X","Intersector","J","fromValues","K","removeLoadedShaderModules","Q","TaskPriority","Z","$","ee","te","re","se","constructor","_handles","_spatialReference","_renderSR","_overlaySREqualsRenderSR","_drapeSources","Map","_drapeTargets","Set","_renderedAltitude","_displayOpacity","_displayOpacityTime","_placementDirty","_drawTexturesDirty","_drawTexturesAnimateDirty","_layerViewsDirty","_hasUnusedRenderTargets","_longitudeCyclical","_latestOriginId","_maxResolution","_animationTimeLast","running","size","view","graphics","length","OVERLAY_DRAW_DEBUG_TEXTURE","suspended","surface","ready","_isSpherical","state","isGlobal","updating","renderer","hasHighlights","rendersOccluded","initialize","globalUnitScale","spatialReference","onHasHighlightsChanged","_setDrawTexturesDirty","notifyChange","onRendersOccludedChanged","onContentChanged","onHasWaterChanged","_stage","renderView","setRenderParameters","hasOverlayWater","groundIntersector","viewingMode","options","backfacesTerrain","invisibleTerrain","hud","add","watch","setOverlayPlacementDirty","on","allLayerViews","preRender","processSyncLayers","_updateLayerViews","hasOverlays","_dispatchRendererUpdate","_drawOverlayTextures","overlays","_collectUnusedRenderTargetMemory","resourceController","scheduler","registerTask","OVERLAY_MANAGER","events","_updateOverlays","destroy","forEach","unregisterDrapeSource","_unregisterDrapeTarget","dispose","remove","setSpatialReference","renderSpatialReference","equals","isWebMercator","longitudeCyclical","disposeOverlays","getGpuMemoryUsage","gpuMemoryUsage","items","uid","has","_registerDrapeSource","_registerDrapeTarget","updateLayerOrder","registerDrapeSource","ensureOverlays","_updateDrapeSource","_setOverlayContentDirty","setDrapingExtent","delete","ensureDrapeSources","_updateDrapeTarget","setDrapingTextures","ensureDrapeTargets","runTask","camera","fullWidth","fullHeight","_computeOverlayExtents","oe","inner","outer","_updateOverlay","updateTileOverlayParams","updateOverlayOpacity","ie","extent","resolution","pixelRatio","renderLocalOrigin","computeOpacity","Math","sqrt","performance","now","textureFadeDuration","setTileParameters","renderData","overlay","he","_rectInsideRect","_rectanglesOverlap","_setTileOverlayData","_clearTileOverlayData","overlayPixelSizeInMapUnits","_pointIsInExtent","setScale","minimalMonotonic","setOffset","reloadShaders","stopAnimationsAtTime","time","updateLogic","dt","_intersectGroundFromView","sceneIntersectionHelper","getCenterRayWithSubpixelOffset","ce","origin","ne","direction","reset","intersect","basemapTerrain","results","min","getIntersectionPoint","_findHorizonBasedPointOfInterest","renderCoordsHelper","getAltitude","eye","pointsOfInterest","centerOnSurfaceFrequent","estimatedSurfaceAltitude","aboveGround","radius","viewForward","normalize","viewRight","fovY","PI","acos","tan","projectionMatrix","distance","renderLocation","abs","OVERLAY_SHOW_CENTER","showPoint","perRenderPixelRatio","cos","metersPerDegree","max","log","exp","round","_shiftExtentToFitBounds","ae","atan2","floor","le","_drawOverlay","requestRender","requestUpdate","setupGeometryViewsCyclical","setupGeometryViewsDirect","draw","collectUnusedRenderTargetMemory","test","update","TESTS_DISABLE_UPDATE_THRESHOLDS","prototype","readOnly","constructOnly","aliasOf","type","Boolean","OverlayManager"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import r from\"../../../core/Handles.js\";import s from\"../../../core/has.js\";import{clamp as i,deg2rad as a}from\"../../../core/mathUtils.js\";import{isSome as n,isNone as o}from\"../../../core/maybe.js\";import{addFrameTask as h}from\"../../../core/scheduling.js\";import{Milliseconds as l}from\"../../../core/time.js\";import{getMetersPerUnitForSR as c}from\"../../../core/unitUtils.js\";import{property as d}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import{a as u}from\"../../../chunks/vec2.js\";import{b as y,f as _,y as g,g as m,i as f}from\"../../../chunks/vec3.js\";import{c as v}from\"../../../chunks/vec3f64.js\";import{t as O,b as w,a as T}from\"../../../chunks/vec4.js\";import{c as D,f as R}from\"../../../chunks/vec4f64.js\";import{projectVectorToVector as S}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as x}from\"../../../geometry/projectionEllipsoid.js\";import{width as M,set as C,center as j,intersection as I,contains as b,intersects as E,offset as A,create as U}from\"../../../geometry/support/aaBoundingRect.js\";import{wrap as P,create as V}from\"../../../geometry/support/ray.js\";import{b as L,e as H}from\"../../../chunks/sphere.js\";import{angleAroundAxis as k}from\"../../../geometry/support/vector.js\";import{y2lat as q}from\"../../../geometry/support/webMercatorUtils.js\";import{viewAngle as F}from\"../state/utils/viewUtils.js\";import{DESIRED_DRAPED_ANIMATION_MS as G}from\"../support/animationUtils.js\";import B from\"../support/debugFlags.js\";import{GraphicsHandle as W}from\"../support/debugUtils.js\";import{Cyclical as z,cyclicalPI as Y}from\"../support/mathUtils.js\";import{computeOverlayResolution as N}from\"./Overlay.js\";import{OverlayRenderer as X}from\"./OverlayRenderer.js\";import{Intersector as J}from\"../webgl-engine/lib/Intersector.js\";import{fromValues as K}from\"../webgl-engine/lib/localOrigin.js\";import{removeLoadedShaderModules as Q}from\"../webgl-engine/parts/requireUtils.js\";import{TaskPriority as Z}from\"../../support/Scheduler.js\";const $=3.5,ee=10,te=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let re,se=class extends t{constructor(e){super(e),this._handles=new r,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Map,this._drapeTargets=new Set,this._renderedAltitude=0,this._displayOpacity=0,this._displayOpacityTime=-1,this._placementDirty=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._layerViewsDirty=!0,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=s(\"esri-mobile\")?2048:4096,this._animationTimeLast=0}get running(){return(this._placementDirty||this._layerViewsDirty)&&(this._drapeSources.size>0||this.view.graphics.length>0||B.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view,t=e.state.isGlobal&&n(this._spatialReference)?c(this._spatialReference):1;this.renderer=new X({view:e,globalUnitScale:t,spatialReference:this._spatialReference}),this.renderer.onHasHighlightsChanged=()=>{this._setDrawTexturesDirty(),this.notifyChange(\"hasHighlights\")},this.renderer.onRendersOccludedChanged=()=>{this._setDrawTexturesDirty(),this.notifyChange(\"rendersOccluded\")},this.renderer.onContentChanged=()=>this._setDrawTexturesDirty(),this.renderer.onHasWaterChanged=t=>{var r;return null==(r=e._stage)?void 0:r.renderView.setRenderParameters({hasOverlayWater:t})},this.groundIntersector=new J(this.view.state.viewingMode),this.groundIntersector.options.backfacesTerrain=!0,this.groundIntersector.options.invisibleTerrain=!0,this.groundIntersector.options.hud=!1,this._handles.add([e.watch([\"pointsOfInterest.renderPointOfView\",\"pointsOfInterest.centerOnSurfaceFrequent.location\",\"pixelRatio\"],(()=>this.setOverlayPlacementDirty())),this.surface.on(\"elevation-change\",(()=>this.setOverlayPlacementDirty())),e.allLayerViews.on(\"after-changes\",(()=>this._layerViewsDirty=!0)),e.on(\"resize\",(()=>this.setOverlayPlacementDirty())),h({preRender:e=>{this.renderer.processSyncLayers(),this._updateLayerViews(),this.renderer.hasOverlays&&(this._dispatchRendererUpdate(e),this._drawOverlayTextures(this.renderer.overlays)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(Z.OVERLAY_MANAGER,this),e._stage.renderView.events.on(\"force-camera-for-screenshot\",(e=>{this._updateOverlays(e),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays)}))]),this._updateLayerViews()}destroy(){this._drapeSources.forEach(((e,t)=>this.unregisterDrapeSource(t))),this._drapeTargets.forEach((e=>this._unregisterDrapeTarget(e))),this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),n(re)&&(re.remove(),re=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;n(e)&&n(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new z(-20037508.342787,20037508.342787):new z(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.globalUnitScale=this._isSpherical&&n(this._spatialReference)?c(this._spatialReference):1)):this.renderer.disposeOverlays()}getGpuMemoryUsage(){return this.renderer.gpuMemoryUsage}_updateLayerViews(){if(!this._layerViewsDirty)return;const e=new Set;for(const t of this.view.allLayerViews.items)e.add(t.uid),\"drapeSourceType\"in t&&!this._drapeSources.has(t)&&this._registerDrapeSource(t,0),\"drapeTargetType\"in t&&!this._drapeTargets.has(t)&&this._registerDrapeTarget(t);this._drapeSources.forEach(((t,r)=>{0!==t||e.has(r.uid)||this.unregisterDrapeSource(r)})),this._drapeTargets.forEach((t=>{e.has(t.uid)||this._unregisterDrapeTarget(t)})),this.renderer.updateLayerOrder(),this._setDrawTexturesDirty(),this._layerViewsDirty=!1}registerDrapeSource(e){this._registerDrapeSource(e,1)}_registerDrapeSource(e,t){this._drapeSources.set(e,t),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources),this.renderer.overlays.forEach((t=>{this._updateDrapeSource(e,t)})),this._setOverlayContentDirty(),this.notifyChange(\"running\")}_updateDrapeSource(e,t){n(e.setDrapingExtent)&&n(this._spatialReference)&&e.setDrapingExtent(t,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setOverlayContentDirty(),this.notifyChange(\"running\"))}_registerDrapeTarget(e){this._drapeTargets.add(e),this._updateDrapeTarget(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}_updateDrapeTarget(e){this.renderer.overlays.forEach((t=>e.setDrapingTextures(t)))}_unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setOverlayContentDirty(){this.setOverlayPlacementDirty(),this._setDrawTexturesDirty()}setOverlayPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera)}_updateOverlays(e){if(!this._spatialReference)return;this._updateLayerViews();const t=N(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,t,oe);const r=M(oe.inner)/M(oe.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(0,oe.inner,t,1),i=this._updateOverlay(1,oe.outer,t,r);(s||i)&&(this.surface.updateTileOverlayParams(),this._setDrawTexturesDirty()),this._placementDirty=!1,this.surface.updateOverlayOpacity()}_updateOverlay(e,t,r,s){if(0===this.renderer.overlays.length)return!1;const i=this.renderer.overlays[e];if(!ie(t,i.extent)&&r===i.resolution&&i.pixelRatio===s)return!1;C(i.extent,t),i.resolution=r,i.pixelRatio=s;const a=j(i.extent);return i.renderLocalOrigin=K(a[0],a[1],0,\"OV_\"+this._latestOriginId++),this._drapeSources.forEach(((e,t)=>this._updateDrapeSource(t,i))),!0}computeOpacity(e){if(!this.renderer.hasOverlays)return this._displayOpacity=0,this._displayOpacityTime=-1,1;if(e*$<this._renderedAltitude){const t=(e-this._renderedAltitude/ee)/(this._renderedAltitude/$-this._renderedAltitude/ee);this._displayOpacity=Math.sqrt(i(t,0,1)),this._displayOpacityTime=performance.now()}else if(1!==this._displayOpacity){const e=performance.now();this._displayOpacityTime=this._displayOpacityTime>0?this._displayOpacityTime:e;const t=e-this._displayOpacityTime,r=this.surface.textureFadeDuration;if(t<r)return this._displayOpacity+(1-this._displayOpacity)*(t/r);this._displayOpacity=1,this._displayOpacityTime=-1}return this._displayOpacity}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[0],s=this.renderer.overlays[1],i=I(e.extent,e.surface.extent,he);this._rectInsideRect(i,r.extent)||this._rectanglesOverlap(i,r.extent)||this._rectanglesOverlap(i,s.extent)?(this._setTileOverlayData(i,0,t),this._setTileOverlayData(i,1,t)):(this._clearTileOverlayData(0,t),this._clearTileOverlayData(1,t))}else this._clearTileOverlayData(0,t),this._clearTileOverlayData(1,t)}overlayPixelSizeInMapUnits(e){if(0===this.renderer.overlays.length)return 0;const t=this.renderer.overlays[0],r=this.renderer.overlays[1],s=this._pointIsInExtent(e,t.extent)?t:r;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,t,r){if(0===this.renderer.overlays.length)return;const s=this.renderer.overlays[t].extent;r.setScale(t,(e[2]-e[0])/(s[2]-s[0]),(e[3]-e[1])/(s[3]-s[1]));let i=e[0];if(this._longitudeCyclical){i=this._longitudeCyclical.minimalMonotonic(s[0],i);const t=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);i>t&&(i=t-(e[2]-e[0]))}r.setOffset(t,(i-s[0])/(s[2]-s[0]),(e[1]-s[1])/(s[3]-s[1]))}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){Q(),await this.renderer.reloadShaders(),this.runTask()}stopAnimationsAtTime(e){this.renderer.stopAnimationsAtTime(e),this._drawTexturesAnimateDirty=!0}_dispatchRendererUpdate(e){const t=l(e.time-this._animationTimeLast);if(t<G)return;this._animationTimeLast=e.time;this.renderer.updateLogic({dt:t,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0)}_setDrawTexturesDirty(){this.renderer.hasOverlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()}_intersectGroundFromView(e,t,r,s){const i=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,ce,t,r);if(o(i))return!1;const a=i.origin,n=y(ne,i.origin,i.direction);return this.groundIntersector.reset(a,n),this.groundIntersector.intersect([],null,e),this.view.basemapTerrain.intersect(this.groundIntersector,null,a,n),this.groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const s=.55,a=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,h=i(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:a+o,e.aboveGround?a-o:1/0),l=e.aboveGround;if(\"global\"===this.view.viewingMode){const t=ne;L(H(x(this.view.spatialReference).radius+h),P(e.eye,e.viewForward),t),_(t,t,e.eye);const i=Y.normalize(k(e.viewForward,t,e.viewRight))/e.fovY+.5,a=i<=0||i>=1?.5:s;r=l?a*i:i+a*(1-i)}else{const t=.5*Math.PI-Math.acos(-e.viewForward[2]),a=Math.tan(t),n=R(0,a,1,0),o=O(n,n,e.projectionMatrix)[1],h=i(.5+.5*o,0,1);r=1===h||0===h?.5:l?h*s:1-(1-h)*s}return!!this._intersectGroundFromView(e,.5,r,t)&&g(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,r){const s=this.surface.extent,i=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,h=v();this._findHorizonBasedPointOfInterest(e,h)||m(h,i),this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(e.eye);const l=f(e.eye,h),c=F(this.view.renderCoordsHelper,i,e.eye),d=Math.PI/2-Math.abs(c-Math.PI/2);B.OVERLAY_SHOW_CENTER?(o(re)&&(re=new W(this.view.graphics,\"red\")),re.showPoint(h,this._renderSR)):n(re)&&re.remove(),this._overlaySREqualsRenderSR||S(h,this._renderSR,h,this._spatialReference);let p=t*e.perRenderPixelRatio*l/2,y=!1,_=1/0;this._isSpherical&&n(this._spatialReference)&&(this._spatialReference.isWebMercator?(p/=Math.cos(q(h[1])),_=this.surface.extent[3]):(y=!0,p/=x(this._spatialReference).metersPerDegree,_=90),p>=_&&(p=_,h[1]=0,this._spatialReference.isWebMercator&&(h[0]=0)));let g=1;y&&(g=1/Math.max(.2,Math.cos(Math.abs(a(h[1])))),p*g>180&&(g=180/p));const O=Math.log(2)/12;p=Math.exp(Math.round(Math.log(p)/O)*O);const D=p*g,R=32,M=.5*t/(R*D),j=.5*t/(R*p);h[0]=Math.round(h[0]*M)/M,h[1]=Math.round(h[1]*j)/j;const E=r.inner;E[0]=h[0]-D,E[1]=h[1]-p,E[2]=h[0]+D,E[3]=h[1]+p,this._isSpherical&&this._shiftExtentToFitBounds(E,1/0,_);const A=r.outer;if(C(A,E),6*D>s[2]-s[0])C(A,s);else if(d<=.25*Math.PI)A[0]-=D,A[1]-=p,A[2]+=D,A[3]+=p;else{S(e.eye,this._renderSR,ne,this._spatialReference),u(ae,h,ne);let t=-Math.atan2(ae[1],ae[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const r=Math.floor(t/(.25*Math.PI));w(ae,te[r],2*p),ae[0]*=g,ae[2]*=g,T(A,A,ae)}if(this._isSpherical&&(A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-_),A[3]=Math.min(A[3],_)),!this._isSpherical&&s){const e=I(E,s,he),t=I(A,s,le);b(e,t)&&(A[2]=A[0],A[3]=A[1])}}_drawOverlayTextures(e){if(0===e.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const t=this._drawOverlay(e[0]),r=this._drawOverlay(e[1]);0!==t&&0!==r||this.surface.updateTileOverlayParams(),this._collectUnusedRenderTargetMemory(),this._drapeTargets.forEach((e=>this._updateDrapeTarget(e))),this._drawTexturesAnimateDirty=!1,this._drawTexturesDirty?(this._drawTexturesDirty=!1,this.surface.requestRender(),this.surface.requestUpdate()):this.surface.requestRender(0)}_drawOverlay(e){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,this.view.state.camera.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):E(e,t)}_rectInsideRect(e,t){return this._longitudeCyclical?this._longitudeCyclical.contains(t[0],t[2],e[0])&&this._longitudeCyclical.contains(t[0],t[2],e[2])&&e[1]>t[1]&&e[3]<t[3]:b(t,e)}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,s=e.y;return r>t[0]&&r<t[2]&&s>t[1]&&s<t[3]}_shiftExtentToFitBounds(e,t,r){let s=0,i=0;e[0]<-t?s=e[0]+t:e[2]>t&&(s=t-e[2]),e[1]<-r?i=e[1]+r:e[3]>r&&(i=r-e[3]),A(e,s,i)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function ie(e,t){const r=1e-5,s=B.TESTS_DISABLE_UPDATE_THRESHOLDS?0:r*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);for(let i=0;i<4;i++)if(Math.abs(t[i]-e[i])>s)return!0;return!1}e([d()],se.prototype,\"_spatialReference\",void 0),e([d({readOnly:!0})],se.prototype,\"running\",null),e([d()],se.prototype,\"_placementDirty\",void 0),e([d()],se.prototype,\"_layerViewsDirty\",void 0),e([d()],se.prototype,\"renderer\",void 0),e([d({constructOnly:!0})],se.prototype,\"surface\",void 0),e([d({readOnly:!0,aliasOf:\"surface.suspended\"})],se.prototype,\"suspended\",void 0),e([d({readOnly:!0})],se.prototype,\"updating\",null),e([d({type:Boolean})],se.prototype,\"hasHighlights\",null),e([d({type:Boolean})],se.prototype,\"rendersOccluded\",null),se=e([p(\"esri.views.3d.terrain.OverlayManager\")],se);const ae=D(),ne=v(),oe={inner:U(),outer:U()},he=U(),le=U(),ce=V();export{se as OverlayManager};\n"]},"metadata":{},"sourceType":"module"}