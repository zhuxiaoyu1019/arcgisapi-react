{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { result as r } from \"../../core/asyncUtils.js\";\nimport e from \"../../core/Error.js\";\nimport { eachAlways as o, throwIfAborted as t } from \"../../core/promiseUtils.js\";\nimport { generateUUID as s } from \"../../core/uuid.js\";\nimport { getSiblingOfSameTypeI as c } from \"../../portal/support/resourceUtils.js\";\n\nasync function a(r, a, u) {\n  if (!a || !a.resources) return;\n  const h = a.portalItem === r.portalItem ? new Set(r.paths) : new Set();\n  r.paths.length = 0, r.portalItem = a.portalItem;\n  const i = new Set(a.resources.toKeep.map(r => r.resource.path)),\n        f = new Set(),\n        m = [];\n  i.forEach(e => {\n    h.delete(e), r.paths.push(e);\n  });\n\n  for (const e of a.resources.toUpdate) if (h.delete(e.resource.path), i.has(e.resource.path) || f.has(e.resource.path)) {\n    const {\n      resource: o,\n      content: t,\n      finish: a,\n      error: p\n    } = e,\n          h = c(o, s());\n    r.paths.push(h.path), m.push(n({\n      resource: h,\n      content: t,\n      finish: a,\n      error: p\n    }, u));\n  } else r.paths.push(e.resource.path), m.push(p(e, u)), f.add(e.resource.path);\n\n  for (const e of a.resources.toAdd) m.push(n(e, u)), r.paths.push(e.resource.path);\n\n  if (h.forEach(r => {\n    const e = a.portalItem.resourceFromPath(r);\n    m.push(e.portalItem.removeResource(e).catch(() => {}));\n  }), 0 === m.length) return;\n  const l = await o(m);\n  t(u);\n  const d = l.filter(r => \"error\" in r).map(r => r.error);\n  if (d.length > 0) throw new e(\"save:resources\", \"Failed to save one or more resources\", {\n    errors: d\n  });\n}\n\nasync function n(e, o) {\n  const t = await r(e.resource.portalItem.addResource(e.resource, e.content, o));\n  if (!0 !== t.ok) throw e.error && e.error(t.error), t.error;\n  e.finish && e.finish(e.resource);\n}\n\nasync function p(e, o) {\n  const t = await r(e.resource.update(e.content, o));\n  if (!0 !== t.ok) throw e.error(t.error), t.error;\n  e.finish(e.resource);\n}\n\nexport { a as saveResources };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/webdoc/support/saveUtils.js"],"names":["result","r","e","eachAlways","o","throwIfAborted","t","generateUUID","s","getSiblingOfSameTypeI","c","a","u","resources","h","portalItem","Set","paths","length","i","toKeep","map","resource","path","f","m","forEach","delete","push","toUpdate","has","content","finish","error","p","n","add","toAdd","resourceFromPath","removeResource","catch","l","d","filter","errors","addResource","ok","update","saveResources"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{result as r}from\"../../core/asyncUtils.js\";import e from\"../../core/Error.js\";import{eachAlways as o,throwIfAborted as t}from\"../../core/promiseUtils.js\";import{generateUUID as s}from\"../../core/uuid.js\";import{getSiblingOfSameTypeI as c}from\"../../portal/support/resourceUtils.js\";async function a(r,a,u){if(!a||!a.resources)return;const h=a.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=a.portalItem;const i=new Set(a.resources.toKeep.map((r=>r.resource.path))),f=new Set,m=[];i.forEach((e=>{h.delete(e),r.paths.push(e)}));for(const e of a.resources.toUpdate)if(h.delete(e.resource.path),i.has(e.resource.path)||f.has(e.resource.path)){const{resource:o,content:t,finish:a,error:p}=e,h=c(o,s());r.paths.push(h.path),m.push(n({resource:h,content:t,finish:a,error:p},u))}else r.paths.push(e.resource.path),m.push(p(e,u)),f.add(e.resource.path);for(const e of a.resources.toAdd)m.push(n(e,u)),r.paths.push(e.resource.path);if(h.forEach((r=>{const e=a.portalItem.resourceFromPath(r);m.push(e.portalItem.removeResource(e).catch((()=>{})))})),0===m.length)return;const l=await o(m);t(u);const d=l.filter((r=>\"error\"in r)).map((r=>r.error));if(d.length>0)throw new e(\"save:resources\",\"Failed to save one or more resources\",{errors:d})}async function n(e,o){const t=await r(e.resource.portalItem.addResource(e.resource,e.content,o));if(!0!==t.ok)throw e.error&&e.error(t.error),t.error;e.finish&&e.finish(e.resource)}async function p(e,o){const t=await r(e.resource.update(e.content,o));if(!0!==t.ok)throw e.error(t.error),t.error;e.finish(e.resource)}export{a as saveResources};\n"]},"metadata":{},"sourceType":"module"}