{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport i from \"../../../../core/Accessor.js\";\nimport t from \"../../../../core/Handles.js\";\nimport { isSome as s, isNone as a } from \"../../../../core/maybe.js\";\nimport { property as r } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as l } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { scaleBoundsPredicate as n } from \"../../../support/layerViewUtils.js\";\nimport { TaskPriority as c } from \"../../../support/Scheduler.js\";\nlet h = class extends i {\n  constructor() {\n    super(...arguments), this._scaleRangeActive = !1, this.layerScaleRangeVisibilityQuery = !1, this.handles = new t(), this.layerView = null, this.layer = null, this.queryGraphicUIDsInExtent = null, this.extent = null, this.graphicsCore = null, this.basemapTerrain = null, this.layerScaleEnabled = !0, this.suspended = !1, this.updating = !0;\n  }\n\n  setup(e, i, t, s, a) {\n    this.layerView = e, this.layer = i, this.queryGraphicUIDsInExtent = t, this.graphicsCore = s, this.basemapTerrain = a, this.updateScaleRangeActive();\n    const r = this.layerView.view.resourceController.scheduler;\n    this.handles.add(r.registerTask(c.SCALE_VISIBILITY, this));\n  }\n\n  destroy() {\n    this.handles.destroy(), this.handles = null, this.layerView = null, this.extent = null, this.queryGraphicUIDsInExtent = null, this.graphicsCore = null;\n  }\n\n  _setDirty() {\n    this.updating || this._set(\"updating\", !0);\n  }\n\n  setExtent(e) {\n    this.extent = e, this._setDirty();\n  }\n\n  scaleRangeActive() {\n    return this._scaleRangeActive;\n  }\n\n  updateScaleRangeActive() {\n    const e = this.layer;\n    let i = this.layerScaleEnabled && p(e.minScale, e.maxScale);\n    e.labelingInfo && !i && (i = e.labelingInfo.some(e => e && p(e.minScale, e.maxScale)));\n    const t = this._scaleRangeActive !== i;\n    return this._scaleRangeActive = i, i && !this.handles.has(o) && this.basemapTerrain ? (this.handles.add(this.basemapTerrain.on(\"scale-change\", e => this.scaleUpdateHandler(e)), o), this.layerScaleEnabled && this.handles.add(this.basemapTerrain.on(\"tiles-visibility-changed\", () => this._setDirty()), o)) : !i && this.handles.has(o) && this.handles.remove(o), t;\n  }\n\n  get running() {\n    return !(!this.layerView.view.basemapTerrain || !this.updating);\n  }\n\n  runTask() {\n    const e = this.layerView.view.basemapTerrain;\n    this.extent && e && e.ready && this._scaleRangeActive && this.layerScaleEnabled ? this.layerScaleRangeVisibilityQuery || (this.layerScaleRangeVisibilityQuery = !0, e.queryVisibleScaleRange(this.extent, this.layer.minScale, this.layer.maxScale, e => this.finishUpdate(e))) : this.finishUpdate(!0);\n  }\n\n  finishUpdate(e) {\n    this.layerScaleRangeVisibilityQuery = !1, this._set(\"suspended\", !e), this._set(\"updating\", !1);\n  }\n\n  visibleAtLayerScale(e) {\n    return !this.layerScaleEnabled || n(e, this.layer.minScale || 0, this.layer.maxScale || 0);\n  }\n\n  visibleAtLabelScale(e, i) {\n    return n(e, i.minScale || 0, i.maxScale || 0);\n  }\n\n  graphicScale(e) {\n    let i;\n\n    if (s(e.centroid) ? i = e.centroid : s(e.graphic.geometry) && \"point\" === e.graphic.geometry.type && (i = e.graphic.geometry), i) {\n      return this.layerView.view.basemapTerrain ? this.layerView.view.basemapTerrain.getScale(i) : 1;\n    }\n\n    return null;\n  }\n\n  graphicVisible(e) {\n    if (!this.layerScaleEnabled) return !0;\n    const i = this.graphicScale(e);\n    return this.visibleAtLayerScale(i);\n  }\n\n  updateVisibility(e) {\n    if (this._scaleRangeActive) {\n      const i = this.graphicVisible(e);\n      return e.setVisibilityFlag(1, i, 0);\n    }\n\n    return !1;\n  }\n\n  updateGraphicLabelScaleVisibility(e) {\n    if (!this._scaleRangeActive) return !1;\n    if (!e.labelGraphics || 0 === e.labelGraphics.length) return !1;\n    const i = this.graphicScale(e),\n          t = this.updateLabelScaleVisibility(e, i);\n    return t && (this.layerView.view.deconflictor.setDirty(), this.layerView.view.labeler.setDirty()), t;\n  }\n\n  updateLabelScaleVisibility(e, i) {\n    if (!e.labelGraphics || 0 === e.labelGraphics.length) return !1;\n    const t = e.labelGraphics[0]._labelClass;\n\n    if (t && null != t.minScale && null != t.maxScale) {\n      const s = this.visibleAtLabelScale(i, t);\n      if (e.setVisibilityFlag(1, s, 1)) return !0;\n    }\n\n    return !1;\n  }\n\n  scaleUpdateHandler(e) {\n    if (this._setDirty(), this.layerView.suspended) return;\n    const i = e.extent,\n          t = e.scale,\n          r = this.visibleAtLayerScale(t);\n    let l = !1;\n    this.queryGraphicUIDsInExtent(i, e.spatialReference, e => {\n      const n = this.graphicsCore.getGraphics3DGraphicById(e);\n      if (a(n)) return;\n      const c = n.centroid;\n      s(c) && (i[0] > c.x || i[1] > c.y || i[2] < c.x || i[3] < c.y) || (n.setVisibilityFlag(1, r, 0) && (l = !0), this.updateLabelScaleVisibility(n, t) && (l = !0));\n    }), l && (this.layerView.view.deconflictor.setDirty(), this.layerView.view.labeler.setDirty());\n  }\n\n  layerMinMaxScaleChangeHandler() {\n    this.updateScaleRangeActive() && !this._scaleRangeActive ? this.graphicsCore.modifyGraphics3DGraphicVisibilities(e => e.clearVisibilityFlag(1)) : this._scaleRangeActive && this.graphicsCore.updateAllGraphicsVisibility(), this._setDirty();\n  }\n\n};\n\nfunction p(e, i) {\n  return e > 0 || i > 0;\n}\n\ne([r({\n  constructOnly: !0\n})], h.prototype, \"layerScaleEnabled\", void 0), e([r({\n  readOnly: !0\n})], h.prototype, \"suspended\", void 0), e([r({\n  readOnly: !0\n})], h.prototype, \"updating\", void 0), h = e([l(\"esri.views.3d.layers.graphics.Graphics3DScaleVisibility\")], h);\nconst o = \"terrain-events\";\nvar y = h;\nexport default y;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DScaleVisibility.js"],"names":["_","e","i","t","isSome","s","isNone","a","property","r","subclass","l","scaleBoundsPredicate","n","TaskPriority","c","h","constructor","arguments","_scaleRangeActive","layerScaleRangeVisibilityQuery","handles","layerView","layer","queryGraphicUIDsInExtent","extent","graphicsCore","basemapTerrain","layerScaleEnabled","suspended","updating","setup","updateScaleRangeActive","view","resourceController","scheduler","add","registerTask","SCALE_VISIBILITY","destroy","_setDirty","_set","setExtent","scaleRangeActive","p","minScale","maxScale","labelingInfo","some","has","o","on","scaleUpdateHandler","remove","running","runTask","ready","queryVisibleScaleRange","finishUpdate","visibleAtLayerScale","visibleAtLabelScale","graphicScale","centroid","graphic","geometry","type","getScale","graphicVisible","updateVisibility","setVisibilityFlag","updateGraphicLabelScaleVisibility","labelGraphics","length","updateLabelScaleVisibility","deconflictor","setDirty","labeler","_labelClass","scale","spatialReference","getGraphics3DGraphicById","x","y","layerMinMaxScaleChangeHandler","modifyGraphics3DGraphicVisibilities","clearVisibilityFlag","updateAllGraphicsVisibility","constructOnly","prototype","readOnly"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,iCAAlB;AAAoD,OAAOC,CAAP,MAAa,8BAAb;AAA4C,OAAOC,CAAP,MAAa,6BAAb;AAA2C,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,QAAmC,2BAAnC;AAA+D,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,yDAAzB;AAAmF,OAAM,yBAAN;AAAgC,OAAM,gDAAN;AAAuD,OAAM,4BAAN;AAAmC,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,yDAAzB;AAAmF,SAAOC,oBAAoB,IAAIC,CAA/B,QAAqC,oCAArC;AAA0E,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,+BAA7B;AAA6D,IAAIC,CAAC,GAAC,cAAcd,CAAd,CAAe;AAACe,EAAAA,WAAW,GAAE;AAAC,UAAM,GAAGC,SAAT,GAAoB,KAAKC,iBAAL,GAAuB,CAAC,CAA5C,EAA8C,KAAKC,8BAAL,GAAoC,CAAC,CAAnF,EAAqF,KAAKC,OAAL,GAAa,IAAIlB,CAAJ,EAAlG,EAAwG,KAAKmB,SAAL,GAAe,IAAvH,EAA4H,KAAKC,KAAL,GAAW,IAAvI,EAA4I,KAAKC,wBAAL,GAA8B,IAA1K,EAA+K,KAAKC,MAAL,GAAY,IAA3L,EAAgM,KAAKC,YAAL,GAAkB,IAAlN,EAAuN,KAAKC,cAAL,GAAoB,IAA3O,EAAgP,KAAKC,iBAAL,GAAuB,CAAC,CAAxQ,EAA0Q,KAAKC,SAAL,GAAe,CAAC,CAA1R,EAA4R,KAAKC,QAAL,GAAc,CAAC,CAA3S;AAA6S;;AAAAC,EAAAA,KAAK,CAAC9B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASE,CAAT,EAAW;AAAC,SAAKe,SAAL,GAAerB,CAAf,EAAiB,KAAKsB,KAAL,GAAWrB,CAA5B,EAA8B,KAAKsB,wBAAL,GAA8BrB,CAA5D,EAA8D,KAAKuB,YAAL,GAAkBrB,CAAhF,EAAkF,KAAKsB,cAAL,GAAoBpB,CAAtG,EAAwG,KAAKyB,sBAAL,EAAxG;AAAsI,UAAMvB,CAAC,GAAC,KAAKa,SAAL,CAAeW,IAAf,CAAoBC,kBAApB,CAAuCC,SAA/C;AAAyD,SAAKd,OAAL,CAAae,GAAb,CAAiB3B,CAAC,CAAC4B,YAAF,CAAetB,CAAC,CAACuB,gBAAjB,EAAkC,IAAlC,CAAjB;AAA0D;;AAAAC,EAAAA,OAAO,GAAE;AAAC,SAAKlB,OAAL,CAAakB,OAAb,IAAuB,KAAKlB,OAAL,GAAa,IAApC,EAAyC,KAAKC,SAAL,GAAe,IAAxD,EAA6D,KAAKG,MAAL,GAAY,IAAzE,EAA8E,KAAKD,wBAAL,GAA8B,IAA5G,EAAiH,KAAKE,YAAL,GAAkB,IAAnI;AAAwI;;AAAAc,EAAAA,SAAS,GAAE;AAAC,SAAKV,QAAL,IAAe,KAAKW,IAAL,CAAU,UAAV,EAAqB,CAAC,CAAtB,CAAf;AAAwC;;AAAAC,EAAAA,SAAS,CAACzC,CAAD,EAAG;AAAC,SAAKwB,MAAL,GAAYxB,CAAZ,EAAc,KAAKuC,SAAL,EAAd;AAA+B;;AAAAG,EAAAA,gBAAgB,GAAE;AAAC,WAAO,KAAKxB,iBAAZ;AAA8B;;AAAAa,EAAAA,sBAAsB,GAAE;AAAC,UAAM/B,CAAC,GAAC,KAAKsB,KAAb;AAAmB,QAAIrB,CAAC,GAAC,KAAK0B,iBAAL,IAAwBgB,CAAC,CAAC3C,CAAC,CAAC4C,QAAH,EAAY5C,CAAC,CAAC6C,QAAd,CAA/B;AAAuD7C,IAAAA,CAAC,CAAC8C,YAAF,IAAgB,CAAC7C,CAAjB,KAAqBA,CAAC,GAACD,CAAC,CAAC8C,YAAF,CAAeC,IAAf,CAAqB/C,CAAC,IAAEA,CAAC,IAAE2C,CAAC,CAAC3C,CAAC,CAAC4C,QAAH,EAAY5C,CAAC,CAAC6C,QAAd,CAA5B,CAAvB;AAA8E,UAAM3C,CAAC,GAAC,KAAKgB,iBAAL,KAAyBjB,CAAjC;AAAmC,WAAO,KAAKiB,iBAAL,GAAuBjB,CAAvB,EAAyBA,CAAC,IAAE,CAAC,KAAKmB,OAAL,CAAa4B,GAAb,CAAiBC,CAAjB,CAAJ,IAAyB,KAAKvB,cAA9B,IAA8C,KAAKN,OAAL,CAAae,GAAb,CAAiB,KAAKT,cAAL,CAAoBwB,EAApB,CAAuB,cAAvB,EAAuClD,CAAC,IAAE,KAAKmD,kBAAL,CAAwBnD,CAAxB,CAA1C,CAAjB,EAAwFiD,CAAxF,GAA2F,KAAKtB,iBAAL,IAAwB,KAAKP,OAAL,CAAae,GAAb,CAAiB,KAAKT,cAAL,CAAoBwB,EAApB,CAAuB,0BAAvB,EAAmD,MAAI,KAAKX,SAAL,EAAvD,CAAjB,EAA2FU,CAA3F,CAAjK,IAAgQ,CAAChD,CAAD,IAAI,KAAKmB,OAAL,CAAa4B,GAAb,CAAiBC,CAAjB,CAAJ,IAAyB,KAAK7B,OAAL,CAAagC,MAAb,CAAoBH,CAApB,CAAlT,EAAyU/C,CAAhV;AAAkV;;AAAW,MAAPmD,OAAO,GAAE;AAAC,WAAM,EAAE,CAAC,KAAKhC,SAAL,CAAeW,IAAf,CAAoBN,cAArB,IAAqC,CAAC,KAAKG,QAA7C,CAAN;AAA6D;;AAAAyB,EAAAA,OAAO,GAAE;AAAC,UAAMtD,CAAC,GAAC,KAAKqB,SAAL,CAAeW,IAAf,CAAoBN,cAA5B;AAA2C,SAAKF,MAAL,IAAaxB,CAAb,IAAgBA,CAAC,CAACuD,KAAlB,IAAyB,KAAKrC,iBAA9B,IAAiD,KAAKS,iBAAtD,GAAwE,KAAKR,8BAAL,KAAsC,KAAKA,8BAAL,GAAoC,CAAC,CAArC,EAAuCnB,CAAC,CAACwD,sBAAF,CAAyB,KAAKhC,MAA9B,EAAqC,KAAKF,KAAL,CAAWsB,QAAhD,EAAyD,KAAKtB,KAAL,CAAWuB,QAApE,EAA8E7C,CAAC,IAAE,KAAKyD,YAAL,CAAkBzD,CAAlB,CAAjF,CAA7E,CAAxE,GAA8P,KAAKyD,YAAL,CAAkB,CAAC,CAAnB,CAA9P;AAAoR;;AAAAA,EAAAA,YAAY,CAACzD,CAAD,EAAG;AAAC,SAAKmB,8BAAL,GAAoC,CAAC,CAArC,EAAuC,KAAKqB,IAAL,CAAU,WAAV,EAAsB,CAACxC,CAAvB,CAAvC,EAAiE,KAAKwC,IAAL,CAAU,UAAV,EAAqB,CAAC,CAAtB,CAAjE;AAA0F;;AAAAkB,EAAAA,mBAAmB,CAAC1D,CAAD,EAAG;AAAC,WAAM,CAAC,KAAK2B,iBAAN,IAAyBf,CAAC,CAACZ,CAAD,EAAG,KAAKsB,KAAL,CAAWsB,QAAX,IAAqB,CAAxB,EAA0B,KAAKtB,KAAL,CAAWuB,QAAX,IAAqB,CAA/C,CAAhC;AAAkF;;AAAAc,EAAAA,mBAAmB,CAAC3D,CAAD,EAAGC,CAAH,EAAK;AAAC,WAAOW,CAAC,CAACZ,CAAD,EAAGC,CAAC,CAAC2C,QAAF,IAAY,CAAf,EAAiB3C,CAAC,CAAC4C,QAAF,IAAY,CAA7B,CAAR;AAAwC;;AAAAe,EAAAA,YAAY,CAAC5D,CAAD,EAAG;AAAC,QAAIC,CAAJ;;AAAM,QAAGG,CAAC,CAACJ,CAAC,CAAC6D,QAAH,CAAD,GAAc5D,CAAC,GAACD,CAAC,CAAC6D,QAAlB,GAA2BzD,CAAC,CAACJ,CAAC,CAAC8D,OAAF,CAAUC,QAAX,CAAD,IAAuB,YAAU/D,CAAC,CAAC8D,OAAF,CAAUC,QAAV,CAAmBC,IAApD,KAA2D/D,CAAC,GAACD,CAAC,CAAC8D,OAAF,CAAUC,QAAvE,CAA3B,EAA4G9D,CAA/G,EAAiH;AAAC,aAAO,KAAKoB,SAAL,CAAeW,IAAf,CAAoBN,cAApB,GAAmC,KAAKL,SAAL,CAAeW,IAAf,CAAoBN,cAApB,CAAmCuC,QAAnC,CAA4ChE,CAA5C,CAAnC,GAAkF,CAAzF;AAA2F;;AAAA,WAAO,IAAP;AAAY;;AAAAiE,EAAAA,cAAc,CAAClE,CAAD,EAAG;AAAC,QAAG,CAAC,KAAK2B,iBAAT,EAA2B,OAAM,CAAC,CAAP;AAAS,UAAM1B,CAAC,GAAC,KAAK2D,YAAL,CAAkB5D,CAAlB,CAAR;AAA6B,WAAO,KAAK0D,mBAAL,CAAyBzD,CAAzB,CAAP;AAAmC;;AAAAkE,EAAAA,gBAAgB,CAACnE,CAAD,EAAG;AAAC,QAAG,KAAKkB,iBAAR,EAA0B;AAAC,YAAMjB,CAAC,GAAC,KAAKiE,cAAL,CAAoBlE,CAApB,CAAR;AAA+B,aAAOA,CAAC,CAACoE,iBAAF,CAAoB,CAApB,EAAsBnE,CAAtB,EAAwB,CAAxB,CAAP;AAAkC;;AAAA,WAAM,CAAC,CAAP;AAAS;;AAAAoE,EAAAA,iCAAiC,CAACrE,CAAD,EAAG;AAAC,QAAG,CAAC,KAAKkB,iBAAT,EAA2B,OAAM,CAAC,CAAP;AAAS,QAAG,CAAClB,CAAC,CAACsE,aAAH,IAAkB,MAAItE,CAAC,CAACsE,aAAF,CAAgBC,MAAzC,EAAgD,OAAM,CAAC,CAAP;AAAS,UAAMtE,CAAC,GAAC,KAAK2D,YAAL,CAAkB5D,CAAlB,CAAR;AAAA,UAA6BE,CAAC,GAAC,KAAKsE,0BAAL,CAAgCxE,CAAhC,EAAkCC,CAAlC,CAA/B;AAAoE,WAAOC,CAAC,KAAG,KAAKmB,SAAL,CAAeW,IAAf,CAAoByC,YAApB,CAAiCC,QAAjC,IAA4C,KAAKrD,SAAL,CAAeW,IAAf,CAAoB2C,OAApB,CAA4BD,QAA5B,EAA/C,CAAD,EAAwFxE,CAA/F;AAAiG;;AAAAsE,EAAAA,0BAA0B,CAACxE,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAG,CAACD,CAAC,CAACsE,aAAH,IAAkB,MAAItE,CAAC,CAACsE,aAAF,CAAgBC,MAAzC,EAAgD,OAAM,CAAC,CAAP;AAAS,UAAMrE,CAAC,GAACF,CAAC,CAACsE,aAAF,CAAgB,CAAhB,EAAmBM,WAA3B;;AAAuC,QAAG1E,CAAC,IAAE,QAAMA,CAAC,CAAC0C,QAAX,IAAqB,QAAM1C,CAAC,CAAC2C,QAAhC,EAAyC;AAAC,YAAMzC,CAAC,GAAC,KAAKuD,mBAAL,CAAyB1D,CAAzB,EAA2BC,CAA3B,CAAR;AAAsC,UAAGF,CAAC,CAACoE,iBAAF,CAAoB,CAApB,EAAsBhE,CAAtB,EAAwB,CAAxB,CAAH,EAA8B,OAAM,CAAC,CAAP;AAAS;;AAAA,WAAM,CAAC,CAAP;AAAS;;AAAA+C,EAAAA,kBAAkB,CAACnD,CAAD,EAAG;AAAC,QAAG,KAAKuC,SAAL,IAAiB,KAAKlB,SAAL,CAAeO,SAAnC,EAA6C;AAAO,UAAM3B,CAAC,GAACD,CAAC,CAACwB,MAAV;AAAA,UAAiBtB,CAAC,GAACF,CAAC,CAAC6E,KAArB;AAAA,UAA2BrE,CAAC,GAAC,KAAKkD,mBAAL,CAAyBxD,CAAzB,CAA7B;AAAyD,QAAIQ,CAAC,GAAC,CAAC,CAAP;AAAS,SAAKa,wBAAL,CAA8BtB,CAA9B,EAAgCD,CAAC,CAAC8E,gBAAlC,EAAoD9E,CAAC,IAAE;AAAC,YAAMY,CAAC,GAAC,KAAKa,YAAL,CAAkBsD,wBAAlB,CAA2C/E,CAA3C,CAAR;AAAsD,UAAGM,CAAC,CAACM,CAAD,CAAJ,EAAQ;AAAO,YAAME,CAAC,GAACF,CAAC,CAACiD,QAAV;AAAmBzD,MAAAA,CAAC,CAACU,CAAD,CAAD,KAAOb,CAAC,CAAC,CAAD,CAAD,GAAKa,CAAC,CAACkE,CAAP,IAAU/E,CAAC,CAAC,CAAD,CAAD,GAAKa,CAAC,CAACmE,CAAjB,IAAoBhF,CAAC,CAAC,CAAD,CAAD,GAAKa,CAAC,CAACkE,CAA3B,IAA8B/E,CAAC,CAAC,CAAD,CAAD,GAAKa,CAAC,CAACmE,CAA5C,MAAiDrE,CAAC,CAACwD,iBAAF,CAAoB,CAApB,EAAsB5D,CAAtB,EAAwB,CAAxB,MAA6BE,CAAC,GAAC,CAAC,CAAhC,GAAmC,KAAK8D,0BAAL,CAAgC5D,CAAhC,EAAkCV,CAAlC,MAAuCQ,CAAC,GAAC,CAAC,CAA1C,CAApF;AAAkI,KAAlR,GAAqRA,CAAC,KAAG,KAAKW,SAAL,CAAeW,IAAf,CAAoByC,YAApB,CAAiCC,QAAjC,IAA4C,KAAKrD,SAAL,CAAeW,IAAf,CAAoB2C,OAApB,CAA4BD,QAA5B,EAA/C,CAAtR;AAA6W;;AAAAQ,EAAAA,6BAA6B,GAAE;AAAC,SAAKnD,sBAAL,MAA+B,CAAC,KAAKb,iBAArC,GAAuD,KAAKO,YAAL,CAAkB0D,mCAAlB,CAAuDnF,CAAC,IAAEA,CAAC,CAACoF,mBAAF,CAAsB,CAAtB,CAA1D,CAAvD,GAA4I,KAAKlE,iBAAL,IAAwB,KAAKO,YAAL,CAAkB4D,2BAAlB,EAApK,EAAoN,KAAK9C,SAAL,EAApN;AAAqO;;AAA1zH,CAArB;;AAAi1H,SAASI,CAAT,CAAW3C,CAAX,EAAaC,CAAb,EAAe;AAAC,SAAOD,CAAC,GAAC,CAAF,IAAKC,CAAC,GAAC,CAAd;AAAgB;;AAAAD,CAAC,CAAC,CAACQ,CAAC,CAAC;AAAC8E,EAAAA,aAAa,EAAC,CAAC;AAAhB,CAAD,CAAF,CAAD,EAAyBvE,CAAC,CAACwE,SAA3B,EAAqC,mBAArC,EAAyD,KAAK,CAA9D,CAAD,EAAkEvF,CAAC,CAAC,CAACQ,CAAC,CAAC;AAACgF,EAAAA,QAAQ,EAAC,CAAC;AAAX,CAAD,CAAF,CAAD,EAAoBzE,CAAC,CAACwE,SAAtB,EAAgC,WAAhC,EAA4C,KAAK,CAAjD,CAAnE,EAAuHvF,CAAC,CAAC,CAACQ,CAAC,CAAC;AAACgF,EAAAA,QAAQ,EAAC,CAAC;AAAX,CAAD,CAAF,CAAD,EAAoBzE,CAAC,CAACwE,SAAtB,EAAgC,UAAhC,EAA2C,KAAK,CAAhD,CAAxH,EAA2KxE,CAAC,GAACf,CAAC,CAAC,CAACU,CAAC,CAAC,yDAAD,CAAF,CAAD,EAAgEK,CAAhE,CAA9K;AAAiP,MAAMkC,CAAC,GAAC,gBAAR;AAAyB,IAAIgC,CAAC,GAAClE,CAAN;AAAQ,eAAekE,CAAf","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import t from\"../../../../core/Handles.js\";import{isSome as s,isNone as a}from\"../../../../core/maybe.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{scaleBoundsPredicate as n}from\"../../../support/layerViewUtils.js\";import{TaskPriority as c}from\"../../../support/Scheduler.js\";let h=class extends i{constructor(){super(...arguments),this._scaleRangeActive=!1,this.layerScaleRangeVisibilityQuery=!1,this.handles=new t,this.layerView=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.extent=null,this.graphicsCore=null,this.basemapTerrain=null,this.layerScaleEnabled=!0,this.suspended=!1,this.updating=!0}setup(e,i,t,s,a){this.layerView=e,this.layer=i,this.queryGraphicUIDsInExtent=t,this.graphicsCore=s,this.basemapTerrain=a,this.updateScaleRangeActive();const r=this.layerView.view.resourceController.scheduler;this.handles.add(r.registerTask(c.SCALE_VISIBILITY,this))}destroy(){this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){const e=this.layer;let i=this.layerScaleEnabled&&p(e.minScale,e.maxScale);e.labelingInfo&&!i&&(i=e.labelingInfo.some((e=>e&&p(e.minScale,e.maxScale))));const t=this._scaleRangeActive!==i;return this._scaleRangeActive=i,i&&!this.handles.has(o)&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on(\"scale-change\",(e=>this.scaleUpdateHandler(e))),o),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on(\"tiles-visibility-changed\",(()=>this._setDirty())),o)):!i&&this.handles.has(o)&&this.handles.remove(o),t}get running(){return!(!this.layerView.view.basemapTerrain||!this.updating)}runTask(){const e=this.layerView.view.basemapTerrain;this.extent&&e&&e.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,e.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,(e=>this.finishUpdate(e)))):this.finishUpdate(!0)}finishUpdate(e){this.layerScaleRangeVisibilityQuery=!1,this._set(\"suspended\",!e),this._set(\"updating\",!1)}visibleAtLayerScale(e){return!this.layerScaleEnabled||n(e,this.layer.minScale||0,this.layer.maxScale||0)}visibleAtLabelScale(e,i){return n(e,i.minScale||0,i.maxScale||0)}graphicScale(e){let i;if(s(e.centroid)?i=e.centroid:s(e.graphic.geometry)&&\"point\"===e.graphic.geometry.type&&(i=e.graphic.geometry),i){return this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(i):1}return null}graphicVisible(e){if(!this.layerScaleEnabled)return!0;const i=this.graphicScale(e);return this.visibleAtLayerScale(i)}updateVisibility(e){if(this._scaleRangeActive){const i=this.graphicVisible(e);return e.setVisibilityFlag(1,i,0)}return!1}updateGraphicLabelScaleVisibility(e){if(!this._scaleRangeActive)return!1;if(!e.labelGraphics||0===e.labelGraphics.length)return!1;const i=this.graphicScale(e),t=this.updateLabelScaleVisibility(e,i);return t&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),t}updateLabelScaleVisibility(e,i){if(!e.labelGraphics||0===e.labelGraphics.length)return!1;const t=e.labelGraphics[0]._labelClass;if(t&&null!=t.minScale&&null!=t.maxScale){const s=this.visibleAtLabelScale(i,t);if(e.setVisibilityFlag(1,s,1))return!0}return!1}scaleUpdateHandler(e){if(this._setDirty(),this.layerView.suspended)return;const i=e.extent,t=e.scale,r=this.visibleAtLayerScale(t);let l=!1;this.queryGraphicUIDsInExtent(i,e.spatialReference,(e=>{const n=this.graphicsCore.getGraphics3DGraphicById(e);if(a(n))return;const c=n.centroid;s(c)&&(i[0]>c.x||i[1]>c.y||i[2]<c.x||i[3]<c.y)||(n.setVisibilityFlag(1,r,0)&&(l=!0),this.updateLabelScaleVisibility(n,t)&&(l=!0))})),l&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(1))):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility(),this._setDirty()}};function p(e,i){return e>0||i>0}e([r({constructOnly:!0})],h.prototype,\"layerScaleEnabled\",void 0),e([r({readOnly:!0})],h.prototype,\"suspended\",void 0),e([r({readOnly:!0})],h.prototype,\"updating\",void 0),h=e([l(\"esri.views.3d.layers.graphics.Graphics3DScaleVisibility\")],h);const o=\"terrain-events\";var y=h;export default y;\n"]},"metadata":{},"sourceType":"module"}