{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../request.js\";\nimport r from \"../../core/Error.js\";\nimport { isNone as a, isSome as t } from \"../../core/maybe.js\";\nimport { getFilename as l, urlToObject as n } from \"../../core/urlUtils.js\";\nimport { parse as s, parseNonStandardSublayerUrl as o } from \"./arcgisLayerUrl.js\";\nimport { layerLookupMap as u } from \"./lazyLayerLoader.js\";\n\nasync function i(e) {\n  var r;\n  const a = null == (r = e.properties) ? void 0 : r.customParameters,\n        t = await d(e.url, a),\n        l = { ...e.properties,\n    url: e.url\n  };\n  if (!t.sublayerIds) return null != t.layerOrTableId && (l.layerId = t.layerOrTableId, l.sourceJSON = t.sourceJSON), new t.Constructor(l);\n  const n = new (0, (await import(\"../GroupLayer.js\")).default)({\n    title: t.parsedUrl.title\n  });\n  return c(n, t, l), n;\n}\n\nfunction y(e, r) {\n  return e ? e.find(e => e.id === r) : null;\n}\n\nfunction c(e, r, a) {\n  function l(e, l) {\n    const n = { ...a,\n      layerId: e,\n      sublayerTitleMode: \"service-name\"\n    };\n    return t(l) && (n.sourceJSON = l), new r.Constructor(n);\n  }\n\n  r.sublayerIds.forEach(a => {\n    const t = l(a, y(r.sublayerInfos, a));\n    e.add(t);\n  }), r.tableIds.forEach(a => {\n    const t = l(a, y(r.tableInfos, a));\n    e.tables.add(t);\n  });\n}\n\nasync function d(e, t) {\n  let l = s(e);\n  if (a(l) && (l = await f(e, t)), a(l)) throw new r(\"arcgis-layers:url-mismatch\", \"The url '${url}' is not a valid arcgis resource\", {\n    url: e\n  });\n  const {\n    serverType: n,\n    sublayer: o\n  } = l;\n  let u;\n  const i = {\n    FeatureServer: \"FeatureLayer\",\n    StreamServer: \"StreamLayer\",\n    VectorTileServer: \"VectorTileLayer\"\n  };\n\n  switch (n) {\n    case \"MapServer\":\n      u = null != o ? \"FeatureLayer\" : S(e, t).then(e => e ? \"TileLayer\" : \"MapImageLayer\");\n      break;\n\n    case \"ImageServer\":\n      u = w(e, t).then(e => {\n        const r = e.tileInfo && e.tileInfo.format;\n        return e.tileInfo ? !r || \"LERC\" !== r.toUpperCase() || e.cacheType && \"elevation\" !== e.cacheType.toLowerCase() ? \"ImageryTileLayer\" : \"ElevationLayer\" : \"ImageryLayer\";\n      });\n      break;\n\n    case \"SceneServer\":\n      u = w(l.url.path, t).then(e => {\n        const r = {\n          Point: \"SceneLayer\",\n          \"3DObject\": \"SceneLayer\",\n          IntegratedMesh: \"IntegratedMeshLayer\",\n          PointCloud: \"PointCloudLayer\",\n          Building: \"BuildingSceneLayer\"\n        };\n\n        if (e && Array.isArray(e.layers) && e.layers.length > 0) {\n          const a = e.layers[0].layerType;\n          if (null != r[a]) return r[a];\n        }\n\n        return \"SceneLayer\";\n      });\n      break;\n\n    default:\n      u = i[n];\n  }\n\n  const y = {\n    FeatureLayer: !0,\n    SceneLayer: !0\n  },\n        c = \"FeatureServer\" === n,\n        d = {\n    parsedUrl: l,\n    Constructor: null,\n    layerOrTableId: c ? o : null,\n    sublayerIds: null,\n    tableIds: null\n  },\n        p = await u;\n\n  if (y[p] && null == o) {\n    const r = await v(e, n, t);\n    c && (d.sublayerInfos = r.layerInfos, d.tableInfos = r.tableInfos);\n    if (1 !== r.layerIds.length + r.tableIds.length) d.sublayerIds = r.layerIds, d.tableIds = r.tableIds;else if (c) {\n      var I, b;\n      d.layerOrTableId = null != (I = r.layerIds[0]) ? I : r.tableIds[0], d.sourceJSON = null != (b = r.layerInfos[0]) ? b : r.tableInfos[0];\n    }\n  }\n\n  return d.Constructor = await m(p), d;\n}\n\nasync function f(e, r) {\n  var a;\n  const s = await w(e, r);\n  let u = null,\n      i = null;\n  const y = s.type;\n  if (\"Feature Layer\" === y || \"Table\" === y ? (u = \"FeatureServer\", i = s.id) : \"indexedVector\" === y ? u = \"VectorTileServer\" : s.hasOwnProperty(\"mapName\") ? u = \"MapServer\" : s.hasOwnProperty(\"bandCount\") && s.hasOwnProperty(\"pixelSizeX\") ? u = \"ImageServer\" : s.hasOwnProperty(\"maxRecordCount\") && s.hasOwnProperty(\"allowGeometryUpdates\") ? u = \"FeatureServer\" : s.hasOwnProperty(\"streamUrls\") ? u = \"StreamServer\" : p(s) ? (u = \"SceneServer\", i = s.id) : s.hasOwnProperty(\"layers\") && p(null == (a = s.layers) ? void 0 : a[0]) && (u = \"SceneServer\"), !u) return null;\n  const c = null != i ? o(e) : null;\n  return {\n    title: t(c) && s.name || l(e),\n    serverType: u,\n    sublayer: i,\n    url: {\n      path: t(c) ? c.serviceUrl : n(e).path\n    }\n  };\n}\n\nfunction p(e) {\n  return (null == e ? void 0 : e.hasOwnProperty(\"store\")) && e.hasOwnProperty(\"id\") && \"number\" == typeof e.id;\n}\n\nasync function v(e, r, a) {\n  var t, l;\n  let n,\n      s = !1;\n\n  if (\"FeatureServer\" === r) {\n    const r = await b(e, a);\n    s = !!r.layersJSON, n = r.layersJSON || r.serviceJSON;\n  } else n = await w(e, a);\n\n  const o = null == (t = n) ? void 0 : t.layers,\n        u = null == (l = n) ? void 0 : l.tables;\n  return {\n    layerIds: (null == o ? void 0 : o.map(e => e.id).reverse()) || [],\n    tableIds: (null == u ? void 0 : u.map(e => e.id).reverse()) || [],\n    layerInfos: s ? o : [],\n    tableInfos: s ? u : []\n  };\n}\n\nfunction I(e) {\n  return !e.type || \"Feature Layer\" === e.type;\n}\n\nasync function b(e, r) {\n  var a, t;\n  let l = await w(e, r);\n  l = l || {}, l.layers = (null == (a = l.layers) ? void 0 : a.filter(I)) || [];\n  const n = {\n    serviceJSON: l\n  };\n  if (l.currentVersion < 10.5) return n;\n  const s = await w(e + \"/layers\", r);\n  return n.layersJSON = {\n    layers: (null == s || null == (t = s.layers) ? void 0 : t.filter(I)) || [],\n    tables: (null == s ? void 0 : s.tables) || []\n  }, n;\n}\n\nasync function m(e) {\n  return (0, u[e])();\n}\n\nasync function S(e, r) {\n  return (await w(e, r)).tileInfo;\n}\n\nasync function w(r, a) {\n  return (await e(r, {\n    responseType: \"json\",\n    query: {\n      f: \"json\",\n      ...a\n    }\n  })).data;\n}\n\nexport { i as fromUrl };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"names":["e","r","isNone","a","isSome","t","getFilename","l","urlToObject","n","parse","s","parseNonStandardSublayerUrl","o","layerLookupMap","u","i","properties","customParameters","d","url","sublayerIds","layerOrTableId","layerId","sourceJSON","Constructor","default","title","parsedUrl","c","y","find","id","sublayerTitleMode","forEach","sublayerInfos","add","tableIds","tableInfos","tables","f","serverType","sublayer","FeatureServer","StreamServer","VectorTileServer","S","then","w","tileInfo","format","toUpperCase","cacheType","toLowerCase","path","Point","IntegratedMesh","PointCloud","Building","Array","isArray","layers","length","layerType","FeatureLayer","SceneLayer","p","v","layerInfos","layerIds","I","b","m","type","hasOwnProperty","name","serviceUrl","layersJSON","serviceJSON","map","reverse","filter","currentVersion","responseType","query","data","fromUrl"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import r from\"../../core/Error.js\";import{isNone as a,isSome as t}from\"../../core/maybe.js\";import{getFilename as l,urlToObject as n}from\"../../core/urlUtils.js\";import{parse as s,parseNonStandardSublayerUrl as o}from\"./arcgisLayerUrl.js\";import{layerLookupMap as u}from\"./lazyLayerLoader.js\";async function i(e){var r;const a=null==(r=e.properties)?void 0:r.customParameters,t=await d(e.url,a),l={...e.properties,url:e.url};if(!t.sublayerIds)return null!=t.layerOrTableId&&(l.layerId=t.layerOrTableId,l.sourceJSON=t.sourceJSON),new t.Constructor(l);const n=new(0,(await import(\"../GroupLayer.js\")).default)({title:t.parsedUrl.title});return c(n,t,l),n}function y(e,r){return e?e.find((e=>e.id===r)):null}function c(e,r,a){function l(e,l){const n={...a,layerId:e,sublayerTitleMode:\"service-name\"};return t(l)&&(n.sourceJSON=l),new r.Constructor(n)}r.sublayerIds.forEach((a=>{const t=l(a,y(r.sublayerInfos,a));e.add(t)})),r.tableIds.forEach((a=>{const t=l(a,y(r.tableInfos,a));e.tables.add(t)}))}async function d(e,t){let l=s(e);if(a(l)&&(l=await f(e,t)),a(l))throw new r(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:e});const{serverType:n,sublayer:o}=l;let u;const i={FeatureServer:\"FeatureLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\"};switch(n){case\"MapServer\":u=null!=o?\"FeatureLayer\":S(e,t).then((e=>e?\"TileLayer\":\"MapImageLayer\"));break;case\"ImageServer\":u=w(e,t).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||\"LERC\"!==r.toUpperCase()||e.cacheType&&\"elevation\"!==e.cacheType.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\"}));break;case\"SceneServer\":u=w(l.url.path,t).then((e=>{const r={Point:\"SceneLayer\",\"3DObject\":\"SceneLayer\",IntegratedMesh:\"IntegratedMeshLayer\",PointCloud:\"PointCloudLayer\",Building:\"BuildingSceneLayer\"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const a=e.layers[0].layerType;if(null!=r[a])return r[a]}return\"SceneLayer\"}));break;default:u=i[n]}const y={FeatureLayer:!0,SceneLayer:!0},c=\"FeatureServer\"===n,d={parsedUrl:l,Constructor:null,layerOrTableId:c?o:null,sublayerIds:null,tableIds:null},p=await u;if(y[p]&&null==o){const r=await v(e,n,t);c&&(d.sublayerInfos=r.layerInfos,d.tableInfos=r.tableInfos);if(1!==r.layerIds.length+r.tableIds.length)d.sublayerIds=r.layerIds,d.tableIds=r.tableIds;else if(c){var I,b;d.layerOrTableId=null!=(I=r.layerIds[0])?I:r.tableIds[0],d.sourceJSON=null!=(b=r.layerInfos[0])?b:r.tableInfos[0]}}return d.Constructor=await m(p),d}async function f(e,r){var a;const s=await w(e,r);let u=null,i=null;const y=s.type;if(\"Feature Layer\"===y||\"Table\"===y?(u=\"FeatureServer\",i=s.id):\"indexedVector\"===y?u=\"VectorTileServer\":s.hasOwnProperty(\"mapName\")?u=\"MapServer\":s.hasOwnProperty(\"bandCount\")&&s.hasOwnProperty(\"pixelSizeX\")?u=\"ImageServer\":s.hasOwnProperty(\"maxRecordCount\")&&s.hasOwnProperty(\"allowGeometryUpdates\")?u=\"FeatureServer\":s.hasOwnProperty(\"streamUrls\")?u=\"StreamServer\":p(s)?(u=\"SceneServer\",i=s.id):s.hasOwnProperty(\"layers\")&&p(null==(a=s.layers)?void 0:a[0])&&(u=\"SceneServer\"),!u)return null;const c=null!=i?o(e):null;return{title:t(c)&&s.name||l(e),serverType:u,sublayer:i,url:{path:t(c)?c.serviceUrl:n(e).path}}}function p(e){return(null==e?void 0:e.hasOwnProperty(\"store\"))&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function v(e,r,a){var t,l;let n,s=!1;if(\"FeatureServer\"===r){const r=await b(e,a);s=!!r.layersJSON,n=r.layersJSON||r.serviceJSON}else n=await w(e,a);const o=null==(t=n)?void 0:t.layers,u=null==(l=n)?void 0:l.tables;return{layerIds:(null==o?void 0:o.map((e=>e.id)).reverse())||[],tableIds:(null==u?void 0:u.map((e=>e.id)).reverse())||[],layerInfos:s?o:[],tableInfos:s?u:[]}}function I(e){return!e.type||\"Feature Layer\"===e.type}async function b(e,r){var a,t;let l=await w(e,r);l=l||{},l.layers=(null==(a=l.layers)?void 0:a.filter(I))||[];const n={serviceJSON:l};if(l.currentVersion<10.5)return n;const s=await w(e+\"/layers\",r);return n.layersJSON={layers:(null==s||null==(t=s.layers)?void 0:t.filter(I))||[],tables:(null==s?void 0:s.tables)||[]},n}async function m(e){return(0,u[e])()}async function S(e,r){return(await w(e,r)).tileInfo}async function w(r,a){return(await e(r,{responseType:\"json\",query:{f:\"json\",...a}})).data}export{i as fromUrl};\n"]},"metadata":{},"sourceType":"module"}