{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as t, unwrap as e } from \"../../../../../../core/maybe.js\";\nimport { pt2px as i } from \"../../../../../../core/screenUtils.js\";\nimport { i as r, t as s, r as o } from \"../../../../../../chunks/mat2d.js\";\nimport { c as h } from \"../../../../../../chunks/mat2df32.js\";\nimport { s as f, t as n } from \"../../../../../../chunks/vec2.js\";\nimport { f as x, c as m } from \"../../../../../../chunks/vec2f32.js\";\nimport { deltaDecodeGeometry as _, convertFromGeometry as a } from \"../../../../../../layers/graphics/featureConversionUtils.js\";\nimport { CIMMarkerPlacementHelper as l } from \"../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper.js\";\nimport { WGLGeometryType as p } from \"../../enums.js\";\nimport { i1616to32 as c } from \"../../number.js\";\n\nconst d = 3.14159265359 / 180,\n      v = 8,\n      W = W => class extends W {\n  constructor(...t) {\n    super(...t), this.angle = 0, this.xOffset = 0, this.yOffset = 0, this.width = 0, this.height = 0, this.boundsType = \"square\", this._anchorX = 0, this._anchorY = 0, this._computedWidth = 0, this._computedHeight = 0, this._vertexBoundsScaleX = 1, this._vertexBoundsScaleY = 1, this._offsets = {\n      xUpperLeft: 0,\n      yUpperLeft: 0,\n      xUpperRight: 0,\n      yUpperRight: 0,\n      xBottomLeft: 0,\n      yBottomLeft: 0,\n      xBottomRight: 0,\n      yBottomRight: 0\n    }, this.geometryType = p.MARKER;\n  }\n\n  _write(t, e, i) {\n    const r = e.getDisplayId();\n    t.recordStart(r, this._materialKey, this.geometryType, !1, !0), this._writeGeometry(t, e, r, i), t.recordEnd();\n  }\n\n  _writeGeometry(e, i, r, s) {\n    if (t(this._markerPlacement)) return this._writePlacedMarkers(e, i, s);\n    const o = s ? _(a(s), 2) : \"esriGeometryPolygon\" === i.geometryType ? i.readCentroid() : i.readUnquantizedGeometry();\n\n    if (o) {\n      if (o.isPoint) {\n        const [t, i] = o.coords;\n        if (!e.hasAggregates && e.hasPixelBufferEnabled && (t < -1 || t >= 513 || i < -1 || i >= 513)) return;\n        return this._writeVertices(e, r, this._getPos(t, i), t, i);\n      }\n\n      o.forEachVertex((t, i) => this._writeVertices(e, r, this._getPos(t, i), t, i));\n    }\n  }\n\n  _writePlacedMarkers(t, r, s) {\n    const o = null != s ? s : r.readLegacyGeometry(),\n          f = l.getPlacement(o, e(this._markerPlacement), i(1));\n    if (!f) return;\n\n    const n = r.getDisplayId(),\n          x = m(),\n          _ = h(),\n          a = -128,\n          p = 640;\n\n    let c = f.next();\n\n    for (; null != c;) {\n      const {\n        tx: e,\n        ty: i\n      } = c;\n      e >= a && e <= p && i >= a && i <= p && (this._applyTransformation(_, x, c.getAngle() / d), this._writeVertices(t, n, this._getPos(e, i), e, i)), c = f.next();\n    }\n  }\n\n  _writeVertices(t, e, i, r, s) {\n    const o = t.vertexCount();\n    t.vertexBounds(r + this.xOffset, s - this.yOffset, this._computedWidth * this._vertexBoundsScaleX, this._computedHeight * this._vertexBoundsScaleY), t.vertexWrite(i), t.vertexWrite(this._offsetUpperLeft), t.vertexWrite(this._texUpperLeft), t.vertexWrite(this._bitestAndDistRatio), t.vertexWrite(e), t.vertexWrite(this._fillColor), t.vertexWrite(this._outlineColor), t.vertexWrite(this._sizeOutlineWidth), t.vertexWrite(this._minMaxZoom), t.vertexEnd(), t.vertexWrite(i), t.vertexWrite(this._offsetUpperRight), t.vertexWrite(this._texUpperRight), t.vertexWrite(this._bitestAndDistRatio), t.vertexWrite(e), t.vertexWrite(this._fillColor), t.vertexWrite(this._outlineColor), t.vertexWrite(this._sizeOutlineWidth), t.vertexWrite(this._minMaxZoom), t.vertexEnd(), t.vertexWrite(i), t.vertexWrite(this._offsetBottomLeft), t.vertexWrite(this._texBottomLeft), t.vertexWrite(this._bitestAndDistRatio), t.vertexWrite(e), t.vertexWrite(this._fillColor), t.vertexWrite(this._outlineColor), t.vertexWrite(this._sizeOutlineWidth), t.vertexWrite(this._minMaxZoom), t.vertexEnd(), t.vertexWrite(i), t.vertexWrite(this._offsetBottomRight), t.vertexWrite(this._texBottomRight), t.vertexWrite(this._bitestAndDistRatio), t.vertexWrite(e), t.vertexWrite(this._fillColor), t.vertexWrite(this._outlineColor), t.vertexWrite(this._sizeOutlineWidth), t.vertexWrite(this._minMaxZoom), t.vertexEnd(), t.indexWrite(o + 0), t.indexWrite(o + 1), t.indexWrite(o + 2), t.indexWrite(o + 1), t.indexWrite(o + 3), t.indexWrite(o + 2);\n  }\n\n  _applyTransformation(t, e, i = 0) {\n    r(t), s(t, t, x(this.xOffset, -this.yOffset)), this.angle + i !== 0 && o(t, t, d * (this.angle + i));\n\n    const h = this._computedWidth,\n          m = this._computedHeight,\n          _ = (this._anchorX - .5) * h,\n          a = (this._anchorY - .5) * m;\n\n    f(e, _, a), n(e, e, t), this._offsetUpperLeft = c(16 * e[0], 16 * e[1]), this._offsets.xUpperLeft = e[0], this._offsets.yUpperLeft = e[1], f(e, _ + h, a), n(e, e, t), this._offsetUpperRight = c(16 * e[0], 16 * e[1]), this._offsets.xUpperRight = e[0], this._offsets.yUpperRight = e[1], f(e, _, a + m), n(e, e, t), this._offsetBottomLeft = c(16 * e[0], 16 * e[1]), this._offsets.xBottomLeft = e[0], this._offsets.yBottomLeft = e[1], f(e, _ + h, a + m), n(e, e, t), this._offsetBottomRight = c(16 * e[0], 16 * e[1]), this._offsets.xBottomRight = e[0], this._offsets.yBottomRight = e[1];\n  }\n\n  _getPos(t, e) {\n    return c(Math.round(v * t), Math.round(v * e));\n  }\n\n};\n\nexport default W;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate.js"],"names":["isSome","t","unwrap","e","pt2px","i","r","s","o","c","h","f","n","x","m","deltaDecodeGeometry","_","convertFromGeometry","a","CIMMarkerPlacementHelper","l","WGLGeometryType","p","i1616to32","d","v","W","constructor","angle","xOffset","yOffset","width","height","boundsType","_anchorX","_anchorY","_computedWidth","_computedHeight","_vertexBoundsScaleX","_vertexBoundsScaleY","_offsets","xUpperLeft","yUpperLeft","xUpperRight","yUpperRight","xBottomLeft","yBottomLeft","xBottomRight","yBottomRight","geometryType","MARKER","_write","getDisplayId","recordStart","_materialKey","_writeGeometry","recordEnd","_markerPlacement","_writePlacedMarkers","readCentroid","readUnquantizedGeometry","isPoint","coords","hasAggregates","hasPixelBufferEnabled","_writeVertices","_getPos","forEachVertex","readLegacyGeometry","getPlacement","next","tx","ty","_applyTransformation","getAngle","vertexCount","vertexBounds","vertexWrite","_offsetUpperLeft","_texUpperLeft","_bitestAndDistRatio","_fillColor","_outlineColor","_sizeOutlineWidth","_minMaxZoom","vertexEnd","_offsetUpperRight","_texUpperRight","_offsetBottomLeft","_texBottomLeft","_offsetBottomRight","_texBottomRight","indexWrite","Math","round"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t,unwrap as e}from\"../../../../../../core/maybe.js\";import{pt2px as i}from\"../../../../../../core/screenUtils.js\";import{i as r,t as s,r as o}from\"../../../../../../chunks/mat2d.js\";import{c as h}from\"../../../../../../chunks/mat2df32.js\";import{s as f,t as n}from\"../../../../../../chunks/vec2.js\";import{f as x,c as m}from\"../../../../../../chunks/vec2f32.js\";import{deltaDecodeGeometry as _,convertFromGeometry as a}from\"../../../../../../layers/graphics/featureConversionUtils.js\";import{CIMMarkerPlacementHelper as l}from\"../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper.js\";import{WGLGeometryType as p}from\"../../enums.js\";import{i1616to32 as c}from\"../../number.js\";const d=3.14159265359/180,v=8,W=W=>class extends W{constructor(...t){super(...t),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType=\"square\",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=p.MARKER}_write(t,e,i){const r=e.getDisplayId();t.recordStart(r,this._materialKey,this.geometryType,!1,!0),this._writeGeometry(t,e,r,i),t.recordEnd()}_writeGeometry(e,i,r,s){if(t(this._markerPlacement))return this._writePlacedMarkers(e,i,s);const o=s?_(a(s),2):\"esriGeometryPolygon\"===i.geometryType?i.readCentroid():i.readUnquantizedGeometry();if(o){if(o.isPoint){const[t,i]=o.coords;if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(t<-1||t>=513||i<-1||i>=513))return;return this._writeVertices(e,r,this._getPos(t,i),t,i)}o.forEachVertex(((t,i)=>this._writeVertices(e,r,this._getPos(t,i),t,i)))}}_writePlacedMarkers(t,r,s){const o=null!=s?s:r.readLegacyGeometry(),f=l.getPlacement(o,e(this._markerPlacement),i(1));if(!f)return;const n=r.getDisplayId(),x=m(),_=h(),a=-128,p=640;let c=f.next();for(;null!=c;){const{tx:e,ty:i}=c;e>=a&&e<=p&&i>=a&&i<=p&&(this._applyTransformation(_,x,c.getAngle()/d),this._writeVertices(t,n,this._getPos(e,i),e,i)),c=f.next()}}_writeVertices(t,e,i,r,s){const o=t.vertexCount();t.vertexBounds(r+this.xOffset,s-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY),t.vertexWrite(i),t.vertexWrite(this._offsetUpperLeft),t.vertexWrite(this._texUpperLeft),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.vertexWrite(i),t.vertexWrite(this._offsetUpperRight),t.vertexWrite(this._texUpperRight),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.vertexWrite(i),t.vertexWrite(this._offsetBottomLeft),t.vertexWrite(this._texBottomLeft),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.vertexWrite(i),t.vertexWrite(this._offsetBottomRight),t.vertexWrite(this._texBottomRight),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}_applyTransformation(t,e,i=0){r(t),s(t,t,x(this.xOffset,-this.yOffset)),this.angle+i!==0&&o(t,t,d*(this.angle+i));const h=this._computedWidth,m=this._computedHeight,_=(this._anchorX-.5)*h,a=(this._anchorY-.5)*m;f(e,_,a),n(e,e,t),this._offsetUpperLeft=c(16*e[0],16*e[1]),this._offsets.xUpperLeft=e[0],this._offsets.yUpperLeft=e[1],f(e,_+h,a),n(e,e,t),this._offsetUpperRight=c(16*e[0],16*e[1]),this._offsets.xUpperRight=e[0],this._offsets.yUpperRight=e[1],f(e,_,a+m),n(e,e,t),this._offsetBottomLeft=c(16*e[0],16*e[1]),this._offsets.xBottomLeft=e[0],this._offsets.yBottomLeft=e[1],f(e,_+h,a+m),n(e,e,t),this._offsetBottomRight=c(16*e[0],16*e[1]),this._offsets.xBottomRight=e[0],this._offsets.yBottomRight=e[1]}_getPos(t,e){return c(Math.round(v*t),Math.round(v*e))}};export default W;\n"]},"metadata":{},"sourceType":"module"}