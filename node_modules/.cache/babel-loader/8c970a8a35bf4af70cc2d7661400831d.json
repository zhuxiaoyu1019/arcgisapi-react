{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { assert as t } from \"../webgl-engine/lib/Util.js\";\n\nclass s {\n  constructor(t) {\n    this.client = t, this._cancelled = !1, this.size = 0, this.duration = 0;\n  }\n\n}\n\nclass e {\n  constructor(t) {\n    this.typeWorkerQuota = t, this.tasks = new Array(), this.numWorkers = 0, this.statistics = new r();\n  }\n\n}\n\nclass r {\n  constructor() {\n    this.requests = 0, this.size = 0, this.duration = 0, this.speed = 0;\n  }\n\n}\n\nclass i {\n  constructor(t, s, r, i) {\n    this._workerFunc = t, this._callbackFunc = s, this._maxTotalNumWorkers = r, this._totalNumWorkers = 0, this._clients = i.map(t => new e(t));\n  }\n\n  hasQuota(t) {\n    const s = this._clients[t];\n    return !!s && (this._totalNumWorkers < this._maxTotalNumWorkers || s.numWorkers + s.tasks.length < s.typeWorkerQuota);\n  }\n\n  push(t) {\n    const s = this._clients[t.client];\n    s && (this._totalNumWorkers < this._maxTotalNumWorkers ? (s.numWorkers++, this._totalNumWorkers++, this._workerFunc(t, (t, s) => this._taskCallback(t, s))) : s.tasks.push(t));\n  }\n\n  cancel(t) {\n    this._taskFinished(t), t._cancelled = !0;\n  }\n\n  destroy() {\n    this._clients.length = 0;\n  }\n\n  _taskFinished(s) {\n    const e = this._clients[s.client];\n    this._totalNumWorkers--, e.numWorkers--, e.statistics.requests++, e.statistics.size += s.size || 0, e.statistics.duration += s.duration || 0, e.statistics.speed = e.statistics.duration > 0 ? e.statistics.size / e.statistics.duration : 0, t(e.numWorkers >= 0), this._next();\n  }\n\n  _next() {\n    for (const t of this._clients) if (t && t.numWorkers < t.typeWorkerQuota && this._processQueue(t)) return;\n\n    for (const t of this._clients) if (t && this._processQueue(t)) return;\n  }\n\n  _processQueue(t) {\n    for (; t.tasks.length > 0;) if (this._workerFunc(t.tasks.shift(), (t, s) => this._taskCallback(t, s))) return t.numWorkers++, this._totalNumWorkers++, !0;\n\n    return !1;\n  }\n\n  _taskCallback(t, s) {\n    t._cancelled || (this._callbackFunc(t, s), this._taskFinished(t));\n  }\n\n  getStatsForType(t) {\n    const s = this._clients[t];\n    return s ? {\n      quota: s.typeWorkerQuota,\n      workers: s.numWorkers,\n      queueSize: s.tasks.length,\n      requestStats: s.statistics\n    } : null;\n  }\n\n  get test() {\n    const t = this;\n    return {\n      set workerFunc(s) {\n        t._workerFunc = s;\n      }\n\n    };\n  }\n\n}\n\nexport { i as AsyncWorkerQueue, s as BaseTask };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/support/AsyncWorkerQueue.js"],"names":["assert","t","s","constructor","client","_cancelled","size","duration","e","typeWorkerQuota","tasks","Array","numWorkers","statistics","r","requests","speed","i","_workerFunc","_callbackFunc","_maxTotalNumWorkers","_totalNumWorkers","_clients","map","hasQuota","length","push","_taskCallback","cancel","_taskFinished","destroy","_next","_processQueue","shift","getStatsForType","quota","workers","queueSize","requestStats","test","workerFunc","AsyncWorkerQueue","BaseTask"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{assert as t}from\"../webgl-engine/lib/Util.js\";class s{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class e{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new r}}class r{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class i{constructor(t,s,r,i){this._workerFunc=t,this._callbackFunc=s,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=i.map((t=>new e(t)))}hasQuota(t){const s=this._clients[t];return!!s&&(this._totalNumWorkers<this._maxTotalNumWorkers||s.numWorkers+s.tasks.length<s.typeWorkerQuota)}push(t){const s=this._clients[t.client];s&&(this._totalNumWorkers<this._maxTotalNumWorkers?(s.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,((t,s)=>this._taskCallback(t,s)))):s.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(s){const e=this._clients[s.client];this._totalNumWorkers--,e.numWorkers--,e.statistics.requests++,e.statistics.size+=s.size||0,e.statistics.duration+=s.duration||0,e.statistics.speed=e.statistics.duration>0?e.statistics.size/e.statistics.duration:0,t(e.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),((t,s)=>this._taskCallback(t,s))))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,s){t._cancelled||(this._callbackFunc(t,s),this._taskFinished(t))}getStatsForType(t){const s=this._clients[t];return s?{quota:s.typeWorkerQuota,workers:s.numWorkers,queueSize:s.tasks.length,requestStats:s.statistics}:null}get test(){const t=this;return{set workerFunc(s){t._workerFunc=s}}}}export{i as AsyncWorkerQueue,s as BaseTask};\n"]},"metadata":{},"sourceType":"module"}