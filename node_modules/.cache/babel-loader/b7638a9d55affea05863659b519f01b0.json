{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { nextHighestPowerOfTwo as e } from \"../../../core/mathUtils.js\";\nimport { s as t } from \"../../../chunks/vec4.js\";\nimport { create as s, offset as r, set as i } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { fromValues as a } from \"../webgl-engine/lib/localOrigin.js\";\n\nclass n {\n  constructor(e, t) {\n    this.index = e, this.renderTargets = t, this.extent = s(), this.resolution = 0, this.viewport = s(), this.renderLocalOrigin = a(0, 0, 0, \"O\"), this.pixelRatio = 1, this.canvasGeometries = {\n      extents: [s(), s(), s()],\n      numViews: 0\n    }, this.validTargets = null, this.hasDrapedFeatureSource = !1, this.hasDrapedRasterSource = !1, this.hasTargetWithoutRasterImage = !1, this.index = e, this.validTargets = new Array(t.renderTargets.length).fill(!1);\n  }\n\n  getValidTarget(e) {\n    return this.validTargets[e] ? this.renderTargets.getTarget(e) : null;\n  }\n\n  get needsColorWithoutRasterImage() {\n    return this.hasDrapedRasterSource && this.hasDrapedFeatureSource && this.hasTargetWithoutRasterImage;\n  }\n\n  getColorTexture(e) {\n    const t = 1 === e ? this.renderTargets.getTarget(0) : 2 === e ? this.renderTargets.getTarget(2) : this.renderTargets.getTarget(4);\n    return t ? t.getTexture() : null;\n  }\n\n  getNormalTexture(e) {\n    const t = 1 === e ? this.renderTargets.getTarget(3) : null;\n    return t ? t.getTexture() : null;\n  }\n\n  draw(e, t) {\n    const s = this.computeRenderTargetValidityBitfield(),\n          r = this.needsColorWithoutRasterImage;\n\n    for (const i of this.renderTargets.renderTargets) 1 === i.type && !1 === r ? this.validTargets[i.type] = !1 : this.validTargets[i.type] = e.drawTarget(this, i, t);\n\n    return s ^ this.computeRenderTargetValidityBitfield() ? 0 : 1;\n  }\n\n  computeRenderTargetValidityBitfield() {\n    const e = this.validTargets;\n    return +e[0] | +e[1] << 1 | +e[2] << 2 | +e[3] << 3 | +e[4] << 4;\n  }\n\n  setupGeometryViewsCyclical(e) {\n    this.setupGeometryViewsDirect();\n    const t = .001 * e.range;\n\n    if (this.extent[0] - t <= e.min) {\n      const t = this.canvasGeometries.extents[this.canvasGeometries.numViews++];\n      r(this.extent, e.range, 0, t);\n    }\n\n    if (this.extent[2] + t >= e.max) {\n      const t = this.canvasGeometries.extents[this.canvasGeometries.numViews++];\n      r(this.extent, -e.range, 0, t);\n    }\n  }\n\n  setupGeometryViewsDirect() {\n    this.canvasGeometries.numViews = 1, i(this.canvasGeometries.extents[0], this.extent), t(this.viewport, 0, 0, this.resolution, this.resolution);\n  }\n\n  hasSomeSizedView() {\n    for (let e = 0; e < this.canvasGeometries.numViews; e++) {\n      const t = this.canvasGeometries.extents[e];\n      if (t[0] !== t[2] && t[1] !== t[3]) return !0;\n    }\n\n    return !1;\n  }\n\n  applyViewport(e) {\n    const t = this.viewport;\n    0 === this.index ? e.setViewport(t[0], t[1], t[2], t[3]) : e.setViewport(t[0] + this.resolution, t[1], t[2], t[3]);\n  }\n\n}\n\nfunction o(t, s, r) {\n  return Math.min(e(Math.max(t, s) + 256), r);\n}\n\nexport { n as Overlay, o as computeOverlayResolution };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/terrain/Overlay.js"],"names":["nextHighestPowerOfTwo","e","s","t","create","offset","r","set","i","fromValues","a","n","constructor","index","renderTargets","extent","resolution","viewport","renderLocalOrigin","pixelRatio","canvasGeometries","extents","numViews","validTargets","hasDrapedFeatureSource","hasDrapedRasterSource","hasTargetWithoutRasterImage","Array","length","fill","getValidTarget","getTarget","needsColorWithoutRasterImage","getColorTexture","getTexture","getNormalTexture","draw","computeRenderTargetValidityBitfield","type","drawTarget","setupGeometryViewsCyclical","setupGeometryViewsDirect","range","min","max","hasSomeSizedView","applyViewport","setViewport","o","Math","Overlay","computeOverlayResolution"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{nextHighestPowerOfTwo as e}from\"../../../core/mathUtils.js\";import{s as t}from\"../../../chunks/vec4.js\";import{create as s,offset as r,set as i}from\"../../../geometry/support/aaBoundingRect.js\";import{fromValues as a}from\"../webgl-engine/lib/localOrigin.js\";class n{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=s(),this.resolution=0,this.viewport=s(),this.renderLocalOrigin=a(0,0,0,\"O\"),this.pixelRatio=1,this.canvasGeometries={extents:[s(),s(),s()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}getNormalTexture(e){const t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}draw(e,t){const s=this.computeRenderTargetValidityBitfield(),r=this.needsColorWithoutRasterImage;for(const i of this.renderTargets.renderTargets)1===i.type&&!1===r?this.validTargets[i.type]=!1:this.validTargets[i.type]=e.drawTarget(this,i,t);return s^this.computeRenderTargetValidityBitfield()?0:1}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];r(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];r(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,i(this.canvasGeometries.extents[0],this.extent),t(this.viewport,0,0,this.resolution,this.resolution)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){const t=this.viewport;0===this.index?e.setViewport(t[0],t[1],t[2],t[3]):e.setViewport(t[0]+this.resolution,t[1],t[2],t[3])}}function o(t,s,r){return Math.min(e(Math.max(t,s)+256),r)}export{n as Overlay,o as computeOverlayResolution};\n"]},"metadata":{},"sourceType":"module"}