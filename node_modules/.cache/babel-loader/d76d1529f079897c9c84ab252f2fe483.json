{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Error.js\";\nimport t from \"../../../../core/Logger.js\";\nimport { isPowerOfTwo as r } from \"../../../../core/mathUtils.js\";\nimport { pt2px as n } from \"../../../../core/screenUtils.js\";\nimport { copyAndPremultiply as o } from \"./color.js\";\nimport { WGLGeometryType as s, VVType as i } from \"./enums.js\";\nimport { TextProperties as a } from \"./SymbolProperties.js\";\nimport c from \"../../../webgl/Texture.js\";\nconst u = t.getLogger(\"esri.views.2d.engine.webgl.Utils\"),\n      f = \"geometry\",\n      l = \"per_instance\",\n      d = \"per_instance_vv\",\n      m = [{\n  name: f,\n  strideInBytes: 36,\n  divisor: 0\n}],\n      p = [{\n  name: f,\n  strideInBytes: 36,\n  divisor: 0\n}],\n      h = [{\n  name: f,\n  strideInBytes: 12,\n  divisor: 0\n}],\n      w = [{\n  name: f,\n  strideInBytes: 40,\n  divisor: 0\n}],\n      v = [{\n  name: f,\n  strideInBytes: 36,\n  divisor: 0\n}],\n      y = [{\n  name: f,\n  strideInBytes: 36,\n  divisor: 0\n}];\n\nfunction g(e) {\n  const t = {};\n\n  for (const r of e) t[r.name] = r.strideInBytes;\n\n  return t;\n}\n\nconst A = g(m),\n      L = g(p),\n      I = g(h),\n      E = g(w),\n      b = g(v),\n      M = g(y);\n\nfunction T(e, t) {\n  switch (e) {\n    case s.MARKER:\n      return A;\n\n    case s.FILL:\n      return t ? I : L;\n\n    case s.LINE:\n      return E;\n\n    case s.TEXT:\n      return b;\n\n    case s.LABEL:\n      return M;\n  }\n}\n\nconst x = [f],\n      U = [f],\n      B = [f],\n      F = [f],\n      z = [f];\n\nfunction j(e) {\n  switch (e) {\n    case s.MARKER:\n      return x;\n\n    case s.FILL:\n      return U;\n\n    case s.LINE:\n      return B;\n\n    case s.TEXT:\n      return F;\n\n    case s.LABEL:\n      return z;\n  }\n}\n\nfunction C(e) {\n  switch (e % 4) {\n    case 0:\n    case 2:\n      return 4;\n\n    case 1:\n    case 3:\n      return 1;\n  }\n}\n\nfunction R(e, t) {\n  switch (t % 4) {\n    case 0:\n    case 2:\n      return new Uint32Array(Math.floor(e * t / 4));\n\n    case 1:\n    case 3:\n      return new Uint8Array(e * t);\n  }\n}\n\nfunction O(e, t) {\n  switch (t % 4) {\n    case 0:\n    case 2:\n      return new Uint32Array(e);\n\n    case 1:\n    case 3:\n      return new Uint8Array(e);\n  }\n}\n\nfunction $(e) {\n  return a.pool.acquire(e.color ? o(e.color) : [255, 255, 255, 255], e.haloColor ? o(e.haloColor) : [255, 255, 255, 255], n(e.haloSize), n(e.font.size), e.angle * Math.PI / 180, e.xoffset / e.font.size, e.yoffset / e.font.size, \"left\" === e.horizontalAlignment ? 0 : \"right\" === e.horizontalAlignment ? 1 : .5, \"top\" === e.verticalAlignment ? 0 : \"bottom\" === e.verticalAlignment ? 1 : .5);\n}\n\nfunction N(e) {\n  return null != e;\n}\n\nfunction K(e) {\n  return \"number\" == typeof e;\n}\n\nfunction P(t) {\n  switch (t) {\n    case \"butt\":\n      return 0;\n\n    case \"round\":\n      return 1;\n\n    case \"square\":\n      return 2;\n\n    default:\n      return u.error(new e(\"mapview-invalid-type\", `Cap type ${t} is not a valid option. Defaulting to round`)), 1;\n  }\n}\n\nfunction S(t) {\n  switch (t) {\n    case \"miter\":\n      return 2;\n\n    case \"bevel\":\n      return 0;\n\n    case \"round\":\n      return 1;\n\n    default:\n      return u.error(new e(\"mapview-invalid-type\", `Join type ${t} is not a valid option. Defaulting to round`)), 1;\n  }\n}\n\nfunction X(e) {\n  switch (e) {\n    case \"opacity\":\n      return i.OPACITY;\n\n    case \"color\":\n      return i.COLOR;\n\n    case \"rotation\":\n      return i.ROTATION;\n\n    case \"size\":\n      return i.SIZE;\n\n    default:\n      return u.error(`Cannot interpret unknown vv: ${e}`), null;\n  }\n}\n\nfunction Z(e) {\n  const {\n    transform: t,\n    hasZ: r,\n    hasM: n\n  } = e;\n  return {\n    transform: t,\n    hasZ: r,\n    hasM: n\n  };\n}\n\nfunction _(e, t, r, n, o, s, i) {\n  for (const c in s) {\n    const t = s[c].stride,\n          n = C(t),\n          i = s[c].data,\n          a = r[c].data,\n          u = t * o.vertexCount / n,\n          f = t * e / n,\n          l = t * o.vertexFrom / n;\n\n    for (let e = 0; e < u; ++e) a[e + f] = i[e + l];\n  }\n\n  const a = o.indexCount;\n\n  for (let c = 0; c < a; ++c) n[c + t] = i[c + o.indexFrom] - o.vertexFrom + e;\n}\n\nconst q = {\n  [f]: 35044\n};\n\nfunction D(e, t) {\n  const r = [];\n\n  for (let n = 0; n < 5; ++n) {\n    const o = j(n),\n          s = {};\n\n    for (const e of o) s[e] = {\n      data: t(n, e)\n    };\n\n    r.push({\n      data: e(n),\n      buffers: s\n    });\n  }\n\n  return r;\n}\n\nfunction k(e, t) {\n  let n, o;\n  return r(t.width) && r(t.height) ? (n = !0, o = 9987) : (n = !1, o = 9729), new c(e, {\n    target: 3553,\n    pixelFormat: 6408,\n    internalFormat: 6408,\n    dataType: 5121,\n    hasMipmap: n,\n    samplingMode: o,\n    wrapMode: 33071,\n    flipped: !0\n  }, t);\n}\n\nfunction J(e) {\n  return {\n    vertexFrom: void 0,\n    vertexTo: void 0,\n    geometry: e\n  };\n}\n\nfunction Y(e) {\n  switch (e) {\n    case 5120:\n    case 5121:\n      return 1;\n\n    case 5122:\n    case 5123:\n      return 2;\n\n    case 5126:\n    case 5124:\n    case 5125:\n      return 4;\n  }\n}\n\nfunction G(t) {\n  switch (t) {\n    case 5121:\n      return 1;\n\n    case 32819:\n      return 2;\n\n    case 5126:\n      return 4;\n\n    default:\n      return void u.error(new e(\"webgl-utils\", `Unable to handle type ${t}`));\n  }\n}\n\nfunction H(t) {\n  switch (t) {\n    case 5121:\n      return Uint8Array;\n\n    case 32819:\n      return Uint16Array;\n\n    case 5126:\n      return Float32Array;\n\n    default:\n      return void u.error(new e(\"webgl-utils\", `Unable to handle type ${t}`));\n  }\n}\n\nfunction Q(e) {\n  const t = {};\n\n  for (const r in e) {\n    const n = e[r];\n    let o = 0;\n    t[r] = n.map(e => {\n      const t = { ...e,\n        normalized: e.normalized || !1,\n        divisor: e.divisor || 0,\n        offset: o,\n        stride: 0\n      };\n      return o += e.count * Y(e.type), t;\n    }), t[r].forEach(e => e.stride = o);\n  }\n\n  return t;\n}\n\nconst V = e => {\n  const t = new Map();\n\n  for (const r in e) for (const n of e[r]) t.set(n.name, n.location);\n\n  return t;\n},\n      W = e => {\n  const t = {};\n\n  for (const r in e) {\n    const n = e[r];\n    t[r] = n.length ? n[0].stride : 0;\n  }\n\n  return t;\n},\n      ee = new Map(),\n      te = (e, t) => {\n  if (!ee.has(e)) {\n    const r = Q(t),\n          n = {\n      strides: W(r),\n      bufferLayouts: r,\n      attributes: V(t)\n    };\n    ee.set(e, n);\n  }\n\n  return ee.get(e);\n};\n\nfunction re(e) {\n  e(s.FILL), e(s.LINE), e(s.MARKER), e(s.TEXT), e(s.LABEL);\n}\n\nexport { L as C_FILL_STRIDE_SPEC, I as C_FILL_STRIDE_SPEC_DD, p as C_FILL_VERTEX_DEF, h as C_FILL_VERTEX_DEF_DD, A as C_ICON_STRIDE_SPEC, m as C_ICON_VERTEX_DEF, M as C_LABEL_STRIDE_SPEC, y as C_LABEL_VERTEX_DEF, E as C_LINE_STRIDE_SPEC, w as C_LINE_VERTEX_DEF, b as C_TEXT_STRIDE_SPEC, v as C_TEXT_VERTEX_DEF, f as C_VBO_GEOMETRY, q as C_VBO_INFO, l as C_VBO_PERINSTANCE, d as C_VBO_PERINSTANCE_VV, R as allocateTypedArrayBuffer, O as allocateTypedArrayBufferwithData, _ as copyMeshData, D as createGeometryData, te as createProgramDescriptor, k as createTextureFromTexelData, re as forEachGeometryType, J as geometryToMappedGeometry, Y as getBytes, P as getCapType, S as getJoinType, j as getNamedBuffers, H as getPixelArrayCtor, G as getPixelBytes, T as getStrides, $ as getTextProperties, Z as getTransformParams, X as getVVType, N as isDefined, K as isNumber, C as strideToPackingFactor };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"],"names":["e","t","isPowerOfTwo","r","pt2px","n","copyAndPremultiply","o","WGLGeometryType","s","VVType","i","TextProperties","a","c","u","getLogger","f","l","d","m","name","strideInBytes","divisor","p","h","w","v","y","g","A","L","I","E","b","M","T","MARKER","FILL","LINE","TEXT","LABEL","x","U","B","F","z","j","C","R","Uint32Array","Math","floor","Uint8Array","O","$","pool","acquire","color","haloColor","haloSize","font","size","angle","PI","xoffset","yoffset","horizontalAlignment","verticalAlignment","N","K","P","error","S","X","OPACITY","COLOR","ROTATION","SIZE","Z","transform","hasZ","hasM","_","stride","data","vertexCount","vertexFrom","indexCount","indexFrom","q","D","push","buffers","k","width","height","target","pixelFormat","internalFormat","dataType","hasMipmap","samplingMode","wrapMode","flipped","J","vertexTo","geometry","Y","G","H","Uint16Array","Float32Array","Q","map","normalized","offset","count","type","forEach","V","Map","set","location","W","length","ee","te","has","strides","bufferLayouts","attributes","get","re","C_FILL_STRIDE_SPEC","C_FILL_STRIDE_SPEC_DD","C_FILL_VERTEX_DEF","C_FILL_VERTEX_DEF_DD","C_ICON_STRIDE_SPEC","C_ICON_VERTEX_DEF","C_LABEL_STRIDE_SPEC","C_LABEL_VERTEX_DEF","C_LINE_STRIDE_SPEC","C_LINE_VERTEX_DEF","C_TEXT_STRIDE_SPEC","C_TEXT_VERTEX_DEF","C_VBO_GEOMETRY","C_VBO_INFO","C_VBO_PERINSTANCE","C_VBO_PERINSTANCE_VV","allocateTypedArrayBuffer","allocateTypedArrayBufferwithData","copyMeshData","createGeometryData","createProgramDescriptor","createTextureFromTexelData","forEachGeometryType","geometryToMappedGeometry","getBytes","getCapType","getJoinType","getNamedBuffers","getPixelArrayCtor","getPixelBytes","getStrides","getTextProperties","getTransformParams","getVVType","isDefined","isNumber","strideToPackingFactor"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import t from\"../../../../core/Logger.js\";import{isPowerOfTwo as r}from\"../../../../core/mathUtils.js\";import{pt2px as n}from\"../../../../core/screenUtils.js\";import{copyAndPremultiply as o}from\"./color.js\";import{WGLGeometryType as s,VVType as i}from\"./enums.js\";import{TextProperties as a}from\"./SymbolProperties.js\";import c from\"../../../webgl/Texture.js\";const u=t.getLogger(\"esri.views.2d.engine.webgl.Utils\"),f=\"geometry\",l=\"per_instance\",d=\"per_instance_vv\",m=[{name:f,strideInBytes:36,divisor:0}],p=[{name:f,strideInBytes:36,divisor:0}],h=[{name:f,strideInBytes:12,divisor:0}],w=[{name:f,strideInBytes:40,divisor:0}],v=[{name:f,strideInBytes:36,divisor:0}],y=[{name:f,strideInBytes:36,divisor:0}];function g(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const A=g(m),L=g(p),I=g(h),E=g(w),b=g(v),M=g(y);function T(e,t){switch(e){case s.MARKER:return A;case s.FILL:return t?I:L;case s.LINE:return E;case s.TEXT:return b;case s.LABEL:return M}}const x=[f],U=[f],B=[f],F=[f],z=[f];function j(e){switch(e){case s.MARKER:return x;case s.FILL:return U;case s.LINE:return B;case s.TEXT:return F;case s.LABEL:return z}}function C(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function R(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function O(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function $(e){return a.pool.acquire(e.color?o(e.color):[255,255,255,255],e.haloColor?o(e.haloColor):[255,255,255,255],n(e.haloSize),n(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,\"left\"===e.horizontalAlignment?0:\"right\"===e.horizontalAlignment?1:.5,\"top\"===e.verticalAlignment?0:\"bottom\"===e.verticalAlignment?1:.5)}function N(e){return null!=e}function K(e){return\"number\"==typeof e}function P(t){switch(t){case\"butt\":return 0;case\"round\":return 1;case\"square\":return 2;default:return u.error(new e(\"mapview-invalid-type\",`Cap type ${t} is not a valid option. Defaulting to round`)),1}}function S(t){switch(t){case\"miter\":return 2;case\"bevel\":return 0;case\"round\":return 1;default:return u.error(new e(\"mapview-invalid-type\",`Join type ${t} is not a valid option. Defaulting to round`)),1}}function X(e){switch(e){case\"opacity\":return i.OPACITY;case\"color\":return i.COLOR;case\"rotation\":return i.ROTATION;case\"size\":return i.SIZE;default:return u.error(`Cannot interpret unknown vv: ${e}`),null}}function Z(e){const{transform:t,hasZ:r,hasM:n}=e;return{transform:t,hasZ:r,hasM:n}}function _(e,t,r,n,o,s,i){for(const c in s){const t=s[c].stride,n=C(t),i=s[c].data,a=r[c].data,u=t*o.vertexCount/n,f=t*e/n,l=t*o.vertexFrom/n;for(let e=0;e<u;++e)a[e+f]=i[e+l]}const a=o.indexCount;for(let c=0;c<a;++c)n[c+t]=i[c+o.indexFrom]-o.vertexFrom+e}const q={[f]:35044};function D(e,t){const r=[];for(let n=0;n<5;++n){const o=j(n),s={};for(const e of o)s[e]={data:t(n,e)};r.push({data:e(n),buffers:s})}return r}function k(e,t){let n,o;return r(t.width)&&r(t.height)?(n=!0,o=9987):(n=!1,o=9729),new c(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:n,samplingMode:o,wrapMode:33071,flipped:!0},t)}function J(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}}function Y(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function G(t){switch(t){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void u.error(new e(\"webgl-utils\",`Unable to handle type ${t}`))}}function H(t){switch(t){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void u.error(new e(\"webgl-utils\",`Unable to handle type ${t}`))}}function Q(e){const t={};for(const r in e){const n=e[r];let o=0;t[r]=n.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0};return o+=e.count*Y(e.type),t})),t[r].forEach((e=>e.stride=o))}return t}const V=e=>{const t=new Map;for(const r in e)for(const n of e[r])t.set(n.name,n.location);return t},W=e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t},ee=new Map,te=(e,t)=>{if(!ee.has(e)){const r=Q(t),n={strides:W(r),bufferLayouts:r,attributes:V(t)};ee.set(e,n)}return ee.get(e)};function re(e){e(s.FILL),e(s.LINE),e(s.MARKER),e(s.TEXT),e(s.LABEL)}export{L as C_FILL_STRIDE_SPEC,I as C_FILL_STRIDE_SPEC_DD,p as C_FILL_VERTEX_DEF,h as C_FILL_VERTEX_DEF_DD,A as C_ICON_STRIDE_SPEC,m as C_ICON_VERTEX_DEF,M as C_LABEL_STRIDE_SPEC,y as C_LABEL_VERTEX_DEF,E as C_LINE_STRIDE_SPEC,w as C_LINE_VERTEX_DEF,b as C_TEXT_STRIDE_SPEC,v as C_TEXT_VERTEX_DEF,f as C_VBO_GEOMETRY,q as C_VBO_INFO,l as C_VBO_PERINSTANCE,d as C_VBO_PERINSTANCE_VV,R as allocateTypedArrayBuffer,O as allocateTypedArrayBufferwithData,_ as copyMeshData,D as createGeometryData,te as createProgramDescriptor,k as createTextureFromTexelData,re as forEachGeometryType,J as geometryToMappedGeometry,Y as getBytes,P as getCapType,S as getJoinType,j as getNamedBuffers,H as getPixelArrayCtor,G as getPixelBytes,T as getStrides,$ as getTextProperties,Z as getTransformParams,X as getVVType,N as isDefined,K as isNumber,C as strideToPackingFactor};\n"]},"metadata":{},"sourceType":"module"}