{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport { isNone as n, isSome as i } from \"../../core/maybe.js\";\nimport { getDeepValue as t, setDeepValue as r } from \"../../core/object.js\";\nimport { validateDomainValue as l, getDomainRange as o, DomainValidationError as a } from \"./domains.js\";\nimport { loadArcade as s } from \"../../support/arcadeOnDemand.js\";\nconst u = [\"field\", \"field2\", \"field3\", \"normalizationField\", \"rotationInfo.field\", \"proportionalSymbolInfo.field\", \"proportionalSymbolInfo.normalizationField\", \"colorInfo.field\", \"colorInfo.normalizationField\"],\n      f = [\"field\", \"normalizationField\"];\n\nfunction c(e, n) {\n  if (null != e && null != n) for (const i of Array.isArray(e) ? e : [e]) if (d(u, i, n), \"visualVariables\" in i && i.visualVariables) for (const e of i.visualVariables) d(f, e, n);\n}\n\nfunction d(e, n, i) {\n  if (e) for (const l of e) {\n    const e = t(l, n),\n          o = e && \"function\" != typeof e && i.get(e);\n    o && r(l, o.name, n);\n  }\n}\n\nfunction m(e, n) {\n  if (null != e && null != n && n.fields.length) if (\"startField\" in e) {\n    const i = n.get(e.startField),\n          t = n.get(e.endField);\n    e.startField = i && i.name || null, e.endField = t && t.name || null;\n  } else {\n    const i = n.get(e.startTimeField),\n          t = n.get(e.endTimeField);\n    e.startTimeField = i && i.name || null, e.endTimeField = t && t.name || null;\n  }\n}\n\nconst y = new Set();\n\nfunction p(e, n) {\n  return e && n ? (y.clear(), g(y, e, n), Array.from(y).sort()) : [];\n}\n\nfunction g(e, n, i) {\n  var t;\n  if (i) if (null != n && null != (t = n.fields) && t.length) {\n    if (i.includes(\"*\")) for (const {\n      name: r\n    } of n.fields) e.add(r);else for (const r of i) F(e, n, r);\n  } else {\n    if (i.includes(\"*\")) return e.clear(), void e.add(\"*\");\n\n    for (const n of i) e.add(n);\n  }\n}\n\nfunction F(e, n, i) {\n  if (\"string\" == typeof i) if (n) {\n    const t = n.get(i);\n    t && e.add(t.name);\n  } else e.add(i);\n}\n\nfunction I(e, i) {\n  return n(i) || n(e) ? [] : i.includes(\"*\") ? e.fields.map(e => e.name) : i;\n}\n\nfunction b(e, n, i = 1) {\n  if (!n || !e) return [];\n  if (n.includes(\"*\")) return [\"*\"];\n  const t = p(e, n);\n  return t.length / e.fields.length >= i ? [\"*\"] : t;\n}\n\nasync function T(e, n, i) {\n  if (!i) return;\n  const {\n    arcadeUtils: t\n  } = await s(),\n        r = t.extractFieldNames(i);\n\n  for (const l of r) F(e, n, l);\n}\n\nasync function x(n, i, t) {\n  if (t && \"1=1\" !== t) {\n    const r = (await import(\"../../core/sql/WhereClause.js\")).WhereClause.create(t, i);\n    if (!r.isStandardized) throw new e(\"fieldUtils:collectFilterFields\", \"Where clause is not standardized\");\n    g(n, i, r.fieldNames);\n  }\n}\n\nfunction h({\n  displayField: e,\n  fields: n\n}) {\n  return e || (n && n.length ? w(n, \"name-or-title\") || w(n, \"unique-identifier\") || w(n, \"type-or-category\") || S(n) : null);\n}\n\nfunction S(e) {\n  for (const n of e) {\n    if (!n || !n.name) continue;\n    const e = n.name.toLowerCase();\n    if (e.indexOf(\"name\") > -1 || e.indexOf(\"title\") > -1) return n.name;\n  }\n\n  return null;\n}\n\nfunction w(e, n) {\n  for (const i of e) if (i && i.valueType && i.valueType === n) return i.name;\n\n  return null;\n}\n\nasync function v(e) {\n  if (!e) return [];\n  const n = new Set();\n  return await A(n, e), Array.from(n).sort();\n}\n\nasync function A(e, n) {\n  if (!n) return;\n  const i = t(\"elevationInfo.featureExpressionInfo\", n);\n  return i ? i.collectRequiredFields(e, n.fieldsIndex) : void 0;\n}\n\nasync function N(e, n, i) {\n  i.outStatistic.onStatisticValueExpression ? T(e, n, i.outStatistic.onStatisticValueExpression) : e.add(i.outStatistic.onStatisticField);\n}\n\nasync function E(e, n, i) {\n  n && i && \"cluster\" === i.type && i.fields && (await Promise.all(i.fields.map(i => N(e, n.fieldsIndex, i))));\n}\n\nasync function V(e, n, t) {\n  n && (n.timeInfo && i(t) && t.timeExtent && g(e, n.fieldsIndex, [n.timeInfo.startField, n.timeInfo.endField]), n.floorInfo && g(e, n.fieldsIndex, [n.floorInfo.floorField]), i(t) && i(t.where) && (await x(e, n.fieldsIndex, t.where)));\n}\n\nasync function _(e) {\n  if (!e) return [];\n  const n = \"timeInfo\" in e && e.timeInfo;\n  return n ? p(e.fieldsIndex, [e.trackIdField, n.startField, n.endField]) : [];\n}\n\nfunction D(e) {\n  if (!e) return [];\n  const n = \"editFieldsInfo\" in e && e.editFieldsInfo;\n  return n ? p(e.fieldsIndex, [n && n.creatorField, n && n.creationDateField, n && n.editorField, n && n.editDateField]) : [];\n}\n\nfunction $(e) {\n  if (!e) return [];\n  const n = e.geometryFieldsInfo;\n  return n ? p(e.fieldsIndex, [n.shapeAreaField, n.shapeLengthField]) : [];\n}\n\nasync function O(e) {\n  if (!e) return [];\n  const n = new Set();\n  return await L(n, e), Array.from(n).sort();\n}\n\nasync function L(e, n) {\n  const {\n    labelingInfo: i,\n    fieldsIndex: t\n  } = n;\n  i && i.length && (await Promise.all(i.map(n => U(e, t, n))));\n}\n\nasync function U(e, n, i) {\n  if (!i) return;\n  const t = i.getLabelExpression(),\n        r = i.where;\n  if (\"arcade\" === t.type) await T(e, n, t.expression);else {\n    const i = t.expression.match(/{[^}]*}/g);\n    i && i.forEach(i => {\n      F(e, n, i.slice(1, -1));\n    });\n  }\n  await x(e, n, r);\n}\n\nfunction j(e) {\n  const n = e.defaultValue;\n  return void 0 !== n && M(e, n) ? n : e.nullable ? null : void 0;\n}\n\nfunction z(e) {\n  return \"number\" == typeof e && !isNaN(e) && isFinite(e);\n}\n\nfunction k(e) {\n  return null === e || z(e);\n}\n\nconst P = \"isInteger\" in Number ? Number.isInteger : e => \"number\" == typeof e && isFinite(e) && Math.floor(e) === e;\n\nfunction R(e) {\n  return null === e || P(e);\n}\n\nfunction C(e) {\n  return null != e && \"string\" == typeof e;\n}\n\nfunction G(e) {\n  return null === e || C(e);\n}\n\nfunction q() {\n  return !0;\n}\n\nfunction M(e, n) {\n  let i;\n\n  switch (e.type) {\n    case \"date\":\n    case \"integer\":\n    case \"long\":\n    case \"small-integer\":\n    case \"esriFieldTypeDate\":\n    case \"esriFieldTypeInteger\":\n    case \"esriFieldTypeLong\":\n    case \"esriFieldTypeSmallInteger\":\n      i = e.nullable ? R : P;\n      break;\n\n    case \"double\":\n    case \"single\":\n    case \"esriFieldTypeSingle\":\n    case \"esriFieldTypeDouble\":\n      i = e.nullable ? k : z;\n      break;\n\n    case \"string\":\n    case \"esriFieldTypeString\":\n      i = e.nullable ? G : C;\n      break;\n\n    default:\n      i = q;\n  }\n\n  return 1 === arguments.length ? i : i(n);\n}\n\nconst W = [\"integer\", \"small-integer\", \"single\", \"double\"],\n      Y = new Set([...W, \"esriFieldTypeInteger\", \"esriFieldTypeSmallInteger\", \"esriFieldTypeSingle\", \"esriFieldTypeDouble\"]);\n\nfunction J(e) {\n  return null != e && Y.has(e.type);\n}\n\nfunction X(e) {\n  return null != e && (\"string\" === e.type || \"esriFieldTypeString\" === e.type);\n}\n\nfunction B(e) {\n  return null != e && (\"date\" === e.type || \"esriFieldTypeDate\" === e.type);\n}\n\nfunction H(e, n) {\n  return null === ee(e, n);\n}\n\nvar K, Q;\n\nfunction Z(e) {\n  return null == e || \"number\" == typeof e && isNaN(e) ? null : e;\n}\n\nfunction ee(e, n) {\n  return e.nullable && null === n ? null : J(e) && !ne(e.type, Number(n)) ? K.OUT_OF_RANGE : M(e, n) ? e.domain ? l(e.domain, n) : null : Q.INVALID_TYPE;\n}\n\nfunction ne(e, n) {\n  const i = \"string\" == typeof e ? te(e) : e;\n  return !!i && (i.isInteger ? P(n) && n >= i.min && n <= i.max : n >= i.min && n <= i.max);\n}\n\nfunction ie(e) {\n  const n = o(e.domain);\n  return n || (J(e) ? te(e.type) : void 0);\n}\n\nfunction te(e) {\n  switch (e) {\n    case \"esriFieldTypeSmallInteger\":\n    case \"small-integer\":\n      return le;\n\n    case \"esriFieldTypeInteger\":\n    case \"integer\":\n      return oe;\n\n    case \"esriFieldTypeSingle\":\n    case \"single\":\n      return ae;\n\n    case \"esriFieldTypeDouble\":\n    case \"double\":\n      return se;\n  }\n}\n\nfunction re(e) {\n  if (!z(e)) return null;\n\n  if (P(e)) {\n    if (e >= le.min && e <= le.max) return \"esriFieldTypeSmallInteger\";\n    if (e >= oe.min && e <= oe.max) return \"esriFieldTypeInteger\";\n  }\n\n  return e >= ae.min && e <= ae.max ? \"esriFieldTypeSingle\" : \"esriFieldTypeDouble\";\n}\n\n!function (e) {\n  e.OUT_OF_RANGE = \"numeric-range-validation-error::out-of-range\";\n}(K || (K = {})), function (e) {\n  e.INVALID_TYPE = \"type-validation-error::invalid-type\";\n}(Q || (Q = {}));\nconst le = {\n  min: -32768,\n  max: 32767,\n  isInteger: !0\n},\n      oe = {\n  min: -2147483648,\n  max: 2147483647,\n  isInteger: !0\n},\n      ae = {\n  min: -34e37,\n  max: 12e37,\n  isInteger: !1\n},\n      se = {\n  min: -Number.MAX_VALUE,\n  max: Number.MAX_VALUE,\n  isInteger: !1\n};\n\nfunction ue(e, n, i) {\n  switch (e) {\n    case a.INVALID_CODED_VALUE:\n      return `Value ${i} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;\n\n    case a.VALUE_OUT_OF_RANGE:\n      return `Value ${i} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;\n\n    case Q.INVALID_TYPE:\n      return `Value ${i} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;\n\n    case K.OUT_OF_RANGE:\n      {\n        const {\n          min: e,\n          max: t\n        } = te(n.type);\n        return `Value ${i} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${e} to ${t}`;\n      }\n  }\n}\n\nfunction fe(e, n) {\n  return !ce(e, n, null);\n}\n\nfunction ce(e, n, t) {\n  if (!n || !n.attributes || !e) {\n    if (i(t)) for (const n of e) t.add(n);\n    return !0;\n  }\n\n  const r = n.attributes;\n  let l = !1;\n\n  for (const o of e) if (!(o in r)) {\n    if (l = !0, !i(t)) break;\n    t.add(o);\n  }\n\n  return l;\n}\n\nasync function de(e, n) {\n  const i = new Set();\n\n  for (const t of n) await T(i, e.fieldsIndex, t);\n\n  return Array.from(i).sort();\n}\n\nexport { K as NumericRangeValidationError, Q as TypeValidationError, T as collectArcadeFieldNames, A as collectElevationFields, E as collectFeatureReductionFields, F as collectField, g as collectFields, V as collectFilterFields, L as collectLabelingFields, se as doubleRange, fe as featureHasFields, p as fixFields, c as fixRendererFields, m as fixTimeInfoFields, h as getDisplayFieldName, v as getElevationFields, de as getExpressionFields, D as getFeatureEditFields, $ as getFeatureGeometryFields, j as getFieldDefaultValue, ie as getFieldRange, O as getLabelingFields, re as getNumericTypeForValue, _ as getTimeFields, oe as integerRange, B as isDateField, ne as isNumberInRange, J as isNumericField, X as isStringField, H as isValidFieldValue, M as isValueMatchingFieldType, W as numericTypes, b as packFields, ce as populateMissingFields, u as rendererFields, Z as sanitizeNullFieldValue, ae as singleRange, le as smallIntegerRange, I as unpackFieldNames, ee as validateFieldValue, ue as validationErrorToString, f as visualVariableFields };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/fieldUtils.js"],"names":["e","isNone","n","isSome","i","getDeepValue","t","setDeepValue","r","validateDomainValue","l","getDomainRange","o","DomainValidationError","a","loadArcade","s","u","f","c","Array","isArray","d","visualVariables","get","name","m","fields","length","startField","endField","startTimeField","endTimeField","y","Set","p","clear","g","from","sort","includes","add","F","I","map","b","T","arcadeUtils","extractFieldNames","x","WhereClause","create","isStandardized","fieldNames","h","displayField","w","S","toLowerCase","indexOf","valueType","v","A","collectRequiredFields","fieldsIndex","N","outStatistic","onStatisticValueExpression","onStatisticField","E","type","Promise","all","V","timeInfo","timeExtent","floorInfo","floorField","where","_","trackIdField","D","editFieldsInfo","creatorField","creationDateField","editorField","editDateField","$","geometryFieldsInfo","shapeAreaField","shapeLengthField","O","L","labelingInfo","U","getLabelExpression","expression","match","forEach","slice","j","defaultValue","M","nullable","z","isNaN","isFinite","k","P","Number","isInteger","Math","floor","R","C","G","q","arguments","W","Y","J","has","X","B","H","ee","K","Q","Z","ne","OUT_OF_RANGE","domain","INVALID_TYPE","te","min","max","ie","le","oe","ae","se","re","MAX_VALUE","ue","INVALID_CODED_VALUE","JSON","stringify","VALUE_OUT_OF_RANGE","fe","ce","attributes","de","NumericRangeValidationError","TypeValidationError","collectArcadeFieldNames","collectElevationFields","collectFeatureReductionFields","collectField","collectFields","collectFilterFields","collectLabelingFields","doubleRange","featureHasFields","fixFields","fixRendererFields","fixTimeInfoFields","getDisplayFieldName","getElevationFields","getExpressionFields","getFeatureEditFields","getFeatureGeometryFields","getFieldDefaultValue","getFieldRange","getLabelingFields","getNumericTypeForValue","getTimeFields","integerRange","isDateField","isNumberInRange","isNumericField","isStringField","isValidFieldValue","isValueMatchingFieldType","numericTypes","packFields","populateMissingFields","rendererFields","sanitizeNullFieldValue","singleRange","smallIntegerRange","unpackFieldNames","validateFieldValue","validationErrorToString","visualVariableFields"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{isNone as n,isSome as i}from\"../../core/maybe.js\";import{getDeepValue as t,setDeepValue as r}from\"../../core/object.js\";import{validateDomainValue as l,getDomainRange as o,DomainValidationError as a}from\"./domains.js\";import{loadArcade as s}from\"../../support/arcadeOnDemand.js\";const u=[\"field\",\"field2\",\"field3\",\"normalizationField\",\"rotationInfo.field\",\"proportionalSymbolInfo.field\",\"proportionalSymbolInfo.normalizationField\",\"colorInfo.field\",\"colorInfo.normalizationField\"],f=[\"field\",\"normalizationField\"];function c(e,n){if(null!=e&&null!=n)for(const i of Array.isArray(e)?e:[e])if(d(u,i,n),\"visualVariables\"in i&&i.visualVariables)for(const e of i.visualVariables)d(f,e,n)}function d(e,n,i){if(e)for(const l of e){const e=t(l,n),o=e&&\"function\"!=typeof e&&i.get(e);o&&r(l,o.name,n)}}function m(e,n){if(null!=e&&null!=n&&n.fields.length)if(\"startField\"in e){const i=n.get(e.startField),t=n.get(e.endField);e.startField=i&&i.name||null,e.endField=t&&t.name||null}else{const i=n.get(e.startTimeField),t=n.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=t&&t.name||null}}const y=new Set;function p(e,n){return e&&n?(y.clear(),g(y,e,n),Array.from(y).sort()):[]}function g(e,n,i){var t;if(i)if(null!=n&&null!=(t=n.fields)&&t.length)if(i.includes(\"*\"))for(const{name:r}of n.fields)e.add(r);else for(const r of i)F(e,n,r);else{if(i.includes(\"*\"))return e.clear(),void e.add(\"*\");for(const n of i)e.add(n)}}function F(e,n,i){if(\"string\"==typeof i)if(n){const t=n.get(i);t&&e.add(t.name)}else e.add(i)}function I(e,i){return n(i)||n(e)?[]:i.includes(\"*\")?e.fields.map((e=>e.name)):i}function b(e,n,i=1){if(!n||!e)return[];if(n.includes(\"*\"))return[\"*\"];const t=p(e,n);return t.length/e.fields.length>=i?[\"*\"]:t}async function T(e,n,i){if(!i)return;const{arcadeUtils:t}=await s(),r=t.extractFieldNames(i);for(const l of r)F(e,n,l)}async function x(n,i,t){if(t&&\"1=1\"!==t){const r=(await import(\"../../core/sql/WhereClause.js\")).WhereClause.create(t,i);if(!r.isStandardized)throw new e(\"fieldUtils:collectFilterFields\",\"Where clause is not standardized\");g(n,i,r.fieldNames)}}function h({displayField:e,fields:n}){return e||(n&&n.length?w(n,\"name-or-title\")||w(n,\"unique-identifier\")||w(n,\"type-or-category\")||S(n):null)}function S(e){for(const n of e){if(!n||!n.name)continue;const e=n.name.toLowerCase();if(e.indexOf(\"name\")>-1||e.indexOf(\"title\")>-1)return n.name}return null}function w(e,n){for(const i of e)if(i&&i.valueType&&i.valueType===n)return i.name;return null}async function v(e){if(!e)return[];const n=new Set;return await A(n,e),Array.from(n).sort()}async function A(e,n){if(!n)return;const i=t(\"elevationInfo.featureExpressionInfo\",n);return i?i.collectRequiredFields(e,n.fieldsIndex):void 0}async function N(e,n,i){i.outStatistic.onStatisticValueExpression?T(e,n,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function E(e,n,i){n&&i&&\"cluster\"===i.type&&i.fields&&await Promise.all(i.fields.map((i=>N(e,n.fieldsIndex,i))))}async function V(e,n,t){n&&(n.timeInfo&&i(t)&&t.timeExtent&&g(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&g(e,n.fieldsIndex,[n.floorInfo.floorField]),i(t)&&i(t.where)&&await x(e,n.fieldsIndex,t.where))}async function _(e){if(!e)return[];const n=\"timeInfo\"in e&&e.timeInfo;return n?p(e.fieldsIndex,[e.trackIdField,n.startField,n.endField]):[]}function D(e){if(!e)return[];const n=\"editFieldsInfo\"in e&&e.editFieldsInfo;return n?p(e.fieldsIndex,[n&&n.creatorField,n&&n.creationDateField,n&&n.editorField,n&&n.editDateField]):[]}function $(e){if(!e)return[];const n=e.geometryFieldsInfo;return n?p(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}async function O(e){if(!e)return[];const n=new Set;return await L(n,e),Array.from(n).sort()}async function L(e,n){const{labelingInfo:i,fieldsIndex:t}=n;i&&i.length&&await Promise.all(i.map((n=>U(e,t,n))))}async function U(e,n,i){if(!i)return;const t=i.getLabelExpression(),r=i.where;if(\"arcade\"===t.type)await T(e,n,t.expression);else{const i=t.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{F(e,n,i.slice(1,-1))}))}await x(e,n,r)}function j(e){const n=e.defaultValue;return void 0!==n&&M(e,n)?n:e.nullable?null:void 0}function z(e){return\"number\"==typeof e&&!isNaN(e)&&isFinite(e)}function k(e){return null===e||z(e)}const P=\"isInteger\"in Number?Number.isInteger:e=>\"number\"==typeof e&&isFinite(e)&&Math.floor(e)===e;function R(e){return null===e||P(e)}function C(e){return null!=e&&\"string\"==typeof e}function G(e){return null===e||C(e)}function q(){return!0}function M(e,n){let i;switch(e.type){case\"date\":case\"integer\":case\"long\":case\"small-integer\":case\"esriFieldTypeDate\":case\"esriFieldTypeInteger\":case\"esriFieldTypeLong\":case\"esriFieldTypeSmallInteger\":i=e.nullable?R:P;break;case\"double\":case\"single\":case\"esriFieldTypeSingle\":case\"esriFieldTypeDouble\":i=e.nullable?k:z;break;case\"string\":case\"esriFieldTypeString\":i=e.nullable?G:C;break;default:i=q}return 1===arguments.length?i:i(n)}const W=[\"integer\",\"small-integer\",\"single\",\"double\"],Y=new Set([...W,\"esriFieldTypeInteger\",\"esriFieldTypeSmallInteger\",\"esriFieldTypeSingle\",\"esriFieldTypeDouble\"]);function J(e){return null!=e&&Y.has(e.type)}function X(e){return null!=e&&(\"string\"===e.type||\"esriFieldTypeString\"===e.type)}function B(e){return null!=e&&(\"date\"===e.type||\"esriFieldTypeDate\"===e.type)}function H(e,n){return null===ee(e,n)}var K,Q;function Z(e){return null==e||\"number\"==typeof e&&isNaN(e)?null:e}function ee(e,n){return e.nullable&&null===n?null:J(e)&&!ne(e.type,Number(n))?K.OUT_OF_RANGE:M(e,n)?e.domain?l(e.domain,n):null:Q.INVALID_TYPE}function ne(e,n){const i=\"string\"==typeof e?te(e):e;return!!i&&(i.isInteger?P(n)&&n>=i.min&&n<=i.max:n>=i.min&&n<=i.max)}function ie(e){const n=o(e.domain);return n||(J(e)?te(e.type):void 0)}function te(e){switch(e){case\"esriFieldTypeSmallInteger\":case\"small-integer\":return le;case\"esriFieldTypeInteger\":case\"integer\":return oe;case\"esriFieldTypeSingle\":case\"single\":return ae;case\"esriFieldTypeDouble\":case\"double\":return se}}function re(e){if(!z(e))return null;if(P(e)){if(e>=le.min&&e<=le.max)return\"esriFieldTypeSmallInteger\";if(e>=oe.min&&e<=oe.max)return\"esriFieldTypeInteger\"}return e>=ae.min&&e<=ae.max?\"esriFieldTypeSingle\":\"esriFieldTypeDouble\"}!function(e){e.OUT_OF_RANGE=\"numeric-range-validation-error::out-of-range\"}(K||(K={})),function(e){e.INVALID_TYPE=\"type-validation-error::invalid-type\"}(Q||(Q={}));const le={min:-32768,max:32767,isInteger:!0},oe={min:-2147483648,max:2147483647,isInteger:!0},ae={min:-34e37,max:12e37,isInteger:!1},se={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function ue(e,n,i){switch(e){case a.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case a.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case Q.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case K.OUT_OF_RANGE:{const{min:e,max:t}=te(n.type);return`Value ${i} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${e} to ${t}`}}}function fe(e,n){return!ce(e,n,null)}function ce(e,n,t){if(!n||!n.attributes||!e){if(i(t))for(const n of e)t.add(n);return!0}const r=n.attributes;let l=!1;for(const o of e)if(!(o in r)){if(l=!0,!i(t))break;t.add(o)}return l}async function de(e,n){const i=new Set;for(const t of n)await T(i,e.fieldsIndex,t);return Array.from(i).sort()}export{K as NumericRangeValidationError,Q as TypeValidationError,T as collectArcadeFieldNames,A as collectElevationFields,E as collectFeatureReductionFields,F as collectField,g as collectFields,V as collectFilterFields,L as collectLabelingFields,se as doubleRange,fe as featureHasFields,p as fixFields,c as fixRendererFields,m as fixTimeInfoFields,h as getDisplayFieldName,v as getElevationFields,de as getExpressionFields,D as getFeatureEditFields,$ as getFeatureGeometryFields,j as getFieldDefaultValue,ie as getFieldRange,O as getLabelingFields,re as getNumericTypeForValue,_ as getTimeFields,oe as integerRange,B as isDateField,ne as isNumberInRange,J as isNumericField,X as isStringField,H as isValidFieldValue,M as isValueMatchingFieldType,W as numericTypes,b as packFields,ce as populateMissingFields,u as rendererFields,Z as sanitizeNullFieldValue,ae as singleRange,le as smallIntegerRange,I as unpackFieldNames,ee as validateFieldValue,ue as validationErrorToString,f as visualVariableFields};\n"]},"metadata":{},"sourceType":"module"}