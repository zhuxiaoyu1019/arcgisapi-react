{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport { toHSV as t } from \"../../core/colorUtils.js\";\nimport { JSONSupport as r } from \"../../core/JSONSupport.js\";\nimport s from \"../../core/Logger.js\";\nimport { unwrap as o, isSome as i } from \"../../core/maybe.js\";\nimport { property as a } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as n } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport l from \"../../layers/support/RasterInfo.js\";\nimport { extractBands as u, stretch as c, colorize as h, remapColor as p, lookupPixels as m, createStretchLUT as f, createColormapLUT as d, createHistogramEqualizationLUT as g, estimateStatisticsHistograms as S } from \"../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { hillshade as b, tintHillshade as x, calculateHillshadeParams as y } from \"../../layers/support/rasterFunctions/surfaceUtils.js\";\nimport { convertColorRampToColormap as k } from \"./colorRampUtils.js\";\nconst C = s.getLogger(\"esri.renderers.support.RasterSymbolizer\");\n\nfunction O(e, t) {\n  const {\n    attributeTable: r,\n    bandCount: s\n  } = e;\n  if (!i(r) || s > 1) return !1;\n\n  if (t) {\n    if (null == r.fields.find(e => e.name.toLowerCase() === t.toLowerCase())) return !1;\n  }\n\n  return !0;\n}\n\nfunction v(e) {\n  return \"elevation\" === e.dataType;\n}\n\nfunction L(e) {\n  const {\n    bandCount: t,\n    colormap: r\n  } = e;\n  return i(r) && r.length && 1 === t;\n}\n\nconst R = {\n  u1: [0, 1],\n  u2: [0, 3],\n  u4: [0, 15],\n  u8: [0, 255],\n  s8: [-128, 127],\n  u16: [0, 65535],\n  s16: [-32768, 32767],\n  u32: [0, 4294967295],\n  s32: [-2147483648, 2147483647],\n  f32: [-34e38, 34e38],\n  f64: [-Number.MAX_VALUE, Number.MAX_VALUE]\n};\n\nlet _ = class extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  bind() {\n    const {\n      rendererJSON: e\n    } = this;\n    if (!e) return !1;\n    let t;\n\n    switch (this.lookup = {\n      rendererJSON: {}\n    }, e.type) {\n      case \"uniqueValue\":\n        t = this._updateUVRenderer(e);\n        break;\n\n      case \"rasterColormap\":\n        t = this._updateColormapRenderer(e);\n        break;\n\n      case \"rasterStretch\":\n        t = this._updateStretchRenderer(e);\n        break;\n\n      case \"classBreaks\":\n        t = this._updateClassBreaksRenderer(e);\n        break;\n\n      case \"rasterShadedRelief\":\n        t = this._updateShadedReliefRenderer(e);\n    }\n\n    return t;\n  }\n\n  symbolize(e) {\n    let t = e && e.pixelBlock;\n    if (!this.isValidPixelBlock(t)) return t;\n    if (e.simpleStretchParams && \"rasterStretch\" === this.rendererJSON.type) return this.simpleStretch(t, e.simpleStretchParams);\n\n    try {\n      let r;\n\n      switch (t.pixels.length > 3 && (t = u(t, [0, 1, 2])), this.rendererJSON.type) {\n        case \"uniqueValue\":\n        case \"rasterColormap\":\n          r = this._symbolize_colormap(t);\n          break;\n\n        case \"classBreaks\":\n          r = this._symbolize_classBreaks(t);\n          break;\n\n        case \"rasterStretch\":\n          r = this._symbolize_stretch(t, e.bandIds);\n          break;\n\n        case \"rasterShadedRelief\":\n          {\n            const {\n              extent: s\n            } = e,\n                  o = s.spatialReference.isGeographic,\n                  i = {\n              x: (s.xmax - s.xmin) / t.width,\n              y: (s.ymax - s.ymin) / t.height\n            };\n            r = this._symbolize_shadedRelief(t, {\n              isGCS: o,\n              resolution: i\n            });\n            break;\n          }\n      }\n\n      return r;\n    } catch (r) {\n      return C.error(\"symbolize\", r.message), t;\n    }\n  }\n\n  simpleStretch(e, t) {\n    if (!this.isValidPixelBlock(e)) return e;\n\n    try {\n      return e.pixels.length > 3 && (e = u(e, [0, 1, 2])), c(e, t);\n    } catch (r) {\n      return C.error(\"symbolize\", r.message), e;\n    }\n  }\n\n  generateWebGLParameters(e) {\n    if ([\"uniqueValue\", \"rasterColormap\", \"classBreaks\"].indexOf(this.rendererJSON.type) > -1) {\n      var t;\n      const {\n        indexedColormap: e,\n        offset: r\n      } = (null == (t = this.lookup) ? void 0 : t.colormapLut) || {};\n      return {\n        colormap: e,\n        colormapOffset: r,\n        type: \"lut\"\n      };\n    }\n\n    const {\n      pixelBlock: r,\n      isGCS: s,\n      resolution: o,\n      bandIds: i\n    } = e,\n          {\n      rendererJSON: a\n    } = this;\n    return \"rasterStretch\" === a.type ? this.generateStretchWebGLParams(r, a, i) : \"rasterShadedRelief\" === a.type ? this.generateShadedReliefWebGLParams(a, s, o) : null;\n  }\n\n  _isLUTChanged(e) {\n    if (!this.lookup || !this.lookup.rendererJSON) return !0;\n\n    if (\"colorRamp\" in this.rendererJSON) {\n      const t = this.rendererJSON.colorRamp;\n      return e ? JSON.stringify(t) !== JSON.stringify(this.lookup.rendererJSON.colorRamp) : (this.rendererJSON, this.lookup.rendererJSON, JSON.stringify(this.rendererJSON) !== JSON.stringify(this.lookup.rendererJSON));\n    }\n\n    return JSON.stringify(this.rendererJSON) !== JSON.stringify(this.lookup.rendererJSON);\n  }\n\n  _symbolize_colormap(e) {\n    if (this._isLUTChanged()) {\n      if (!this.bind()) return e;\n    }\n\n    return h(e, this.lookup.colormapLut);\n  }\n\n  _symbolize_classBreaks(e) {\n    const t = this.rasterInfo.pixelType,\n          r = [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(t) > -1;\n    let s;\n\n    if (this._isLUTChanged()) {\n      if (!this.bind()) return e;\n    }\n\n    return s = r ? h(e, this.lookup.colormapLut) : p(e, this.lookup.remapLut), s;\n  }\n\n  _symbolize_stretch(e, t) {\n    const {\n      pixelType: r,\n      bandCount: s\n    } = this.rasterInfo,\n          o = this.rendererJSON,\n          i = [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(r) > -1;\n    let a, n;\n    const {\n      dra: l\n    } = o,\n          u = o.useGamma ? o.gamma : null;\n\n    if (\"histogramEqualization\" === o.stretchType) {\n      const r = l ? null : this.lookup.histogramLut,\n            s = this.getStretchCutoff(o, e, t, !r),\n            i = c(e, { ...s,\n        gamma: u\n      });\n      n = m(i, {\n        lut: l ? s.histogramLut : r,\n        offset: 0\n      });\n    } else if (i) {\n      var p;\n\n      if (l) {\n        const s = this.getStretchCutoff(o, e, t);\n        a = f({\n          pixelType: r,\n          ...s,\n          gamma: u\n        });\n      } else if (this._isLUTChanged()) {\n        if (!this.bind()) return e;\n        a = this.lookup ? this.lookup.stretchLut : null;\n      } else a = this.lookup ? this.lookup.stretchLut : null;\n\n      if (!a) return e;\n      s > 1 && (null == t ? void 0 : t.length) === e.pixels.length && (null == (p = a) ? void 0 : p.lut.length) === s && (a = {\n        lut: t.map(e => a.lut[e]),\n        offset: a.offset\n      }), n = m(e, a);\n    } else {\n      const r = this.getStretchCutoff(o, e, t);\n      n = c(e, { ...r,\n        gamma: u\n      });\n    }\n\n    if (o.colorRamp) {\n      if (this._isLUTChanged(!0)) {\n        if (!this.bind()) return e;\n      }\n\n      n = h(n, this.lookup.colormapLut);\n    }\n\n    return n;\n  }\n\n  _symbolize_shadedRelief(e, t) {\n    var r, s;\n    const i = this.rendererJSON,\n          a = { ...i,\n      ...t\n    },\n          n = b(e, a);\n    if (!i.colorRamp) return n;\n    let l;\n\n    if (this._isLUTChanged(!0)) {\n      if (!this.bind()) return n;\n      l = this.lookup ? this.lookup.hsvMap : null;\n    } else l = this.lookup ? this.lookup.hsvMap : null;\n\n    if (!l) return n;\n    const u = null != (r = null == (s = o(this.rasterInfo.statistics)) ? void 0 : s[0]) ? r : {\n      min: 0,\n      max: 8e3\n    };\n    return x(n, e, l, u), n;\n  }\n\n  _updateUVRenderer(e) {\n    const {\n      bandCount: t,\n      attributeTable: r,\n      pixelType: s\n    } = this.rasterInfo,\n          o = e.field1;\n    if (!o) return !1;\n    const i = 1 === t && [\"u8\", \"s8\"].includes(s);\n    if (!O(this.rasterInfo, o) && !i) return !1;\n    const a = [];\n\n    if (r) {\n      const t = r.fields.filter(e => \"value\" === e.name.toLowerCase())[0];\n      if (!t) return !1;\n      r.features.forEach(r => {\n        var s;\n        const i = e.uniqueValueInfos.filter(e => String(e.value) === String(r.attributes[o]))[0],\n              n = null == i || null == (s = i.symbol) ? void 0 : s.color;\n        n && a.push([r.attributes[t.name]].concat(n));\n      });\n    } else {\n      if (\"value\" !== o.toLowerCase()) return !1;\n      e.uniqueValueInfos.forEach(e => {\n        var t;\n        const r = null == e || null == (t = e.symbol) ? void 0 : t.color;\n        r && a.push([parseInt(\"\" + e.value, 10)].concat(r));\n      });\n    }\n\n    if (0 === a.length) return !1;\n    const n = d({\n      colormap: a\n    });\n    return this.lookup = {\n      rendererJSON: e,\n      colormapLut: n\n    }, this.canRenderInWebGL = !0, !0;\n  }\n\n  _updateColormapRenderer(e) {\n    if (!L(this.rasterInfo)) return !1;\n    const t = e.colormapInfos.map(e => [e.value].concat(e.color)).sort((e, t) => e[0] - t[0]);\n    if (!t || 0 === t.length) return !1;\n    const r = d({\n      colormap: t\n    });\n    return this.lookup = {\n      rendererJSON: e,\n      colormapLut: r\n    }, this.canRenderInWebGL = !0, !0;\n  }\n\n  _updateShadedReliefRenderer(e) {\n    if (!v(this.rasterInfo)) return !1;\n\n    if (e.colorRamp) {\n      const r = k(e.colorRamp, 256, !0),\n            s = d({\n        colormap: r\n      }),\n            o = [],\n            i = s.indexedColormap;\n\n      for (let e = 0; e < i.length; e += 4) {\n        const r = t({\n          r: i[e],\n          g: i[e + 1],\n          b: i[e + 2]\n        });\n        o.push([r.h / 60, r.s / 100, 255 * r.v / 100]);\n      }\n\n      this.lookup = {\n        rendererJSON: e,\n        colormapLut: s,\n        hsvMap: o\n      };\n    } else this.lookup = null;\n\n    return this.canRenderInWebGL = !0, !0;\n  }\n\n  _updateClassBreaksRenderer(e) {\n    const t = this.rasterInfo.pixelType,\n          r = [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(t) > -1,\n          s = e.classBreakInfos;\n    if (null == s || !s.length) return !1;\n    const o = s.sort((e, t) => e.classMaxValue - t.classMaxValue),\n          i = o[o.length - 1];\n    let a = e.minValue;\n\n    if (!r) {\n      const t = [];\n\n      for (let e = 0; e < o.length; e++) {\n        var n;\n        t.push({\n          value: null != (n = o[e].classMinValue) ? n : a,\n          mappedColor: o[e].symbol.color\n        }), a = o[e].classMaxValue;\n      }\n\n      return t.push({\n        value: i.classMaxValue,\n        mappedColor: i.symbol.color\n      }), this.lookup = {\n        rendererJSON: e,\n        remapLut: t\n      }, this.canRenderInWebGL = !1, !0;\n    }\n\n    const l = [];\n    a = Math.floor(e.minValue);\n\n    for (let c = 0; c < o.length; c++) {\n      const e = o[c];\n\n      for (let t = a; t < e.classMaxValue; t++) l.push([t].concat(e.symbol.color));\n\n      a = Math.ceil(e.classMaxValue);\n    }\n\n    i.classMaxValue === a && l.push([i.classMaxValue].concat(i.symbol.color));\n    const u = d({\n      colormap: l,\n      fillUnspecified: !1\n    });\n    return this.lookup = {\n      rendererJSON: e,\n      colormapLut: u\n    }, this.canRenderInWebGL = !0, !0;\n  }\n\n  _isHistogramRequired(e) {\n    return \"percentClip\" === e || \"histogramEqualization\" === e;\n  }\n\n  _isValidRasterStatistics(e) {\n    return i(e) && e.length > 0 && null != e[0].min && null != e[0].max;\n  }\n\n  _updateStretchRenderer(e) {\n    var t;\n    let {\n      stretchType: r,\n      dra: s\n    } = e;\n    if (!(\"none\" === r || null != (t = e.statistics) && t.length || this._isValidRasterStatistics(this.rasterInfo.statistics) || s)) return !1;\n    const i = o(e.histograms || this.rasterInfo.histograms);\n    !this._isHistogramRequired(e.stretchType) || null != i && i.length || s || (r = \"minMax\");\n    const {\n      gamma: a,\n      useGamma: n,\n      colorRamp: l\n    } = e,\n          u = this.rasterInfo.pixelType,\n          c = !s && [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(u) > -1;\n\n    if (\"histogramEqualization\" === r) {\n      const t = i.map(e => g(e));\n      this.lookup = {\n        rendererJSON: e,\n        histogramLut: t\n      };\n    } else if (c) {\n      const t = this.getStretchCutoff(e),\n            r = f({\n        pixelType: u,\n        ...t,\n        gamma: n ? a : null\n      });\n      this.lookup = {\n        rendererJSON: e,\n        stretchLut: r\n      };\n    }\n\n    if (l) {\n      const t = k(l, 256, !0);\n      this.lookup || (this.lookup = {\n        rendererJSON: e\n      }), this.lookup.colormapLut = d({\n        colormap: t\n      }), this.lookup.rendererJSON = e;\n    }\n\n    return this.canRenderInWebGL = !0, !0;\n  }\n\n  getStretchCutoff(e, t, r, s) {\n    var i, a, n;\n    let l,\n        u,\n        c = e.stretchType;\n    var h;\n    if (e.dra) {\n      if (\"minMax\" === c && t.statistics) l = t.statistics.map(e => [e.minValue, e.maxValue, 0, 0]);else {\n        const e = S(t);\n        l = e.statistics, u = e.histograms;\n      }\n    } else l = (null == (h = e.statistics) ? void 0 : h.length) > 0 ? e.statistics : o(this.rasterInfo.statistics), u = e.histograms || o(this.rasterInfo.histograms);\n    !this._isHistogramRequired(c) || null != (i = u) && i.length || (c = \"minMax\");\n    const p = (null == (a = l) ? void 0 : a.length) || (null == (n = u) ? void 0 : n.length) || this.rasterInfo.bandCount,\n          m = [],\n          f = [];\n\n    let d, b, x, y, k, C, O, v, L, _, N, J;\n\n    switch (l && !Array.isArray(l[0]) && (l = l.map(e => [e.min, e.max, e.avg, e.stddev])), c) {\n      case \"none\":\n        {\n          const e = R[this.rasterInfo.pixelType] || R.f32;\n\n          for (v = 0; v < p; v++) m[v] = e[0], f[v] = e[1];\n        }\n        break;\n\n      case \"minMax\":\n        for (v = 0; v < p; v++) m[v] = l[v][0], f[v] = l[v][1];\n\n        break;\n\n      case \"standardDeviation\":\n        for (v = 0; v < p; v++) m[v] = l[v][2] - e.numberOfStandardDeviations * l[v][3], f[v] = l[v][2] + e.numberOfStandardDeviations * l[v][3], m[v] < l[v][0] && (m[v] = l[v][0]), f[v] > l[v][1] && (f[v] = l[v][1]);\n\n        break;\n\n      case \"histogramEqualization\":\n        for (v = 0; v < p; v++) m[v] = u[v].min, f[v] = u[v].max;\n\n        break;\n\n      case \"percentClip\":\n        for (v = 0; v < u.length; v++) {\n          for (d = u[v], k = new Uint32Array(d.size), y = d.counts, x = 0, b = (d.max - d.min) / d.size, O = -.5 === d.min && 1 === b ? .5 : 0, L = 0; L < d.size; L++) x += y[L], k[L] = x;\n\n          for (C = e.minPercent * x / 100, L = 0; L < d.size; L++) if (k[L] > C) {\n            m[v] = d.min + b * (L + O);\n            break;\n          }\n\n          for (C = (1 - e.maxPercent / 100) * x, L = d.size - 2; L >= 0; L--) if (k[L] < C) {\n            f[v] = d.min + b * (L + 2 - O);\n            break;\n          }\n        }\n\n        break;\n\n      default:\n        for (v = 0; v < p; v++) m[v] = l[v][0], f[v] = l[v][1];\n\n    }\n\n    \"histogramEqualization\" === c ? (N = u[0].size || 256, _ = 0, s && (J = u.map(e => g(e)))) : (N = e.max || 255, _ = e.min || 0);\n    const I = {\n      minCutOff: m,\n      maxCutOff: f,\n      outMax: N,\n      outMin: _,\n      histogramLut: J\n    };\n    return this.getSelectedBandCutoffs(I, r);\n  }\n\n  getSelectedBandCutoffs(e, t) {\n    if (null == t || 0 === t.length) return e;\n    const r = Math.max.apply(null, t),\n          {\n      minCutOff: s,\n      maxCutOff: o,\n      outMin: i,\n      outMax: a,\n      histogramLut: n\n    } = e;\n    return s.length === t.length || s.length <= r ? e : {\n      minCutOff: t.map(e => s[e]),\n      maxCutOff: t.map(e => o[e]),\n      histogramLut: n ? t.map(e => n[e]) : null,\n      outMin: i,\n      outMax: a\n    };\n  }\n\n  generateStretchWebGLParams(e, t, r) {\n    var s;\n    let o = null,\n        i = null;\n    const a = this.lookup && this.lookup.colormapLut;\n    t.colorRamp && a && (o = a.indexedColormap, i = a.offset), \"histogramEqualization\" === t.stretchType && (t = { ...t,\n      stretchType: \"minMax\"\n    });\n    const {\n      gamma: n\n    } = t,\n          l = !!(t.useGamma && n && n.some(e => 1 !== e)),\n          {\n      minCutOff: u,\n      maxCutOff: c,\n      outMin: h,\n      outMax: p\n    } = this.getStretchCutoff(t, e, r),\n          m = null == (s = e) ? void 0 : s.getPlaneCount();\n    2 === m && ((e = e.clone()).statistics = [e.statistics[0]], e.pixels = [e.pixels[0]]);\n    const f = Math.min(3, (null == r ? void 0 : r.length) || m || this.rasterInfo.bandCount),\n          d = new Float32Array(f),\n          g = o || l ? 1 : 255;\n    let S;\n\n    for (S = 0; S < f; S++) d[S] = (p - h) / (c[S] - u[S]) / g;\n\n    const b = new Float32Array(f);\n    if (l) for (S = 0; S < f; S++) n[S] > 1 ? n[S] > 2 ? b[S] = 6.5 + (n[S] - 2) ** 2.5 : b[S] = 6.5 + 100 * (2 - n[S]) ** 4 : b[S] = 1;\n    return {\n      bandCount: f,\n      outMin: h / g,\n      outMax: p / g,\n      minCutOff: u,\n      maxCutOff: c,\n      factor: d,\n      useGamma: l,\n      gamma: l ? n : [1, 1, 1],\n      gammaCorrection: l ? b : [1, 1, 1],\n      colormap: o,\n      colormapOffset: i,\n      type: \"stretch\"\n    };\n  }\n\n  generateShadedReliefWebGLParams(e, t, r) {\n    var s, i, a;\n    let n = null,\n        l = null;\n    const u = this.lookup && this.lookup.colormapLut;\n    e.colorRamp && u && (n = u.indexedColormap, l = u.offset);\n    const c = { ...e,\n      isGCS: t,\n      resolution: r\n    },\n          h = y(c),\n          p = null == (s = o(this.rasterInfo.statistics)) ? void 0 : s[0];\n    return { ...h,\n      minValue: null != (i = null == p ? void 0 : p.min) ? i : 0,\n      maxValue: null != (a = null == p ? void 0 : p.max) ? a : 8e3,\n      hillshadeType: \"traditional\" === e.hillshadeType ? 0 : 1,\n      type: \"hillshade\",\n      colormap: n,\n      colormapOffset: l\n    };\n  }\n\n  isValidPixelBlock(e) {\n    return !!(e && e.pixels && e.pixels.length > 0 && 0 !== e.validPixelCount);\n  }\n\n};\n\ne([a({\n  json: {\n    write: !0\n  }\n})], _.prototype, \"rendererJSON\", void 0), e([a({\n  type: l,\n  json: {\n    write: !0\n  }\n})], _.prototype, \"rasterInfo\", void 0), e([a({\n  json: {\n    write: !0\n  }\n})], _.prototype, \"lookup\", void 0), e([a()], _.prototype, \"canRenderInWebGL\", void 0), _ = e([n(\"esri.renderers.support.RasterSymbolizer\")], _);\nvar N = _;\nexport default N;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/renderers/support/RasterSymbolizer.js"],"names":["_","e","toHSV","t","JSONSupport","r","s","unwrap","o","isSome","i","property","a","subclass","n","l","extractBands","u","stretch","c","colorize","h","remapColor","p","lookupPixels","m","createStretchLUT","f","createColormapLUT","d","createHistogramEqualizationLUT","g","estimateStatisticsHistograms","S","hillshade","b","tintHillshade","x","calculateHillshadeParams","y","convertColorRampToColormap","k","C","getLogger","O","attributeTable","bandCount","fields","find","name","toLowerCase","v","dataType","L","colormap","length","R","u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64","Number","MAX_VALUE","constructor","bind","rendererJSON","lookup","type","_updateUVRenderer","_updateColormapRenderer","_updateStretchRenderer","_updateClassBreaksRenderer","_updateShadedReliefRenderer","symbolize","pixelBlock","isValidPixelBlock","simpleStretchParams","simpleStretch","pixels","_symbolize_colormap","_symbolize_classBreaks","_symbolize_stretch","bandIds","extent","spatialReference","isGeographic","xmax","xmin","width","ymax","ymin","height","_symbolize_shadedRelief","isGCS","resolution","error","message","generateWebGLParameters","indexOf","indexedColormap","offset","colormapLut","colormapOffset","generateStretchWebGLParams","generateShadedReliefWebGLParams","_isLUTChanged","colorRamp","JSON","stringify","rasterInfo","pixelType","remapLut","dra","useGamma","gamma","stretchType","histogramLut","getStretchCutoff","lut","stretchLut","map","hsvMap","statistics","min","max","field1","includes","filter","features","forEach","uniqueValueInfos","String","value","attributes","symbol","color","push","concat","parseInt","canRenderInWebGL","colormapInfos","sort","classBreakInfos","classMaxValue","minValue","classMinValue","mappedColor","Math","floor","ceil","fillUnspecified","_isHistogramRequired","_isValidRasterStatistics","histograms","maxValue","N","J","Array","isArray","avg","stddev","numberOfStandardDeviations","Uint32Array","size","counts","minPercent","maxPercent","I","minCutOff","maxCutOff","outMax","outMin","getSelectedBandCutoffs","apply","some","getPlaneCount","clone","Float32Array","factor","gammaCorrection","hillshadeType","validPixelCount","json","write","prototype"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{toHSV as t}from\"../../core/colorUtils.js\";import{JSONSupport as r}from\"../../core/JSONSupport.js\";import s from\"../../core/Logger.js\";import{unwrap as o,isSome as i}from\"../../core/maybe.js\";import{property as a}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../core/accessorSupport/decorators/subclass.js\";import l from\"../../layers/support/RasterInfo.js\";import{extractBands as u,stretch as c,colorize as h,remapColor as p,lookupPixels as m,createStretchLUT as f,createColormapLUT as d,createHistogramEqualizationLUT as g,estimateStatisticsHistograms as S}from\"../../layers/support/rasterFunctions/pixelUtils.js\";import{hillshade as b,tintHillshade as x,calculateHillshadeParams as y}from\"../../layers/support/rasterFunctions/surfaceUtils.js\";import{convertColorRampToColormap as k}from\"./colorRampUtils.js\";const C=s.getLogger(\"esri.renderers.support.RasterSymbolizer\");function O(e,t){const{attributeTable:r,bandCount:s}=e;if(!i(r)||s>1)return!1;if(t){if(null==r.fields.find((e=>e.name.toLowerCase()===t.toLowerCase())))return!1}return!0}function v(e){return\"elevation\"===e.dataType}function L(e){const{bandCount:t,colormap:r}=e;return i(r)&&r.length&&1===t}const R={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};let _=class extends r{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return!1;let t;switch(this.lookup={rendererJSON:{}},e.type){case\"uniqueValue\":t=this._updateUVRenderer(e);break;case\"rasterColormap\":t=this._updateColormapRenderer(e);break;case\"rasterStretch\":t=this._updateStretchRenderer(e);break;case\"classBreaks\":t=this._updateClassBreaksRenderer(e);break;case\"rasterShadedRelief\":t=this._updateShadedReliefRenderer(e)}return t}symbolize(e){let t=e&&e.pixelBlock;if(!this.isValidPixelBlock(t))return t;if(e.simpleStretchParams&&\"rasterStretch\"===this.rendererJSON.type)return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=u(t,[0,1,2])),this.rendererJSON.type){case\"uniqueValue\":case\"rasterColormap\":r=this._symbolize_colormap(t);break;case\"classBreaks\":r=this._symbolize_classBreaks(t);break;case\"rasterStretch\":r=this._symbolize_stretch(t,e.bandIds);break;case\"rasterShadedRelief\":{const{extent:s}=e,o=s.spatialReference.isGeographic,i={x:(s.xmax-s.xmin)/t.width,y:(s.ymax-s.ymin)/t.height};r=this._symbolize_shadedRelief(t,{isGCS:o,resolution:i});break}}return r}catch(r){return C.error(\"symbolize\",r.message),t}}simpleStretch(e,t){if(!this.isValidPixelBlock(e))return e;try{return e.pixels.length>3&&(e=u(e,[0,1,2])),c(e,t)}catch(r){return C.error(\"symbolize\",r.message),e}}generateWebGLParameters(e){if([\"uniqueValue\",\"rasterColormap\",\"classBreaks\"].indexOf(this.rendererJSON.type)>-1){var t;const{indexedColormap:e,offset:r}=(null==(t=this.lookup)?void 0:t.colormapLut)||{};return{colormap:e,colormapOffset:r,type:\"lut\"}}const{pixelBlock:r,isGCS:s,resolution:o,bandIds:i}=e,{rendererJSON:a}=this;return\"rasterStretch\"===a.type?this.generateStretchWebGLParams(r,a,i):\"rasterShadedRelief\"===a.type?this.generateShadedReliefWebGLParams(a,s,o):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if(\"colorRamp\"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolize_colormap(e){if(this._isLUTChanged()){if(!this.bind())return e}return h(e,this.lookup.colormapLut)}_symbolize_classBreaks(e){const t=this.rasterInfo.pixelType,r=[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(t)>-1;let s;if(this._isLUTChanged()){if(!this.bind())return e}return s=r?h(e,this.lookup.colormapLut):p(e,this.lookup.remapLut),s}_symbolize_stretch(e,t){const{pixelType:r,bandCount:s}=this.rasterInfo,o=this.rendererJSON,i=[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(r)>-1;let a,n;const{dra:l}=o,u=o.useGamma?o.gamma:null;if(\"histogramEqualization\"===o.stretchType){const r=l?null:this.lookup.histogramLut,s=this.getStretchCutoff(o,e,t,!r),i=c(e,{...s,gamma:u});n=m(i,{lut:l?s.histogramLut:r,offset:0})}else if(i){var p;if(l){const s=this.getStretchCutoff(o,e,t);a=f({pixelType:r,...s,gamma:u})}else if(this._isLUTChanged()){if(!this.bind())return e;a=this.lookup?this.lookup.stretchLut:null}else a=this.lookup?this.lookup.stretchLut:null;if(!a)return e;s>1&&(null==t?void 0:t.length)===e.pixels.length&&(null==(p=a)?void 0:p.lut.length)===s&&(a={lut:t.map((e=>a.lut[e])),offset:a.offset}),n=m(e,a)}else{const r=this.getStretchCutoff(o,e,t);n=c(e,{...r,gamma:u})}if(o.colorRamp){if(this._isLUTChanged(!0)){if(!this.bind())return e}n=h(n,this.lookup.colormapLut)}return n}_symbolize_shadedRelief(e,t){var r,s;const i=this.rendererJSON,a={...i,...t},n=b(e,a);if(!i.colorRamp)return n;let l;if(this._isLUTChanged(!0)){if(!this.bind())return n;l=this.lookup?this.lookup.hsvMap:null}else l=this.lookup?this.lookup.hsvMap:null;if(!l)return n;const u=null!=(r=null==(s=o(this.rasterInfo.statistics))?void 0:s[0])?r:{min:0,max:8e3};return x(n,e,l,u),n}_updateUVRenderer(e){const{bandCount:t,attributeTable:r,pixelType:s}=this.rasterInfo,o=e.field1;if(!o)return!1;const i=1===t&&[\"u8\",\"s8\"].includes(s);if(!O(this.rasterInfo,o)&&!i)return!1;const a=[];if(r){const t=r.fields.filter((e=>\"value\"===e.name.toLowerCase()))[0];if(!t)return!1;r.features.forEach((r=>{var s;const i=e.uniqueValueInfos.filter((e=>String(e.value)===String(r.attributes[o])))[0],n=null==i||null==(s=i.symbol)?void 0:s.color;n&&a.push([r.attributes[t.name]].concat(n))}))}else{if(\"value\"!==o.toLowerCase())return!1;e.uniqueValueInfos.forEach((e=>{var t;const r=null==e||null==(t=e.symbol)?void 0:t.color;r&&a.push([parseInt(\"\"+e.value,10)].concat(r))}))}if(0===a.length)return!1;const n=d({colormap:a});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=!0,!0}_updateColormapRenderer(e){if(!L(this.rasterInfo))return!1;const t=e.colormapInfos.map((e=>[e.value].concat(e.color))).sort(((e,t)=>e[0]-t[0]));if(!t||0===t.length)return!1;const r=d({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,!0}_updateShadedReliefRenderer(e){if(!v(this.rasterInfo))return!1;if(e.colorRamp){const r=k(e.colorRamp,256,!0),s=d({colormap:r}),o=[],i=s.indexedColormap;for(let e=0;e<i.length;e+=4){const r=t({r:i[e],g:i[e+1],b:i[e+2]});o.push([r.h/60,r.s/100,255*r.v/100])}this.lookup={rendererJSON:e,colormapLut:s,hsvMap:o}}else this.lookup=null;return this.canRenderInWebGL=!0,!0}_updateClassBreaksRenderer(e){const t=this.rasterInfo.pixelType,r=[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(t)>-1,s=e.classBreakInfos;if(null==s||!s.length)return!1;const o=s.sort(((e,t)=>e.classMaxValue-t.classMaxValue)),i=o[o.length-1];let a=e.minValue;if(!r){const t=[];for(let e=0;e<o.length;e++){var n;t.push({value:null!=(n=o[e].classMinValue)?n:a,mappedColor:o[e].symbol.color}),a=o[e].classMaxValue}return t.push({value:i.classMaxValue,mappedColor:i.symbol.color}),this.lookup={rendererJSON:e,remapLut:t},this.canRenderInWebGL=!1,!0}const l=[];a=Math.floor(e.minValue);for(let c=0;c<o.length;c++){const e=o[c];for(let t=a;t<e.classMaxValue;t++)l.push([t].concat(e.symbol.color));a=Math.ceil(e.classMaxValue)}i.classMaxValue===a&&l.push([i.classMaxValue].concat(i.symbol.color));const u=d({colormap:l,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:u},this.canRenderInWebGL=!0,!0}_isHistogramRequired(e){return\"percentClip\"===e||\"histogramEqualization\"===e}_isValidRasterStatistics(e){return i(e)&&e.length>0&&null!=e[0].min&&null!=e[0].max}_updateStretchRenderer(e){var t;let{stretchType:r,dra:s}=e;if(!(\"none\"===r||null!=(t=e.statistics)&&t.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||s))return!1;const i=o(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||null!=i&&i.length||s||(r=\"minMax\");const{gamma:a,useGamma:n,colorRamp:l}=e,u=this.rasterInfo.pixelType,c=!s&&[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(u)>-1;if(\"histogramEqualization\"===r){const t=i.map((e=>g(e)));this.lookup={rendererJSON:e,histogramLut:t}}else if(c){const t=this.getStretchCutoff(e),r=f({pixelType:u,...t,gamma:n?a:null});this.lookup={rendererJSON:e,stretchLut:r}}if(l){const t=k(l,256,!0);this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=d({colormap:t}),this.lookup.rendererJSON=e}return this.canRenderInWebGL=!0,!0}getStretchCutoff(e,t,r,s){var i,a,n;let l,u,c=e.stretchType;var h;if(e.dra)if(\"minMax\"===c&&t.statistics)l=t.statistics.map((e=>[e.minValue,e.maxValue,0,0]));else{const e=S(t);l=e.statistics,u=e.histograms}else l=(null==(h=e.statistics)?void 0:h.length)>0?e.statistics:o(this.rasterInfo.statistics),u=e.histograms||o(this.rasterInfo.histograms);!this._isHistogramRequired(c)||null!=(i=u)&&i.length||(c=\"minMax\");const p=(null==(a=l)?void 0:a.length)||(null==(n=u)?void 0:n.length)||this.rasterInfo.bandCount,m=[],f=[];let d,b,x,y,k,C,O,v,L,_,N,J;switch(l&&!Array.isArray(l[0])&&(l=l.map((e=>[e.min,e.max,e.avg,e.stddev]))),c){case\"none\":{const e=R[this.rasterInfo.pixelType]||R.f32;for(v=0;v<p;v++)m[v]=e[0],f[v]=e[1]}break;case\"minMax\":for(v=0;v<p;v++)m[v]=l[v][0],f[v]=l[v][1];break;case\"standardDeviation\":for(v=0;v<p;v++)m[v]=l[v][2]-e.numberOfStandardDeviations*l[v][3],f[v]=l[v][2]+e.numberOfStandardDeviations*l[v][3],m[v]<l[v][0]&&(m[v]=l[v][0]),f[v]>l[v][1]&&(f[v]=l[v][1]);break;case\"histogramEqualization\":for(v=0;v<p;v++)m[v]=u[v].min,f[v]=u[v].max;break;case\"percentClip\":for(v=0;v<u.length;v++){for(d=u[v],k=new Uint32Array(d.size),y=d.counts,x=0,b=(d.max-d.min)/d.size,O=-.5===d.min&&1===b?.5:0,L=0;L<d.size;L++)x+=y[L],k[L]=x;for(C=e.minPercent*x/100,L=0;L<d.size;L++)if(k[L]>C){m[v]=d.min+b*(L+O);break}for(C=(1-e.maxPercent/100)*x,L=d.size-2;L>=0;L--)if(k[L]<C){f[v]=d.min+b*(L+2-O);break}}break;default:for(v=0;v<p;v++)m[v]=l[v][0],f[v]=l[v][1]}\"histogramEqualization\"===c?(N=u[0].size||256,_=0,s&&(J=u.map((e=>g(e))))):(N=e.max||255,_=e.min||0);const I={minCutOff:m,maxCutOff:f,outMax:N,outMin:_,histogramLut:J};return this.getSelectedBandCutoffs(I,r)}getSelectedBandCutoffs(e,t){if(null==t||0===t.length)return e;const r=Math.max.apply(null,t),{minCutOff:s,maxCutOff:o,outMin:i,outMax:a,histogramLut:n}=e;return s.length===t.length||s.length<=r?e:{minCutOff:t.map((e=>s[e])),maxCutOff:t.map((e=>o[e])),histogramLut:n?t.map((e=>n[e])):null,outMin:i,outMax:a}}generateStretchWebGLParams(e,t,r){var s;let o=null,i=null;const a=this.lookup&&this.lookup.colormapLut;t.colorRamp&&a&&(o=a.indexedColormap,i=a.offset),\"histogramEqualization\"===t.stretchType&&(t={...t,stretchType:\"minMax\"});const{gamma:n}=t,l=!!(t.useGamma&&n&&n.some((e=>1!==e))),{minCutOff:u,maxCutOff:c,outMin:h,outMax:p}=this.getStretchCutoff(t,e,r),m=null==(s=e)?void 0:s.getPlaneCount();2===m&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]);const f=Math.min(3,(null==r?void 0:r.length)||m||this.rasterInfo.bandCount),d=new Float32Array(f),g=o||l?1:255;let S;for(S=0;S<f;S++)d[S]=(p-h)/(c[S]-u[S])/g;const b=new Float32Array(f);if(l)for(S=0;S<f;S++)n[S]>1?n[S]>2?b[S]=6.5+(n[S]-2)**2.5:b[S]=6.5+100*(2-n[S])**4:b[S]=1;return{bandCount:f,outMin:h/g,outMax:p/g,minCutOff:u,maxCutOff:c,factor:d,useGamma:l,gamma:l?n:[1,1,1],gammaCorrection:l?b:[1,1,1],colormap:o,colormapOffset:i,type:\"stretch\"}}generateShadedReliefWebGLParams(e,t,r){var s,i,a;let n=null,l=null;const u=this.lookup&&this.lookup.colormapLut;e.colorRamp&&u&&(n=u.indexedColormap,l=u.offset);const c={...e,isGCS:t,resolution:r},h=y(c),p=null==(s=o(this.rasterInfo.statistics))?void 0:s[0];return{...h,minValue:null!=(i=null==p?void 0:p.min)?i:0,maxValue:null!=(a=null==p?void 0:p.max)?a:8e3,hillshadeType:\"traditional\"===e.hillshadeType?0:1,type:\"hillshade\",colormap:n,colormapOffset:l}}isValidPixelBlock(e){return!!(e&&e.pixels&&e.pixels.length>0&&0!==e.validPixelCount)}};e([a({json:{write:!0}})],_.prototype,\"rendererJSON\",void 0),e([a({type:l,json:{write:!0}})],_.prototype,\"rasterInfo\",void 0),e([a({json:{write:!0}})],_.prototype,\"lookup\",void 0),e([a()],_.prototype,\"canRenderInWebGL\",void 0),_=e([n(\"esri.renderers.support.RasterSymbolizer\")],_);var N=_;export default N;\n"]},"metadata":{},"sourceType":"module"}