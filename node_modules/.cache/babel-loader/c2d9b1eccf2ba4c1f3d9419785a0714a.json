{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../../chunks/tslib.es6.js\";\nimport i from \"../../../../../core/has.js\";\nimport { createScreenPointArray as e } from \"../../../../../core/screenUtils.js\";\nimport { property as r } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as s } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { c as a } from \"../../../../../chunks/vec2.js\";\nimport { a as n } from \"../../../../../chunks/vec2f64.js\";\nimport { n as o, a as c, b as h, f as m, l as p } from \"../../../../../chunks/vec3.js\";\nimport { c as l } from \"../../../../../chunks/vec3f64.js\";\nimport { getReferenceEllipsoid as u } from \"../../../../../geometry/projectionEllipsoid.js\";\nimport { create as y, fromPoints as C } from \"../../../../../geometry/support/axisAngle.js\";\nimport { c as P } from \"../../../../../chunks/sphere.js\";\nimport { pixelDistanceToInteractionFactor as f, applyAll as d } from \"../../../camera/constraintUtils.js\";\nimport { InteractiveController as g } from \"../InteractiveController.js\";\nimport { normalizeCoordinate as v, pickPointAndInitSphere as j, decideNavigationMode as R, NavigationMode as k, sphereOrPlanePointFromScreenPoint as w, applyRotation as D } from \"../../utils/navigationUtils.js\";\nimport { fromScreenAtEye as A } from \"../../../support/geometryUtils/ray.js\";\nimport { applySurfaceCollisionConstraint as b } from \"../../../camera/constraintUtils/surfaceCollision.js\";\nconst x = 30,\n      M = 70;\nlet O = class extends g {\n  constructor(t) {\n    super(t), this.view = null, this.pickPoint = l(), this.tmpP0 = n(), this.panAxisAngle = y(), this.tmpRayDir = l(), this.targetOnSphere = l(), this.tmpRay = {\n      origin: l(),\n      direction: l()\n    }, this.dragBeginPoint = e(), this.normalizedAnchorPoint = n(), this.constraintOptions = {\n      selection: 7,\n      interactionType: 1,\n      interactionFactor: 0,\n      interactionStartCamera: null,\n      interactionDirection: null,\n      tiltMode: 0\n    }, this.sphere = P(), this.hasPickPoint = !1;\n  }\n\n  get intersectionHelper() {\n    return this.view.sceneIntersectionHelper;\n  }\n\n  begin(t) {\n    if (!this.active) return;\n    a(this.dragBeginPoint, t), v(this.startCamera, t, this.normalizedAnchorPoint);\n    const e = u(this.view.spatialReference),\n          r = j(this.intersectionHelper, this.startCamera, t, !1, e);\n    if (this.navMode = R(this.startCamera, t, r.hasGeometryIntersection, e), this.navMode === k.Horizontal || i(\"disable-feature:context-navigation\")) this.hasPickPoint = !!r.scenePickPoint, this.pickPoint = r.scenePickPoint, this.sphere = r.sphere;else {\n      let i;\n      A(this.startCamera, t, this.tmpRay), o(this.tmpRay.direction, this.tmpRay.direction), this.view.camera.position.hasZ && (i = Math.abs(this.view.camera.position.z));\n      let e = x * i;\n\n      const r = this.view._stage.renderView.getMinimalDepthForArea(t[0], t[1], this.view.state.camera, M);\n\n      e = e > r ? r : e, this.hasPickPoint = !0, c(this.tmpRay.direction, this.tmpRay.direction, e), h(this.pickPoint, this.tmpRay.origin, this.tmpRay.direction);\n    }\n    this.constraintOptions.interactionStartCamera = this.startCamera;\n  }\n\n  update(t) {\n    if (this.active) {\n      if (this.currentCamera.eye = this.startCamera.eye, this.currentCamera.center = this.startCamera.center, this.currentCamera.up = this.startCamera.up, this.navMode === k.Horizontal || i(\"disable-feature:context-navigation\")) {\n        m(this.tmpRayDir, this.currentCamera.center, this.currentCamera.eye);\n        const i = p(this.tmpRayDir);\n        v(this.currentCamera, t, this.tmpP0);\n        const e = 12 * (this.normalizedAnchorPoint[1] - this.tmpP0[1]);\n        let r = i * 2 ** e;\n        const s = this.view.state.constraints.minimumPoiDistance;\n        if (e < 0 && r < s && (r = s), Math.abs(i - r) < 1e-6) return;\n\n        if (this.hasPickPoint && r < i) {\n          const t = 1 - (1 - r / i) * (1 - this.sphere[3] / p(this.currentCamera.center));\n          this.currentCamera.center = c(S, this.currentCamera.center, t);\n        }\n\n        c(this.tmpRayDir, this.tmpRayDir, -r / i), this.currentCamera.eye = h(S, this.currentCamera.center, this.tmpRayDir), this.constraintOptions.interactionFactor = f(this.dragBeginPoint, t), d(this.view, this.currentCamera, this.constraintOptions), this.hasPickPoint && (w(this.sphere, this.currentCamera, this.dragBeginPoint, this.targetOnSphere), C(this.pickPoint, this.targetOnSphere, this.panAxisAngle), D(this.currentCamera, this.sphere, this.panAxisAngle));\n      } else {\n        const i = p(this.tmpRay.direction);\n        v(this.currentCamera, t, this.tmpP0);\n        const e = 12 * (this.normalizedAnchorPoint[1] - this.tmpP0[1]);\n        let r = i * 2 ** e;\n        const s = this.view.state.constraints.minimumPoiDistance;\n        if (e < 0 && r < s && (r = s), Math.abs(i - r) < 1e-6) return;\n        c(this.tmpRayDir, this.tmpRay.direction, 1 - r / i), this.currentCamera.eye = h(S, this.currentCamera.eye, this.tmpRayDir), this.currentCamera.center = h(S, this.currentCamera.center, this.tmpRayDir);\n      }\n\n      b(this.view, this.currentCamera);\n    }\n  }\n\n  end() {\n    this.active && this.finishController();\n  }\n\n};\nt([r({\n  constructOnly: !0\n})], O.prototype, \"view\", void 0), O = t([s(\"esri.views.3d.state.controllers.global.ZoomController\")], O);\nconst S = l();\nexport { O as ZoomController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/state/controllers/global/ZoomController.js"],"names":["_","t","i","createScreenPointArray","e","property","r","subclass","s","c","a","n","o","b","h","f","m","l","p","getReferenceEllipsoid","u","create","y","fromPoints","C","P","pixelDistanceToInteractionFactor","applyAll","d","InteractiveController","g","normalizeCoordinate","v","pickPointAndInitSphere","j","decideNavigationMode","R","NavigationMode","k","sphereOrPlanePointFromScreenPoint","w","applyRotation","D","fromScreenAtEye","A","applySurfaceCollisionConstraint","x","M","O","constructor","view","pickPoint","tmpP0","panAxisAngle","tmpRayDir","targetOnSphere","tmpRay","origin","direction","dragBeginPoint","normalizedAnchorPoint","constraintOptions","selection","interactionType","interactionFactor","interactionStartCamera","interactionDirection","tiltMode","sphere","hasPickPoint","intersectionHelper","sceneIntersectionHelper","begin","active","startCamera","spatialReference","navMode","hasGeometryIntersection","Horizontal","scenePickPoint","camera","position","hasZ","Math","abs","z","_stage","renderView","getMinimalDepthForArea","state","update","currentCamera","eye","center","up","constraints","minimumPoiDistance","S","end","finishController","constructOnly","prototype","ZoomController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../../chunks/tslib.es6.js\";import i from\"../../../../../core/has.js\";import{createScreenPointArray as e}from\"../../../../../core/screenUtils.js\";import{property as r}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as s}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{c as a}from\"../../../../../chunks/vec2.js\";import{a as n}from\"../../../../../chunks/vec2f64.js\";import{n as o,a as c,b as h,f as m,l as p}from\"../../../../../chunks/vec3.js\";import{c as l}from\"../../../../../chunks/vec3f64.js\";import{getReferenceEllipsoid as u}from\"../../../../../geometry/projectionEllipsoid.js\";import{create as y,fromPoints as C}from\"../../../../../geometry/support/axisAngle.js\";import{c as P}from\"../../../../../chunks/sphere.js\";import{pixelDistanceToInteractionFactor as f,applyAll as d}from\"../../../camera/constraintUtils.js\";import{InteractiveController as g}from\"../InteractiveController.js\";import{normalizeCoordinate as v,pickPointAndInitSphere as j,decideNavigationMode as R,NavigationMode as k,sphereOrPlanePointFromScreenPoint as w,applyRotation as D}from\"../../utils/navigationUtils.js\";import{fromScreenAtEye as A}from\"../../../support/geometryUtils/ray.js\";import{applySurfaceCollisionConstraint as b}from\"../../../camera/constraintUtils/surfaceCollision.js\";const x=30,M=70;let O=class extends g{constructor(t){super(t),this.view=null,this.pickPoint=l(),this.tmpP0=n(),this.panAxisAngle=y(),this.tmpRayDir=l(),this.targetOnSphere=l(),this.tmpRay={origin:l(),direction:l()},this.dragBeginPoint=e(),this.normalizedAnchorPoint=n(),this.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},this.sphere=P(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;a(this.dragBeginPoint,t),v(this.startCamera,t,this.normalizedAnchorPoint);const e=u(this.view.spatialReference),r=j(this.intersectionHelper,this.startCamera,t,!1,e);if(this.navMode=R(this.startCamera,t,r.hasGeometryIntersection,e),this.navMode===k.Horizontal||i(\"disable-feature:context-navigation\"))this.hasPickPoint=!!r.scenePickPoint,this.pickPoint=r.scenePickPoint,this.sphere=r.sphere;else{let i;A(this.startCamera,t,this.tmpRay),o(this.tmpRay.direction,this.tmpRay.direction),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let e=x*i;const r=this.view._stage.renderView.getMinimalDepthForArea(t[0],t[1],this.view.state.camera,M);e=e>r?r:e,this.hasPickPoint=!0,c(this.tmpRay.direction,this.tmpRay.direction,e),h(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(t){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===k.Horizontal||i(\"disable-feature:context-navigation\")){m(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=p(this.tmpRayDir);v(this.currentCamera,t,this.tmpP0);const e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=i*2**e;const s=this.view.state.constraints.minimumPoiDistance;if(e<0&&r<s&&(r=s),Math.abs(i-r)<1e-6)return;if(this.hasPickPoint&&r<i){const t=1-(1-r/i)*(1-this.sphere[3]/p(this.currentCamera.center));this.currentCamera.center=c(S,this.currentCamera.center,t)}c(this.tmpRayDir,this.tmpRayDir,-r/i),this.currentCamera.eye=h(S,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=f(this.dragBeginPoint,t),d(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(w(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),C(this.pickPoint,this.targetOnSphere,this.panAxisAngle),D(this.currentCamera,this.sphere,this.panAxisAngle))}else{const i=p(this.tmpRay.direction);v(this.currentCamera,t,this.tmpP0);const e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=i*2**e;const s=this.view.state.constraints.minimumPoiDistance;if(e<0&&r<s&&(r=s),Math.abs(i-r)<1e-6)return;c(this.tmpRayDir,this.tmpRay.direction,1-r/i),this.currentCamera.eye=h(S,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=h(S,this.currentCamera.center,this.tmpRayDir)}b(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};t([r({constructOnly:!0})],O.prototype,\"view\",void 0),O=t([s(\"esri.views.3d.state.controllers.global.ZoomController\")],O);const S=l();export{O as ZoomController};\n"]},"metadata":{},"sourceType":"module"}