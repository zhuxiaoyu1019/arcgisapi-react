{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { range as e } from \"../../../../../core/arrayUtils.js\";\nimport { deg2rad as t, acosClamped as n } from \"../../../../../core/mathUtils.js\";\nimport { forEach as o } from \"../../../../../core/typedArrayUtil.js\";\nimport { i as r, s, g as c, d as a, r as i, c as l, f as g, n as f } from \"../../../../../chunks/vec3.js\";\nimport { c as m } from \"../../../../../chunks/vec3f64.js\";\nconst p = -1;\n\nfunction u(n, i, l, g = V) {\n  const f = n.vertices.position,\n        m = n.vertices.componentIndex,\n        u = t(g.anglePlanar),\n        I = t(g.angleSignificantEdge),\n        N = Math.cos(I),\n        j = Math.cos(u),\n        x = y.edge,\n        F = x.position0,\n        E = x.position1,\n        U = x.faceNormal0,\n        k = x.faceNormal1,\n        D = w(n),\n        M = v(n),\n        P = M.length / 4,\n        S = i.allocate(P);\n  let b = 0;\n  const L = P,\n        q = l.allocate(L);\n  let z = 0,\n      B = 0,\n      C = 0;\n  const G = e(0, P),\n        H = new Float32Array(P);\n  o(H, (e, t, n) => {\n    f.getVec(M[4 * t + 0], F), f.getVec(M[4 * t + 1], E), n[t] = r(F, E);\n  }), G.sort((e, t) => H[t] - H[e]);\n  const J = new Array(),\n        K = new Array();\n\n  for (let e = 0; e < P; e++) {\n    const t = G[e],\n          n = H[t],\n          o = M[4 * t + 0],\n          r = M[4 * t + 1],\n          g = M[4 * t + 2],\n          v = M[4 * t + 3],\n          w = v === p;\n    if (f.getVec(o, F), f.getVec(r, E), w) s(U, D[3 * g + 0], D[3 * g + 1], D[3 * g + 2]), c(k, U), x.componentIndex = m.get(o), x.cosAngle = a(U, k);else {\n      if (s(U, D[3 * g + 0], D[3 * g + 1], D[3 * g + 2]), s(k, D[3 * v + 0], D[3 * v + 1], D[3 * v + 2]), x.componentIndex = m.get(o), x.cosAngle = a(U, k), d(x, j)) continue;\n      x.cosAngle < -.9999 && c(k, U);\n    }\n    B += n, C++, w || h(x, N) ? (i.write(S, b++, x), J.push(n)) : A(x, u) && (l.write(q, z++, x), K.push(n));\n  }\n\n  const O = new Float32Array(J.reverse()),\n        Q = new Float32Array(K.reverse());\n  return {\n    regular: {\n      instancesData: i.trim(S, b),\n      lodInfo: {\n        lengths: O\n      }\n    },\n    silhouette: {\n      instancesData: l.trim(q, z),\n      lodInfo: {\n        lengths: Q\n      }\n    },\n    averageEdgeLength: B / C\n  };\n}\n\nfunction h(e, t) {\n  return e.cosAngle < t;\n}\n\nfunction d(e, t) {\n  return e.cosAngle > t;\n}\n\nfunction A(e, t) {\n  const o = n(e.cosAngle),\n        r = y.fwd,\n        s = y.ortho;\n  i(r, e.position1, e.position0);\n  return o * (a(l(s, e.faceNormal0, e.faceNormal1), r) > 0 ? -1 : 1) > t;\n}\n\nfunction v(e) {\n  const t = e.faces.length / 3,\n        n = e.faces,\n        o = e.neighbors;\n  let r = 0;\n\n  for (let a = 0; a < t; a++) {\n    const e = o[3 * a + 0],\n          t = o[3 * a + 1],\n          s = o[3 * a + 2],\n          c = n[3 * a + 0],\n          i = n[3 * a + 1],\n          l = n[3 * a + 2];\n    r += e === p || c < i ? 1 : 0, r += t === p || i < l ? 1 : 0, r += s === p || l < c ? 1 : 0;\n  }\n\n  const s = new Int32Array(4 * r);\n  let c = 0;\n\n  for (let a = 0; a < t; a++) {\n    const e = o[3 * a + 0],\n          t = o[3 * a + 1],\n          r = o[3 * a + 2],\n          i = n[3 * a + 0],\n          l = n[3 * a + 1],\n          g = n[3 * a + 2];\n    (e === p || i < l) && (s[c++] = i, s[c++] = l, s[c++] = a, s[c++] = e), (t === p || l < g) && (s[c++] = l, s[c++] = g, s[c++] = a, s[c++] = t), (r === p || g < i) && (s[c++] = g, s[c++] = i, s[c++] = a, s[c++] = r);\n  }\n\n  return s;\n}\n\nfunction w(e) {\n  const t = e.faces.length / 3,\n        n = e.vertices.position,\n        o = e.faces,\n        r = I.v0,\n        s = I.v1,\n        c = I.v2,\n        a = new Float32Array(3 * t);\n\n  for (let i = 0; i < t; i++) {\n    const e = o[3 * i + 0],\n          t = o[3 * i + 1],\n          m = o[3 * i + 2];\n    n.getVec(e, r), n.getVec(t, s), n.getVec(m, c), g(s, s, r), g(c, c, r), l(r, s, c), f(r, r), a[3 * i + 0] = r[0], a[3 * i + 1] = r[1], a[3 * i + 2] = r[2];\n  }\n\n  return a;\n}\n\nconst y = {\n  edge: {\n    position0: m(),\n    position1: m(),\n    faceNormal0: m(),\n    faceNormal1: m(),\n    componentIndex: 0,\n    cosAngle: 0\n  },\n  ortho: m(),\n  fwd: m()\n},\n      I = {\n  v0: m(),\n  v1: m(),\n  v2: m()\n},\n      V = {\n  anglePlanar: 4,\n  angleSignificantEdge: 35\n};\nexport { u as extractEdges };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing.js"],"names":["range","e","deg2rad","t","acosClamped","n","forEach","o","i","r","s","g","c","d","a","l","f","m","p","u","V","vertices","position","componentIndex","anglePlanar","I","angleSignificantEdge","N","Math","cos","j","x","y","edge","F","position0","E","position1","U","faceNormal0","k","faceNormal1","D","w","M","v","P","length","S","allocate","b","L","q","z","B","C","G","H","Float32Array","getVec","sort","J","Array","K","get","cosAngle","h","write","push","A","O","reverse","Q","regular","instancesData","trim","lodInfo","lengths","silhouette","averageEdgeLength","fwd","ortho","faces","neighbors","Int32Array","v0","v1","v2","extractEdges"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{range as e}from\"../../../../../core/arrayUtils.js\";import{deg2rad as t,acosClamped as n}from\"../../../../../core/mathUtils.js\";import{forEach as o}from\"../../../../../core/typedArrayUtil.js\";import{i as r,s,g as c,d as a,r as i,c as l,f as g,n as f}from\"../../../../../chunks/vec3.js\";import{c as m}from\"../../../../../chunks/vec3f64.js\";const p=-1;function u(n,i,l,g=V){const f=n.vertices.position,m=n.vertices.componentIndex,u=t(g.anglePlanar),I=t(g.angleSignificantEdge),N=Math.cos(I),j=Math.cos(u),x=y.edge,F=x.position0,E=x.position1,U=x.faceNormal0,k=x.faceNormal1,D=w(n),M=v(n),P=M.length/4,S=i.allocate(P);let b=0;const L=P,q=l.allocate(L);let z=0,B=0,C=0;const G=e(0,P),H=new Float32Array(P);o(H,((e,t,n)=>{f.getVec(M[4*t+0],F),f.getVec(M[4*t+1],E),n[t]=r(F,E)})),G.sort(((e,t)=>H[t]-H[e]));const J=new Array,K=new Array;for(let e=0;e<P;e++){const t=G[e],n=H[t],o=M[4*t+0],r=M[4*t+1],g=M[4*t+2],v=M[4*t+3],w=v===p;if(f.getVec(o,F),f.getVec(r,E),w)s(U,D[3*g+0],D[3*g+1],D[3*g+2]),c(k,U),x.componentIndex=m.get(o),x.cosAngle=a(U,k);else{if(s(U,D[3*g+0],D[3*g+1],D[3*g+2]),s(k,D[3*v+0],D[3*v+1],D[3*v+2]),x.componentIndex=m.get(o),x.cosAngle=a(U,k),d(x,j))continue;x.cosAngle<-.9999&&c(k,U)}B+=n,C++,w||h(x,N)?(i.write(S,b++,x),J.push(n)):A(x,u)&&(l.write(q,z++,x),K.push(n))}const O=new Float32Array(J.reverse()),Q=new Float32Array(K.reverse());return{regular:{instancesData:i.trim(S,b),lodInfo:{lengths:O}},silhouette:{instancesData:l.trim(q,z),lodInfo:{lengths:Q}},averageEdgeLength:B/C}}function h(e,t){return e.cosAngle<t}function d(e,t){return e.cosAngle>t}function A(e,t){const o=n(e.cosAngle),r=y.fwd,s=y.ortho;i(r,e.position1,e.position0);return o*(a(l(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function v(e){const t=e.faces.length/3,n=e.faces,o=e.neighbors;let r=0;for(let a=0;a<t;a++){const e=o[3*a+0],t=o[3*a+1],s=o[3*a+2],c=n[3*a+0],i=n[3*a+1],l=n[3*a+2];r+=e===p||c<i?1:0,r+=t===p||i<l?1:0,r+=s===p||l<c?1:0}const s=new Int32Array(4*r);let c=0;for(let a=0;a<t;a++){const e=o[3*a+0],t=o[3*a+1],r=o[3*a+2],i=n[3*a+0],l=n[3*a+1],g=n[3*a+2];(e===p||i<l)&&(s[c++]=i,s[c++]=l,s[c++]=a,s[c++]=e),(t===p||l<g)&&(s[c++]=l,s[c++]=g,s[c++]=a,s[c++]=t),(r===p||g<i)&&(s[c++]=g,s[c++]=i,s[c++]=a,s[c++]=r)}return s}function w(e){const t=e.faces.length/3,n=e.vertices.position,o=e.faces,r=I.v0,s=I.v1,c=I.v2,a=new Float32Array(3*t);for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],m=o[3*i+2];n.getVec(e,r),n.getVec(t,s),n.getVec(m,c),g(s,s,r),g(c,c,r),l(r,s,c),f(r,r),a[3*i+0]=r[0],a[3*i+1]=r[1],a[3*i+2]=r[2]}return a}const y={edge:{position0:m(),position1:m(),faceNormal0:m(),faceNormal1:m(),componentIndex:0,cosAngle:0},ortho:m(),fwd:m()},I={v0:m(),v1:m(),v2:m()},V={anglePlanar:4,angleSignificantEdge:35};export{u as extractEdges};\n"]},"metadata":{},"sourceType":"module"}