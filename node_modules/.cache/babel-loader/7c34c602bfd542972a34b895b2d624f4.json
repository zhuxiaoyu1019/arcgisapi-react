{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../../chunks/tslib.es6.js\";\nimport { Milliseconds as e } from \"../../../../../core/time.js\";\nimport \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/Logger.js\";\nimport { subclass as i } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { g as o, f as r, l as s, n as a, b as n, a as m, e as c } from \"../../../../../chunks/vec3.js\";\nimport { c as p } from \"../../../../../chunks/vec3f64.js\";\nimport { disableContextNavigation as h } from \"../../../../../support/featureFlags.js\";\nimport { applyAll as l } from \"../../../camera/constraintUtils.js\";\nimport { PointToPointAnimationController as C } from \"../PointToPointAnimationController.js\";\nimport u from \"../../../webgl-engine/lib/Camera.js\";\nimport { Intersector as y } from \"../../../webgl-engine/lib/Intersector.js\";\nimport { outExpo as f } from \"../../../../animation/easing.js\";\nconst g = .6,\n      j = 4,\n      w = 60,\n      b = 14,\n      d = 20;\nlet v = class extends C {\n  constructor() {\n    super(...arguments), this.zoomLocation = p(), this.tmpCamera = new u(), this.tmpRayDir = p(), this.tmpCenter = p(), this.constraintOptions = {\n      selection: 15,\n      interactionType: 1,\n      interactionFactor: null,\n      interactionStartCamera: new u(),\n      interactionDirection: null,\n      tiltMode: 0\n    };\n  }\n\n  zoomStep(t, e) {\n    if (!this.active) return;\n    const i = this.view.state,\n          {\n      interactionStartCamera: c\n    } = this.constraintOptions;\n    this.animation.finished ? c.copyFrom(i.camera) : this.animation.cameraAt(1, c), this.tmpCamera.copyFrom(i.camera);\n    const l = new y(this.view.state.viewingMode);\n    t > 0 ? (this.intersectionHelper.intersectScreenFreePointFallback(e, this.zoomLocation), this.intersectionHelper.intersectRay(this.tmpCamera.ray, l, this.tmpCenter) && (this.tmpCamera.center = this.tmpCenter)) : this.intersectionHelper.intersectRay(this.tmpCamera.ray, l, this.zoomLocation) ? this.tmpCamera.center = this.zoomLocation : o(this.zoomLocation, this.tmpCamera.center);\n    const C = g ** t;\n\n    if (!h()) {\n      let t = this.view._stage.renderView.getMinimalDepthForArea(e[0], e[1], this.view.state.camera, w);\n\n      const i = Math.max(b * Math.abs(this.view.camera.position.z), d);\n\n      if (t = t ? Math.min(t, i) : i, t) {\n        const e = p();\n        r(e, this.zoomLocation, this.tmpCamera.eye), t < s(e) && (a(e, e), n(this.zoomLocation, this.tmpCamera.eye, m(e, e, t)));\n      }\n    }\n\n    this.updateCamera(this.tmpCamera, C, this.zoomLocation), this.begin(this.tmpCamera);\n  }\n\n  animationSettings() {\n    return {\n      apex: null,\n      duration: e(600),\n      easing: f\n    };\n  }\n\n  updateCamera(t, e, i) {\n    r(this.tmpRayDir, i, t.eye);\n    const o = s(this.tmpRayDir);\n    let a = o * e;\n    e <= 1 && a < j && (a = j, e = a / o), Math.abs(o - a) < 1e-6 || (m(this.tmpRayDir, this.tmpRayDir, e), t.eye = r(z, i, this.tmpRayDir), t.center = c(z, t.center, i, 1 - e), l(this.view, t, this.constraintOptions));\n  }\n\n};\nv = t([i(\"esri.views.3d.state.controllers.local.ZoomStepController\")], v);\nconst z = p();\nexport { v as ZoomStepController };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/state/controllers/local/ZoomStepController.js"],"names":["_","t","Milliseconds","e","subclass","i","g","o","f","r","l","s","n","a","b","m","c","p","disableContextNavigation","h","applyAll","PointToPointAnimationController","C","u","Intersector","y","outExpo","j","w","d","v","constructor","arguments","zoomLocation","tmpCamera","tmpRayDir","tmpCenter","constraintOptions","selection","interactionType","interactionFactor","interactionStartCamera","interactionDirection","tiltMode","zoomStep","active","view","state","animation","finished","copyFrom","camera","cameraAt","viewingMode","intersectionHelper","intersectScreenFreePointFallback","intersectRay","ray","center","_stage","renderView","getMinimalDepthForArea","Math","max","abs","position","z","min","eye","updateCamera","begin","animationSettings","apex","duration","easing","ZoomStepController"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../../chunks/tslib.es6.js\";import{Milliseconds as e}from\"../../../../../core/time.js\";import\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as i}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{g as o,f as r,l as s,n as a,b as n,a as m,e as c}from\"../../../../../chunks/vec3.js\";import{c as p}from\"../../../../../chunks/vec3f64.js\";import{disableContextNavigation as h}from\"../../../../../support/featureFlags.js\";import{applyAll as l}from\"../../../camera/constraintUtils.js\";import{PointToPointAnimationController as C}from\"../PointToPointAnimationController.js\";import u from\"../../../webgl-engine/lib/Camera.js\";import{Intersector as y}from\"../../../webgl-engine/lib/Intersector.js\";import{outExpo as f}from\"../../../../animation/easing.js\";const g=.6,j=4,w=60,b=14,d=20;let v=class extends C{constructor(){super(...arguments),this.zoomLocation=p(),this.tmpCamera=new u,this.tmpRayDir=p(),this.tmpCenter=p(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new u,interactionDirection:null,tiltMode:0}}zoomStep(t,e){if(!this.active)return;const i=this.view.state,{interactionStartCamera:c}=this.constraintOptions;this.animation.finished?c.copyFrom(i.camera):this.animation.cameraAt(1,c),this.tmpCamera.copyFrom(i.camera);const l=new y(this.view.state.viewingMode);t>0?(this.intersectionHelper.intersectScreenFreePointFallback(e,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,l,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,l,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:o(this.zoomLocation,this.tmpCamera.center);const C=g**t;if(!h()){let t=this.view._stage.renderView.getMinimalDepthForArea(e[0],e[1],this.view.state.camera,w);const i=Math.max(b*Math.abs(this.view.camera.position.z),d);if(t=t?Math.min(t,i):i,t){const e=p();r(e,this.zoomLocation,this.tmpCamera.eye),t<s(e)&&(a(e,e),n(this.zoomLocation,this.tmpCamera.eye,m(e,e,t)))}}this.updateCamera(this.tmpCamera,C,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:e(600),easing:f}}updateCamera(t,e,i){r(this.tmpRayDir,i,t.eye);const o=s(this.tmpRayDir);let a=o*e;e<=1&&a<j&&(a=j,e=a/o),Math.abs(o-a)<1e-6||(m(this.tmpRayDir,this.tmpRayDir,e),t.eye=r(z,i,this.tmpRayDir),t.center=c(z,t.center,i,1-e),l(this.view,t,this.constraintOptions))}};v=t([i(\"esri.views.3d.state.controllers.local.ZoomStepController\")],v);const z=p();export{v as ZoomStepController};\n"]},"metadata":{},"sourceType":"module"}