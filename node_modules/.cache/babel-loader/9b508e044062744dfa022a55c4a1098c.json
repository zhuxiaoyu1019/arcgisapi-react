{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as t } from \"../../../../../core/maybe.js\";\nimport e from \"../MemoryBuffer.js\";\n\nclass n {\n  constructor(t) {\n    this._locations = new Map(), this._key = t;\n  }\n\n  get key() {\n    return this._key;\n  }\n\n  get type() {\n    return 7 & this._key;\n  }\n\n  defines() {\n    return [];\n  }\n\n  getStride() {\n    return this._layoutInfo || this._buildAttributesInfo(), this._stride;\n  }\n\n  getAttributeLocations() {\n    return 0 === this._locations.size && this._buildAttributesInfo(), this._locations;\n  }\n\n  getLayoutInfo() {\n    return this._layoutInfo || this._buildAttributesInfo(), this._layoutInfo;\n  }\n\n  getEncodingInfos() {\n    return this._propertyEncodingInfo || this._buildAttributesInfo(), this._propertyEncodingInfo;\n  }\n\n  getUniforms() {\n    return this._uniforms || this._buildAttributesInfo(), this._uniforms;\n  }\n\n  getShaderHeader() {\n    return this._shaderHeader || this._buildAttributesInfo(), this._shaderHeader;\n  }\n\n  getShaderMain() {\n    return this._shaderMain || this._buildAttributesInfo(), this._shaderMain;\n  }\n\n  setDataUniforms(t, e, n, o, s) {\n    const r = this.getUniforms();\n\n    for (const i of r) {\n      const {\n        name: r,\n        type: a,\n        getValue: c\n      } = i,\n            u = c(n, e, o, s);\n      if (null !== u) switch (a) {\n        case \"float\":\n          t.setUniform1f(r, u);\n          break;\n\n        case \"vec2\":\n          t.setUniform2fv(r, u);\n          break;\n\n        case \"vec4\":\n          t.setUniform4fv(r, u);\n      }\n    }\n  }\n\n  encodeAttributes(t, e, n, o) {\n    const s = this.attributesInfo(),\n          r = this.getEncodingInfos(),\n          i = [];\n    let a = 0,\n        c = 0;\n\n    for (const f of Object.keys(r)) {\n      var u;\n\n      const d = r[f],\n            {\n        type: h,\n        precisionFactor: l,\n        isLayout: y\n      } = s[f],\n            _ = y ? n.getLayoutProperty(f) : n.getPaintProperty(f),\n            m = null == (u = _.interpolator) ? void 0 : u.getInterpolationRange(e);\n\n      let b = 0;\n\n      for (const n of d) {\n        const {\n          offset: s,\n          bufferElementsToAdd: r\n        } = n;\n\n        if (r > 0) {\n          for (let t = 0; t < r; t++) i.push(0);\n\n          a += c, c = n.bufferElementsToAdd;\n        }\n\n        const u = null != o ? o : _.getValue(m ? m[b] : e, t);\n\n        switch (h) {\n          case 0:\n          case 1:\n            i[a] |= this._encodeByte(u * (l || 1), 8 * s);\n            break;\n\n          case 2:\n          case 3:\n            i[a] |= this._encodeShort(u * (l || 1), 8 * s);\n            break;\n\n          case 4:\n          case 5:\n            i[a] |= this._encodeByte(u * (l || 1), 8 * s), i[a] |= this._encodeByte(u * (l || 1), 8 * s + 8);\n            break;\n\n          case 6:\n          case 7:\n            i[a] |= this._encodeShort(u * (l || 1), 8 * s), i[a] |= this._encodeShort(u * (l || 1), 8 * s + 16);\n            break;\n\n          case 8:\n          case 9:\n            i[a] |= this._encodeByte(u * (l || 1), 8 * s), i[a] |= this._encodeByte(u * (l || 1), 8 * s + 8), i[a] |= this._encodeByte(u * (l || 1), 8 * s + 16), i[a] |= this._encodeByte(u * (l || 1), 8 * s + 24);\n            break;\n\n          case 10:\n            i[a] = this._encodeColor(u);\n            break;\n\n          case 11:\n          case 12:\n            this._encodePattern(a, i, u);\n\n            break;\n\n          default:\n            throw new Error(\"Unsupported encoding type\");\n        }\n\n        b++;\n      }\n    }\n\n    return i;\n  }\n\n  getAtributeState(t) {\n    let e = 0;\n    const n = 3 + 2 * t;\n    return e |= this._bit(n), e |= this._bit(n + 1) << 1, e;\n  }\n\n  _buildAttributesInfo() {\n    const t = [],\n          e = {},\n          o = {};\n    let s = -1;\n    const r = this.attributesInfo(),\n          i = this.attributes();\n    let a = -1;\n\n    for (const d of i) {\n      a++;\n      const i = this.getAtributeState(a);\n      if (0 === i || 3 === i) continue;\n      const c = r[d],\n            u = [];\n      e[d] = u;\n      const f = c.type;\n\n      for (let e = 0; e < i; e++) {\n        const {\n          dataType: e,\n          bytesPerElement: r,\n          count: i,\n          normalized: a\n        } = n._encodingInfo[f],\n              c = r * i;\n        let d = o[e],\n            h = 0;\n        if (!d || d.count + i > 4) s++, d = {\n          dataIndex: s,\n          count: 0,\n          offset: 0\n        }, 4 !== i && (o[e] = d), t.push({\n          location: -1,\n          name: \"a_data_\" + s,\n          count: i,\n          type: e,\n          normalized: a\n        }), h = Math.ceil(Math.max(c / 4, 1));else {\n          const e = t[d.dataIndex];\n          e.count += i;\n          h = Math.ceil(Math.max(e.count * r / 4, 1)) - Math.ceil(Math.max(d.offset / 4, 1));\n        }\n        u.push({\n          dataIndex: d.dataIndex,\n          offset: d.offset,\n          bufferElementsToAdd: h\n        }), d.offset += c, d.count += i;\n      }\n    }\n\n    for (const n of t) switch (n.type) {\n      case 5120:\n      case 5121:\n        n.count = 4;\n\n      case 5122:\n      case 5123:\n        n.count += n.count % 2;\n    }\n\n    this._buildVertexBufferLayout(t);\n\n    let c = 0;\n    const u = this._layoutInfo.geometry;\n\n    for (const n of u) this._locations.set(n.name, c++);\n\n    const f = this._layoutInfo.opacity;\n    if (f) for (const n of f) this._locations.set(n.name, c++);\n    this._buildShaderInfo(t, e), this._propertyEncodingInfo = e;\n  }\n\n  _buildVertexBufferLayout(t) {\n    const e = {},\n          n = this.geometryInfo();\n    let s = n[0].stride;\n    if (0 === t.length) e.geometry = n;else {\n      const r = [];\n      let i = s;\n\n      for (const e of t) s += o(e.type) * e.count;\n\n      for (const t of n) {\n        const e = { ...t\n        };\n        e.stride = s, r.push(e);\n      }\n\n      for (const e of t) r.push({\n        name: e.name,\n        count: e.count,\n        type: e.type,\n        offset: i,\n        stride: s,\n        normalized: e.normalized || !1,\n        divisor: 0\n      }), i += o(e.type) * e.count;\n\n      e.geometry = r;\n    }\n    this.opacityInfo() && (e.opacity = this.opacityInfo()), this._layoutInfo = e, this._stride = s;\n  }\n\n  _buildShaderInfo(e, o) {\n    let r = \"\\n\",\n        i = \"\\n\";\n    const a = [];\n\n    for (const t of e) r += `attribute ${this._getType(t.count)} ${t.name};\\n`;\n\n    const c = this.attributes(),\n          u = this.attributesInfo();\n    let f = -1;\n\n    for (const d of c) {\n      f++;\n\n      const {\n        name: e,\n        type: c,\n        precisionFactor: h,\n        isLayout: l\n      } = u[d],\n            y = h && 1 !== h ? \" * \" + 1 / h : \"\",\n            {\n        bytesPerElement: _,\n        count: m\n      } = n._encodingInfo[c],\n            b = t => `a_data_${t.dataIndex}${s(m, t.offset, _)}`;\n\n      switch (this.getAtributeState(f)) {\n        case 0:\n          {\n            const n = this._getType(m),\n                  o = `u_${e}`;\n\n            a.push({\n              name: o,\n              type: n,\n              getValue: (e, n, o, s) => {\n                const r = l ? e.getLayoutValue(d, n) : e.getPaintValue(d, n);\n\n                if (11 === c) {\n                  const o = e.getDashKey(r, e.getLayoutValue(\"line-cap\", n)),\n                        i = s.getMosaicItemPosition(o, !1);\n                  if (t(i)) return null;\n                  const {\n                    tl: a,\n                    br: c\n                  } = i;\n                  return [a[0], c[1], c[0], a[1]];\n                }\n\n                if (12 === c) {\n                  const e = s.getMosaicItemPosition(r, -1 === d.indexOf(\"line-\"));\n                  if (t(e)) return null;\n                  const {\n                    tl: n,\n                    br: o\n                  } = e;\n                  return [n[0], o[1], o[0], n[1]];\n                }\n\n                if (10 === c) {\n                  const t = r[3];\n                  return [t * r[0], t * r[1], t * r[2], t];\n                }\n\n                return r;\n              }\n            }), r += `uniform ${n} ${o};\\n`, i += `${n} ${e} = ${o};\\n`;\n          }\n          break;\n\n        case 1:\n          {\n            const t = b(o[d][0]);\n            i += `${this._getType(m)} ${e} = ${t}${y};\\n`;\n          }\n          break;\n\n        case 2:\n          {\n            const t = `u_t_${e}`;\n            a.push({\n              name: t,\n              type: \"float\",\n              getValue: (t, e, n, o) => (l ? t.getLayoutProperty(d) : t.getPaintProperty(d)).interpolator.interpolationUniformValue(n, e)\n            }), r += `uniform float ${t};\\n`;\n            const n = b(o[d][0]),\n                  s = b(o[d][1]);\n            i += `${this._getType(m)} ${e} = mix(${n}${y}, ${s}${y}, ${t});\\n`;\n          }\n      }\n    }\n\n    this._shaderHeader = r, this._shaderMain = i, this._uniforms = a;\n  }\n\n  _bit(t) {\n    return (this._key & 1 << t) >> t;\n  }\n\n  _getType(t) {\n    switch (t) {\n      case 1:\n        return \"float\";\n\n      case 2:\n        return \"vec2\";\n\n      case 3:\n        return \"vec3\";\n\n      case 4:\n        return \"vec4\";\n    }\n\n    throw new Error(\"Invalid count\");\n  }\n\n  _encodeColor(t) {\n    const n = 255 * t[3];\n    return e.i8888to32(t[0] * n, t[1] * n, t[2] * n, n);\n  }\n\n  _encodePattern(t, e, n) {\n    if (!n || !n.rect) return;\n    const o = 2,\n          s = n.rect,\n          r = n.width,\n          i = n.height;\n    e[t] = this._encodeShort(s.x + o, 0), e[t] |= this._encodeShort(s.y + o + i, 16), e[t + 1] = this._encodeShort(s.x + o + r, 0), e[t + 1] |= this._encodeShort(s.y + o, 16);\n  }\n\n  _encodeByte(t, e) {\n    return (255 & t) << e;\n  }\n\n  _encodeShort(t, e) {\n    return (65535 & t) << e;\n  }\n\n}\n\nn._encodingInfo = {\n  0: {\n    dataType: 5120,\n    bytesPerElement: 1,\n    count: 1,\n    normalized: !1\n  },\n  1: {\n    dataType: 5121,\n    bytesPerElement: 1,\n    count: 1,\n    normalized: !1\n  },\n  2: {\n    dataType: 5122,\n    bytesPerElement: 2,\n    count: 1,\n    normalized: !1\n  },\n  3: {\n    dataType: 5123,\n    bytesPerElement: 2,\n    count: 1,\n    normalized: !1\n  },\n  4: {\n    dataType: 5120,\n    bytesPerElement: 1,\n    count: 2,\n    normalized: !1\n  },\n  5: {\n    dataType: 5121,\n    bytesPerElement: 1,\n    count: 2,\n    normalized: !1\n  },\n  6: {\n    dataType: 5122,\n    bytesPerElement: 2,\n    count: 2,\n    normalized: !1\n  },\n  7: {\n    dataType: 5123,\n    bytesPerElement: 2,\n    count: 2,\n    normalized: !1\n  },\n  8: {\n    dataType: 5120,\n    bytesPerElement: 1,\n    count: 4,\n    normalized: !1\n  },\n  9: {\n    dataType: 5121,\n    bytesPerElement: 1,\n    count: 4,\n    normalized: !1\n  },\n  10: {\n    dataType: 5121,\n    bytesPerElement: 1,\n    count: 4,\n    normalized: !0\n  },\n  11: {\n    dataType: 5123,\n    bytesPerElement: 2,\n    count: 4,\n    normalized: !1\n  },\n  12: {\n    dataType: 5123,\n    bytesPerElement: 2,\n    count: 4,\n    normalized: !1\n  }\n};\n\nconst o = t => {\n  switch (t) {\n    case 5126:\n    case 5124:\n    case 5125:\n      return 4;\n\n    case 5122:\n    case 5123:\n      return 2;\n\n    case 5120:\n    case 5121:\n      return 1;\n  }\n},\n      s = (t, e, n) => {\n  const o = e / n;\n  if (1 === t) switch (o) {\n    case 0:\n      return \".x\";\n\n    case 1:\n      return \".y\";\n\n    case 2:\n      return \".z\";\n\n    case 3:\n      return \".w\";\n  } else if (2 === t) switch (o) {\n    case 0:\n      return \".xy\";\n\n    case 1:\n      return \".yz\";\n\n    case 2:\n      return \".zw\";\n  } else if (3 === t) switch (o) {\n    case 0:\n      return \".xyz\";\n\n    case 1:\n      return \".yzw\";\n  }\n  return \"\";\n};\n\nexport { n as VTLMaterial };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/VTLMaterial.js"],"names":["isNone","t","e","n","constructor","_locations","Map","_key","key","type","defines","getStride","_layoutInfo","_buildAttributesInfo","_stride","getAttributeLocations","size","getLayoutInfo","getEncodingInfos","_propertyEncodingInfo","getUniforms","_uniforms","getShaderHeader","_shaderHeader","getShaderMain","_shaderMain","setDataUniforms","o","s","r","i","name","a","getValue","c","u","setUniform1f","setUniform2fv","setUniform4fv","encodeAttributes","attributesInfo","f","Object","keys","d","h","precisionFactor","l","isLayout","y","_","getLayoutProperty","getPaintProperty","m","interpolator","getInterpolationRange","b","offset","bufferElementsToAdd","push","_encodeByte","_encodeShort","_encodeColor","_encodePattern","Error","getAtributeState","_bit","attributes","dataType","bytesPerElement","count","normalized","_encodingInfo","dataIndex","location","Math","ceil","max","_buildVertexBufferLayout","geometry","set","opacity","_buildShaderInfo","geometryInfo","stride","length","divisor","opacityInfo","_getType","getLayoutValue","getPaintValue","getDashKey","getMosaicItemPosition","tl","br","indexOf","interpolationUniformValue","i8888to32","rect","width","height","x","VTLMaterial"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as t}from\"../../../../../core/maybe.js\";import e from\"../MemoryBuffer.js\";class n{constructor(t){this._locations=new Map,this._key=t}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return 0===this._locations.size&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(t,e,n,o,s){const r=this.getUniforms();for(const i of r){const{name:r,type:a,getValue:c}=i,u=c(n,e,o,s);if(null!==u)switch(a){case\"float\":t.setUniform1f(r,u);break;case\"vec2\":t.setUniform2fv(r,u);break;case\"vec4\":t.setUniform4fv(r,u)}}}encodeAttributes(t,e,n,o){const s=this.attributesInfo(),r=this.getEncodingInfos(),i=[];let a=0,c=0;for(const f of Object.keys(r)){var u;const d=r[f],{type:h,precisionFactor:l,isLayout:y}=s[f],_=y?n.getLayoutProperty(f):n.getPaintProperty(f),m=null==(u=_.interpolator)?void 0:u.getInterpolationRange(e);let b=0;for(const n of d){const{offset:s,bufferElementsToAdd:r}=n;if(r>0){for(let t=0;t<r;t++)i.push(0);a+=c,c=n.bufferElementsToAdd}const u=null!=o?o:_.getValue(m?m[b]:e,t);switch(h){case 0:case 1:i[a]|=this._encodeByte(u*(l||1),8*s);break;case 2:case 3:i[a]|=this._encodeShort(u*(l||1),8*s);break;case 4:case 5:i[a]|=this._encodeByte(u*(l||1),8*s),i[a]|=this._encodeByte(u*(l||1),8*s+8);break;case 6:case 7:i[a]|=this._encodeShort(u*(l||1),8*s),i[a]|=this._encodeShort(u*(l||1),8*s+16);break;case 8:case 9:i[a]|=this._encodeByte(u*(l||1),8*s),i[a]|=this._encodeByte(u*(l||1),8*s+8),i[a]|=this._encodeByte(u*(l||1),8*s+16),i[a]|=this._encodeByte(u*(l||1),8*s+24);break;case 10:i[a]=this._encodeColor(u);break;case 11:case 12:this._encodePattern(a,i,u);break;default:throw new Error(\"Unsupported encoding type\")}b++}}return i}getAtributeState(t){let e=0;const n=3+2*t;return e|=this._bit(n),e|=this._bit(n+1)<<1,e}_buildAttributesInfo(){const t=[],e={},o={};let s=-1;const r=this.attributesInfo(),i=this.attributes();let a=-1;for(const d of i){a++;const i=this.getAtributeState(a);if(0===i||3===i)continue;const c=r[d],u=[];e[d]=u;const f=c.type;for(let e=0;e<i;e++){const{dataType:e,bytesPerElement:r,count:i,normalized:a}=n._encodingInfo[f],c=r*i;let d=o[e],h=0;if(!d||d.count+i>4)s++,d={dataIndex:s,count:0,offset:0},4!==i&&(o[e]=d),t.push({location:-1,name:\"a_data_\"+s,count:i,type:e,normalized:a}),h=Math.ceil(Math.max(c/4,1));else{const e=t[d.dataIndex];e.count+=i;h=Math.ceil(Math.max(e.count*r/4,1))-Math.ceil(Math.max(d.offset/4,1))}u.push({dataIndex:d.dataIndex,offset:d.offset,bufferElementsToAdd:h}),d.offset+=c,d.count+=i}}for(const n of t)switch(n.type){case 5120:case 5121:n.count=4;case 5122:case 5123:n.count+=n.count%2}this._buildVertexBufferLayout(t);let c=0;const u=this._layoutInfo.geometry;for(const n of u)this._locations.set(n.name,c++);const f=this._layoutInfo.opacity;if(f)for(const n of f)this._locations.set(n.name,c++);this._buildShaderInfo(t,e),this._propertyEncodingInfo=e}_buildVertexBufferLayout(t){const e={},n=this.geometryInfo();let s=n[0].stride;if(0===t.length)e.geometry=n;else{const r=[];let i=s;for(const e of t)s+=o(e.type)*e.count;for(const t of n){const e={...t};e.stride=s,r.push(e)}for(const e of t)r.push({name:e.name,count:e.count,type:e.type,offset:i,stride:s,normalized:e.normalized||!1,divisor:0}),i+=o(e.type)*e.count;e.geometry=r}this.opacityInfo()&&(e.opacity=this.opacityInfo()),this._layoutInfo=e,this._stride=s}_buildShaderInfo(e,o){let r=\"\\n\",i=\"\\n\";const a=[];for(const t of e)r+=`attribute ${this._getType(t.count)} ${t.name};\\n`;const c=this.attributes(),u=this.attributesInfo();let f=-1;for(const d of c){f++;const{name:e,type:c,precisionFactor:h,isLayout:l}=u[d],y=h&&1!==h?\" * \"+1/h:\"\",{bytesPerElement:_,count:m}=n._encodingInfo[c],b=t=>`a_data_${t.dataIndex}${s(m,t.offset,_)}`;switch(this.getAtributeState(f)){case 0:{const n=this._getType(m),o=`u_${e}`;a.push({name:o,type:n,getValue:(e,n,o,s)=>{const r=l?e.getLayoutValue(d,n):e.getPaintValue(d,n);if(11===c){const o=e.getDashKey(r,e.getLayoutValue(\"line-cap\",n)),i=s.getMosaicItemPosition(o,!1);if(t(i))return null;const{tl:a,br:c}=i;return[a[0],c[1],c[0],a[1]]}if(12===c){const e=s.getMosaicItemPosition(r,-1===d.indexOf(\"line-\"));if(t(e))return null;const{tl:n,br:o}=e;return[n[0],o[1],o[0],n[1]]}if(10===c){const t=r[3];return[t*r[0],t*r[1],t*r[2],t]}return r}}),r+=`uniform ${n} ${o};\\n`,i+=`${n} ${e} = ${o};\\n`}break;case 1:{const t=b(o[d][0]);i+=`${this._getType(m)} ${e} = ${t}${y};\\n`}break;case 2:{const t=`u_t_${e}`;a.push({name:t,type:\"float\",getValue:(t,e,n,o)=>(l?t.getLayoutProperty(d):t.getPaintProperty(d)).interpolator.interpolationUniformValue(n,e)}),r+=`uniform float ${t};\\n`;const n=b(o[d][0]),s=b(o[d][1]);i+=`${this._getType(m)} ${e} = mix(${n}${y}, ${s}${y}, ${t});\\n`}}}this._shaderHeader=r,this._shaderMain=i,this._uniforms=a}_bit(t){return(this._key&1<<t)>>t}_getType(t){switch(t){case 1:return\"float\";case 2:return\"vec2\";case 3:return\"vec3\";case 4:return\"vec4\"}throw new Error(\"Invalid count\")}_encodeColor(t){const n=255*t[3];return e.i8888to32(t[0]*n,t[1]*n,t[2]*n,n)}_encodePattern(t,e,n){if(!n||!n.rect)return;const o=2,s=n.rect,r=n.width,i=n.height;e[t]=this._encodeShort(s.x+o,0),e[t]|=this._encodeShort(s.y+o+i,16),e[t+1]=this._encodeShort(s.x+o+r,0),e[t+1]|=this._encodeShort(s.y+o,16)}_encodeByte(t,e){return(255&t)<<e}_encodeShort(t,e){return(65535&t)<<e}}n._encodingInfo={0:{dataType:5120,bytesPerElement:1,count:1,normalized:!1},1:{dataType:5121,bytesPerElement:1,count:1,normalized:!1},2:{dataType:5122,bytesPerElement:2,count:1,normalized:!1},3:{dataType:5123,bytesPerElement:2,count:1,normalized:!1},4:{dataType:5120,bytesPerElement:1,count:2,normalized:!1},5:{dataType:5121,bytesPerElement:1,count:2,normalized:!1},6:{dataType:5122,bytesPerElement:2,count:2,normalized:!1},7:{dataType:5123,bytesPerElement:2,count:2,normalized:!1},8:{dataType:5120,bytesPerElement:1,count:4,normalized:!1},9:{dataType:5121,bytesPerElement:1,count:4,normalized:!1},10:{dataType:5121,bytesPerElement:1,count:4,normalized:!0},11:{dataType:5123,bytesPerElement:2,count:4,normalized:!1},12:{dataType:5123,bytesPerElement:2,count:4,normalized:!1}};const o=t=>{switch(t){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1}},s=(t,e,n)=>{const o=e/n;if(1===t)switch(o){case 0:return\".x\";case 1:return\".y\";case 2:return\".z\";case 3:return\".w\"}else if(2===t)switch(o){case 0:return\".xy\";case 1:return\".yz\";case 2:return\".zw\"}else if(3===t)switch(o){case 0:return\".xyz\";case 1:return\".yzw\"}return\"\"};export{n as VTLMaterial};\n"]},"metadata":{},"sourceType":"module"}