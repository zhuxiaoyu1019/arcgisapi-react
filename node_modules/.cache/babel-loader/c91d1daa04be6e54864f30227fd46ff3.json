{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { log2 as e } from \"../../../core/mathUtils.js\";\nimport { isSome as t, abortMaybe as i, isNone as s } from \"../../../core/maybe.js\";\nimport n from \"../../../core/ObjectPool.js\";\nimport { createAbortController as r } from \"../../../core/promiseUtils.js\";\nimport { c as a, s as o } from \"../../../chunks/vec2.js\";\nimport { a as h } from \"../../../chunks/vec2f64.js\";\nimport { g as l, f as d, p as u, d as c, a as p, b as g, l as f } from \"../../../chunks/vec3.js\";\nimport { c as m, u as _ } from \"../../../chunks/vec3f64.js\";\nimport { t as y } from \"../../../chunks/vec4.js\";\nimport { c as v } from \"../../../chunks/vec4f64.js\";\nimport { getReferenceEllipsoid as A } from \"../../../geometry/projectionEllipsoid.js\";\nimport { create as M, equals as L } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { c as j } from \"../../../chunks/sphere.js\";\nimport { VectorTile as D } from \"../../2d/engine/vectorTiles/VectorTile.js\";\nimport { ImageWithType as I } from \"../support/StreamDataLoader.js\";\nimport { ElevationBounds as U } from \"./ElevationBounds.js\";\nimport B from \"./ElevationTileAgent.js\";\nimport C from \"./MapTileAgent.js\";\nimport T from \"./RasterTile.js\";\nimport { LayerClasses as x, MAX_PATCH_TESSELATION as S, ELEVATION_DESIRED_RESOLUTION_LEVEL as b } from \"./TerrainConst.js\";\nimport { weakAssert as q, getLayerWithExtentRange as R } from \"./terrainUtils.js\";\nimport { TILE_AGENT_DONE as P } from \"./TileAgent.js\";\nimport { TilePerLayerInfo as w } from \"./TilePerLayerInfo.js\";\nimport E from \"./TileTexture.js\";\nimport { tile2str as V, fallsWithinLayer as W } from \"./tileUtils.js\";\nimport { getGpuMemoryUsage as N } from \"../../webgl/Util.js\";\nconst O = m(),\n      k = m(),\n      z = m(),\n      H = v(),\n      G = .1;\n\nclass F {\n  constructor() {\n    this.fovX = 0, this.fovY = 0, this.relativeWidthLimit = 0, this.relativeHeightLimit = 0, this.maxLod = 0, this.angledSplitBias = 0, this.aboveGround = !0;\n  }\n\n}\n\nclass X {\n  constructor(e) {\n    this._numSubdivisionAtLevel = e, this.lij = [0, 0, 0], this._children = [null, null, null, null], this._dirty = !0, this._previouslyRendered = !1, this.extent = M(), this._elevationBounds = h(), this.layerInfo = [[], []], this.extentInRadians = M(), this.centerAtSeaLevel = m(), this._center = [m(), j(), m()], this.up = _(), this._isWithinClippingArea = !0, this._intersectsClippingArea = !0, this._maxTesselation = 0, this._usedMemory = Z, this._mapTileMemory = 0, this._mapDataRefCount = 0, this._screenDepth = 0, this.renderOrder = 0, this._edgeLen = 0, this._edgeLen2 = 0, this._curvatureHeight = 0;\n  }\n\n  static prune() {\n    Q.prune(0), J.prune(0), w.prune();\n  }\n\n  get usedMemory() {\n    return this._usedMemory === Z && this._updateMemoryUsed(), this._usedMemory + (this.isCached ? 0 : this.mapTileMemory);\n  }\n\n  get cachedMemory() {\n    return this.isCached ? this.mapTileMemory : 0;\n  }\n\n  get mapTileMemory() {\n    this._usedMemory === Z && this._updateMemoryUsed();\n    let e = this._mapTileMemory;\n\n    for (const {\n      data: t\n    } of this.layerInfo[1]) t instanceof D && (e += t.memoryUsage);\n\n    return e;\n  }\n\n  get isCached() {\n    return !this.shouldLoad && this._mapDataRefCount <= 0;\n  }\n\n  get maxTesselation() {\n    return this._maxTesselation;\n  }\n\n  get numSubdivisionsAtLevel() {\n    return this._numSubdivisionAtLevel;\n  }\n\n  get isWithinClippingArea() {\n    return this._isWithinClippingArea;\n  }\n\n  get intersectsClippingArea() {\n    return this._intersectsClippingArea;\n  }\n\n  get clippingArea() {\n    return this._clippingArea;\n  }\n\n  get parent() {\n    return this._parent;\n  }\n\n  get children() {\n    return this._children;\n  }\n\n  get surface() {\n    return this._surface;\n  }\n\n  get elevationBounds() {\n    return this._elevationBounds;\n  }\n\n  get level() {\n    return this.lij[0];\n  }\n\n  get edgeLen() {\n    return this._edgeLen;\n  }\n\n  get radius() {\n    return this._center[1][3];\n  }\n\n  get screenDepth() {\n    return this._screenDepth;\n  }\n\n  get visible() {\n    if (this._dirty) {\n      this._dirty = !1;\n\n      const e = this._isVisible(this.surface.frustum);\n\n      e !== this._visible && (this._visible = e, this._surface.emit(\"tiles-visibility-changed\"), this._surface.renderer.setNeedsRender()), this.updateAgentSuspension();\n    }\n\n    return this._visible;\n  }\n\n  get loadable() {\n    return this.visible || this._surface.view.state.fixedContentCamera;\n  }\n\n  get rendered() {\n    const e = !!this.renderData;\n    return e !== this._previouslyRendered && (this._surface.emit(\"tiles-visibility-changed\"), this._previouslyRendered = e, this._surface.renderer.setNeedsRender()), e;\n  }\n\n  get shouldLoad() {\n    if (!this.loadable) return !1;\n\n    if (1 === this._surface.lodSnapping) {\n      const e = this.level - this._surface.snapLevel;\n      if (0 === e) return !0;\n      if (1 === e) return !1;\n    }\n\n    return this.isLeaf;\n  }\n\n  init(e, t, i) {\n    this.lij[0] = e[0], this.lij[1] = e[1], this.lij[2] = e[2], this.ellipsoid = A(i.tilingScheme.spatialReference), i.tilingScheme.getExtent(e[0], e[1], e[2], this.extent), i.tilingScheme.convertExtentToRadians(this.extent, this.extentInRadians), this._isWithinClippingArea = !0, this._intersectsClippingArea = !0, this._clippingArea = null, this._mapDataRefCount = 0, i.upsampleMapCache.pop(V(this)), this._edgeLen = 0, this._edgeLen2 = 0, this._center[1][3] = 0, this.vlevel = e ? e[0] : 0, t && t.elevationBounds ? a(this._elevationBounds, t.elevationBounds) : o(this._elevationBounds, 0, 0), this._pendingUpdates = 0, this.renderData = null, this._screenDepth = 0, this._visible = !1, this._previouslyRendered = !1, this._parent = t, this.unsetChildren(), this._surface = i, this.updateVisibility();\n\n    for (const s of x) {\n      const e = i.numLayers(s),\n            t = this.layerInfo[s];\n\n      for (const i of t) i.release();\n\n      t.length = e;\n\n      for (let i = 0; i < e; i++) t[i] = w.acquire(this._surface.upsampleInfoPool), 0 === s && this.findElevationBoundsForLayer(i, -1);\n    }\n\n    this.computeElevationBounds(), this._maxTesselation = Math.min(i.tilingScheme.pixelSize, S);\n  }\n\n  release() {\n    q(!this.renderData, \"tile.renderData was not unloaded\"), this._surface.upsampleMapCache.pop(V(this));\n\n    for (const e of x) {\n      for (const t of this.layerInfo[e]) t.release();\n\n      this.layerInfo[e].length = 0;\n    }\n\n    this._parent = null, this._surface = null, this._usedMemory = Z;\n  }\n\n  refMapData() {\n    ++this._mapDataRefCount, this.isCached || this._surface.upsampleMapCache.pop(V(this));\n  }\n\n  unrefMapData() {\n    if (--this._mapDataRefCount, this.isCached) {\n      const e = this.cachedMemory;\n      e > 0 && (this._surface.upsampleMapCache.put(V(this), this, e), this.setMemoryDirty());\n    }\n  }\n\n  setMemoryDirty() {\n    this._usedMemory = Z;\n  }\n\n  get cpuImageMemorySize() {\n    const e = 4,\n          t = this._surface.tilingScheme.pixelSize;\n    return t * t * e;\n  }\n\n  _updateMemoryUsed() {\n    this._usedMemory = 0, this._mapTileMemory = 0;\n    const e = this.cpuImageMemorySize;\n\n    for (const {\n      data: t\n    } of this.layerInfo[1]) t instanceof E ? this._mapTileMemory += N(t.texture) : t instanceof HTMLImageElement || t instanceof I ? this._mapTileMemory += e : t instanceof T && (this._mapTileMemory += t.memoryUsage);\n\n    for (const t of this.layerInfo[0]) this._usedMemory += t.data ? e : 0;\n\n    this.renderData && (this._usedMemory += this.renderData.estimatedGeometryMemoryUsage, this._mapTileMemory += N(this.renderData.textureDescriptor)), this.isCached && this._surface.upsampleMapCache.updateSize(V(this), this, this.cachedMemory);\n  }\n\n  getUsedMemoryForLayer(e, t) {\n    const i = this.layerInfo[e][t];\n    if (!i || !i.data) return 0;\n\n    if (1 !== e || this.isCached) {\n      if (0 === e) return this.cpuImageMemorySize;\n    } else {\n      const e = i.data;\n      if (e instanceof E) return N(e.texture);\n      if (e instanceof HTMLImageElement || e instanceof I) return this.cpuImageMemorySize;\n      if (e instanceof D || e instanceof T) return e.memoryUsage;\n    }\n\n    return 0;\n  }\n\n  updateScreenDepth(e) {\n    l(H, this._center[1]), H[3] = 1, y(H, H, e), this._screenDepth = H[2] < 0 ? 0 : H[2] / H[3];\n  }\n\n  shouldSplit(i, s, n) {\n    if (t(i.frustum) && !this._isVisible(i.frustum)) return 0;\n    const r = this.level;\n    d(O, this._center[1], s);\n    let a = u(O),\n        o = 1;\n    d(k, this._center[0], s);\n    const h = u(k);\n    h < a && (a = h, o = 0), d(k, this._center[2], s);\n    const l = u(k);\n    if (l < a && (a = l, o = 2), this._edgeLen2 > a && r < i.maxLod) return 2;\n\n    const m = Math.sqrt(a),\n          _ = i.fovX * m * 2,\n          y = this._edgeLen / _,\n          v = () => {\n      const t = r + Math.ceil(-e(i.relativeWidthLimit / y));\n      return t !== this.vlevel ? (this.vlevel = t, 4) : 1;\n    };\n\n    if (1 === n) {\n      if (1 === this._surface.snapLevel - r) return r >= i.maxLod ? v() : 2;\n    }\n\n    const A = c(this.up, O),\n          M = this._elevationBounds[1] - this._elevationBounds[0],\n          L = M / this.edgeLen;\n\n    if (i.aboveGround && A > 0 && L < .001) {\n      if (A / m - Math.sin(this._curvatureHeight / (this.edgeLen * Math.SQRT1_2) * Math.PI) - L > 0) return 0;\n    }\n\n    if (y < i.relativeWidthLimit) return this.vlevel !== this.level ? (this.vlevel = this.level, 4) : 0;\n    if (r >= i.maxLod) return v();\n\n    if (r > 6) {\n      d(k, this._center[o], s), p(z, this.up, A), d(z, z, k);\n      const e = u(z);\n\n      if (e > this.radius * this.radius) {\n        p(z, z, this.radius / Math.sqrt(e)), g(z, z, this._center[o]), d(z, s, z);\n        const t = Math.min(1, (Math.abs(c(z, this.up)) + .5 * M + this._curvatureHeight) / f(z)),\n              n = G / i.angledSplitBias,\n              r = i.fovY * m * 2;\n        if (t * (this._edgeLen / r) < n * i.relativeHeightLimit) return 0;\n      }\n    }\n\n    return 2;\n  }\n\n  setChildren(e, t, i, s) {\n    q(!!(e && t && i && s), \"Null child passed\"), this._children[0] = e, this._children[1] = t, this._children[2] = i, this._children[3] = s;\n  }\n\n  unsetChildren() {\n    this._children[0] = null, this._children[1] = null, this._children[2] = null, this._children[3] = null;\n  }\n\n  load(e) {\n    this.refMapData();\n\n    for (const t of x) this._createOrUpdateAgents(0, t);\n\n    e.loadTile(this);\n  }\n\n  unload(e) {\n    e.unloadTile(this);\n\n    for (const t of x) {\n      const e = this.layerInfo[t];\n\n      for (const t of e) t.loadingAgent && t.loadingAgent !== P && (Y(t.loadingAgent), t.loadingAgent = null), t.pendingUpdates = 0;\n    }\n\n    this.resetPendingUpdate(32), this.resetPendingUpdate(64), this.unrefMapData();\n  }\n\n  unloadMapData() {\n    const e = this.layerInfo[1];\n\n    for (const t of e) t.loadingAgent && t.loadingAgent !== P && (Y(t.loadingAgent), t.loadingAgent = null), t.pendingUpdates = 0;\n\n    this.renderData && this.renderData.releaseTexture(), this.setMemoryDirty();\n  }\n\n  updateClippingStatus(e) {\n    if (L(e, this._clippingArea)) return !1;\n    const i = this._intersectsClippingArea,\n          s = this._isWithinClippingArea;\n    t(e) ? (this._intersectsClippingArea = this.intersectsExtent(e), this._isWithinClippingArea = this._isWithinExtent(e)) : (this._intersectsClippingArea = !0, this._isWithinClippingArea = !0), this._clippingArea = e, this.updateVisibility();\n    const n = s && this._isWithinClippingArea,\n          r = !(s || i || this._isWithinClippingArea || this._intersectsClippingArea);\n    return !this.renderData || n || r || this.setPendingUpdate(32), !0;\n  }\n\n  updateVisibility() {\n    this._dirty = !0, this._surface.setTileTreeDirty();\n  }\n\n  getLayerInfo(e, t) {\n    return this.layerInfo[t][e];\n  }\n\n  hasLayerData(e, t) {\n    const i = this.layerInfo[t][e];\n    return !(!i || !i.data || i.dataInvalidated);\n  }\n\n  get updating() {\n    if (this.hasPendingUpdates) return !0;\n\n    for (const e of x) {\n      const t = this.layerInfo[e];\n\n      for (const e of t) if (e.loadingAgent && e.loadingAgent !== P && e.loadingAgent.updating) return !0;\n    }\n\n    return !1;\n  }\n\n  isSuspended(e) {\n    return !!this.hasPendingUpdate(2) || 0 !== e && !this.loadable;\n  }\n\n  get hasPendingUpdates() {\n    return 0 !== this._pendingUpdates;\n  }\n\n  hasPendingUpdate(e) {\n    return (this._pendingUpdates & e) === e;\n  }\n\n  setPendingUpdate(e) {\n    this._pendingUpdates |= e, 2 === e || 8 === e ? this._surface.setTileTreeDirty() : this._surface.requestUpdate();\n  }\n\n  resetPendingUpdate(e) {\n    return !!this.hasPendingUpdate(e) && (this._pendingUpdates &= ~e, !0);\n  }\n\n  requestLayerData(e, t, s) {\n    const n = this.layerInfo[t][e];\n    if (n.waitingAgents.has(s)) return console.warn(\"agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)\", this.lij.toString(), s.tile.lij.toString(), t, e), !0;\n    if (n.waitingAgents.push(s), n.data && !n.dataInvalidated) return console.warn(\"agent requested existing data (tile %s, agent tile %s, layer: %d/%d)\", this.lij.toString(), s.tile.lij.toString(), t, e), s.dataArrived(this), !0;\n    if (n.requestPromise) return !0;\n    i(n.requestAbort), n.requestAbort = r();\n\n    const a = this._surface.requestTileData(this, e, t, n.requestAbort);\n\n    if (!a) return n.requestAbort = null, !1;\n\n    const o = () => {\n      n.requestPromise === a && (n.requestPromise = null, n.requestAbort = null);\n    };\n\n    return n.requestPromise = a, a.then(o, o), !0;\n  }\n\n  get isLeaf() {\n    return null == this._children[0];\n  }\n\n  hasLij(e) {\n    return this.lij[0] === e[0] && this.lij[1] === e[1] && this.lij[2] === e[2];\n  }\n\n  findByLij(e) {\n    if (this.hasLij(e)) return this;\n    if (this.isLeaf) return null;\n\n    const t = this._children[0].findByLij(e) || this._children[1].findByLij(e) || this._children[2].findByLij(e) || this._children[3].findByLij(e);\n\n    return t || null;\n  }\n\n  distanceToSquared(e) {\n    return u(d(z, this._center[1], e));\n  }\n\n  containsPoint(e) {\n    const t = this.extent;\n    return e[0] >= t[0] && e[1] >= t[1] && e[0] <= t[2] && e[1] <= t[3];\n  }\n\n  unrequestLayerData(e, t, i) {\n    const s = this.layerInfo[t][e],\n          n = s.waitingAgents,\n          r = null != n.removeUnordered(i);\n    q(r, \"agent has not requested this piece of map data\"), n.length < 1 && (s.abortRequest(), this._updateMemoryUsed());\n  }\n\n  dataArrived(e, t, i) {\n    const s = this.layerInfo[t][e];\n    s.data = i, s.dataInvalidated = !1, s.waitingAgents.forAll(e => e.dataArrived(this)), s.waitingAgents.clear(), this._updateMemoryUsed();\n  }\n\n  dataMissing(e, t, i) {\n    i.notInTilemap || console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${i}`);\n    const s = this.layerInfo[t][e];\n    s.dataMissing = !0, s.waitingAgents.forAll(e => e.dataMissing()), s.waitingAgents.clear(), this._updateMemoryUsed();\n  }\n\n  updateRenderData(e) {\n    switch (e) {\n      case 1:\n        return this.updateTexture();\n\n      case 0:\n        return this.updateGeometry();\n    }\n  }\n\n  updateTexture() {\n    this.renderData && this.setPendingUpdate(64);\n  }\n\n  updateGeometry() {\n    this.setPendingUpdate(32);\n\n    for (const e of this.layerInfo[0]) e.pendingUpdates |= 32;\n  }\n\n  invalidateLayerData(e, t) {\n    this.layerInfo[t][e].invalidateSourceData(), this.restartAgents(t);\n  }\n\n  computeElevationBounds() {\n    o(this._elevationBounds, Number.MAX_VALUE, -Number.MAX_VALUE);\n    const e = this.layerInfo[0];\n    let i = !0;\n\n    for (const s of e) t(s.elevationBounds) && (this._elevationBounds[0] = Math.min(this._elevationBounds[0], s.elevationBounds.min), this._elevationBounds[1] = Math.max(this._elevationBounds[1], s.elevationBounds.max), s.elevationBounds.hasNoDataValues || (i = !1));\n\n    i && (this._elevationBounds[0] = Math.min(this._elevationBounds[0], 0), this._elevationBounds[1] = Math.max(this._elevationBounds[1], 0)), this.updateRadiusAndCenter(), this._surface.setTileTreeDirty();\n  }\n\n  _updateCenter() {\n    const e = .5 * (this._elevationBounds[0] + this._elevationBounds[1]);\n    p(z, this.up, e), g(this._center[1], this.centerAtSeaLevel, z), p(z, this.up, this._elevationBounds[0]), g(this._center[0], this.centerAtSeaLevel, z), p(z, this.up, this._elevationBounds[1]), g(this._center[2], this.centerAtSeaLevel, z);\n  }\n\n  findElevationBoundsForLayer(e, i) {\n    const n = this.layerInfo[0][e];\n    if (t(n.elevationBounds) && n.elevationBounds.level >= i) return;\n\n    const r = this._surface.layerViewByIndex(e, 0),\n          a = R(r);\n\n    if (!W(this, a, !1)) return;\n    const o = K;\n    let h = !1;\n\n    if (n.data) {\n      const e = n.data;\n      o.min = e.bounds[0], o.max = e.bounds[1], o.hasNoDataValues = e.hasNoDataValues, o.level = this.lij[0], h = !0;\n    } else {\n      let t,\n          i,\n          s = 0;\n\n      for (let n = this._parent; n && (!i || s < b) && (s = this.vlevel - n.level, t = i || t, i = n.layerInfo[0][e].data, !(!i && t && s >= b)); n = n.parent);\n\n      i = i || t, i && (i.computeMinMaxValue(this.lij[0], this.lij[1], this.lij[2], o), o.min !== 1 / 0 && (o.level = i.level, h = !0));\n    }\n\n    h && (s(n.elevationBounds) && (n.elevationBounds = new U()), n.elevationBounds.copyFrom(o));\n  }\n\n  modifyLayers(e, t, i) {\n    const s = this.layerInfo[i];\n\n    for (const a of s) a.loadingAgent && a.loadingAgent !== P && (Y(a.loadingAgent), a.loadingAgent = null), a.waitingAgents.clear();\n\n    for (let a = 0; a < s.length; ++a) void 0 === e[a] && s[a].release();\n\n    const n = new Array(...s),\n          r = t.length;\n    s.length = r;\n\n    for (let a = 0; a < r; a++) {\n      const e = t[a];\n      s[a] = e > -1 ? n[e] : w.acquire(this._surface.upsampleInfoPool);\n    }\n\n    this._updateMemoryUsed();\n  }\n\n  restartAgents(e) {\n    this.renderData && (this._createOrUpdateAgents(0, e), this.updateRenderData(e));\n  }\n\n  updateAgents(e) {\n    if (this.renderData) {\n      const t = this.layerInfo[e];\n\n      for (const e of t) e.loadingAgent === P && (e.loadingAgent = null);\n\n      this._createOrUpdateAgents(0, e);\n    }\n  }\n\n  updateAgentSuspension() {\n    for (const e of x) {\n      const t = this.isSuspended(e);\n\n      for (const i of this.layerInfo[e]) i.loadingAgent && i.loadingAgent !== P && (i.loadingAgent.setSuspension(t), i.loadingAgent === P && this.updateRenderData(e));\n    }\n  }\n\n  removeLayerAgent(e, t) {\n    const i = this.layerInfo[t][e];\n    i.loadingAgent && i.loadingAgent !== P && i.loadingAgent.dispose(), i.loadingAgent = null;\n  }\n\n  agentDone(e, t) {\n    const i = this.layerInfo[t][e];\n    i.loadingAgent = P, i.data || i.upsampleInfo || this._createOrUpdateAgents(e + 1, t);\n  }\n\n  _createOrUpdateAgents(e, t) {\n    const i = this.isSuspended(t),\n          s = this.layerInfo[t];\n\n    for (let n = e; n < s.length; ++n) {\n      const e = s[n];\n      let r = !1;\n\n      const a = this._surface.layerViewByIndex(n, t),\n            o = R(a);\n\n      if (e.loadingAgent ? W(this, o, !1) ? (e.loadingAgent !== P && e.loadingAgent.setSuspension(i), e.loadingAgent !== P && (r = e.loadingAgent.update())) : e.dispose() : W(this, o, !1) && (e.loadingAgent = $(this, n, t, i), r = e.loadingAgent.startLoading(), r ? e.loadingAgent === P && this.setPendingUpdate(32) : (Y(e.loadingAgent), e.loadingAgent = P)), e.loadingAgent === P && this.updateRenderData(t), r && a.isOpaque) return;\n    }\n  }\n\n  _isWithinExtent(e) {\n    const t = this.extent;\n    return t[0] >= e[0] && e[2] >= t[2] && t[1] >= e[1] && e[3] >= t[3];\n  }\n\n  intersectsExtent(e) {\n    const t = this.extent;\n    return t[2] >= e[0] && e[2] >= t[0] && t[3] >= e[1] && e[3] >= t[1];\n  }\n\n  get test() {\n    return {\n      cachedMemory: this.cachedMemory\n    };\n  }\n\n}\n\nfunction $(e, t, i, s) {\n  const n = 0 === i ? J.acquire() : Q.acquire();\n  return n.init(e, t, i, s), n;\n}\n\nfunction Y(e) {\n  e.dispose(), e instanceof B ? J.release(e) : e instanceof C && Q.release(e);\n}\n\nconst Q = new n(C),\n      J = new n(B),\n      K = new U(),\n      Z = -1;\nexport default X;\nexport { F as SplitLimits };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/terrain/Tile.js"],"names":["log2","e","isSome","t","abortMaybe","i","isNone","s","n","createAbortController","r","c","a","o","h","g","l","f","d","p","u","b","m","_","y","v","getReferenceEllipsoid","A","create","M","equals","L","j","VectorTile","D","ImageWithType","I","ElevationBounds","U","B","C","T","LayerClasses","x","MAX_PATCH_TESSELATION","S","ELEVATION_DESIRED_RESOLUTION_LEVEL","weakAssert","q","getLayerWithExtentRange","R","TILE_AGENT_DONE","P","TilePerLayerInfo","w","E","tile2str","V","fallsWithinLayer","W","getGpuMemoryUsage","N","O","k","z","H","G","F","constructor","fovX","fovY","relativeWidthLimit","relativeHeightLimit","maxLod","angledSplitBias","aboveGround","X","_numSubdivisionAtLevel","lij","_children","_dirty","_previouslyRendered","extent","_elevationBounds","layerInfo","extentInRadians","centerAtSeaLevel","_center","up","_isWithinClippingArea","_intersectsClippingArea","_maxTesselation","_usedMemory","Z","_mapTileMemory","_mapDataRefCount","_screenDepth","renderOrder","_edgeLen","_edgeLen2","_curvatureHeight","prune","Q","J","usedMemory","_updateMemoryUsed","isCached","mapTileMemory","cachedMemory","data","memoryUsage","shouldLoad","maxTesselation","numSubdivisionsAtLevel","isWithinClippingArea","intersectsClippingArea","clippingArea","_clippingArea","parent","_parent","children","surface","_surface","elevationBounds","level","edgeLen","radius","screenDepth","visible","_isVisible","frustum","_visible","emit","renderer","setNeedsRender","updateAgentSuspension","loadable","view","state","fixedContentCamera","rendered","renderData","lodSnapping","snapLevel","isLeaf","init","ellipsoid","tilingScheme","spatialReference","getExtent","convertExtentToRadians","upsampleMapCache","pop","vlevel","_pendingUpdates","unsetChildren","updateVisibility","numLayers","release","length","acquire","upsampleInfoPool","findElevationBoundsForLayer","computeElevationBounds","Math","min","pixelSize","refMapData","unrefMapData","put","setMemoryDirty","cpuImageMemorySize","texture","HTMLImageElement","estimatedGeometryMemoryUsage","textureDescriptor","updateSize","getUsedMemoryForLayer","updateScreenDepth","shouldSplit","sqrt","ceil","sin","SQRT1_2","PI","abs","setChildren","load","_createOrUpdateAgents","loadTile","unload","unloadTile","loadingAgent","Y","pendingUpdates","resetPendingUpdate","unloadMapData","releaseTexture","updateClippingStatus","intersectsExtent","_isWithinExtent","setPendingUpdate","setTileTreeDirty","getLayerInfo","hasLayerData","dataInvalidated","updating","hasPendingUpdates","isSuspended","hasPendingUpdate","requestUpdate","requestLayerData","waitingAgents","has","console","warn","toString","tile","push","dataArrived","requestPromise","requestAbort","requestTileData","then","hasLij","findByLij","distanceToSquared","containsPoint","unrequestLayerData","removeUnordered","abortRequest","forAll","clear","dataMissing","notInTilemap","error","updateRenderData","updateTexture","updateGeometry","invalidateLayerData","invalidateSourceData","restartAgents","Number","MAX_VALUE","max","hasNoDataValues","updateRadiusAndCenter","_updateCenter","layerViewByIndex","K","bounds","computeMinMaxValue","copyFrom","modifyLayers","Array","updateAgents","setSuspension","removeLayerAgent","dispose","agentDone","upsampleInfo","update","$","startLoading","isOpaque","test","SplitLimits"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{log2 as e}from\"../../../core/mathUtils.js\";import{isSome as t,abortMaybe as i,isNone as s}from\"../../../core/maybe.js\";import n from\"../../../core/ObjectPool.js\";import{createAbortController as r}from\"../../../core/promiseUtils.js\";import{c as a,s as o}from\"../../../chunks/vec2.js\";import{a as h}from\"../../../chunks/vec2f64.js\";import{g as l,f as d,p as u,d as c,a as p,b as g,l as f}from\"../../../chunks/vec3.js\";import{c as m,u as _}from\"../../../chunks/vec3f64.js\";import{t as y}from\"../../../chunks/vec4.js\";import{c as v}from\"../../../chunks/vec4f64.js\";import{getReferenceEllipsoid as A}from\"../../../geometry/projectionEllipsoid.js\";import{create as M,equals as L}from\"../../../geometry/support/aaBoundingRect.js\";import{c as j}from\"../../../chunks/sphere.js\";import{VectorTile as D}from\"../../2d/engine/vectorTiles/VectorTile.js\";import{ImageWithType as I}from\"../support/StreamDataLoader.js\";import{ElevationBounds as U}from\"./ElevationBounds.js\";import B from\"./ElevationTileAgent.js\";import C from\"./MapTileAgent.js\";import T from\"./RasterTile.js\";import{LayerClasses as x,MAX_PATCH_TESSELATION as S,ELEVATION_DESIRED_RESOLUTION_LEVEL as b}from\"./TerrainConst.js\";import{weakAssert as q,getLayerWithExtentRange as R}from\"./terrainUtils.js\";import{TILE_AGENT_DONE as P}from\"./TileAgent.js\";import{TilePerLayerInfo as w}from\"./TilePerLayerInfo.js\";import E from\"./TileTexture.js\";import{tile2str as V,fallsWithinLayer as W}from\"./tileUtils.js\";import{getGpuMemoryUsage as N}from\"../../webgl/Util.js\";const O=m(),k=m(),z=m(),H=v(),G=.1;class F{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class X{constructor(e){this._numSubdivisionAtLevel=e,this.lij=[0,0,0],this._children=[null,null,null,null],this._dirty=!0,this._previouslyRendered=!1,this.extent=M(),this._elevationBounds=h(),this.layerInfo=[[],[]],this.extentInRadians=M(),this.centerAtSeaLevel=m(),this._center=[m(),j(),m()],this.up=_(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=Z,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){Q.prune(0),J.prune(0),w.prune()}get usedMemory(){return this._usedMemory===Z&&this._updateMemoryUsed(),this._usedMemory+(this.isCached?0:this.mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){this._usedMemory===Z&&this._updateMemoryUsed();let e=this._mapTileMemory;for(const{data:t}of this.layerInfo[1])t instanceof D&&(e+=t.memoryUsage);return e}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get numSubdivisionsAtLevel(){return this._numSubdivisionAtLevel}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get edgeLen(){return this._edgeLen}get radius(){return this._center[1][3]}get screenDepth(){return this._screenDepth}get visible(){if(this._dirty){this._dirty=!1;const e=this._isVisible(this.surface.frustum);e!==this._visible&&(this._visible=e,this._surface.emit(\"tiles-visibility-changed\"),this._surface.renderer.setNeedsRender()),this.updateAgentSuspension()}return this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit(\"tiles-visibility-changed\"),this._previouslyRendered=e,this._surface.renderer.setNeedsRender()),e}get shouldLoad(){if(!this.loadable)return!1;if(1===this._surface.lodSnapping){const e=this.level-this._surface.snapLevel;if(0===e)return!0;if(1===e)return!1}return this.isLeaf}init(e,t,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=A(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(V(this)),this._edgeLen=0,this._edgeLen2=0,this._center[1][3]=0,this.vlevel=e?e[0]:0,t&&t.elevationBounds?a(this._elevationBounds,t.elevationBounds):o(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of x){const e=i.numLayers(s),t=this.layerInfo[s];for(const i of t)i.release();t.length=e;for(let i=0;i<e;i++)t[i]=w.acquire(this._surface.upsampleInfoPool),0===s&&this.findElevationBoundsForLayer(i,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,S)}release(){q(!this.renderData,\"tile.renderData was not unloaded\"),this._surface.upsampleMapCache.pop(V(this));for(const e of x){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null,this._surface=null,this._usedMemory=Z}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(V(this))}unrefMapData(){if(--this._mapDataRefCount,this.isCached){const e=this.cachedMemory;e>0&&(this._surface.upsampleMapCache.put(V(this),this,e),this.setMemoryDirty())}}setMemoryDirty(){this._usedMemory=Z}get cpuImageMemorySize(){const e=4,t=this._surface.tilingScheme.pixelSize;return t*t*e}_updateMemoryUsed(){this._usedMemory=0,this._mapTileMemory=0;const e=this.cpuImageMemorySize;for(const{data:t}of this.layerInfo[1])t instanceof E?this._mapTileMemory+=N(t.texture):t instanceof HTMLImageElement||t instanceof I?this._mapTileMemory+=e:t instanceof T&&(this._mapTileMemory+=t.memoryUsage);for(const t of this.layerInfo[0])this._usedMemory+=t.data?e:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=N(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(V(this),this,this.cachedMemory)}getUsedMemoryForLayer(e,t){const i=this.layerInfo[e][t];if(!i||!i.data)return 0;if(1!==e||this.isCached){if(0===e)return this.cpuImageMemorySize}else{const e=i.data;if(e instanceof E)return N(e.texture);if(e instanceof HTMLImageElement||e instanceof I)return this.cpuImageMemorySize;if(e instanceof D||e instanceof T)return e.memoryUsage}return 0}updateScreenDepth(e){l(H,this._center[1]),H[3]=1,y(H,H,e),this._screenDepth=H[2]<0?0:H[2]/H[3]}shouldSplit(i,s,n){if(t(i.frustum)&&!this._isVisible(i.frustum))return 0;const r=this.level;d(O,this._center[1],s);let a=u(O),o=1;d(k,this._center[0],s);const h=u(k);h<a&&(a=h,o=0),d(k,this._center[2],s);const l=u(k);if(l<a&&(a=l,o=2),this._edgeLen2>a&&r<i.maxLod)return 2;const m=Math.sqrt(a),_=i.fovX*m*2,y=this._edgeLen/_,v=()=>{const t=r+Math.ceil(-e(i.relativeWidthLimit/y));return t!==this.vlevel?(this.vlevel=t,4):1};if(1===n){if(1===this._surface.snapLevel-r)return r>=i.maxLod?v():2}const A=c(this.up,O),M=this._elevationBounds[1]-this._elevationBounds[0],L=M/this.edgeLen;if(i.aboveGround&&A>0&&L<.001){if(A/m-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-L>0)return 0}if(y<i.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,4):0;if(r>=i.maxLod)return v();if(r>6){d(k,this._center[o],s),p(z,this.up,A),d(z,z,k);const e=u(z);if(e>this.radius*this.radius){p(z,z,this.radius/Math.sqrt(e)),g(z,z,this._center[o]),d(z,s,z);const t=Math.min(1,(Math.abs(c(z,this.up))+.5*M+this._curvatureHeight)/f(z)),n=G/i.angledSplitBias,r=i.fovY*m*2;if(t*(this._edgeLen/r)<n*i.relativeHeightLimit)return 0}}return 2}setChildren(e,t,i,s){q(!!(e&&t&&i&&s),\"Null child passed\"),this._children[0]=e,this._children[1]=t,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}load(e){this.refMapData();for(const t of x)this._createOrUpdateAgents(0,t);e.loadTile(this)}unload(e){e.unloadTile(this);for(const t of x){const e=this.layerInfo[t];for(const t of e)t.loadingAgent&&t.loadingAgent!==P&&(Y(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0}this.resetPendingUpdate(32),this.resetPendingUpdate(64),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[1];for(const t of e)t.loadingAgent&&t.loadingAgent!==P&&(Y(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(L(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,s=this._isWithinClippingArea;t(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=s&&this._isWithinClippingArea,r=!(s||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||r||this.setPendingUpdate(32),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const i=this.layerInfo[t][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of x){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==P&&e.loadingAgent.updating)return!0}return!1}isSuspended(e){return!!this.hasPendingUpdate(2)||0!==e&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,2===e||8===e?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,s){const n=this.layerInfo[t][e];if(n.waitingAgents.has(s))return console.warn(\"agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)\",this.lij.toString(),s.tile.lij.toString(),t,e),!0;if(n.waitingAgents.push(s),n.data&&!n.dataInvalidated)return console.warn(\"agent requested existing data (tile %s, agent tile %s, layer: %d/%d)\",this.lij.toString(),s.tile.lij.toString(),t,e),s.dataArrived(this),!0;if(n.requestPromise)return!0;i(n.requestAbort),n.requestAbort=r();const a=this._surface.requestTileData(this,e,t,n.requestAbort);if(!a)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===a&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=a,a.then(o,o),!0}get isLeaf(){return null==this._children[0]}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;if(this.isLeaf)return null;const t=this._children[0].findByLij(e)||this._children[1].findByLij(e)||this._children[2].findByLij(e)||this._children[3].findByLij(e);return t||null}distanceToSquared(e){return u(d(z,this._center[1],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}unrequestLayerData(e,t,i){const s=this.layerInfo[t][e],n=s.waitingAgents,r=null!=n.removeUnordered(i);q(r,\"agent has not requested this piece of map data\"),n.length<1&&(s.abortRequest(),this._updateMemoryUsed())}dataArrived(e,t,i){const s=this.layerInfo[t][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll((e=>e.dataArrived(this))),s.waitingAgents.clear(),this._updateMemoryUsed()}dataMissing(e,t,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${i}`);const s=this.layerInfo[t][e];s.dataMissing=!0,s.waitingAgents.forAll((e=>e.dataMissing())),s.waitingAgents.clear(),this._updateMemoryUsed()}updateRenderData(e){switch(e){case 1:return this.updateTexture();case 0:return this.updateGeometry()}}updateTexture(){this.renderData&&this.setPendingUpdate(64)}updateGeometry(){this.setPendingUpdate(32);for(const e of this.layerInfo[0])e.pendingUpdates|=32}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){o(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const e=this.layerInfo[0];let i=!0;for(const s of e)t(s.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],s.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(i=!1));i&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const e=.5*(this._elevationBounds[0]+this._elevationBounds[1]);p(z,this.up,e),g(this._center[1],this.centerAtSeaLevel,z),p(z,this.up,this._elevationBounds[0]),g(this._center[0],this.centerAtSeaLevel,z),p(z,this.up,this._elevationBounds[1]),g(this._center[2],this.centerAtSeaLevel,z)}findElevationBoundsForLayer(e,i){const n=this.layerInfo[0][e];if(t(n.elevationBounds)&&n.elevationBounds.level>=i)return;const r=this._surface.layerViewByIndex(e,0),a=R(r);if(!W(this,a,!1))return;const o=K;let h=!1;if(n.data){const e=n.data;o.min=e.bounds[0],o.max=e.bounds[1],o.hasNoDataValues=e.hasNoDataValues,o.level=this.lij[0],h=!0}else{let t,i,s=0;for(let n=this._parent;n&&(!i||s<b)&&(s=this.vlevel-n.level,t=i||t,i=n.layerInfo[0][e].data,!(!i&&t&&s>=b));n=n.parent);i=i||t,i&&(i.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=i.level,h=!0))}h&&(s(n.elevationBounds)&&(n.elevationBounds=new U),n.elevationBounds.copyFrom(o))}modifyLayers(e,t,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==P&&(Y(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)void 0===e[a]&&s[a].release();const n=new Array(...s),r=t.length;s.length=r;for(let a=0;a<r;a++){const e=t[a];s[a]=e>-1?n[e]:w.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===P&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of x){const t=this.isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==P&&(i.loadingAgent.setSuspension(t),i.loadingAgent===P&&this.updateRenderData(e))}}removeLayerAgent(e,t){const i=this.layerInfo[t][e];i.loadingAgent&&i.loadingAgent!==P&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,t){const i=this.layerInfo[t][e];i.loadingAgent=P,i.data||i.upsampleInfo||this._createOrUpdateAgents(e+1,t)}_createOrUpdateAgents(e,t){const i=this.isSuspended(t),s=this.layerInfo[t];for(let n=e;n<s.length;++n){const e=s[n];let r=!1;const a=this._surface.layerViewByIndex(n,t),o=R(a);if(e.loadingAgent?W(this,o,!1)?(e.loadingAgent!==P&&e.loadingAgent.setSuspension(i),e.loadingAgent!==P&&(r=e.loadingAgent.update())):e.dispose():W(this,o,!1)&&(e.loadingAgent=$(this,n,t,i),r=e.loadingAgent.startLoading(),r?e.loadingAgent===P&&this.setPendingUpdate(32):(Y(e.loadingAgent),e.loadingAgent=P)),e.loadingAgent===P&&this.updateRenderData(t),r&&a.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}get test(){return{cachedMemory:this.cachedMemory}}}function $(e,t,i,s){const n=0===i?J.acquire():Q.acquire();return n.init(e,t,i,s),n}function Y(e){e.dispose(),e instanceof B?J.release(e):e instanceof C&&Q.release(e)}const Q=new n(C),J=new n(B),K=new U,Z=-1;export default X;export{F as SplitLimits};\n"]},"metadata":{},"sourceType":"module"}