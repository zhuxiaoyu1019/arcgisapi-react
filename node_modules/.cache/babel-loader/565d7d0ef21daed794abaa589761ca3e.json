{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport s from \"../../core/Accessor.js\";\nimport t from \"../../core/Handles.js\";\nimport { isNone as r } from \"../../core/maybe.js\";\nimport { schedule as d } from \"../../core/scheduling.js\";\nimport { init as i, on as n } from \"../../core/watchUtils.js\";\nimport { valueOf as a } from \"../../core/accessorSupport/get.js\";\nimport { reaction as o } from \"../../core/accessorSupport/trackingUtils.js\";\nimport { property as h } from \"../../core/accessorSupport/decorators/property.js\";\nimport { subclass as c } from \"../../core/accessorSupport/decorators/subclass.js\";\nlet l = class extends s {\n  constructor() {\n    super(...arguments), this.updating = !1, this.handleId = 0, this.handles = new t(), this.scheduleHandleId = 0, this.pendingPromises = new Set();\n  }\n\n  destroy() {\n    this.removeAll(), this.handles.destroy();\n  }\n\n  add(e, s, t, r = 0) {\n    const d = 0 != (1 & r),\n          n = ++this.handleId;\n    d || this.installSyncUpdatingWatch(e, s, n);\n    const a = 0 != (2 & r) ? i(e, s, t, d) : e.watch(s, t, d);\n    return this.handles.add(a, n), {\n      remove: () => this.handles.remove(n)\n    };\n  }\n\n  addOnCollectionPropertyChange(e, s, t, r = 0) {\n    const d = 0 != (2 & r),\n          i = ++this.handleId;\n    return this.handles.add([n(e, s, \"after-changes\", this.createSyncUpdatingCallback()), n(e, s, \"change\", t, d ? e => {\n      t({\n        added: e.items,\n        removed: [],\n        moved: [],\n        target: e\n      });\n    } : void 0)], i), {\n      remove: () => {\n        this.handles.remove(i);\n      }\n    };\n  }\n\n  addOnCollectionChange(e, s, t = 0) {\n    const r = 0 != (2 & t),\n          d = ++this.handleId;\n    return this.handles.add([e.on(\"after-changes\", this.createSyncUpdatingCallback()), e.on(\"change\", s)], d), r && s({\n      added: e.items,\n      removed: [],\n      moved: [],\n      target: e\n    }), {\n      remove: () => {\n        this.handles.remove(d);\n      }\n    };\n  }\n\n  addPromise(e) {\n    if (r(e)) return e;\n    const s = ++this.handleId;\n    this.handles.add({\n      remove: () => {\n        this.pendingPromises.delete(e) && (0 !== this.pendingPromises.size || this.handles.has(p) || this._set(\"updating\", !1));\n      }\n    }, s), this.pendingPromises.add(e), this._set(\"updating\", !0);\n\n    const t = () => this.handles.remove(s);\n\n    return e.then(t, t), e;\n  }\n\n  removeAll() {\n    this.pendingPromises.clear(), this.handles.removeAll(), this._set(\"updating\", !1);\n  }\n\n  installSyncUpdatingWatch(e, s, t) {\n    const r = this.createSyncUpdatingCallback(),\n          d = o(() => a(e, s), r);\n    return this.handles.add(d, t), d;\n  }\n\n  createSyncUpdatingCallback() {\n    return () => {\n      this.handles.remove(p), ++this.scheduleHandleId;\n      const e = this.scheduleHandleId;\n      this._get(\"updating\") || this._set(\"updating\", !0), this.handles.add(d(() => {\n        e === this.scheduleHandleId && (this._set(\"updating\", this.pendingPromises.size > 0), this.handles.remove(p));\n      }), p);\n    };\n  }\n\n};\ne([h({\n  readOnly: !0\n})], l.prototype, \"updating\", void 0), l = e([c(\"esri.views.support.WatchUpdatingTracking\")], l);\nconst p = -42;\nexport { l as WatchUpdatingTracking };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/support/WatchUpdatingTracking.js"],"names":["_","e","s","t","isNone","r","schedule","d","init","i","on","n","valueOf","a","reaction","o","property","h","subclass","c","l","constructor","arguments","updating","handleId","handles","scheduleHandleId","pendingPromises","Set","destroy","removeAll","add","installSyncUpdatingWatch","watch","remove","addOnCollectionPropertyChange","createSyncUpdatingCallback","added","items","removed","moved","target","addOnCollectionChange","addPromise","delete","size","has","p","_set","then","clear","_get","readOnly","prototype","WatchUpdatingTracking"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import s from\"../../core/Accessor.js\";import t from\"../../core/Handles.js\";import{isNone as r}from\"../../core/maybe.js\";import{schedule as d}from\"../../core/scheduling.js\";import{init as i,on as n}from\"../../core/watchUtils.js\";import{valueOf as a}from\"../../core/accessorSupport/get.js\";import{reaction as o}from\"../../core/accessorSupport/trackingUtils.js\";import{property as h}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as c}from\"../../core/accessorSupport/decorators/subclass.js\";let l=class extends s{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new t,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,s,t,r=0){const d=0!=(1&r),n=++this.handleId;d||this.installSyncUpdatingWatch(e,s,n);const a=0!=(2&r)?i(e,s,t,d):e.watch(s,t,d);return this.handles.add(a,n),{remove:()=>this.handles.remove(n)}}addOnCollectionPropertyChange(e,s,t,r=0){const d=0!=(2&r),i=++this.handleId;return this.handles.add([n(e,s,\"after-changes\",this.createSyncUpdatingCallback()),n(e,s,\"change\",t,d?e=>{t({added:e.items,removed:[],moved:[],target:e})}:void 0)],i),{remove:()=>{this.handles.remove(i)}}}addOnCollectionChange(e,s,t=0){const r=0!=(2&t),d=++this.handleId;return this.handles.add([e.on(\"after-changes\",this.createSyncUpdatingCallback()),e.on(\"change\",s)],d),r&&s({added:e.items,removed:[],moved:[],target:e}),{remove:()=>{this.handles.remove(d)}}}addPromise(e){if(r(e))return e;const s=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(p)||this._set(\"updating\",!1))}},s),this.pendingPromises.add(e),this._set(\"updating\",!0);const t=()=>this.handles.remove(s);return e.then(t,t),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set(\"updating\",!1)}installSyncUpdatingWatch(e,s,t){const r=this.createSyncUpdatingCallback(),d=o((()=>a(e,s)),r);return this.handles.add(d,t),d}createSyncUpdatingCallback(){return()=>{this.handles.remove(p),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.handles.add(d((()=>{e===this.scheduleHandleId&&(this._set(\"updating\",this.pendingPromises.size>0),this.handles.remove(p))})),p)}}};e([h({readOnly:!0})],l.prototype,\"updating\",void 0),l=e([c(\"esri.views.support.WatchUpdatingTracking\")],l);const p=-42;export{l as WatchUpdatingTracking};\n"]},"metadata":{},"sourceType":"module"}