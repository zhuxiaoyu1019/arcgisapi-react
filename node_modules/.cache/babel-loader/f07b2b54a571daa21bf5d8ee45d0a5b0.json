{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isNone as e } from \"../../../../core/maybe.js\";\nimport { getBasisTranscoder as t } from \"../../../../libs/basisu/BasisU.js\";\nimport n from \"../../../webgl/Texture.js\";\nimport { getBytesPerElementFormat as r } from \"../../../webgl/Util.js\";\nlet s = null,\n    i = null;\n\nasync function a() {\n  return e(i) && (i = t(), s = await i), i;\n}\n\nfunction o(t, n) {\n  if (e(s)) return t.byteLength;\n  const r = new s.BasisFile(new Uint8Array(t)),\n        i = c(r) ? l(r.getNumLevels(0), r.getHasAlpha(), r.getImageWidth(0, 0), r.getImageHeight(0, 0), n) : 0;\n  return r.close(), r.delete(), i;\n}\n\nfunction g(t, n) {\n  if (e(s)) return t.byteLength;\n  const r = new s.KTX2File(new Uint8Array(t)),\n        i = u(r) ? l(r.getLevels(), r.getHasAlpha(), r.getWidth(), r.getHeight(), n) : 0;\n  return r.close(), r.delete(), i;\n}\n\nfunction l(e, t, n, s, i) {\n  const a = r(t ? 37496 : 37492),\n        o = i && e > 1 ? (4 ** e - 1) / (3 * 4 ** (e - 1)) : 1;\n  return Math.ceil(n * s * a * o);\n}\n\nfunction c(e) {\n  return e.getNumImages() >= 1 && !e.isUASTC();\n}\n\nfunction u(e) {\n  return e.getFaces() >= 1 && e.isETC1S();\n}\n\nasync function m(t, n, r) {\n  e(s) && (s = await a());\n  const i = new s.BasisFile(new Uint8Array(r));\n  if (!c(i)) return null;\n  i.startTranscoding();\n  const o = d(t, n, i.getNumLevels(0), i.getHasAlpha(), i.getImageWidth(0, 0), i.getImageHeight(0, 0), (e, t) => i.getImageTranscodedSizeInBytes(0, e, t), (e, t, n) => i.transcodeImage(n, 0, e, t, 0, 0));\n  return i.close(), i.delete(), o;\n}\n\nasync function h(t, n, r) {\n  e(s) && (s = await a());\n  const i = new s.KTX2File(new Uint8Array(r));\n  if (!u(i)) return null;\n  i.startTranscoding();\n  const o = d(t, n, i.getLevels(), i.getHasAlpha(), i.getWidth(), i.getHeight(), (e, t) => i.getImageTranscodedSizeInBytes(e, 0, 0, t), (e, t, n) => i.transcodeImage(n, e, 0, 0, t, 0, -1, -1));\n  return i.close(), i.delete(), o;\n}\n\nfunction d(e, t, r, s, i, a, o, g) {\n  const {\n    compressedTextureETC: l,\n    compressedTextureS3TC: c\n  } = e.capabilities,\n        [u, m] = l ? s ? [1, 37496] : [0, 37492] : c ? s ? [3, 33779] : [2, 33776] : [13, 6408],\n        h = t.hasMipmap ? r : Math.min(1, r),\n        d = [];\n\n  for (let n = 0; n < h; n++) d.push(new Uint8Array(o(n, u))), g(n, u, d[n]);\n\n  const p = d.length > 1,\n        f = p ? 9987 : 9729,\n        w = { ...t,\n    samplingMode: f,\n    hasMipmap: p,\n    internalFormat: m,\n    width: i,\n    height: a\n  };\n  return new n(e, w, {\n    type: \"compressed\",\n    levels: d\n  });\n}\n\nexport { m as createTextureBasis, h as createTextureKTX2, o as estimateMemoryBasis, g as estimateMemoryKTX2, a as loadBasis };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/BasisUtil.js"],"names":["isNone","e","getBasisTranscoder","t","n","getBytesPerElementFormat","r","s","i","a","o","byteLength","BasisFile","Uint8Array","c","l","getNumLevels","getHasAlpha","getImageWidth","getImageHeight","close","delete","g","KTX2File","u","getLevels","getWidth","getHeight","Math","ceil","getNumImages","isUASTC","getFaces","isETC1S","m","startTranscoding","d","getImageTranscodedSizeInBytes","transcodeImage","h","compressedTextureETC","compressedTextureS3TC","capabilities","hasMipmap","min","push","p","length","f","w","samplingMode","internalFormat","width","height","type","levels","createTextureBasis","createTextureKTX2","estimateMemoryBasis","estimateMemoryKTX2","loadBasis"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isNone as e}from\"../../../../core/maybe.js\";import{getBasisTranscoder as t}from\"../../../../libs/basisu/BasisU.js\";import n from\"../../../webgl/Texture.js\";import{getBytesPerElementFormat as r}from\"../../../webgl/Util.js\";let s=null,i=null;async function a(){return e(i)&&(i=t(),s=await i),i}function o(t,n){if(e(s))return t.byteLength;const r=new s.BasisFile(new Uint8Array(t)),i=c(r)?l(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),n):0;return r.close(),r.delete(),i}function g(t,n){if(e(s))return t.byteLength;const r=new s.KTX2File(new Uint8Array(t)),i=u(r)?l(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),n):0;return r.close(),r.delete(),i}function l(e,t,n,s,i){const a=r(t?37496:37492),o=i&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(n*s*a*o)}function c(e){return e.getNumImages()>=1&&!e.isUASTC()}function u(e){return e.getFaces()>=1&&e.isETC1S()}async function m(t,n,r){e(s)&&(s=await a());const i=new s.BasisFile(new Uint8Array(r));if(!c(i))return null;i.startTranscoding();const o=d(t,n,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((e,t)=>i.getImageTranscodedSizeInBytes(0,e,t)),((e,t,n)=>i.transcodeImage(n,0,e,t,0,0)));return i.close(),i.delete(),o}async function h(t,n,r){e(s)&&(s=await a());const i=new s.KTX2File(new Uint8Array(r));if(!u(i))return null;i.startTranscoding();const o=d(t,n,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,n)=>i.transcodeImage(n,e,0,0,t,0,-1,-1)));return i.close(),i.delete(),o}function d(e,t,r,s,i,a,o,g){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,m]=l?s?[1,37496]:[0,37492]:c?s?[3,33779]:[2,33776]:[13,6408],h=t.hasMipmap?r:Math.min(1,r),d=[];for(let n=0;n<h;n++)d.push(new Uint8Array(o(n,u))),g(n,u,d[n]);const p=d.length>1,f=p?9987:9729,w={...t,samplingMode:f,hasMipmap:p,internalFormat:m,width:i,height:a};return new n(e,w,{type:\"compressed\",levels:d})}export{m as createTextureBasis,h as createTextureKTX2,o as estimateMemoryBasis,g as estimateMemoryKTX2,a as loadBasis};\n"]},"metadata":{},"sourceType":"module"}