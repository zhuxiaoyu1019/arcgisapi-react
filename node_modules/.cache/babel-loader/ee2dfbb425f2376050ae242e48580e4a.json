{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { unwrap as e } from \"../../../../../core/maybe.js\";\nimport t from \"../../../../../core/PooledArray.js\";\n\nclass s {\n  constructor(e, s, i = 0) {\n    this._rctx = e, this._techniqueRepository = s, this._sorting = i, this._draws = new t({\n      initialSize: 32,\n      allocator: e => e || {\n        material: null,\n        geometry: null,\n        geometryRanges: null,\n        bindDrawParams: null,\n        depthSquaredHint: 0,\n        indexType: 0\n      }\n    }), this._passBoundTechniques = new Set(), this._previouslyBoundMaterials = new Map(), this._previouslyBoundDraw = new Map();\n  }\n\n  submitDraw(t, s, i, r, a) {\n    const n = this._draws.pushNew();\n\n    n.geometry = s, n.geometryRanges = i, n.material = t, n.bindDrawParams = r, n.depthSquaredHint = a, n.indexType = s.indexed ? e(s.vao.indexBuffer).indexType : 0;\n  }\n\n  dispatch(e) {\n    const t = this._rctx;\n    this._passBoundTechniques.clear(), this._previouslyBoundMaterials.clear(), this._previouslyBoundDraw.clear();\n    let s = null;\n    const r = this._draws.length;\n\n    for (let a = 0; a < r; a++) {\n      const r = this._draws.data[a],\n            n = r.geometry,\n            o = r.material.getTechnique(this._techniqueRepository, e, n.parameters);\n      o === s && 3 === o.configuration.transparencyPassType || (t.useProgram(o.program), t.setPipelineState(o.pipeline), s = o), this._passBoundTechniques.has(o) || (o.bindPass(e), this._passBoundTechniques.add(o)), t.bindVAO(n.vao), this._previouslyBoundMaterials.get(o) !== r.material && (o.bindMaterial(r.material, e), this._previouslyBoundMaterials.set(o, r.material)), this._previouslyBoundDraw.get(o) !== r.bindDrawParams && (o.bindDraw(r.bindDrawParams, r.material, e), this._previouslyBoundDraw.set(o, r.bindDrawParams));\n      const d = r.geometryRanges,\n            l = d.length;\n\n      if (0 !== r.indexType) {\n        const e = i.get(r.indexType);\n\n        for (let s = 0; s < l; s += 2) {\n          const i = d[s],\n                a = d[s + 1];\n          t.drawElements(n.primitiveType, a, r.indexType, i * e);\n        }\n      } else for (let e = 0; e < l; e += 2) {\n        const s = d[e],\n              i = d[e + 1];\n        t.drawArrays(n.primitiveType, s, i);\n      }\n    }\n  }\n\n  prepareSubmit() {\n    this._draws.clear();\n  }\n\n  finishSubmit() {\n    const e = 0 === this._sorting ? 1 : -1;\n\n    this._draws.sort((t, s) => {\n      const i = e * (t.depthSquaredHint - s.depthSquaredHint);\n      return 0 !== i ? i : t.geometry.vao.size - s.geometry.vao.size;\n    });\n  }\n\n  get count() {\n    return this._draws.length;\n  }\n\n}\n\nconst i = new Map();\ni.set(5121, 1), i.set(5123, 2), i.set(5125, 4);\nexport { s as RenderPass };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/core/renderPasses/RenderPass.js"],"names":["unwrap","e","t","s","constructor","i","_rctx","_techniqueRepository","_sorting","_draws","initialSize","allocator","material","geometry","geometryRanges","bindDrawParams","depthSquaredHint","indexType","_passBoundTechniques","Set","_previouslyBoundMaterials","Map","_previouslyBoundDraw","submitDraw","r","a","n","pushNew","indexed","vao","indexBuffer","dispatch","clear","length","data","o","getTechnique","parameters","configuration","transparencyPassType","useProgram","program","setPipelineState","pipeline","has","bindPass","add","bindVAO","get","bindMaterial","set","bindDraw","d","l","drawElements","primitiveType","drawArrays","prepareSubmit","finishSubmit","sort","size","count","RenderPass"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{unwrap as e}from\"../../../../../core/maybe.js\";import t from\"../../../../../core/PooledArray.js\";class s{constructor(e,s,i=0){this._rctx=e,this._techniqueRepository=s,this._sorting=i,this._draws=new t({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}submitDraw(t,s,i,r,a){const n=this._draws.pushNew();n.geometry=s,n.geometryRanges=i,n.material=t,n.bindDrawParams=r,n.depthSquaredHint=a,n.indexType=s.indexed?e(s.vao.indexBuffer).indexType:0}dispatch(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let s=null;const r=this._draws.length;for(let a=0;a<r;a++){const r=this._draws.data[a],n=r.geometry,o=r.material.getTechnique(this._techniqueRepository,e,n.parameters);o===s&&3===o.configuration.transparencyPassType||(t.useProgram(o.program),t.setPipelineState(o.pipeline),s=o),this._passBoundTechniques.has(o)||(o.bindPass(e),this._passBoundTechniques.add(o)),t.bindVAO(n.vao),this._previouslyBoundMaterials.get(o)!==r.material&&(o.bindMaterial(r.material,e),this._previouslyBoundMaterials.set(o,r.material)),this._previouslyBoundDraw.get(o)!==r.bindDrawParams&&(o.bindDraw(r.bindDrawParams,r.material,e),this._previouslyBoundDraw.set(o,r.bindDrawParams));const d=r.geometryRanges,l=d.length;if(0!==r.indexType){const e=i.get(r.indexType);for(let s=0;s<l;s+=2){const i=d[s],a=d[s+1];t.drawElements(n.primitiveType,a,r.indexType,i*e)}}else for(let e=0;e<l;e+=2){const s=d[e],i=d[e+1];t.drawArrays(n.primitiveType,s,i)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=0===this._sorting?1:-1;this._draws.sort(((t,s)=>{const i=e*(t.depthSquaredHint-s.depthSquaredHint);return 0!==i?i:t.geometry.vao.size-s.geometry.vao.size}))}get count(){return this._draws.length}}const i=new Map;i.set(5121,1),i.set(5123,2),i.set(5125,4);export{s as RenderPass};\n"]},"metadata":{},"sourceType":"module"}