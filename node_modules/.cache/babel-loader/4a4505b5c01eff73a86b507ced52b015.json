{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { disposeMaybe as e, isNone as t, isSome as r } from \"../../../../core/maybe.js\";\nimport \"../../../webgl/BufferObject.js\";\nimport \"../../../webgl/FramebufferObject.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../webgl/enums.js\";\nimport \"../../../webgl/RenderingContext.js\";\nimport \"../../../../chunks/builtins.js\";\nimport n from \"../../../webgl/Texture.js\";\nimport \"../../../webgl/VertexArrayObject.js\";\n\nclass s {\n  constructor(e) {\n    this._rctx = e, this.cache = new Map();\n  }\n\n  dispose() {\n    this.cache.forEach(t => t.texture = e(t.texture)), this.cache.clear();\n  }\n\n  acquire(e) {\n    if (t(e)) return null;\n    const r = this.patternId(e),\n          s = this.cache.get(r);\n    if (s) return s.refCount++, s.bind;\n    const i = 2,\n          o = this.patternToTextureData(e, 2),\n          a = o.length / i,\n          c = {\n      refCount: 1,\n      texture: null,\n      bind: e => (t(c.texture) && (c.texture = new n(this._rctx, {\n        width: o.length,\n        height: 1,\n        internalFormat: 6406,\n        pixelFormat: 6406,\n        dataType: 5121,\n        wrapMode: 33071\n      }, o)), e.bindTexture(c.texture, \"stipplePatternTexture\"), a)\n    };\n    return this.cache.set(r, c), c.bind;\n  }\n\n  release(e) {\n    if (t(e)) return;\n    const n = this.patternId(e),\n          s = this.cache.get(n);\n    s && (s.refCount--, 0 === s.refCount && (r(s.texture) && s.texture.dispose(), this.cache.delete(n)));\n  }\n\n  swap(e, t) {\n    const r = this.acquire(t);\n    return this.release(e), r;\n  }\n\n  patternId(e) {\n    return e.join(\",\");\n  }\n\n  patternToTextureData(e, t) {\n    const r = e.reduce((e, t) => e + t) * t,\n          n = new Uint8Array(r);\n    let s = !0,\n        i = 0;\n\n    for (const o of e) {\n      for (let e = 0; e < o * t; e++) n[i++] = s ? 255 : 0;\n\n      s = !s;\n    }\n\n    return n;\n  }\n\n}\n\nexport { s as StippleTextureRepository };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/materials/StippleTextureRepository.js"],"names":["disposeMaybe","e","isNone","t","isSome","r","n","s","constructor","_rctx","cache","Map","dispose","forEach","texture","clear","acquire","patternId","get","refCount","bind","i","o","patternToTextureData","a","length","c","width","height","internalFormat","pixelFormat","dataType","wrapMode","bindTexture","set","release","delete","swap","join","reduce","Uint8Array","StippleTextureRepository"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as e,isNone as t,isSome as r}from\"../../../../core/maybe.js\";import\"../../../webgl/BufferObject.js\";import\"../../../webgl/FramebufferObject.js\";import\"../../../../core/has.js\";import\"../../../webgl/enums.js\";import\"../../../webgl/RenderingContext.js\";import\"../../../../chunks/builtins.js\";import n from\"../../../webgl/Texture.js\";import\"../../../webgl/VertexArrayObject.js\";class s{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach((t=>t.texture=e(t.texture))),this.cache.clear()}acquire(e){if(t(e))return null;const r=this.patternId(e),s=this.cache.get(r);if(s)return s.refCount++,s.bind;const i=2,o=this.patternToTextureData(e,2),a=o.length/i,c={refCount:1,texture:null,bind:e=>(t(c.texture)&&(c.texture=new n(this._rctx,{width:o.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},o)),e.bindTexture(c.texture,\"stipplePatternTexture\"),a)};return this.cache.set(r,c),c.bind}release(e){if(t(e))return;const n=this.patternId(e),s=this.cache.get(n);s&&(s.refCount--,0===s.refCount&&(r(s.texture)&&s.texture.dispose(),this.cache.delete(n)))}swap(e,t){const r=this.acquire(t);return this.release(e),r}patternId(e){return e.join(\",\")}patternToTextureData(e,t){const r=e.reduce(((e,t)=>e+t))*t,n=new Uint8Array(r);let s=!0,i=0;for(const o of e){for(let e=0;e<o*t;e++)n[i++]=s?255:0;s=!s}return n}}export{s as StippleTextureRepository};\n"]},"metadata":{},"sourceType":"module"}