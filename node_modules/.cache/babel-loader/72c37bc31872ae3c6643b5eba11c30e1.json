{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../core/maybe.js\";\nimport { I as i } from \"../../../../chunks/mat4f64.js\";\nimport { f as s } from \"../../../../chunks/vec3.js\";\nimport { c as r } from \"../../../../chunks/vec3f64.js\";\nimport { projectBuffer as e } from \"../../../../geometry/projection.js\";\nimport { Geometry as o } from \"./Geometry.js\";\nimport { fromValues as n } from \"./localOrigin.js\";\nimport { Object3D as a } from \"./Object3D.js\";\nimport { WebGLLayer as h } from \"./WebGLLayer.js\";\nimport { RibbonLineMaterial as c } from \"../materials/RibbonLineMaterial.js\";\nlet _ = 0;\nconst m = \"rg_\";\n\nclass d {\n  constructor(t) {\n    this._originSR = t, this.ROOT_ORIGIN_ID = m + \"root_\" + _++, this._origins = new Map(), this._gridSize = 125e4, this._objects = new Map();\n  }\n\n  getOrigin(i) {\n    const r = this._origins.get(this.ROOT_ORIGIN_ID);\n\n    if (null == r) {\n      if (t(g)) return this._origins.set(this.ROOT_ORIGIN_ID, n(g[0], g[1], g[2], this.ROOT_ORIGIN_ID)), this.getOrigin(i);\n      const s = n(i[0] + Math.random() - .5, i[1] + Math.random() - .5, i[2] + Math.random() - .5, this.ROOT_ORIGIN_ID);\n      return this._origins.set(this.ROOT_ORIGIN_ID, s), s;\n    }\n\n    const e = this._gridSize,\n          o = Math.round(i[0] / e),\n          a = Math.round(i[1] / e),\n          h = Math.round(i[2] / e),\n          c = `${m}${o}/${a}/${h}`;\n\n    let _ = this._origins.get(c);\n\n    const d = .5 * e;\n\n    if (s(f, i, r.vec3), f[0] = Math.abs(f[0]), f[1] = Math.abs(f[1]), f[2] = Math.abs(f[2]), f[0] < d && f[1] < d && f[2] < d) {\n      if (_) {\n        const t = Math.max(...f);\n        s(f, i, _.vec3), f[0] = Math.abs(f[0]), f[1] = Math.abs(f[1]), f[2] = Math.abs(f[2]);\n        if (Math.max(...f) < t) return _;\n      }\n\n      return r;\n    }\n\n    return _ || (_ = n(o * e, a * e, h * e, c), this._origins.set(c, _)), _;\n  }\n\n  _drawOriginBox(t, s = [1, 1, 0, 1]) {\n    const r = window.view,\n          n = r._stage,\n          _ = s.toString();\n\n    if (!this._objects.has(_)) {\n      this._material = new c({\n        width: 2,\n        color: s\n      }), n.add(this._material);\n      const t = new h({\n        isPickable: !1\n      }),\n            i = new a({\n        castShadow: !1\n      });\n      n.add(i), t.add(i), n.add(t), this._objects.set(_, i);\n    }\n\n    const m = this._objects.get(_),\n          d = [0, 1, 5, 4, 0, 2, 1, 7, 6, 2, 0, 1, 3, 7, 5, 4, 6, 2, 0],\n          g = d.length,\n          O = new Array(3 * g),\n          f = new Uint16Array(2 * (g - 1)),\n          l = .5 * this._gridSize;\n\n    for (let i = 0; i < g; i++) O[3 * i + 0] = t[0] + (1 & d[i] ? l : -l), O[3 * i + 1] = t[1] + (2 & d[i] ? l : -l), O[3 * i + 2] = t[2] + (4 & d[i] ? l : -l), i > 0 && (f[2 * i + 0] = i - 1, f[2 * i + 1] = i);\n\n    e(O, this._originSR, 0, O, r.renderSpatialReference, 0, g);\n    const I = new o([[\"position\", {\n      size: 3,\n      data: O,\n      exclusive: !0\n    }]], [[\"position\", f]], 2);\n    n.add(I), m.addGeometry(I, this._material, i);\n  }\n\n  get test() {\n    const t = this;\n    return {\n      get gridSize() {\n        return t._gridSize;\n      },\n\n      set gridSize(i) {\n        t._gridSize = i;\n      }\n\n    };\n  }\n\n}\n\nlet g = null;\n\nfunction O(t) {\n  g = t;\n}\n\nconst f = r();\nexport { d as GridLocalOriginFactory, O as setTestRootOrigin };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/GridLocalOriginFactory.js"],"names":["isSome","t","I","i","f","s","c","r","projectBuffer","e","Geometry","o","fromValues","n","Object3D","a","WebGLLayer","h","RibbonLineMaterial","_","m","d","constructor","_originSR","ROOT_ORIGIN_ID","_origins","Map","_gridSize","_objects","getOrigin","get","g","set","Math","random","round","vec3","abs","max","_drawOriginBox","window","view","_stage","toString","has","_material","width","color","add","isPickable","castShadow","length","O","Array","Uint16Array","l","renderSpatialReference","size","data","exclusive","addGeometry","test","gridSize","GridLocalOriginFactory","setTestRootOrigin"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../core/maybe.js\";import{I as i}from\"../../../../chunks/mat4f64.js\";import{f as s}from\"../../../../chunks/vec3.js\";import{c as r}from\"../../../../chunks/vec3f64.js\";import{projectBuffer as e}from\"../../../../geometry/projection.js\";import{Geometry as o}from\"./Geometry.js\";import{fromValues as n}from\"./localOrigin.js\";import{Object3D as a}from\"./Object3D.js\";import{WebGLLayer as h}from\"./WebGLLayer.js\";import{RibbonLineMaterial as c}from\"../materials/RibbonLineMaterial.js\";let _=0;const m=\"rg_\";class d{constructor(t){this._originSR=t,this.ROOT_ORIGIN_ID=m+\"root_\"+_++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}getOrigin(i){const r=this._origins.get(this.ROOT_ORIGIN_ID);if(null==r){if(t(g))return this._origins.set(this.ROOT_ORIGIN_ID,n(g[0],g[1],g[2],this.ROOT_ORIGIN_ID)),this.getOrigin(i);const s=n(i[0]+Math.random()-.5,i[1]+Math.random()-.5,i[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,s),s}const e=this._gridSize,o=Math.round(i[0]/e),a=Math.round(i[1]/e),h=Math.round(i[2]/e),c=`${m}${o}/${a}/${h}`;let _=this._origins.get(c);const d=.5*e;if(s(f,i,r.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]),f[0]<d&&f[1]<d&&f[2]<d){if(_){const t=Math.max(...f);s(f,i,_.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]);if(Math.max(...f)<t)return _}return r}return _||(_=n(o*e,a*e,h*e,c),this._origins.set(c,_)),_}_drawOriginBox(t,s=[1,1,0,1]){const r=window.view,n=r._stage,_=s.toString();if(!this._objects.has(_)){this._material=new c({width:2,color:s}),n.add(this._material);const t=new h({isPickable:!1}),i=new a({castShadow:!1});n.add(i),t.add(i),n.add(t),this._objects.set(_,i)}const m=this._objects.get(_),d=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],g=d.length,O=new Array(3*g),f=new Uint16Array(2*(g-1)),l=.5*this._gridSize;for(let i=0;i<g;i++)O[3*i+0]=t[0]+(1&d[i]?l:-l),O[3*i+1]=t[1]+(2&d[i]?l:-l),O[3*i+2]=t[2]+(4&d[i]?l:-l),i>0&&(f[2*i+0]=i-1,f[2*i+1]=i);e(O,this._originSR,0,O,r.renderSpatialReference,0,g);const I=new o([[\"position\",{size:3,data:O,exclusive:!0}]],[[\"position\",f]],2);n.add(I),m.addGeometry(I,this._material,i)}get test(){const t=this;return{get gridSize(){return t._gridSize},set gridSize(i){t._gridSize=i}}}}let g=null;function O(t){g=t}const f=r();export{d as GridLocalOriginFactory,O as setTestRootOrigin};\n"]},"metadata":{},"sourceType":"module"}