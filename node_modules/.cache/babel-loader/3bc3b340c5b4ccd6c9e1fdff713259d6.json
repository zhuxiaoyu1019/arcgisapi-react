{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { isAbortError as t } from \"../../../../core/promiseUtils.js\";\nimport { PlacementEngine as s } from \"./Placement.js\";\nimport r from \"./TileParser.js\";\nimport { TileStatus as i } from \"../../tiling/enums.js\";\n\nclass n {\n  constructor(e, t, r, n) {\n    this.status = i.INITIALIZED, this.placementEngine = new s(), this.tileKey = e, this.refKeys = t, this._workerTileHandler = r, this._styleRepository = n;\n  }\n\n  release() {\n    this.tileKey = \"\", this.refKeys = null, this.status = i.INITIALIZED, this._workerTileHandler = null;\n  }\n\n  async parse(s, r, n) {\n    const a = n && n.signal;\n\n    if (e(a)) {\n      const e = () => {\n        a.removeEventListener(\"abort\", e), this.status = i.INVALID;\n      };\n\n      a.addEventListener(\"abort\", e);\n    }\n\n    let o;\n\n    try {\n      o = await this._parse(s, n);\n    } catch (h) {\n      if (t(h)) throw h;\n      return {\n        result: [],\n        transferList: []\n      };\n    }\n\n    this.status = i.READY;\n    const l = [];\n\n    for (const e of o) {\n      const t = e.serialize();\n      l.push(t);\n    }\n\n    return {\n      result: l,\n      transferList: l.length <= r && l\n    };\n  }\n\n  setObsolete() {\n    this.status = i.INVALID;\n  }\n\n  getLayers() {\n    return this._workerTileHandler.getLayers();\n  }\n\n  getWorkerTileHandler() {\n    return this._workerTileHandler;\n  }\n\n  async _parse(e, t) {\n    const s = e.sourceName2DataAndRefKey;\n    if (0 === Object.keys(s).length) return [];\n    this.status = i.MODIFIED;\n    return new r(s, this, t.client, this._styleRepository, e.styleLayerUIDs).parse(t);\n  }\n\n}\n\nexport default n;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/WorkerTile.js"],"names":["isSome","e","isAbortError","t","PlacementEngine","s","r","TileStatus","i","n","constructor","status","INITIALIZED","placementEngine","tileKey","refKeys","_workerTileHandler","_styleRepository","release","parse","a","signal","removeEventListener","INVALID","addEventListener","o","_parse","h","result","transferList","READY","l","serialize","push","length","setObsolete","getLayers","getWorkerTileHandler","sourceName2DataAndRefKey","Object","keys","MODIFIED","client","styleLayerUIDs"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{isAbortError as t}from\"../../../../core/promiseUtils.js\";import{PlacementEngine as s}from\"./Placement.js\";import r from\"./TileParser.js\";import{TileStatus as i}from\"../../tiling/enums.js\";class n{constructor(e,t,r,n){this.status=i.INITIALIZED,this.placementEngine=new s,this.tileKey=e,this.refKeys=t,this._workerTileHandler=r,this._styleRepository=n}release(){this.tileKey=\"\",this.refKeys=null,this.status=i.INITIALIZED,this._workerTileHandler=null}async parse(s,r,n){const a=n&&n.signal;if(e(a)){const e=()=>{a.removeEventListener(\"abort\",e),this.status=i.INVALID};a.addEventListener(\"abort\",e)}let o;try{o=await this._parse(s,n)}catch(h){if(t(h))throw h;return{result:[],transferList:[]}}this.status=i.READY;const l=[];for(const e of o){const t=e.serialize();l.push(t)}return{result:l,transferList:l.length<=r&&l}}setObsolete(){this.status=i.INVALID}getLayers(){return this._workerTileHandler.getLayers()}getWorkerTileHandler(){return this._workerTileHandler}async _parse(e,t){const s=e.sourceName2DataAndRefKey;if(0===Object.keys(s).length)return[];this.status=i.MODIFIED;return new r(s,this,t.client,this._styleRepository,e.styleLayerUIDs).parse(t)}}export default n;\n"]},"metadata":{},"sourceType":"module"}