{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport { isSome as t, isNone as s, destroyMaybe as o } from \"../../../../core/maybe.js\";\nimport { throwIfAborted as u, createAbortError as a } from \"../../../../core/promiseUtils.js\";\nimport { property as y } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as i } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { fromFeatureSetJSON as p } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nimport { runQuery as l, executeQuery as n } from \"../../../../rest/query/operations/query.js\";\nimport { PBFDecoder as c } from \"../../support/PBFDecoder.js\";\nlet d = class extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  get queryFeaturesDehydrated() {\n    const e = this.layer.capabilities,\n          r = e && e.query;\n\n    if (r && r.supportsFormatPBF) {\n      var o, y;\n      s(this._decoder) && (this._decoder = new c(this.schedule));\n      const e = {\n        sourceSpatialReference: null != (o = null == (y = this.layer.spatialReference) ? void 0 : y.toJSON()) ? o : null,\n        applyTransform: !0,\n        maxStringAttributeLength: 1024\n      };\n      return (r, s) => l(this.layer.parsedUrl, r, \"pbf\", this._createRequestOptions(s)).then(r => (u(s), t(this._decoder) ? this._decoder.invoke({\n        buffer: r.data,\n        options: e\n      }, s.signal) : Promise.reject(a())));\n    }\n\n    return (e, r) => n(this.layer.parsedUrl, e, this.layer.spatialReference, this._createRequestOptions(r)).then(e => p(e.data));\n  }\n\n  queryFeatureCount(e, r) {\n    return this.layer.queryFeatureCount(e, r);\n  }\n\n  destroy() {\n    this._decoder = o(this._decoder);\n  }\n\n  _createRequestOptions(e) {\n    return { ...e,\n      query: { ...this.layer.customParameters,\n        token: this.layer.apiKey,\n        ...(null == e ? void 0 : e.query)\n      }\n    };\n  }\n\n};\ne([y({\n  constructOnly: !0\n})], d.prototype, \"layer\", void 0), e([y({\n  constructOnly: !0\n})], d.prototype, \"schedule\", void 0), e([y({\n  readOnly: !0\n})], d.prototype, \"queryFeaturesDehydrated\", null), d = e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D\")], d);\nlet h = class extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  queryFeaturesDehydrated(e, r) {\n    return this.layer.queryFeatures(e, r);\n  }\n\n  queryFeatureCount(e, r) {\n    return this.layer.queryFeatureCount(e, r);\n  }\n\n};\ne([y({\n  constructOnly: !0\n})], h.prototype, \"layer\", void 0), e([y({\n  readOnly: !0\n})], h.prototype, \"queryFeaturesDehydrated\", null), h = e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D\")], h);\nlet m = class extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  queryFeaturesDehydrated(e, r) {\n    return this.layer.queryFeatures(e, r);\n  }\n\n};\ne([y({\n  constructOnly: !0\n})], m.prototype, \"layer\", void 0), m = e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D\")], m);\nlet f = class extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  queryFeaturesDehydrated(e, r) {\n    return this.source.queryFeaturesJSON(e, r).then(p, t => {\n      if (t && \"query-features-json:unsupported\" === t.name) return this.layer.queryFeatures(e, r);\n      throw t;\n    });\n  }\n\n  queryFeatureCount(e, r) {\n    return this.layer.queryFeatureCount(e, r);\n  }\n\n};\n\nfunction q(e, r) {\n  return \"feature\" === e.type && \"feature-layer\" === e.source.type ? t(e.infoFor3D) ? new h({\n    layer: e\n  }) : new d({\n    layer: e,\n    schedule: r\n  }) : \"feature\" === e.type && \"memory\" === e.source.type || \"csv\" === e.type || \"geojson\" === e.type || \"wfs\" === e.type ? new f({\n    layer: e,\n    source: e.source\n  }) : \"ogc-feature\" === e.type ? new m({\n    layer: e\n  }) : null;\n}\n\ne([y({\n  constructOnly: !0\n})], f.prototype, \"layer\", void 0), e([y({\n  constructOnly: !0\n})], f.prototype, \"source\", void 0), f = e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D\")], f);\nexport { q as createFeatureTileQuery3D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/support/featureTileQuery3D.js"],"names":["_","e","r","isSome","t","isNone","s","destroyMaybe","o","throwIfAborted","u","createAbortError","a","property","y","subclass","i","fromFeatureSetJSON","p","runQuery","l","executeQuery","n","PBFDecoder","c","d","constructor","queryFeaturesDehydrated","layer","capabilities","query","supportsFormatPBF","_decoder","schedule","sourceSpatialReference","spatialReference","toJSON","applyTransform","maxStringAttributeLength","parsedUrl","_createRequestOptions","then","invoke","buffer","data","options","signal","Promise","reject","queryFeatureCount","destroy","customParameters","token","apiKey","constructOnly","prototype","readOnly","h","queryFeatures","m","f","source","queryFeaturesJSON","name","q","type","infoFor3D","createFeatureTileQuery3D"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Accessor.js\";import{isSome as t,isNone as s,destroyMaybe as o}from\"../../../../core/maybe.js\";import{throwIfAborted as u,createAbortError as a}from\"../../../../core/promiseUtils.js\";import{property as y}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as i}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{fromFeatureSetJSON as p}from\"../../../../layers/graphics/dehydratedFeatures.js\";import{runQuery as l,executeQuery as n}from\"../../../../rest/query/operations/query.js\";import{PBFDecoder as c}from\"../../support/PBFDecoder.js\";let d=class extends r{constructor(e){super(e)}get queryFeaturesDehydrated(){const e=this.layer.capabilities,r=e&&e.query;if(r&&r.supportsFormatPBF){var o,y;s(this._decoder)&&(this._decoder=new c(this.schedule));const e={sourceSpatialReference:null!=(o=null==(y=this.layer.spatialReference)?void 0:y.toJSON())?o:null,applyTransform:!0,maxStringAttributeLength:1024};return(r,s)=>l(this.layer.parsedUrl,r,\"pbf\",this._createRequestOptions(s)).then((r=>(u(s),t(this._decoder)?this._decoder.invoke({buffer:r.data,options:e},s.signal):Promise.reject(a()))))}return(e,r)=>n(this.layer.parsedUrl,e,this.layer.spatialReference,this._createRequestOptions(r)).then((e=>p(e.data)))}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}destroy(){this._decoder=o(this._decoder)}_createRequestOptions(e){return{...e,query:{...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query}}}};e([y({constructOnly:!0})],d.prototype,\"layer\",void 0),e([y({constructOnly:!0})],d.prototype,\"schedule\",void 0),e([y({readOnly:!0})],d.prototype,\"queryFeaturesDehydrated\",null),d=e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D\")],d);let h=class extends r{constructor(e){super(e)}queryFeaturesDehydrated(e,r){return this.layer.queryFeatures(e,r)}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}};e([y({constructOnly:!0})],h.prototype,\"layer\",void 0),e([y({readOnly:!0})],h.prototype,\"queryFeaturesDehydrated\",null),h=e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D\")],h);let m=class extends r{constructor(e){super(e)}queryFeaturesDehydrated(e,r){return this.layer.queryFeatures(e,r)}};e([y({constructOnly:!0})],m.prototype,\"layer\",void 0),m=e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D\")],m);let f=class extends r{constructor(e){super(e)}queryFeaturesDehydrated(e,r){return this.source.queryFeaturesJSON(e,r).then(p,(t=>{if(t&&\"query-features-json:unsupported\"===t.name)return this.layer.queryFeatures(e,r);throw t}))}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}};function q(e,r){return\"feature\"===e.type&&\"feature-layer\"===e.source.type?t(e.infoFor3D)?new h({layer:e}):new d({layer:e,schedule:r}):\"feature\"===e.type&&\"memory\"===e.source.type||\"csv\"===e.type||\"geojson\"===e.type||\"wfs\"===e.type?new f({layer:e,source:e.source}):\"ogc-feature\"===e.type?new m({layer:e}):null}e([y({constructOnly:!0})],f.prototype,\"layer\",void 0),e([y({constructOnly:!0})],f.prototype,\"source\",void 0),f=e([i(\"esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D\")],f);export{q as createFeatureTileQuery3D};\n"]},"metadata":{},"sourceType":"module"}