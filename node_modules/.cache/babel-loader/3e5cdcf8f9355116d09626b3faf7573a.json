{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../config.js\";\nimport { id as o } from \"../../kernel.js\";\nimport t from \"../../PopupTemplate.js\";\nimport r from \"../../request.js\";\nimport { clone as s } from \"../../core/lang.js\";\nimport { addQueryParameters as n } from \"../../core/urlUtils.js\";\nimport i from \"../../geometry/SpatialReference.js\";\nimport { equals as f, NEGATIVE_INFINITY as a, create as l, expandWithAABB as u } from \"../../geometry/support/aaBoundingBox.js\";\nimport { getBoundsXYZ as p } from \"../../geometry/support/boundsUtils.js\";\nimport { fromJSON as m } from \"../../renderers/support/jsonUtils.js\";\nimport y from \"../../rest/support/FeatureSet.js\";\nconst c = {\n  esriGeometryPoint: \"points\",\n  esriGeometryPolyline: \"polylines\",\n  esriGeometryPolygon: \"polygons\"\n};\n\nfunction d(e) {\n  const o = e.folders || [],\n        t = o.slice(),\n        r = new Map(),\n        n = new Map(),\n        i = new Map(),\n        f = new Map(),\n        a = new Map(),\n        l = {\n    esriGeometryPoint: n,\n    esriGeometryPolyline: i,\n    esriGeometryPolygon: f\n  };\n  (e.featureCollection && e.featureCollection.layers || []).forEach(e => {\n    const o = s(e);\n    o.featureSet.features = [];\n    const t = e.featureSet.geometryType;\n    r.set(t, o);\n    const a = e.layerDefinition.objectIdField;\n    \"esriGeometryPoint\" === t ? G(n, a, e.featureSet.features) : \"esriGeometryPolyline\" === t ? G(i, a, e.featureSet.features) : \"esriGeometryPolygon\" === t && G(f, a, e.featureSet.features);\n  }), e.groundOverlays && e.groundOverlays.forEach(e => {\n    a.set(e.id, e);\n  }), o.forEach(o => {\n    o.networkLinkIds.forEach(r => {\n      const s = P(r, o.id, e.networkLinks);\n      s && t.push(s);\n    });\n  }), t.forEach(e => {\n    e.featureInfos && (e.points = s(r.get(\"esriGeometryPoint\")), e.polylines = s(r.get(\"esriGeometryPolyline\")), e.polygons = s(r.get(\"esriGeometryPolygon\")), e.mapImages = [], e.featureInfos.map(o => {\n      switch (o.type) {\n        case \"esriGeometryPoint\":\n        case \"esriGeometryPolyline\":\n        case \"esriGeometryPolygon\":\n          {\n            const t = l[o.type].get(o.id);\n            t && e[c[o.type]].featureSet.features.push(t);\n            break;\n          }\n\n        case \"GroundOverlay\":\n          {\n            const t = a.get(o.id);\n            t && e.mapImages.push(t);\n            break;\n          }\n      }\n    }), e.fullExtent = j([e]));\n  });\n  const u = j(t);\n  return {\n    folders: o,\n    sublayers: t,\n    extent: u\n  };\n}\n\nfunction g(t, s, i, f) {\n  const a = o && o.findCredential(t);\n  t = n(t, {\n    token: a && a.token\n  });\n  const l = e.kmlServiceUrl;\n  return r(l, {\n    query: {\n      url: t,\n      model: \"simple\",\n      folders: \"\",\n      refresh: 0 !== i || void 0,\n      outSR: JSON.stringify(s)\n    },\n    responseType: \"json\",\n    signal: f\n  });\n}\n\nfunction S(e, o, t = null, r = []) {\n  const s = [],\n        n = {},\n        i = o.sublayers,\n        f = o.folders.map(e => e.id);\n  return i.forEach(o => {\n    const i = new e();\n\n    if (t ? i.read(o, t) : i.read(o), r.length && f.indexOf(i.id) > -1 && (i.visible = -1 !== r.indexOf(i.id)), n[o.id] = i, null != o.parentFolderId && -1 !== o.parentFolderId) {\n      const e = n[o.parentFolderId];\n      e.sublayers || (e.sublayers = []), e.sublayers.unshift(i);\n    } else s.unshift(i);\n  }), s;\n}\n\nfunction G(e, o, t) {\n  t.forEach(t => {\n    e.set(t.attributes[o], t);\n  });\n}\n\nfunction h(e, o) {\n  let t;\n  return o.some(o => o.id === e && (t = o, !0)), t;\n}\n\nfunction P(e, o, t) {\n  const r = h(e, t);\n  return r && (r.parentFolderId = o, r.networkLink = r), r;\n}\n\nasync function b(e) {\n  const o = y.fromJSON(e.featureSet).features,\n        r = e.layerDefinition,\n        s = m(r.drawingInfo.renderer),\n        n = t.fromJSON(e.popupInfo),\n        i = [];\n\n  for (const t of o) {\n    const e = await s.getSymbolAsync(t);\n    t.symbol = e, t.popupTemplate = n, t.visible = !0, i.push(t);\n  }\n\n  return i;\n}\n\nfunction j(e) {\n  const o = l(),\n        t = l(a);\n\n  for (const r of e) {\n    if (r.polygons && r.polygons.featureSet && r.polygons.featureSet.features) for (const e of r.polygons.featureSet.features) p(o, e.geometry), u(t, o);\n    if (r.polylines && r.polylines.featureSet && r.polylines.featureSet.features) for (const e of r.polylines.featureSet.features) p(o, e.geometry), u(t, o);\n    if (r.points && r.points.featureSet && r.points.featureSet.features) for (const e of r.points.featureSet.features) p(o, e.geometry), u(t, o);\n    if (r.mapImages) for (const e of r.mapImages) p(o, e.extent), u(t, o);\n  }\n\n  return f(t, a) ? null : {\n    xmin: t[0],\n    ymin: t[1],\n    zmin: t[2],\n    xmax: t[3],\n    ymax: t[4],\n    zmax: t[5],\n    spatialReference: i.WGS84\n  };\n}\n\nexport { j as computeExtent, g as fetchService, b as getGraphics, d as parseKML, S as sublayersFromJSON };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/layers/support/kmlUtils.js"],"names":["e","id","o","t","r","clone","s","addQueryParameters","n","i","equals","f","NEGATIVE_INFINITY","a","create","l","expandWithAABB","u","getBoundsXYZ","p","fromJSON","m","y","c","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","d","folders","slice","Map","featureCollection","layers","forEach","featureSet","features","geometryType","set","layerDefinition","objectIdField","G","groundOverlays","networkLinkIds","P","networkLinks","push","featureInfos","points","get","polylines","polygons","mapImages","map","type","fullExtent","j","sublayers","extent","g","findCredential","token","kmlServiceUrl","query","url","model","refresh","outSR","JSON","stringify","responseType","signal","S","read","length","indexOf","visible","parentFolderId","unshift","attributes","h","some","networkLink","b","drawingInfo","renderer","popupInfo","getSymbolAsync","symbol","popupTemplate","geometry","xmin","ymin","zmin","xmax","ymax","zmax","spatialReference","WGS84","computeExtent","fetchService","getGraphics","parseKML","sublayersFromJSON"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../config.js\";import{id as o}from\"../../kernel.js\";import t from\"../../PopupTemplate.js\";import r from\"../../request.js\";import{clone as s}from\"../../core/lang.js\";import{addQueryParameters as n}from\"../../core/urlUtils.js\";import i from\"../../geometry/SpatialReference.js\";import{equals as f,NEGATIVE_INFINITY as a,create as l,expandWithAABB as u}from\"../../geometry/support/aaBoundingBox.js\";import{getBoundsXYZ as p}from\"../../geometry/support/boundsUtils.js\";import{fromJSON as m}from\"../../renderers/support/jsonUtils.js\";import y from\"../../rest/support/FeatureSet.js\";const c={esriGeometryPoint:\"points\",esriGeometryPolyline:\"polylines\",esriGeometryPolygon:\"polygons\"};function d(e){const o=e.folders||[],t=o.slice(),r=new Map,n=new Map,i=new Map,f=new Map,a=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:i,esriGeometryPolygon:f};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const o=s(e);o.featureSet.features=[];const t=e.featureSet.geometryType;r.set(t,o);const a=e.layerDefinition.objectIdField;\"esriGeometryPoint\"===t?G(n,a,e.featureSet.features):\"esriGeometryPolyline\"===t?G(i,a,e.featureSet.features):\"esriGeometryPolygon\"===t&&G(f,a,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{a.set(e.id,e)})),o.forEach((o=>{o.networkLinkIds.forEach((r=>{const s=P(r,o.id,e.networkLinks);s&&t.push(s)}))})),t.forEach((e=>{e.featureInfos&&(e.points=s(r.get(\"esriGeometryPoint\")),e.polylines=s(r.get(\"esriGeometryPolyline\")),e.polygons=s(r.get(\"esriGeometryPolygon\")),e.mapImages=[],e.featureInfos.map((o=>{switch(o.type){case\"esriGeometryPoint\":case\"esriGeometryPolyline\":case\"esriGeometryPolygon\":{const t=l[o.type].get(o.id);t&&e[c[o.type]].featureSet.features.push(t);break}case\"GroundOverlay\":{const t=a.get(o.id);t&&e.mapImages.push(t);break}}})),e.fullExtent=j([e]))}));const u=j(t);return{folders:o,sublayers:t,extent:u}}function g(t,s,i,f){const a=o&&o.findCredential(t);t=n(t,{token:a&&a.token});const l=e.kmlServiceUrl;return r(l,{query:{url:t,model:\"simple\",folders:\"\",refresh:0!==i||void 0,outSR:JSON.stringify(s)},responseType:\"json\",signal:f})}function S(e,o,t=null,r=[]){const s=[],n={},i=o.sublayers,f=o.folders.map((e=>e.id));return i.forEach((o=>{const i=new e;if(t?i.read(o,t):i.read(o),r.length&&f.indexOf(i.id)>-1&&(i.visible=-1!==r.indexOf(i.id)),n[o.id]=i,null!=o.parentFolderId&&-1!==o.parentFolderId){const e=n[o.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(i)}else s.unshift(i)})),s}function G(e,o,t){t.forEach((t=>{e.set(t.attributes[o],t)}))}function h(e,o){let t;return o.some((o=>o.id===e&&(t=o,!0))),t}function P(e,o,t){const r=h(e,t);return r&&(r.parentFolderId=o,r.networkLink=r),r}async function b(e){const o=y.fromJSON(e.featureSet).features,r=e.layerDefinition,s=m(r.drawingInfo.renderer),n=t.fromJSON(e.popupInfo),i=[];for(const t of o){const e=await s.getSymbolAsync(t);t.symbol=e,t.popupTemplate=n,t.visible=!0,i.push(t)}return i}function j(e){const o=l(),t=l(a);for(const r of e){if(r.polygons&&r.polygons.featureSet&&r.polygons.featureSet.features)for(const e of r.polygons.featureSet.features)p(o,e.geometry),u(t,o);if(r.polylines&&r.polylines.featureSet&&r.polylines.featureSet.features)for(const e of r.polylines.featureSet.features)p(o,e.geometry),u(t,o);if(r.points&&r.points.featureSet&&r.points.featureSet.features)for(const e of r.points.featureSet.features)p(o,e.geometry),u(t,o);if(r.mapImages)for(const e of r.mapImages)p(o,e.extent),u(t,o)}return f(t,a)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:i.WGS84}}export{j as computeExtent,g as fetchService,b as getGraphics,d as parseKML,S as sublayersFromJSON};\n"]},"metadata":{},"sourceType":"module"}