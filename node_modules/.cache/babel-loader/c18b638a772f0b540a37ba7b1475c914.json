{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { create as t, resolve as e } from \"../../../core/promiseUtils.js\";\n\nclass n {\n  constructor(t, e) {\n    this._lastId = -1, this._progress = e, this._parent = t;\n  }\n\n  reset() {\n    this._lastId = -1;\n  }\n\n  nextBatch(e) {\n    if (null !== this._parent._mainSetInUse) return this._parent._mainSetInUse.then(t => this.nextBatch(e), t => this.nextBatch(e));\n    const n = {\n      returnpromise: null,\n      hasset: !1\n    },\n          s = [];\n    return n.returnpromise = t((t, a) => {\n      this._parent._getSet(this._progress).then(h => {\n        let _ = h._known.length - 1;\n\n        if (\"GETPAGES\" === h._known[h._known.length - 1] && (_ -= 1), this._lastId + e > _ && h._known.length > 0 && \"GETPAGES\" === h._known[h._known.length - 1]) this._parent._expandPagedSet(h, this._parent._maxQueryRate(), 0, 0, this._progress).then(s => {\n          n.hasset = !0, this._parent._mainSetInUse = null, this.nextBatch(e).then(t, a);\n        }, t => {\n          n.hasset = !0, this._parent._mainSetInUse = null, a(t);\n        });else {\n          if (_ >= this._lastId + e || 0 === h._candidates.length) {\n            for (let t = 0; t < e; t++) {\n              const e = t + this._lastId + 1;\n              if (e >= h._known.length) break;\n              s[t] = h._known[e];\n            }\n\n            return this._lastId += s.length, 0 === s.length && (n.hasset = !0, this._parent._mainSetInUse = null, t([])), void this._parent._getFeatureBatch(s, this._progress).then(e => {\n              n.hasset = !0, this._parent._mainSetInUse = null, t(e);\n            }, t => {\n              n.hasset = !0, this._parent._mainSetInUse = null, a(t);\n            });\n          }\n\n          this._parent._refineSetBlock(h, this._parent._maxProcessingRate(), this._progress).then(() => {\n            n.hasset = !0, this._parent._mainSetInUse = null, this.nextBatch(e).then(t, a);\n          }, t => {\n            n.hasset = !0, this._parent._mainSetInUse = null, a(t);\n          });\n        }\n      }, t => {\n        n.hasset = !0, this._parent._mainSetInUse = null, a(t);\n      });\n    }), !1 === n.hasset && (this._parent._mainSetInUse = n.returnpromise, n.hasset = !0), n.returnpromise;\n  }\n\n  next() {\n    if (null !== this._parent._mainSetInUse) return this._parent._mainSetInUse.then(t => this.next(), t => this.next());\n    const e = {\n      returnpromise: null,\n      hasset: !1\n    };\n    return e.returnpromise = t((t, n) => {\n      this._parent._getSet(this._progress).then(s => {\n        this._lastId < s._known.length - 1 ? \"GETPAGES\" === s._known[this._lastId + 1] ? this._parent._expandPagedSet(s, this._parent._maxQueryRate(), 0, 0, this._progress).then(t => (e.hasset = !0, this._parent._mainSetInUse = null, this.next())).then(t, n) : (this._lastId += 1, this._parent._getFeature(s, s._known[this._lastId], this._progress).then(n => {\n          e.hasset = !0, this._parent._mainSetInUse = null, t(n);\n        }, t => {\n          e.hasset = !0, this._parent._mainSetInUse = null, n(t);\n        })) : s._candidates.length > 0 ? this._parent._refineSetBlock(s, this._parent._maxProcessingRate(), this._progress).then(() => {\n          e.hasset = !0, this._parent._mainSetInUse = null, this.next().then(t, n);\n        }, t => {\n          e.hasset = !0, this._parent._mainSetInUse = null, n(t);\n        }) : (e.hasset = !0, this._parent._mainSetInUse = null, t(null));\n      }, t => {\n        e.hasset = !0, this._parent._mainSetInUse = null, n(t);\n      });\n    }), !1 === e.hasset && (this._parent._mainSetInUse = e.returnpromise, e.hasset = !0), e.returnpromise;\n  }\n\n  count() {\n    return -1 !== this._parent._totalCount ? e(this._parent._totalCount) : this._parent._getSet(this._progress).then(t => this._refineAllSets(t)).then(t => (this._parent._totalCount = t._known.length, e(this._parent._totalCount)));\n  }\n\n  _refineAllSets(t) {\n    return t._known.length > 0 && \"GETPAGES\" === t._known[t._known.length - 1] ? this._parent._expandPagedSet(t, this._parent._maxQueryRate(), 0, 1, this._progress).then(e => this._refineAllSets(t)).then(t => e(t)) : t._candidates.length > 0 ? \"GETPAGES\" === t._known[t._candidates.length - 1] ? this._parent._expandPagedSet(t, this._parent._maxQueryRate(), 0, 2, this._progress).then(e => this._refineAllSets(t)).then(t => e(t)) : this._parent._refineSetBlock(t, this._parent._maxProcessingRate(), this._progress).then(t => t._candidates.length > 0 ? this._refineAllSets(t) : e(t)) : e(t);\n  }\n\n}\n\nexport default n;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/arcade/featureset/support/FeatureSetIterator.js"],"names":["create","t","resolve","e","n","constructor","_lastId","_progress","_parent","reset","nextBatch","_mainSetInUse","then","returnpromise","hasset","s","a","_getSet","h","_","_known","length","_expandPagedSet","_maxQueryRate","_candidates","_getFeatureBatch","_refineSetBlock","_maxProcessingRate","next","_getFeature","count","_totalCount","_refineAllSets"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{create as t,resolve as e}from\"../../../core/promiseUtils.js\";class n{constructor(t,e){this._lastId=-1,this._progress=e,this._parent=t}reset(){this._lastId=-1}nextBatch(e){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((t=>this.nextBatch(e)),(t=>this.nextBatch(e)));const n={returnpromise:null,hasset:!1},s=[];return n.returnpromise=t(((t,a)=>{this._parent._getSet(this._progress).then((h=>{let _=h._known.length-1;if(\"GETPAGES\"===h._known[h._known.length-1]&&(_-=1),this._lastId+e>_&&h._known.length>0&&\"GETPAGES\"===h._known[h._known.length-1])this._parent._expandPagedSet(h,this._parent._maxQueryRate(),0,0,this._progress).then((s=>{n.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(t,a)}),(t=>{n.hasset=!0,this._parent._mainSetInUse=null,a(t)}));else{if(_>=this._lastId+e||0===h._candidates.length){for(let t=0;t<e;t++){const e=t+this._lastId+1;if(e>=h._known.length)break;s[t]=h._known[e]}return this._lastId+=s.length,0===s.length&&(n.hasset=!0,this._parent._mainSetInUse=null,t([])),void this._parent._getFeatureBatch(s,this._progress).then((e=>{n.hasset=!0,this._parent._mainSetInUse=null,t(e)}),(t=>{n.hasset=!0,this._parent._mainSetInUse=null,a(t)}))}this._parent._refineSetBlock(h,this._parent._maxProcessingRate(),this._progress).then((()=>{n.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(t,a)}),(t=>{n.hasset=!0,this._parent._mainSetInUse=null,a(t)}))}}),(t=>{n.hasset=!0,this._parent._mainSetInUse=null,a(t)}))})),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise}next(){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((t=>this.next()),(t=>this.next()));const e={returnpromise:null,hasset:!1};return e.returnpromise=t(((t,n)=>{this._parent._getSet(this._progress).then((s=>{this._lastId<s._known.length-1?\"GETPAGES\"===s._known[this._lastId+1]?this._parent._expandPagedSet(s,this._parent._maxQueryRate(),0,0,this._progress).then((t=>(e.hasset=!0,this._parent._mainSetInUse=null,this.next()))).then(t,n):(this._lastId+=1,this._parent._getFeature(s,s._known[this._lastId],this._progress).then((n=>{e.hasset=!0,this._parent._mainSetInUse=null,t(n)}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,n(t)}))):s._candidates.length>0?this._parent._refineSetBlock(s,this._parent._maxProcessingRate(),this._progress).then((()=>{e.hasset=!0,this._parent._mainSetInUse=null,this.next().then(t,n)}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,n(t)})):(e.hasset=!0,this._parent._mainSetInUse=null,t(null))}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,n(t)}))})),!1===e.hasset&&(this._parent._mainSetInUse=e.returnpromise,e.hasset=!0),e.returnpromise}count(){return-1!==this._parent._totalCount?e(this._parent._totalCount):this._parent._getSet(this._progress).then((t=>this._refineAllSets(t))).then((t=>(this._parent._totalCount=t._known.length,e(this._parent._totalCount))))}_refineAllSets(t){return t._known.length>0&&\"GETPAGES\"===t._known[t._known.length-1]?this._parent._expandPagedSet(t,this._parent._maxQueryRate(),0,1,this._progress).then((e=>this._refineAllSets(t))).then((t=>e(t))):t._candidates.length>0?\"GETPAGES\"===t._known[t._candidates.length-1]?this._parent._expandPagedSet(t,this._parent._maxQueryRate(),0,2,this._progress).then((e=>this._refineAllSets(t))).then((t=>e(t))):this._parent._refineSetBlock(t,this._parent._maxProcessingRate(),this._progress).then((t=>t._candidates.length>0?this._refineAllSets(t):e(t))):e(t)}}export default n;\n"]},"metadata":{},"sourceType":"module"}