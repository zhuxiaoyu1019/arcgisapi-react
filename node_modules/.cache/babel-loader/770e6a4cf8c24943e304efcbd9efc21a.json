{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../Color.js\";\nimport t from \"../../core/Error.js\";\nimport { pt2px as a, px2pt as l } from \"../../core/screenUtils.js\";\nimport { getFill as n, getStroke as o, getPatternUrlWithColor as s } from \"./gfxUtils.js\";\nimport { shapes as i, adjustColorBrightness as r } from \"./previewUtils.js\";\nimport { renderSymbol as c } from \"./renderUtils.js\";\nconst m = \"picture-fill\",\n      u = \"picture-marker\",\n      p = \"simple-fill\",\n      h = \"simple-line\",\n      d = \"simple-marker\",\n      f = \"text\",\n      v = \"Aa\",\n      y = 22,\n      g = 120,\n      w = 80,\n      M = 40,\n      b = document.createElement(\"canvas\");\n\nfunction x(e, t) {\n  const a = b.getContext(\"2d\"),\n        l = [];\n  return t && (t.weight && l.push(t.weight), t.size && l.push(t.size + \"px\"), t.family && l.push(t.family)), a.font = l.join(\" \"), a.measureText(e).width;\n}\n\nconst k = 7.2 / 2.54,\n      L = 72 / 2.54;\n\nfunction z(e) {\n  if (0 === e.length) return 0;\n\n  if (e.length > 2) {\n    const t = l(1),\n          a = parseFloat(e);\n\n    switch (e.slice(-2)) {\n      case \"px\":\n        return a;\n\n      case \"pt\":\n        return a * t;\n\n      case \"in\":\n        return 72 * a * t;\n\n      case \"pc\":\n        return 12 * a * t;\n\n      case \"mm\":\n        return a * k * t;\n\n      case \"cm\":\n        return a * L * t;\n    }\n  }\n\n  return parseFloat(e);\n}\n\nfunction j(l, b) {\n  var k, L;\n  const j = null != (null == b ? void 0 : b.size) ? a(b.size) : null,\n        C = null != (null == b ? void 0 : b.maxSize) ? a(b.maxSize) : null,\n        F = null != (null == b ? void 0 : b.opacity) ? b.opacity : null,\n        S = null != (null == b ? void 0 : b.rotation) ? b.rotation : \"angle\" in l ? l.angle : null,\n        E = n(l);\n  let P = o(l);\n\n  if (E && !P) {\n    const t = \"type\" in E ? null : new e(E);\n    \"#ffffff\" === (t ? t.toHex() : null) && (P = {\n      color: \"#bdc3c7\",\n      width: .75\n    });\n  }\n\n  const U = {\n    shape: null,\n    fill: null,\n    stroke: P,\n    offset: [0, 0]\n  };\n  null != (k = P) && k.width && (P.width = Math.min(P.width, w));\n  const q = (null == (L = P) ? void 0 : L.width) || 0;\n  let Z = null != j && (null == (null == b ? void 0 : b.scale) || (null == b ? void 0 : b.scale)),\n      H = 0,\n      T = 0,\n      A = !1;\n\n  switch (l.type) {\n    case d:\n      {\n        const e = l.style,\n              t = Math.min(null != j ? j : a(l.size), C || g);\n\n        switch (H = t, T = t, e) {\n          case \"circle\":\n            U.shape = {\n              type: \"circle\",\n              cx: 0,\n              cy: 0,\n              r: .5 * t\n            }, Z || (H += q, T += q);\n            break;\n\n          case \"cross\":\n            U.shape = {\n              type: \"path\",\n              path: [{\n                command: \"M\",\n                values: [0, .5 * T]\n              }, {\n                command: \"L\",\n                values: [H, .5 * T]\n              }, {\n                command: \"M\",\n                values: [.5 * H, 0]\n              }, {\n                command: \"L\",\n                values: [.5 * H, T]\n              }]\n            };\n            break;\n\n          case \"diamond\":\n            U.shape = {\n              type: \"path\",\n              path: [{\n                command: \"M\",\n                values: [0, .5 * T]\n              }, {\n                command: \"L\",\n                values: [.5 * H, 0]\n              }, {\n                command: \"L\",\n                values: [H, .5 * T]\n              }, {\n                command: \"L\",\n                values: [.5 * H, T]\n              }, {\n                command: \"Z\",\n                values: []\n              }]\n            }, Z || (H += q, T += q);\n            break;\n\n          case \"square\":\n            U.shape = {\n              type: \"path\",\n              path: [{\n                command: \"M\",\n                values: [0, 0]\n              }, {\n                command: \"L\",\n                values: [H, 0]\n              }, {\n                command: \"L\",\n                values: [H, T]\n              }, {\n                command: \"L\",\n                values: [0, T]\n              }, {\n                command: \"Z\",\n                values: []\n              }]\n            }, Z || (H += q, T += q), S && (A = !0);\n            break;\n\n          case \"triangle\":\n            U.shape = {\n              type: \"path\",\n              path: [{\n                command: \"M\",\n                values: [.5 * H, 0]\n              }, {\n                command: \"L\",\n                values: [H, T]\n              }, {\n                command: \"L\",\n                values: [0, T]\n              }, {\n                command: \"Z\",\n                values: []\n              }]\n            }, Z || (H += q, T += q), S && (A = !0);\n            break;\n\n          case \"x\":\n            U.shape = {\n              type: \"path\",\n              path: [{\n                command: \"M\",\n                values: [0, 0]\n              }, {\n                command: \"L\",\n                values: [H, T]\n              }, {\n                command: \"M\",\n                values: [H, 0]\n              }, {\n                command: \"L\",\n                values: [0, T]\n              }]\n            }, S && (A = !0);\n            break;\n\n          case \"path\":\n            U.shape = {\n              type: \"path\",\n              path: l.path || \"\"\n            }, Z || (H += q, T += q), S && (A = !0), Z = !0;\n        }\n\n        break;\n      }\n\n    case h:\n      {\n        const e = Math.min(null != j ? j : q, C || w),\n              t = e > y ? 2 * e : M;\n        P.width = e, H = t, T = e, U.shape = {\n          type: \"path\",\n          path: [{\n            command: \"M\",\n            values: [0, T]\n          }, {\n            command: \"L\",\n            values: [H, T]\n          }]\n        };\n        break;\n      }\n\n    case m:\n    case p:\n      H = Math.min(null != j ? j : y, C || g) + q, T = H, Z = !0, U.shape = \"object\" == typeof (null == b ? void 0 : b.symbolConfig) && null != b && b.symbolConfig.isSquareFill ? i.squareFill[0] : i.fill[0];\n      break;\n\n    case u:\n      {\n        let e = a(l.width),\n            t = a(l.height);\n        const n = Math.max(e, t),\n              o = e / t;\n        e = o <= 1 ? Math.ceil(n * o) : n, t = o <= 1 ? n : Math.ceil(n / o), H = Math.min(null != j ? j : e, C || g), T = Math.min(null != j ? j : t, C || g), U.shape = {\n          type: \"image\",\n          x: -Math.round(H / 2),\n          y: -Math.round(T / 2),\n          width: H,\n          height: T,\n          src: l.url || \"\"\n        }, S && (A = !0);\n        break;\n      }\n\n    case f:\n      {\n        const e = l,\n              t = e.text || v,\n              n = e.font,\n              o = Math.min(null != j ? j : a(n.size), C || g),\n              s = x(t, {\n          weight: n.weight,\n          size: o,\n          family: n.family\n        }),\n              i = /[\\uE600-\\uE6FF]/.test(t);\n        H = i ? o : s, T = o;\n        let r = .25 * z((n ? o : 0).toString());\n        i && (r += 5), U.shape = {\n          type: \"text\",\n          text: t,\n          x: 0,\n          y: r,\n          align: \"middle\",\n          decoration: n && n.decoration,\n          rotated: e.rotated,\n          kerning: e.kerning\n        }, U.font = n && {\n          size: o,\n          style: n.style,\n          decoration: n.decoration,\n          weight: n.weight,\n          family: n.family\n        };\n        break;\n      }\n  }\n\n  if (!U.shape) return Promise.reject(new t(\"symbolPreview: renderPreviewHTML2D\", \"symbol not supported.\"));\n  const D = E,\n        R = l.color;\n  let B = null;\n  return D && \"pattern\" === D.type && R && l.type !== m ? B = s(D.src, R.toCss(!0)).then(e => (D.src = e, U.fill = D, U)) : (U.fill = E, B = Promise.resolve(U)), B.then(e => {\n    const t = [[e]];\n\n    if (\"object\" == typeof (null == b ? void 0 : b.symbolConfig) && null != b && b.symbolConfig.applyColorModulation) {\n      const a = .6 * H;\n      t.unshift([{ ...e,\n        offset: [-a, 0],\n        fill: r(E, -.3)\n      }]), t.push([{ ...e,\n        offset: [a, 0],\n        fill: r(E, .3)\n      }]), H += 2 * a;\n    }\n\n    return c(t, [H, T], {\n      node: b && b.node,\n      scale: Z,\n      opacity: F,\n      rotation: S,\n      useRotationSize: A\n    });\n  });\n}\n\nexport { j as previewSymbol2D };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/symbols/support/previewSymbol2D.js"],"names":["e","t","pt2px","a","px2pt","l","getFill","n","getStroke","o","getPatternUrlWithColor","s","shapes","i","adjustColorBrightness","r","renderSymbol","c","m","u","p","h","d","f","v","y","g","w","M","b","document","createElement","x","getContext","weight","push","size","family","font","join","measureText","width","k","L","z","length","parseFloat","slice","j","C","maxSize","F","opacity","S","rotation","angle","E","P","toHex","color","U","shape","fill","stroke","offset","Math","min","q","Z","scale","H","T","A","type","style","cx","cy","path","command","values","symbolConfig","isSquareFill","squareFill","height","max","ceil","round","src","url","text","test","toString","align","decoration","rotated","kerning","Promise","reject","D","R","B","toCss","then","resolve","applyColorModulation","unshift","node","useRotationSize","previewSymbol2D"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../Color.js\";import t from\"../../core/Error.js\";import{pt2px as a,px2pt as l}from\"../../core/screenUtils.js\";import{getFill as n,getStroke as o,getPatternUrlWithColor as s}from\"./gfxUtils.js\";import{shapes as i,adjustColorBrightness as r}from\"./previewUtils.js\";import{renderSymbol as c}from\"./renderUtils.js\";const m=\"picture-fill\",u=\"picture-marker\",p=\"simple-fill\",h=\"simple-line\",d=\"simple-marker\",f=\"text\",v=\"Aa\",y=22,g=120,w=80,M=40,b=document.createElement(\"canvas\");function x(e,t){const a=b.getContext(\"2d\"),l=[];return t&&(t.weight&&l.push(t.weight),t.size&&l.push(t.size+\"px\"),t.family&&l.push(t.family)),a.font=l.join(\" \"),a.measureText(e).width}const k=7.2/2.54,L=72/2.54;function z(e){if(0===e.length)return 0;if(e.length>2){const t=l(1),a=parseFloat(e);switch(e.slice(-2)){case\"px\":return a;case\"pt\":return a*t;case\"in\":return 72*a*t;case\"pc\":return 12*a*t;case\"mm\":return a*k*t;case\"cm\":return a*L*t}}return parseFloat(e)}function j(l,b){var k,L;const j=null!=(null==b?void 0:b.size)?a(b.size):null,C=null!=(null==b?void 0:b.maxSize)?a(b.maxSize):null,F=null!=(null==b?void 0:b.opacity)?b.opacity:null,S=null!=(null==b?void 0:b.rotation)?b.rotation:\"angle\"in l?l.angle:null,E=n(l);let P=o(l);if(E&&!P){const t=\"type\"in E?null:new e(E);\"#ffffff\"===(t?t.toHex():null)&&(P={color:\"#bdc3c7\",width:.75})}const U={shape:null,fill:null,stroke:P,offset:[0,0]};null!=(k=P)&&k.width&&(P.width=Math.min(P.width,w));const q=(null==(L=P)?void 0:L.width)||0;let Z=null!=j&&(null==(null==b?void 0:b.scale)||(null==b?void 0:b.scale)),H=0,T=0,A=!1;switch(l.type){case d:{const e=l.style,t=Math.min(null!=j?j:a(l.size),C||g);switch(H=t,T=t,e){case\"circle\":U.shape={type:\"circle\",cx:0,cy:0,r:.5*t},Z||(H+=q,T+=q);break;case\"cross\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,.5*T]},{command:\"L\",values:[H,.5*T]},{command:\"M\",values:[.5*H,0]},{command:\"L\",values:[.5*H,T]}]};break;case\"diamond\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,.5*T]},{command:\"L\",values:[.5*H,0]},{command:\"L\",values:[H,.5*T]},{command:\"L\",values:[.5*H,T]},{command:\"Z\",values:[]}]},Z||(H+=q,T+=q);break;case\"square\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,0]},{command:\"L\",values:[H,0]},{command:\"L\",values:[H,T]},{command:\"L\",values:[0,T]},{command:\"Z\",values:[]}]},Z||(H+=q,T+=q),S&&(A=!0);break;case\"triangle\":U.shape={type:\"path\",path:[{command:\"M\",values:[.5*H,0]},{command:\"L\",values:[H,T]},{command:\"L\",values:[0,T]},{command:\"Z\",values:[]}]},Z||(H+=q,T+=q),S&&(A=!0);break;case\"x\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,0]},{command:\"L\",values:[H,T]},{command:\"M\",values:[H,0]},{command:\"L\",values:[0,T]}]},S&&(A=!0);break;case\"path\":U.shape={type:\"path\",path:l.path||\"\"},Z||(H+=q,T+=q),S&&(A=!0),Z=!0}break}case h:{const e=Math.min(null!=j?j:q,C||w),t=e>y?2*e:M;P.width=e,H=t,T=e,U.shape={type:\"path\",path:[{command:\"M\",values:[0,T]},{command:\"L\",values:[H,T]}]};break}case m:case p:H=Math.min(null!=j?j:y,C||g)+q,T=H,Z=!0,U.shape=\"object\"==typeof(null==b?void 0:b.symbolConfig)&&null!=b&&b.symbolConfig.isSquareFill?i.squareFill[0]:i.fill[0];break;case u:{let e=a(l.width),t=a(l.height);const n=Math.max(e,t),o=e/t;e=o<=1?Math.ceil(n*o):n,t=o<=1?n:Math.ceil(n/o),H=Math.min(null!=j?j:e,C||g),T=Math.min(null!=j?j:t,C||g),U.shape={type:\"image\",x:-Math.round(H/2),y:-Math.round(T/2),width:H,height:T,src:l.url||\"\"},S&&(A=!0);break}case f:{const e=l,t=e.text||v,n=e.font,o=Math.min(null!=j?j:a(n.size),C||g),s=x(t,{weight:n.weight,size:o,family:n.family}),i=/[\\uE600-\\uE6FF]/.test(t);H=i?o:s,T=o;let r=.25*z((n?o:0).toString());i&&(r+=5),U.shape={type:\"text\",text:t,x:0,y:r,align:\"middle\",decoration:n&&n.decoration,rotated:e.rotated,kerning:e.kerning},U.font=n&&{size:o,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family};break}}if(!U.shape)return Promise.reject(new t(\"symbolPreview: renderPreviewHTML2D\",\"symbol not supported.\"));const D=E,R=l.color;let B=null;return D&&\"pattern\"===D.type&&R&&l.type!==m?B=s(D.src,R.toCss(!0)).then((e=>(D.src=e,U.fill=D,U))):(U.fill=E,B=Promise.resolve(U)),B.then((e=>{const t=[[e]];if(\"object\"==typeof(null==b?void 0:b.symbolConfig)&&null!=b&&b.symbolConfig.applyColorModulation){const a=.6*H;t.unshift([{...e,offset:[-a,0],fill:r(E,-.3)}]),t.push([{...e,offset:[a,0],fill:r(E,.3)}]),H+=2*a}return c(t,[H,T],{node:b&&b.node,scale:Z,opacity:F,rotation:S,useRotationSize:A})}))}export{j as previewSymbol2D};\n"]},"metadata":{},"sourceType":"module"}