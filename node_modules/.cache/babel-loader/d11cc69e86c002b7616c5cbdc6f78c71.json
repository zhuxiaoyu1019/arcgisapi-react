{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { disposeMaybe as t } from \"../../../../core/maybe.js\";\nimport { f as i } from \"../../../../chunks/vec4f32.js\";\nimport { createQuadVAO as e } from \"./glUtil3D.js\";\nimport { ShadowHighlightTechnique as s } from \"../shaders/ShadowHighlightTechnique.js\";\nimport { vertexCount as h } from \"../../../webgl/Util.js\";\nconst a = .001953125;\n\nclass o {\n  constructor(t, h) {\n    this._rctx = t, this._maxOpacity = 1, this._defaultOptions = {\n      shadowColor: i(1, 0, 1, 1),\n      shadowOpacity: .2,\n      occludedShadowOpacity: .1\n    }, this._technique = new s({\n      rctx: t,\n      viewingMode: h\n    }, null), this._vao = e(this._rctx);\n  }\n\n  render(t, i) {\n    t.shadowMap.enabled && t.linearDepthTexture && this.isVisible && (this._rctx.bindFramebuffer(i), this._rctx.useProgram(this._technique.program), this._technique.bindPipelineState(this._rctx), this._technique.bindPass(this._defaultOptions, t), this._rctx.bindVAO(this._vao), this._rctx.drawArrays(this._technique.primitiveType, 0, h(this._vao, \"geometry\")));\n  }\n\n  getGpuMemoryUsage() {\n    return this._vao ? this._vao.size : 0;\n  }\n\n  setDefaultOptions(t) {\n    this._defaultOptions = t, this._updateMaxOpacity();\n  }\n\n  get highlightShadowMapSlot() {\n    return this._technique.highlightShadowMapSlot;\n  }\n\n  get defaultSnapshotSlot() {\n    return this._technique.defaultSnapshotSlot;\n  }\n\n  dispose() {\n    this._vao = t(this._vao), this._technique = t(this._technique);\n  }\n\n  get isVisible() {\n    return this._maxOpacity * this._technique.opacityElevation * this._technique.dayNightTerminator >= a;\n  }\n\n  _updateMaxOpacity() {\n    const t = this._defaultOptions,\n          i = t.shadowColor,\n          e = Math.max(t.shadowOpacity, t.occludedShadowOpacity);\n    this._maxOpacity = e * i[3];\n  }\n\n}\n\nexport { o as ShadowHighlightHelper };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/webgl-engine/lib/ShadowHighlightHelper.js"],"names":["disposeMaybe","t","f","i","createQuadVAO","e","ShadowHighlightTechnique","s","vertexCount","h","a","o","constructor","_rctx","_maxOpacity","_defaultOptions","shadowColor","shadowOpacity","occludedShadowOpacity","_technique","rctx","viewingMode","_vao","render","shadowMap","enabled","linearDepthTexture","isVisible","bindFramebuffer","useProgram","program","bindPipelineState","bindPass","bindVAO","drawArrays","primitiveType","getGpuMemoryUsage","size","setDefaultOptions","_updateMaxOpacity","highlightShadowMapSlot","defaultSnapshotSlot","dispose","opacityElevation","dayNightTerminator","Math","max","ShadowHighlightHelper"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t}from\"../../../../core/maybe.js\";import{f as i}from\"../../../../chunks/vec4f32.js\";import{createQuadVAO as e}from\"./glUtil3D.js\";import{ShadowHighlightTechnique as s}from\"../shaders/ShadowHighlightTechnique.js\";import{vertexCount as h}from\"../../../webgl/Util.js\";const a=.001953125;class o{constructor(t,h){this._rctx=t,this._maxOpacity=1,this._defaultOptions={shadowColor:i(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1},this._technique=new s({rctx:t,viewingMode:h},null),this._vao=e(this._rctx)}render(t,i){t.shadowMap.enabled&&t.linearDepthTexture&&this.isVisible&&(this._rctx.bindFramebuffer(i),this._rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this._rctx),this._technique.bindPass(this._defaultOptions,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._technique.primitiveType,0,h(this._vao,\"geometry\")))}getGpuMemoryUsage(){return this._vao?this._vao.size:0}setDefaultOptions(t){this._defaultOptions=t,this._updateMaxOpacity()}get highlightShadowMapSlot(){return this._technique.highlightShadowMapSlot}get defaultSnapshotSlot(){return this._technique.defaultSnapshotSlot}dispose(){this._vao=t(this._vao),this._technique=t(this._technique)}get isVisible(){return this._maxOpacity*this._technique.opacityElevation*this._technique.dayNightTerminator>=a}_updateMaxOpacity(){const t=this._defaultOptions,i=t.shadowColor,e=Math.max(t.shadowOpacity,t.occludedShadowOpacity);this._maxOpacity=e*i[3]}}export{o as ShadowHighlightHelper};\n"]},"metadata":{},"sourceType":"module"}