{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport r from \"../core/Evented.js\";\nimport t from \"../core/Handles.js\";\nimport { property as s } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/has.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport \"../core/Logger.js\";\nimport { subclass as i } from \"../core/accessorSupport/decorators/subclass.js\";\nimport { isRefreshableLayerView as a } from \"./layers/RefreshableLayerView.js\";\nconst n = 6e3;\nlet h = class extends r.EventedAccessor {\n  constructor() {\n    super(...arguments), this._handles = new t(), this._currentTick = 0;\n  }\n\n  initialize() {\n    this._handles.add([this.view.allLayerViews.on(\"after-changes\", () => {\n      this.notifyChange(\"tickInterval\"), this._handles.remove(\"layerViewsUpdating\"), this._handles.add(this._getLayerViewHandles(), \"layerViewsUpdating\");\n    }), this.watch(\"tickInterval\", () => this._restartTicking()), this.watch(\"view.ready\", () => this._restartTicking())]), this._restartTicking();\n  }\n\n  destroy() {\n    this._handles && (this._handles.destroy(), this._handles = null, this._intervalID && clearInterval(this._intervalID), this._currentTick = 0);\n  }\n\n  get tickInterval() {\n    const e = this.view.allLayerViews.filter(e => a(e));\n    return this._getCommonInterval(e);\n  }\n\n  _restartTicking() {\n    this._currentTick = 0, this._intervalID && clearInterval(this._intervalID), this.get(\"view.ready\") && this.tickInterval && (this._intervalID = setInterval(() => {\n      const e = Date.now();\n      this._currentTick += this.tickInterval, this.view.allLayerViews.forEach(r => {\n        if (a(r)) {\n          const t = Math.round(6e4 * r.refreshInterval),\n                s = this._currentTick % t == 0,\n                i = e - r.refreshTimestamp < .9 * n;\n          t && s && !i && (r.refresh(e), this.emit(\"refresh\", {\n            layerView: r,\n            timestamp: e,\n            trigger: \"interval\"\n          }));\n        }\n      });\n    }, this.tickInterval));\n  }\n\n  _getLayerViewHandles() {\n    const e = [],\n          r = () => this.notifyChange(\"tickInterval\");\n\n    return this.view.allLayerViews.forEach(t => {\n      a(t) && t.layer && e.push(t.watch(\"refreshInterval\", r), t.layer.on(\"refresh\", () => {\n        const e = Date.now();\n        t.refresh(e), this.emit(\"refresh\", {\n          layerView: t,\n          timestamp: e,\n          trigger: \"layer-refresh\"\n        });\n      }));\n    }), e;\n  }\n\n  _getCommonInterval(e) {\n    const r = (e, t) => isNaN(e) || isNaN(t) ? 0 : t <= 0 ? e : r(t, e % t);\n\n    return e.toArray().reduce((e, t) => r(Math.round(6e4 * t.refreshInterval), e), 0);\n  }\n\n};\ne([s()], h.prototype, \"view\", void 0), e([s({\n  readOnly: !0\n})], h.prototype, \"tickInterval\", null), h = e([i(\"esri.views.RefreshManager\")], h);\nvar o = h;\nexport default o;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/RefreshManager.js"],"names":["_","e","r","t","property","s","subclass","i","isRefreshableLayerView","a","n","h","EventedAccessor","constructor","arguments","_handles","_currentTick","initialize","add","view","allLayerViews","on","notifyChange","remove","_getLayerViewHandles","watch","_restartTicking","destroy","_intervalID","clearInterval","tickInterval","filter","_getCommonInterval","get","setInterval","Date","now","forEach","Math","round","refreshInterval","refreshTimestamp","refresh","emit","layerView","timestamp","trigger","layer","push","isNaN","toArray","reduce","prototype","readOnly","o"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../core/Evented.js\";import t from\"../core/Handles.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/accessorSupport/ensureType.js\";import\"../core/Logger.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";import{isRefreshableLayerView as a}from\"./layers/RefreshableLayerView.js\";const n=6e3;let h=class extends r.EventedAccessor{constructor(){super(...arguments),this._handles=new t,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on(\"after-changes\",(()=>{this.notifyChange(\"tickInterval\"),this._handles.remove(\"layerViewsUpdating\"),this._handles.add(this._getLayerViewHandles(),\"layerViewsUpdating\")})),this.watch(\"tickInterval\",(()=>this._restartTicking())),this.watch(\"view.ready\",(()=>this._restartTicking()))]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter((e=>a(e)));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get(\"view.ready\")&&this.tickInterval&&(this._intervalID=setInterval((()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach((r=>{if(a(r)){const t=Math.round(6e4*r.refreshInterval),s=this._currentTick%t==0,i=e-r.refreshTimestamp<.9*n;t&&s&&!i&&(r.refresh(e),this.emit(\"refresh\",{layerView:r,timestamp:e,trigger:\"interval\"}))}}))}),this.tickInterval))}_getLayerViewHandles(){const e=[],r=()=>this.notifyChange(\"tickInterval\");return this.view.allLayerViews.forEach((t=>{a(t)&&t.layer&&e.push(t.watch(\"refreshInterval\",r),t.layer.on(\"refresh\",(()=>{const e=Date.now();t.refresh(e),this.emit(\"refresh\",{layerView:t,timestamp:e,trigger:\"layer-refresh\"})})))})),e}_getCommonInterval(e){const r=(e,t)=>isNaN(e)||isNaN(t)?0:t<=0?e:r(t,e%t);return e.toArray().reduce(((e,t)=>r(Math.round(6e4*t.refreshInterval),e)),0)}};e([s()],h.prototype,\"view\",void 0),e([s({readOnly:!0})],h.prototype,\"tickInterval\",null),h=e([i(\"esri.views.RefreshManager\")],h);var o=h;export default o;\n"]},"metadata":{},"sourceType":"module"}