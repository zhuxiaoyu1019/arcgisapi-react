{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/_rollupPluginBabelHelpers.js\";\nimport \"../../geometry.js\";\nimport t from \"../../request.js\";\nimport i from \"../../core/Error.js\";\nimport n from \"../../core/Logger.js\";\nimport { isNone as r, unwrapOr as a, isSome as o } from \"../../core/maybe.js\";\nimport { WGS84 as s, equals as l } from \"../../geometry/support/spatialReferenceUtils.js\";\nimport { project as c } from \"../../geometry/support/webMercatorUtils.js\";\nimport { convertToFeatureSet as d, convertToGeometry as u, convertFromGeometry as p } from \"../graphics/featureConversionUtils.js\";\nimport m from \"../graphics/OptimizedFeatureSet.js\";\nimport { validateGeoJSON as f, inferLayerProperties as g, createOptimizedFeatures as y } from \"../graphics/sources/geojson/geojson.js\";\nimport { createDrawingInfo as w } from \"../graphics/sources/support/clientSideDefaults.js\";\nimport h from \"../support/FieldsIndex.js\";\nimport { kebabDict as b } from \"../support/fieldType.js\";\nimport j from \"../../rest/support/FeatureSet.js\";\nimport F from \"../../geometry/SpatialReference.js\";\nconst I = n.getLogger(\"esri.layers.graphics.sources.ogcfeature\");\n\nasync function T(e, n, a = {}, o = 5) {\n  const {\n    links: s\n  } = e,\n        l = $(s, \"items\", \"application/geo+json\") || $(s, \"http://www.opengis.net/def/rel/ogc/1.0/items\", \"application/geo+json\");\n  if (r(l)) throw new i(\"ogc-feature-layer:missing-items-page\", \"Missing items url\");\n  const {\n    data: c\n  } = await t(l.href, {\n    signal: a.signal,\n    query: {\n      limit: o,\n      ...a.customParameters,\n      token: a.apiKey\n    },\n    headers: {\n      accept: \"application/geo+json\"\n    }\n  });\n  await f(c);\n  const d = g(c, {\n    geometryType: n.geometryType\n  }),\n        u = n.fields || d.fields || [],\n        p = null != n.hasZ ? n.hasZ : d.hasZ,\n        m = d.geometryType,\n        y = n.objectIdField || d.objectIdFieldName || \"OBJECTID\";\n  let j = n.timeInfo;\n  const F = u.find(e => e.name === y);\n\n  if (!F) {\n    if (!d.objectIdFieldType) throw new i(\"ogc-feature-layer:missing-feature-id\", \"Collection geojson require a feature id as a unique identifier\");\n    u.unshift({\n      name: y,\n      alias: y,\n      type: \"esriFieldTypeOID\",\n      editable: !1,\n      nullable: !1\n    });\n  } else F.type = \"esriFieldTypeOID\", F.editable = !1, F.nullable = !1;\n\n  if (y !== d.objectIdFieldName) {\n    const e = u.find(e => e.name === d.objectIdFieldName);\n    e && (e.type = \"esriFieldTypeInteger\");\n  }\n\n  if (!m) throw new i(\"ogc-feature-layer:missing-property\", \"geometryType not set and couldn't be inferred from the provided features\");\n  u === d.fields && d.unknownFields.length > 0 && I.warn({\n    name: \"ogc-feature-layer:unknown-field-types\",\n    message: \"Some fields types couldn't be inferred from the features and were dropped\",\n    details: {\n      unknownFields: d.unknownFields\n    }\n  });\n\n  for (const t of u) {\n    if (null == t.name && (t.name = t.alias), null == t.alias && (t.alias = t.name), \"esriFieldTypeOID\" !== t.type && \"esriFieldTypeGlobalID\" !== t.type && (t.editable = null == t.editable || !!t.editable, t.nullable = null == t.nullable || !!t.nullable), !t.name) throw new i(\"ogc-feature-layer:invalid-field-name\", \"field name is missing\", {\n      field: t\n    });\n    if (-1 === b.jsonValues.indexOf(t.type)) throw new i(\"ogc-feature-layer:invalid-field-type\", `invalid type for field \"${t.name}\"`, {\n      field: t\n    });\n  }\n\n  if (j) {\n    const e = new h(u);\n\n    if (j.startTimeField) {\n      const t = e.get(j.startTimeField);\n      t ? (j.startTimeField = t.name, t.type = \"esriFieldTypeDate\") : j.startTimeField = null;\n    }\n\n    if (j.endTimeField) {\n      const t = e.get(j.endTimeField);\n      t ? (j.endTimeField = t.name, t.type = \"esriFieldTypeDate\") : j.endTimeField = null;\n    }\n\n    if (j.trackIdField) {\n      const t = e.get(j.trackIdField);\n      t ? j.trackIdField = t.name : (j.trackIdField = null, I.warn({\n        name: \"ogc-feature-layer:invalid-timeInfo-trackIdField\",\n        message: \"trackIdField is missing\",\n        details: {\n          timeInfo: j\n        }\n      }));\n    }\n\n    j.startTimeField || j.endTimeField || (I.warn({\n      name: \"ogc-feature-layer:invalid-timeInfo\",\n      message: \"startTimeField and endTimeField are missing\",\n      details: {\n        timeInfo: j\n      }\n    }), j = null);\n  }\n\n  return {\n    drawingInfo: w(m),\n    geometryType: m,\n    fields: u,\n    hasZ: !!p,\n    objectIdField: y,\n    timeInfo: j\n  };\n}\n\nasync function k(e, n = {}) {\n  const {\n    links: a\n  } = e,\n        o = $(a, \"data\", \"application/json\") || $(a, \"http://www.opengis.net/def/rel/ogc/1.0/data\", \"application/json\");\n  if (r(o)) throw new i(\"ogc-feature-layer:missing-collections-page\", \"Missing collections url\");\n  const {\n    apiKey: s,\n    customParameters: l,\n    signal: c\n  } = n,\n        {\n    data: d\n  } = await t(o.href, {\n    signal: c,\n    headers: {\n      accept: \"application/json\"\n    },\n    query: { ...l,\n      token: s\n    }\n  });\n  return d;\n}\n\nasync function S(e, n = {}) {\n  const {\n    links: a\n  } = e,\n        o = $(a, \"conformance\", \"application/json\") || $(a, \"http://www.opengis.net/def/rel/ogc/1.0/conformance\", \"application/json\");\n  if (r(o)) throw new i(\"ogc-feature-layer:missing-conformance-page\", \"Missing conformance url\");\n  const {\n    apiKey: s,\n    customParameters: l,\n    signal: c\n  } = n,\n        {\n    data: d\n  } = await t(o.href, {\n    signal: c,\n    headers: {\n      accept: \"application/json\"\n    },\n    query: { ...l,\n      token: s\n    }\n  });\n  return d;\n}\n\nasync function x(e, i = {}) {\n  const {\n    apiKey: n,\n    customParameters: r,\n    signal: a\n  } = i,\n        {\n    data: o\n  } = await t(e, {\n    signal: a,\n    headers: {\n      accept: \"application/json\"\n    },\n    query: { ...r,\n      token: n\n    }\n  });\n  return o;\n}\n\nasync function v(e, i = {}) {\n  const n = \"application/vnd.oai.openapi+json;version=3.0\",\n        a = $(e.links, \"service-desc\", n);\n  if (r(a)) return I.warn(\"ogc-feature-layer:missing-openapi-page\", \"The OGC API-Features server does not have an OpenAPI page.\"), null;\n  const {\n    apiKey: o,\n    customParameters: s,\n    signal: l\n  } = i,\n        {\n    data: c\n  } = await t(a.href, {\n    signal: l,\n    headers: {\n      accept: n\n    },\n    query: { ...s,\n      token: o\n    }\n  });\n  return c;\n}\n\nfunction N(t) {\n  const i = e(/^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/(.*)\\/(.*)\\/(.*)$/i, {\n    authority: 1,\n    version: 2,\n    code: 3\n  }).exec(t),\n        n = null == i ? void 0 : i.groups;\n  if (!n) return null;\n  const {\n    authority: r,\n    code: a\n  } = n;\n\n  switch (r.toLowerCase()) {\n    case \"ogc\":\n      switch (a.toLowerCase()) {\n        case \"crs27\":\n          return F.GCS_NAD_1927;\n\n        case \"crs83\":\n          return new F({\n            wkid: 4269\n          });\n\n        case \"crs84\":\n        case \"crs84h\":\n          return F.WGS84;\n\n        default:\n          return null;\n      }\n\n    case \"esri\":\n    case \"epsg\":\n      {\n        const e = Number.parseInt(a, 10);\n        return Number.isNaN(e) ? null : 900913 === e ? F.WebMercator : new F({\n          wkid: e\n        });\n      }\n\n    default:\n      return null;\n  }\n}\n\nasync function q(e, t, i) {\n  const n = await M(e, t, i);\n  return j.fromJSON(n);\n}\n\nasync function M(e, t, i) {\n  const n = await O(e, t, i);\n  return d(n);\n}\n\nasync function O(e, n, o) {\n  const {\n    capabilities: {\n      query: {\n        maxRecordCount: l\n      }\n    },\n    collection: d,\n    layerDefinition: f,\n    queryParameters: {\n      apiKey: g,\n      customParameters: w\n    },\n    spatialReference: h,\n    supportedCrs: b\n  } = e,\n        {\n    links: j\n  } = d,\n        I = $(j, \"items\", \"application/geo+json\") || $(j, \"http://www.opengis.net/def/rel/ogc/1.0/items\", \"application/geo+json\");\n  if (r(I)) throw new i(\"ogc-feature-layer:missing-items-page\", \"Missing items url\");\n  const {\n    geometry: T,\n    num: k,\n    start: S,\n    timeExtent: x,\n    where: v\n  } = n;\n  if (n.objectIds) throw new i(\"ogc-feature-layer:query-by-objectids-not-supported\", \"Queries with objectids are not supported\");\n  const N = F.fromJSON(h),\n        q = a(n.outSpatialReference, N),\n        M = q.isWGS84 ? null : P(q, b),\n        O = G(T, b),\n        D = C(x),\n        R = W(v),\n        Z = null != k ? k : null != S && void 0 !== S ? 10 : l,\n        {\n    data: K\n  } = await t(I.href, { ...o,\n    query: { ...w,\n      ...O,\n      crs: M,\n      datetime: D,\n      query: R,\n      limit: Z,\n      startindex: S,\n      token: g\n    },\n    headers: {\n      accept: \"application/geo+json\"\n    }\n  });\n  let L = !1;\n\n  if (K.links) {\n    L = !!K.links.find(e => \"next\" === e.rel);\n  }\n\n  !L && Number.isInteger(K.numberMatched) && Number.isInteger(K.numberReturned) && (L = K.numberReturned < K.numberMatched);\n  const {\n    fields: J,\n    globalIdField: _,\n    hasM: A,\n    hasZ: E,\n    objectIdField: U\n  } = f,\n        B = f.geometryType,\n        z = y(K, {\n    geometryType: B,\n    hasZ: E,\n    objectIdField: U\n  });\n  if (!M && q.isWebMercator) for (const t of z) if (t.geometry) {\n    const e = u(t.geometry, B, E, !1);\n    e.spatialReference = F.WGS84, t.geometry = p(c(e, q));\n  }\n\n  for (const t of z) t.objectId = t.attributes[U];\n\n  const H = M || !M && q.isWebMercator ? q.toJSON() : s,\n        Q = new m();\n  return Q.exceededTransferLimit = L, Q.features = z, Q.fields = J, Q.geometryType = B, Q.globalIdFieldName = _, Q.hasM = A, Q.hasZ = E, Q.objectIdFieldName = U, Q.spatialReference = H, Q;\n}\n\nfunction D(e) {\n  return o(e) && \"extent\" === e.type;\n}\n\nfunction P(e, t) {\n  return t.find(t => {\n    const i = N(t);\n    return l(i, e);\n  });\n}\n\nfunction R(e) {\n  const {\n    xmin: t,\n    ymin: i,\n    xmax: n,\n    ymax: r\n  } = e;\n  return `${t},${i},${n},${r}`;\n}\n\nfunction C(e) {\n  if (r(e)) return null;\n  const {\n    start: t,\n    end: i\n  } = e;\n  return `${o(t) ? t.toISOString() : \"..\"}/${o(i) ? i.toISOString() : \"..\"}`;\n}\n\nfunction W(e) {\n  return r(e) || !e || \"1=1\" === e ? null : e;\n}\n\nfunction G(e, t) {\n  if (!D(e)) return null;\n  const {\n    spatialReference: i\n  } = e;\n  if (!i || i.isWGS84) return {\n    bbox: R(e)\n  };\n  const n = P(i, t);\n  return n ? {\n    bbox: R(e),\n    \"bbox-crs\": n\n  } : i.isWebMercator ? {\n    bbox: R(c(e, F.WGS84))\n  } : null;\n}\n\nfunction $(e, t, i) {\n  return e.find(e => e.rel === t && e.type === i) || e.find(e => e.rel === t && !e.type);\n}\n\nexport { T as getCollectionDefinition, k as getServerCollections, S as getServerConformance, x as getServerLandingPage, v as getServerOpenApi, N as getSpatialReference, q as queryFeatureSet, M as queryFeatureSetJSON, O as queryOptimizedFeatureSet };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/ogc/ogcFeatureUtils.js"],"names":["_","e","t","i","n","isNone","r","unwrapOr","a","isSome","o","WGS84","s","equals","l","project","c","convertToFeatureSet","d","convertToGeometry","u","convertFromGeometry","p","m","validateGeoJSON","f","inferLayerProperties","g","createOptimizedFeatures","y","createDrawingInfo","w","h","kebabDict","b","j","F","I","getLogger","T","links","$","data","href","signal","query","limit","customParameters","token","apiKey","headers","accept","geometryType","fields","hasZ","objectIdField","objectIdFieldName","timeInfo","find","name","objectIdFieldType","unshift","alias","type","editable","nullable","unknownFields","length","warn","message","details","field","jsonValues","indexOf","startTimeField","get","endTimeField","trackIdField","drawingInfo","k","S","x","v","N","authority","version","code","exec","groups","toLowerCase","GCS_NAD_1927","wkid","Number","parseInt","isNaN","WebMercator","q","M","fromJSON","O","capabilities","maxRecordCount","collection","layerDefinition","queryParameters","spatialReference","supportedCrs","geometry","num","start","timeExtent","where","objectIds","outSpatialReference","isWGS84","P","G","D","C","R","W","Z","K","crs","datetime","startindex","L","rel","isInteger","numberMatched","numberReturned","J","globalIdField","hasM","A","E","U","B","z","isWebMercator","objectId","attributes","H","toJSON","Q","exceededTransferLimit","features","globalIdFieldName","xmin","ymin","xmax","ymax","end","toISOString","bbox","getCollectionDefinition","getServerCollections","getServerConformance","getServerLandingPage","getServerOpenApi","getSpatialReference","queryFeatureSet","queryFeatureSetJSON","queryOptimizedFeatureSet"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/_rollupPluginBabelHelpers.js\";import\"../../geometry.js\";import t from\"../../request.js\";import i from\"../../core/Error.js\";import n from\"../../core/Logger.js\";import{isNone as r,unwrapOr as a,isSome as o}from\"../../core/maybe.js\";import{WGS84 as s,equals as l}from\"../../geometry/support/spatialReferenceUtils.js\";import{project as c}from\"../../geometry/support/webMercatorUtils.js\";import{convertToFeatureSet as d,convertToGeometry as u,convertFromGeometry as p}from\"../graphics/featureConversionUtils.js\";import m from\"../graphics/OptimizedFeatureSet.js\";import{validateGeoJSON as f,inferLayerProperties as g,createOptimizedFeatures as y}from\"../graphics/sources/geojson/geojson.js\";import{createDrawingInfo as w}from\"../graphics/sources/support/clientSideDefaults.js\";import h from\"../support/FieldsIndex.js\";import{kebabDict as b}from\"../support/fieldType.js\";import j from\"../../rest/support/FeatureSet.js\";import F from\"../../geometry/SpatialReference.js\";const I=n.getLogger(\"esri.layers.graphics.sources.ogcfeature\");async function T(e,n,a={},o=5){const{links:s}=e,l=$(s,\"items\",\"application/geo+json\")||$(s,\"http://www.opengis.net/def/rel/ogc/1.0/items\",\"application/geo+json\");if(r(l))throw new i(\"ogc-feature-layer:missing-items-page\",\"Missing items url\");const{data:c}=await t(l.href,{signal:a.signal,query:{limit:o,...a.customParameters,token:a.apiKey},headers:{accept:\"application/geo+json\"}});await f(c);const d=g(c,{geometryType:n.geometryType}),u=n.fields||d.fields||[],p=null!=n.hasZ?n.hasZ:d.hasZ,m=d.geometryType,y=n.objectIdField||d.objectIdFieldName||\"OBJECTID\";let j=n.timeInfo;const F=u.find((e=>e.name===y));if(!F){if(!d.objectIdFieldType)throw new i(\"ogc-feature-layer:missing-feature-id\",\"Collection geojson require a feature id as a unique identifier\");u.unshift({name:y,alias:y,type:\"esriFieldTypeOID\",editable:!1,nullable:!1})}else F.type=\"esriFieldTypeOID\",F.editable=!1,F.nullable=!1;if(y!==d.objectIdFieldName){const e=u.find((e=>e.name===d.objectIdFieldName));e&&(e.type=\"esriFieldTypeInteger\")}if(!m)throw new i(\"ogc-feature-layer:missing-property\",\"geometryType not set and couldn't be inferred from the provided features\");u===d.fields&&d.unknownFields.length>0&&I.warn({name:\"ogc-feature-layer:unknown-field-types\",message:\"Some fields types couldn't be inferred from the features and were dropped\",details:{unknownFields:d.unknownFields}});for(const t of u){if(null==t.name&&(t.name=t.alias),null==t.alias&&(t.alias=t.name),\"esriFieldTypeOID\"!==t.type&&\"esriFieldTypeGlobalID\"!==t.type&&(t.editable=null==t.editable||!!t.editable,t.nullable=null==t.nullable||!!t.nullable),!t.name)throw new i(\"ogc-feature-layer:invalid-field-name\",\"field name is missing\",{field:t});if(-1===b.jsonValues.indexOf(t.type))throw new i(\"ogc-feature-layer:invalid-field-type\",`invalid type for field \"${t.name}\"`,{field:t})}if(j){const e=new h(u);if(j.startTimeField){const t=e.get(j.startTimeField);t?(j.startTimeField=t.name,t.type=\"esriFieldTypeDate\"):j.startTimeField=null}if(j.endTimeField){const t=e.get(j.endTimeField);t?(j.endTimeField=t.name,t.type=\"esriFieldTypeDate\"):j.endTimeField=null}if(j.trackIdField){const t=e.get(j.trackIdField);t?j.trackIdField=t.name:(j.trackIdField=null,I.warn({name:\"ogc-feature-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:j}}))}j.startTimeField||j.endTimeField||(I.warn({name:\"ogc-feature-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing\",details:{timeInfo:j}}),j=null)}return{drawingInfo:w(m),geometryType:m,fields:u,hasZ:!!p,objectIdField:y,timeInfo:j}}async function k(e,n={}){const{links:a}=e,o=$(a,\"data\",\"application/json\")||$(a,\"http://www.opengis.net/def/rel/ogc/1.0/data\",\"application/json\");if(r(o))throw new i(\"ogc-feature-layer:missing-collections-page\",\"Missing collections url\");const{apiKey:s,customParameters:l,signal:c}=n,{data:d}=await t(o.href,{signal:c,headers:{accept:\"application/json\"},query:{...l,token:s}});return d}async function S(e,n={}){const{links:a}=e,o=$(a,\"conformance\",\"application/json\")||$(a,\"http://www.opengis.net/def/rel/ogc/1.0/conformance\",\"application/json\");if(r(o))throw new i(\"ogc-feature-layer:missing-conformance-page\",\"Missing conformance url\");const{apiKey:s,customParameters:l,signal:c}=n,{data:d}=await t(o.href,{signal:c,headers:{accept:\"application/json\"},query:{...l,token:s}});return d}async function x(e,i={}){const{apiKey:n,customParameters:r,signal:a}=i,{data:o}=await t(e,{signal:a,headers:{accept:\"application/json\"},query:{...r,token:n}});return o}async function v(e,i={}){const n=\"application/vnd.oai.openapi+json;version=3.0\",a=$(e.links,\"service-desc\",n);if(r(a))return I.warn(\"ogc-feature-layer:missing-openapi-page\",\"The OGC API-Features server does not have an OpenAPI page.\"),null;const{apiKey:o,customParameters:s,signal:l}=i,{data:c}=await t(a.href,{signal:l,headers:{accept:n},query:{...s,token:o}});return c}function N(t){const i=e(/^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/(.*)\\/(.*)\\/(.*)$/i,{authority:1,version:2,code:3}).exec(t),n=null==i?void 0:i.groups;if(!n)return null;const{authority:r,code:a}=n;switch(r.toLowerCase()){case\"ogc\":switch(a.toLowerCase()){case\"crs27\":return F.GCS_NAD_1927;case\"crs83\":return new F({wkid:4269});case\"crs84\":case\"crs84h\":return F.WGS84;default:return null}case\"esri\":case\"epsg\":{const e=Number.parseInt(a,10);return Number.isNaN(e)?null:900913===e?F.WebMercator:new F({wkid:e})}default:return null}}async function q(e,t,i){const n=await M(e,t,i);return j.fromJSON(n)}async function M(e,t,i){const n=await O(e,t,i);return d(n)}async function O(e,n,o){const{capabilities:{query:{maxRecordCount:l}},collection:d,layerDefinition:f,queryParameters:{apiKey:g,customParameters:w},spatialReference:h,supportedCrs:b}=e,{links:j}=d,I=$(j,\"items\",\"application/geo+json\")||$(j,\"http://www.opengis.net/def/rel/ogc/1.0/items\",\"application/geo+json\");if(r(I))throw new i(\"ogc-feature-layer:missing-items-page\",\"Missing items url\");const{geometry:T,num:k,start:S,timeExtent:x,where:v}=n;if(n.objectIds)throw new i(\"ogc-feature-layer:query-by-objectids-not-supported\",\"Queries with objectids are not supported\");const N=F.fromJSON(h),q=a(n.outSpatialReference,N),M=q.isWGS84?null:P(q,b),O=G(T,b),D=C(x),R=W(v),Z=null!=k?k:null!=S&&void 0!==S?10:l,{data:K}=await t(I.href,{...o,query:{...w,...O,crs:M,datetime:D,query:R,limit:Z,startindex:S,token:g},headers:{accept:\"application/geo+json\"}});let L=!1;if(K.links){L=!!K.links.find((e=>\"next\"===e.rel))}!L&&Number.isInteger(K.numberMatched)&&Number.isInteger(K.numberReturned)&&(L=K.numberReturned<K.numberMatched);const{fields:J,globalIdField:_,hasM:A,hasZ:E,objectIdField:U}=f,B=f.geometryType,z=y(K,{geometryType:B,hasZ:E,objectIdField:U});if(!M&&q.isWebMercator)for(const t of z)if(t.geometry){const e=u(t.geometry,B,E,!1);e.spatialReference=F.WGS84,t.geometry=p(c(e,q))}for(const t of z)t.objectId=t.attributes[U];const H=M||!M&&q.isWebMercator?q.toJSON():s,Q=new m;return Q.exceededTransferLimit=L,Q.features=z,Q.fields=J,Q.geometryType=B,Q.globalIdFieldName=_,Q.hasM=A,Q.hasZ=E,Q.objectIdFieldName=U,Q.spatialReference=H,Q}function D(e){return o(e)&&\"extent\"===e.type}function P(e,t){return t.find((t=>{const i=N(t);return l(i,e)}))}function R(e){const{xmin:t,ymin:i,xmax:n,ymax:r}=e;return`${t},${i},${n},${r}`}function C(e){if(r(e))return null;const{start:t,end:i}=e;return`${o(t)?t.toISOString():\"..\"}/${o(i)?i.toISOString():\"..\"}`}function W(e){return r(e)||!e||\"1=1\"===e?null:e}function G(e,t){if(!D(e))return null;const{spatialReference:i}=e;if(!i||i.isWGS84)return{bbox:R(e)};const n=P(i,t);return n?{bbox:R(e),\"bbox-crs\":n}:i.isWebMercator?{bbox:R(c(e,F.WGS84))}:null}function $(e,t,i){return e.find((e=>e.rel===t&&e.type===i))||e.find((e=>e.rel===t&&!e.type))}export{T as getCollectionDefinition,k as getServerCollections,S as getServerConformance,x as getServerLandingPage,v as getServerOpenApi,N as getSpatialReference,q as queryFeatureSet,M as queryFeatureSetJSON,O as queryOptimizedFeatureSet};\n"]},"metadata":{},"sourceType":"module"}