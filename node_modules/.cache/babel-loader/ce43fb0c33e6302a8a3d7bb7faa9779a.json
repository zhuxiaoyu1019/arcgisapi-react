{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport \"../../../../core/has.js\";\nimport { clamp as e } from \"../../../../core/mathUtils.js\";\nimport { f as o } from \"../../../../chunks/mat3.js\";\nimport { c as t } from \"../../../../chunks/mat3f64.js\";\nimport { i, r as n, b as r, j as s, d as l, h as a, m as u, s as f, t as c } from \"../../../../chunks/mat4.js\";\nimport { c as p } from \"../../../../chunks/mat4f64.js\";\nimport { s as v } from \"../../../../chunks/vec3.js\";\nimport { c as d } from \"../../../../chunks/vec3f64.js\";\nimport { meterIn as z } from \"../../../../renderers/support/lengthUtils.js\";\nimport m from \"../../support/debugFlags.js\";\n\nfunction y(e) {\n  return null != e;\n}\n\nfunction S(e) {\n  return \"number\" == typeof e;\n}\n\nfunction h(e) {\n  return \"string\" == typeof e;\n}\n\nfunction x(e) {\n  return null == e || h(e);\n}\n\nfunction b(e, o) {\n  e && e.push(o);\n}\n\nfunction C(e, o, t, i = p()) {\n  const l = e || 0,\n        a = o || 0,\n        u = t || 0;\n  return 0 !== l && n(i, i, -l / 180 * Math.PI), 0 !== a && r(i, i, a / 180 * Math.PI), 0 !== u && s(i, i, u / 180 * Math.PI), i;\n}\n\nfunction M(e, o, t, i, n) {\n  const r = e.minSize,\n        s = e.maxSize;\n  if (e.expression) return b(n, \"Could not convert size info: expression not supported\"), !1;\n\n  if (e.useSymbolValue) {\n    const e = i.symbolSize[t];\n    return o.minSize[t] = e, o.maxSize[t] = e, o.offset[t] = o.minSize[t], o.factor[t] = 0, o.type[t] = 1, !0;\n  }\n\n  if (y(e.field)) return y(e.stops) ? 2 === e.stops.length && S(e.stops[0].size) && S(e.stops[1].size) ? (g(e.stops[0].size, e.stops[1].size, e.stops[0].value, e.stops[1].value, o, t), o.type[t] = 1, !0) : (b(n, \"Could not convert size info: stops only supported with 2 elements\"), !1) : S(r) && S(s) && y(e.minDataValue) && y(e.maxDataValue) ? (g(r, s, e.minDataValue, e.maxDataValue, o, t), o.type[t] = 1, !0) : null != z[e.valueUnit] ? (o.minSize[t] = -1 / 0, o.maxSize[t] = 1 / 0, o.offset[t] = 0, o.factor[t] = 1 / z[e.valueUnit], o.type[t] = 1, !0) : \"unknown\" === e.valueUnit ? (b(n, \"Could not convert size info: proportional size not supported\"), !1) : (b(n, \"Could not convert size info: scale-dependent size not supported\"), !1);\n\n  if (!y(e.field)) {\n    if (e.stops && e.stops[0] && S(e.stops[0].size)) return o.minSize[t] = e.stops[0].size, o.maxSize[t] = e.stops[0].size, o.offset[t] = o.minSize[t], o.factor[t] = 0, o.type[t] = 1, !0;\n    if (S(r)) return o.minSize[t] = r, o.maxSize[t] = r, o.offset[t] = r, o.factor[t] = 0, o.type[t] = 1, !0;\n  }\n\n  return b(n, \"Could not convert size info: unsupported variant of sizeInfo\"), !1;\n}\n\nfunction g(e, o, t, i, n, r) {\n  const s = Math.abs(i - t) > 0 ? (o - e) / (i - t) : 0;\n  n.minSize[r] = s > 0 ? e : o, n.maxSize[r] = s > 0 ? o : e, n.offset[r] = e - t * s, n.factor[r] = s;\n}\n\nfunction V(e, o, t, i) {\n  if (e.normalizationField || e.valueRepresentation) return b(i, \"Could not convert size info: unsupported property\"), null;\n  if (!x(e.field)) return b(i, \"Could not convert size info: field is not a string\"), null;\n\n  if (o.size) {\n    if (e.field) if (o.size.field) {\n      if (e.field !== o.size.field) return b(i, \"Could not convert size info: multiple fields in use\"), null;\n    } else o.size.field = e.field;\n  } else o.size = {\n    field: e.field,\n    minSize: [0, 0, 0],\n    maxSize: [0, 0, 0],\n    offset: [0, 0, 0],\n    factor: [0, 0, 0],\n    type: [0, 0, 0]\n  };\n\n  let n;\n\n  switch (e.axis) {\n    case \"width\":\n      return n = M(e, o.size, 0, t, i), n ? o : null;\n\n    case \"height\":\n      return n = M(e, o.size, 2, t, i), n ? o : null;\n\n    case \"depth\":\n      return n = M(e, o.size, 1, t, i), n ? o : null;\n\n    case \"width-and-depth\":\n      return n = M(e, o.size, 0, t, i), n && M(e, o.size, 1, t, i), n ? o : null;\n\n    case null:\n    case void 0:\n    case \"all\":\n      return n = M(e, o.size, 0, t, i), n = n && M(e, o.size, 1, t, i), n = n && M(e, o.size, 2, t, i), n ? o : null;\n\n    default:\n      return b(i, `Could not convert size info: unknown axis \"${e.axis}\"\"`), null;\n  }\n}\n\nfunction T(e, o, t) {\n  for (let n = 0; n < 3; ++n) {\n    let t = o.unitInMeters;\n    1 === e.type[n] && (t *= o.modelSize[n], e.type[n] = 2), e.minSize[n] = e.minSize[n] / t, e.maxSize[n] = e.maxSize[n] / t, e.offset[n] = e.offset[n] / t, e.factor[n] = e.factor[n] / t;\n  }\n\n  let i;\n  if (0 !== e.type[0]) i = 0;else if (0 !== e.type[1]) i = 1;else {\n    if (0 === e.type[2]) return b(t, \"No size axis contains a valid size or scale\"), !1;\n    i = 2;\n  }\n\n  for (let n = 0; n < 3; ++n) 0 === e.type[n] && (e.minSize[n] = e.minSize[i], e.maxSize[n] = e.maxSize[i], e.offset[n] = e.offset[i], e.factor[n] = e.factor[i], e.type[n] = e.type[i]);\n\n  return !0;\n}\n\nfunction O(e, o, t) {\n  e[4 * o + 0] = t.r / 255, e[4 * o + 1] = t.g / 255, e[4 * o + 2] = t.b / 255, e[4 * o + 3] = t.a;\n}\n\nfunction j(e, o, t) {\n  if (e.normalizationField) return b(t, \"Could not convert color info: unsupported property\"), null;\n\n  if (h(e.field)) {\n    if (!e.stops) return b(t, \"Could not convert color info: missing stops or colors\"), null;\n    {\n      if (e.stops.length > 8) return b(t, \"Could not convert color info: too many color stops\"), null;\n      o.color = {\n        field: e.field,\n        values: [0, 0, 0, 0, 0, 0, 0, 0],\n        colors: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n      };\n      const i = e.stops;\n\n      for (let e = 0; e < 8; ++e) {\n        const t = i[Math.min(e, i.length - 1)];\n        o.color.values[e] = t.value, O(o.color.colors, e, t.color);\n      }\n    }\n  } else {\n    if (!(e.stops && e.stops.length >= 0)) return b(t, \"Could not convert color info: no field and no colors/stops\"), null;\n    {\n      const t = e.stops && e.stops.length >= 0 && e.stops[0].color;\n      o.color = {\n        field: null,\n        values: [0, 0, 0, 0, 0, 0, 0, 0],\n        colors: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n      };\n\n      for (let e = 0; e < 8; e++) o.color.values[e] = 1 / 0, O(o.color.colors, e, t);\n    }\n  }\n\n  return o;\n}\n\nfunction E(e, o, t) {\n  if (e.normalizationField) return b(t, \"Could not convert opacity info: unsupported property\"), null;\n\n  if (h(e.field)) {\n    if (!e.stops) return b(t, \"Could not convert opacity info: missing stops or opacities\"), null;\n    {\n      if (e.stops.length > 8) return b(t, \"Could not convert opacity info: too many opacity stops\"), null;\n      o.opacity = {\n        field: e.field,\n        values: [0, 0, 0, 0, 0, 0, 0, 0],\n        opacityValues: [0, 0, 0, 0, 0, 0, 0, 0]\n      };\n      const i = e.stops;\n\n      for (let e = 0; e < 8; ++e) {\n        const t = i[Math.min(e, i.length - 1)];\n        o.opacity.values[e] = t.value, o.opacity.opacityValues[e] = t.opacity;\n      }\n    }\n  } else {\n    if (!(e.stops && e.stops.length >= 0)) return b(t, \"Could not convert opacity info: no field and no opacities/stops\"), null;\n    {\n      const t = e.stops && e.stops.length >= 0 && e.stops[0].opacity;\n      o.opacity = {\n        field: null,\n        values: [0, 0, 0, 0, 0, 0, 0, 0],\n        opacityValues: [0, 0, 0, 0, 0, 0, 0, 0]\n      };\n\n      for (let e = 0; e < 8; e++) o.opacity.values[e] = 1 / 0, o.opacity.opacityValues[e] = t;\n    }\n  }\n\n  return o;\n}\n\nfunction k(e, o, t) {\n  const i = 2 === t && \"arithmetic\" === e.rotationType;\n  o.offset[t] = i ? 90 : 0, o.factor[t] = i ? -1 : 1, o.type[t] = 1;\n}\n\nfunction w(e, o, t) {\n  if (!h(e.field)) return b(t, \"Could not convert rotation info: field is not a string\"), null;\n\n  if (o.rotation) {\n    if (e.field) if (o.rotation.field) {\n      if (e.field !== o.rotation.field) return b(t, \"Could not convert rotation info: multiple fields in use\"), null;\n    } else o.rotation.field = e.field;\n  } else o.rotation = {\n    field: e.field,\n    offset: [0, 0, 0],\n    factor: [1, 1, 1],\n    type: [0, 0, 0]\n  };\n\n  switch (e.axis) {\n    case \"tilt\":\n      return k(e, o.rotation, 0), o;\n\n    case \"roll\":\n      return k(e, o.rotation, 1), o;\n\n    case null:\n    case void 0:\n    case \"heading\":\n      return k(e, o.rotation, 2), o;\n\n    default:\n      return b(t, `Could not convert rotation info: unknown axis \"${e.axis}\"\"`), null;\n  }\n}\n\nfunction F(e, o, t) {\n  if (!e) return null;\n  const i = !o.supportedTypes || !!o.supportedTypes.size,\n        n = !o.supportedTypes || !!o.supportedTypes.color,\n        r = !o.supportedTypes || !!o.supportedTypes.rotation,\n        s = !!o.supportedTypes && !!o.supportedTypes.opacity,\n        l = e.reduce((e, l) => {\n    if (!e) return e;\n    if (l.valueExpression) return b(t, \"Could not convert visual variables: arcade expressions not supported\"), null;\n\n    switch (l.type) {\n      case \"size\":\n        return i ? V(l, e, o, t) : e;\n\n      case \"color\":\n        return n ? j(l, e, t) : e;\n\n      case \"opacity\":\n        return s ? E(l, e, t) : null;\n\n      case \"rotation\":\n        return r ? w(l, e, t) : e;\n\n      default:\n        return null;\n    }\n  }, {\n    size: null,\n    color: null,\n    opacity: null,\n    rotation: null\n  });\n  return !(e.length > 0 && l) || l.size || l.color || l.opacity || l.rotation ? l && l.size && !T(l.size, o, t) ? null : l : null;\n}\n\nfunction A(e) {\n  return e && null != e.size;\n}\n\nfunction D(e, o) {\n  if (!e) return {\n    enabled: !1\n  };\n  if (m.DISABLE_FAST_UPDATES) return {\n    enabled: !1\n  };\n  const t = F(e.visualVariables, o);\n  return t ? {\n    enabled: !0,\n    visualVariables: t,\n    materialParameters: U(t, o),\n    requiresShaderTransformation: A(t)\n  } : {\n    enabled: !1\n  };\n}\n\nfunction I(e, o, t) {\n  if (!o || !e.enabled) return !1;\n  const i = e.visualVariables,\n        n = F(o.visualVariables, t);\n  return !!n && !!(P(i.size, n.size, \"size\") && P(i.color, n.color, \"color\") && P(i.rotation, n.rotation, \"rotation\") && P(i.opacity, n.opacity, \"opacity\")) && (e.visualVariables = n, e.materialParameters = U(n, t), e.requiresShaderTransformation = A(n), !0);\n}\n\nfunction P(e, o, t) {\n  if (!!e != !!o) return !1;\n  if (e && e.field !== o.field) return !1;\n\n  if (e && \"rotation\" === t) {\n    const t = e,\n          i = o;\n\n    for (let e = 0; e < 3; e++) if (t.type[e] !== i.type[e] || t.offset[e] !== i.offset[e] || t.factor[e] !== i.factor[e]) return !1;\n  }\n\n  return !0;\n}\n\nfunction U(e, n) {\n  const r = {\n    vvSizeEnabled: !1,\n    vvSizeMinSize: null,\n    vvSizeMaxSize: null,\n    vvSizeOffset: null,\n    vvSizeFactor: null,\n    vvSizeValue: null,\n    vvColorEnabled: !1,\n    vvColorValues: null,\n    vvColorColors: null,\n    vvOpacityEnabled: !1,\n    vvOpacityValues: null,\n    vvOpacityOpacities: null,\n    vvSymbolAnchor: null,\n    vvSymbolRotationMatrix: null\n  },\n        s = A(e);\n  return e && e.size ? (r.vvSizeEnabled = !0, r.vvSizeMinSize = e.size.minSize, r.vvSizeMaxSize = e.size.maxSize, r.vvSizeOffset = e.size.offset, r.vvSizeFactor = e.size.factor) : e && s && (r.vvSizeValue = n.transformation.scale), e && s && (r.vvSymbolAnchor = n.transformation.anchor, r.vvSymbolRotationMatrix = t(), i(q), C(n.transformation.rotation[2], n.transformation.rotation[0], n.transformation.rotation[1], q), o(r.vvSymbolRotationMatrix, q)), e && e.color && (r.vvColorEnabled = !0, r.vvColorValues = e.color.values, r.vvColorColors = e.color.colors), e && e.opacity && (r.vvOpacityEnabled = !0, r.vvOpacityValues = e.opacity.values, r.vvOpacityOpacities = e.opacity.opacityValues), r;\n}\n\nvar R;\n!function (o) {\n  const t = p(),\n        i = d();\n\n  function n(o, n, r) {\n    if (!o.vvSizeEnabled) return r;\n    l(t, r);\n    const s = o.vvSymbolRotationMatrix;\n    a(q, s[0], s[1], s[2], 0, s[3], s[4], s[5], 0, s[6], s[7], s[8], 0, 0, 0, 0, 1), u(t, t, q);\n\n    for (let t = 0; t < 3; ++t) {\n      const r = o.vvSizeOffset[t] + n[0] * o.vvSizeFactor[t];\n      i[t] = e(r, o.vvSizeMinSize[t], o.vvSizeMaxSize[t]);\n    }\n\n    return f(t, t, i), c(t, t, o.vvSymbolAnchor), t;\n  }\n\n  function r(o, t, i) {\n    if (!t.vvSizeEnabled) return v(o, 1, 1, 1);\n\n    for (let n = 0; n < 3; ++n) {\n      const r = t.vvSizeOffset[n] + i[0] * t.vvSizeFactor[n];\n      o[n] = e(r, t.vvSizeMinSize[n], t.vvSizeMaxSize[n]);\n    }\n\n    return o;\n  }\n\n  o.evaluateModelTransform = n, o.evaluateModelTransformScale = r;\n}(R || (R = {}));\nconst q = p(),\n      $ = R.evaluateModelTransform,\n      _ = R.evaluateModelTransformScale;\nexport { F as convertVisualVariables, $ as evaluateModelTransform, _ as evaluateModelTransformScale, U as getMaterialParams, D as initFastSymbolUpdatesState, I as updateFastSymbolUpdatesState };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/support/FastSymbolUpdates.js"],"names":["clamp","e","f","o","c","t","i","r","n","b","j","s","d","l","h","a","m","u","p","v","meterIn","z","y","S","x","push","C","Math","PI","M","minSize","maxSize","expression","useSymbolValue","symbolSize","offset","factor","type","field","stops","length","size","g","value","minDataValue","maxDataValue","valueUnit","abs","V","normalizationField","valueRepresentation","axis","T","unitInMeters","modelSize","O","color","values","colors","min","E","opacity","opacityValues","k","rotationType","w","rotation","F","supportedTypes","reduce","valueExpression","A","D","enabled","DISABLE_FAST_UPDATES","visualVariables","materialParameters","U","requiresShaderTransformation","I","P","vvSizeEnabled","vvSizeMinSize","vvSizeMaxSize","vvSizeOffset","vvSizeFactor","vvSizeValue","vvColorEnabled","vvColorValues","vvColorColors","vvOpacityEnabled","vvOpacityValues","vvOpacityOpacities","vvSymbolAnchor","vvSymbolRotationMatrix","transformation","scale","anchor","q","R","evaluateModelTransform","evaluateModelTransformScale","$","_","convertVisualVariables","getMaterialParams","initFastSymbolUpdatesState","updateFastSymbolUpdatesState"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAM,yBAAN;AAAgC,SAAOA,KAAK,IAAIC,CAAhB,QAAsB,+BAAtB;AAAsD,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOC,CAAP,EAASC,CAAC,IAAIC,CAAd,EAAgBC,CAAC,IAAIF,CAArB,EAAuBG,CAAC,IAAIC,CAA5B,EAA8BC,CAAC,IAAIC,CAAnC,EAAqCC,CAAC,IAAIC,CAA1C,EAA4CC,CAAC,IAAIC,CAAjD,EAAmDN,CAAC,IAAIT,CAAxD,EAA0DG,CAAC,IAAID,CAA/D,QAAqE,4BAArE;AAAkG,SAAOA,CAAC,IAAIc,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOP,CAAC,IAAIQ,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOf,CAAC,IAAIQ,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOQ,OAAO,IAAIC,CAAlB,QAAwB,8CAAxB;AAAuE,OAAOL,CAAP,MAAa,6BAAb;;AAA2C,SAASM,CAAT,CAAWrB,CAAX,EAAa;AAAC,SAAO,QAAMA,CAAb;AAAe;;AAAA,SAASsB,CAAT,CAAWtB,CAAX,EAAa;AAAC,SAAM,YAAU,OAAOA,CAAvB;AAAyB;;AAAA,SAASa,CAAT,CAAWb,CAAX,EAAa;AAAC,SAAM,YAAU,OAAOA,CAAvB;AAAyB;;AAAA,SAASuB,CAAT,CAAWvB,CAAX,EAAa;AAAC,SAAO,QAAMA,CAAN,IAASa,CAAC,CAACb,CAAD,CAAjB;AAAqB;;AAAA,SAASQ,CAAT,CAAWR,CAAX,EAAaE,CAAb,EAAe;AAACF,EAAAA,CAAC,IAAEA,CAAC,CAACwB,IAAF,CAAOtB,CAAP,CAAH;AAAa;;AAAA,SAASuB,CAAT,CAAWzB,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBC,CAAC,GAACY,CAAC,EAApB,EAAuB;AAAC,QAAML,CAAC,GAACZ,CAAC,IAAE,CAAX;AAAA,QAAac,CAAC,GAACZ,CAAC,IAAE,CAAlB;AAAA,QAAoBc,CAAC,GAACZ,CAAC,IAAE,CAAzB;AAA2B,SAAO,MAAIQ,CAAJ,IAAOL,CAAC,CAACF,CAAD,EAAGA,CAAH,EAAK,CAACO,CAAD,GAAG,GAAH,GAAOc,IAAI,CAACC,EAAjB,CAAR,EAA6B,MAAIb,CAAJ,IAAOR,CAAC,CAACD,CAAD,EAAGA,CAAH,EAAKS,CAAC,GAAC,GAAF,GAAMY,IAAI,CAACC,EAAhB,CAArC,EAAyD,MAAIX,CAAJ,IAAON,CAAC,CAACL,CAAD,EAAGA,CAAH,EAAKW,CAAC,GAAC,GAAF,GAAMU,IAAI,CAACC,EAAhB,CAAjE,EAAqFtB,CAA5F;AAA8F;;AAAA,SAASuB,CAAT,CAAW5B,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqB;AAAC,QAAMD,CAAC,GAACN,CAAC,CAAC6B,OAAV;AAAA,QAAkBnB,CAAC,GAACV,CAAC,CAAC8B,OAAtB;AAA8B,MAAG9B,CAAC,CAAC+B,UAAL,EAAgB,OAAOvB,CAAC,CAACD,CAAD,EAAG,uDAAH,CAAD,EAA6D,CAAC,CAArE;;AAAuE,MAAGP,CAAC,CAACgC,cAAL,EAAoB;AAAC,UAAMhC,CAAC,GAACK,CAAC,CAAC4B,UAAF,CAAa7B,CAAb,CAAR;AAAwB,WAAOF,CAAC,CAAC2B,OAAF,CAAUzB,CAAV,IAAaJ,CAAb,EAAeE,CAAC,CAAC4B,OAAF,CAAU1B,CAAV,IAAaJ,CAA5B,EAA8BE,CAAC,CAACgC,MAAF,CAAS9B,CAAT,IAAYF,CAAC,CAAC2B,OAAF,CAAUzB,CAAV,CAA1C,EAAuDF,CAAC,CAACiC,MAAF,CAAS/B,CAAT,IAAY,CAAnE,EAAqEF,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAA/E,EAAiF,CAAC,CAAzF;AAA2F;;AAAA,MAAGiB,CAAC,CAACrB,CAAC,CAACqC,KAAH,CAAJ,EAAc,OAAOhB,CAAC,CAACrB,CAAC,CAACsC,KAAH,CAAD,GAAW,MAAItC,CAAC,CAACsC,KAAF,CAAQC,MAAZ,IAAoBjB,CAAC,CAACtB,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAAZ,CAArB,IAAwClB,CAAC,CAACtB,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAAZ,CAAzC,IAA4DC,CAAC,CAACzC,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAAZ,EAAiBxC,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAA5B,EAAiCxC,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWI,KAA5C,EAAkD1C,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWI,KAA7D,EAAmExC,CAAnE,EAAqEE,CAArE,CAAD,EAAyEF,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAAnF,EAAqF,CAAC,CAAlJ,KAAsJI,CAAC,CAACD,CAAD,EAAG,mEAAH,CAAD,EAAyE,CAAC,CAAhO,CAAX,GAA8Oe,CAAC,CAAChB,CAAD,CAAD,IAAMgB,CAAC,CAACZ,CAAD,CAAP,IAAYW,CAAC,CAACrB,CAAC,CAAC2C,YAAH,CAAb,IAA+BtB,CAAC,CAACrB,CAAC,CAAC4C,YAAH,CAAhC,IAAkDH,CAAC,CAACnC,CAAD,EAAGI,CAAH,EAAKV,CAAC,CAAC2C,YAAP,EAAoB3C,CAAC,CAAC4C,YAAtB,EAAmC1C,CAAnC,EAAqCE,CAArC,CAAD,EAAyCF,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAAnD,EAAqD,CAAC,CAAxG,IAA2G,QAAMgB,CAAC,CAACpB,CAAC,CAAC6C,SAAH,CAAP,IAAsB3C,CAAC,CAAC2B,OAAF,CAAUzB,CAAV,IAAa,CAAC,CAAD,GAAG,CAAhB,EAAkBF,CAAC,CAAC4B,OAAF,CAAU1B,CAAV,IAAa,IAAE,CAAjC,EAAmCF,CAAC,CAACgC,MAAF,CAAS9B,CAAT,IAAY,CAA/C,EAAiDF,CAAC,CAACiC,MAAF,CAAS/B,CAAT,IAAY,IAAEgB,CAAC,CAACpB,CAAC,CAAC6C,SAAH,CAAhE,EAA8E3C,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAAxF,EAA0F,CAAC,CAAjH,IAAoH,cAAYJ,CAAC,CAAC6C,SAAd,IAAyBrC,CAAC,CAACD,CAAD,EAAG,8DAAH,CAAD,EAAoE,CAAC,CAA9F,KAAkGC,CAAC,CAACD,CAAD,EAAG,iEAAH,CAAD,EAAuE,CAAC,CAA1K,CAApd;;AAAioB,MAAG,CAACc,CAAC,CAACrB,CAAC,CAACqC,KAAH,CAAL,EAAe;AAAC,QAAGrC,CAAC,CAACsC,KAAF,IAAStC,CAAC,CAACsC,KAAF,CAAQ,CAAR,CAAT,IAAqBhB,CAAC,CAACtB,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAAZ,CAAzB,EAA2C,OAAOtC,CAAC,CAAC2B,OAAF,CAAUzB,CAAV,IAAaJ,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAAxB,EAA6BtC,CAAC,CAAC4B,OAAF,CAAU1B,CAAV,IAAaJ,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWE,IAArD,EAA0DtC,CAAC,CAACgC,MAAF,CAAS9B,CAAT,IAAYF,CAAC,CAAC2B,OAAF,CAAUzB,CAAV,CAAtE,EAAmFF,CAAC,CAACiC,MAAF,CAAS/B,CAAT,IAAY,CAA/F,EAAiGF,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAA3G,EAA6G,CAAC,CAArH;AAAuH,QAAGkB,CAAC,CAAChB,CAAD,CAAJ,EAAQ,OAAOJ,CAAC,CAAC2B,OAAF,CAAUzB,CAAV,IAAaE,CAAb,EAAeJ,CAAC,CAAC4B,OAAF,CAAU1B,CAAV,IAAaE,CAA5B,EAA8BJ,CAAC,CAACgC,MAAF,CAAS9B,CAAT,IAAYE,CAA1C,EAA4CJ,CAAC,CAACiC,MAAF,CAAS/B,CAAT,IAAY,CAAxD,EAA0DF,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAApE,EAAsE,CAAC,CAA9E;AAAgF;;AAAA,SAAOI,CAAC,CAACD,CAAD,EAAG,8DAAH,CAAD,EAAoE,CAAC,CAA5E;AAA8E;;AAAA,SAASkC,CAAT,CAAWzC,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqBD,CAArB,EAAuB;AAAC,QAAMI,CAAC,GAACgB,IAAI,CAACoB,GAAL,CAASzC,CAAC,GAACD,CAAX,IAAc,CAAd,GAAgB,CAACF,CAAC,GAACF,CAAH,KAAOK,CAAC,GAACD,CAAT,CAAhB,GAA4B,CAApC;AAAsCG,EAAAA,CAAC,CAACsB,OAAF,CAAUvB,CAAV,IAAaI,CAAC,GAAC,CAAF,GAAIV,CAAJ,GAAME,CAAnB,EAAqBK,CAAC,CAACuB,OAAF,CAAUxB,CAAV,IAAaI,CAAC,GAAC,CAAF,GAAIR,CAAJ,GAAMF,CAAxC,EAA0CO,CAAC,CAAC2B,MAAF,CAAS5B,CAAT,IAAYN,CAAC,GAACI,CAAC,GAACM,CAA1D,EAA4DH,CAAC,CAAC4B,MAAF,CAAS7B,CAAT,IAAYI,CAAxE;AAA0E;;AAAA,SAASqC,CAAT,CAAW/C,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiBC,CAAjB,EAAmB;AAAC,MAAGL,CAAC,CAACgD,kBAAF,IAAsBhD,CAAC,CAACiD,mBAA3B,EAA+C,OAAOzC,CAAC,CAACH,CAAD,EAAG,mDAAH,CAAD,EAAyD,IAAhE;AAAqE,MAAG,CAACkB,CAAC,CAACvB,CAAC,CAACqC,KAAH,CAAL,EAAe,OAAO7B,CAAC,CAACH,CAAD,EAAG,oDAAH,CAAD,EAA0D,IAAjE;;AAAsE,MAAGH,CAAC,CAACsC,IAAL,EAAU;AAAC,QAAGxC,CAAC,CAACqC,KAAL,EAAW,IAAGnC,CAAC,CAACsC,IAAF,CAAOH,KAAV,EAAgB;AAAC,UAAGrC,CAAC,CAACqC,KAAF,KAAUnC,CAAC,CAACsC,IAAF,CAAOH,KAApB,EAA0B,OAAO7B,CAAC,CAACH,CAAD,EAAG,qDAAH,CAAD,EAA2D,IAAlE;AAAuE,KAAlH,MAAuHH,CAAC,CAACsC,IAAF,CAAOH,KAAP,GAAarC,CAAC,CAACqC,KAAf;AAAqB,GAAlK,MAAuKnC,CAAC,CAACsC,IAAF,GAAO;AAACH,IAAAA,KAAK,EAACrC,CAAC,CAACqC,KAAT;AAAeR,IAAAA,OAAO,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAvB;AAA+BC,IAAAA,OAAO,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAvC;AAA+CI,IAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAtD;AAA8DC,IAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAArE;AAA6EC,IAAAA,IAAI,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL;AAAlF,GAAP;;AAAkG,MAAI7B,CAAJ;;AAAM,UAAOP,CAAC,CAACkD,IAAT;AAAe,SAAI,OAAJ;AAAY,aAAO3C,CAAC,GAACqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAH,EAAoBE,CAAC,GAACL,CAAD,GAAG,IAA/B;;AAAoC,SAAI,QAAJ;AAAa,aAAOK,CAAC,GAACqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAH,EAAoBE,CAAC,GAACL,CAAD,GAAG,IAA/B;;AAAoC,SAAI,OAAJ;AAAY,aAAOK,CAAC,GAACqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAH,EAAoBE,CAAC,GAACL,CAAD,GAAG,IAA/B;;AAAoC,SAAI,iBAAJ;AAAsB,aAAOK,CAAC,GAACqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAH,EAAoBE,CAAC,IAAEqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAxB,EAAyCE,CAAC,GAACL,CAAD,GAAG,IAApD;;AAAyD,SAAK,IAAL;AAAU,SAAK,KAAK,CAAV;AAAY,SAAI,KAAJ;AAAU,aAAOK,CAAC,GAACqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAH,EAAoBE,CAAC,GAACA,CAAC,IAAEqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAA1B,EAA2CE,CAAC,GAACA,CAAC,IAAEqB,CAAC,CAAC5B,CAAD,EAAGE,CAAC,CAACsC,IAAL,EAAU,CAAV,EAAYpC,CAAZ,EAAcC,CAAd,CAAjD,EAAkEE,CAAC,GAACL,CAAD,GAAG,IAA7E;;AAAkF;AAAQ,aAAOM,CAAC,CAACH,CAAD,EAAI,8CAA6CL,CAAC,CAACkD,IAAK,IAAxD,CAAD,EAA8D,IAArE;AAAzW;AAAob;;AAAA,SAASC,CAAT,CAAWnD,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,OAAI,IAAIG,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgB,EAAEA,CAAlB,EAAoB;AAAC,QAAIH,CAAC,GAACF,CAAC,CAACkD,YAAR;AAAqB,UAAIpD,CAAC,CAACoC,IAAF,CAAO7B,CAAP,CAAJ,KAAgBH,CAAC,IAAEF,CAAC,CAACmD,SAAF,CAAY9C,CAAZ,CAAH,EAAkBP,CAAC,CAACoC,IAAF,CAAO7B,CAAP,IAAU,CAA5C,GAA+CP,CAAC,CAAC6B,OAAF,CAAUtB,CAAV,IAAaP,CAAC,CAAC6B,OAAF,CAAUtB,CAAV,IAAaH,CAAzE,EAA2EJ,CAAC,CAAC8B,OAAF,CAAUvB,CAAV,IAAaP,CAAC,CAAC8B,OAAF,CAAUvB,CAAV,IAAaH,CAArG,EAAuGJ,CAAC,CAACkC,MAAF,CAAS3B,CAAT,IAAYP,CAAC,CAACkC,MAAF,CAAS3B,CAAT,IAAYH,CAA/H,EAAiIJ,CAAC,CAACmC,MAAF,CAAS5B,CAAT,IAAYP,CAAC,CAACmC,MAAF,CAAS5B,CAAT,IAAYH,CAAzJ;AAA2J;;AAAA,MAAIC,CAAJ;AAAM,MAAG,MAAIL,CAAC,CAACoC,IAAF,CAAO,CAAP,CAAP,EAAiB/B,CAAC,GAAC,CAAF,CAAjB,KAA0B,IAAG,MAAIL,CAAC,CAACoC,IAAF,CAAO,CAAP,CAAP,EAAiB/B,CAAC,GAAC,CAAF,CAAjB,KAAyB;AAAC,QAAG,MAAIL,CAAC,CAACoC,IAAF,CAAO,CAAP,CAAP,EAAiB,OAAO5B,CAAC,CAACJ,CAAD,EAAG,6CAAH,CAAD,EAAmD,CAAC,CAA3D;AAA6DC,IAAAA,CAAC,GAAC,CAAF;AAAI;;AAAA,OAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgB,EAAEA,CAAlB,EAAoB,MAAIP,CAAC,CAACoC,IAAF,CAAO7B,CAAP,CAAJ,KAAgBP,CAAC,CAAC6B,OAAF,CAAUtB,CAAV,IAAaP,CAAC,CAAC6B,OAAF,CAAUxB,CAAV,CAAb,EAA0BL,CAAC,CAAC8B,OAAF,CAAUvB,CAAV,IAAaP,CAAC,CAAC8B,OAAF,CAAUzB,CAAV,CAAvC,EAAoDL,CAAC,CAACkC,MAAF,CAAS3B,CAAT,IAAYP,CAAC,CAACkC,MAAF,CAAS7B,CAAT,CAAhE,EAA4EL,CAAC,CAACmC,MAAF,CAAS5B,CAAT,IAAYP,CAAC,CAACmC,MAAF,CAAS9B,CAAT,CAAxF,EAAoGL,CAAC,CAACoC,IAAF,CAAO7B,CAAP,IAAUP,CAAC,CAACoC,IAAF,CAAO/B,CAAP,CAA9H;;AAAyI,SAAM,CAAC,CAAP;AAAS;;AAAA,SAASiD,CAAT,CAAWtD,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAACJ,EAAAA,CAAC,CAAC,IAAEE,CAAF,GAAI,CAAL,CAAD,GAASE,CAAC,CAACE,CAAF,GAAI,GAAb,EAAiBN,CAAC,CAAC,IAAEE,CAAF,GAAI,CAAL,CAAD,GAASE,CAAC,CAACqC,CAAF,GAAI,GAA9B,EAAkCzC,CAAC,CAAC,IAAEE,CAAF,GAAI,CAAL,CAAD,GAASE,CAAC,CAACI,CAAF,GAAI,GAA/C,EAAmDR,CAAC,CAAC,IAAEE,CAAF,GAAI,CAAL,CAAD,GAASE,CAAC,CAACU,CAA9D;AAAgE;;AAAA,SAASL,CAAT,CAAWT,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,MAAGJ,CAAC,CAACgD,kBAAL,EAAwB,OAAOxC,CAAC,CAACJ,CAAD,EAAG,oDAAH,CAAD,EAA0D,IAAjE;;AAAsE,MAAGS,CAAC,CAACb,CAAC,CAACqC,KAAH,CAAJ,EAAc;AAAC,QAAG,CAACrC,CAAC,CAACsC,KAAN,EAAY,OAAO9B,CAAC,CAACJ,CAAD,EAAG,uDAAH,CAAD,EAA6D,IAApE;AAAyE;AAAC,UAAGJ,CAAC,CAACsC,KAAF,CAAQC,MAAR,GAAe,CAAlB,EAAoB,OAAO/B,CAAC,CAACJ,CAAD,EAAG,oDAAH,CAAD,EAA0D,IAAjE;AAAsEF,MAAAA,CAAC,CAACqD,KAAF,GAAQ;AAAClB,QAAAA,KAAK,EAACrC,CAAC,CAACqC,KAAT;AAAemB,QAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,CAAtB;AAAwCC,QAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,EAAqB,CAArB,EAAuB,CAAvB,EAAyB,CAAzB,EAA2B,CAA3B,EAA6B,CAA7B,EAA+B,CAA/B,EAAiC,CAAjC,EAAmC,CAAnC,EAAqC,CAArC,EAAuC,CAAvC,EAAyC,CAAzC,EAA2C,CAA3C,EAA6C,CAA7C,EAA+C,CAA/C,EAAiD,CAAjD,EAAmD,CAAnD,EAAqD,CAArD,EAAuD,CAAvD,EAAyD,CAAzD,EAA2D,CAA3D,EAA6D,CAA7D,EAA+D,CAA/D;AAA/C,OAAR;AAA0H,YAAMpD,CAAC,GAACL,CAAC,CAACsC,KAAV;;AAAgB,WAAI,IAAItC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgB,EAAEA,CAAlB,EAAoB;AAAC,cAAMI,CAAC,GAACC,CAAC,CAACqB,IAAI,CAACgC,GAAL,CAAS1D,CAAT,EAAWK,CAAC,CAACkC,MAAF,GAAS,CAApB,CAAD,CAAT;AAAkCrC,QAAAA,CAAC,CAACqD,KAAF,CAAQC,MAAR,CAAexD,CAAf,IAAkBI,CAAC,CAACsC,KAApB,EAA0BY,CAAC,CAACpD,CAAC,CAACqD,KAAF,CAAQE,MAAT,EAAgBzD,CAAhB,EAAkBI,CAAC,CAACmD,KAApB,CAA3B;AAAsD;AAAC;AAAC,GAAxb,MAA4b;AAAC,QAAG,EAAEvD,CAAC,CAACsC,KAAF,IAAStC,CAAC,CAACsC,KAAF,CAAQC,MAAR,IAAgB,CAA3B,CAAH,EAAiC,OAAO/B,CAAC,CAACJ,CAAD,EAAG,4DAAH,CAAD,EAAkE,IAAzE;AAA8E;AAAC,YAAMA,CAAC,GAACJ,CAAC,CAACsC,KAAF,IAAStC,CAAC,CAACsC,KAAF,CAAQC,MAAR,IAAgB,CAAzB,IAA4BvC,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWiB,KAA/C;AAAqDrD,MAAAA,CAAC,CAACqD,KAAF,GAAQ;AAAClB,QAAAA,KAAK,EAAC,IAAP;AAAYmB,QAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,CAAnB;AAAqCC,QAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,EAAqB,CAArB,EAAuB,CAAvB,EAAyB,CAAzB,EAA2B,CAA3B,EAA6B,CAA7B,EAA+B,CAA/B,EAAiC,CAAjC,EAAmC,CAAnC,EAAqC,CAArC,EAAuC,CAAvC,EAAyC,CAAzC,EAA2C,CAA3C,EAA6C,CAA7C,EAA+C,CAA/C,EAAiD,CAAjD,EAAmD,CAAnD,EAAqD,CAArD,EAAuD,CAAvD,EAAyD,CAAzD,EAA2D,CAA3D,EAA6D,CAA7D,EAA+D,CAA/D;AAA5C,OAAR;;AAAuH,WAAI,IAAIzD,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgBA,CAAC,EAAjB,EAAoBE,CAAC,CAACqD,KAAF,CAAQC,MAAR,CAAexD,CAAf,IAAkB,IAAE,CAApB,EAAsBsD,CAAC,CAACpD,CAAC,CAACqD,KAAF,CAAQE,MAAT,EAAgBzD,CAAhB,EAAkBI,CAAlB,CAAvB;AAA4C;AAAC;;AAAA,SAAOF,CAAP;AAAS;;AAAA,SAASyD,CAAT,CAAW3D,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,MAAGJ,CAAC,CAACgD,kBAAL,EAAwB,OAAOxC,CAAC,CAACJ,CAAD,EAAG,sDAAH,CAAD,EAA4D,IAAnE;;AAAwE,MAAGS,CAAC,CAACb,CAAC,CAACqC,KAAH,CAAJ,EAAc;AAAC,QAAG,CAACrC,CAAC,CAACsC,KAAN,EAAY,OAAO9B,CAAC,CAACJ,CAAD,EAAG,4DAAH,CAAD,EAAkE,IAAzE;AAA8E;AAAC,UAAGJ,CAAC,CAACsC,KAAF,CAAQC,MAAR,GAAe,CAAlB,EAAoB,OAAO/B,CAAC,CAACJ,CAAD,EAAG,wDAAH,CAAD,EAA8D,IAArE;AAA0EF,MAAAA,CAAC,CAAC0D,OAAF,GAAU;AAACvB,QAAAA,KAAK,EAACrC,CAAC,CAACqC,KAAT;AAAemB,QAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,CAAtB;AAAwCK,QAAAA,aAAa,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf;AAAtD,OAAV;AAAmF,YAAMxD,CAAC,GAACL,CAAC,CAACsC,KAAV;;AAAgB,WAAI,IAAItC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgB,EAAEA,CAAlB,EAAoB;AAAC,cAAMI,CAAC,GAACC,CAAC,CAACqB,IAAI,CAACgC,GAAL,CAAS1D,CAAT,EAAWK,CAAC,CAACkC,MAAF,GAAS,CAApB,CAAD,CAAT;AAAkCrC,QAAAA,CAAC,CAAC0D,OAAF,CAAUJ,MAAV,CAAiBxD,CAAjB,IAAoBI,CAAC,CAACsC,KAAtB,EAA4BxC,CAAC,CAAC0D,OAAF,CAAUC,aAAV,CAAwB7D,CAAxB,IAA2BI,CAAC,CAACwD,OAAzD;AAAiE;AAAC;AAAC,GAAra,MAAya;AAAC,QAAG,EAAE5D,CAAC,CAACsC,KAAF,IAAStC,CAAC,CAACsC,KAAF,CAAQC,MAAR,IAAgB,CAA3B,CAAH,EAAiC,OAAO/B,CAAC,CAACJ,CAAD,EAAG,iEAAH,CAAD,EAAuE,IAA9E;AAAmF;AAAC,YAAMA,CAAC,GAACJ,CAAC,CAACsC,KAAF,IAAStC,CAAC,CAACsC,KAAF,CAAQC,MAAR,IAAgB,CAAzB,IAA4BvC,CAAC,CAACsC,KAAF,CAAQ,CAAR,EAAWsB,OAA/C;AAAuD1D,MAAAA,CAAC,CAAC0D,OAAF,GAAU;AAACvB,QAAAA,KAAK,EAAC,IAAP;AAAYmB,QAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,CAAnB;AAAqCK,QAAAA,aAAa,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf;AAAnD,OAAV;;AAAgF,WAAI,IAAI7D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgBA,CAAC,EAAjB,EAAoBE,CAAC,CAAC0D,OAAF,CAAUJ,MAAV,CAAiBxD,CAAjB,IAAoB,IAAE,CAAtB,EAAwBE,CAAC,CAAC0D,OAAF,CAAUC,aAAV,CAAwB7D,CAAxB,IAA2BI,CAAnD;AAAqD;AAAC;;AAAA,SAAOF,CAAP;AAAS;;AAAA,SAAS4D,CAAT,CAAW9D,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,QAAMC,CAAC,GAAC,MAAID,CAAJ,IAAO,iBAAeJ,CAAC,CAAC+D,YAAhC;AAA6C7D,EAAAA,CAAC,CAACgC,MAAF,CAAS9B,CAAT,IAAYC,CAAC,GAAC,EAAD,GAAI,CAAjB,EAAmBH,CAAC,CAACiC,MAAF,CAAS/B,CAAT,IAAYC,CAAC,GAAC,CAAC,CAAF,GAAI,CAApC,EAAsCH,CAAC,CAACkC,IAAF,CAAOhC,CAAP,IAAU,CAAhD;AAAkD;;AAAA,SAAS4D,CAAT,CAAWhE,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,MAAG,CAACS,CAAC,CAACb,CAAC,CAACqC,KAAH,CAAL,EAAe,OAAO7B,CAAC,CAACJ,CAAD,EAAG,wDAAH,CAAD,EAA8D,IAArE;;AAA0E,MAAGF,CAAC,CAAC+D,QAAL,EAAc;AAAC,QAAGjE,CAAC,CAACqC,KAAL,EAAW,IAAGnC,CAAC,CAAC+D,QAAF,CAAW5B,KAAd,EAAoB;AAAC,UAAGrC,CAAC,CAACqC,KAAF,KAAUnC,CAAC,CAAC+D,QAAF,CAAW5B,KAAxB,EAA8B,OAAO7B,CAAC,CAACJ,CAAD,EAAG,yDAAH,CAAD,EAA+D,IAAtE;AAA2E,KAA9H,MAAmIF,CAAC,CAAC+D,QAAF,CAAW5B,KAAX,GAAiBrC,CAAC,CAACqC,KAAnB;AAAyB,GAAtL,MAA2LnC,CAAC,CAAC+D,QAAF,GAAW;AAAC5B,IAAAA,KAAK,EAACrC,CAAC,CAACqC,KAAT;AAAeH,IAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAtB;AAA8BC,IAAAA,MAAM,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAArC;AAA6CC,IAAAA,IAAI,EAAC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL;AAAlD,GAAX;;AAAsE,UAAOpC,CAAC,CAACkD,IAAT;AAAe,SAAI,MAAJ;AAAW,aAAOY,CAAC,CAAC9D,CAAD,EAAGE,CAAC,CAAC+D,QAAL,EAAc,CAAd,CAAD,EAAkB/D,CAAzB;;AAA2B,SAAI,MAAJ;AAAW,aAAO4D,CAAC,CAAC9D,CAAD,EAAGE,CAAC,CAAC+D,QAAL,EAAc,CAAd,CAAD,EAAkB/D,CAAzB;;AAA2B,SAAK,IAAL;AAAU,SAAK,KAAK,CAAV;AAAY,SAAI,SAAJ;AAAc,aAAO4D,CAAC,CAAC9D,CAAD,EAAGE,CAAC,CAAC+D,QAAL,EAAc,CAAd,CAAD,EAAkB/D,CAAzB;;AAA2B;AAAQ,aAAOM,CAAC,CAACJ,CAAD,EAAI,kDAAiDJ,CAAC,CAACkD,IAAK,IAA5D,CAAD,EAAkE,IAAzE;AAAlK;AAAiP;;AAAA,SAASgB,CAAT,CAAWlE,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,MAAG,CAACJ,CAAJ,EAAM,OAAO,IAAP;AAAY,QAAMK,CAAC,GAAC,CAACH,CAAC,CAACiE,cAAH,IAAmB,CAAC,CAACjE,CAAC,CAACiE,cAAF,CAAiB3B,IAA9C;AAAA,QAAmDjC,CAAC,GAAC,CAACL,CAAC,CAACiE,cAAH,IAAmB,CAAC,CAACjE,CAAC,CAACiE,cAAF,CAAiBZ,KAA3F;AAAA,QAAiGjD,CAAC,GAAC,CAACJ,CAAC,CAACiE,cAAH,IAAmB,CAAC,CAACjE,CAAC,CAACiE,cAAF,CAAiBF,QAAzI;AAAA,QAAkJvD,CAAC,GAAC,CAAC,CAACR,CAAC,CAACiE,cAAJ,IAAoB,CAAC,CAACjE,CAAC,CAACiE,cAAF,CAAiBP,OAA3L;AAAA,QAAmMhD,CAAC,GAACZ,CAAC,CAACoE,MAAF,CAAU,CAACpE,CAAD,EAAGY,CAAH,KAAO;AAAC,QAAG,CAACZ,CAAJ,EAAM,OAAOA,CAAP;AAAS,QAAGY,CAAC,CAACyD,eAAL,EAAqB,OAAO7D,CAAC,CAACJ,CAAD,EAAG,sEAAH,CAAD,EAA4E,IAAnF;;AAAwF,YAAOQ,CAAC,CAACwB,IAAT;AAAe,WAAI,MAAJ;AAAW,eAAO/B,CAAC,GAAC0C,CAAC,CAACnC,CAAD,EAAGZ,CAAH,EAAKE,CAAL,EAAOE,CAAP,CAAF,GAAYJ,CAApB;;AAAsB,WAAI,OAAJ;AAAY,eAAOO,CAAC,GAACE,CAAC,CAACG,CAAD,EAAGZ,CAAH,EAAKI,CAAL,CAAF,GAAUJ,CAAlB;;AAAoB,WAAI,SAAJ;AAAc,eAAOU,CAAC,GAACiD,CAAC,CAAC/C,CAAD,EAAGZ,CAAH,EAAKI,CAAL,CAAF,GAAU,IAAlB;;AAAuB,WAAI,UAAJ;AAAe,eAAOE,CAAC,GAAC0D,CAAC,CAACpD,CAAD,EAAGZ,CAAH,EAAKI,CAAL,CAAF,GAAUJ,CAAlB;;AAAoB;AAAQ,eAAO,IAAP;AAAhK;AAA6K,GAA3T,EAA6T;AAACwC,IAAAA,IAAI,EAAC,IAAN;AAAWe,IAAAA,KAAK,EAAC,IAAjB;AAAsBK,IAAAA,OAAO,EAAC,IAA9B;AAAmCK,IAAAA,QAAQ,EAAC;AAA5C,GAA7T,CAArM;AAAqjB,SAAM,EAAEjE,CAAC,CAACuC,MAAF,GAAS,CAAT,IAAY3B,CAAd,KAAkBA,CAAC,CAAC4B,IAApB,IAA0B5B,CAAC,CAAC2C,KAA5B,IAAmC3C,CAAC,CAACgD,OAArC,IAA8ChD,CAAC,CAACqD,QAAhD,GAAyDrD,CAAC,IAAEA,CAAC,CAAC4B,IAAL,IAAW,CAACW,CAAC,CAACvC,CAAC,CAAC4B,IAAH,EAAQtC,CAAR,EAAUE,CAAV,CAAb,GAA0B,IAA1B,GAA+BQ,CAAxF,GAA0F,IAAhG;AAAqG;;AAAA,SAAS0D,CAAT,CAAWtE,CAAX,EAAa;AAAC,SAAOA,CAAC,IAAE,QAAMA,CAAC,CAACwC,IAAlB;AAAuB;;AAAA,SAAS+B,CAAT,CAAWvE,CAAX,EAAaE,CAAb,EAAe;AAAC,MAAG,CAACF,CAAJ,EAAM,OAAM;AAACwE,IAAAA,OAAO,EAAC,CAAC;AAAV,GAAN;AAAmB,MAAGzD,CAAC,CAAC0D,oBAAL,EAA0B,OAAM;AAACD,IAAAA,OAAO,EAAC,CAAC;AAAV,GAAN;AAAmB,QAAMpE,CAAC,GAAC8D,CAAC,CAAClE,CAAC,CAAC0E,eAAH,EAAmBxE,CAAnB,CAAT;AAA+B,SAAOE,CAAC,GAAC;AAACoE,IAAAA,OAAO,EAAC,CAAC,CAAV;AAAYE,IAAAA,eAAe,EAACtE,CAA5B;AAA8BuE,IAAAA,kBAAkB,EAACC,CAAC,CAACxE,CAAD,EAAGF,CAAH,CAAlD;AAAwD2E,IAAAA,4BAA4B,EAACP,CAAC,CAAClE,CAAD;AAAtF,GAAD,GAA4F;AAACoE,IAAAA,OAAO,EAAC,CAAC;AAAV,GAApG;AAAiH;;AAAA,SAASM,CAAT,CAAW9E,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,MAAG,CAACF,CAAD,IAAI,CAACF,CAAC,CAACwE,OAAV,EAAkB,OAAM,CAAC,CAAP;AAAS,QAAMnE,CAAC,GAACL,CAAC,CAAC0E,eAAV;AAAA,QAA0BnE,CAAC,GAAC2D,CAAC,CAAChE,CAAC,CAACwE,eAAH,EAAmBtE,CAAnB,CAA7B;AAAmD,SAAM,CAAC,CAACG,CAAF,IAAM,CAAC,EAAEwE,CAAC,CAAC1E,CAAC,CAACmC,IAAH,EAAQjC,CAAC,CAACiC,IAAV,EAAe,MAAf,CAAD,IAAyBuC,CAAC,CAAC1E,CAAC,CAACkD,KAAH,EAAShD,CAAC,CAACgD,KAAX,EAAiB,OAAjB,CAA1B,IAAqDwB,CAAC,CAAC1E,CAAC,CAAC4D,QAAH,EAAY1D,CAAC,CAAC0D,QAAd,EAAuB,UAAvB,CAAtD,IAA0Fc,CAAC,CAAC1E,CAAC,CAACuD,OAAH,EAAWrD,CAAC,CAACqD,OAAb,EAAqB,SAArB,CAA7F,CAAD,KAAiI5D,CAAC,CAAC0E,eAAF,GAAkBnE,CAAlB,EAAoBP,CAAC,CAAC2E,kBAAF,GAAqBC,CAAC,CAACrE,CAAD,EAAGH,CAAH,CAA1C,EAAgDJ,CAAC,CAAC6E,4BAAF,GAA+BP,CAAC,CAAC/D,CAAD,CAAhF,EAAoF,CAAC,CAAtN,CAAZ;AAAsO;;AAAA,SAASwE,CAAT,CAAW/E,CAAX,EAAaE,CAAb,EAAeE,CAAf,EAAiB;AAAC,MAAG,CAAC,CAACJ,CAAF,IAAK,CAAC,CAACE,CAAV,EAAY,OAAM,CAAC,CAAP;AAAS,MAAGF,CAAC,IAAEA,CAAC,CAACqC,KAAF,KAAUnC,CAAC,CAACmC,KAAlB,EAAwB,OAAM,CAAC,CAAP;;AAAS,MAAGrC,CAAC,IAAE,eAAaI,CAAnB,EAAqB;AAAC,UAAMA,CAAC,GAACJ,CAAR;AAAA,UAAUK,CAAC,GAACH,CAAZ;;AAAc,SAAI,IAAIF,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgBA,CAAC,EAAjB,EAAoB,IAAGI,CAAC,CAACgC,IAAF,CAAOpC,CAAP,MAAYK,CAAC,CAAC+B,IAAF,CAAOpC,CAAP,CAAZ,IAAuBI,CAAC,CAAC8B,MAAF,CAASlC,CAAT,MAAcK,CAAC,CAAC6B,MAAF,CAASlC,CAAT,CAArC,IAAkDI,CAAC,CAAC+B,MAAF,CAASnC,CAAT,MAAcK,CAAC,CAAC8B,MAAF,CAASnC,CAAT,CAAnE,EAA+E,OAAM,CAAC,CAAP;AAAS;;AAAA,SAAM,CAAC,CAAP;AAAS;;AAAA,SAAS4E,CAAT,CAAW5E,CAAX,EAAaO,CAAb,EAAe;AAAC,QAAMD,CAAC,GAAC;AAAC0E,IAAAA,aAAa,EAAC,CAAC,CAAhB;AAAkBC,IAAAA,aAAa,EAAC,IAAhC;AAAqCC,IAAAA,aAAa,EAAC,IAAnD;AAAwDC,IAAAA,YAAY,EAAC,IAArE;AAA0EC,IAAAA,YAAY,EAAC,IAAvF;AAA4FC,IAAAA,WAAW,EAAC,IAAxG;AAA6GC,IAAAA,cAAc,EAAC,CAAC,CAA7H;AAA+HC,IAAAA,aAAa,EAAC,IAA7I;AAAkJC,IAAAA,aAAa,EAAC,IAAhK;AAAqKC,IAAAA,gBAAgB,EAAC,CAAC,CAAvL;AAAyLC,IAAAA,eAAe,EAAC,IAAzM;AAA8MC,IAAAA,kBAAkB,EAAC,IAAjO;AAAsOC,IAAAA,cAAc,EAAC,IAArP;AAA0PC,IAAAA,sBAAsB,EAAC;AAAjR,GAAR;AAAA,QAA+RnF,CAAC,GAAC4D,CAAC,CAACtE,CAAD,CAAlS;AAAsS,SAAOA,CAAC,IAAEA,CAAC,CAACwC,IAAL,IAAWlC,CAAC,CAAC0E,aAAF,GAAgB,CAAC,CAAjB,EAAmB1E,CAAC,CAAC2E,aAAF,GAAgBjF,CAAC,CAACwC,IAAF,CAAOX,OAA1C,EAAkDvB,CAAC,CAAC4E,aAAF,GAAgBlF,CAAC,CAACwC,IAAF,CAAOV,OAAzE,EAAiFxB,CAAC,CAAC6E,YAAF,GAAenF,CAAC,CAACwC,IAAF,CAAON,MAAvG,EAA8G5B,CAAC,CAAC8E,YAAF,GAAepF,CAAC,CAACwC,IAAF,CAAOL,MAA/I,IAAuJnC,CAAC,IAAEU,CAAH,KAAOJ,CAAC,CAAC+E,WAAF,GAAc9E,CAAC,CAACuF,cAAF,CAAiBC,KAAtC,CAAvJ,EAAoM/F,CAAC,IAAEU,CAAH,KAAOJ,CAAC,CAACsF,cAAF,GAAiBrF,CAAC,CAACuF,cAAF,CAAiBE,MAAlC,EAAyC1F,CAAC,CAACuF,sBAAF,GAAyBzF,CAAC,EAAnE,EAAsEC,CAAC,CAAC4F,CAAD,CAAvE,EAA2ExE,CAAC,CAAClB,CAAC,CAACuF,cAAF,CAAiB7B,QAAjB,CAA0B,CAA1B,CAAD,EAA8B1D,CAAC,CAACuF,cAAF,CAAiB7B,QAAjB,CAA0B,CAA1B,CAA9B,EAA2D1D,CAAC,CAACuF,cAAF,CAAiB7B,QAAjB,CAA0B,CAA1B,CAA3D,EAAwFgC,CAAxF,CAA5E,EAAuK/F,CAAC,CAACI,CAAC,CAACuF,sBAAH,EAA0BI,CAA1B,CAA/K,CAApM,EAAiZjG,CAAC,IAAEA,CAAC,CAACuD,KAAL,KAAajD,CAAC,CAACgF,cAAF,GAAiB,CAAC,CAAlB,EAAoBhF,CAAC,CAACiF,aAAF,GAAgBvF,CAAC,CAACuD,KAAF,CAAQC,MAA5C,EAAmDlD,CAAC,CAACkF,aAAF,GAAgBxF,CAAC,CAACuD,KAAF,CAAQE,MAAxF,CAAjZ,EAAifzD,CAAC,IAAEA,CAAC,CAAC4D,OAAL,KAAetD,CAAC,CAACmF,gBAAF,GAAmB,CAAC,CAApB,EAAsBnF,CAAC,CAACoF,eAAF,GAAkB1F,CAAC,CAAC4D,OAAF,CAAUJ,MAAlD,EAAyDlD,CAAC,CAACqF,kBAAF,GAAqB3F,CAAC,CAAC4D,OAAF,CAAUC,aAAvG,CAAjf,EAAumBvD,CAA9mB;AAAgnB;;AAAA,IAAI4F,CAAJ;AAAM,CAAC,UAAShG,CAAT,EAAW;AAAC,QAAME,CAAC,GAACa,CAAC,EAAT;AAAA,QAAYZ,CAAC,GAACM,CAAC,EAAf;;AAAkB,WAASJ,CAAT,CAAWL,CAAX,EAAaK,CAAb,EAAeD,CAAf,EAAiB;AAAC,QAAG,CAACJ,CAAC,CAAC8E,aAAN,EAAoB,OAAO1E,CAAP;AAASM,IAAAA,CAAC,CAACR,CAAD,EAAGE,CAAH,CAAD;AAAO,UAAMI,CAAC,GAACR,CAAC,CAAC2F,sBAAV;AAAiC/E,IAAAA,CAAC,CAACmF,CAAD,EAAGvF,CAAC,CAAC,CAAD,CAAJ,EAAQA,CAAC,CAAC,CAAD,CAAT,EAAaA,CAAC,CAAC,CAAD,CAAd,EAAkB,CAAlB,EAAoBA,CAAC,CAAC,CAAD,CAArB,EAAyBA,CAAC,CAAC,CAAD,CAA1B,EAA8BA,CAAC,CAAC,CAAD,CAA/B,EAAmC,CAAnC,EAAqCA,CAAC,CAAC,CAAD,CAAtC,EAA0CA,CAAC,CAAC,CAAD,CAA3C,EAA+CA,CAAC,CAAC,CAAD,CAAhD,EAAoD,CAApD,EAAsD,CAAtD,EAAwD,CAAxD,EAA0D,CAA1D,EAA4D,CAA5D,CAAD,EAAgEM,CAAC,CAACZ,CAAD,EAAGA,CAAH,EAAK6F,CAAL,CAAjE;;AAAyE,SAAI,IAAI7F,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgB,EAAEA,CAAlB,EAAoB;AAAC,YAAME,CAAC,GAACJ,CAAC,CAACiF,YAAF,CAAe/E,CAAf,IAAkBG,CAAC,CAAC,CAAD,CAAD,GAAKL,CAAC,CAACkF,YAAF,CAAehF,CAAf,CAA/B;AAAiDC,MAAAA,CAAC,CAACD,CAAD,CAAD,GAAKJ,CAAC,CAACM,CAAD,EAAGJ,CAAC,CAAC+E,aAAF,CAAgB7E,CAAhB,CAAH,EAAsBF,CAAC,CAACgF,aAAF,CAAgB9E,CAAhB,CAAtB,CAAN;AAAgD;;AAAA,WAAOH,CAAC,CAACG,CAAD,EAAGA,CAAH,EAAKC,CAAL,CAAD,EAASF,CAAC,CAACC,CAAD,EAAGA,CAAH,EAAKF,CAAC,CAAC0F,cAAP,CAAV,EAAiCxF,CAAxC;AAA0C;;AAAA,WAASE,CAAT,CAAWJ,CAAX,EAAaE,CAAb,EAAeC,CAAf,EAAiB;AAAC,QAAG,CAACD,CAAC,CAAC4E,aAAN,EAAoB,OAAO9D,CAAC,CAAChB,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAR;;AAAkB,SAAI,IAAIK,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgB,EAAEA,CAAlB,EAAoB;AAAC,YAAMD,CAAC,GAACF,CAAC,CAAC+E,YAAF,CAAe5E,CAAf,IAAkBF,CAAC,CAAC,CAAD,CAAD,GAAKD,CAAC,CAACgF,YAAF,CAAe7E,CAAf,CAA/B;AAAiDL,MAAAA,CAAC,CAACK,CAAD,CAAD,GAAKP,CAAC,CAACM,CAAD,EAAGF,CAAC,CAAC6E,aAAF,CAAgB1E,CAAhB,CAAH,EAAsBH,CAAC,CAAC8E,aAAF,CAAgB3E,CAAhB,CAAtB,CAAN;AAAgD;;AAAA,WAAOL,CAAP;AAAS;;AAAAA,EAAAA,CAAC,CAACiG,sBAAF,GAAyB5F,CAAzB,EAA2BL,CAAC,CAACkG,2BAAF,GAA8B9F,CAAzD;AAA2D,CAAhlB,CAAilB4F,CAAC,KAAGA,CAAC,GAAC,EAAL,CAAllB,CAAD;AAA6lB,MAAMD,CAAC,GAAChF,CAAC,EAAT;AAAA,MAAYoF,CAAC,GAACH,CAAC,CAACC,sBAAhB;AAAA,MAAuCG,CAAC,GAACJ,CAAC,CAACE,2BAA3C;AAAuE,SAAOlC,CAAC,IAAIqC,sBAAZ,EAAmCF,CAAC,IAAIF,sBAAxC,EAA+DG,CAAC,IAAIF,2BAApE,EAAgGxB,CAAC,IAAI4B,iBAArG,EAAuHjC,CAAC,IAAIkC,0BAA5H,EAAuJ3B,CAAC,IAAI4B,4BAA5J","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{clamp as e}from\"../../../../core/mathUtils.js\";import{f as o}from\"../../../../chunks/mat3.js\";import{c as t}from\"../../../../chunks/mat3f64.js\";import{i,r as n,b as r,j as s,d as l,h as a,m as u,s as f,t as c}from\"../../../../chunks/mat4.js\";import{c as p}from\"../../../../chunks/mat4f64.js\";import{s as v}from\"../../../../chunks/vec3.js\";import{c as d}from\"../../../../chunks/vec3f64.js\";import{meterIn as z}from\"../../../../renderers/support/lengthUtils.js\";import m from\"../../support/debugFlags.js\";function y(e){return null!=e}function S(e){return\"number\"==typeof e}function h(e){return\"string\"==typeof e}function x(e){return null==e||h(e)}function b(e,o){e&&e.push(o)}function C(e,o,t,i=p()){const l=e||0,a=o||0,u=t||0;return 0!==l&&n(i,i,-l/180*Math.PI),0!==a&&r(i,i,a/180*Math.PI),0!==u&&s(i,i,u/180*Math.PI),i}function M(e,o,t,i,n){const r=e.minSize,s=e.maxSize;if(e.expression)return b(n,\"Could not convert size info: expression not supported\"),!1;if(e.useSymbolValue){const e=i.symbolSize[t];return o.minSize[t]=e,o.maxSize[t]=e,o.offset[t]=o.minSize[t],o.factor[t]=0,o.type[t]=1,!0}if(y(e.field))return y(e.stops)?2===e.stops.length&&S(e.stops[0].size)&&S(e.stops[1].size)?(g(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,o,t),o.type[t]=1,!0):(b(n,\"Could not convert size info: stops only supported with 2 elements\"),!1):S(r)&&S(s)&&y(e.minDataValue)&&y(e.maxDataValue)?(g(r,s,e.minDataValue,e.maxDataValue,o,t),o.type[t]=1,!0):null!=z[e.valueUnit]?(o.minSize[t]=-1/0,o.maxSize[t]=1/0,o.offset[t]=0,o.factor[t]=1/z[e.valueUnit],o.type[t]=1,!0):\"unknown\"===e.valueUnit?(b(n,\"Could not convert size info: proportional size not supported\"),!1):(b(n,\"Could not convert size info: scale-dependent size not supported\"),!1);if(!y(e.field)){if(e.stops&&e.stops[0]&&S(e.stops[0].size))return o.minSize[t]=e.stops[0].size,o.maxSize[t]=e.stops[0].size,o.offset[t]=o.minSize[t],o.factor[t]=0,o.type[t]=1,!0;if(S(r))return o.minSize[t]=r,o.maxSize[t]=r,o.offset[t]=r,o.factor[t]=0,o.type[t]=1,!0}return b(n,\"Could not convert size info: unsupported variant of sizeInfo\"),!1}function g(e,o,t,i,n,r){const s=Math.abs(i-t)>0?(o-e)/(i-t):0;n.minSize[r]=s>0?e:o,n.maxSize[r]=s>0?o:e,n.offset[r]=e-t*s,n.factor[r]=s}function V(e,o,t,i){if(e.normalizationField||e.valueRepresentation)return b(i,\"Could not convert size info: unsupported property\"),null;if(!x(e.field))return b(i,\"Could not convert size info: field is not a string\"),null;if(o.size){if(e.field)if(o.size.field){if(e.field!==o.size.field)return b(i,\"Could not convert size info: multiple fields in use\"),null}else o.size.field=e.field}else o.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};let n;switch(e.axis){case\"width\":return n=M(e,o.size,0,t,i),n?o:null;case\"height\":return n=M(e,o.size,2,t,i),n?o:null;case\"depth\":return n=M(e,o.size,1,t,i),n?o:null;case\"width-and-depth\":return n=M(e,o.size,0,t,i),n&&M(e,o.size,1,t,i),n?o:null;case null:case void 0:case\"all\":return n=M(e,o.size,0,t,i),n=n&&M(e,o.size,1,t,i),n=n&&M(e,o.size,2,t,i),n?o:null;default:return b(i,`Could not convert size info: unknown axis \"${e.axis}\"\"`),null}}function T(e,o,t){for(let n=0;n<3;++n){let t=o.unitInMeters;1===e.type[n]&&(t*=o.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/t,e.maxSize[n]=e.maxSize[n]/t,e.offset[n]=e.offset[n]/t,e.factor[n]=e.factor[n]/t}let i;if(0!==e.type[0])i=0;else if(0!==e.type[1])i=1;else{if(0===e.type[2])return b(t,\"No size axis contains a valid size or scale\"),!1;i=2}for(let n=0;n<3;++n)0===e.type[n]&&(e.minSize[n]=e.minSize[i],e.maxSize[n]=e.maxSize[i],e.offset[n]=e.offset[i],e.factor[n]=e.factor[i],e.type[n]=e.type[i]);return!0}function O(e,o,t){e[4*o+0]=t.r/255,e[4*o+1]=t.g/255,e[4*o+2]=t.b/255,e[4*o+3]=t.a}function j(e,o,t){if(e.normalizationField)return b(t,\"Could not convert color info: unsupported property\"),null;if(h(e.field)){if(!e.stops)return b(t,\"Could not convert color info: missing stops or colors\"),null;{if(e.stops.length>8)return b(t,\"Could not convert color info: too many color stops\"),null;o.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const t=i[Math.min(e,i.length-1)];o.color.values[e]=t.value,O(o.color.colors,e,t.color)}}}else{if(!(e.stops&&e.stops.length>=0))return b(t,\"Could not convert color info: no field and no colors/stops\"),null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].color;o.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)o.color.values[e]=1/0,O(o.color.colors,e,t)}}return o}function E(e,o,t){if(e.normalizationField)return b(t,\"Could not convert opacity info: unsupported property\"),null;if(h(e.field)){if(!e.stops)return b(t,\"Could not convert opacity info: missing stops or opacities\"),null;{if(e.stops.length>8)return b(t,\"Could not convert opacity info: too many opacity stops\"),null;o.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const t=i[Math.min(e,i.length-1)];o.opacity.values[e]=t.value,o.opacity.opacityValues[e]=t.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return b(t,\"Could not convert opacity info: no field and no opacities/stops\"),null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].opacity;o.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)o.opacity.values[e]=1/0,o.opacity.opacityValues[e]=t}}return o}function k(e,o,t){const i=2===t&&\"arithmetic\"===e.rotationType;o.offset[t]=i?90:0,o.factor[t]=i?-1:1,o.type[t]=1}function w(e,o,t){if(!h(e.field))return b(t,\"Could not convert rotation info: field is not a string\"),null;if(o.rotation){if(e.field)if(o.rotation.field){if(e.field!==o.rotation.field)return b(t,\"Could not convert rotation info: multiple fields in use\"),null}else o.rotation.field=e.field}else o.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case\"tilt\":return k(e,o.rotation,0),o;case\"roll\":return k(e,o.rotation,1),o;case null:case void 0:case\"heading\":return k(e,o.rotation,2),o;default:return b(t,`Could not convert rotation info: unknown axis \"${e.axis}\"\"`),null}}function F(e,o,t){if(!e)return null;const i=!o.supportedTypes||!!o.supportedTypes.size,n=!o.supportedTypes||!!o.supportedTypes.color,r=!o.supportedTypes||!!o.supportedTypes.rotation,s=!!o.supportedTypes&&!!o.supportedTypes.opacity,l=e.reduce(((e,l)=>{if(!e)return e;if(l.valueExpression)return b(t,\"Could not convert visual variables: arcade expressions not supported\"),null;switch(l.type){case\"size\":return i?V(l,e,o,t):e;case\"color\":return n?j(l,e,t):e;case\"opacity\":return s?E(l,e,t):null;case\"rotation\":return r?w(l,e,t):e;default:return null}}),{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!T(l.size,o,t)?null:l:null}function A(e){return e&&null!=e.size}function D(e,o){if(!e)return{enabled:!1};if(m.DISABLE_FAST_UPDATES)return{enabled:!1};const t=F(e.visualVariables,o);return t?{enabled:!0,visualVariables:t,materialParameters:U(t,o),requiresShaderTransformation:A(t)}:{enabled:!1}}function I(e,o,t){if(!o||!e.enabled)return!1;const i=e.visualVariables,n=F(o.visualVariables,t);return!!n&&(!!(P(i.size,n.size,\"size\")&&P(i.color,n.color,\"color\")&&P(i.rotation,n.rotation,\"rotation\")&&P(i.opacity,n.opacity,\"opacity\"))&&(e.visualVariables=n,e.materialParameters=U(n,t),e.requiresShaderTransformation=A(n),!0))}function P(e,o,t){if(!!e!=!!o)return!1;if(e&&e.field!==o.field)return!1;if(e&&\"rotation\"===t){const t=e,i=o;for(let e=0;e<3;e++)if(t.type[e]!==i.type[e]||t.offset[e]!==i.offset[e]||t.factor[e]!==i.factor[e])return!1}return!0}function U(e,n){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},s=A(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&s&&(r.vvSizeValue=n.transformation.scale),e&&s&&(r.vvSymbolAnchor=n.transformation.anchor,r.vvSymbolRotationMatrix=t(),i(q),C(n.transformation.rotation[2],n.transformation.rotation[0],n.transformation.rotation[1],q),o(r.vvSymbolRotationMatrix,q)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}var R;!function(o){const t=p(),i=d();function n(o,n,r){if(!o.vvSizeEnabled)return r;l(t,r);const s=o.vvSymbolRotationMatrix;a(q,s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1),u(t,t,q);for(let t=0;t<3;++t){const r=o.vvSizeOffset[t]+n[0]*o.vvSizeFactor[t];i[t]=e(r,o.vvSizeMinSize[t],o.vvSizeMaxSize[t])}return f(t,t,i),c(t,t,o.vvSymbolAnchor),t}function r(o,t,i){if(!t.vvSizeEnabled)return v(o,1,1,1);for(let n=0;n<3;++n){const r=t.vvSizeOffset[n]+i[0]*t.vvSizeFactor[n];o[n]=e(r,t.vvSizeMinSize[n],t.vvSizeMaxSize[n])}return o}o.evaluateModelTransform=n,o.evaluateModelTransformScale=r}(R||(R={}));const q=p(),$=R.evaluateModelTransform,_=R.evaluateModelTransformScale;export{F as convertVisualVariables,$ as evaluateModelTransform,_ as evaluateModelTransformScale,U as getMaterialParams,D as initFastSymbolUpdatesState,I as updateFastSymbolUpdatesState};\n"]},"metadata":{},"sourceType":"module"}