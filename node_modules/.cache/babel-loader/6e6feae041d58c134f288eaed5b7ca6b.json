{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../Graphic.js\";\nimport t from \"../../core/Collection.js\";\nimport a from \"../../core/Error.js\";\nimport { clone as r } from \"../../core/lang.js\";\nimport { isSome as i } from \"../../core/maybe.js\";\nimport { dataComponents as s } from \"../../core/urlUtils.js\";\nimport { normalizeCentralMeridian as d } from \"../../geometry/support/normalizeUtils.js\";\n\nfunction n(e) {\n  return e && null != e.applyEdits;\n}\n\nasync function l(e, t, a, i = {}) {\n  let s, d;\n  const n = {\n    edits: a,\n    result: new Promise((e, t) => {\n      s = e, d = t;\n    })\n  };\n  e.emit(\"apply-edits\", n);\n\n  try {\n    var l;\n\n    const {\n      results: d,\n      edits: n\n    } = await o(e, t, a, i),\n          u = e => e.filter(e => !e.error).map(r),\n          p = {\n      edits: n,\n      addedFeatures: u(d.addFeatureResults),\n      updatedFeatures: u(d.updateFeatureResults),\n      deletedFeatures: u(d.deleteFeatureResults),\n      addedAttachments: u(d.addAttachmentResults),\n      updatedAttachments: u(d.updateAttachmentResults),\n      deletedAttachments: u(d.deleteAttachmentResults)\n    };\n\n    return null != (l = d.editedFeatureResults) && l.length && (p.editedFeatures = d.editedFeatureResults), (p.addedFeatures.length || p.updatedFeatures.length || p.deletedFeatures.length || p.addedAttachments.length || p.updatedAttachments.length || p.deletedAttachments.length) && e.emit(\"edits\", p), s(p), d;\n  } catch (u) {\n    throw d(u), u;\n  }\n}\n\nasync function o(e, t, r, i) {\n  if (await e.load(), !n(t)) return Promise.reject(new a(`${e.type}-layer:no-editing-support`, \"Layer source does not support applyEdits capability\", {\n    layer: e\n  }));\n  if (!e.editingEnabled) throw new a(`${e.type}-layer:editing-disabled`, \"Editing is disabled for layer\", {\n    layer: e\n  });\n  const {\n    edits: s,\n    options: d\n  } = await u(e, r, i);\n  return s.addFeatures.length || s.updateFeatures.length || s.deleteFeatures.length || s.addAttachments.length || s.updateAttachments.length || s.deleteAttachments.length ? {\n    edits: s,\n    results: await t.applyEdits(s, d)\n  } : {\n    edits: s,\n    results: {\n      addFeatureResults: [],\n      updateFeatureResults: [],\n      deleteFeatureResults: [],\n      addAttachmentResults: [],\n      updateAttachmentResults: [],\n      deleteAttachmentResults: []\n    }\n  };\n}\n\nasync function u(e, r, i) {\n  const s = r && (r.addFeatures || r.updateFeatures || r.deleteFeatures),\n        d = r && (r.addAttachments || r.updateAttachments || r.deleteAttachments);\n  if (!r || !s && !d) throw new a(`${e.type}-layer:missing-parameters`, \"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required\");\n  if (!e.capabilities.data.isVersioned && i && i.gdbVersion) throw new a(`${e.type}-layer:invalid-parameter`, \"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'\");\n  if (!e.capabilities.editing.supportsRollbackOnFailure && i && i.rollbackOnFailureEnabled) throw new a(`${e.type}-layer:invalid-parameter`, \"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'\");\n  if (!e.capabilities.editing.supportsGlobalId && i && i.globalIdUsed) throw new a(`${e.type}-layer:invalid-parameter`, \"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'\");\n  if (!e.capabilities.editing.supportsGlobalId && d) throw new a(`${e.type}-layer:invalid-parameter`, \"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'\");\n  if ((!i || !i.globalIdUsed) && d) throw new a(`${e.type}-layer:invalid-parameter`, \"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true\");\n  const n = { ...i\n  };\n  if (null != n.rollbackOnFailureEnabled || e.capabilities.editing.supportsRollbackOnFailure || (n.rollbackOnFailureEnabled = !0), !1 === n.rollbackOnFailureEnabled && \"original-and-current-features\" === n.returnServiceEditsOption) throw new a(`${e.type}-layer:invalid-parameter`, \"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true.\");\n  if (!e.capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference && n.returnServiceEditsInSourceSR) throw new a(`${e.type}-layer:invalid-parameter`, \"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'\");\n  if (n.returnServiceEditsInSourceSR && \"original-and-current-features\" !== n.returnServiceEditsOption) throw new a(`${e.type}-layer:invalid-parameter`, \"'returnServiceEditsOption' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'\");\n  const l = { ...r\n  };\n  if (l.addFeatures = r && t.isCollection(r.addFeatures) ? r.addFeatures.toArray() : l.addFeatures || [], l.updateFeatures = r && t.isCollection(r.updateFeatures) ? r.updateFeatures.toArray() : l.updateFeatures || [], l.deleteFeatures = r && t.isCollection(r.deleteFeatures) ? r.deleteFeatures.toArray() : l.deleteFeatures || [], l.addFeatures.length && !e.capabilities.operations.supportsAdd) throw new a(`${e.type}-layer:unsupported-operation`, \"Layer does not support adding features.\");\n  if (l.updateFeatures.length && !e.capabilities.operations.supportsUpdate) throw new a(`${e.type}-layer:unsupported-operation`, \"Layer does not support updating features.\");\n  if (l.deleteFeatures.length && !e.capabilities.operations.supportsDelete) throw new a(`${e.type}-layer:unsupported-operation`, \"Layer does not support deleting features.\");\n  l.addAttachments = l.addAttachments || [], l.updateAttachments = l.updateAttachments || [], l.deleteAttachments = l.deleteAttachments || [], l.addFeatures = l.addFeatures.map(g), l.updateFeatures = l.updateFeatures.map(g);\n  const o = i && i.globalIdUsed;\n  l.addFeatures.forEach(t => c(t, e, o)), l.updateFeatures.forEach(t => m(t, e, o)), l.deleteFeatures.forEach(t => h(t, e, o)), l.addAttachments.forEach(t => y(t, e)), l.updateAttachments.forEach(t => y(t, e));\n  return {\n    edits: await f(l),\n    options: n\n  };\n}\n\nfunction p(e, t, r) {\n  if (r) {\n    if (\"attributes\" in e && !e.attributes[t.globalIdField]) throw new a(`${t.type}-layer:invalid-parameter`, \"Feature should have 'globalId' when 'globalIdUsed' is true\");\n    if (!(\"attributes\" in e) && !e.globalId) throw new a(`${t.type}-layer:invalid-parameter`, \"'globalId' of the feature should be passed when 'globalIdUsed' is true\");\n  }\n\n  if (\"geometry\" in e && i(e.geometry)) {\n    if (e.geometry.hasZ && !1 === t.capabilities.data.supportsZ) throw new a(`${t.type}-layer:z-unsupported`, \"Layer does not support z values while feature has z values.\");\n    if (e.geometry.hasM && !1 === t.capabilities.data.supportsM) throw new a(`${t.type}-layer:m-unsupported`, \"Layer does not support m values while feature has m values.\");\n  }\n}\n\nfunction c(e, t, a) {\n  p(e, t, a);\n}\n\nfunction h(e, t, a) {\n  p(e, t, a);\n}\n\nfunction m(e, t, r) {\n  if (p(e, t, r), \"geometry\" in e && i(e.geometry) && !t.capabilities.editing.supportsGeometryUpdate) throw new a(`${t.type}-layer:unsupported-operation`, \"Layer does not support geometry updates.\");\n}\n\nfunction y(e, t) {\n  const {\n    feature: r,\n    attachment: i\n  } = e;\n  if (!r || \"attributes\" in r && !r.attributes[t.globalIdField]) throw new a(`${t.type}-layer:invalid-parameter`, \"Attachment should have reference to a feature with 'globalId'\");\n  if (!(\"attributes\" in r) && !r.globalId) throw new a(`${t.type}-layer:invalid-parameter`, \"Attachment should have reference to 'globalId' of the parent feature\");\n  if (!i.globalId) throw new a(`${t.type}-layer:invalid-parameter`, \"Attachment should have 'globalId'\");\n  if (!i.data && !i.uploadId) throw new a(`${t.type}-layer:invalid-parameter`, \"Attachment should have 'data' or 'uploadId'\");\n  if (!(i.data instanceof File && !!i.data.name) && !i.name) throw new a(`${t.type}-layer:invalid-parameter`, \"'name' is required when attachment is specified as Base64 encoded string using 'data'\");\n  if (!t.capabilities.editing.supportsUploadWithItemId && i.uploadId) throw new a(`${t.type}-layer:invalid-parameter`, \"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'\");\n\n  if (\"string\" == typeof i.data) {\n    const e = s(i.data);\n    if (e && !e.isBase64) throw new a(`${t.type}-layer:invalid-parameter`, \"Attachment 'data' should be a Blob, File or Base64 encoded string\");\n  }\n}\n\nasync function f(e) {\n  const t = e.addFeatures,\n        a = e.updateFeatures,\n        r = t.concat(a).map(e => e.geometry),\n        i = await d(r),\n        s = t.length,\n        n = a.length;\n  return i.slice(0, s).forEach((t, a) => e.addFeatures[a].geometry = t), i.slice(s, s + n).forEach((t, a) => e.updateFeatures[a].geometry = t), e;\n}\n\nfunction g(t) {\n  const a = new e();\n  return t.attributes || (t.attributes = {}), a.geometry = t.geometry, a.attributes = t.attributes, a;\n}\n\nexport { l as applyEdits };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/layers/graphics/editingSupport.js"],"names":["e","t","a","clone","r","isSome","i","dataComponents","s","normalizeCentralMeridian","d","n","applyEdits","l","edits","result","Promise","emit","results","o","u","filter","error","map","p","addedFeatures","addFeatureResults","updatedFeatures","updateFeatureResults","deletedFeatures","deleteFeatureResults","addedAttachments","addAttachmentResults","updatedAttachments","updateAttachmentResults","deletedAttachments","deleteAttachmentResults","editedFeatureResults","length","editedFeatures","load","reject","type","layer","editingEnabled","options","addFeatures","updateFeatures","deleteFeatures","addAttachments","updateAttachments","deleteAttachments","capabilities","data","isVersioned","gdbVersion","editing","supportsRollbackOnFailure","rollbackOnFailureEnabled","supportsGlobalId","globalIdUsed","returnServiceEditsOption","supportsReturnServiceEditsInSourceSpatialReference","returnServiceEditsInSourceSR","isCollection","toArray","operations","supportsAdd","supportsUpdate","supportsDelete","g","forEach","c","m","h","y","f","attributes","globalIdField","globalId","geometry","hasZ","supportsZ","hasM","supportsM","supportsGeometryUpdate","feature","attachment","uploadId","File","name","supportsUploadWithItemId","isBase64","concat","slice"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Collection.js\";import a from\"../../core/Error.js\";import{clone as r}from\"../../core/lang.js\";import{isSome as i}from\"../../core/maybe.js\";import{dataComponents as s}from\"../../core/urlUtils.js\";import{normalizeCentralMeridian as d}from\"../../geometry/support/normalizeUtils.js\";function n(e){return e&&null!=e.applyEdits}async function l(e,t,a,i={}){let s,d;const n={edits:a,result:new Promise(((e,t)=>{s=e,d=t}))};e.emit(\"apply-edits\",n);try{var l;const{results:d,edits:n}=await o(e,t,a,i),u=e=>e.filter((e=>!e.error)).map(r),p={edits:n,addedFeatures:u(d.addFeatureResults),updatedFeatures:u(d.updateFeatureResults),deletedFeatures:u(d.deleteFeatureResults),addedAttachments:u(d.addAttachmentResults),updatedAttachments:u(d.updateAttachmentResults),deletedAttachments:u(d.deleteAttachmentResults)};return null!=(l=d.editedFeatureResults)&&l.length&&(p.editedFeatures=d.editedFeatureResults),(p.addedFeatures.length||p.updatedFeatures.length||p.deletedFeatures.length||p.addedAttachments.length||p.updatedAttachments.length||p.deletedAttachments.length)&&e.emit(\"edits\",p),s(p),d}catch(u){throw d(u),u}}async function o(e,t,r,i){if(await e.load(),!n(t))return Promise.reject(new a(`${e.type}-layer:no-editing-support`,\"Layer source does not support applyEdits capability\",{layer:e}));if(!e.editingEnabled)throw new a(`${e.type}-layer:editing-disabled`,\"Editing is disabled for layer\",{layer:e});const{edits:s,options:d}=await u(e,r,i);return s.addFeatures.length||s.updateFeatures.length||s.deleteFeatures.length||s.addAttachments.length||s.updateAttachments.length||s.deleteAttachments.length?{edits:s,results:await t.applyEdits(s,d)}:{edits:s,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}async function u(e,r,i){const s=r&&(r.addFeatures||r.updateFeatures||r.deleteFeatures),d=r&&(r.addAttachments||r.updateAttachments||r.deleteAttachments);if(!r||!s&&!d)throw new a(`${e.type}-layer:missing-parameters`,\"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required\");if(!e.capabilities.data.isVersioned&&i&&i.gdbVersion)throw new a(`${e.type}-layer:invalid-parameter`,\"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'\");if(!e.capabilities.editing.supportsRollbackOnFailure&&i&&i.rollbackOnFailureEnabled)throw new a(`${e.type}-layer:invalid-parameter`,\"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'\");if(!e.capabilities.editing.supportsGlobalId&&i&&i.globalIdUsed)throw new a(`${e.type}-layer:invalid-parameter`,\"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'\");if(!e.capabilities.editing.supportsGlobalId&&d)throw new a(`${e.type}-layer:invalid-parameter`,\"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'\");if((!i||!i.globalIdUsed)&&d)throw new a(`${e.type}-layer:invalid-parameter`,\"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true\");const n={...i};if(null!=n.rollbackOnFailureEnabled||e.capabilities.editing.supportsRollbackOnFailure||(n.rollbackOnFailureEnabled=!0),!1===n.rollbackOnFailureEnabled&&\"original-and-current-features\"===n.returnServiceEditsOption)throw new a(`${e.type}-layer:invalid-parameter`,\"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true.\");if(!e.capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference&&n.returnServiceEditsInSourceSR)throw new a(`${e.type}-layer:invalid-parameter`,\"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'\");if(n.returnServiceEditsInSourceSR&&\"original-and-current-features\"!==n.returnServiceEditsOption)throw new a(`${e.type}-layer:invalid-parameter`,\"'returnServiceEditsOption' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'\");const l={...r};if(l.addFeatures=r&&t.isCollection(r.addFeatures)?r.addFeatures.toArray():l.addFeatures||[],l.updateFeatures=r&&t.isCollection(r.updateFeatures)?r.updateFeatures.toArray():l.updateFeatures||[],l.deleteFeatures=r&&t.isCollection(r.deleteFeatures)?r.deleteFeatures.toArray():l.deleteFeatures||[],l.addFeatures.length&&!e.capabilities.operations.supportsAdd)throw new a(`${e.type}-layer:unsupported-operation`,\"Layer does not support adding features.\");if(l.updateFeatures.length&&!e.capabilities.operations.supportsUpdate)throw new a(`${e.type}-layer:unsupported-operation`,\"Layer does not support updating features.\");if(l.deleteFeatures.length&&!e.capabilities.operations.supportsDelete)throw new a(`${e.type}-layer:unsupported-operation`,\"Layer does not support deleting features.\");l.addAttachments=l.addAttachments||[],l.updateAttachments=l.updateAttachments||[],l.deleteAttachments=l.deleteAttachments||[],l.addFeatures=l.addFeatures.map(g),l.updateFeatures=l.updateFeatures.map(g);const o=i&&i.globalIdUsed;l.addFeatures.forEach((t=>c(t,e,o))),l.updateFeatures.forEach((t=>m(t,e,o))),l.deleteFeatures.forEach((t=>h(t,e,o))),l.addAttachments.forEach((t=>y(t,e))),l.updateAttachments.forEach((t=>y(t,e)));return{edits:await f(l),options:n}}function p(e,t,r){if(r){if(\"attributes\"in e&&!e.attributes[t.globalIdField])throw new a(`${t.type}-layer:invalid-parameter`,\"Feature should have 'globalId' when 'globalIdUsed' is true\");if(!(\"attributes\"in e)&&!e.globalId)throw new a(`${t.type}-layer:invalid-parameter`,\"'globalId' of the feature should be passed when 'globalIdUsed' is true\")}if(\"geometry\"in e&&i(e.geometry)){if(e.geometry.hasZ&&!1===t.capabilities.data.supportsZ)throw new a(`${t.type}-layer:z-unsupported`,\"Layer does not support z values while feature has z values.\");if(e.geometry.hasM&&!1===t.capabilities.data.supportsM)throw new a(`${t.type}-layer:m-unsupported`,\"Layer does not support m values while feature has m values.\")}}function c(e,t,a){p(e,t,a)}function h(e,t,a){p(e,t,a)}function m(e,t,r){if(p(e,t,r),\"geometry\"in e&&i(e.geometry)&&!t.capabilities.editing.supportsGeometryUpdate)throw new a(`${t.type}-layer:unsupported-operation`,\"Layer does not support geometry updates.\")}function y(e,t){const{feature:r,attachment:i}=e;if(!r||\"attributes\"in r&&!r.attributes[t.globalIdField])throw new a(`${t.type}-layer:invalid-parameter`,\"Attachment should have reference to a feature with 'globalId'\");if(!(\"attributes\"in r)&&!r.globalId)throw new a(`${t.type}-layer:invalid-parameter`,\"Attachment should have reference to 'globalId' of the parent feature\");if(!i.globalId)throw new a(`${t.type}-layer:invalid-parameter`,\"Attachment should have 'globalId'\");if(!i.data&&!i.uploadId)throw new a(`${t.type}-layer:invalid-parameter`,\"Attachment should have 'data' or 'uploadId'\");if(!(i.data instanceof File&&!!i.data.name)&&!i.name)throw new a(`${t.type}-layer:invalid-parameter`,\"'name' is required when attachment is specified as Base64 encoded string using 'data'\");if(!t.capabilities.editing.supportsUploadWithItemId&&i.uploadId)throw new a(`${t.type}-layer:invalid-parameter`,\"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'\");if(\"string\"==typeof i.data){const e=s(i.data);if(e&&!e.isBase64)throw new a(`${t.type}-layer:invalid-parameter`,\"Attachment 'data' should be a Blob, File or Base64 encoded string\")}}async function f(e){const t=e.addFeatures,a=e.updateFeatures,r=t.concat(a).map((e=>e.geometry)),i=await d(r),s=t.length,n=a.length;return i.slice(0,s).forEach(((t,a)=>e.addFeatures[a].geometry=t)),i.slice(s,s+n).forEach(((t,a)=>e.updateFeatures[a].geometry=t)),e}function g(t){const a=new e;return t.attributes||(t.attributes={}),a.geometry=t.geometry,a.attributes=t.attributes,a}export{l as applyEdits};\n"]},"metadata":{},"sourceType":"module"}