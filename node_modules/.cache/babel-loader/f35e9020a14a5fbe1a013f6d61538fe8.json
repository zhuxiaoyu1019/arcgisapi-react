{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../Graphic.js\";\nimport t from \"../../../request.js\";\nimport r from \"../../Attachment.js\";\nimport i from \"../support/FeatureSet.js\";\nimport s from \"../support/IdSet.js\";\nimport { defaultMaxRecords as a, stableStringify as n, FeatureServiceDatabaseType as l, IdState as o, extractServiceUrl as u } from \"../support/shared.js\";\nimport { toWhereClause as d, isSingleField as h } from \"../support/sqlUtils.js\";\nimport { decodeStatType as c } from \"../support/stats.js\";\nimport { createMD5Hash as p, outputTypes as y } from \"../../../core/MD5.js\";\nimport { id as f } from \"../../../kernel.js\";\nimport { create as _, resolve as g, reject as m } from \"../../../core/promiseUtils.js\";\nimport { fromJSON as b } from \"../../../geometry/support/jsonUtils.js\";\nimport S from \"../../../layers/FeatureLayer.js\";\nimport { convertToFeatureSet as F } from \"../../../layers/graphics/featureConversionUtils.js\";\nimport { OptimizedFeatureSetParserContext as R } from \"../../../rest/query/operations/pbfOptimizedFeatureSet.js\";\nimport w from \"../../../rest/support/FeatureSet.js\";\nimport D from \"../../../rest/support/Query.js\";\nimport x from \"../../../rest/support/StatisticDefinition.js\";\nimport I from \"../../../tasks/QueryTask.js\";\nimport { executeQueryPBF as P } from \"../../../rest/query/operations/query.js\";\n\nclass q extends i {\n  constructor(e) {\n    super(e), this.declaredClass = \"esri.arcade.featureset.sources.FeatureLayerDynamic\", this._removeGeometry = !1, this._overrideFields = null, this.formulaCredential = null, this._pageJustIds = !1, this._requestStandardised = !1, e.spatialReference && (this.spatialReference = e.spatialReference), this._transparent = !0, this._maxProcessing = 1e3, this._layer = e.layer, this._wset = null, void 0 !== e.outFields && (this._overrideFields = e.outFields), void 0 !== e.includeGeometry && (this._removeGeometry = !1 === e.includeGeometry);\n  }\n\n  _maxQueryRate() {\n    return a;\n  }\n\n  end() {\n    return this._layer;\n  }\n\n  optimisePagingFeatureQueries(e) {\n    this._pageJustIds = e;\n  }\n\n  convertQueryToLruCacheKey(e) {\n    const t = n(e.toJSON());\n    return p(t, y.String);\n  }\n\n  load() {\n    return null === this._loadPromise && (this._loadPromise = _((e, t) => {\n      try {\n        if (!0 === this._layer.loaded) return this._initialiseFeatureSet(), void e(this);\n        this._layer.when().then(() => {\n          try {\n            this._initialiseFeatureSet(), e(this);\n          } catch (r) {\n            t(r);\n          }\n        }, t), this._layer.load();\n      } catch (r) {\n        t(r);\n      }\n    })), this._loadPromise;\n  }\n\n  _initialiseFeatureSet() {\n    if (null == this.spatialReference && (this.spatialReference = this._layer.spatialReference), this.geometryType = this._layer.geometryType, this.fields = this._layer.fields.slice(0), this._layer.outFields) {\n      if (1 === this._layer.outFields.length && \"*\" === this._layer.outFields[0]) ;else {\n        const e = [];\n\n        for (const t of this.fields) if (\"oid\" === t.type) e.push(t);else for (const r of this._layer.outFields) if (r.toLowerCase() === t.name.toLowerCase()) {\n          e.push(t);\n          break;\n        }\n\n        this.fields = e;\n      }\n    } else ;\n    if (null !== this._overrideFields) if (1 === this._overrideFields.length && \"*\" === this._overrideFields[0]) this._overrideFields = null;else {\n      const e = [],\n            t = [];\n\n      for (const r of this.fields) if (\"oid\" === r.type) e.push(r), t.push(r.name);else for (const i of this._overrideFields) if (i.toLowerCase() === r.name.toLowerCase()) {\n        e.push(r), t.push(r.name);\n        break;\n      }\n\n      this.fields = e, this._overrideFields = t;\n    }\n\n    if (this._layer.source && this._layer.source.sourceJSON) {\n      const e = this._layer.source.sourceJSON.currentVersion;\n      !0 === this._layer.source.sourceJSON.useStandardizedQueries ? (this._databaseType = l.StandardisedNoInterval, null != e && e >= 10.61 && (this._databaseType = l.Standardised)) : null != e && (e >= 10.5 && (this._databaseType = l.StandardisedNoInterval, this._requestStandardised = !0), e >= 10.61 && (this._databaseType = l.Standardised));\n    }\n\n    this.objectIdField = this._layer.objectIdField;\n\n    for (const e of this.fields) \"global-id\" === e.type && (this.globalIdField = e.name);\n\n    this.hasM = this._layer.supportsM, this.hasZ = this._layer.supportsZ, this.typeIdField = this._layer.typeIdField, this.types = this._layer.types;\n  }\n\n  _isInFeatureSet() {\n    return o.InFeatureSet;\n  }\n\n  _refineSetBlock(e) {\n    return g(e);\n  }\n\n  _candidateIdTransform(e) {\n    return e;\n  }\n\n  _getSet(e) {\n    return null === this._wset ? this._ensureLoaded().then(() => this._getFilteredSet(\"\", null, null, null, e)).then(e => (this._wset = e, e)) : g(this._wset);\n  }\n\n  _runDatabaseProbe(e) {\n    return _((t, r) => {\n      try {\n        this._ensureLoaded().then(() => {\n          try {\n            const i = new D();\n            i.where = e.replace(\"OBJECTID\", this._layer.objectIdField), this._layer.queryObjectIds(i).then(() => {\n              t(!0);\n            }, () => {\n              try {\n                t(!1);\n              } catch (e) {\n                r(e);\n              }\n            });\n          } catch (i) {\n            r(i);\n          }\n        });\n      } catch (i) {\n        r(i);\n      }\n    });\n  }\n\n  _canUsePagination() {\n    return !(!this._layer.capabilities || !this._layer.capabilities.query || !0 !== this._layer.capabilities.query.supportsPagination);\n  }\n\n  _cacheableFeatureSetSourceKey() {\n    return this._layer.url;\n  }\n\n  pbfSupportedForQuery(e) {\n    return !e.outStatistics && this._layer && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsFormatPBF && !0 === this._layer.capabilities.query.supportsQuantizationEditMode;\n  }\n\n  queryPBF(e) {\n    return e.quantizationParameters = {\n      mode: \"edit\"\n    }, P(this._layer.parsedUrl, e, new R({})).then(e => w.fromJSON(F(e.data)).unquantize());\n  }\n\n  get gdbVersion() {\n    return this._layer && this._layer.capabilities && this._layer.capabilities.data && this._layer.capabilities.data.isVersioned ? this._layer.gdbVersion ? this._layer.gdbVersion : \"SDE.DEFAULT\" : \"\";\n  }\n\n  nativeCapabilities() {\n    return {\n      title: this._layer.title,\n      source: this,\n      canQueryRelated: !0,\n      capabilities: this._layer.capabilities,\n      databaseType: this._databaseType,\n      requestStandardised: this._requestStandardised\n    };\n  }\n\n  executeQuery(e, t) {\n    const r = new I({\n      url: this._layer.parsedUrl.path\n    }),\n          i = \"execute\" === t && this.pbfSupportedForQuery(e);\n    let s = null;\n\n    if (this.recentlyUsedQueries) {\n      const a = this.convertQueryToLruCacheKey(e);\n      s = this.recentlyUsedQueries.getFromCache(a), null === s && (s = !0 !== i ? r[t](e) : this.queryPBF(e), this.recentlyUsedQueries.addToCache(a, s), s = s.catch(e => {\n        throw this.recentlyUsedQueries.removeFromCache(a), e;\n      }));\n    }\n\n    return this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preLayerQueryCallback({\n      layer: this._layer,\n      query: e,\n      method: t\n    }), null === s && (s = !0 !== i ? r[t](e) : this.queryPBF(e)), s;\n  }\n\n  _getFilteredSet(e, t, r, i, a) {\n    return this.databaseType().then(n => {\n      if (this.isTable() && t && null !== e && \"\" !== e) {\n        return new s([], [], !0, null);\n      }\n\n      if (this._canUsePagination()) return this._getFilteredSetUsingPaging(e, t, r, i, a);\n      let l = \"\",\n          o = !1;\n      null !== i && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsOrderBy && (l = i.constructClause(), o = !0);\n      const u = new D();\n      return u.where = null === r ? null === t ? \"1=1\" : \"\" : d(r, n), this._requestStandardised && (u.sqlFormat = \"standard\"), u.spatialRelationship = this._makeRelationshipEnum(e), u.outSpatialReference = this.spatialReference, u.orderByFields = \"\" !== l ? l.split(\",\") : null, u.geometry = null === t ? null : t, u.relationParameter = this._makeRelationshipParam(e), this.executeQuery(u, \"executeForIds\").then(e => {\n        null === e && (e = []), this._checkCancelled(a);\n        return new s([], e, o, null);\n      });\n    });\n  }\n\n  _expandPagedSet(e, t, r, i, s) {\n    return this._expandPagedSetFeatureSet(e, t, r, i, s);\n  }\n\n  _getFilteredSetUsingPaging(e, t, r, i, a) {\n    try {\n      let n = \"\",\n          l = !1;\n      return null !== i && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsOrderBy && (n = i.constructClause(), l = !0), this.databaseType().then(i => {\n        let o = null === r ? null === t ? \"1=1\" : \"\" : d(r, i);\n        this._layer.definitionExpression && (o = \"\" !== o ? \"((\" + this._layer.definitionExpression + \") AND (\" + o + \"))\" : this._layer.definitionExpression);\n\n        let u = this._maxQueryRate();\n\n        const h = this._layer.capabilities.query.maxRecordCount;\n        void 0 !== h && h < u && (u = h);\n        let c = null;\n        if (!0 === this._pageJustIds) c = new s([], [\"GETPAGES\"], l, {\n          spatialRel: this._makeRelationshipEnum(e),\n          relationParam: this._makeRelationshipParam(e),\n          outFields: this._layer.objectIdField,\n          resultRecordCount: u,\n          resultOffset: 0,\n          geometry: null === t ? null : t,\n          where: o,\n          orderByFields: n,\n          returnGeometry: !1,\n          returnIdsOnly: \"false\",\n          internal: {\n            set: [],\n            lastRetrieved: 0,\n            lastPage: 0,\n            fullyResolved: !1\n          }\n        });else {\n          let r = !0;\n          !0 === this._removeGeometry && (r = !1);\n          const i = null !== this._overrideFields ? this._overrideFields : this._fieldsIncludingObjectId(this._layer.outFields ? this._layer.outFields : [\"*\"]);\n          c = new s([], [\"GETPAGES\"], l, {\n            spatialRel: this._makeRelationshipEnum(e),\n            relationParam: this._makeRelationshipParam(e),\n            outFields: i.join(\",\"),\n            resultRecordCount: u,\n            resultOffset: 0,\n            geometry: null === t ? null : t,\n            where: o,\n            orderByFields: n,\n            returnGeometry: r,\n            returnIdsOnly: \"false\",\n            internal: {\n              set: [],\n              lastRetrieved: 0,\n              lastPage: 0,\n              fullyResolved: !1\n            }\n          });\n        }\n        return this._expandPagedSet(c, u, 0, 1, a).then(() => c);\n      });\n    } catch (n) {\n      return m(n);\n    }\n  }\n\n  _clonePageDefinition(e) {\n    return null === e ? null : !0 !== e.groupbypage ? {\n      groupbypage: !1,\n      spatialRel: e.spatialRel,\n      relationParam: e.relationParam,\n      outFields: e.outFields,\n      resultRecordCount: e.resultRecordCount,\n      resultOffset: e.resultOffset,\n      geometry: e.geometry,\n      where: e.where,\n      orderByFields: e.orderByFields,\n      returnGeometry: e.returnGeometry,\n      returnIdsOnly: e.returnIdsOnly,\n      internal: e.internal\n    } : {\n      groupbypage: !0,\n      spatialRel: e.spatialRel,\n      relationParam: e.relationParam,\n      outFields: e.outFields,\n      resultRecordCount: e.resultRecordCount,\n      useOIDpagination: e.useOIDpagination,\n      generatedOid: e.generatedOid,\n      groupByFieldsForStatistics: e.groupByFieldsForStatistics,\n      resultOffset: e.resultOffset,\n      outStatistics: e.outStatistics,\n      geometry: e.geometry,\n      where: e.where,\n      orderByFields: e.orderByFields,\n      returnGeometry: e.returnGeometry,\n      returnIdsOnly: e.returnIdsOnly,\n      internal: e.internal\n    };\n  }\n\n  _getPhysicalPage(e, t, r) {\n    try {\n      const t = e.pagesDefinition.internal.lastRetrieved,\n            i = t,\n            s = e.pagesDefinition.internal.lastPage,\n            a = new D();\n      return this._requestStandardised && (a.sqlFormat = \"standard\"), a.spatialRelationship = e.pagesDefinition.spatialRel, a.relationParameter = e.pagesDefinition.relationParam, a.outFields = e.pagesDefinition.outFields.split(\",\"), a.num = e.pagesDefinition.resultRecordCount, a.start = e.pagesDefinition.internal.lastPage, a.geometry = e.pagesDefinition.geometry, a.where = e.pagesDefinition.where, a.orderByFields = \"\" !== e.pagesDefinition.orderByFields ? e.pagesDefinition.orderByFields.split(\",\") : null, a.returnGeometry = e.pagesDefinition.returnGeometry, a.outSpatialReference = this.spatialReference, this.executeQuery(a, \"execute\").then(a => {\n        if (this._checkCancelled(r), e.pagesDefinition.internal.lastPage !== s) return \"done\";\n\n        for (let t = 0; t < a.features.length; t++) e.pagesDefinition.internal.set[i + t] = a.features[t].attributes[this._layer.objectIdField];\n\n        if (!1 === this._pageJustIds) for (let e = 0; e < a.features.length; e++) this._featureCache[a.features[e].attributes[this._layer.objectIdField]] = a.features[e];\n        return (void 0 === a.exceededTransferLimit && a.features.length !== e.pagesDefinition.resultRecordCount || !1 === a.exceededTransferLimit) && (e.pagesDefinition.internal.fullyResolved = !0), e.pagesDefinition.internal.lastRetrieved = t + a.features.length, e.pagesDefinition.internal.lastPage += e.pagesDefinition.resultRecordCount, \"done\";\n      });\n    } catch (i) {\n      return m(i);\n    }\n  }\n\n  _fieldsIncludingObjectId(e) {\n    if (null === e) return [this.objectIdField];\n    const t = e.slice(0);\n    if (t.indexOf(\"*\") > -1) return t;\n    let r = !1;\n\n    for (const i of t) if (i.toUpperCase() === this.objectIdField.toUpperCase()) {\n      r = !0;\n      break;\n    }\n\n    return !1 === r && t.push(this.objectIdField), t;\n  }\n\n  _getFeatures(e, t, r, i) {\n    const s = [];\n\n    try {\n      if (-1 !== t && void 0 === this._featureCache[t] && s.push(t), !0 === this._checkIfNeedToExpandKnownPage(e, this._maxProcessingRate())) return this._expandPagedSet(e, this._maxProcessingRate(), 0, 0, i).then(() => this._getFeatures(e, t, r, i));\n      let n = 0;\n\n      for (let i = e._lastFetchedIndex; i < e._known.length; i++) {\n        if (e._lastFetchedIndex += 1, n++, void 0 === this._featureCache[e._known[i]]) {\n          let r = !1;\n\n          if (null !== this._layer._mode && void 0 !== this._layer._mode) {\n            const t = this._layer._mode;\n\n            if (void 0 !== t._featureMap[e._known[i]]) {\n              const s = t._featureMap[e._known[i]];\n              null !== s && (r = !0, this._featureCache[e._known[i]] = s);\n            }\n          }\n\n          if (!1 === r && (e._known[i] !== t && s.push(e._known[i]), s.length >= this._maxProcessingRate() - 1)) break;\n        }\n\n        if (n >= r && 0 === s.length) break;\n      }\n\n      if (0 === s.length) return g(\"success\");\n\n      try {\n        const e = new D();\n        return this._requestStandardised && (e.sqlFormat = \"standard\"), e.objectIds = s, e.outFields = null !== this._overrideFields ? this._overrideFields : this._fieldsIncludingObjectId(this._layer.outFields ? this._layer.outFields : [\"*\"]), e.returnGeometry = !0, !0 === this._removeGeometry && (e.returnGeometry = !1), e.outSpatialReference = this.spatialReference, this.executeQuery(e, \"execute\").then(e => {\n          if (this._checkCancelled(i), void 0 !== e.error) return m(new Error(e.error));\n\n          for (let t = 0; t < e.features.length; t++) this._featureCache[e.features[t].attributes[this._layer.objectIdField]] = e.features[t];\n\n          return \"success\";\n        });\n      } catch (a) {\n        return m(a);\n      }\n    } catch (a) {\n      return m(a);\n    }\n  }\n\n  _getDistinctPages(e, t, r, i, s, a, n, l, o) {\n    return this._ensureLoaded().then(() => this.databaseType()).then(u => {\n      let h = r.parseTree.column;\n\n      for (let e = 0; e < this._layer.fields.length; e++) if (this._layer.fields[e].name.toLowerCase() === h.toLowerCase()) {\n        h = this._layer.fields[e].name;\n        break;\n      }\n\n      const c = new D();\n      this._requestStandardised && (c.sqlFormat = \"standard\");\n      let p = null === a ? null === s ? \"1=1\" : \"\" : d(a, u);\n      return this._layer.definitionExpression && (p = \"\" !== p ? \"((\" + this._layer.definitionExpression + \") AND (\" + p + \"))\" : this._layer.definitionExpression), c.where = p, c.spatialRelationship = this._makeRelationshipEnum(i), c.relationParameter = this._makeRelationshipParam(i), c.geometry = null === s ? null : s, c.returnDistinctValues = !0, c.returnGeometry = !1, c.outFields = [h], this.executeQuery(c, \"execute\").then(u => {\n        if (this._checkCancelled(o), !u.hasOwnProperty(\"features\")) return m(new Error(\"Unnexected Result querying statistics from layer\"));\n        let d = !1;\n\n        for (let e = 0; e < this._layer.fields.length; e++) if (this._layer.fields[e].name === h) {\n          \"date\" === this._layer.fields[e].type && (d = !0);\n          break;\n        }\n\n        for (let e = 0; e < u.features.length; e++) {\n          if (d) {\n            const t = u.features[e].attributes[h];\n            null !== t ? l.push(new Date(t)) : l.push(t);\n          } else l.push(u.features[e].attributes[h]);\n\n          if (l.length >= n) break;\n        }\n\n        return 0 === u.features.length ? l : u.features.length === this._layer.capabilities.query.maxRecordCount && l.length < n ? this._getDistinctPages(e + u.features.length, t, r, i, s, a, n, l, o).then(e => ({\n          calculated: !0,\n          result: e\n        })) : l;\n      });\n    });\n  }\n\n  _distinctStat(e, t, r, i, s, a, n) {\n    return this._getDistinctPages(0, e, t, r, i, s, a, [], n).then(e => ({\n      calculated: !0,\n      result: e\n    }));\n  }\n\n  isTable() {\n    return this._layer.isTable || null === this._layer.geometryType || \"table\" === this._layer.type || \"\" === this._layer.geometryType;\n  }\n\n  _countstat(e, t, r, i) {\n    return this.databaseType().then(e => {\n      const s = new D();\n      if (this._requestStandardised && (s.sqlFormat = \"standard\"), this.isTable() && r && null !== t && \"\" !== t) return {\n        calculated: !0,\n        result: 0\n      };\n      let a = null === i ? null === r ? \"1=1\" : \"\" : d(i, e);\n      return this._layer.definitionExpression && (a = \"\" !== a ? \"((\" + this._layer.definitionExpression + \") AND (\" + a + \"))\" : this._layer.definitionExpression), s.where = a, s.where = a, s.spatialRelationship = this._makeRelationshipEnum(t), s.relationParameter = this._makeRelationshipParam(t), s.geometry = null === r ? null : r, s.returnGeometry = !1, this.executeQuery(s, \"executeForCount\").then(e => ({\n        calculated: !0,\n        result: e\n      }));\n    });\n  }\n\n  _stats(e, t, r, i, s, a, n) {\n    return this._ensureLoaded().then(() => {\n      const l = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsSqlExpression,\n            o = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsStatistics,\n            u = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsDistinct;\n      return \"count\" === e ? u ? this._countstat(e, r, i, s) : {\n        calculated: !1\n      } : !1 === o || !1 === h(t) && !1 === l || !1 === t.isStandardized ? \"\" !== r || null !== s ? {\n        calculated: !1\n      } : this._manualStat(e, t, a, n) : \"distinct\" === e ? !1 === u ? \"\" !== r || null !== s ? {\n        calculated: !1\n      } : this._manualStat(e, t, a, n) : this._distinctStat(e, t, r, i, s, a, n) : this.databaseType().then(a => {\n        if (this.isTable() && i && null !== r && \"\" !== r) return {\n          calculated: !0,\n          result: null\n        };\n        const n = new D();\n        this._requestStandardised && (n.sqlFormat = \"standard\");\n        let l = null === s ? null === i ? \"1=1\" : \"\" : d(s, a);\n        this._layer.definitionExpression && (l = \"\" !== l ? \"((\" + this._layer.definitionExpression + \") AND (\" + l + \"))\" : this._layer.definitionExpression), n.where = l, n.spatialRelationship = this._makeRelationshipEnum(r), n.relationParameter = this._makeRelationshipParam(r), n.geometry = null === i ? null : i;\n        const o = new x();\n        o.statisticType = c(e), o.onStatisticField = d(t, a), o.outStatisticFieldName = \"ARCADE_STAT_RESULT\", n.returnGeometry = !1;\n        let u = \"ARCADE_STAT_RESULT\";\n        return n.outStatistics = [o], this.executeQuery(n, \"execute\").then(e => {\n          if (!e.hasOwnProperty(\"features\") || 0 === e.features.length) return m(new Error(\"Unnexected Result querying statistics from layer\"));\n          let t = !1;\n\n          for (let r = 0; r < e.fields.length; r++) if (\"ARCADE_STAT_RESULT\" === e.fields[r].name.toUpperCase()) {\n            u = e.fields[r].name, \"date\" === e.fields[r].type && (t = !0);\n            break;\n          }\n\n          if (t) {\n            let t = e.features[0].attributes[u];\n            return null !== t && (t = new Date(e.features[0].attributes[u])), {\n              calculated: !0,\n              result: t\n            };\n          }\n\n          return {\n            calculated: !0,\n            result: e.features[0].attributes[u]\n          };\n        });\n      });\n    });\n  }\n\n  _stat(e, t, r, i, s, a, n) {\n    return this._stats(e, t, r, i, s, a, n);\n  }\n\n  _canDoAggregates(e, t) {\n    return this._ensureLoaded().then(() => {\n      let e = !1;\n      const r = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsSqlExpression;\n      if (void 0 !== this._layer.capabilities && null !== this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsStatistics && !0 === this._layer.capabilities.query.supportsOrderBy && (e = !0), e) for (let i = 0; i < t.length - 1; i++) null !== t[i].workingexpr && (!1 === t[i].workingexpr.isStandardized || !1 === h(t[i].workingexpr) && !1 === r) && (e = !1);\n      return !1 !== e;\n    });\n  }\n\n  _makeRelationshipEnum(e) {\n    if (e.indexOf(\"esriSpatialRelRelation\") >= 0) return \"relation\";\n\n    switch (e) {\n      case \"esriSpatialRelRelation\":\n        return \"relation\";\n\n      case \"esriSpatialRelIntersects\":\n        return \"intersects\";\n\n      case \"esriSpatialRelContains\":\n        return \"contains\";\n\n      case \"esriSpatialRelOverlaps\":\n        return \"overlaps\";\n\n      case \"esriSpatialRelWithin\":\n        return \"within\";\n\n      case \"esriSpatialRelTouches\":\n        return \"touches\";\n\n      case \"esriSpatialRelCrosses\":\n        return \"crosses\";\n\n      case \"esriSpatialRelEnvelopeIntersects\":\n        return \"envelope-intersects\";\n    }\n\n    return e;\n  }\n\n  _makeRelationshipParam(e) {\n    return e.indexOf(\"esriSpatialRelRelation\") >= 0 ? e.split(\":\")[1] : \"\";\n  }\n\n  _getAggregatePagesDataSourceDefinition(e, t, r, i, a, n, l) {\n    return this._ensureLoaded().then(() => this.databaseType()).then(o => {\n      let u = \"\",\n          h = !1,\n          c = !1;\n      null !== n && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsOrderBy && (u = n.constructClause(), c = !0), this._layer.capabilities && this._layer.capabilities.query && !1 === this._layer.capabilities.query.supportsPagination && (c = !1, h = !0, u = this._layer.objectIdField);\n      const p = [];\n\n      for (let e = 0; e < t.length; e++) {\n        const r = new x();\n        r.onStatisticField = null !== t[e].workingexpr ? d(t[e].workingexpr, o) : \"\", r.outStatisticFieldName = t[e].field, r.statisticType = t[e].toStatisticsName(), p.push(r);\n      }\n\n      \"\" === u && (u = e.join(\",\"));\n\n      let y = this._maxQueryRate();\n\n      const f = this._layer.capabilities.query.maxRecordCount;\n      void 0 !== f && f < y && (y = f);\n\n      let _ = null === a ? null === i ? \"1=1\" : \"\" : d(a, o);\n\n      this._layer.definitionExpression && (_ = \"\" !== _ ? \"((\" + this._layer.definitionExpression + \") AND (\" + _ + \"))\" : this._layer.definitionExpression);\n      return new s([], [\"GETPAGES\"], c, {\n        groupbypage: !0,\n        spatialRel: this._makeRelationshipEnum(r),\n        relationParam: this._makeRelationshipParam(r),\n        outFields: [\"*\"],\n        useOIDpagination: h,\n        generatedOid: l,\n        resultRecordCount: y,\n        resultOffset: 0,\n        groupByFieldsForStatistics: e,\n        outStatistics: p,\n        geometry: null === i ? null : i,\n        where: _,\n        orderByFields: u,\n        returnGeometry: !1,\n        returnIdsOnly: !1,\n        internal: {\n          lastMaxId: -1,\n          set: [],\n          lastRetrieved: 0,\n          lastPage: 0,\n          fullyResolved: !1\n        }\n      });\n    });\n  }\n\n  _getAgregagtePhysicalPage(t, r, i) {\n    try {\n      let r = t.pagesDefinition.where;\n      !0 === t.pagesDefinition.useOIDpagination && (r = \"\" !== r ? \"(\" + r + \") AND (\" + t.pagesDefinition.generatedOid + \">\" + t.pagesDefinition.internal.lastMaxId.toString() + \")\" : t.pagesDefinition.generatedOid + \">\" + t.pagesDefinition.internal.lastMaxId.toString());\n      const s = t.pagesDefinition.internal.lastRetrieved,\n            a = s,\n            n = t.pagesDefinition.internal.lastPage,\n            l = new D();\n      return this._requestStandardised && (l.sqlFormat = \"standard\"), l.where = r, l.spatialRelationship = t.pagesDefinition.spatialRel, l.relationParameter = t.pagesDefinition.relationParam, l.outFields = t.pagesDefinition.outFields, l.outStatistics = t.pagesDefinition.outStatistics, l.geometry = t.pagesDefinition.geometry, l.groupByFieldsForStatistics = t.pagesDefinition.groupByFieldsForStatistics, l.num = t.pagesDefinition.resultRecordCount, l.start = t.pagesDefinition.internal.lastPage, l.returnGeometry = t.pagesDefinition.returnGeometry, l.orderByFields = \"\" !== t.pagesDefinition.orderByFields ? t.pagesDefinition.orderByFields.split(\",\") : null, this.isTable() && l.geometry && l.spatialRelationship ? g([]) : this.executeQuery(l, \"execute\").then(r => {\n        if (this._checkCancelled(i), !r.hasOwnProperty(\"features\")) return m(new Error(\"Unnexected Result querying aggregates from layer\"));\n        const l = [];\n        if (t.pagesDefinition.internal.lastPage !== n) return [];\n\n        for (let e = 0; e < r.features.length; e++) t.pagesDefinition.internal.set[a + e] = r.features[e].attributes[t.pagesDefinition.generatedOid];\n\n        for (let t = 0; t < r.features.length; t++) l.push(new e({\n          attributes: r.features[t].attributes,\n          geometry: null\n        }));\n\n        return !0 === t.pagesDefinition.useOIDpagination ? 0 === r.features.length ? t.pagesDefinition.internal.fullyResolved = !0 : t.pagesDefinition.internal.lastMaxId = r.features[r.features.length - 1].attributes[t.pagesDefinition.generatedOid] : (void 0 === r.exceededTransferLimit && r.features.length !== t.pagesDefinition.resultRecordCount || !1 === r.exceededTransferLimit) && (t.pagesDefinition.internal.fullyResolved = !0), t.pagesDefinition.internal.lastRetrieved = s + r.features.length, t.pagesDefinition.internal.lastPage += t.pagesDefinition.resultRecordCount, l;\n      });\n    } catch (s) {\n      return m(s);\n    }\n  }\n\n  static create(e, t, r, i, s) {\n    const a = new S({\n      url: e,\n      outFields: null === t ? [\"*\"] : t\n    });\n    return new q({\n      layer: a,\n      spatialReference: r,\n      lrucache: i,\n      interceptor: s\n    });\n  }\n\n  relationshipMetaData() {\n    return this._layer && this._layer.source && this._layer.source.sourceJSON && this._layer.source.sourceJSON.relationships ? this._layer.source.sourceJSON.relationships : [];\n  }\n\n  serviceUrl() {\n    return u(this._layer.parsedUrl.path);\n  }\n\n  queryAttachments(e, t, i, s) {\n    if (this._layer.capabilities.data.supportsAttachment && this._layer.capabilities.operations.supportsQueryAttachments) {\n      const a = {\n        objectIds: [e]\n      };\n      return (t && t > 0 || i && i > 0) && (a.size = [t && t > 0 ? t : 0, i && i > 0 ? i : t + 1]), s && s.length > 0 && (a.attachmentTypes = s), this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preLayerQueryCallback({\n        layer: this._layer,\n        query: a,\n        method: \"attachments\"\n      }), this._layer.queryAttachments(a).then(t => {\n        const i = [];\n        return t && t[e] && t[e].forEach(t => {\n          const s = this._layer.parsedUrl.path + \"/\" + e.toString() + \"/attachments/\" + t.id.toString();\n          i.push(new r(t.id, t.name, t.contentType, t.size, s));\n        }), i;\n      });\n    }\n\n    return g([]);\n  }\n\n  queryRelatedFeatures(r) {\n    const i = {\n      f: \"json\",\n      relationshipId: r.relationshipId.toString(),\n      definitionExpression: r.where,\n      outFields: r.outFields.join(\",\"),\n      returnGeometry: r.returnGeometry.toString()\n    };\n    return void 0 !== r.resultOffset && null !== r.resultOffset && (i.resultOffset = r.resultOffset.toString()), void 0 !== r.resultRecordCount && null !== r.resultRecordCount && (i.resultRecordCount = r.resultRecordCount.toString()), r.orderByFields && (i.orderByFields = r.orderByFields.join(\",\")), r.objectIds.length > 0 && (i.objectIds = r.objectIds.join(\",\")), r.outSpatialReference && (i.outSR = JSON.stringify(r.outSpatialReference.toJSON())), this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preRequestCallback({\n      layer: this._layer,\n      queryPayload: i,\n      method: \"relatedrecords\",\n      url: this._layer.parsedUrl.path + \"/queryRelatedRecords\"\n    }), t(this._layer.parsedUrl.path + \"/queryRelatedRecords\", {\n      responseType: \"json\",\n      query: i\n    }).then(t => {\n      if (t.data) {\n        const r = {},\n              i = t.data;\n\n        if (i && i.relatedRecordGroups) {\n          const t = i.spatialReference;\n\n          for (const s of i.relatedRecordGroups) {\n            const a = s.objectId,\n                  n = [];\n\n            for (const r of s.relatedRecords) {\n              r.geometry && (r.geometry.spatialReference = t);\n              const i = new e({\n                geometry: r.geometry ? b(r.geometry) : null,\n                attributes: r.attributes\n              });\n              n.push(i);\n            }\n\n            r[a] = {\n              features: n,\n              exceededTransferLimit: !0 === i.exceededTransferLimit\n            };\n          }\n        }\n\n        return r;\n      }\n\n      return m(\"Invalid Request\");\n    });\n  }\n\n  getFeatureByObjectId(e, t) {\n    const r = new I({\n      url: this._layer.parsedUrl.path\n    }),\n          i = new D();\n    return i.outFields = t, i.returnGeometry = !1, i.outSpatialReference = this.spatialReference, i.where = this.objectIdField + \"=\" + e.toString(), this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preLayerQueryCallback({\n      layer: this._layer,\n      query: i,\n      method: \"execute\"\n    }), r.execute(i).then(e => 1 === e.features.length ? e.features[0] : null);\n  }\n\n  getIdentityUser() {\n    return this.load().then(() => {\n      var e;\n      const t = null == (e = f) ? void 0 : e.findCredential(this._layer.url);\n      return t ? t.userId : null;\n    });\n  }\n\n  getOwningSystemUrl() {\n    return this.load().then(() => {\n      var e;\n      const r = null == (e = f) ? void 0 : e.findServerInfo(this._layer.url);\n      if (r) return g(r.owningSystemUrl);\n      let i = this._layer.url;\n      const s = i.toLowerCase().indexOf(\"/rest/services\");\n      return i = s > -1 ? i.substring(0, s) : i, i ? (i += \"/rest/info\", _((e, r) => {\n        t(i, {\n          query: {\n            f: \"json\"\n          }\n        }).then(t => {\n          let r = \"\";\n          t.data && t.data.owningSystemUrl && (r = t.data.owningSystemUrl), e(r);\n        }, t => {\n          e(\"\");\n        });\n      })) : g(\"\");\n    });\n  }\n\n}\n\nexport default q;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/arcade/featureset/sources/FeatureLayerDynamic.js"],"names":["e","t","r","i","s","defaultMaxRecords","a","stableStringify","n","FeatureServiceDatabaseType","l","IdState","o","extractServiceUrl","u","toWhereClause","d","isSingleField","h","decodeStatType","c","createMD5Hash","p","outputTypes","y","id","f","create","_","resolve","g","reject","m","fromJSON","b","S","convertToFeatureSet","F","OptimizedFeatureSetParserContext","R","w","D","x","I","executeQueryPBF","P","q","constructor","declaredClass","_removeGeometry","_overrideFields","formulaCredential","_pageJustIds","_requestStandardised","spatialReference","_transparent","_maxProcessing","_layer","layer","_wset","outFields","includeGeometry","_maxQueryRate","end","optimisePagingFeatureQueries","convertQueryToLruCacheKey","toJSON","String","load","_loadPromise","loaded","_initialiseFeatureSet","when","then","geometryType","fields","slice","length","type","push","toLowerCase","name","source","sourceJSON","currentVersion","useStandardizedQueries","_databaseType","StandardisedNoInterval","Standardised","objectIdField","globalIdField","hasM","supportsM","hasZ","supportsZ","typeIdField","types","_isInFeatureSet","InFeatureSet","_refineSetBlock","_candidateIdTransform","_getSet","_ensureLoaded","_getFilteredSet","_runDatabaseProbe","where","replace","queryObjectIds","_canUsePagination","capabilities","query","supportsPagination","_cacheableFeatureSetSourceKey","url","pbfSupportedForQuery","outStatistics","supportsFormatPBF","supportsQuantizationEditMode","queryPBF","quantizationParameters","mode","parsedUrl","data","unquantize","gdbVersion","isVersioned","nativeCapabilities","title","canQueryRelated","databaseType","requestStandardised","executeQuery","path","recentlyUsedQueries","getFromCache","addToCache","catch","removeFromCache","featureSetQueryInterceptor","preLayerQueryCallback","method","isTable","_getFilteredSetUsingPaging","supportsOrderBy","constructClause","sqlFormat","spatialRelationship","_makeRelationshipEnum","outSpatialReference","orderByFields","split","geometry","relationParameter","_makeRelationshipParam","_checkCancelled","_expandPagedSet","_expandPagedSetFeatureSet","definitionExpression","maxRecordCount","spatialRel","relationParam","resultRecordCount","resultOffset","returnGeometry","returnIdsOnly","internal","set","lastRetrieved","lastPage","fullyResolved","_fieldsIncludingObjectId","join","_clonePageDefinition","groupbypage","useOIDpagination","generatedOid","groupByFieldsForStatistics","_getPhysicalPage","pagesDefinition","num","start","features","attributes","_featureCache","exceededTransferLimit","indexOf","toUpperCase","_getFeatures","_checkIfNeedToExpandKnownPage","_maxProcessingRate","_lastFetchedIndex","_known","_mode","_featureMap","objectIds","error","Error","_getDistinctPages","parseTree","column","returnDistinctValues","hasOwnProperty","Date","calculated","result","_distinctStat","_countstat","_stats","supportsSqlExpression","supportsStatistics","supportsDistinct","isStandardized","_manualStat","statisticType","onStatisticField","outStatisticFieldName","_stat","_canDoAggregates","workingexpr","_getAggregatePagesDataSourceDefinition","field","toStatisticsName","lastMaxId","_getAgregagtePhysicalPage","toString","lrucache","interceptor","relationshipMetaData","relationships","serviceUrl","queryAttachments","supportsAttachment","operations","supportsQueryAttachments","size","attachmentTypes","forEach","contentType","queryRelatedFeatures","relationshipId","outSR","JSON","stringify","preRequestCallback","queryPayload","responseType","relatedRecordGroups","objectId","relatedRecords","getFeatureByObjectId","execute","getIdentityUser","findCredential","userId","getOwningSystemUrl","findServerInfo","owningSystemUrl","substring"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../Graphic.js\";import t from\"../../../request.js\";import r from\"../../Attachment.js\";import i from\"../support/FeatureSet.js\";import s from\"../support/IdSet.js\";import{defaultMaxRecords as a,stableStringify as n,FeatureServiceDatabaseType as l,IdState as o,extractServiceUrl as u}from\"../support/shared.js\";import{toWhereClause as d,isSingleField as h}from\"../support/sqlUtils.js\";import{decodeStatType as c}from\"../support/stats.js\";import{createMD5Hash as p,outputTypes as y}from\"../../../core/MD5.js\";import{id as f}from\"../../../kernel.js\";import{create as _,resolve as g,reject as m}from\"../../../core/promiseUtils.js\";import{fromJSON as b}from\"../../../geometry/support/jsonUtils.js\";import S from\"../../../layers/FeatureLayer.js\";import{convertToFeatureSet as F}from\"../../../layers/graphics/featureConversionUtils.js\";import{OptimizedFeatureSetParserContext as R}from\"../../../rest/query/operations/pbfOptimizedFeatureSet.js\";import w from\"../../../rest/support/FeatureSet.js\";import D from\"../../../rest/support/Query.js\";import x from\"../../../rest/support/StatisticDefinition.js\";import I from\"../../../tasks/QueryTask.js\";import{executeQueryPBF as P}from\"../../../rest/query/operations/query.js\";class q extends i{constructor(e){super(e),this.declaredClass=\"esri.arcade.featureset.sources.FeatureLayerDynamic\",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}convertQueryToLruCacheKey(e){const t=n(e.toJSON());return p(t,y.String)}load(){return null===this._loadPromise&&(this._loadPromise=_(((e,t)=>{try{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(r){t(r)}}),t),this._layer.load()}catch(r){t(r)}}))),this._loadPromise}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&\"*\"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if(\"oid\"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}else;if(null!==this._overrideFields)if(1===this._overrideFields.length&&\"*\"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if(\"oid\"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=l.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=l.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=l.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=l.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)\"global-id\"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}_isInFeatureSet(){return o.InFeatureSet}_refineSetBlock(e){return g(e)}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet(\"\",null,null,null,e))).then((e=>(this._wset=e,e))):g(this._wset)}_runDatabaseProbe(e){return _(((t,r)=>{try{this._ensureLoaded().then((()=>{try{const i=new D;i.where=e.replace(\"OBJECTID\",this._layer.objectIdField),this._layer.queryObjectIds(i).then((()=>{t(!0)}),(()=>{try{t(!1)}catch(e){r(e)}}))}catch(i){r(i)}}))}catch(i){r(i)}}))}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}queryPBF(e){return e.quantizationParameters={mode:\"edit\"},P(this._layer.parsedUrl,e,new R({})).then((e=>w.fromJSON(F(e.data)).unquantize()))}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:\"SDE.DEFAULT\":\"\"}nativeCapabilities(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){const r=new I({url:this._layer.parsedUrl.path}),i=\"execute\"===t&&this.pbfSupportedForQuery(e);let s=null;if(this.recentlyUsedQueries){const a=this.convertQueryToLruCacheKey(e);s=this.recentlyUsedQueries.getFromCache(a),null===s&&(s=!0!==i?r[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(a,s),s=s.catch((e=>{throw this.recentlyUsedQueries.removeFromCache(a),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===s&&(s=!0!==i?r[t](e):this.queryPBF(e)),s}_getFilteredSet(e,t,r,i,a){return this.databaseType().then((n=>{if(this.isTable()&&t&&null!==e&&\"\"!==e){return new s([],[],!0,null)}if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,i,a);let l=\"\",o=!1;null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(l=i.constructClause(),o=!0);const u=new D;return u.where=null===r?null===t?\"1=1\":\"\":d(r,n),this._requestStandardised&&(u.sqlFormat=\"standard\"),u.spatialRelationship=this._makeRelationshipEnum(e),u.outSpatialReference=this.spatialReference,u.orderByFields=\"\"!==l?l.split(\",\"):null,u.geometry=null===t?null:t,u.relationParameter=this._makeRelationshipParam(e),this.executeQuery(u,\"executeForIds\").then((e=>{null===e&&(e=[]),this._checkCancelled(a);return new s([],e,o,null)}))}))}_expandPagedSet(e,t,r,i,s){return this._expandPagedSetFeatureSet(e,t,r,i,s)}_getFilteredSetUsingPaging(e,t,r,i,a){try{let n=\"\",l=!1;return null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(n=i.constructClause(),l=!0),this.databaseType().then((i=>{let o=null===r?null===t?\"1=1\":\"\":d(r,i);this._layer.definitionExpression&&(o=\"\"!==o?\"((\"+this._layer.definitionExpression+\") AND (\"+o+\"))\":this._layer.definitionExpression);let u=this._maxQueryRate();const h=this._layer.capabilities.query.maxRecordCount;void 0!==h&&h<u&&(u=h);let c=null;if(!0===this._pageJustIds)c=new s([],[\"GETPAGES\"],l,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:u,resultOffset:0,geometry:null===t?null:t,where:o,orderByFields:n,returnGeometry:!1,returnIdsOnly:\"false\",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const i=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:[\"*\"]);c=new s([],[\"GETPAGES\"],l,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:i.join(\",\"),resultRecordCount:u,resultOffset:0,geometry:null===t?null:t,where:o,orderByFields:n,returnGeometry:r,returnIdsOnly:\"false\",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return this._expandPagedSet(c,u,0,1,a).then((()=>c))}))}catch(n){return m(n)}}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,i=t,s=e.pagesDefinition.internal.lastPage,a=new D;return this._requestStandardised&&(a.sqlFormat=\"standard\"),a.spatialRelationship=e.pagesDefinition.spatialRel,a.relationParameter=e.pagesDefinition.relationParam,a.outFields=e.pagesDefinition.outFields.split(\",\"),a.num=e.pagesDefinition.resultRecordCount,a.start=e.pagesDefinition.internal.lastPage,a.geometry=e.pagesDefinition.geometry,a.where=e.pagesDefinition.where,a.orderByFields=\"\"!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(\",\"):null,a.returnGeometry=e.pagesDefinition.returnGeometry,a.outSpatialReference=this.spatialReference,this.executeQuery(a,\"execute\").then((a=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return\"done\";for(let t=0;t<a.features.length;t++)e.pagesDefinition.internal.set[i+t]=a.features[t].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(let e=0;e<a.features.length;e++)this._featureCache[a.features[e].attributes[this._layer.objectIdField]]=a.features[e];return(void 0===a.exceededTransferLimit&&a.features.length!==e.pagesDefinition.resultRecordCount||!1===a.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+a.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,\"done\"}))}catch(i){return m(i)}}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf(\"*\")>-1)return t;let r=!1;for(const i of t)if(i.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,i){const s=[];try{if(-1!==t&&void 0===this._featureCache[t]&&s.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,i).then((()=>this._getFeatures(e,t,r,i)));let n=0;for(let i=e._lastFetchedIndex;i<e._known.length;i++){if(e._lastFetchedIndex+=1,n++,void 0===this._featureCache[e._known[i]]){let r=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const t=this._layer._mode;if(void 0!==t._featureMap[e._known[i]]){const s=t._featureMap[e._known[i]];null!==s&&(r=!0,this._featureCache[e._known[i]]=s)}}if(!1===r&&(e._known[i]!==t&&s.push(e._known[i]),s.length>=this._maxProcessingRate()-1))break}if(n>=r&&0===s.length)break}if(0===s.length)return g(\"success\");try{const e=new D;return this._requestStandardised&&(e.sqlFormat=\"standard\"),e.objectIds=s,e.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:[\"*\"]),e.returnGeometry=!0,!0===this._removeGeometry&&(e.returnGeometry=!1),e.outSpatialReference=this.spatialReference,this.executeQuery(e,\"execute\").then((e=>{if(this._checkCancelled(i),void 0!==e.error)return m(new Error(e.error));for(let t=0;t<e.features.length;t++)this._featureCache[e.features[t].attributes[this._layer.objectIdField]]=e.features[t];return\"success\"}))}catch(a){return m(a)}}catch(a){return m(a)}}_getDistinctPages(e,t,r,i,s,a,n,l,o){return this._ensureLoaded().then((()=>this.databaseType())).then((u=>{let h=r.parseTree.column;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===h.toLowerCase()){h=this._layer.fields[e].name;break}const c=new D;this._requestStandardised&&(c.sqlFormat=\"standard\");let p=null===a?null===s?\"1=1\":\"\":d(a,u);return this._layer.definitionExpression&&(p=\"\"!==p?\"((\"+this._layer.definitionExpression+\") AND (\"+p+\"))\":this._layer.definitionExpression),c.where=p,c.spatialRelationship=this._makeRelationshipEnum(i),c.relationParameter=this._makeRelationshipParam(i),c.geometry=null===s?null:s,c.returnDistinctValues=!0,c.returnGeometry=!1,c.outFields=[h],this.executeQuery(c,\"execute\").then((u=>{if(this._checkCancelled(o),!u.hasOwnProperty(\"features\"))return m(new Error(\"Unnexected Result querying statistics from layer\"));let d=!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name===h){\"date\"===this._layer.fields[e].type&&(d=!0);break}for(let e=0;e<u.features.length;e++){if(d){const t=u.features[e].attributes[h];null!==t?l.push(new Date(t)):l.push(t)}else l.push(u.features[e].attributes[h]);if(l.length>=n)break}return 0===u.features.length?l:u.features.length===this._layer.capabilities.query.maxRecordCount&&l.length<n?this._getDistinctPages(e+u.features.length,t,r,i,s,a,n,l,o).then((e=>({calculated:!0,result:e}))):l}))}))}_distinctStat(e,t,r,i,s,a,n){return this._getDistinctPages(0,e,t,r,i,s,a,[],n).then((e=>({calculated:!0,result:e})))}isTable(){return this._layer.isTable||null===this._layer.geometryType||\"table\"===this._layer.type||\"\"===this._layer.geometryType}_countstat(e,t,r,i){return this.databaseType().then((e=>{const s=new D;if(this._requestStandardised&&(s.sqlFormat=\"standard\"),this.isTable()&&r&&null!==t&&\"\"!==t)return{calculated:!0,result:0};let a=null===i?null===r?\"1=1\":\"\":d(i,e);return this._layer.definitionExpression&&(a=\"\"!==a?\"((\"+this._layer.definitionExpression+\") AND (\"+a+\"))\":this._layer.definitionExpression),s.where=a,s.where=a,s.spatialRelationship=this._makeRelationshipEnum(t),s.relationParameter=this._makeRelationshipParam(t),s.geometry=null===r?null:r,s.returnGeometry=!1,this.executeQuery(s,\"executeForCount\").then((e=>({calculated:!0,result:e})))}))}_stats(e,t,r,i,s,a,n){return this._ensureLoaded().then((()=>{const l=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;return\"count\"===e?u?this._countstat(e,r,i,s):{calculated:!1}:!1===o||!1===h(t)&&!1===l||!1===t.isStandardized?\"\"!==r||null!==s?{calculated:!1}:this._manualStat(e,t,a,n):\"distinct\"===e?!1===u?\"\"!==r||null!==s?{calculated:!1}:this._manualStat(e,t,a,n):this._distinctStat(e,t,r,i,s,a,n):this.databaseType().then((a=>{if(this.isTable()&&i&&null!==r&&\"\"!==r)return{calculated:!0,result:null};const n=new D;this._requestStandardised&&(n.sqlFormat=\"standard\");let l=null===s?null===i?\"1=1\":\"\":d(s,a);this._layer.definitionExpression&&(l=\"\"!==l?\"((\"+this._layer.definitionExpression+\") AND (\"+l+\"))\":this._layer.definitionExpression),n.where=l,n.spatialRelationship=this._makeRelationshipEnum(r),n.relationParameter=this._makeRelationshipParam(r),n.geometry=null===i?null:i;const o=new x;o.statisticType=c(e),o.onStatisticField=d(t,a),o.outStatisticFieldName=\"ARCADE_STAT_RESULT\",n.returnGeometry=!1;let u=\"ARCADE_STAT_RESULT\";return n.outStatistics=[o],this.executeQuery(n,\"execute\").then((e=>{if(!e.hasOwnProperty(\"features\")||0===e.features.length)return m(new Error(\"Unnexected Result querying statistics from layer\"));let t=!1;for(let r=0;r<e.fields.length;r++)if(\"ARCADE_STAT_RESULT\"===e.fields[r].name.toUpperCase()){u=e.fields[r].name,\"date\"===e.fields[r].type&&(t=!0);break}if(t){let t=e.features[0].attributes[u];return null!==t&&(t=new Date(e.features[0].attributes[u])),{calculated:!0,result:t}}return{calculated:!0,result:e.features[0].attributes[u]}}))}))}))}_stat(e,t,r,i,s,a,n){return this._stats(e,t,r,i,s,a,n)}_canDoAggregates(e,t){return this._ensureLoaded().then((()=>{let e=!1;const r=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression;if(void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(let i=0;i<t.length-1;i++)null!==t[i].workingexpr&&(!1===t[i].workingexpr.isStandardized||!1===h(t[i].workingexpr)&&!1===r)&&(e=!1);return!1!==e}))}_makeRelationshipEnum(e){if(e.indexOf(\"esriSpatialRelRelation\")>=0)return\"relation\";switch(e){case\"esriSpatialRelRelation\":return\"relation\";case\"esriSpatialRelIntersects\":return\"intersects\";case\"esriSpatialRelContains\":return\"contains\";case\"esriSpatialRelOverlaps\":return\"overlaps\";case\"esriSpatialRelWithin\":return\"within\";case\"esriSpatialRelTouches\":return\"touches\";case\"esriSpatialRelCrosses\":return\"crosses\";case\"esriSpatialRelEnvelopeIntersects\":return\"envelope-intersects\"}return e}_makeRelationshipParam(e){return e.indexOf(\"esriSpatialRelRelation\")>=0?e.split(\":\")[1]:\"\"}_getAggregatePagesDataSourceDefinition(e,t,r,i,a,n,l){return this._ensureLoaded().then((()=>this.databaseType())).then((o=>{let u=\"\",h=!1,c=!1;null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(u=n.constructClause(),c=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(c=!1,h=!0,u=this._layer.objectIdField);const p=[];for(let e=0;e<t.length;e++){const r=new x;r.onStatisticField=null!==t[e].workingexpr?d(t[e].workingexpr,o):\"\",r.outStatisticFieldName=t[e].field,r.statisticType=t[e].toStatisticsName(),p.push(r)}\"\"===u&&(u=e.join(\",\"));let y=this._maxQueryRate();const f=this._layer.capabilities.query.maxRecordCount;void 0!==f&&f<y&&(y=f);let _=null===a?null===i?\"1=1\":\"\":d(a,o);this._layer.definitionExpression&&(_=\"\"!==_?\"((\"+this._layer.definitionExpression+\") AND (\"+_+\"))\":this._layer.definitionExpression);return new s([],[\"GETPAGES\"],c,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:[\"*\"],useOIDpagination:h,generatedOid:l,resultRecordCount:y,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:p,geometry:null===i?null:i,where:_,orderByFields:u,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}_getAgregagtePhysicalPage(t,r,i){try{let r=t.pagesDefinition.where;!0===t.pagesDefinition.useOIDpagination&&(r=\"\"!==r?\"(\"+r+\") AND (\"+t.pagesDefinition.generatedOid+\">\"+t.pagesDefinition.internal.lastMaxId.toString()+\")\":t.pagesDefinition.generatedOid+\">\"+t.pagesDefinition.internal.lastMaxId.toString());const s=t.pagesDefinition.internal.lastRetrieved,a=s,n=t.pagesDefinition.internal.lastPage,l=new D;return this._requestStandardised&&(l.sqlFormat=\"standard\"),l.where=r,l.spatialRelationship=t.pagesDefinition.spatialRel,l.relationParameter=t.pagesDefinition.relationParam,l.outFields=t.pagesDefinition.outFields,l.outStatistics=t.pagesDefinition.outStatistics,l.geometry=t.pagesDefinition.geometry,l.groupByFieldsForStatistics=t.pagesDefinition.groupByFieldsForStatistics,l.num=t.pagesDefinition.resultRecordCount,l.start=t.pagesDefinition.internal.lastPage,l.returnGeometry=t.pagesDefinition.returnGeometry,l.orderByFields=\"\"!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(\",\"):null,this.isTable()&&l.geometry&&l.spatialRelationship?g([]):this.executeQuery(l,\"execute\").then((r=>{if(this._checkCancelled(i),!r.hasOwnProperty(\"features\"))return m(new Error(\"Unnexected Result querying aggregates from layer\"));const l=[];if(t.pagesDefinition.internal.lastPage!==n)return[];for(let e=0;e<r.features.length;e++)t.pagesDefinition.internal.set[a+e]=r.features[e].attributes[t.pagesDefinition.generatedOid];for(let t=0;t<r.features.length;t++)l.push(new e({attributes:r.features[t].attributes,geometry:null}));return!0===t.pagesDefinition.useOIDpagination?0===r.features.length?t.pagesDefinition.internal.fullyResolved=!0:t.pagesDefinition.internal.lastMaxId=r.features[r.features.length-1].attributes[t.pagesDefinition.generatedOid]:(void 0===r.exceededTransferLimit&&r.features.length!==t.pagesDefinition.resultRecordCount||!1===r.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=s+r.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,l}))}catch(s){return m(s)}}static create(e,t,r,i,s){const a=new S({url:e,outFields:null===t?[\"*\"]:t});return new q({layer:a,spatialReference:r,lrucache:i,interceptor:s})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return u(this._layer.parsedUrl.path)}queryAttachments(e,t,i,s){if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){const a={objectIds:[e]};return(t&&t>0||i&&i>0)&&(a.size=[t&&t>0?t:0,i&&i>0?i:t+1]),s&&s.length>0&&(a.attachmentTypes=s),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:a,method:\"attachments\"}),this._layer.queryAttachments(a).then((t=>{const i=[];return t&&t[e]&&t[e].forEach((t=>{const s=this._layer.parsedUrl.path+\"/\"+e.toString()+\"/attachments/\"+t.id.toString();i.push(new r(t.id,t.name,t.contentType,t.size,s))})),i}))}return g([])}queryRelatedFeatures(r){const i={f:\"json\",relationshipId:r.relationshipId.toString(),definitionExpression:r.where,outFields:r.outFields.join(\",\"),returnGeometry:r.returnGeometry.toString()};return void 0!==r.resultOffset&&null!==r.resultOffset&&(i.resultOffset=r.resultOffset.toString()),void 0!==r.resultRecordCount&&null!==r.resultRecordCount&&(i.resultRecordCount=r.resultRecordCount.toString()),r.orderByFields&&(i.orderByFields=r.orderByFields.join(\",\")),r.objectIds.length>0&&(i.objectIds=r.objectIds.join(\",\")),r.outSpatialReference&&(i.outSR=JSON.stringify(r.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:i,method:\"relatedrecords\",url:this._layer.parsedUrl.path+\"/queryRelatedRecords\"}),t(this._layer.parsedUrl.path+\"/queryRelatedRecords\",{responseType:\"json\",query:i}).then((t=>{if(t.data){const r={},i=t.data;if(i&&i.relatedRecordGroups){const t=i.spatialReference;for(const s of i.relatedRecordGroups){const a=s.objectId,n=[];for(const r of s.relatedRecords){r.geometry&&(r.geometry.spatialReference=t);const i=new e({geometry:r.geometry?b(r.geometry):null,attributes:r.attributes});n.push(i)}r[a]={features:n,exceededTransferLimit:!0===i.exceededTransferLimit}}}return r}return m(\"Invalid Request\")}))}getFeatureByObjectId(e,t){const r=new I({url:this._layer.parsedUrl.path}),i=new D;return i.outFields=t,i.returnGeometry=!1,i.outSpatialReference=this.spatialReference,i.where=this.objectIdField+\"=\"+e.toString(),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:i,method:\"execute\"}),r.execute(i).then((e=>1===e.features.length?e.features[0]:null))}getIdentityUser(){return this.load().then((()=>{var e;const t=null==(e=f)?void 0:e.findCredential(this._layer.url);return t?t.userId:null}))}getOwningSystemUrl(){return this.load().then((()=>{var e;const r=null==(e=f)?void 0:e.findServerInfo(this._layer.url);if(r)return g(r.owningSystemUrl);let i=this._layer.url;const s=i.toLowerCase().indexOf(\"/rest/services\");return i=s>-1?i.substring(0,s):i,i?(i+=\"/rest/info\",_(((e,r)=>{t(i,{query:{f:\"json\"}}).then((t=>{let r=\"\";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(t=>{e(\"\")}))}))):g(\"\")}))}}export default q;\n"]},"metadata":{},"sourceType":"module"}