{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { glsl as v } from \"../../shaderModules/interfaces.js\";\n\nfunction e(e, o) {\n  o.vvInstancingEnabled && (o.vvSize || o.vvColor) && e.attributes.add(\"instanceFeatureAttribute\", \"vec4\"), o.vvSize ? (e.vertex.uniforms.add(\"vvSizeMinSize\", \"vec3\"), e.vertex.uniforms.add(\"vvSizeMaxSize\", \"vec3\"), e.vertex.uniforms.add(\"vvSizeOffset\", \"vec3\"), e.vertex.uniforms.add(\"vvSizeFactor\", \"vec3\"), e.vertex.uniforms.add(\"vvSymbolRotationMatrix\", \"mat3\"), e.vertex.uniforms.add(\"vvSymbolAnchor\", \"vec3\"), e.vertex.code.add(v`vec3 vvScale(vec4 _featureAttribute) {\nreturn clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n}\nvec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\nreturn vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n}`), e.vertex.code.add(v`\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ${o.vvInstancingEnabled ? v`\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }` : \"\"}\n    `)) : e.vertex.code.add(v`vec4 localPosition() { return vec4(position, 1.0); }\nvec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`), o.vvColor ? (e.vertex.constants.add(\"vvColorNumber\", \"int\", 8), e.vertex.code.add(v`\n      uniform float vvColorValues[vvColorNumber];\n      uniform vec4 vvColorColors[vvColorNumber];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < vvColorNumber; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[vvColorNumber - 1];\n      }\n\n      ${o.vvInstancingEnabled ? v`\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }` : \"\"}\n    `)) : e.vertex.code.add(v`vec4 vvColor() { return vec4(1.0); }`);\n}\n\nfunction o(v, e) {\n  e.vvSizeEnabled && (v.setUniform3fv(\"vvSizeMinSize\", e.vvSizeMinSize), v.setUniform3fv(\"vvSizeMaxSize\", e.vvSizeMaxSize), v.setUniform3fv(\"vvSizeOffset\", e.vvSizeOffset), v.setUniform3fv(\"vvSizeFactor\", e.vvSizeFactor)), e.vvColorEnabled && (v.setUniform1fv(\"vvColorValues\", e.vvColorValues), v.setUniform4fv(\"vvColorColors\", e.vvColorColors));\n}\n\nfunction r(v, e) {\n  o(v, e), e.vvOpacityEnabled && (v.setUniform1fv(\"vvOpacityValues\", e.vvOpacityValues), v.setUniform1fv(\"vvOpacityOpacities\", e.vvOpacityOpacities));\n}\n\nfunction t(v, e) {\n  o(v, e), e.vvSizeEnabled && (v.setUniform3fv(\"vvSymbolAnchor\", e.vvSymbolAnchor), v.setUniformMatrix3fv(\"vvSymbolRotationMatrix\", e.vvSymbolRotationMatrix));\n}\n\nexport { e as VisualVariables, o as bindVisualVariablesUniforms, t as bindVisualVariablesUniformsForSymbols, r as bindVisualVariablesUniformsWithOpacity };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl.js"],"names":["glsl","v","e","o","vvInstancingEnabled","vvSize","vvColor","attributes","add","vertex","uniforms","code","constants","vvSizeEnabled","setUniform3fv","vvSizeMinSize","vvSizeMaxSize","vvSizeOffset","vvSizeFactor","vvColorEnabled","setUniform1fv","vvColorValues","setUniform4fv","vvColorColors","r","vvOpacityEnabled","vvOpacityValues","vvOpacityOpacities","t","vvSymbolAnchor","setUniformMatrix3fv","vvSymbolRotationMatrix","VisualVariables","bindVisualVariablesUniforms","bindVisualVariablesUniformsForSymbols","bindVisualVariablesUniformsWithOpacity"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{glsl as v}from\"../../shaderModules/interfaces.js\";function e(e,o){o.vvInstancingEnabled&&(o.vvSize||o.vvColor)&&e.attributes.add(\"instanceFeatureAttribute\",\"vec4\"),o.vvSize?(e.vertex.uniforms.add(\"vvSizeMinSize\",\"vec3\"),e.vertex.uniforms.add(\"vvSizeMaxSize\",\"vec3\"),e.vertex.uniforms.add(\"vvSizeOffset\",\"vec3\"),e.vertex.uniforms.add(\"vvSizeFactor\",\"vec3\"),e.vertex.uniforms.add(\"vvSymbolRotationMatrix\",\"mat3\"),e.vertex.uniforms.add(\"vvSymbolAnchor\",\"vec3\"),e.vertex.code.add(v`vec3 vvScale(vec4 _featureAttribute) {\nreturn clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n}\nvec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\nreturn vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n}`),e.vertex.code.add(v`\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ${o.vvInstancingEnabled?v`\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }`:\"\"}\n    `)):e.vertex.code.add(v`vec4 localPosition() { return vec4(position, 1.0); }\nvec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),o.vvColor?(e.vertex.constants.add(\"vvColorNumber\",\"int\",8),e.vertex.code.add(v`\n      uniform float vvColorValues[vvColorNumber];\n      uniform vec4 vvColorColors[vvColorNumber];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < vvColorNumber; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[vvColorNumber - 1];\n      }\n\n      ${o.vvInstancingEnabled?v`\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }`:\"\"}\n    `)):e.vertex.code.add(v`vec4 vvColor() { return vec4(1.0); }`)}function o(v,e){e.vvSizeEnabled&&(v.setUniform3fv(\"vvSizeMinSize\",e.vvSizeMinSize),v.setUniform3fv(\"vvSizeMaxSize\",e.vvSizeMaxSize),v.setUniform3fv(\"vvSizeOffset\",e.vvSizeOffset),v.setUniform3fv(\"vvSizeFactor\",e.vvSizeFactor)),e.vvColorEnabled&&(v.setUniform1fv(\"vvColorValues\",e.vvColorValues),v.setUniform4fv(\"vvColorColors\",e.vvColorColors))}function r(v,e){o(v,e),e.vvOpacityEnabled&&(v.setUniform1fv(\"vvOpacityValues\",e.vvOpacityValues),v.setUniform1fv(\"vvOpacityOpacities\",e.vvOpacityOpacities))}function t(v,e){o(v,e),e.vvSizeEnabled&&(v.setUniform3fv(\"vvSymbolAnchor\",e.vvSymbolAnchor),v.setUniformMatrix3fv(\"vvSymbolRotationMatrix\",e.vvSymbolRotationMatrix))}export{e as VisualVariables,o as bindVisualVariablesUniforms,t as bindVisualVariablesUniformsForSymbols,r as bindVisualVariablesUniformsWithOpacity};\n"]},"metadata":{},"sourceType":"module"}