{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { a as t } from \"../../chunks/vec2f64.js\";\nimport { p as e, n as i, g as s } from \"../../chunks/vec3.js\";\nimport { c as a } from \"../../chunks/vec3f64.js\";\nimport { rotationAngleAndAxisDirectRotation as h, rotationAnglesAndAxesHeadingPreserving as n } from \"../3d/state/utils/navigationUtils.js\";\nimport { FilteredFiniteDifference as l } from \"./FilteredFiniteDifference.js\";\nimport { FilteredValue as r } from \"./FilteredValue.js\";\nimport { Momentum as m } from \"./Momentum.js\";\nconst u = 1e-5;\n\nclass c extends m {\n  constructor(t, e, i, s, a, h = 0, n) {\n    super(t, e, i), this.angularVelocity1 = s, this.axis1 = a, this.angularVelocity2 = h, this.axis2 = n;\n  }\n\n  value1(t) {\n    return super.valueFromInitialVelocity(this.angularVelocity1, t);\n  }\n\n  value2(t) {\n    return super.valueFromInitialVelocity(this.angularVelocity2, t);\n  }\n\n}\n\nclass o {\n  constructor(e = 300, i = 12, s = .84) {\n    this.minimumInitialVelocity = e, this.stopVelocity = i, this.friction = s, this.enabled = !0, this.tmpAxis1 = a(), this.tmpAxis2 = a(), this.tmpAngles = t(), this.time = new l(.3), this.screen = [new l(.4), new l(.4)], this.angle1 = new r(.6), this.angle2 = new r(.6), this.axis1 = a(), this.axis2 = a(), this.lastScene = a();\n  }\n\n  addMomentumDirectRotation(t, a, n, l, r, m) {\n    if (this.enabled) {\n      if (this.time.hasLastValue) {\n        if (this.time.computeDelta(n) < .01) return;\n        let t = h(this.lastScene, a, this.tmpAxis2, l, r, m);\n        this.angle2.update(0), e(this.tmpAxis2) < u ? t = 0 : i(this.axis1, this.tmpAxis2), this.angle1.update(t), s(this.lastScene, a);\n      }\n\n      this.screen[0].update(t[0]), this.screen[1].update(t[1]), this.time.update(n);\n    }\n  }\n\n  addMomentumPreserveHeading(t, a, h, l, r, m, c) {\n    if (this.enabled) {\n      if (this.time.hasLastValue) {\n        if (this.time.computeDelta(h) < .01) return;\n        n(this.lastScene, a, this.tmpAxis2, this.tmpAxis1, this.tmpAngles, l, r, m, c, !1), e(this.tmpAxis2) < u ? (this.angle1.update(0), this.angle2.update(0)) : (this.angle1.update(this.tmpAngles[1]), this.angle2.update(this.tmpAngles[0]), i(this.axis1, this.tmpAxis1), i(this.axis2, this.tmpAxis2)), s(this.lastScene, a);\n      }\n\n      this.screen[0].update(t[0]), this.screen[1].update(t[1]), this.time.update(h);\n    }\n  }\n\n  reset() {\n    this.screen[0].reset(), this.screen[1].reset(), this.angle1.reset(), this.angle2.reset(), this.time.reset();\n  }\n\n  evaluateMomentum() {\n    if (!this.enabled || !this.screen[0].hasFilteredDelta) return null;\n    const t = this.screen[0].filteredDelta,\n          e = this.screen[1].filteredDelta,\n          i = Math.sqrt(t * t + e * e) / this.time.filteredDelta;\n    return Math.abs(i) < this.minimumInitialVelocity ? null : this.createMomentum(i, this.stopVelocity, this.friction);\n  }\n\n  createMomentum(t, e, i) {\n    const s = this.angle1.filteredValue / this.time.filteredDelta,\n          a = this.angle2.filteredValue / this.time.filteredDelta;\n    return new c(t, e, i, s, this.axis1, a, this.axis2);\n  }\n\n}\n\nexport { c as PanSphericalMomentum, o as PanSphericalMomentumEstimator };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/views/navigation/PanSphericalMomentumEstimator.js"],"names":["a","t","p","e","n","i","g","s","c","rotationAngleAndAxisDirectRotation","h","rotationAnglesAndAxesHeadingPreserving","FilteredFiniteDifference","l","FilteredValue","r","Momentum","m","u","constructor","angularVelocity1","axis1","angularVelocity2","axis2","value1","valueFromInitialVelocity","value2","o","minimumInitialVelocity","stopVelocity","friction","enabled","tmpAxis1","tmpAxis2","tmpAngles","time","screen","angle1","angle2","lastScene","addMomentumDirectRotation","hasLastValue","computeDelta","update","addMomentumPreserveHeading","reset","evaluateMomentum","hasFilteredDelta","filteredDelta","Math","sqrt","abs","createMomentum","filteredValue","PanSphericalMomentum","PanSphericalMomentumEstimator"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{a as t}from\"../../chunks/vec2f64.js\";import{p as e,n as i,g as s}from\"../../chunks/vec3.js\";import{c as a}from\"../../chunks/vec3f64.js\";import{rotationAngleAndAxisDirectRotation as h,rotationAnglesAndAxesHeadingPreserving as n}from\"../3d/state/utils/navigationUtils.js\";import{FilteredFiniteDifference as l}from\"./FilteredFiniteDifference.js\";import{FilteredValue as r}from\"./FilteredValue.js\";import{Momentum as m}from\"./Momentum.js\";const u=1e-5;class c extends m{constructor(t,e,i,s,a,h=0,n){super(t,e,i),this.angularVelocity1=s,this.axis1=a,this.angularVelocity2=h,this.axis2=n}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class o{constructor(e=300,i=12,s=.84){this.minimumInitialVelocity=e,this.stopVelocity=i,this.friction=s,this.enabled=!0,this.tmpAxis1=a(),this.tmpAxis2=a(),this.tmpAngles=t(),this.time=new l(.3),this.screen=[new l(.4),new l(.4)],this.angle1=new r(.6),this.angle2=new r(.6),this.axis1=a(),this.axis2=a(),this.lastScene=a()}addMomentumDirectRotation(t,a,n,l,r,m){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(n)<.01)return;let t=h(this.lastScene,a,this.tmpAxis2,l,r,m);this.angle2.update(0),e(this.tmpAxis2)<u?t=0:i(this.axis1,this.tmpAxis2),this.angle1.update(t),s(this.lastScene,a)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(n)}}addMomentumPreserveHeading(t,a,h,l,r,m,c){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(h)<.01)return;n(this.lastScene,a,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,l,r,m,c,!1),e(this.tmpAxis2)<u?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),i(this.axis1,this.tmpAxis1),i(this.axis2,this.tmpAxis2)),s(this.lastScene,a)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(h)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,e=this.screen[1].filteredDelta,i=Math.sqrt(t*t+e*e)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,e,i){const s=this.angle1.filteredValue/this.time.filteredDelta,a=this.angle2.filteredValue/this.time.filteredDelta;return new c(t,e,i,s,this.axis1,a,this.axis2)}}export{c as PanSphericalMomentum,o as PanSphericalMomentumEstimator};\n"]},"metadata":{},"sourceType":"module"}