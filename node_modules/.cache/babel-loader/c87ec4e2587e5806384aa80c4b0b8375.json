{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { assumeNonNull as e } from \"./maybe.js\";\nimport t from \"./nextTick.js\";\nimport r from \"./PerformanceSampler.js\";\nimport s from \"./PooledArray.js\";\nimport { createResolver as o, isAborted as n, createAbortError as a } from \"./promiseUtils.js\";\nimport { Milliseconds as i } from \"./time.js\";\n\nclass c {\n  constructor(e) {\n    this.phases = e, this.paused = !1, this.ticks = -1, this.removed = !1;\n  }\n\n}\n\nclass m {\n  constructor(e) {\n    this.callback = e, this.isActive = !0;\n  }\n\n  remove() {\n    this.isActive = !1;\n  }\n\n}\n\nlet l = 0,\n    p = 0;\nconst u = {\n  time: i(0),\n  deltaTime: i(0),\n  elapsedFrameTime: i(0),\n  frameDuration: i(0)\n},\n      f = [\"prepare\", \"preRender\", \"render\", \"postRender\", \"update\"],\n      h = [],\n      d = new s();\n\nclass w {\n  constructor(e) {\n    this._task = e;\n  }\n\n  remove() {\n    this._task.removed = !0;\n  }\n\n  pause() {\n    this._task.paused = !0;\n  }\n\n  resume() {\n    this._task.paused = !1;\n  }\n\n}\n\nconst k = {\n  frameTasks: d,\n  willDispatch: !1,\n  clearFrameTasks: j,\n  dispatch: b,\n  executeFrameTasks: D\n};\n\nfunction v(e) {\n  const r = new m(e);\n  return h.push(r), k.willDispatch || (k.willDispatch = !0, t(b)), r;\n}\n\nfunction A(e) {\n  const t = new c(e);\n  return d.push(t), null == T && (l = performance.now(), T = requestAnimationFrame(x)), new w(t);\n}\n\nlet T = null;\n\nfunction j(e = !1) {\n  d.forAll(e => {\n    e.removed = !0;\n  }), e && _();\n}\n\nfunction F(e) {\n  p = Math.max(0, e);\n}\n\nfunction x() {\n  const e = performance.now();\n  T = null, T = d.length > 0 ? requestAnimationFrame(x) : null, k.executeFrameTasks(e);\n}\n\nfunction D(e) {\n  const t = i(e - l);\n  l = e;\n  const r = p > 0 ? p : 1e3 / 60,\n        s = Math.max(0, t - r);\n\n  for (let o = 0; o < f.length; o++) {\n    const n = performance.now(),\n          a = f[o];\n    d.forAll(n => {\n      var c;\n      if (n.paused || n.removed) return;\n      0 === o && n.ticks++;\n      n.phases[a] && (u.time = e, u.deltaTime = 0 === n.ticks ? i(0) : t, u.elapsedFrameTime = i(performance.now() - e), u.frameDuration = i(r - s), null == (c = n.phases[a]) || c.call(n, u));\n    }), M[o].record(performance.now() - n);\n  }\n\n  _(), q.record(performance.now() - e);\n}\n\nconst g = new s();\n\nfunction _() {\n  d.forAll(e => {\n    e.removed && g.push(e);\n  }), d.removeUnorderedMany(g.data, g.length), g.clear();\n}\n\nfunction b() {\n  for (; h.length;) {\n    const t = e(h.shift());\n    t.isActive && t.callback();\n  }\n\n  k.willDispatch = !1;\n}\n\nfunction y(e = 1, r) {\n  const s = o(),\n        i = () => {\n    n(r) ? s.reject(a()) : 0 === e ? s() : (--e, t(() => i()));\n  };\n\n  return i(), s.promise;\n}\n\nconst M = f.map(e => new r(e)),\n      q = new r(\"total\");\nexport { w as FrameTaskHandle, A as addFrameTask, k as debug, M as performanceInfo, q as performanceTotal, v as schedule, F as setFrameDuration, y as waitTicks };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/core/scheduling.js"],"names":["assumeNonNull","e","t","r","s","createResolver","o","isAborted","n","createAbortError","a","Milliseconds","i","c","constructor","phases","paused","ticks","removed","m","callback","isActive","remove","l","p","u","time","deltaTime","elapsedFrameTime","frameDuration","f","h","d","w","_task","pause","resume","k","frameTasks","willDispatch","clearFrameTasks","j","dispatch","b","executeFrameTasks","D","v","push","A","T","performance","now","requestAnimationFrame","x","forAll","_","F","Math","max","length","call","M","record","q","g","removeUnorderedMany","data","clear","shift","y","reject","promise","map","FrameTaskHandle","addFrameTask","debug","performanceInfo","performanceTotal","schedule","setFrameDuration","waitTicks"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{assumeNonNull as e}from\"./maybe.js\";import t from\"./nextTick.js\";import r from\"./PerformanceSampler.js\";import s from\"./PooledArray.js\";import{createResolver as o,isAborted as n,createAbortError as a}from\"./promiseUtils.js\";import{Milliseconds as i}from\"./time.js\";class c{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class m{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let l=0,p=0;const u={time:i(0),deltaTime:i(0),elapsedFrameTime:i(0),frameDuration:i(0)},f=[\"prepare\",\"preRender\",\"render\",\"postRender\",\"update\"],h=[],d=new s;class w{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const k={frameTasks:d,willDispatch:!1,clearFrameTasks:j,dispatch:b,executeFrameTasks:D};function v(e){const r=new m(e);return h.push(r),k.willDispatch||(k.willDispatch=!0,t(b)),r}function A(e){const t=new c(e);return d.push(t),null==T&&(l=performance.now(),T=requestAnimationFrame(x)),new w(t)}let T=null;function j(e=!1){d.forAll((e=>{e.removed=!0})),e&&_()}function F(e){p=Math.max(0,e)}function x(){const e=performance.now();T=null,T=d.length>0?requestAnimationFrame(x):null,k.executeFrameTasks(e)}function D(e){const t=i(e-l);l=e;const r=p>0?p:1e3/60,s=Math.max(0,t-r);for(let o=0;o<f.length;o++){const n=performance.now(),a=f[o];d.forAll((n=>{var c;if(n.paused||n.removed)return;0===o&&n.ticks++;n.phases[a]&&(u.time=e,u.deltaTime=0===n.ticks?i(0):t,u.elapsedFrameTime=i(performance.now()-e),u.frameDuration=i(r-s),null==(c=n.phases[a])||c.call(n,u))})),M[o].record(performance.now()-n)}_(),q.record(performance.now()-e)}const g=new s;function _(){d.forAll((e=>{e.removed&&g.push(e)})),d.removeUnorderedMany(g.data,g.length),g.clear()}function b(){for(;h.length;){const t=e(h.shift());t.isActive&&t.callback()}k.willDispatch=!1}function y(e=1,r){const s=o(),i=()=>{n(r)?s.reject(a()):0===e?s():(--e,t((()=>i())))};return i(),s.promise}const M=f.map((e=>new r(e))),q=new r(\"total\");export{w as FrameTaskHandle,A as addFrameTask,k as debug,M as performanceInfo,q as performanceTotal,v as schedule,F as setFrameDuration,y as waitTicks};\n"]},"metadata":{},"sourceType":"module"}