{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../Graphic.js\";\nimport t from \"../support/FeatureSet.js\";\nimport r from \"../support/IdSet.js\";\nimport { defaultMaxRecords as s, FeatureServiceDatabaseType as i, IdState as a } from \"../support/shared.js\";\nimport { toWhereClause as l } from \"../support/sqlUtils.js\";\nimport { create as n, resolve as o, reject as u } from \"../../../core/promiseUtils.js\";\nimport h from \"../../../geometry/Geometry.js\";\nimport c from \"../../../layers/FeatureLayer.js\";\nimport d from \"../../../layers/support/FeatureType.js\";\nimport f from \"../../../layers/support/Field.js\";\nimport p from \"../../../rest/support/Query.js\";\n\nclass y extends t {\n  constructor(e) {\n    super(e), this.declaredClass = \"esri.arcade.featureset.sources.FeatureLayerMemory\", this._removeGeometry = !1, this._overrideFields = null, this._forceIsTable = !1, e.spatialReference && (this.spatialReference = e.spatialReference), this._transparent = !0, this._maxProcessing = 1e3, this._layer = e.layer, this._wset = null, !0 === e.isTable && (this._forceIsTable = !0), void 0 !== e.outFields && (this._overrideFields = e.outFields), void 0 !== e.includeGeometry && (this._removeGeometry = !1 === e.includeGeometry);\n  }\n\n  _maxQueryRate() {\n    return s;\n  }\n\n  end() {\n    return this._layer;\n  }\n\n  optimisePagingFeatureQueries() {}\n\n  load() {\n    return null === this._loadPromise && (this._loadPromise = n((e, t) => {\n      if (!0 === this._layer.loaded) return this._initialiseFeatureSet(), void e(this);\n      this._layer.when().then(() => {\n        try {\n          this._initialiseFeatureSet(), e(this);\n        } catch (r) {\n          t(r);\n        }\n      }, t), this._layer.load();\n    })), this._loadPromise;\n  }\n\n  get gdbVersion() {\n    return \"\";\n  }\n\n  _initialiseFeatureSet() {\n    if (null == this.spatialReference && (this.spatialReference = this._layer.spatialReference), this.geometryType = this._layer.geometryType, this.fields = this._layer.fields.slice(0), this._layer.outFields) {\n      if (1 === this._layer.outFields.length && \"*\" === this._layer.outFields[0]) ;else {\n        const e = [];\n\n        for (const t of this.fields) if (\"oid\" === t.type) e.push(t);else for (const r of this._layer.outFields) if (r.toLowerCase() === t.name.toLowerCase()) {\n          e.push(t);\n          break;\n        }\n\n        this.fields = e;\n      }\n    } else ;\n    if (null !== this._overrideFields) if (1 === this._overrideFields.length && \"*\" === this._overrideFields[0]) this._overrideFields = null;else {\n      const e = [],\n            t = [];\n\n      for (const r of this.fields) if (\"oid\" === r.type) e.push(r), t.push(r.name);else for (const s of this._overrideFields) if (s.toLowerCase() === r.name.toLowerCase()) {\n        e.push(r), t.push(r.name);\n        break;\n      }\n\n      this.fields = e, this._overrideFields = t;\n    }\n    this.objectIdField = this._layer.objectIdField;\n\n    for (const e of this.fields) \"global-id\" === e.type && (this.globalIdField = e.name);\n\n    this.hasM = this._layer.supportsM, this.hasZ = this._layer.supportsZ, this._databaseType = i.Standardised, this.typeIdField = this._layer.typeIdField, this.types = this._layer.types;\n  }\n\n  isTable() {\n    return this._forceIsTable || this._layer.isTable || \"table\" === this._layer.type || !this._layer.geometryType;\n  }\n\n  _isInFeatureSet() {\n    return a.InFeatureSet;\n  }\n\n  _candidateIdTransform(e) {\n    return e;\n  }\n\n  _getSet(e) {\n    return null === this._wset ? this._ensureLoaded().then(() => this._getFilteredSet(\"\", null, null, null, e)).then(e => (this._wset = e, e)) : o(this._wset);\n  }\n\n  _changeFeature(t) {\n    const r = {};\n\n    for (const e of this.fields) r[e.name] = t.attributes[e.name];\n\n    return new e({\n      geometry: !0 === this._removeGeometry ? null : t.geometry,\n      attributes: r\n    });\n  }\n\n  _getFilteredSet(e, t, s, a, n) {\n    let u = \"\",\n        h = !1;\n\n    if (null !== a && (u = a.constructClause(), h = !0), this.isTable() && t && null !== e && \"\" !== e) {\n      const e = new r([], [], !0, null);\n      return o(e);\n    }\n\n    const c = new p();\n    return c.where = null === s ? null === t ? \"1=1\" : \"\" : l(s, i.Standardised), c.spatialRelationship = this._makeRelationshipEnum(e), c.outSpatialReference = this.spatialReference, c.orderByFields = \"\" !== u ? u.split(\",\") : null, c.geometry = null === t ? null : t, c.returnGeometry = !0, c.relationParameter = this._makeRelationshipParam(e), this._layer.queryFeatures(c).then(e => {\n      if (null === e) return new r([], [], h, null);\n\n      this._checkCancelled(n);\n\n      const t = [];\n      e.features.forEach(e => {\n        const r = e.attributes[this._layer.objectIdField];\n        t.push(r), this._featureCache[r] = this._changeFeature(e);\n      });\n      return new r([], t, h, null);\n    });\n  }\n\n  _makeRelationshipEnum(e) {\n    if (e.indexOf(\"esriSpatialRelRelation\") >= 0) return \"relation\";\n\n    switch (e) {\n      case \"esriSpatialRelRelation\":\n        return \"relation\";\n\n      case \"esriSpatialRelIntersects\":\n        return \"intersects\";\n\n      case \"esriSpatialRelContains\":\n        return \"contains\";\n\n      case \"esriSpatialRelOverlaps\":\n        return \"overlaps\";\n\n      case \"esriSpatialRelWithin\":\n        return \"within\";\n\n      case \"esriSpatialRelTouches\":\n        return \"touches\";\n\n      case \"esriSpatialRelCrosses\":\n        return \"crosses\";\n\n      case \"esriSpatialRelEnvelopeIntersects\":\n        return \"envelope-intersects\";\n    }\n\n    return e;\n  }\n\n  _makeRelationshipParam(e) {\n    return e.indexOf(\"esriSpatialRelRelation\") >= 0 ? e.split(\":\")[1] : \"\";\n  }\n\n  _queryAllFeatures() {\n    if (this._wset) return o(this._wset);\n    const e = new p();\n    return e.where = \"1=1\", this._ensureLoaded().then(() => {\n      if (this._layer.source && this._layer.source.items) {\n        const e = [];\n        return this._layer.source.items.forEach(t => {\n          const r = t.attributes[this._layer.objectIdField];\n          e.push(r), this._featureCache[r] = this._changeFeature(t);\n        }), this._wset = new r([], e, !1, null), this._wset;\n      }\n\n      return this._layer.queryFeatures(e).then(e => {\n        const t = [];\n        return e.features.forEach(e => {\n          const r = e.attributes[this._layer.objectIdField];\n          t.push(r), this._featureCache[r] = this._changeFeature(e);\n        }), this._wset = new r([], t, !1, null), this._wset;\n      });\n    });\n  }\n\n  _getFeatures(e, t, r) {\n    const s = [];\n    -1 !== t && void 0 === this._featureCache[t] && s.push(t);\n\n    for (let i = e._lastFetchedIndex; i < e._known.length && (e._lastFetchedIndex += 1, !(void 0 === this._featureCache[e._known[i]] && (e._known[i] !== t && s.push(e._known[i]), s.length > r))); i++);\n\n    return 0 === s.length ? o(\"success\") : u(new Error(\"Unaccounted for Features. Not in Feature Collection\"));\n  }\n\n  _refineSetBlock(e) {\n    return o(e);\n  }\n\n  _stat() {\n    return o({\n      calculated: !1\n    });\n  }\n\n  _canDoAggregates() {\n    return o(!1);\n  }\n\n  relationshipMetaData() {\n    return [];\n  }\n\n  static _cloneAttr(e) {\n    const t = {};\n\n    for (const r in e) t[r] = e[r];\n\n    return t;\n  }\n\n  nativeCapabilities() {\n    return {\n      title: this._layer.title,\n      canQueryRelated: !1,\n      source: this,\n      capabilities: this._layer.capabilities,\n      databaseType: this._databaseType,\n      requestStandardised: !0\n    };\n  }\n\n  static create(e, t) {\n    let r = e.layerDefinition.objectIdField;\n    const s = e.layerDefinition.typeIdField ? e.layerDefinition.typeIdField : \"\",\n          i = [];\n    if (e.layerDefinition.types) for (const h of e.layerDefinition.types) i.push(d.fromJSON(h));\n    let a = e.layerDefinition.geometryType;\n    void 0 === a && (a = e.featureSet.geometryType || \"\");\n    let l = e.featureSet.features;\n    const n = t.toJSON();\n\n    if (\"\" === r || void 0 === r) {\n      let t = !1;\n\n      for (const s of e.layerDefinition.fields) if (\"oid\" === s.type || \"esriFieldTypeOID\" === s.type) {\n        r = s.name, t = !0;\n        break;\n      }\n\n      if (!1 === t) {\n        let t = \"FID\",\n            s = !0,\n            i = 0;\n\n        for (; s;) {\n          let r = !0;\n\n          for (const s of e.layerDefinition.fields) if (s.name === t) {\n            r = !1;\n            break;\n          }\n\n          !0 === r ? s = !1 : (i++, t = \"FID\" + i.toString());\n        }\n\n        e.layerDefinition.fields.push({\n          type: \"esriFieldTypeOID\",\n          name: t,\n          alias: t\n        });\n        const a = [];\n\n        for (let r = 0; r < l.length; r++) a.push({\n          geometry: e.featureSet.features[r].geometry,\n          attributes: e.featureSet.features[r].attributes ? this._cloneAttr(e.featureSet.features[r].attributes) : {}\n        }), a[r].attributes[t] = r;\n\n        l = a, r = t;\n      }\n    }\n\n    const o = [];\n\n    for (const h of e.layerDefinition.fields) h instanceof f ? o.push(h) : o.push(f.fromJSON(h));\n\n    let u = a;\n\n    switch (u) {\n      case \"esriGeometryPoint\":\n        u = \"point\";\n        break;\n\n      case \"esriGeometryPolyline\":\n        u = \"polyline\";\n        break;\n\n      case \"esriGeometryPolygon\":\n        u = \"polygon\";\n        break;\n\n      case \"esriGeometryExtent\":\n        u = \"extent\";\n        break;\n\n      case \"esriGeometryMultipoint\":\n        u = \"multipoint\";\n    }\n\n    for (const c of l) c.geometry && c.geometry instanceof h == !1 && (c.geometry.type = u, void 0 === c.geometry.spatialReference && (c.geometry.spatialReference = n));\n\n    const p = {\n      outFields: [\"*\"],\n      source: l,\n      fields: o,\n      types: i,\n      typeIdField: s,\n      objectIdField: r,\n      spatialReference: t\n    };\n    p.geometryType = u || \"point\";\n\n    const _ = new c(p);\n\n    return new y({\n      layer: _,\n      spatialReference: t,\n      isTable: null === u || \"\" === u\n    });\n  }\n\n  queryAttachments() {\n    return o([]);\n  }\n\n  getFeatureByObjectId(e) {\n    const t = new p();\n    return t.where = this.objectIdField + \"=\" + e.toString(), this._layer.queryFeatures(t).then(e => 1 === e.features.length ? e.features[0] : null);\n  }\n\n  getOwningSystemUrl() {\n    return o(\"\");\n  }\n\n  getIdentityUser() {\n    return o(\"\");\n  }\n\n}\n\nexport default y;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/arcade/featureset/sources/FeatureLayerMemory.js"],"names":["e","t","r","defaultMaxRecords","s","FeatureServiceDatabaseType","i","IdState","a","toWhereClause","l","create","n","resolve","o","reject","u","h","c","d","f","p","y","constructor","declaredClass","_removeGeometry","_overrideFields","_forceIsTable","spatialReference","_transparent","_maxProcessing","_layer","layer","_wset","isTable","outFields","includeGeometry","_maxQueryRate","end","optimisePagingFeatureQueries","load","_loadPromise","loaded","_initialiseFeatureSet","when","then","gdbVersion","geometryType","fields","slice","length","type","push","toLowerCase","name","objectIdField","globalIdField","hasM","supportsM","hasZ","supportsZ","_databaseType","Standardised","typeIdField","types","_isInFeatureSet","InFeatureSet","_candidateIdTransform","_getSet","_ensureLoaded","_getFilteredSet","_changeFeature","attributes","geometry","constructClause","where","spatialRelationship","_makeRelationshipEnum","outSpatialReference","orderByFields","split","returnGeometry","relationParameter","_makeRelationshipParam","queryFeatures","_checkCancelled","features","forEach","_featureCache","indexOf","_queryAllFeatures","source","items","_getFeatures","_lastFetchedIndex","_known","Error","_refineSetBlock","_stat","calculated","_canDoAggregates","relationshipMetaData","_cloneAttr","nativeCapabilities","title","canQueryRelated","capabilities","databaseType","requestStandardised","layerDefinition","fromJSON","featureSet","toJSON","toString","alias","_","queryAttachments","getFeatureByObjectId","getOwningSystemUrl","getIdentityUser"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../Graphic.js\";import t from\"../support/FeatureSet.js\";import r from\"../support/IdSet.js\";import{defaultMaxRecords as s,FeatureServiceDatabaseType as i,IdState as a}from\"../support/shared.js\";import{toWhereClause as l}from\"../support/sqlUtils.js\";import{create as n,resolve as o,reject as u}from\"../../../core/promiseUtils.js\";import h from\"../../../geometry/Geometry.js\";import c from\"../../../layers/FeatureLayer.js\";import d from\"../../../layers/support/FeatureType.js\";import f from\"../../../layers/support/Field.js\";import p from\"../../../rest/support/Query.js\";class y extends t{constructor(e){super(e),this.declaredClass=\"esri.arcade.featureset.sources.FeatureLayerMemory\",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,!0===e.isTable&&(this._forceIsTable=!0),void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return s}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=n(((e,t)=>{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(r){t(r)}}),t),this._layer.load()}))),this._loadPromise}get gdbVersion(){return\"\"}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&\"*\"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if(\"oid\"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}else;if(null!==this._overrideFields)if(1===this._overrideFields.length&&\"*\"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if(\"oid\"===r.type)e.push(r),t.push(r.name);else for(const s of this._overrideFields)if(s.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)\"global-id\"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=i.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}isTable(){return this._forceIsTable||this._layer.isTable||\"table\"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return a.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet(\"\",null,null,null,e))).then((e=>(this._wset=e,e))):o(this._wset)}_changeFeature(t){const r={};for(const e of this.fields)r[e.name]=t.attributes[e.name];return new e({geometry:!0===this._removeGeometry?null:t.geometry,attributes:r})}_getFilteredSet(e,t,s,a,n){let u=\"\",h=!1;if(null!==a&&(u=a.constructClause(),h=!0),this.isTable()&&t&&null!==e&&\"\"!==e){const e=new r([],[],!0,null);return o(e)}const c=new p;return c.where=null===s?null===t?\"1=1\":\"\":l(s,i.Standardised),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=\"\"!==u?u.split(\",\"):null,c.geometry=null===t?null:t,c.returnGeometry=!0,c.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(c).then((e=>{if(null===e)return new r([],[],h,null);this._checkCancelled(n);const t=[];e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)}));return new r([],t,h,null)}))}_makeRelationshipEnum(e){if(e.indexOf(\"esriSpatialRelRelation\")>=0)return\"relation\";switch(e){case\"esriSpatialRelRelation\":return\"relation\";case\"esriSpatialRelIntersects\":return\"intersects\";case\"esriSpatialRelContains\":return\"contains\";case\"esriSpatialRelOverlaps\":return\"overlaps\";case\"esriSpatialRelWithin\":return\"within\";case\"esriSpatialRelTouches\":return\"touches\";case\"esriSpatialRelCrosses\":return\"crosses\";case\"esriSpatialRelEnvelopeIntersects\":return\"envelope-intersects\"}return e}_makeRelationshipParam(e){return e.indexOf(\"esriSpatialRelRelation\")>=0?e.split(\":\")[1]:\"\"}_queryAllFeatures(){if(this._wset)return o(this._wset);const e=new p;return e.where=\"1=1\",this._ensureLoaded().then((()=>{if(this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach((t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)})),this._wset=new r([],e,!1,null),this._wset}return this._layer.queryFeatures(e).then((e=>{const t=[];return e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)})),this._wset=new r([],t,!1,null),this._wset}))}))}_getFeatures(e,t,r){const s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);for(let i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&s.push(e._known[i]),s.length>r)));i++);return 0===s.length?o(\"success\"):u(new Error(\"Unaccounted for Features. Not in Feature Collection\"))}_refineSetBlock(e){return o(e)}_stat(){return o({calculated:!1})}_canDoAggregates(){return o(!1)}relationshipMetaData(){return[]}static _cloneAttr(e){const t={};for(const r in e)t[r]=e[r];return t}nativeCapabilities(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(e,t){let r=e.layerDefinition.objectIdField;const s=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:\"\",i=[];if(e.layerDefinition.types)for(const h of e.layerDefinition.types)i.push(d.fromJSON(h));let a=e.layerDefinition.geometryType;void 0===a&&(a=e.featureSet.geometryType||\"\");let l=e.featureSet.features;const n=t.toJSON();if(\"\"===r||void 0===r){let t=!1;for(const s of e.layerDefinition.fields)if(\"oid\"===s.type||\"esriFieldTypeOID\"===s.type){r=s.name,t=!0;break}if(!1===t){let t=\"FID\",s=!0,i=0;for(;s;){let r=!0;for(const s of e.layerDefinition.fields)if(s.name===t){r=!1;break}!0===r?s=!1:(i++,t=\"FID\"+i.toString())}e.layerDefinition.fields.push({type:\"esriFieldTypeOID\",name:t,alias:t});const a=[];for(let r=0;r<l.length;r++)a.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),a[r].attributes[t]=r;l=a,r=t}}const o=[];for(const h of e.layerDefinition.fields)h instanceof f?o.push(h):o.push(f.fromJSON(h));let u=a;switch(u){case\"esriGeometryPoint\":u=\"point\";break;case\"esriGeometryPolyline\":u=\"polyline\";break;case\"esriGeometryPolygon\":u=\"polygon\";break;case\"esriGeometryExtent\":u=\"extent\";break;case\"esriGeometryMultipoint\":u=\"multipoint\"}for(const c of l)c.geometry&&c.geometry instanceof h==!1&&(c.geometry.type=u,void 0===c.geometry.spatialReference&&(c.geometry.spatialReference=n));const p={outFields:[\"*\"],source:l,fields:o,types:i,typeIdField:s,objectIdField:r,spatialReference:t};p.geometryType=u||\"point\";const _=new c(p);return new y({layer:_,spatialReference:t,isTable:null===u||\"\"===u})}queryAttachments(){return o([])}getFeatureByObjectId(e){const t=new p;return t.where=this.objectIdField+\"=\"+e.toString(),this._layer.queryFeatures(t).then((e=>1===e.features.length?e.features[0]:null))}getOwningSystemUrl(){return o(\"\")}getIdentityUser(){return o(\"\")}}export default y;\n"]},"metadata":{},"sourceType":"module"}