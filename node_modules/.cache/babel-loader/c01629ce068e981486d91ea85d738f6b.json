{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"./BaseBucket.js\";\nimport { LineTessellation as t } from \"../../webgl/TurboLine.js\";\nconst i = 65535;\n\nclass n extends e {\n  constructor(e, i, n, r, a) {\n    super(e, i, n), this.type = 2, this._tessellationOptions = {\n      pixelCoordRatio: 8,\n      halfWidth: 0,\n      offset: 0\n    }, this._patternMap = new Map(), this.tessellationProperties = {\n      _lineVertexBuffer: null,\n      _lineIndexBuffer: null,\n      _ddValues: null\n    }, this.tessellationProperties._lineVertexBuffer = r, this.tessellationProperties._lineIndexBuffer = a, this._lineTessellator = new t(s(this.tessellationProperties), l(this.tessellationProperties), e.canUseThinTessellation);\n  }\n\n  get lineIndexStart() {\n    return this._lineIndexStart;\n  }\n\n  get lineIndexCount() {\n    return this._lineIndexCount;\n  }\n\n  getResources(e, t, i) {\n    const n = this.layer,\n          s = this.zoom,\n          l = n.hasDataDrivenLine,\n          r = n.getPaintProperty(\"line-pattern\"),\n          a = n.getPaintProperty(\"line-dasharray\"),\n          o = n.getLayoutProperty(\"line-cap\");\n    if (!r && !a) return;\n    const u = (null == o ? void 0 : o.getValue(s)) || 0,\n          f = null == o ? void 0 : o.isDataDriven;\n\n    if (l) {\n      const e = null == r ? void 0 : r.isDataDriven,\n            i = null == a ? void 0 : a.isDataDriven;\n      if (!e && !i) return;\n\n      for (const l of this._features) e ? t.add(r.getValue(s, l)) : t.add({\n        name: this._getDashArrayKey(l, s, n, a, f, o, u)\n      });\n    } else if (r) t.add(r.getValue(s));else if (a) {\n      const e = a.getValue(s);\n      t.add({\n        name: n.getDashKey(e, u)\n      });\n    }\n  }\n\n  processFeatures(e) {\n    var t, i, n, s, l, r;\n    this._lineIndexStart = 3 * this.tessellationProperties._lineIndexBuffer.index, this._lineIndexCount = 0;\n    const a = this.layer,\n          o = this.zoom,\n          u = this._features,\n          f = this._tessellationOptions,\n          {\n      hasDataDrivenLine: h,\n      lineMaterial: p\n    } = a;\n    e && e.setExtent(this.layerExtent);\n    const d = a.getPaintProperty(\"line-pattern\"),\n          g = a.getPaintProperty(\"line-dasharray\"),\n          y = null == d ? void 0 : d.isDataDriven,\n          c = null == g ? void 0 : g.isDataDriven;\n\n    let _;\n\n    _ = a.getLayoutProperty(\"line-cap\");\n    const x = null != (t = _) && t.isDataDriven ? _ : null,\n          D = x ? null : a.getLayoutValue(\"line-cap\", o),\n          V = D || 0,\n          m = !!x;\n    _ = a.getLayoutProperty(\"line-join\");\n    const P = null != (i = _) && i.isDataDriven ? _ : null,\n          I = P ? null : a.getLayoutValue(\"line-join\", o);\n    _ = a.getLayoutProperty(\"line-miter-limit\");\n    const L = null != (n = _) && n.isDataDriven ? _ : null,\n          v = L ? null : a.getLayoutValue(\"line-miter-limit\", o);\n    _ = a.getLayoutProperty(\"line-round-limit\");\n    const B = null != (s = _) && s.isDataDriven ? _ : null,\n          T = B ? null : a.getLayoutValue(\"line-round-limit\", o);\n    _ = a.getPaintProperty(\"line-width\");\n    const j = null != (l = _) && l.isDataDriven ? _ : null,\n          A = j ? null : a.getPaintValue(\"line-width\", o);\n    _ = a.getPaintProperty(\"line-offset\");\n    const b = null != (r = _) && r.isDataDriven ? _ : null,\n          w = b ? null : a.getPaintValue(\"line-offset\", o);\n\n    if (y || c) {\n      const t = [];\n\n      for (const i of u) {\n        const n = y ? d.getValue(o, i) : this._getDashArrayKey(i, o, a, g, m, x, V),\n              s = this._spriteInfo[n];\n        if (!s || !s.rect) continue;\n        const l = p.encodeAttributes(i, o, a, s),\n              r = i.getGeometry(e);\n        t.push({\n          ddAttributes: l,\n          page: s.page,\n          cap: x ? x.getValue(o, i) : D,\n          join: P ? P.getValue(o, i) : I,\n          miterLimit: L ? L.getValue(o, i) : v,\n          roundLimit: B ? B.getValue(o, i) : T,\n          halfWidth: .5 * (j ? j.getValue(o, i) : A),\n          offset: b ? b.getValue(o, i) : w,\n          geometry: r\n        });\n      }\n\n      t.sort((e, t) => e.page - t.page), f.textured = !0;\n\n      for (const {\n        ddAttributes: e,\n        page: i,\n        cap: n,\n        join: s,\n        miterLimit: l,\n        roundLimit: r,\n        halfWidth: a,\n        offset: o,\n        geometry: u\n      } of t) f.capType = n, f.joinType = s, f.miterLimit = l, f.roundLimit = r, f.halfWidth = a, f.offset = o, this._processFeature(u, e, i);\n    } else {\n      f.textured = !(!d && !g), f.capType = D, f.joinType = I, f.miterLimit = v, f.roundLimit = T, f.halfWidth = .5 * A, f.offset = w;\n\n      for (const t of u) {\n        const i = h ? p.encodeAttributes(t, o, a) : null;\n        x && (f.capType = x.getValue(o, t)), P && (f.joinType = P.getValue(o, t)), L && (f.miterLimit = L.getValue(o, t)), B && (f.roundLimit = B.getValue(o, t)), j && (f.halfWidth = .5 * j.getValue(o, t)), b && (f.offset = b.getValue(o, t));\n        const n = t.getGeometry(e);\n\n        this._processFeature(n, i);\n      }\n    }\n  }\n\n  serialize() {\n    let e = 6;\n    e += this.layerUIDs.length, e += this.tessellationProperties._lineVertexBuffer.array.length, e += this.tessellationProperties._lineIndexBuffer.array.length, e += 3 * this._patternMap.size + 1;\n    const t = new Uint32Array(e),\n          i = new Int32Array(t.buffer);\n    let n = 0;\n    t[n++] = this.type, t[n++] = this.layerUIDs.length;\n\n    for (let r = 0; r < this.layerUIDs.length; r++) t[n++] = this.layerUIDs[r];\n\n    t[n++] = this._lineIndexStart, t[n++] = this._lineIndexCount;\n    const s = this._patternMap,\n          l = s.size;\n    if (t[n++] = l, l > 0) for (const [r, [a, o]] of s) t[n++] = r, t[n++] = a, t[n++] = o;\n    t[n++] = this.tessellationProperties._lineVertexBuffer.array.length;\n\n    for (let r = 0; r < this.tessellationProperties._lineVertexBuffer.array.length; r++) i[n++] = this.tessellationProperties._lineVertexBuffer.array[r];\n\n    t[n++] = this.tessellationProperties._lineIndexBuffer.array.length;\n\n    for (let r = 0; r < this.tessellationProperties._lineIndexBuffer.array.length; r++) t[n++] = this.tessellationProperties._lineIndexBuffer.array[r];\n\n    return t.buffer;\n  }\n\n  _processFeature(e, t, i) {\n    if (!e) return;\n    const n = e.length;\n\n    for (let s = 0; s < n; s++) this._processGeometry(e[s], t, i);\n  }\n\n  _processGeometry(e, t, n) {\n    if (e.length < 2) return;\n    const s = .001;\n    let l,\n        r,\n        a = e[0],\n        o = 1;\n\n    for (; o < e.length;) l = e[o].x - a.x, r = e[o].y - a.y, l * l + r * r < s * s ? e.splice(o, 1) : (a = e[o], ++o);\n\n    if (e.length < 2) return;\n    const u = this.tessellationProperties._lineIndexBuffer,\n          f = 3 * u.index;\n    this._tessellationOptions.initialDistance = 0, this._tessellationOptions.wrapDistance = i, this.tessellationProperties._ddValues = t, this._lineTessellator.tessellate(e, this._tessellationOptions);\n    const h = 3 * u.index - f;\n\n    if (void 0 !== n) {\n      const e = this._patternMap,\n            t = e.get(n);\n      t ? t[1] += h : e.set(n, [f + this._lineIndexCount, h]);\n    }\n\n    this._lineIndexCount += h;\n  }\n\n  _getDashArrayKey(e, t, i, n, s, l, r) {\n    const a = s ? l.getValue(t, e) : r,\n          o = n.getValue(t, e);\n    return i.getDashKey(o, a);\n  }\n\n}\n\nconst s = e => (t, i, n, s, l, r, a, o, u, f, h) => (e._lineVertexBuffer.add(t, i, a, o, n, s, l, r, u, f, h, e._ddValues), e._lineVertexBuffer.index - 1),\n      l = e => (t, i, n) => {\n  e._lineIndexBuffer.add(t, i, n);\n};\n\nexport default n;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/2d/engine/vectorTiles/buckets/LineBucket.js"],"names":["e","LineTessellation","t","i","n","constructor","r","a","type","_tessellationOptions","pixelCoordRatio","halfWidth","offset","_patternMap","Map","tessellationProperties","_lineVertexBuffer","_lineIndexBuffer","_ddValues","_lineTessellator","s","l","canUseThinTessellation","lineIndexStart","_lineIndexStart","lineIndexCount","_lineIndexCount","getResources","layer","zoom","hasDataDrivenLine","getPaintProperty","o","getLayoutProperty","u","getValue","f","isDataDriven","_features","add","name","_getDashArrayKey","getDashKey","processFeatures","index","h","lineMaterial","p","setExtent","layerExtent","d","g","y","c","_","x","D","getLayoutValue","V","m","P","I","L","v","B","T","j","A","getPaintValue","b","w","_spriteInfo","rect","encodeAttributes","getGeometry","push","ddAttributes","page","cap","join","miterLimit","roundLimit","geometry","sort","textured","capType","joinType","_processFeature","serialize","layerUIDs","length","array","size","Uint32Array","Int32Array","buffer","_processGeometry","splice","initialDistance","wrapDistance","tessellate","get","set"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./BaseBucket.js\";import{LineTessellation as t}from\"../../webgl/TurboLine.js\";const i=65535;class n extends e{constructor(e,i,n,r,a){super(e,i,n),this.type=2,this._tessellationOptions={pixelCoordRatio:8,halfWidth:0,offset:0},this._patternMap=new Map,this.tessellationProperties={_lineVertexBuffer:null,_lineIndexBuffer:null,_ddValues:null},this.tessellationProperties._lineVertexBuffer=r,this.tessellationProperties._lineIndexBuffer=a,this._lineTessellator=new t(s(this.tessellationProperties),l(this.tessellationProperties),e.canUseThinTessellation)}get lineIndexStart(){return this._lineIndexStart}get lineIndexCount(){return this._lineIndexCount}getResources(e,t,i){const n=this.layer,s=this.zoom,l=n.hasDataDrivenLine,r=n.getPaintProperty(\"line-pattern\"),a=n.getPaintProperty(\"line-dasharray\"),o=n.getLayoutProperty(\"line-cap\");if(!r&&!a)return;const u=(null==o?void 0:o.getValue(s))||0,f=null==o?void 0:o.isDataDriven;if(l){const e=null==r?void 0:r.isDataDriven,i=null==a?void 0:a.isDataDriven;if(!e&&!i)return;for(const l of this._features)e?t.add(r.getValue(s,l)):t.add({name:this._getDashArrayKey(l,s,n,a,f,o,u)})}else if(r)t.add(r.getValue(s));else if(a){const e=a.getValue(s);t.add({name:n.getDashKey(e,u)})}}processFeatures(e){var t,i,n,s,l,r;this._lineIndexStart=3*this.tessellationProperties._lineIndexBuffer.index,this._lineIndexCount=0;const a=this.layer,o=this.zoom,u=this._features,f=this._tessellationOptions,{hasDataDrivenLine:h,lineMaterial:p}=a;e&&e.setExtent(this.layerExtent);const d=a.getPaintProperty(\"line-pattern\"),g=a.getPaintProperty(\"line-dasharray\"),y=null==d?void 0:d.isDataDriven,c=null==g?void 0:g.isDataDriven;let _;_=a.getLayoutProperty(\"line-cap\");const x=null!=(t=_)&&t.isDataDriven?_:null,D=x?null:a.getLayoutValue(\"line-cap\",o),V=D||0,m=!!x;_=a.getLayoutProperty(\"line-join\");const P=null!=(i=_)&&i.isDataDriven?_:null,I=P?null:a.getLayoutValue(\"line-join\",o);_=a.getLayoutProperty(\"line-miter-limit\");const L=null!=(n=_)&&n.isDataDriven?_:null,v=L?null:a.getLayoutValue(\"line-miter-limit\",o);_=a.getLayoutProperty(\"line-round-limit\");const B=null!=(s=_)&&s.isDataDriven?_:null,T=B?null:a.getLayoutValue(\"line-round-limit\",o);_=a.getPaintProperty(\"line-width\");const j=null!=(l=_)&&l.isDataDriven?_:null,A=j?null:a.getPaintValue(\"line-width\",o);_=a.getPaintProperty(\"line-offset\");const b=null!=(r=_)&&r.isDataDriven?_:null,w=b?null:a.getPaintValue(\"line-offset\",o);if(y||c){const t=[];for(const i of u){const n=y?d.getValue(o,i):this._getDashArrayKey(i,o,a,g,m,x,V),s=this._spriteInfo[n];if(!s||!s.rect)continue;const l=p.encodeAttributes(i,o,a,s),r=i.getGeometry(e);t.push({ddAttributes:l,page:s.page,cap:x?x.getValue(o,i):D,join:P?P.getValue(o,i):I,miterLimit:L?L.getValue(o,i):v,roundLimit:B?B.getValue(o,i):T,halfWidth:.5*(j?j.getValue(o,i):A),offset:b?b.getValue(o,i):w,geometry:r})}t.sort(((e,t)=>e.page-t.page)),f.textured=!0;for(const{ddAttributes:e,page:i,cap:n,join:s,miterLimit:l,roundLimit:r,halfWidth:a,offset:o,geometry:u}of t)f.capType=n,f.joinType=s,f.miterLimit=l,f.roundLimit=r,f.halfWidth=a,f.offset=o,this._processFeature(u,e,i)}else{f.textured=!(!d&&!g),f.capType=D,f.joinType=I,f.miterLimit=v,f.roundLimit=T,f.halfWidth=.5*A,f.offset=w;for(const t of u){const i=h?p.encodeAttributes(t,o,a):null;x&&(f.capType=x.getValue(o,t)),P&&(f.joinType=P.getValue(o,t)),L&&(f.miterLimit=L.getValue(o,t)),B&&(f.roundLimit=B.getValue(o,t)),j&&(f.halfWidth=.5*j.getValue(o,t)),b&&(f.offset=b.getValue(o,t));const n=t.getGeometry(e);this._processFeature(n,i)}}}serialize(){let e=6;e+=this.layerUIDs.length,e+=this.tessellationProperties._lineVertexBuffer.array.length,e+=this.tessellationProperties._lineIndexBuffer.array.length,e+=3*this._patternMap.size+1;const t=new Uint32Array(e),i=new Int32Array(t.buffer);let n=0;t[n++]=this.type,t[n++]=this.layerUIDs.length;for(let r=0;r<this.layerUIDs.length;r++)t[n++]=this.layerUIDs[r];t[n++]=this._lineIndexStart,t[n++]=this._lineIndexCount;const s=this._patternMap,l=s.size;if(t[n++]=l,l>0)for(const[r,[a,o]]of s)t[n++]=r,t[n++]=a,t[n++]=o;t[n++]=this.tessellationProperties._lineVertexBuffer.array.length;for(let r=0;r<this.tessellationProperties._lineVertexBuffer.array.length;r++)i[n++]=this.tessellationProperties._lineVertexBuffer.array[r];t[n++]=this.tessellationProperties._lineIndexBuffer.array.length;for(let r=0;r<this.tessellationProperties._lineIndexBuffer.array.length;r++)t[n++]=this.tessellationProperties._lineIndexBuffer.array[r];return t.buffer}_processFeature(e,t,i){if(!e)return;const n=e.length;for(let s=0;s<n;s++)this._processGeometry(e[s],t,i)}_processGeometry(e,t,n){if(e.length<2)return;const s=.001;let l,r,a=e[0],o=1;for(;o<e.length;)l=e[o].x-a.x,r=e[o].y-a.y,l*l+r*r<s*s?e.splice(o,1):(a=e[o],++o);if(e.length<2)return;const u=this.tessellationProperties._lineIndexBuffer,f=3*u.index;this._tessellationOptions.initialDistance=0,this._tessellationOptions.wrapDistance=i,this.tessellationProperties._ddValues=t,this._lineTessellator.tessellate(e,this._tessellationOptions);const h=3*u.index-f;if(void 0!==n){const e=this._patternMap,t=e.get(n);t?t[1]+=h:e.set(n,[f+this._lineIndexCount,h])}this._lineIndexCount+=h}_getDashArrayKey(e,t,i,n,s,l,r){const a=s?l.getValue(t,e):r,o=n.getValue(t,e);return i.getDashKey(o,a)}}const s=e=>(t,i,n,s,l,r,a,o,u,f,h)=>(e._lineVertexBuffer.add(t,i,a,o,n,s,l,r,u,f,h,e._ddValues),e._lineVertexBuffer.index-1),l=e=>(t,i,n)=>{e._lineIndexBuffer.add(t,i,n)};export default n;\n"]},"metadata":{},"sourceType":"module"}