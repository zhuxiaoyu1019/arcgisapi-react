{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { s as t } from \"../../../../chunks/vec3.js\";\nimport { c as i } from \"../../../../chunks/vec3f64.js\";\nimport { create as r, empty as s, expandWithRect as o, center as a, set as n, toRect as d } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { create as h } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { demResolutionForBoundingBox as c } from \"./graphicUtils.js\";\n\nclass l {\n  constructor(e, t, i) {\n    this.graphics3DSymbolLayer = e, this.renderGeometries = t, this.boundingBox = i, this.type = \"draped\", this.stage = null, this._visible = !1, this._addedToStage = !1, this._layerView = null, this.isElevationSource = !1;\n  }\n\n  initialize(e, t, i) {\n    this.stage = e, this._layerView = i, this._overlayRenderer = this._layerView.view.basemapTerrain.overlayManager.renderer;\n  }\n\n  setVisibility(e) {\n    if (null != this.stage && this._visible !== e) {\n      if (this._visible = e, e && !this._addedToStage) return this._addedToStage = !0, void this._overlayRenderer.addGeometries(this.renderGeometries, this._layerView, 1);\n\n      if (e || this._addedToStage) {\n        for (const e of this.renderGeometries) e.instanceParameters.visible = this._visible;\n\n        this._overlayRenderer.updateGeometries(this.renderGeometries, this._layerView, 1);\n      }\n    }\n  }\n\n  destroy() {\n    this.stage && this._addedToStage && this._overlayRenderer.removeGeometries(this.renderGeometries, this._layerView, 4), this._addedToStage = !1, this._visible = !1, this.stage = null;\n  }\n\n  getCenterObjectSpace(e = i()) {\n    return t(e, 0, 0, 0);\n  }\n\n  getBoundingBoxObjectSpace(e = r()) {\n    return s(e);\n  }\n\n  addObjectState(e, t) {\n    0 === e && (this.renderGeometries.forEach(e => {\n      const i = e.addHighlight();\n      t.addRenderGeometry(e, i, this);\n    }), this._addedToStage && this._overlayRenderer.updateHighlights(this.renderGeometries, this._layerView));\n  }\n\n  removeObjectState(e) {\n    this.renderGeometries.forEach(t => {\n      e.removeRenderGeometry(t);\n    });\n  }\n\n  removeRenderGeometryObjectState(e, t) {\n    e.removeHighlight(t), this._addedToStage && this._overlayRenderer.updateHighlights(this.renderGeometries, this._layerView);\n  }\n\n  computeAttachmentOrigin(e) {\n    for (const t of this.renderGeometries) t.computeAttachmentOrigin(u) && (e.draped.origin[0] += u[0], e.draped.origin[1] += u[1], e.draped.num++);\n  }\n\n  async getProjectedBoundingBox(t, i, r, n, d) {\n    s(d);\n\n    for (let e = 0; e < this.renderGeometries.length; e++) {\n      const i = this.renderGeometries[e];\n      this._getRenderGeometryProjectedBoundingRect(i, t, m, r), o(d, m);\n    }\n\n    if (i) {\n      let t;\n      a(d, u);\n      const r = c(d, i);\n\n      try {\n        t = await i.service.queryElevation(u[0], u[1], n, r, \"ground\");\n      } catch (h) {}\n\n      e(t) && (d[2] = Math.min(d[2], t), d[5] = Math.max(d[5], t));\n    }\n\n    return d;\n  }\n\n  _getRenderGeometryProjectedBoundingRect(e, t, i, r) {\n    if (this.boundingBox) n(g, this.boundingBox);else {\n      const t = e.boundingSphere,\n            i = t[3];\n      g[0] = t[0] - i, g[1] = t[1] - i, g[2] = t[2] - i, g[3] = t[0] + i, g[4] = t[1] + i, g[5] = t[2] + i;\n    }\n    return t(g, 0, 2), this.calculateRelativeScreenBounds && r.push({\n      location: a(g),\n      screenSpaceBoundingRect: this.calculateRelativeScreenBounds()\n    }), d(g, i);\n  }\n\n}\n\nconst m = h(),\n      g = r(),\n      u = i();\nexport default l;","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer.js"],"names":["isSome","e","s","t","c","i","create","r","empty","expandWithRect","o","center","a","set","n","toRect","d","h","demResolutionForBoundingBox","l","constructor","graphics3DSymbolLayer","renderGeometries","boundingBox","type","stage","_visible","_addedToStage","_layerView","isElevationSource","initialize","_overlayRenderer","view","basemapTerrain","overlayManager","renderer","setVisibility","addGeometries","instanceParameters","visible","updateGeometries","destroy","removeGeometries","getCenterObjectSpace","getBoundingBoxObjectSpace","addObjectState","forEach","addHighlight","addRenderGeometry","updateHighlights","removeObjectState","removeRenderGeometry","removeRenderGeometryObjectState","removeHighlight","computeAttachmentOrigin","u","draped","origin","num","getProjectedBoundingBox","length","_getRenderGeometryProjectedBoundingRect","m","service","queryElevation","Math","min","max","g","boundingSphere","calculateRelativeScreenBounds","push","location","screenSpaceBoundingRect"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{s as t}from\"../../../../chunks/vec3.js\";import{c as i}from\"../../../../chunks/vec3f64.js\";import{create as r,empty as s,expandWithRect as o,center as a,set as n,toRect as d}from\"../../../../geometry/support/aaBoundingBox.js\";import{create as h}from\"../../../../geometry/support/aaBoundingRect.js\";import{demResolutionForBoundingBox as c}from\"./graphicUtils.js\";class l{constructor(e,t,i){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=i,this.type=\"draped\",this.stage=null,this._visible=!1,this._addedToStage=!1,this._layerView=null,this.isElevationSource=!1}initialize(e,t,i){this.stage=e,this._layerView=i,this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}}}destroy(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=i()){return t(e,0,0,0)}getBoundingBoxObjectSpace(e=r()){return s(e)}addObjectState(e,t){0===e&&(this.renderGeometries.forEach((e=>{const i=e.addHighlight();t.addRenderGeometry(e,i,this)})),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))}removeObjectState(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(u)&&(e.draped.origin[0]+=u[0],e.draped.origin[1]+=u[1],e.draped.num++)}async getProjectedBoundingBox(t,i,r,n,d){s(d);for(let e=0;e<this.renderGeometries.length;e++){const i=this.renderGeometries[e];this._getRenderGeometryProjectedBoundingRect(i,t,m,r),o(d,m)}if(i){let t;a(d,u);const r=c(d,i);try{t=await i.service.queryElevation(u[0],u[1],n,r,\"ground\")}catch(h){}e(t)&&(d[2]=Math.min(d[2],t),d[5]=Math.max(d[5],t))}return d}_getRenderGeometryProjectedBoundingRect(e,t,i,r){if(this.boundingBox)n(g,this.boundingBox);else{const t=e.boundingSphere,i=t[3];g[0]=t[0]-i,g[1]=t[1]-i,g[2]=t[2]-i,g[3]=t[0]+i,g[4]=t[1]+i,g[5]=t[2]+i}return t(g,0,2),this.calculateRelativeScreenBounds&&r.push({location:a(g),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),d(g,i)}}const m=h(),g=r(),u=i();export default l;\n"]},"metadata":{},"sourceType":"module"}