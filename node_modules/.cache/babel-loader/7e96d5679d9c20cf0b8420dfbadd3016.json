{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../core/has.js\";\nimport { eventKey as t } from \"./keys.js\";\nimport { GamepadSource as n } from \"./gamepad/GamepadSource.js\";\nimport { createScreenPointFromNativeEvent as i } from \"../support/screenUtils.js\";\nconst o = e(\"trident\"),\n      a = e(\"edge\"),\n      s = e(\"chrome\"),\n      r = e(\"ff\"),\n      h = e(\"safari\"),\n      l = {\n  touchNone: \"esri-view-surface--touch-none\",\n  touchPan: \"esri-view-surface--touch-pan\"\n};\n\nclass u {\n  constructor(e, t) {\n    this.input = t, this._active = {}, this._activePointerCaptures = new Set(), this._keyDownState = new Set(), this._eventId = 1, this._browserTouchPanningEnabled = !1, this._element = e, e.getAttribute(\"tabindex\") || e.setAttribute(\"tabindex\", \"0\"), this._eventHandlers = {\n      \"key-down\": this._handleKey,\n      \"key-up\": this._handleKey,\n      \"pointer-down\": this._handlePointer,\n      \"pointer-move\": this._handlePointerPreventDefault,\n      \"pointer-up\": this._handlePointerPreventDefault,\n      \"pointer-enter\": this._handlePointer,\n      \"pointer-leave\": this._handlePointer,\n      \"pointer-cancel\": this._handlePointer,\n      \"mouse-wheel\": this._handleMouseWheel,\n      \"pointer-capture-lost\": this._handlePointerCaptureLost\n    }, this._updateTouchAction(), this._element.addEventListener(\"keydown\", this._preventAltKeyDefault), this._gamepadSource = new n(e, this.input), this._gamepadSource.onEvent = e => this._callback(\"gamepad\", e);\n  }\n\n  destroy() {\n    this._callback = null, this.activeEvents = null, this._activePointerCaptures.forEach(e => {\n      this._releasePointerCaptureSafe(e);\n    }), this._gamepadSource && (this._gamepadSource.destroy(), this._gamepadSource = null), this._activePointerCaptures = null, this._removeTouchAction(), this._element.removeEventListener(\"keydown\", this._preventAltKeyDefault);\n  }\n\n  get browserTouchPanningEnabled() {\n    return this._browserTouchPanningEnabled;\n  }\n\n  set browserTouchPanningEnabled(e) {\n    this._browserTouchPanningEnabled = e, this._updateTouchAction(), this._updateTouchEventHandling();\n  }\n\n  set onEventReceived(e) {\n    this._callback = e;\n  }\n\n  set activeEvents(e) {\n    for (const t in this._active) if (!e || !e.has(t)) {\n      const e = this._active[t];\n      this._element.removeEventListener(c[t], e), delete this._active[t];\n    }\n\n    e && e.forEach(e => {\n      if (!this._active[e] && c[e]) {\n        const t = (this._eventHandlers[e] || this._handleDefault).bind(this, e);\n\n        this._element.addEventListener(c[e], t), this._active[e] = t;\n      }\n    }), this._gamepadSource.hasEventListeners = e && e.has(\"gamepad\");\n  }\n\n  setPointerCapture(e, t) {\n    t ? (this._element.setPointerCapture(e.pointerId), this._activePointerCaptures.add(e.pointerId)) : (this._releasePointerCaptureSafe(e.pointerId), this._activePointerCaptures.delete(e.pointerId));\n  }\n\n  _updateTouchAction() {\n    this._element.classList.remove(this._browserTouchPanningEnabled ? l.touchNone : l.touchPan), this._element.classList.add(this._browserTouchPanningEnabled ? l.touchPan : l.touchNone);\n  }\n\n  _updateTouchEventHandling() {\n    this._browserTouchPanningEnabled ? this._element.addEventListener(\"touchmove\", this._preventMultiTouchPanning) : this._element.removeEventListener(\"touchmove\", this._preventMultiTouchPanning);\n  }\n\n  _removeTouchAction() {\n    this._element.classList.remove(l.touchNone), this._element.classList.remove(l.touchPan), this._element.removeEventListener(\"touchmove\", this._preventMultiTouchPanning);\n  }\n\n  _releasePointerCaptureSafe(e) {\n    try {\n      if (this._element.hasPointerCapture && !this._element.hasPointerCapture(e)) return;\n\n      this._element.releasePointerCapture(e);\n    } catch (t) {}\n  }\n\n  _updateNormalizedPointerLikeEvent(e, t) {\n    const n = i(this._element, e);\n    return u.test.disableSubpixelCoordinates && (n.x = Math.round(n.x), n.y = Math.round(n.y)), t.x = n.x, t.y = n.y, t;\n  }\n\n  _handleKey(e, n) {\n    const i = t(n);\n    i && \"key-up\" === e && this._keyDownState.delete(i);\n    const o = {\n      native: n,\n      key: i,\n      repeat: i && this._keyDownState.has(i)\n    };\n    i && \"key-down\" === e && this._keyDownState.add(o.key), this._callback(e, o);\n  }\n\n  _handlePointer(e, t) {\n    const n = this._updateNormalizedPointerLikeEvent(t, {\n      native: t,\n      x: 0,\n      y: 0,\n      pointerType: t.pointerType,\n      button: t.button,\n      buttons: t.buttons,\n      eventId: this._eventId++\n    });\n\n    this._callback(e, n);\n  }\n\n  _handlePointerPreventDefault(e, t) {\n    const n = this._updateNormalizedPointerLikeEvent(t, {\n      native: t,\n      x: 0,\n      y: 0,\n      pointerType: t.pointerType,\n      button: t.button,\n      buttons: t.buttons,\n      eventId: this._eventId++\n    });\n\n    t.preventDefault(), this._callback(e, n);\n  }\n\n  _handleMouseWheel(e, t) {\n    let n = t.deltaY;\n\n    switch (t.deltaMode) {\n      case 0:\n        (o || a) && (n = n / document.documentElement.clientHeight * 600);\n        break;\n\n      case 1:\n        n *= 30;\n        break;\n\n      case 2:\n        n *= 900;\n    }\n\n    o || a ? n *= .7 : s || h ? n *= .6 : r && (n *= 1.375);\n    const i = 100,\n          l = Math.abs(n);\n\n    if (l > i) {\n      const e = .02;\n      n = n / l * 200 / (1 + Math.exp(-e * (l - i)));\n    }\n\n    const u = this._updateNormalizedPointerLikeEvent(t, {\n      native: t,\n      x: 0,\n      y: 0,\n      deltaY: n\n    });\n\n    this._callback(e, u);\n  }\n\n  _handlePointerCaptureLost(e, t) {\n    this._activePointerCaptures.delete(t.pointerId), this._handleDefault(e, t);\n  }\n\n  _handleDefault(e, t) {\n    const n = {\n      native: t\n    };\n    t.preventDefault(), this._callback(e, n);\n  }\n\n  _preventAltKeyDefault(e) {\n    \"Alt\" === e.key && e.preventDefault();\n  }\n\n  _preventMultiTouchPanning(e) {\n    e.touches.length > 1 && e.preventDefault();\n  }\n\n}\n\nu.test = {\n  disableSubpixelCoordinates: !1\n};\nconst c = {\n  \"key-down\": \"keydown\",\n  \"key-up\": \"keyup\",\n  \"pointer-down\": \"pointerdown\",\n  \"pointer-up\": \"pointerup\",\n  \"pointer-move\": \"pointermove\",\n  \"mouse-wheel\": \"wheel\",\n  \"pointer-capture-got\": \"gotpointercapture\",\n  \"pointer-capture-lost\": \"lostpointercapture\",\n  \"context-menu\": \"contextmenu\",\n  \"pointer-enter\": \"pointerenter\",\n  \"pointer-leave\": \"pointerleave\",\n  \"pointer-cancel\": \"pointercancel\",\n  focus: \"focus\",\n  blur: \"blur\"\n};\nexport { u as BrowserEventSource };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgisapi-react/node_modules/@arcgis/core/views/input/BrowserEventSource.js"],"names":["e","eventKey","t","GamepadSource","n","createScreenPointFromNativeEvent","i","o","a","s","r","h","l","touchNone","touchPan","u","constructor","input","_active","_activePointerCaptures","Set","_keyDownState","_eventId","_browserTouchPanningEnabled","_element","getAttribute","setAttribute","_eventHandlers","_handleKey","_handlePointer","_handlePointerPreventDefault","_handleMouseWheel","_handlePointerCaptureLost","_updateTouchAction","addEventListener","_preventAltKeyDefault","_gamepadSource","onEvent","_callback","destroy","activeEvents","forEach","_releasePointerCaptureSafe","_removeTouchAction","removeEventListener","browserTouchPanningEnabled","_updateTouchEventHandling","onEventReceived","has","c","_handleDefault","bind","hasEventListeners","setPointerCapture","pointerId","add","delete","classList","remove","_preventMultiTouchPanning","hasPointerCapture","releasePointerCapture","_updateNormalizedPointerLikeEvent","test","disableSubpixelCoordinates","x","Math","round","y","native","key","repeat","pointerType","button","buttons","eventId","preventDefault","deltaY","deltaMode","document","documentElement","clientHeight","abs","exp","touches","length","focus","blur","BrowserEventSource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../core/has.js\";import{eventKey as t}from\"./keys.js\";import{GamepadSource as n}from\"./gamepad/GamepadSource.js\";import{createScreenPointFromNativeEvent as i}from\"../support/screenUtils.js\";const o=e(\"trident\"),a=e(\"edge\"),s=e(\"chrome\"),r=e(\"ff\"),h=e(\"safari\"),l={touchNone:\"esri-view-surface--touch-none\",touchPan:\"esri-view-surface--touch-pan\"};class u{constructor(e,t){this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute(\"tabindex\")||e.setAttribute(\"tabindex\",\"0\"),this._eventHandlers={\"key-down\":this._handleKey,\"key-up\":this._handleKey,\"pointer-down\":this._handlePointer,\"pointer-move\":this._handlePointerPreventDefault,\"pointer-up\":this._handlePointerPreventDefault,\"pointer-enter\":this._handlePointer,\"pointer-leave\":this._handlePointer,\"pointer-cancel\":this._handlePointer,\"mouse-wheel\":this._handleMouseWheel,\"pointer-capture-lost\":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener(\"keydown\",this._preventAltKeyDefault),this._gamepadSource=new n(e,this.input),this._gamepadSource.onEvent=e=>this._callback(\"gamepad\",e)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener(\"keydown\",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(c[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&c[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(c[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e&&e.has(\"gamepad\")}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?l.touchNone:l.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?l.touchPan:l.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener(\"touchmove\",this._preventMultiTouchPanning):this._element.removeEventListener(\"touchmove\",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(l.touchNone),this._element.classList.remove(l.touchPan),this._element.removeEventListener(\"touchmove\",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(t){}}_updateNormalizedPointerLikeEvent(e,t){const n=i(this._element,e);return u.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),t.x=n.x,t.y=n.y,t}_handleKey(e,n){const i=t(n);i&&\"key-up\"===e&&this._keyDownState.delete(i);const o={native:n,key:i,repeat:i&&this._keyDownState.has(i)};i&&\"key-down\"===e&&this._keyDownState.add(o.key),this._callback(e,o)}_handlePointer(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}_handlePointerPreventDefault(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}_handleMouseWheel(e,t){let n=t.deltaY;switch(t.deltaMode){case 0:(o||a)&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}o||a?n*=.7:s||h?n*=.6:r&&(n*=1.375);const i=100,l=Math.abs(n);if(l>i){const e=.02;n=n/l*200/(1+Math.exp(-e*(l-i)))}const u=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,u)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const n={native:t};t.preventDefault(),this._callback(e,n)}_preventAltKeyDefault(e){\"Alt\"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}u.test={disableSubpixelCoordinates:!1};const c={\"key-down\":\"keydown\",\"key-up\":\"keyup\",\"pointer-down\":\"pointerdown\",\"pointer-up\":\"pointerup\",\"pointer-move\":\"pointermove\",\"mouse-wheel\":\"wheel\",\"pointer-capture-got\":\"gotpointercapture\",\"pointer-capture-lost\":\"lostpointercapture\",\"context-menu\":\"contextmenu\",\"pointer-enter\":\"pointerenter\",\"pointer-leave\":\"pointerleave\",\"pointer-cancel\":\"pointercancel\",focus:\"focus\",blur:\"blur\"};export{u as BrowserEventSource};\n"]},"metadata":{},"sourceType":"module"}