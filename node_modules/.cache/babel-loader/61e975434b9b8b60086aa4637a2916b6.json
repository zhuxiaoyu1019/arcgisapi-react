{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Error.js\";\nimport { isSome as t, isNone as s } from \"../../../core/maybe.js\";\nimport { whenOrAbort as r, eachAlwaysValues as o, isAborted as n, throwIfAborted as a } from \"../../../core/promiseUtils.js\";\nimport { makeRelative as i, removeFile as l } from \"../../../core/urlUtils.js\";\nimport c from \"../../Point.js\";\n\nasync function u(e, s, o) {\n  const {\n    loadGLTFMesh: n\n  } = await r(import(\"./loadGLTFMesh.js\"), o),\n        a = await m(s, o),\n        i = n(new c({\n    x: 0,\n    y: 0,\n    z: 0,\n    spatialReference: e.spatialReference\n  }), a.url, {\n    resolveFile: f(a),\n    useTransform: !0,\n    signal: t(o) ? o.signal : null\n  });\n  i.then(() => a.dispose(), () => a.dispose());\n  const {\n    vertexAttributes: l,\n    components: u\n  } = await i;\n  e.vertexAttributes = l, e.components = u;\n}\n\nfunction f(e) {\n  const t = l(e.url);\n  return s => {\n    var r;\n    const o = i(s, t, t),\n          n = o ? o.replace(/^ *\\.\\//, \"\") : null;\n    return null != (r = e.files.get(n)) ? r : s;\n  };\n}\n\nasync function m(e, t) {\n  return e instanceof Blob ? y.fromBlob(e) : \"string\" == typeof e ? new y(e) : Array.isArray(e) ? p(e, t) : w(e, t);\n}\n\nasync function p(t, r) {\n  const i = new Map();\n  let l = null;\n  const c = await o(t.map(async e => ({\n    name: e.name,\n    source: await m(e instanceof Blob ? e : e.source, r)\n  }))),\n        u = [];\n\n  for (const e of c) e && (n(r) ? e.source.dispose() : u.push(e));\n\n  a(r);\n\n  for (const {\n    name: e,\n    source: o\n  } of u) (s(l) || /\\.(gltf|glb)/i.test(e)) && (l = o.url), i.set(e, o.url), o.files && o.files.forEach((e, t) => i.set(t, e));\n\n  if (s(l)) throw new e(\"mesh-load-external:missing-files\", \"Missing files to load external mesh source\");\n  return new y(l, () => u.forEach(({\n    source: e\n  }) => e.dispose()), i);\n}\n\nasync function w(e, t) {\n  const {\n    default: s\n  } = await r(import(\"../../../request.js\"), t),\n        o = \"string\" == typeof e.multipart[0] ? await Promise.all(e.multipart.map(async e => (await s(e, {\n    responseType: \"array-buffer\"\n  })).data)) : e.multipart;\n  return y.fromBlob(new Blob(o));\n}\n\nclass y {\n  constructor(e, t = () => {}, s = new Map()) {\n    this.url = e, this.dispose = t, this.files = s;\n  }\n\n  static fromBlob(e) {\n    const t = URL.createObjectURL(e);\n    return new y(t, () => URL.revokeObjectURL(t));\n  }\n\n}\n\nexport { u as loadExternal };","map":{"version":3,"sources":["/Users/xiaoyuzhu/Desktop/arcgis-api-react/node_modules/@arcgis/core/geometry/support/meshUtils/loadExternal.js"],"names":["e","isSome","t","isNone","s","whenOrAbort","r","eachAlwaysValues","o","isAborted","n","throwIfAborted","a","makeRelative","i","removeFile","l","c","u","loadGLTFMesh","m","x","y","z","spatialReference","url","resolveFile","f","useTransform","signal","then","dispose","vertexAttributes","components","replace","files","get","Blob","fromBlob","Array","isArray","p","w","Map","map","name","source","push","test","set","forEach","default","multipart","Promise","all","responseType","data","constructor","URL","createObjectURL","revokeObjectURL","loadExternal"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import{isSome as t,isNone as s}from\"../../../core/maybe.js\";import{whenOrAbort as r,eachAlwaysValues as o,isAborted as n,throwIfAborted as a}from\"../../../core/promiseUtils.js\";import{makeRelative as i,removeFile as l}from\"../../../core/urlUtils.js\";import c from\"../../Point.js\";async function u(e,s,o){const{loadGLTFMesh:n}=await r(import(\"./loadGLTFMesh.js\"),o),a=await m(s,o),i=n(new c({x:0,y:0,z:0,spatialReference:e.spatialReference}),a.url,{resolveFile:f(a),useTransform:!0,signal:t(o)?o.signal:null});i.then((()=>a.dispose()),(()=>a.dispose()));const{vertexAttributes:l,components:u}=await i;e.vertexAttributes=l,e.components=u}function f(e){const t=l(e.url);return s=>{var r;const o=i(s,t,t),n=o?o.replace(/^ *\\.\\//,\"\"):null;return null!=(r=e.files.get(n))?r:s}}async function m(e,t){return e instanceof Blob?y.fromBlob(e):\"string\"==typeof e?new y(e):Array.isArray(e)?p(e,t):w(e,t)}async function p(t,r){const i=new Map;let l=null;const c=await o(t.map((async e=>({name:e.name,source:await m(e instanceof Blob?e:e.source,r)})))),u=[];for(const e of c)e&&(n(r)?e.source.dispose():u.push(e));a(r);for(const{name:e,source:o}of u)(s(l)||/\\.(gltf|glb)/i.test(e))&&(l=o.url),i.set(e,o.url),o.files&&o.files.forEach(((e,t)=>i.set(t,e)));if(s(l))throw new e(\"mesh-load-external:missing-files\",\"Missing files to load external mesh source\");return new y(l,(()=>u.forEach((({source:e})=>e.dispose()))),i)}async function w(e,t){const{default:s}=await r(import(\"../../../request.js\"),t),o=\"string\"==typeof e.multipart[0]?await Promise.all(e.multipart.map((async e=>(await s(e,{responseType:\"array-buffer\"})).data))):e.multipart;return y.fromBlob(new Blob(o))}class y{constructor(e,t=(()=>{}),s=new Map){this.url=e,this.dispose=t,this.files=s}static fromBlob(e){const t=URL.createObjectURL(e);return new y(t,(()=>URL.revokeObjectURL(t)))}}export{u as loadExternal};\n"]},"metadata":{},"sourceType":"module"}